# ERDMS - Project Context Memory

## ğŸ“‹ ZÃ¡kladnÃ­ informace o projektu

### NÃ¡zev projektu
**ERDMS** - ElektronickÃ½ RozcestnÃ­k pro Dokument Management System

### Organizace
**ZZS** - ZdravotnickÃ¡ zÃ¡chrannÃ¡ sluÅ¾ba

### ProdukÄnÃ­ domÃ©na
- **URL:** https://erdms.zachranka.cz
- **SSL:** âœ… AktivnÃ­

---

## ğŸ“‚ Struktura projektu

### Development workspace: `/var/www/erdms-dev/`
```
erdms-dev/
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ eeo-v2/                 # EEO aplikace v2
â”‚       â”œâ”€â”€ api/                # Node.js testy a skripty
â”‚       â”œâ”€â”€ api-legacy/         # StarÅ¡Ã­ PHP API
â”‚       â””â”€â”€ client/             # Frontend EEO
â”‚
â”œâ”€â”€ auth-api/                   # AutentizaÄnÃ­ API (Node.js)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ index.js
â”‚
â”œâ”€â”€ dashboard/                  # ğŸ¯ HLAVNÃ DASHBOARD (React + Vite)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.jsx   # HlavnÃ­ komponenta
â”‚   â”‚   â”‚   â””â”€â”€ Dashboard.css   # Styling (Å¡irokÃ© karty, vlevo, hover efekty)
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ App.jsx
â”‚   â”‚   â”œâ”€â”€ App.css
â”‚   â”‚   â””â”€â”€ main.jsx
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â””â”€â”€ .env                    # PORT=5173
â”‚
â””â”€â”€ docs/                       # Dokumentace
    â”œâ”€â”€ deployment/
    â”œâ”€â”€ development/
    â”œâ”€â”€ production/
    â””â”€â”€ setup/
```

### Production build: `/var/www/erdms/` (TBD)
```
erdms/
â””â”€â”€ (ÄekÃ¡ na deployment z erdms-dev/dashboard build)
```

---

## ğŸ” Autentizace - Microsoft Entra ID

### Technologie
- **Frontend:** `@azure/msal-react` (v3.0.22)
- **Backend:** `@azure/msal-node` (v3.8.3)

### Flow
1. User â†’ PÅ™ihlÃ¡Å¡enÃ­ pÅ™es Microsoft (SSO)
2. Frontend zÃ­skÃ¡ Access Token
3. Frontend â†’ API s `Bearer Token` v hlaviÄce
4. Backend validuje token pomocÃ­ JWKS
5. Backend vracÃ­ data

### Konfigurace (.env)

**Client (.env):**
```env
VITE_AZURE_CLIENT_ID=...
VITE_AZURE_TENANT_ID=...
VITE_AZURE_AUTHORITY=https://login.microsoftonline.com/{TENANT_ID}
VITE_REDIRECT_URI=https://erdms.zachranka.cz
VITE_AZURE_API_SCOPE=api://{CLIENT_ID}/access_as_user
```

**Server (.env):**
```env
AZURE_CLIENT_ID=...
AZURE_TENANT_ID=...
AZURE_CLIENT_SECRET=...
AZURE_AUTHORITY=https://login.microsoftonline.com/{TENANT_ID}
AZURE_API_SCOPE=api://{CLIENT_ID}/access_as_user
PORT=5000
NODE_ENV=production
```

### Scopes
- **Login:** `User.Read`, `profile`, `email`, `openid`
- **API:** `api://{CLIENT_ID}/access_as_user`

---

## ğŸ› ï¸ Technologie

### Dashboard (React + Vite)
- **React:** 18.3.1
- **Vite:** 6.0.1 (build tool, dev server na :5173)
- **React Router:** DOM 7.1.1
- **Axios:** 1.7.9 (HTTP klient)
- **MSAL React:** TBD (pÅ™ipraveno pro Entra ID)

### Auth API (Node.js)
- **Node.js:** 20.x (pÅ™es NVM)
- **Express:** TBD
- **Database:** MariaDB 11.8.3 (10.3.172.11:3306)

### EEO v2 API
- **Node.js:** Testy a scripty
- **PHP:** 8.4.11 (legacy API)

### Server
- **Web server:** Apache 2.4
- **OS:** Linux
- **Process manager:** systemd / nohup

---

## ğŸš€ SpuÅ¡tÄ›nÃ­

### Development

**Dashboard (hlavnÃ­ rozcestnÃ­k):**
```bash
cd /var/www/erdms-dev/dashboard
npm run dev                    # Vite dev server na portu 5173
# http://localhost:5173
```

**Auth API:**
```bash
cd /var/www/erdms-dev/auth-api
npm start
```

**EEO v2:**
```bash
cd /var/www/erdms-dev/apps/eeo-v2/client
npm run dev
```

### Production (TBD)
```bash
# Dashboard build
cd /var/www/erdms-dev/dashboard
npm run build                  # VytvoÅ™Ã­ dist/

# Deploy do /var/www/erdms/
# (ÄekÃ¡ na konfiguraci)
```

---

## ğŸ“¦ Build & Deploy workflow

### 1. ZmÄ›ny v kÃ³du
```bash
# Edituj soubory v /var/www/eeo2025/client/ nebo /server/
```

### 2. Test v development
```bash
cd /var/www/eeo2025/client && npm run dev
cd /var/www/eeo2025/server && npm run dev
```

### 3. Build frontend
```bash
cd /var/www/eeo2025/client
npm run build                   # VytvoÅ™Ã­ dist/
```

### 4. Deploy frontend
```bash
cp -r /var/www/eeo2025/client/dist/* /var/www/erdms/
```

### 5. Deploy backend
```bash
# ZkopÃ­ruj zmÄ›nÄ›nÃ© soubory
cp /var/www/eeo2025/server/src/* /var/www/erdms/api/v1.0/src/

# Restart API
kill $(cat /var/run/erdms-api.pid)
cd /var/www/erdms/api/v1.0 && nohup node src/index.js > /var/log/erdms-api.log 2>&1 &
echo $! > /var/run/erdms-api.pid
```

### 6. OvÄ›Å™enÃ­
```bash
# Health check
curl http://localhost:5000/api/health

# Test v prohlÃ­Å¾eÄi
firefox https://erdms.zachranka.cz
```

---

## ğŸŒ Apache VirtualHost konfigurace

**Soubor:** `/etc/apache2/sites-available/erdms.zachranka.cz.conf`

### KlÃ­ÄovÃ© direktivy
- **DocumentRoot:** `/var/www/erdms/`
- **ServerName:** `erdms.zachranka.cz`
- **SSL:** âœ… AktivnÃ­ (certifikÃ¡t Let's Encrypt)
- **API Proxy:** `/api â†’ http://localhost:5000/api`
- **SPA Routing:** `FallbackResource /index.html`

### Proxy nastavenÃ­
```apache
ProxyPass /api http://localhost:5000/api
ProxyPassReverse /api http://localhost:5000/api
```

---

## ğŸ” DÅ¯leÅ¾itÃ© endpointy

### API
- **Health:** `GET http://localhost:5000/api/health`
- **Auth Token:** `POST http://localhost:5000/api/auth/token`
- **Protected Data:** `GET http://localhost:5000/api/protected/data`

### Frontend
- **Homepage:** `https://erdms.zachranka.cz/`
- **Login:** `https://erdms.zachranka.cz/` (HomePage zobrazÃ­ login)

---

## âš ï¸ AktuÃ¡lnÃ­ stav projektu

### âœ… Co funguje (5. prosince 2025)
- **Dashboard:** React + Vite aplikace bÄ›Å¾Ã­ na :5173
- **UI Design:** Å irokÃ© karty (400px), zarovnanÃ© vlevo, hover efekty na ikonÃ¡ch
- **Database:** MariaDB pÅ™ipojenÃ­ funguje (10.3.172.11:3306)
- **Struktura:** ModulÃ¡rnÃ­ aplikace (dashboard, auth-api, eeo-v2)

### ğŸ”œ TODO
- [ ] Dashboard UI - dokonÄit employees tab (search bar, clear button)
- [ ] Entra ID integrace - zÃ­skat credentials
- [ ] Production build & deployment
- [ ] Apache konfigurace pro production

## ğŸ¨ UI Design Pravidla (Dashboard)

### AplikaÄnÃ­ karty
- **Å Ã­Å™ka:** 400px (Å¡irokÃ© obdÃ©lnÃ­ky)
- **ZarovnÃ¡nÃ­:** Vlevo (justify-content: flex-start)
- **Border radius:** 16px
- **Min vÃ½Å¡ka:** 180px
- **Gap:** 1.5rem

### Hover efekty
- **Karty:** 
  - Transform: translateY(-4px)
  - Shadow: rgba(0,0,0,0.08)
  - Border bottom: 3px solid #FDB714 (Å¾lutÃ¡)
- **Ikony:**
  - Transform: scale(1.1) rotate(5deg)
  - Shadow: zvÃ½raznÄ›nÃ½

### Barvy
- **Å½lutÃ¡ accent:** #FDB714 (hover border)
- **ModrÃ¡ primÃ¡rnÃ­:** #003D7A (tabs active)
- **Gradienty:** RÅ¯znÃ© pro EEO, Intranet, Admin karty

### âš ï¸ DÅ®LEÅ½ITÃ‰
- **BEZ Å¾lutÃ©ho stÃ­nu** na kartÃ¡ch!
- **BEZ centrovÃ¡nÃ­** kontejneru!
- Ikony majÃ­ hover, ne karty shadow!
- Search input musÃ­ mÃ­t viditelnÃ½ text (color: #1e293b)

---

## ğŸ“ PoznÃ¡mky

### Git repository
- **Owner:** robex08
- **Repo:** eeo2025-erdms
- **Branch:** main (default)

### Node.js verze
- PouÅ¾Ã­vÃ¡ se pÅ™es NVM (`~/.nvm/nvm.sh`)
- Verze: 20.x

### PHP verze
- **CLI:** PHP 8.4.11 (NTS)
- **FPM:** PHP 8.4 FastCGI Process Manager
- **Status:** âœ… AktivnÃ­ (bÄ›Å¾Ã­ od 24. Å™Ã­jna 2025)
- **Zend Engine:** v4.4.11
- **OPcache:** âœ… AktivnÃ­
- **Config:** `/etc/php/8.4/`
- **PoznÃ¡mka:** Apache nepouÅ¾Ã­vÃ¡ PHP modul (mod_php), ale FastCGI (php-fpm)

### MySQL/Database
- **Server IP:** 10.3.172.11
- **Port:** 3306 (standardnÃ­ MySQL port)
- **Status:** âœ… FUNKÄŒNÃ - Firewall opraven, pÅ™ipojenÃ­ funguje!
- **Verze serveru:** MariaDB 11.8.3-0+deb13u1 (Debian)
- **Typ serveru:** MariaDB (TCP connection)
- **Verze protokolu:** 10
- **PÅ™ipojenÃ­:** âš ï¸ SSL musÃ­ bÃ½t vypnuto (`--skip-ssl`) - chyba "wrong version number"
- **phpMyAdmin:** 5.2.2deb1 (localhost:3306)
- **MySQL klient:** âœ… NainstalovanÃ½ na web serveru (mariadb-client 11.8.3)
- **Firewall:** âœ… Opraveno - web server 10.3.174.11 mÃ¡ pÅ™Ã­stup
- **DatabÃ¡zovÃ© extensions PHP:** mysqli, mysqlnd 8.4.11, pdo_mysql

#### DatabÃ¡ze ERDMS:
- **NÃ¡zev:** `erdms`
- **Charset:** `utf8mb4` âœ…
- **Collation:** `utf8mb4_czech_ci` âœ… (ÄeskÃ© Å™azenÃ­, case-insensitive)
- **UÅ¾ivatel:** `erdms_user@10.3.174.11`
- **Heslo:** UloÅ¾eno v `/var/www/eeo2025/server/.env`
- **OprÃ¡vnÄ›nÃ­:** ALL PRIVILEGES na databÃ¡zi `erdms`
- **Stav:** PrÃ¡zdnÃ¡ databÃ¡ze (Å¾Ã¡dnÃ© tabulky zatÃ­m)

### ÄŒasovÃ© razÃ­tko
- **PoslednÃ­ update:** 5. prosince 2025 - RH ERDMS START
- **Projekt zahÃ¡jen:** Prosinec 2025

---

## ğŸ†˜ Quick troubleshooting

### API nereaguje
```bash
# Zjisti, jestli bÄ›Å¾Ã­
ps aux | grep "node src/index.js"

# Zkontroluj logy
tail -f /var/log/erdms-api.log

# Restart
kill $(cat /var/run/erdms-api.pid)
cd /var/www/erdms/api/v1.0 && nohup node src/index.js > /var/log/erdms-api.log 2>&1 &
echo $! > /var/run/erdms-api.pid
```

### Frontend vracÃ­ 404
```bash
# Zkontroluj, Å¾e build existuje
ls -la /var/www/erdms/index.html

# Zkontroluj Apache
systemctl status apache2
tail -f /var/log/apache2/erdms-443-ssl-error.log
```

### Login nefunguje
```bash
# Zkontroluj .env hodnoty
cat /var/www/eeo2025/client/.env
cat /var/www/eeo2025/server/.env

# Po zmÄ›nÄ› .env vÅ¾dy rebuild
cd /var/www/eeo2025/client && npm run build
cp -r dist/* /var/www/erdms/
```

---

**Tento soubor slouÅ¾Ã­ jako "pamÄ›Å¥" pro GitHub Copilot - obsahuje vÅ¡echny dÅ¯leÅ¾itÃ© informace o projektu.**
