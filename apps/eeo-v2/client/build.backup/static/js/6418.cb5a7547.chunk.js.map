{"version":3,"file":"static/js/6418.cb5a7547.chunk.js","mappings":"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","sources":["../node_modules/lucide-react/src/icons/lock-open.ts","../node_modules/lucide-react/src/icons/shopping-cart.ts","../node_modules/lucide-react/src/icons/trash.ts","../node_modules/lucide-react/src/icons/copy.ts","components/SupplierAddDialog.js","../node_modules/lucide-react/src/icons/menu.ts","../node_modules/lucide-react/src/icons/maximize-2.ts","../node_modules/lucide-react/src/icons/minimize-2.ts","../node_modules/lucide-react/src/icons/chevron-left.ts","../node_modules/lucide-react/src/icons/file-down.ts","../node_modules/lucide-react/src/icons/minus.ts","../node_modules/lucide-react/src/icons/chevron-right.ts","../node_modules/lucide-react/src/icons/upload.ts","components/TemplateDropdown.js","components/FloatingNavigator.js","utils/dataTransformHelpers.js","services/FormDataManager.js","hooks/useAutosave.js","services/notificationService.js","constants/workflow25.js","utils/workflowUtils.js","forms/OrderForm25/reducers/lifecycleReducer.js","forms/OrderForm25/reducers/dictionariesReducer.js","forms/OrderForm25/reducers/uiReducer.js","forms/OrderForm25/hooks/useFormController.js","forms/OrderForm25/hooks/useFormLifecycle.js","forms/OrderForm25/hooks/useDictionaries.js","forms/OrderForm25/hooks/useOrderDataLoader.js","forms/OrderForm25/hooks/useUIState.js","forms/OrderForm25/hooks/useWorkflowManager.js","forms/OrderForm25.js","../node_modules/lucide-react/src/icons/users.ts","../node_modules/lucide-react/src/icons/user.ts","../node_modules/lucide-react/src/icons/map-pin.ts","../node_modules/lucide-react/src/icons/eye.ts","../node_modules/lucide-react/src/icons/mail.ts","../node_modules/lucide-react/src/icons/search.ts","../node_modules/lucide-react/src/icons/refresh-cw.ts","utils/errorTranslation.js","../node_modules/lucide-react/src/icons/hash.ts","../node_modules/lucide-react/src/icons/lock.ts","../node_modules/lucide-react/src/icons/plus.ts","services/apiSmlouvy.js","../node_modules/lucide-react/src/icons/calculator.ts","../node_modules/lucide-react/src/icons/phone.ts","../node_modules/lucide-react/src/icons/chevron-down.ts","../node_modules/lucide-react/src/icons/coins.ts"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['rect', { width: '18', height: '11', x: '3', y: '11', rx: '2', ry: '2', key: '1w4ew1' }],\n  ['path', { d: 'M7 11V7a5 5 0 0 1 9.9-1', key: '1mm8w8' }],\n];\n\n/**\n * @component @name LockOpen\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cmVjdCB3aWR0aD0iMTgiIGhlaWdodD0iMTEiIHg9IjMiIHk9IjExIiByeD0iMiIgcnk9IjIiIC8+CiAgPHBhdGggZD0iTTcgMTFWN2E1IDUgMCAwIDEgOS45LTEiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/lock-open\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst LockOpen = createLucideIcon('lock-open', __iconNode);\n\nexport default LockOpen;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '8', cy: '21', r: '1', key: 'jimo8o' }],\n  ['circle', { cx: '19', cy: '21', r: '1', key: '13723u' }],\n  [\n    'path',\n    {\n      d: 'M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12',\n      key: '9zh506',\n    },\n  ],\n];\n\n/**\n * @component @name ShoppingCart\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSI4IiBjeT0iMjEiIHI9IjEiIC8+CiAgPGNpcmNsZSBjeD0iMTkiIGN5PSIyMSIgcj0iMSIgLz4KICA8cGF0aCBkPSJNMi4wNSAyLjA1aDJsMi42NiAxMi40MmEyIDIgMCAwIDAgMiAxLjU4aDkuNzhhMiAyIDAgMCAwIDEuOTUtMS41N2wxLjY1LTcuNDNINS4xMiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/shopping-cart\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ShoppingCart = createLucideIcon('shopping-cart', __iconNode);\n\nexport default ShoppingCart;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6', key: 'miytrc' }],\n  ['path', { d: 'M3 6h18', key: 'd0wm0j' }],\n  ['path', { d: 'M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2', key: 'e791ji' }],\n];\n\n/**\n * @component @name Trash\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTkgNnYxNGEyIDIgMCAwIDEtMiAySDdhMiAyIDAgMCAxLTItMlY2IiAvPgogIDxwYXRoIGQ9Ik0zIDZoMTgiIC8+CiAgPHBhdGggZD0iTTggNlY0YTIgMiAwIDAgMSAyLTJoNGEyIDIgMCAwIDEgMiAydjIiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/trash\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Trash = createLucideIcon('trash', __iconNode);\n\nexport default Trash;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['rect', { width: '14', height: '14', x: '8', y: '8', rx: '2', ry: '2', key: '17jyea' }],\n  ['path', { d: 'M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2', key: 'zix9uf' }],\n];\n\n/**\n * @component @name Copy\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cmVjdCB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHg9IjgiIHk9IjgiIHJ4PSIyIiByeT0iMiIgLz4KICA8cGF0aCBkPSJNNCAxNmMtMS4xIDAtMi0uOS0yLTJWNGMwLTEuMS45LTIgMi0yaDEwYzEuMSAwIDIgLjkgMiAyIiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/copy\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Copy = createLucideIcon('copy', __iconNode);\n\nexport default Copy;\n","import React, { useState, useEffect, useContext } from 'react';\nimport styled from '@emotion/styled';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTimes, faCheck, faGlobe, faUser, faBuilding, faCheckCircle } from '@fortawesome/free-solid-svg-icons';\nimport { Building, MapPin, Hash, Mail, Phone, User } from 'lucide-react';\nimport { AuthContext } from '../context/AuthContext';\nimport { fetchUskyList } from '../services/api2auth';\n\n// Styled Components\nconst DialogOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n`;\n\nconst DialogContainer = styled.div`\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 700px;\n  max-height: 90vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp 0.3s ease-out;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n`;\n\nconst DialogHeader = styled.div`\n  padding: 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n`;\n\nconst DialogTitle = styled.h2`\n  margin: 0;\n  font-size: 20px;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n\n  svg {\n    font-size: 24px;\n  }\n`;\n\nconst CloseButton = styled.button`\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n`;\n\nconst DialogContent = styled.div`\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n`;\n\nconst InfoBox = styled.div`\n  background: ${props => {\n    if (props.type === 'update') return '#fff4e6';\n    if (props.type === 'exists-own') return '#e6f7ff';\n    if (props.type === 'exists-global') return '#fff0f6';\n    return '#f0f9ff';\n  }};\n  border: 1px solid ${props => {\n    if (props.type === 'update') return '#ffd591';\n    if (props.type === 'exists-own') return '#91d5ff';\n    if (props.type === 'exists-global') return '#ffadd2';\n    return '#bae7ff';\n  }};\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 20px;\n  display: flex;\n  align-items: flex-start;\n  gap: 12px;\n\n  svg {\n    font-size: 20px;\n    margin-top: 2px;\n    color: ${props => {\n      if (props.type === 'update') return '#fa8c16';\n      if (props.type === 'exists-own') return '#1890ff';\n      if (props.type === 'exists-global') return '#eb2f96';\n      return '#1890ff';\n    }};\n  }\n`;\n\nconst InfoText = styled.div`\n  flex: 1;\n\n  strong {\n    display: block;\n    margin-bottom: 4px;\n    font-size: 14px;\n    color: #262626;\n  }\n\n  p {\n    margin: 0;\n    font-size: 13px;\n    color: #595959;\n    line-height: 1.5;\n  }\n`;\n\nconst FormSection = styled.div`\n  margin-bottom: 20px;\n`;\n\nconst SectionTitle = styled.h3`\n  font-size: 14px;\n  font-weight: 600;\n  color: #262626;\n  margin: 0 0 12px 0;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n`;\n\nconst FormRow = styled.div`\n  display: grid;\n  grid-template-columns: ${props => props.columns || '1fr'};\n  gap: 16px;\n  margin-bottom: 16px;\n`;\n\nconst FormGroup = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n`;\n\nconst Label = styled.label`\n  font-size: 13px;\n  font-weight: 500;\n  color: #595959;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n\n  ${props => props.required && `\n    &:after {\n      content: '*';\n      color: #ff4d4f;\n      margin-left: 2px;\n    }\n  `}\n`;\n\nconst InputWithIcon = styled.div`\n  position: relative;\n  display: flex;\n  align-items: center;\n\n  svg {\n    position: absolute;\n    left: 12px;\n    width: 16px;\n    height: 16px;\n    color: #8c8c8c;\n    pointer-events: none;\n  }\n`;\n\nconst Input = styled.input`\n  width: 100%;\n  padding: 10px 12px 10px ${props => props.hasIcon ? '38px' : '12px'};\n  border: 1px solid ${props => props.hasError ? '#ff4d4f' : '#d9d9d9'};\n  border-radius: 6px;\n  font-size: 14px;\n  transition: all 0.2s;\n  background: ${props => props.disabled ? '#f5f5f5' : 'white'};\n  color: ${props => props.disabled ? '#8c8c8c' : '#262626'};\n\n  &:focus {\n    outline: none;\n    border-color: ${props => props.hasError ? '#ff4d4f' : '#40a9ff'};\n    box-shadow: 0 0 0 2px ${props => props.hasError ? 'rgba(255,77,79,0.1)' : 'rgba(24,144,255,0.1)'};\n  }\n\n  &:disabled {\n    cursor: not-allowed;\n  }\n`;\n\nconst ScopeSelector = styled.div`\n  display: grid;\n  grid-template-columns: repeat(${props => props.optionsCount}, 1fr);\n  gap: 8px;\n  margin-top: 8px;\n`;\n\nconst ScopeOption = styled.button`\n  padding: 12px;\n  border: 2px solid ${props => props.selected ? '#667eea' : '#e5e7eb'};\n  border-radius: 8px;\n  background: ${props => props.selected ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : 'white'};\n  color: ${props => props.selected ? 'white' : '#595959'};\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  opacity: ${props => props.disabled ? 0.5 : 1};\n  transition: all 0.2s;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 6px;\n  font-size: 13px;\n  font-weight: 500;\n  position: relative;\n\n  &:hover:not(:disabled) {\n    border-color: #667eea;\n    background: ${props => props.selected ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : '#f9fafb'};\n  }\n\n  svg {\n    font-size: 18px;\n  }\n`;\n\nconst ExistingIndicator = styled.div`\n  position: absolute;\n  top: 6px;\n  right: 6px;\n  background: ${props => props.scope === 'global' ? '#10b981' : (props.scope === 'usek' ? '#3b82f6' : '#06b6d4')};\n  color: white;\n  width: 20px;\n  height: 20px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 11px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\n  svg {\n    font-size: 11px;\n  }\n`;\n\nconst UsekGrid = styled.div`\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));\n  gap: 8px;\n  margin-top: 12px;\n`;\n\nconst UsekItem = styled.label`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  padding: 8px 10px;\n  border: 2px solid ${props => props.selected ? '#667eea' : '#e5e7eb'};\n  border-radius: 6px;\n  background: ${props => props.selected ? 'rgba(102, 126, 234, 0.05)' : 'white'};\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  opacity: ${props => props.disabled ? 0.5 : 1};\n  transition: all 0.2s;\n  font-size: 13px;\n  font-weight: 600;\n  color: ${props => props.selected ? '#667eea' : '#374151'};\n\n  &:hover:not([disabled]) {\n    border-color: #667eea;\n    background: rgba(102, 126, 234, 0.05);\n  }\n\n  input[type=\"checkbox\"] {\n    width: 16px;\n    height: 16px;\n    cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  }\n`;\n\nconst UsekInfo = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n  flex: 1;\n`;\n\nconst UsekCode = styled.span`\n  font-weight: 600;\n  color: #667eea;\n`;\n\nconst UsekName = styled.span`\n  font-size: 11px;\n  color: #6b7280;\n`;\n\nconst ErrorText = styled.span`\n  color: #ff4d4f;\n  font-size: 12px;\n  margin-top: 4px;\n`;\n\nconst DialogFooter = styled.div`\n  padding: 16px 24px;\n  border-top: 1px solid #e5e7eb;\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  background: #fafafa;\n`;\n\nconst Button = styled.button`\n  padding: 10px 20px;\n  border: none;\n  border-radius: 6px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  ${props => props.variant === 'primary' && `\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n\n    &:hover:not(:disabled) {\n      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n      transform: translateY(-1px);\n    }\n\n    &:disabled {\n      opacity: 0.6;\n      cursor: not-allowed;\n    }\n  `}\n\n  ${props => props.variant === 'secondary' && `\n    background: white;\n    color: #595959;\n    border: 1px solid #d9d9d9;\n\n    &:hover:not(:disabled) {\n      border-color: #40a9ff;\n      color: #40a9ff;\n    }\n  `}\n`;\n\n/**\n * Dialog pro pidn dodavatele do lokln databze\n *\n * Props:\n * - isOpen: bool - zda je dialog oteven\n * - onClose: func - callback pro zaven dialogu\n * - onSave: func(supplierData, scope) - callback po spnm uloen\n * - supplierData: obj - data dodavatele z formule\n * - existsInPersonal: obj|null - existujc zznam v Personal scope\n * - existsInUsek: obj|null - existujc zznam v sek scope\n * - existsInGlobal: obj|null - existujc zznam v Global scope\n * - userPermissions: obj - uivatelsk prva { canAddPersonal, canAddUsek, canAddGlobal }\n */\nconst SupplierAddDialog = ({\n  isOpen,\n  onClose,\n  onSave,\n  supplierData,\n  existsInPersonal = null,\n  existsInUsek = null,\n  existsInGlobal = null,\n  userPermissions = { canAddPersonal: true, canAddUsek: false, canAddGlobal: false }\n}) => {\n  const { token, username, userDetail } = useContext(AuthContext);\n  const [editedData, setEditedData] = useState({});\n  const [selectedScope, setSelectedScope] = useState('personal');\n  const [selectedUseky, setSelectedUseky] = useState([]); // Vybran seky pro scope 'usek'\n  const [availableUseky, setAvailableUseky] = useState([]); // Seznam vech sek\n  const [usekyLoading, setUsekyLoading] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [errors, setErrors] = useState({});\n\n  // Inicializace dat pi oteven dialogu\n  useEffect(() => {\n    if (isOpen && supplierData) {\n      setEditedData({\n        nazev: supplierData.dodavatel_nazev || '',\n        adresa: supplierData.dodavatel_adresa || '',\n        ico: supplierData.dodavatel_ico || '',\n        dic: supplierData.dodavatel_dic || '',\n        zastoupeny: supplierData.dodavatel_zastoupeny || '',\n        kontakt_jmeno: supplierData.dodavatel_kontakt_jmeno || '',\n        kontakt_email: supplierData.dodavatel_kontakt_email || '',\n        kontakt_telefon: supplierData.dodavatel_kontakt_telefon || ''\n      });\n\n      // Vchoz scope podle toho, kde kontakt existuje\n      // Priority: Personal > sek > Global (co m uivatel monost upravit)\n      if (existsInPersonal) {\n        setSelectedScope('personal');\n      } else if (existsInUsek) {\n        setSelectedScope('usek');\n        // seky se natou a pedvypln v dalm useEffect\n      } else if (existsInGlobal && userPermissions.canAddGlobal) {\n        setSelectedScope('global');\n      } else {\n        setSelectedScope('personal');\n      }\n\n      setErrors({});\n    }\n  }, [isOpen, supplierData, existsInPersonal, existsInUsek, existsInGlobal, userPermissions.canAddGlobal]);\n\n  // Naten seznamu sek pi oteven dialogu\n  useEffect(() => {\n    const loadUseky = async () => {\n      if (!isOpen || !userPermissions.canAddUsek) return;\n\n      try {\n        setUsekyLoading(true);\n        const result = await fetchUskyList({ token, username });\n        setAvailableUseky(result || []);\n      } catch (error) {\n      } finally {\n        setUsekyLoading(false);\n      }\n    };\n\n    loadUseky();\n  }, [isOpen, userPermissions.canAddUsek, token, username]);\n\n  // Pedvyplnn sek pokud existuje dodavatel v sek scope\n  useEffect(() => {\n    if (!isOpen) return;\n\n    if (existsInUsek && existsInUsek.usek_zkr) {\n      try {\n        const usekArray = typeof existsInUsek.usek_zkr === 'string'\n          ? JSON.parse(existsInUsek.usek_zkr)\n          : existsInUsek.usek_zkr;\n        if (Array.isArray(usekArray)) {\n          setSelectedUseky(usekArray);\n        }\n      } catch (e) {\n      }\n    } else {\n      // Pokud nen existsInUsek, vyma vybran seky\n      setSelectedUseky([]);\n    }\n  }, [isOpen, existsInUsek]);\n\n  const handleInputChange = (field, value) => {\n    setEditedData(prev => ({\n      ...prev,\n      [field]: value\n    }));\n\n    // Clear error for this field\n    if (errors[field]) {\n      setErrors(prev => {\n        const newErrors = { ...prev };\n        delete newErrors[field];\n        return newErrors;\n      });\n    }\n  };\n\n  // Handler pro pepnut vbru seku\n  const handleUsekToggle = (usekZkr) => {\n    setSelectedUseky(prev => {\n      if (prev.includes(usekZkr)) {\n        return prev.filter(zkr => zkr !== usekZkr);\n      } else {\n        return [...prev, usekZkr];\n      }\n    });\n  };\n\n  const validateData = () => {\n    const newErrors = {};\n\n    if (!editedData.nazev?.trim()) {\n      newErrors.nazev = 'Nzev je povinn';\n    }\n\n    if (!editedData.ico?.trim()) {\n      newErrors.ico = 'IO je povinn';\n    } else if (!/^\\d{8}$/.test(editedData.ico.trim())) {\n      newErrors.ico = 'IO mus mt 8 slic';\n    }\n\n    if (editedData.kontakt_email && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(editedData.kontakt_email)) {\n      newErrors.kontakt_email = 'Neplatn email';\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSave = async () => {\n    if (!validateData()) {\n      return;\n    }\n\n    // Pokud je vybran scope 'usek', ale dn seky nejsou zakrtnut,\n    // pouije se scope 'personal' (osobn)\n    let finalScope = selectedScope;\n    let finalUseky = null;\n\n    if (selectedScope === 'usek') {\n      if (selectedUseky.length === 0) {\n        // dn seky  pepnout na osobn\n        finalScope = 'personal';\n        finalUseky = null;\n      } else {\n        finalUseky = selectedUseky;\n      }\n    } else if (selectedScope === 'global') {\n      // Global  user_id = 0, usek_zkr = przdn\n      finalUseky = null;\n    }\n\n    setIsSaving(true);\n\n    try {\n      await onSave(editedData, finalScope, finalUseky);\n      onClose();\n    } catch (error) {\n      setErrors({ general: error.message || 'Chyba pi ukldn dodavatele' });\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  // Urit typ akce a info box\n  const getActionType = () => {\n    // Zkontroluj existence v jednotlivch scope\n    if (existsInPersonal || existsInUsek || existsInGlobal) {\n      return 'exists';\n    }\n    return 'add';\n  };\n\n  const actionType = getActionType();\n\n  // Urit text tlatka podle vybranho scope a existence\n  const getButtonText = () => {\n    if (isSaving) return 'Ukldm...';\n\n    // Zkontroluj, jestli v aktuln vybranm scope dodavatel existuje\n    const existsInSelectedScope =\n      (selectedScope === 'personal' && existsInPersonal) ||\n      (selectedScope === 'usek' && existsInUsek) ||\n      (selectedScope === 'global' && existsInGlobal);\n\n    if (existsInSelectedScope) {\n      return 'Aktualizovat'; // Aktualizujeme existujc zznam v tomto scope\n    }\n\n    return 'Pidat dodavatele'; // Pidvme do novho scope nebo nov dodavatel\n  };\n\n  // Zjisti jestli aktualizujeme existujc zznam\n  const isUpdatingExisting =\n    (selectedScope === 'personal' && existsInPersonal) ||\n    (selectedScope === 'usek' && existsInUsek) ||\n    (selectedScope === 'global' && existsInGlobal);\n\n  return (\n    <DialogOverlay>\n      <DialogContainer onClick={(e) => e.stopPropagation()}>\n        <DialogHeader>\n          <DialogTitle>\n            <FontAwesomeIcon icon={faBuilding} />\n            {isUpdatingExisting ? 'Aktualizovat dodavatele' : 'Pidat dodavatele do adrese'}\n          </DialogTitle>\n          <CloseButton onClick={onClose}>\n            <FontAwesomeIcon icon={faTimes} />\n          </CloseButton>\n        </DialogHeader>\n\n        <DialogContent>\n          {/* Info box podle situace */}\n          {actionType === 'add' && (\n            <InfoBox type=\"add\">\n              <FontAwesomeIcon icon={faBuilding} />\n              <InfoText>\n                <strong>Nov dodavatel</strong>\n                <p>Dodavatel s tmto IO nebyl nalezen v databzi. Mete ho pidat.</p>\n              </InfoText>\n            </InfoBox>\n          )}\n\n          {actionType === 'exists' && (\n            <InfoBox type=\"exists-own\">\n              <FontAwesomeIcon icon={faCheckCircle} />\n              <InfoText>\n                <strong>Dodavatel ji existuje v adresi</strong>\n                <p>\n                  Fajfky u scope oznauj, kde je dodavatel ji uloen.\n                  {existsInPersonal && ' Mte ho ve svm osobnm adresi.'}\n                  {existsInUsek && ' Existuje v sekovm adresi.'}\n                  {existsInGlobal && ' Existuje v globlnm adresi.'}\n                </p>\n              </InfoText>\n            </InfoBox>\n          )}\n\n          {/* Rozsah uloen */}\n          <FormSection>\n            <SectionTitle>Rozsah uloen</SectionTitle>\n            <ScopeSelector optionsCount={3}>\n              {/* Osobn - vdy viditeln */}\n              <ScopeOption\n                selected={selectedScope === 'personal'}\n                onClick={() => userPermissions.canAddPersonal && setSelectedScope('personal')}\n                disabled={!userPermissions.canAddPersonal}\n              >\n                {existsInPersonal && (\n                  <ExistingIndicator scope=\"personal\" title=\"Kontakt ji existuje v osobnm adresi\">\n                    <FontAwesomeIcon icon={faCheckCircle} />\n                  </ExistingIndicator>\n                )}\n                <FontAwesomeIcon icon={faUser} />\n                <span>Osobn</span>\n              </ScopeOption>\n\n              {/* sek - vdy viditeln */}\n              <ScopeOption\n                selected={selectedScope === 'usek'}\n                onClick={() => userPermissions.canAddUsek && setSelectedScope('usek')}\n                disabled={!userPermissions.canAddUsek}\n              >\n                {existsInUsek && (\n                  <ExistingIndicator scope=\"usek\" title=\"Kontakt ji existuje v adresi seku\">\n                    <FontAwesomeIcon icon={faCheckCircle} />\n                  </ExistingIndicator>\n                )}\n                <FontAwesomeIcon icon={faBuilding} />\n                <span>sek</span>\n              </ScopeOption>\n\n              {/* Globln - vdy viditeln */}\n              <ScopeOption\n                selected={selectedScope === 'global'}\n                onClick={() => userPermissions.canAddGlobal && setSelectedScope('global')}\n                disabled={!userPermissions.canAddGlobal}\n              >\n                {existsInGlobal && (\n                  <ExistingIndicator scope=\"global\" title=\"Kontakt ji existuje v globlnm adresi\">\n                    <FontAwesomeIcon icon={faCheckCircle} />\n                  </ExistingIndicator>\n                )}\n                <FontAwesomeIcon icon={faGlobe} />\n                <span>Globln</span>\n              </ScopeOption>\n            </ScopeSelector>\n          </FormSection>\n\n          {/* Vbr sek - zobraz se pouze kdy je vybran scope 'usek' */}\n          {selectedScope === 'usek' && (\n            <FormSection>\n              <SectionTitle>Vbr sek</SectionTitle>\n              {usekyLoading ? (\n                <div style={{ padding: '1rem', textAlign: 'center', color: '#6b7280' }}>\n                  Natm seky...\n                </div>\n              ) : availableUseky.length === 0 ? (\n                <div style={{ padding: '1rem', background: '#fef2f2', border: '1px solid #fecaca', borderRadius: '8px', color: '#dc2626' }}>\n                   dn seky nebyly nateny\n                </div>\n              ) : (\n                <UsekGrid>\n                  {(userPermissions.canAddGlobal ? availableUseky :\n                    availableUseky.filter(usek => {\n                      // userDetail.usek_zkr me bt pole ['IT', 'EN'] nebo string 'IT'\n                      const myUseky = Array.isArray(userDetail?.usek_zkr)\n                        ? userDetail.usek_zkr\n                        : [userDetail?.usek_zkr];\n                      return myUseky.includes(usek.usek_zkr);\n                    })\n                  ).map((usek) => (\n                    <UsekItem\n                      key={usek.usek_zkr}\n                      selected={selectedUseky.includes(usek.usek_zkr)}\n                      disabled={!userPermissions.canAddGlobal && (() => {\n                        const myUseky = Array.isArray(userDetail?.usek_zkr)\n                          ? userDetail.usek_zkr\n                          : [userDetail?.usek_zkr];\n                        return !myUseky.includes(usek.usek_zkr);\n                      })()}\n                      onClick={() => {\n                        const myUseky = Array.isArray(userDetail?.usek_zkr)\n                          ? userDetail.usek_zkr\n                          : [userDetail?.usek_zkr];\n                        if (userPermissions.canAddGlobal || myUseky.includes(usek.usek_zkr)) {\n                          handleUsekToggle(usek.usek_zkr);\n                        }\n                      }}\n                    >\n                      <input\n                        type=\"checkbox\"\n                        checked={selectedUseky.includes(usek.usek_zkr)}\n                        onChange={() => handleUsekToggle(usek.usek_zkr)}\n                        disabled={!userPermissions.canAddGlobal && (() => {\n                          const myUseky = Array.isArray(userDetail?.usek_zkr)\n                            ? userDetail.usek_zkr\n                            : [userDetail?.usek_zkr];\n                          return !myUseky.includes(usek.usek_zkr);\n                        })()}\n                      />\n                      <UsekCode>{usek.usek_zkr}</UsekCode>\n                    </UsekItem>\n                  ))}\n                </UsekGrid>\n              )}\n              {selectedUseky.length === 0 && !usekyLoading && (\n                <div style={{ marginTop: '8px', padding: '8px', background: '#e0f2fe', border: '1px solid #0ea5e9', borderRadius: '6px', fontSize: '12px', color: '#0c4a6e' }}>\n                   Pokud nevyberete dn sek, kontakt se ulo jako osobn\n                </div>\n              )}\n            </FormSection>\n          )}\n\n          {/* Zkladn daje */}\n          <FormSection>\n            <SectionTitle>Zkladn daje</SectionTitle>\n            <FormRow columns=\"1fr\">\n              <FormGroup>\n                <Label required>Nzev spolenosti</Label>\n                <InputWithIcon>\n                  <Building />\n                  <Input\n                    type=\"text\"\n                    value={editedData.nazev || ''}\n                    onChange={(e) => handleInputChange('nazev', e.target.value)}\n                    hasError={!!errors.nazev}\n                    hasIcon\n                    placeholder=\"Nzev dodavatele\"\n                  />\n                </InputWithIcon>\n                {errors.nazev && <ErrorText>{errors.nazev}</ErrorText>}\n              </FormGroup>\n            </FormRow>\n\n            <FormRow columns=\"2fr 1fr 1fr\">\n              <FormGroup>\n                <Label required>Adresa</Label>\n                <InputWithIcon>\n                  <MapPin />\n                  <Input\n                    type=\"text\"\n                    value={editedData.adresa || ''}\n                    onChange={(e) => handleInputChange('adresa', e.target.value)}\n                    hasError={!!errors.adresa}\n                    hasIcon\n                    placeholder=\"Adresa sdla\"\n                  />\n                </InputWithIcon>\n                {errors.adresa && <ErrorText>{errors.adresa}</ErrorText>}\n              </FormGroup>\n\n              <FormGroup>\n                <Label required>IO</Label>\n                <InputWithIcon>\n                  <Hash />\n                  <Input\n                    type=\"text\"\n                    value={editedData.ico || ''}\n                    onChange={(e) => handleInputChange('ico', e.target.value)}\n                    hasError={!!errors.ico}\n                    hasIcon\n                    placeholder=\"12345678\"\n                    maxLength={8}\n                  />\n                </InputWithIcon>\n                {errors.ico && <ErrorText>{errors.ico}</ErrorText>}\n              </FormGroup>\n\n              <FormGroup>\n                <Label>DI</Label>\n                <InputWithIcon>\n                  <Hash />\n                  <Input\n                    type=\"text\"\n                    value={editedData.dic || ''}\n                    onChange={(e) => handleInputChange('dic', e.target.value)}\n                    hasIcon\n                    placeholder=\"CZ12345678\"\n                  />\n                </InputWithIcon>\n              </FormGroup>\n            </FormRow>\n\n            <FormRow columns=\"1fr\">\n              <FormGroup>\n                <Label>Zastoupen(a)</Label>\n                <InputWithIcon>\n                  <User />\n                  <Input\n                    type=\"text\"\n                    value={editedData.zastoupeny || ''}\n                    onChange={(e) => handleInputChange('zastoupeny', e.target.value)}\n                    hasIcon\n                    placeholder=\"Jmno jednajcho\"\n                  />\n                </InputWithIcon>\n              </FormGroup>\n            </FormRow>\n          </FormSection>\n\n          {/* Kontaktn daje */}\n          <FormSection>\n            <SectionTitle>Kontaktn osoba</SectionTitle>\n            <FormRow columns=\"1fr\">\n              <FormGroup>\n                <Label>Jmno kontaktn osoby</Label>\n                <InputWithIcon>\n                  <User />\n                  <Input\n                    type=\"text\"\n                    value={editedData.kontakt_jmeno || ''}\n                    onChange={(e) => handleInputChange('kontakt_jmeno', e.target.value)}\n                    hasIcon\n                    placeholder=\"Jmno a pjmen\"\n                  />\n                </InputWithIcon>\n              </FormGroup>\n            </FormRow>\n\n            <FormRow columns=\"1fr 1fr\">\n              <FormGroup>\n                <Label>Email</Label>\n                <InputWithIcon>\n                  <Mail />\n                  <Input\n                    type=\"email\"\n                    value={editedData.kontakt_email || ''}\n                    onChange={(e) => handleInputChange('kontakt_email', e.target.value)}\n                    hasError={!!errors.kontakt_email}\n                    hasIcon\n                    placeholder=\"email@example.com\"\n                  />\n                </InputWithIcon>\n                {errors.kontakt_email && <ErrorText>{errors.kontakt_email}</ErrorText>}\n              </FormGroup>\n\n              <FormGroup>\n                <Label>Telefon</Label>\n                <InputWithIcon>\n                  <Phone />\n                  <Input\n                    type=\"tel\"\n                    value={editedData.kontakt_telefon || ''}\n                    onChange={(e) => handleInputChange('kontakt_telefon', e.target.value)}\n                    hasIcon\n                    placeholder=\"+420 123 456 789\"\n                  />\n                </InputWithIcon>\n              </FormGroup>\n            </FormRow>\n          </FormSection>\n\n          {errors.general && (\n            <ErrorText style={{ display: 'block', marginTop: '16px', fontSize: '14px' }}>\n              {errors.general}\n            </ErrorText>\n          )}\n        </DialogContent>\n\n        <DialogFooter>\n          <Button variant=\"secondary\" onClick={onClose} disabled={isSaving}>\n            <FontAwesomeIcon icon={faTimes} />\n            Zruit\n          </Button>\n          <Button variant=\"primary\" onClick={handleSave} disabled={isSaving}>\n            <FontAwesomeIcon icon={faCheck} />\n            {getButtonText()}\n          </Button>\n        </DialogFooter>\n      </DialogContainer>\n    </DialogOverlay>\n  );\n};\n\nexport default SupplierAddDialog;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M4 5h16', key: '1tepv9' }],\n  ['path', { d: 'M4 12h16', key: '1lakjw' }],\n  ['path', { d: 'M4 19h16', key: '1djgab' }],\n];\n\n/**\n * @component @name Menu\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNNCA1aDE2IiAvPgogIDxwYXRoIGQ9Ik00IDEyaDE2IiAvPgogIDxwYXRoIGQ9Ik00IDE5aDE2IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/menu\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Menu = createLucideIcon('menu', __iconNode);\n\nexport default Menu;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M15 3h6v6', key: '1q9fwt' }],\n  ['path', { d: 'm21 3-7 7', key: '1l2asr' }],\n  ['path', { d: 'm3 21 7-7', key: 'tjx5ai' }],\n  ['path', { d: 'M9 21H3v-6', key: 'wtvkvv' }],\n];\n\n/**\n * @component @name Maximize2\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTUgM2g2djYiIC8+CiAgPHBhdGggZD0ibTIxIDMtNyA3IiAvPgogIDxwYXRoIGQ9Im0zIDIxIDctNyIgLz4KICA8cGF0aCBkPSJNOSAyMUgzdi02IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/maximize-2\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Maximize2 = createLucideIcon('maximize-2', __iconNode);\n\nexport default Maximize2;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'm14 10 7-7', key: 'oa77jy' }],\n  ['path', { d: 'M20 10h-6V4', key: 'mjg0md' }],\n  ['path', { d: 'm3 21 7-7', key: 'tjx5ai' }],\n  ['path', { d: 'M4 14h6v6', key: 'rmj7iw' }],\n];\n\n/**\n * @component @name Minimize2\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTQgMTAgNy03IiAvPgogIDxwYXRoIGQ9Ik0yMCAxMGgtNlY0IiAvPgogIDxwYXRoIGQ9Im0zIDIxIDctNyIgLz4KICA8cGF0aCBkPSJNNCAxNGg2djYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/minimize-2\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Minimize2 = createLucideIcon('minimize-2', __iconNode);\n\nexport default Minimize2;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'm15 18-6-6 6-6', key: '1wnfg3' }]];\n\n/**\n * @component @name ChevronLeft\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTUgMTgtNi02IDYtNiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/chevron-left\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ChevronLeft = createLucideIcon('chevron-left', __iconNode);\n\nexport default ChevronLeft;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z', key: '1rqfz7' }],\n  ['path', { d: 'M14 2v4a2 2 0 0 0 2 2h4', key: 'tnqrlb' }],\n  ['path', { d: 'M12 18v-6', key: '17g6i2' }],\n  ['path', { d: 'm9 15 3 3 3-3', key: '1npd3o' }],\n];\n\n/**\n * @component @name FileDown\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTUgMkg2YTIgMiAwIDAgMC0yIDJ2MTZhMiAyIDAgMCAwIDIgMmgxMmEyIDIgMCAwIDAgMi0yVjdaIiAvPgogIDxwYXRoIGQ9Ik0xNCAydjRhMiAyIDAgMCAwIDIgMmg0IiAvPgogIDxwYXRoIGQ9Ik0xMiAxOHYtNiIgLz4KICA8cGF0aCBkPSJtOSAxNSAzIDMgMy0zIiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/file-down\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst FileDown = createLucideIcon('file-down', __iconNode);\n\nexport default FileDown;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'M5 12h14', key: '1ays0h' }]];\n\n/**\n * @component @name Minus\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNNSAxMmgxNCIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/minus\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Minus = createLucideIcon('minus', __iconNode);\n\nexport default Minus;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'm9 18 6-6-6-6', key: 'mthhwq' }]];\n\n/**\n * @component @name ChevronRight\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtOSAxOCA2LTYtNi02IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/chevron-right\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ChevronRight = createLucideIcon('chevron-right', __iconNode);\n\nexport default ChevronRight;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M12 3v12', key: '1x0j5s' }],\n  ['path', { d: 'm17 8-5-5-5 5', key: '7q97r8' }],\n  ['path', { d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4', key: 'ih7n3h' }],\n];\n\n/**\n * @component @name Upload\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTIgM3YxMiIgLz4KICA8cGF0aCBkPSJtMTcgOC01LTUtNSA1IiAvPgogIDxwYXRoIGQ9Ik0yMSAxNXY0YTIgMiAwIDAgMS0yIDJINWEyIDIgMCAwIDEtMi0ydi00IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/upload\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Upload = createLucideIcon('upload', __iconNode);\n\nexport default Upload;\n","import React, { useState, useRef, useEffect } from 'react';\nimport styled from '@emotion/styled';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faUser, faDatabase } from '@fortawesome/free-solid-svg-icons';\nimport { Search, X, RefreshCw, Eye, Plus, Trash } from 'lucide-react';\n\n// Styled Components\nconst DropdownContainer = styled.div`\n  position: absolute;\n  top: calc(100% + 3px);\n  left: ${props => props.$left || '0'};\n  right: ${props => props.$right || 'auto'};\n  z-index: 999999;\n  width: 450px;\n  background-color: white;\n  border: 2px solid #10b981;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  max-height: 500px;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst SectionHeader = styled.div`\n  padding: 0.5rem 0.75rem;\n  font-weight: 700;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n  border-bottom: 1px solid #e5e7eb;\n`;\n\nconst HeaderTitle = styled.span`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n`;\n\nconst HeaderActions = styled.span`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n`;\n\nconst IconButton = styled.button`\n  background: none;\n  border: none;\n  padding: 0;\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  color: ${props => props.disabled ? '#9ca3af' : (props.$color || '#374151')};\n  \n  &:hover:not(:disabled) {\n    opacity: 0.7;\n  }\n`;\n\nconst SearchBox = styled.div`\n  position: relative;\n  padding: 0 0.75rem 0.5rem;\n`;\n\nconst SearchIcon = styled.div`\n  position: absolute;\n  left: 1.5rem;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #9ca3af;\n  pointer-events: none;\n`;\n\nconst SearchInput = styled.input`\n  width: 100%;\n  padding: 0.5rem 2.5rem 0.5rem 2.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  outline: none;\n  \n  &:focus {\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n`;\n\nconst SearchClearButton = styled.button`\n  position: absolute;\n  right: 1.5rem;\n  top: 50%;\n  transform: translateY(-50%);\n  background: none;\n  border: none;\n  padding: 0;\n  cursor: pointer;\n  color: #6b7280;\n  \n  &:hover {\n    color: #374151;\n  }\n`;\n\nconst TemplateList = styled.div`\n  max-height: 14rem;\n  overflow-y: auto;\n  \n  &::-webkit-scrollbar {\n    width: 6px;\n  }\n  \n  &::-webkit-scrollbar-track {\n    background: #f3f4f6;\n  }\n  \n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 3px;\n    \n    &:hover {\n      background: #9ca3af;\n    }\n  }\n`;\n\nconst TemplateItem = styled.div`\n  padding: 0.5rem 0.75rem;\n  display: flex;\n  justify-content: space-between;\n  gap: 0.5rem;\n  align-items: flex-start;\n  transition: background-color 0.15s ease, border-left 0.15s ease;\n  cursor: pointer;\n  border-left: 3px solid transparent;\n  \n  &:hover {\n    background-color: ${props => props.$type === 'user' ? '#f0fdf4' : '#f8fafc'};\n    border-left-color: ${props => props.$type === 'user' ? '#22c55e' : '#3b82f6'};\n  }\n  \n  &:not(:last-child) {\n    border-bottom: 0.5px solid #f3f4f6;\n  }\n`;\n\nconst TemplateInfo = styled.div`\n  flex: 1;\n  min-width: 0;\n`;\n\nconst TemplateName = styled.div`\n  font-weight: 600;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n`;\n\nconst TemplateBadge = styled.div`\n  margin-top: 3px;\n  color: #1e40af;\n  font-size: 0.7rem;\n  background: #dbeafe;\n  padding: 0.1rem 0.4rem;\n  border-radius: 0.25rem;\n  display: inline-block;\n`;\n\nconst TemplateActions = styled.div`\n  display: flex;\n  gap: 0.25rem;\n  align-items: center;\n`;\n\nconst ActionButton = styled.button`\n  background: none;\n  border: none;\n  color: ${props => props.$color || '#6b7280'};\n  padding: 0.125rem;\n  cursor: pointer;\n  \n  &:hover {\n    opacity: 0.7;\n  }\n`;\n\nconst LoadButton = styled.button`\n  font-size: 0.75rem;\n  padding: 0.25rem 0.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 0.25rem;\n  background: ${props => props.disabled ? '#f3f4f6' : '#eff6ff'};\n  color: ${props => props.disabled ? '#9ca3af' : '#1e3a8a'};\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  pointer-events: ${props => props.disabled ? 'none' : 'auto'};\n  opacity: ${props => props.disabled ? 0.6 : 1};\n  \n  &:hover:not(:disabled) {\n    background: #dbeafe;\n  }\n`;\n\nconst EmptyMessage = styled.div`\n  padding: 0.5rem 0.75rem;\n  color: ${props => props.$muted ? '#9ca3af' : '#6b7280'};\n  ${props => props.$italic && 'font-style: italic;'}\n`;\n\nconst Divider = styled.hr`\n  margin: 0.5rem 0;\n  border-color: #d1d5db;\n  border-width: 2px;\n  border-style: double;\n`;\n\n/**\n * TemplateDropdown - Komponent pro dropdown se ablonami\n * Zobrazuje peddefinovan a uivatelsk ablony s monost naten do formule\n */\nconst TemplateDropdown = ({\n  show,\n  serverTemplates = [],\n  savedTemplates = [],\n  templatesLoading = false,\n  searchQuery = '',\n  showSearch = false,\n  currentPhase = 1,\n  isArchived = false,\n  token = null,\n  hasPermission,\n  onSearch,\n  onToggleSearch,\n  onRefresh,\n  onFillPo,\n  onFillDetails,\n  canFillTemplate = true,\n  onCopyToUser,\n  onCopyToGlobal,\n  onShowPreview,\n  onDelete,\n  onEditName,\n  editingTemplateId = null,\n  editingTemplateName = '',\n  matchesQuery\n}) => {\n  const searchInputRef = useRef(null);\n  const dropdownRef = useRef(null);\n  const [position, setPosition] = useState({ left: '0', right: 'auto' });\n\n  // Pepotat pozici dropdownu, aby se veel do okna\n  useEffect(() => {\n    if (show && dropdownRef.current) {\n      const rect = dropdownRef.current.getBoundingClientRect();\n      const viewportWidth = window.innerWidth;\n      const dropdownWidth = 450; // ka dropdownu\n\n      // Pokud dropdown pesahuje prav okraj okna\n      if (rect.right > viewportWidth) {\n        // Pesunout doleva - zarovnat k pravmu okraji\n        setPosition({ left: 'auto', right: '0' });\n      } \n      // Pokud dropdown pesahuje lev okraj okna (me nastat pi right: 0)\n      else if (rect.left < 0) {\n        // Vrtit zpt k levmu okraji\n        setPosition({ left: '0', right: 'auto' });\n      }\n      // Pokud je dostatek msta, standardn pozice\n      else if (rect.left >= 0 && rect.right <= viewportWidth) {\n        setPosition({ left: '0', right: 'auto' });\n      }\n    }\n  }, [show]);\n\n  useEffect(() => {\n    if (showSearch && searchInputRef.current) {\n      setTimeout(() => searchInputRef.current?.focus(), 50);\n    }\n  }, [showSearch]);\n\n  if (!show) return null;\n\n  const filteredServerTemplates = serverTemplates\n    .filter(entry => entry && (entry.user_id === 0 || String(entry.user_id) === '0'))\n    .filter(entry => matchesQuery(entry, searchQuery));\n\n  const filteredSavedTemplates = savedTemplates\n    .filter(entry => matchesQuery(entry, searchQuery));\n\n  return (\n    <DropdownContainer ref={dropdownRef} $left={position.left} $right={position.right}>\n      {/* Peddefinovan ablony */}\n      <SectionHeader>\n        <HeaderTitle>\n          <FontAwesomeIcon icon={faDatabase} style={{ color: '#3b82f6', fontSize: '14px' }} />\n          <span>Peddefinovan ablony</span>\n        </HeaderTitle>\n        <HeaderActions>\n          <IconButton\n            onClick={(e) => { e.stopPropagation(); onRefresh(); }}\n            title=\"Aktualizovat ablony z DB\"\n            disabled={!token || templatesLoading}\n            $color=\"#10b981\"\n          >\n            <RefreshCw size={16} />\n          </IconButton>\n          <IconButton\n            onClick={onToggleSearch}\n            title={showSearch ? 'Skrt hledn' : 'Hledat'}\n          >\n            <Search size={16} />\n          </IconButton>\n        </HeaderActions>\n      </SectionHeader>\n\n      {/* Vyhledvn */}\n      {showSearch && (\n        <SearchBox>\n          <SearchIcon>\n            <Search size={16} />\n          </SearchIcon>\n          <SearchInput\n            ref={searchInputRef}\n            type=\"text\"\n            value={searchQuery}\n            onChange={(e) => onSearch(e.target.value)}\n            placeholder=\"Hledat v ablonch...\"\n          />\n          {searchQuery && (\n            <SearchClearButton\n              onClick={() => onSearch('')}\n              title=\"Vymazat vyhledvn\"\n            >\n              <X size={14} />\n            </SearchClearButton>\n          )}\n        </SearchBox>\n      )}\n\n      {/* Seznam peddefinovanch ablon */}\n      <TemplateList>\n        {filteredServerTemplates.map((entry, idx) => {\n          const t = entry.data || {};\n          const typ = (entry.type || '').toString().toUpperCase();\n          const allowedPo = typ.includes('PO') || typ === 'OBEJD' || typ === 'MIXED';\n          const allowedDet = typ.includes('DET') || typ === 'OBEJD' || typ === 'MIXED';\n          const displayName = entry.name || entry.dbName || (t.poApproval?.predmet || `ablona ${entry.id || '?'}`);\n          const badge = (typ === 'OBEJD' || (allowedPo && allowedDet)) ? 'PO+Detaily' : (allowedDet ? 'Detaily' : 'PO');\n\n          return (\n            <TemplateItem key={`predef-${entry.id}-${entry.ts}-${idx}`} $type=\"server\">\n              <TemplateInfo>\n                <TemplateName>\n                  {displayName}\n                  {hasPermission?.('TEMPLATE_MANAGE') && (\n                    <ActionButton\n                      onClick={(e) => { e.stopPropagation(); onEditName(entry); }}\n                      title=\"Pejmenovat ablonu\"\n                    >\n                      <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                        <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"></path>\n                        <path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"></path>\n                      </svg>\n                    </ActionButton>\n                  )}\n                </TemplateName>\n                <TemplateBadge>{badge}</TemplateBadge>\n              </TemplateInfo>\n              \n              <TemplateActions>\n                <ActionButton onClick={() => onCopyToUser(entry)} title=\"Koprovat do mch ablon\" $color=\"#065f46\">\n                  <Plus size={16} />\n                </ActionButton>\n                <ActionButton onClick={() => onShowPreview(entry, entry.data)} title=\"Detailn nhled ablony\">\n                  <Eye size={16} />\n                </ActionButton>\n                {hasPermission?.('TEMPLATE_MANAGE') && (\n                  <ActionButton onClick={() => onDelete(entry)} title=\"Smazat\" $color=\"#dc2626\">\n                    <Trash size={16} />\n                  </ActionButton>\n                )}\n              </TemplateActions>\n              \n              <div style={{ display: 'flex', gap: '0.25rem' }}>\n                <LoadButton\n                  onClick={() => onFillPo(entry)}\n                  disabled={!canFillTemplate || (!isArchived && currentPhase >= 2) || !allowedPo}\n                  title={!canFillTemplate ? 'Vyplovn nelze - objednvka je dokonena nebo m neuloen zmny' : ((!isArchived && currentPhase >= 2) ? 'Nelze vloit PO po schvlen' : (!allowedPo ? 'Tato ablona neobsahuje PO' : 'Nast PO'))}\n                >\n                  PO\n                </LoadButton>\n                <LoadButton\n                  onClick={() => onFillDetails(entry)}\n                  disabled={!canFillTemplate || (!isArchived && currentPhase < 3) || !allowedDet}\n                  title={!canFillTemplate ? 'Vyplovn nelze - objednvka je dokonena nebo m neuloen zmny' : ((!isArchived && currentPhase < 3) ? 'Detaily se nataj a ve fzi 3 (po schvlen)' : (!allowedDet ? 'Tato ablona neobsahuje Detaily' : 'Nast detaily'))}\n                >\n                  Detaily\n                </LoadButton>\n              </div>\n            </TemplateItem>\n          );\n        })}\n        \n        {searchQuery.trim() && filteredServerTemplates.length === 0 && (\n          <EmptyMessage $muted>Nenalezeno</EmptyMessage>\n        )}\n      </TemplateList>\n\n      <Divider />\n\n      {/* Uivatelsk ablony */}\n      <SectionHeader>\n        <HeaderTitle>\n          <FontAwesomeIcon icon={faUser} style={{ color: '#22c55e', fontSize: '14px' }} />\n          <span>Moje ablony</span>\n        </HeaderTitle>\n      </SectionHeader>\n\n      {savedTemplates.length === 0 && (\n        <EmptyMessage>dn ablony</EmptyMessage>\n      )}\n\n      <TemplateList>\n        {filteredSavedTemplates.map((entry, idx) => {\n          const typ = (entry.type || '').toString().toUpperCase();\n          const hasPo = typ === 'PO' || typ === 'OBEJD' || typ === 'MIXED' || !!entry?.data?.poApproval;\n          const hasDet = typ === 'DETAIL' || typ === 'OBEJD' || typ === 'MIXED' || !!entry?.data?.orderDetails;\n          const badge = (typ === 'OBEJD' || (hasPo && hasDet)) ? 'PO+Detaily' : (hasDet ? 'Detaily' : 'PO');\n\n          return (\n            <TemplateItem key={`user-${entry.id}-${entry.ts}-${idx}`} $type=\"user\">\n              <TemplateInfo>\n                <TemplateName>\n                  {entry.name}\n                  <ActionButton\n                    onClick={(e) => { e.stopPropagation(); onEditName(entry); }}\n                    title=\"Pejmenovat ablonu\"\n                  >\n                    <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                      <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"></path>\n                      <path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"></path>\n                    </svg>\n                  </ActionButton>\n                </TemplateName>\n                <TemplateBadge>{badge}</TemplateBadge>\n              </TemplateInfo>\n              \n              <TemplateActions>\n                <ActionButton onClick={() => onShowPreview(entry, entry.data)} title=\"Detailn nhled ablony\">\n                  <Eye size={16} />\n                </ActionButton>\n                {hasPermission?.('TEMPLATE_MANAGE') && (\n                  <ActionButton onClick={() => onCopyToGlobal(entry)} title=\"Koprovat do globlnch ablon\" $color=\"#059669\">\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n                      <path d=\"m9 12 2 2 4-4\"></path>\n                    </svg>\n                  </ActionButton>\n                )}\n                <ActionButton onClick={() => onDelete(entry)} title=\"Smazat\" $color=\"#dc2626\">\n                  <Trash size={16} />\n                </ActionButton>\n              </TemplateActions>\n              \n              <div style={{ display: 'flex', gap: '0.25rem' }}>\n                <LoadButton\n                  onClick={() => onFillPo(entry)}\n                  disabled={!canFillTemplate || (!isArchived && currentPhase >= 2) || !hasPo}\n                  title={!canFillTemplate ? 'Vyplovn nelze - objednvka je dokonena nebo m neuloen zmny' : ((!isArchived && currentPhase >= 2) ? 'Nelze vloit PO po schvlen' : (!hasPo ? 'Tato ablona neobsahuje PO' : 'Nast PO'))}\n                >\n                  PO\n                </LoadButton>\n                <LoadButton\n                  onClick={() => onFillDetails(entry)}\n                  disabled={!canFillTemplate || (!isArchived && currentPhase < 3) || !hasDet}\n                  title={!canFillTemplate ? 'Vyplovn nelze - objednvka je dokonena nebo m neuloen zmny' : ((!isArchived && currentPhase < 3) ? 'Detaily se nataj a ve fzi 3 (po schvlen)' : (!hasDet ? 'Tato ablona neobsahuje Detaily' : 'Nast detaily'))}\n                >\n                  Detaily\n                </LoadButton>\n              </div>\n            </TemplateItem>\n          );\n        })}\n        \n        {searchQuery.trim() && filteredSavedTemplates.length === 0 && (\n          <EmptyMessage $muted>Nenalezeno</EmptyMessage>\n        )}\n      </TemplateList>\n    </DropdownContainer>\n  );\n};\n\nexport default TemplateDropdown;\n","import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport ReactDOM from 'react-dom';\nimport styled from '@emotion/styled';\nimport {\n  Menu,\n  ChevronLeft,\n  ChevronRight,\n  ChevronDown,\n  Upload,\n  Building,\n  Package,\n  Calendar,\n  FileText as FileTextIcon,\n  Calculator,\n  Maximize2,\n  Minimize2,\n  Minus,\n  CheckCircle2,\n  FileDown\n} from 'lucide-react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faUser,\n  faClipboardCheck,\n  faFileContract,\n  faCheckCircle,\n  faClipboard,\n  faBookmark,\n  faExpand,\n  faCompress,\n  faSave\n} from '@fortawesome/free-solid-svg-icons';\nimport TemplateDropdown from './TemplateDropdown';\n\n//  KRITICK: Kategorizace chybovch kl do sekc navigtoru\n// MUS BT 100% SHODN s OrderForm25.formatValidationErrors() !!!\n// Jakkoliv zmna zde MUS bt provedena i v OrderForm25.js\nconst categorizeErrorKey = (key) => {\n  // POAD JE DLEIT - specifitj podmnky mus bt PED obecnjmi!\n  \n  // 1. Informace o objednateli (vetn garanta!)\n  if (key.includes('jmeno') || key.includes('email') || key.includes('ev_cislo') || key.includes('garant')) {\n    console.log(` categorizeErrorKey: \"${key}\"  objednatel`);\n    return 'objednatel';\n  }\n  \n  // 2. Schvlen nkupu PO (FZE 1-2) - vetn FINANCOVN!\n  if (key.includes('prikazce') || key.includes('max_cena') || \n      key.includes('strediska') || key.includes('predmet') ||\n      key.includes('financovani') || key.includes('lp_kod') || key.includes('cislo_smlouvy') ||\n      key.includes('individualni_schvaleni') || key.includes('pojistna_udalost')) {\n    console.log(` categorizeErrorKey: \"${key}\"  schvaleni`);\n    return 'schvaleni';\n  }\n  \n  // 3. Detaily objednvky (FZE 3+: poloky + druh + lokalizace) - MUS BT PED dodavatelem!\n  if (key.startsWith('polozka_') || key.includes('druh_objednavky')) {\n    return 'detaily';\n  }\n  \n  // 4. Potvrzen objednvky dodavatelem - MUS BT PED \"dodavatel\" (kvli dodavatel_zpusob_potvrzeni)\n  if (key.includes('zpusob_potvrzeni') || key.includes('dt_akceptace') || key.includes('zpusob_platby')) {\n    return 'potvrzeni_objednavky';\n  }\n  \n  // 5. Dodavatel - MUS BT PO potvrzen (kvli dodavatel_zpusob_potvrzeni)\n  if (key.includes('dodavatel') || key.includes('ico') || key.includes('adresa') || key.includes('kontakt')) {\n    return 'dodavatel';\n  }\n  \n  // 6. Odesln objednvky\n  if (key.includes('datum_odeslani') || key.includes('stav_odeslani')) {\n    return 'stav_odeslani';\n  }\n  \n  // 7. Vcn sprvnost - MUS BT PED obecnm \"faktura_\"\n  if (key.startsWith('faktura_') && key.includes('vecna_spravnost')) {\n    return 'vecna_spravnost';\n  }\n  \n  // 8. Fakturace\n  if (key.startsWith('faktura_')) {\n    return 'fakturace';\n  }\n  \n  // 9. Registr smluv\n  if (key.includes('dt_zverejneni') || key.includes('registr') || key.includes('ma_byt_zverejnena')) {\n    return 'registr_smluv_vyplneni';\n  }\n  \n  // 10. Ostatn (fallback)\n  return null;\n};\n\n// Konstanta pro ku navigtoru\nconst NAVIGATOR_WIDTH = 305; // +25px\nconst NAVIGATOR_MINIMIZED_WIDTH = 40;\nconst NAVIGATOR_COMPACT_WIDTH = 305; // Kompaktn reim (jen dropzone)\nconst DROPZONE_HEIGHT = 120;\n\n// Styled Components\nconst NavigatorContainer = styled.div`\n  position: fixed;\n  top: ${props => props.$position.y}px;\n  left: ${props => props.$position.x}px;\n  width: ${props => {\n    if (props.$isMinimized) return `${NAVIGATOR_MINIMIZED_WIDTH}px`;\n    if (props.$isCompact) return `${NAVIGATOR_COMPACT_WIDTH}px`;\n    return `${NAVIGATOR_WIDTH}px`;\n  }};\n  background: ${props => props.$isMinimized\n    ? 'linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.98) 100%)'\n    : 'linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.98) 100%)'\n  };\n  backdrop-filter: blur(12px);\n  border-radius: ${props => props.$isMinimized ? '0 8px 8px 0' : '12px'};\n  box-shadow: ${props => props.$isMinimized\n    ? '0 4px 16px rgba(0, 0, 0, 0.1), 0 1px 4px rgba(0, 0, 0, 0.06)'\n    : '0 8px 32px rgba(0, 0, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(0, 0, 0, 0.08)'};\n  z-index: ${props => props.$isFullscreen ? '999999' : '99999'};\n  cursor: ${props => props.$isDragging ? 'grabbing' : 'default'};\n  transition: ${props => props.$isDragging\n    ? 'none'\n    : 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)'};\n  display: flex;\n  flex-direction: column;\n  max-height: ${props => props.$isMinimized ? '400px' : '80vh'};\n  user-select: none;\n  will-change: width, left, border-radius, box-shadow;\n\n  ${props => props.$isMinimized && `\n    left: 0;\n    border-radius: 0 8px 8px 0;\n  `}\n`;\n\nconst NavigatorHeader = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: ${props => props.$isMinimized ? '12px 8px' : '16px 20px'};\n  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n  border-bottom: 2px solid #e2e8f0;\n  cursor: ${props => props.$isMinimized ? 'default' : 'grab'};\n  border-radius: ${props => props.$isMinimized ? '0 8px 0 0' : '12px 12px 0 0'};\n  transition: padding 0.4s cubic-bezier(0.4, 0, 0.2, 1), border-radius 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n\n  &:active {\n    cursor: ${props => props.$isMinimized ? 'default' : 'grabbing'};\n  }\n`;\n\nconst MinimizedText = styled.div`\n  writing-mode: vertical-rl;\n  text-orientation: mixed;\n  font-size: 14px;\n  font-weight: 600;\n  color: #334155;\n  letter-spacing: 2px;\n  text-transform: uppercase;\n  line-height: 1.2;\n  animation: fadeInScaleDelayed 0.3s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;\n\n  @keyframes fadeInScaleDelayed {\n    from {\n      opacity: 0;\n      transform: scale(0.9) translateY(10px);\n    }\n    to {\n      opacity: 1;\n      transform: scale(1) translateY(0);\n    }\n  }\n`;\n\nconst NavigatorTitle = styled.div`\n  font-size: 15px;\n  font-weight: 600;\n  color: #1e293b;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  animation: fadeInSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n\n  @keyframes fadeInSlide {\n    from {\n      opacity: 0;\n      transform: translateX(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateX(0);\n    }\n  }\n\n  svg {\n    width: 18px;\n    height: 18px;\n    color: #3b82f6;\n  }\n`;\n\nconst HeaderControls = styled.div`\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  animation: fadeInSlideLeft 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n\n  @keyframes fadeInSlideLeft {\n    from {\n      opacity: 0;\n      transform: translateX(10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateX(0);\n    }\n  }\n`;\n\nconst ToolbarSection = styled.div`\n  padding: 12px 16px;\n  border-bottom: 2px solid #e2e8f0;\n  background: linear-gradient(135deg, #fefefe 0%, #f8fafc 100%);\n  animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n      transform: translateY(-5px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n`;\n\nconst ToolbarButtons = styled.div`\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n`;\n\nconst ToolbarButton = styled.button`\n  background: #ffffff;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  transition: all 0.2s ease;\n  color: #475569;\n  opacity: ${props => props.disabled ? 0.4 : 1};\n  position: relative;\n\n  &:hover:not(:disabled) {\n    background: #f8fafc;\n    border-color: #cbd5e1;\n    color: #1e293b;\n    transform: scale(1.05);\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n  }\n\n  &:active:not(:disabled) {\n    transform: scale(0.95);\n  }\n\n  ${props => props.$withPlus && `\n    &::after {\n      content: '+';\n      position: absolute;\n      top: -2px;\n      right: -2px;\n      width: 14px;\n      height: 14px;\n      background: #f59e0b;\n      color: white;\n      border-radius: 50%;\n      font-size: 10px;\n      font-weight: bold;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border: 2px solid white;\n    }\n  `}\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n`;\n\nconst IconButton = styled.button`\n  background: #ffffff;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  color: #475569;\n\n  &:hover {\n    background: #f8fafc;\n    border-color: #cbd5e1;\n    color: #1e293b;\n    transform: scale(1.05);\n  }\n\n  &:active {\n    transform: scale(0.95);\n  }\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n`;\n\nconst MinimizedExpandButton = styled(IconButton)`\n  margin: 8px auto;\n  display: flex;\n  animation: fadeInBounce 0.3s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;\n\n  @keyframes fadeInBounce {\n    0% {\n      opacity: 0;\n      transform: scale(0.8) translateY(-10px);\n    }\n    60% {\n      transform: scale(1.05) translateY(0);\n    }\n    100% {\n      opacity: 1;\n      transform: scale(1) translateY(0);\n    }\n  }\n`;\n\nconst NavigatorContent = styled.div`\n  flex: 1;\n  overflow: hidden;\n  padding: ${props => props.$isMinimized ? '8px 4px' : '12px 8px'};\n  transition: padding 0.4s cubic-bezier(0.4, 0, 0.2, 1),\n              opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1),\n              transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n  opacity: ${props => props.$isMinimized ? '0' : '1'};\n  transform: ${props => props.$isMinimized ? 'scale(0.95) translateX(-10px)' : 'scale(1) translateX(0)'};\n  transform-origin: left center;\n\n  ${props => !props.$isMinimized && `\n    overflow-y: auto;\n  `}\n\n  &::-webkit-scrollbar {\n    width: 6px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: rgba(226, 232, 240, 0.3);\n    border-radius: 3px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: rgba(148, 163, 184, 0.5);\n    border-radius: 3px;\n\n    &:hover {\n      background: rgba(100, 116, 139, 0.7);\n    }\n  }\n`;\n\nconst SectionItem = styled.div`\n  padding: ${props => props.$isMinimized ? '8px 4px' : '10px 14px'};\n  margin-bottom: 6px;\n  border-radius: 8px;\n  cursor: pointer; /*  Vdy pointer - umouje scrollovn i k zamenm sekcm */\n  transition: all 0.2s ease;\n  opacity: ${props => props.$isDisabled ? 0.45 : 1};\n  background: ${props => {\n    if (props.$isDisabled) return 'linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)';\n    return props.$bgColor || 'rgba(255, 255, 255, 0.8)';\n  }};\n  border: 2px solid ${props => {\n    if (props.$isDisabled) return '#cbd5e1';\n    return props.$borderColor || '#94a3b8';\n  }};\n  box-shadow: ${props => props.$isActive\n    ? '0 2px 8px rgba(0, 0, 0, 0.12), inset 0 0 0 1px rgba(59, 130, 246, 0.3)'\n    : '0 1px 3px rgba(0, 0, 0, 0.05)'\n  };\n\n  &:hover {\n    opacity: ${props => props.$isDisabled ? 0.55 : 1}; /*  Mrn zesvtlen i pro disabled */\n    transform: translateX(2px); /*  Hover efekt i pro disabled - ukazuje e je to klikateln */\n    box-shadow: ${props => props.$isDisabled\n      ? '0 2px 6px rgba(0, 0, 0, 0.08)' /*  Mrn stn pro disabled */\n      : '0 4px 12px rgba(0, 0, 0, 0.12)'\n    };\n  }\n`;\n\nconst SectionItemContent = styled.div`\n  display: flex;\n  align-items: center;\n  gap: ${props => props.$isMinimized ? '0' : '12px'};\n  justify-content: ${props => props.$isMinimized ? 'center' : 'flex-start'};\n`;\n\nconst SectionIcon = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  color: ${props => props.$isDisabled ? '#64748b' : props.$color || '#94a3b8'};\n  flex-shrink: 0;\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n`;\n\nconst SectionInfo = styled.div`\n  flex: 1;\n  min-width: 0;\n  color: ${props => props.$textColor || '#1e293b'};\n`;\n\nconst SectionName = styled.div`\n  font-size: 13px;\n  font-weight: 600;\n  line-height: 1.4;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst ValidationBadge = styled.span`\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background: ${props => {\n    if (props.$hasErrors) return '#ef4444'; // erven pro chyby\n    if (props.$hasMissingFields) return '#f59e0b'; // Oranov teka pro nevyplnn pole\n    return '#10b981'; // Zelen pro OK (nepouv se)\n  }};\n  color: white;\n  font-size: 11px;\n  font-weight: 600;\n  padding: ${props => props.$hasMissingFields && !props.$hasErrors ? '5px' : '2px 6px'};\n  border-radius: 50%;\n  width: ${props => props.$hasMissingFields && !props.$hasErrors ? '8px' : '20px'};\n  height: ${props => props.$hasMissingFields && !props.$hasErrors ? '8px' : '20px'};\n  min-width: ${props => props.$hasMissingFields && !props.$hasErrors ? '8px' : '20px'};\n  min-height: ${props => props.$hasMissingFields && !props.$hasErrors ? '8px' : '20px'};\n  margin-left: auto;\n  flex-shrink: 0;\n  line-height: 1;\n`;\n\nconst DropzoneContainer = styled.div`\n  margin: 12px 8px 12px 8px;\n  padding: ${props => props.$isMinimized ? '12px 8px' : '20px'};\n  border: 2px dashed ${props => props.$isDisabled ? '#d1d5db' : (props.$isDragOver ? '#dc2626' : '#fca5a5')};\n  border-radius: 8px;\n  background: ${props => props.$isDisabled\n    ? '#f3f4f6'\n    : (props.$isDragOver\n      ? 'linear-gradient(135deg, rgba(254, 202, 202, 0.5) 0%, rgba(252, 165, 165, 0.5) 100%)'\n      : 'linear-gradient(135deg, rgba(254, 226, 226, 0.3) 0%, rgba(254, 202, 202, 0.3) 100%)')\n  };\n  transition: all 0.2s ease;\n  cursor: ${props => props.$isDisabled ? 'not-allowed' : 'pointer'};\n  opacity: ${props => props.$isDisabled ? 0.5 : 1};\n  pointer-events: ${props => props.$isDisabled ? 'none' : 'auto'};\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: ${props => props.$isMinimized ? '4px' : '8px'};\n  height: ${props => props.$isMinimized ? '60px' : `${DROPZONE_HEIGHT}px`};\n\n  &:hover {\n    border-color: ${props => props.$isDisabled ? '#d1d5db' : '#dc2626'};\n    background: ${props => props.$isDisabled ? '#f3f4f6' : 'linear-gradient(135deg, rgba(254, 202, 202, 0.5) 0%, rgba(252, 165, 165, 0.5) 100%)'};\n  }\n`;\n\nconst DropzoneIcon = styled.div`\n  color: ${props => props.$isDisabled ? '#9ca3af' : (props.$isDragOver ? '#dc2626' : '#991b1b')};\n  transition: all 0.2s ease;\n\n  svg {\n    width: ${props => props.$isMinimized ? '20px' : '32px'};\n    height: ${props => props.$isMinimized ? '20px' : '32px'};\n  }\n`;\n\nconst DropzoneText = styled.div`\n  font-size: ${props => props.$isMinimized ? '10px' : '13px'};\n  font-weight: 600;\n  color: ${props => props.$isDisabled ? '#9ca3af' : (props.$isDragOver ? '#dc2626' : '#991b1b')};\n  text-align: center;\n  line-height: 1.4;\n`;\n\n// Definice sekc formule - barvy odpovdaj OrderForm25 schmatu\nconst FORM_SECTIONS = [\n  {\n    id: 'objednatel',\n    name: 'Informace o objednateli',\n    icon: faUser,\n    color: '#4b5563', // section-grey text color\n    bgColor: 'linear-gradient(135deg, rgba(249, 250, 251, 0.95) 0%, rgba(243, 244, 246, 0.95) 100%)',\n    borderColor: '#9ca3af',\n    phase: 1,\n    required: ['jmeno', 'prijmeni']\n  },\n  {\n    id: 'schvaleni',\n    name: 'Schvlen nkupu PO',\n    icon: faClipboardCheck,\n    color: '#4b5563', // section-grey text color\n    bgColor: 'linear-gradient(135deg, rgba(249, 250, 251, 0.95) 0%, rgba(243, 244, 246, 0.95) 100%)',\n    borderColor: '#9ca3af',\n    phase: 1,\n    required: ['schvalovatel_id']\n  },\n  // 'financovani' je podsekce schvlen - nen v navigtoru samostatn\n  {\n    id: 'dodavatel',\n    name: 'Dodavatel',\n    icon: Building,\n    iconType: 'lucide',\n    color: '#92400e', // section-orange text color\n    bgColor: 'linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)',\n    borderColor: '#f59e0b',\n    phase: 2,\n    required: ['dodavatel_ico', 'dodavatel_nazev']\n  },\n  {\n    id: 'detaily',\n    name: 'Detaily objednvky',\n    icon: Package,\n    iconType: 'lucide',\n    color: '#92400e', // section-orange text color\n    bgColor: 'linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)',\n    borderColor: '#f59e0b',\n    phase: 2,\n    required: ['predmet', 'celkova_cena']\n  },\n  {\n    id: 'dodaci_podminky',\n    name: 'Dodac a zrun podmnky',\n    icon: Calendar,\n    iconType: 'lucide',\n    color: '#92400e', // section-orange text color\n    bgColor: 'linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)',\n    borderColor: '#f59e0b',\n    phase: 2,\n    required: []\n  },\n  {\n    id: 'prilohy',\n    name: 'Plohy k objednvce',\n    icon: FileTextIcon,\n    iconType: 'lucide',\n    color: '#991b1b', // section-red text color\n    bgColor: 'linear-gradient(135deg, rgba(254, 226, 226, 0.95) 0%, rgba(254, 202, 202, 0.95) 100%)',\n    borderColor: '#dc2626',\n    phase: 2,\n    required: []\n  },\n  {\n    id: 'stav_odeslani',\n    name: 'Stav odesln objednvky',\n    icon: Package,\n    iconType: 'lucide',\n    color: '#92400e', // section-orange text color\n    bgColor: 'linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)',\n    borderColor: '#f59e0b',\n    phase: 3,\n    required: []\n  },\n  {\n    id: 'potvrzeni_objednavky',\n    name: 'Potvrzen objednvky',\n    icon: faCheckCircle,\n    color: '#1e40af', // section-blue text color\n    bgColor: 'linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)',\n    borderColor: '#3b82f6',\n    phase: 3,\n    required: []\n  },\n  {\n    id: 'registr_smluv',\n    name: 'Registr smluv',\n    icon: faFileContract,\n    color: '#1e40af', // section-blue text color\n    bgColor: 'linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)',\n    borderColor: '#3b82f6',\n    phase: 4,\n    required: []\n  },\n  {\n    id: 'registr_smluv_vyplneni',\n    name: 'Potvrzen zveejnn',\n    icon: faFileContract,\n    color: '#7e22ce', // section-purple text color\n    bgColor: 'linear-gradient(135deg, rgba(243, 232, 255, 0.95) 0%, rgba(233, 213, 255, 0.95) 100%)',\n    borderColor: '#a855f7',\n    phase: 5,\n    required: []\n  },\n  {\n    id: 'fakturace',\n    name: 'Fakturace',\n    icon: Calculator,\n    iconType: 'lucide',\n    color: '#1e40af', // section-blue text color\n    bgColor: 'linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)',\n    borderColor: '#3b82f6',\n    phase: 6,\n    required: []\n  },\n  {\n    id: 'vecna_spravnost',\n    name: 'Vcn sprvnost',\n    icon: CheckCircle2,\n    iconType: 'lucide',\n    color: '#1e40af', // section-blue text color\n    bgColor: 'linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)',\n    borderColor: '#3b82f6',\n    phase: 7,\n    required: []\n  },\n  {\n    id: 'dokonceni',\n    name: 'Dokonen',\n    icon: faCheckCircle,\n    color: '#059669', // zelen pro dokonen\n    bgColor: 'linear-gradient(135deg, rgba(209, 250, 229, 0.95) 0%, rgba(167, 243, 208, 0.95) 100%)',\n    borderColor: '#10b981',\n    phase: 8,\n    required: []\n  }\n  //  \"Plohy k objednvce\" jsou vyrenderovan SAMOSTATN POD dropzone (viz ne v JSX)\n];\n\n/**\n * FloatingNavigator - Plovouc navigtor pro OrderForm25\n *\n * @param {Object} props\n * @param {Function} props.onSectionClick - Callback pi kliknut na sekci (sectionId)\n * @param {Function} props.onFilesDrop - Callback pi dropnut soubor (files)\n * @param {number} props.currentPhase - Aktuln fze workflow (1-5+)\n * @param {Object} props.validationErrors - Objekt s validanmi chybami\n * @param {Object} props.formData - Data formule pro kontrolu vyplnn\n * @param {boolean} props.isFullscreen - Zda je formul ve fullscreen reimu\n * @param {Function} props.isSectionActive - Funkce pro uren, zda je sekce aktivn\n * @param {boolean} props.canPublishRegistry - M uivatel prvo ORDER_PUBLISH_REGISTRY\n */\nconst FloatingNavigator = ({\n  onSectionClick,\n  onFilesDrop,\n  onToggleSections, //  Nov: callback pro sbalen/rozbalen sekc\n  areSectionsCollapsed = false, //  Nov: stav sbalen sekc\n  currentPhase = 1,\n  validationErrors = {},\n  formData = {},\n  isFullscreen = false,\n  isSectionActive,\n  allSectionStates = {}, //  Pidno: stavy sekc z workflowManager\n  isWorkflowCompleted = false, //  Nov: indiktor dokonenho workflow (DOKONCENA/ZAMITNUTA/ZRUSENA)\n  canPublishRegistry = false, //  Nov: oprvnn pro sekci registru smluv\n  canUnlockAnything = false, //  Nov: pouze ADMIN + ORDER_MANAGE vid sekci Dokonen\n  //  NOV: Toolbar akce\n  onTemplateClick,\n  onSaveAsTemplate,\n  onGenerateDocx,\n  onToggleFullscreen,\n  canGenerateDocx = false,\n  canSaveTemplate = false,\n  //  Template Dropdown props\n  showTemplateDropdown = false,\n  serverTemplates = [],\n  savedTemplates = [],\n  templatesLoading = false,\n  searchQuery = '',\n  showSearch = false,\n  token = null,\n  hasPermission,\n  onTemplateSearch,\n  onToggleTemplateSearch,\n  onRefreshTemplates,\n  onFillPoApproval,\n  onFillDetails,\n  canFillTemplate = true, //  Nov: me uivatel vyplnit data ze ablony\n  onCopyTemplateToUser,\n  onCopyTemplateToGlobal,\n  onShowTemplatePreview,\n  onDeleteTemplate,\n  onEditTemplateName,\n  editingTemplateId = null,\n  editingTemplateName = '',\n  matchesTemplateQuery,\n  isArchived = false\n}) => {\n  const [isMinimized, setIsMinimized] = useState(false);\n  const [isCompact, setIsCompact] = useState(false); //  Nov: Kompaktn reim\n  const [isDragging, setIsDragging] = useState(false);\n  const [isDragOver, setIsDragOver] = useState(false);\n  const [position, setPosition] = useState({ x: 20, y: 150 });\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n  const [isTemplateDropdownOpen, setIsTemplateDropdownOpen] = useState(false); //  State pro dropdown ablon\n  const containerRef = useRef(null);\n  const fileInputRef = useRef(null);\n  const contentRef = useRef(null); //  Ref pro scroll pozici\n\n  // Save position to localStorage\n  const savePosition = useCallback((newPosition) => {\n    localStorage.setItem('floatingNavigatorPosition', JSON.stringify(newPosition));\n  }, []);\n\n  //  Funkce pro kontrolu a pravu pozice pi zmn velikosti okna\n  const constrainToViewport = useCallback((pos) => {\n    const navigatorWidth = isMinimized ? NAVIGATOR_MINIMIZED_WIDTH :\n                           isCompact ? NAVIGATOR_COMPACT_WIDTH : NAVIGATOR_WIDTH;\n\n    // Minimln okraj kolem navigtoru\n    const margin = 20;\n    \n    // Zskat skutenou vku navigtoru z DOM\n    const navigatorHeight = containerRef.current?.offsetHeight || 400;\n\n    const maxX = Math.max(0, window.innerWidth - navigatorWidth - margin);\n    const maxY = Math.max(0, window.innerHeight - navigatorHeight - margin);\n\n    const constrainedX = Math.max(0, Math.min(pos.x, maxX));\n    const constrainedY = Math.max(0, Math.min(pos.y, maxY));\n\n    return { x: constrainedX, y: constrainedY };\n  }, [isMinimized, isCompact]);\n\n    // Load position and scroll from localStorage\n  useEffect(() => {\n    const saved = localStorage.getItem('floatingNavigatorPosition');\n    if (saved) {\n      try {\n        const savedPos = JSON.parse(saved);\n        //  Zkontrolovat, zda uloen pozice je stle validn pro aktuln velikost okna\n        const constrainedPos = constrainToViewport(savedPos);\n        setPosition(constrainedPos);\n\n        // Uloit upravenou pozici, pokud se zmnila\n        if (constrainedPos.x !== savedPos.x || constrainedPos.y !== savedPos.y) {\n          savePosition(constrainedPos);\n        }\n      } catch (e) {\n        console.warn('Failed to parse saved navigator position');\n      }\n    }\n\n    const savedMinimized = localStorage.getItem('floatingNavigatorMinimized');\n    if (savedMinimized === 'true') {\n      setIsMinimized(true);\n    }\n\n    const savedCompact = localStorage.getItem('floatingNavigatorCompact');\n    if (savedCompact === 'true') {\n      setIsCompact(true);\n    }\n\n    //  Obnoven scroll pozice\n    const savedScroll = localStorage.getItem('floatingNavigatorScroll');\n    if (savedScroll && contentRef.current) {\n      try {\n        const scrollPos = parseInt(savedScroll, 10);\n        contentRef.current.scrollTop = scrollPos;\n      } catch (e) {\n        console.warn('Failed to restore scroll position');\n      }\n    }\n  }, [constrainToViewport, savePosition]);\n\n  //  Handler pro zmnu velikosti okna\n  const handleWindowResize = useCallback(() => {\n    setPosition(prevPosition => {\n      const newPosition = constrainToViewport(prevPosition);\n\n      // Uloit novou pozici jen pokud se skuten zmnila\n      if (newPosition.x !== prevPosition.x || newPosition.y !== prevPosition.y) {\n        savePosition(newPosition);\n        return newPosition;\n      }\n\n      return prevPosition;\n    });\n  }, [constrainToViewport, savePosition]);\n\n  //  Sledovn zmn velikosti okna\n  useEffect(() => {\n    const handleResize = () => {\n      // Debounce resize handler pro lep vkon\n      clearTimeout(handleResize.timeoutId);\n      handleResize.timeoutId = setTimeout(handleWindowResize, 150);\n    };\n\n    window.addEventListener('resize', handleResize);\n\n    return () => {\n      window.removeEventListener('resize', handleResize);\n      clearTimeout(handleResize.timeoutId);\n    };\n  }, [handleWindowResize]);\n\n  // Save minimized state\n  const saveMinimizedState = useCallback((minimized) => {\n    localStorage.setItem('floatingNavigatorMinimized', minimized.toString());\n  }, []);\n\n  // Save compact state\n  const saveCompactState = useCallback((compact) => {\n    localStorage.setItem('floatingNavigatorCompact', compact.toString());\n  }, []);\n\n  //  Save scroll position (debounced)\n  const scrollTimeoutRef = useRef(null);\n  const saveScrollPosition = useCallback(() => {\n    if (scrollTimeoutRef.current) {\n      clearTimeout(scrollTimeoutRef.current);\n    }\n    scrollTimeoutRef.current = setTimeout(() => {\n      if (contentRef.current) {\n        localStorage.setItem('floatingNavigatorScroll', contentRef.current.scrollTop.toString());\n      }\n    }, 300); // ulo a po 300ms bez scrollovn\n  }, []);\n\n  // Drag handlers\n  const handleMouseDown = useCallback((e) => {\n    if (isMinimized) return;\n\n    const rect = containerRef.current.getBoundingClientRect();\n    setDragOffset({\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top\n    });\n    setIsDragging(true);\n  }, [isMinimized]);\n\n  const handleMouseMove = useCallback((e) => {\n    if (!isDragging) return;\n\n    const newX = e.clientX - dragOffset.x;\n    const newY = e.clientY - dragOffset.y;\n\n    // Pout centralizovanou constraint logiku\n    const constrainedPosition = constrainToViewport({ x: newX, y: newY });\n\n    setPosition(constrainedPosition);\n  }, [isDragging, dragOffset, constrainToViewport]);\n\n  const handleMouseUp = useCallback(() => {\n    if (isDragging) {\n      setIsDragging(false);\n      savePosition(position);\n    }\n  }, [isDragging, position, savePosition]);\n\n  useEffect(() => {\n    if (isDragging) {\n      document.addEventListener('mousemove', handleMouseMove);\n      document.addEventListener('mouseup', handleMouseUp);\n\n      return () => {\n        document.removeEventListener('mousemove', handleMouseMove);\n        document.removeEventListener('mouseup', handleMouseUp);\n      };\n    }\n  }, [isDragging, handleMouseMove, handleMouseUp]);\n\n  // Toggle minimized\n  const toggleMinimized = useCallback(() => {\n    const newMinimized = !isMinimized;\n    setIsMinimized(newMinimized);\n    saveMinimizedState(newMinimized);\n\n    if (newMinimized) {\n      // Pilepit k levmu okraji\n      const newPosition = { ...position, x: 0 };\n      setPosition(newPosition);\n      savePosition(newPosition);\n    } else {\n      // Pi rozblen zkontrolovat, zda je pozice stle validn\n      setPosition(prevPos => {\n        const constrainedPos = constrainToViewport(prevPos);\n        if (constrainedPos.x !== prevPos.x || constrainedPos.y !== prevPos.y) {\n          savePosition(constrainedPos);\n        }\n        return constrainedPos;\n      });\n    }\n  }, [isMinimized, position, saveMinimizedState, savePosition, constrainToViewport]);\n\n  // Toggle compact mode\n  const toggleCompact = useCallback(() => {\n    const newCompact = !isCompact;\n    setIsCompact(newCompact);\n    saveCompactState(newCompact);\n\n    // Po zmn compact reimu zkontrolovat pozici (jin ka navigtoru)\n    setTimeout(() => {\n      setPosition(prevPos => {\n        const constrainedPos = constrainToViewport(prevPos);\n        if (constrainedPos.x !== prevPos.x || constrainedPos.y !== prevPos.y) {\n          savePosition(constrainedPos);\n        }\n        return constrainedPos;\n      });\n    }, 50); // Krtk prodleva pro dokonen CSS pechodu\n  }, [isCompact, saveCompactState, constrainToViewport, savePosition]);\n\n  // Dropzone handlers\n  const handleDragEnter = useCallback((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(true);\n  }, []);\n\n  const handleDragLeave = useCallback((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    // Zkontroluj, zda opravdu opoutme celou dropzone oblast\n    if (!e.currentTarget.contains(e.relatedTarget)) {\n      setIsDragOver(false);\n    }\n  }, []);\n\n  const handleDragOver = useCallback((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(true);\n  }, []);\n\n  const handleDrop = useCallback((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(false);\n\n    const files = Array.from(e.dataTransfer.files);\n    if (files.length > 0 && onFilesDrop) {\n      onFilesDrop(files);\n    }\n  }, [onFilesDrop]);\n\n  const handleDropzoneClick = useCallback(() => {\n    fileInputRef.current?.click();\n  }, []);\n\n  const handleFileSelect = useCallback((e) => {\n    const files = Array.from(e.target.files);\n    if (files.length > 0 && onFilesDrop) {\n      onFilesDrop(files);\n    }\n    // Reset input\n    e.target.value = '';\n  }, [onFilesDrop]);\n\n  //  Handler pro toggle template dropdownu\n  const handleToggleTemplateDropdown = useCallback(() => {\n    setIsTemplateDropdownOpen(prev => !prev);\n    // Pi oteven voliteln zavolat refresh ablon\n    if (!isTemplateDropdownOpen && onRefreshTemplates) {\n      onRefreshTemplates();\n    }\n  }, [isTemplateDropdownOpen, onRefreshTemplates]);\n\n  //  Zavt dropdown pi kliknut mimo nj\n  useEffect(() => {\n    if (!isTemplateDropdownOpen) return;\n\n    const handleClickOutside = (event) => {\n      // Zkontroluj, jestli klik nebyl na tlatko nebo dropdown\n      const dropdown = event.target.closest('[data-template-dropdown]');\n      const toolbarButton = event.target.closest('[data-template-button]');\n      \n      if (!dropdown && !toolbarButton) {\n        setIsTemplateDropdownOpen(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [isTemplateDropdownOpen]);\n\n  // Section click handler - umouje scrollovn i k zamenm sekcm pro ten\n  const handleSectionClick = useCallback((section) => {\n    if (onSectionClick) {\n      onSectionClick(section.id);\n    }\n  }, [onSectionClick]);\n\n  //  Mapovn validanch kl na sekce navigtoru\n  const FIELD_TO_SECTION = {\n    // Sekce: Objednatel (informace o objednateli)\n    jmeno: 'objednatel',\n    prijmeni: 'objednatel',\n    email: 'objednatel',\n    telefon: 'objednatel',\n    \n    // Sekce: Schvlen nkupu PO\n    schvalovatel_id: 'schvaleni',\n    prikazce_id: 'schvaleni',\n    garant_uzivatel_id: 'schvaleni',\n    strediska_kod: 'schvaleni',\n    zpusob_financovani: 'schvaleni',\n    lp_kod: 'schvaleni',\n    cislo_smlouvy: 'schvaleni',\n    smlouva_poznamka: 'schvaleni',\n    individualni_schvaleni: 'schvaleni',\n    individualni_poznamka: 'schvaleni',\n    pojistna_udalost_cislo: 'schvaleni',\n    pojistna_udalost_poznamka: 'schvaleni',\n    schvaleni_komentar: 'schvaleni',\n    \n    // Sekce: Dodavatel\n    dodavatel_ico: 'dodavatel',\n    dodavatel_nazev: 'dodavatel',\n    dodavatel_adresa: 'dodavatel',\n    dodavatel_kontakt: 'dodavatel',\n    ico: 'dodavatel',\n    nazev: 'dodavatel',\n    ulice: 'dodavatel',\n    psc: 'dodavatel',\n    obec: 'dodavatel',\n    \n    // Sekce: Detaily objednvky\n    predmet: 'detaily',\n    nazev_objednavky: 'detaily',\n    max_cena_s_dph: 'detaily',\n    celkova_cena: 'detaily',\n    druh_objednavky_kod: 'detaily',\n    polozky_objednavky: 'detaily',\n    // Poloky objednvky (pattern match)\n    // polozka_N_popis, polozka_N_cena_bez_dph, polozka_N_cena_s_dph atd.\n    \n    // Sekce: Dodac a zrun podmnky\n    dodaci_termin: 'dodaci_podminky',\n    misto_dodani: 'dodaci_podminky',\n    zarucni_doba: 'dodaci_podminky',\n    zaruka_poznamka: 'dodaci_podminky',\n    \n    // Sekce: Plohy k objednvce\n    // (nem validan pole, jen vizuln zobrazen)\n    \n    // Sekce: Stav odesln objednvky\n    datum_odeslani: 'stav_odeslani',\n    odeslani_storno_duvod: 'stav_odeslani',\n    \n    // Sekce: Potvrzen objednvky\n    dodavatel_zpusob_potvrzeni: 'potvrzeni_objednavky',\n    zpusob_platby: 'potvrzeni_objednavky',\n    dt_akceptace: 'potvrzeni_objednavky',\n    \n    // Sekce: Registr smluv\n    ma_byt_zverejnena: 'registr_smluv',\n    \n    // Sekce: Potvrzen zveejnn (registr_smluv_vyplneni)\n    dt_zverejneni: 'registr_smluv_vyplneni',\n    registr_iddt: 'registr_smluv_vyplneni',\n    \n    // Sekce: Fakturace\n    // faktura_N_cislo, faktura_N_castka, faktura_N_dorucena, faktura_N_splatnost atd.\n    \n    // Sekce: Vcn sprvnost\n    // faktura_N_vecna_spravnost, faktura_N_poznamka_vs atd.\n  };\n\n  // Count fields for section - pot chyby validace + nevyplnn povinn pole\n  const getSectionValidationInfo = useCallback((section) => {\n    // Pouij centralizovanou kategorizaci chyb\n    const sectionErrors = Object.keys(validationErrors).filter(key => {\n      const category = categorizeErrorKey(key);\n      const matches = category === section.id;\n      return matches;\n    });\n\n    const errorCount = sectionErrors.length;\n    \n    if (Object.keys(validationErrors).length > 0 && section.id === 'schvaleni') {\n      console.log(` NaviPanel - sekce \"${section.id}\":`, {\n        allValidationErrors: validationErrors,\n        allErrorKeys: Object.keys(validationErrors),\n        sectionErrors,\n        errorCount\n      });\n    }\n\n    //  Spotat nevyplnn povinn pole (jen pokud NEJSOU validan chyby)\n    // Toto slou k zobrazen \"oranov teky\" ped pokusem o uloen\n    let missingCount = 0;\n    \n    // Speciln logika pro sekci vcn sprvnosti - kontrola checkbox u faktur\n    if (errorCount === 0 && section.id === 'vecna_spravnost' && formData.faktury && formData.faktury.length > 0) {\n      // Zkontroluj kadou fakturu, zda m potvrzenou vcnou sprvnost\n      formData.faktury.forEach((faktura) => {\n        if (faktura.potvrzeni_vecne_spravnosti !== 1 && faktura.potvrzeni_vecne_spravnosti !== true) {\n          missingCount++;\n        }\n        \n        // Pokud faktura pekrauje max cenu, kontroluj i poznmku\n        const maxCena = parseFloat(formData.max_cena_s_dph) || 0;\n        const fakturaCastka = parseFloat(faktura.fa_castka) || 0;\n        if (fakturaCastka > maxCena && (!faktura.vecna_spravnost_poznamka || faktura.vecna_spravnost_poznamka.trim() === '')) {\n          missingCount++;\n        }\n      });\n    }\n    // Bn logika pro ostatn sekce\n    else if (errorCount === 0 && section.required && section.required.length > 0) {\n      section.required.forEach(fieldName => {\n        const value = formData[fieldName];\n        \n        // Kontrola, zda je pole przdn\n        const isEmpty = !value || \n          (typeof value === 'string' && value.trim() === '') ||\n          (Array.isArray(value) && value.length === 0);\n        \n        if (isEmpty) {\n          missingCount++;\n        }\n      });\n    }\n\n    return {\n      missingCount: missingCount,\n      errorCount: errorCount,\n      totalRequired: section.required?.length || 0\n    };\n  }, [validationErrors, formData]);\n\n  //  Kontrola viditelnosti a enabled stavu podle WorkflowManager\n  const isSectionVisibleAndEnabled = useCallback((sectionId) => {\n    const sectionState = allSectionStates[sectionId];\n    if (!sectionState) return { visible: true, enabled: true }; // fallback\n\n    //  Pouvat section states pmo z WorkflowManager (pes allSectionStates)\n    // Vechny podmnky viditelnosti jsou u vyeen v OrderForm25 (extendedSectionStates)\n    return {\n      visible: sectionState.visible !== false, // sekce je viditeln\n      enabled: sectionState.enabled !== false  // sekce je enabled (ne disabled)\n    };\n  }, [allSectionStates]);\n\n  // Render section icon\n  const renderSectionIcon = (section) => {\n    if (section.iconType === 'lucide') {\n      const IconComponent = section.icon;\n      return <IconComponent />;\n    }\n    return <FontAwesomeIcon icon={section.icon} />;\n  };\n\n  const navigatorContent = (\n    <NavigatorContainer\n      ref={containerRef}\n      $position={position}\n      $isMinimized={isMinimized}\n      $isCompact={isCompact}\n      $isDragging={isDragging}\n      $isFullscreen={isFullscreen}\n    >\n      <NavigatorHeader\n        $isMinimized={isMinimized}\n        onMouseDown={handleMouseDown}\n      >\n        {isMinimized ? (\n          <MinimizedText>NAVIGATOR</MinimizedText>\n        ) : (\n          <>\n            <NavigatorTitle>\n              <Menu />\n              Navigace\n            </NavigatorTitle>\n            <HeaderControls>\n              <IconButton\n                onClick={toggleCompact}\n                title={isCompact ? \"Zobrazit vechny sekce\" : \"Zobrazit jen Plohy + Dropzone\"}\n              >\n                {isCompact ? <Maximize2 /> : <Minimize2 />}\n              </IconButton>\n              <IconButton onClick={toggleMinimized} title=\"Minimalizovat (schovat na levou stranu)\">\n                <ChevronLeft />\n              </IconButton>\n            </HeaderControls>\n          </>\n        )}\n      </NavigatorHeader>\n\n      {/*  TOOLBAR: Akce pro prci s objednvkou */}\n      {!isMinimized && (\n        <ToolbarSection>\n          <ToolbarButtons>\n            <ToolbarButton\n              data-template-button\n              onClick={handleToggleTemplateDropdown}\n              title={canFillTemplate ? \"Nast ablonu objednvky\" : \"Natn ablon nen k dispozici - objednvka je dokonena nebo m neuloen zmny\"}\n              disabled={!canFillTemplate}\n            >\n              <FontAwesomeIcon icon={faBookmark} />\n            </ToolbarButton>\n            {onSaveAsTemplate && (\n              <ToolbarButton\n                $withPlus\n                onClick={onSaveAsTemplate}\n                title=\"Uloit aktuln formul jako ablonu\"\n                disabled={!canSaveTemplate}\n              >\n                <FontAwesomeIcon icon={faBookmark} />\n              </ToolbarButton>\n            )}\n            {onGenerateDocx && (\n              <ToolbarButton\n                onClick={onGenerateDocx}\n                title=\"Generovat DOCX ze ablony\"\n                disabled={!canGenerateDocx}\n              >\n                <FileDown size={16} />\n              </ToolbarButton>\n            )}\n            {onToggleSections && (\n              <ToolbarButton\n                onClick={onToggleSections}\n                title={areSectionsCollapsed ? \"Rozbalit vechny sekce\" : \"Sbalit zamen sekce\"}\n              >\n                {areSectionsCollapsed ? <ChevronDown size={16} /> : <Minus size={16} />}\n              </ToolbarButton>\n            )}\n            {onToggleFullscreen && (\n              <ToolbarButton\n                onClick={onToggleFullscreen}\n                title={isFullscreen ? \"Ukonit fullscreen reim\" : \"Pepnout do fullscreen reimu\"}\n              >\n                <FontAwesomeIcon icon={isFullscreen ? faCompress : faExpand} />\n              </ToolbarButton>\n            )}\n          </ToolbarButtons>\n          \n          {/*  Dropdown se ablonami - zobraz se pod ikonami */}\n          <div data-template-dropdown style={{ position: 'relative' }}>\n            <TemplateDropdown\n              show={isTemplateDropdownOpen}\n              serverTemplates={serverTemplates}\n              savedTemplates={savedTemplates}\n              templatesLoading={templatesLoading}\n              searchQuery={searchQuery}\n              showSearch={showSearch}\n              currentPhase={currentPhase}\n              isArchived={isArchived}\n              token={token}\n              hasPermission={hasPermission}\n              onSearch={onTemplateSearch}\n              onToggleSearch={onToggleTemplateSearch}\n              onRefresh={onRefreshTemplates}\n              onFillPo={onFillPoApproval}\n              onFillDetails={onFillDetails}\n              canFillTemplate={canFillTemplate}\n              onCopyToUser={onCopyTemplateToUser}\n              onCopyToGlobal={onCopyTemplateToGlobal}\n              onShowPreview={onShowTemplatePreview}\n              onDelete={onDeleteTemplate}\n              onEditName={onEditTemplateName}\n              editingTemplateId={editingTemplateId}\n              editingTemplateName={editingTemplateName}\n              matchesQuery={matchesTemplateQuery}\n            />\n          </div>\n        </ToolbarSection>\n      )}\n\n      {/* Tlatko pro rozbalen kdy je minimalizovan */}\n      {isMinimized && (\n        <MinimizedExpandButton\n          onClick={toggleMinimized}\n          title=\"Rozbalit navigtor\"\n        >\n          <ChevronRight />\n        </MinimizedExpandButton>\n      )}\n\n      {!isMinimized && (\n        <NavigatorContent\n          ref={contentRef}\n          $isMinimized={isMinimized}\n          onScroll={saveScrollPosition}\n        >\n          {/*  ST 1: Vechny poloky menu z FORM_SECTIONS */}\n          {FORM_SECTIONS.map((section) => {\n            //  SKIP \"prilohy\" - renderuje se samostatn pod dropzone\n            if (section.id === 'prilohy') return null;\n\n            //  V kompaktnm reimu SKRT vechny bn sekce\n            if (isCompact) return null;\n\n            //  Kontrola viditelnosti podle WorkflowManager\n            const { visible, enabled } = isSectionVisibleAndEnabled(section.id);\n\n            // Pokud sekce nen viditeln, neukzat ji\n            if (!visible) return null;\n\n            const isDisabled = !enabled; //  Disabled podle WorkflowManager\n            const isActive = isSectionActive ? isSectionActive(section.id) : false;\n            const validationInfo = getSectionValidationInfo(section);\n            \n            //  Zobrazen badge podle stavu:\n            // 1. erven koleko s slem = jsou chyby po validaci\n            // 2. Oranov teka = jsou nevyplnn povinn pole (jen kdy nen aktivn validace)\n            // 3. dn badge = ve OK\n            const hasErrors = validationInfo.errorCount > 0;\n            const hasMissingFields = !hasErrors && validationInfo.missingCount > 0;\n            const showBadge = hasErrors || hasMissingFields;\n\n            return (\n              <SectionItem\n                key={section.id}\n                $isDisabled={isDisabled}\n                $isActive={isActive}\n                $color={section.color}\n                $bgColor={section.bgColor}\n                $borderColor={section.borderColor}\n                $isMinimized={isMinimized}\n                onClick={() => handleSectionClick(section)}\n                title={isDisabled ? `${section.name} (zameno - kliknutm zobrazte vyplnn data)` : section.name}\n              >\n                <SectionItemContent $isMinimized={isMinimized}>\n                  <SectionIcon $color={section.color} $isDisabled={isDisabled}>\n                    {renderSectionIcon(section)}\n                  </SectionIcon>\n                  {!isMinimized && (\n                    <SectionInfo $textColor={isDisabled ? '#64748b' : section.color}>\n                      <SectionName $isDisabled={isDisabled}>\n                        {section.name}\n                        {showBadge && (\n                          <ValidationBadge \n                            $hasErrors={hasErrors}\n                            $hasMissingFields={hasMissingFields}\n                          >\n                            {hasErrors ? validationInfo.errorCount : ''}\n                          </ValidationBadge>\n                        )}\n                      </SectionName>\n                    </SectionInfo>\n                  )}\n                </SectionItemContent>\n              </SectionItem>\n            );\n          })}\n        </NavigatorContent>\n      )}\n\n      {/*  DROPZONE - JEN kdy m objednvka ID (je uloen) */}\n      {!isMinimized && formData.id && (() => {\n        //  Pout stejnou logiku jako pro sekci Plohy\n        const sectionState = allSectionStates?.prilohy;\n        const isDropzoneDisabled = sectionState ? !sectionState.enabled : isWorkflowCompleted;\n        \n        return (\n        <DropzoneContainer\n          $isDragOver={isDragOver}\n          $isMinimized={isMinimized}\n          $isDisabled={isDropzoneDisabled}\n          onDragEnter={handleDragEnter}\n          onDragLeave={handleDragLeave}\n          onDragOver={handleDragOver}\n          onDrop={handleDrop}\n          onClick={handleDropzoneClick}\n        >\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            multiple\n            style={{ display: 'none' }}\n            onChange={handleFileSelect}\n          />\n          <DropzoneIcon \n            $isDragOver={isDragOver} \n            $isMinimized={isMinimized}\n            $isDisabled={isDropzoneDisabled}\n          >\n            <Upload />\n          </DropzoneIcon>\n          <DropzoneText \n            $isDragOver={isDragOver} \n            $isMinimized={isMinimized}\n            $isDisabled={isDropzoneDisabled}\n          >\n            {isDragOver ? 'Puste soubory zde' : 'Pethnte soubory'}\n          </DropzoneText>\n        </DropzoneContainer>\n        );\n      })()}\n\n      {/*  INFORMAN BANNER - kdy je dropzone vypnut kvli zamen objednvce */}\n      {!isMinimized && formData.id && (() => {\n        const sectionState = allSectionStates?.prilohy;\n        const isDropzoneDisabled = sectionState ? !sectionState.enabled : isWorkflowCompleted;\n        return isDropzoneDisabled && (\n        <div style={{\n          margin: '12px 8px',\n          padding: '16px',\n          background: 'linear-gradient(135deg, rgba(229, 229, 229, 0.95) 0%, rgba(209, 213, 219, 0.95) 100%)',\n          border: '2px solid #9ca3af',\n          borderRadius: '8px',\n          textAlign: 'center',\n          color: '#4b5563',\n          fontSize: '13px',\n          fontWeight: '600',\n          lineHeight: '1.4'\n        }}>\n          <div style={{ marginBottom: '4px' }}> Objednvka zamena</div>\n          <div style={{ fontSize: '11px', fontWeight: '400' }}>\n            Plohy jsou uzamen\n          </div>\n        </div>\n        );\n      })()}\n\n      {/*  ST 3: Sekce \"Plohy k objednvce\" POD dropzone - JEN kdy m objednvka ID */}\n      {!isMinimized && formData.id && (() => {\n        //  Samostatn sekce \"Plohy k objednvce\" (nen v FORM_SECTIONS ani SECTION_DEFINITIONS)\n        const section = {\n          id: 'prilohy',\n          name: 'Plohy k objednvce',\n          icon: faClipboard,\n          color: '#991b1b',\n          bgColor: 'linear-gradient(135deg, rgba(254, 226, 226, 0.95) 0%, rgba(254, 202, 202, 0.95) 100%)',\n          borderColor: '#dc2626'\n        };\n\n        //  Sekce Plohy je disabled, kdy je objednvka zamen (dokonena/zamtnuta/zruena) - CENTRLN ZEN\n        //  DLEIT: Pout allSectionStates pokud je dostupn (pichz z OrderForm25.js s isPrilohyLocked)\n        const sectionState = allSectionStates?.prilohy;\n        const isDisabled = sectionState ? !sectionState.enabled : isWorkflowCompleted;\n        const isActive = isSectionActive ? isSectionActive(section.id) : false;\n        const validationInfo = getSectionValidationInfo(section);\n        \n        //  Zobrazen badge podle stavu\n        const hasErrors = validationInfo.errorCount > 0;\n        const hasMissingFields = !hasErrors && validationInfo.missingCount > 0;\n        const showBadge = hasErrors || hasMissingFields;\n\n        return (\n          <NavigatorContent $isMinimized={isMinimized}>\n            <SectionItem\n              $isDisabled={isDisabled}\n              $isActive={isActive}\n              $color={section.color}\n              $bgColor={section.bgColor}\n              $borderColor={section.borderColor}\n              $isMinimized={isMinimized}\n              onClick={() => handleSectionClick(section)}\n              title={isDisabled ? `${section.name} (zameno - kliknutm zobrazte vyplnn data)` : section.name}\n            >\n              <SectionItemContent $isMinimized={isMinimized}>\n                <SectionIcon $color={section.color} $isDisabled={isDisabled}>\n                  <FontAwesomeIcon icon={section.icon} />\n                </SectionIcon>\n                {!isMinimized && (\n                  <SectionInfo $textColor={isDisabled ? '#64748b' : section.color}>\n                    <SectionName $isDisabled={isDisabled}>\n                      {section.name}\n                      {showBadge && (\n                        <ValidationBadge \n                          $hasErrors={hasErrors}\n                          $hasMissingFields={hasMissingFields}\n                        >\n                          {hasErrors ? validationInfo.errorCount : ''}\n                        </ValidationBadge>\n                      )}\n                    </SectionName>\n                  </SectionInfo>\n                )}\n              </SectionItemContent>\n            </SectionItem>\n          </NavigatorContent>\n        );\n      })()}\n    </NavigatorContainer>\n  );\n\n  // Pouit React Portal pro vykreslen mimo DOM hierarchii rodie\n  return typeof document !== 'undefined'\n    ? ReactDOM.createPortal(navigatorContent, document.body)\n    : navigatorContent;\n};\n\nexport default FloatingNavigator;\n","/**\n *  DATA TRANSFORM HELPERS\n *\n * Centrln msto pro transformace dat mezi Frontend  Backend\n * Specifikace: DATA-FORMAT-CONTRACT.md\n *\n * @author OrderForm25 Team\n * @date 2025-11-01\n */\n\n/**\n *  STEDISKA: Backend  Frontend\n *\n * Normalizuje stediska z BE do FE formtu\n *\n * @param {any} data - Raw data z backendu (me bt array, JSON string, objekty)\n * @returns {string[]} - Array kd stedisek UPPERCASE\n *\n * @example\n * // Backend posl array string (IDELN)\n * normalizeStrediskaFromBackend([\"KLADNO\", \"BENESOV\"])\n * //  [\"KLADNO\", \"BENESOV\"]\n *\n * @example\n * // Backend posl JSON string (DEPRECATED)\n * normalizeStrediskaFromBackend('[\"KLADNO\",\"BENESOV\"]')\n * //  [\"KLADNO\", \"BENESOV\"]\n *\n * @example\n * // Backend posl objekty (DEPRECATED)\n * normalizeStrediskaFromBackend([{kod_stavu: \"KLADNO\", nazev_stavu: \"Kladno\"}])\n * //  [\"KLADNO\"]\n */\nexport function normalizeStrediskaFromBackend(data) {\n  if (!data) return [];\n\n  //  IDELN: U je array string  vrtit UPPERCASE\n  if (Array.isArray(data) && data.every(item => typeof item === 'string')) {\n    return data.map(kod => String(kod).toUpperCase().trim()).filter(Boolean);\n  }\n\n  //  FALLBACK 1: JSON string  parsovat\n  if (typeof data === 'string') {\n    try {\n      const parsed = JSON.parse(data);\n      if (Array.isArray(parsed)) {\n        return parsed.map(item => {\n          if (typeof item === 'string') return item.toUpperCase().trim();\n          if (item?.kod_stavu) return String(item.kod_stavu).toUpperCase().trim();\n          if (item?.kod) return String(item.kod).toUpperCase().trim();\n          return String(item).toUpperCase().trim();\n        }).filter(Boolean);\n      }\n    } catch (e) {\n      console.error(' [normalizeStrediskaFromBackend] Chyba parsovn JSON:', e, 'Data:', data);\n      return [];\n    }\n  }\n\n  //  FALLBACK 2: Array objekt  extrahovat kdy\n  if (Array.isArray(data) && data.some(item => typeof item === 'object' && item !== null)) {\n    return data.map(item => {\n      if (item?.kod_stavu) return String(item.kod_stavu).toUpperCase().trim();\n      if (item?.kod) return String(item.kod).toUpperCase().trim();\n      if (typeof item === 'string') return item.toUpperCase().trim();\n      return String(item).toUpperCase().trim();\n    }).filter(Boolean);\n  }\n\n  console.warn(' [normalizeStrediskaFromBackend] Neznm formt dat:', typeof data, data);\n  return [];\n}\n\n/**\n *  STEDISKA: Frontend  Backend\n *\n * Normalizuje stediska z FE do BE formtu\n *\n * @param {string[]} codes - Array kd stedisek z formData\n * @returns {string[]} - Array kd stedisek UPPERCASE (BE oekv pesn tento formt)\n *\n * @example\n * normalizeStrediskaForBackend([\"kladno\", \"benesov\"])\n * //  [\"KLADNO\", \"BENESOV\"]\n */\nexport function normalizeStrediskaForBackend(codes) {\n  if (!Array.isArray(codes)) return [];\n\n  return codes\n    .map(kod => String(kod).toUpperCase().trim())\n    .filter(Boolean);\n}\n\n/**\n *  FINANCOVN: Backend  Frontend\n *\n * Normalizuje financovn z BE do FE formtu (flat struktura pro formData)\n *\n * @param {any} data - Raw financovani objekt z backendu (me bt objekt nebo JSON string)\n * @returns {object} - Flat objekt pro formData\n *\n * @example\n * // Backend posl objekt (IDELN)\n * normalizeFinancovaniFromBackend({\n *   typ: \"LP\",\n *   lp_kody: [\"LP123\", \"LP456\"]\n * })\n * //  {\n * //   zpusob_financovani: \"LP\",\n * //   lp_kod: [\"LP123\", \"LP456\"],\n * //   cislo_smlouvy: \"\",\n * //   ...\n * // }\n *\n * @example\n * // Backend posl JSON string (FALLBACK)\n * normalizeFinancovaniFromBackend('{\"typ\":\"LP\",\"lp_kody\":[\"LP123\"]}')\n * //  { zpusob_financovani: \"LP\", lp_kod: [\"LP123\"], ... }\n *\n * @example\n * // Backend posl star formt (DEPRECATED)\n * normalizeFinancovaniFromBackend({\n *   kod_stavu: \"LP\",\n *   nazev_stavu: \"Limitovan pslib\",\n *   doplnujici_data: { lp_kod: [\"LP123\"] }\n * })\n * //  { zpusob_financovani: \"LP\", lp_kod: [\"LP123\"], ... }\n */\nexport function normalizeFinancovaniFromBackend(data) {\n  if (!data) {\n    return {};\n  }\n\n  let financing = data;\n\n  //  FALLBACK: JSON string  parsovat\n  if (typeof data === 'string') {\n    try {\n      financing = JSON.parse(data);\n    } catch (e) {\n      console.error(' [normalizeFinancovaniFromBackend] Chyba parsovn JSON:', e, 'Data:', data);\n      return {};\n    }\n  }\n\n  //  FORMT Z DB: {typ, lp_kody?, cislo_smlouvy?, individualni_schvaleni?, pojistna_udalost_cislo?}\n  const result = {\n    zpusob_financovani: financing.typ || financing.kod_stavu || financing.zdroj || ''\n  };\n\n  // LP kdy\n  if (financing.lp_kody) result.lp_kod = financing.lp_kody;\n  else if (financing.lp_kod) result.lp_kod = financing.lp_kod;\n\n  // SMLOUVA pole\n  if (financing.cislo_smlouvy) result.cislo_smlouvy = financing.cislo_smlouvy;\n  if (financing.smlouva_poznamka) result.smlouva_poznamka = financing.smlouva_poznamka;\n\n  // INDIVIDULN pole\n  if (financing.individualni_schvaleni) result.individualni_schvaleni = financing.individualni_schvaleni;\n  if (financing.individualni_poznamka) result.individualni_poznamka = financing.individualni_poznamka;\n\n  // POJISTN UDLOST pole\n  if (financing.pojistna_udalost_cislo) result.pojistna_udalost_cislo = financing.pojistna_udalost_cislo;\n  if (financing.pojistna_udalost_poznamka) result.pojistna_udalost_poznamka = financing.pojistna_udalost_poznamka;\n\n  //  FALLBACK: STAR FORMT s doplnujici_data (pro zptnou kompatibilitu)\n  if (financing.doplnujici_data) {\n    const data = financing.doplnujici_data;\n    if (data.lp_kod && !result.lp_kod) result.lp_kod = data.lp_kod;\n    if (data.lp_kody && !result.lp_kod) result.lp_kod = data.lp_kody;\n    if (data.cislo_smlouvy && !result.cislo_smlouvy) result.cislo_smlouvy = data.cislo_smlouvy;\n    if (data.smlouva_poznamka && !result.smlouva_poznamka) result.smlouva_poznamka = data.smlouva_poznamka;\n    if (data.individualni_schvaleni && !result.individualni_schvaleni) result.individualni_schvaleni = data.individualni_schvaleni;\n    if (data.individualni_poznamka && !result.individualni_poznamka) result.individualni_poznamka = data.individualni_poznamka;\n    if (data.pojistna_udalost_cislo && !result.pojistna_udalost_cislo) result.pojistna_udalost_cislo = data.pojistna_udalost_cislo;\n    if (data.pojistna_udalost_poznamka && !result.pojistna_udalost_poznamka) result.pojistna_udalost_poznamka = data.pojistna_udalost_poznamka;\n  }\n\n  return result;\n}\n\n/**\n *  FINANCOVN: Frontend  Backend\n *\n * Normalizuje financovn z FE do BE formtu (vnoen struktura)\n *\n * @param {object} formData - Frontend form data\n * @param {array} financovaniOptions - Seznam dostupnch zdroj financovn (pro dohledn nzvu)\n * @returns {object|null} - Objekt pro backend API nebo null pokud nen vyplnno\n *\n * @example\n * normalizeFinancovaniForBackend({\n *   zpusob_financovani: \"LP\",\n *   lp_kod: [\"LP123\", \"LP456\"],\n *   cislo_smlouvy: \"\",\n *   ...\n * }, financovaniOptions)\n * //  {\n * //   typ: \"LP\",\n * //   nazev: \"Limitovan pslib\",\n * //   nazev_stavu: \"Limitovan pslib\",\n * //   kod_stavu: \"LP\",\n * //   lp_kody: [\"LP123\", \"LP456\"]\n * // }\n */\nexport function normalizeFinancovaniForBackend(formData, financovaniOptions = []) {\n  if (!formData || !formData.zpusob_financovani) {\n    return null;\n  }\n\n  //  Najt nzev v financovaniOptions pro backend validaci\n  const selectedOption = financovaniOptions.find(opt => \n    opt.kod === formData.zpusob_financovani ||\n    opt.kod_stavu === formData.zpusob_financovani ||\n    opt.value === formData.zpusob_financovani\n  );\n\n  const result = {\n    typ: formData.zpusob_financovani,\n    nazev: selectedOption?.nazev || selectedOption?.nazev_stavu || selectedOption?.label || formData.zpusob_financovani,\n    nazev_stavu: selectedOption?.nazev_stavu || selectedOption?.nazev || selectedOption?.label || formData.zpusob_financovani\n  };\n\n  //  KRITICK: Poslat POUZE pole odpovdajc vybranmu typu!\n  const typ = formData.zpusob_financovani;\n  \n  // LP: poslat POUZE lp_kody\n  if (typ === 'LP') {\n    if (formData.lp_kod && Array.isArray(formData.lp_kod) && formData.lp_kod.length > 0) {\n      // Backend oekv array sel: [3, 5], NE [\"3\", \"5\"]\n      result.lp_kody = formData.lp_kod.map(id => parseInt(id, 10));\n    }\n  }\n  // SMLOUVA: poslat POUZE cislo_smlouvy a smlouva_poznamka\n  else if (typ === 'SMLOUVA') {\n    if (formData.cislo_smlouvy) {\n      result.cislo_smlouvy = formData.cislo_smlouvy;\n    }\n    if (formData.smlouva_poznamka) {\n      result.smlouva_poznamka = formData.smlouva_poznamka;\n    }\n  }\n  // INDIVIDUALNI_SCHVALENI: poslat POUZE individualni_schvaleni a poznamka\n  else if (typ === 'INDIVIDUALNI_SCHVALENI' || typ === 'INDIVIDULN' || typ === 'INDIVIDUALNI') {\n    if (formData.individualni_schvaleni) {\n      result.individualni_schvaleni = formData.individualni_schvaleni;\n    }\n    if (formData.individualni_poznamka) {\n      result.individualni_poznamka = formData.individualni_poznamka;\n    }\n  }\n  // POJISTNA_UDALOST: poslat POUZE pojistna_udalost_cislo a poznamka\n  else if (typ === 'POJISTNA_UDALOST' || typ === 'POJISTN UDLOST' || typ === 'POJISTNA UDALOST') {\n    if (formData.pojistna_udalost_cislo) {\n      result.pojistna_udalost_cislo = formData.pojistna_udalost_cislo;\n    }\n    if (formData.pojistna_udalost_poznamka) {\n      result.pojistna_udalost_poznamka = formData.pojistna_udalost_poznamka;\n    }\n  }\n\n  return result;\n}\n\n/**\n *  FAKTURY STEDISKA: Backend  Frontend\n *\n * Alias pro normalizeStrediskaFromBackend (stejn logika pro fa_strediska_kod)\n *\n * @param {any} data - Raw fa_strediska_kod z backendu\n * @returns {string[]} - Array kd stedisek UPPERCASE\n */\nexport function normalizeFakturaStrediskaFromBackend(data) {\n  return normalizeStrediskaFromBackend(data);\n}\n\n/**\n *  FAKTURY STEDISKA: Frontend  Backend\n *\n * Alias pro normalizeStrediskaForBackend (stejn logika pro fa_strediska_kod)\n *\n * @param {string[]} codes - Array kd stedisek\n * @returns {string[]} - Array kd stedisek UPPERCASE\n */\nexport function normalizeFakturaStrediskaForBackend(codes) {\n  return normalizeStrediskaForBackend(codes);\n}\n\n/**\n *  TEST HELPER: Validuje, zda data odpovdaj oekvanmu formtu\n *\n * @param {any} data - Data k validaci\n * @param {string} type - Typ dat ('strediska' | 'financovani')\n * @returns {boolean} - True pokud data odpovdaj formtu\n */\nexport function validateDataFormat(data, type) {\n  switch (type) {\n    case 'strediska':\n      return Array.isArray(data) && data.every(item => typeof item === 'string');\n\n    case 'financovani':\n      return (\n        data &&\n        typeof data === 'object' &&\n        typeof data.typ === 'string' &&\n        !data.kod_stavu && // Star formt\n        !data.nazev_stavu && // Star formt\n        !data.doplnujici_data // Star formt\n      );\n\n    default:\n      return false;\n  }\n}\n\n/**\n *  DEBUG HELPER: Loguje formt dat pro debugging\n *\n * @param {any} data - Data k analze\n * @param {string} label - Label pro log\n */\nexport function debugDataFormat(data, label = 'Data') {\n  console.log(` [DEBUG] ${label}:`, {\n    type: typeof data,\n    isArray: Array.isArray(data),\n    isString: typeof data === 'string',\n    isObject: typeof data === 'object' && !Array.isArray(data),\n    value: data,\n    keys: typeof data === 'object' ? Object.keys(data) : undefined\n  });\n}\n","/**\n * FormDataManager - Centralizovan manaer pro inicializaci a sprvu dat formule\n *\n * e problmy:\n * - Asynchronn natn selnk\n * - Synchronizaci s React state\n * - Race conditions pi inicializaci\n * - Sprvn poad natn dat\n *\n * @author Robert Holovsk\n * @date 2025-10-28\n */\n\nimport {\n  fetchAllUsers,\n  fetchApprovers,\n  fetchLimitovanePrisliby\n} from './api2auth';\n\nimport {\n  getStrediska25,\n  getFinancovaniZdroj25,\n  getDruhyObjednavky25\n} from './api25orders';\n\n//  NOV: Import V2 API pro natn objednvek\nimport { getOrderV2 } from './apiOrderV2';\n\n//  KRITICK: Import transformanch utilit pro sprvn mapovn dat\nimport {\n  normalizeFinancovaniFromBackend,\n  normalizeStrediskaFromBackend\n} from '../utils/dataTransformHelpers';\n\nclass FormDataManager {\n  constructor() {\n    this.isInitialized = false;\n    this.isInitializing = false;\n    this.initPromise = null;\n\n    // Cache pro naten data\n    this.cache = {\n      users: [],\n      approvers: [],\n      strediska: [],\n      financovani: [],\n      druhyObjednavky: [],\n      lpKody: []\n    };\n\n    // Metadata o stavu\n    this.metadata = {\n      lastInitTime: null,\n      initDuration: null,\n      errors: []\n    };\n\n    // Callbacks pro state update (nastav React komponenta)\n    this.stateCallbacks = {};\n  }\n\n  /**\n   * Registrace callback funkc pro update React state\n   */\n  registerStateCallbacks(callbacks) {\n    this.stateCallbacks = {\n      setAllUsers: callbacks.setAllUsers || (() => {}),\n      setApprovers: callbacks.setApprovers || (() => {}),\n      setStrediskaOptions: callbacks.setStrediskaOptions || (() => {}),\n      setFinancovaniOptions: callbacks.setFinancovaniOptions || (() => {}),\n      setDruhyObjednavkyOptions: callbacks.setDruhyObjednavkyOptions || (() => {}),\n      setLpKodyOptions: callbacks.setLpKodyOptions || (() => {}),\n      setLoadingUsers: callbacks.setLoadingUsers || (() => {}),\n      setLoadingApprovers: callbacks.setLoadingApprovers || (() => {}),\n      setLoadingStrediska: callbacks.setLoadingStrediska || (() => {}),\n      setLoadingFinancovani: callbacks.setLoadingFinancovani || (() => {}),\n      setLoadingDruhyObjednavky: callbacks.setLoadingDruhyObjednavky || (() => {}),\n      setLoadingLpKody: callbacks.setLoadingLpKody || (() => {})\n    };\n  }\n\n  /**\n   * Hlavn inicializan metoda - vol se pouze jednou\n   */\n  async initialize({ token, username, formDataId = null }) {\n    // Pokud u b inicializace, vra stejn Promise\n    if (this.isInitializing) {\n      //  KRITICK: I kdy ekme, musme aktualizovat React state z cache!\n      await this.initPromise;\n      this._updateReactState();\n      return this.cache;\n    }\n\n    // Pokud u je inicializovno, vra cached data\n    if (this.isInitialized) {\n      //  KRITICK: Aktualizuj React state i kdy vracme cache!\n      this._updateReactState();\n      return this.cache;\n    }\n\n    this.isInitializing = true;\n    const startTime = Date.now();\n\n    this.initPromise = this._performInitialization({ token, username, formDataId });\n\n    try {\n      await this.initPromise;\n\n      const duration = Date.now() - startTime;\n      this.metadata.lastInitTime = new Date();\n      this.metadata.initDuration = duration;\n      this.isInitialized = true;\n\n      return this.cache;\n\n    } catch (error) {\n      this.metadata.errors.push({\n        timestamp: new Date(),\n        error: error.message\n      });\n      throw error;\n    } finally {\n      this.isInitializing = false;\n    }\n  }\n\n  /**\n   * Intern metoda pro paraleln naten vech dat\n   */\n  async _performInitialization({ token, username, formDataId }) {\n    const isLoadingFromDB = !!formDataId;\n\n    // Nast vechna data paraleln\n    const [\n      usersResult,\n      approversResult,\n      strediskaResult,\n      financovaniResult,\n      druhyObjednavkyResult,\n      lpKodyResult\n    ] = await Promise.allSettled([\n      this._loadUsers(token, username, isLoadingFromDB),\n      this._loadApprovers(token, username),\n      this._loadStrediska(token, username),\n      this._loadFinancovani(token, username),\n      this._loadDruhyObjednavky(token, username),\n      this._loadLpKody(token, username)\n    ]);\n\n    // Kontrola vsledk\n    const results = {\n      users: this._handleResult(usersResult, 'Uivatel'),\n      approvers: this._handleResult(approversResult, 'Schvalovatel'),\n      strediska: this._handleResult(strediskaResult, 'Stediska'),\n      financovani: this._handleResult(financovaniResult, 'Financovn'),\n      druhyObjednavky: this._handleResult(druhyObjednavkyResult, 'Druhy objednvky'),\n      lpKody: this._handleResult(lpKodyResult, 'LP kdy')\n    };\n\n    // Aktualizuj cache\n    this.cache = {\n      users: results.users.data,\n      approvers: results.approvers.data,\n      strediska: results.strediska.data,\n      financovani: results.financovani.data,\n      druhyObjednavky: results.druhyObjednavky.data,\n      lpKody: results.lpKody.data\n    };\n\n    // Aktualizuj React state synchronn\n    this._updateReactState();\n\n    // Kontrola chyb\n    const errors = Object.entries(results)\n      .filter(([_, result]) => !result.success)\n      .map(([key]) => key);\n\n    if (errors.length > 0) {\n    }\n\n    return this.cache;\n  }\n\n  /**\n   * Naten uivatel\n   */\n  async _loadUsers(token, username, isLoadingFromDB) {\n    this.stateCallbacks.setLoadingUsers?.(true);\n\n    try {\n      const users = await fetchAllUsers({ token, username });\n\n      // Filtrovn podle reimu\n      const filtered = isLoadingFromDB\n        ? users || []\n        : (users || []).filter(user => user.aktivni === 1 || user.aktivni === '1');\n\n      return filtered;\n\n    } catch (error) {\n      return [];\n    } finally {\n      this.stateCallbacks.setLoadingUsers?.(false);\n    }\n  }\n\n  /**\n   * Naten schvalovatel\n   */\n  async _loadApprovers(token, username) {\n    this.stateCallbacks.setLoadingApprovers?.(true);\n\n    try {\n      const approvers = await fetchApprovers({ token, username });\n\n      // Filtrovat aktivn\n      const active = (approvers || []).filter(a => {\n        if (a.aktivni === undefined || a.aktivni === null) return true;\n        return a.aktivni === 1 || a.aktivni === '1';\n      });\n\n      // Zpracovat jmna\n      const processed = active.map(approver => {\n        const titul_pred_str = approver.titul_pred ? approver.titul_pred + ' ' : '';\n        const jmeno_str = approver.jmeno || '';\n        const prijmeni_str = approver.prijmeni || '';\n        const titul_za_str = approver.titul_za ? ', ' + approver.titul_za : '';\n        const displayName = `${titul_pred_str}${jmeno_str} ${prijmeni_str}${titul_za_str}`.replace(/\\s+/g, ' ').trim() || approver.username || `User ${approver.id || approver.user_id}`;\n\n        return {\n          ...approver,\n          displayName,\n          label: displayName,\n          value: approver.id || approver.user_id\n        };\n      });\n\n      return processed;\n\n    } catch (error) {\n      return [];\n    } finally {\n      this.stateCallbacks.setLoadingApprovers?.(false);\n    }\n  }\n\n  /**\n   * Naten stedisek\n   */\n  async _loadStrediska(token, username) {\n    this.stateCallbacks.setLoadingStrediska?.(true);\n\n    try {\n      const strediska = await getStrediska25({ token, username });\n      return strediska || [];\n\n    } catch (error) {\n      return [];\n    } finally {\n      this.stateCallbacks.setLoadingStrediska?.(false);\n    }\n  }\n\n  /**\n   * Naten financovn\n   */\n  async _loadFinancovani(token, username) {\n    this.stateCallbacks.setLoadingFinancovani?.(true);\n\n    try {\n      const financovani = await getFinancovaniZdroj25({ token, username });\n      if (Array.isArray(financovani)) {\n        if (financovani.length > 0) {\n        }\n        return financovani;\n      } else {\n        return [];\n      }\n\n    } catch (error) {\n      return [];\n    } finally {\n      this.stateCallbacks.setLoadingFinancovani?.(false);\n    }\n  }\n\n  /**\n   * Naten druh objednvky\n   */\n  async _loadDruhyObjednavky(token, username) {\n    this.stateCallbacks.setLoadingDruhyObjednavky?.(true);\n\n    try {\n      const response = await getDruhyObjednavky25({ token, username });\n      //  OPRAVA: API nyn vrac pmo pole, ne objekt s options\n      const druhy = Array.isArray(response) ? response : [];\n      if (druhy.length > 0) {\n      }\n\n      return druhy;\n\n    } catch (error) {\n      return [];\n    } finally {\n      this.stateCallbacks.setLoadingDruhyObjednavky?.(false);\n    }\n  }\n\n  /**\n   * Naten LP kd\n   */\n  async _loadLpKody(token, username) {\n    this.stateCallbacks.setLoadingLpKody?.(true);\n\n    try {\n      const lpKody = await fetchLimitovanePrisliby({ token, username });\n      return lpKody || [];\n\n    } catch (error) {\n      return [];\n    } finally {\n      this.stateCallbacks.setLoadingLpKody?.(false);\n    }\n  }\n\n  /**\n   * Helper pro zpracovn Promise.allSettled vsledk\n   */\n  _handleResult(result, name) {\n    if (result.status === 'fulfilled' && result.value !== undefined && result.value !== null) {\n      return {\n        success: true,\n        data: result.value\n      };\n    } else {\n      return {\n        success: false,\n        data: []\n      };\n    }\n  }\n\n  /**\n   * Aktualizace React state - vol registrovan callbacks\n   *  OPTIMALIZACE: Vol setState JEN kdy se data skuten zmnila\n   */\n  _updateReactState() {\n    // Kontrola jestli se data zmnila ped volnm setState\n    if (this._hasDataChanged('users', this.cache.users)) {\n      this.stateCallbacks.setAllUsers?.(this.cache.users);\n    }\n    if (this._hasDataChanged('approvers', this.cache.approvers)) {\n      this.stateCallbacks.setApprovers?.(this.cache.approvers);\n    }\n    if (this._hasDataChanged('strediska', this.cache.strediska)) {\n      this.stateCallbacks.setStrediskaOptions?.(this.cache.strediska);\n    }\n    if (this._hasDataChanged('financovani', this.cache.financovani)) {\n      this.stateCallbacks.setFinancovaniOptions?.(this.cache.financovani);\n    }\n    if (this._hasDataChanged('druhyObjednavky', this.cache.druhyObjednavky)) {\n      this.stateCallbacks.setDruhyObjednavkyOptions?.(this.cache.druhyObjednavky);\n    }\n    if (this._hasDataChanged('lpKody', this.cache.lpKody)) {\n      this.stateCallbacks.setLpKodyOptions?.(this.cache.lpKody);\n    }\n  }\n\n  /**\n   * Pomocn metoda: Kontrola jestli se data zmnila\n   */\n  _hasDataChanged(key, newData) {\n    const prevKey = `_prev_${key}`;\n    const prevData = this[prevKey];\n\n    // Prvn voln - vdy true\n    if (!prevData) {\n      this[prevKey] = newData;\n      return true;\n    }\n\n    // Porovnn dlky pole\n    if (prevData.length !== newData.length) {\n      this[prevKey] = newData;\n      return true;\n    }\n\n    // Data se nezmnila\n    return false;\n  }\n\n  /**\n   * Naten objednvky\n   *  NOV: Pouv Order V2 API s enriched daty\n   */\n  async loadOrder({ token, username, orderId, archivovano = 0 }) {\n\n    try {\n\n      //  NOV: Pouvme V2 API s enriched daty\n      const order = await getOrderV2(orderId, token, username, true); // enriched = true\n\n\n      if (!order) {\n        throw new Error(`Objednvka ID ${orderId} nebyla nalezena`);\n      }\n\n      //  DEBUG: RAW DATA Z BACKENDU\n\n      //  KRITICK OPRAVA: Transformuj financovn z BE do FE formtu\n      if (order.financovani) {\n        const financing = normalizeFinancovaniFromBackend(order.financovani);\n        // Rozbal flat strukturu do order objektu\n        Object.assign(order, financing);\n      }\n\n      //  KRITICK OPRAVA: Transformuj stediska z BE do FE formtu\n      if (order.strediska_kod) {\n        order.strediska_kod = normalizeStrediskaFromBackend(order.strediska_kod);\n      }\n\n      return order;\n\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  /**\n   * Reset manageru (pro testing)\n   */\n  reset() {\n    this.isInitialized = false;\n    this.isInitializing = false;\n    this.initPromise = null;\n    this.cache = {\n      users: [],\n      approvers: [],\n      strediska: [],\n      financovani: [],\n      druhyObjednavky: [],\n      lpKody: []\n    };\n    this.metadata = {\n      lastInitTime: null,\n      initDuration: null,\n      errors: []\n    };\n  }\n\n  /**\n   * Zskn aktulnho stavu\n   */\n  getState() {\n    return {\n      isInitialized: this.isInitialized,\n      isInitializing: this.isInitializing,\n      cache: { ...this.cache },\n      metadata: { ...this.metadata }\n    };\n  }\n}\n\n// Singleton instance\nconst formDataManager = new FormDataManager();\n\nexport default formDataManager;\n","import { useRef, useCallback, useEffect } from 'react';\n\n/**\n * Centralizovan hook pro autosave s debounce logikou\n *\n * @param {Function} saveFunction - Funkce kter se zavol pro uloen\n * @param {Object} options - Konfigurace\n * @param {number} options.delay - Zpodn v ms ped uloenm (default: 3000)\n * @param {boolean} options.enabled - Zda je autosave povoleno (default: true)\n * @param {Array} options.dependencies - Zvislosti pro useCallback\n *\n * @returns {Object} - { triggerAutosave, cancelAutosave, isScheduled }\n */\nexport const useAutosave = (saveFunction, options = {}) => {\n  const {\n    delay = 3000,\n    enabled = true,\n    dependencies = []\n  } = options;\n\n  const timeoutRef = useRef(null);\n  const isScheduledRef = useRef(false);\n  const lastSaveTimeRef = useRef(0);\n  const MIN_INTERVAL = 1000; // Minimln interval mezi uloenmi (1s)\n\n  /**\n   * Zru naplnovan autosave\n   */\n  const cancelAutosave = useCallback(() => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n      timeoutRef.current = null;\n      isScheduledRef.current = false;\n    }\n  }, []);\n\n  /**\n   * Spust autosave s debounce\n   * @param {boolean} immediate - Pokud true, ulo okamit (pro selecty)\n   */\n  const triggerAutosave = useCallback((immediate = false) => {\n    if (!enabled) {\n      return;\n    }\n\n    // Zru pedchoz timeout\n    cancelAutosave();\n\n    const now = Date.now();\n    const timeSinceLastSave = now - lastSaveTimeRef.current;\n\n    // Pokud je immediate a od poslednho uloen uplynula minimln doba\n    if (immediate && timeSinceLastSave >= MIN_INTERVAL) {\n      lastSaveTimeRef.current = now;\n      saveFunction(true); // true = isAutoSave\n      return;\n    }\n\n    // Jinak nastav debounce timeout\n    isScheduledRef.current = true;\n    timeoutRef.current = setTimeout(() => {\n      const currentTime = Date.now();\n      const elapsed = currentTime - lastSaveTimeRef.current;\n\n      // Pouze pokud uplynula minimln doba\n      if (elapsed >= MIN_INTERVAL) {\n        lastSaveTimeRef.current = currentTime;\n        saveFunction(true); // true = isAutoSave\n      }\n\n      isScheduledRef.current = false;\n      timeoutRef.current = null;\n    }, immediate ? 0 : delay);\n  }, [enabled, delay, saveFunction, cancelAutosave, ...dependencies]);\n\n  /**\n   * Vyist timeout pi unmount\n   */\n  useEffect(() => {\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, []);\n\n  return {\n    triggerAutosave,\n    cancelAutosave,\n    isScheduled: () => isScheduledRef.current\n  };\n};\n\n/**\n * Hook pro input pole s automatickm debouncem\n * Vrac handleChange a handleBlur funkce\n *\n * @param {Function} onChange - Pvodn onChange handler\n * @param {Function} triggerAutosave - Funkce pro sputn autosave\n * @param {Object} options - Konfigurace\n * @param {boolean} options.saveOnBlur - Ukldat pi oputn pole (default: true)\n * @param {boolean} options.isSelectField - Je to select/checkbox? (default: false)\n *\n * @returns {Object} - { handleChange, handleBlur }\n */\nexport const useAutosaveField = (onChange, triggerAutosave, options = {}) => {\n  const {\n    saveOnBlur = true,\n    isSelectField = false\n  } = options;\n\n  const handleChange = useCallback((fieldOrEvent, value) => {\n    // Zavolej pvodn onChange\n    if (typeof fieldOrEvent === 'string') {\n      // handleInputChange(field, value)\n      onChange(fieldOrEvent, value);\n    } else {\n      // handleChange(event)\n      onChange(fieldOrEvent);\n    }\n\n    // Pro select/checkbox ulo okamit (s debouncem), pro text ekej na blur\n    if (isSelectField) {\n      triggerAutosave(true); // immediate = true\n    } else {\n      // Pro textov pole zatm nic - ekme na blur\n    }\n  }, [onChange, triggerAutosave, isSelectField]);\n\n  const handleBlur = useCallback((fieldName, value) => {\n    // Spus autosave pi oputn pole (pouze pro textov pole)\n    if (saveOnBlur && !isSelectField) {\n      triggerAutosave(false); // s debouncem\n    }\n  }, [triggerAutosave, saveOnBlur, isSelectField]);\n\n  return {\n    handleChange,\n    handleBlur\n  };\n};\n\nexport default useAutosave;\n","import axios from 'axios';\n\nconst api = axios.create({\n  baseURL: process.env.REACT_APP_API2_BASE_URL || '/api.eeo',\n  headers: { 'Content-Type': 'application/json' }\n});\n\n/**\n * Notifikan service pro komunikaci s backend API\n *\n * Backend commit: 3a28a99 - FEATURE: Rozsireni notifikacniho systemu\n * Automaticky napluje 50+ placeholder z order_id\n */\nclass NotificationService {\n\n  /**\n   * Vytvo notifikaci s automatickm naplnnm placeholder z objednvky\n   *\n   * @param {Object} params\n   * @param {string} params.token - User token\n   * @param {string} params.username - Username\n   * @param {string} params.type - Typ notifikace (z NOTIFICATION_TYPES)\n   * @param {number} params.order_id - ID objednvky (automaticky napln placeholdery)\n   * @param {number} params.action_user_id - ID uivatele, kter provedl akci\n   * @param {number} [params.to_user_id] - ID pjemce (nebo pouij to_users)\n   * @param {number[]} [params.to_users] - Pole ID pjemc\n   * @param {Object} [params.additional_data] - Dodaten data (rejection_reason, atd.)\n   * @param {string} [params.priority] - Pepe default prioritu (urgent/high/normal/low)\n   * @param {boolean} [params.send_email] - Pepe default email nastaven\n   * @param {Object} [params.template_override] - Pepe sti templatu\n   * @returns {Promise<Object>} Response s notification_id a recipients_count\n   */\n  async create({\n    token,\n    username,\n    type,\n    order_id,\n    action_user_id,\n    to_user_id,\n    to_users,\n    additional_data = {},\n    priority,\n    send_email,\n    template_override\n  }) {\n    try {\n      const payload = {\n        token,\n        username,\n        type,\n        order_id,\n        action_user_id\n      };\n\n      // Pjemci\n      if (to_user_id) payload.to_user_id = to_user_id;\n      if (to_users) payload.to_users = to_users;\n\n      // Voliteln parametry\n      if (Object.keys(additional_data).length > 0) {\n        payload.additional_data = additional_data;\n      }\n      if (priority) payload.priority = priority;\n      if (send_email !== undefined) payload.send_email = send_email;\n      if (template_override) payload.template_override = template_override;\n\n      const response = await api.post('/notifications/create', payload);\n\n\n      return response;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  /**\n   * Nhled notifikace PED odeslnm (pro testovn)\n   *\n   * @param {Object} params\n   * @param {string} params.token - User token\n   * @param {string} params.username - Username\n   * @param {string} params.type - Typ notifikace\n   * @param {number} params.order_id - ID objednvky\n   * @param {number} params.action_user_id - ID uivatele\n   * @param {Object} [params.additional_data] - Dodaten data\n   * @returns {Promise<Object>} Preview s naplnnmi placeholdery\n   */\n  async preview({\n    token,\n    username,\n    type,\n    order_id,\n    action_user_id,\n    additional_data = {}\n  }) {\n    try {\n      const response = await api.post('/notifications/preview', {\n        token,\n        username,\n        type,\n        order_id,\n        action_user_id,\n        additional_data\n      });\n\n      return response;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  /**\n   * Seznam vech dostupnch notification templates (pro admin)\n   *\n   * @param {Object} params\n   * @param {string} params.token - User token\n   * @param {string} params.username - Username\n   * @param {boolean} [params.active_only=true] - Jen aktivn templates\n   * @returns {Promise<Array>} Seznam templates\n   */\n  async getTemplates({\n    token,\n    username,\n    active_only = true\n  }) {\n    try {\n      const response = await api.post('/notifications/templates', {\n        token,\n        username,\n        active_only\n      });\n\n      return response.data || [];\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  /**\n   * Hromadn odesln notifikace vce uivatelm\n   *\n   * @param {Object} params\n   * @param {string} params.token - User token\n   * @param {string} params.username - Username\n   * @param {string} params.type - Typ notifikace\n   * @param {number} params.order_id - ID objednvky\n   * @param {number} params.action_user_id - ID uivatele\n   * @param {number[]} params.recipients - Pole ID pjemc\n   * @param {Object} [params.additional_data] - Dodaten data\n   * @returns {Promise<Object>} Response s notification_id a recipients_count\n   */\n  async sendBulk({\n    token,\n    username,\n    type,\n    order_id,\n    action_user_id,\n    recipients,\n    additional_data = {}\n  }) {\n    try {\n      const response = await api.post('/notifications/send-bulk', {\n        token,\n        username,\n        type,\n        order_id,\n        action_user_id,\n        recipients,\n        additional_data\n      });\n\n\n      return response;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // =====================================================================\n  // HELPER FUNKCE PRO WORKFLOW - READY TO USE\n  // =====================================================================\n\n  /**\n   * Odeslat notifikaci pi schvlen objednvky\n   */\n  async notifyOrderApproved({\n    token,\n    username,\n    order_id,\n    action_user_id,\n    creator_id\n  }) {\n    return this.create({\n      token,\n      username,\n      type: 'order_status_schvalena',\n      order_id,\n      action_user_id,\n      to_user_id: creator_id,\n      send_email: true\n    });\n  }\n\n  /**\n   * Odeslat notifikaci pi zamtnut objednvky\n   */\n  async notifyOrderRejected({\n    token,\n    username,\n    order_id,\n    action_user_id,\n    creator_id,\n    rejection_reason\n  }) {\n    return this.create({\n      token,\n      username,\n      type: 'order_status_zamitnuta',\n      order_id,\n      action_user_id,\n      to_user_id: creator_id,\n      additional_data: {\n        rejection_reason: rejection_reason || 'Bez uveden dvodu'\n      },\n      send_email: true,\n      priority: 'high'\n    });\n  }\n\n  /**\n   * Odeslat notifikaci pi odesln ke schvlen\n   */\n  async notifyPendingApproval({\n    token,\n    username,\n    order_id,\n    action_user_id,\n    garant_id\n  }) {\n    return this.create({\n      token,\n      username,\n      type: 'order_status_ke_schvaleni',\n      order_id,\n      action_user_id,\n      to_user_id: garant_id,\n      send_email: true,\n      priority: 'high'\n    });\n  }\n\n  /**\n   * Odeslat notifikaci pi vrcen k pepracovn\n   */\n  async notifyWaitingForChanges({\n    token,\n    username,\n    order_id,\n    action_user_id,\n    creator_id,\n    waiting_reason\n  }) {\n    return this.create({\n      token,\n      username,\n      type: 'order_status_ceka_se',\n      order_id,\n      action_user_id,\n      to_user_id: creator_id,\n      additional_data: {\n        waiting_reason: waiting_reason || 'Poadovno doplnn daj'\n      },\n      send_email: true,\n      priority: 'normal'\n    });\n  }\n\n  /**\n   * Odeslat notifikaci pi odesln dodavateli\n   */\n  async notifySentToSupplier({\n    token,\n    username,\n    order_id,\n    action_user_id,\n    recipients  // creator, garant\n  }) {\n    return this.sendBulk({\n      token,\n      username,\n      type: 'order_status_odeslana',\n      order_id,\n      action_user_id,\n      recipients,\n      send_email: true\n    });\n  }\n\n  /**\n   * Odeslat notifikaci pi potvrzen dodavatelem\n   */\n  async notifyConfirmedBySupplier({\n    token,\n    username,\n    order_id,\n    action_user_id,\n    recipients  // creator, garant\n  }) {\n    return this.sendBulk({\n      token,\n      username,\n      type: 'order_status_potvrzena',\n      order_id,\n      action_user_id,\n      recipients,\n      send_email: true\n    });\n  }\n\n  /**\n   * Odeslat notifikaci pi zveejnn v registru smluv (NOV FZE)\n   */\n  async notifyRegistryPublished({\n    token,\n    username,\n    order_id,\n    action_user_id,\n    recipients  // creator, garant, pkazce\n  }) {\n    return this.sendBulk({\n      token,\n      username,\n      type: 'order_status_registr_zverejnena',\n      order_id,\n      action_user_id,\n      recipients,\n      send_email: true\n    });\n  }\n\n  /**\n   * Odeslat notifikaci pi pidn faktury (NOV FZE)\n   */\n  async notifyInvoiceAdded({\n    token,\n    username,\n    order_id,\n    action_user_id,\n    garant_id\n  }) {\n    return this.create({\n      token,\n      username,\n      type: 'order_status_faktura_pridana',\n      order_id,\n      action_user_id,\n      to_user_id: garant_id,\n      send_email: true\n    });\n  }\n\n  /**\n   * Odeslat notifikaci pi schvlen faktury (NOV FZE)\n   */\n  async notifyInvoiceApproved({\n    token,\n    username,\n    order_id,\n    action_user_id,\n    creator_id\n  }) {\n    return this.create({\n      token,\n      username,\n      type: 'order_status_faktura_schvalena',\n      order_id,\n      action_user_id,\n      to_user_id: creator_id,\n      send_email: true\n    });\n  }\n\n  /**\n   * Odeslat notifikaci pi uhrazen faktury (NOV FZE)\n   */\n  async notifyInvoicePaid({\n    token,\n    username,\n    order_id,\n    action_user_id,\n    recipients  // creator, garant\n  }) {\n    return this.sendBulk({\n      token,\n      username,\n      type: 'order_status_faktura_uhrazena',\n      order_id,\n      action_user_id,\n      recipients,\n      send_email: true\n    });\n  }\n\n  /**\n   * Odeslat notifikaci pi potvrzen vcn sprvnosti (NOV FZE)\n   */\n  async notifyVecnaSpravnostConfirmed({\n    token,\n    username,\n    order_id,\n    action_user_id,\n    recipients  // garant, pkazce\n  }) {\n    return this.sendBulk({\n      token,\n      username,\n      type: 'order_status_kontrola_potvrzena',\n      order_id,\n      action_user_id,\n      recipients,\n      send_email: true\n    });\n  }\n\n  /**\n   * Odeslat notifikaci pi zamtnut vcn sprvnosti - reklamace (NOV FZE)\n   */\n  async notifyVecnaSpravnostRejected({\n    token,\n    username,\n    order_id,\n    action_user_id,\n    recipients,  // creator, garant, pkazce\n    rejection_reason\n  }) {\n    return this.sendBulk({\n      token,\n      username,\n      type: 'order_status_kontrola_zamitnuta',\n      order_id,\n      action_user_id,\n      recipients,\n      additional_data: {\n        rejection_reason: rejection_reason || 'Vadn plnn - nutn reklamace'\n      },\n      send_email: true,\n      priority: 'high'\n    });\n  }\n\n  /**\n   * Odeslat DUAL-TEMPLATE notifikace pi odesln ke schvlen\n   * \n   * @param {Object} params\n   * @param {string} params.token - User token\n   * @param {string} params.username - Username\n   * @param {Object} params.orderData - Data objednvky z OrderForm25\n   * @returns {Promise<Object>} Response s potem odeslanch email\n   */\n  async sendOrderApprovalNotifications({\n    token,\n    username,\n    orderData\n  }) {\n    try {\n      // Sestavit FROM (SUBMITTER - zelen ablona) a TO (APPROVER - erven ablona)\n      const fromSet = new Set();\n      const toSet = new Set();\n      \n      // TO = APPROVER: pkazce (erven ablona ke schvlen)\n      if (orderData.prikazce_id) {\n        toSet.add(orderData.prikazce_id);\n      }\n      \n      // FROM = SUBMITTER: garant, vytvoil, objednatel (zelen informan ablona)\n      if (orderData.garant_id && orderData.garant_id !== orderData.prikazce_id) {\n        fromSet.add(orderData.garant_id);\n      }\n      if (orderData.vytvoril && orderData.vytvoril !== orderData.prikazce_id) {\n        fromSet.add(orderData.vytvoril);\n      }\n      if (orderData.objednatel_id && orderData.objednatel_id !== orderData.prikazce_id) {\n        fromSet.add(orderData.objednatel_id);\n      }\n\n      const from = Array.from(fromSet);\n      const to = Array.from(toSet);\n\n      if (from.length === 0 && to.length === 0) {\n        console.warn('sendOrderApprovalNotifications: dn pjemci k odesln');\n        return { status: 'warning', message: 'No recipients', sent: 0 };\n      }\n\n      // Formtovat data pro API (nov formt s from/to + stediska + financovn JSON)\n      const payload = {\n        token,\n        username,\n        order_id: orderData.id,\n        order_number: orderData.ev_cislo,\n        order_subject: orderData.predmet,\n        commander_id: orderData.prikazce_id,\n        garant_id: orderData.garant_id,\n        creator_id: orderData.vytvoril,\n        supplier_name: orderData.dodavatel_nazev || 'Neuvedeno',\n        //  FINANCOVN - cel JSON objekt (backend ho parsuje)\n        financovani_json: orderData.financovani_json || '{}',\n        strediska_names: orderData.strediska_nazvy || [],          // Array nzv stedisek (u pevedeno ve FE)\n        max_price: orderData.max_price_with_dph ? `${orderData.max_price_with_dph.toLocaleString('cs-CZ')} K` : 'Neuvedeno',\n        is_urgent: orderData.is_urgent || false,                   //  Mimodn udlost (erven vs oranov)\n        from,  // SUBMITTER recipients (zelen ablona)\n        to     // APPROVER recipients (erven/oranov ablona)\n      };\n      \n      console.log('Dual notification payload:', { fromCount: from.length, toCount: to.length, strediska: payload.strediska_names.length, urgent: payload.is_urgent });\n\n      // Volat backend API pro dual-template odesln\n      const response = await api.post('/notifications/send-dual', payload);\n\n      console.log('sendOrderApprovalNotifications SUCCESS:', response);\n      return response;\n\n    } catch (error) {\n      // Non-blocking error - logovat ale neperuovat workflow\n      console.error('sendOrderApprovalNotifications ERROR:', error);\n      return { \n        status: 'error', \n        message: error.message || 'Failed to send notifications',\n        sent: 0 \n      };\n    }\n  }\n}\n\n// Singleton instance\nconst notificationService = new NotificationService();\n\nexport default notificationService;\n\n// Export pro explicitn importy\nexport {\n  NotificationService,\n  notificationService\n};\n","// Workflow constants for Order Management System 2025\n// Centralizovan definice stav a pechod pro objednvky\n\nexport const WORKFLOW_STATES = {\n  NOVA: {\n    code: 'NOVA',\n    name: 'Nov',\n    description: 'Objednvka je v pprav, viditeln pouze pro autora',\n    color: '#94a3b8',\n    icon: '',\n    phase: 'draft'\n  },\n  ODESLANA_KE_SCHVALENI: {\n    code: 'ODESLANA_KE_SCHVALENI',\n    name: 'Ke schvlen',\n    description: 'Objednvka byla odeslna a ek na akci schvalovatele',\n    color: '#f59e0b',\n    icon: '',\n    phase: 'approval'\n  },\n  SCHVALENA: {\n    code: 'SCHVALENA',\n    name: 'Schvlen',\n    description: 'Objednvka byla schvlena pslunm manaerem',\n    color: '#10b981',\n    icon: '',\n    phase: 'approved'\n  },\n  ZAMITNUTA: {\n    code: 'ZAMITNUTA',\n    name: 'Zamtnuta',\n    description: 'Objednvka byla schvalovatelem zamtnuta',\n    color: '#ef4444',\n    icon: '',\n    phase: 'rejected'\n  },\n  CEKA_POTVRZENI: {\n    code: 'CEKA_POTVRZENI',\n    name: 'ek na potvrzen',\n    description: 'Objednvka byla odeslna, ek na potvrzen dodavatele',\n    color: '#3b82f6',\n    icon: '',\n    phase: 'supplier_pending'\n  },\n  POTVRZENA: {\n    code: 'POTVRZENA',\n    name: 'Potvrzen dodavatelem',\n    description: 'Dodavatel potvrdil pijet a akceptaci objednvky',\n    color: '#059669',\n    icon: '',\n    phase: 'supplier_confirmed'\n  },\n  DOKONCENA: {\n    code: 'DOKONCENA',\n    name: 'Dokonen',\n    description: 'Zbo/sluba bylo dodno, proces je uzaven',\n    color: '#6b7280',\n    icon: '',\n    phase: 'completed'\n  },\n  ZRUSENA: {\n    code: 'ZRUSENA',\n    name: 'Zruena',\n    description: 'Objednvka byla stornovna ped dokonenm',\n    color: '#9ca3af',\n    icon: '',\n    phase: 'cancelled'\n  },\n  ROZPRACOVANA: {\n    code: 'ROZPRACOVANA',\n    name: 'Rozpracovan',\n    description: 'Schvlen objednvka je v procesu zpracovn',\n    color: '#8b5cf6',\n    icon: '',\n    phase: 'in_progress'\n  }\n};\n\n// Povolen pechody mezi stavy\nexport const WORKFLOW_TRANSITIONS = {\n  NOVA: ['ODESLANA_KE_SCHVALENI', 'ZRUSENA'],\n  ODESLANA_KE_SCHVALENI: ['SCHVALENA', 'ZAMITNUTA', 'NOVA'], // vrcen k prav\n  SCHVALENA: ['CEKA_POTVRZENI', 'DOKONCENA', 'ZRUSENA', 'ROZPRACOVANA'],\n  ZAMITNUTA: ['NOVA', 'ZRUSENA'], // monost opravy\n  CEKA_POTVRZENI: ['POTVRZENA', 'ZRUSENA'],\n  POTVRZENA: ['DOKONCENA', 'ZRUSENA'],\n  ROZPRACOVANA: ['CEKA_POTVRZENI', 'DOKONCENA', 'ZRUSENA'],\n  DOKONCENA: [], // finln stav\n  ZRUSENA: [] // finln stav\n};\n\n// Fze workflow pro UI logiku\nexport const WORKFLOW_PHASES = {\n  DRAFT: 'draft',           // NOVA\n  APPROVAL: 'approval',     // ODESLANA_KE_SCHVALENI\n  APPROVED: 'approved',     // SCHVALENA\n  REJECTED: 'rejected',     // ZAMITNUTA\n  SUPPLIER_PENDING: 'supplier_pending',   // CEKA_POTVRZENI\n  SUPPLIER_CONFIRMED: 'supplier_confirmed', // POTVRZENA\n  IN_PROGRESS: 'in_progress',  // ROZPRACOVANA\n  COMPLETED: 'completed',   // DOKONCENA\n  CANCELLED: 'cancelled'    // ZRUSENA\n};\n\n// Mapovn stav na fze\nexport const getWorkflowPhase = (stateCode) => {\n  const state = WORKFLOW_STATES[stateCode];\n  return state ? state.phase : 'draft';\n};\n\n// Kontrola povolench pechod\nexport const canTransitionTo = (fromState, toState) => {\n  const allowedTransitions = WORKFLOW_TRANSITIONS[fromState] || [];\n  return allowedTransitions.includes(toState);\n};\n\n// Validace povinnch pol podle stavu workflow\nexport const getRequiredFields = (workflowCode) => {\n  //  Financovn je povinn ve vech fzch od zatku\n  //  OPRAVA: prikazce_id a garant_uzivatel_id jsou povinn u v NOVA fzi (formul je oznauje jako required)\n  const baseFields = ['predmet', 'max_cena_s_dph', 'strediska_kod', 'zpusob_financovani', 'prikazce_id', 'garant_uzivatel_id'];\n\n  switch (workflowCode) {\n    case 'NOVA':\n      return baseFields;\n\n    case 'ODESLANA_KE_SCHVALENI':\n      return [\n        ...baseFields,\n        'garant_uzivatel_id',\n        'prikazce_id',\n        'jmeno',\n        'email'\n      ];\n\n    case 'SCHVALENA':\n      return [\n        ...baseFields,\n        'garant_uzivatel_id',\n        'prikazce_id',\n        'jmeno',\n        'email',\n        'schvalovatel_id',\n        'dt_schvaleni',\n        // Fze 3 - Povinn pole pro dodavatele\n        'dodavatel_nazev',\n        'dodavatel_adresa', // v DB je dodavatel_adresa, ne dodavatel_sidlo\n        'dodavatel_ico',\n        // dodavatel_dic nen povinn\n        // dodavatel_zastoupeny nen povinn\n        // kontaktn adresa nen povinn (dodavatel_kontakt_*)\n        'druh_objednavky_kod', // v DB je druh_objednavky_kod\n        'polozky_objednavky' // min. 1 poloka s povinnmi poli\n      ];\n\n    case 'CEKA_POTVRZENI':\n      return [\n        ...baseFields,\n        'garant_uzivatel_id',\n        'prikazce_id',\n        'jmeno',\n        'email',\n        'dodavatel_nazev',\n        'dodavatel_kontakt'\n      ];\n\n    default:\n      return baseFields;\n  }\n};\n\n// Sekce formule viditeln podle stavu workflow\nexport const getVisibleSections = (workflowCode) => {\n  const baseSections = ['objednatel', 'schvaleni'];\n\n  switch (workflowCode) {\n    case 'NOVA':\n      return baseSections;\n\n    case 'ODESLANA_KE_SCHVALENI':\n      return baseSections;\n\n    case 'SCHVALENA':\n    case 'CEKA_POTVRZENI':\n    case 'POTVRZENA':\n    case 'DOKONCENA':\n      return [\n        ...baseSections,\n        'financovani',\n        'dodavatel',\n        'kontakt',\n        'detaily',\n        'dodaci_podminky',\n        'stav_odeslani'\n      ];\n\n    case 'ZAMITNUTA':\n      return baseSections;\n\n    case 'ZRUSENA':\n      return [...baseSections, 'stav_odeslani'];\n\n    default:\n      return baseSections;\n  }\n};\n\n// Helper funkce pro zskn informac o stavu\nexport const getWorkflowInfo = (stateCode) => {\n  return WORKFLOW_STATES[stateCode] || WORKFLOW_STATES.NOVA;\n};\n\n// Export vech stav jako pole pro selecty\nexport const WORKFLOW_STATES_ARRAY = Object.values(WORKFLOW_STATES);","\n// Utility functions for workflow management in OrderForm25\nimport {\n  WORKFLOW_STATES,\n  WORKFLOW_PHASES,\n  getWorkflowPhase,\n  canTransitionTo,\n  getRequiredFields,\n  getVisibleSections,\n  getWorkflowInfo\n} from '../constants/workflow25';\n\n// Mapa pro peklad systmovch nzv pol na lidsky iteln labely\nconst FIELD_LABELS = {\n  predmet: 'Pedmt objednvky',\n  garant_uzivatel_id: 'Garant',\n  prikazce_id: 'Pkazce',\n  max_cena_s_dph: 'Maximln cena s DPH',\n  strediska_kod: 'Stedisko',\n  jmeno: 'Jmno objednatele',\n  email: 'E-mail objednatele',\n  dodavatel_nazev: 'Nzev dodavatele',\n  dodavatel_adresa: 'Adresa dodavatele',\n  dodavatel_ico: 'IO dodavatele',\n  dodavatel_kontakt: 'Kontakt na dodavatele',\n  druh_objednavky_kod: 'Druh objednvky',\n  polozky_objednavky: 'Poloky objednvky',\n  zpusob_financovani: 'Zpsob financovn',\n  lp_kod: 'LP kd',\n  cislo_smlouvy: 'slo smlouvy',\n  smlouva_poznamka: 'Poznmka ke smlouv',\n  individualni_schvaleni: 'Identifiktor schvlen',\n  individualni_poznamka: 'Poznmka k schvlen',\n  pojistna_udalost_cislo: 'slo pojistn udlosti',\n  pojistna_udalost_poznamka: 'Poznmka k pojistn udlosti',\n  datum_odeslani: 'Datum odesln',\n  schvaleni_komentar: 'Koment',\n  odeslani_storno_duvod: 'Dvod stornovn',\n  dodavatel_zpusob_potvrzeni: 'Zpsob potvrzen',\n  zpusob_platby: 'Zpsob platby',\n  dt_akceptace: 'Datum akceptace',\n  dt_zverejneni: 'Datum zveejnn (VZ)',\n  registr_iddt: 'Identifiktor IDDT',\n  ma_byt_zverejnena: 'Zveejnn'\n};\n\n/**\n * Validates form data based on current workflow state\n * @param {Object} formData - Current form data\n * @param {string} workflowCode - Current workflow state code\n * @param {Object} sectionStates - Optional object with section visibility and lock states\n *   e.g. { phase1: { visible: true, locked: false }, phase3: { visible: true, locked: true } }\n * @returns {Object} - Validation errors object\n */\nexport const validateWorkflowData = (formData, workflowCode = 'NOVA', sectionStates = null) => {\n  const errors = {};\n  const requiredFields = getRequiredFields(workflowCode);\n\n  // Helper: Ur, zda validovat pole podle fze/sekce\n  const shouldValidateField = (fieldPhase, fieldName) => {\n    if (!sectionStates || !fieldPhase) return true; // Pokud nemme info o sekcch, validuj vdy\n\n    const sectionState = sectionStates[fieldPhase];\n    if (!sectionState) return true; // Pokud sekce nen definovna, validuj\n\n    //  VJIMKY: Tato pole se VDY validuj i kdy je sekce zamen\n    // Dvod: Jsou to KRITICK pole kter mus bt vyplnn pro uloen objednvky\n    const alwaysValidateFields = [\n      'dodavatel_nazev', 'dodavatel_adresa', 'dodavatel_ico', 'dodavatel_kontakt', // Dodavatel\n      'prikazce_id', 'max_cena_s_dph', 'garant_uzivatel_id', 'predmet', 'strediska_kod' // Schvlen PO - FZE 1\n    ];\n    if (alwaysValidateFields.includes(fieldName)) {\n      const shouldValidate = sectionState.visible;\n      return shouldValidate; // Validuj pokud je sekce viditeln (ignoruj locked)\n    }\n\n    // VALIDOVAT: Sekce je viditeln A odemen\n    // NEVALIDOVAT: Sekce nen viditeln NEBO je zamen\n    const shouldValidate = sectionState.visible && !sectionState.locked;\n    return shouldValidate;\n  };\n\n  // Mapa pole  fze/sekce (pro kontrolu viditelnosti a zamen)\n  const FIELD_TO_PHASE = {\n    // Fze 1: Zkladn daje\n    predmet: 'phase1',\n    garant_uzivatel_id: 'phase1',\n    prikazce_id: 'phase1',\n    max_cena_s_dph: 'phase1',\n    strediska_kod: 'phase1',\n    jmeno: 'phase1',\n    email: 'phase1',\n\n    // Financovn: Samostatn sekce (viditeln ve FZI 1, validovan podle svho stavu)\n    zpusob_financovani: 'financovani',\n    lp_kod: 'financovani',\n    cislo_smlouvy: 'financovani',\n    smlouva_poznamka: 'financovani',\n    individualni_schvaleni: 'financovani',\n    individualni_poznamka: 'financovani',\n    pojistna_udalost_cislo: 'financovani',\n    pojistna_udalost_poznamka: 'financovani',\n\n    // Fze 3: Dodavatel a poloky\n    dodavatel_nazev: 'phase3',\n    dodavatel_adresa: 'phase3',\n    dodavatel_ico: 'phase3',\n    dodavatel_kontakt: 'phase3',\n    druh_objednavky_kod: 'phase3',\n    polozky_objednavky: 'phase3',\n\n    // Fze 4-6: Odesln a potvrzen\n    datum_odeslani: 'phase4to6',\n    dodavatel_zpusob_potvrzeni: 'phase4to6',\n    zpusob_platby: 'phase4to6',\n    dt_akceptace: 'phase4to6',\n\n    // Fze 2: Schvlen\n    schvaleni_komentar: 'phase2',\n    odeslani_storno_duvod: 'phase2'\n  };\n\n  // Zkontroluj, zda je vybran Pokladna jako zpsob financovn\n  // Pokud ano, pesko validaci dodavatele\n  const isPokladnaFinancing = (() => {\n    const zpusob = formData.zpusob_financovani;\n    if (!zpusob) return false;\n    // Me bt string nebo objekt - kontroluj nazev_stavu nebo nazev\n    if (typeof zpusob === 'string') {\n      return zpusob.toLowerCase().includes('pokladna');\n    }\n    if (typeof zpusob === 'object' && zpusob !== null) {\n      const nazev = zpusob.nazev_stavu || zpusob.nazev || '';\n      return nazev.toLowerCase().includes('pokladna');\n    }\n    return false;\n  })();\n\n  requiredFields.forEach(field => {\n    // Zjisti, ve kter fzi/sekci pole je\n    const fieldPhase = FIELD_TO_PHASE[field];\n\n    //  NOV LOGIKA: Validuj pouze pokud je sekce viditeln a odemen\n    if (!shouldValidateField(fieldPhase, field)) {\n      return; // Pesko validaci - sekce je neviditeln nebo zamen\n    }\n\n    // Skip dodavatel fields kdy je vybran Pokladna\n    if (isPokladnaFinancing && ['dodavatel_nazev', 'dodavatel_adresa', 'dodavatel_ico', 'dodavatel_kontakt'].includes(field)) {\n      return; // Pesko validaci tohoto pole\n    }\n\n    switch (field) {\n      case 'predmet':\n        if (!formData.predmet?.trim()) {\n          errors.predmet = `${FIELD_LABELS.predmet} je povinn - zadejte strun popis toho, co objednvte`;\n        }\n        break;\n\n      case 'max_cena_s_dph':\n        if (!formData.max_cena_s_dph || formData.max_cena_s_dph <= 0) {\n          errors.max_cena_s_dph = `${FIELD_LABELS.max_cena_s_dph} je povinn - zadejte pedpokldanou celkovou cenu vetn DPH`;\n        }\n        break;\n\n      case 'strediska_kod':\n        if (!formData.strediska_kod ||\n            (Array.isArray(formData.strediska_kod) && formData.strediska_kod.length === 0)) {\n          errors.strediska_kod = `${FIELD_LABELS.strediska_kod} - vyberte alespo jedno stedisko, ke ktermu se objednvka vztahuje`;\n        }\n        break;\n\n      case 'garant_uzivatel_id':\n        if (!formData.garant_uzivatel_id || formData.garant_uzivatel_id === '') {\n          errors.garant_uzivatel_id = `${FIELD_LABELS.garant_uzivatel_id} je povinn - vyberte osobu zodpovdnou za objednvku`;\n        }\n        break;\n\n      case 'prikazce_id':\n        if (!formData.prikazce_id || formData.prikazce_id === '') {\n          errors.prikazce_id = `${FIELD_LABELS.prikazce_id} je povinn - vyberte osobu, kter schvaluje objednvku`;\n        }\n        break;\n\n      case 'jmeno':\n        if (!formData.jmeno?.trim() || formData.jmeno === 'Neuvedeno') {\n          errors.jmeno = `${FIELD_LABELS.jmeno} je povinn - zkontrolujte sv uivatelsk daje`;\n        }\n        break;\n\n      case 'email':\n        if (!formData.email?.trim()) {\n          errors.email = `${FIELD_LABELS.email} je povinn - zadejte platnou e-mailovou adresu`;\n        } else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)) {\n          errors.email = 'E-mail m neplatn formt - zkontrolujte, zda obsahuje @ a domnu';\n        }\n        break;\n\n      case 'dodavatel_nazev':\n        if (!formData.dodavatel_nazev?.trim()) {\n          errors.dodavatel_nazev = `${FIELD_LABELS.dodavatel_nazev} je povinn - zadejte nzev firmy dodavatele`;\n        }\n        break;\n\n      case 'dodavatel_adresa':\n        // Formul i DB pouvaj dodavatel_adresa\n        if (!formData.dodavatel_adresa?.trim()) {\n          errors.dodavatel_adresa = `${FIELD_LABELS.dodavatel_adresa} je povinn - zadejte plnou adresu dodavatele`;\n        }\n        break;\n\n      case 'dodavatel_ico':\n        if (!formData.dodavatel_ico?.trim()) {\n          errors.dodavatel_ico = `${FIELD_LABELS.dodavatel_ico} je povinn - zadejte IO dodavatele (8 slic)`;\n        }\n        break;\n\n      case 'druh_objednavky_kod':\n        if (!formData.druh_objednavky_kod?.trim()) {\n          errors.druh_objednavky_kod = `${FIELD_LABELS.druh_objednavky_kod} je povinn - vyberte typ objednvky`;\n        }\n        break;\n\n      case 'polozky_objednavky':\n        if (!formData.polozky_objednavky || formData.polozky_objednavky.length === 0) {\n          errors.polozky_objednavky = `${FIELD_LABELS.polozky_objednavky} - pidejte alespo jednu poloku s nzvem a cenou`;\n        } else {\n          // Validace jednotlivch poloek\n          let hasItemError = false;\n          formData.polozky_objednavky.forEach((polozka, index) => {\n            // Nzev/popis je povinn (formul i DB: popis)\n            if (!polozka.popis?.trim()) {\n              errors[`polozka_${index}_popis`] = `Poloka ${index + 1}: Vyplte nzev nebo popis poloky`;\n              hasItemError = true;\n            }\n            // Cena bez DPH je povinn\n            if (!polozka.cena_bez_dph || parseFloat(polozka.cena_bez_dph) <= 0) {\n              errors[`polozka_${index}_cena_bez_dph`] = `Poloka ${index + 1}: Zadejte cenu bez DPH (mus bt vt ne 0)`;\n              hasItemError = true;\n            }\n            // Cena s DPH je povinn\n            if (!polozka.cena_s_dph || parseFloat(polozka.cena_s_dph) <= 0) {\n              errors[`polozka_${index}_cena_s_dph`] = `Poloka ${index + 1}: Zadejte cenu s DPH (mus bt vt ne 0)`;\n              hasItemError = true;\n            }\n            // DPH sazba nen povinn, m vchoz hodnotu (formul i DB: sazba_dph)\n          });\n          if (hasItemError) {\n            errors.polozky_objednavky = 'Nkter poloky obsahuj chyby - zkontrolujte nzev a ceny vech poloek';\n          }\n        }\n        break;\n\n      case 'dodavatel_kontakt':\n        if (!formData.dodavatel_kontakt?.trim()) {\n          errors.dodavatel_kontakt = `${FIELD_LABELS.dodavatel_kontakt} je povinn - zadejte e-mail nebo telefon na dodavatele`;\n        }\n        break;\n\n      case 'druh_objednavky':\n        // Legacy podpora druh_objednavky - mapuje na druh_objednavky_kod\n        if (!formData.druh_objednavky_kod?.trim()) {\n          errors.druh_objednavky_kod = `${FIELD_LABELS.druh_objednavky_kod} je povinn - vyberte typ objednvky`;\n        }\n        break;\n\n      case 'financovani':\n      case 'zpusob_financovani':\n        //  Validace zpsobu financovn (formData obsahuje STRING kd typu financovn)\n        // Formt: formData.zpusob_financovani = \"LP\" | \"POKLADNA\" | \"SMLOUVA\" | \"DOTACE\" atd.\n        if (!formData.zpusob_financovani ||\n            (typeof formData.zpusob_financovani === 'string' && !formData.zpusob_financovani.trim())) {\n          errors.zpusob_financovani = `${FIELD_LABELS.zpusob_financovani} je povinn - vyberte zdroj financovn`;\n        }\n        break;\n\n      case 'lp_kod':\n        if (!formData.lp_kod ||\n            (Array.isArray(formData.lp_kod) ? formData.lp_kod.length === 0 :\n             (typeof formData.lp_kod === 'string' ? !formData.lp_kod.trim() : !formData.lp_kod))) {\n          errors.lp_kod = `${FIELD_LABELS.lp_kod} je povinn - vyberte limitovan pslib pro financovn`;\n        }\n        break;\n\n      case 'cislo_smlouvy':\n        //  Podmnn validace - pouze pokud je vybran \"Smlouva\" jako zpsob financovn\n        // Tato validace se provd dynamicky v OrderForm25.js (dek 13246)\n        if (!formData.cislo_smlouvy?.trim()) {\n          errors.cislo_smlouvy = `${FIELD_LABELS.cislo_smlouvy} je povinn - zadejte evidenn slo smlouvy`;\n        }\n        break;\n\n      case 'individualni_schvaleni':\n        //  Podmnn validace - pouze pokud je vybran \"Individuln schvlen\"\n        // Tato validace se provd dynamicky v OrderForm25.js (dek 13252)\n        if (!formData.individualni_schvaleni?.trim()) {\n          errors.individualni_schvaleni = `${FIELD_LABELS.individualni_schvaleni} je povinn - zadejte identifiktor schvlen`;\n        }\n        break;\n\n      case 'pojistna_udalost_cislo':\n        //  Podmnn validace - pouze pokud je vybran \"Pojistn udlost\"\n        // Tato validace se provd dynamicky v OrderForm25.js (dek 13263)\n        if (!formData.pojistna_udalost_cislo?.trim()) {\n          errors.pojistna_udalost_cislo = `${FIELD_LABELS.pojistna_udalost_cislo} je povinn - zadejte slo pojistn udlosti`;\n        }\n        break;\n\n      // Poznmkov pole k financovn - nejsou povinn, proto nen validace\n      case 'smlouva_poznamka':\n      case 'individualni_poznamka':\n      case 'pojistna_udalost_poznamka':\n        // Poznmky nejsou povinn - peskoit validaci\n        break;\n\n      default:\n        break;\n    }\n  });\n\n  // Speciln validace podle stavu\n  if (workflowCode === 'ZAMITNUTA' && !formData.schvaleni_komentar?.trim()) {\n    errors.schvaleni_komentar = `${FIELD_LABELS.schvaleni_komentar} - uvete dvod zamtnut objednvky`;\n  }\n\n  // Validace komente kdy je zobrazen (neschvleno nebo ek se)\n  if ((formData.stav_schvaleni === 'neschvaleno' || formData.stav_schvaleni === 'ceka_se') &&\n      !formData.schvaleni_komentar?.trim()) {\n    errors.schvaleni_komentar = formData.stav_schvaleni === 'neschvaleno'\n      ? `${FIELD_LABELS.schvaleni_komentar} - vysvtlete, pro objednvku neschvalujete`\n      : `${FIELD_LABELS.schvaleni_komentar} - uvete dvod odloen schvlen`;\n  }\n\n  // Validace stavu odesln a data\n  if (formData.stav_odeslani && formData.stav_odeslani.trim() !== '') {\n    if (!formData.datum_odeslani?.trim()) {\n      errors.datum_odeslani = `${FIELD_LABELS.datum_odeslani} je povinn pi vybranm stavu odesln`;\n    }\n  }\n\n  // Validace stornovn - dvod je povinn pi stornovn\n  if (formData.stav_stornovano) {\n    if (!formData.odeslani_storno_duvod?.trim()) {\n      errors.odeslani_storno_duvod = `${FIELD_LABELS.odeslani_storno_duvod} je povinn - uvete, pro objednvku stornujete`;\n    }\n  }\n\n  //  VALIDACE ZVEEJNN V REGISTRU SMLUV\n  // Pokud je checkbox \"M bt zveejnna\" zakrtnut, pak jsou POVINN:\n  // - dt_zverejneni (Datum zveejnn VZ)\n  // - registr_iddt (Identifiktor IDDT)\n  if (formData.ma_byt_zverejnena === true || formData.ma_byt_zverejnena === 1) {\n    // Zkontroluj, zda je sekce registr_smluv_vyplneni viditeln a odemen\n    const registrSection = sectionStates?.registr_smluv_vyplneni;\n    const shouldValidateRegistr = !registrSection || (registrSection.visible && !registrSection.locked);\n    \n    if (shouldValidateRegistr) {\n      if (!formData.dt_zverejneni || !String(formData.dt_zverejneni).trim()) {\n        errors.dt_zverejneni = 'Datum zveejnn je povinn kdy m bt objednvka zveejnna';\n      }\n      if (!formData.registr_iddt || !String(formData.registr_iddt).trim()) {\n        errors.registr_iddt = 'Identifiktor IDDT je povinn kdy m bt objednvka zveejnna';\n      }\n    }\n  }\n\n  // Validace stavu fakturace a data\n  if (formData.stav_fakturace && formData.stav_fakturace.trim() !== '') {\n    if (!formData.datum_fakturace?.trim()) {\n      errors.datum_fakturace = `${FIELD_LABELS.datum_fakturace} je povinn pi vybranm stavu fakturace`;\n    }\n\n    // Validace sla faktury\n    if (!formData.cislo_faktury?.trim()) {\n      errors.cislo_faktury = `${FIELD_LABELS.cislo_faktury} je povinn - zadejte slo pijat faktury`;\n    }\n\n    // Validace stek fakturace\n    if (!formData.fakturovana_cena_bez_dph || parseFloat(formData.fakturovana_cena_bez_dph) <= 0) {\n      errors.fakturovana_cena_bez_dph = `${FIELD_LABELS.fakturovana_cena_bez_dph} je povinn a mus bt vt ne 0 - zadejte stku z faktury bez DPH`;\n    }\n    if (!formData.fakturovana_cena_s_dph || parseFloat(formData.fakturovana_cena_s_dph) <= 0) {\n      errors.fakturovana_cena_s_dph = `${FIELD_LABELS.fakturovana_cena_s_dph} je povinn a mus bt vt ne 0 - zadejte celkovou stku z faktury vetn DPH`;\n    }\n  }\n\n  return errors;\n};\n\n/**\n * Determines which sections should be visible based on workflow state and order phase\n * @param {string} workflowCode - Current workflow state code\n * @param {number} orderPhase - Current order phase (1 = NOV, 2 = PO SCHVLEN)\n * @returns {Object} - Object with section visibility flags\n */\nexport const getSectionVisibility = (workflowCode = 'NOVA', orderPhase = 1, isArchived = false) => {\n  //  ARCHIVOVAN OBJEDNVKY: Zobraz VECHNY sekce\n  if (isArchived) {\n    return {\n      objednatel: true,\n      schvaleni: true,\n      financovani: true,\n      dodavatel: true,\n      kontakt: true,\n      detaily: true,\n      dodaci_podminky: true,\n      stav_odeslani: true\n    };\n  }\n\n  const visibleSections = getVisibleSections(workflowCode);\n\n  // Zkladn sekce viditeln vdy\n  const baseVisibility = {\n    objednatel: visibleSections.includes('objednatel'),\n    schvaleni: visibleSections.includes('schvaleni')\n  };\n\n  //  Rozen sekce\n  // Financovn: Viditeln od FZE 1 (soust sekce Schvlen PO)\n  // Ostatn sekce: Viditeln od FZE 2/8 (ODESLANA_KE_SCHVALENI - po uloen do DB)\n  const extendedVisibility = {\n    financovani: visibleSections.includes('financovani'), //  Financovn viditeln VDY (je soust sekce Schvlen PO ve FZI 1)\n    dodavatel: orderPhase >= 2 && visibleSections.includes('dodavatel'),\n    kontakt: orderPhase >= 2 && visibleSections.includes('kontakt'),\n    detaily: orderPhase >= 2 && visibleSections.includes('detaily'),\n    dodaci_podminky: orderPhase >= 2 && visibleSections.includes('dodaci_podminky'),\n    stav_odeslani: orderPhase >= 2 && visibleSections.includes('stav_odeslani')\n  };\n\n  return {\n    ...baseVisibility,\n    ...extendedVisibility\n  };\n};\n\n/**\n * Determines which fields should be editable based on workflow state and user permissions\n * @param {string} workflowCode - Current workflow state code\n * @param {Object} userPermissions - User permissions object\n * @param {string} currentUserId - Current user ID\n * @param {string} orderAuthorId - Order author ID\n * @returns {Object} - Object with field editability flags\n */\nexport const getFieldEditability = (workflowCode, userPermissions = {}, currentUserId, orderAuthorId) => {\n  const phase = getWorkflowPhase(workflowCode);\n  const isAuthor = currentUserId === orderAuthorId;\n  const canApprove = userPermissions.ORDER_APPROVE || userPermissions.hasPermission?.('ORDER_APPROVE');\n  const canEdit = userPermissions.ORDER_EDIT || userPermissions.hasPermission?.('ORDER_EDIT');\n\n  switch (phase) {\n    case 'draft':\n      // Nov - autor me editovat ve\n      return {\n        basic_info: isAuthor,\n        approval_section: false,\n        extended_sections: false,\n        workflow_actions: isAuthor\n      };\n\n    case 'approval':\n      // ek na schvlen - pouze schvalovatel me mnit stav schvlen\n      return {\n        basic_info: false,\n        approval_section: canApprove,\n        extended_sections: false,\n        workflow_actions: canApprove\n      };\n\n    case 'approved':\n      // Schvleno - rozen sekce editovateln, zkladn info uzameno\n      return {\n        basic_info: false,\n        approval_section: canApprove, // monost vrtit ke schvlen\n        extended_sections: canEdit || isAuthor,\n        workflow_actions: canEdit || canApprove\n      };\n\n    case 'rejected':\n      // Zamtnuto - autor me editovat a poslat znovu\n      return {\n        basic_info: isAuthor,\n        approval_section: false,\n        extended_sections: false,\n        workflow_actions: isAuthor\n      };\n\n    case 'supplier_pending':\n    case 'supplier_confirmed':\n      // U dodavatele - omezen editace\n      return {\n        basic_info: false,\n        approval_section: false,\n        extended_sections: canEdit,\n        workflow_actions: canEdit\n      };\n\n    case 'completed':\n    case 'cancelled':\n      // Finln stavy - pouze ten\n      return {\n        basic_info: false,\n        approval_section: false,\n        extended_sections: false,\n        workflow_actions: false\n      };\n\n    default:\n      return {\n        basic_info: false,\n        approval_section: false,\n        extended_sections: false,\n        workflow_actions: false\n      };\n  }\n};\n\n/**\n * Gets available workflow actions based on current state and user permissions\n * @param {string} workflowCode - Current workflow state code\n * @param {Object} userPermissions - User permissions object\n * @param {string} currentUserId - Current user ID\n * @param {string} orderAuthorId - Order author ID\n * @returns {Array} - Array of available actions\n */\nexport const getAvailableActions = (workflowCode, userPermissions = {}, currentUserId, orderAuthorId) => {\n  const phase = getWorkflowPhase(workflowCode);\n  const isAuthor = currentUserId === orderAuthorId;\n  const canApprove = userPermissions.ORDER_APPROVE || userPermissions.hasPermission?.('ORDER_APPROVE');\n  const canEdit = userPermissions.ORDER_EDIT || userPermissions.hasPermission?.('ORDER_EDIT');\n\n  const actions = [];\n\n  switch (phase) {\n    case 'draft':\n      if (isAuthor) {\n        actions.push({\n          code: 'SEND_FOR_APPROVAL',\n          label: 'Odeslat ke schvlen',\n          targetState: 'ODESLANA_KE_SCHVALENI',\n          color: '#f59e0b',\n          icon: ''\n        });\n        actions.push({\n          code: 'SAVE_DRAFT',\n          label: 'Uloit koncept',\n          targetState: 'NOVA',\n          color: '#6b7280',\n          icon: ''\n        });\n      }\n      break;\n\n    case 'approval':\n      if (canApprove) {\n        actions.push({\n          code: 'APPROVE',\n          label: 'Schvlit',\n          targetState: 'SCHVALENA',\n          color: '#10b981',\n          icon: ''\n        });\n        actions.push({\n          code: 'REJECT',\n          label: 'Zamtnout',\n          targetState: 'ZAMITNUTA',\n          color: '#ef4444',\n          icon: ''\n        });\n        actions.push({\n          code: 'RETURN_TO_AUTHOR',\n          label: 'Vrtit k prav',\n          targetState: 'NOVA',\n          color: '#6b7280',\n          icon: ''\n        });\n      }\n      break;\n\n    case 'approved':\n      if (canEdit || isAuthor) {\n        actions.push({\n          code: 'SEND_TO_SUPPLIER',\n          label: 'Odeslat dodavateli',\n          targetState: 'CEKA_POTVRZENI',\n          color: '#3b82f6',\n          icon: ''\n        });\n      }\n      if (canApprove) {\n        actions.push({\n          code: 'REOPEN_APPROVAL',\n          label: 'Znovu ke schvlen',\n          targetState: 'ODESLANA_KE_SCHVALENI',\n          color: '#f59e0b',\n          icon: ''\n        });\n      }\n      break;\n\n    case 'rejected':\n      if (isAuthor) {\n        actions.push({\n          code: 'RESUBMIT',\n          label: 'Poslat znovu ke schvlen',\n          targetState: 'ODESLANA_KE_SCHVALENI',\n          color: '#f59e0b',\n          icon: ''\n        });\n        actions.push({\n          code: 'EDIT_DRAFT',\n          label: 'Upravit koncept',\n          targetState: 'NOVA',\n          color: '#6b7280',\n          icon: ''\n        });\n      }\n      break;\n\n    case 'supplier_pending':\n      if (canEdit) {\n        actions.push({\n          code: 'CONFIRM_SUPPLIER',\n          label: 'Potvrdit od dodavatele',\n          targetState: 'POTVRZENA',\n          color: '#059669',\n          icon: ''\n        });\n      }\n      break;\n\n    case 'supplier_confirmed':\n      if (canEdit) {\n        actions.push({\n          code: 'COMPLETE',\n          label: 'Dokonit objednvku',\n          targetState: 'DOKONCENA',\n          color: '#6b7280',\n          icon: ''\n        });\n      }\n      break;\n  }\n\n  // Vechny stavy krom finlnch umouj zruen\n  if (!['completed', 'cancelled'].includes(phase) && (canEdit || isAuthor)) {\n    actions.push({\n      code: 'CANCEL',\n      label: 'Zruit objednvku',\n      targetState: 'ZRUSENA',\n      color: '#9ca3af',\n      icon: '',\n      confirmRequired: true\n    });\n  }\n\n  return actions;\n};\n\n/**\n * Formats workflow state for display\n * @param {string} workflowCode - Workflow state code\n * @returns {Object} - Formatted state info for UI\n */\nexport const formatWorkflowState = (workflowCode) => {\n  const info = getWorkflowInfo(workflowCode);\n  return {\n    code: info.code,\n    name: info.name,\n    description: info.description,\n    color: info.color,\n    icon: info.icon,\n    phase: info.phase\n  };\n};\n\n/**\n * Gets human-readable label for a field\n * @param {string} fieldName - Field name\n * @returns {string} - Human-readable label\n */\nexport const getFieldLabel = (fieldName) => {\n  return FIELD_LABELS[fieldName] || fieldName;\n};\n\nexport default {\n  validateWorkflowData,\n  getSectionVisibility,\n  getFieldEditability,\n  getAvailableActions,\n  formatWorkflowState,\n  getFieldLabel\n};","/**\n *  LIFECYCLE REDUCER\n * d ivotn cyklus formule: MOUNTING  LOADING_DICTIONARIES  READY_FOR_DATA  DATA_LOADED  READY\n */\n\n// Fze inicializace formule\nexport const LIFECYCLE_PHASES = {\n  MOUNTING: 'MOUNTING',                       // Komponent se mountuje\n  LOADING_DICTIONARIES: 'LOADING_DICTIONARIES', // Nataj se selnky\n  READY_FOR_DATA: 'READY_FOR_DATA',          // selnky ready, meme nast data\n  LOADING_DATA: 'LOADING_DATA',              // Nataj se data objednvky\n  DATA_LOADED: 'DATA_LOADED',                // Data natena, formul se vypluje\n  READY: 'READY',                            // Ve hotov, uivatel me editovat\n  ERROR: 'ERROR'                             // Chyba pi inicializaci\n};\n\n// Poten stav\nexport const initialLifecycleState = {\n  phase: LIFECYCLE_PHASES.MOUNTING,\n  isInitializing: true,\n  isLoadingDictionaries: false,\n  isLoadingFormData: false,\n  isReady: false,\n  error: null,\n  startTime: Date.now(),\n  phaseHistory: [] // Pro debugging - historie pechod mezi fzemi\n};\n\n// Action types\nexport const LIFECYCLE_ACTIONS = {\n  START_DICTIONARIES_LOAD: 'START_DICTIONARIES_LOAD',\n  DICTIONARIES_LOADED: 'DICTIONARIES_LOADED',\n  START_DATA_LOAD: 'START_DATA_LOAD',\n  DATA_LOADED: 'DATA_LOADED',\n  READY: 'READY',\n  ERROR: 'ERROR',\n  RESET: 'RESET'\n};\n\n// Reducer\nexport const lifecycleReducer = (state, action) => {\n  const addToHistory = (phase) => [\n    ...state.phaseHistory,\n    { phase, timestamp: Date.now() }\n  ];\n\n  switch (action.type) {\n    case LIFECYCLE_ACTIONS.START_DICTIONARIES_LOAD:\n      return {\n        ...state,\n        phase: LIFECYCLE_PHASES.LOADING_DICTIONARIES,\n        isLoadingDictionaries: true,\n        phaseHistory: addToHistory(LIFECYCLE_PHASES.LOADING_DICTIONARIES)\n      };\n\n    case LIFECYCLE_ACTIONS.DICTIONARIES_LOADED:\n      return {\n        ...state,\n        phase: LIFECYCLE_PHASES.READY_FOR_DATA,\n        isLoadingDictionaries: false,\n        phaseHistory: addToHistory(LIFECYCLE_PHASES.READY_FOR_DATA)\n      };\n\n    case LIFECYCLE_ACTIONS.START_DATA_LOAD:\n      return {\n        ...state,\n        phase: LIFECYCLE_PHASES.LOADING_DATA,\n        isLoadingFormData: true,\n        phaseHistory: addToHistory(LIFECYCLE_PHASES.LOADING_DATA)\n      };\n\n    case LIFECYCLE_ACTIONS.DATA_LOADED:\n      return {\n        ...state,\n        phase: LIFECYCLE_PHASES.DATA_LOADED,\n        isLoadingFormData: false,\n        phaseHistory: addToHistory(LIFECYCLE_PHASES.DATA_LOADED)\n      };\n\n    case LIFECYCLE_ACTIONS.READY:\n      return {\n        ...state,\n        phase: LIFECYCLE_PHASES.READY,\n        isInitializing: false,\n        isReady: true,\n        phaseHistory: addToHistory(LIFECYCLE_PHASES.READY)\n      };\n\n    case LIFECYCLE_ACTIONS.ERROR:\n      return {\n        ...state,\n        phase: LIFECYCLE_PHASES.ERROR,\n        error: action.payload,\n        isInitializing: false,\n        isLoadingDictionaries: false,\n        isLoadingFormData: false,\n        phaseHistory: addToHistory(LIFECYCLE_PHASES.ERROR)\n      };\n\n    case LIFECYCLE_ACTIONS.RESET:\n      return {\n        ...initialLifecycleState,\n        startTime: Date.now()\n      };\n\n    default:\n      return state;\n  }\n};\n\n// Helper funkce pro debugging\nexport const getLifecycleDebugInfo = (state) => {\n  const totalTime = Date.now() - state.startTime;\n  const phases = state.phaseHistory.map((p, idx) => {\n    const prevTime = idx > 0 ? state.phaseHistory[idx - 1].timestamp : state.startTime;\n    const duration = p.timestamp - prevTime;\n    return `${p.phase} (${duration}ms)`;\n  });\n\n  return {\n    currentPhase: state.phase,\n    totalTime: `${totalTime}ms`,\n    phaseSequence: phases.join('  '),\n    isReady: state.isReady,\n    error: state.error\n  };\n};\n","/**\n *  DICTIONARIES REDUCER\n * Spravuje vechny selnky a jejich loading states\n */\n\n// Poten stav\nexport const initialDictionariesState = {\n  data: {\n    allUsers: [],\n    approvers: [],\n    strediskaOptions: [],\n    financovaniOptions: [],\n    druhyObjednavkyOptions: [],\n    druhyObjednavkyRawData: null,\n    lpKodyOptions: [],\n    prilohyTypyOptions: [],\n    typyFakturOptions: [],\n    stavyWorkflowMap: {} //  Mapa workflow stav (key: workflow_kod, value: {kod, nazev, popis})\n  },\n  loading: {\n    users: false,\n    approvers: false,\n    strediska: false,\n    financovani: false,\n    druhy: false,\n    lpKody: false,\n    prilohyTypy: false,\n    typyFaktur: false,\n    stavyWorkflow: false // \n  },\n  errors: {\n    users: null,\n    approvers: null,\n    strediska: null,\n    financovani: null,\n    druhy: null,\n    lpKody: null,\n    prilohyTypy: null,\n    typyFaktur: null,\n    stavyWorkflow: null // \n  },\n  isReady: false,\n  loadedCount: 0,\n  totalToLoad: 9 //  Zmnno z 8 na 9 (pidn selnk workflow stav)\n};\n\n// Action types\nexport const DICTIONARIES_ACTIONS = {\n  START_LOADING: 'START_LOADING',\n  SET_USERS: 'SET_USERS',\n  SET_APPROVERS: 'SET_APPROVERS',\n  SET_STREDISKA: 'SET_STREDISKA',\n  SET_FINANCOVANI: 'SET_FINANCOVANI',\n  SET_DRUHY: 'SET_DRUHY',\n  SET_LP_KODY: 'SET_LP_KODY',\n  SET_PRILOHY_TYPY: 'SET_PRILOHY_TYPY',\n  SET_TYPY_FAKTUR: 'SET_TYPY_FAKTUR',\n  SET_STAVY_WORKFLOW: 'SET_STAVY_WORKFLOW', // \n  SET_ERROR: 'SET_ERROR',\n  ALL_LOADED: 'ALL_LOADED',\n  RESET: 'RESET'\n};\n\n// Reducer\nexport const dictionariesReducer = (state, action) => {\n  switch (action.type) {\n    case DICTIONARIES_ACTIONS.START_LOADING:\n      return {\n        ...state,\n        loading: {\n          ...state.loading,\n          [action.payload.key]: true\n        },\n        errors: {\n          ...state.errors,\n          [action.payload.key]: null\n        }\n      };\n\n    case DICTIONARIES_ACTIONS.SET_USERS:\n      return {\n        ...state,\n        data: { ...state.data, allUsers: action.payload },\n        loading: { ...state.loading, users: false },\n        loadedCount: state.loadedCount + 1\n      };\n\n    case DICTIONARIES_ACTIONS.SET_APPROVERS:\n      return {\n        ...state,\n        data: { ...state.data, approvers: action.payload },\n        loading: { ...state.loading, approvers: false },\n        loadedCount: state.loadedCount + 1\n      };\n\n    case DICTIONARIES_ACTIONS.SET_STREDISKA:\n      return {\n        ...state,\n        data: { ...state.data, strediskaOptions: action.payload },\n        loading: { ...state.loading, strediska: false },\n        loadedCount: state.loadedCount + 1\n      };\n\n    case DICTIONARIES_ACTIONS.SET_FINANCOVANI:\n      return {\n        ...state,\n        data: { ...state.data, financovaniOptions: action.payload },\n        loading: { ...state.loading, financovani: false },\n        loadedCount: state.loadedCount + 1\n      };\n\n    case DICTIONARIES_ACTIONS.SET_DRUHY:\n      return {\n        ...state,\n        data: {\n          ...state.data,\n          druhyObjednavkyOptions: action.payload.options,\n          druhyObjednavkyRawData: action.payload.rawData\n        },\n        loading: { ...state.loading, druhy: false },\n        loadedCount: state.loadedCount + 1\n      };\n\n    case DICTIONARIES_ACTIONS.SET_LP_KODY:\n      return {\n        ...state,\n        data: { ...state.data, lpKodyOptions: action.payload },\n        loading: { ...state.loading, lpKody: false },\n        loadedCount: state.loadedCount + 1\n      };\n\n    case DICTIONARIES_ACTIONS.SET_PRILOHY_TYPY:\n      return {\n        ...state,\n        data: { ...state.data, prilohyTypyOptions: action.payload },\n        loading: { ...state.loading, prilohyTypy: false },\n        loadedCount: state.loadedCount + 1\n      };\n\n    case DICTIONARIES_ACTIONS.SET_TYPY_FAKTUR:\n      return {\n        ...state,\n        data: { ...state.data, typyFakturOptions: action.payload },\n        loading: { ...state.loading, typyFaktur: false },\n        loadedCount: state.loadedCount + 1\n      };\n\n    case DICTIONARIES_ACTIONS.SET_STAVY_WORKFLOW:\n      return {\n        ...state,\n        data: { ...state.data, stavyWorkflowMap: action.payload },\n        loading: { ...state.loading, stavyWorkflow: false },\n        loadedCount: state.loadedCount + 1\n      };\n\n    case DICTIONARIES_ACTIONS.SET_ERROR:\n      return {\n        ...state,\n        loading: {\n          ...state.loading,\n          [action.payload.key]: false\n        },\n        errors: {\n          ...state.errors,\n          [action.payload.key]: action.payload.error\n        }\n      };\n\n    case DICTIONARIES_ACTIONS.ALL_LOADED:\n      return {\n        ...state,\n        isReady: true\n      };\n\n    case DICTIONARIES_ACTIONS.RESET:\n      return initialDictionariesState;\n\n    default:\n      return state;\n  }\n};\n\n// Helper funkce\nexport const areAllDictionariesLoaded = (state) => {\n  return state.loadedCount >= state.totalToLoad;\n};\n\nexport const getDictionaryErrors = (state) => {\n  return Object.entries(state.errors)\n    .filter(([_, error]) => error !== null)\n    .map(([key, error]) => ({ key, error }));\n};\n\nexport const getLoadingProgress = (state) => {\n  return Math.round((state.loadedCount / state.totalToLoad) * 100);\n};\n","/**\n *  UI STATE REDUCER\n * Spravuje vechny UI stavy - modals, dialogs, sections, atd.\n */\n\n// Poten stav\nexport const initialUIState = {\n  // Modals & Dialogs\n  modals: {\n    cancelConfirm: false,\n    supplierSearch: false,\n    aresPopup: false,\n    templateSave: false,\n    templateDeleteConfirm: false,\n    icoCheck: false,\n    saveProgress: false,\n    addFaktura: false,\n\n    // Unlock confirmation modals\n    unlockPhase1Confirm: false,\n    unlockPhase2Confirm: false,\n    unlockRegistrConfirm: false,\n    unlockFakturaceConfirm: false,\n    unlockVecnaSpravnostConfirm: false,\n    unlockDokonceniConfirm: false\n  },\n\n  // Dropdowns & Menus\n  dropdowns: {\n    template: false\n  },\n\n  // Sections state (collapsed/expanded)\n  sections: {\n    collapsed: {\n      // Bude obsahovat: { 'section1': true, 'section2': false, ... }\n    },\n    locked: {\n      // Bude obsahovat: { 'phase2': true, ... }\n    }\n  },\n\n  // Select states (open/closed, search values)\n  selectStates: {\n    // Zachovno z pvodnho kdu\n  },\n\n  searchStates: {\n    // Zachovno z pvodnho kdu\n  },\n\n  // Global UI states\n  fullscreen: false,\n  areSectionsCollapsed: false,\n\n  // Debug panel\n  debug: {\n    visible: false,\n    pinned: false\n  },\n\n  // Progress indicators\n  saveProgress: {\n    visible: false,\n    value: 0,\n    text: ''\n  },\n\n  // ICO check status\n  icoCheckStatus: null, // null, 'checking', 'found-local', 'found-ares', 'not-found'\n  icoCheckData: null,\n\n  // Drag & Drop\n  dragOver: false\n};\n\n// Action types\nexport const UI_ACTIONS = {\n  // Modals\n  OPEN_MODAL: 'OPEN_MODAL',\n  CLOSE_MODAL: 'CLOSE_MODAL',\n  CLOSE_ALL_MODALS: 'CLOSE_ALL_MODALS',\n\n  // Dropdowns\n  TOGGLE_DROPDOWN: 'TOGGLE_DROPDOWN',\n  CLOSE_ALL_DROPDOWNS: 'CLOSE_ALL_DROPDOWNS',\n\n  // Sections\n  COLLAPSE_SECTION: 'COLLAPSE_SECTION',\n  EXPAND_SECTION: 'EXPAND_SECTION',\n  TOGGLE_SECTION: 'TOGGLE_SECTION',\n  COLLAPSE_ALL_SECTIONS: 'COLLAPSE_ALL_SECTIONS',\n  EXPAND_ALL_SECTIONS: 'EXPAND_ALL_SECTIONS',\n  LOCK_SECTION: 'LOCK_SECTION',\n  UNLOCK_SECTION: 'UNLOCK_SECTION',\n\n  // Select states\n  SET_SELECT_STATE: 'SET_SELECT_STATE',\n  SET_SEARCH_STATE: 'SET_SEARCH_STATE',\n\n  // Global UI\n  TOGGLE_FULLSCREEN: 'TOGGLE_FULLSCREEN',\n  SET_FULLSCREEN: 'SET_FULLSCREEN',\n\n  // Debug panel\n  TOGGLE_DEBUG: 'TOGGLE_DEBUG',\n  PIN_DEBUG: 'PIN_DEBUG',\n\n  // Progress\n  SET_SAVE_PROGRESS: 'SET_SAVE_PROGRESS',\n  SHOW_SAVE_PROGRESS: 'SHOW_SAVE_PROGRESS',\n  HIDE_SAVE_PROGRESS: 'HIDE_SAVE_PROGRESS',\n\n  // ICO check\n  SET_ICO_CHECK_STATUS: 'SET_ICO_CHECK_STATUS',\n  SET_ICO_CHECK_DATA: 'SET_ICO_CHECK_DATA',\n\n  // Drag & Drop\n  SET_DRAG_OVER: 'SET_DRAG_OVER',\n\n  // Reset\n  RESET: 'RESET'\n};\n\n// Reducer\nexport const uiReducer = (state, action) => {\n  switch (action.type) {\n    case UI_ACTIONS.OPEN_MODAL:\n      return {\n        ...state,\n        modals: {\n          ...state.modals,\n          [action.payload]: true\n        }\n      };\n\n    case UI_ACTIONS.CLOSE_MODAL:\n      return {\n        ...state,\n        modals: {\n          ...state.modals,\n          [action.payload]: false\n        }\n      };\n\n    case UI_ACTIONS.CLOSE_ALL_MODALS:\n      const closedModals = {};\n      Object.keys(state.modals).forEach(key => {\n        closedModals[key] = false;\n      });\n      return {\n        ...state,\n        modals: closedModals\n      };\n\n    case UI_ACTIONS.TOGGLE_DROPDOWN:\n      return {\n        ...state,\n        dropdowns: {\n          ...state.dropdowns,\n          [action.payload]: !state.dropdowns[action.payload]\n        }\n      };\n\n    case UI_ACTIONS.CLOSE_ALL_DROPDOWNS:\n      const closedDropdowns = {};\n      Object.keys(state.dropdowns).forEach(key => {\n        closedDropdowns[key] = false;\n      });\n      return {\n        ...state,\n        dropdowns: closedDropdowns\n      };\n\n    case UI_ACTIONS.COLLAPSE_SECTION:\n      return {\n        ...state,\n        sections: {\n          ...state.sections,\n          collapsed: {\n            ...state.sections.collapsed,\n            [action.payload]: true\n          }\n        }\n      };\n\n    case UI_ACTIONS.EXPAND_SECTION:\n      return {\n        ...state,\n        sections: {\n          ...state.sections,\n          collapsed: {\n            ...state.sections.collapsed,\n            [action.payload]: false\n          }\n        }\n      };\n\n    case UI_ACTIONS.TOGGLE_SECTION:\n      return {\n        ...state,\n        sections: {\n          ...state.sections,\n          collapsed: {\n            ...state.sections.collapsed,\n            [action.payload]: !state.sections.collapsed[action.payload]\n          }\n        }\n      };\n\n    case UI_ACTIONS.COLLAPSE_ALL_SECTIONS:\n      return {\n        ...state,\n        areSectionsCollapsed: true\n      };\n\n    case UI_ACTIONS.EXPAND_ALL_SECTIONS:\n      return {\n        ...state,\n        areSectionsCollapsed: false\n      };\n\n    case UI_ACTIONS.LOCK_SECTION:\n      return {\n        ...state,\n        sections: {\n          ...state.sections,\n          locked: {\n            ...state.sections.locked,\n            [action.payload]: true\n          }\n        }\n      };\n\n    case UI_ACTIONS.UNLOCK_SECTION:\n      return {\n        ...state,\n        sections: {\n          ...state.sections,\n          locked: {\n            ...state.sections.locked,\n            [action.payload]: false\n          }\n        }\n      };\n\n    case UI_ACTIONS.SET_SELECT_STATE:\n      return {\n        ...state,\n        selectStates: {\n          ...state.selectStates,\n          [action.payload.key]: action.payload.value\n        }\n      };\n\n    case UI_ACTIONS.SET_SEARCH_STATE:\n      return {\n        ...state,\n        searchStates: {\n          ...state.searchStates,\n          [action.payload.key]: action.payload.value\n        }\n      };\n\n    case UI_ACTIONS.TOGGLE_FULLSCREEN:\n      return {\n        ...state,\n        fullscreen: !state.fullscreen\n      };\n\n    case UI_ACTIONS.SET_FULLSCREEN:\n      return {\n        ...state,\n        fullscreen: action.payload\n      };\n\n    case UI_ACTIONS.TOGGLE_DEBUG:\n      return {\n        ...state,\n        debug: {\n          ...state.debug,\n          visible: !state.debug.visible\n        }\n      };\n\n    case UI_ACTIONS.PIN_DEBUG:\n      return {\n        ...state,\n        debug: {\n          ...state.debug,\n          pinned: action.payload\n        }\n      };\n\n    case UI_ACTIONS.SET_SAVE_PROGRESS:\n      return {\n        ...state,\n        saveProgress: {\n          ...state.saveProgress,\n          value: action.payload.value,\n          text: action.payload.text\n        }\n      };\n\n    case UI_ACTIONS.SHOW_SAVE_PROGRESS:\n      return {\n        ...state,\n        saveProgress: {\n          ...state.saveProgress,\n          visible: true\n        }\n      };\n\n    case UI_ACTIONS.HIDE_SAVE_PROGRESS:\n      return {\n        ...state,\n        saveProgress: {\n          ...state.saveProgress,\n          visible: false\n        }\n      };\n\n    case UI_ACTIONS.SET_ICO_CHECK_STATUS:\n      return {\n        ...state,\n        icoCheckStatus: action.payload\n      };\n\n    case UI_ACTIONS.SET_ICO_CHECK_DATA:\n      return {\n        ...state,\n        icoCheckData: action.payload\n      };\n\n    case UI_ACTIONS.SET_DRAG_OVER:\n      return {\n        ...state,\n        dragOver: action.payload\n      };\n\n    case UI_ACTIONS.RESET:\n      return initialUIState;\n\n    default:\n      return state;\n  }\n};\n\n// Helper funkce\nexport const isAnyModalOpen = (state) => {\n  return Object.values(state.modals).some(value => value === true);\n};\n\nexport const isSectionCollapsed = (state, sectionKey) => {\n  return state.sections.collapsed[sectionKey] === true;\n};\n\nexport const isSectionLocked = (state, sectionKey) => {\n  return state.sections.locked[sectionKey] === true;\n};\n","/**\n *  useFormController Hook\n * MASTER HOOK - d celou inicializaci a lifecycle formule\n */\n\nimport { useCallback, useEffect, useRef } from 'react';\nimport { useFormLifecycle } from './useFormLifecycle';\nimport { useDictionaries } from './useDictionaries';\nimport { useOrderDataLoader } from './useOrderDataLoader';\nimport { useUIState } from './useUIState';\nimport { LIFECYCLE_PHASES } from '../reducers';\n\n//  COMPONENT INSTANCE TRACKING\n// Kad instance formule m vlastn ID\n// Window flag obsahuje ID aktuln bc inicializace\nif (typeof window !== 'undefined') {\n  if (!window.__orderFormCurrentInstanceId) {\n    window.__orderFormCurrentInstanceId = null;\n  }\n  if (!window.__orderFormInitInProgress) {\n    window.__orderFormInitInProgress = false;\n  }\n}\n\nexport const useFormController = ({\n  token,\n  username,\n  userId,\n  editOrderId,\n  archivovanoParam,\n  onDataLoaded, // Callback kdy jsou data natena\n  onError, // Callback pi chyb\n  onReady // Callback kdy je formul ready\n}) => {\n  const lifecycle = useFormLifecycle();\n  const dictionaries = useDictionaries({ token, username, enabled: true });\n  const orderDataLoader = useOrderDataLoader({ token, username, dictionaries });\n  const ui = useUIState();\n\n  //  Vytvo uniktn ID pro tuto instanci komponenty\n  const instanceIdRef = useRef(`form_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`);\n\n  //  Ref-based lock pro prevenci duplicitn inicializace\n  const initLockRef = useRef(false);\n  const cleanupRef = useRef(false);\n  const hasInitializedRef = useRef(false); //  Ref pro tracking zda u probhla inicializace\n  const isMountedRef = useRef(true); //  Tracking mounting state\n  const strictModeUnmountRef = useRef(false); //  Detekce StrictMode unmount\n\n  //  REFS pro useEffect - zabrnit opakovanmu voln\n  const lifecycleRef = useRef();\n  const dictionariesRef = useRef();\n  const orderDataLoaderRef = useRef();\n  const onDataLoadedRef = useRef();\n  const onErrorRef = useRef();\n  const onReadyRef = useRef();\n\n  // Update refs pi kadm renderu\n  lifecycleRef.current = lifecycle;\n  dictionariesRef.current = dictionaries;\n  orderDataLoaderRef.current = orderDataLoader;\n  onDataLoadedRef.current = onDataLoaded;\n  onErrorRef.current = onError;\n  onReadyRef.current = onReady;\n\n  //  REMOVED: initializeForm - moved inline to useEffect to prevent dependency loops\n\n  /**\n   *  CLEANUP EFFECT\n   * Samostatn effect pro cleanup aby ml vlastn lifecycle\n   */\n  useEffect(() => {\n    const instanceId = instanceIdRef.current;\n\n    return () => {\n      const wasInitializing = window.__orderFormInitInProgress &&\n                            window.__orderFormCurrentInstanceId === instanceId;\n\n      //  STRICTMODE DETECTION\n      const timeSinceMount = Date.now() - parseInt(instanceId.split('_')[1]);\n\n      if (timeSinceMount < 100 && wasInitializing) {\n        if (process.env.NODE_ENV === 'development') {\n        }\n        strictModeUnmountRef.current = true;\n        return;\n      }\n\n      //  HMR DETECTION - pokud je unmount tsn po mount, je to pravdpodobn HMR\n      if (timeSinceMount < 500) {\n        if (process.env.NODE_ENV === 'development') {\n        }\n        // Pro HMR nastavme cleanup s delm timeoutem\n        setTimeout(() => {\n          if (window.__orderFormCurrentInstanceId === instanceId) {\n            window.__orderFormInitInProgress = false;\n            window.__orderFormCurrentInstanceId = null;\n          }\n          cleanupRef.current = true;\n        }, 1000); // Del timeout pro HMR\n        return;\n      }\n\n      // Normln cleanup - delayed pro StrictMode safety\n      if (process.env.NODE_ENV === 'development') {\n      }\n      setTimeout(() => {\n        if (window.__orderFormCurrentInstanceId === instanceId) {\n          window.__orderFormInitInProgress = false;\n          window.__orderFormCurrentInstanceId = null;\n        }\n        cleanupRef.current = true;\n      }, 200);\n    };\n  }, []); // Spust se jednou pi mount/unmount\n\n  /**\n   *  Auto-initialization pi mountu\n   * Spust se kdy jsou token a username dostupn\n   *\n   *  INSTANCE-BASED: Kad instance m vlastn ID\n   *  STRICTMODE DETECTION: Ignoruje StrictMode test unmount\n   *  NAVIGATION FIX: Re-initialize when editOrderId changes\n   */\n  useEffect(() => {\n    // console.log(' [useFormController] useEffect SE SPOUT! token:', !!token, 'username:', !!username, 'editOrderId:', editOrderId);\n    const instanceId = instanceIdRef.current;\n    isMountedRef.current = true;\n\n    //  NAVIGATION FIX: Reset VDY kdy se zmn editOrderId\n    // This allows re-initialization when navigating between orders\n    \n    //  CRITICAL: Reset VECH flag pro re-inicializaci\n    hasInitializedRef.current = false;\n    initLockRef.current = false;\n    cleanupRef.current = false;\n    strictModeUnmountRef.current = false;\n    \n    //  CRITICAL: Reset global window flags\n    if (window.__orderFormCurrentInstanceId === instanceIdRef.current) {\n      window.__orderFormInitInProgress = false;\n      window.__orderFormCurrentInstanceId = null;\n    }\n    \n    //  CRITICAL: Reset lifecycle state pi zmn editOrderId\n    lifecycle.reset();\n\n    // Skip pokud u je oznaen pro cleanup (ale ne StrictMode unmount nebo HMR)\n    //  V production mode by cleanup ml zastavit re-init, ale v dev mode (HMR) ne\n    if (cleanupRef.current && !strictModeUnmountRef.current) {\n      if (process.env.NODE_ENV === 'development') {\n      }\n      return;\n    }\n\n    // Reset StrictMode flag pokud byl nastaven\n    if (strictModeUnmountRef.current) {\n      strictModeUnmountRef.current = false;\n    }\n\n    if (token && username) {\n      // console.log(' [useFormController] Mm token a username, VOLM init()');\n      hasInitializedRef.current = true; //  Oznait e inicializace zaala\n      //  Call initializeForm directly to avoid dependency loop - use refs\n      const init = async () => {\n        // console.log(' [useFormController] init() FUNKCE SE SPOUT!');\n        const instanceId = instanceIdRef.current;\n\n        //  DOUBLE CHECK LOCK - prevence race conditions\n        if (initLockRef.current) {\n          return { success: false, reason: 'already_running' };\n        }\n\n        // Check jestli jin instance u b\n        if (window.__orderFormInitInProgress && window.__orderFormCurrentInstanceId !== instanceId) {\n          return { success: false, reason: 'other_instance_running' };\n        }\n\n        //  SET LOCK - OKAMIT, synchronn\n        initLockRef.current = true;\n        window.__orderFormInitInProgress = true;\n        window.__orderFormCurrentInstanceId = instanceId;\n\n        try {\n          // Use current refs to get latest values\n          const currentLifecycle = lifecycleRef.current;\n          const currentDictionaries = dictionariesRef.current;\n          const currentOrderDataLoader = orderDataLoaderRef.current;\n          const currentOnDataLoaded = onDataLoadedRef.current;\n          const currentOnError = onErrorRef.current;\n          const currentOnReady = onReadyRef.current;\n\n          // FZE 1: Naten selnk\n          if (process.env.NODE_ENV === 'development') {\n          }\n          \n          //  Optimalizace: Pokud selnky u jsou naten' (nap. po HMR), pesko\n          if (!currentDictionaries.isReady) {\n            currentLifecycle.startDictionariesLoad();\n\n            const dictionariesSuccess = await currentDictionaries.loadAll();\n\n            if (!dictionariesSuccess) {\n              throw new Error('Failed to load dictionaries');\n            }\n\n            if (process.env.NODE_ENV === 'development') {\n            }\n            currentLifecycle.dictionariesLoaded();\n          } else {\n            if (process.env.NODE_ENV === 'development') {\n            }\n            currentLifecycle.dictionariesLoaded();\n          }\n\n          // FZE 2: Naten dat objednvky (pokud edit/copy)\n          let loadedData = null;\n          let sourceOrderId = null;\n\n          if (process.env.NODE_ENV === 'development') {\n          }\n\n          if (editOrderId) {\n            // EDIT MODE\n            // console.log(' [useFormController] EDIT MODE - editOrderId:', editOrderId, 'archivovano:', archivovanoParam);\n            if (process.env.NODE_ENV === 'development') {\n            }\n            currentLifecycle.startDataLoad();\n\n            loadedData = await currentOrderDataLoader.loadOrderForEdit({\n              orderId: editOrderId,\n              archivovano: archivovanoParam === '1' ? 1 : 0\n            });\n            // console.log(' [useFormController] loadedData po loadOrderForEdit:', loadedData);\n\n            if (process.env.NODE_ENV === 'development') {\n            }\n            currentLifecycle.dataLoaded();\n\n          } else {\n            // NEW ORDER - dn data k naten, ale stle zavolat callback pro draft loading!\n            if (process.env.NODE_ENV === 'development') {\n            }\n            currentLifecycle.dataLoaded(); // Peskoit data loading fzi\n            loadedData = {}; //  Przdn objekt aby se zavolal onDataLoaded\n          }\n\n          // FZE 3: Formul ready\n          currentLifecycle.setReady();\n\n          // Callbacks -  Volat VDY, i pro NEW order (kvli draft loading)\n          if (currentOnDataLoaded) {\n            currentOnDataLoaded(loadedData, sourceOrderId);\n          }\n\n          if (currentOnReady) {\n            currentOnReady();\n          }\n\n          //  FIX: Uvolnit lock po spnm dokonen\n          initLockRef.current = false;\n          window.__orderFormInitInProgress = false;\n\n          return {\n            success: true,\n            data: loadedData,\n            sourceOrderId\n          };\n\n        } catch (error) {\n          const currentLifecycle = lifecycleRef.current;\n          const currentOnError = onErrorRef.current;\n\n          currentLifecycle.setError(error.message);\n\n          // Reset locks pi chyb\n          initLockRef.current = false;\n          window.__orderFormInitInProgress = false;\n          if (window.__orderFormCurrentInstanceId === instanceId) {\n            window.__orderFormCurrentInstanceId = null;\n          }\n\n          if (currentOnError) {\n            currentOnError(error);\n          }\n\n          return {\n            success: false,\n            error: error.message\n          };\n        }\n      };\n\n      init();\n    }\n  }, [token, username, editOrderId]); //  FIX: REMOVED initializeForm and copyOrderId to prevent infinite loop\n\n  return {\n    // Lifecycle\n    lifecycle: {\n      phase: lifecycle.phase,\n      isInitializing: lifecycle.isInitializing,\n      isLoadingDictionaries: lifecycle.isLoadingDictionaries,\n      isLoadingFormData: lifecycle.isLoadingFormData,\n      isReady: lifecycle.isReady,\n      error: lifecycle.error,\n      isInPhase: lifecycle.isInPhase,\n      canLoadData: lifecycle.canLoadData\n    },\n\n    // Dictionaries\n    dictionaries: {\n      data: dictionaries.data,\n      loading: dictionaries.loading,\n      errors: dictionaries.errors,\n      isReady: dictionaries.isReady,\n      loadedCount: dictionaries.loadedCount,\n      totalToLoad: dictionaries.totalToLoad\n    },\n\n    // Order data loader\n    orderDataLoader: {\n      loading: orderDataLoader.loading,\n      error: orderDataLoader.error,\n      loadOrderForEdit: orderDataLoader.loadOrderForEdit\n      // loadOrderForCopy: Funkce existuje v useOrderDataLoader, ale nen pouita v UI\n    },\n\n    // UI State\n    ui,\n\n    // Master functions\n    // initializeForm: removed - inline in useEffect to prevent loops\n    reset: () => {\n      const instanceId = instanceIdRef.current;\n      lifecycle.reset();\n      ui.reset();\n\n      // Reset vechny lock flagy\n      initLockRef.current = false;\n      cleanupRef.current = false;\n      hasInitializedRef.current = false; //  Reset hasInitialized flag\n\n      // Reset global flags pokud tato instance je ta aktivn\n      if (window.__orderFormCurrentInstanceId === instanceId) {\n        window.__orderFormInitInProgress = false;\n        window.__orderFormCurrentInstanceId = null;\n      }\n    }\n  };\n};\n","/**\n *  useFormLifecycle Hook\n * d cel ivotn cyklus formule od mountu po ready state\n */\n\nimport { useReducer, useCallback, useEffect } from 'react';\nimport {\n  lifecycleReducer,\n  initialLifecycleState,\n  LIFECYCLE_ACTIONS,\n  LIFECYCLE_PHASES\n} from '../reducers';\n\nexport const useFormLifecycle = () => {\n  const [state, dispatch] = useReducer(lifecycleReducer, initialLifecycleState);\n\n  /**\n   * Start natn selnk\n   */\n  const startDictionariesLoad = useCallback(() => {\n    dispatch({ type: LIFECYCLE_ACTIONS.START_DICTIONARIES_LOAD });\n  }, []);\n\n  /**\n   * selnky nateny - ready pro data\n   */\n  const dictionariesLoaded = useCallback(() => {\n    dispatch({ type: LIFECYCLE_ACTIONS.DICTIONARIES_LOADED });\n  }, []);\n\n  /**\n   * Start natn dat objednvky\n   */\n  const startDataLoad = useCallback(() => {\n    dispatch({ type: LIFECYCLE_ACTIONS.START_DATA_LOAD });\n  }, []);\n\n  /**\n   * Data natena\n   */\n  const dataLoaded = useCallback(() => {\n    dispatch({ type: LIFECYCLE_ACTIONS.DATA_LOADED });\n  }, []);\n\n  /**\n   * Formul ready pro editaci\n   */\n  const setReady = useCallback(() => {\n    dispatch({ type: LIFECYCLE_ACTIONS.READY });\n  }, []);\n\n  /**\n   * Chyba pi inicializaci\n   */\n  const setError = useCallback((error) => {\n    dispatch({ type: LIFECYCLE_ACTIONS.ERROR, payload: error });\n  }, []);\n\n  /**\n   * Reset lifecycle\n   */\n  const reset = useCallback(() => {\n    dispatch({ type: LIFECYCLE_ACTIONS.RESET });\n  }, []);\n\n  return {\n    // State\n    phase: state.phase,\n    isInitializing: state.isInitializing,\n    isLoadingDictionaries: state.isLoadingDictionaries,\n    isLoadingFormData: state.isLoadingFormData,\n    isReady: state.isReady,\n    error: state.error,\n    phaseHistory: state.phaseHistory,\n\n    // Actions\n    startDictionariesLoad,\n    dictionariesLoaded,\n    startDataLoad,\n    dataLoaded,\n    setReady,\n    setError,\n    reset,\n\n    // Helpers\n    isInPhase: (phase) => state.phase === phase,\n    canLoadData: () => state.phase === LIFECYCLE_PHASES.READY_FOR_DATA\n  };\n};\n","/**\n *  useDictionaries Hook\n * Nat vechny selnky paraleln a d jejich stav\n */\n\nimport { useReducer, useCallback, useEffect, useRef } from 'react';\nimport {\n  dictionariesReducer,\n  initialDictionariesState,\n  DICTIONARIES_ACTIONS,\n  areAllDictionariesLoaded\n} from '../reducers';\n\n// Import API funkc\nimport { fetchAllUsers, fetchApprovers, fetchLimitovanePrisliby } from '../../../services/api2auth';\nimport {\n  getStrediska25,\n  getFinancovaniZdroj25,\n  getDruhyObjednavky25,\n  getTypyPriloh25,\n  getTypyFaktur25,\n  getStavyWorkflow25\n} from '../../../services/api25orders';\n\nexport const useDictionaries = ({ token, username, enabled = true }) => {\n  const [state, dispatch] = useReducer(dictionariesReducer, initialDictionariesState);\n  const loadingRef = useRef(false); // Prevence duplicitnho natn\n  const resolveRef = useRef(null);\n  const promiseRef = useRef(null);\n  const abortControllerRef = useRef(null); //  AbortController pro cancellation\n\n  //  Hlavn funkce pro naten vech selnk paraleln\n  const loadAll = useCallback(async () => {\n    if (!token || !username) {\n      return false;\n    }\n\n    if (loadingRef.current) {\n      // Already loading - vrtme existujc promise\n      return promiseRef.current;\n    }\n\n    loadingRef.current = true;\n\n    //  AbortController DISABLED - zpsoboval problmy s StrictMode remount\n    // abortControllerRef.current = new AbortController();\n    // const signal = abortControllerRef.current.signal;\n    const signal = { aborted: false }; // Dummy signal - vdy false, nikdy neabortuje\n\n    // Vytvo Promise kter se resolve a kdy jsou vechny selnky naten\n    if (!promiseRef.current) {\n      promiseRef.current = new Promise((resolve) => {\n        resolveRef.current = resolve;\n      });\n    }\n\n    try {\n      // Paraleln naten vech selnk\n      const results = await Promise.allSettled([\n        // 1. All Users (including inactive - filtering done in OrderForm25)\n        (async () => {\n          if (signal.aborted) return { key: 'users', success: false, cancelled: true };\n          try {\n            dispatch({ type: DICTIONARIES_ACTIONS.START_LOADING, payload: { key: 'users' } });\n            const users = await fetchAllUsers({ token, username }); //  TODO: API nepodporuje signal zatm\n            if (signal.aborted) return { key: 'users', success: false, cancelled: true };\n\n            //  Bez SYSTEM uivatele - pid se dynamicky jen u archivovanch objednvek\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_USERS, payload: users || [] });\n            return { key: 'users', success: true };\n          } catch (error) {\n            if (error.name === 'AbortError' || signal.aborted) {\n              return { key: 'users', success: false, cancelled: true };\n            }\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_ERROR, payload: { key: 'users', error: error.message } });\n            return { key: 'users', success: false, error };\n          }\n        })(),\n\n        // 2. Approvers\n        (async () => {\n          if (signal.aborted) return { key: 'approvers', success: false, cancelled: true };\n          try {\n            dispatch({ type: DICTIONARIES_ACTIONS.START_LOADING, payload: { key: 'approvers' } });\n            const approvers = await fetchApprovers({ token, username }); //  TODO: API nepodporuje signal zatm\n            if (signal.aborted) return { key: 'approvers', success: false, cancelled: true };\n\n            //  Bez SYSTEM uivatele - pid se dynamicky jen u archivovanch objednvek\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_APPROVERS, payload: approvers || [] });\n            return { key: 'approvers', success: true };\n          } catch (error) {\n            if (error.name === 'AbortError' || signal.aborted) {\n              return { key: 'approvers', success: false, cancelled: true };\n            }\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_ERROR, payload: { key: 'approvers', error: error.message } });\n            return { key: 'approvers', success: false, error };\n          }\n        })(),\n\n        // 3. Stediska\n        (async () => {\n          if (signal.aborted) return { key: 'strediska', success: false, cancelled: true };\n          try {\n            dispatch({ type: DICTIONARIES_ACTIONS.START_LOADING, payload: { key: 'strediska' } });\n            const strediska = await getStrediska25({ token, username }); //  TODO: API nepodporuje signal zatm\n            if (signal.aborted) return { key: 'strediska', success: false, cancelled: true };\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_STREDISKA, payload: strediska || [] });\n            return { key: 'strediska', success: true };\n          } catch (error) {\n            if (error.name === 'AbortError' || signal.aborted) {\n              return { key: 'strediska', success: false, cancelled: true };\n            }\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_ERROR, payload: { key: 'strediska', error: error.message } });\n            return { key: 'strediska', success: false, error };\n          }\n        })(),\n\n        // 4. Financovn\n        (async () => {\n          if (signal.aborted) return { key: 'financovani', success: false, cancelled: true };\n          try {\n            dispatch({ type: DICTIONARIES_ACTIONS.START_LOADING, payload: { key: 'financovani' } });\n            const financovani = await getFinancovaniZdroj25({ token, username }); //  TODO: API nepodporuje signal zatm\n            if (signal.aborted) return { key: 'financovani', success: false, cancelled: true };\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_FINANCOVANI, payload: financovani || [] });\n            return { key: 'financovani', success: true };\n          } catch (error) {\n            if (error.name === 'AbortError' || signal.aborted) {\n              return { key: 'financovani', success: false, cancelled: true };\n            }\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_ERROR, payload: { key: 'financovani', error: error.message } });\n            return { key: 'financovani', success: false, error };\n          }\n        })(),\n\n        // 5. Druhy objednvky\n        (async () => {\n          if (signal.aborted) return { key: 'druhy', success: false, cancelled: true };\n          try {\n            dispatch({ type: DICTIONARIES_ACTIONS.START_LOADING, payload: { key: 'druhy' } });\n            const druhyData = await getDruhyObjednavky25({ token, username }); //  TODO: API nepodporuje signal zatm\n            if (signal.aborted) return { key: 'druhy', success: false, cancelled: true };\n            //  OPRAVA: druhyData je u pole (stejn jako getFinancovaniZdroj25), ne objekt s property .data\n            const druhyOptions = druhyData || [];\n            dispatch({\n              type: DICTIONARIES_ACTIONS.SET_DRUHY,\n              payload: { options: druhyOptions, rawData: druhyData }\n            });\n            return { key: 'druhy', success: true };\n          } catch (error) {\n            if (error.name === 'AbortError' || signal.aborted) {\n              return { key: 'druhy', success: false, cancelled: true };\n            }\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_ERROR, payload: { key: 'druhy', error: error.message } });\n            return { key: 'druhy', success: false, error };\n          }\n        })(),\n\n        // 6. LP Kdy (limitovan pslby)\n        (async () => {\n          if (signal.aborted) return { key: 'lpKody', success: false, cancelled: true };\n          try {\n            dispatch({ type: DICTIONARIES_ACTIONS.START_LOADING, payload: { key: 'lpKody' } });\n            const lpKody = await fetchLimitovanePrisliby({ token, username }); //  TODO: API nepodporuje signal zatm\n            if (signal.aborted) return { key: 'lpKody', success: false, cancelled: true };\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_LP_KODY, payload: lpKody || [] });\n            return { key: 'lpKody', success: true };\n          } catch (error) {\n            if (error.name === 'AbortError' || signal.aborted) {\n              return { key: 'lpKody', success: false, cancelled: true };\n            }\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_ERROR, payload: { key: 'lpKody', error: error.message } });\n            return { key: 'lpKody', success: false, error };\n          }\n        })(),\n\n        // 7. Typy ploh\n        (async () => {\n          if (signal.aborted) return { key: 'prilohyTypy', success: false, cancelled: true };\n          try {\n            dispatch({ type: DICTIONARIES_ACTIONS.START_LOADING, payload: { key: 'prilohyTypy' } });\n            const prilohyTypy = await getTypyPriloh25({ token, username }); //  TODO: API nepodporuje signal zatm\n            if (signal.aborted) return { key: 'prilohyTypy', success: false, cancelled: true };\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_PRILOHY_TYPY, payload: prilohyTypy || [] });\n            return { key: 'prilohyTypy', success: true };\n          } catch (error) {\n            if (error.name === 'AbortError' || signal.aborted) {\n              return { key: 'prilohyTypy', success: false, cancelled: true };\n            }\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_ERROR, payload: { key: 'prilohyTypy', error: error.message } });\n            return { key: 'prilohyTypy', success: false, error };\n          }\n        })(),\n\n        // 8. Typy faktur\n        (async () => {\n          if (signal.aborted) return { key: 'typyFaktur', success: false, cancelled: true };\n          try {\n            dispatch({ type: DICTIONARIES_ACTIONS.START_LOADING, payload: { key: 'typyFaktur' } });\n            const typyFaktur = await getTypyFaktur25({ token, username }); //  TODO: API nepodporuje signal zatm\n            if (signal.aborted) return { key: 'typyFaktur', success: false, cancelled: true };\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_TYPY_FAKTUR, payload: typyFaktur || [] });\n            return { key: 'typyFaktur', success: true };\n          } catch (error) {\n            if (error.name === 'AbortError' || signal.aborted) {\n              return { key: 'typyFaktur', success: false, cancelled: true };\n            }\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_ERROR, payload: { key: 'typyFaktur', error: error.message } });\n            return { key: 'typyFaktur', success: false, error };\n          }\n        })(),\n\n        // 9. Stavy workflow (selnk OBJEDNAVKA)\n        (async () => {\n          if (signal.aborted) return { key: 'stavyWorkflow', success: false, cancelled: true };\n          try {\n            dispatch({ type: DICTIONARIES_ACTIONS.START_LOADING, payload: { key: 'stavyWorkflow' } });\n            const stavyWorkflow = await getStavyWorkflow25({ token, username }); //  TODO: API nepodporuje signal zatm\n            if (signal.aborted) return { key: 'stavyWorkflow', success: false, cancelled: true };\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_STAVY_WORKFLOW, payload: stavyWorkflow || {} });\n            return { key: 'stavyWorkflow', success: true };\n          } catch (error) {\n            if (error.name === 'AbortError' || signal.aborted) {\n              return { key: 'stavyWorkflow', success: false, cancelled: true };\n            }\n            dispatch({ type: DICTIONARIES_ACTIONS.SET_ERROR, payload: { key: 'stavyWorkflow', error: error.message } });\n            return { key: 'stavyWorkflow', success: false, error };\n          }\n        })()\n      ]);\n\n      // Vyhodnocen vsledk (ignorovat cancelled)\n      const successful = results.filter(r =>\n        r.status === 'fulfilled' &&\n        r.value.success &&\n        !r.value.cancelled\n      ).length;\n\n      const failed = results.filter(r =>\n        r.status === 'rejected' ||\n        (r.status === 'fulfilled' && !r.value.success && !r.value.cancelled)\n      ).length;\n\n      const cancelled = results.filter(r =>\n        r.status === 'fulfilled' && r.value.cancelled\n      ).length;\n\n      //  DEBUG: Log kter dictionary bylo cancelled\n      results.forEach((r, index) => {\n        if (r.status === 'fulfilled' && r.value.cancelled) {\n        }\n      });\n      //  KRITICK KONTROLA: Pokud jsou cancelled users nebo approvers, NEOZNAIT jako hotov\n      const criticalCancelled = results.some(r =>\n        r.status === 'fulfilled' &&\n        r.value.cancelled &&\n        (r.value.key === 'users' || r.value.key === 'approvers')\n      );\n\n      if (criticalCancelled) {\n        // NEvyeit promise - lifecycle zstane v LOADING_DICTIONARIES\n        return false;\n      }\n\n      // Oznait jako hotov (i kdy nkter failovaly - formul by ml bt pouiteln)\n      dispatch({ type: DICTIONARIES_ACTIONS.ALL_LOADED });\n\n      //  FIX: Resolve promise VDY po dokonen natn (i kdy pozdji abort)\n      // Jinak se lifecycle nikdy nedostane z LOADING_DICTIONARIES fze\n      if (resolveRef.current) {\n        resolveRef.current(true);\n      }\n\n      //  Final check pokud mezitm nebylo cancelled (ale promise u je resolved)\n      // Disabled - signal.aborted je vdy false\n      // if (signal.aborted) {\n      //   return false;\n      // }\n\n      return true;\n    } catch (error) {\n      // Kontrola jestli to nen cancel error - DISABLED\n      // if (error.name === 'AbortError' || abortControllerRef.current?.signal.aborted) {\n      //   return false;\n      // }\n\n      if (resolveRef.current) {\n        resolveRef.current(false);\n      }\n      return false;\n    } finally {\n      loadingRef.current = false;\n    }\n  }, [token, username]);\n\n  // Auto-load pokud je enabled\n  const loadAllRef = useRef();\n  loadAllRef.current = loadAll;\n\n  useEffect(() => {\n    if (enabled && token && username && !state.isReady && !loadingRef.current) {\n      loadAllRef.current();\n    }\n  }, [enabled, token, username, state.isReady]); //  FIX: Use ref to avoid loadAll dependency loop\n\n  //  Cleanup - abort vechny pending requesty pi unmount\n  useEffect(() => {\n    return () => {\n      //  Cleanup DISABLED - zpsobuje problmy s StrictMode\n      // Nechej requesty dokonit, AbortController nen poteba pro tento use case\n      // if (abortControllerRef.current) {\n      //   abortControllerRef.current.abort();\n      // }\n    };\n  }, []);\n\n  return {\n    // State\n    ...state,\n\n    // Functions\n    loadAll,\n\n    // Abort function pro manuln cancel\n    abort: () => {\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n      }\n    },\n\n    // Promise pro await v jinch hookch\n    readyPromise: promiseRef.current\n  };\n};\n","/**\n *  useOrderDataLoader Hook\n * Nat data objednvky z DB a transformuje je pro formul\n *\n *  V2 API Migration: Uses Order V2 API with standardized data types\n * - strediska_kod: string[] (array of codes)\n * - financovani: {typ, nazev, lp_kody?}\n * - druh_objednavky_kod: string\n * - max_cena_s_dph: string (for precision)\n */\n\nimport { useState, useCallback, useRef } from 'react';\nimport { getOrderV2, getNextOrderNumberV2 } from '../../../services/apiOrderV2'; //  V2 API\nimport { WORKFLOW_STATES } from '../../../constants/workflow25';\n\nexport const useOrderDataLoader = ({ token, username, dictionaries }) => {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const loadingRef = useRef(false);\n\n  /**\n   * Helper: Extrahovn enriched user dat z backendu\n   */\n  const extractEnrichedUserData = useCallback((enrichedUser) => {\n    if (!enrichedUser) return null;\n\n    const titul_pred = enrichedUser.titul_pred || '';\n    const jmeno = enrichedUser.jmeno || '';\n    const prijmeni = enrichedUser.prijmeni || '';\n    const titul_za = enrichedUser.titul_za || '';\n\n    const displayName = `${titul_pred ? titul_pred + ' ' : ''}${jmeno} ${prijmeni}${titul_za ? ', ' + titul_za : ''}`.trim();\n\n    return {\n      displayName,\n      email: enrichedUser.email || '',\n      telefon: enrichedUser.telefon || ''\n    };\n  }, []);\n\n  /**\n   * Helper: Transformace dat z DB do formtu formule\n   *\n   *  V2 API: Backend u posl standardizovan formt:\n   * - strediska_kod: string[] (ne objekty!)\n   * - financovani: {typ, nazev, lp_kody} (ne kod_stavu!)\n   * - druh_objednavky_kod: string (ne objekt!)\n   * - max_cena_s_dph: string (ne number!)\n   *\n   *  V2 API /enriched endpoint:\n   * - Posl _enriched.objednatel data (user info)\n   * - Nen poteba fallback na dictionaries.data.allUsers\n   */\n  const transformOrderData = useCallback((dbOrder, dictionaries) => {\n    if (!dbOrder) return null;\n\n    // Doplnit daje objednatele z _enriched (V2 API /enriched endpoint)\n    let objednatelData = {};\n    if (dbOrder.objednatel_id) {\n      // V2 /enriched endpoint: Data pijdou v _enriched.objednatel\n      if (dbOrder._enriched?.objednatel) {\n        const enriched = extractEnrichedUserData(dbOrder._enriched.objednatel);\n        if (enriched) {\n          objednatelData = {\n            jmeno: enriched.displayName,\n            email: enriched.email,\n            telefon: enriched.telefon\n          };\n        }\n      }\n\n      // Fallback na selnk jen pokud enriched data chyb\n      if (!objednatelData.jmeno && dictionaries?.data?.allUsers) {\n        const objednatel = dictionaries.data.allUsers.find(u =>\n          (u.id && u.id === dbOrder.objednatel_id) ||\n          (u.user_id && u.user_id === dbOrder.objednatel_id)\n        );\n\n        if (objednatel) {\n          const titul_pred_str = objednatel.titul_pred ? objednatel.titul_pred + ' ' : '';\n          const jmeno_str = objednatel.jmeno || '';\n          const prijmeni_str = objednatel.prijmeni || '';\n          const titul_za_str = objednatel.titul_za ? ', ' + objednatel.titul_za : '';\n          const displayName = `${titul_pred_str}${jmeno_str} ${prijmeni_str}${titul_za_str}`.replace(/\\s+/g, ' ').trim();\n\n          objednatelData = {\n            jmeno: displayName || objednatel.username || '',\n            email: objednatel.email || '',\n            telefon: objednatel.telefon || ''\n          };\n        }\n      }\n    }\n\n    //  V2 API: Stediska jsou u array string [\"KLADNO\", \"PRAHA\"]\n    const strediskaKod = (() => {\n      // Backend V2 vrac u sprvn formt\n      if (Array.isArray(dbOrder.strediska_kod)) {\n        const result = dbOrder.strediska_kod.map(kod => String(kod).toUpperCase());\n        return result;\n      }\n      // Fallback: enriched data (pro kompatibilitu se starm API)\n      if (dbOrder._enriched?.strediska && Array.isArray(dbOrder._enriched.strediska)) {\n        const result = dbOrder._enriched.strediska.map(s => s.kod.toUpperCase());\n        return result;\n      }\n      return [];\n    })();\n\n    //  V2 API: Financovn je {typ, nazev, lp_kody}\n    const zpusobFinancovani = (() => {\n      // Backend V2 vrac {typ: \"LP\", nazev: \"...\", lp_kody: [...]}\n      if (dbOrder.financovani && typeof dbOrder.financovani === 'object') {\n        return dbOrder.financovani.typ || '';\n      }\n      // Fallback pro star formt (bhem migrace)\n      if (dbOrder.financovani && typeof dbOrder.financovani === 'string') {\n        try {\n          const parsed = JSON.parse(dbOrder.financovani);\n          return parsed.typ || parsed.kod_stavu || '';\n        } catch (e) {\n          return dbOrder.zpusob_financovani || '';\n        }\n      }\n      return dbOrder.zpusob_financovani || '';\n    })();\n\n    //  V2 API: Vnoen data financovn\n    let financovaniVnorena = {};\n    if (dbOrder.financovani && typeof dbOrder.financovani === 'object') {\n      financovaniVnorena = {\n        lp_kod: dbOrder.financovani.lp_kody || [], // V2 pouv \"lp_kody\"\n        lp_nazev: dbOrder.financovani.nazev || '', // Nzev LP\n        // Dal pole (pokud existuj)\n        paragraf: dbOrder.financovani.paragraf || '',\n        polozka: dbOrder.financovani.polozka || '',\n        investice: dbOrder.financovani.investice || '',\n        //  SMLOUVA - slo a poznmka (nataj se z root objektu, fallback na financovani)\n        cislo_smlouvy: dbOrder.cislo_smlouvy || dbOrder.financovani.cislo_smlouvy || '',\n        smlouva_poznamka: dbOrder.smlouva_poznamka || dbOrder.financovani.smlouva_poznamka || ''\n      };\n    }\n\n    //  INDIVIDULN SCHVLEN a POJISTN UDLOST - natat z root objektu (stejn jako cislo_smlouvy)\n    const individualni_schvaleni = dbOrder.individualni_schvaleni \n      ? String(dbOrder.individualni_schvaleni)\n      : (dbOrder.financovani?.individualni_schvaleni ? String(dbOrder.financovani.individualni_schvaleni) : '');\n    const individualni_poznamka = dbOrder.individualni_poznamka || dbOrder.financovani?.individualni_poznamka || '';\n    const pojistna_udalost_cislo = dbOrder.pojistna_udalost_cislo || dbOrder.financovani?.pojistna_udalost_cislo || '';\n    const pojistna_udalost_poznamka = dbOrder.pojistna_udalost_poznamka || dbOrder.financovani?.pojistna_udalost_poznamka || '';\n\n    //  V2 API: Druh objednvky je string \"AUTA\"\n    const druhObjednavky = (() => {\n      // Backend V2 vrac u jen string\n      if (typeof dbOrder.druh_objednavky_kod === 'string') {\n        return dbOrder.druh_objednavky_kod;\n      }\n      // Fallback pro star formt (bhem migrace)\n      if (dbOrder.druh_objednavky_kod && typeof dbOrder.druh_objednavky_kod === 'object') {\n        return dbOrder.druh_objednavky_kod.kod_stavu || dbOrder.druh_objednavky_kod.kod || '';\n      }\n      return '';\n    })();\n\n    //  Stav objednvky - pevst workflow kd na text\n    const stavObjednavky = (() => {\n      try {\n        // Parsuj workflow stavy (me bt array nebo JSON string)\n        const stavyArray = Array.isArray(dbOrder.stav_workflow_kod)\n          ? dbOrder.stav_workflow_kod\n          : JSON.parse(dbOrder.stav_workflow_kod || '[\"NOVA\"]');\n\n        if (!Array.isArray(stavyArray) || stavyArray.length === 0) {\n          return 'Nov';\n        }\n\n        // Zskej posledn (nejvznamnj) stav\n        const poslednSta = stavyArray[stavyArray.length - 1];\n        const stavInfo = WORKFLOW_STATES[poslednSta];\n\n        if (stavInfo) {\n          return stavInfo.name;\n        }\n\n        // Fallback\n        return poslednSta || 'Nov';\n      } catch (e) {\n        return 'Nov';\n      }\n    })();\n\n    // Transformovan data\n    const transformedData = {\n      ...dbOrder,\n      ...objednatelData,\n      id: dbOrder.id,\n      ev_cislo: dbOrder.cislo_objednavky || dbOrder.ev_cislo,\n      stav_workflow_kod: dbOrder.stav_workflow_kod || 'NOVA',\n      stav_objednavky: stavObjednavky, //  Textov popis stavu\n      mimoradna_udalost: dbOrder.mimoradna_udalost || false, // Mimodn udlost\n\n      //  Detekce stav checkbox podle workflow\n      // ODESLANA: stav obsahuje \"ODESLANA\" + dt_odeslani != null + odesilatel_id != null\n      stav_odeslano: (() => {\n        try {\n          const stavyArray = Array.isArray(dbOrder.stav_workflow_kod)\n            ? dbOrder.stav_workflow_kod\n            : JSON.parse(dbOrder.stav_workflow_kod || '[]');\n          const maOdeslanu = Array.isArray(stavyArray) && stavyArray.includes('ODESLANA');\n          const maDatum = !!dbOrder.dt_odeslani;\n          const maOdesilatele = !!dbOrder.odesilatel_id;\n          return maOdeslanu && maDatum && maOdesilatele;\n        } catch (e) {\n          return false;\n        }\n      })(),\n\n      // STORNOVANA: stav obsahuje \"STORNOVANA\"\n      stav_stornovano: (() => {\n        try {\n          const stavyArray = Array.isArray(dbOrder.stav_workflow_kod)\n            ? dbOrder.stav_workflow_kod\n            : JSON.parse(dbOrder.stav_workflow_kod || '[]');\n          return Array.isArray(stavyArray) && stavyArray.includes('STORNOVANA');\n        } catch (e) {\n          return false;\n        }\n      })(),\n\n      //  FZE 1: Stav schvlen (UI helper odvozen ze workflow stav)\n      //  Checkbox se zobrazuje pro vechny stavy KROM \"NOVA\"\n      // Mapovn stav: SCHVALENA  'schvaleno', ZAMITNUTA  'neschvaleno', CEKA_SE  'ceka_se'\n      // Pro ostatn stavy (ODESLAN_KE_SCHVALENI apod.)  checkbox zstane przdn\n      stav_schvaleni: (() => {\n        try {\n          const stavyArray = Array.isArray(dbOrder.stav_workflow_kod)\n            ? dbOrder.stav_workflow_kod\n            : JSON.parse(dbOrder.stav_workflow_kod || '[]');\n\n          if (!Array.isArray(stavyArray)) return '';\n\n          //  Mapovn workflow stav na UI checkbox hodnoty\n          if (stavyArray.includes('SCHVALENA')) {\n            return 'schvaleno';\n          } else if (stavyArray.includes('ZAMITNUTA')) {\n            return 'neschvaleno';\n          } else if (stavyArray.includes('CEKA_SE')) {\n            return 'ceka_se';\n          }\n\n          // ODESLAN_KE_SCHVALENI nebo jin  checkbox zstane przdn (ale zobraz se)\n          return '';\n        } catch (e) {\n          return '';\n        }\n      })(),\n\n      // Datumov pole\n      datum_odeslani: dbOrder.dt_odeslani || dbOrder.dt_odeslano ? (dbOrder.dt_odeslani || dbOrder.dt_odeslano).split(' ')[0] : '',\n      datum_storna: dbOrder.dt_odeslani || dbOrder.dt_odeslano ? (dbOrder.dt_odeslani || dbOrder.dt_odeslano).split(' ')[0] : '',\n      dt_akceptace: dbOrder.dt_akceptace ? dbOrder.dt_akceptace.split(' ')[0] : '',\n      datum_vytvoreni: dbOrder.dt_vytvoreni ? dbOrder.dt_vytvoreni.split(' ')[0] : '',\n      datum_splatnosti: dbOrder.dt_splatnost ? dbOrder.dt_splatnost.split(' ')[0] : '',\n      temp_datum_objednavky: dbOrder.datum_objednavky ? dbOrder.datum_objednavky.split(' ')[0] : (dbOrder.dt_objednavky ? dbOrder.dt_objednavky.split(' ')[0] : ''),\n\n      // Workflow tracking pole\n      odesilatel_id: dbOrder.odesilatel_id || null,\n      dodavatel_potvrdil_id: dbOrder.dodavatel_potvrdil_id || null,\n      zverejnil_id: dbOrder.zverejnil_id || null,\n      dt_zverejneni_potvrzeni: dbOrder.dt_zverejneni_potvrzeni ? dbOrder.dt_zverejneni_potvrzeni.split(' ')[0] : '',\n      potvrdil_vecnou_spravnost_id: dbOrder.potvrdil_vecnou_spravnost_id || null,\n      dt_potvrzeni_vecne_spravnosti: dbOrder.dt_potvrzeni_vecne_spravnosti || '',\n      potvrzeni_vecne_spravnosti: (() => {\n        const rawValue = dbOrder.potvrzeni_vecne_spravnosti;\n        // Handle boolean from V2 API\n        if (typeof rawValue === 'boolean') return rawValue ? 1 : 0;\n        // Handle number\n        if (typeof rawValue === 'number') return rawValue;\n        // Handle string\n        if (typeof rawValue === 'string') return parseInt(rawValue, 10) || 0;\n        // Default\n        return 0;\n      })(),\n      vecna_spravnost_umisteni_majetku: dbOrder.vecna_spravnost_umisteni_majetku || '',\n      vecna_spravnost_poznamka: dbOrder.vecna_spravnost_poznamka || '',\n      fakturant_id: dbOrder.fakturant_id || null,\n      dt_faktura_pridana: dbOrder.dt_faktura_pridana || '',\n      dokoncil_id: dbOrder.dokoncil_id || null,\n      dt_dokonceni: dbOrder.dt_dokonceni || '',\n      dokonceni_poznamka: dbOrder.dokonceni_poznamka || '',\n      potvrzeni_dokonceni_objednavky: (() => {\n        const rawValue = dbOrder.potvrzeni_dokonceni_objednavky;\n        // Handle boolean from V2 API\n        if (typeof rawValue === 'boolean') return rawValue ? 1 : 0;\n        // Handle number\n        if (typeof rawValue === 'number') return rawValue;\n        // Handle string\n        if (typeof rawValue === 'string') return parseInt(rawValue, 10) || 0;\n        // Default\n        return 0;\n      })(),\n\n      //  V2 API: Stediska a financovn v novm formtu\n      strediska_kod: strediskaKod,\n      zpusob_financovani: zpusobFinancovani,\n      ...financovaniVnorena,\n      \n      //  INDIVIDULN SCHVLEN a POJISTN UDLOST - z root objektu\n      individualni_schvaleni,\n      individualni_poznamka,\n      pojistna_udalost_cislo,\n      pojistna_udalost_poznamka,\n\n      //  V2 API: Druh objednvky jako string\n      druh_objednavky_kod: druhObjednavky,\n\n      // Poloky objednvky - backend posl jako 'polozky', frontend pouv 'polozky_objednavky'\n      polozky_objednavky: Array.isArray(dbOrder.polozky) ? dbOrder.polozky : [],\n\n      //  FAKTURY: Mapovn DB -> FE (fa_datum_splatnosti -> fa_splatnost)\n      faktury: (() => {\n        if (!Array.isArray(dbOrder.faktury)) return [];\n\n        return dbOrder.faktury.map(faktura => ({\n          ...faktura,\n          //  MAPOVN 1:1 mezi DB sloupci a FE poli\n          fa_dorucena: faktura.fa_datum_doruceni ? 1 : 0, //  Boolean flag zda m datum doruen\n          fa_splatnost: faktura.fa_datum_splatnosti ? faktura.fa_datum_splatnosti.split(' ')[0] : '', //  DB -> FE: fa_datum_splatnosti -> fa_splatnost\n          //  Zachovat originln DB pole pro API odesln\n          fa_datum_doruceni: faktura.fa_datum_doruceni,\n          fa_datum_splatnosti: faktura.fa_datum_splatnosti,\n          fa_datum_vystaveni: faktura.fa_datum_vystaveni\n          //  VCN SPRVNOST: 1:1 mapovn - dn pejmenovvn pol!\n          // vecna_spravnost_umisteni_majetku, vecna_spravnost_poznamka, vecna_spravnost_potvrzeno,\n          // potvrdil_vecnou_spravnost_id, dt_potvrzeni_vecne_spravnosti - ve 1:1 z DB\n        }));\n      })(),\n\n      //  V2 API: Dodavatel zpsob potvrzen {zpusob_potvrzeni[], zpusob_platby}\n      dodavatel_zpusob_potvrzeni: (() => {\n        try {\n          //  ANO = pokud existuje dt_akceptace A dodavatel_potvrdil_id (bez ohledu na dodavatel_zpusob_potvrzeni)\n          const maAkceptaci = !!(dbOrder.dt_akceptace && dbOrder.dodavatel_potvrdil_id);\n\n          // Kontrola przdn hodnoty\n          if (!dbOrder.dodavatel_zpusob_potvrzeni ||\n              dbOrder.dodavatel_zpusob_potvrzeni === '' ||\n              (typeof dbOrder.dodavatel_zpusob_potvrzeni === 'string' && dbOrder.dodavatel_zpusob_potvrzeni.trim() === '')) {\n            // Pokud mme dt_akceptace + dodavatel_potvrdil_id, ale chyb dodavatel_zpusob_potvrzeni -> ANO s przdnmi daty\n            if (maAkceptaci) {\n              return {\n                potvrzeni: 'ANO',\n                zpusoby: [],\n                platba: 'faktura' // vdy faktura (pevn nastaveno)\n              };\n            }\n            // Jinak NE\n            return {\n              potvrzeni: 'NE',\n              zpusoby: [],\n              platba: 'faktura' // vdy faktura (pevn nastaveno)\n            };\n          }\n\n          if (typeof dbOrder.dodavatel_zpusob_potvrzeni === 'object') {\n            //  BE formt: {potvrzeno: true, zpusoby: [], platba: \"\"}\n            // NEBO star formt BEZ potvrzeno: {zpusoby: [], platba: \"\"}\n            const beData = dbOrder.dodavatel_zpusob_potvrzeni;\n\n            //  FALLBACK: Pokud DB neobsahuje 'potvrzeno', odvo z dt_akceptace\n            const potvrzenoValue = beData.potvrzeno !== undefined\n              ? beData.potvrzeno          // DB m potvrzeno\n              : maAkceptaci;              // DB nem  odvozeno z dt_akceptace\n\n            return {\n              potvrzeni: potvrzenoValue ? 'ANO' : 'NE',\n              //  OPRAVA: zpusoby (mnon slo!) - DB vrac \"zpusoby\" ne \"zpusob\"\n              zpusoby: beData.zpusoby || beData.zpusob || beData.zpusob_potvrzeni || [],\n              platba: 'faktura' // vdy faktura (pevn nastaveno)\n            };\n          } else if (typeof dbOrder.dodavatel_zpusob_potvrzeni === 'string') {\n            // Star formt (fallback bhem migrace) - parsuj jen neprzdn string\n            const trimmed = dbOrder.dodavatel_zpusob_potvrzeni.trim();\n            if (trimmed.length === 0) {\n              return {\n                potvrzeni: 'NE',\n                zpusoby: [],\n                platba: ''\n              };\n            }\n\n            const parsed = JSON.parse(trimmed);\n            //  FALLBACK: Pokud DB nem 'potvrzeno', odvo z dt_akceptace\n            const potvrzenoValue = parsed.potvrzeno !== undefined\n              ? parsed.potvrzeno    // DB m potvrzeno\n              : maAkceptaci;        // DB nem  odvozeno z dt_akceptace\n\n            return {\n              potvrzeni: potvrzenoValue ? 'ANO' : 'NE',\n              //  OPRAVA: zpusoby (mnon slo!) - DB vrac \"zpusoby\" ne \"zpusob\"\n              zpusoby: parsed.zpusoby || parsed.zpusob || parsed.zpusob_potvrzeni || [],\n              platba: 'faktura' // vdy faktura (pevn nastaveno)\n            };\n          } else {\n            // Default - NE\n            return {\n              potvrzeni: 'NE',\n              zpusoby: [],\n              platba: 'faktura' // vdy faktura (pevn nastaveno)\n            };\n          }\n        } catch (e) {\n          return {\n            potvrzeni: 'NE',\n            zpusoby: [],\n            platba: ''\n          };\n        }\n      })()\n    };\n\n    //  ARCHIVOVAN OBJEDNVKY - speciln pravidla\n    // Detekce archivovan objednvky (stav workflow)\n    const currentStates = Array.isArray(transformedData.stav_workflow_kod)\n      ? transformedData.stav_workflow_kod\n      : (transformedData.stav_workflow_kod ? [transformedData.stav_workflow_kod] : []);\n\n    //  KRITICK: Detekovat podle PVODN DB hodnoty stav_objednavky, NE podle transformovan!\n    const isArchived = dbOrder.stav_objednavky === 'ARCHIVOVANO' ||\n                       dbOrder.stav_objednavky === 'Archivovno' ||\n                       currentStates.includes('ARCHIVOVANO');\n\n    if (isArchived) {\n\n      // 1. Nastav workflow stav pouze na ARCHIVOVANO (NESM SE PEPSAT!)\n      transformedData.stav_workflow_kod = ['ARCHIVOVANO'];\n      transformedData.stav_objednavky = 'Archivovno';\n\n      // 2. Nastav vechny dokonen fze jako completed\n      transformedData.stav_odeslano = true;\n      transformedData.stav_schvaleni = 'schvaleno';\n\n      // 3. Pokud m \"m bt zveejnna\", ozna jako zveejnnou\n      if (transformedData.ma_byt_zverejnena || transformedData.ma_byt_zverejnena === 1) {\n        transformedData.dt_zverejneni = transformedData.dt_zverejneni || new Date().toISOString().split('T')[0];\n      }\n\n      // 4. Nastav jako zkontrolovno\n      transformedData.potvrzeni_vecne_spravnosti = 1;\n\n      // 5. Normalizuj pkazce a schvalovatele na string (vetn '0' pro SYSTEM)\n      if (transformedData.prikazce_id === 0 || transformedData.prikazce_id === null || transformedData.prikazce_id === '') {\n        transformedData.prikazce_id = '0'; // SYSTEM\n      } else if (transformedData.prikazce_id) {\n        transformedData.prikazce_id = String(transformedData.prikazce_id);\n      }\n\n      if (transformedData.schvalovatel_id === 0 || transformedData.schvalovatel_id === null || transformedData.schvalovatel_id === '') {\n        transformedData.schvalovatel_id = '0'; // SYSTEM\n      } else if (transformedData.schvalovatel_id) {\n        transformedData.schvalovatel_id = String(transformedData.schvalovatel_id);\n      }\n\n    } else {\n      //  BN OBJEDNVKY - dn speciln logika, jen normalizace ID na string\n      if (transformedData.prikazce_id !== null && transformedData.prikazce_id !== undefined && transformedData.prikazce_id !== '') {\n        transformedData.prikazce_id = String(transformedData.prikazce_id);\n      }\n\n      if (transformedData.schvalovatel_id !== null && transformedData.schvalovatel_id !== undefined && transformedData.schvalovatel_id !== '') {\n        transformedData.schvalovatel_id = String(transformedData.schvalovatel_id);\n      }\n    }\n\n    return transformedData;\n  }, [extractEnrichedUserData]);\n\n  /**\n    // Detekce archivovan objednvky (URL param nebo stav workflow)\n    const currentStates = Array.isArray(transformedData.stav_workflow_kod)\n      ? transformedData.stav_workflow_kod\n      : (transformedData.stav_workflow_kod ? [transformedData.stav_workflow_kod] : []);\n\n    const isArchived = transformedData.archivovano === 1 ||\n                       transformedData.archivovano === '1' ||\n                       currentStates.includes('ARCHIVOVANO') ||\n                       transformedData.stav_objednavky === 'ARCHIVOVANO' ||\n                       transformedData.stav_objednavky === 'Archivovno';\n\n    if (isArchived) {\n      console.log(' Detekovna ARCHIVOVAN objednvka - aplikuji speciln pravidla');\n\n      // 1. Nastav workflow stav pouze na ARCHIVOVANO (NESM SE PEPSAT!)\n      transformedData.stav_workflow_kod = ['ARCHIVOVANO'];\n      transformedData.stav_objednavky = 'Archivovno';\n\n      // 2. Nastav vechny dokonen fze jako completed\n      transformedData.stav_odeslano = true;\n      transformedData.stav_schvaleni = 'schvaleno';\n\n      // 3. Pokud m \"m bt zveejnna\", ozna jako zveejnnou\n      if (transformedData.ma_byt_zverejnena || transformedData.ma_byt_zverejnena === 1) {\n        transformedData.dt_zverejneni = transformedData.dt_zverejneni || new Date().toISOString().split('T')[0];\n      }\n\n      // 4. Nastav jako zkontrolovno\n      transformedData.potvrzeni_vecne_spravnosti = 1;\n\n      // 5. Normalizuj pkazce a schvalovatele na '0' pokud chyb\n      if (!transformedData.prikazce_id ||\n          transformedData.prikazce_id === 0 ||\n          transformedData.prikazce_id === null) {\n        transformedData.prikazce_id = '0';\n      } else {\n        transformedData.prikazce_id = String(transformedData.prikazce_id);\n      }\n\n      if (!transformedData.schvalovatel_id ||\n          transformedData.schvalovatel_id === 0 ||\n          transformedData.schvalovatel_id === null) {\n        transformedData.schvalovatel_id = '0';\n      } else {\n        transformedData.schvalovatel_id = String(transformedData.schvalovatel_id);\n      }\n\n    } else {\n      //  PRIORITA 2: BN OBJEDNVKY - normalizace SYSTEM uivatel\n      let maSystemUzivatele = false;\n\n      // Pokud nen pkazce (null, undefined, '', 0), nastav SYSTEM (string '0')\n      if (!transformedData.prikazce_id ||\n          transformedData.prikazce_id === '' ||\n          transformedData.prikazce_id === null ||\n          transformedData.prikazce_id === 0 ||\n          transformedData.prikazce_id === '0') {\n        transformedData.prikazce_id = '0';\n        maSystemUzivatele = true;\n      } else {\n        // Zajisti e ID je string\n        transformedData.prikazce_id = String(transformedData.prikazce_id);\n      }\n\n      // Pokud nen schvalovatel (null, undefined, '', 0), nastav SYSTEM (string '0')\n      if (!transformedData.schvalovatel_id ||\n          transformedData.schvalovatel_id === '' ||\n          transformedData.schvalovatel_id === null ||\n          transformedData.schvalovatel_id === 0 ||\n          transformedData.schvalovatel_id === '0') {\n        transformedData.schvalovatel_id = '0';\n        maSystemUzivatele = true;\n      } else {\n        // Zajisti e ID je string\n        transformedData.schvalovatel_id = String(transformedData.schvalovatel_id);\n      }\n\n      // Pokud m SYSTEM uivatele, nastav workflow stavy na SCHVALENA + ROZPRACOVANA\n      if (maSystemUzivatele) {\n        transformedData.stav_workflow_kod = ['SCHVALENA', 'ROZPRACOVANA'];\n        transformedData.stav_objednavky = 'Schvlen';\n      }\n    }\n\n    console.log(' Po normalizaci:', {\n      prikazce_id: transformedData.prikazce_id,\n      prikazce_id_type: typeof transformedData.prikazce_id,\n      schvalovatel_id: transformedData.schvalovatel_id,\n      schvalovatel_id_type: typeof transformedData.schvalovatel_id,\n      stav_workflow_kod: transformedData.stav_workflow_kod,\n      stav_objednavky: transformedData.stav_objednavky\n    });\n\n    return transformedData;\n  }, [extractEnrichedUserData]);\n\n  /**\n   *  Naten objednvky pro EDIT reim\n   *\n   *  V2 API Migration: Uses getOrderV2() instead of getOrder25()\n   */\n  const loadOrderForEdit = useCallback(async ({ orderId, archivovano = 0 }) => {\n    if (!token || !username) {\n      console.error(' [useOrderDataLoader] Missing token or username!');\n      throw new Error('Missing token or username');\n    }\n\n    //  NOTE: dictionaries.isReady check REMOVED\n    // Reason: Closure captures old dictionaries state\n    // Check is now done in useFormController with polling\n    // See: useFormController.js lines 63-83\n\n    if (loadingRef.current) {\n      // Already loading - skip duplicate call\n      return null;\n    }\n\n    loadingRef.current = true;\n    setLoading(true);\n    setError(null);\n\n    try {\n      // console.log(' [useOrderDataLoader] Volm getOrderV2 pro orderId:', orderId);\n      //  V2 API: Use getOrderV2() - returns standardized data with enriched=true\n      const dbOrder = await getOrderV2(orderId, token, username, true); //  enriched=true pro financovani.lp_nazvy\n      // console.log(' [useOrderDataLoader] Obdrel jsem dbOrder:', dbOrder);\n\n      if (!dbOrder) {\n        console.error(' [useOrderDataLoader] dbOrder is null!');\n        throw new Error(`Order ${orderId} not found`);\n      }\n\n      const transformedData = transformOrderData(dbOrder, dictionaries);\n      // console.log(' [useOrderDataLoader] Transformovan data:', transformedData);\n      return transformedData;\n    } catch (err) {\n      console.error(' [useOrderDataLoader] Error in loadOrderForEdit:', err);\n      setError(err.message);\n      throw err;\n    } finally {\n      setLoading(false);\n      loadingRef.current = false;\n    }\n  }, [token, username, dictionaries, transformOrderData]);\n\n  /**\n   *  Naten objednvky pro COPY reim\n   */\n  const loadOrderForCopy = useCallback(async ({ orderId, archivovano = 0, userId }) => {\n    if (!token || !username) {\n      throw new Error('Missing token or username');\n    }\n\n    //  NOTE: dictionaries.isReady check REMOVED\n    // Reason: Closure captures old dictionaries state\n    // Check is now done in useFormController with polling\n    // See: useFormController.js lines 63-83\n\n    if (loadingRef.current) {\n      // Already loading - skip duplicate call\n      return null;\n    }\n\n    loadingRef.current = true;\n    setLoading(true);\n    setError(null);\n\n    try {\n      // Nati zdrojovou objednvku -  V2 API\n      const dbOrder = await getOrderV2(\n        orderId,\n        token,\n        username,\n        true // enriched = true\n      );\n\n      if (!dbOrder) {\n        throw new Error(`Order ${orderId} not found`);\n      }\n\n      // Zskej nov evidenn slo (pouze pro ZOBRAZEN) -  V2 API\n      const nextNumberResponse = await getNextOrderNumberV2(token, username);\n      // V2 API vrac: { data: { next_order_string, order_number_string, ... } }\n      //  DLEIT: Toto slo je POUZE pro ZOBRAZEN - neposl se v CREATE/UPDATE\n      const newEvCislo = nextNumberResponse?.order_number_string || nextNumberResponse?.next_order_string || nextNumberResponse?.next_number;\n\n      if (!newEvCislo) {\n        throw new Error('Failed to get new order number');\n      }\n\n      // Transformuj a reset pol pro kopii\n      const transformedData = transformOrderData(dbOrder, dictionaries);\n\n      const copiedOrder = {\n        ...transformedData,\n\n        // Reset ID a evidennho sla\n        id: null,\n        objednavka_id: null,\n        ev_cislo: newEvCislo,\n        temp_datum_objednavky: new Date().toISOString().split('T')[0],\n\n        // Reset workflow\n        stav_workflow_kod: 'NOVA',\n        schvalovatel_id: '',\n        dt_schvaleni: '',\n        schvaleni_komentar: '',\n\n        // Reset asovch raztek\n        datum_vytvoreni: '',\n        datum_posledni_zmeny: '',\n        vytvoril_uzivatel_id: userId,\n        uzivatel_id: userId,\n\n        // Reset stav\n        stav_odeslano: false,\n        datum_odeslani: '',\n        stav_stornovano: false,\n        datum_storna: '',\n\n        // Reset ploh a faktur\n        prilohy_dokumenty: [],\n        faktury: []\n      };\n\n      return { data: copiedOrder, sourceOrderId: orderId };\n    } catch (err) {\n      setError(err.message);\n      throw err;\n    } finally {\n      setLoading(false);\n      loadingRef.current = false;\n    }\n  }, [token, username, dictionaries, transformOrderData]);\n\n  return {\n    loading,\n    error,\n    loadOrderForEdit,\n    loadOrderForCopy\n  };\n};\n","/**\n *  useUIState Hook\n * Spravuje UI states - modals, dialogs, sections, atd.\n */\n\nimport { useReducer, useCallback } from 'react';\nimport {\n  uiReducer,\n  initialUIState,\n  UI_ACTIONS\n} from '../reducers';\n\nexport const useUIState = () => {\n  const [state, dispatch] = useReducer(uiReducer, initialUIState);\n\n  // Modals\n  const openModal = useCallback((modalKey) => {\n    dispatch({ type: UI_ACTIONS.OPEN_MODAL, payload: modalKey });\n  }, []);\n\n  const closeModal = useCallback((modalKey) => {\n    dispatch({ type: UI_ACTIONS.CLOSE_MODAL, payload: modalKey });\n  }, []);\n\n  const closeAllModals = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.CLOSE_ALL_MODALS });\n  }, []);\n\n  // Dropdowns\n  const toggleDropdown = useCallback((dropdownKey) => {\n    dispatch({ type: UI_ACTIONS.TOGGLE_DROPDOWN, payload: dropdownKey });\n  }, []);\n\n  const closeAllDropdowns = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.CLOSE_ALL_DROPDOWNS });\n  }, []);\n\n  // Sections\n  const collapseSection = useCallback((sectionKey) => {\n    dispatch({ type: UI_ACTIONS.COLLAPSE_SECTION, payload: sectionKey });\n  }, []);\n\n  const expandSection = useCallback((sectionKey) => {\n    dispatch({ type: UI_ACTIONS.EXPAND_SECTION, payload: sectionKey });\n  }, []);\n\n  const toggleSection = useCallback((sectionKey) => {\n    dispatch({ type: UI_ACTIONS.TOGGLE_SECTION, payload: sectionKey });\n  }, []);\n\n  const collapseAllSections = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.COLLAPSE_ALL_SECTIONS });\n  }, []);\n\n  const expandAllSections = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.EXPAND_ALL_SECTIONS });\n  }, []);\n\n  const lockSection = useCallback((sectionKey) => {\n    dispatch({ type: UI_ACTIONS.LOCK_SECTION, payload: sectionKey });\n  }, []);\n\n  const unlockSection = useCallback((sectionKey) => {\n    dispatch({ type: UI_ACTIONS.UNLOCK_SECTION, payload: sectionKey });\n  }, []);\n\n  // Select states\n  const setSelectState = useCallback((key, value) => {\n    dispatch({ type: UI_ACTIONS.SET_SELECT_STATE, payload: { key, value } });\n  }, []);\n\n  const setSearchState = useCallback((key, value) => {\n    dispatch({ type: UI_ACTIONS.SET_SEARCH_STATE, payload: { key, value } });\n  }, []);\n\n  // Fullscreen\n  const toggleFullscreen = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.TOGGLE_FULLSCREEN });\n  }, []);\n\n  const setFullscreen = useCallback((value) => {\n    dispatch({ type: UI_ACTIONS.SET_FULLSCREEN, payload: value });\n  }, []);\n\n  // Debug panel\n  const toggleDebug = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.TOGGLE_DEBUG });\n  }, []);\n\n  const pinDebug = useCallback((value) => {\n    dispatch({ type: UI_ACTIONS.PIN_DEBUG, payload: value });\n  }, []);\n\n  // Save progress\n  const setSaveProgress = useCallback((value, text) => {\n    dispatch({ type: UI_ACTIONS.SET_SAVE_PROGRESS, payload: { value, text } });\n  }, []);\n\n  const showSaveProgress = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.SHOW_SAVE_PROGRESS });\n  }, []);\n\n  const hideSaveProgress = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.HIDE_SAVE_PROGRESS });\n  }, []);\n\n  // ICO check\n  const setIcoCheckStatus = useCallback((status) => {\n    dispatch({ type: UI_ACTIONS.SET_ICO_CHECK_STATUS, payload: status });\n  }, []);\n\n  const setIcoCheckData = useCallback((data) => {\n    dispatch({ type: UI_ACTIONS.SET_ICO_CHECK_DATA, payload: data });\n  }, []);\n\n  // Drag & Drop\n  const setDragOver = useCallback((value) => {\n    dispatch({ type: UI_ACTIONS.SET_DRAG_OVER, payload: value });\n  }, []);\n\n  // Reset\n  const reset = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.RESET });\n  }, []);\n\n  return {\n    // State\n    modals: state.modals,\n    dropdowns: state.dropdowns,\n    sections: state.sections,\n    selectStates: state.selectStates,\n    searchStates: state.searchStates,\n    fullscreen: state.fullscreen,\n    areSectionsCollapsed: state.areSectionsCollapsed,\n    debug: state.debug,\n    saveProgress: state.saveProgress,\n    icoCheckStatus: state.icoCheckStatus,\n    icoCheckData: state.icoCheckData,\n    dragOver: state.dragOver,\n\n    // Actions\n    openModal,\n    closeModal,\n    closeAllModals,\n    toggleDropdown,\n    closeAllDropdowns,\n    collapseSection,\n    expandSection,\n    toggleSection,\n    collapseAllSections,\n    expandAllSections,\n    lockSection,\n    unlockSection,\n    setSelectState,\n    setSearchState,\n    toggleFullscreen,\n    setFullscreen,\n    toggleDebug,\n    pinDebug,\n    setSaveProgress,\n    showSaveProgress,\n    hideSaveProgress,\n    setIcoCheckStatus,\n    setIcoCheckData,\n    setDragOver,\n    reset\n  };\n};\n","/**\n * useWorkflowManager.js\n *\n *  CENTRALIZOVAN WORKFLOW MANAGER pro OrderForm25\n *\n * el:\n * - Jednotn logika pro uren aktuln fze objednvky (1-10)\n * - Generovn progress baru s fzemi\n * - Uren tma barev podle fze\n * - Eliminace duplicitn logiky v komponent\n *\n * @author Senior Developer\n * @date 31. jna 2025\n */\n\nimport { useMemo, useCallback, useState } from 'react';\n\n// Dedupe varovn (spam)  zapamatujeme si u vypsan varovn a vypeme je pouze jednou.\nconst _loggedWarnings = new Set();\nfunction warnOnce(id, msg, meta) {\n  try {\n    const key = id + '|' + (meta && typeof meta === 'object' ? JSON.stringify(meta) : String(meta));\n    if (_loggedWarnings.has(key)) return;\n    _loggedWarnings.add(key);\n  } catch (_err) {\n    // Pokud JSON.stringify sele, fallback na id-only kl\n    if (_loggedWarnings.has(id)) return;\n    _loggedWarnings.add(id);\n  }\n\n  if (typeof console !== 'undefined') {\n    if (console.error) console.error(msg, meta);\n    else if (console.warn) console.warn(msg, meta);\n  }\n}\n\n/**\n * Helper funkce pro parsovn workflow stav z JSON\n */\nconst parseWorkflowStates = (workflowCode) => {\n  if (!workflowCode) return ['ODESLANA_KE_SCHVALENI'];\n  if (typeof workflowCode === 'string') {\n    try {\n      const parsed = JSON.parse(workflowCode);\n      if (Array.isArray(parsed)) {\n        return parsed.length > 0 ? parsed : ['ODESLANA_KE_SCHVALENI'];\n      }\n      return [workflowCode];\n    } catch {\n      return [workflowCode];\n    }\n  }\n  const result = Array.isArray(workflowCode) ? workflowCode : [workflowCode];\n  return result.length > 0 ? result : ['ODESLANA_KE_SCHVALENI'];\n};\n\n/**\n * Helper funkce pro kontrolu ptomnosti workflow stavu\n */\nconst hasWorkflowState = (workflowCode, state) => {\n  const states = parseWorkflowStates(workflowCode);\n  const result = states.includes(state);\n\n  //  DEBUG: Log typu state parametru  vypisujeme pouze jednou pro stejn payload\n  if (typeof state !== 'string' || (typeof state === 'string' && state.includes(',')) || Array.isArray(state)) {\n    warnOnce('hasWorkflowState', ' [hasWorkflowState] CHYBA: state by ml bt string, ne pole!', {\n      state,\n      typeofState: typeof state,\n      isArray: Array.isArray(state),\n      workflowCode,\n      parsedStates: states\n    });\n  }\n\n  return result;\n};\n\n/**\n *  DEFINICE SEKC S JEJICH WORKFLOW VAZBAMI\n *\n * Kad sekce m:\n * - name: Lidsky iteln nzev\n * - phase: slo fze, kdy se sekce zobrazuje (null = vdy viditeln)\n * - visibilityLogic: Funkce urujc, zda je sekce VIDITELN (context) => boolean\n * - lockLogic: Funkce urujc, zda je sekce ZAMEN/DISABLED (context) => boolean\n */\nconst SECTION_DEFINITIONS = {\n  objednatel: {\n    name: 'Objednatel',\n    phase: 1,\n    visibilityLogic: (context) => context.currentPhase >= 1,\n    lockLogic: (context) => {\n      //  FZE 1 (NOVA) = VDY ODEMENO pro nov objednvky\n      if (context.currentPhase === 1 && !context.formData.id) {\n        return false; // ODEMENO\n      }\n\n      //  ADMIN UNLOCK: Pokud admin odemkl fzi 1, povolit editaci\n      if (context.unlockStates?.phase1) {\n        return false; // ODEMENO adminorem\n      }\n\n      //  ADMIN UNLOCK FZE 2: Pokud admin odemkl fzi 2 (resetuje na FZI 2), povolit editaci\n      // Tento unlock se pouv z PO sekce a resetuje workflow na ODESLANA_KE_SCHVALENI\n      if (context.unlockStates?.phase2) {\n        return false; // ODEMENO adminorem (resetoval na FZI 2, objednatel mus bt odemen)\n      }\n\n      //  Zamknout POUZE pokud jsme PELI fzi 2 (currentPhase > 2)\n      // FZE 2 = ODESLANA_KE_SCHVALENI - sekce Objednatel mus bt odemen\n      if (context.currentPhase > 2) {\n        return true; // ZAMENO (jsme u dl ne fze 2)\n      }\n\n      return false; // Jinak ODEMENO\n    }\n  },\n  schvaleni: {\n    name: 'Schvlen',\n    phase: 1,\n    visibilityLogic: (context) => context.currentPhase >= 1,\n    lockLogic: (context) => {\n      //  FZE 1 (NOVA) = VDY ODEMENO pro nov objednvky\n      if (context.currentPhase === 1 && !context.formData.id) {\n        return false; // ODEMENO\n      }\n\n      //  ADMIN UNLOCK: Pokud admin odemkl fzi 1, povolit editaci\n      if (context.unlockStates?.phase1) {\n        return false; // ODEMENO adminorem\n      }\n\n      //  ADMIN UNLOCK FZE 2: Pokud admin odemkl fzi 2 (resetuje na FZI 2), povolit editaci\n      // Tento unlock se pouv z PO sekce a resetuje workflow na ODESLANA_KE_SCHVALENI\n      if (context.unlockStates?.phase2) {\n        return false; // ODEMENO adminorem (resetoval na FZI 2, take PO sekce mus bt odemen)\n      }\n\n      //  Zamknout POUZE pokud jsme PELI fzi 2 (currentPhase > 2)\n      // FZE 2 = ODESLANA_KE_SCHVALENI - PO sekce (schvlen) mus bt odemen\n      if (context.currentPhase > 2) {\n        return true; // ZAMENO (jsme u dl ne fze 2)\n      }\n\n      return false; // Jinak ODEMENO\n    }\n  },\n  //  SEKCE \"prilohy\" ODSTRANNA - je nyn mimo workflow systm, zena samostatn v OrderForm25.js\n  // Viditeln pouze kdy m objednvka ID, zamen pouze pi stavu DOKONCENA\n  financovani: {\n    name: 'Financovn',\n    phase: 1, //  Fze 1-2 (viditeln a editovateln od zatku)\n    visibilityLogic: (context) => context.currentPhase >= 1, //  Viditeln od fze 1\n    lockLogic: (context) => {\n      //  FZE 1-2: Odemeno pro vyplnn (povinn ve FZI 1 a 2)\n      if (context.currentPhase >= 1 && context.currentPhase <= 2) {\n        return false; // ODEMENO\n      }\n\n      //  FZE 3+: Zameno (financovn se u nemn po schvlen)\n      if (context.currentPhase >= 3) {\n        return true; // ZAMENO\n      }\n\n      return false; // Jinak odemeno (fallback)\n    }\n  },\n  dodavatel: {\n    name: 'Dodavatel',\n    phase: 3, //  Fze 3\n    visibilityLogic: (context) => context.currentPhase >= 3,\n    lockLogic: (context) => {\n      if (context.unlockStates?.phase3_sections) {\n        return false;\n      }\n      if (context.currentPhase > 3) {\n        return true;\n      }\n      return false;\n    }\n  },\n  kontakt: {\n    name: 'Kontakt',\n    phase: 3, //  Fze 3\n    visibilityLogic: (context) => context.currentPhase >= 3,\n    lockLogic: (context) => {\n      if (context.unlockStates?.phase3_sections) {\n        return false;\n      }\n      if (context.currentPhase > 3) {\n        return true;\n      }\n      return false;\n    }\n  },\n  detaily: {\n    name: 'Detaily',\n    phase: 3, //  Fze 3\n    visibilityLogic: (context) => context.currentPhase >= 3,\n    lockLogic: (context) => {\n      if (context.unlockStates?.phase3_sections) {\n        return false;\n      }\n      if (context.currentPhase > 3) {\n        return true;\n      }\n      return false;\n    }\n  },\n  dodaci_podminky: {\n    name: 'Dodac podmnky',\n    phase: 3, //  Fze 3\n    visibilityLogic: (context) => context.currentPhase >= 3,\n    lockLogic: (context) => {\n      if (context.unlockStates?.phase3_sections) {\n        return false;\n      }\n      if (context.currentPhase > 3) {\n        return true;\n      }\n      return false;\n    }\n  },\n  stav_odeslani: {\n    name: 'Stav odesln',\n    phase: 3, //  Fze 3\n    visibilityLogic: (context) => context.currentPhase >= 3,\n    lockLogic: (context) => {\n      if (context.unlockStates?.phase3_sections) {\n        return false;\n      }\n      if (context.currentPhase > 3) {\n        return true;\n      }\n      return false;\n    }\n  },\n  potvrzeni_objednavky: {\n    name: 'Potvrzen objednvky',\n    phase: 3,\n    visibilityLogic: (context) => {\n      //  SKRYT pro POKLADNA reim\n      if (context.isPokladna) return false;\n      return context.currentPhase >= 4;\n    },\n    lockLogic: (context) => {\n      //  Zamknuto od FZE 5+ (pokud nen explicitn odemeno)\n      return context.currentPhase >= 5 && !context.unlockStates?.potvrzeni;\n    }\n  },\n  registr_smluv: {\n    name: 'Registr smluv',\n    phase: 4,  //  FZE 4 - pouze CHECKBOX \"M bt zveejnna\"\n    visibilityLogic: (context) => {\n      //  SKRYT pro POKLADNA reim\n      if (context.isPokladna) return false;\n      //  Viditeln ve FZI 4+ kdy dodavatel potvrdil ANO\n      //  ZMNA: Zobrazit i ve FZI 6+ (historie rozhodnut)\n      const potvrzeniAno = context.formData.dodavatel_zpusob_potvrzeni?.potvrzeni === 'ANO';\n      return potvrzeniAno && context.currentPhase >= 4;\n    },\n    lockLogic: (context) => {\n      //  Zamknuto od FZE 5+ (pokud nen explicitn odemeno)\n      return context.currentPhase >= 5 && !context.unlockStates?.registr;\n    }\n  },\n  registr_smluv_vyplneni: {\n    name: 'Vyplnn registru smluv',\n    phase: 5,  //  NOV FZE 5 - DATUM + IDDT + checkbox\n    visibilityLogic: (context) => {\n      //  SKRYT pro POKLADNA reim\n      if (context.isPokladna) return false;\n      //  Viditeln kdy workflow obsahuje UVEREJNIT nebo UVEREJNENA\n      //  ZMNA: Zobrazit i kdy je UVEREJNENA (jako disabled ve FZI 6+)\n      const hasUverejnit = hasWorkflowState(context.formData.stav_workflow_kod, 'UVEREJNIT');\n      const hasUverejnena = hasWorkflowState(context.formData.stav_workflow_kod, 'UVEREJNENA');\n      return hasUverejnit || hasUverejnena;\n    },\n    lockLogic: (context) => {\n      //  Zamknuto od FZE 6+ (pokud nen explicitn odemeno)\n      return context.currentPhase >= 6 && !context.unlockStates?.registr_vyplneni;\n    }\n  },\n  prubeh_objednavky: {\n    name: 'Prbh objednvky',\n    phase: null,\n    visibilityLogic: () => true, // Vdy viditeln\n    lockLogic: () => false // Nikdy zamen\n  },\n  dodaci_informace: {\n    name: 'Dodac informace',\n    phase: null,\n    visibilityLogic: () => true,\n    lockLogic: () => false\n  },\n  fakturace: {\n    name: 'Fakturace',\n    phase: 6,  //  ZMNA: 8  6\n    visibilityLogic: (context) => {\n      //  SKRYT pro POKLADNA reim\n      if (context.isPokladna) return false;\n      //  Viditeln od fze 6 A VE (6, 7, 8, 9)\n      // Zobraz se kdy: UVEREJNENA (z FZE 5) nebo NEUVEREJNIT (peskoeno z FZE 4) nebo FAKTURACE\n      return context.currentPhase >= 6;\n    },\n    lockLogic: (context) => {\n      //  Zamknuto od FZE 7+ (pokud nen explicitn odemeno)\n      return context.currentPhase >= 7 && !context.unlockStates?.fakturace;\n    }\n  },\n  vecna_spravnost: {\n    name: 'Vcn sprvnost',\n    phase: 7,  //  ZMNA: 9  7\n    visibilityLogic: (context) => {\n      //  Viditeln od fze 7 A VE (7, 8, 9)\n      return context.currentPhase >= 7;\n    },\n    lockLogic: (context) => {\n      //  Zamknuto od FZE 8+ (pokud nen explicitn odemeno)\n      return context.currentPhase >= 8 && !context.unlockStates?.vecna_spravnost;\n    }\n  },\n  dokonceni: {\n    name: 'Dokonen',\n    phase: 8,  //  FZE 8 - zobrazuje se po ZKONTROLOVANA (ve stejn fzi)\n    visibilityLogic: (context) => {\n      //  Viditeln POUZE kdy:\n      // 1. Objednvka je SKUTEN DOKONENA (stav DOKONCENA)\n      // 2. NEBO m uivatel prvo canUnlockAnything (bude pedno z extendedSectionStates)\n      // Poznmka: canUnlockAnything kontrola je v OrderForm25.js v extendedSectionStates\n      const isDokoncena = hasWorkflowState(context.formData.stav_workflow_kod, 'DOKONCENA');\n      return isDokoncena; // zkladn viditelnost - rozeno v extendedSectionStates\n    },\n    lockLogic: (context) => {\n      //  Zamknuto po DOKONCENA (pokud nen explicitn odemeno)\n      return hasWorkflowState(context.formData.stav_workflow_kod, 'DOKONCENA') && !context.unlockStates?.dokonceni;\n    }\n  }\n};\n\n/**\n *  CENTRALIZOVAN LOGIKA STAVU SEKC\n *\n * Uruje kompletn stav sekce: visible (viditeln) a enabled (odemen).\n * Toto je JEDIN SOURCE OF TRUTH pro stavy sekc!\n *\n * @param {string} sectionKey - Kl sekce (nap. 'objednatel', 'prilohy')\n * @param {Object} formData - Data formule\n * @param {Object} unlockStates - Stavy odemen sekc\n * @param {Object} context - Dodaten kontext (permissions, flags)\n * @returns {Object} { visible: boolean, enabled: boolean }\n */\nconst calculateSectionState = (sectionKey, formData, unlockStates = {}, context = {}) => {\n  const section = SECTION_DEFINITIONS[sectionKey];\n  if (!section) {\n    return { visible: false, enabled: false }; // neznm sekce nen viditeln ani odemen\n  }\n\n  //  Detekce archivovan objednvky\n  const isArchived = context.isArchived || false;\n\n  // Kontext pro vyhodnocen (vechny potebn flagy)\n  const evalContext = {\n    formData,\n    currentPhase: context.currentPhase || calculateCurrentPhase(formData),\n    isArchived, //  Pidn flag pro archivovan objednvky\n\n    // Unlock stavy (pro pstup v lockLogic funkcch)\n    //  FIX: Pout sprvn kle z OrderForm25.js (phase1, phase2, phase3, ...)\n    unlockStates: {\n      phase1: unlockStates.phase1 || false,\n      phase2: unlockStates.phase2 || false,\n      phase3: unlockStates.phase3 || false,\n      registr: unlockStates.registr || false,\n      fakturace: unlockStates.fakturace || false,\n      vecna_spravnost: unlockStates.vecna_spravnost || false,\n      dokonceni: unlockStates.dokonceni || false,\n      potvrzeni: unlockStates.potvrzeni || false\n    },\n\n    // Permissions\n    canEditApprovedSections: context.canEditApprovedSections || false,\n\n    // UI flags\n    showSaveProgress: context.showSaveProgress || false,\n    isSaving: context.isSaving || false,\n\n    // Workflow locks (centrln vypotan hodnoty)\n    isWorkflowLocked: context.isWorkflowLocked || false,\n\n    // Phase-specific locks (vypotan v OrderForm25)\n    shouldLockPhase1Sections: context.shouldLockPhase1Sections || false,\n    shouldLockPhase2Sections: context.shouldLockPhase2Sections || false,\n    shouldLockPhase3Sections: context.shouldLockPhase3Sections || false,\n\n    // Section-specific locks\n    isRegistrLocked: context.isRegistrLocked || false,\n    isFakturaceDisplayLocked: context.isFakturaceDisplayLocked || false,\n    isVecnaSpravnostLocked: context.isVecnaSpravnostLocked || false,\n    isDokonceniLocked: context.isDokonceniLocked || false\n  };\n\n  //  ARCHIVOVAN OBJEDNVKY: Zobraz VECHNY sekce (viditeln vdy = true)\n  // Vyhodnotit viditelnost: bu archivovan (vdy true) NEBO pvodn logika podle fze\n  const visible = isArchived || section.visibilityLogic(evalContext);\n\n  //  CENTRLN GLOBLN ZMEK: Pokud je isWorkflowLocked = true, VECHNY sekce jsou zamen\n  // isWorkflowLocked = isFormLocked (DOKONCENA || ZAMITNUTA || ZRUSENA) && !canUnlockAnything\n  if (evalContext.isWorkflowLocked) {\n    return {\n      visible,\n      enabled: false // GLOBLN ZAMENO - formul je v jednom z finlnch stav\n    };\n  }\n\n  //  ARCHIVOVAN OBJEDNVKY: Vechny sekce ODEMEN (locked = false)\n  // Vyhodnotit zamen: bu archivovan (vdy false = odemeno) NEBO pvodn logika\n  const locked = visible ? (isArchived ? false : section.lockLogic(evalContext)) : false;\n\n  return {\n    visible,\n    enabled: !locked // enabled = opak locked\n  };\n};\n\n/**\n *  ZPTN KOMPATIBILITA: CENTRALIZOVAN LOGIKA ZAMYKN SEKC\n *\n * @deprecated Pouij radji calculateSectionState() kter vrac { visible, enabled }\n * @returns {boolean} true = sekce JE zamen, false = sekce NEN zamen\n */\nconst calculateSectionLockState = (sectionKey, formData, unlockStates = {}, context = {}) => {\n  // Pouij novou funkci a vra jen 'enabled' stav (invertovan)\n  const state = calculateSectionState(sectionKey, formData, unlockStates, context);\n  return !state.enabled; // locked = opak enabled\n};\n\n/**\n *  DEFINICE 10 FZ WORKFLOW\n *\n * FZE 1/10: NOVA - Vytvoen konceptu (nen v DB)\n * FZE 2/10: ODESLANA_KE_SCHVALENI - ek na schvlen\n * FZE 3/10: SCHVALENA (+ROZPRACOVANA) - Schvlen, uivatel vypluje detaily\n *             - SCHVALENA = prv odemknuto, ek na vyplnn\n *             - SCHVALENA + ROZPRACOVANA = uloeno, ale jet neodeslno (pracuje se na tom)\n * FZE 4/10: ODESLANA - Odeslno dodavateli (nahrazuje ROZPRACOVANA)\n * FZE 5/10: POTVRZENA - Potvrzena dodavatelem (zobraz se sekce Registr smluv s checkboxem \"M bt zveejnna\")\n * FZE 6/10: (REZERVOVNO - nyn nepouito)\n * FZE 7/10: UVEREJNIT - Rozhodnuto o zveejnn (vyplovn daj o zveejnn)\n * FZE 8/10: FAKTURACE nebo NEUVEREJNIT - Faktury pidny (nebo peskoeno ze 5 pokud NE)\n * FZE 9/10: KONTROLA/ZKONTROLOVANA - Vcn sprvnost\n * FZE 10/10: DOKONCENA - Hotovo\n */\nconst PHASE_DEFINITIONS = [\n  { id: 1, name: 'Vytvoen', class: 'phase-1', description: 'Vytvoen konceptu' },\n  { id: 2, name: 'Ke schvlen', class: 'phase-2', description: 'ek na schvlen' },\n  { id: 3, name: 'Schvlen', class: 'phase-3', description: 'Schvlen, rozpracovan' },\n  { id: 4, name: 'Odeslno', class: 'phase-4', description: 'Odeslno dodavateli' },\n  { id: 5, name: 'Potvrzen', class: 'phase-5', description: 'Potvrzena dodavatelem' },\n  { id: 6, name: 'Rozhodnut', class: 'phase-6', description: 'Rozhodnut o zveejnn' },\n  { id: 7, name: 'Uveejnn', class: 'phase-7', description: 'Vyplnn daj o zveejnn' },\n  { id: 8, name: 'Fakturace', class: 'phase-8', description: 'Faktury pidny' },\n  { id: 9, name: 'Vcn sprvnost', class: 'phase-9', description: 'Vcn sprvnost' },\n  { id: 10, name: 'Dokonen', class: 'phase-10', description: 'Hotovo' }\n];\n\n/**\n *  CENTRALIZOVAN LOGIKA PRO UREN AKTULN FZE\n *\n * Tato funkce je JEDIN SOURCE OF TRUTH pro uren fze objednvky.\n * Veker logika je zde - dn duplicity!\n *\n *  FZE SE URUJE PODLE POSLEDNHO STAVU V stav_workflow_kod\n *\n * @param {Object} formData - Data formule objednvky\n * @returns {number} slo aktuln fze (1-10)\n */\nconst calculateCurrentPhase = (formData) => {\n  // FZE 1: Nen uloeno v DB NEBO m explicitn stav NOVA/KONCEPT\n  if (!formData.id || hasWorkflowState(formData.stav_workflow_kod, 'NOVA')) {\n    return 1;\n  }\n\n  //  KLOV ZMNA: Bere POUZE POSLEDN STAV (aktuln), ne vechny historick\n  const workflowStates = parseWorkflowStates(formData.stav_workflow_kod);\n  const lastState = workflowStates[workflowStates.length - 1];\n\n  // Mapovn poslednho stavu na fzi (8 fz celkem)\n  const stateToPhaseMap = {\n    'DOKONCENA': 8,          //  DOKONCENA = konec procesu ve FZI 8 (ne samostatn fze 9)\n    'ZKONTROLOVANA': 8,      //  FZE 8 - zobraz sekci Dokonen\n    'VECNA_SPRAVNOST': 7,    //  FZE 7 - Vcn sprvnost\n    'FAKTURACE': 6,          //  FZE 6 - Fakturace\n    'NEUVEREJNIT': 6,        //  FZE 6 - pesko FZI 5\n    'UVEREJNENA': 6,         //  FZE 6\n    'UVEREJNIT': 5,          //  FZE 5 - voliteln (vyplnn registru)\n    'POTVRZENA': 4,          //  FZE 4 - Potvrzen dodavatele + rozhodnut o zveejnn\n    'ODESLANA': 4,\n    'ROZPRACOVANA': 3,\n    'SCHVALENA': 3,\n    'ZRUSENA': 3,            //  STORNOVNA = FZE 3 (storno ped odeslnm, viditeln jen do schvlen)\n    'ZAMITNUTA': 3,          //  ZAMTNUTA = FZE 3 (zamtnut pi schvlen)\n    'CEKA_SE': 2,\n    'ODESLANA_KE_SCHVALENI': 2,\n    'NOVA': 1\n  };\n\n  return stateToPhaseMap[lastState] || 1;\n};\n\n/**\n *  Uren tma barvy podle fze\n */\nconst getPhaseTheme = (workflowCode, isStorno) => {\n  // Storno m error tma\n  if (isStorno || hasWorkflowState(workflowCode, 'ZRUSENA')) {\n    return 'phase-error';\n  }\n\n  // FZE 4+: POTVRZENA nebo DOKONCENA\n  if (hasWorkflowState(workflowCode, 'POTVRZENA') ||\n      hasWorkflowState(workflowCode, 'DOKONCENA')) {\n    return 'phase-4';\n  }\n\n  // FZE 3: SCHVALENA + ODESLANA\n  if (hasWorkflowState(workflowCode, 'SCHVALENA') &&\n      hasWorkflowState(workflowCode, 'ODESLANA')) {\n    return 'phase-3';\n  }\n\n  // FZE 2: Pouze SCHVALENA (ale ne ODESLANA)\n  if (hasWorkflowState(workflowCode, 'SCHVALENA')) {\n    return 'phase-2';\n  }\n\n  // FZE 1: NOVA, CEKA_SE, ZAMITNUTA\n  return 'phase-1';\n};\n\n/**\n *  UNLOCK HELPERS - Funkce pro odemykn sekc s modifikac workflow\n *\n * Tyto funkce vrac POUZE DATA pro aktualizaci - nemodifikuj state pmo!\n * OrderForm25 je zodpovdn za voln setFormData() s vrcenmi daty.\n */\n\n/**\n * Piprav data pro odemknut FZE 2 (Plohy)\n * Vrac: { updatedFormData, unlockState }\n */\nconst preparePhase2Unlock = (formData) => {\n  //  ODEMKNUT FZE 2 = vrtit se na ODESLANA_KE_SCHVALENI (vymazat vechny vy fze)\n  const newWorkflowCode = JSON.stringify(['ODESLANA_KE_SCHVALENI']);\n\n  return {\n    updatedFormData: {\n      ...formData,\n      stav_odeslano: false,\n      datum_odeslani: '',\n      stav_stornovano: false,\n      datum_storna: '',\n      odeslani_storno_duvod: '',\n      stav_workflow_kod: newWorkflowCode,\n      dodavatel_zpusob_potvrzeni: { potvrzeni: '', datum: '', zpusob: '', poznamka: '' },\n      dt_akceptace: '',\n      stav_u_dodavatele: '',\n      datum_zmeny_stavu: '',\n      poznamka_stav: '',\n      cislo_zasilky: '',\n      prepravce: '',\n      ocekavane_doruceni: '',\n      skutecne_doruceni: '',\n      cislo_faktury: '',\n      datum_faktury: '',\n      castka_bez_dph: '',\n      castka_s_dph: '',\n      datum_platby: '',\n      dt_zverejneni: '',\n      registr_iddt: '',\n      ma_byt_zverejnena: false,\n      faktury: []\n    },\n    unlockState: 'phase2',\n    newPhase: 2\n  };\n};\n\n/**\n * Piprav data pro odemknut FZE 3 (Financovn, Dodavatel, Detaily...)\n * Vrac: { updatedFormData, unlockState }\n */\nconst preparePhase3Unlock = (formData) => {\n  //  ODEMKNUT FZE 3 = vrtit se na SCHVALENA (vymazat vechny vy fze)\n  const newWorkflowCode = JSON.stringify(['SCHVALENA']);\n\n  return {\n    updatedFormData: {\n      ...formData,\n      stav_workflow_kod: newWorkflowCode,\n      stav_odeslano: false,\n      datum_odeslani: '',\n      dodavatel_zpusob_potvrzeni: { potvrzeni: '', datum: '', zpusob: '', poznamka: '' },\n      dt_akceptace: '',\n      stav_u_dodavatele: '',\n      datum_zmeny_stavu: '',\n      poznamka_stav: '',\n      cislo_zasilky: '',\n      prepravce: '',\n      ocekavane_doruceni: '',\n      skutecne_doruceni: '',\n      cislo_faktury: '',\n      datum_faktury: '',\n      castka_bez_dph: '',\n      castka_s_dph: '',\n      datum_platby: '',\n      faktury: [],\n      dt_zverejneni: '',\n      registr_iddt: '',\n      ma_byt_zverejnena: false,\n      potvrdil_vecnou_spravnost_id: '',\n      dt_potvrzeni_vecne_spravnosti: '',\n      vecna_spravnost_poznamka: ''\n    },\n    unlockState: 'phase3_sections',\n    newPhase: 3\n  };\n};\n\n/**\n * Piprav data pro odemknut FZE 4 (Potvrzen dodavatele)\n * Vrac: { updatedFormData, unlockState }\n */\nconst preparePhase4Unlock = (formData) => {\n  //  ODEMKNUT FZE 4 = vrtit se na [\"SCHVALENA\", \"ODESLANA\"] (vymazat vechny vy fze)\n  const newWorkflowCode = JSON.stringify(['SCHVALENA', 'ODESLANA']);\n\n  return {\n    updatedFormData: {\n      ...formData,\n      stav_workflow_kod: newWorkflowCode,\n      dodavatel_zpusob_potvrzeni: { potvrzeni: '', datum: '', zpusob: '', poznamka: '' },\n      dt_akceptace: '',\n      dt_zverejneni: '',\n      registr_iddt: '',\n      faktury: [],\n      potvrdil_vecnou_spravnost_id: null,\n      dt_potvrzeni_vecne_spravnosti: '',\n      potvrzeni_vecne_spravnosti: 0,\n      dokoncil_id: null,\n      dt_dokonceni: '',\n      potvrzeni_dokonceni_objednavky: 0\n    },\n    unlockState: 'potvrzeni',\n    newPhase: 4\n  };\n};\n\n/**\n *  HLAVN HOOK - useWorkflowManager\n *\n * Poskytuje centralizovan pstup k workflow logice:\n * - getCurrentPhase() - aktuln fze (1-10)\n * - getPhaseProgress() - data pro progress bar\n * - getPhaseTheme() - tma barvy pro fzi\n * - parseWorkflowStates() - parsovn workflow kdu\n * - hasWorkflowState() - kontrola ptomnosti stavu\n * - unlockSection() - NOV: Odemknut sekce s vrcenm dat pro update\n *\n * @param {Object} formData - Data formule objednvky\n * @param {boolean} isArchived - TRUE pokud je objednvka archivovan\n * @returns {Object} Workflow manager API\n */\nexport const useWorkflowManager = (formData, isArchived = false) => {\n  //  INTERN STATE: Force refresh kl pro pepoet workflow po zmnch\n  const [workflowRefreshKey, setWorkflowRefreshKey] = useState(0);\n\n  //  DETEKCE POKLADNA REIMU\n  // Reim POKLADNA znamen:\n  // - Peskoen fz 3-6 (Potvrzen dodavatele, Registr, Zveejnn, Fakturace)\n  // - Automatick skok z ODESLANA  VECNA_SPRAVNOST (Fze 7)\n  // - Kontrola MAX ceny podle soutu poloek (ne faktur)\n  const isPokladna = useMemo(() => {\n    // Kontrola v objektu financovn\n    const isPlatbaPokladnaObj = formData.financovani?.platba === 'pokladna';\n    // Kontrola v dodavatel_zpusob_potvrzeni\n    const isPlatbaPokladnaDodavatel = formData.dodavatel_zpusob_potvrzeni?.platba === 'pokladna';\n\n    return isPlatbaPokladnaObj || isPlatbaPokladnaDodavatel;\n  }, [formData.financovani?.platba, formData.dodavatel_zpusob_potvrzeni?.platba]);\n\n  //  UNLOCK STATES: Centralizovan stavy pro odemykn sekc\n  const [unlockedSections, setUnlockedSections] = useState({\n    phase1: false,\n    phase2: false,\n    phase3_sections: false,\n    potvrzeni: false,\n    registr: false,\n    registr_vyplneni: false,\n    fakturace: false,\n    vecna_spravnost: false,\n    dokonceni: false\n  });\n\n  //  METODY PRO ODEMYKN/ZAMYKN SEKC\n  const unlockSection = useCallback((sectionKey) => {\n    setUnlockedSections(prev => ({ ...prev, [sectionKey]: true }));\n  }, []);\n\n  const lockSection = useCallback((sectionKey) => {\n    setUnlockedSections(prev => ({ ...prev, [sectionKey]: false }));\n  }, []);\n\n  const isSectionUnlocked = useCallback((sectionKey) => {\n    return unlockedSections[sectionKey] || false;\n  }, [unlockedSections]);\n\n  const resetAllUnlocks = useCallback(() => {\n    setUnlockedSections({\n      phase1: false,\n      phase2: false,\n      phase3_sections: false,\n      potvrzeni: false,\n      registr: false,\n      registr_vyplneni: false,\n      fakturace: false,\n      vecna_spravnost: false,\n      dokonceni: false\n    });\n  }, []);\n\n  //  FORCE REFRESH: Funkce pro vynucen pepotu workflow (exportovna v API)\n  const forceRefresh = useCallback(() => {\n    setWorkflowRefreshKey(prev => prev + 1);\n  }, []);\n\n  //  Aktuln fze - useMemo pro optimalizaci\n  //  FZE SE URUJE JEN PODLE stav_workflow_kod - dn dal atributy!\n  //  Pro archivovan objednvky nastavme fzi na 8 (vechny sekce viditeln)\n  const currentPhase = useMemo(() => {\n    //  Archivovan objednvky = fze 8 (maximum)\n    if (isArchived) {\n      return 8;\n    }\n\n    const phase = calculateCurrentPhase(formData);\n    return phase;\n  }, [\n    formData.id,\n    formData.stav_workflow_kod,\n    workflowRefreshKey,\n    isArchived\n  ]);\n\n  //  Tma barvy pro fzi\n  const phaseTheme = useMemo(() => {\n    return getPhaseTheme(formData.stav_workflow_kod, formData.stav_stornovano);\n  }, [formData.stav_workflow_kod, formData.stav_stornovano]);\n\n  //  Progress bar data - kompletn informace o vech fzch\n  const phaseProgress = useMemo(() => {\n    const isStorno = formData.stav_stornovano;\n    const workflowCode = formData.stav_workflow_kod;\n\n    return {\n      currentPhase,\n      phases: PHASE_DEFINITIONS.map((phase, index) => {\n        const phaseNum = index + 1;\n        let fillClass = phase.class;\n        let isVisible = false;\n\n        // Uren viditelnosti a barvy segmentu\n        if ((isStorno || hasWorkflowState(workflowCode, 'ZRUSENA')) && phaseNum >= 2) {\n          fillClass = 'phase-error';\n          isVisible = phaseNum <= Math.max(currentPhase, 2);\n        } else {\n          isVisible = phaseNum <= currentPhase;\n        }\n\n        return {\n          ...phase,\n          isVisible,\n          isCurrent: phaseNum === currentPhase,\n          fillClass\n        };\n      })\n    };\n  }, [currentPhase, formData.stav_stornovano, formData.stav_workflow_kod]);\n\n  //  Helper funkce jako useCallback\n  const getCurrentPhaseCallback = useCallback(() => currentPhase, [currentPhase]);\n\n  const getPhaseProgressCallback = useCallback(() => phaseProgress, [phaseProgress]);\n\n  const getPhaseThemeCallback = useCallback(() => phaseTheme, [phaseTheme]);\n\n  const parseWorkflowStatesCallback = useCallback((code) => {\n    return parseWorkflowStates(code || formData.stav_workflow_kod);\n  }, [formData.stav_workflow_kod]);\n\n  //  OPRAVA: Callback mus pijmat 2 parametry (workflowCode, state)\n  // protoe v OrderForm25.js se vol ve 2 formch:\n  // 1) hasWorkflowState(formData.stav_workflow_kod, 'STATE') - explicitn workflowCode\n  // 2) hasWorkflowState('STATE') - pouije formData.stav_workflow_kod\n  const hasWorkflowStateCallback = useCallback((workflowCodeOrState, maybeState) => {\n    // Pokud je pouze 1 parametr, pouij formData.stav_workflow_kod jako workflowCode\n    if (maybeState === undefined) {\n      return hasWorkflowState(formData.stav_workflow_kod, workflowCodeOrState);\n    }\n    // Pokud jsou 2 parametry, pouij prvn jako workflowCode\n    return hasWorkflowState(workflowCodeOrState, maybeState);\n  }, [formData.stav_workflow_kod]);\n\n  //  Hlavn workflow state (pro zptnou kompatibilitu s workflow25.js)\n  const mainWorkflowState = useMemo(() => {\n    const states = parseWorkflowStates(formData.stav_workflow_kod);\n\n    // Hierarchie stav pro uren hlavnho stavu\n    const stateHierarchy = [\n      'DOKONCENA', 'POTVRZENA', 'CEKA_POTVRZENI', 'SCHVALENA',\n      'ODESLANA_KE_SCHVALENI', 'ZAMITNUTA', 'ZRUSENA', 'NOVA'\n    ];\n\n    // Najdi nejvznamnj stav\n    for (const hierarchyState of stateHierarchy) {\n      if (states.includes(hierarchyState)) {\n        const stateMapping = {\n          'CEKA_SE': 'ODESLANA_KE_SCHVALENI',\n          'ODESLANA': 'CEKA_POTVRZENI'\n        };\n        return stateMapping[hierarchyState] || hierarchyState;\n      }\n    }\n\n    // Fallback na posledn stav\n    const lastState = states.length > 0 ? states[states.length - 1] : 'NOVA';\n\n    // ROZPRACOVANA se chov jako SCHVALENA\n    if (lastState === 'ROZPRACOVANA' && states.includes('SCHVALENA')) {\n      return 'SCHVALENA';\n    }\n\n    return lastState || 'NOVA';\n  }, [formData.stav_workflow_kod]);\n\n  //  Section state helper (NOV FUNKCE)\n  const getSectionState = useCallback((sectionKey, unlockStates = {}, additionalContext = {}) => {\n    return calculateSectionState(sectionKey, formData, unlockStates, {\n      currentPhase,\n      isPokladna,  //  Pidno: pro podmnky skrvn sekc v POKLADNA reimu\n      isArchived,  //  Pro zobrazen vech sekc u archivovanch\n      ...additionalContext\n    });\n  }, [formData, currentPhase, isPokladna, isArchived]);\n\n  //  Section locking helper (DEPRECATED - pouij getSectionState)\n  const getSectionLockState = useCallback((sectionKey, unlockStates = {}, additionalContext = {}) => {\n    return calculateSectionLockState(sectionKey, formData, unlockStates, {\n      currentPhase,\n      isPokladna,  //  Pidno: pro podmnky skrvn sekc v POKLADNA reimu\n      ...additionalContext\n    });\n  }, [formData, currentPhase, isPokladna]);\n\n  //  Get all section lock states (for Collapse All button)\n  const getAllSectionLockStates = useCallback((unlockStates = {}, additionalContext = {}) => {\n    const lockStates = {};\n    Object.keys(SECTION_DEFINITIONS).forEach(sectionKey => {\n      lockStates[sectionKey] = getSectionLockState(sectionKey, unlockStates, additionalContext);\n    });\n    return lockStates;\n  }, [getSectionLockState]);\n\n  //  DETEKCE DOKONEN WORKFLOW (konen stavy)\n  //  TRUE pro DOKONCENA, ZAMITNUTA, ZRUSENA - vechny jsou konec workflow\n  const isWorkflowCompleted = useMemo(() => {\n    return !!(\n      formData.id && // Mus mt ID (uloeno v DB)\n      (hasWorkflowStateCallback(formData.stav_workflow_kod, 'DOKONCENA') ||\n       hasWorkflowStateCallback(formData.stav_workflow_kod, 'ZAMITNUTA') ||\n       hasWorkflowStateCallback(formData.stav_workflow_kod, 'ZRUSENA'))\n    );\n  }, [formData.id, formData.stav_workflow_kod, hasWorkflowStateCallback, workflowRefreshKey]);\n\n  //  DETEKCE ZAMTNUT OBJEDNVKY\n  const isWorkflowRejected = useMemo(() => {\n    return !!(\n      formData.id && // Mus mt ID (uloeno v DB)\n      hasWorkflowStateCallback(formData.stav_workflow_kod, 'ZAMITNUTA') // Objednvka byla zamtnuta\n    );\n  }, [formData.id, formData.stav_workflow_kod, hasWorkflowStateCallback, workflowRefreshKey]);\n\n  //  DETEKCE ZRUEN (STORNOVAN) OBJEDNVKY\n  const isWorkflowCancelled = useMemo(() => {\n    return !!(\n      formData.id && // Mus mt ID (uloeno v DB)\n      hasWorkflowStateCallback(formData.stav_workflow_kod, 'ZRUSENA') // Objednvka byla stornovna\n    );\n  }, [formData.id, formData.stav_workflow_kod, hasWorkflowStateCallback, workflowRefreshKey]);\n\n  //  UNIVERZLN ZAMEN FORMULE\n  // TRUE kdy je objednvka v jednom z finlnch stav: DOKONCENA, ZAMITNUTA, ZRUSENA (stornovna)\n  const isFormLocked = useMemo(() => {\n    return isWorkflowCompleted || isWorkflowRejected || isWorkflowCancelled;\n  }, [isWorkflowCompleted, isWorkflowRejected, isWorkflowCancelled]);\n\n  //  Get all section states (NOV FUNKCE) - MUS BT A PO isFormLocked!\n  const getAllSectionStates = useCallback((additionalContext = {}) => {\n    const states = {};\n    //  Pidat isWorkflowLocked do kontextu - kdy je formul zamen (DOKONCENA/ZAMITNUTA/ZRUSENA), vechny sekce jsou disabled\n    const contextWithLock = {\n      ...additionalContext,\n      isWorkflowLocked: isFormLocked //  Pedat isFormLocked do vech sekc\n    };\n    Object.keys(SECTION_DEFINITIONS).forEach(sectionKey => {\n      states[sectionKey] = getSectionState(sectionKey, unlockedSections, contextWithLock);\n    });\n\n    return states;\n  }, [getSectionState, currentPhase, formData.id, unlockedSections, isFormLocked]);\n\n  //  UNLOCK API - Funkce pro ppravu odemknut sekc\n  const unlockPhase2 = useCallback(() => {\n    return preparePhase2Unlock(formData);\n  }, [formData]);\n\n  const unlockPhase3 = useCallback(() => {\n    return preparePhase3Unlock(formData);\n  }, [formData]);\n\n  const unlockPhase4 = useCallback(() => {\n    return preparePhase4Unlock(formData);\n  }, [formData]);\n\n  //  Return API\n  return {\n    // Computed values\n    currentPhase,\n    phaseTheme,\n    phaseProgress,\n    mainWorkflowState,\n\n    //  Payment mode detection\n    isPokladna,                // NOV: TRUE pokud je reim POKLADNA (peskakuj se fze 3-6)\n\n    //  Archive mode detection\n    isArchived,  // NOV: TRUE pokud je objednvka archivovan\n\n    //  Workflow locking states\n    isWorkflowCompleted,       // NOV: objednvka je v konenm stavu (DOKONCENA || ZAMITNUTA || ZRUSENA)\n    isWorkflowRejected,        // NOV: objednvka byla zamtnuta\n    isWorkflowCancelled,       // NOV: objednvka byla stornovna\n\n    //  FORCE REFRESH API\n    forceRefresh,              // NOV: funkce pro vynucen pepotu workflow\n\n    //  UNLOCK/LOCK API - NOV: Centralizovan zen odemykn sekc\n    unlockSection,             // Odemkne konkrtn sekci\n    lockSection,               // Zamkne konkrtn sekci\n    isSectionUnlocked,         // Zjist zda je sekce odemena\n    resetAllUnlocks,           // Resetuje vechny unlock states (po uloen)\n    unlockPhase2,              // Odemkne FZI 2 (Plohy) - piprav data\n    unlockPhase3,              // Odemkne FZI 3 (Financovn, Dodavatel...) - piprav data\n    unlockPhase4,              // Odemkne FZI 4 (Potvrzen dodavatele) - piprav data\n\n    // Helper functions\n    getCurrentPhase: getCurrentPhaseCallback,\n    getPhaseProgress: getPhaseProgressCallback,\n    getPhaseTheme: getPhaseThemeCallback,\n    parseWorkflowStates: parseWorkflowStatesCallback,\n    hasWorkflowState: hasWorkflowStateCallback,\n\n    // Section state API (NOV)\n    getSectionState,           // NOV: vrac { visible, enabled }\n    getAllSectionStates,       // NOV: vrac vechny stavy sekc\n\n    // Section locking API (DEPRECATED - pouij getSectionState)\n    getSectionLockState,\n    getAllSectionLockStates,\n    sectionDefinitions: SECTION_DEFINITIONS,\n\n    // Raw phase definitions (for UI rendering)\n    phaseDefinitions: PHASE_DEFINITIONS\n  };\n};\n\n//  REMOVED: export default - pouvme named export\n\n","import React, { useState, useContext, useEffect, useLayoutEffect, useRef, useCallback, useMemo } from 'react';\nimport ReactDOM, { flushSync } from 'react-dom';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport styled from '@emotion/styled';\nimport { keyframes } from '@emotion/react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faUser, faClipboardCheck, faChevronUp, faChevronDown, faTimes, faClipboard, faSave, faCheckCircle, faFileContract, faHashtag, faLock, faUnlock, faFileAlt, faFileCircleXmark, faTrash, faSync, faBrain, faDatabase, faDownload, faCheck, faClock, faBookmark, faInfoCircle, faExpand, faCompress, faCreditCard, faPlus, faMinus, faBuilding, faGlobe, faExclamationTriangle, faTimesCircle } from '@fortawesome/free-solid-svg-icons';\nimport { User, Package, Calendar, FileText, Building, CreditCard, Hash, Users, Mail, Phone, MapPin, Calculator, Coins, Unlock, Lock, Plus, Trash, Search, X, RefreshCw, Bookmark, Eye, CheckCircle, ShoppingCart, Info, Copy, FileDown, AlertCircle, CheckCircle2, AlertTriangle, InfoIcon } from 'lucide-react';\nimport { CustomSelect, SelectWithIcon } from '../components/CustomSelect';\nimport { InvoiceAttachmentsCompact } from '../components/invoices';\nimport ConfirmDialog from '../components/ConfirmDialog';\nimport SupplierAddDialog from '../components/SupplierAddDialog';\nimport ModernHelper from '../components/ModernHelper'; //  Modern Sponka helper\nimport FloatingNavigator from '../components/FloatingNavigator'; //  Plovouc navigtor po sekcch\nimport { ToastContext } from '../context/ToastContext';\nimport { AuthContext } from '../context/AuthContext';\nimport { useActivity } from '../context/ActivityContext';\nimport { ProgressContext } from '../context/ProgressContext';\nimport backgroundTaskService from '../services/backgroundTaskService';\nimport ordersCacheService from '../services/ordersCacheService';\nimport draftManager from '../services/DraftManager'; //  CENTRALIZOVAN DRAFT MANAGER\nimport formDataManager from '../services/FormDataManager'; //  CENTRALIZOVAN DATA MANAGER\nimport { useAutosave } from '../hooks/useAutosave'; //  CENTRALIZOVAN AUTOSAVE HOOK\nimport { prettyDate, formatDateOnly } from '../utils/format';\nimport { fetchAllUsers, fetchApprovers, fetchLimitovanePrisliby, fetchLPDetail, searchSupplierByIco, searchSuppliersList, fetchSupplierContacts, createSupplier, updateSupplierByIco, fetchTemplatesList, fetchTemplatesListWithMeta, createTemplate, updateTemplate, deleteTemplate, getUserDetailApi2, fetchUskyList } from '../services/api2auth';\nimport { getSmlouvyList, getSmlouvaDetail, prepocetCerpaniSmluv } from '../services/apiSmlouvy';\n// NOTE: setDebugLogger removed - was unused (only commented call on line 11445)\nimport {\n  //  V2 API: Core CRUD operations\n  getOrderV2,           //  V2 API: GET order by ID\n  createOrderV2,        //  V2 API: CREATE order\n  updateOrderV2,        //  V2 API: UPDATE order\n  deleteOrderV2,        //  V2 API: DELETE order\n  getNextOrderNumberV2, //  V2 API: GET next order number\n  checkOrderNumberV2,   //  V2 API: CHECK order number availability\n  getOrderTimestampV2,  //  V2 API: GET order timestamp (lightweight)\n  //  V2 API: Order Attachments\n  uploadOrderAttachment,\n  listOrderAttachments,\n  downloadOrderAttachment,\n  deleteOrderAttachment,\n  verifyOrderAttachments,\n  //  V2 API: Invoice Attachments\n  uploadInvoiceAttachment,\n  listInvoiceAttachments,\n  downloadInvoiceAttachment,\n  deleteInvoiceAttachment,\n  //  V2 API: Lock/Unlock\n  lockOrderV2,\n  unlockOrderV2,\n  //  V2 API: Dictionaries\n  getTypyPrilohV2,\n  getTypyFakturV2,\n  //  V2 API: Utilities\n  generateAttachmentGUID,\n  generateSystemFilename,\n  createAttachmentMetadata,\n  isAllowedFileType,\n  isAllowedFileSize,\n  formatFileSize,\n  //  V2 API: Helpers\n  prepareDataForAPI,\n  normalizeError,\n  updateAttachmentV2\n} from '../services/apiOrderV2';\nimport { deleteInvoiceV2, createInvoiceV2, updateInvoiceV2 } from '../services/api25invoices';\nimport { notificationService, NOTIFICATION_TYPES } from '../services/notificationsUnified';\nimport notificationServiceDual from '../services/notificationService'; //  Dual-template notifikace\nimport { WORKFLOW_STATES, getWorkflowPhase, canTransitionTo } from '../constants/workflow25';\nimport {\n  validateWorkflowData,\n  getSectionVisibility,\n  getFieldEditability,\n  getAvailableActions,\n  formatWorkflowState\n} from '../utils/workflowUtils';\nimport {\n  broadcastDraftUpdated,\n  broadcastDraftDeleted,\n  broadcastOrderSaved,\n  broadcastMessage\n} from '../utils/tabSync';\nimport { translateErrorMessageShort } from '../utils/errorTranslation';\nimport {\n  normalizeStrediskaFromBackend,\n  normalizeStrediskaForBackend,\n  normalizeFinancovaniFromBackend,\n  normalizeFinancovaniForBackend,\n  normalizeFakturaStrediskaFromBackend,\n  normalizeFakturaStrediskaForBackend\n} from '../utils/dataTransformHelpers';\n\n//  NOV: Import refactored hooks pro state management\nimport { useFormController, useWorkflowManager } from './OrderForm25/hooks';\nimport { DocxGeneratorModal } from '../components/DocxGeneratorModal';\n\n// Pomocn funkce pro formtovn data pro DatePicker (YYYY-MM-DD formt)\nconst formatDateForPicker = (date) => {\n  if (!date) return '';\n  const d = new Date(date);\n  if (isNaN(d.getTime())) return '';\n  const year = d.getFullYear();\n  const month = String(d.getMonth() + 1).padStart(2, '0');\n  const day = String(d.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n};\n\n// Pomocn funkce pro normalizaci textu - odstrann diakritiky a pevod na mal psmena\nconst normalizeText = (text) => {\n  if (!text) return '';\n  return text\n    .toLowerCase()\n    .normalize('NFD') // Rozlo diakritiku na zkladn znaky + kombinujc znaky\n    .replace(/[\\u0300-\\u036f]/g, '') // Odstran kombinujc znaky (diakritiku)\n    .replace(/[^\\w\\s]/g, '') // Odstran interpunkci\n    .trim();\n};\n\n// Globln pomocn funkce pro aktuln datum ve formtu YYYY-MM-DD\nconst getCurrentDateFormatted = () => {\n  const now = new Date();\n  const year = now.getFullYear();\n  const month = String(now.getMonth() + 1).padStart(2, '0');\n  const day = String(now.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n};\n\n/**\n *  Z-INDEX HIERARCHIE PRO ORDERFORM25\n *\n * Pehled vech z-index hodnot pro sprvn vrstven komponent:\n *\n * 1-100:     Zkladn elementy (headers, shadows, atd.)\n * 10000:     Dropdown menu (CustomSelect, MultiSelect)\n * 99999:     Fullscreen reim (Container.isFullscreen)\n * 100000:    Dialogy nad fullscreenem (SupplierAddDialog, AresPopup, SupplierPopup, DeleteConfirm)\n * 999999:    Nejvy vrstva (ConfirmDialog, TemplateModal, LoadingOverlay, PreviewModal)\n *\n *  DLEIT: Dialogy a modly MUS mt vy z-index ne fullscreen (99999),\n *              aby se zobrazovaly i kdy je formul ve fullscreen mdu!\n */\n\nconst Container = styled.div`\n  background: #f8fafc;\n  padding: 0;\n  position: fixed;\n  top: ${props => props.isFullscreen ? '0' : 'var(--app-fixed-offset-actual, calc(var(--app-header-height, 96px) + var(--app-menu-height, 48px)))'};\n  left: 0;\n  right: 0;\n  bottom: ${props => props.isFullscreen ? '0' : 'var(--app-footer-height, 54px)'};\n  width: 100%;\n  height: ${props => props.isFullscreen ? '100vh' : 'calc(100vh - var(--app-fixed-offset-actual, calc(var(--app-header-height, 96px) + var(--app-menu-height, 48px))) - var(--app-footer-height, 54px))'};\n  overflow: hidden;\n  z-index: ${props => props.isFullscreen ? '99999' : 'auto'};\n  transition: all 0.3s ease-in-out;\n\n  /* Animace pro loading spinner */\n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n`;\n\nconst FormWrapper = styled.div`\n  width: 100%;\n  max-width: 990px;\n  margin: 0 auto;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  ${props => props.debugPinned ? `\n    margin-left: 420px;\n    margin-right: auto;\n  ` : ''}\n  background: transparent;\n  transition: margin-left 0.3s ease-in-out, margin-right 0.3s ease-in-out;\n\n  @media (max-width: 1400px) {\n    ${props => props.debugPinned ? `\n      margin-left: 380px;\n      margin-right: auto;\n    ` : ''}\n  }\n\n  @media (max-width: 1200px) {\n    margin-left: auto;\n    margin-right: auto;\n    max-width: 990px;\n  }\n\n  @media (max-width: 768px) {\n    max-width: 100%;\n    padding: 0 0.5rem;\n    margin-left: auto;\n    margin-right: auto;\n  }\n`;\n\nconst FixedHeader = styled.div`\n  position: absolute;\n  top: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 100%;\n  max-width: 990px;\n  z-index: 100;\n  background: ${({theme}) => theme.colors.gray100 || '#f8fafc'};\n  border-bottom: 1px solid #e5e7eb;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  padding: 1rem 0 1rem 0;\n`;\n\nconst FixedHeaderContent = styled.div`\n  width: 100%;\n  max-width: 990px;\n  margin: 0 auto;\n  ${props => props.debugPinned ? `\n    margin-left: 420px;\n    margin-right: auto;\n  ` : ''}\n  padding: 0 1rem;\n  transition: margin-left 0.3s ease-in-out, margin-right 0.3s ease-in-out;\n\n  @media (max-width: 1400px) {\n    ${props => props.debugPinned ? `\n      margin-left: 380px;\n      margin-right: auto;\n    ` : ''}\n  }\n\n  @media (max-width: 1200px) {\n    margin-left: auto;\n    margin-right: auto;\n    max-width: 990px;\n  }\n\n  @media (max-width: 768px) {\n    max-width: 100%;\n    padding: 0 1rem;\n  }\n`;\n\nconst ScrollableContent = styled.div`\n  /* Scrollovateln obsah - scrollbar na pravm okraji okna prohlee */\n  position: absolute;\n  top: 0px;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 0;\n\n  /* Decentn scrollbar - 80% prhledn ve vchozm stavu */\n  scrollbar-width: thin;\n  scrollbar-color: rgba(148, 163, 184, 0.2) transparent;\n\n  /* Pi hover vce viditeln */\n  &:hover {\n    scrollbar-color: rgba(148, 163, 184, 0.8) transparent;\n  }\n\n  /* Webkit browsers (Chrome, Safari, Edge) */\n  &::-webkit-scrollbar {\n    width: 10px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: transparent;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background-color: rgba(148, 163, 184, 0.2);\n    border-radius: 5px;\n    border: 2px solid transparent;\n    background-clip: content-box;\n    transition: background-color 0.3s ease;\n  }\n\n  &:hover::-webkit-scrollbar-thumb {\n    background-color: rgba(148, 163, 184, 0.8);\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background-color: rgba(100, 116, 139, 0.95);\n  }\n\n  @media (max-width: 768px) {\n    padding: 0;\n  }\n`;\n\nconst ScrollableInner = styled.div`\n  /* Vnitn wrapper pro centrovn obsahu */\n  max-width: 990px;\n  margin: 0 auto;\n  /*  Dynamick padding-top: vka headeru + 20px gap (u zapotno v CSS variable) */\n  padding: var(--fixed-header-height, 200px) 1rem 2rem 1rem;\n\n  @media (max-width: 768px) {\n    padding: var(--fixed-header-height, 200px) 0.5rem 2rem 0.5rem;\n  }\n`;\n\nconst FormHeader = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 0.75rem;\n\n  @media (max-width: 768px) {\n    flex-direction: column;\n    gap: 0.75rem;\n    align-items: stretch;\n  }\n`;\n\nconst HeaderLeft = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  flex-wrap: wrap;\n  flex: 1;\n\n  @media (max-width: 768px) {\n    justify-content: space-between;\n  }\n`;\n\nconst PriceSummary = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 8px 16px;\n  background: ${props => props.isOverBudget ? 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)' : 'linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)'};\n  border: 2px solid ${props => props.isOverBudget ? '#fca5a5' : '#bbf7d0'};\n  border-radius: 8px;\n  font-size: 14px;\n  font-weight: 600;\n  color: ${props => props.isOverBudget ? '#991b1b' : '#166534'};\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n\n  @media (max-width: 768px) {\n    font-size: 12px;\n    padding: 6px 12px;\n    gap: 8px;\n  }\n`;\n\nconst PriceItem = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n\n  .label {\n    font-size: 10px;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    opacity: 0.8;\n    font-weight: 500;\n  }\n\n  .value {\n    font-size: 16px;\n    font-weight: 700;\n\n    @media (max-width: 768px) {\n      font-size: 14px;\n    }\n  }\n`;\n\nconst TitleWithButtons = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  position: relative;\n`;\n\nconst HeaderTitle = styled.h1`\n  font-size: 1.8125rem;\n  font-weight: 700;\n  color: #b45309;\n  margin: 0;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-variant: small-caps;\n  position: relative;\n\n  /* Vt prvn psmeno s gradientnm zvraznnm */\n  &::first-letter {\n    font-size: 1.3em;\n    font-variant: normal;\n    font-weight: 800;\n    background: linear-gradient(135deg, #d97706 0%, #b45309 50%, #92400e 100%);\n    background-clip: text;\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    text-shadow: 0 2px 4px rgba(180, 83, 9, 0.3);\n  }\n\n  /* Horn index pro ID objednvky */\n  .order-id-badge {\n    font-size: 0.4em;\n    font-weight: 500;\n    color: #6b7280;\n    margin-left: 0.1em;\n    vertical-align: top;\n    line-height: 1;\n    position: relative;\n    top: -0.5em;\n    left: -6px;\n  }\n\n  @media (max-width: 768px) {\n    font-size: 1.75rem;\n\n    .order-id-badge {\n      font-size: 0.55em;\n    }\n  }\n`;\n\nconst PhaseInfo = styled.div`\n  font-size: 0.875rem;\n  color: #6b7280;\n  font-weight: 500;\n`;\n\nconst HeaderButtons = styled.div`\n  display: flex;\n  gap: 0.75rem;\n  align-items: center;\n`;\n\nconst HeaderButton = styled.button`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border-radius: 8px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &.template-btn {\n    background: #10b981;\n    color: white;\n    cursor: pointer;\n    opacity: 1;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:hover {\n      background: #059669;\n      transform: scale(1.05);\n    }\n  }\n\n  &.reload-btn {\n    background: #0ea5e9;\n    color: white;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:disabled {\n      cursor: not-allowed;\n      opacity: 0.6;\n\n      &:hover {\n        background: #0ea5e9;\n      }\n    }\n\n    &:not(:disabled) {\n      cursor: pointer;\n      opacity: 1;\n\n      &:hover {\n        background: #0284c7;\n        transform: translateY(-1px);\n      }\n    }\n  }\n\n  &.cancel-btn {\n    background: #dc2626;\n    color: white;\n\n    &:hover {\n      background: #b91c1c;\n    }\n  }\n\n  &.draft-btn {\n    background: #059669;\n    color: white;\n\n    &:hover {\n      background: #047857;\n    }\n\n    &:disabled {\n      background: #9ca3af;\n      cursor: not-allowed;\n    }\n  }\n\n  &.fullscreen-btn {\n    background: #10b981;\n    color: white;\n    cursor: pointer;\n    opacity: 1;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:hover {\n      background: #059669;\n      transform: scale(1.05);\n    }\n  }\n\n  &.toggle-sections-btn {\n    background: #8b5cf6;\n    color: white;\n    cursor: pointer;\n    opacity: 1;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:hover {\n      background: #7c3aed;\n      transform: scale(1.05);\n    }\n  }\n\n  &.generate-docx-btn {\n    background: #f97316;\n    color: white;\n    cursor: pointer;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:disabled {\n      background: #9ca3af;\n      cursor: not-allowed;\n      opacity: 0.6;\n\n      &:hover {\n        background: #9ca3af;\n        transform: none;\n      }\n    }\n\n    &:not(:disabled):hover {\n      background: #ea580c;\n      transform: scale(1.05);\n    }\n  }\n`;\n\nconst PhaseRow = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: #f3f4f6;\n  border: 1px solid #d1d5db;\n  border-radius: 8px;\n  padding: 0.5rem 1rem;\n  margin-bottom: 0;\n  gap: 1rem;\n\n  @media (max-width: 768px) {\n    flex-direction: column;\n    gap: 0.75rem;\n    align-items: stretch;\n  }\n`;\n\nconst PhaseIndicator = styled.div`\n  font-size: 0.875rem;\n  font-weight: 700;\n  text-align: center;\n  position: relative;\n  flex: 1;\n\n  @media (max-width: 768px) {\n    text-align: left;\n  }\n`;\n\nconst PhaseProgressContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  flex: 1;\n`;\n\nconst PriceSummaryContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  gap: 0.25rem;\n  padding-right: 1rem;\n`;\n\nconst PriceSummaryRow = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.875rem;\n  font-weight: 600;\n`;\n\nconst PriceLabel = styled.span`\n  color: #dc2626;\n  font-size: 0.8rem;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  font-weight: 700;\n`;\n\nconst PriceValue = styled.span`\n  color: #dc2626;\n  font-size: 1.1rem;\n  font-weight: 800;\n  font-family: 'Courier New', monospace;\n`;\n\nconst PriceBadge = styled.span`\n  font-size: 0.75rem;\n  padding: 3px 8px;\n  border-radius: 4px;\n  font-weight: 600;\n  background: ${props => props.isOver ? '#fef2f2' : '#f0fdf4'};\n  color: ${props => props.isOver ? '#dc2626' : '#059669'};\n  border: 1px solid ${props => props.isOver ? '#fecaca' : '#bbf7d0'};\n`;\n\nconst PhaseText = styled.div`\n  font-size: 0.875rem;\n  color: #374151;\n  font-weight: 700;\n  text-align: left;\n`;\n\nconst PhaseProgressBar = styled.div`\n  display: flex;\n  height: 6px;\n  background: #e5e7eb;\n  border-radius: 3px;\n  overflow: hidden;\n  position: relative;\n  border: 1px solid #d1d5db;\n`;\n\nconst PhaseSegment = styled.div`\n  flex: 1;\n  position: relative;\n\n  &:not(:last-child)::after {\n    content: '';\n    position: absolute;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    width: 1px;\n    background: #d1d5db;\n    z-index: 2;\n  }\n`;\n\nconst PhaseSegmentFill = styled.div`\n  height: 100%;\n  transition: all 0.3s ease;\n\n  /* Barevn pechody pro jednotliv fze */\n  &.phase-1 {\n    background: linear-gradient(90deg, #9ca3af 0%, #6b7280 100%); /* ed - zatek */\n  }\n\n  &.phase-2 {\n    background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%); /* Oranov - v procesu */\n  }\n\n  &.phase-3 {\n    background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%); /* Modr - odeslno */\n  }\n\n  &.phase-4 {\n    background: linear-gradient(90deg, #10b981 0%, #059669 100%); /* Zelen - potvrzeno */\n  }\n\n  &.phase-5 {\n    background: linear-gradient(90deg, #8b5cf6 0%, #7c3aed 100%); /* Fialov - registr */\n  }\n\n  &.phase-6 {\n    background: linear-gradient(90deg, #06b6d4 0%, #0891b2 100%); /* Tyrkysov - fakturace */\n  }\n\n  &.phase-7 {\n    background: linear-gradient(90deg, #14b8a6 0%, #0d9488 100%); /* Teal - vcn sprvnost */\n  }\n\n  &.phase-8 {\n    background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%); /* Svtle zelen - dokoneno */\n  }\n\n  &.phase-error {\n    background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%); /* erven - chyba/storno */\n  }\n`;\n\nconst PhaseDivider = styled.div`\n  width: 2px;\n  height: 40px;\n  background: linear-gradient(to bottom, transparent, #d1d5db 20%, #d1d5db 80%, transparent);\n  border-radius: 1px;\n\n  @media (max-width: 768px) {\n    width: 100%;\n    height: 2px;\n    background: linear-gradient(to right, transparent, #d1d5db 20%, #d1d5db 80%, transparent);\n  }\n`;\n\nconst FormActions = styled.div`\n  display: flex;\n  gap: 0.75rem;\n  align-items: center;\n`;\n\nconst ActionButton = styled.button`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &.save-btn {\n    background: #10b981;\n    color: white;\n\n    &:hover:not(:disabled) {\n      background: #059669;\n    }\n\n    &:disabled {\n      background: #6b7280;\n      cursor: not-allowed;\n    }\n  }\n\n  &.cancel-btn {\n    background: #dc2626;\n    color: white;\n\n    &:hover {\n      background: #b91c1c;\n    }\n  }\n\n  &.icon-only {\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n`;\n\n//  Keyframe animace pro spinner\nconst spin = keyframes`\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n`;\n\n//  Styled spinner komponent\nconst Spinner = styled.span`\n  display: inline-block;\n  width: 14px;\n  height: 14px;\n  border: 2px solid #ddd;\n  border-top: 2px solid #666;\n  border-radius: 50%;\n  animation: ${spin} 0.8s linear infinite;\n`;\n\n//  Styled retry button - nenpadn, ale funkn\nconst RetryButton = styled.button`\n  padding: 2px 8px;\n  fontSize: 11px;\n  backgroundColor: #fef3c7;\n  border: 1px solid #fbbf24;\n  borderRadius: 4px;\n  color: #92400e;\n  cursor: pointer;\n  fontWeight: 500;\n  transition: all 0.2s ease;\n\n  &:hover {\n    background-color: #fde68a;\n    border-color: #f59e0b;\n  }\n\n  &:active {\n    transform: scale(0.95);\n  }\n`;\n\nconst EvidenceNumber = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n\n  @media (max-width: 768px) {\n    flex-direction: column;\n    gap: 0.25rem;\n    align-items: flex-start;\n  }\n`;\n\nconst EvidenceLabel = styled.div`\n  font-size: 0.75rem;\n  color: #6b7280;\n  font-weight: 500;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  white-space: nowrap;\n`;\n\nconst EvidenceValue = styled.div`\n  font-size: 1rem;\n  font-weight: 700;\n  color: ${props => props.$isEmergency ? '#fde047' : '#1e40af'};\n  font-family: 'Courier New', monospace;\n  background: ${props => props.$isEmergency \n    ? 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)' \n    : 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)'};\n  padding: 0.4rem 0.6rem;\n  border-radius: 6px;\n  border: 1px solid ${props => props.$isEmergency ? '#991b1b' : '#93c5fd'};\n  white-space: nowrap;\n`;\n\nconst FormSection = styled.div`\n  background: #ffffff;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n  margin-bottom: 1.5rem;\n  overflow: visible;\n  border: 1px solid #e2e8f0;\n`;\n\nconst SectionHeader = styled.div`\n  padding: 1rem 1.25rem;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  transition: all 0.3s ease;\n\n  /* Barevn schma podle typu sekce */\n  ${props => {\n    // Ur zkladn barvu podle typu sekce\n    const getBaseColors = (sectionTheme) => {\n      switch(sectionTheme) {\n        case 'section-grey':\n          return {\n            bg: ['#f9fafb', '#f3f4f6'],\n            border: '#9ca3af',\n            hover: ['#f3f4f6', '#e5e7eb']\n          };\n        case 'section-orange':\n          return {\n            bg: ['#fef3c7', '#fde68a'],\n            border: '#f59e0b',\n            hover: ['#fde68a', '#facc15']\n          };\n        case 'section-blue':\n          return {\n            bg: ['#dbeafe', '#bfdbfe'],\n            border: '#3b82f6',\n            hover: ['#bfdbfe', '#93c5fd']\n          };\n        case 'section-purple':\n          return {\n            bg: ['#f3e8ff', '#e9d5ff'],\n            border: '#a855f7',\n            hover: ['#e9d5ff', '#d8b4fe']\n          };\n        case 'section-red':\n          return {\n            bg: ['#fee2e2', '#fecaca'],\n            border: '#dc2626',\n            hover: ['#fecaca', '#fca5a5']\n          };\n        default:\n          return {\n            bg: ['#fef3c7', '#fde68a'],\n            border: '#f59e0b',\n            hover: ['#fde68a', '#facc15']\n          };\n      }\n    };\n\n    const colors = getBaseColors(props.sectionTheme);\n\n    // Uprav intenzitu podle toho, jestli je sekce aktivn\n    const opacity = props.isActive ? '1' : '0.6';\n\n    return `\n      background: linear-gradient(135deg, ${colors.bg[0]} 0%, ${colors.bg[1]} 100%);\n      border-bottom: 1px solid ${colors.border};\n      opacity: ${opacity};\n\n      &:hover {\n        background: linear-gradient(135deg, ${colors.hover[0]} 0%, ${colors.hover[1]} 100%);\n        opacity: 1;\n      }\n    `;\n  }}\n`;\n\nconst SectionTitle = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  font-weight: 600;\n  font-size: 1.1rem;\n\n  ${props => {\n    switch(props.sectionTheme) {\n      case 'section-grey':\n        return 'color: #4b5563;';\n      case 'section-orange':\n        return 'color: #92400e;';\n      case 'section-blue':\n        return 'color: #1e40af;';\n      case 'section-purple':\n        return 'color: #7e22ce;';\n      case 'section-red':\n        return 'color: #991b1b;';\n      default:\n        return 'color: #92400e;';\n    }\n  }}\n`;\n\nconst SectionIcon = styled.div`\n  font-size: 1.2rem;\n\n  ${props => {\n    switch(props.sectionTheme) {\n      case 'section-grey':\n        return 'color: #6b7280;';\n      case 'section-orange':\n        return 'color: #f59e0b;';\n      case 'section-blue':\n        return 'color: #3b82f6;';\n      case 'section-purple':\n        return 'color: #a855f7;';\n      case 'section-red':\n        return 'color: #dc2626;';\n      default:\n        return 'color: #f59e0b;';\n    }\n  }}\n`;\n\nconst CollapseIcon = styled.div`\n  transition: transform 0.2s ease;\n  transform: ${props => props.collapsed ? 'rotate(0deg)' : 'rotate(180deg)'};\n\n  ${props => {\n    switch(props.sectionTheme) {\n      case 'section-grey':\n        return 'color: #4b5563;';\n      case 'section-orange':\n        return 'color: #92400e;';\n      case 'section-blue':\n        return 'color: #1e40af;';\n      case 'section-purple':\n        return 'color: #7e22ce;';\n      case 'section-red':\n        return 'color: #991b1b;';\n      default:\n        return 'color: #92400e;';\n    }\n  }}\n`;\n\nconst SectionControls = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n`;\n\nconst LockWarning = styled.span`\n  margin-left: 0.75rem;\n  color: #dc2626;\n  font-size: 0.7rem;\n  font-weight: 500;\n  background: rgba(255, 255, 255, 0.2);\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n  cursor: help;\n`;\n\nconst SectionContent = styled.div`\n  padding: 1.5rem 1.25rem;\n  display: ${props => props.collapsed ? 'none' : 'block'};\n`;\n\nconst EmergencyToggleWrapper = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  opacity: ${props => props.disabled ? 0.6 : 1};\n  pointer-events: ${props => props.disabled ? 'none' : 'auto'};\n`;\n\nconst EmergencyToggleSwitch = styled.label`\n  position: relative;\n  display: inline-block;\n  width: 56px;\n  height: 28px;\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  flex-shrink: 0;\n\n  input {\n    opacity: 0;\n    width: 0;\n    height: 0;\n  }\n\n  span {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: ${props => props.checked ? '#ef4444' : '#cbd5e1'};\n    border-radius: 28px;\n    transition: all 0.3s ease;\n\n    &::before {\n      content: '';\n      position: absolute;\n      height: 20px;\n      width: 20px;\n      left: 4px;\n      bottom: 4px;\n      background-color: white;\n      border-radius: 50%;\n      transition: all 0.3s ease;\n      transform: ${props => props.checked ? 'translateX(28px)' : 'translateX(0)'};\n    }\n  }\n\n  input:focus + span {\n    box-shadow: 0 0 0 3px ${props => props.checked ? 'rgba(239, 68, 68, 0.1)' : 'rgba(59, 130, 246, 0.1)'};\n  }\n`;\n\nconst EmergencyToggleLabel = styled.span`\n  font-size: 0.9rem;\n  font-weight: ${props => props.checked ? '700' : '400'};\n  color: ${props => props.checked ? '#dc2626' : '#374151'};\n`;\n\nconst FormRow = styled.div`\n  display: grid;\n  grid-template-columns: 1fr 1fr 1fr;\n  gap: 1rem;\n  margin-bottom: 1rem;\n\n  @media (max-width: 1024px) {\n    grid-template-columns: 1fr 1fr;\n  }\n\n  @media (max-width: 768px) {\n    grid-template-columns: 1fr;\n  }\n`;\n\nconst FormGroup = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n`;\n\nconst ErrorText = styled.div`\n  color: #dc2626;\n  font-size: 0.75rem;\n  font-weight: 500;\n  margin-top: 0.25rem;\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n`;\n\nconst Label = styled.label`\n  font-weight: 600;\n  font-size: 0.875rem;\n  color: #374151;\n\n  &::after {\n    content: ${props => props.required ? '\" *\"' : '\"\"'};\n    color: #dc2626;\n    margin-left: 2px;\n  }\n`;\n\n// Label s Clear tlatkem vpravo (pro selects)\nconst LabelWithClear = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n  width: 100%;\n  margin-bottom: 0.5rem;\n`;\n\nconst LabelText = styled.label`\n  font-weight: 600;\n  font-size: 0.875rem;\n  color: #374151;\n\n  &::after {\n    content: ${props => props.required ? '\" *\"' : '\"\"'};\n    color: #dc2626;\n    margin-left: 2px;\n  }\n`;\n\nconst ClearSelectButton = styled.button`\n  background: none;\n  border: none;\n  padding: 0.25rem 0.5rem;\n  cursor: pointer;\n  color: #9ca3af;\n  font-size: 0.75rem;\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  transition: all 0.2s ease;\n  border-radius: 4px;\n  opacity: ${props => props.$visible ? 1 : 0};\n  pointer-events: ${props => props.$visible ? 'auto' : 'none'};\n\n  &:hover {\n    color: #ef4444;\n    background: rgba(239, 68, 68, 0.1);\n  }\n\n  svg {\n    width: 12px;\n    height: 12px;\n  }\n`;\n\n// Wrapper pro input s ikonou\nconst InputWithIcon = styled.div`\n  position: relative;\n  width: 100%;\n\n  > svg {\n    position: absolute;\n    left: 0.75rem;\n    top: 50%;\n    transform: translateY(-50%);\n    color: #9ca3af;\n    z-index: 1;\n    pointer-events: none;\n    width: 16px !important;\n    height: 16px !important;\n  }\n`;\n\nconst Input = styled.input`\n  width: 100%;\n  box-sizing: border-box;\n  padding: ${props => props.hasIcon ? '0.75rem 0.75rem 0.75rem 2.5rem' : '0.75rem'};\n  border: 2px solid ${props => props.hasError ? '#dc2626' : '#e5e7eb'};\n  border-radius: 8px;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n  background: #ffffff;\n\n  /* Zvraznn vyplnn hodnoty vs. placeholder - sladno s CustomSelect */\n  color: ${props => props.value && props.value !== '' ? '#1f2937' : '#6b7280'};\n  font-weight: ${props => {\n    if (props.disabled) return '400'; // Disabled elementy maj normln font-weight\n    return props.value && props.value !== '' ? '600' : '400'; // Sladno s CustomSelect\n  }};\n\n  &:focus {\n    outline: none;\n    border-color: ${props => props.hasError ? '#dc2626' : '#3b82f6'};\n    box-shadow: 0 0 0 3px ${props => props.hasError ? 'rgba(220, 38, 38, 0.1)' : 'rgba(59, 130, 246, 0.1)'};\n  }\n\n  &:focus + svg {\n    color: ${props => props.hasError ? '#dc2626' : '#3b82f6'};\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    color: #6b7280;\n    cursor: not-allowed;\n  }\n\n  /* Sjednocen placeholder barvy se selecty */\n  &::placeholder {\n    color: #9ca3af;\n    opacity: 1;\n    font-weight: 400;\n  }\n\n  &::-webkit-input-placeholder {\n    color: #9ca3af;\n    font-weight: 400;\n  }\n\n  &::-moz-placeholder {\n    color: #9ca3af;\n    opacity: 1;\n    font-weight: 400;\n  }\n\n  /* Odstrann spinner arrows u number input */\n  &[type=\"number\"] {\n    -moz-appearance: textfield; /* Firefox */\n    appearance: textfield;\n\n    &::-webkit-outer-spin-button,\n    &::-webkit-inner-spin-button {\n      -webkit-appearance: none;\n      margin: 0;\n    }\n  }\n`;\n\nconst TextArea = styled.textarea`\n  width: 100%;\n  box-sizing: border-box;\n  padding: 0.75rem;\n  border: 2px solid ${props => props.hasError ? '#dc2626' : '#e5e7eb'};\n  border-radius: 8px;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n  background: #ffffff;\n  font-family: inherit;\n  resize: vertical;\n  min-height: 80px;\n\n  /* Zvraznn vyplnn hodnoty vs. placeholder - sladno s CustomSelect */\n  color: ${props => props.value && props.value !== '' ? '#1f2937' : '#6b7280'};\n  font-weight: ${props => {\n    if (props.disabled) return '400'; // Disabled elementy maj normln font-weight\n    return props.value && props.value !== '' ? '600' : '400'; // Sladno s CustomSelect\n  }};\n\n  &:focus {\n    outline: none;\n    border-color: ${props => props.hasError ? '#dc2626' : '#3b82f6'};\n    box-shadow: 0 0 0 3px ${props => props.hasError ? 'rgba(220, 38, 38, 0.1)' : 'rgba(59, 130, 246, 0.1)'};\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    color: #6b7280;\n    cursor: not-allowed;\n  }\n\n  &::placeholder {\n    color: #9ca3af;\n    opacity: 1;\n    font-weight: 400;\n  }\n`;\n\n//  Komponenta pro zobrazen zbvajc stky (LP a Smlouvy)\nconst RemainingAmountDisplay = styled.div`\n  margin-top: 0.75rem;\n  padding: 0.75rem;\n  border-radius: 8px;\n  background: ${props => {\n    if (props.$loading) return '#f3f4f6';\n    if (props.$notFound) return '#fef2f2';\n    if (props.$isNegative) return '#fef2f2';\n    return '#f0fdf4';\n  }};\n  border: 2px solid ${props => {\n    if (props.$loading) return '#e5e7eb';\n    if (props.$notFound) return '#fecaca';\n    if (props.$isNegative) return '#fca5a5';\n    return '#86efac';\n  }};\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  animation: slideDown 0.3s ease;\n\n  @keyframes slideDown {\n    from {\n      opacity: 0;\n      transform: translateY(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n`;\n\nconst RemainingAmountIcon = styled.div`\n  font-size: 1.5rem;\n  flex-shrink: 0;\n`;\n\nconst RemainingAmountContent = styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n`;\n\nconst RemainingAmountLabel = styled.div`\n  font-size: 0.75rem;\n  font-weight: 500;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n  color: ${props => {\n    if (props.$loading) return '#6b7280';\n    if (props.$notFound) return '#991b1b';\n    if (props.$isNegative) return '#b91c1c';\n    return '#15803d';\n  }};\n`;\n\nconst RemainingAmountValue = styled.div`\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: ${props => {\n    if (props.$loading) return '#6b7280';\n    if (props.$notFound) return '#991b1b';\n    if (props.$isNegative) return '#dc2626';\n    return '#16a34a';\n  }};\n  font-variant-numeric: tabular-nums;\n`;\n\nconst RemainingAmountSubtext = styled.div`\n  font-size: 0.75rem;\n  color: #6b7280;\n  margin-top: 0.125rem;\n`;\n\n//  Styled komponenty pro autocomplete smluv\nconst SmlouvaAutocompleteContainer = styled.div`\n  position: relative;\n  width: 100%;\n`;\n\nconst SmlouvaSuggestionsList = styled.div`\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  margin-top: 0.25rem;\n  background: white;\n  border: 2px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  max-height: 300px;\n  overflow-y: auto;\n  z-index: 1000;\n  animation: slideDown 0.2s ease;\n\n  @keyframes slideDown {\n    from {\n      opacity: 0;\n      transform: translateY(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n`;\n\nconst SmlouvaSuggestionItem = styled.div`\n  padding: 0.75rem;\n  cursor: pointer;\n  border-bottom: 1px solid #f3f4f6;\n  transition: all 0.15s ease;\n\n  &:hover {\n    background: #f3f4f6;\n  }\n\n  &:last-child {\n    border-bottom: none;\n  }\n`;\n\nconst SmlouvaSuggestionTitle = styled.div`\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #1f2937;\n  margin-bottom: 0.25rem;\n`;\n\nconst SmlouvaSuggestionMeta = styled.div`\n  font-size: 0.75rem;\n  color: #6b7280;\n  display: flex;\n  gap: 1rem;\n`;\n\nconst SmlouvaSuggestionEmpty = styled.div`\n  padding: 1rem;\n  text-align: center;\n  color: #6b7280;\n  font-size: 0.875rem;\n`;\n\nconst Select = styled.select`\n  width: 100%;\n  box-sizing: border-box;\n  padding: 0.75rem;\n  border: 2px solid ${props => props.hasError ? '#dc2626' : '#e5e7eb'};\n  border-radius: 8px;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n  background: #ffffff;\n  cursor: pointer;\n\n  /* Zvraznn vybran hodnoty vs. placeholder - sladno s CustomSelect */\n  color: ${props => props.value && props.value !== '' && props.value !== 'placeholder' ? '#1f2937' : '#6b7280'};\n  font-weight: ${props => {\n    if (props.disabled) return '400'; // Disabled elementy maj normln font-weight\n    return props.value && props.value !== '' && props.value !== 'placeholder' ? '600' : '400'; // Sladno s CustomSelect\n  }};\n\n  &:focus {\n    outline: none;\n    border-color: ${props => props.hasError ? '#dc2626' : '#3b82f6'};\n    box-shadow: 0 0 0 3px ${props => props.hasError ? 'rgba(220, 38, 38, 0.1)' : 'rgba(59, 130, 246, 0.1)'};\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    color: #6b7280;\n    cursor: not-allowed;\n  }\n\n  /* Placeholder styl pro prvn option */\n  option:first-child {\n    color: #9ca3af;\n    font-weight: 400;\n  }\n`;\n\n// Multi-select komponenta pro stediska - lokln komponenty\nconst MultiSelectWrapper = styled.div`\n  position: relative;\n  width: 100%;\n  z-index: ${props => props.isOpen ? 10000 : 1};\n`;\n\nconst MultiSelectButton = styled.div`\n  width: 100%;\n  box-sizing: border-box;\n  padding: 0.75rem 1.75rem 0.75rem 0.75rem;\n  border: 2px solid ${props => props.hasError ? '#dc2626' : '#e5e7eb'};\n  border-radius: 8px;\n  font-size: 0.875rem;\n  background: ${props => props.disabled ? '#f9fafb' : '#ffffff'};\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  color: ${props => {\n    if (props.disabled) return '#6b7280';\n    if (props.placeholder || !props.value || props.value === '') return '#9ca3af';\n    return '#1f2937';\n  }};\n\n  font-weight: ${props => props.disabled ? '400' : (props.value && props.value !== '' && props.placeholder !== \"true\" ? '600' : '400')};\n  min-height: 2.5rem;\n\n  display: flex;\n  align-items: center;\n  position: relative;\n  transition: all 0.2s ease;\n\n  /* Custom arrow */\n  appearance: none;\n  -moz-appearance: none;\n  -webkit-appearance: none;\n  background-image: ${props => {\n    if (props.disabled) {\n      return props.isOpen\n        ? `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='18 15 12 9 6 15'%3E%3C/polyline%3E%3C/svg%3E\")`\n        : `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")`;\n    } else if (props.hasError) {\n      return props.isOpen\n        ? `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23b91c1c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='18 15 12 9 6 15'%3E%3C/polyline%3E%3C/svg%3E\")`\n        : `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23b91c1c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")`;\n    } else {\n      return props.isOpen\n        ? `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23374151' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='18 15 12 9 6 15'%3E%3C/polyline%3E%3C/svg%3E\")`\n        : `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23374151' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")`;\n    }\n  }};\n  background-repeat: no-repeat;\n  background-position: right 0.5rem center;\n  background-size: 16px 16px;\n\n  &:hover {\n    border-color: ${props => props.disabled ? '#e5e7eb' : (props.hasError ? '#dc2626' : '#3b82f6')};\n  }\n\n  &:focus {\n    outline: none;\n    border-color: ${props => props.hasError ? '#dc2626' : '#3b82f6'};\n    box-shadow: 0 0 0 3px ${props => props.hasError ? 'rgba(220, 38, 38, 0.1)' : 'rgba(59, 130, 246, 0.1)'};\n  }\n`;\n\nconst SelectedValue = styled.span`\n  flex: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  color: ${props => props.isEmpty ? '#9ca3af' : '#1f2937'};\n  font-weight: ${props => props.isEmpty ? '400' : '600'};\n`;\n\nconst CustomSelectDropdown = styled.div`\n  position: fixed;\n  z-index: 40;\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.1);\n  max-height: 300px;\n  overflow-y: auto;\n  min-width: 200px;\n\n  /* Prevent text selection while scrolling */\n  user-select: none;\n\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #f9fafb;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 4px;\n  }\n`;\n\nconst CustomSelectOption = styled.div`\n  padding: 0.75rem;\n  cursor: pointer;\n  font-size: 0.875rem;\n  border-bottom: 1px solid #f3f4f6;\n  color: #1f2937;\n  font-weight: 400 !important; /* Normal font pro vechny monosti - s !important */\n\n  &:hover {\n    background: #f8fafc;\n    font-weight: 400 !important; /* Zstv normal i pi hover */\n  }\n\n  &:last-child {\n    border-bottom: none;\n  }\n\n  ${props => props.selected && `\n    background: #eff6ff;\n    border-left: 3px solid #3b82f6;\n    font-weight: 600 !important; /* Bold jen pro vybranou monost */\n  `}\n`;\n\nconst MultiSelectDropdown = styled.div`\n  position: fixed;\n  z-index: 40;\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.1);\n  max-height: 300px;\n  overflow-y: auto;\n  min-width: 200px;\n\n  /* Prevent text selection while scrolling */\n  user-select: none;\n\n  /* Optimalizace pro plynulej scrollovn */\n  scroll-behavior: auto;\n  contain: layout style paint;\n  will-change: scroll-position;\n  transform: translateZ(0); /* Force hardware acceleration */\n\n  /* Lep scrollbar styling */\n  scrollbar-width: thin;\n  scrollbar-color: #d1d5db #f9fafb;\n\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #f9fafb;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background: #9ca3af;\n  }\n`;\n\nconst SearchBox = styled.div`\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n  padding: 0.75rem;\n  border-bottom: 1px solid #e5e7eb;\n`;\n\nconst SearchInput = styled.input`\n  width: 100%;\n  padding: 0.75rem 0.75rem 0.75rem 2.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  font-size: 0.875rem;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n  }\n`;\n\nconst SearchIcon = styled.div`\n  position: absolute;\n  left: 1rem;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #6b7280;\n  pointer-events: none;\n`;\n\nconst TemplateSearchBox = styled.div`\n  position: relative;\n  width: 100%;\n`;\n\nconst SearchClearButton = styled.button`\n  position: absolute;\n  right: 0.75rem;\n  top: 50%;\n  transform: translateY(-50%);\n  background: none;\n  border: none;\n  color: #9ca3af;\n  cursor: pointer;\n  padding: 0.25rem;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n\n  &:hover {\n    color: #6b7280;\n    background: #f3f4f6;\n  }\n\n  &:active {\n    transform: translateY(-50%) scale(0.95);\n  }\n`;\n\nconst TemplateSearchInput = styled(SearchInput)`\n  padding-right: 2.5rem;\n`;\n\n// Modern Template Save Modal komponenty\nconst TemplateModalOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.4);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 999999;\n  padding: 1rem;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n`;\n\n// Delete Confirmation Modal Components - vy z-index ne fullscreen (100000+)\nconst DeleteConfirmOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n`;\n\nconst DeleteConfirmModal = styled.div`\n  background: white;\n  padding: 2rem;\n  border-radius: 8px;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n  max-width: 400px;\n  width: 90%;\n  z-index: 100001;\n`;\n\nconst DeleteConfirmTitle = styled.div`\n  font-size: 1.125rem;\n  font-weight: 600;\n  margin-bottom: 1rem;\n  color: #dc2626;\n`;\n\nconst DeleteConfirmMessage = styled.div`\n  margin-bottom: 1.5rem;\n  color: #374151;\n  line-height: 1.5;\n`;\n\nconst DeleteConfirmActions = styled.div`\n  display: flex;\n  gap: 0.75rem;\n  justify-content: flex-end;\n`;\n\nconst DeleteConfirmButton = styled.button`\n  padding: 0.75rem 1.5rem;\n  background-color: ${props => props.variant === 'danger' ? '#dc2626' : '#f3f4f6'};\n  color: ${props => props.variant === 'danger' ? 'white' : '#374151'};\n  border: none;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.15s ease;\n\n  &:hover {\n    background-color: ${props => props.variant === 'danger' ? '#b91c1c' : '#e5e7eb'};\n  }\n`;\n\nconst TemplateModal = styled.div`\n  background: white;\n  border-radius: 8px;\n  width: 100%;\n  max-width: 600px;\n  padding: 2rem;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n`;\n\nconst TemplateModalHeader = styled.div`\n  margin-bottom: 1.5rem;\n  border-bottom: 1px solid #e5e7eb;\n  padding-bottom: 1rem;\n`;\n\nconst TemplateModalTitle = styled.h2`\n  margin: 0;\n  color: #1e293b;\n  font-size: 1.25rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n`;\n\nconst TemplateModalCloseButton = styled.button`\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  background: transparent;\n  border: none;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: #64748b;\n  transition: all 0.2s;\n  border-radius: 4px;\n\n  &:hover {\n    background: #f1f5f9;\n    color: #1e293b;\n  }\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n`;\n\nconst TemplateModalBody = styled.div`\n  /* dn padding - u je v hlavnm modalu */\n`;\n\nconst TemplateFormGroup = styled.div`\n  margin-bottom: 1.25rem;\n`;\n\nconst TemplateLabel = styled.label`\n  display: block;\n  font-size: 0.75rem;\n  font-weight: 700;\n  color: #64748b;\n  margin-bottom: 0.5rem;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n`;\n\nconst TemplateInput = styled.input`\n  width: 100%;\n  padding: 10px 12px;\n  border: 2px solid #e5e7eb;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n  background: white;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n\n  &::placeholder {\n    color: #9ca3af;\n  }\n`;\n\nconst TemplateSelect = styled.select`\n  width: 100%;\n  padding: 10px 12px;\n  border: 2px solid #e5e7eb;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n  background: white;\n  cursor: pointer;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n\n  option {\n    padding: 8px;\n  }\n`;\n\nconst TemplateTypeGrid = styled.div`\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n  gap: 1rem;\n  margin-top: 0.75rem;\n`;\n\nconst TemplateTypeOption = styled.label`\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  padding: 1rem;\n  border: 2px solid ${props => props.checked ? '#10b981' : '#e5e7eb'};\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  background: ${props => props.checked ? 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)' : 'white'};\n\n  &:hover {\n    border-color: #10b981;\n    background: ${props => props.checked ? 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)' : '#f8fafc'};\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);\n  }\n`;\n\nconst TemplateTypeRadio = styled.input`\n  appearance: none;\n  width: 20px;\n  height: 20px;\n  border: 2px solid #d1d5db;\n  border-radius: 50%;\n  position: relative;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  margin-top: 2px;\n\n  &:checked {\n    border-color: #10b981;\n    background: #10b981;\n  }\n\n  &:checked::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 8px;\n    height: 8px;\n    background: white;\n    border-radius: 50%;\n  }\n`;\n\nconst TemplateTypeText = styled.div`\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: ${props => props.checked ? '#065f46' : '#374151'};\n  line-height: 1.4;\n`;\n\nconst TemplateModalActions = styled.div`\n  display: flex;\n  gap: 0.75rem;\n  justify-content: flex-end;\n  margin-top: 1.5rem;\n  padding-top: 1.5rem;\n  border-top: 1px solid #e5e7eb;\n`;\n\nconst TemplateActionButton = styled.button`\n  padding: 0.625rem 1.25rem;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  transition: all 0.2s;\n\n  ${props => props.variant === 'cancel' ? `\n    background: white;\n    color: #64748b;\n    border: 1px solid #e2e8f0;\n\n    &:hover {\n      background: #f8fafc;\n      border-color: #cbd5e1;\n    }\n  ` : `\n    background: ${props.disabled ? '#cbd5e1' : '#3b82f6'};\n    color: white;\n    border: 1px solid ${props.disabled ? '#cbd5e1' : '#3b82f6'};\n\n    &:hover:not(:disabled) {\n      background: #2563eb;\n      border-color: #2563eb;\n    }\n\n    &:disabled {\n      cursor: not-allowed;\n    }\n  `}\n`;\n\nconst MultiSelectOption = styled.div`\n  padding: ${props => props.level === 0 ? '0.75rem' : '0.5rem 0.75rem 0.5rem 2rem'};\n  cursor: pointer;\n  font-size: 0.875rem;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  background: ${props => props.level === 0 ? '#f9fafb' : '#ffffff'};\n  border-bottom: ${props => props.level === 0 ? '2px solid #e5e7eb' : '1px solid #f3f4f6'};\n  font-weight: ${props => props.level === 0 ? '600' : '400'};\n  color: ${props => props.level === 0 ? '#111827' : '#4b5563'};\n  position: relative;\n  /* Optimalizace pro plynulej scrollovn */\n  will-change: transform;\n  backface-visibility: hidden;\n  /* Focusable pro tab navigaci */\n  outline: none;\n\n  &:hover {\n    background: ${props => props.level === 0 ? '#f3f4f6' : '#f8fafc'};\n  }\n\n  &:focus {\n    background: #dbeafe;\n    box-shadow: inset 0 0 0 2px #3b82f6;\n  }\n\n  &:last-child {\n    border-bottom: none;\n  }\n\n  input[type=\"checkbox\"] {\n    margin: 0;\n    /* Zabrnit pefokusovn pi kliknut na checkbox */\n    pointer-events: none;\n  }\n\n  span {\n    padding-left: ${props => (props.level || 0) * 20}px;\n    font-weight: ${props => (props.level || 0) === 0 ? '600' : '400'};\n  }\n`;\n\nconst RadioGroup = styled.div`\n  display: flex;\n  gap: 1rem;\n  align-items: center;\n  margin-top: 0.5rem;\n`;\n\nconst RadioLabel = styled.label`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-size: 0.875rem;\n  color: #374151;\n`;\n\nconst RadioInput = styled.input`\n  width: 16px;\n  height: 16px;\n  cursor: pointer;\n`;\n\n// Unlock button pro FZE 1 sekce - bez pozad, jen ikona\nconst UnlockButton = styled.button`\n  background: transparent;\n  color: #f59e0b;\n  border: none;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n  padding: 0;\n  margin-right: 8px;\n\n  &:hover {\n    color: #d97706;\n    transform: scale(1.1);\n  }\n\n  &:active {\n    transform: scale(0.95);\n  }\n\n  svg {\n    width: 16px;\n    height: 16px;\n  }\n`;\n\n// Loading overlay pro inicializaci formule with blur and fade\nconst LoadingOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(248, 250, 252, 0.95);\n  backdrop-filter: blur(${props => props.$visible ? '8px' : '0px'});\n  -webkit-backdrop-filter: blur(${props => props.$visible ? '8px' : '0px'});\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  z-index: 999999;\n  opacity: ${props => props.$visible ? 1 : 0};\n  transition: opacity 0.5s ease-in-out, backdrop-filter 0.6s ease-in-out;\n  pointer-events: ${props => props.$visible ? 'auto' : 'none'};\n\n  @media (max-width: 768px) {\n    padding: 1rem;\n  }\n`;\n\nconst LoadingSpinner = styled.div`\n  width: 64px;\n  height: 64px;\n  border: 4px solid #e2e8f0;\n  border-top: 4px solid #f59e0b;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n  margin-bottom: 1.5rem;\n  transform: scale(${props => props.$visible ? 1 : 0.8});\n  transition: transform 0.5s ease-in-out;\n\n  @keyframes spin {\n    0% { transform: rotate(0deg) scale(1); }\n    100% { transform: rotate(360deg) scale(1); }\n  }\n`;\n\nconst LoadingMessage = styled.div`\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #374151;\n  text-align: center;\n  margin-bottom: 0.5rem;\n  transform: translateY(${props => props.$visible ? '0' : '10px'});\n  opacity: ${props => props.$visible ? 1 : 0};\n  transition: transform 0.5s ease-in-out 0.1s, opacity 0.5s ease-in-out 0.1s;\n`;\n\nconst LoadingSubtext = styled.div`\n  font-size: 0.875rem;\n  color: #6b7280;\n  text-align: center;\n  transform: translateY(${props => props.$visible ? '0' : '10px'});\n  opacity: ${props => props.$visible ? 1 : 0};\n  transition: transform 0.5s ease-in-out 0.15s, opacity 0.5s ease-in-out 0.15s;\n`;\n\n//  Save Overlay - blur efekt pro zbytek strnky krom hlaviky pi ukldn\nconst SaveOverlay = styled.div`\n  position: fixed;\n  top: var(--fixed-header-height, 0px);\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.2);\n  backdrop-filter: blur(${props => props.$visible ? '5px' : '0px'});\n  -webkit-backdrop-filter: blur(${props => props.$visible ? '5px' : '0px'});\n  z-index: 99;\n  opacity: ${props => props.$visible ? 1 : 0};\n  transition: opacity 0.3s ease-in-out, backdrop-filter 0.3s ease-in-out;\n  pointer-events: ${props => props.$visible ? 'auto' : 'none'};\n  visibility: ${props => props.$visible ? 'visible' : 'hidden'};\n`;\n\n//  Hlasov rozpoznvn je implementovno globln v Layout.js\n// OrderForm25 NEPOUV vlastn indiktor, aby nedochzelo ke kolizm\n\nconst PageContent = styled.div`\n  filter: blur(${props => props.$blurred ? '3px' : '0px'});\n  transition: filter 0.6s ease-in-out;\n  pointer-events: ${props => props.$blurred ? 'none' : 'auto'};\n`;\n\nconst LoadingProgressBarContainer = styled.div`\n  width: 300px;\n  height: 6px;\n  background: #e2e8f0;\n  border-radius: 3px;\n  overflow: hidden;\n  margin-top: 1.5rem;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) inset;\n`;\n\nconst LoadingProgressBarFill = styled.div`\n  height: 100%;\n  background: linear-gradient(90deg, #2e7d32, #4caf50 40%, #66bb6a);\n  border-radius: 3px;\n  transition: width 250ms ease;\n  box-shadow: 0 0 6px rgba(76, 175, 80, 0.55);\n`;\n\nconst ErrorMessage = styled.div`\n  background: #fee2e2;\n  border: 1px solid #fecaca;\n  border-radius: 8px;\n  padding: 1rem;\n  color: #dc2626;\n  font-size: 0.875rem;\n  margin: 1rem 0;\n  text-align: center;\n`;\n\n// Ikony pro dodavatelsk pole\nconst SupplierSearchIcon = styled.div`\n  position: absolute;\n  right: 35px;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #059669;\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n\n  &:hover {\n    background-color: #f0fdf4;\n    color: #047857;\n  }\n\n  &:active {\n    background-color: #dcfce7;\n  }\n`;\n\nconst AresSearchIcon = styled.div`\n  position: absolute;\n  right: 8px;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #059669;\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n\n  &:hover {\n    background-color: #f0fdf4;\n    color: #047857;\n  }\n\n  &:active {\n    background-color: #dcfce7;\n  }\n`;\n\nconst AddToDirectoryIcon = styled.div`\n  color: ${props => props.isActive ? '#667eea' : '#d1d5db'};\n  cursor: ${props => props.isActive ? 'pointer' : 'not-allowed'};\n  padding: 6px;\n  border-radius: 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  transition: all 0.2s;\n  opacity: ${props => props.isActive ? 1 : 0.5};\n  background: ${props => props.isActive ? 'rgba(102, 126, 234, 0.1)' : 'transparent'};\n\n  ${props => props.isActive && `\n    &:hover {\n      background-color: rgba(102, 126, 234, 0.2);\n      color: #764ba2;\n      transform: scale(1.1);\n    }\n\n    &:active {\n      background-color: rgba(118, 75, 162, 0.2);\n      transform: scale(1.05);\n    }\n  `}\n`;\n\n// Ikona koe pro mazn poloek\nconst DeleteItemButton = styled.button`\n  background: #ef4444;\n  color: white;\n  border: 2px solid white;\n  border-radius: 6px;\n  padding: 0.375rem;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  transition: all 0.2s;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\n  &:hover {\n    background-color: #dc2626;\n    transform: scale(1.1);\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);\n  }\n\n  &:active {\n    background-color: #b91c1c;\n    transform: scale(0.95);\n  }\n`;\n\n// Supplier Directory Popup Styled Components\nconst SupplierPopupOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n`;\n\nconst SupplierPopupModal = styled.div`\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 800px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  animation: slideUp 0.3s ease-out;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n`;\n\nconst SupplierPopupHeader = styled.div`\n  padding: 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n`;\n\nconst SupplierPopupTitle = styled.h2`\n  margin: 0;\n  font-size: 20px;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  color: white;\n\n  svg {\n    font-size: 24px;\n  }\n`;\n\nconst SupplierPopupCloseButton = styled.button`\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 24px;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n`;\n\nconst SupplierSearchInput = styled.input`\n  width: 100%;\n  padding: 10px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 6px;\n  font-size: 14px;\n  transition: all 0.2s;\n\n  &:focus {\n    outline: none;\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 2px rgba(24,144,255,0.1);\n  }\n\n  &::placeholder {\n    color: #8c8c8c;\n  }\n`;\n\nconst SupplierPopupContent = styled.div`\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n`;\n\nconst SupplierList = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  max-height: 400px;\n  overflow-y: auto;\n`;\n\nconst SupplierItem = styled.div`\n  padding: 16px;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s;\n  background: white;\n\n  &:hover {\n    border-color: #667eea;\n    background-color: #f9fafb;\n    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);\n  }\n`;\n\n// ARES Popup Styled Components\nconst AresPopupOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n`;\n\nconst AresPopupModal = styled.div`\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 900px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  animation: slideUp 0.3s ease-out;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n`;\n\nconst AresPopupHeader = styled.div`\n  padding: 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n`;\n\nconst AresPopupTitle = styled.h2`\n  margin: 0;\n  font-size: 18px;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  color: white;\n\n  svg {\n    width: 24px;\n    height: 24px;\n  }\n`;\n\nconst AresPopupCloseButton = styled.button`\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n`;\n\nconst AresPopupContent = styled.div`\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n`;\n\nconst AresSearchInputField = styled.input`\n  width: 100%;\n  padding: 10px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 6px;\n  font-size: 14px;\n  margin-bottom: 20px;\n  transition: all 0.2s;\n\n  &:focus {\n    outline: none;\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 2px rgba(24,144,255,0.1);\n  }\n\n  &::placeholder {\n    color: #8c8c8c;\n  }\n`;\n\nconst AresList = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  max-height: 400px;\n  overflow-y: auto;\n`;\n\nconst AresItem = styled.div`\n  padding: 16px;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  background: white;\n  position: relative;\n\n  &:hover {\n    border-color: #667eea;\n    background-color: #f9fafb;\n    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);\n  }\n`;\n\nconst AresItemContent = styled.div`\n  cursor: pointer;\n  margin-bottom: ${props => props.hasButtons ? '12px' : '0'};\n`;\n\nconst AresScopeBadges = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  margin-top: 8px;\n  flex-wrap: wrap;\n`;\n\nconst AresScopeBadge = styled.div`\n  display: inline-flex;\n  align-items: center;\n  gap: 4px;\n  padding: 4px 10px;\n  border-radius: 12px;\n  font-size: 11px;\n  font-weight: 600;\n  background: ${props => {\n    if (props.scope === 'global') return 'linear-gradient(135deg, #10b981 0%, #059669 100%)';\n    if (props.scope === 'usek') return 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';\n    return 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)'; // personal\n  }};\n  color: white;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\n  svg {\n    width: 12px;\n    height: 12px;\n  }\n`;\n\nconst AresItemButtons = styled.div`\n  display: flex;\n  gap: 8px;\n  margin-top: 12px;\n  padding-top: 12px;\n  border-top: 1px solid #e5e7eb;\n`;\n\nconst AresActionButton = styled.button`\n  padding: 10px 16px;\n  border: none;\n  border-radius: 6px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  white-space: nowrap;\n\n  &:disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n  }\n\n  &.primary {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);\n\n    &:hover:not(:disabled) {\n      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);\n      transform: translateY(-1px);\n    }\n\n    &:active:not(:disabled) {\n      transform: translateY(0);\n    }\n  }\n\n  &.success {\n    background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n    color: white;\n    box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);\n\n    &:hover:not(:disabled) {\n      box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);\n      transform: translateY(-1px);\n    }\n\n    &:active:not(:disabled) {\n      transform: translateY(0);\n    }\n  }\n`;\n\nconst AresLocationSelect = styled.select`\n  width: 100%;\n  padding: 10px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 6px;\n  background: white;\n  font-size: 14px;\n  color: #262626;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n\n  &:focus {\n    outline: none;\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 2px rgba(24,144,255,0.1);\n  }\n\n  &:hover {\n    border-color: #40a9ff;\n  }\n`;\n\nconst AresLoadingSpinner = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 40px 20px;\n  color: #6b7280;\n\n  @keyframes spin {\n    to { transform: rotate(360deg); }\n  }\n`;\n\n//  ARES Scope Selector Components - PESN STEJN jako v SupplierAddDialog\nconst AresScopeSelector = styled.div`\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 8px;\n  margin-top: 8px;\n  margin-bottom: 16px;\n`;\n\nconst AresScopeOption = styled.button`\n  padding: 12px;\n  border: 2px solid ${props => props.selected ? '#667eea' : '#e5e7eb'};\n  border-radius: 8px;\n  background: ${props => props.selected ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : 'white'};\n  color: ${props => props.selected ? 'white' : '#595959'};\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  opacity: ${props => props.disabled ? 0.5 : 1};\n  transition: all 0.2s;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 6px;\n  font-size: 13px;\n  font-weight: 500;\n  position: relative;\n\n  &:hover:not(:disabled) {\n    border-color: #667eea;\n    background: ${props => props.selected ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : '#f9fafb'};\n  }\n\n  svg {\n    font-size: 18px;\n  }\n`;\n\nconst AresUsekGrid = styled.div`\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));\n  gap: 8px;\n  margin-top: 12px;\n`;\n\nconst AresUsekItem = styled.label`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  padding: 8px 10px;\n  border: 2px solid ${props => props.selected ? '#667eea' : '#e5e7eb'};\n  border-radius: 6px;\n  background: ${props => props.selected ? 'rgba(102, 126, 234, 0.05)' : 'white'};\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  opacity: ${props => props.disabled ? 0.5 : 1};\n  transition: all 0.2s;\n  font-size: 13px;\n  font-weight: 600;\n  color: ${props => props.selected ? '#667eea' : '#374151'};\n\n  &:hover:not([disabled]) {\n    border-color: #667eea;\n    background: rgba(102, 126, 234, 0.05);\n  }\n\n  input[type=\"checkbox\"] {\n    width: 16px;\n    height: 16px;\n    cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  }\n`;\n\n// IO Check Notification Components\nconst IcoNotification = styled.div`\n  position: absolute;\n  top: calc(100% + 8px);\n  left: 0;\n  right: 0;\n  background: white;\n  border: 2px solid #e5e7eb;\n  border-radius: 8px;\n  padding: 16px;\n  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);\n  z-index: 100;\n\n  &[data-status=\"checking\"] {\n    border-color: #3b82f6;\n  }\n\n  &[data-status=\"found-local\"], &[data-status=\"found-ares\"] {\n    border-color: #10b981;\n  }\n\n  &[data-status=\"not-found\"] {\n    border-color: #ef4444;\n  }\n`;\n\nconst IcoNotificationTitle = styled.h4`\n  margin: 0 0 8px 0;\n  font-size: 14px;\n  font-weight: 600;\n  color: ${props =>\n    props.status === 'checking' ? '#3b82f6' :\n    props.status === 'found' ? '#10b981' :\n    props.status === 'not-found' ? '#ef4444' : '#111827'\n  };\n`;\n\nconst IcoNotificationMessage = styled.div`\n  font-size: 13px;\n  color: #6b7280;\n  margin-bottom: 12px;\n  line-height: 1.4;\n`;\n\nconst IcoNotificationActions = styled.div`\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n`;\n\nconst IcoActionButton = styled.button`\n  padding: 6px 12px;\n  border-radius: 6px;\n  font-size: 12px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n\n  &.primary {\n    background: #10b981;\n    color: white;\n    border: 1px solid #10b981;\n\n    &:hover {\n      background: #059669;\n    }\n  }\n\n  &.fill-form {\n    background: #3b82f6;\n    color: white;\n    border: 1px solid #3b82f6;\n\n    &:hover {\n      background: #2563eb;\n    }\n  }\n\n  &.secondary {\n    background: white;\n    color: #6b7280;\n    border: 1px solid #d1d5db;\n\n    &:hover {\n      background: #f9fafb;\n      color: #374151;\n    }\n  }\n`;\n\n// CSS for spinner animation\nconst GlobalStyle = `\n  @keyframes spin {\n    to { transform: rotate(360deg); }\n  }\n`;\n\n// =============== TEMPLATE PREVIEW KOMPONENTY ===============\n\nconst PreviewModal = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 999999;\n  padding: 1rem;\n`;\nconst PreviewContent = styled.div`\n  background: white;\n  border-radius: 8px;\n  padding: 2rem;\n  max-width: 700px;\n  width: 100%;\n  max-height: 85vh;\n  overflow-y: auto;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n  position: relative;\n`;\n\nconst PreviewHeader = styled.div`\n  margin-bottom: 1.5rem;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid #e5e7eb;\n`;\n\nconst PreviewTitle = styled.h3`\n  margin: 0;\n  color: #1e293b;\n  font-size: 1.25rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n`;\n\nconst PreviewCloseButton = styled.button`\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  background: transparent;\n  border: none;\n  border-radius: 4px;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: #64748b;\n  transition: all 0.2s;\n\n  &:hover {\n    background: #f1f5f9;\n    color: #1e293b;\n  }\n`;\n\nconst PreviewSection = styled.div`\n  margin-bottom: 1.5rem;\n  padding: 1.25rem;\n  background: #f8fafc;\n  border-radius: 8px;\n  border: 1px solid #e5e7eb;\n`;\n\nconst PreviewSectionTitle = styled.h4`\n  margin: 0 0 1rem 0;\n  color: #1e293b;\n  font-size: 0.875rem;\n  font-weight: 700;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n`;\n\nconst PreviewField = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  padding: 0.625rem 0;\n  border-bottom: 1px solid #e5e7eb;\n\n  &:last-child {\n    border-bottom: none;\n    padding-bottom: 0;\n  }\n`;\n\nconst PreviewFieldLabel = styled.span`\n  color: #64748b;\n  font-size: 0.875rem;\n  font-weight: 500;\n  min-width: 120px;\n  flex-shrink: 0;\n`;\n\nconst PreviewFieldValue = styled.span`\n  color: #1e293b;\n  font-size: 0.875rem;\n  font-weight: 600;\n  text-align: right;\n  flex: 1;\n  margin-left: 1rem;\n  word-break: break-word;\n`;\n\nconst PreviewItemsList = styled.div`\n  margin-top: 0.75rem;\n`;\n\nconst PreviewItem = styled.div`\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 0.75rem;\n  margin-bottom: 0.5rem;\n\n  &:last-child {\n    margin-bottom: 0;\n  }\n`;\n\nconst PreviewItemTitle = styled.div`\n  font-weight: 600;\n  color: #1e293b;\n  font-size: 0.875rem;\n  margin-bottom: 0.375rem;\n`;\n\nconst PreviewItemDetails = styled.div`\n  font-size: 0.75rem;\n  color: #64748b;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n`;\n\nconst PreviewBadge = styled.span`\n  background: ${props => {\n    if (props.type === 'po') return '#3b82f6';\n    if (props.type === 'details') return '#10b981';\n    return '#8b5cf6';\n  }};\n  color: white;\n  padding: 0.25rem 0.625rem;\n  border-radius: 4px;\n  font-size: 0.6875rem;\n  font-weight: 700;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n`;\n\nconst PreviewEmptyState = styled.div`\n  text-align: center;\n  padding: 2rem;\n  color: #9ca3af;\n  font-style: italic;\n`;\n\n// Currency Input Wrapper - pro zobrazen K fixn vpravo\nconst CurrencyInputWrapper = styled.div`\n  position: relative;\n  display: flex;\n  align-items: center;\n`;\n\nconst CurrencySymbol = styled.span`\n  position: absolute;\n  right: 12px;\n  color: ${props => props.disabled ? '#9ca3af' : '#374151'};\n  font-weight: 600;\n  font-size: 0.875rem;\n  font-family: inherit;\n  pointer-events: none;\n  user-select: none;\n  display: flex;\n  align-items: center;\n  height: 100%;\n`;\n\n// Currency Input Component - Zachovv pozici kurzoru pi psan\nfunction CurrencyInput({ fieldName, value, onChange, onBlur, disabled, hasError, placeholder }) {\n  const inputRef = useRef(null);\n  const [localValue, setLocalValue] = useState('');\n  const [isFocused, setIsFocused] = useState(false);\n\n  // Funkce pro formtovn mny (BEZ K, protoe to je fixn vpravo)\n  const formatCurrency = (val) => {\n    if (!val && val !== 0) return '';\n    const num = parseFloat(val.toString().replace(/[^0-9.-]/g, ''));\n    if (isNaN(num)) return '';\n    // Pro faktury/etnictv pesn 2 desetinn msta\n    return num.toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ' ').replace('.', ',');\n  };\n\n  // Inicializace lokln hodnoty z props (pouze kdy nen focused)\n  useEffect(() => {\n    if (!isFocused) {\n      const formattedValue = formatCurrency(value || '');\n      if (localValue !== formattedValue) {\n        setLocalValue(formattedValue);\n      }\n    }\n  }, [value, isFocused]);\n\n  const handleChange = (e) => {\n    const newValue = e.target.value;\n\n    // Aktualizovat lokln hodnotu okamit (bez formtovn)\n    setLocalValue(newValue);\n\n    //  FIX: Ped odeslnm do onChange oistit hodnotu od formtovn\n    // Parsovat a vrtit jako string s tekou (ne rkou) pro konzistentn ukldn\n    const cleanValue = newValue.replace(/[^\\d,.-]/g, '').replace(',', '.');\n    const numValue = parseFloat(cleanValue);\n    const finalValue = isNaN(numValue) ? '' : numValue.toFixed(2);\n\n    //  VOLAT onChange pi kadm znaku pro pepoet DPH s oitnou hodnotou\n    onChange(fieldName, finalValue);\n  };\n\n  const handleFocus = () => {\n    setIsFocused(true);\n  };\n\n  const handleBlurLocal = () => {\n    setIsFocused(false);\n\n    // Formtovat hodnotu pi ztrt fokusu (BEZ K)\n    const formatted = formatCurrency(localValue);\n    setLocalValue(formatted);\n\n    //  FIX: Ped odeslnm do onBlur oistit hodnotu od formtovn\n    const cleanValue = localValue.replace(/[^\\d,.-]/g, '').replace(',', '.');\n    const numValue = parseFloat(cleanValue);\n    const finalValue = isNaN(numValue) ? '' : numValue.toFixed(2);\n\n    //  onChange u se vol pi kadm znaku, pi blur jen formatujeme\n    // Ale stle musme zavolat parent onBlur pro validaci\n    if (onBlur) {\n      onBlur(fieldName, finalValue);\n    }\n  };\n\n  return (\n    <CurrencyInputWrapper>\n      <InputWithIcon hasIcon>\n        <Calculator />\n        <Input\n          ref={inputRef}\n          type=\"text\"\n          name={fieldName}\n          placeholder={placeholder}\n          value={localValue}\n          onChange={handleChange}\n          onFocus={handleFocus}\n          onBlur={handleBlurLocal}\n          disabled={disabled}\n          style={{ textAlign: 'right', paddingRight: '40px' }}\n          hasError={hasError}\n          hasIcon\n        />\n      </InputWithIcon>\n      <CurrencySymbol disabled={disabled}>K</CurrencySymbol>\n    </CurrencyInputWrapper>\n  );\n}\n\n// DatePicker Component - prevzato z src/components/DatePicker.js\nfunction DatePicker({ fieldName, value, onChange, onBlur, disabled, hasError, placeholder = 'Vyberte datum' }) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [currentMonth, setCurrentMonth] = useState(new Date());\n  const [openUpwards, setOpenUpwards] = useState(false); //  Detekce smru oteven\n  const wrapperRef = useRef(null);\n  const calendarRef = useRef(null);\n\n  // Parse value to Date\n  const selectedDate = value ? new Date(value) : null;\n\n  // Update currentMonth when value changes to show correct month\n  useEffect(() => {\n    if (value) {\n      const date = new Date(value);\n      if (!isNaN(date.getTime())) {\n        setCurrentMonth(date);\n      }\n    }\n  }, [value]);\n\n  // Close calendar when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {\n        setIsOpen(false);\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n    }\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, [isOpen]);\n\n  //  Detekce smru oteven kalende (nahoru/dol) podle dostupnho msta\n  useEffect(() => {\n    if (isOpen && wrapperRef.current) {\n      const checkPosition = () => {\n        if (!wrapperRef.current) return;\n\n        const buttonRect = wrapperRef.current.getBoundingClientRect();\n        const calendarHeight = 380; // Piblin vka kalende\n        const footerHeight = 54; // Vka fixn patiky\n        const buffer = 20; // Extra buffer pro bezpenost\n\n        const spaceBelow = window.innerHeight - buttonRect.bottom - footerHeight - buffer;\n        const spaceAbove = buttonRect.top - buffer;\n\n        // Otevi nahoru pokud: nen dost msta dole NEBO je nahoe vrazn vce msta\n        const shouldOpenUpward = spaceBelow < 300 || (spaceBelow < calendarHeight && spaceAbove > spaceBelow + 50);\n\n        setOpenUpwards(shouldOpenUpward);\n      };\n\n      checkPosition();\n\n      // Pidej scroll listener pro re-pozicovn\n      const scrollContainer = document.querySelector('[class*=\"ScrollableContent\"]');\n      if (scrollContainer) {\n        scrollContainer.addEventListener('scroll', checkPosition);\n        return () => scrollContainer.removeEventListener('scroll', checkPosition);\n      }\n    }\n  }, [isOpen]);\n\n  // Format date for display\n  const formatDisplayDate = (date) => {\n    if (!date) return '';\n    try {\n      const d = new Date(date);\n      if (isNaN(d.getTime())) return ''; // Invalid date check\n      return d.toLocaleDateString('cs-CZ', { day: '2-digit', month: '2-digit', year: 'numeric' });\n    } catch (err) {\n      return '';\n    }\n  };\n\n  // Format date for input (YYYY-MM-DD)\n  const formatInputDate = (date) => {\n    const d = new Date(date);\n    const year = d.getFullYear();\n    const month = String(d.getMonth() + 1).padStart(2, '0');\n    const day = String(d.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n  };\n\n  // Get calendar days for current month\n  const getCalendarDays = () => {\n    const year = currentMonth.getFullYear();\n    const month = currentMonth.getMonth();\n\n    const firstDay = new Date(year, month, 1);\n    const lastDay = new Date(year, month + 1, 0);\n\n    const startDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1; // Monday = 0\n    const days = [];\n\n    // Previous month days\n    for (let i = startDay - 1; i >= 0; i--) {\n      const date = new Date(year, month, -i);\n      days.push({ date, isOtherMonth: true });\n    }\n\n    // Current month days\n    for (let i = 1; i <= lastDay.getDate(); i++) {\n      const date = new Date(year, month, i);\n      days.push({ date, isOtherMonth: false });\n    }\n\n    // Next month days\n    const remainingDays = 42 - days.length; // 6 rows * 7 days\n    for (let i = 1; i <= remainingDays; i++) {\n      const date = new Date(year, month + 1, i);\n      days.push({ date, isOtherMonth: true });\n    }\n\n    return days;\n  };\n\n  const handleDateSelect = (date) => {\n    const formattedDate = formatInputDate(date);\n    // Volat onChange s hodnotou - fieldName je u v props\n    onChange(formattedDate);\n    if (onBlur) {\n      onBlur(formattedDate);\n    }\n    setIsOpen(false);\n  };\n\n  const handleToday = (e) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    handleDateSelect(new Date());\n  };\n\n  const handleClear = (e) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    onChange('');\n    if (onBlur) {\n      onBlur('');\n    }\n    setIsOpen(false);\n  };\n\n  const prevMonth = (e) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1));\n  };\n\n  const nextMonth = (e) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1));\n  };\n\n  const today = new Date();\n  const calendarDays = getCalendarDays();\n\n  const displayText = value ? formatDisplayDate(value) : placeholder;\n\n  return (\n    <DatePickerWrapper ref={wrapperRef} data-field={fieldName}>\n      <InputWithIcon hasIcon>\n        <Calendar />\n        <DateInputButton\n          type=\"button\"\n          onClick={() => !disabled && setIsOpen(!isOpen)}\n          disabled={disabled}\n          hasError={hasError}\n          hasValue={!!value}\n          data-datepicker={fieldName}\n        >\n          {displayText}\n        </DateInputButton>\n\n        {/* Kek pro smazn */}\n        {value && !disabled && (\n          <DateClearButton\n            type=\"button\"\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              handleClear(e);\n            }}\n            title=\"Smazat datum\"\n          >\n            \n          </DateClearButton>\n        )}\n\n        {/* Tlatko pro dnen datum */}\n        {!disabled && (\n          <DateTodayButton\n            type=\"button\"\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              handleToday(e);\n            }}\n            title=\"Nastavit dnen datum\"\n          >\n            \n          </DateTodayButton>\n        )}\n      </InputWithIcon>\n\n      {isOpen && !disabled && (\n        <DateCalendarPopup ref={calendarRef} openUpwards={openUpwards}>\n          <CalendarHeader>\n            <CalendarNav onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              prevMonth(e);\n            }}></CalendarNav>\n            <CalendarTitle>\n              <span>{currentMonth.toLocaleDateString('cs-CZ', { month: 'long' })}</span>\n              <span>{currentMonth.getFullYear()}</span>\n            </CalendarTitle>\n            <CalendarNav onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              nextMonth(e);\n            }}></CalendarNav>\n          </CalendarHeader>\n\n          <CalendarGrid>\n            <CalendarDay>Po</CalendarDay>\n            <CalendarDay>t</CalendarDay>\n            <CalendarDay>St</CalendarDay>\n            <CalendarDay>t</CalendarDay>\n            <CalendarDay>P</CalendarDay>\n            <CalendarDay>So</CalendarDay>\n            <CalendarDay>Ne</CalendarDay>\n\n            {calendarDays.map((day, index) => {\n              const isToday = day.date.toDateString() === today.toDateString();\n              const isSelected = selectedDate && day.date.toDateString() === selectedDate.toDateString();\n\n              return (\n                <CalendarDate\n                  key={index}\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleDateSelect(day.date);\n                  }}\n                  isToday={isToday}\n                  isSelected={isSelected}\n                  isOtherMonth={day.isOtherMonth}\n                >\n                  {day.date.getDate()}\n                </CalendarDate>\n              );\n            })}\n          </CalendarGrid>\n\n          <CalendarFooter>\n            <CalendarButton\n              className=\"today\"\n              onClick={(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                handleDateSelect(new Date());\n              }}\n            >\n              Dnes\n            </CalendarButton>\n            <CalendarButton\n              className=\"clear\"\n              onClick={(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                onChange('');\n                if (onBlur) {\n                  onBlur('');\n                }\n                setIsOpen(false);\n              }}\n            >\n              Smazat\n            </CalendarButton>\n          </CalendarFooter>\n        </DateCalendarPopup>\n      )}\n    </DatePickerWrapper>\n  );\n}\n\n// DatePicker styled components\nconst DatePickerWrapper = styled.div`\n  position: relative;\n  width: 100%;\n`;\n\nconst DateInputButton = styled.button`\n  width: 100%;\n  display: block;\n  padding: 0.75rem;\n  padding-left: 2.75rem;\n  padding-right: ${props => props.disabled ? '0.75rem' : props.hasValue ? '4.5rem' : '3rem'};\n  border: 2px solid ${props => props.hasError ? '#ef4444' : '#e5e7eb'};\n  border-radius: 8px;\n  background: ${props => props.disabled ? '#f9fafb' : 'white'};\n  color: ${props => props.disabled ? '#6b7280' : props.hasValue ? '#1f2937' : '#9ca3af'};\n  font-size: 0.875rem;\n  font-weight: ${props => props.hasValue && !props.disabled ? '600' : '400'};\n  line-height: 1.5;\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  transition: all 0.2s ease;\n  text-align: left;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  min-height: 42px;\n  box-sizing: border-box;\n\n  &:hover:not(:disabled) {\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n`;\n\nconst DateClearButton = styled.button`\n  position: absolute;\n  right: 36px;\n  top: 50%;\n  transform: translateY(-50%);\n  background: #ef4444;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: bold;\n  transition: all 0.2s ease;\n  z-index: 1;\n\n  &:hover {\n    background: #dc2626;\n    transform: translateY(-50%) scale(1.1);\n  }\n`;\n\nconst DateTodayButton = styled.button`\n  position: absolute;\n  right: 8px;\n  top: 50%;\n  transform: translateY(-50%);\n  background: transparent;\n  color: #3b82f6;\n  border: none;\n  border-radius: 4px;\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  font-size: 13px;\n  font-weight: bold;\n  transition: all 0.2s ease;\n  z-index: 1;\n\n  &:hover {\n    background: transparent;\n    color: #2563eb;\n    transform: translateY(-50%) scale(1.15);\n  }\n`;\n\nconst DateCalendarPopup = styled.div`\n  position: absolute;\n  ${props => props.openUpwards ? `\n    bottom: calc(100% + 4px);\n    top: auto;\n  ` : `\n    top: calc(100% + 4px);\n    bottom: auto;\n  `}\n  left: 0;\n  right: 0;\n  z-index: 10001;\n  background: white;\n  border: 2px solid #3b82f6;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n  padding: 0.5rem;\n`;\n\nconst CalendarHeader = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n  padding-bottom: 0.35rem;\n  border-bottom: 1px solid #e5e7eb;\n`;\n\nconst CalendarNav = styled.button`\n  background: #f3f4f6;\n  border: none;\n  border-radius: 4px;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: #374151;\n  font-weight: 600;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n\n  &:hover {\n    background: #3b82f6;\n    color: white;\n    transform: scale(1.1);\n  }\n`;\n\nconst CalendarTitle = styled.div`\n  font-weight: 600;\n  font-size: 0.85rem;\n  color: #111827;\n  display: flex;\n  gap: 0.35rem;\n`;\n\nconst CalendarGrid = styled.div`\n  display: grid;\n  grid-template-columns: repeat(7, 1fr);\n  gap: 1px;\n`;\n\nconst CalendarDay = styled.div`\n  aspect-ratio: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 0.65rem;\n  font-weight: 600;\n  color: #6b7280;\n  padding: 0.15rem;\n`;\n\nconst CalendarDate = styled.button`\n  aspect-ratio: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 0.75rem;\n  border: none;\n  border-radius: 4px;\n  background: ${props => props.isToday ? '#dbeafe' : props.isSelected ? '#3b82f6' : 'transparent'};\n  color: ${props => props.isSelected ? 'white' : props.isOtherMonth ? '#9ca3af' : '#374151'};\n  font-weight: ${props => props.isToday || props.isSelected ? '600' : '400'};\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &:hover {\n    background: ${props => props.isSelected ? '#2563eb' : '#f3f4f6'};\n    transform: scale(1.1);\n    color: ${props => props.isSelected ? 'white' : '#111827'};\n  }\n`;\n\nconst CalendarFooter = styled.div`\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 0.5rem;\n  padding-top: 0.5rem;\n  border-top: 2px solid #e5e7eb;\n`;\n\nconst CalendarButton = styled.button`\n  flex: 1;\n  padding: 0.5rem;\n  border: none;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &.today {\n    background: #dbeafe;\n    color: #1e40af;\n\n    &:hover {\n      background: #bfdbfe;\n    }\n  }\n\n  &.clear {\n    background: #fee2e2;\n    color: #991b1b;\n\n    &:hover {\n      background: #fecaca;\n    }\n  }\n`;\n\n// ========================================\n//  FAKTURY PLOHY - nyn eeno samostatnou komponentou InvoiceAttachmentsCompact\n// Star styled components (FakturaAttachmentsWrapper, DropZone, AttachmentsList, atd.) odstranny\n// ========================================\n\n// ========================================\n//  TOOLTIP PRO INFO FAKTURY\n// ========================================\n\nconst FakturaInfoIconWrapper = styled.div`\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 6px;\n  cursor: help;\n\n  &:hover .tooltip-bubble {\n    opacity: 1;\n    visibility: visible;\n    transform: translateY(0);\n  }\n\n  &:hover .help-icon {\n    color: #3b82f6;\n  }\n`;\n\nconst FakturaInfoIcon = styled.span`\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  width: 16px;\n  height: 16px;\n  color: #6b7280;\n  transition: color 0.2s ease;\n\n  svg {\n    width: 16px;\n    height: 16px;\n  }\n`;\n\nconst FakturaTooltipBubble = styled.div`\n  position: absolute;\n  bottom: calc(100% + 8px);\n  left: 50%;\n  transform: translateX(-50%) translateY(-4px);\n  width: 320px;\n  padding: 12px;\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);\n  opacity: 0;\n  visibility: hidden;\n  transition: all 0.2s ease;\n  z-index: 1000;\n  pointer-events: none;\n\n  /* ipka dol */\n  &::after {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    width: 0;\n    height: 0;\n    border-left: 6px solid transparent;\n    border-right: 6px solid transparent;\n    border-top: 6px solid #ffffff;\n  }\n\n  &::before {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    width: 0;\n    height: 0;\n    border-left: 7px solid transparent;\n    border-right: 7px solid transparent;\n    border-top: 7px solid #e5e7eb;\n    margin-top: 1px;\n    z-index: -1;\n  }\n`;\n\nconst FakturaTooltipRow = styled.div`\n  display: flex;\n  justify-content: space-between;\n  padding: 6px 0;\n  font-size: 0.75rem;\n  border-bottom: 1px solid #f3f4f6;\n\n  &:last-child {\n    border-bottom: none;\n  }\n`;\n\nconst FakturaTooltipLabel = styled.span`\n  color: #6b7280;\n  font-weight: 500;\n`;\n\nconst FakturaTooltipValue = styled.span`\n  color: #1f2937;\n  font-weight: 600;\n  text-align: right;\n  max-width: 180px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n`;\n\n/**\n *  VALIDACE STEDISEK: Fallback pro neaktivn stediska\n *\n * Zkontroluje, zda jsou vechna stediska aktivn.\n * Pokud ne, nahrad neaktivn stediska za \"100\" (Sprva Kladno).\n *\n * @param {string[]} strediskaCodes - Array kd stedisek\n * @param {Array} strediskaOptions - Dostupn aktivn stediska\n * @returns {string[]} - Validovan array stedisek\n */\nconst validateAndFixStrediska = (strediskaCodes, strediskaOptions) => {\n  if (!Array.isArray(strediskaCodes) || strediskaCodes.length === 0) {\n    return strediskaCodes;\n  }\n\n  const FALLBACK_STREDISKO = \"100\"; // 100 Sprva Kladno\n\n  return strediskaCodes.map(kod => {\n    // Zkontroluj, zda stedisko existuje v aktivnch\n    const exists = strediskaOptions.find(opt =>\n      (opt.value && opt.value === kod) ||\n      (opt.kod && opt.kod === kod) ||\n      (opt.kod_stavu && opt.kod_stavu === kod)\n    );\n\n    if (!exists) {\n      return FALLBACK_STREDISKO;\n    }\n\n    return kod;\n  });\n};\n\n/**\n *  CENTRLN TRANSFORMACE: Backend  Frontend\n *\n * Transformuje data z backendu do formtu pro frontend form\n * Specifikace: DATA-FORMAT-CONTRACT.md\n *\n * @see src/utils/dataTransformHelpers.js\n * @param {object} backendData - Raw data z V2 API\n * @returns {object} - Transformovan data pro formData\n *\n * Pouit:\n * - Po INSERT/UPDATE objednvky (saveOrderToAPI)\n * - Po naten objednvky (loadOrderData)\n * - Po jakkoli komunikaci s backendem\n */\nconst transformBackendDataToFrontend = (backendData) => {\n  if (!backendData) return {};\n\n  const transformed = { ...backendData };\n\n  // 1. POLOKY: Backend vrac 'polozky', FE pouv 'polozky_objednavky'\n  if (backendData.polozky && !backendData.polozky_objednavky) {\n    //  FIX: Normalizovat ceny z DB - zajistit e jsou ve formtu \"12345.67\" (string s tekou, 2 des. msta)\n    transformed.polozky_objednavky = Array.isArray(backendData.polozky) \n      ? backendData.polozky.map(item => ({\n          ...item,\n          cena_bez_dph: typeof item.cena_bez_dph === 'number' \n            ? item.cena_bez_dph.toFixed(2) \n            : (parseFloat((item.cena_bez_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0).toFixed(2),\n          cena_s_dph: typeof item.cena_s_dph === 'number' \n            ? item.cena_s_dph.toFixed(2) \n            : (parseFloat((item.cena_s_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0).toFixed(2),\n          sazba_dph: parseInt(item.sazba_dph) || 21\n        }))\n      : [];\n    delete transformed.polozky; // Vyistit BE pole\n  }\n\n  // 2.  STEDISKA: Normalizovat do array string\n  if (backendData.strediska_kod) {\n    transformed.strediska_kod = normalizeStrediskaFromBackend(backendData.strediska_kod);\n  }\n\n  // 3.  FINANCOVN: Normalizovat do flat struktury (POUZE LP a SMLOUVA pole)\n  \n  if (backendData.financovani) {\n    \n    const financing = normalizeFinancovaniFromBackend(backendData.financovani);\n    \n    \n    Object.assign(transformed, financing);\n  } else {\n  }\n\n  // 3.5.  VECHNA POLE (LP, SMLOUVA, INDIVIDULN, POJISTN UDLOST) se nataj z financovani objektu\n  // normalizeFinancovaniFromBackend() u to udlal v kroku 3\n\n  // 4. SLOVN: cislo_objednavky  ev_cislo\n  if (backendData.cislo_objednavky && !backendData.ev_cislo) {\n    transformed.ev_cislo = backendData.cislo_objednavky;\n  }\n\n  // 5.  WORKFLOW: Parsovat stav_workflow_kod z JSON stringu na array\n  // Backend vrac: '[\"NOVA\",\"SCHVALENA\"]'  FE oekv: [\"NOVA\",\"SCHVALENA\"]\n  if (backendData.stav_workflow_kod) {\n    if (typeof backendData.stav_workflow_kod === 'string' && backendData.stav_workflow_kod.trim().startsWith('[')) {\n      try {\n        const parsed = JSON.parse(backendData.stav_workflow_kod);\n        if (Array.isArray(parsed)) {\n          transformed.stav_workflow_kod = parsed;\n        }\n      } catch (e) {\n        // Zachovat pvodn hodnotu\n      }\n    }\n    // Pokud u je array nebo nen JSON string, zachovat pvodn hodnotu\n  }\n\n  // 5.5.  DOKONEN: Zajistit sprvn parsovn potvrzeni_dokonceni_objednavky\n  // Backend vrac slo (0/1), FE oekv integer\n  if (backendData.potvrzeni_dokonceni_objednavky !== undefined) {\n    transformed.potvrzeni_dokonceni_objednavky = parseInt(backendData.potvrzeni_dokonceni_objednavky, 10) || 0;\n  }\n\n  // 5.6.  STAV ODESLN: Parsovat boolean/integer fieldy pro odesln a storno\n  // Backend me vracet 0/1 nebo true/false\n  if (backendData.stav_odeslano !== undefined) {\n    transformed.stav_odeslano = Boolean(backendData.stav_odeslano);\n  }\n  if (backendData.stav_stornovano !== undefined) {\n    transformed.stav_stornovano = Boolean(backendData.stav_stornovano);\n  }\n\n  //   INDIVIDULN SCHVLEN a POJISTN UDLOST: Nataj se z root objektu (krok 3.5)\n  //     stejn jako cislo_smlouvy - NEJSOU vnoen ve financovani objektu\n\n  // 5.8.  DATUMY A TEXTOV FIELDY: Koprovat pmo bez transformace\n  const directCopyFields = [\n    'datum_storna',\n    'odeslani_storno_duvod',\n    'identifikator',\n    'dt_odeslani',\n    'storno_uzivatel_id',\n    'storno_provedl'\n  ];\n\n  directCopyFields.forEach(field => {\n    if (backendData[field] !== undefined) {\n      transformed[field] = backendData[field];\n    }\n  });\n\n  // 6. POZNMKA: Backend vrac 'poznamka', FE pouv 'poznamka_objednavky'\n  if (backendData.poznamka) {\n    // Pokud je poznmka JSON string (chyba z Notes panelu), zkus parsovat text\n    let poznamkaText = backendData.poznamka;\n\n    // Opakovan parsuj, dokud je to JSON (e vcensobn zanoovn)\n    let maxIterations = 5; // Ochrana proti nekonen smyce\n    while (typeof poznamkaText === 'string' && poznamkaText.trim().startsWith('{') && maxIterations > 0) {\n      try {\n        const parsed = JSON.parse(poznamkaText);\n\n        // Pokud m strukturu {text, datum, typ} z Notes panelu, extrahuj text\n        if (parsed.text !== undefined) {\n          poznamkaText = parsed.text;\n        } else {\n          // Jin JSON struktura - zachovej pvodn\n          break;\n        }\n      } catch (e) {\n        // Nen validn JSON - konec parsovn\n        break;\n      }\n      maxIterations--;\n    }\n\n    transformed.poznamka_objednavky = poznamkaText;\n    delete transformed.poznamka; // Vyistit BE pole\n  }\n\n  // 7.  POTVRZEN DODAVATELEM: Parsovat JSON string z DB\n  // Backend vrac: '{\"potvrzeni\":\"ANO\",\"zpusoby\":[\"podepsana_objednavka\"],\"platba\":\"faktura\"}'\n  // FE oekv: {potvrzeni: 'ANO', zpusoby: ['podepsana_objednavka'], platba: 'faktura'}\n  if (backendData.dodavatel_zpusob_potvrzeni && typeof backendData.dodavatel_zpusob_potvrzeni === 'string') {\n    try {\n      const parsed = JSON.parse(backendData.dodavatel_zpusob_potvrzeni);\n      transformed.dodavatel_zpusob_potvrzeni = parsed;\n    } catch (e) {\n      // Zachovat pvodn hodnotu pi chyb\n    }\n  }\n\n  return transformed;\n};\n\n// OrderForm25 - Modern form for 2025 orders following workflow phases\nfunction OrderForm25() {\n  const navigate = useNavigate();\n  const { showToast } = useContext(ToastContext) || {};\n  const { userDetail, user_id, username, token, user, userPermissions, hasPermission } = useContext(AuthContext) || {};\n  const { triggerActivity } = useActivity();\n  const { progress, start: startGlobalProgress, setProgress: setGlobalProgress, done: doneGlobalProgress, fail: failGlobalProgress, reset: resetGlobalProgress } = useContext(ProgressContext) || {};\n\n  //  REF: onDataLoaded protection flag - pout ref msto window\n  const onDataLoadedCalledRef = useRef(false);\n\n  //  OPRAVENO: Pouit useLocation() pro reaktivn URL parametry\n  const location = useLocation();\n  const urlParams = useMemo(() => new URLSearchParams(location.search), [location.search]);\n  \n  //  PERSISTENCE: ti editOrderId z URL nebo z draftManager\n  const editOrderIdFromUrl = urlParams.get('edit');\n  const metadata = draftManager.getMetadata();\n  const editOrderIdFromLS = metadata?.editOrderId;\n  const editOrderId = editOrderIdFromUrl || editOrderIdFromLS;\n  \n  //  OKAMIT BROADCAST MenuBaru pi mount - podle dostupnch dat\n  useEffect(() => {\n    //  PRIORITA: Zkontrolovat draft NEJDV (me mt vce informac ne URL)\n    const checkInitialState = async () => {\n      let menuBarState = 'NOVA'; // Default\n      let orderId = null;\n      let orderNumber = '';\n      \n      try {\n        if (user_id) {\n          draftManager.setCurrentUser(user_id);\n          \n          // Nast draft metadata\n          const metadata = draftManager.getMetadata();\n          const hasDraftData = await draftManager.hasDraft();\n          \n          if (hasDraftData) {\n            const draftData = await draftManager.loadDraft();\n            \n            if (draftData && draftData.formData) {\n              // Draft existuje - urit stav podle savedOrderId\n              if (draftData.savedOrderId && draftData.formData.id) {\n                // M savedOrderId  EDITACE skuten objednvky\n                menuBarState = 'EDITACE';\n                orderId = draftData.savedOrderId;\n                orderNumber = draftData.formData.cislo_objednavky || draftData.formData.ev_cislo || '';\n              } else {\n                // Nem savedOrderId  KONCEPT (autosave po prvn zmn)\n                menuBarState = 'KONCEPT';\n                orderId = null;\n                orderNumber = '';\n              }\n            }\n          } else if (editOrderId) {\n            // Nem draft, ale m editOrderId z URL  natn EDITACE\n            menuBarState = 'EDITACE';\n            orderId = parseInt(editOrderId);\n            orderNumber = ''; // Bude doplnno po naten\n            \n            // Ulo editOrderId do draftManager\n            draftManager.saveMetadata({ editOrderId: editOrderId });\n          }\n        } else if (editOrderId) {\n          // Anonymn uivatel s editOrderId\n          menuBarState = 'EDITACE';\n          orderId = parseInt(editOrderId);\n          orderNumber = '';\n        }\n      } catch (error) {\n        // Chyba pi kontrole draftu - fallback na URL parametr\n        if (editOrderId) {\n          menuBarState = 'EDITACE';\n          orderId = parseInt(editOrderId);\n          orderNumber = '';\n        }\n      }\n      \n      //  POSLAT BROADCAST s urenm stavem\n      const state = {\n        isEditMode: menuBarState === 'EDITACE',\n        isNewOrder: menuBarState === 'NOVA',\n        orderId: orderId,\n        orderNumber: orderNumber,\n        currentPhase: 1,\n        mainWorkflowState: 'NOVA',\n        hasDraft: menuBarState !== 'NOVA',\n        timestamp: Date.now()\n      };\n      \n      window.__orderFormState = state;\n      window.dispatchEvent(new CustomEvent('orderFormStateChange', { detail: state }));\n    };\n    \n    checkInitialState();\n  }, [editOrderId, user_id]); // Spust se pi mount a zmn editOrderId\n  \n  const archivovanoParam = urlParams.get('archivovano'); // Parametr pro naten archivovanch objednvek\n\n  //  NOV REFACTORED STATE MANAGEMENT\n\n  //  NOV REFACTORED STATE MANAGEMENT\n  // Callbacks pro useFormController budou definovny a po state variables\n\n  //  POZOR: Star useState hooks ne budou postupn nahrazeny formController state\n  // Pro nyn je ponechvme pro zachovn funknosti bhem refactoringu\n\n  const [sectionStates, setSectionStates] = useState({\n    objednatel: false,\n    schvaleni: false,\n    prilohy: false,  // FZE 2: Plohy\n\n    // Rozen sekce - viditeln jen po schvlen\n    financovani: false,\n    dodavatel: false,\n    kontakt: false,\n    detaily: false,\n    dodaci_podminky: false,\n    stav_odeslani: false,\n\n    // Nov sekce po stavu objednvky\n    potvrzeni_objednavky: false,\n    registr_smluv: false,  // FZE 4: Checkbox \"M bt zveejnna\"\n    registr_smluv_vyplneni: false,  // FZE 5: Vyplnn datum + IDDT\n\n    // FZE 3: Sekce po odesln objednvky\n    prubeh_objednavky: false,\n    dodaci_informace: false,\n    fakturace: false,\n    // vecna_spravnost: false,  //  ODSTRANNO - refaktorovno na per-invoice\n    dokonceni: false,  // FZE 8: Dokonen objednvky\n    storno_detail: false,\n  });\n\n  // State pro vlastn select komponenty\n  const [selectStates, setSelectStates] = useState({\n    garant: false,\n    prikazce: false,\n    strediska: false,\n    financovani: false,\n    lp_kod: false,\n  });\n\n  // Search states pro selecty\n  const [searchStates, setSearchStates] = useState({\n    garant: '',\n    prikazce: '',\n    strediska: '',\n    financovani: '',\n    lp_kod: '',\n  });\n\n  // Tracking kter Custom Select fields byly \"touched\" (uivatel s nimi interagoval)\n  const [touchedSelectFields, setTouchedSelectFields] = useState(new Set());\n\n  //  Loading state pro ev. slo (EEN PROBLMU #1)\n  const [isLoadingEvCislo, setIsLoadingEvCislo] = useState(false);\n\n  // Fullscreen reim\n  const [isFullscreen, setIsFullscreen] = useState(false);\n\n  //  SPRINT 4: Consolidated LP Details State (21 hook)\n  const [lpDetailsState, setLpDetailsState] = useState({\n    details: {}, // { lp_id: { zbyva_skutecne, celkovy_limit, ... } }\n    loading: {} // { lp_id: true/false }\n  });\n  \n  //  SPRINT 4: Consolidated Smlouvy (Contracts) State (61 hook)\n  const [smlouvyState, setSmlouvyState] = useState({\n    list: [], // Seznam vech smluv pro autocomplete\n    loadingList: false,\n    detail: null, // Detail vybran smlouvy\n    loadingDetail: false,\n    searchTerm: '', // Vyhledvac term pro smlouvy\n    showSuggestions: false,\n    selectedSuggestionIndex: -1 // Index vybran poloky v dropdownu\n  });\n\n  // useEffect pro ESC klvesy v fullscreen reimu\n  useEffect(() => {\n    if (!isFullscreen) return;\n\n    const handleEscKey = (event) => {\n      if (event.key === 'Escape') {\n        setIsFullscreen(false);\n      }\n    };\n\n    window.addEventListener('keydown', handleEscKey);\n    return () => window.removeEventListener('keydown', handleEscKey);\n  }, [isFullscreen]);\n\n  //  REFACTORED: selnky budou definovny a po formController\n\n  // Stavy pro plohy\n  const [attachments, setAttachments] = useState([]); // Lokln seznam ploh\n  \n  //  SPRINT 4: Consolidated Attachment UI State (61 hook)\n  const [attachmentUI, setAttachmentUI] = useState({\n    uploading: false,\n    dragOver: false,\n    checkingSync: false,\n    showDeleteDialog: false,\n    deleteTarget: null,\n    showDeleteAllDialog: false\n  });\n\n  //  SPRINT 4: Consolidated Supplier Search State (51 hook)\n  const [supplierSearch, setSupplierSearch] = useState({\n    showDialog: false,\n    searchTerm: '',\n    results: [],\n    loading: false,\n    allContacts: [] // Vechny kontakty naten jednou\n  });\n  \n  //  SPRINT 4: Consolidated ARES State (81 hook)\n  const [aresState, setAresState] = useState({\n    popupOpen: false,\n    search: '',\n    results: [],\n    loading: false,\n    savingToLocal: null, // ID zznamu kter se ukld\n    scopeInfo: {}, // { ico: { existsInPersonal, existsInUsek, existsInGlobal } }\n    selectedScope: 'personal', // Vybran scope pro ARES dialog\n    selectedUseky: [] // Vybran seky pro ARES scope 'usek'\n  });\n\n  //  SPRINT 4: Consolidated Useky State (21 hook)\n  const [usekyState, setUsekyState] = useState({\n    available: [],\n    loading: false\n  });\n\n  //  SPRINT 4: Consolidated ICO Check State (41 hook)\n  const [icoCheckState, setIcoCheckState] = useState({\n    show: false,\n    status: null, // null, 'checking', 'found-local', 'found-ares', 'not-found'\n    data: null,\n    isOperation: false\n  });\n\n  //  SPRINT 4: Consolidated Save Progress State (31 hook)\n  const [saveProgressState, setSaveProgressState] = useState({\n    show: false,\n    progress: 0,\n    text: ''\n  });\n\n  //  State pro odemykn FZE 3 SEKC (Dodavatel  Stav odesln)\n  //  POZNMKA: Financovn je soust FZE 1-2, ne FZE 3!\n  const [isPhase3SectionsLocked, setIsPhase3SectionsLocked] = useState(false);\n  const [isPhase3SectionsUnlocked, setIsPhase3SectionsUnlocked] = useState(false); // Vchoz stav - zameno\n  const [isPhase3SectionsLockProcessedFromDB, setIsPhase3SectionsLockProcessedFromDB] = useState(false); // Flag e zamen bylo zpracovno pi naten z DB\n\n  // State pro sledovn stavu sbalen/rozbalen sekc\n  const [areSectionsCollapsed, setAreSectionsCollapsed] = useState(false);\n\n  //  SPRINT 4: Consolidated Supplier Dialog State (31 hook)\n  const [supplierDialog, setSupplierDialog] = useState({\n    showAddDialog: false,\n    existingCheck: null, // Vsledek detekce dodavatele v DB\n    autoFillSource: null // Zdroj automatickho vyplnn dodavatele (local/ares/smlouva)\n  });\n\n  //  SPRINT 4: Consolidated DOCX Modal State (21 hook)\n  const [docxModal, setDocxModal] = useState({\n    open: false,\n    orderData: null\n  });\n\n  //  SPRINT 4: Consolidated Loading State (51 hook)\n  const [loadingState, setLoadingState] = useState({\n    ciselniky: true, // Natn selnk (selecty, dropdown options)\n    formData: false, // Natn dat formule (editace objednvky)\n    initializing: true, // Celkov loading stav pro inicializaci\n    initialized: false, //  Flag pro dokonenou inicializaci\n    error: null // Chyba pi inicializaci\n  });\n\n  //  isEditMode - persistuje v localStorage pro sprvn MenuBar zobrazen\n  // NIKDY se nesm ztratit po F5 refresh!\n  const [isEditMode, setIsEditMode] = useState(() => {\n    try {\n      //  Nast z DraftManager\n      const metadata = draftManager.getMetadata();\n\n      if (metadata && metadata.isEditMode === true) {\n        //  PIDAT: Nast i formData.id pi inicializaci\n        if (metadata.editOrderId || metadata.formData.id) {\n          const orderId = metadata.editOrderId || metadata.formData.id;\n          // Poznmka: setSavedOrderId nelze volat zde (useState init),\n          // take to udlme v useEffect ne\n        }\n\n        return true;\n      }\n      return false;\n    } catch {\n      return false;\n    }\n  });\n\n  //  Nast seky z API pro ARES scope selector\n  useEffect(() => {\n    const loadUseky = async () => {\n      if (!token || !username) return;\n\n      setUsekyLoading(true);\n      try {\n        const usekyData = await fetchUskyList({ token, username });\n        setAvailableUseky(usekyData || []);\n      } catch (error) {\n        setAvailableUseky([]);\n      } finally {\n        setUsekyLoading(false);\n      }\n    };\n\n    loadUseky();\n  }, [token, username]);\n\n  //  Nast formData.id z metadata pi mount (nelze v useState init)\n  useEffect(() => {\n    if (!user_id) return;\n\n    try {\n      const metadata = draftManager.getMetadata();\n\n      if (metadata && metadata.isEditMode === true) {\n        // NOTE: setSavedOrderId removed - formData.id is single source of truth\n        // Metadata is used only for editOrderId initialization\n      }\n    } catch (error) {\n    }\n  }, [user_id]);\n\n  //  Uloit isEditMode pes DraftManager pi kad zmn\n  useEffect(() => {\n    if (user_id) {\n      try {\n        draftManager.saveMetadata({ isEditMode });\n      } catch (error) {\n      }\n    }\n  }, [isEditMode, user_id]);\n\n  //  Ukldat scroll pozici pi scrollovn\n  useEffect(() => {\n    if (!user_id) return;\n\n    let scrollTimeout;\n    const handleScroll = (e) => {\n      // Debounce - ukldej a po 500ms neinnosti\n      clearTimeout(scrollTimeout);\n      //  ZRUENO: Ukldn scroll pozice (na dost uivatele)\n      // scrollTimeout = setTimeout(() => {\n      //   try {\n      //     const scrollContainer = scrollableContentRef.current;\n      //     const scrollPosition = scrollContainer ? scrollContainer.scrollTop : (window.pageYOffset || document.documentElement.scrollTop);\n      //     draftManager.saveMetadata({ scrollPosition });\n      //     // console.log(' [Scroll] Uloena pozice:', scrollPosition);\n      //   } catch (error) {\n      //     console.error(' [Scroll] Chyba pi ukldn pozice:', error);\n      //   }\n      // }, 500);\n    };\n\n    // Pipoj listener pmo na ref element\n    const scrollContainer = scrollableContentRef.current;\n    if (scrollContainer) {\n      scrollContainer.addEventListener('scroll', handleScroll);\n    } else {\n      // Fallback na window scroll\n      window.addEventListener('scroll', handleScroll);\n    }\n\n    return () => {\n      clearTimeout(scrollTimeout);\n      if (scrollContainer) {\n        scrollContainer.removeEventListener('scroll', handleScroll);\n      } else {\n        window.removeEventListener('scroll', handleScroll);\n      }\n    };\n  }, [user_id]);\n\n  // Cache pro naten uivatele z DB (pro getUserNameById)\n  const [userNamesCache, setUserNamesCache] = useState({});\n\n  //  CENTRALIZOVAN WORKFLOW MANAGER - PESUNUT PO DEFINICI formData\n  // (Nyn ne v kdu, po useState formData)\n\n  // Helper funkce pro prci s workflow stavy (modifikace)\n  const addWorkflowState = (currentStates, newState) => {\n    const states = parseWorkflowStates(currentStates);\n    if (!states.includes(newState)) {\n      states.push(newState);\n    }\n    return JSON.stringify(states);\n  };\n\n  const removeWorkflowState = (currentStates, stateToRemove) => {\n    const states = parseWorkflowStates(currentStates);\n    const filtered = states.filter(s => s !== stateToRemove);\n    return JSON.stringify(filtered);\n  };\n\n  // Helper funkce pro zskn textu stavu objednvky z DB\n  const getOrderStatusInfo = () => {\n    // Mapovn stav na esk texty a detaily\n    const statusMapping = {\n      'NOVA': {\n        text: isChanged ? 'Koncept' : 'Nov objednvka',\n        icon: '',\n        type: 'info',\n        description: 'Objednvka je v pprav'\n      },\n      'ODESLANA_KE_SCHVALENI': {\n        text: 'Odeslno ke schvlen',\n        icon: '',\n        type: 'warning',\n        description: 'Objednvka ek na schvlen pslunm schvalovatelem'\n      },\n      'SCHVALENA': {\n        text: 'Schvlen objednvka',\n        icon: '',\n        type: 'success',\n        description: 'Objednvka byla schvlena a je pipravena k dalm krokm'\n      },\n      'ZAMITNUTA': {\n        text: 'Zamtnut objednvka',\n        icon: '',\n        type: 'error',\n        description: 'Objednvka byla zamtnuta'\n      },\n      'NESCHVALENA': {\n        text: 'Neschvlen objednvka',\n        icon: '',\n        type: 'error',\n        description: 'Objednvka nebyla schvlena'\n      },\n      'CEKA_SE': {\n        text: 'ek se na rozhodnut',\n        icon: '',\n        type: 'warning',\n        description: 'ek se na dal kroky'\n      },\n      'ROZPRACOVANA': {\n        text: 'Rozpracovan objednvka',\n        icon: '',\n        type: 'info',\n        description: 'Objednvka se zpracovv'\n      },\n      'ODESLANA': {\n        text: 'Odeslno dodavateli',\n        icon: '',\n        type: 'info',\n        description: 'Objednvka byla odeslna dodavateli'\n      },\n      'POTVRZENA': {\n        text: 'Potvrzeno dodavatelem',\n        icon: '',\n        type: 'success',\n        description: 'Dodavatel potvrdil objednvku'\n      },\n      'DOKONCENA': {\n        text: 'Dokonen objednvky',\n        icon: '',\n        type: 'success',\n        description: 'Objednvka byla spn dokonena'\n      },\n      'ZRUSENA': {\n        text: 'Stornovan objednvka',\n        icon: '',\n        type: 'error',\n        description: 'Objednvka byla stornovna'\n      }\n    };\n\n    // Zskej aktuln stav z workflow\n    const currentStates = parseWorkflowStates(formData.stav_workflow_kod);\n    const latestState = currentStates[currentStates.length - 1];\n\n    // Pokud existuje stav_objednavky, preferuj ho\n    if (formData.stav_objednavky) {\n      // Najdi stav podle nzvu\n      const foundState = Object.entries(statusMapping).find(([key, info]) =>\n        info.text === formData.stav_objednavky ||\n        key === formData.stav_objednavky\n      );\n\n      if (foundState) {\n        return {\n          ...foundState[1],\n          code: foundState[0],\n          hasReason: !!formData.schvaleni_komentar,\n          reason: formData.schvaleni_komentar,\n          dateApproved: formData.dt_schvaleni\n        };\n      }\n    }\n\n    // Fallback na workflow stav\n    const statusInfo = statusMapping[latestState] || statusMapping['NOVA'];\n\n    return {\n      ...statusInfo,\n      code: latestState,\n      hasReason: !!formData.schvaleni_komentar,\n      reason: formData.schvaleni_komentar,\n      dateApproved: formData.dt_schvaleni\n    };\n  };\n\n  //  Fzovn objednvky (8 fz podle workflow)\n  // FZE 1/8: NOVA - Vytvoen konceptu\n  // FZE 2/8: ODESLANA_KE_SCHVALENI - ek na schvlen\n  // FZE 3/8: SCHVALENA + ROZPRACOVANA - Schvlen, rozpracovan\n  // FZE 4/8: ODESLANA + POTVRZENA - Potvrzen dodavatele + checkbox \"M bt zveejnna\"\n  // FZE 5/8: UVEREJNIT - Vyplnn registru smluv (datum + IDDT) [VOLITELN - pouze kdy ANO]\n  // FZE 6/8: UVEREJNENA / NEUVEREJNIT / FAKTURACE - Fakturace\n  // FZE 7/8: VECNA_SPRAVNOST - Kontrola vcn sprvnosti\n  // FZE 8/8: ZKONTROLOVANA  zobraz sekci Dokonen  pid DOKONCENA a proces kon\n\n  const [formData, _setFormData] = useState({\n    // Informace o objednateli (nateno z userDetail)\n    objednatel_id: '', // z databze uivatel\n    uzivatel_id: '', // souasn uivatel (vytvoil objednvku)\n    garant_uzivatel_id: '', // garant objednvky\n    prikazce_id: '', // pkazce objednvky (dve po_uzivatel)\n    jmeno: '', // nateno z userDetail\n    email: '', // nateno z userDetail\n    telefon: '', // nateno z userDetail\n\n    // Schvlen nkupu PO\n    predmet: '',\n    strediska_kod: [], // Zmnno na pole pro multi-select\n    max_cena_s_dph: '',\n    popis_pozadavku: '', // Podrobn popis poadavku\n    mimoradna_udalost: false, // Mimodn udlost (krize, havrie)\n\n    // Workflow system - pouv nov konstanty\n    stav_workflow_kod: JSON.stringify(['NOVA']), //  Vchoz stav: NOVA (nov/koncept objednvka)\n    schvalovatel_id: '', // ID uivatele, kter schvlil/zamtl\n    dt_schvaleni: '', // Datum schvlen/zamtnut\n    schvaleni_komentar: '', // Koment/dvod schvlen i zamtnut\n\n    // === DAL ST - VIDITELN JEN PO SCHVLEN ===\n\n    // Financovn objednvky\n    zpusob_financovani: '',\n    financovani: '', // JSON pole pro uloen do DB\n    // Dynamick pole pro financovn\n    lp_kod: [], // LP kdy pro Limitovan pslib (multiselect)\n    cislo_smlouvy: '', // slo smlouvy pro Smlouva\n    smlouva_poznamka: '', // Poznmka ke smlouv\n    individualni_schvaleni: '', // Identifiktor pro Individuln schvlen\n    individualni_poznamka: '', // Poznmka pro Individuln schvlen\n    pojistna_udalost_cislo: '', // slo pojistn udlosti\n    pojistna_udalost_poznamka: '', // Poznmka k pojistn udlosti\n\n    // Informace o dodavateli\n    dodavatel_id: '',\n    dodavatel_nazev: '',\n    dodavatel_adresa: '',\n    dodavatel_ico: '',\n    dodavatel_dic: '',\n    dodavatel_zastoupeny: '',\n\n    // Kontaktn osoba dodavatele\n    dodavatel_kontakt_jmeno: '',\n    dodavatel_kontakt_email: '',\n    dodavatel_kontakt_telefon: '',\n\n    // Detaily objednvky\n    druh_objednavky: '',\n    druh_objednavky_kod: '', // Sprvn pole pro databzi\n    polozky_objednavky: [], // Poloky se inicializuj v useEffect\n    faktury: [], // Faktury se natou s objednvkou z BE\n    poznamka_objednavky: '',\n\n    // Dodac a zrun podmnky\n    dt_predpokladany_termin_dodani: '',\n    misto_dodani: '',\n    zaruka: '',\n\n    // Stav odesln objednvky\n    stav_odeslano: false, // FZE 3: checkbox \"Odeslno\"\n    datum_odeslani: '',\n    stav_stornovano: false, // FZE 3: checkbox \"Stornovno\"\n    datum_storna: '',\n    storno_uzivatel_id: '', // ID uivatele, kter provedl storno\n    odeslani_storno_duvod: '', // DB pole pro dvod storna\n    storno_provedl: '',\n    storno_poznamky: '',\n\n    // Potvrzen objednvky od dodavatele - struktura JSON pro DB\n    dodavatel_zpusob_potvrzeni: {\n      potvrzeni: 'NE', // 'ANO' nebo 'NE'\n      zpusoby: [], // pole zpsob: 'email', 'telefon', 'podepsana_objednavka', 'eshop'\n      platba: 'faktura' // vdy faktura (pevn nastaveno)\n    },\n    dt_akceptace: '',\n\n    // Registr smluv\n    dt_zverejneni: '',\n    registr_iddt: '',\n    ma_byt_zverejnena: false,\n\n    // === FZE 3: SEKCE PO ODESLN OBJEDNVKY ===\n\n    // Prbh objednvky\n    stav_u_dodavatele: '', // 'potvrzeno', 've_vyrobe', 'pripraveno', 'odeslano', 'doruceno', 'stornovno'\n    datum_zmeny_stavu: '',\n    poznamka_stav: '',\n\n    // Dodac informace\n    cislo_zasilky: '',\n    prepravce: '',\n    ocekavane_doruceni: '',\n    skutecne_doruceni: '',\n\n    // Fakturace\n    cislo_faktury: '',\n    datum_faktury: '',\n    castka_bez_dph: '',\n    castka_s_dph: '',\n    datum_splatnosti: '',\n    datum_zaplaceni: '',\n    faktury_objednavky: [], //  Faktury k objednvce - ukldaj se do konceptu\n\n    //  Vcn sprvnost - FZE 7 ODSTRANNA - refaktorovno na per-invoice\n    // vecna_spravnost_umisteni_majetku: '', \n    // vecna_spravnost_poznamka: '',\n    // vecna_spravnost_potvrzeno: 0,\n\n    // Dokonen objednvky - FZE 8\n    potvrzeni_dokonceni_objednavky: 0, // ANO/NE checkbox (0/1) - finln potvrzen\n\n    // Plohy k objednvce\n    prilohy_dokumenty: [],\n\n    // Evidenn slo objednvky (nateno z API)\n    ev_cislo: '',\n\n    // Doasn datum objednvky pro koncepty (generuje se na FE, pepe se pi prvnm uloen na BE)\n    temp_datum_objednavky: new Date().toISOString().split('T')[0], //  OPRAVA: Nastavit ihned pi inicializaci\n\n    // Datum vytvoen objednvky (nastavuje se a pi uloen do DB)\n    datum_vytvoreni: ''\n  });\n\n  //  DEBUG: Interceptor pro setFormData - trackuje vechna voln\n  const setFormData = useCallback((newData) => {\n    const stack = new Error().stack;\n    const caller = stack.split('\\n')[2]?.trim() || 'unknown';\n\n    if (typeof newData === 'function') {\n      _setFormData(prev => {\n        const result = newData(prev);\n        // DEBUG: FORMDATA UPDATE logging removed for performance\n        return result;\n      });\n    } else {\n      _setFormData(newData);\n    }\n  }, []);\n\n  //  Registrace aktivn objednvky (pro detekci konfliktu v InvoiceEvidencePage)\n  useEffect(() => {\n    if (formData.id) {\n      window.__activeOrderFormId = formData.id;\n      window.__activeOrderFormEvCislo = formData.cislo_objednavky || formData.ev_cislo || `#${formData.id}`;\n    }\n    \n    return () => {\n      delete window.__activeOrderFormId;\n      delete window.__activeOrderFormEvCislo;\n    };\n  }, [formData.id, formData.cislo_objednavky, formData.ev_cislo]);\n\n  //  SNAPSHOT pvodnho stavu formule pro detekci zmn\n  const originalFormDataRef = useRef(null);\n\n  //  Detekce zmn v objednvce - porovnv aktuln stav s pvodnm snapshotem\n  const hasUnsavedChanges = useMemo(() => {\n    if (!originalFormDataRef.current || !formData.id) {\n      return false; // Nov objednvka nebo snapshot jet nen vytvoen\n    }\n\n    // Porovnn klovch pol formule\n    const original = originalFormDataRef.current;\n    \n    // Pole kter budeme porovnvat\n    const fieldsToCompare = [\n      'predmet', 'max_cena_s_dph', 'popis_pozadavku',\n      'zpusob_financovani', 'dodavatel_nazev', 'dodavatel_ico',\n      'druh_objednavky_kod', 'poznamka_objednavky',\n      'dt_predpokladany_termin_dodani', 'misto_dodani', 'zaruka'\n    ];\n\n    // Kontrola zkladnch pol\n    for (const field of fieldsToCompare) {\n      if (original[field] !== formData[field]) {\n        return true;\n      }\n    }\n\n    // Kontrola pole poloek objednvky\n    const originalPolozky = original.polozky_objednavky || [];\n    const currentPolozky = formData.polozky_objednavky || [];\n    \n    if (originalPolozky.length !== currentPolozky.length) {\n      return true;\n    }\n\n    // Porovnn jednotlivch poloek\n    for (let i = 0; i < originalPolozky.length; i++) {\n      const origItem = originalPolozky[i];\n      const currItem = currentPolozky[i];\n      \n      if (origItem.popis !== currItem.popis ||\n          origItem.mnozstvi !== currItem.mnozstvi ||\n          origItem.cena_jednotkova !== currItem.cena_jednotkova) {\n        return true;\n      }\n    }\n\n    return false;\n  }, [formData]);\n\n  // CENTRALIZOVANY WORKFLOW MANAGER\n  // Poskytuje jednotnou logiku pro workflow (eliminuje duplicity)\n  // MUSI byt AZ PO useState(formData), protoze potrebuje formData jako zavislost\n  // JEDINA PROMENNA pro archivovane objednavky\n  const isArchived = useMemo(() => {\n    return formData.stav_objednavky === 'ARCHIVOVANO' ||\n           formData.stav_objednavky === 'Archivovno';\n  }, [formData.stav_objednavky]);\n\n  const workflowManager = useWorkflowManager(formData, isArchived);\n\n  // Rozbalen API pro snadnj pouit\n  const {\n    currentPhase,\n    phaseTheme: currentPhaseTheme,\n    phaseProgress,\n    mainWorkflowState,\n    getCurrentPhase,\n    getPhaseProgress,\n    getPhaseTheme,\n    parseWorkflowStates,\n    hasWorkflowState,\n    //  Payment mode detection\n    isPokladna,\n    //  Workflow locking states z WorkflowManager\n    isWorkflowCompleted, //  TRUE pro DOKONCENA, ZAMITNUTA, ZRUSENA (vechny konen stavy workflow)\n    isWorkflowRejected,\n    isWorkflowCancelled,\n    //  Force refresh API\n    forceRefresh: workflowForceRefresh,\n    //  Section state API\n    getSectionState\n  } = workflowManager;\n\n  //  NOTE: formData.id removed - using formData.id directly as single source of truth\n\n  //  [WORKFLOW MANAGER] Logovn zmny fze - DISABLED to prevent infinite loop\n  // useEffect(() => {\n  //   if formData.id {\n  //   }\n  // }, [currentPhase, currentPhaseTheme, mainWorkflowState, formData.id, formData.id]);\n\n  // Uren zda je to nov objednvka - odvozeno z formData.id (single source of truth)\n  const isNewOrder = useMemo(() => !formData.id, [formData.id]);\n\n  //  COMPUTED: Detekce archivovan objednvky\n  // Flag kter indikuje, e pracujeme s archivovanou objednvkou\n  const isArchivedOrder = isArchived;\n\n  // Pro archivovan objednvky nastavit fzi na maximum (8)\n  // POZNMKA: currentPhase u je 8 pro archivovan dky logice v useWorkflowManager\n  const currentPhaseOverride = currentPhase;\n\n  //  OVERRIDE: Pro archivovan objednvky zobrazit vechny fze jako dokonen\n  const phaseProgressOverride = useMemo(() => {\n    if (!isArchivedOrder) {\n      return phaseProgress; // Bn objednvka - pouij originln progress\n    }\n\n    // Archivovan objednvka - vechny fze completed\n    return {\n      ...phaseProgress,\n      phases: phaseProgress.phases.map(phase => ({\n        ...phase,\n        isVisible: true,\n        fillClass: 'completed' // Vechny fze jako dokonen\n      }))\n    };\n  }, [isArchivedOrder, phaseProgress]);\n\n  //  Flag pro zmny proti DB - d prioritu koncept vs DB\n  const [isChanged, setIsChanged] = useState(false);\n  \n  //  Sleduje zda u probhlo naten draftu\n  const [isDraftLoaded, setIsDraftLoaded] = useState(false);\n\n  //  [CENTRLN SPRVCE STAVU MENUBARU]\n  // Jedno msto pro inicializaci, update a deinicializaci - HOTOVO, KONEC!\n  \n  // Centrln funkce pro broadcast stavu\n  const broadcastMenuBarState = useCallback((state) => {\n    const fullState = {\n      isEditMode: state.isEditMode ?? isEditMode,\n      isNewOrder: state.isNewOrder ?? !isEditMode,\n      orderId: state.orderId ?? formData.id,\n      orderNumber: state.orderNumber ?? (formData.cislo_objednavky || formData.ev_cislo),\n      currentPhase: state.currentPhase ?? currentPhase,\n      mainWorkflowState: state.mainWorkflowState ?? mainWorkflowState,\n      hasDraft: state.hasDraft ?? (isChanged || isDraftLoaded),\n      timestamp: Date.now()\n    };\n    \n    window.__orderFormState = fullState;\n    window.dispatchEvent(new CustomEvent('orderFormStateChange', { detail: fullState }));\n    \n    return fullState;\n  }, [isEditMode, formData.id, formData.cislo_objednavky, formData.ev_cislo, currentPhase, mainWorkflowState, isChanged, isDraftLoaded]);\n  \n  // Ref pro pstup z async funkc\n  const broadcastMenuBarStateRef = useRef(broadcastMenuBarState);\n  useEffect(() => {\n    broadcastMenuBarStateRef.current = broadcastMenuBarState;\n  }, [broadcastMenuBarState]);\n  \n  // Helper pro voln z async funkc\n  const broadcastOrderState = (overrides) => {\n    return broadcastMenuBarStateRef.current(overrides);\n  };\n  \n  //  SYNCHRONN BROADCAST MenuBaru - reaguje OKAMIT na zmny\n  useEffect(() => {\n    // ekat dokud nen isDraftLoaded = skuten nateno\n    if (!isDraftLoaded) return;\n    \n    //  URIT STAV podle formData.id a editOrderId (SINGLE SOURCE OF TRUTH)\n    const hasRealId = !!formData.id; // DB ID = skuten objednvka v databzi\n    const hasEditIntent = !!editOrderId; // URL parametr edit=123 = editan zmr\n    \n    //  JEDNOZNAN LOGIKA:\n    // 1. M DB ID (formData.id)  EDITACE (nezle na editOrderId)\n    // 2. Nem DB ID, ale m zmny (isChanged)  KONCEPT\n    // 3. Nem DB ID ani zmny  NOV\n    \n    let menuBarState = 'NOVA'; // Default\n    \n    if (hasRealId) {\n      // M DB ID  EDITACE\n      menuBarState = 'EDITACE';\n    } else if (isChanged || hasEditIntent) {\n      // Nem DB ID, ale m zmny nebo editan zmr  KONCEPT\n      menuBarState = 'KONCEPT';\n    }\n    \n    //  POSLAT BROADCAST s jednoznanm stavem\n    const state = {\n      isEditMode: menuBarState === 'EDITACE',\n      isNewOrder: menuBarState === 'NOVA',\n      orderId: hasRealId ? formData.id : null,\n      orderNumber: formData.cislo_objednavky || formData.ev_cislo || '',\n      currentPhase,\n      mainWorkflowState,\n      hasDraft: menuBarState === 'KONCEPT' || menuBarState === 'EDITACE',\n      timestamp: Date.now()\n    };\n    \n    window.__orderFormState = state;\n    window.dispatchEvent(new CustomEvent('orderFormStateChange', { detail: state }));\n    \n    //  DEINICIALIZACE pi unmount - zruit vechny ID a nastavit \"dn objednvka\"\n    return () => {\n      window.__orderFormState = {\n        isEditMode: false,\n        isNewOrder: false,\n        orderId: null,\n        orderNumber: '',\n        currentPhase: 1,\n        mainWorkflowState: 'NOVA',\n        hasDraft: false,\n        timestamp: Date.now()\n      };\n      window.dispatchEvent(new CustomEvent('orderFormStateChange', { detail: window.__orderFormState }));\n    };\n  }, [isDraftLoaded, formData.id, formData.cislo_objednavky, formData.ev_cislo, currentPhase, mainWorkflowState, isChanged, editOrderId]); //  Reaguje na vechny relevantn zmny!\n\n  //  SPRINT 4: Consolidated Save State (61 hook)\n  const [saveState, setSaveState] = useState({\n    saving: false,\n    savingDraft: false,\n    disableAutosave: false, //  ZAKZAT autosave po spnm uloen\n    lastAutoSave: null,\n    autoSaving: false,\n    dataSource: null // 'concept', 'database', null\n  });\n  const disableAutosaveRef = useRef(false); //  REF pro OKAMITOU kontrolu (bez async delay)\n  const autoSaveTimerRef = useRef(null); //  Timer pro debounce autosave pi psan\n  \n  //  KRITICK FLAG: Globln blokovn VECH save operac pi zavrn\n  const isClosingRef = useRef(false);\n\n  //  CENTRALIZOVAN AUTOSAVE s debounce logikou (3 sekundy neaktivity)\n  const autosaveCallbackRef = useRef(null);\n\n  // Pomocn funkce pro saveDraft - bude nastavena pozdji\n  const performSaveDraft = useCallback((isAutoSave) => {\n    if (autosaveCallbackRef.current) {\n      autosaveCallbackRef.current(isAutoSave);\n    }\n  }, []);\n  \n  //  AUTOSAVE HOOK - Defined early to be accessible throughout the component\n  // Uses saveState directly instead of aliases to avoid initialization order issues\n  const { triggerAutosave, cancelAutosave } = useAutosave(performSaveDraft, {\n    delay: 3000, // 3 sekundy neaktivity\n    enabled: !saveState.disableAutosave && isDraftLoaded,\n    dependencies: [saveState.disableAutosave, isDraftLoaded, formData.faktury]\n  });\n  \n  //  POZOR: Hlasov rozpoznvn je implementovno GLOBLN v Layout.js\n  // OrderForm25 NEPOUV vlastn hook, protoe by to zpsobovalo konflikty\n  // Pokud uivatel chce nahrvat do poznmky formule:\n  //   1. Fokusne textarea poznmky\n  //   2. Zmkne CTRL+Space\n  //   3. Text se vlo pmo do textarea (dky logice v hooku)\n\n  // NOTE: sourceOrderIdForUnlock removed - using formData.id directly\n\n  // Stav pro cancel confirm modal\n  const [showCancelConfirmModal, setShowCancelConfirmModal] = useState(false);\n  const [cancelWarningMessage, setCancelWarningMessage] = useState('');\n\n  //  SPRINT 4: Consolidated Template State (131 hook)\n  const [templateState, setTemplateState] = useState({\n    saved: [], // [{ name, data, ts }]\n    server: [], // array of { name, data, ts, type, id, user_id }\n    fetchStatus: { status: null, error: null },\n    loading: false,\n    showSaveModal: false,\n    name: '',\n    type: 'po', // 'po', 'details', 'mixed'\n    saveChecked: false,\n    saveMode: 'new', // 'new', 'update', 'merge'\n    selectedTarget: null, // cel template objekt\n    selectedTargetTs: null,\n    showDeleteConfirm: false,\n    pendingDelete: null\n  });\n\n  //  SPRINT 4: Consolidated Unlock Confirm Dialogs (91 hook)\n  const [unlockDialogs, setUnlockDialogs] = useState({\n    phase1: false,\n    phase2: false,\n    phase3: false,\n    registr: false,\n    potvrzeni: false,\n    cancelPublish: false, // Confirm pro zruen zveejnn\n    fakturace: false,\n    dokonceni: false,\n    storno: false\n  });\n\n  //  SPRINT 4: Consolidated Faktury (Invoice) State (41 hook)\n  const [fakturyState, setFakturyState] = useState({\n    loading: false,\n    showAddForm: false,\n    editing: null, // Faktura being edited\n    formData: {\n      fa_datum_doruceni: formatDateForPicker(new Date()), //  Sprvn pole pro datum\n      fa_dorucena: 1, //  Boolean flag (0/1)\n      fa_castka: '',\n      fa_cislo_vema: '',\n      fa_strediska_kod: [], //  Sprvn nzev pole pro stediska\n      fa_poznamka: '',\n      fa_splatnost: ''\n    }\n  });\n\n  //  PLOHY FAKTUR - u eeno samostatnou komponentou InvoiceAttachmentsCompact\n  // (star state promnn fakturaAttachments, uploadingFakturaFiles, draggingFakturaId, fakturaFileInputRefs odstranny)\n  //  REMOVED: fakturaTypyPrilohOptions a loadingFakturaTypyPriloh budou definovny a po dictionaries\n\n  //  Confirm dialog pro mazn faktury\n  const [deleteFacturaDialog, setDeleteFacturaDialog] = useState({\n    isOpen: false,\n    fakturaId: null,\n    fakturaNazev: '',\n    pocetPriloh: 0\n  });\n\n  //  Confirm dialog pro odemykn sekc (univerzln)\n  const [confirmDialog, setConfirmDialog] = useState({\n    isOpen: false,\n    title: '',\n    message: '',\n    onConfirm: null\n  });\n\n  //  SPRINT 5: Broadcast consolidated above (was 41 hook)\n\n  //  SPRINT 4: Consolidated Template UI State (71 hook)\n  const [templateUI, setTemplateUI] = useState({\n    actionsLog: [],\n    hoveredPreviewKey: null,\n    previewModalData: null, // {template, data}\n    editingId: null,\n    editingName: '',\n    showSearchPredefs: false,\n    searchPredefs: ''\n  });\n  const searchInputRef = useRef(null);\n\n  // Validan chyby - state pro oznaen ervench pol\n  const [validationErrors, setValidationErrors] = useState({});\n  const [hasTriedToSubmit, setHasTriedToSubmit] = useState(false);\n  \n\n\n  //  SPRINT 4: Consolidated LP (lokalizace) States (42 hooks)\n  const [lokalizacePanelStates, setLokalizacePanelStates] = useState({}); // Rozkldac panely u poloek\n  \n  const [lpState, setLpState] = useState({\n    options: [], // LP options pro dropdown v polokch objednvky\n    loading: false,\n    financovani: {} //  LP stavy z API (limit, erpno, zbv) - pro pesn zobrazen erpn\n  });\n\n  //  SPRINT 4: Backward Compatibility Aliases - ALL STATES (defined AFTER all useState declarations)\n  // This ensures no \"Cannot access before initialization\" errors\n  \n  // Supplier Search Aliases\n  const showSupplierSearchDialog = supplierSearch.showDialog;\n  const setShowSupplierSearchDialog = (val) => setSupplierSearch(s => ({...s, showDialog: val}));\n  const supplierSearchTerm = supplierSearch.searchTerm;\n  const setSupplierSearchTerm = (val) => setSupplierSearch(s => ({...s, searchTerm: val}));\n  const supplierSearchResults = supplierSearch.results;\n  const setSupplierSearchResults = (val) => setSupplierSearch(s => ({...s, results: val}));\n  const supplierSearchLoading = supplierSearch.loading;\n  const setSupplierSearchLoading = (val) => setSupplierSearch(s => ({...s, loading: val}));\n  const allSupplierContacts = supplierSearch.allContacts;\n  const setAllSupplierContacts = (val) => setSupplierSearch(s => ({...s, allContacts: val}));\n  \n  // ARES State Aliases\n  const aresPopupOpen = aresState.popupOpen;\n  const setAresPopupOpen = (val) => setAresState(s => ({...s, popupOpen: val}));\n  const aresSearch = aresState.search;\n  const setAresSearch = (val) => setAresState(s => ({...s, search: val}));\n  const aresResults = aresState.results;\n  const setAresResults = (val) => setAresState(s => ({...s, results: val}));\n  const loadingAres = aresState.loading;\n  const setLoadingAres = (val) => setAresState(s => ({...s, loading: val}));\n  const savingToLocal = aresState.savingToLocal;\n  const setSavingToLocal = (val) => setAresState(s => ({...s, savingToLocal: val}));\n  const aresScopeInfo = aresState.scopeInfo;\n  const setAresScopeInfo = (val) => setAresState(s => ({...s, scopeInfo: val}));\n  const aresSelectedScope = aresState.selectedScope;\n  const setAresSelectedScope = (val) => setAresState(s => ({...s, selectedScope: val}));\n  const aresSelectedUseky = aresState.selectedUseky;\n  const setAresSelectedUseky = (val) => setAresState(s => ({...s, selectedUseky: val}));\n  \n  // Useky State Aliases\n  const availableUseky = usekyState.available;\n  const setAvailableUseky = (val) => setUsekyState(s => ({...s, available: val}));\n  const usekyLoading = usekyState.loading;\n  const setUsekyLoading = (val) => setUsekyState(s => ({...s, loading: val}));\n  \n  // ICO Check State Aliases\n  const showIcoCheck = icoCheckState.show;\n  const setShowIcoCheck = (val) => setIcoCheckState(s => ({...s, show: val}));\n  const icoCheckStatus = icoCheckState.status;\n  const setIcoCheckStatus = (val) => setIcoCheckState(s => ({...s, status: val}));\n  const icoCheckData = icoCheckState.data;\n  const setIcoCheckData = (val) => setIcoCheckState(s => ({...s, data: val}));\n  const isIcoOperation = icoCheckState.isOperation;\n  const setIsIcoOperation = (val) => setIcoCheckState(s => ({...s, isOperation: val}));\n  \n  // Save Progress State Aliases\n  const showSaveProgress = saveProgressState.show;\n  const setShowSaveProgress = (val) => setSaveProgressState(s => ({...s, show: val}));\n  const saveProgress = saveProgressState.progress;\n  const setSaveProgress = (val) => setSaveProgressState(s => ({...s, progress: val}));\n  const saveProgressText = saveProgressState.text;\n  const setSaveProgressText = (val) => setSaveProgressState(s => ({...s, text: val}));\n  \n  // Attachment UI Aliases\n  const uploadingFiles = attachmentUI.uploading;\n  const setUploadingFiles = (val) => setAttachmentUI(s => ({...s, uploading: val}));\n  const dragOver = attachmentUI.dragOver;\n  const setDragOver = (val) => setAttachmentUI(s => ({...s, dragOver: val}));\n  const isCheckingSyncAttachments = attachmentUI.checkingSync;\n  const setIsCheckingSyncAttachments = (val) => setAttachmentUI(s => ({...s, checkingSync: val}));\n  const showDeleteAttachmentDialog = attachmentUI.showDeleteDialog;\n  const setShowDeleteAttachmentDialog = (val) => setAttachmentUI(s => ({...s, showDeleteDialog: val}));\n  const attachmentToDelete = attachmentUI.deleteTarget;\n  const setAttachmentToDelete = (val) => setAttachmentUI(s => ({...s, deleteTarget: val}));\n  const showDeleteAllAttachmentsDialog = attachmentUI.showDeleteAllDialog;\n  const setShowDeleteAllAttachmentsDialog = (val) => setAttachmentUI(s => ({...s, showDeleteAllDialog: val}));\n  \n  // Supplier Dialog Aliases\n  const showSupplierAddDialog = supplierDialog.showAddDialog;\n  const setShowSupplierAddDialog = (val) => setSupplierDialog(s => ({...s, showAddDialog: val}));\n  const existingSupplierCheck = supplierDialog.existingCheck;\n  const setExistingSupplierCheck = (val) => setSupplierDialog(s => ({...s, existingCheck: val}));\n  const supplierAutoFillSource = supplierDialog.autoFillSource;\n  const setSupplierAutoFillSource = (val) => setSupplierDialog(s => ({...s, autoFillSource: val}));\n  \n  // DOCX Modal Aliases\n  const docxModalOpen = docxModal.open;\n  const setDocxModalOpen = (val) => setDocxModal(s => ({...s, open: val}));\n  const docxModalOrder = docxModal.orderData;\n  const setDocxModalOrder = (val) => setDocxModal(s => ({...s, orderData: val}));\n  \n  // Loading State Aliases\n  const isLoadingCiselniky = loadingState.ciselniky;\n  const setIsLoadingCiselniky = (val) => setLoadingState(s => ({...s, ciselniky: val}));\n  const isLoadingFormData = loadingState.formData;\n  const setIsLoadingFormData = (val) => setLoadingState(s => ({...s, formData: val}));\n  const isFormInitializing = loadingState.initializing;\n  const setIsFormInitializing = (val) => setLoadingState(s => ({...s, initializing: val}));\n  const isInitialized = loadingState.initialized;\n  const setIsInitialized = (val) => setLoadingState(s => ({...s, initialized: val}));\n  const initializationError = loadingState.error;\n  const setInitializationError = (val) => setLoadingState(s => ({...s, error: val}));\n  \n  // Save State Aliases\n  const isSaving = saveState.saving;\n  const setIsSaving = (val) => setSaveState(s => ({...s, saving: val}));\n  const isSavingDraft = saveState.savingDraft;\n  const setIsSavingDraft = (val) => setSaveState(s => ({...s, savingDraft: val}));\n  const disableAutosave = saveState.disableAutosave;\n  const setDisableAutosave = (val) => {\n    setSaveState(s => ({...s, disableAutosave: val}));\n    disableAutosaveRef.current = val; // Sync ref\n  };\n  const lastAutoSave = saveState.lastAutoSave;\n  const setLastAutoSave = (val) => setSaveState(s => ({...s, lastAutoSave: val}));\n  const isAutoSaving = saveState.autoSaving;\n  const setIsAutoSaving = (val) => setSaveState(s => ({...s, autoSaving: val}));\n  const dataSource = saveState.dataSource;\n  const setDataSource = (val) => setSaveState(s => ({...s, dataSource: val}));\n  \n  // LP Details Aliases\n  const lpDetails = lpDetailsState.details;\n  const setLpDetails = (val) => setLpDetailsState(s => ({...s, details: val}));\n  const loadingLpDetails = lpDetailsState.loading;\n  const setLoadingLpDetails = (val) => setLpDetailsState(s => ({...s, loading: val}));\n  \n  // Smlouvy (Contracts) Aliases\n  const smlouvyList = smlouvyState.list;\n  const setSmlouvyList = (val) => setSmlouvyState(s => ({...s, list: val}));\n  const loadingSmlouvyList = smlouvyState.loadingList;\n  const setLoadingSmlouvyList = (val) => setSmlouvyState(s => ({...s, loadingList: val}));\n  const smlouvaDetail = smlouvyState.detail;\n  const setSmlouvaDetail = (val) => setSmlouvyState(s => ({...s, detail: val}));\n  const loadingSmlouvaDetail = smlouvyState.loadingDetail;\n  const setLoadingSmlouvaDetail = (val) => setSmlouvyState(s => ({...s, loadingDetail: val}));\n  const smlouvaSearchTerm = smlouvyState.searchTerm;\n  const setSmlouvaSearchTerm = (val) => setSmlouvyState(s => ({...s, searchTerm: val}));\n  const showSmlouvySuggestions = smlouvyState.showSuggestions;\n  const setShowSmlouvySuggestions = (val) => setSmlouvyState(s => ({...s, showSuggestions: val}));\n  const selectedSmlouvaSuggestionIndex = smlouvyState.selectedSuggestionIndex;\n  const setSelectedSmlouvaSuggestionIndex = (val) => setSmlouvyState(s => ({...s, selectedSuggestionIndex: val}));\n  \n  // Template State Aliases\n  const savedTemplates = templateState.saved;\n  const setSavedTemplates = (val) => setTemplateState(s => ({...s, saved: val}));\n  const serverTemplates = templateState.server;\n  const setServerTemplates = (val) => setTemplateState(s => ({...s, server: val}));\n  const templatesFetchStatus = templateState.fetchStatus;\n  const setTemplatesFetchStatus = (val) => setTemplateState(s => ({...s, fetchStatus: val}));\n  const templatesLoading = templateState.loading;\n  const setTemplatesLoading = (val) => setTemplateState(s => ({...s, loading: val}));\n  const showTemplateSaveModal = templateState.showSaveModal;\n  const setShowTemplateSaveModal = (val) => setTemplateState(s => ({...s, showSaveModal: val}));\n  const templateName = templateState.name;\n  const setTemplateName = (val) => setTemplateState(s => ({...s, name: val}));\n  const templateType = templateState.type;\n  const setTemplateType = (val) => setTemplateState(s => ({...s, type: val}));\n  const templateSaveChecked = templateState.saveChecked;\n  const setTemplateSaveChecked = (val) => setTemplateState(s => ({...s, saveChecked: val}));\n  const saveMode = templateState.saveMode;\n  const setSaveMode = (val) => setTemplateState(s => ({...s, saveMode: val}));\n  const selectedTargetTemplate = templateState.selectedTarget;\n  const setSelectedTargetTemplate = (val) => setTemplateState(s => ({...s, selectedTarget: val}));\n  const selectedTargetTemplateTs = templateState.selectedTargetTs;\n  const setSelectedTargetTemplateTs = (val) => setTemplateState(s => ({...s, selectedTargetTs: val}));\n  const showDeleteTemplateConfirm = templateState.showDeleteConfirm;\n  const setShowDeleteTemplateConfirm = (val) => setTemplateState(s => ({...s, showDeleteConfirm: val}));\n  const templatePendingDelete = templateState.pendingDelete;\n  const setTemplatePendingDelete = (val) => setTemplateState(s => ({...s, pendingDelete: val}));\n  \n  // Unlock Dialogs Aliases\n  const showUnlockPhase1Confirm = unlockDialogs.phase1;\n  const setShowUnlockPhase1Confirm = (val) => setUnlockDialogs(s => ({...s, phase1: val}));\n  const showUnlockPhase2Confirm = unlockDialogs.phase2;\n  const setShowUnlockPhase2Confirm = (val) => setUnlockDialogs(s => ({...s, phase2: val}));\n  const showUnlockPhase3Confirm = unlockDialogs.phase3;\n  const setShowUnlockPhase3Confirm = (val) => setUnlockDialogs(s => ({...s, phase3: val}));\n  const showUnlockRegistrConfirm = unlockDialogs.registr;\n  const setShowUnlockRegistrConfirm = (val) => setUnlockDialogs(s => ({...s, registr: val}));\n  const showUnlockPotvrzeniConfirm = unlockDialogs.potvrzeni;\n  const setShowUnlockPotvrzeniConfirm = (val) => setUnlockDialogs(s => ({...s, potvrzeni: val}));\n  const showCancelPublishConfirm = unlockDialogs.cancelPublish;\n  const setShowCancelPublishConfirm = (val) => setUnlockDialogs(s => ({...s, cancelPublish: val}));\n  const showUnlockFakturaceConfirm = unlockDialogs.fakturace;\n  const setShowUnlockFakturaceConfirm = (val) => setUnlockDialogs(s => ({...s, fakturace: val}));\n  const showUnlockDokonceniConfirm = unlockDialogs.dokonceni;\n  const setShowUnlockDokonceniConfirm = (val) => setUnlockDialogs(s => ({...s, dokonceni: val}));\n  const showUnlockStornoConfirm = unlockDialogs.storno;\n  const setShowUnlockStornoConfirm = (val) => setUnlockDialogs(s => ({...s, storno: val}));\n  \n  // Faktury (Invoice) State Aliases\n  const fakturyLoading = fakturyState.loading;\n  const setFakturyLoading = (val) => setFakturyState(s => ({...s, loading: val}));\n  const showAddFakturaForm = fakturyState.showAddForm;\n  const setShowAddFakturaForm = (val) => setFakturyState(s => ({...s, showAddForm: val}));\n  const editingFaktura = fakturyState.editing;\n  const setEditingFaktura = (val) => setFakturyState(s => ({...s, editing: val}));\n  const fakturaFormData = fakturyState.formData;\n  const setFakturaFormData = (val) => setFakturyState(s => ({...s, formData: val}));\n  \n  // Template UI Aliases\n  const templateActionsLog = templateUI.actionsLog;\n  const setTemplateActionsLog = (val) => setTemplateUI(s => ({...s, actionsLog: val}));\n  const hoveredPreviewKey = templateUI.hoveredPreviewKey;\n  const setHoveredPreviewKey = (val) => setTemplateUI(s => ({...s, hoveredPreviewKey: val}));\n  const previewModalData = templateUI.previewModalData;\n  const setPreviewModalData = (val) => setTemplateUI(s => ({...s, previewModalData: val}));\n  const editingTemplateId = templateUI.editingId;\n  const setEditingTemplateId = (val) => setTemplateUI(s => ({...s, editingId: val}));\n  const editingTemplateName = templateUI.editingName;\n  const setEditingTemplateName = (val) => setTemplateUI(s => ({...s, editingName: val}));\n  const showSearchPredefs = templateUI.showSearchPredefs;\n  const setShowSearchPredefs = (val) => setTemplateUI(s => ({...s, showSearchPredefs: val}));\n  const searchPredefs = templateUI.searchPredefs;\n  const setSearchPredefs = (val) => setTemplateUI(s => ({...s, searchPredefs: val}));\n  \n  // LP State Aliases\n  const lpOptionsForItems = lpState.options;\n  const setLpOptionsForItems = (val) => setLpState(s => ({...s, options: val}));\n  const lpOptionsLoading = lpState.loading;\n  const setLpOptionsLoading = (val) => setLpState(s => ({...s, loading: val}));\n  const lpStavy = lpState.financovani;\n  const setLpStavy = (val) => setLpState(s => ({...s, financovani: val}));\n\n  //  LP options se nataj automaticky v enriched objednvce z backendu\n  // Viz handleDataLoaded() kde se extrahuj z response.lp_options\n  \n  //  Nast aktuln stavy LP z API kdy se zmn lpOptionsForItems\n  useEffect(() => {\n    if (!lpOptionsForItems || lpOptionsForItems.length === 0 || !token || !username) return;\n    \n    const loadLPStavy = async () => {\n      const stavy = {};\n      for (const lp of lpOptionsForItems) {\n        try {\n          const stav = await fetchLPDetail({ token, username, cislo_lp: lp.kod });\n          if (stav) {\n            stavy[lp.id] = {\n              limit: parseFloat(stav.celkovy_limit) || 0,\n              cerpano: parseFloat(stav.skutecne_cerpano) || 0,\n              zbyva: parseFloat(stav.zbyva_skutecne) || 0\n            };\n          }\n        } catch (error) {\n          console.warn(`Nelze nast stav LP ${lp.kod}:`, error.message);\n        }\n      }\n      setLpStavy(stavy);\n    };\n    \n    loadLPStavy();\n  }, [lpOptionsForItems, token, username]);\n\n  //  WORKFLOW TRACKING - VYPNUTO (zpsobovalo hluk v konzoli)\n  // useEffect(() => {\n  //   if (!formData.stav_workflow_kod) return;\n  //\n  //   const workflowStates = parseWorkflowStates(formData.stav_workflow_kod);\n  //   const phaseInfo = getPhaseProgressInternal(formData.stav_workflow_kod, false, !!formData.id);\n  //\n  //   addDebugLog('info', 'WORKFLOW', 'state-changed', {\n  //     phase: phaseInfo.currentPhase,\n  //     states: workflowStates,\n  //     orderId: formData.id || 'NEW',\n  //     orderNumber: formData.ev_cislo || formData.cislo_objednavky || 'N/A'\n  //   });\n  // }, [formData.stav_workflow_kod, formData.id]);\n\n  //  REMOVED: useEffect pro natn typ faktur - nyn se nat pes useDictionaries.loadAll()\n  // Typy faktur jsou nyn dostupn v dictionaries.data.typyFakturOptions (alias: fakturaTypyPrilohOptions)\n  // Loading stav je v dictionaries.loading.typyFaktur (alias: loadingFakturaTypyPriloh)\n  // Fallback pi chyb je een pmo v useDictionaries reducer\n\n  /**\n   *  Automatick doplnn dodavatele ze smlouvy\n   * Pouit: Pi naten objednvky ve fzi 3+ s financovnm \"Smlouva\"\n   * Priorita: 1) Lokln adres, 2) ARES, 3) Data ze smlouvy\n   * @param {Object} orderData - Data objednvky s cislo_smlouvy a zpusob_financovani\n   * @param {number} currentPhase - Aktuln fze objednvky\n   * @returns {Object|null} - Dodavatelsk data nebo null\n   */\n  const autoFillSupplierFromContract = useCallback(async (orderData, currentPhase) => {\n    try {\n      // 1 KONTROLA PODMNEK\n      // Spustit POUZE kdy:\n      // - Objednvka je SCHVLEN (ale jet nen ODESLAN) - stav po schvlen\n      // - NEBO je rozpracovan s financovnm Smlouva\n      const workflowStates = orderData.stav_workflow_kod ? \n        (typeof orderData.stav_workflow_kod === 'string' ? JSON.parse(orderData.stav_workflow_kod) : orderData.stav_workflow_kod) : [];\n      \n      const hasSchvalena = Array.isArray(workflowStates) && workflowStates.includes('SCHVALENA');\n      const hasOdeslana = Array.isArray(workflowStates) && workflowStates.includes('ODESLANA');\n      \n      // NEPOUVAT pro objednvky co jsou u ODESLAN (tam mus bt dodavatel vyplnn)\n      if (hasOdeslana) {\n        return null;\n      }\n      \n      // Mus bt bu SCHVLEN nebo rozpracovan s financovnm Smlouva\n      const isSmlouvaFinancing = orderData.zpusob_financovani?.toLowerCase().includes('smlouva');\n      if (!hasSchvalena && !isSmlouvaFinancing) {\n        return null;\n      }\n      \n      if (!isSmlouvaFinancing) {\n        return null;\n      }\n\n      const hasSupplier = orderData.dodavatel_nazev?.trim() || orderData.dodavatel_ico?.trim();\n      if (hasSupplier) {\n        return null; // U je vyplnn - bu z DB nebo z draftu\n      }\n\n      const cisloSmlouvy = orderData.cislo_smlouvy?.trim();\n      if (!cisloSmlouvy) {\n        return null;\n      }\n      \n      // 2 NAST SEZNAM SMLUV PMO (eliminace zvislosti na state)\n      let currentSmlouvyList = [];\n      try {\n        const response = await getSmlouvyList({\n          token,\n          username,\n          show_inactive: false,\n          limit: 500\n        });\n        \n        if (response?.data && Array.isArray(response.data)) {\n          currentSmlouvyList = response.data;\n        }\n      } catch (loadError) {\n        return null;\n      }\n\n      // 3 NAJT SMLOUVU V SEZNAMU\n      const smlouva = currentSmlouvyList.find(s => \n        s.cislo_smlouvy === cisloSmlouvy || \n        s.evidencni_cislo === cisloSmlouvy\n      );\n\n      if (!smlouva) {\n        return null;\n      }\n\n      const icoZeSmlouvy = smlouva.ico?.trim();\n      if (!icoZeSmlouvy || icoZeSmlouvy.length < 8) {\n        // Smlouva nem IO nebo je neplatn - vrtme jen nzev\n        return {\n          dodavatel_nazev: smlouva.nazev_firmy || '',\n          dodavatel_ico: '',\n          source: 'smlouva-fallback'\n        };\n      }\n\n      // 4 HLEDAT V LOKLNM ADRESI (primrn zdroj)\n      try {\n        const localResult = await searchSupplierByIco({\n          token: token,\n          username: username,\n          ico: icoZeSmlouvy\n        });\n\n        if (localResult?.data && Array.isArray(localResult.data) && localResult.data.length > 0) {\n          const supplier = localResult.data[0];\n          return {\n            dodavatel_nazev: supplier.nazev || supplier.name || smlouva.nazev_firmy || '',\n            dodavatel_adresa: supplier.adresa || supplier.address || '',\n            dodavatel_ico: supplier.ico || icoZeSmlouvy,\n            dodavatel_dic: supplier.dic || '',\n            dodavatel_zastoupeny: supplier.zastoupeny || supplier.represented || '',\n            dodavatel_kontakt_jmeno: supplier.kontakt_jmeno || '',\n            dodavatel_kontakt_email: supplier.kontakt_email || supplier.email || '',\n            dodavatel_kontakt_telefon: supplier.kontakt_telefon || supplier.telefon || '',\n            source: 'local'\n          };\n        }\n      } catch (localError) {\n        // Error in local directory search\n      }\n\n      // 5 FALLBACK NA ARES\n      try {\n        const aresUrl = `https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/${icoZeSmlouvy}`;\n        const aresResponse = await fetch(aresUrl, {\n          method: 'GET',\n          headers: { 'Accept': 'application/json' }\n        });\n\n        if (aresResponse.ok) {\n          const aresData = await aresResponse.json();\n          return {\n            dodavatel_nazev: aresData.obchodniJmeno || smlouva.nazev_firmy || '',\n            dodavatel_adresa: aresData.sidlo?.textovaAdresa || '',\n            dodavatel_ico: aresData.ico || icoZeSmlouvy,\n            dodavatel_dic: aresData.dic || '',\n            dodavatel_zastoupeny: '',\n            dodavatel_kontakt_jmeno: '',\n            dodavatel_kontakt_email: '',\n            dodavatel_kontakt_telefon: '',\n            source: 'ares'\n          };\n        }\n      } catch (aresError) {\n        // Error in ARES query\n      }\n\n      // 6 FALLBACK NA DATA ZE SMLOUVY (pouze nzev a IO)\n      return {\n        dodavatel_nazev: smlouva.nazev_firmy || '',\n        dodavatel_ico: icoZeSmlouvy,\n        source: 'smlouva'\n      };\n\n    } catch (error) {\n      return null;\n    }\n  }, [token, username]);\n\n  //  FIX: Callback funkce pro useFormController - definovan a po vech state promnnch\n  const handleDataLoaded = useCallback(async (loadedData, sourceOrderId) => {\n      // Callback kdy jsou data natena z DB\n      // KRITICK: Nastavit formData s natenmi daty\n\n      //  DEBUG: RAW CEL OBJEDNVKY z backendu\n      // console.log(' RAW CEL OBJEDNVKA z DB:', loadedData);\n\n      //  OCHRANA: Zabrnit opakovanmu voln onDataLoaded PRO STEJNOU objednvku\n      //  FIX: Kontroluj souasn editOrderId, ne jen flag\n      const currentEditId = editOrderId || loadedData?.id || 'NEW';\n      if (onDataLoadedCalledRef.current === currentEditId) {\n        if (process.env.NODE_ENV === 'development') {\n          console.warn(' handleDataLoaded u byl zavoln pro:', currentEditId, '- ignoruji duplicitn voln');\n        }\n        return;\n      }\n\n      // KRITICK: Nastavit ochranu PED jakmikoliv async operacemi\n      onDataLoadedCalledRef.current = currentEditId;\n\n      //  DAL OCHRANA: Reset ochrany po 5 sekundch pro ppad e by dolo k chyb\n      setTimeout(() => {\n        if (onDataLoadedCalledRef.current === currentEditId) {\n          onDataLoadedCalledRef.current = null;\n        }\n      }, 5000);\n\n      //  FIX: Pro NOVOU objednvku okamit povolit autosave\n      // Nen poteba ekat na draft loading - form je ready hned\n      const isNewOrder = !editOrderId;\n      if (isNewOrder) {\n        setIsDraftLoaded(true); //  Povolit autosave OKAMIT pro nov objednvky\n        setIsInitialized(true); //  Oznait jako inicializovan aby se nespustil duplicitn effect\n      }\n\n      // NOTE: sourceOrderIdForUnlock removed - formData.id is used directly\n      // NOTE: formData.id removed - formData.id is single source of truth\n\n      // Nastavit edit mode pokud m loadedData ID\n      if (loadedData?.id) {\n        setIsEditMode(true);\n        //  PERSISTENCE: Ulo editOrderId do draftManager pro refresh\n        draftManager.saveMetadata({ editOrderId: String(loadedData.id) });\n      }\n\n      //  NEBO pokud je editOrderId v URL - OKAMIT nastavit editMode\n      if (editOrderId) {\n        setIsEditMode(true);\n        //  PERSISTENCE: Ulo editOrderId do draftManager pro refresh\n        draftManager.saveMetadata({ editOrderId: String(editOrderId) });\n      }\n\n      //  NOV: Nati draft PMO TADY bhem inicializace!\n      let finalData = loadedData || {};\n      const hasDbData = loadedData && Object.keys(loadedData).length > 0;\n\n      if (user_id) {\n        try {\n          draftManager.setCurrentUser(user_id);\n          const hasDraft = await draftManager.hasDraft();\n\n          if (hasDraft) {\n            const draftData = await draftManager.loadDraft();\n\n            if (draftData?.formData) {\n              //  KONTROLA: Pat draft k tto objednvce?\n              const draftOrderId = draftData.formData.id || draftData.formData?.id;\n              const currentOrderId = editOrderId || loadedData?.id;\n\n              //  Pokud draft m ID objednvky, JE TO EDITACE - nastav HNED!\n              if (draftOrderId) {\n                setIsEditMode(true);\n                // NOTE: formData.id removed - formData.id is single source of truth\n                //  PERSISTENCE: Ulo do draftManager pro refresh\n                draftManager.saveMetadata({ editOrderId: String(draftOrderId) });\n              }\n\n              //  Pokud je draft od JIN objednvky, IGNORUJ ho!\n              if (currentOrderId && draftOrderId && String(draftOrderId) !== String(currentOrderId)) {\n                // NEPOUVAT tento draft - pat k jin objednvce\n                console.warn(' Draft pat k jin objednvce, ignoruji:', { draftOrderId, currentOrderId });\n              } else if (hasDbData) {\n                //  Draft pat k TTO objednvce - pouij ho!\n                //  NOV LOGIKA: LocalStorage VDY m prioritu (obsahuje aktuln zmny uivatele)\n                // DB slou jen jako zklad pro systmov/immutable pole\n\n                finalData = {\n                  ...loadedData, // Nejdv DB (zkladn systmov data)\n                  ...draftData.formData, // Pak LS draft PEPE vechny user-editable fieldy\n                  \n                  //  IMMUTABLE systmov pole - VDY Z DB (nelze mnit)\n                  id: loadedData.id,\n                  ev_cislo: loadedData.ev_cislo || loadedData.cislo_objednavky,\n                  cislo_objednavky: loadedData.cislo_objednavky,\n                  datum_vytvoreni: loadedData.datum_vytvoreni,\n                  datum_posledni_zmeny: loadedData.datum_posledni_zmeny,\n                  \n                  //  FAKTURY: Preferovat draft faktury (obsahuj lokln zmny), fallback na DB\n                  faktury: (draftData.formData.faktury && draftData.formData.faktury.length > 0) \n                    ? draftData.formData.faktury \n                    : (loadedData.faktury || [])\n                };\n              } else {\n                // NEW: Pouij draft\n                finalData = draftData.formData;\n              }\n            }\n          }\n        } catch (error) {\n          console.error(' Chyba pi natn draftu:', error);\n        }\n      }\n\n      //  AUTOMATICK DOPLNN DODAVATELE ZE SMLOUVY\n      // Pokud je fze 3+, financovn = Smlouva a dodavatel przdn, zkusit doplnit\n      let wasAutoFilled = false;\n      if (Object.keys(finalData).length > 0) {\n        const currentPhase = getWorkflowPhase(finalData.stav_workflow_kod);\n        \n        try {\n          const supplierFromContract = await autoFillSupplierFromContract(finalData, currentPhase);\n          \n          if (supplierFromContract) {\n            // Slouit dodavatelsk data do finalData\n            finalData = {\n              ...finalData,\n              ...supplierFromContract\n            };\n            \n            // Nastavit zdroj pro zobrazen v labelu\n            setSupplierAutoFillSource(supplierFromContract.source);\n            \n            wasAutoFilled = true;\n          }\n        } catch (error) {\n        }\n      }\n\n      // Nastavit finln data (pokud nen przdn)\n      if (Object.keys(finalData).length > 0) {\n        setFormData(finalData);\n\n        //  EXTRAHOVAT LP OPTIONS z enriched order response\n        // LP options jsou v loadedData.financovani.lp_nazvy (ne v lp_options!)\n        \n        // Extrahuj LP z financovani.lp_nazvy (primrn zdroj pro poloky)\n        if (loadedData?.financovani?.lp_nazvy && Array.isArray(loadedData.financovani.lp_nazvy)) {\n          const lpOptions = loadedData.financovani.lp_nazvy\n            .map(lp => ({\n              id: lp.id,\n              kod: lp.cislo_lp || lp.kod || `LP${lp.id}`,\n              nazev: lp.nazev || 'Bez nzvu',\n              kategorie: lp.kategorie,\n              limit: lp.limit || lp.celkovy_limit,\n              cerpano: lp.cerpano || lp.skutecne_cerpano,\n              zbyva: lp.zbyva || lp.zbyva_skutecne,\n              rok: lp.rok,\n              label: `${lp.cislo_lp || lp.kod || `LP${lp.id}`} - ${lp.nazev || 'Bez nzvu'}`\n            }))\n            .sort((a, b) => a.nazev.localeCompare(b.nazev, 'cs'));\n          \n          setLpOptionsForItems(lpOptions);\n        } else if (finalData.lp_kod && Array.isArray(finalData.lp_kod) && finalData.lp_kod.length > 0) {\n          //  FALLBACK: Objednvka m LP financovn, ale chyb lp_nazvy data - nati z API\n          \n          try {\n            //  KROK 1: Pokud lpKodyOptions nen dostupn, nati vechny LP\n            let lpMappingData = lpKodyOptions || [];\n            if (!lpKodyOptions || lpKodyOptions.length === 0) {\n              try {\n                lpMappingData = await fetchLimitovanePrisliby({ token, username });\n              } catch (err) {\n                console.error(' Chyba natn LP mapovn:', err);\n                lpMappingData = [];\n              }\n            }\n            \n            //  KROK 2: Nati detaily pro kad LP (peve ID  KD)\n            const lpDetails = await Promise.all(\n              finalData.lp_kod.map(async (lpValue) => {\n                // Deklarujeme promnn na rovni map callbacku, aby byly dostupn i v catch\n                let lpKod = lpValue;\n                const originalValue = lpValue;\n                \n                try {\n                  //  lpValue me bt ID (number/string-number) nebo KD (string)\n                  // Pokud je to slo, najdi KD z lpMappingData, jinak pouij pmo\n                  \n                  if (lpMappingData && lpMappingData.length > 0) {\n                    // Zkus najt podle ID nebo KD\n                    const lpOption = lpMappingData.find(opt => \n                      opt.id === lpValue || \n                      opt.id === Number(lpValue) ||\n                      opt.kod === lpValue ||\n                      opt.cislo_lp === lpValue\n                    );\n                    \n                    if (lpOption) {\n                      lpKod = lpOption.cislo_lp || lpOption.kod || lpValue;\n                    } else {\n                      console.warn(` LP ${lpValue} nebylo nalezeno v LP mapovn (${lpMappingData.length} zznam)`);\n                      // Zkusme pout hodnotu pmo - mon je to u KD\n                    }\n                  } else {\n                    console.warn(' LP mapovn nen dostupn, zkusm hodnotu pmo:', lpValue);\n                  }\n                  \n                  const lpDetail = await fetchLPDetail({ token, username, cislo_lp: lpKod });\n                  //  Zkontroluj, jestli API vrtilo platn data\n                  if (!lpDetail || !lpDetail.id) {\n                    console.warn(` LP ${lpKod} (ID: ${originalValue}) nebylo nalezeno nebo nem platn data`);\n                    return null;\n                  }\n                  return {\n                    id: lpDetail.id,\n                    kod: lpDetail.cislo_lp || lpDetail.kod || `LP${lpDetail.id}`,\n                    nazev: lpDetail.nazev_uctu || lpDetail.nazev || 'Bez nzvu',\n                    kategorie: lpDetail.kategorie,\n                    limit: lpDetail.celkovy_limit || 0,\n                    cerpano: lpDetail.skutecne_cerpano || 0,\n                    zbyva: lpDetail.zbyva_skutecne || 0,\n                    rok: lpDetail.rok,\n                    label: `${lpDetail.cislo_lp || lpDetail.kod || `LP${lpDetail.id}`} - ${lpDetail.nazev_uctu || lpDetail.nazev || 'Bez nzvu'}`\n                  };\n                } catch (err) {\n                  console.error(` Chyba natn LP ${lpKod} (ID: ${originalValue}):`, err);\n                  return null;\n                }\n              })\n            );\n            const validLpOptions = lpDetails.filter(lp => lp !== null).sort((a, b) => a.nazev.localeCompare(b.nazev, 'cs'));\n            setLpOptionsForItems(validLpOptions);\n          } catch (err) {\n            console.error(' Chyba pi natn LP z API:', err);\n            setLpOptionsForItems([]);\n          }\n        } else {\n          // Nen LP financovn\n          setLpOptionsForItems([]);\n        }\n\n        //  ULOIT SNAPSHOT pvodnho stavu pro detekci zmn\n        if (finalData.id) {\n          originalFormDataRef.current = JSON.parse(JSON.stringify(finalData));\n        }\n\n        //  ULOIT DRAFT po autoFill (aby se zmny zachovaly pi F5)\n        if (wasAutoFilled && editOrderId && draftManager) {\n          try {\n            draftManager.setCurrentUser(user_id);\n            await draftManager.saveDraft(finalData, {\n              orderId: parseInt(editOrderId)\n            });\n          } catch (draftError) {\n            // Nepodailo se uloit draft\n          }\n        }\n\n        //  KRITICK: Pokud m ev_cislo, nastavit ref aby se u neptalo na next-number!\n        if (finalData.ev_cislo && finalData.ev_cislo !== 'Natm...') {\n          if (window.__orderForm_hasLoadedNextNumberRef) {\n            window.__orderForm_hasLoadedNextNumberRef.current = true;\n          }\n        }\n\n        //  Nastavit isInitialized flag aby se zabrnilo duplicitnmu natn\n        setIsInitialized(true);\n      }\n\n      //  Pro EDIT mode: Oznait e inicializace je hotov a tady (po naten draftu)\n      // Pro NEW order u je isDraftLoaded=true nastaveno ve\n      if (!isNewOrder) {\n        if (process.env.NODE_ENV === 'development') {\n        }\n        setIsDraftLoaded(true);\n        \n        //  KRITICK: Povolit autosave i pro EDIT mode!\n        draftManager.setAutosaveEnabled(true, 'EDIT order initialization');\n        \n        //  KRITICK: Poslat broadcast MenuBaru - EDIT MODE JE READY!\n        broadcastOrderState({\n          isEditMode: true,\n          isNewOrder: false,\n          orderId: finalData.id || editOrderId,\n          orderNumber: finalData.cislo_objednavky || finalData.ev_cislo || ''\n        });\n      }\n  }, [editOrderId, user_id, draftManager, setFormData, setIsEditMode, setIsDraftLoaded, setIsInitialized, autoFillSupplierFromContract, setSupplierAutoFillSource, broadcastOrderState]);\n\n  //  HELPER FUNKCE PRO FORMTOVAN TOASTY\n  // Vytv jednotn vzhled pro vechny toast zprvy s ikonami a barvami\n  const formatToastMessage = useCallback((message, type = 'info') => {\n    const styles = {\n      error: {\n        bg: '#fff1f0',\n        color: '#d32f2f',\n        icon: <AlertCircle size={18} color=\"#ff4d4f\" />,\n      },\n      success: {\n        bg: '#f0f9ff',\n        color: '#0d7d3e',\n        icon: <CheckCircle2 size={18} color=\"#10b981\" />,\n      },\n      warning: {\n        bg: '#fff7e6',\n        color: '#d46b08',\n        icon: <AlertTriangle size={18} color=\"#f59e0b\" />,\n      },\n      info: {\n        bg: '#f5f5f5',\n        color: '#4b5563',\n        icon: <InfoIcon size={18} color=\"#6b7280\" />,\n      }\n    };\n\n    const style = styles[type] || styles.info;\n\n    return (\n      <div style={{ \n        display: 'flex', \n        alignItems: 'flex-start', \n        gap: '10px',\n        padding: '4px',\n        fontFamily: 'system-ui, -apple-system, sans-serif'\n      }}>\n        <div style={{ flexShrink: 0, marginTop: '2px' }}>\n          {style.icon}\n        </div>\n        <div style={{ \n          flex: 1,\n          fontSize: '14px',\n          lineHeight: '1.5',\n          color: style.color\n        }}>\n          {message}\n        </div>\n      </div>\n    );\n  }, []);\n\n  // Ostatn callback funkce pro formController\n  const handleError = useCallback((error) => {\n    // Callback pi chyb inicializace\n    showToast?.(formatToastMessage(`Nepodailo se nast formul: ${error.message}`, 'error'), { type: 'error' });\n  }, [formatToastMessage]); //  FIX: Remove showToast dependency to prevent infinite loop\n\n  const handleReady = useCallback(() => {\n    // Formul ready - meme dodaten inicializovat UI\n\n    //  ZRUENO: Auto-scroll po naten formule (na dost uivatele)\n  }, []);\n\n  // Tento hook d celou inicializaci formule a eliminuje race conditions\n  const formController = useFormController({\n    token,\n    username,\n    userId: user_id,\n    editOrderId,\n    archivovanoParam,\n    onDataLoaded: handleDataLoaded,\n    onError: handleError,\n    onReady: handleReady\n  });\n\n  // Rozbalen formController pro snadnj pstup\n  const { lifecycle, dictionaries, orderDataLoader, ui } = formController;\n\n  //  REFACTORED: selnky a jejich loading states nyn z formController\n  // Aliasy pro zachovn zptn kompatibility se stvajcm kdem\n  const allUsers = dictionaries.data?.allUsers || [];\n  const approversBase = dictionaries.data?.approvers || [];\n  const strediskaOptions = dictionaries.data?.strediskaOptions || [];\n  const financovaniOptions = dictionaries.data?.financovaniOptions || [];\n  const druhyObjednavkyOptions = dictionaries.data?.druhyObjednavkyOptions || [];\n  const druhyObjednavkyRawData = dictionaries.data?.druhyObjednavkyRawData || null;\n  const lpKodyOptions = dictionaries.data?.lpKodyOptions || [];\n  const prilohyTypyOptions = dictionaries.data?.prilohyTypyOptions || [];\n  const typyFakturOptions = dictionaries.data?.typyFakturOptions || []; // Typy faktur z reduceru\n  const stavyWorkflowMap = dictionaries.data?.stavyWorkflowMap || {}; //  Mapa workflow stav z DB selnku\n\n  //  Memoizovan hodnota: Je druh objednvky majetek (atribut_objektu = 1)?\n  const isMaterialOrder = React.useMemo(() => {\n    if (!formData.druh_objednavky_kod) return false;\n    \n    const druhObj = druhyObjednavkyOptions.find(opt =>\n      (opt.kod_stavu && opt.kod_stavu === formData.druh_objednavky_kod) ||\n      (opt.kod && opt.kod === formData.druh_objednavky_kod) ||\n      (opt.value && opt.value === formData.druh_objednavky_kod)\n    );\n    \n    // Kontrola atribut_objektu = 1 (majetek)\n    return druhObj?.atribut_objektu === 1;\n  }, [formData.druh_objednavky_kod, druhyObjednavkyOptions]);\n\n  //  Helper: Formtovn chybovch hlek do strukturovan podoby\n  const formatValidationErrors = React.useCallback((errors) => {\n    if (!errors || Object.keys(errors).length === 0) return null;\n\n    console.log(' formatValidationErrors - vstup:', {\n      errorKeys: Object.keys(errors),\n      errorCount: Object.keys(errors).length,\n      errors\n    });\n\n    //  SJEDNOCENO S FloatingNavigator.categorizeErrorKey() - MUS BT 100% STEJN!\n    // Kategorizace chyb podle sekc NAVIGTORU (odpovd FloatingNavigator.js sekce IDs)\n    const categories = {\n      objednatel: { label: 'Informace o objednateli', errors: [] },\n      schvaleni: { label: 'Schvlen nkupu PO', errors: [] },\n      dodavatel: { label: 'Dodavatel', errors: [] },\n      detaily: { label: 'Detaily objednvky', errors: [] },\n      stav_odeslani: { label: 'Odesln objednvky', errors: [] },\n      potvrzeni_objednavky: { label: 'Potvrzen objednvky dodavatelem', errors: [] },\n      fakturace: { label: 'Fakturace', errors: [] },\n      vecna_spravnost: { label: 'Vcn sprvnost', errors: [] },\n      registr_smluv_vyplneni: { label: 'Registr smluv', errors: [] },\n      ostatni: { label: 'Ostatn', errors: [] }\n    };\n\n    Object.entries(errors).forEach(([key, message]) => {\n      // Vytvo lidsky itelnou zprvu (odstra technick prefixy)\n      let cleanMessage = message;\n      \n      //  KRITICK: Detekce kategorie MUS bt IDENTICK s FloatingNavigator.categorizeErrorKey()\n      // POAD JE DLEIT - specifitj podmnky mus bt PED obecnjmi!\n      \n      // 1. Informace o objednateli (vetn garanta!)\n      if (key.includes('jmeno') || key.includes('email') || key.includes('ev_cislo') || key.includes('garant')) {\n        categories.objednatel.errors.push(cleanMessage);\n      }\n      // 2. Schvlen nkupu PO (FZE 1-2) - vetn FINANCOVN!\n      else if (key.includes('prikazce') || key.includes('max_cena') || \n               key.includes('strediska') || key.includes('predmet') ||\n               key.includes('financovani') || key.includes('lp_kod') || key.includes('cislo_smlouvy') ||\n               key.includes('individualni_schvaleni') || key.includes('pojistna_udalost')) {\n        categories.schvaleni.errors.push(cleanMessage);\n      }\n      // 3. Detaily objednvky (FZE 3+: poloky + druh + lokalizace) - MUS BT PED dodavatelem!\n      else if (key.startsWith('polozka_') || key.includes('druh_objednavky') || message.includes('Poloka')) {\n        categories.detaily.errors.push(cleanMessage);\n      }\n      // 4. Potvrzen objednvky dodavatelem - MUS BT PED \"dodavatel\" (kvli dodavatel_zpusob_potvrzeni)\n      else if (key.includes('zpusob_potvrzeni') || key.includes('dt_akceptace') || key.includes('zpusob_platby')) {\n        categories.potvrzeni_objednavky.errors.push(cleanMessage);\n      }\n      // 5. Dodavatel - MUS BT PO potvrzen (kvli dodavatel_zpusob_potvrzeni)\n      else if (key.includes('dodavatel') || key.includes('ico') || key.includes('adresa') || key.includes('kontakt')) {\n        categories.dodavatel.errors.push(cleanMessage);\n      }\n      // 6. Odesln objednvky\n      else if (key.includes('datum_odeslani') || key.includes('stav_odeslani')) {\n        categories.stav_odeslani.errors.push(cleanMessage);\n      }\n      // 7. Vcn sprvnost - MUS BT PED obecnm \"faktura_\"\n      else if (key.startsWith('faktura_') && key.includes('vecna_spravnost')) {\n        categories.vecna_spravnost.errors.push(cleanMessage);\n      }\n      // 8. Fakturace\n      else if (key.startsWith('faktura_')) {\n        categories.fakturace.errors.push(cleanMessage);\n      }\n      // 9. Registr smluv\n      else if (key.includes('dt_zverejneni') || key.includes('registr') || key.includes('ma_byt_zverejnena')) {\n        categories.registr_smluv_vyplneni.errors.push(cleanMessage);\n      }\n      // 10. Ostatn (fallback)\n      else {\n        categories.ostatni.errors.push(cleanMessage);\n      }\n    });\n\n    // Sestaven strukturovan zprvy - pouze neprzdn kategorie\n    return (\n      <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n        <div style={{ \n          fontSize: '15px', \n          fontWeight: '600', \n          marginBottom: '12px', \n          color: '#1a1a1a',\n          display: 'flex',\n          alignItems: 'center',\n          gap: '8px'\n        }}>\n          <AlertCircle size={20} color=\"#ff4d4f\" style={{ flexShrink: 0 }} />\n          <span>Pro uloen je nutn vyplnit nsledujc poloky:</span>\n        </div>\n        {Object.values(categories).map((cat, idx) => \n          cat.errors.length > 0 && (\n            <div key={idx} style={{ \n              marginBottom: '10px',\n              padding: '10px',\n              backgroundColor: '#fff1f0',\n              borderRadius: '4px'\n            }}>\n              <div style={{ \n                fontWeight: '600', \n                fontSize: '13px',\n                color: '#d32f2f',\n                marginBottom: '6px'\n              }}>\n                {cat.label}\n              </div>\n              {cat.errors.map((err, errIdx) => (\n                <div key={errIdx} style={{ \n                  fontSize: '12px',\n                  color: '#666',\n                  marginLeft: '8px',\n                  marginTop: '4px',\n                  display: 'flex',\n                  alignItems: 'flex-start'\n                }}>\n                  <span style={{ marginRight: '6px', color: '#ff4d4f', fontWeight: 'bold' }}></span>\n                  <span>{err}</span>\n                </div>\n              ))}\n            </div>\n          )\n        )}\n      </div>\n    );\n  }, []);\n\n  //  Kombinovan options pro dodaten dokumenty (PRILOHA_TYP + FAKTURA_TYP)\n  //  OPRAVA: Deduplikace podle value, aby nedolo k duplicitnm klm v React\n  const dodatecneDokladyOptions = React.useMemo(() => {\n    const combined = [...prilohyTypyOptions, ...typyFakturOptions];\n    const uniqueMap = new Map();\n\n    // Deduplikace - pokud je duplicitn value, ponechme prvn vskyt\n    combined.forEach(opt => {\n      if (!uniqueMap.has(opt.value)) {\n        uniqueMap.set(opt.value, opt);\n      }\n    });\n\n    return Array.from(uniqueMap.values());\n  }, [prilohyTypyOptions, typyFakturOptions]);\n\n  //  REFACTORED: areDictionariesReady nyn z formController.dictionaries.isReady\n  const areDictionariesReady = dictionaries.isReady;\n\n  //  State pro garant dropdown options (active users + inactive garant if editing)\n  // Inicializuj HNED s aktivnmi uivateli pokud jsou k dispozici\n  const [garantOptions, setGarantOptions] = useState(() => {\n    const activeUsers = allUsers.filter(u => u.aktivni === 1 || u.aktivni === '1' || u.active === 1 || u.active === '1');\n    return activeUsers;\n  });\n\n  //  SYSTEM uivatel - pid se JEN kdy m objednvka prikazce_id nebo schvalovatel_id = '0'\n  // Pouv se POUZE u archivovanch objednvek\n  const approvers = useMemo(() => {\n    const needsSystemUser = formData.prikazce_id === '0' || formData.schvalovatel_id === '0';\n\n    if (!needsSystemUser) {\n      return approversBase; // Bn objednvky - bez SYSTEM\n    }\n\n    // Archivovan objednvka s SYSTEM uivatelem\n    return [\n      {\n        id: '0',\n        jmeno: 'SYSTEM',\n        prijmeni: '',\n        displayName: 'SYSTEM',\n        aktivni: 1,\n        deaktivovan: 0\n      },\n      ...approversBase\n    ];\n  }, [approversBase, formData.prikazce_id, formData.schvalovatel_id]);\n\n  // Pejmenovn pro zptnou kompatibilitu (rzn sti kdu pouvaj rzn nzvy)\n  const fakturaTypyPrilohOptions = typyFakturOptions; // Alias\n  const loadingFakturaTypyPriloh = false; // selnky u jsou naten kdy se formul zobrazuje\n\n  //  CRITICAL FIX: Reset a povolit autosave pi zmn editOrderId\n  useEffect(() => {\n    const isNewOrder = !editOrderId;\n    \n    //  FIX: RESET isDraftLoaded pi zmn editOrderId (pepnut mezi objednvkami)\n    setIsDraftLoaded(false);\n    \n    if (isNewOrder && user_id) {\n      setIsDraftLoaded(true);\n\n      //  KRITICK: Povolit autosave v DraftManageru!\n      draftManager.setAutosaveEnabled(true, 'NEW order initialization');\n    } else {\n    }\n  }, [editOrderId, user_id]); // Spust se pi zmn editOrderId\n\n  // Automatick rozbalen lokalizanch panel s vyplnnmi hodnotami\n  // VDY rozbalit pokud:\n  // 1. Je to majetkov poloka (atribut_objektu = 1)  POVINN lokalizace\n  // 2. M vyplnn lokalizan data (sek, budova, mstnost, poznmka)\n  useEffect(() => {\n    if (formData.polozky_objednavky && Array.isArray(formData.polozky_objednavky)) {\n      const newPanelStates = {};\n      \n      // Zkontroluj, jestli druh objednvky m atribut_objektu = 1 (majetek)\n      const isMaterialOrderValue = isMaterialOrder;\n      \n      formData.polozky_objednavky.forEach(polozka => {\n        // Zkontroluj, zda m poloka vyplnn lokalizan data\n        const hasLocationData =\n          (polozka.usek_kod && polozka.usek_kod.trim() !== '') ||\n          (polozka.budova_kod && polozka.budova_kod.trim() !== '') ||\n          (polozka.mistnost_kod && polozka.mistnost_kod.trim() !== '') ||\n          (polozka.poznamka && polozka.poznamka.trim() !== '');\n\n        //  ROZBALIT pokud:\n        // - Je to majetek (lokalizace je POVINN)  mus bt vidt erven rmeky pi validaci\n        // - M vyplnn data (aby uivatel vidl co u vyplnil)\n        // \n        // DLEIT: Panel se rozbal pi:\n        // - Naten objednvky s majetkovmi polokami (i kdy lokalizace nen vyplnn)\n        // - Naten objednvky s vyplnnmi lokalizanmi daty\n        // - Zmn druhu objednvky na majetek\n        if (isMaterialOrderValue || hasLocationData) {\n          newPanelStates[polozka.id] = true;\n        } else {\n          // Zavt pouze pokud NEN majetek A NEM data\n          newPanelStates[polozka.id] = false;\n        }\n      });\n\n      // Nastav VDY - aby se panely mohly otevt i zavt pi zmn stavu\n      setLokalizacePanelStates(newPanelStates);\n    }\n  }, [\n    formData.polozky_objednavky?.length, \n    formData.druh_objednavky_kod, \n    isMaterialOrder,\n    //  KRITICK: Sledovat i zmny v lokalizanch datech poloek\n    // Kdy se nate objednvka z DB, mus se panely rozbalit\n    JSON.stringify(formData.polozky_objednavky?.map(p => ({\n      id: p.id,\n      usek: p.usek_kod,\n      budova: p.budova_kod,\n      mistnost: p.mistnost_kod,\n      poznamka: p.poznamka\n    })))\n  ])\n\n  // Synchronizace smlouvaSearchTerm s formData.cislo_smlouvy pi naten dat\n  useEffect(() => {\n    if (formData.cislo_smlouvy && formData.cislo_smlouvy !== smlouvaSearchTerm) {\n      setSmlouvaSearchTerm(formData.cislo_smlouvy);\n    }\n  }, [formData.cislo_smlouvy, smlouvaSearchTerm]);\n\n  // JEDNODUCH WORKFLOW - pmo z DB stavu bez mapovn\n  const [isConceptSaved, setIsConceptSaved] = useState(false); // Pouze localStorage koncept\n  const [isPhase1Unlocked, setIsPhase1Unlocked] = useState(false); // Stav pro odemknut FZE 1\n\n  //  Cleanup pi unmount - uloit draft ped unmount\n  useEffect(() => {\n    // dn logika tady - jen cleanup funkce\n    return () => {\n      // Cleanup POUZE pi unmount komponenty\n      //  POZOR: Pouij REF pro pstup k aktulnm hodnotm - dependencies mus bt przdn!\n\n      //  KRITICK: Uloit draft ped unmount (i kdy autosave jet neprobhlo)\n      // Scn: User zmn pole  navigace pry bhem 3s delay  bez tohoto by se draft neukldal\n      if (isDraftLoaded && user_id && formData) {\n        //  OCHRANA: Ukldat POUZE pokud m formData smyslupln obsah\n        // Minimln 40 kl (przdn formData m ~78 kl)\n        const formDataKeys = Object.keys(formData);\n        const hasSignificantData = formDataKeys.length >= 40;\n\n        if (!hasSignificantData) {\n          return;\n        }\n\n        try {\n          //  ZRUENO: Ukldn scroll pozice ped unmount (na dost uivatele)\n          // const scrollContainer = scrollableContentRef.current;\n          // const scrollPosition = scrollContainer ? scrollContainer.scrollTop : (window.pageYOffset || document.documentElement.scrollTop);\n\n          //  Nastavit current user ped ukldnm\n          draftManager.setCurrentUser(user_id);\n\n          //  Sprvn API: saveDraft(formData, options)\n          draftManager.saveDraft(formData, {\n            orderId: formData.id || null\n          });\n\n          //  ZRUENO: Ukldn scroll pozice\n          // draftManager.saveMetadata({ scrollPosition });\n        } catch (error) {\n        }\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []); //  PRZDN dependencies - spust se JEN pi mount/unmount!\n\n  //  CENTRLN NATN DRAFTU pi obnoven strnky (F5)\n  // Tento useEffect se spust kdy isDraftLoaded=true a nen editOrderId v URL\n  useEffect(() => {\n    // Ochrana: Nast draft pouze pokud:\n    // 1. user_id existuje\n    // 2. isDraftLoaded=true (inicializace dokonena)\n    // 3. NEN editOrderId (editace se e v handleDataLoaded)\n    if (!user_id || !isDraftLoaded || editOrderId) {\n      return;\n    }\n\n    let isActive = true;\n\n    const loadDraftData = async () => {\n      try {\n        draftManager.setCurrentUser(user_id);\n\n        // Kontrola existence draftu\n        const hasDraft = await draftManager.hasDraft();\n\n        if (!hasDraft) {\n          return;\n        }\n\n        // Nati draft\n        const draftData = await draftManager.loadDraft();\n\n        if (!draftData?.formData || !isActive) {\n          return;\n        }\n\n        //  DB SYNC CHECK - pouze pro EDIT mode\n        if (draftData.formData.id) {\n\n          const syncCheck = await draftManager.checkDBSync(\n            async (orderId) => {\n              try {\n                return await getOrderTimestampV2(orderId, token, username);\n              } catch (error) {\n                return null;\n              }\n            },\n            async (orderId) => {\n              try {\n                const response = await getOrderV2(orderId, token, username);\n                return response?.data || null;\n              } catch (error) {\n                //  HIERARCHIE: Pokud backend vrtil 403, nemme prvo\n                if (error?.status === 403 || error?.response?.status === 403) {\n                  console.warn(' HIERARCHY: Pstup k objednvce zamtnut hierarchi');\n                }\n                return null;\n              }\n            }\n          );\n\n          if (!isActive) return;\n\n          if (syncCheck.needsSync && syncCheck.dbData) {\n            //  OCHRANA: Zachovat existujc poloky pokud DB data je nem\n            const mergedData = { ...syncCheck.dbData };\n            if (!mergedData.polozky_objednavky || mergedData.polozky_objednavky.length === 0) {\n              if (formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n                mergedData.polozky_objednavky = formData.polozky_objednavky;\n                // DEBUG: Local items protection - logging removed\n              }\n            }\n\n            setFormData(mergedData);\n            setIsChanged(false);\n            setIsEditMode(true);\n            //  KRITICK: Poslat broadcast po DB sync\n            broadcastOrderState({\n              isEditMode: true,\n              isNewOrder: false,\n              orderId: syncCheck.dbData.id,\n              orderNumber: syncCheck.dbData.cislo_objednavky || syncCheck.dbData.ev_cislo\n            });\n            await draftManager.syncWithDatabase(syncCheck.dbData, syncCheck.dbData.id);\n            return;\n          }\n        }\n\n        //  Aplikuj draft data\n\n        //  VYISTIT objekty ve fa_strediska_kod (pokud tam jsou)\n        const cleanedDraftData = { ...draftData.formData };\n\n        if (cleanedDraftData.faktury && Array.isArray(cleanedDraftData.faktury)) {\n          cleanedDraftData.faktury = cleanedDraftData.faktury.map(faktura => {\n            if (faktura.fa_strediska_kod && Array.isArray(faktura.fa_strediska_kod)) {\n              // Extrahovat jen stringy z objekt\n              faktura.fa_strediska_kod = faktura.fa_strediska_kod.map(item => {\n                if (typeof item === 'string') return item;\n                return item.value || item.kod_stavu || item.id || item;\n              });\n            }\n            return faktura;\n          });\n        }\n\n        setFormData(prev => ({\n          ...prev,  //  KRITICK: Zachovat vechny vchoz hodnoty (78 kl)\n          ...cleanedDraftData,  //  Pepsat jen zmnn hodnoty z draftu (VYITN!)\n          id: prev?.id || draftData.formData.id,\n          datum_posledni_zmeny: prev?.datum_posledni_zmeny || draftData.formData.datum_posledni_zmeny,\n          //  FIX: Zachovat stav_schvaleni a strediska_kod z prev pokud draft neobsahuje validn hodnoty\n          // prev obsahuje u SPRVN TRANSFORMOVAN data z useOrderDataLoader\n          stav_schvaleni: cleanedDraftData.stav_schvaleni || prev?.stav_schvaleni || '',\n          strediska_kod: (cleanedDraftData.strediska_kod && Array.isArray(cleanedDraftData.strediska_kod) && cleanedDraftData.strediska_kod.length > 0)\n            ? cleanedDraftData.strediska_kod\n            : (prev?.strediska_kod || []),\n          //  FIX: dodavatel_zpusob_potvrzeni - pout draft JEN pokud m NEPRZDN zpusoby\n          // Pokud je pole przdn, zachovat hodnotu z DB (prev)\n          dodavatel_zpusob_potvrzeni: (cleanedDraftData.dodavatel_zpusob_potvrzeni?.zpusoby?.length > 0)\n            ? cleanedDraftData.dodavatel_zpusob_potvrzeni\n            : (prev?.dodavatel_zpusob_potvrzeni || cleanedDraftData.dodavatel_zpusob_potvrzeni)\n        }));\n\n        setIsChanged(draftData.isChanged === true);\n\n        if (draftData.formData.id || draftData.formData?.id) {\n          setIsEditMode(true);\n          //  KRITICK: Poslat broadcast po naten draftu s editId\n          broadcastOrderState({\n            isEditMode: true,\n            isNewOrder: false,\n            orderId: draftData.formData.id,\n            orderNumber: draftData.formData.cislo_objednavky || draftData.formData.ev_cislo\n          });\n        }\n\n      } catch (error) {\n      }\n    };\n\n    loadDraftData();\n\n    return () => {\n      isActive = false;\n    };\n  }, [user_id, isDraftLoaded, editOrderId]); //  Spust se kdy isDraftLoaded=true a nen editOrderId\n\n  // Flag pro kontrolu odesln u nen poteba - odvozuje se pmo z DB stavu\n\n  // Vechno odvozen pmo z formData.stav_workflow_kod (DB stav) - useMemo optimalizace\n  const isOrderSavedToDB = useMemo(() => !!formData.id, [formData.id]);\n  const isApprovedOrder = useMemo(() => {\n    const states = Array.isArray(formData.stav_workflow_kod) ? formData.stav_workflow_kod : parseWorkflowStates(formData.stav_workflow_kod);\n    return states.includes('SCHVALENA');\n  }, [formData.stav_workflow_kod]);\n\n  const sectionVisibility = getSectionVisibility(mainWorkflowState, currentPhase, isArchived);\n\n  // Mapovn sekc na jejich pevn barvy podle typu\n  const getSectionTheme = (sectionName) => {\n    const sectionColorMap = {\n      // ED sekce (zkladn info)\n      'objednatel': 'section-grey',\n      'schvaleni': 'section-grey',\n\n      // ORANOV sekce (pprava objednvky)\n      'financovani': 'section-orange',\n      'dodavatel': 'section-orange',\n      'detaily': 'section-orange',\n      'dodaci_podminky': 'section-orange',\n      'stav_odeslani': 'section-orange',\n\n      // ERVEN sekce (plohy - mimo workflow)\n      'prilohy': 'section-red',\n\n      // MODR sekce (potvrzen a realizace)\n      'potvrzeni_objednavky': 'section-blue',\n      'registr_smluv': 'section-blue',\n      'prubeh_objednavky': 'section-blue',\n      'dodaci_informace': 'section-blue',\n      'fakturace': 'section-blue',\n      'storno_detail': 'section-blue',\n\n      // FIALOV sekce (registr - potvrzen zveejnn)\n      'registr_smluv_vyplneni': 'section-purple'\n    };\n\n    return sectionColorMap[sectionName] || 'section-orange'; // default oranov\n  };\n\n  //  FIX: Define canEditPhase2 before isSectionActive uses it\n  const canEditPhase2 = hasPermission && (hasPermission('ORDER_MANAGE') || hasPermission('ORDER_APPROVE') || hasPermission('ORDER_EDIT_OWN') || hasPermission('ORDER_EDIT_ALL')); // Pro odemykn FZE 2\n\n  // Uren, zda je sekce aktivn podle aktuln fze\n  const isSectionActive = useCallback((sectionName) => {\n    const phase = currentPhase; //  Use pre-calculated currentPhase instead of getCurrentPhase()\n\n    // FZE 1: Zkladn info sekce jsou vdy aktivn + financovn a detaily pro uivatele s oprvnnm\n    if (phase === 1) {\n      const basicSections = ['objednatel', 'schvaleni'];\n      const phase2SectionsForAuthorizedUsers = ['financovani', 'detaily'];\n\n      // Zkladn sekce jsou vdy aktivn ve FZI 1\n      if (basicSections.includes(sectionName)) {\n        return true;\n      }\n\n      // Pokud m uivatel oprvnn k editaci objednvek, povol tak klov sekce FZE 2\n      if (canEditPhase2 && phase2SectionsForAuthorizedUsers.includes(sectionName)) {\n        return true;\n      }\n\n      return false;\n    }\n\n    // FZE 2: Pprava objednvky - oranov sekce aktivn\n    if (phase === 2) {\n      return ['financovani', 'dodavatel', 'detaily', 'dodaci_podminky', 'prilohy', 'stav_odeslani'].includes(sectionName);\n    }\n\n    // FZE 3+: Potvrzen a realizace - modr sekce aktivn\n    if (phase >= 3) {\n      return ['potvrzeni_objednavky', 'registr_smluv', 'prubeh_objednavky', 'dodaci_informace', 'fakturace', 'storno_detail'].includes(sectionName);\n    }\n\n    return false; // Default neaktivn\n  }, [currentPhase, canEditPhase2]); //  Add dependencies for useCallback\n\n  // Kontrola oprvnn pro schvalovn objednvek\n  const canApproveOrders = hasPermission && hasPermission('ORDER_APPROVE');\n  const canManageOrders = hasPermission && hasPermission('ORDER_MANAGE');\n  const canManageUsers = hasPermission && hasPermission('USER_MANAGE'); // Pro prci s kontakty\n  const canEditPhase3 = hasPermission && (hasPermission('ORDER_MANAGE') || hasPermission('ORDER_EDIT_OWN') || hasPermission('ORDER_EDIT_ALL')); // Pro odemykn FZE 3\n  const canEditApprovedSections = canApproveOrders || canManageOrders;\n  const canPublishRegistry = hasPermission && hasPermission('ORDER_PUBLISH_REGISTRY'); //  Pro editaci pol registru smluv\n  const canManageInvoices = hasPermission && hasPermission('INVOICE_MANAGE'); //  Pro editaci faktur ve Fzi 7\n  const canSaveOrder = hasPermission && (hasPermission('ORDER_MANAGE') || hasPermission('ORDER_EDIT_OWN') || hasPermission('ORDER_EDIT_ALL')); // Pro ukldn objednvek\n\n  // Kontrola rol pro speciln oprvnn - MUS BT PED pouitm!\n  const isSuperAdmin = userDetail?.roles?.some(role => role.kod_role === 'SUPERADMIN');\n  const isAdmin = userDetail?.roles?.some(role => role.kod_role === 'ADMINISTRATOR');\n  const hasOrderManagePermission = hasPermission && hasPermission('ORDER_MANAGE');\n  const canUnlockAnything = isSuperAdmin || isAdmin || hasOrderManagePermission; // SUPER, ADMIN a ORDER_MANAGE mohou odemknout cokoliv\n\n  //  Filtrovan LP kdy podle seku vybranho pkazce a platnosti\n  // MUS bt A PO definici isSuperAdmin a approvers!\n  const filteredLpKodyOptions = React.useMemo(() => {\n    // Pokud nen vybran pkazce, vrtit vechny LP kdy\n    if (!formData.prikazce_id) {\n      return lpKodyOptions;\n    }\n\n    // Najt vybranho pkazce v seznamu approvers\n    const selectedPrikazce = approvers.find(user => \n      (user.id || user.user_id) === parseInt(formData.prikazce_id)\n    );\n\n    // Pokud pkazce nenalezen, vrtit vechny LP kdy\n    if (!selectedPrikazce) {\n      console.warn(' Pkazce nenalezen v approvers!');\n      return lpKodyOptions;\n    }\n\n    //  VJIMKA: Pokud je VYBRAN PKAZCE SUPERADMIN  zobrazit VECHNY LP kdy\n    // (kontrolujeme roli VYBRANHO pkazce, ne pihlenho uivatele!)\n    // Najt pkazce v allUsers (kde jsou role)\n    const prikazceWithRoles = allUsers.find(u => \n      (u.id || u.user_id) === parseInt(formData.prikazce_id)\n    );\n    const prikazceIsSuperAdmin = prikazceWithRoles?.roles?.some(role => role.kod_role === 'SUPERADMIN');\n    \n    if (prikazceIsSuperAdmin) {\n      // Stle aplikovat filtr platnosti\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      \n      return lpKodyOptions.filter(lp => {\n        const platneOd = lp.platne_od ? new Date(lp.platne_od) : null;\n        const platneDo = lp.platne_do ? new Date(lp.platne_do) : null;\n        if (platneOd) platneOd.setHours(0, 0, 0, 0);\n        if (platneDo) platneDo.setHours(0, 0, 0, 0);\n        return (!platneOd || platneOd <= today) && (!platneDo || platneDo >= today);\n      });\n    }\n\n    // Zskat usek_id pkazce (u by ml bt v response z API)\n    const prikazceUsekId = selectedPrikazce.usek_id;\n    \n    if (!prikazceUsekId) {\n      console.warn(' Pkazce nem usek_id:', selectedPrikazce);\n      return lpKodyOptions;\n    }\n\n    // Aktuln datum pro kontrolu platnosti\n    const today = new Date();\n    today.setHours(0, 0, 0, 0); // Normalizovat na plnoc\n\n    // Filtrovat LP kdy podle usek_id a platnosti\n    const filtered = lpKodyOptions.filter(lp => {\n      // 1. Kontrola seku\n      const lpUsekId = lp.usek_id || lp.usek;\n      if (!lpUsekId || String(lpUsekId) !== String(prikazceUsekId)) {\n        return false;\n      }\n\n      // 2. Kontrola platnosti (platne_od / platne_do)\n      const platneOd = lp.platne_od ? new Date(lp.platne_od) : null;\n      const platneDo = lp.platne_do ? new Date(lp.platne_do) : null;\n\n      // Normalizovat datumy na plnoc\n      if (platneOd) platneOd.setHours(0, 0, 0, 0);\n      if (platneDo) platneDo.setHours(0, 0, 0, 0);\n\n      // LP mus bt platn DNES\n      // - pokud m platne_od, mus bt <= today\n      // - pokud m platne_do, mus bt >= today\n      const jeAktivni = \n        (!platneOd || platneOd <= today) && \n        (!platneDo || platneDo >= today);\n\n      return jeAktivni;\n    });\n\n    console.log(' LP filtrovn:', {\n      prikazce: `${selectedPrikazce.jmeno} ${selectedPrikazce.prijmeni}`,\n      prikazceUsekId,\n      dnesniDatum: today.toISOString().split('T')[0],\n      vsechnyLP: lpKodyOptions.length,\n      filtrovaneLP: filtered.length,\n      filtrovaneKody: filtered.map(lp => ({\n        kod: lp.cislo_lp || lp.kod,\n        platneOd: lp.platne_od,\n        platneDo: lp.platne_do\n      }))\n    });\n\n    return filtered;\n  }, [formData.prikazce_id, lpKodyOptions, approvers, allUsers]);\n\n  //  WORKFLOW LOCKING - isWorkflowCompleted, isWorkflowRejected, isWorkflowCancelled\n  // pichzej z workflowManager. WorkflowManager d zamykn CENTRLN pes isWorkflowCompleted.\n  // isWorkflowCompleted = TRUE pro DOKONCENA, ZAMITNUTA, ZRUSENA (vechny konen stavy workflow)\n  // SUPER/ADMIN/ORDER_MANAGE mohou odemknout pes unlock dialogy.\n  \n  //  CENTRLN ZAMYKN PRO PLOHY: Pouit workflowManager.getSectionState() pro sprvn zamykn\n  // Sekce 'prilohy' NEN v SECTION_DEFINITIONS, take pouijeme fallback na isWorkflowCompleted\n  const isPrilohyLocked = useMemo(() => {\n    //  SPRVN LOGIKA: Plohy jsou zamen kdy je workflow dokoneno\n    //  DLEIT: Plohy jsou zamen PRO VECHNY vetn admin (nen monost odemen)\n    // Dvod: Plohy k dokonen/zamtnut/stornovan objednvce by nemly bt mniteln\n    return isWorkflowCompleted;\n  }, [isWorkflowCompleted]);\n\n  //  NOV: Pout centralizovan section states z workflowManager\n  //  WorkflowManager vrac { visible, enabled } pro kadou sekci (bez unlock states parametru)\n  //  FIX: Stable section states - pouze zvislost na klovch hodnotch, ne na celm workflowManager\n  const allSectionStates = useMemo(() => {\n    return workflowManager.getAllSectionStates();\n  }, [currentPhase, formData.id, isArchived, formData.stav_workflow_kod, formData.potvrzeni_dokonceni_objednavky, workflowManager]); //  Kompletn dependencies pro refresh\n\n  //  FIX: Memoize formData for FloatingNavigator to prevent re-renders\n  //  Include faktury for vcn sprvnost validation badge\n  const navigatorFormData = useMemo(() => ({ \n    id: formData.id,\n    faktury: formData.faktury,\n    max_cena_s_dph: formData.max_cena_s_dph\n  }), [formData.id, formData.faktury, formData.max_cena_s_dph]);\n\n  //  Rozen section states pro navigator - zahrnuje inline podmnky viditelnosti\n  const extendedSectionStates = useMemo(() => {\n    const states = { ...allSectionStates };\n    \n    //  PLOHY - manuln pidn stavu (nen v SECTION_DEFINITIONS)\n    // Viditeln pouze kdy m objednvka ID, zamen kdy je workflow dokoneno\n    if (formData.id) {\n      states.prilohy = {\n        visible: true,  // Vdy viditeln kdy m objednvka ID\n        enabled: !isPrilohyLocked  // Odemen pouze kdy nen workflow dokoneno\n      };\n    }\n    \n    // Fakturace - upravit viditelnost podle prv a vyplnnch dat\n    const isPlatbaPokladnaObj = formData.financovani?.platba === 'pokladna';\n    const isPlatbaPokladnaDodavatel = formData.dodavatel_zpusob_potvrzeni?.platba === 'pokladna';\n    const isPokladna = isPlatbaPokladnaObj || isPlatbaPokladnaDodavatel;\n    const hasFaktury = formData.faktury && formData.faktury.length > 0;\n    \n    if (states.fakturace) {\n      states.fakturace = {\n        ...states.fakturace,\n        visible: !isPokladna && (\n          canManageInvoices \n            ? currentPhase >= 6 \n            : (currentPhase >= 7 || hasFaktury)\n        )\n      };\n    }\n    \n    // Registr smluv vyplnn - upravit viditelnost podle prv a vyplnnch dat\n    const isRegistrFilled = formData.dt_zverejneni && formData.registr_iddt;\n    if (states.registr_smluv_vyplneni) {\n      states.registr_smluv_vyplneni = {\n        ...states.registr_smluv_vyplneni,\n        visible: states.registr_smluv_vyplneni.visible && (\n          canPublishRegistry || isRegistrFilled\n        )\n      };\n    }\n    \n    //  DOKONEN - rozit viditelnost pro ADMIN + ORDER_MANAGE\n    // WorkflowManager kontroluje stav DOKONCENA, my pidme viditelnost pro adminy ve fzi 8+\n    if (states.dokonceni && canUnlockAnything && currentPhase >= 8) {\n      states.dokonceni = {\n        ...states.dokonceni,\n        visible: true  // Admin vid sekci od fze 8 (i kdy nen dokonen)\n      };\n    }\n    \n    return states;\n  }, [allSectionStates, currentPhase, canManageInvoices, canPublishRegistry, \n      formData.financovani?.platba, formData.dodavatel_zpusob_potvrzeni?.platba, \n      formData.faktury, formData.dt_zverejneni, formData.registr_iddt, \n      formData.id, isPrilohyLocked, canUnlockAnything]);\n\n  //  HELPER: Zjist jestli je pole disabled (kombinace workflow lock + UI stav)\n  const isFieldDisabled = useCallback((sectionState) => {\n    return !sectionState.enabled || showSaveProgress || isSaving;\n  }, [showSaveProgress, isSaving]);\n\n  //  NOV: Pout workflowManager pro section states\n  const registrState = allSectionStates.registr_smluv;\n  const isRegistrLocked = !registrState.enabled; // Locked = !enabled\n\n  const registrVyplneniState = allSectionStates.registr_smluv_vyplneni;\n  const isRegistrVyplneniLocked = !registrVyplneniState.enabled; // Locked = !enabled\n\n  const potvrzeniState = allSectionStates.potvrzeni_objednavky;\n  const isPotvrzeniLocked = !potvrzeniState.enabled; // Locked = !enabled\n\n  //  FIX: Pout 'objednatel' sekci (ne 'vytvoreni' - ta neexistuje v SECTION_DEFINITIONS)\n  const objednatelState = allSectionStates.objednatel;\n  const shouldLockPhase1Sections = isFieldDisabled(objednatelState);\n\n  const schvaleniState = allSectionStates.schvaleni;\n  const shouldLockPhase2Sections = isFieldDisabled(schvaleniState);\n\n  //  CHECKBOXY \"Stav schvlen\" - VDY odemen ve FZI 2, zamen a ve FZI 3+\n  //  ARCHIVOVAN: Vdy odemen (isArchived = false)\n  // Toto je aktivn st workflow ve FZI 2 (uivatel mus zakrtnout Schvleno/Neschvleno/ek se)\n  const shouldLockSchvaleniCheckboxes = !isArchived && currentPhase >= 3 && !workflowManager.isSectionUnlocked('phase2');\n\n  //  Financovn je FZE 1-2 (samostatn sekce)\n  const financovaniState = allSectionStates.financovani;\n  const shouldLockFinancovaniSection = isFieldDisabled(financovaniState);\n\n  //  FZE 3: Dodavatel, Poloky, Detaily\n  const dodavatelState = allSectionStates.dodavatel;\n  const shouldLockPhase3Sections = isFieldDisabled(dodavatelState);\n\n  //  potvrzeniState u je definovan ve (dek 4969)\n  const shouldLockPhase4to6Sections = isFieldDisabled(potvrzeniState);\n\n  const fakturaceState = allSectionStates.fakturace;\n  const isFakturaceLockedPhase7 = !fakturaceState.enabled && (currentPhase >= 8 || hasWorkflowState(formData.stav_workflow_kod, 'FAKTURACE'));\n  const shouldLockFaktury = !fakturaceState.enabled;\n\n  //  ODSTRANNO: vecnaSpravnostState - refaktorovno na per-invoice\n  // const vecnaSpravnostState = allSectionStates.vecna_spravnost;\n  // const isVecnaSpravnostLocked = !vecnaSpravnostState.enabled;\n\n  const dokonceniState = allSectionStates.dokonceni;\n  const isDokonceniLocked = !dokonceniState.enabled;\n\n  //  GLOBLN ZMEK: Po dokonen objednvky zamknout VECHNY sekce\n  const isOrderCompleted = hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA');\n  const shouldLockAllSections = isOrderCompleted && !workflowManager.isSectionUnlocked('dokonceni');\n  \n  //  VCN SPRVNOST: Pole vcn sprvnosti jsou editovateln ve FZI 7+, i kdy zbytek faktury je zamen\n  //  VE FZI ZKONTROLOVANA (8) je vcn sprvnost ZAKZNA\n  const isZkontrolovana = hasWorkflowState(formData.stav_workflow_kod, 'ZKONTROLOVANA');\n  const shouldLockVecnaSpravnost = currentPhase < 7 || currentPhase >= 8 || isZkontrolovana || shouldLockAllSections || isArchived;\n\n  // Helper promnn pro workflow stavy (pouvaj se v jinch stech kdu)\n  const isOrderSent = hasWorkflowState(formData.stav_workflow_kod, 'ODESLANA');\n  const isOrderCancelled = hasWorkflowState(formData.stav_workflow_kod, 'ZRUSENA');\n\n  //  POUVME PMO currentPhase a phaseProgress Z WorkflowManager\n  // WorkflowManager automaticky pepot fzi kdy se zmn formData.stav_workflow_kod\n  // Nen poteba manuln mnit fzi podle unlock states - WorkflowManager to dl sm\n\n  // =====================================================\n  // FZE 3 SEKCE (DodavatelStav odesln): ZAMENO ve FZI 4+\n  //  POZNMKA: Financovn je soust FZE 1-2, nikoliv FZE 3!\n  // =====================================================\n  // const shouldLockPhase3Sections = ...\n\n  //  FZE 4-6: Zamykn sekc \"Potvrzen\" a \"Registr smluv\" kdy jsme v pozdj fzi (6+)\n  // DEPRECATED - NYN EENO PES workflowManager.getSectionState('potvrzeni_objednavky')\n  // const shouldLockPhase4to6Sections = ...\n\n  // Kdo me zobrazit tlatko pro odemknut?\n  // SUPER/ADMIN mohou vdy, bn uivatel pouze pokud jsou v aktuln/posledn fzi\n  const canShowUnlockPhase3Button = canUnlockAnything || (currentPhase >= 3 && currentPhase <= 6);\n\n  //  NOV useEffect: Reset stavu pi zmn editOrderId (proklik z jin objednvky)\n  useEffect(() => {\n    // Pokud se zmn editOrderId (nap. z notifikace nebo universal search), resetuj stav\n    if (editOrderId) {\n      // NOTE: unlockOrderIdRef removed - previous order unlock no longer tracked\n      \n      setIsDraftLoaded(false);\n      setIsInitialized(false);\n      //  KRITICK: Reset protection flag aby se pi F5 sprvn naetl draft\n      onDataLoadedCalledRef.current = null;\n    }\n  }, [editOrderId, token, username]);\n\n  // Zpracovn editace objednvky z URL parametru\n  //  DEPRECATED: Data se nyn nataj v initializeForm() PED prvnm renderem\n  useEffect(() => {\n    //  Tento useEffect je te zlon - pouije se jen pokud initializeForm() selhal\n    if (editOrderId && token && username && !isDraftLoaded && areDictionariesReady) {\n      // // console.log(` ZLON natn objednvky #${editOrderId} (initializeForm() neprobhl sprvn)`);\n      // Nech pvodn kd zstane jako fallback...\n    }\n  }, [editOrderId, token, username, isDraftLoaded, areDictionariesReady]);\n\n  // Pvodn useEffect pro editaci - ZAKOMENTOVNO, nyn se dje v initializeForm()\n  /*\n  useEffect(() => {\n    //  KRITICK KONTROLA: ekej na explicitn flag areDictionariesReady\n    if (editOrderId && token && username && !isDraftLoaded && areDictionariesReady) {\n      const loadOrderForEdit = async () => {\n        try {\n          //  NEJDV zkontroluj jestli u existuje draft z Orders25List\n          draftManager.setCurrentUser(user_id);\n          const existingDraft = await draftManager.loadDraft();\n\n          if (existingDraft && existingDraft.formData && existingDraft.formData.id == editOrderId) {\n            //  Mme erstv draft z Orders25List - pouij ho!\n\n            // Aplikuj draft data na formData\n            setFormData(existingDraft.formData);\n            setAttachments(existingDraft.attachments || []);\n            setIsChanged(existingDraft.isChanged || false);\n            // NOTE: formData.id removed - formData.id is single source of truth\n            setIsDraftLoaded(true);\n            \n            //  KRITICK: Nastavit isEditMode state komponenty\n            setIsEditMode(true);\n\n            return; // HOTOVO - draft naten\n          }\n\n          // Pokud draft neexistuje, nati z databze\n\n          //  V2 API: Nati objednvku s enriched daty\n          let dbOrder;\n          try {\n            dbOrder = await getOrderV2(editOrderId, token, username, true);\n          } catch (error) {\n            //  HIERARCHIE: Zachy 403 error (hierarchie zamtla pstup)\n            if (error?.status === 403 || error?.response?.status === 403) {\n              showToast?.(\n                'Nemte oprvnn k zobrazen tto objednvky podle aktulnho organizanho du',\n                { type: 'error' }\n              );\n              navigate('/orders25-list', { replace: true });\n              return;\n            }\n            \n            // Jin chyba\n            showToast?.(formatToastMessage('Nepodailo se nast objednvku', 'error'), { type: 'error' });\n            return;\n          }\n\n          if (!dbOrder) {\n            showToast?.(formatToastMessage('Nepodailo se nast objednvku', 'error'), { type: 'error' });\n            return;\n          }\n\n          //  KONTROLA ZAMEN podle nov BE logiky (24.10.2025)\n          // BE vrac locked: true POUZE kdy je zamen JINM uivatelem\n          // locked: false znamen \"mu editovat\" (voln NEBO moje zamen)\n\n          if (dbOrder.lock_info?.locked === true) {\n            //  Zamen JINM uivatelem - BLOKUJ a pesmruj\n            const lockInfo = dbOrder.lock_info;\n            const lockedByUserName = lockInfo.locked_by_user_fullname || `uivatel #${lockInfo.locked_by_user_id}`;\n\n            showToast?.(\n              `Objednvka je zamena uivatelem ${lockedByUserName}. Nelze ji otevt pro editaci.`,\n              'warning'\n            );\n\n            addDebugLog('warning', 'EDIT', 'locked', `Objednvka ${editOrderId} je zamena uivatelem ${lockedByUserName}`);\n\n            //  OPRAVENO: Pout React Router navigate msto window.location.href\n            navigate('/orders25-list', { replace: true });\n            return; // ZABLOKOVAT naten formule\n          } else if (dbOrder.lock_info?.is_owned_by_me === true) {\n            //  Moje zamen objednvka - pokrauj v editaci\n            // NOTE: unlockOrderIdRef removed - formData.id is used for unlock\n          } else {\n            // Objednvka nen zamen - normln lock\n            try {\n              const lockResult = await lockOrderV2({ token, username, orderId: editOrderId });\n              if (lockResult.success) {\n                // NOTE: unlockOrderIdRef removed - formData.id is used for unlock\n                \n                showToast?.(\n                  `Objednvka zamknuta pro editaci`,\n                  'info'\n                );\n                addDebugLog('success', 'EDIT', 'locked', `Objednvka ${editOrderId} byla zamknuta pro editaci`);\n              }\n            } catch (lockError) {\n\n              // Pokud m lockError lock_info, je zamen jinm uivatelem\n              if (lockError.lock_info) {\n                const lockInfo = lockError.lock_info;\n                const userName = lockInfo.locked_by_user_fullname || `uivatel #${lockInfo.locked_by_user_id}`;\n\n                showToast?.(\n                  `Objednvka je zamena uivatelem ${userName}`,\n                  'warning'\n                );\n\n                window.history.replaceState({}, '', '/orders25-list');\n                return;\n              }\n\n              // Jin chyba - varovn, ale pokrauj\n              showToast?.('Varovn: Nepodailo se zamknout objednvku', 'warning');\n            }\n          }\n\n          addDebugLog('success', 'EDIT', 'url-loaded', `Objednvka natena z URL parametru: ${dbOrder.cislo_objednavky || dbOrder.ev_cislo}`);\n\n          //  DEBUG: Co BE vrac\n          if (dbOrder.faktury && dbOrder.faktury.length > 0) {\n            if (dbOrder.faktury[0].fa_polozky && dbOrder.faktury[0].fa_polozky.length > 0) {\n            }\n          }\n          // Vytvo draft pro editaci (stejn jako v Orders25List.js)\n          const orderId = dbOrder.id;\n\n          // Nati detaily objednatele\n          let objednatelDetails = null;\n          if (dbOrder.objednatel_id) {\n            try {\n              const { getUserDetailApi2 } = await import('../services/api2auth');\n              objednatelDetails = await getUserDetailApi2(username, token, dbOrder.objednatel_id);\n            } catch (error) {\n              objednatelDetails = null;\n            }\n          }\n\n          // Vytvo daje objednatele\n          let objednatelData = {\n            objednatel_id: dbOrder.objednatel_id || user_id,\n            jmeno: 'Neuvedeno',\n            email: '',\n            telefon: ''\n          };\n\n          if (objednatelDetails) {\n            const jmeno = `${objednatelDetails.titul_pred ? objednatelDetails.titul_pred + ' ' : ''}${objednatelDetails.jmeno || ''} ${objednatelDetails.prijmeni || ''}${objednatelDetails.titul_za ? ', ' + objednatelDetails.titul_za : ''}`.replace(/\\s+/g, ' ').trim();\n            objednatelData = {\n              objednatel_id: dbOrder.objednatel_id,\n              jmeno: jmeno || 'Neuvedeno',\n              email: objednatelDetails.email || '',\n              telefon: objednatelDetails.telefon || ''\n            };\n          }\n\n          // Helper funkce pro workflow stavy\n          const hasWorkflowState = (workflowCode, state) => {\n            if (!workflowCode) return false;\n            try {\n              if (typeof workflowCode === 'string' && workflowCode.startsWith('[')) {\n                const states = JSON.parse(workflowCode);\n                return Array.isArray(states) && states.includes(state);\n              }\n              return String(workflowCode).includes(state);\n            } catch {\n              return String(workflowCode).includes(state);\n            }\n          };\n\n          // Odvozen UI stav ze workflow\n          const isSchvalena = hasWorkflowState(dbOrder.stav_workflow_kod, 'SCHVALENA');\n          const isOdeslana = hasWorkflowState(dbOrder.stav_workflow_kod, 'ODESLANA');\n          const isZrusena = hasWorkflowState(dbOrder.stav_workflow_kod, 'ZRUSENA');\n          const isZamitnuta = hasWorkflowState(dbOrder.stav_workflow_kod, 'ZAMITNUTA');\n          const isCekaSe = hasWorkflowState(dbOrder.stav_workflow_kod, 'CEKA_SE');\n\n          //  Mapovn workflow stav na UI checkbox (stav_schvaleni je POUZE UI helper, neukld se do DB!)\n          let stavSchvaleni = '';\n          if (isSchvalena) {\n            stavSchvaleni = 'schvaleno';\n          } else if (isZamitnuta) {\n            stavSchvaleni = 'neschvaleno';\n          } else if (isCekaSe) {\n            stavSchvaleni = 'ceka_se';\n          }\n          // ODESLANA_KE_SCHVALENI  checkbox zstane przdn (nen vybran dn stav)\n\n          // Vytvo fresh draft s DB daty\n          //  KRITICK OPRAVA: Pouij transformBackendDataToFrontend pro sprvn mapovn financovn!\n          const transformedDbOrder = transformBackendDataToFrontend(dbOrder);\n\n          //  VALIDACE STEDISEK: Fallback pro neaktivn stediska\n          if (transformedDbOrder.strediska_kod && Array.isArray(transformedDbOrder.strediska_kod)) {\n            transformedDbOrder.strediska_kod = validateAndFixStrediska(\n              transformedDbOrder.strediska_kod,\n              strediskaOptions\n            );\n          }\n\n          const freshDraft = {\n            formData: {\n              ...transformedDbOrder,\n              uzivatel_id: user_id,\n              ev_cislo: dbOrder.cislo_objednavky || dbOrder.ev_cislo || 'CHYBA: Chyb slo v DB!',\n              stav_schvaleni: stavSchvaleni,\n              stav_odeslano: isOdeslana,\n              stav_stornovano: isZrusena,\n              //  FZE 7: Explicitn parsovn vcn sprvnosti z DB\n              //  ODSTRANNO: Vcn sprvnost global fields - refaktorovno na per-invoice\n              // vecna_spravnost_potvrzeno: 0,\n              // potvrdil_vecnou_spravnost_id: null,\n              // dt_vecna_spravnost_potvrzeno: null,\n              // vecna_spravnost_umisteni_majetku: '',\n              // vecna_spravnost_poznamka: '',\n              //  FZE 8: Explicitn parsovn dokonen z DB\n              potvrzeni_dokonceni_objednavky: dbOrder.potvrzeni_dokonceni_objednavky !== undefined\n                ? parseInt(dbOrder.potvrzeni_dokonceni_objednavky, 10)\n                : 0,\n              dokoncil_id: dbOrder.dokoncil_id || null,\n              dt_dokonceni: dbOrder.dt_dokonceni || null,\n              dokonceni_poznamka: dbOrder.dokonceni_poznamka || '',\n\n              ...(objednatelData && {\n                objednatel_id: objednatelData.objednatel_id,\n                jmeno: objednatelData.jmeno,\n                email: objednatelData.email,\n                telefon: objednatelData.telefon\n              }),\n              //  KRITICK OPRAVA: Mapovn faktur z DB na FE formt (stejn jako v dku 7867)\n              faktury: (() => {\n                if (dbOrder.faktury && Array.isArray(dbOrder.faktury)) {\n                  return dbOrder.faktury.map(faktura => {\n                    //  DETEKCE POKLADNHO DOKLADU z rozsirujici_data\n                    const rozsirujiciData = typeof faktura.rozsirujici_data === 'string'\n                      ? JSON.parse(faktura.rozsirujici_data || '{}')\n                      : (faktura.rozsirujici_data || {});\n\n                    const isPokladna = rozsirujiciData.typ_platby === 'pokladna' || rozsirujiciData.pokladni_doklad;\n\n                    const mappedFaktura = {\n                      ...faktura,\n                      //  PZNAK POKLADNY\n                      _isPokladna: isPokladna,\n                      rozsirujici_data: rozsirujiciData,\n                      //  MAPOVN 1:1 mezi DB sloupci a FE poli\n                      fa_dorucena: faktura.fa_datum_doruceni ? 1 : 0, //  Boolean flag zda m datum doruen\n                      fa_splatnost: faktura.fa_datum_splatnosti ? faktura.fa_datum_splatnosti.split(' ')[0] : '', // DB -> FE: fa_datum_splatnosti -> fa_splatnost\n                      //  PARSOVN STEDISEK z DB: JSON string kd  FE objekty s nzvy\n                    fa_strediska_kod: (() => {\n                      try {\n                        let parsed = [];\n\n                        if (Array.isArray(faktura.fa_strediska_kod)) {\n                          parsed = faktura.fa_strediska_kod; // U je pole\n                        } else if (typeof faktura.fa_strediska_kod === 'string') {\n                          parsed = JSON.parse(faktura.fa_strediska_kod) || []; // Parsuj JSON: [\"KLADNO\",\"BENESOV\"]\n                        }\n\n                        //  Transformuj kdy na objekty s nzvy (pro zobrazen v SELECTu)\n                        const result = parsed.map(item => {\n                          if (typeof item === 'object' && item.kod_stavu) {\n                            // U je objekt  zkontroluj zda existuje v aktivnch\n                            const exists = strediskaOptions.find(opt =>\n                              opt.kod_stavu === item.kod_stavu || opt.kod === item.kod_stavu || opt.value === item.kod_stavu\n                            );\n                            if (exists) {\n                              return item;\n                            }\n                            // Neaktivn stedisko  nahradit za 100 Sprva Kladno\n                            const fallback = strediskaOptions.find(opt =>\n                              opt.kod_stavu === \"100\" || opt.kod === \"100\" || opt.value === \"100\"\n                            );\n                            return fallback ? {\n                              kod_stavu: fallback.kod_stavu || fallback.kod || fallback.value,\n                              nazev_stavu: fallback.nazev_stavu || fallback.nazev || fallback.label\n                            } : { kod_stavu: \"100\", nazev_stavu: \"100 Sprva Kladno\" };\n                          }\n                          // Je to jen kd (string)  najt stedisko v options a vzt cel objekt\n                          const stredisko = strediskaOptions.find(opt =>\n                            opt.kod_stavu === item || opt.kod === item || opt.value === item\n                          );\n                          if (stredisko) {\n                            return {\n                              kod_stavu: stredisko.kod_stavu || stredisko.kod || stredisko.value,\n                              nazev_stavu: stredisko.nazev_stavu || stredisko.nazev || stredisko.label\n                            };\n                          }\n                          // Neaktivn stedisko  nahradit za 100 Sprva Kladno\n                          const fallback = strediskaOptions.find(opt =>\n                            opt.kod_stavu === \"100\" || opt.kod === \"100\" || opt.value === \"100\"\n                          );\n                          return fallback ? {\n                            kod_stavu: fallback.kod_stavu || fallback.kod || fallback.value,\n                            nazev_stavu: fallback.nazev_stavu || fallback.nazev || fallback.label\n                          } : { kod_stavu: \"100\", nazev_stavu: \"100 Sprva Kladno\" };\n                        });\n\n                        return result;\n\n                      } catch (e) {\n                        addDebugLog('warning', 'EDIT-FAKTURY-LOAD', 'json-parse-error', `Chyba pi parsovn fa_strediska_kod faktury ID ${faktura.id}: ${e.message}, data: ${faktura.fa_strediska_kod}`);\n                        return [];\n                      }\n                    })(),\n                    // Zachovat originln DB pole pro API odesln\n                    fa_datum_doruceni: faktura.fa_datum_doruceni,\n                    fa_datum_splatnosti: faktura.fa_datum_splatnosti,\n                    fa_datum_vystaveni: faktura.fa_datum_vystaveni\n                    };\n\n                    return mappedFaktura;\n                  });\n                } else {\n                  return []; // dn faktury\n                }\n              })()\n            },\n            timestamp: Date.now(),\n            version: '1.4',\n            isConceptSaved: true,\n            isChanged: false,\n            isOrderSavedToDB: true,\n            formData.id: orderId,\n            attachments: []\n          };\n\n          // Draft cleanup je nyn een automaticky pes draftManager\n\n          //  KRITICK OPRAVA: Pokud DB nem faktury, explicitn nastav przdn pole\n          if (!freshDraft.formData.faktury || freshDraft.formData.faktury.length === 0) {\n            freshDraft.formData.faktury = []; // Explicitn przdn pole\n          }\n\n          //  Ulo draft pes DraftManager s invalidated: false (editace ze seznamu = validn draft)\n          draftManager.setCurrentUser(user_id);\n          await draftManager.syncWithDatabase(freshDraft.formData, orderId);\n\n          //  PIDAT: Explicitn ulo metadata pro EDIT mode\n          draftManager.saveMetadata({\n            isEditMode: true,\n            editOrderId: orderId,\n            openConceptNumber: freshDraft.formData.ev_cislo || freshDraft.formData.cislo_objednavky\n          });\n\n          //  KRITICK: Nastavit isEditMode state komponenty\n          setIsEditMode(true);\n\n          //  DEBUG LOG - FZE 2: Objednvka natena z URL\n          const currentPhaseNum = (() => {\n            // Highest phases first\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'DOKONCENA')) return 10;\n            // ZKONTROLOVANA - fze 10 (ped dokonenm)\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'ZKONTROLOVANA')) return 10;\n            // VECNA_SPRAVNOST - fze 9 (vcn sprvnost)\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'VECNA_SPRAVNOST')) return 9;\n            // Fakturace (fze 8)\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'FAKTURACE')) return 8;\n            // Registr smluv - FZE 7\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'DOKONCENA')) return 9;\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'ZKONTROLOVANA')) return 8;\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'VECNA_SPRAVNOST')) return 7;\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'FAKTURACE')) return 6;\n            // Pokud UVEREJNENA  FZE 6 (Fakturace)\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'UVEREJNENA')) return 6;\n            // Pokud bylo rozhodnuto NEUVEREJNIT  FZE 6 (Fakturace)\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'NEUVEREJNIT')) return 6;\n            // Pokud bylo rozhodnuto UVEREJNIT  FZE 5 (Vyplnn registru)\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'UVEREJNIT')) return 5;\n            // Potvrzeno dodavatelem - ZSTV ve FZI 4\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'POTVRZENA')) return 4;\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'ODESLANA')) return 4;\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'SCHVALENA')) return 2;\n            return 1;\n          })();\n          // Vyisti URL od edit parametru\n          const newUrl = window.location.pathname;\n          window.history.replaceState({}, '', newUrl);\n\n        } catch (error) {\n\n          showToast?.('Nepodailo se nast objednvku pro editaci', 'error');\n        }\n      };\n\n      loadOrderForEdit();\n    } else if (editOrderId && !areDictionariesReady) {\n      //  ekn na naten slovnk (tich reim - bez logovn)\n    }\n  }, [editOrderId, token, username, isDraftLoaded, showToast, areDictionariesReady]);\n  */\n\n  //  CLEANUP: Odemkni objednvku pi unmount komponenty (zaven formule)\n  // OPRAVA: Pouit useRef pro uloen aktuln hodnoty bez triggeru cleanup pi zmn dependencies\n\n\n  const userRoleRef = useRef({ isSuperAdmin: false, isAdmin: false });\n  // NOTE: unlockOrderIdRef removed - using formData.id directly in cleanup logic\n\n  // Aktualizuj ref s rolemi uivatele\n  useEffect(() => {\n    const isSuperAdmin = userDetail?.roles?.some(role => role.kod_role === 'SUPERADMIN');\n    const isAdmin = userDetail?.roles?.some(role => role.kod_role === 'ADMINISTRATOR');\n    userRoleRef.current = { isSuperAdmin, isAdmin };\n  }, [userDetail]);\n\n  //  NOV OBJEDNVKA: Automatick vyplnn daj pihlenho uivatele\n  // Spust se POUZE pokud je to nov objednvka BEZ daj v formData\n  useEffect(() => {\n    // Podmnky: je to nov objednvka + draft je naten + nen vyplnno jmno + mme userDetail\n    if (isNewOrder && isDraftLoaded && !formData.jmeno && userDetail && user_id) {\n\n      const jmeno = `${userDetail.titul_pred ? userDetail.titul_pred + ' ' : ''}${userDetail.jmeno || ''} ${userDetail.prijmeni || ''}${userDetail.titul_za ? ', ' + userDetail.titul_za : ''}`.replace(/\\s+/g, ' ').trim();\n\n      setFormData(prev => ({\n        ...prev,\n        jmeno: jmeno,\n        email: userDetail.email || '',\n        telefon: userDetail.telefon || '',\n        uzivatel_id: user_id, // ID uivatele kter vytv objednvku\n        objednatel_id: user_id // Implicitn objednatel = vytvoil\n      }));\n    }\n  }, [isNewOrder, isDraftLoaded, formData.jmeno, userDetail, user_id]);\n\n  // Cleanup se spust POUZE pi skutenm unmount (przdn dependencies)\n  useEffect(() => {\n    return () => {\n      //  DLEIT: Automatick odemykn pi unmount VYPNUTO\n      // Zmek se uvoln POUZE explicitn pes handleCancelOrder (tlatko ZAVT)\n      // nebo pi oteven jin objednvky\n      // Tm zajistme, e i ADMIN/SUPERADMIN dr zmek pi Save a zstvaj na formuli\n    };\n  }, []); //  Przdn dependencies = cleanup POUZE pi unmount\n\n  // DEBUG logy odstranny - zpsobovaly nekonen re-rendery!\n  // NOTE: formData.id sync removed - formData.id is single source of truth\n  useEffect(() => {\n    if (formData.id) {\n\n      // KRITICK: Reset validanch stav pouze pi ZMN ID (nat se jin objednvka)\n      //  NEISTIT validationErrors pokud uivatel prv zkusil uloit (hasTriedToSubmit)\n      //  istit pouze kdy se mn ID objednvky (nat se jin zznam)\n      if (!hasTriedToSubmit) {\n        setValidationErrors({});\n        setTouchedSelectFields(new Set());\n      }\n\n      //  Uloit slo objednvky pes DraftManager pro zvraznn v seznamu\n      if (user_id && formData.ev_cislo) {\n        draftManager.saveMetadata({ openConceptNumber: formData.ev_cislo });\n      }\n\n      // Flag u nepotebujeme - fze se odvozuje pmo z workflow stavu\n    }\n  }, [formData.id]); //  ODSTRANIT stav_workflow_kod z dependencies!\n\n  //  Ref pro zabrnn duplicitnho vytven poloek\n  const hasCreatedInitialItem = useRef(false);\n  const lastPhaseRef = useRef(currentPhase);\n\n  // Inicializace poloek objednvky pi pechodu do fze 2 nebo po naten konceptu\n  useEffect(() => {\n    // KRITICK: Vytvoit przdnou poloku POUZE pokud:\n    // 1. Jsme ve fzi 2+\n    // 2. Nejsou dn poloky\n    // 3. Sekce Detail objednvky NEN zamen (pokud je odemen, mus bt vidt min. 1 poloka)\n    // 4. Draft u byl naten (aby se nespustilo bhem natn dat)\n    // 5. Jet jsme nevytvoili przdnou poloku v tto fzi\n\n    const polozkyLength = formData.polozky_objednavky?.length || 0;\n\n    //  DEBUG: Logovn vech podmnek\n    if (currentPhase >= 3) {\n      // DEBUG: POLOZKY phase 3+ debug logging removed for performance\n    }\n\n    //  OCHRANA: Zabrnit sputn bhem inicializace\n    if (!isDraftLoaded) {\n      // DEBUG: Draft loading wait - logging removed\n      return;\n    }\n\n    //  Pro nov objednvky nemus bt vybrn druh objednvky - poloky se mohou vytvoit i bez nj\n\n    //  Resetovat pi zmn fze nebo druhu objednvky\n    if (lastPhaseRef.current !== currentPhase) {\n      hasCreatedInitialItem.current = false;\n      lastPhaseRef.current = currentPhase;\n      // DEBUG: Phase change reset - logging removed\n    }\n\n    //  OPRAVA: Zmna z fze 2+ na fze 3+ (Detail objednvky se zobrazuje od fze 3)\n    //  ADDITIONAL FIX: Vytvoit poloku i kdy je sekce zamen (aby se zobrazila)\n    if (currentPhase >= 3 &&\n        polozkyLength === 0 &&\n        !hasCreatedInitialItem.current) {\n\n      hasCreatedInitialItem.current = true; //  Zamknout dal vytven\n\n      // DEBUG: Creating empty item - logging removed\n      setFormData(prev => ({\n        ...prev,\n        polozky_objednavky: [\n          {\n            id: `new_item_${Date.now()}`,\n            popis: '',\n            mnozstvi: '1',\n            jednotka: 'ks',\n            cena_bez_dph: '',\n            sazba_dph: '21',\n            cena_s_dph: ''\n          }\n        ]\n      }));\n    }\n  }, [currentPhase, isDraftLoaded, formData.druh_objednavky_kod, formData.polozky_objednavky?.length]);\n\n  // DEBUG: Sledovn zmn v polokch (disabled to prevent console flood)\n  // useEffect(() => {\n  //   if (formData.polozky_objednavky) {\n  //     addDebugLog('info', 'POLOZKY', 'change-detected', `Zmna v polokch - aktuln poet: ${formData.polozky_objednavky.length}`);\n  //     if (formData.polozky_objednavky.length > 0) {\n  //       const firstItem = formData.polozky_objednavky[0];\n  //       addDebugLog('info', 'POLOZKY', 'first-item', `Prvn poloka: popis=\"${firstItem.popis}\", cena_bez_dph=\"${firstItem.cena_bez_dph}\"`);\n  //     }\n  //   }\n  // }, [formData.polozky_objednavky]);\n\n  //  AUTOMATICK DETEKCE CENY > 50 000 K bez DPH pro \"M bt zveejnna\"\n  useEffect(() => {\n    // Aktivovat pouze ve FZI 4 (ODESLANA/POTVRZENA) kdy dodavatel potvrd ANO\n    if (!formData.polozky_objednavky || formData.polozky_objednavky.length === 0) return;\n    if (currentPhase !== 4) return; // Pouze ve FZI 4\n\n    // Mus bt potvrzeno dodavatelem ANO\n    const dodavatelPotvrzeni = formData.dodavatel_zpusob_potvrzeni;\n    const potvrdilAno = dodavatelPotvrzeni?.potvrzeni === 'ANO' || dodavatelPotvrzeni?.potvrzeno === true;\n    if (!potvrdilAno) return;\n\n    // Pokud u je rozhodnuto (UVEREJNIT nebo NEUVEREJNIT), nepepisuj\n    if (hasWorkflowState(formData.stav_workflow_kod, 'UVEREJNIT')) return;\n    if (hasWorkflowState(formData.stav_workflow_kod, 'NEUVEREJNIT')) return;\n\n    // Pokud u je hodnota nastavena (uivatel kliknul), nepepisuj\n    if (formData.ma_byt_zverejnena !== undefined && formData.ma_byt_zverejnena !== null) return;\n\n    // Seti vechny ceny bez DPH\n    const celkovaCenaBezDPH = formData.polozky_objednavky.reduce((sum, polozka) => {\n      //  FIX: Odstranit formtovn ped parseFloat\n      const cenaBezDPH = parseFloat((polozka.cena_bez_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\n      const mnozstvi = parseFloat(polozka.mnozstvi) || 1;\n      return sum + (cenaBezDPH * mnozstvi);\n    }, 0);\n\n    // Nastavit vchoz hodnotu podle ceny\n    const defaultValue = celkovaCenaBezDPH > 50000;\n    setFormData(prev => ({\n      ...prev,\n      ma_byt_zverejnena: defaultValue\n    }));\n\n    addDebugLog('info', 'REGISTR', 'auto-detect',\n      `Cena ${celkovaCenaBezDPH.toFixed(2)} K ${defaultValue ? '>' : ''} 50 000 K  vchoz hodnota \"M bt zveejnna\" = ${defaultValue}`\n    );\n  }, [currentPhase, formData.polozky_objednavky, formData.dodavatel_zpusob_potvrzeni, formData.stav_workflow_kod, formData.ma_byt_zverejnena]);\n\n  //  HELPER FUNKCE PRO PRCI S FAKTURAMI (stejn pattern jako poloky)\n  const updateFaktury = useCallback((newFaktury) => {\n    setFormData(prev => ({\n      ...prev,\n      faktury: newFaktury\n    }));\n    //  KRITICK: Nastavit isChanged pi zmn faktur\n    setIsChanged(true);\n  }, []);\n\n  // Zamykn se e pmo v saveOrderToAPI() po uloen\n\n  // Reaktivn logika pro zpusob_financovani: Pokud je vybran Pokladna, zablokuj Dodavatel sekci\n  useEffect(() => {\n    if (!formData.zpusob_financovani || !financovaniOptions.length) return;\n\n    const selectedFinancovani = financovaniOptions.find(opt =>\n      opt.kod === formData.zpusob_financovani ||\n      opt.value === formData.zpusob_financovani\n    );\n\n    const nazev = selectedFinancovani?.nazev || '';\n    const isPokladna = nazev.toLowerCase().includes('pokladna');\n\n    if (isPokladna) {\n      // 1. Svinout (collapse) sekci Dodavatel\n      setSectionStates(prev => ({\n        ...prev,\n        dodavatel: true // true = collapsed\n      }));\n\n      // 2. Vymazat vechny hodnoty pol dodavatele\n      setFormData(prev => ({\n        ...prev,\n        dodavatel_id: null,\n        dodavatel_nazev: '',\n        dodavatel_adresa: '',\n        dodavatel_ico: '',\n        dodavatel_dic: '',\n        dodavatel_zastoupeny: '',\n        dodavatel_kontakt_jmeno: '',\n        dodavatel_kontakt_email: '',\n        dodavatel_kontakt_telefon: ''\n      }));\n\n      // Validace probh POUZE pi Save, live mazn chyb nen poteba\n    } else {\n      // Pokud NEN Pokladna, rozbal sekci Dodavatel (aby byla viditeln)\n      setSectionStates(prev => ({\n        ...prev,\n        dodavatel: false // false = expanded/rozbalen\n      }));\n    }\n  }, [formData.zpusob_financovani, financovaniOptions, hasTriedToSubmit]);\n\n  // Globln drag and drop prevention (zabrn oteven souboru v prohlei)\n  useEffect(() => {\n    const preventDefaults = (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n    };\n\n    const handleDrop = (e) => {\n      preventDefaults(e);\n    };\n\n    // Pidat event listenery\n    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {\n      document.addEventListener(eventName, preventDefaults, false);\n    });\n\n    document.addEventListener('drop', handleDrop, false);\n\n    // Cleanup\n    return () => {\n      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {\n        document.removeEventListener(eventName, preventDefaults, false);\n      });\n      document.removeEventListener('drop', handleDrop, false);\n    };\n  }, []);\n\n  // Vpoet celkov ceny poloek s DPH (optimalizovno s useMemo)\n  const totalPrice = useMemo(() => {\n    if (!formData.polozky_objednavky || formData.polozky_objednavky.length === 0) {\n      return 0;\n    }\n\n    return formData.polozky_objednavky.reduce((total, polozka) => {\n      //  FIX: Odstranit formtovn ped parseFloat\n      const cena = parseFloat((polozka.cena_s_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\n      return total + cena;\n    }, 0);\n  }, [formData.polozky_objednavky]);\n\n  // Porovnn s maximln cenou\n  const maxPrice = useMemo(() => {\n    return parseFloat(formData.max_cena_s_dph?.toString().replace(/[^0-9.-]/g, '')) || 0;\n  }, [formData.max_cena_s_dph]);\n\n  const priceDifference = maxPrice - totalPrice;\n  const isPriceExceeded = totalPrice > maxPrice && maxPrice > 0;\n  const isPriceWithinLimit = totalPrice <= maxPrice && maxPrice > 0 && totalPrice > 0;\n\n  // Vpoet ceny BEZ DPH (pro registr smluv) - sprvn z poloek\n  const celkovaCenaBezDPH = useMemo(() => {\n    if (!formData.polozky_objednavky || formData.polozky_objednavky.length === 0) {\n      return 0;\n    }\n    return formData.polozky_objednavky.reduce((sum, polozka) => {\n      //  FIX: Odstranit formtovn ped parseFloat\n      const cenaBezDPH = parseFloat((polozka.cena_bez_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\n      const mnozstvi = parseFloat(polozka.mnozstvi) || 1;\n      return sum + (cenaBezDPH * mnozstvi);\n    }, 0);\n  }, [formData.polozky_objednavky]);\n\n  // DEPRECATED: Star vpoet DPH\n  const totalPriceWithoutDPH = useMemo(() => {\n    return totalPrice / 1.21; // Pedpokldme 21% DPH\n  }, [totalPrice]);\n\n  // Automatick zakrtvn registru smluv pi pechodu do FZE 3 (pokud cena BEZ DPH > 50 000 K)\n  //  POZOR: Automaticky se nastav jen pokud objednvka JE ULOEN v DB (m formData.id)\n  useEffect(() => {\n    const currentPhaseNum = getCurrentPhase();\n    const shouldAutoCheck = currentPhaseNum >= 3 &&\n                           celkovaCenaBezDPH > 50000 &&\n                           !formData.ma_byt_zverejnena &&\n                           formData.id; //  Kontrola e objednvka je uloen v DB\n\n    if (shouldAutoCheck) {\n      handleInputChange('ma_byt_zverejnena', true);\n    }\n  }, [getCurrentPhase(), celkovaCenaBezDPH, formData.id, formData.id]); //  Pidna zvislost na formData.id\n\n  // Vynucen typu ablony 'po' ve FZI 1 (ped schvlenm)\n  useEffect(() => {\n    if (currentPhase < 2 && templateType !== 'po') {\n      setTemplateType('po');\n    }\n  }, [currentPhase, templateType]);\n\n  // Smart naten ploh pi refreshi formule (DB + lokln neuloen)\n  // POZOR: Nat se vdy, kdy m objednvka ID a sekce ploh je viditeln (!sectionStates.prilohy)\n  useEffect(() => {\n    if (formData.id && token && username && !isNewOrder && !sectionStates.prilohy) {\n\n      loadAttachmentsSmartly();\n    }\n  }, [formData.id, formData.id, token, username, isNewOrder, sectionStates.prilohy]);\n\n  //  REMOVED: useEffect pro natn typ ploh - DEPRECATED\n  // Typy ploh se nataj pi inicializaci pes useDictionaries.loadAll()\n  // Nejsou poteba lazy loading - jsou dostupn ihned v prilohyTypyOptions (alias na dictionaries.data.prilohyTypyOptions)\n\n  // TICH validace pro zobrazen ervench pol (pouze pokud ji uivatel se pokusil uloit)\n  //  DOASN ZAKOMENTOVNO: Tyto useEffecty zpsobuj PEPSN validationErrors a mizen ervench rmek\n  // Validace se dl pouze pi kliknut na \"Uloit\" v validateFormForSave()\n  // Live validace bhem editace nen poteba a zpsobuje race conditions\n  \n  // useEffect(() => {\n  //   // Spus TICHOU validaci pouze pokud se uivatel u jednou pokusil odeslat formul\n  //   // POUZE pro kritick pole, ne pro vechna pole formule\n  //   if (hasTriedToSubmit) {\n  //     validateFormSilently();\n  //   }\n  // }, [hasTriedToSubmit, formData.polozky_objednavky?.length, formData.stav_workflow_kod, shouldLockPhase1Sections, shouldLockPhase2Sections, shouldLockPhase3Sections, shouldLockPhase4to6Sections]);\n\n  // useEffect(() => {\n  //   // Reset validanho stavu pi pechodu mezi fzemi\n  //   if (hasTriedToSubmit) {\n  //     validateFormSilently();\n  //   }\n  // }, [currentPhase, hasTriedToSubmit, formData.stav_workflow_kod, formData.zpusob_financovani, formData.lp_kod, formData.cislo_smlouvy, formData.individualni_schvaleni, formData.pojistna_udalost_cislo, shouldLockPhase1Sections, shouldLockPhase2Sections, financovaniState.visible, financovaniState.enabled, shouldLockPhase3Sections, shouldLockPhase4to6Sections]);\n\n  //  Kompaktn debug logging pro workflow tracking\n  const addDebugLog = (level, category, action, data) => {\n    const styles = {\n      workflow: 'background: #4CAF50; color: white; padding: 2px 6px; border-radius: 3px; font-weight: bold;',\n      autosave: 'background: #2196F3; color: white; padding: 2px 6px; border-radius: 3px;',\n      db: 'background: #FF9800; color: white; padding: 2px 6px; border-radius: 3px; font-weight: bold;',\n      error: 'background: #f44336; color: white; padding: 2px 6px; border-radius: 3px;',\n    };\n\n    // Workflow stavy - VDY zobrazuj\n    if (category === 'WORKFLOW' || category === 'DB-RESPONSE') {\n    }\n    // Autosave - pouze dleit udlosti\n    else if (category === 'AUTOSAVE' && (action === 'saved' || action === 'triggered')) {\n    }\n    // DB response - strukturovan vpis\n    else if (category === 'DB' || category === 'SAVE') {\n    }\n    // Chyby - vdy\n    else if (level === 'error') {\n    }\n  };\n\n  const clearDebugLogs = () => {}; // No-op\n\n  // Funkce pro zskn jmna uivatele podle ID\n  const getUserNameById = (userId) => {\n    if (!userId) return '';\n\n    // Nejdve hledej mezi vemi uivateli\n    let user = allUsers.find(u => (u.id || u.user_id) === parseInt(userId));\n\n    // Pokud nenajde, hledej mezi schvalovateli\n    if (!user) {\n      user = approvers.find(u => (u.id || u.user_id) === parseInt(userId));\n    }\n\n    // Pokud je to aktuln uivatel\n    if (!user && parseInt(userId) === parseInt(user_id) && userDetail) {\n      user = userDetail;\n    }\n\n    // Zkontroluj cache\n    if (!user && userNamesCache[userId]) {\n      return userNamesCache[userId];\n    }\n\n    if (user) {\n      // Sprvn poad: Titul ped + Jmno + Pjmen + Titul za\n      const titul_pred = user.titul_pred ? user.titul_pred + ' ' : '';\n      const jmeno = user.jmeno || '';\n      const prijmeni = user.prijmeni || '';\n      const titul_za = user.titul_za ? ', ' + user.titul_za : '';\n\n      return `${titul_pred}${jmeno} ${prijmeni}${titul_za}`.replace(/\\s+/g, ' ').trim();\n    }\n\n    // Pokud uivatel nen v cache, nati ho z DB asynchronn\n    if (!userNamesCache[userId]) {\n      getUserDetailApi2(username, token, userId)\n        .then(userDetail => {\n          if (userDetail) {\n            const titul_pred = userDetail.titul_pred ? userDetail.titul_pred + ' ' : '';\n            const jmeno = userDetail.jmeno || '';\n            const prijmeni = userDetail.prijmeni || '';\n            const titul_za = userDetail.titul_za ? ', ' + userDetail.titul_za : '';\n            const fullName = `${titul_pred}${jmeno} ${prijmeni}${titul_za}`.replace(/\\s+/g, ' ').trim();\n\n            // Ulo do cache\n            setUserNamesCache(prev => ({\n              ...prev,\n              [userId]: fullName\n            }));\n          } else {\n            // Uivatel neexistuje\n            setUserNamesCache(prev => ({\n              ...prev,\n              [userId]: `Uivatel ID ${userId}`\n            }));\n          }\n        })\n        .catch(error => {\n          // Error loading user\n          setUserNamesCache(prev => ({\n            ...prev,\n            [userId]: `Uivatel ID ${userId}`\n          }));\n        });\n    }\n\n    // Mezitm zobraz placeholder\n    return 'Natm...';\n  };\n\n  //  Helper funkce pro validaci ev. sla (EEN PROBLMU #3)\n  const isValidEvCislo = (ev_cislo) => {\n    if (!ev_cislo) return false;\n    if (ev_cislo === 'Natm...') return false;\n    if (typeof ev_cislo === 'string' && ev_cislo.trim() === '') return false;\n    return true;\n  };\n\n  //  useEffect: Nast neaktivnho garanta pokud nen v allUsers (pi editaci)\n  // allUsers nyn obsahuje JEN aktivn uivatele (fetchActiveUsers)\n  // Pokud editujeme objednvku s neaktivnm garantem, musme jej explicitn nast\n  useEffect(() => {\n    const loadGarantOptions = async () => {\n      //  Pokej ne se natou selnky\n      if (!areDictionariesReady || allUsers.length === 0) {\n        return;\n      }\n\n      // 1. Filtruj AKTIVN uivatele z allUsers\n      const activeUsers = allUsers.filter(u => u.aktivni === 1 || u.aktivni === '1' || u.active === 1 || u.active === '1');\n\n      // 2. Pokud NEN editace nebo nen garant, pouij jen aktivn\n      const currentOrderId = formData.id || formData.id;\n\n      if (!formData.garant_uzivatel_id || !currentOrderId) {\n        setGarantOptions(activeUsers);\n        return;\n      }\n\n      // 3. EDITACE: Zkontroluj jestli je garant v aktivnch\n      const garantInActiveList = activeUsers.find(\n        u => (u.id === formData.garant_uzivatel_id || u.user_id === formData.garant_uzivatel_id)\n      );\n\n      if (garantInActiveList) {\n        setGarantOptions(activeUsers);\n        return;\n      }\n\n      // 4. Garant NEN aktivn  zkontroluj jestli je v allUsers (neaktivn)\n      const garantInAllUsers = allUsers.find(\n        u => (u.id === formData.garant_uzivatel_id || u.user_id === formData.garant_uzivatel_id)\n      );\n\n      if (garantInAllUsers) {\n        setGarantOptions([garantInAllUsers, ...activeUsers]);\n        return;\n      }\n\n      // 5. Garant nen ani v allUsers  nati explicitn (star user)\n\n      if (!username || !token) {\n        setGarantOptions(activeUsers);\n        return;\n      }\n\n      try {\n        const inactiveGarantDetail = await getUserDetailApi2(\n          username,\n          token,\n          formData.garant_uzivatel_id\n        );\n\n        if (inactiveGarantDetail) {\n          // Normalizuj formt jako ostatn users z allUsers\n          const normalizedGarant = {\n            id: inactiveGarantDetail.id || inactiveGarantDetail.uzivatel_id,\n            user_id: inactiveGarantDetail.id || inactiveGarantDetail.uzivatel_id,\n            username: inactiveGarantDetail.username || inactiveGarantDetail.login,\n            jmeno: inactiveGarantDetail.jmeno || '',\n            prijmeni: inactiveGarantDetail.prijmeni || '',\n            titul_pred: inactiveGarantDetail.titul_pred || '',\n            titul_za: inactiveGarantDetail.titul_za || '',\n            email: inactiveGarantDetail.email || '',\n            aktivni: 0 // Ozname jako neaktivn\n          };\n\n          // Pidej neaktivnho garanta na zatek seznamu\n          setGarantOptions([normalizedGarant, ...activeUsers]);\n        } else {\n          setGarantOptions(activeUsers);\n        }\n      } catch (error) {\n        setGarantOptions(activeUsers);\n      }\n    };\n\n    loadGarantOptions();\n  }, [formData.garant_uzivatel_id, formData.id, allUsers, formData.id, username, token, areDictionariesReady]);\n\n  //  DEPRECATED: Tyto funkce byly nahrazeny FormDataManager\n  //  ============================================\n  // FAKTURY - Funkce pro sprvu faktur k objednvce\n  // ============================================\n\n  // Naten faktur z API\n  //  FAKTURY jsou nyn soust formData.faktury (natou se s objednvkou z BE)\n\n  //  FUNKCE: Zajist, e vdy existuje alespo jedna faktura ve fzi 7+\n  // Vol se pmo pi renderovn sekce Faktury (ne v useEffect)\n  const ensureFirstInvoiceExists = React.useCallback(() => {\n    if (!formData.id || currentPhase < 7 || fakturyLoading) {\n      return;\n    }\n\n    // Pokud nejsou dn faktury, vytvo prvn\n    if (!formData.faktury || formData.faktury.length === 0) {\n      const dnesniDatum = formatDateForPicker(new Date());\n\n      const novaFaktura = {\n        id: `temp-${Date.now()}`, // Temporary ID\n        objednavka_id: formData.id,\n        fa_datum_doruceni: dnesniDatum,\n        fa_dorucena: 1,\n        fa_castka: '',\n        fa_cislo_vema: '',\n        fa_strediska_kod: formData.strediska_kod || [],\n        fa_splatnost: '',\n        fa_poznamka: '',\n        vytvoril_uzivatel_id: user_id,\n        vytvoril_jmeno: getUserNameById(user_id),\n        dt_vytvoreni: new Date().toISOString(),\n        dt_aktualizace: null,\n        aktivni: 1,\n        _isNew: true\n      };\n\n      updateFaktury([novaFaktura]);\n    }\n  }, [formData.id, currentPhase, fakturyLoading, formData.faktury, formData.strediska_kod, user_id]);\n\n  // Pidat novou fakturu\n  const handleAddFaktura = async () => {\n    if (!formData.id) {\n      showToast && showToast(formatToastMessage('Nejprve ulote objednvku', 'error'), { type: 'error' });\n      return;\n    }\n\n    // Validace povinnch pol\n    if (!fakturaFormData.fa_datum_doruceni || (typeof fakturaFormData.fa_datum_doruceni === 'string' && fakturaFormData.fa_datum_doruceni.trim() === '')) {\n      showToast && showToast('Datum doruen faktury je povinn', { type: 'error' });\n      return;\n    }\n\n    if (!fakturaFormData.fa_castka || parseFloat(fakturaFormData.fa_castka) <= 0) {\n      showToast && showToast('stka faktury je povinn a mus bt vt ne 0', { type: 'error' });\n      return;\n    }\n\n    if (!fakturaFormData.fa_cislo_vema || (typeof fakturaFormData.fa_cislo_vema === 'string' && fakturaFormData.fa_cislo_vema.trim() === '')) {\n      showToast && showToast('Variabiln symbol je povinn', { type: 'error' });\n      return;\n    }\n\n    if (!fakturaFormData.fa_splatnost || (typeof fakturaFormData.fa_splatnost === 'string' && fakturaFormData.fa_splatnost.trim() === '')) {\n      showToast && showToast('Datum splatnosti je povinn', { type: 'error' });\n      return;\n    }\n\n    //  POUZE LOKLN AKTUALIZACE - faktury se ulo s objednvkou\n    //  NEPOTEBUJEME nastavovat fakturant_id ZDE - nastav se automaticky pi uloen objednvky\n\n    //  VYISTIT fa_strediska_kod - zajistit e jsou JEN stringy\n    const cleanedStrediska = Array.isArray(fakturaFormData.fa_strediska_kod)\n      ? fakturaFormData.fa_strediska_kod.map(item => {\n          if (typeof item === 'string') return item;\n          return item.value || item.kod_stavu || item.id || item;\n        })\n      : [];\n\n    // Vytvoit novou fakturu s temp ID\n    const newFaktura = {\n      ...fakturaFormData,\n      id: `temp-${Date.now()}`, // Doasn ID - BE piad sprvn pi uloen objednvky\n      objednavka_id: formData.id,\n      fa_strediska_kod: cleanedStrediska, //  POUT VYITN STRINGY\n      vytvoril_uzivatel_id: user_id,\n      vytvoril_jmeno: getUserNameById(user_id),\n      dt_vytvoreni: new Date().toISOString(),\n      aktivni: 1,\n      _isNew: false, // Oznait jako uloenou (ulo se s objednvkou)\n      // fa_dorucena je VDY 1 (boolean flag e faktura je doruen)\n      fa_dorucena: 1,\n      //  OPRAVA MAPOVN DATUMOVCH POL\n      fa_datum_doruceni: fakturaFormData.fa_dorucena || new Date().toISOString().split('T')[0], // fa_dorucena obsahuje datum doruen!\n      fa_datum_vystaveni: fakturaFormData.fa_datum_vystaveni || new Date().toISOString().split('T')[0], // Pidat datum vystaven\n      fa_datum_splatnosti: fakturaFormData.fa_splatnost || '', // fa_splatnost obsahuje datum splatnosti!\n      //  PLOHY FAKTURY - ukldaj se do konceptu stejn jako prilohy_dokumenty\n      attachments: [], // Pole ploh faktury (formt stejn jako u objednvek)\n      //  NOV: Per-invoice vcn sprvnost (FZE 7/8) - 1:1 s DB\n      vecna_spravnost_umisteni_majetku: fakturaFormData.vecna_spravnost_umisteni_majetku || '',\n      vecna_spravnost_poznamka: fakturaFormData.vecna_spravnost_poznamka || '',\n      vecna_spravnost_potvrzeno: fakturaFormData.vecna_spravnost_potvrzeno || 0\n    };\n\n    // Pidat do formData.faktury\n    const currentFaktury = Array.isArray(formData.faktury) ? formData.faktury : [];\n    updateFaktury([...currentFaktury, newFaktura]);\n\n    // Reset formule s auto-vyplnnm stedisek z objednvky\n    const dnesniDatum = formatDateForPicker(new Date());\n\n    setFakturaFormData({\n      fa_datum_doruceni: dnesniDatum,\n      fa_dorucena: 1, //  Boolean flag\n      fa_castka: '', //  Przdn - uivatel vypln sm\n      fa_cislo_vema: '',\n      fa_strediska_kod: formData.strediska_kod || [],\n      fa_poznamka: '',\n      fa_splatnost: '',\n      //  NOV: Per-invoice vcn sprvnost\n      vecna_spravnost_umisteni_majetku: '',\n      vecna_spravnost_poznamka: '',\n      vecna_spravnost_potvrzeno: 0\n    });\n    setEditingFaktura(null);\n    setShowAddFakturaForm(false);\n\n    showToast && showToast('Faktura pidna - ulo se s objednvkou', { type: 'success' });\n\n    // Spustit autosave po zmn faktur\n    triggerAutosave(true);\n  };\n\n  const handleUpdateFaktura = async () => {\n    if (!editingFaktura) return;\n\n    // Validace\n    if (!fakturaFormData.fa_datum_doruceni || (typeof fakturaFormData.fa_datum_doruceni === 'string' && fakturaFormData.fa_datum_doruceni.trim() === '')) {\n      showToast && showToast('Datum doruen faktury je povinn', { type: 'error' });\n      return;\n    }\n\n    if (!fakturaFormData.fa_castka || parseFloat(fakturaFormData.fa_castka) <= 0) {\n      console.groupEnd();\n      showToast && showToast('stka faktury je povinn a mus bt vt ne 0', { type: 'error' });\n      return;\n    }\n\n    if (!fakturaFormData.fa_cislo_vema || (typeof fakturaFormData.fa_cislo_vema === 'string' && fakturaFormData.fa_cislo_vema.trim() === '')) {\n      console.groupEnd();\n      showToast && showToast('Variabiln symbol je povinn', { type: 'error' });\n      return;\n    }\n\n    if (!fakturaFormData.fa_splatnost || (typeof fakturaFormData.fa_splatnost === 'string' && fakturaFormData.fa_splatnost.trim() === '')) {\n      console.groupEnd();\n      showToast && showToast('Datum splatnosti je povinn', { type: 'error' });\n      return;\n    }\n\n    try {\n      // Zkontroluj e faktura m reln ID (ne temp-)\n      const isRealInvoice = editingFaktura.id && !String(editingFaktura.id).startsWith('temp-');\n      \n      if (!isRealInvoice) {\n        console.groupEnd();\n        showToast && showToast(formatToastMessage('Pidejte nejprve plohu faktury', 'error'), { type: 'error' });\n        return;\n      }\n\n      //  VYISTIT fa_strediska_kod - zajistit e jsou JEN stringy\n      const cleanedStrediska = Array.isArray(fakturaFormData.fa_strediska_kod)\n        ? fakturaFormData.fa_strediska_kod.map(item => {\n            if (typeof item === 'string') return item;\n            return item.value || item.kod_stavu || item.id || item;\n          })\n        : [];\n\n      // Piprav data pro API update\n      const updateData = {\n        fa_cislo_vema: fakturaFormData.fa_cislo_vema,\n        fa_datum_vystaveni: fakturaFormData.fa_datum_vystaveni || fakturaFormData.fa_datum_doruceni,\n        fa_castka: fakturaFormData.fa_castka,\n        fa_datum_splatnosti: fakturaFormData.fa_splatnost,\n        fa_datum_doruceni: fakturaFormData.fa_datum_doruceni,\n        fa_dorucena: 1,\n        fa_strediska_kod: JSON.stringify(cleanedStrediska),\n        fa_poznamka: fakturaFormData.fa_poznamka || null,\n        rozsirujici_data: fakturaFormData.rozsirujici_data || null,\n        //  RESET: Pi aktualizaci faktury se zru JEN checkbox (umstn a poznmka zstvaj)\n        vecna_spravnost_umisteni_majetku: fakturaFormData.vecna_spravnost_umisteni_majetku || '',\n        vecna_spravnost_poznamka: fakturaFormData.vecna_spravnost_poznamka || '',\n        vecna_spravnost_potvrzeno: 0,\n        potvrdil_vecnou_spravnost_id: null,\n        dt_potvrzeni_vecne_spravnosti: null\n      };\n\n      // Volej API update\n      const response = await updateInvoiceV2({\n        token,\n        username,\n        invoice_id: editingFaktura.id,\n        updateData\n      });\n\n      // Aktualizovat fakturu v loklnm state\n      const currentFaktury = Array.isArray(formData.faktury) ? formData.faktury : [];\n      const updatedFaktury = currentFaktury.map(faktura =>\n        faktura.id === editingFaktura.id\n          ? {\n              ...faktura,\n              ...fakturaFormData,\n              fa_strediska_kod: cleanedStrediska,\n              dt_aktualizace: new Date().toISOString(),\n              fa_dorucena: 1,\n              fa_datum_doruceni: fakturaFormData.fa_datum_doruceni,\n              fa_datum_vystaveni: fakturaFormData.fa_datum_vystaveni || fakturaFormData.fa_datum_doruceni,\n              fa_datum_splatnosti: fakturaFormData.fa_splatnost\n            }\n          : faktura\n      );\n\n      updateFaktury(updatedFaktury);\n\n      // Reset formule\n      const dnesniDatum = formatDateForPicker(new Date());\n      setFakturaFormData({\n        fa_datum_doruceni: dnesniDatum,\n        fa_dorucena: 1,\n        fa_castka: '',\n        fa_cislo_vema: '',\n        fa_strediska_kod: formData.strediska_kod || [],\n        fa_poznamka: '',\n        fa_splatnost: '',\n        //  NOV: Per-invoice vcn sprvnost\n        vecna_spravnost_umisteni_majetku: '',\n        vecna_spravnost_poznamka: '',\n        vecna_spravnost_potvrzeno: 0\n      });\n      setEditingFaktura(null);\n      setShowAddFakturaForm(false);\n\n      showToast && showToast(' Faktura spn aktualizovna', { type: 'success' });\n\n    } catch (err) {\n      console.group(' CHYBA pi aktualizaci faktury');\n      if (err.response) {\n      }\n      console.groupEnd();\n\n      showToast && showToast(`Chyba pi aktualizaci faktury: ${err.message}`, { type: 'error' });\n    }\n  };\n\n  //  Handler pro vyplnn faktury z ISDOC souboru - NOV ATOMICK WORKFLOW\n  const handleISDOCParsed = (isdocData, realFakturaId) => {\n    const currentFaktury = Array.isArray(formData.faktury) ? formData.faktury : [];\n\n    //  KONTROLA: M se UPDATOVAT existujc faktura?\n    if (isdocData._updateExisting) {\n\n      // UPDATOVAT existujc fakturu novmi daty z ISDOC\n      const updatedFaktury = currentFaktury.map(faktura => {\n        if (Number(faktura.id) === Number(realFakturaId)) {\n          const updated = {\n            ...faktura,\n            //  PEPSAT data z ISDOC\n            fa_cislo_vema: isdocData.fa_cislo_vema || faktura.fa_cislo_vema,\n            fa_datum_vystaveni: isdocData.fa_datum_vystaveni || faktura.fa_datum_vystaveni,\n            fa_datum_zdanitelneho_plneni: isdocData.fa_datum_zdanitelneho_plneni || faktura.fa_datum_zdanitelneho_plneni,\n            fa_datum_splatnosti: isdocData.fa_datum_splatnosti || faktura.fa_datum_splatnosti,\n            fa_splatnost: isdocData.fa_datum_splatnosti || faktura.fa_splatnost,\n            fa_datum_doruceni: isdocData.fa_datum_doruceni || faktura.fa_datum_doruceni,\n            fa_castka: isdocData.fa_castka || faktura.fa_castka,\n            fa_castka_bez_dph: isdocData.fa_castka_bez_dph || faktura.fa_castka_bez_dph,\n            fa_dph: isdocData.fa_dph || faktura.fa_dph,\n            fa_poznamka: isdocData.fa_poznamka || faktura.fa_poznamka,\n            fa_strediska_kod: isdocData.fa_strediska_kod || faktura.fa_strediska_kod,\n            fa_dorucena: 1,\n            dt_aktualizace: new Date().toISOString(),\n            _isdoc_parsed: true,\n            _isdoc_polozky: isdocData._isdoc_polozky,\n            _isdoc_dodavatel: isdocData._isdoc_dodavatel,\n            _isdoc_email: isdocData._isdoc_email,\n            _fromISDOC: true\n          };\n\n          return updated;\n        }\n        return faktura;\n      });\n\n      updateFaktury(updatedFaktury);\n\n      //  NAPLNIT HLAVN POLE FORMDATA\n      setFormData(prev => ({\n        ...prev,\n        cislo_faktury: isdocData.fa_cislo_vema || prev.cislo_faktury,\n        datum_faktury: isdocData.fa_datum_vystaveni || prev.datum_faktury,\n        datum_splatnosti: isdocData.fa_datum_splatnosti || prev.datum_splatnosti,\n        castka_bez_dph: isdocData.fa_castka_bez_dph || prev.castka_bez_dph,\n        castka_s_dph: isdocData.fa_castka || prev.castka_s_dph,\n        _isdocRefresh: Date.now()\n      }));\n\n      // Toast odstrann - uivatel vid vyplnn data v formuli\n      setTimeout(() => triggerAutosave(true), 300);\n\n      return; //  KONEC - faktura byla updatovna\n    }\n\n    //  VYTVOEN NOV FAKTURY (pvodn logika)\n    //  VYTVOEN NOV FAKTURY (pvodn logika)\n\n    // Vytvoit novou fakturu s daty z ISDOC + relnm ID z BE\n    const newFaktura = {\n      id: realFakturaId, //  RELN ID z BE\n      objednavka_id: formData.id,\n      // Data z ISDOC\n      fa_cislo_vema: isdocData.fa_cislo_vema || '',\n      fa_datum_vystaveni: isdocData.fa_datum_vystaveni || '',\n      fa_datum_zdanitelneho_plneni: isdocData.fa_datum_zdanitelneho_plneni || '',\n      fa_datum_splatnosti: isdocData.fa_datum_splatnosti || '',\n      fa_splatnost: isdocData.fa_datum_splatnosti || '',\n      fa_datum_doruceni: isdocData.fa_datum_doruceni || getCurrentDateFormatted(),\n      fa_castka: isdocData.fa_castka || '',\n      fa_castka_bez_dph: isdocData.fa_castka_bez_dph || '',\n      fa_dph: isdocData.fa_dph || '',\n      fa_poznamka: isdocData.fa_poznamka || '',\n      fa_strediska_kod: isdocData.fa_strediska_kod || (Array.isArray(formData.strediska_kod) ? formData.strediska_kod : []),\n      fa_dorucena: 1,\n      // Metadata\n      vytvoril_uzivatel_id: user_id,\n      vytvoril_jmeno: getUserNameById(user_id),\n      dt_vytvoreni: new Date().toISOString(),\n      dt_aktualizace: null,\n      aktivni: 1,\n      _isdoc_parsed: true,\n      _isdoc_polozky: isdocData._isdoc_polozky,\n      _isdoc_dodavatel: isdocData._isdoc_dodavatel,\n      _fromISDOC: true, // Flag pro rozpoznn ISDOC faktury\n      //  NOV: Per-invoice vcn sprvnost (przdn pi ISDOC importu)\n      vecna_spravnost_umisteni_majetku: '',\n      vecna_spravnost_poznamka: '',\n      vecna_spravnost_potvrzeno: 0\n    };\n\n    //  KRITICK OPRAVA: Najdi a odstra vechny temp faktury, pak pidej relnou\n    const updatedFaktury = [\n      ...currentFaktury.filter(f => !String(f.id).startsWith('temp-')), // Odstranit vechny temp faktury\n      newFaktura // Pidat novou relnou fakturu\n    ];\n\n    updateFaktury(updatedFaktury);\n\n    //  Nastavit jako editovanou (aby se zobrazila)\n    setEditingFaktura(newFaktura);\n    setFakturaFormData(newFaktura);\n\n    //  NAPLNIT HLAVN POLE FORMDATA DATA Z ISDOC\n    setFormData(prev => ({\n      ...prev,\n      cislo_faktury: newFaktura.fa_cislo_vema || '',\n      datum_faktury: newFaktura.fa_datum_vystaveni || '',\n      datum_splatnosti: newFaktura.fa_datum_splatnosti || '',\n      castka_bez_dph: newFaktura.fa_castka_bez_dph || '', //  OPRAVEN KL\n      castka_s_dph: newFaktura.fa_castka || '',           //  OPRAVEN KL\n      _isdocRefresh: Date.now()\n    }));\n\n    // Toast odstrann - uivatel vid vyplnn data v formuli\n\n    // Spustit autosave\n    setTimeout(() => triggerAutosave(true), 300);\n  };\n\n  // Smazat fakturu - zobraz confirm dialog\n  const handleDeleteFaktura = async (fakturaId) => {\n    // Najdi fakturu\n    const faktura = formData.faktury?.find(f => f.id === fakturaId);\n    if (!faktura) return;\n\n    // Kontrola ploh - nati ze serveru pokud m reln ID\n    let prilohyCount = 0;\n\n    if (fakturaId && !String(fakturaId).startsWith('temp-')) {\n      try {\n        const response = await listInvoiceAttachments(\n          fakturaId,  // invoiceId\n          username,   // username\n          token,      // token\n          formData.id  // orderId\n        );\n\n        prilohyCount = (response.data?.attachments || response.data || []).length;\n      } catch (err) {\n      }\n    }\n\n    // Zobrazit confirm dialog\n    setDeleteFacturaDialog({\n      isOpen: true,\n      fakturaId: fakturaId,\n      fakturaNazev: faktura.fa_cislo_vema || `Faktura ${faktura.id}`,\n      pocetPriloh: prilohyCount\n    });\n  };\n\n  // Potvrzen smazn faktury z dialogu\n  const confirmDeleteFaktura = async () => {\n    const { fakturaId, pocetPriloh } = deleteFacturaDialog;\n\n    // Zavt dialog\n    setDeleteFacturaDialog({ isOpen: false, fakturaId: null, fakturaNazev: '', pocetPriloh: 0 });\n\n    if (!fakturaId) return;\n\n    try {\n      // Kontrola, zda je faktura uloen v DB (reln ID, ne temp-xxx)\n      const isRealInvoice = fakturaId && !String(fakturaId).startsWith('temp-');\n\n      // 1. Pokud m plohy, sma je ze serveru\n      if (isRealInvoice && pocetPriloh > 0) {\n        try {\n          const response = await listInvoiceAttachments(\n            fakturaId,  // invoiceId\n            username,   // username\n            token,      // token\n            formData.id  // orderId\n          );\n\n          const prilohy = response.data?.attachments || response.data || [];\n\n          // Sma kadou plohu\n          for (const priloha of prilohy) {\n            try {\n              await deleteInvoiceAttachment(\n                fakturaId,    // invoiceId\n                priloha.id,   // attachmentId\n                username,     // username\n                token         // token\n              );\n            } catch (err) {\n              // Technick detaily odstranny - uivatel vid jen lidskou zprvu\n              showToast && showToast('Nepodailo se smazat plohu faktury', { type: 'error' });\n            }\n          }\n\n          //  Toast odstrann - uivatel vid, e plohy zmizely ze seznamu\n          // if (prilohy.length > 0) {\n          //   showToast && showToast(`Smazno ${prilohy.length} ploh faktury`, { type: 'success' });\n          // }\n        } catch (err) {\n          showToast && showToast('Nepodailo se smazat plohy faktury', { type: 'error' });\n        }\n      }\n\n      // 2. Pokud je faktura uloen v DB, sma ji ze serveru (hard delete - smae i soubory)\n      if (isRealInvoice) {\n        try {\n          //  V2 API: deleteInvoiceV2(invoiceId, token, username, hardDelete=true)\n          await deleteInvoiceV2(fakturaId, token, username, true);\n          showToast && showToast(' Faktura i plohy byly trvale smazny', { type: 'success' });\n        } catch (err) {\n          showToast && showToast('Nepodailo se smazat fakturu', { type: 'error' });\n          // Pokrauj i pi chyb - odeber fakturu alespo lokln\n        }\n      }\n\n      // 3. LOKLN ODEBRN - odstranit fakturu ze seznamu\n      const currentFaktury = Array.isArray(formData.faktury) ? formData.faktury : [];\n      const updatedFaktury = currentFaktury.filter(f => f.id !== fakturaId);\n      updateFaktury(updatedFaktury);\n\n      //  Toast odstrann - autosave v pozad, faktura zmizela ze seznamu\n      // if (!isRealInvoice) {\n      //   showToast && showToast('Faktura odebrna - zmna se ulo s objednvkou', { type: 'success' });\n      // }\n\n      // Spustit autosave po smazn faktury\n      triggerAutosave(true);\n\n    } catch (err) {\n      showToast && showToast('Nepodailo se smazat fakturu', { type: 'error' });\n    }\n  };\n\n  // Zat editovat fakturu\n  const handleEditFaktura = (faktura) => {\n    setEditingFaktura(faktura);\n\n    //  PARSOVN stedisek: DB JSON string kd  FE objekty s nzvy\n    let strediskaArray = [];\n    if (faktura.fa_strediska_kod) {\n      if (Array.isArray(faktura.fa_strediska_kod)) {\n        strediskaArray = faktura.fa_strediska_kod; // U je pole objekt\n      } else if (typeof faktura.fa_strediska_kod === 'string') {\n        try {\n          // Parsuj JSON: [\"KLADNO\",\"BENESOV\"] nebo [{kod_stavu, nazev_stavu}]\n          const parsed = JSON.parse(faktura.fa_strediska_kod) || [];\n          // Transformuj kdy na objekty s nzvy\n          strediskaArray = parsed.map(item => {\n            if (typeof item === 'object' && item.kod_stavu) {\n              return item; // U je objekt\n            }\n            // Je to jen kd  najt v options\n            const stredisko = strediskaOptions.find(opt =>\n              opt.kod_stavu === item || opt.kod === item || opt.value === item\n            );\n            return stredisko ? {\n              kod_stavu: stredisko.kod_stavu || stredisko.kod || stredisko.value,\n              nazev_stavu: stredisko.nazev_stavu || stredisko.nazev || stredisko.label\n            } : { kod_stavu: item, nazev_stavu: item };\n          });\n        } catch (e) {\n          // Fallback pro star formt (comma-separated stringy)\n          strediskaArray = faktura.fa_strediska_kod.split(',').map(s => s.trim()).filter(Boolean);\n        }\n      }\n    }\n\n    // Pro nov faktury nebo faktury bez data doruen nastavit dnen datum\n    const dnesniDatum = formatDateForPicker(new Date());\n\n    setFakturaFormData({\n      fa_datum_doruceni: faktura.fa_datum_doruceni || dnesniDatum,\n      fa_dorucena: faktura.fa_dorucena || 1, //  Boolean flag\n      fa_castka: faktura.fa_castka || '', //  Neauto-vyplovat pi editaci\n      fa_cislo_vema: faktura.fa_cislo_vema || '',\n      fa_strediska_kod: strediskaArray,\n      fa_poznamka: faktura.fa_poznamka || '',\n      fa_splatnost: faktura.fa_splatnost || (faktura.fa_datum_splatnosti ? faktura.fa_datum_splatnosti.split(' ')[0] : ''), //  DB -> FE: fa_datum_splatnosti -> fa_splatnost\n      //  NOV: Per-invoice vcn sprvnost\n      vecna_spravnost_umisteni_majetku: faktura.vecna_spravnost_umisteni_majetku || '',\n      vecna_spravnost_poznamka: faktura.vecna_spravnost_poznamka || '',\n      vecna_spravnost_potvrzeno: faktura.vecna_spravnost_potvrzeno || 0\n    });\n    setShowAddFakturaForm(true);\n  };\n\n  // Zruit pidn/editaci faktury\n  const handleCancelFakturaForm = () => {\n    const dnesniDatum = formatDateForPicker(new Date());\n\n    setFakturaFormData({\n      fa_datum_doruceni: dnesniDatum,\n      fa_dorucena: 1, //  Boolean flag\n      fa_castka: '', //  Przdn - uivatel vypln sm\n      fa_cislo_vema: '',\n      fa_strediska_kod: formData.strediska_kod || [],\n      fa_poznamka: '',\n      fa_splatnost: '',\n      //  NOV: Per-invoice vcn sprvnost\n      vecna_spravnost_umisteni_majetku: '',\n      vecna_spravnost_poznamka: '',\n      vecna_spravnost_potvrzeno: 0\n    });\n    setEditingFaktura(null);\n    setShowAddFakturaForm(false);\n  };\n\n  // ========================================\n  // PLOHY FAKTUR - Sprva podle vzoru ploh objednvek\n  // ========================================\n\n  /**\n   * Validace faktury pro pidn ploh\n   * @param {Object} faktura - Objekt faktury\n   * @param {File} file - Nahrvan soubor (voliteln, pro detekci ISDOC)\n   * @returns {Object} { isValid: boolean, valid: boolean, isISDOC: boolean, missingFields: string[], message: string }\n   * \n   * Pravidla:\n   * - ISDOC soubory lze nahrt KDYKOLIV (i bez vyplnnch pol) - automatick vyten hodnot\n   * - Bn soubory vyaduj vyplnn povinn pole (fa_cislo_vema, fa_castka, fa_datum_doruceni, fa_splatnost)\n   */\n  const validateInvoiceForAttachments = useCallback((faktura, file = null) => {\n    const missingFields = [];\n    \n    // Kontrola povinnch pol\n    if (!faktura.fa_cislo_vema || (typeof faktura.fa_cislo_vema === 'string' && faktura.fa_cislo_vema.trim() === '')) {\n      missingFields.push('slo faktury VEMA');\n    }\n    \n    if (!faktura.fa_castka || parseFloat(faktura.fa_castka) <= 0) {\n      missingFields.push('stka');\n    }\n    \n    if (!faktura.fa_datum_doruceni || (typeof faktura.fa_datum_doruceni === 'string' && faktura.fa_datum_doruceni.trim() === '')) {\n      missingFields.push('Datum doruen');\n    }\n    \n    if (!faktura.fa_splatnost || (typeof faktura.fa_splatnost === 'string' && faktura.fa_splatnost.trim() === '')) {\n      missingFields.push('Datum splatnosti');\n    }\n    \n    // Detekce ISDOC souboru\n    const isISDOC = file && (\n      file.name?.toLowerCase().endsWith('.isdoc') ||\n      file.name?.toLowerCase().endsWith('.isdocx') ||\n      file.type === 'text/isdoc'\n    );\n\n    //  ISDOC soubory - vdy povolit (monost vyten hodnot)\n    if (isISDOC) {\n      return {\n        isValid: true,          // Vdy TRUE pro ISDOC\n        valid: true,\n        isISDOC: true,\n        missingFields: missingFields, // Informativn (pro ppadn automatick doplnn)\n        message: missingFields.length > 0 \n          ? 'ISDOC soubor - data lze automaticky vytit po nahrn' \n          : 'ISDOC soubor pipraven k nahrn'\n      };\n    }\n\n    //  Bn soubory - vyadovat vyplnn pole\n    if (missingFields.length > 0) {\n      return {\n        isValid: false,         // FALSE - blokovat nahrvn\n        valid: false,\n        isISDOC: false,\n        missingFields: missingFields,\n        message: `Pro nahrn plohy vyplte nejprve: ${missingFields.join(', ')}`\n      };\n    }\n    \n    //  Vechna pole vyplnna - povolit nahrvn\n    return {\n      isValid: true,\n      valid: true,\n      isISDOC: false,\n      missingFields: [],\n      message: 'Pipraven k nahrn'\n    };\n  }, []);\n\n  /**\n   * Handler pro zmnu ploh faktury\n   * Vol se z InvoiceAttachmentsCompact komponenty\n   * @param {string} fakturaId - ID faktury (temp-xxx nebo reln)\n   * @param {Array} newAttachments - Nov pole ploh\n   */\n  const handleInvoiceAttachmentsChange = useCallback((fakturaId, newAttachments) => {\n    //  OPRAVA: Pokud attachments maj faktura_id, pouij to jako skuten ID\n    let realFakturaId = fakturaId;\n    if (newAttachments.length > 0 && newAttachments[0].faktura_id) {\n      realFakturaId = newAttachments[0].faktura_id;\n    }\n\n    //  DETEKCE POKLADNHO DOKLADU podle klasifikace ploh\n    const hasPokladniDoklad = newAttachments.some(att => {\n      const klasifikace = att.klasifikace || att.typ_prilohy || '';\n      return klasifikace.toLowerCase().includes('pokladn') ||\n             klasifikace.toLowerCase().includes('paragon');\n    });\n\n    //  FUNKN UPDATE - pouij aktuln state, ne closure\n    setFormData(prev => {\n      const updatedFaktury = (prev.faktury || []).map(f => {\n        // Porovnej jak pvodn ID, tak reln ID\n        if (f.id === fakturaId || f.id === realFakturaId || String(f.id) === String(realFakturaId)) {\n          return {\n            ...f,\n            attachments: newAttachments,\n            _isPokladna: hasPokladniDoklad //  Nastavit pznak podle klasifikace\n          };\n        }\n        return f;\n      });\n\n      return { ...prev, faktury: updatedFaktury };\n    });\n\n    // Spustit autosave (plohy se ulo do konceptu)\n    triggerAutosave(true);\n  }, []);\n\n  /**\n   *  Handler pro vytvoen faktury v DB (z temp ID na reln ID)\n   * Vol se z InvoiceAttachmentsCompact pi pokusu o upload plohy s temp ID\n   * @param {string} tempFakturaId - Temp ID faktury (temp-xxx)\n   * @returns {Promise<number>} - Reln ID faktury z DB\n   */\n  const handleCreateInvoiceInDB = useCallback(async (tempFakturaId) => {\n    try {\n      // Najdi fakturu podle temp ID\n      const faktura = formData.faktury?.find(f => f.id === tempFakturaId);\n      if (!faktura) {\n        throw new Error(`Faktura s ID ${tempFakturaId} nebyla nalezena`);\n      }\n\n      // Validace povinnch pol\n      if (!faktura.fa_cislo_vema) {\n        throw new Error('Vyplte slo faktury');\n      }\n      if (!faktura.fa_datum_doruceni) {\n        throw new Error('Vyplte datum doruen');\n      }\n      if (!faktura.fa_castka) {\n        throw new Error('Vyplte stku faktury');\n      }\n      if (!faktura.fa_strediska_kod || faktura.fa_strediska_kod.length === 0) {\n        throw new Error('Vyberte alespo jedno stedisko');\n      }\n\n      // Zkontroluj e objednvka je uloen\n      const orderId = formData.id || formData.id;\n      if (!orderId) {\n        throw new Error('Nejdv ulote objednvku');\n      }\n\n      // Piprav stediska - extrahuj jen kdy z objekt\n      let strediskaKody = [];\n      if (faktura.fa_strediska_kod && Array.isArray(faktura.fa_strediska_kod)) {\n        strediskaKody = faktura.fa_strediska_kod.map(item => {\n          if (typeof item === 'object' && item.kod_stavu) {\n            return item.kod_stavu; // Objekt  extrahuj kod_stavu\n          }\n          return item; // U je string  pouij pmo\n        });\n      }\n\n      //  DEBUG: Payload ped odeslnm\n      const invoicePayload = {\n        token,\n        username,\n        order_id: orderId,\n        fa_cislo_vema: faktura.fa_cislo_vema,\n        fa_datum_vystaveni: faktura.fa_datum_doruceni,\n        fa_castka: faktura.fa_castka,\n        fa_datum_splatnosti: faktura.fa_splatnost || null,\n        fa_datum_doruceni: faktura.fa_datum_doruceni,\n        fa_dorucena: faktura.fa_dorucena || 1,\n        fa_strediska_kod: JSON.stringify(strediskaKody),\n        fa_poznamka: faktura.fa_poznamka || null,\n        rozsirujici_data: faktura.rozsirujici_data || null\n      };\n\n      // Vytvo fakturu v DB pomoc createInvoiceV2\n      const response = await createInvoiceV2(invoicePayload);\n\n      const realFakturaId = response.data?.invoice_id || response.invoice_id;\n      if (!realFakturaId) {\n        throw new Error('Backend nevrtil ID faktury');\n      }\n\n      // Aktualizuj fakturu v state (temp ID  reln ID)\n      setFormData(prev => {\n        const updatedFaktury = (prev.faktury || []).map(f =>\n          f.id === tempFakturaId\n            ? {\n                ...f,\n                id: realFakturaId,\n                _isNew: false // U nen nov, je v DB\n              }\n            : f\n        );\n        return { ...prev, faktury: updatedFaktury };\n      });\n\n      return realFakturaId;\n\n    } catch (err) {\n      console.group(' CHYBA pi vytven faktury v DB');\n      if (err.response) {\n      }\n      console.groupEnd();\n      throw err;\n    }\n  }, [formData, formData.id, token, username]);\n\n  /**\n   * Handler po spnm uploadu plohy faktury\n   * Pokud m faktura temp ID, vytvo fakturu v DB a zsk reln ID\n   * @param {string} fakturaId - ID faktury\n   * @param {object} uploadedAttachment - Nahran ploha\n   */\n  const handleInvoiceAttachmentUploaded = useCallback(async (fakturaId, uploadedAttachment) => {\n    // Pokud je ID temp, musme vytvoit fakturu v DB\n    if (String(fakturaId).startsWith('temp-')) {\n      // Faktura se vytvo v DB pi ptm uloen objednvky (saveOrderToAPI)\n      // Po uloen dostane reln ID a plohy se automaticky propoj\n    }\n\n    // Spustit autosave\n    triggerAutosave(true);\n  }, []);\n\n  // ========================================\n  // KONEC PLOHY FAKTUR\n  // ========================================\n\n  // Automatick vytvoen prvn faktury (pokud nen pokladn objednvka)\n  const ensureMinimalFaktura = () => {\n    // Pouze pokud je objednvka uloen a nen pokladn\n    if (!formData.id) return;\n\n    // Zkontroluj, zda nen pokladn objednvka (kontrola dodavatele atd.)\n    // TODO: Doplnit kontrolu podle logiky dodavatele/pokladny\n\n    if ((formData.faktury?.length || 0) === 0 && !showAddFakturaForm) {\n      const dnesniDatum = formatDateForPicker(new Date());\n\n      // Automaticky otevi formul s pedvyplnnmi stedisky\n      setFakturaFormData({\n        fa_datum_doruceni: dnesniDatum, //  Sprvn pole pro datum\n        fa_dorucena: 1, //  Boolean flag\n        fa_castka: '', //  Przdn - uivatel vypln sm\n        fa_cislo_vema: '',\n        fa_strediska_kod: formData.strediska_kod || [],\n        fa_poznamka: '',\n        fa_splatnost: '',\n        //  NOV: Per-invoice vcn sprvnost\n        vecna_spravnost_umisteni_majetku: '',\n        vecna_spravnost_poznamka: '',\n        vecna_spravnost_potvrzeno: 0\n      });\n      setShowAddFakturaForm(true);\n    }\n  };\n\n  //  ZRUENO: Automatick reinicializace stky faktury pi zmn cen\n  // Uivatel vypln stku run\n  // useEffect(() => {\n  //   if (totalPrice > 0 &&\n  //       (!fakturaFormData.fa_castka || fakturaFormData.fa_castka === '')) {\n  //     const predpokladanaCastka = totalPrice.toString();\n\n  //  AUTOMATICK VYTVOEN PRVN FAKTURY pi zobrazen sekce Fakturace\n  useEffect(() => {\n    // Pouze pokud:\n    // 1. Objednvka je uloen (formData.id)\n    // 2. Pole faktur je przdn\n    // 3. Sekce nen zamen\n    // 4. Jsme ve fzi 7+ (UVEREJNENA - zobrazuje se Fakturace)\n    const faktury = formData.faktury || [];\n\n    if (formData.id &&\n        faktury.length === 0 &&\n        !shouldLockFaktury &&\n        currentPhase >= 7) {\n\n      const dnesniDatum = formatDateForPicker(new Date());\n      const user_id = parseInt(localStorage.getItem('user_id'), 10);\n\n      const firstFaktura = {\n        id: `temp-${Date.now()}`,\n        objednavka_id: formData.id,\n        fa_datum_doruceni: dnesniDatum,\n        fa_dorucena: 1,\n        fa_castka: '',\n        fa_cislo_vema: '',\n        fa_strediska_kod: Array.isArray(formData.strediska_kod) ? formData.strediska_kod : [],\n        fa_poznamka: '',\n        fa_splatnost: '',\n        vytvoril_uzivatel_id: user_id,\n        vytvoril_jmeno: getUserNameById(user_id),\n        dt_vytvoreni: new Date().toISOString(),\n        dt_aktualizace: null,\n        aktivni: 1,\n        _isNew: true,\n        //  NOV: Per-invoice vcn sprvnost\n        vecna_spravnost_umisteni_majetku: '',\n        vecna_spravnost_poznamka: '',\n        vecna_spravnost_potvrzeno: 0\n      };\n\n      // Pidat prvn fakturu do state\n      updateFaktury([firstFaktura]);\n      setEditingFaktura(firstFaktura);\n      setFakturaFormData({\n        fa_datum_doruceni: dnesniDatum,\n        fa_dorucena: 1,\n        fa_castka: '',\n        fa_cislo_vema: '',\n        fa_strediska_kod: formData.strediska_kod || [],\n        fa_poznamka: '',\n        fa_splatnost: '',\n        //  NOV: Per-invoice vcn sprvnost\n        vecna_spravnost_umisteni_majetku: '',\n        vecna_spravnost_poznamka: '',\n        vecna_spravnost_potvrzeno: 0\n      });\n    }\n  }, [formData.id, formData.faktury?.length, shouldLockFaktury, currentPhase]);\n  //     const dnesniDatum = formatDateForPicker(new Date());\n  //\n  //     setFakturaFormData(prev => ({\n  //       ...prev,\n  //       fa_datum_doruceni: prev.fa_datum_doruceni || dnesniDatum,\n  //       fa_dorucena: prev.fa_dorucena || 1,\n  //       fa_castka: predpokladanaCastka\n  //     }));\n  //   }\n  // }, [totalPrice]);\n\n  //  REMOVED: loadStrediska() - DEPRECATED\n  // selnky se nyn nataj pes useFormController  useDictionaries.loadAll()\n\n  //  REMOVED: loadPrilohyTypy() - DEPRECATED\n  // selnky se nyn nataj pes useFormController  useDictionaries.loadAll()\n\n  //  REMOVED: loadDruhyObjednavky() - DEPRECATED\n  // selnky se nyn nataj pes useFormController  useDictionaries.loadAll()\n\n  //  REMOVED: loadFinancovani() - DEPRECATED\n  // selnky se nyn nataj pes useFormController  useDictionaries.loadAll()\n\n  //  REMOVED: loadLpKody() - DEPRECATED\n  // selnky se nyn nataj pes useFormController  useDictionaries.loadAll()\n\n  const loadNextOrderNumber = async () => {\n    //  KRITICK: Next-number jen pro NOV objednvky!\n    // Po uloen do DB  pouvat ev_cislo z DB\n\n    // 1 Zkontrolovat formData.id (uloeno v DB)\n    if (formData.id) {\n      return false;\n    }\n\n    // 2 Zkontrolovat metadata\n    const metadata = draftManager.getMetadata();\n    const isInEditMode = isEditMode || metadata?.isEditMode === true;\n\n    if (isInEditMode) {\n      return false;\n    }\n\n    // 3 Pokud mme ev_cislo (ne \"Natm...\"), skipnout\n    if (formData.ev_cislo && formData.ev_cislo !== 'Natm...') {\n      return false;\n    }\n\n    // 4 Zkontrolovat URL parametry\n    const urlParams = new URLSearchParams(window.location.search);\n    const editOrderId = urlParams.get('edit');\n    if (editOrderId) {\n      return false;\n    }\n\n    //  EEN PROBLMU #1: Aktivuj loading state\n    setIsLoadingEvCislo(true);\n\n    try {\n      //  EEN PROBLMU #2: V2 API s retry mechanismem (bude pidn do apiOrderV2.js)\n      const orderNumberData = await getNextOrderNumberV2(token, username);\n      const nextNumber = orderNumberData.next_order_string || orderNumberData.order_number_string || orderNumberData.next_number;\n\n      if (!nextNumber) {\n        throw new Error(`API nevrtilo next_order_string`);\n      }\n\n      //  DOUBLE CHECK ped nastavenm\n      if (formData.id || isEditMode || metadata?.isEditMode === true || editOrderId) {\n        return false;\n      }\n\n      setFormData(prev => ({\n        ...prev,\n        ev_cislo: nextNumber\n      }));\n\n      return true;\n    } catch (error) {\n\n      //  EEN PROBLMU #1: Fallback na null msto \"Natm...\"\n      setFormData(prev => ({\n        ...prev,\n        ev_cislo: null\n      }));\n\n      //  Zobraz uivateli error toast\n      showToast?.(formatToastMessage('Nepodailo se nast evidenn slo. Zkuste strnku obnovit.', 'error'), { type: 'error' });\n\n      return false;\n    } finally {\n      //  EEN PROBLMU #1: Vdy vypni loading state\n      setIsLoadingEvCislo(false);\n    }\n  };\n\n  // Funkce pro prci s koncepty - ORDER25 SYSTEM\n  const getOrder25DraftKey = () => `order25_draft_new_${user_id}`;\n\n  //  Uloen stavu sekc pes DraftManager\n  const saveSectionStates = (states) => {\n    if (!user_id) return;\n    try {\n      draftManager.saveUIState({ sectionState: states });\n    } catch (error) {\n      // Error saving section states\n    }\n  };\n\n  //  Naten stavu sekc pes DraftManager\n  const loadSectionStates = () => {\n    if (!user_id) return null;\n    try {\n      const uiState = draftManager.getUIState();\n      return uiState?.sectionState || null;\n    } catch (error) {\n      // Error loading section states\n      return null;\n    }\n  };\n\n  //  Uloen pozice scrollu pes DraftManager\n\n  //  Naten pozice scrollu pes DraftManager\n  const loadScrollPosition = () => {\n    if (!user_id) return;\n\n    try {\n      const uiState = draftManager.getUIState();\n      const scrollPos = uiState?.scrollPosition;\n      const scrollElementSelector = uiState?.scrollElementSelector || 'main';\n\n      if (scrollPos !== undefined && scrollPos !== null) {\n        if (!isNaN(scrollPos) && scrollPos > 0) {\n          // Delay pro zajitn, e je obsah naten\n          setTimeout(() => {\n            const targetElement = document.querySelector(scrollElementSelector);\n\n            if (targetElement) {\n              targetElement.scrollTop = scrollPos;\n\n              // Pokud scrollTop zstal 0, zkus scroll pes window\n              if (targetElement.scrollTop === 0 && scrollPos > 0) {\n                window.scrollTo({\n                  top: scrollPos,\n                  left: 0,\n                  behavior: 'instant'\n                });\n\n                // Pokud ani window nefunguje, zkus najt prvn scrollovateln child\n                const scrollableChild = Array.from(targetElement.querySelectorAll('*')).find(el => {\n                  const style = window.getComputedStyle(el);\n                  return style.overflowY === 'auto' || style.overflowY === 'scroll';\n                });\n\n                if (scrollableChild) {\n                  scrollableChild.scrollTop = scrollPos;\n                }\n              }\n            } else {\n              window.scrollTo({\n                top: scrollPos,\n                left: 0,\n                behavior: 'instant'\n              });\n            }\n\n            addDebugLog('success', 'UI', 'scroll-restore', `Obnovena pozice scrollu: ${scrollPos}px`);\n          }, 500);\n        }\n      }\n    } catch (error) {\n      // Error loading scroll position\n    }\n  };\n\n  // Progress indiktor a pesmrovn po spnm uloen\n  //  skipUnlock: Pro ADMIN/SUPERADMIN nezamykme - zstvaj editovat\n  const startSaveProgressAndRedirect = (orderNumber, orderId, skipUnlock = false) => {\n    //  Spustit progress pes DraftManager (automaticky zake autosave)\n    setShowSaveProgress(true);\n    setSaveProgress(0);\n    setSaveProgressText('Ukldm objednvku...');\n\n    // Odemkni objednvku na pozad (POKUD NEN skipUnlock)\n    (async () => {\n      const unlockOrderId = orderId; // NOTE: sourceOrderIdForUnlock removed, using orderId directly\n      if (unlockOrderId && token && username && !skipUnlock) {\n        try {\n          await unlockOrderV2({ token, username, orderId: unlockOrderId });\n        } catch (error) {\n          // Ignoruj chybu odemykn\n        }\n      }\n      setIsChanged(false);\n    })();\n\n    //  Spustit progress pes DraftManager\n    const progressControl = draftManager.startProgress({\n      duration: 1000, //  Zkrceno z 3000ms na 1000ms (2 sekundy krat)\n      onProgress: (percent) => {\n        setSaveProgress(percent);\n      },\n      onComplete: () => {\n        //  Uloit highlightOrderId pes DraftManager\n        if (orderNumber && user_id) {\n          draftManager.saveUIState({ highlightOrderId: orderNumber });\n        }\n\n        //  OPRAVEN POAD PRO BN UIVATELE:\n        // 1. Reset MenuBaru PED navigac\n        broadcastOrderState({\n          isEditMode: false,\n          orderId: null,\n          orderNumber: ''\n        });\n\n        // 2. Zruit status editace\n        setIsEditMode(false);\n\n        // 3. Pokej 50ms, aby se broadcast propagoval\n        setTimeout(() => {\n          // 4. Pepnout na seznam objednvek\n          navigate('/orders25-list', { replace: true });\n          \n          // 5. Skrt progress a ukonit ukldn\n          setShowSaveProgress(false);\n          setIsSaving(false);\n        }, 50);\n      }\n    });\n\n    // Uloit control pro mon zruen\n    // (meme pout nap. pi zavrn formule)\n    window._activeProgressControl = progressControl;\n  };\n\n  // Pomocn funkce pro odesln notifikac pi zmnch stavu objednvky\n  //  MIGRACE NA NOV BACKEND API (commit 3a28a99)\n  // Backend automaticky napln 50+ placeholder z order_id\n  //  ROZEN PRAVIDLA NOTIFIKAC (01.11.2025)\n  const sendOrderNotifications = async (orderId, orderNumber, newWorkflowState, oldWorkflowState, formData) => {\n    try {\n      // Pokud se stav nezmnil, nic neposlej\n      if (oldWorkflowState && newWorkflowState === oldWorkflowState) {\n        return;\n      }\n\n\n      //  NOV VERZE - Backend API s automatickmi placeholdery\n\n      // Detekce typu notifikace podle zmny stavu\n      let notificationType = null;\n      let recipientUserIds = new Set();\n\n      // === 1. NOV OBJEDNVKA / ODESLNA KE SCHVLEN ===\n      // Pjemci: garant, pkazce, pp. schvalovatel\n      // Vyjmka: pokud je aktuln uivatel pkazcem, dostane notifikaci\n      const hasKeSchvaleni = hasWorkflowState(newWorkflowState, 'ODESLANA_KE_SCHVALENI');\n      const hadKeSchvaleni = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'ODESLANA_KE_SCHVALENI') : false;\n\n      if (hasKeSchvaleni && !hadKeSchvaleni) {\n        notificationType = 'order_status_ke_schvaleni';\n\n\n        if (formData.garant_uzivatel_id) {\n          recipientUserIds.add(parseInt(formData.garant_uzivatel_id));\n        }\n        if (formData.prikazce_id) {\n          recipientUserIds.add(parseInt(formData.prikazce_id));\n        }\n        if (formData.schvalovatel_id) {\n          recipientUserIds.add(parseInt(formData.schvalovatel_id));\n        }\n      }\n\n      // === 2. STAV SCHVLEN - SCHVLENA / ZAMTNUTA ===\n      // Pjemci: vdy objednatel, garant\n      // Pkazce JEN pokud je jin ne schvalovatel\n      const hasSchvalena = hasWorkflowState(newWorkflowState, 'SCHVALENA');\n      const hadSchvalena = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'SCHVALENA') : false;\n\n      const hasZamitnuta = hasWorkflowState(newWorkflowState, 'ZAMITNUTA');\n      const hadZamitnuta = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'ZAMITNUTA') : false;\n\n      if ((hasSchvalena && !hadSchvalena) || (hasZamitnuta && !hadZamitnuta)) {\n        notificationType = hasSchvalena ? 'order_status_schvalena' : 'order_status_zamitnuta';\n\n\n        // Vdy: objednatel a garant\n        if (formData.objednatel_id) {\n          recipientUserIds.add(parseInt(formData.objednatel_id));\n        }\n        if (formData.garant_uzivatel_id) {\n          recipientUserIds.add(parseInt(formData.garant_uzivatel_id));\n        }\n\n        // Pkazce JEN pokud je jin ne schvalovatel\n        if (formData.prikazce_id && formData.schvalovatel_id &&\n            parseInt(formData.prikazce_id) !== parseInt(formData.schvalovatel_id)) {\n          recipientUserIds.add(parseInt(formData.prikazce_id));\n        } else if (formData.prikazce_id) {\n        }\n      }\n\n      // Objednvka ek (CEKA_SE) - schvalovatel vrtil k doplnn\n      const hasCekaSe = hasWorkflowState(newWorkflowState, 'CEKA_SE');\n      const hadCekaSe = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'CEKA_SE') : false;\n\n      if (hasCekaSe && !hadCekaSe) {\n        notificationType = 'order_status_ceka_se';\n\n        // Pro ek: objednatel a garant\n        if (formData.objednatel_id) {\n          recipientUserIds.add(parseInt(formData.objednatel_id));\n        }\n        if (formData.garant_uzivatel_id) {\n          recipientUserIds.add(parseInt(formData.garant_uzivatel_id));\n        }\n      }\n\n      // === 3. STAV ODESLN - ODESLANA DODAVATELI ===\n      // Pjemci: VICHNI zastnn (objednatel, garant, pkazce, schvalovatel)\n      // Uniktn *_id - pokud je nkdo ve vce rolch, notifikace jen jednou\n      const hasOdeslana = hasWorkflowState(newWorkflowState, 'ODESLANA');\n      const hadOdeslana = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'ODESLANA') : false;\n\n      if (hasOdeslana && !hadOdeslana) {\n        notificationType = 'order_status_odeslana';\n\n\n        // VICHNI zastnn (Set zajist uniktnost)\n        if (formData.objednatel_id) recipientUserIds.add(parseInt(formData.objednatel_id));\n        if (formData.garant_uzivatel_id) recipientUserIds.add(parseInt(formData.garant_uzivatel_id));\n        if (formData.prikazce_id) recipientUserIds.add(parseInt(formData.prikazce_id));\n        if (formData.schvalovatel_id) recipientUserIds.add(parseInt(formData.schvalovatel_id));\n      }\n\n      // === 4. POTVRZEN DODAVATELE - POTVRZENA ===\n      // Pjemci: VICHNI zastnn (objednatel, garant, pkazce, schvalovatel)\n      // Uniktn *_id - pokud je nkdo ve vce rolch, notifikace jen jednou\n      const hasPotvrzena = hasWorkflowState(newWorkflowState, 'POTVRZENA');\n      const hadPotvrzena = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'POTVRZENA') : false;\n\n      if (hasPotvrzena && !hadPotvrzena) {\n        notificationType = 'order_status_potvrzena';\n\n\n        // VICHNI zastnn (Set zajist uniktnost)\n        if (formData.objednatel_id) recipientUserIds.add(parseInt(formData.objednatel_id));\n        if (formData.garant_uzivatel_id) recipientUserIds.add(parseInt(formData.garant_uzivatel_id));\n        if (formData.prikazce_id) recipientUserIds.add(parseInt(formData.prikazce_id));\n        if (formData.schvalovatel_id) recipientUserIds.add(parseInt(formData.schvalovatel_id));\n      }\n\n      // === 5. REGISTR - EK NA SCHVLEN ===\n      // TODO: Pokud se m schvalovat, notifikace uivatelm s prvy VEREJNE_ZAKAZKY\n      // Zatm ponechno pro budouc implementaci - vyaduje naten uivatel podle prv\n\n      // === 6. REGISTR - ZVEEJNNA ===\n      // Pjemci: garant, objednatel, pkazce, schvalovatel\n      // Uniktn *_id - pokud je nkdo ve vce rolch, notifikace jen jednou\n      const hasUverejnena = hasWorkflowState(newWorkflowState, 'UVEREJNENA');\n      const hadUverejnena = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'UVEREJNENA') : false;\n\n      if (hasUverejnena && !hadUverejnena) {\n        notificationType = 'order_status_registr_zverejnena'; //  OPRAVENO: pouvat sprvn nzev z DB\n\n\n        // VICHNI zastnn (Set zajist uniktnost)\n        if (formData.garant_uzivatel_id) recipientUserIds.add(parseInt(formData.garant_uzivatel_id));\n        if (formData.objednatel_id) recipientUserIds.add(parseInt(formData.objednatel_id));\n        if (formData.prikazce_id) recipientUserIds.add(parseInt(formData.prikazce_id));\n        if (formData.schvalovatel_id) recipientUserIds.add(parseInt(formData.schvalovatel_id));\n      }\n\n      // === 6b. REGISTR - EK NA ZVEEJNN (NEUVEREJNENA) ===\n      // Pjemci: uivatel s prvy VEREJNE_ZAKAZKY + garant\n      const hasNeuverejnena = hasWorkflowState(newWorkflowState, 'NEUVEREJNENA');\n      const hadNeuverejnena = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'NEUVEREJNENA') : false;\n\n      if (hasNeuverejnena && !hadNeuverejnena) {\n        notificationType = 'order_status_registr_ceka';\n\n\n        // Garant + TODO: uivatel s prvy VEREJNE_ZAKAZKY\n        if (formData.garant_uzivatel_id) recipientUserIds.add(parseInt(formData.garant_uzivatel_id));\n      }\n\n      // === 7. FZE FAKTURACE - EK NA FAKTURU ===\n      // Pjemci: garant a objednatel (pokud nen zrove garantem)\n      // Uniktn *_id - pokud je objednatel = garant, notifikace jen jednou\n      const hasFakturace = hasWorkflowState(newWorkflowState, 'FAKTURACE');\n      const hadFakturace = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'FAKTURACE') : false;\n\n      if (hasFakturace && !hadFakturace) {\n        notificationType = 'order_status_faktura_ceka'; //  OPRAVENO: ek na fakturu, ne \"fakturace\"\n\n\n        // Garant a objednatel (Set zajist uniktnost pokud jsou stejn)\n        if (formData.garant_uzivatel_id) recipientUserIds.add(parseInt(formData.garant_uzivatel_id));\n        if (formData.objednatel_id) recipientUserIds.add(parseInt(formData.objednatel_id));\n      }\n\n      // === 8. FZE VCN SPRVNOST - EK NA KONTROLU ===\n      // Pjemci: garant a objednatel\n      const hasVecnaSpravnost = hasWorkflowState(newWorkflowState, 'VECNA_SPRAVNOST');\n      const hadVecnaSpravnost = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'VECNA_SPRAVNOST') : false;\n\n      if (hasVecnaSpravnost && !hadVecnaSpravnost) {\n        notificationType = 'order_status_kontrola_ceka';\n\n\n        // Garant a objednatel (Set zajist uniktnost pokud jsou stejn)\n        if (formData.garant_uzivatel_id) recipientUserIds.add(parseInt(formData.garant_uzivatel_id));\n        if (formData.objednatel_id) recipientUserIds.add(parseInt(formData.objednatel_id));\n      }\n\n      // === 9. FZE ZKONTROLOVNA (VCN SPRVNOST POTVRZENA) ===\n      // Pjemci: uivatel s rolemi VEREJNE_ZAKAZKY, HLAVNI_UCETNI, ROZPOCTAR\n      // + objednatel (pokud nen zrove garantem)\n      // Vyjmka: NEN ten, kdo vcnou kontrolu provdl\n      // TODO: Vyaduje naten uivatel podle prv - zatm ponechno pro budouc implementaci\n      const hasZkontrolovana = hasWorkflowState(newWorkflowState, 'ZKONTROLOVANA');\n      const hadZkontrolovana = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'ZKONTROLOVANA') : false;\n\n      if (hasZkontrolovana && !hadZkontrolovana) {\n        notificationType = 'order_status_kontrola_potvrzena'; //  OPRAVENO: vcn sprvnost potvrzena\n\n\n        // Objednatel (pokud nen garant - Set zajist uniktnost)\n        if (formData.objednatel_id) recipientUserIds.add(parseInt(formData.objednatel_id));\n        if (formData.garant_uzivatel_id) recipientUserIds.add(parseInt(formData.garant_uzivatel_id));\n\n        // TODO: Pidat uivatele s prvy VEREJNE_ZAKAZKY, HLAVNI_UCETNI, ROZPOCTAR\n        // Vyaduje voln API pro zskn uivatel podle prv\n      }\n\n      // === 10. OBJEDNVKA DOKONENA ===\n      // Pjemci: VICHNI zastnn (objednatel, garant, pkazce, schvalovatel)\n      // Uniktn *_id - pokud je nkdo ve vce rolch, notifikace jen jednou\n      const hasDokoncena = hasWorkflowState(newWorkflowState, 'DOKONCENA');\n      const hadDokoncena = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'DOKONCENA') : false;\n\n      if (hasDokoncena && !hadDokoncena) {\n        notificationType = 'order_status_dokoncena';\n\n\n        // VICHNI zastnn (Set zajist uniktnost)\n        if (formData.objednatel_id) recipientUserIds.add(parseInt(formData.objednatel_id));\n        if (formData.garant_uzivatel_id) recipientUserIds.add(parseInt(formData.garant_uzivatel_id));\n        if (formData.prikazce_id) recipientUserIds.add(parseInt(formData.prikazce_id));\n        if (formData.schvalovatel_id) recipientUserIds.add(parseInt(formData.schvalovatel_id));\n      }\n\n      // === 11. OBJEDNVKA ZRUENA/STORNOVNA ===\n      const hasZrusena = hasWorkflowState(newWorkflowState, 'ZRUSENA');\n      const hadZrusena = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'ZRUSENA') : false;\n\n      if (hasZrusena && !hadZrusena) {\n        notificationType = 'order_status_zrusena';\n\n        // Pro zruen: vichni relevantn\n        if (formData.objednatel_id) recipientUserIds.add(parseInt(formData.objednatel_id));\n        if (formData.garant_uzivatel_id) recipientUserIds.add(parseInt(formData.garant_uzivatel_id));\n        if (formData.prikazce_id) recipientUserIds.add(parseInt(formData.prikazce_id));\n      }\n\n      //  FILTR 1: Odfiltrovat aktuln pihlenho uivatele (neposlat sm sob!)\n      //  VYJMKA: Pokud je aktuln uivatel PKAZCE objednvky, tak notifikaci DOSTAT M\n      if (user_id) {\n        const currentUserIdInt = parseInt(user_id);\n        const isUserCreator = formData.prikazce_id && parseInt(formData.prikazce_id) === currentUserIdInt;\n\n        if (recipientUserIds.has(currentUserIdInt)) {\n          if (isUserCreator) {\n          } else {\n            recipientUserIds.delete(currentUserIdInt);\n          }\n        }\n      }\n\n      //  FILTR 2: Odstranit nevalidn ID (null, undefined, NaN)\n      const validRecipients = Array.from(recipientUserIds).filter(id => {\n        return id && !isNaN(id) && id > 0;\n      });\n\n\n      // Pokud nebyl detekovn dn typ notifikace, skoni\n      if (!notificationType) {\n        return;\n      }\n\n      // Pokud nejsou dn pjemci, skoni\n      if (validRecipients.length === 0) {\n        return;\n      }\n\n      //  NOV BACKEND API - Odeslat notifikaci s automatickmi placeholdery\n      // Backend automaticky napln 50+ placeholder z order_id!\n\n      await notificationService.create({\n        token,\n        username,\n        type: notificationType,\n        order_id: orderId,\n        action_user_id: user_id,\n        recipients: validRecipients // Hromadn odesln\n      });\n\n    } catch (error) {\n      // Nezastavuj workflow kvli chyb notifikace\n    }\n  };\n\n  // Uloen objednvky do API (kdy je validn)\n  const saveOrderToAPI = async () => {\n    \n    if (!token || !username) {\n      showToast && showToast(formatToastMessage('Pro uloen objednvky muste bt pihleni', 'error'), { type: 'error' });\n      return;\n    }\n\n    //  EEN PROBLMU #3: Validace ev_cislo PED uloenm\n    if (!isValidEvCislo(formData.ev_cislo)) {\n      showToast && showToast('Evidenn slo se stle nat. Pokejte prosm na dokonen.', { type: 'warning' });\n      return;\n    }\n\n    //  KRITICK: Vyistit workflow update flag na zatku\n    window.__workflowStateUpdated = false;\n\n    // Nastavit saving state\n    setIsSaving(true);\n\n    //  ARCHIVOVAN OBJEDNVKY: Partial update - jen vyplnn pole\n    if (isArchivedOrder) {\n\n      try {\n        // PARTIAL UPDATE - sestavit orderData STEJN jako u bnch objednvek\n        // Poslat jen skuten DB pole, vyfiltrovat agregovan/potan pole\n        const orderData = {};\n\n        // Zkladn pole - poslat jen pokud jsou vyplnn\n        if (user_id) orderData.uzivatel_id = typeof user_id === 'string' ? parseInt(user_id, 10) : user_id;\n        if (formData.objednatel_id) orderData.objednatel_id = typeof formData.objednatel_id === 'string' ? parseInt(formData.objednatel_id, 10) : formData.objednatel_id;\n        if (formData.predmet) orderData.predmet = formData.predmet;\n        if (formData.garant_uzivatel_id) orderData.garant_uzivatel_id = formData.garant_uzivatel_id;\n        if (formData.prikazce_id) orderData.prikazce_id = formData.prikazce_id;\n        if (formData.max_cena_s_dph) orderData.max_cena_s_dph = formData.max_cena_s_dph;\n        if (formData.druh_objednavky_kod) orderData.druh_objednavky_kod = formData.druh_objednavky_kod;\n        if (formData.poznamka) orderData.poznamka = formData.poznamka;\n\n        // Stediska - normalizovat\n        if (formData.strediska_kod && formData.strediska_kod.length > 0) {\n          orderData.strediska_kod = normalizeStrediskaForBackend(formData.strediska_kod);\n        }\n\n        // Financovn - normalizovat\n        if (formData.zpusob_financovani) {\n          orderData.financovani = normalizeFinancovaniForBackend(formData, financovaniOptions);\n        }\n\n        // Workflow pole\n        if (formData.stav_objednavky) orderData.stav_objednavky = formData.stav_objednavky;\n        if (formData.stav_workflow_kod) orderData.stav_workflow_kod = formData.stav_workflow_kod;\n        if (formData.faze_objednavky) orderData.faze_objednavky = formData.faze_objednavky;\n\n        // Schvlen\n        if (formData.schvalil_uzivatel_id) orderData.schvalil_uzivatel_id = formData.schvalil_uzivatel_id;\n        if (formData.dt_schvaleni) orderData.dt_schvaleni = formData.dt_schvaleni;\n        if (formData.poznamka_schvaleni) orderData.poznamka_schvaleni = formData.poznamka_schvaleni;\n\n        // Vcn sprvnost\n        if (formData.potvrdil_vecnou_spravnost_id) orderData.potvrdil_vecnou_spravnost_id = formData.potvrdil_vecnou_spravnost_id;\n        if (formData.dt_potvrzeni_vecne_spravnosti) orderData.dt_potvrzeni_vecne_spravnosti = formData.dt_potvrzeni_vecne_spravnosti;\n        if (formData.poznamka_vecna_spravnost) orderData.poznamka_vecna_spravnost = formData.poznamka_vecna_spravnost;\n\n        // Poloky (pokud existuj)\n        if (formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n          orderData.polozky = formData.polozky_objednavky.map(polozka => ({\n            popis: polozka.popis || '',\n            //  FIX: Odstranit mezery a formtovn ped parseFloat (parseFloat(\"67 000\") vrac 67, ne 67000!)\n            cena_bez_dph: parseFloat((polozka.cena_bez_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0,\n            sazba_dph: parseInt(polozka.sazba_dph) || 21,\n            cena_s_dph: parseFloat((polozka.cena_s_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0,\n            usek_kod: polozka.usek_kod || null,\n            budova_kod: polozka.budova_kod || null,\n            mistnost_kod: polozka.mistnost_kod || null,\n            poznamka: polozka.poznamka || null,\n            //  LP kd na rovni poloky\n            lp_id: polozka.lp_id ? parseInt(polozka.lp_id) : null\n          }));\n        }\n\n        //  KRITICK: dt_objednavky = aktuln datum a as VDY pi kadm uloen\n        //  Pouij stejnou helper funkci jako v bnm saveOrderToAPI\n        const getMySQLDateTime = () => {\n          const now = new Date();\n          const year = now.getFullYear();\n          const month = String(now.getMonth() + 1).padStart(2, '0');\n          const day = String(now.getDate()).padStart(2, '0');\n          const hours = String(now.getHours()).padStart(2, '0');\n          const minutes = String(now.getMinutes()).padStart(2, '0');\n          const seconds = String(now.getSeconds()).padStart(2, '0');\n          return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n        };\n        const currentDateTime = getMySQLDateTime(); //  LOKLN AS\n        orderData.dt_objednavky = currentDateTime;\n\n        // updateOrderV2 vrac pmo data nebo hod error\n        const updatedOrder = await updateOrderV2(formData.id, orderData, token, username);\n\n        showToast && showToast(' Archivovan objednvka aktualizovna', { type: 'success' });\n\n        // Znovu nast aktuln data z DB (pouije se getOrderV2)\n        if (formData.id || formData.id) {\n          const freshOrderData = await getOrderV2(parseInt(formData.id || formData.id), token, username, true);\n\n          if (freshOrderData?.id) {\n            // Aktualizovat formData s novmi daty z DB\n            setFormData(prev => {\n              const updatedData = {\n                ...prev,\n                ...freshOrderData\n              };\n              \n              //  AKTUALIZOVAT SNAPSHOT po spnm uloen archivovan objednvky\n              originalFormDataRef.current = JSON.parse(JSON.stringify(updatedData));\n              \n              return updatedData;\n            });\n\n            // Uloit do konceptu\n            saveDraft(freshOrderData, {\n              isOrderSavedToDB: true,\n              savedOrderId: freshOrderData.id,\n              isChanged: false\n            });\n          }\n        }\n      } catch (error) {\n        showToast && showToast(`Chyba: ${error.message}`, { type: 'error' });\n      } finally {\n        setIsSaving(false);\n        setIsSavingDraft(false);\n      }\n\n      return; //  KONEC pro archivovan objednvky\n    }\n\n    // VALIDACE POUZE PI POKUSU O ULOEN DO DATABZE (bn objednvky)\n    const isValid = validateFormForSave();\n    if (!isValid) {\n      // Chybov zprva se zobraz v validateFormForSave()\n      setIsSaving(false);\n      return;\n    }\n\n    // VALIDACE NADLIMITU - nepovol uloen pokud je pekroen limit\n    const totalPrice = (formData.polozky_objednavky || []).reduce((sum, item) =>\n      sum + (parseFloat(item.cena_s_dph) || 0), 0\n    );\n    const maxPrice = parseFloat(formData.max_cena_s_dph) || 0;\n    const nadlimit = totalPrice - maxPrice;\n\n    if (nadlimit > 0) {\n      showToast && showToast(\n        `Nelze uloit objednvku - pekroen limit o ${nadlimit.toLocaleString('cs-CZ')} K! Upravte poloky nebo zvyte maximln cenu.`,\n        { type: 'error' }\n      );\n\n      // Rozbalit sekci Detail objednvky pokud je sbalen (ale NEAUTOMATICKY scrollovat)\n      if (sectionStates.detaily) {\n        setSectionStates(prev => ({ ...prev, detaily: false }));\n      }\n\n      // KRITICK: Vyistit saving stav pi chyb validace\n      setIsSaving(false);\n      return;\n    }\n\n    try {\n      setIsSavingDraft(true);\n\n      //  HELPER: Jednotn funkce pro generovn datetime v MySQL formtu\n      // Vrac: \"YYYY-MM-DD HH:MM:SS\" (LOKLN as, ne UTC!)\n      const getMySQLDateTime = () => {\n        const now = new Date();\n        const year = now.getFullYear();\n        const month = String(now.getMonth() + 1).padStart(2, '0');\n        const day = String(now.getDate()).padStart(2, '0');\n        const hours = String(now.getHours()).padStart(2, '0');\n        const minutes = String(now.getMinutes()).padStart(2, '0');\n        const seconds = String(now.getSeconds()).padStart(2, '0');\n        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n      };\n\n      //  HELPER: Pouze datum bez asu (LOKLN as, ne UTC!)\n      // Vrac: \"YYYY-MM-DD\"\n      const getMySQLDate = () => {\n        const now = new Date();\n        const year = now.getFullYear();\n        const month = String(now.getMonth() + 1).padStart(2, '0');\n        const day = String(now.getDate()).padStart(2, '0');\n        return `${year}-${month}-${day}`;\n      };\n\n      // KRITICK: Urit role uivatele na zatku - pouv se na vce mstech\n      const isSuperAdmin = userDetail?.roles?.some(role => role.kod_role === 'SUPERADMIN');\n      const isAdmin = userDetail?.roles?.some(role => role.kod_role === 'ADMINISTRATOR');\n      const shouldStayOnForm = isSuperAdmin || isAdmin; // SUPERADMIN/ADMIN zstvaj na formuli\n\n      //  FZE 7: Automaticky nastavit potvrdil_vecnou_spravnost_id a dt_potvrzeni_vecne_spravnosti pi prvnm potvrzen\n      // MUS BT PED sestavenm orderData!\n      let updatedFormData = { ...formData };\n\n      //  DEBUG: Kontrola podmnek pro nastaven ID\n      addDebugLog('info', 'VECNA-SPRAVNOST', 'check-conditions', `Kontrola: checkbox=${formData.potvrzeni_vecne_spravnosti}, existing_id=${formData.potvrdil_vecnou_spravnost_id}, user_id=${user_id}`);\n\n      if ((formData.potvrzeni_vecne_spravnosti === 1 || formData.potvrzeni_vecne_spravnosti === true) &&\n          !formData.potvrdil_vecnou_spravnost_id &&\n          user_id) {\n        const timestamp = getMySQLDateTime(); //  JEDNOTN FORMT\n        updatedFormData.potvrdil_vecnou_spravnost_id = user_id;\n        updatedFormData.dt_potvrzeni_vecne_spravnosti = timestamp;\n        addDebugLog('info', 'VECNA-SPRAVNOST', 'auto-set-id', ` Automaticky nastaveno ped uloenm: user_id=${user_id}, timestamp=${timestamp}`);\n      } else {\n        addDebugLog('warning', 'VECNA-SPRAVNOST', 'auto-set-skip', ` Peskoeno nastaven ID - podmnka nesplnna`);\n      }\n\n      // Pipravm jen vyplnn pole pro API\n      const orderData = {};\n\n      //  KRITICK: ID pihlenho uivatele (VDY povinn)\n      if (user_id) {\n        // Pevst na slo, pokud je to string\n        const uzivatelIdNumber = typeof user_id === 'string' ? parseInt(user_id, 10) : user_id;\n        orderData.uzivatel_id = uzivatelIdNumber;\n        addDebugLog('info', 'SAVE', 'uzivatel-id', `Nastaveno uzivatel_id: ${uzivatelIdNumber} (pvodn typ: ${typeof user_id})`);\n      } else {\n        addDebugLog('error', 'SAVE', 'uzivatel-id-missing', 'user_id chyb v AuthContext');\n      }\n\n      // Zkladn povinn pole\n      if (formData.predmet) orderData.predmet = formData.predmet;\n      if (formData.garant_uzivatel_id) orderData.garant_uzivatel_id = formData.garant_uzivatel_id;\n      if (formData.prikazce_id) orderData.prikazce_id = formData.prikazce_id;\n\n      //  BUGFIX: Objednatel ID - poslat VDY (INSERT i UPDATE)\n      // Pi INSERT: nastavit na user_id (kdo objednvku vytvoil)\n      // Pi UPDATE: zachovat pvodn hodnotu z formData\n      if (!isOrderSavedToDB && user_id) {\n        // INSERT - nov objednvka, objednatel = aktuln uivatel\n        const objednatelIdNumber = typeof user_id === 'string' ? parseInt(user_id, 10) : user_id;\n        orderData.objednatel_id = objednatelIdNumber;\n        addDebugLog('info', 'SAVE', 'objednatel-id', `Nastaveno objednatel_id: ${objednatelIdNumber} (nov objednvka)`);\n      } else if (isOrderSavedToDB && formData.objednatel_id) {\n        // UPDATE - existujc objednvka, zachovat pvodnho objednatele\n        const objednatelIdNumber = typeof formData.objednatel_id === 'string' ? parseInt(formData.objednatel_id, 10) : formData.objednatel_id;\n        orderData.objednatel_id = objednatelIdNumber;\n        addDebugLog('info', 'SAVE', 'objednatel-id-preserved', `Zachovn objednatel_id: ${objednatelIdNumber} (UPDATE objednvky)`);\n      }\n\n      //  STEDISKA: Normalizovat do array string pro backend\n      if (formData.strediska_kod && formData.strediska_kod.length > 0) {\n        orderData.strediska_kod = normalizeStrediskaForBackend(formData.strediska_kod);\n        addDebugLog('info', 'SAVE', 'strediska-normalized', `Stediska: ${JSON.stringify(formData.strediska_kod)} -> ${JSON.stringify(orderData.strediska_kod)}`);\n      }\n\n      if (formData.max_cena_s_dph) orderData.max_cena_s_dph = formData.max_cena_s_dph;\n      \n      // Mimodn udlost (boolean) - OPRAVA: explicitn pevod na boolean\n      orderData.mimoradna_udalost = Boolean(formData.mimoradna_udalost);\n      addDebugLog('info', 'SAVE', 'mimoradna-udalost', `Mimodn udlost: ${formData.mimoradna_udalost} -> ${orderData.mimoradna_udalost}`);\n\n      //  FINANCOVN: Normalizovat do objektu pro backend (VECHNA POLE jdou do financovani objektu!)\n      //  KRITICK OPRAVA: I kdy je pole disabled, MUSME poslat hodnotu!\n      // Disabled pole se neposlaj v HTML form submit, ale zde mme pstup k formData\n      if (formData.zpusob_financovani) {\n        orderData.financovani = normalizeFinancovaniForBackend(formData, financovaniOptions);\n        addDebugLog('info', 'SAVE', 'financovani-normalized', `Financovn: ${JSON.stringify(orderData.financovani)}`);\n      } else {\n        //  OCHRANA: Pokud nen financovn vyplnno, poli null\n        orderData.financovani = null;\n        addDebugLog('warning', 'SAVE', 'financovani-empty', 'Financovn nen vyplnno - poslm null');\n      }\n\n      // Druh objednvky - transformovat na objekt s kod_stavu a nazev_stavu\n      // Pole je vyplovno a ve FZI 3, proto ve fzi 1-2 me bt NULL\n      if (formData.druh_objednavky_kod) {\n        const druhObj = druhyObjednavkyOptions.find(opt =>\n          (opt.kod_stavu && opt.kod_stavu === formData.druh_objednavky_kod) ||\n          (opt.kod && opt.kod === formData.druh_objednavky_kod) ||\n          (opt.value && opt.value === formData.druh_objednavky_kod)\n        );\n\n        const druhObjednavkyObj = {\n          kod_stavu: druhObj?.kod_stavu || druhObj?.kod || druhObj?.value || formData.druh_objednavky_kod,\n          nazev_stavu: druhObj?.nazev_stavu || druhObj?.nazev || druhObj?.label || formData.druh_objednavky_kod\n        };\n\n        orderData.druh_objednavky_kod = JSON.stringify(druhObjednavkyObj);\n        addDebugLog('info', 'SAVE', 'druh-transform', `Transformace druhu objednvky: ${formData.druh_objednavky_kod} -> ${orderData.druh_objednavky_kod}`);\n      } else {\n        // Pokud nen vyplnno (fze 1-2), poslat null (po ALTER TABLE na DB)\n        orderData.druh_objednavky_kod = null;\n        addDebugLog('info', 'SAVE', 'druh-empty', 'Druh objednvky nen vyplnn (fze 1-2) - poslm NULL');\n      }\n\n      // Poloky objednvky - ukldaj se pi UPDATE (existujc objednvka) nebo od FZE 3+\n      // Poslaj se pmo jako pole do root objektu, ne jako JSON string\n      const isUpdateOperation = isOrderSavedToDB && formData.id;\n\n      //  OPRAVA: Pokud existuj poloky, VDY je poslat pi UPDATE (i ve fzi 2)\n      if (isUpdateOperation) {\n        // UPDATE - poslat poloky pokud existuj (i ve fzi 2)\n        if (formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n          orderData.polozky = formData.polozky_objednavky.map(polozka => ({\n            popis: polozka.popis || '',\n            //  FIX: Odstranit mezery a formtovn ped parseFloat (parseFloat(\"67 000\") vrac 67, ne 67000!)\n            cena_bez_dph: parseFloat((polozka.cena_bez_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0,\n            sazba_dph: parseInt(polozka.sazba_dph) || 21,\n            cena_s_dph: parseFloat((polozka.cena_s_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0,\n            //  Voliteln lokalizace (sek, budova, mstnost, poznmka)\n            usek_kod: polozka.usek_kod || null,\n            budova_kod: polozka.budova_kod || null,\n            mistnost_kod: polozka.mistnost_kod || null,\n            poznamka: polozka.poznamka || null,\n            //  LP kd na rovni poloky\n            lp_id: polozka.lp_id ? parseInt(polozka.lp_id) : null\n          }));\n\n          addDebugLog('info', 'SAVE', 'polozky-transform', `Transformace poloek objednvky (UPDATE fze ${currentPhase}): ${formData.polozky_objednavky.length} poloek -> pmo do root jako 'polozky' pole`);\n        } else {\n          // Przdn pole - poslat przdn pole, aby backend vymazal existujc poloky\n          orderData.polozky = [];\n          addDebugLog('warning', 'SAVE', 'polozky-empty', `Poloky jsou przdn (UPDATE fze ${currentPhase}) - poslm przdn pole`);\n        }\n      } else if (currentPhase >= 3 && formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n        // INSERT ve fzi 3+ - poslat poloky\n        orderData.polozky = formData.polozky_objednavky.map(polozka => ({\n          popis: polozka.popis || '',\n          cena_bez_dph: parseFloat((polozka.cena_bez_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0,\n          sazba_dph: parseInt(polozka.sazba_dph) || 21,\n          cena_s_dph: parseFloat((polozka.cena_s_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0,\n          usek_kod: polozka.usek_kod || null,\n          budova_kod: polozka.budova_kod || null,\n          mistnost_kod: polozka.mistnost_kod || null,\n          poznamka: polozka.poznamka || null,\n          lp_id: polozka.lp_id ? parseInt(polozka.lp_id) : null\n        }));\n        addDebugLog('info', 'SAVE', 'polozky-transform-insert', `Transformace poloek objednvky (INSERT fze ${currentPhase}): ${formData.polozky_objednavky.length} poloek`);\n      } else {\n        addDebugLog('info', 'SAVE', 'polozky-skip', `Poloky se neposlaj - INSERT v FZI ${currentPhase}`);\n      }\n\n      // Poznmka objednvky - soust hlavn datov vty\n      if (formData.poznamka_objednavky) {\n        orderData.poznamka = formData.poznamka_objednavky;\n        addDebugLog('info', 'SAVE', 'poznamka-add', `Pidna poznmka objednvky: ${formData.poznamka_objednavky.length} znak`);\n      }\n\n      // Vcn sprvnost - FZE 7 (ukldat VDY, i przdn hodnoty - EXPLICITN)\n      //  KRITICK OPRAVA: Textov pole pouvat z formData (obsahuj aktuln vyplnn hodnoty)\n      // Checkbox a metadata pouvat z updatedFormData (obsahuje nov nastaven ID a timestamp)\n      orderData.vecna_spravnost_umisteni_majetku = formData.vecna_spravnost_umisteni_majetku || '';\n      orderData.vecna_spravnost_poznamka = formData.vecna_spravnost_poznamka || '';\n      //  FIX: Konvertovat przdn string na 0, aby MySQL nepijal nevalidn hodnotu\n      const vecnaSpravnostValue = updatedFormData.potvrzeni_vecne_spravnosti;\n      orderData.potvrzeni_vecne_spravnosti = (vecnaSpravnostValue === 1 || vecnaSpravnostValue === true) ? 1 : 0;\n\n      //  DEBUG: Vcn sprvnost - automatick ID a timestamp (poslat VDY, i null)\n      orderData.potvrdil_vecnou_spravnost_id = updatedFormData.potvrdil_vecnou_spravnost_id || null;\n      orderData.dt_potvrzeni_vecne_spravnosti = updatedFormData.dt_potvrzeni_vecne_spravnosti || null;\n\n      //  DEBUG: Vpis vcn sprvnosti ped odeslnm\n      addDebugLog('info', 'VECNA-SPRAVNOST', 'save-data', `Ukldm vcnou sprvnost: checkbox=${orderData.potvrzeni_vecne_spravnosti}, umisteni=\"${orderData.vecna_spravnost_umisteni_majetku}\", poznamka=\"${orderData.vecna_spravnost_poznamka}\", user_id=${orderData.potvrdil_vecnou_spravnost_id}, dt=${orderData.dt_potvrzeni_vecne_spravnosti}`);\n\n      // Dodac a zrun podmnky\n      if (formData.dt_predpokladany_termin_dodani) orderData.dt_predpokladany_termin_dodani = formData.dt_predpokladany_termin_dodani;\n      if (formData.misto_dodani) orderData.misto_dodani = formData.misto_dodani;\n      if (formData.zaruka) orderData.zaruka = formData.zaruka;\n\n      // Informace o dodavateli\n      if (formData.dodavatel_id) orderData.dodavatel_id = formData.dodavatel_id;\n      if (formData.dodavatel_nazev) orderData.dodavatel_nazev = formData.dodavatel_nazev;\n      if (formData.dodavatel_adresa) orderData.dodavatel_adresa = formData.dodavatel_adresa;\n      if (formData.dodavatel_ico) orderData.dodavatel_ico = formData.dodavatel_ico;\n      if (formData.dodavatel_dic) orderData.dodavatel_dic = formData.dodavatel_dic;\n      if (formData.dodavatel_zastoupeny) orderData.dodavatel_zastoupeny = formData.dodavatel_zastoupeny;\n\n      // Kontaktn osoba dodavatele\n      if (formData.dodavatel_kontakt_jmeno) orderData.dodavatel_kontakt_jmeno = formData.dodavatel_kontakt_jmeno;\n      if (formData.dodavatel_kontakt_email) orderData.dodavatel_kontakt_email = formData.dodavatel_kontakt_email;\n      if (formData.dodavatel_kontakt_telefon) orderData.dodavatel_kontakt_telefon = formData.dodavatel_kontakt_telefon;\n\n      // Kontaktn daje objednatele\n      if (formData.objednatel_jmeno) orderData.objednatel_jmeno = formData.objednatel_jmeno;\n      if (formData.objednatel_email) orderData.objednatel_email = formData.objednatel_email;\n      if (formData.objednatel_telefon) orderData.objednatel_telefon = formData.objednatel_telefon;\n\n      // Popis a poznmky\n      if (formData.popis_pozadavku) orderData.popis_pozadavku = formData.popis_pozadavku;\n      if (formData.poznamky) orderData.poznamky = formData.poznamky;\n\n      // Plohy (pokud existuj)\n      if (formData.prilohy && formData.prilohy.length > 0) {\n        orderData.prilohy = formData.prilohy;\n      }\n\n      //  Schvlen objednvky - SPRVN LOGIKA podle DB struktury\n      // stav_schvaleni NEEXISTUJE v DB! Msto toho pouvme:\n      // 1. schvalovatel_id - ID uivatele, kter schvlil\n      // 2. dt_schvaleni - datum schvlen\n      // 3. stav_workflow_kod - pidme \"SCHVALENA\" do array\n\n      if (formData.dt_schvaleni) orderData.dt_schvaleni = formData.dt_schvaleni;\n\n      // Koment ke schvlen\n      //  Pi schvlen (stav_schvaleni === 'schvaleno') poslat przdn string nebo null\n      // Pro zamtnut a ek_se poslat hodnotu (povinn pole)\n      if (formData.stav_schvaleni === 'schvaleno') {\n        // Pi schvlen VDY poslat przdn string (vymazat koment)\n        orderData.schvaleni_komentar = '';\n      } else if (formData.schvaleni_komentar) {\n        // Pro ostatn stavy poslat hodnotu (pokud existuje)\n        orderData.schvaleni_komentar = formData.schvaleni_komentar;\n      }\n\n      // stav_workflow_kod - SESTAVUJ SPRVNOU POSLOUPNOST PODLE WORKFLOW KONCEPTU\n      // Nati existujc stavy z DB\n      let existingStates = parseWorkflowStates(formData.stav_workflow_kod);\n\n      //  OPRAVA WORKFLOW: ZACHOVAT PEDCHOZ STAVY A PIDVAT NOV (ne pepisovat)\n      // Workflow poad: KE_SCHVALENI  SCHVALENA  ROZPRACOVANA  ODESLANA  POTVRZENA  UVEREJNENA  FAKTURACE  DOKONCENA\n      let workflowStates = [...existingStates]; // Zachovat existujc stavy z DB\n\n      //  KRITICK: Kontrolovat formData.id NEBO formData.id pro rozhodnut INSERT vs UPDATE\n      const hasOrderId = formData.id || formData.id;\n\n      // 1. Prvn uloen do DB (INSERT)\n      if (!hasOrderId) {\n        workflowStates = []; // U novch zat ist\n\n        //  SPRVN LOGIKA: Rozhodnout podle radio buttonu v UI\n        // formData.stav_schvaleni je POUZE UI helper (neukld se do DB!)\n        const approvalChoice = formData.stav_schvaleni; // 'schvaleno', 'neschvaleno', 'ceka_se', nebo ''\n\n        if (approvalChoice === 'schvaleno') {\n          // Okamit schvlen - peskoit ODESLANA_KE_SCHVALENI\n          workflowStates = ['SCHVALENA'];\n          addDebugLog('info', 'SAVE', 'workflow-new', 'INSERT: Okamit schvlen - SCHVALENA');\n        } else {\n          // Normln postup - odesln ke schvlen\n          workflowStates = ['ODESLANA_KE_SCHVALENI'];\n          addDebugLog('info', 'SAVE', 'workflow-new', 'INSERT: Odesln ke schvlen - ODESLANA_KE_SCHVALENI');\n        }\n      } else {\n        //  UPDATE: Oetit star stav NOVA (deprecated) - nahradit za ODESLANA_KE_SCHVALENI\n        if (workflowStates.includes('NOVA') || workflowStates.length === 0 || (workflowStates.length === 1 && workflowStates[0] === 'NOVA')) {\n          workflowStates = workflowStates.filter(s => s !== 'NOVA');\n          if (!workflowStates.includes('ODESLANA_KE_SCHVALENI')) {\n            workflowStates.push('ODESLANA_KE_SCHVALENI');\n            addDebugLog('info', 'SAVE', 'workflow-migration', 'UPDATE: Migrovn star stav NOVA  ODESLANA_KE_SCHVALENI');\n          }\n        }\n      }\n\n      // 2. Schvlen/zamtnut - pepsat JEN vzjemn se vyluujc stavy\n      //  POUV formData.stav_schvaleni POUZE PRO UI LOGIKU (neposl se do DB!)\n      const approvalChoice = formData.stav_schvaleni; // UI helper\n\n      if (approvalChoice === 'schvaleno') {\n        // Odstranit POUZE vyluujc se schvalovac stavy (CEKA_SE, ZAMITNUTA)\n        workflowStates = workflowStates.filter(s => !['ODESLANA_KE_SCHVALENI', 'CEKA_SE', 'ZAMITNUTA'].includes(s));\n        if (!workflowStates.includes('SCHVALENA')) {\n          workflowStates.push('SCHVALENA');\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav SCHVALENA');\n        }\n      } else if (approvalChoice === 'neschvaleno') {\n        // Odstranit POUZE vyluujc se schvalovac stavy (SCHVALENA, CEKA_SE)\n        // POZOR: Pi zamtnut NEODSTRAOVAT dal stavy workflow!\n        workflowStates = workflowStates.filter(s => !['ODESLANA_KE_SCHVALENI', 'CEKA_SE', 'SCHVALENA'].includes(s));\n        if (!workflowStates.includes('ZAMITNUTA')) {\n          workflowStates.push('ZAMITNUTA');\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav ZAMITNUTA');\n        }\n      } else if (approvalChoice === 'ceka_se') {\n        // Odstranit POUZE vyluujc se schvalovac stavy (SCHVALENA, ZAMITNUTA)\n        workflowStates = workflowStates.filter(s => !['ODESLANA_KE_SCHVALENI', 'ZAMITNUTA', 'SCHVALENA'].includes(s));\n        if (!workflowStates.includes('CEKA_SE')) {\n          workflowStates.push('CEKA_SE');\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav CEKA_SE');\n        }\n      }\n\n      // 3. ROZPRACOVANA - FZE 3 rozpracovan (vyluuje se s ODESLANA a ZRUSENA)\n      // Pokud jsme ve FZI 3 (mme SCHVALENA) a NEN zakrtnut checkbox \"Odeslno\" ani \"Stornovno\"\n      //  pidej ROZPRACOVANA (uivatel pracuje na objednvce, ale jet ji neodeslal)\n      //  OPRAVA: NEPIDVAT ROZPRACOVANA pi prvnm schvlen (pouze kdy u byla SCHVALENA pedtm)\n      const wasAlreadyApproved = existingStates?.includes('SCHVALENA') || false;\n      const isJustNowApproved = approvalChoice === 'schvaleno' && !wasAlreadyApproved;\n\n      if (workflowStates.includes('SCHVALENA') &&\n          !formData.stav_odeslano &&\n          !formData.stav_stornovano &&\n          !workflowStates.includes('ROZPRACOVANA') &&\n          !isJustNowApproved) {  //  NOV PODMNKA: nepidvat pi prvnm schvlen\n        // Pidat ROZPRACOVANA (indiktor e se na objednvce pracuje)\n        workflowStates.push('ROZPRACOVANA');\n        addDebugLog('info', 'SAVE', 'workflow-update', ' Pidn stav ROZPRACOVANA - objednvka ve FZI 3, jet neodeslan');\n      }\n\n      // 4. ODESLANA - po odesln dodavateli (nahrazuje ROZPRACOVANA)\n      //  KRITICK: Workflow MUS bt IST [\"SCHVALENA\", \"ODESLANA\"], vymazat vy fze\n      if (formData.stav_odeslano && !formData.stav_stornovano) {\n        // Nastavit ist workflow FZE 4\n        workflowStates = ['SCHVALENA', 'ODESLANA'];\n        addDebugLog('info', 'SAVE', 'workflow-clean', ' Workflow nastaven na istou FZI 4: [\"SCHVALENA\", \"ODESLANA\"]');\n      } else if (!formData.stav_odeslano && workflowStates.includes('ODESLANA')) {\n        // Pokud ODESLANA existuje ale checkbox nen zakrtnut  vrtit na SCHVALENA\n        workflowStates = ['SCHVALENA'];\n        addDebugLog('info', 'SAVE', 'workflow-clean', ' Workflow vrcen na FZI 3: [\"SCHVALENA\"]');\n      }\n\n      // 5. ZRUSENA - pi stornovn\n      if (formData.stav_stornovano) {\n        if (!workflowStates.includes('ZRUSENA')) {\n          workflowStates.push('ZRUSENA');\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav ZRUSENA');\n        }\n        // Pi stornovn odstranit nkter stavy\n        workflowStates = workflowStates.filter(s => !['ROZPRACOVANA', 'ODESLANA', 'POTVRZENA'].includes(s));\n      } else {\n        // Odstranit ZRUSENA pokud nen stornovno\n        workflowStates = workflowStates.filter(s => s !== 'ZRUSENA');\n      }\n\n      // 6. POTVRZENA - potvrzen od dodavatele\n      const isDodavatelPotvrzeno = formData.dodavatel_zpusob_potvrzeni?.potvrzeni === 'ANO' ||\n                                  formData.stav_u_dodavatele === 'potvrzeno';\n      if (isDodavatelPotvrzeno && !formData.stav_stornovano) {\n        if (!workflowStates.includes('POTVRZENA')) {\n          workflowStates.push('POTVRZENA');\n          addDebugLog('info', 'SAVE', 'workflow-update', ' Pidn stav POTVRZENA - dodavatel potvrdil ANO');\n        }\n      } else if (!isDodavatelPotvrzeno) {\n        //  Dodavatel potvrdil NE  vrtit na istou FZI 4 (vymazat vechny vy fze)\n        workflowStates = workflowStates.filter(s =>\n          !['POTVRZENA', 'UVEREJNIT', 'NEUVEREJNIT', 'UVEREJNENA', 'FAKTURACE', 'VECNA_SPRAVNOST', 'ZKONTROLOVANA', 'DOKONCENA'].includes(s)\n        );\n        addDebugLog('info', 'SAVE', 'workflow-clean', ' Dodavatel potvrdil NE - workflow vrcen na FZI 4, vymazny vy fze');\n      }\n\n      // 7. UVEREJNENA - pi rozhodnut o zveejnn v registru smluv\n      // FZE 4: Uivatel s oprvnnm rozhodne ANO/NE pomoc checkboxu \"M bt zveejnna\"\n      //   - Pokud ma_byt_zverejnena = true  UVEREJNIT  FZE 5 (vyplnn datum + IDDT)\n      //   - Pokud ma_byt_zverejnena = false  NEUVEREJNIT  pesko FZI 5  rovnou FZE 6 (Fakturace)\n\n      // UVEREJNOVN - rozhodnut o zveejnn\n      // Logika:\n      // - Pokud dodavatel potvrdil (POTVRZENA) a ma_byt_zverejnena === true  pidat stav 'UVEREJNIT' (posun na fzi 5)\n      // - Pokud dodavatel potvrdil a ma_byt_zverejnena === false  pidat stav 'NEUVEREJNIT' (peskoit na fzi 6 - Fakturace)\n      // - Pokud ma_byt_zverejnena nen definovno, povaovat za false (defaultn chovn)\n      if (workflowStates.includes('POTVRZENA') && !formData.stav_stornovano) {\n        const maBytZverejnena = formData.ma_byt_zverejnena === true || formData.ma_byt_zverejnena === 1;\n\n        if (maBytZverejnena) {\n          // Chceme zveejnit  pidat UVEREJNIT\n          if (!workflowStates.includes('UVEREJNIT')) {\n            // Odstranme ppadn NEUVEREJNIT/UVEREJNENA pro konzistenci\n            workflowStates = workflowStates.filter(s => s !== 'NEUVEREJNIT' && s !== 'UVEREJNENA');\n            workflowStates.push('UVEREJNIT');\n            addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav UVEREJNIT (ma_byt_zverejnena = true)');\n          }\n\n          //  NOV: Pokud je UVEREJNIT a zrove jsou vyplnn datum + IDDT  posun na UVEREJNENA\n          if (workflowStates.includes('UVEREJNIT') && formData.dt_zverejneni && formData.registr_iddt) {\n            // Odstranit UVEREJNIT (u je dokoneno)\n            workflowStates = workflowStates.filter(s => s !== 'UVEREJNIT');\n            // Pidat UVEREJNENA  posun do FZE 6\n            if (!workflowStates.includes('UVEREJNENA')) {\n              workflowStates.push('UVEREJNENA');\n              addDebugLog('info', 'SAVE', 'workflow-update', 'Vyplnn registr smluv (datum + IDDT)  odstrann UVEREJNIT  pidn UVEREJNENA  FZE 6');\n            }\n          }\n        } else {\n          // Nem bt zveejnno (false, 0, undefined, null)  pidat NEUVEREJNIT\n          workflowStates = workflowStates.filter(s => s !== 'UVEREJNIT' && s !== 'UVEREJNENA');\n          if (!workflowStates.includes('NEUVEREJNIT')) {\n            workflowStates.push('NEUVEREJNIT');\n            addDebugLog('info', 'SAVE', 'workflow-update', `Pidn stav NEUVEREJNIT (ma_byt_zverejnena = ${formData.ma_byt_zverejnena})  pejt na FAKTURACE`);\n          }\n        }\n      }\n\n      // Pokud POTVRZENA zmiz nebo je stornovno, odstranit jakkoliv zveejovac stavy\n      if (!workflowStates.includes('POTVRZENA') || formData.stav_stornovano) {\n        workflowStates = workflowStates.filter(s => !['UVEREJNIT', 'NEUVEREJNIT', 'UVEREJNENA'].includes(s));\n        addDebugLog('info', 'SAVE', 'workflow-update', 'Odebrny zveejovac stavy (nen POTVRZENA nebo je stornovno)');\n      }\n\n      // Urit reim platby (POKLADNA vs FAKTURA) - pouito pro workflow vtven\n      const isPlatbaPokladnaObj = formData.financovani?.platba === 'pokladna';\n      const isPlatbaPokladnaDodavatel = formData.dodavatel_zpusob_potvrzeni?.platba === 'pokladna';\n      const isPokladna = isPlatbaPokladnaObj || isPlatbaPokladnaDodavatel;\n\n      //  POKLADNA: Po ODESLANA automaticky pidat VECNA_SPRAVNOST (pesko POTVRZEN, REGISTR, FAKTURACI)\n      // Pro POKLADNA skeme pmo z FZE 3 (ODESLANA) do FZE 7 (VECNA_SPRAVNOST)\n      if (isPokladna &&\n          (workflowStates.includes('ODESLANA') ||\n           workflowStates.includes('POTVRZENA') ||\n           workflowStates.includes('UVEREJNENA') ||\n           workflowStates.includes('NEUVEREJNIT')) &&\n          !formData.stav_stornovano) {\n        if (!workflowStates.includes('VECNA_SPRAVNOST')) {\n          workflowStates.push('VECNA_SPRAVNOST');\n          addDebugLog('info', 'SAVE', 'workflow-update', ' Reim POKLADNA  pidn stav VECNA_SPRAVNOST (peskoeny fze 4-6)  FZE 7/8');\n        }\n      }\n\n      // 8. FAKTURACE - pi pidn faktury (pouze kdy NEN pokladna)\n\n      if (!isPokladna && formData.faktury && formData.faktury.length > 0 && !formData.stav_stornovano) {\n        if (!workflowStates.includes('FAKTURACE')) {\n          workflowStates.push('FAKTURACE');\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav FAKTURACE  FZE 6/8');\n        }\n\n        //  Automaticky pidat VECNA_SPRAVNOST (vcn kontrola) po FAKTURACI\n        if (workflowStates.includes('FAKTURACE') && !workflowStates.includes('VECNA_SPRAVNOST')) {\n          workflowStates.push('VECNA_SPRAVNOST');\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav VECNA_SPRAVNOST - faktury uloeny  FZE 7/8 (Vcn kontrola)');\n        }\n      } else if (!formData.faktury || formData.faktury.length === 0 || isPokladna) {\n        // Pokud nejsou faktury NEBO je pokladna, odeber FAKTURACE a VECNA_SPRAVNOST\n        const hadFakturace = workflowStates.includes('FAKTURACE');\n        workflowStates = workflowStates.filter(s => s !== 'FAKTURACE' && s !== 'VECNA_SPRAVNOST');\n        if (hadFakturace && isPokladna) {\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Odebrn stav FAKTURACE a VECNA_SPRAVNOST (reim POKLADNA)');\n        }\n      }\n\n      // 8.5. ZKONTROLOVANA - POUZE pokud VECHNY faktury maj potvrzenou per-invoice vcnou sprvnost\n      //  NOV LOGIKA: Kontrola per-invoice checkbox pro KADOU fakturu\n      const allFakturyVecneSpravny = (formData.faktury || []).length > 0 && \n        (formData.faktury || []).every(f => f.vecna_spravnost_potvrzeno === 1 || f.vecna_spravnost_potvrzeno === true);\n      \n      if (allFakturyVecneSpravny && !formData.stav_stornovano) {\n        if (!workflowStates.includes('ZKONTROLOVANA')) {\n          workflowStates.push('ZKONTROLOVANA');\n          addDebugLog('info', 'SAVE', 'workflow-update', ` VECHNY faktury (${formData.faktury.length}x) maj potvrzenou vcnou sprvnost  pidn stav ZKONTROLOVANA  FZE 8/8`);\n        }\n      } else {\n        //  Odebrat ZKONTROLOVANA pokud NEN potvrzena vcn sprvnost VECH faktur\n        // Automaticky se vrt na VECNA_SPRAVNOST  FZE 7/8\n        const hadZkontrolovana = workflowStates.includes('ZKONTROLOVANA');\n        workflowStates = workflowStates.filter(s => s !== 'ZKONTROLOVANA');\n        if (hadZkontrolovana) {\n          const nepotvrzeneFaktury = (formData.faktury || []).filter(f => !(f.vecna_spravnost_potvrzeno === 1 || f.vecna_spravnost_potvrzeno === true)).length;\n          addDebugLog('info', 'SAVE', 'workflow-update', ` NEJSOU potvrzeny vechny faktury (${nepotvrzeneFaktury}x chyb)  odebrn stav ZKONTROLOVANA  nvrat na FZI 7/8`);\n        }\n      }\n\n      // 9. DOKONCENA - pi potvrzen finlnho dokonen checkboxem\n      //  BEZ kontroly na faktury - objednvka me bt dokonen i bez faktur\n      //  Kontrola: ob checkboxy potvrzeny\n      const jeDokonceniPotvrzeno = formData.potvrzeni_dokonceni_objednavky === 1 || formData.potvrzeni_dokonceni_objednavky === true;\n      //  OPRAVA: Kontrolovat AKTULN stav workflowStates (po pidn ZKONTROLOVANA ve)\n      const jeVecnaSprvnostPotvrzena = workflowStates.includes('ZKONTROLOVANA');\n\n      if (jeDokonceniPotvrzeno && jeVecnaSprvnostPotvrzena && !formData.stav_stornovano) {\n        if (!workflowStates.includes('DOKONCENA')) {\n          workflowStates.push('DOKONCENA');\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav DOKONCENA - objednvka finln dokonena');\n        }\n\n        //  Automaticky nastavit dokoncil_id a dt_dokonceni pi prvnm potvrzen\n        if (!formData.dokoncil_id) {\n          orderData.dokoncil_id = user_id;\n          orderData.dt_dokonceni = getMySQLDateTime(); //  JEDNOTN FORMT\n          addDebugLog('info', 'SAVE', 'dokonceni', `Nastaveno dokonen objednvky uivatelem ${user_id}`);\n        }\n      } else {\n        // Odstranit DOKONCENA pokud checkbox nen zakrtnut\n        workflowStates = workflowStates.filter(s => s !== 'DOKONCENA');\n      }\n\n      // FINLN KONTROLA A PRAVY\n      // Odstra duplicity (zachovej poad)\n      workflowStates = [...new Set(workflowStates)];\n\n      //  KRITICK OPRAVA: Odstranit STAR/NEPLATN workflow stavy\n      // Odstranit K_DOKONCENI - ji se nepouv, nahrazeno ZKONTROLOVANA + DOKONCENA\n      workflowStates = workflowStates.filter(s => s !== 'K_DOKONCENI');\n\n      // BEZPENOSTN KONTROLA: nikdy przdn pole\n      if (workflowStates.length === 0) {\n        workflowStates = ['NOVA'];\n        addDebugLog('warning', 'SAVE', 'workflow-fallback', 'Przdn workflow - fallback na [NOVA]');\n      }\n\n      // Seadit stavy podle logickho poad (zachovat vznam workflow)\n      const workflowOrder = [\n        'NOVA', 'ODESLANA_KE_SCHVALENI', 'CEKA_SE', 'ZAMITNUTA', 'SCHVALENA',\n        'ROZPRACOVANA', 'ODESLANA', 'ZRUSENA', 'POTVRZENA', 'UVEREJNIT', 'NEUVEREJNIT', 'UVEREJNENA', 'FAKTURACE', 'VECNA_SPRAVNOST', 'ZKONTROLOVANA', 'DOKONCENA'\n      ];\n\n      workflowStates.sort((a, b) => {\n        const indexA = workflowOrder.indexOf(a);\n        const indexB = workflowOrder.indexOf(b);\n        return (indexA === -1 ? 999 : indexA) - (indexB === -1 ? 999 : indexB);\n      });\n\n      orderData.stav_workflow_kod = JSON.stringify(workflowStates);\n\n      //  KRITICK: Nastavit stav_objednavky podle poslednho workflow kdu\n      //  POUV SELNK Z DB msto hardcoded WORKFLOW_STATES\n      if (workflowStates.length > 0) {\n        const lastWorkflowCode = workflowStates[workflowStates.length - 1];\n\n        //  SPRVN: Najdi stav v selnku z DB\n        const stavZCiselniku = stavyWorkflowMap[lastWorkflowCode];\n\n        if (stavZCiselniku) {\n          //  Pouij hodnotu z DB selnku\n          orderData.stav_objednavky = stavZCiselniku.nazev;\n          addDebugLog('info', 'SAVE', 'stav-objednavky', ` Nastaveno stav_objednavky: \"${orderData.stav_objednavky}\" (z DB selnku pro workflow: ${lastWorkflowCode})`);\n        } else {\n          //  FALLBACK: Pokud selnk nen naten nebo chyb kd, pouij hardcoded\n          const workflowState = WORKFLOW_STATES[lastWorkflowCode];\n          orderData.stav_objednavky = workflowState ? workflowState.name : lastWorkflowCode;\n          addDebugLog('warning', 'SAVE', 'stav-objednavky-fallback', ` selnk neobsahuje \"${lastWorkflowCode}\" - pouit fallback: \"${orderData.stav_objednavky}\"`);\n        }\n      } else {\n        orderData.stav_objednavky = 'Nov';\n        addDebugLog('warning', 'SAVE', 'stav-objednavky-fallback', 'Przdn workflow stavy - stav_objednavky: \"Nov\"');\n      }\n\n      //  VDY pedat workflow tracking pol (pokud existuj v formData) - KROM odesilatel_id\n      // odesilatel_id se nastavuje POUZE pi zakrtnut checkboxu \"Odeslano\" (viz ne)\n      // Ostatn pole se zachovaj pi kadm UPDATE\n\n      //  BREAKING CHANGE: potvrdil_id  dodavatel_potvrdil_id\n      if (formData.dodavatel_potvrdil_id !== undefined) orderData.dodavatel_potvrdil_id = formData.dodavatel_potvrdil_id;\n\n      //  NOV WORKFLOW POLE (26.10.2025):\n      // Registr smluv -  VDY nastavit zverejnil_id pi uloen pokud existuje dt_zverejneni a registr_iddt\n      if (formData.dt_zverejneni && formData.registr_iddt) {\n        // Pokud jet nen zverejnil_id, nastav aktulnho uivatele\n        if (!formData.zverejnil_id) {\n          orderData.zverejnil_id = user_id;\n          addDebugLog('info', 'SAVE', 'registr-tracking', `Automaticky nastaven zverejnil_id: ${user_id}`);\n        } else {\n          // Zachovat existujc hodnotu\n          orderData.zverejnil_id = formData.zverejnil_id;\n        }\n      } else if (formData.zverejnil_id !== undefined) {\n        // Zachovat hodnotu pokud nen podmnka splnna\n        orderData.zverejnil_id = formData.zverejnil_id;\n      }\n\n      if (formData.dt_zverejneni_potvrzeni) orderData.dt_zverejneni_potvrzeni = formData.dt_zverejneni_potvrzeni;\n\n      // Vcn sprvnost - FZE 7 (vdy ukldat, i null hodnoty)\n      orderData.potvrdil_vecnou_spravnost_id = formData.potvrdil_vecnou_spravnost_id !== undefined ? formData.potvrdil_vecnou_spravnost_id : null;\n      orderData.dt_potvrzeni_vecne_spravnosti = formData.dt_potvrzeni_vecne_spravnosti || null;\n\n      // Fakturace -  VDY aktualizovat pi uloen ve fzi fakturace (posledn uivatel)\n      if (formData.faktury && formData.faktury.length > 0 && workflowStates.includes('FAKTURACE')) {\n        // Aktualizovat fakturant_id a dt_faktura_pridana pi kadm uloen ve fzi fakturace\n        orderData.fakturant_id = user_id;\n        orderData.dt_faktura_pridana = getMySQLDateTime(); //  JEDNOTN FORMT\n        addDebugLog('info', 'SAVE', 'fakturace-tracking', `Aktualizovn fakturant_id: ${user_id}, dt_faktura_pridana: ${orderData.dt_faktura_pridana}`);\n      } else {\n        // Zachovat existujc hodnoty pokud nejsme ve fzi fakturace\n        if (formData.fakturant_id !== undefined) orderData.fakturant_id = formData.fakturant_id;\n        if (formData.dt_faktura_pridana) orderData.dt_faktura_pridana = formData.dt_faktura_pridana;\n      }\n\n      // Dokonen - FZE 8 (vdy ukldat, i null hodnoty)\n      orderData.dokoncil_id = formData.dokoncil_id !== undefined ? formData.dokoncil_id : null;\n      orderData.dt_dokonceni = formData.dt_dokonceni || null;\n      orderData.dokonceni_poznamka = formData.dokonceni_poznamka !== undefined ? formData.dokonceni_poznamka : '';\n      //  FIX: Konvertovat przdn string na 0, aby MySQL nepijal nevalidn hodnotu\n      const dokonceniValue = formData.potvrzeni_dokonceni_objednavky;\n      orderData.potvrzeni_dokonceni_objednavky = (dokonceniValue === 1 || dokonceniValue === true) ? 1 : 0;\n\n      addDebugLog('info', 'SAVE', 'tracking-fields', `Workflow tracking pole: dodavatel_potvrdil=${orderData.dodavatel_potvrdil_id}, zverejnil=${orderData.zverejnil_id}, vecna_spravnost=${orderData.potvrdil_vecnou_spravnost_id}, fakturant=${orderData.fakturant_id}, dokoncil=${orderData.dokoncil_id}`);\n\n      // Storno metadata - pouze pokud je stornovno (dt_odeslani se e ve)\n      if (formData.stav_stornovano) {\n        if (formData.storno_uzivatel_id) orderData.storno_uzivatel_id = formData.storno_uzivatel_id;\n        if (formData.storno_provedl) orderData.storno_provedl = formData.storno_provedl;\n        // odeslani_storno_duvod se e v sekci dt_odeslani ve\n        // datum_storna se mapuje na dt_odeslani ve\n      }\n\n      // dt_odeslani se pouv jak pro odesln, tak pro storno\n      //  DLEIT: Workflow data mnit POUZE pokud je sekce ODEMEN!\n      if (formData.stav_odeslano || formData.stav_stornovano) {\n        // Kontrola: je sekce FZE 3 odemen?\n        const isPhase3Unlocked = !shouldLockPhase3Sections;\n\n        if (isPhase3Unlocked) {\n          // Sekce je ODEMEN - meme mnit workflow data\n          //  odesilatel_id nastavit POUZE pokud jet neexistuje (pi prvnm odesln/stornu)\n          if (!formData.odesilatel_id && user_id) {\n            orderData.odesilatel_id = user_id;\n            addDebugLog('info', 'SAVE', 'odesilatel-tracking-new', `Uloen NOV odesilatel_id: ${user_id} (prvn odesln/storno)`);\n          } else if (formData.odesilatel_id) {\n            // odesilatel_id ji existuje - ZACHOVAT pvodn hodnotu\n            orderData.odesilatel_id = formData.odesilatel_id;\n            addDebugLog('info', 'SAVE', 'odesilatel-tracking-preserve', `ZACHOVN pvodn odesilatel_id: ${formData.odesilatel_id}`);\n          }\n\n          // Pro ODESLN: nastavit datum odesln a smazat dvod storna\n          if (formData.stav_odeslano && !formData.stav_stornovano) {\n            //  Datum odesln nastavit POUZE pokud jet neexistuje (pi prvnm odesln)\n            if (!formData.dt_odeslani) {\n              const datumOdeslani = formData.datum_odeslani || getMySQLDate(); //  JEDNOTN FORMT\n              orderData.dt_odeslani = datumOdeslani;\n              addDebugLog('info', 'SAVE', 'odeslani-datum-new', `Nastaveno NOV dt_odeslani: ${datumOdeslani}`);\n            } else {\n              // Datum ji existuje - ZACHOVAT pvodn hodnotu\n              orderData.dt_odeslani = formData.dt_odeslani;\n              addDebugLog('info', 'SAVE', 'odeslani-datum-preserve', `ZACHOVNO pvodn dt_odeslani: ${formData.dt_odeslani}`);\n            }\n            orderData.odeslani_storno_duvod = ''; // Vymazat dvod storna pi odesln\n          }\n          // Pro STORNO: nastavit datum storna a zachovat dvod storna\n          else if (formData.stav_stornovano) {\n            //  Datum storna nastavit POUZE pokud jet neexistuje (pi prvnm stornovn)\n            if (!formData.dt_odeslani) {\n              const datumStorna = formData.datum_storna || getMySQLDate(); //  JEDNOTN FORMT\n              orderData.dt_odeslani = datumStorna;\n              addDebugLog('info', 'SAVE', 'storno-datum-new', `Nastaveno NOV dt_odeslani pro STORNO: ${datumStorna}`);\n            } else {\n              // Datum ji existuje - ZACHOVAT pvodn hodnotu\n              orderData.dt_odeslani = formData.dt_odeslani;\n              addDebugLog('info', 'SAVE', 'storno-datum-preserve', `ZACHOVNO pvodn dt_odeslani pro STORNO: ${formData.dt_odeslani}`);\n            }\n            if (formData.odeslani_storno_duvod) orderData.odeslani_storno_duvod = formData.odeslani_storno_duvod;\n\n            addDebugLog('info', 'SAVE', 'storno-datum', `Uloeno STORNO s dvodem: ${formData.odeslani_storno_duvod}`);\n          }\n        } else {\n          // Sekce je ZAMEN - ZACHOVAT vechny existujc workflow hodnoty beze zmny!\n          if (formData.odesilatel_id) orderData.odesilatel_id = formData.odesilatel_id;\n          if (formData.dt_odeslani) orderData.dt_odeslani = formData.dt_odeslani;\n          if (formData.odeslani_storno_duvod) orderData.odeslani_storno_duvod = formData.odeslani_storno_duvod;\n          addDebugLog('info', 'SAVE', 'odeslani-locked', `FZE 3 ZAMEN - workflow data zachovna beze zmny`);\n        }\n      } else {\n        //  Pokud NEN zakrtnut ANI \"Odeslano\" ANI \"Stornovno\"  vymazat odesilatel_id\n        // (objednvka se vrac do stavu \"neodeslna\")\n        orderData.odesilatel_id = null;\n        addDebugLog('info', 'SAVE', 'odesilatel-reset', `Vymazn odesilatel_id - objednvka nen odeslna ani stornovna`);\n      }\n\n      //  OPRAVA: dodavatel_zpusob_potvrzeni ukldat pokud je workflow >= POTVRZENA\n      // Pokud je sekce ODEMEN (editovateln)  ukldat NOV hodnoty z formule\n      // Pokud je sekce ZAMEN  zachovat hodnotu z DB\n      const hasPotvrzena = existingStates.includes('POTVRZENA') || workflowStates.includes('POTVRZENA');\n      \n      if (hasPotvrzena) {\n        // FZE 4+ - ukldat podle toho jestli je sekce odemen\n        const isSectionUnlocked = !shouldLockPhase4to6Sections;\n        \n        if (isSectionUnlocked) {\n          //  SEKCE ODEMEN  ukldat NOV hodnoty z formule\n          const potvrzeniData = formData.dodavatel_zpusob_potvrzeni || {};\n          const potvrzeni = potvrzeniData.potvrzeni || 'NE';\n          \n          const dataToSave = {\n            potvrzeni: potvrzeni,\n            zpusoby: Array.isArray(potvrzeniData.zpusoby) ? potvrzeniData.zpusoby : [],\n            platba: potvrzeniData.platba || ''\n          };\n          \n          orderData.dodavatel_zpusob_potvrzeni = JSON.stringify(dataToSave);\n          \n          addDebugLog('info', 'SAVE', 'dodavatel-potvrzeni-unlocked', `Sekce odemen - Uloeno: ${orderData.dodavatel_zpusob_potvrzeni}`);\n        } else {\n          //  SEKCE ZAMEN  ZACHOVAT hodnotu z DB (nebo z formData pokud original chyb)\n          if (formData.dodavatel_zpusob_potvrzeni_original) {\n            orderData.dodavatel_zpusob_potvrzeni = formData.dodavatel_zpusob_potvrzeni_original;\n          } else if (formData.dodavatel_zpusob_potvrzeni) {\n            // Fallback: pokud original chyb, pouij aktuln hodnotu\n            orderData.dodavatel_zpusob_potvrzeni = JSON.stringify(formData.dodavatel_zpusob_potvrzeni);\n          }\n          addDebugLog('info', 'SAVE', 'dodavatel-potvrzeni-locked', `Sekce zamen - Hodnota zachovna`);\n        }\n      } else {\n        // FZE 3 nebo ni - NEPOSLAT pole\n        addDebugLog('info', 'SAVE', 'dodavatel-potvrzeni-skip', `FZE 3- - Peskoeno`);\n      }\n\n      // Akceptace a zveejnn\n      //  OPRAVA: Konvertovat datetime hodnoty do MySQL formtu (odstranit timezone a ms)\n      if (formData.dt_akceptace) {\n        // Pokud obsahuje 'T' (ISO format), extrahovat jen datum nebo datum+as bez timezone\n        const akceptaceValue = String(formData.dt_akceptace);\n        if (akceptaceValue.includes('T')) {\n          // ISO format: 2025-12-05T16:57:42.491Z -> 2025-12-05 nebo 2025-12-05 16:57:42\n          orderData.dt_akceptace = akceptaceValue.split('.')[0].replace('T', ' ').replace('Z', '');\n        } else {\n          orderData.dt_akceptace = akceptaceValue;\n        }\n      }\n      if (formData.dt_zverejneni) {\n        const zverejneniValue = String(formData.dt_zverejneni);\n        if (zverejneniValue.includes('T')) {\n          orderData.dt_zverejneni = zverejneniValue.split('.')[0].replace('T', ' ').replace('Z', '');\n        } else {\n          orderData.dt_zverejneni = zverejneniValue;\n        }\n      }\n      if (formData.registr_iddt) orderData.registr_iddt = formData.registr_iddt;\n\n      //  SMAZNO: dt_splatnosti pat k FAKTUE, ne k objednvce!\n      // Pole dt_splatnosti neexistuje v tabulce objednavky25, zpsobovalo SQL error\n\n      //  KRITICK: dt_objednavky = aktuln datum a as VDY pi kadm uloen (CREATE i UPDATE)\n      // Toto pole slou jako timestamp posledn zmny objednvky\n      //  OPRAVA: Pout LOKLN as, ne UTC!\n      const currentDateTime = getMySQLDateTime(); //  LOKLN AS\n      orderData.dt_objednavky = currentDateTime;\n      \n      if (!isOrderSavedToDB) {\n        addDebugLog('info', 'SAVE', 'datum-vytvoreni', `Nov objednvka - dt_objednavky: ${currentDateTime}`);\n      } else {\n        addDebugLog('info', 'SAVE', 'datum-zmeny', `UPDATE objednvky - dt_objednavky aktualizovno na: ${currentDateTime}`);\n      }\n\n      // schvalovatel_id - pro NOVA neposlat vbec, jinak mus bt platn slo\n      if (!workflowStates.includes('NOVA')) {\n        // Pouze pokud NEN stav NOVA a mme platn ID\n        if (formData.schvalovatel_id && formData.schvalovatel_id > 0) {\n          orderData.schvalovatel_id = formData.schvalovatel_id;\n        }\n        //  Pokud nen NOVA ale schvalovatel_id chyb, nechme pole przdn\n        // Backend si porad s tm, e pole nen v requestu (partial update)\n      }\n      //  Pro stav NOVA: NEPOSLAT schvalovatel_id vbec (ani null, ani '')\n\n      //  FAKTURY - poslat do payload pro uloen s objednvkou (Backend si porad s uloenm)\n      // Faktury jsou v samostatn tabulce, ale BE potebuje data pro update/create pes sv faktury API\n      if (formData.faktury && formData.faktury.length > 0) {\n        orderData.faktury = formData.faktury.map((faktura, index) => {\n          let strediskaArray = [];\n          if (faktura.fa_strediska_kod && Array.isArray(faktura.fa_strediska_kod) && faktura.fa_strediska_kod.length > 0) {\n            // Extrahuj jen kdy (kod_stavu) z objekt\n            strediskaArray = faktura.fa_strediska_kod.map(item => {\n              if (typeof item === 'object' && item.kod_stavu) {\n                return item.kod_stavu; // Objekt  extrahuj kod_stavu\n              }\n              return item; // U je string  pouij pmo\n            });\n\n            //  DEBUG: Transformace stedisek\n          }\n\n          //  KRITICK: Pokud m faktura reln ID (ne temp-), musme ho poslat pro UPDATE!\n          const hasRealId = faktura.id && !String(faktura.id).startsWith('temp-');\n          const fakturaId = hasRealId ? Number(faktura.id) : null;\n\n          const fakturaData = {\n            id: fakturaId,                                                    //  POSLAT ID - pokud je NULL, BE vytvo novou, jinak UPDATE\n            fa_castka: String(parseFloat(faktura.fa_castka) || 0),           //  V2 API: VDY STRING pro pesnost!\n            fa_cislo_vema: faktura.fa_cislo_vema || '',                       // POVINN - slo faktury (me bt '')\n            fa_dorucena: 1,                                                   // POVINN - 0 nebo 1 (boolean)\n            fa_datum_vystaveni: faktura.fa_datum_vystaveni || new Date().toISOString().split('T')[0], // DLEIT - datum vystaven\n            fa_datum_splatnosti: faktura.fa_splatnost || faktura.fa_datum_splatnosti || '', //  FE -> DB: fa_splatnost -> fa_datum_splatnosti (obousmrn mapping)\n            fa_datum_doruceni: (typeof faktura.fa_datum_doruceni === 'string' && faktura.fa_datum_doruceni.match(/^\\d{4}-\\d{2}-\\d{2}$/))\n              ? faktura.fa_datum_doruceni\n              : new Date().toISOString().split('T')[0], //  OPRAVA: Pout jen pokud je validn datum\n            fa_strediska_kod: strediskaArray,                                 //  POLE KD: [\"KLADNO\",\"BENESOV\",\"BEROUN\"]\n            fa_poznamka: faktura.fa_poznamka || '',                           // VOLITELN - poznmka\n            //  NOV: Per-invoice vcn sprvnost (FZE 7/8) - 1:1 DB mapping\n            vecna_spravnost_umisteni_majetku: faktura.vecna_spravnost_umisteni_majetku || '',\n            vecna_spravnost_poznamka: faktura.vecna_spravnost_poznamka || '',\n            vecna_spravnost_potvrzeno: (faktura.vecna_spravnost_potvrzeno === 1 || faktura.vecna_spravnost_potvrzeno === true) ? 1 : 0,\n            potvrdil_vecnou_spravnost_id: faktura.potvrdil_vecnou_spravnost_id || null,\n            dt_potvrzeni_vecne_spravnosti: faktura.dt_potvrzeni_vecne_spravnosti || null,\n            rozsirujici_data: faktura._isPokladna\n              ? {\n                  //  POKLADN DOKLAD - JEN nov data (BEZ spreadu!)\n                  typ_platby: 'pokladna',\n                  pokladni_doklad: {\n                    datum_vytvoreni: faktura.dt_vytvoreni || new Date().toISOString(),\n                    poznamka: faktura.fa_poznamka || '',\n                    prilohy_count: faktura.attachments?.length || 0,\n                    vytvoril_uzivatel_id: faktura.vytvoril_uzivatel_id,\n                    vytvoril_jmeno: faktura.vytvoril_jmeno\n                  }\n                }\n              : faktura._fromISDOC && faktura._isdoc_polozky\n                ? {\n                    // ISDOC FAKTURA - JEN nov data (BEZ spreadu!)\n                    typ_platby: 'faktura',\n                    isdoc: {\n                      cislo_faktury: faktura.fa_cislo_vema,\n                      datum_vystaveni: faktura.fa_datum_vystaveni,\n                      datum_splatnosti: faktura.fa_datum_splatnosti,\n                      castka_s_dph: faktura.fa_castka,\n                      castka_bez_dph: faktura.fa_castka_bez_dph,\n                      dph_celkem: faktura.fa_dph,\n                      polozky: faktura._isdoc_polozky,\n                      dodavatel: faktura._isdoc_dodavatel\n                    }\n                  }\n                : {\n                    // STANDARDN FAKTURA - minimln data\n                    typ_platby: 'faktura'\n                  }\n          };\n          \n\n          \n          return fakturaData;\n        });\n        addDebugLog('info', 'SAVE', 'faktury-transform', `Pidno ${formData.faktury.length} faktur do payload`);\n        addDebugLog('info', 'SAVE', 'faktury-detail', `Detaily faktur: ${JSON.stringify(formData.faktury, null, 2)}`);\n      } else {\n        orderData.faktury = []; // Przdn pole = dn faktury\n        addDebugLog('info', 'SAVE', 'faktury-empty', 'dn faktury k uloen');\n      }\n      //  POZNMKA: Backend si porad s uloenm faktur pes sv faktury API\n      //              Frontend jen pedv data, BE e persist do faktury25 tabulky\n      \n      let result;\n      let orderId;              // Deklarace na rovni celho bloku\n      let orderNumber;          // Deklarace na rovni celho bloku\n      let updatedFormDataImmediate;  // Deklarace na rovni celho bloku\n\n      //  hasOrderId je ji deklarovn ve (ped workflow logikou na dku ~6567)\n      // POUIJ ho pro rozhodnut INSERT vs UPDATE\n\n      if (!hasOrderId) {\n        //  V2 API: Prvn uloen - vytvoen nov objednvky\n        addDebugLog('info', 'SAVE-V2', 'create-start', 'Volm createOrderV2()');\n\n        //  FZE 1: Omezit pole na pouze zkladn daje (BEZ faktur!)\n        if (currentPhase === 1) {\n          const phase1Fields = [\n            'uzivatel_id', 'objednatel_id', 'predmet', 'garant_uzivatel_id',\n            'prikazce_id', 'strediska_kod', 'max_cena_s_dph', 'financovani',\n            'druh_objednavky_kod', 'stav_workflow_kod', 'stav_objednavky', 'dt_objednavky',\n            'mimoradna_udalost'  //  EMERGENCY FLAG\n          ];\n\n          Object.keys(orderData).forEach(key => {\n            if (!phase1Fields.includes(key)) {\n              delete orderData[key];\n            }\n          });\n        }\n\n        //  prepareDataForAPI() se vol automaticky uvnit createOrderV2() - NEMNIT ZNOVU!\n        // const preparedData = prepareDataForAPI(orderData);   DUPLICITN - ji se dl v createOrderV2()\n\n        result = await createOrderV2(orderData, token, username);\n\n        addDebugLog('info', 'SAVE-V2', 'create-success', `Order created: ID ${result.id}`);\n\n        if (result.lock_info?.locked && !result.lock_info?.locked_by_user_id) {\n          try {\n            await unlockOrderV2({ token, username, orderId: result.id });\n            addDebugLog('info', 'SAVE-V2', 'auto-unlock', `Automaticky odemena objednvka ${result.id} (byla zamen bez vlastnka)`);\n          } catch (unlockError) {\n            addDebugLog('warning', 'SAVE-V2', 'auto-unlock-error', `Chyba pi odemykn: ${unlockError.message}`);\n          }\n        }\n\n        updatedFormDataImmediate = result;\n        orderId = result.id;\n\n        orderNumber = result.ev_cislo || result.cislo_objednavky || formData.ev_cislo;\n\n        if (!orderNumber) {\n          addDebugLog('error', 'SAVE-V2', 'missing-ev-cislo', 'Backend nevrtil eviden slo objednvky');\n        }\n\n        // V2 API: faktury jsou pmo v result, ne v result.data\n        const fakturyFromBE = result.faktury || [];\n\n        //  DEKLARACE FAKTUR S PLOHAMI - MIMO IF BLOK (aby byla dostupn i pozdji)\n        let fakturyWithAttachments = [];\n\n        if (fakturyFromBE && Array.isArray(fakturyFromBE) && fakturyFromBE.length > 0) {\n          //  ZACHOVAT plohy z formData pokud existuj (ped uloenm)\n          const originalFaktury = formData.faktury || [];\n\n          //  Nast plohy pro kadou fakturu z DB\n          fakturyWithAttachments = await Promise.all(\n            fakturyFromBE.map(async (fakturaFromDB) => {\n              let attachments = [];\n\n              // 1. NEJDV zkusit najt plohy v pvodnch datech (ped uloenm)\n              const originalFaktura = originalFaktury.find(f =>\n                String(f.id) === String(fakturaFromDB.id) ||\n                f.fa_cislo_vema === fakturaFromDB.fa_cislo_vema\n              );\n\n              if (originalFaktura && originalFaktura.attachments && originalFaktura.attachments.length > 0) {\n                // Pout plohy z pvodnho formData\n                attachments = originalFaktura.attachments;\n              } else if (fakturaFromDB.id && !String(fakturaFromDB.id).startsWith('temp-')) {\n                // 2. Pokud nejsou v pvodnch datech, nast z DB\n                try {\n                  const attachResponse = await listInvoiceAttachments(\n                    fakturaFromDB.id,  // invoiceId\n                    username,          // username\n                    token,             // token\n                    parsedInsertData.id  // orderId\n                  );\n                  attachments = attachResponse.data?.attachments || attachResponse.data || [];\n                } catch (err) {\n                }\n              }\n\n              // Parsovat ISDOC data z rozsirujici_data pokud existuj\n              const isdocData = fakturaFromDB.rozsirujici_data?.isdoc;\n\n              //  PARSOVN STEDISEK z DB JSON stringu na pole objekt\n              let parsedStrediska = [];\n              try {\n                if (Array.isArray(fakturaFromDB.fa_strediska_kod)) {\n                  parsedStrediska = fakturaFromDB.fa_strediska_kod;\n                } else if (typeof fakturaFromDB.fa_strediska_kod === 'string') {\n                  parsedStrediska = JSON.parse(fakturaFromDB.fa_strediska_kod || '[]');\n                }\n\n                //  Zachovat cel objekty {kod_stavu, nazev_stavu}, ne jen kdy + validace\n                parsedStrediska = parsedStrediska.map(item => {\n                  if (typeof item === 'object' && item.kod_stavu) {\n                    // Zkontroluj zda existuje v aktivnch\n                    const exists = strediskaOptions.find(opt =>\n                      opt.kod_stavu === item.kod_stavu || opt.kod === item.kod_stavu || opt.value === item.kod_stavu\n                    );\n                    if (exists) {\n                      return item;\n                    }\n                    // Neaktivn stedisko  nahradit za 100 Sprva Kladno\n                    const fallback = strediskaOptions.find(opt =>\n                      opt.kod_stavu === \"100\" || opt.kod === \"100\" || opt.value === \"100\"\n                    );\n                    return fallback ? {\n                      kod_stavu: fallback.kod_stavu || fallback.kod || fallback.value,\n                      nazev_stavu: fallback.nazev_stavu || fallback.nazev || fallback.label\n                    } : { kod_stavu: \"100\", nazev_stavu: \"100 Sprva Kladno\" };\n                  }\n                  // String  zkontroluj zda existuje\n                  const stredisko = strediskaOptions.find(opt =>\n                    opt.kod_stavu === item || opt.kod === item || opt.value === item\n                  );\n                  if (stredisko) {\n                    return {\n                      kod_stavu: stredisko.kod_stavu || stredisko.kod || stredisko.value,\n                      nazev_stavu: stredisko.nazev_stavu || stredisko.nazev || stredisko.label\n                    };\n                  }\n                  // Neaktivn stedisko  nahradit za 100 Sprva Kladno\n                  const fallback = strediskaOptions.find(opt =>\n                    opt.kod_stavu === \"100\" || opt.kod === \"100\" || opt.value === \"100\"\n                  );\n                  return fallback ? {\n                    kod_stavu: fallback.kod_stavu || fallback.kod || fallback.value,\n                    nazev_stavu: fallback.nazev_stavu || fallback.nazev || fallback.label\n                  } : { kod_stavu: \"100\", nazev_stavu: \"100 Sprva Kladno\" };\n                });\n\n                //  DEBUG: Co jsme naparsovali?\n              } catch (e) {\n                parsedStrediska = [];\n              }\n\n              return {\n                ...fakturaFromDB,\n                // Mapovn DB -> FE (stejn jako pi natn)\n                fa_dorucena: fakturaFromDB.fa_datum_doruceni ? 1 : 0,\n                fa_splatnost: fakturaFromDB.fa_splatnost || (fakturaFromDB.fa_datum_splatnosti ? fakturaFromDB.fa_datum_splatnosti.split(' ')[0] : ''), //  OPRAVENO: Fallback na fa_datum_splatnosti\n                fa_strediska_kod: parsedStrediska, //  OPRAVENO: Pouij parsovan objekty\n                //  KRITICK: Pidat naten plohy\n                attachments: attachments,\n                // Zachovat originln DB pole pro API odesln\n                fa_datum_doruceni: fakturaFromDB.fa_datum_doruceni,\n                fa_datum_splatnosti: fakturaFromDB.fa_datum_splatnosti,\n                fa_datum_vystaveni: fakturaFromDB.fa_datum_vystaveni,\n                // Obnovit ISDOC metadata z rozsirujici_data\n                ...(isdocData ? {\n                  _isdoc_polozky: isdocData.polozky,\n                  _isdoc_dodavatel: isdocData.dodavatel,\n                  _fromISDOC: true\n                } : {})\n              };\n            })\n          );\n\n          // Aktualizuj faktury ve formData s natenmi plohami\n          setFormData(prev => ({\n            ...prev,\n            faktury: fakturyWithAttachments\n          }));\n\n          addDebugLog('success', 'SAVE', 'faktury-updated', `Faktury aktualizovny s relnmi ID z DB (${fakturyFromBE.length}) vetn ploh`);\n        }\n\n        //  Odeslat notifikace pi vytvoen nov objednvky\n        try {\n          // V2 API: stav_workflow_kod je pmo v result (me bt undefined nebo JSON string)\n          let workflowKod = result?.stav_workflow_kod || orderData.stav_workflow_kod;\n\n          // Pokud je stav_workflow_kod JSON string, parsuj ho\n          if (typeof workflowKod === 'string' && workflowKod.startsWith('[')) {\n            try {\n              workflowKod = JSON.parse(workflowKod);\n            } catch (e) {\n            }\n          }\n\n          //  STANDARDN NOTIFIKACE (zvoneek) - VDY zavolat!\n          await sendOrderNotifications(orderId, orderNumber, workflowKod, null, formData);\n\n          //  DUAL-TEMPLATE EMAIL: Nov objednvka m automaticky ODESLANA_KE_SCHVALENI (NAVC k zvoneku)\n          if (hasWorkflowState(workflowKod, 'ODESLANA_KE_SCHVALENI')) {\n            try {\n              // Pevst kdy stedisek na nzvy (strediskaOptions m strukturu {value, label})\n              const strediskaNazvy = (formData.strediska_kod || []).map(kod => {\n                const stredisko = strediskaOptions.find(opt => opt.value === kod);\n                return stredisko ? stredisko.label : kod;\n              });\n              \n              await notificationServiceDual.sendOrderApprovalNotifications({\n                token,\n                username,\n                orderData: {\n                  id: orderId,\n                  ev_cislo: orderNumber,\n                  predmet: formData.predmet || '',\n                  prikazce_id: formData.prikazce_id,\n                  garant_id: formData.garant_uzivatel_id,\n                  vytvoril: formData.objednatel_id,\n                  objednatel_id: formData.objednatel_id,\n                  dodavatel_nazev: formData.dodavatel_nazev || 'Neuvedeno',\n                  //  FINANCOVN - pout ji normalizovan objekt z orderData (stejn jako jde do DB)\n                  financovani_json: JSON.stringify(orderData.financovani || {}),\n                  strediska_nazvy: strediskaNazvy,\n                  max_price_with_dph: formData.max_cena_s_dph || 0,\n                  is_urgent: formData.mimoradna_udalost || false  //  Mimodn udlost\n                }\n              });\n              addDebugLog('success', 'NOTIFICATION', 'dual-email-sent-new', `Dual-template EMAILY odeslny pro novou objednvku ${orderNumber}`);\n            } catch (dualError) {\n              addDebugLog('warning', 'NOTIFICATION', 'dual-email-error-new', `Chyba pi dual-template emailech: ${dualError.message}`);\n            }\n          }\n        } catch (notifError) {\n          // Nezastavuj workflow kvli chyb notifikace\n          addDebugLog('warning', 'SAVE', 'notification-error', `Chyba pi odesln notifikace: ${notifError.message}`);\n        }\n\n        // Toast notifikace se zobraz a pozdji (dek ~5150-5160) - jednotn pro INSERT i UPDATE\n\n        // SUPERADMIN a ADMINISTRATOR zstvaj na formuli (DN pesmrovn)\n        // Vichni ostatn uivatel vid progress a pak pesmrovn\n        // POUIJ promnn deklarovan na zatku funkce (dek ~4817)\n        const shouldShowProgress = !shouldStayOnForm; // Bn uivatel vid progress\n\n        //  WORKFLOW REFACTORING: Backend vrac kompletn zznam, pouij ho pmo\n        updatedFormDataImmediate = result;\n        orderId = result.id;\n        //  KRITICK: Backend by ml vracet ev_cislo, ale pokud nevrt, pouijeme cislo_objednavky\n        // Frontend NIKDY nevyml ev_cislo - bere POUZE z backendu!\n        orderNumber = result.ev_cislo || result.cislo_objednavky;\n\n        //  V2 API: Backend vrac data PMO v result, ne v result.data!\n        //  POUT CENTRLN TRANSFORMACI: Backend  Frontend\n        const transformedResult = transformBackendDataToFrontend(result);\n\n        //  VALIDACE STEDISEK: Fallback pro neaktivn stediska\n        if (transformedResult.strediska_kod && Array.isArray(transformedResult.strediska_kod)) {\n          transformedResult.strediska_kod = validateAndFixStrediska(\n            transformedResult.strediska_kod,\n            strediskaOptions\n          );\n        }\n\n        const parsedInsertData = {\n          ...transformedResult,\n          id: orderId,\n          //  Pout orderNumber (ev_cislo NEBO cislo_objednavky jako fallback)\n          ev_cislo: orderNumber\n        };\n\n        addDebugLog('success', 'INSERT', 'data-transformed', `Data transformovna: strediska=${parsedInsertData.strediska_kod?.join(', ') || 'none'}, financovani=${parsedInsertData.zpusob_financovani || 'none'}`);\n\n        //  KRITICK: Aktualizovat formData s PARSOVANMI daty z DB PRO VECHNY\n        // Tm zabrnme ztrt dat po uloen + sprvn parsujeme stediska\n        //  BUGFIX: Zachovat faktury s natenmi plohami (fakturyWithAttachments z dku 8030-8107)\n        setFormData(prev => ({\n          ...prev,\n          ...parsedInsertData,  //  Pouij parsedInsertData msto result.data (obsahuje parsovan stediska)\n          //  POUT FAKTURY S NATENMI PLOHAMI (pokud byly nateny)\n          faktury: fakturyWithAttachments && fakturyWithAttachments.length > 0 ? fakturyWithAttachments : (parsedInsertData.faktury || prev.faktury)\n        }));\n\n        addDebugLog('success', 'INSERT', 'formdata-updated', `FormData aktualizovn: id=${orderId}, strediska=${parsedInsertData.strediska_kod?.join(', ') || 'none'}, faktury s plohami: ${fakturyWithAttachments?.length || 0}`);\n        \n        //  NAST LP OPTIONS z enriched response (z financovani.lp_nazvy)\n        if (result.financovani?.lp_nazvy && Array.isArray(result.financovani.lp_nazvy)) {\n          const lpOptions = result.financovani.lp_nazvy\n            .map(lp => ({\n              id: lp.id,\n              kod: lp.cislo_lp || lp.kod || `LP${lp.id}`,\n              nazev: lp.nazev || 'Bez nzvu',\n              kategorie: lp.kategorie,\n              limit: lp.limit || lp.celkovy_limit,\n              cerpano: lp.cerpano || lp.skutecne_cerpano,\n              zbyva: lp.zbyva || lp.zbyva_skutecne,\n              rok: lp.rok,\n              label: `${lp.cislo_lp || lp.kod || `LP${lp.id}`} - ${lp.nazev || 'Bez nzvu'}`\n            }))\n            .sort((a, b) => a.nazev.localeCompare(b.nazev, 'cs'));\n          \n          setLpOptionsForItems(lpOptions);\n          addDebugLog('success', 'INSERT', 'lp-options-loaded', `LP options nateny z financovani.lp_nazvy: ${lpOptions.length}`);\n        }\n\n        //  FORCE REFRESH workflowManager hned po setFormData\n        workflowForceRefresh();\n\n        //  Reset vech unlock states - sekce se maj zamknout podle nov fze\n        workflowManager.resetAllUnlocks();\n\n        // NOTE: formData.id removed - formData.id is single source of truth (orderId is in formData)\n\n        if (shouldShowProgress) {\n          // Bn uivatel - spust progress a pesmrovn\n          //  CENTRALIZOVAN MAZN pes DraftManager\n          setDisableAutosave(true);\n          disableAutosaveRef.current = true; //  OKAMIT zakzat autosave (REF)\n          setIsEditMode(false);\n          setIsConceptSaved(false);\n\n          //  Pouij DraftManager pro mazn VECH kl (ASYNCHRONN pro verifikaci)\n          if (user_id) {\n            draftManager.setCurrentUser(user_id);\n            const deleted = await draftManager.deleteAllDraftKeys();\n\n            if (deleted) {\n              addDebugLog('success', 'INSERT', 'draftmanager-delete', `Vechny kle smazny pes DraftManager`);\n            } else {\n            }\n          }\n\n          //  KRITICK: Invaliduj cache PED navigac (aby seznam ml erstv data)\n          try {\n            ordersCacheService.invalidate(user_id);\n            addDebugLog('success', 'INSERT', 'cache-invalidation', 'Cache invalidovna ped navigac');\n          } catch (e) {\n            addDebugLog('error', 'INSERT', 'cache-invalidation-error', `Chyba pi invalidaci cache: ${e.message}`);\n          }\n\n          startSaveProgressAndRedirect(orderNumber, orderId);\n\n        } else {\n          // SUPERADMIN/ADMIN - zstv na formuli v edit reimu\n          //  Povolit autosave zpt (zstvaj editovat)\n          setDisableAutosave(false);\n          disableAutosaveRef.current = false;\n          draftManager.setAutosaveEnabled(true, 'SUPERADMIN/ADMIN stays on form after INSERT');\n\n          //  ADMIN: Uloit aktualizovan data do draftu\n          try {\n            draftManager.setCurrentUser(user_id);\n            await draftManager.saveDraft(updatedFormDataImmediate, {\n              step: getCurrentPhase(),\n              attachments: attachments,\n              metadata: {\n                version: '1.4',\n                isConceptSaved: true,\n                isOrderSavedToDB: true,\n                savedOrderId: orderId,\n                isChanged: false,\n                dictionaries: {\n                  approvers: approvers || [],\n                  users: allUsers || [],\n                  strediska: strediskaOptions || [],\n                  financovani: financovaniOptions || [],\n                  druhyObjednavky: druhyObjednavkyOptions || [],\n                  lpKody: lpKodyOptions || []\n                }\n              }\n            });\n            addDebugLog('success', 'INSERT', 'admin-draft-saved', 'Draft uloen pro ADMIN po INSERT');\n          } catch (error) {\n            addDebugLog('error', 'INSERT', 'admin-draft-error', `Chyba pi ukldn draftu pro ADMIN: ${error.message}`);\n          }\n\n          // NEPROVDME unlock ani mazn konceptu - objednvka zstv oteven pro dal editaci\n          addDebugLog('info', 'SAVE', 'stay-on-form', `SUPERADMIN/ADMIN zstv na formuli - koncept NEN smazn, formul v edit reimu`);\n\n          //  TOAST NOTIFIKACE pro SUPERADMIN/ADMIN - zobrazit spch\n          if (showToast) {\n            const isNewOrder = !isOrderSavedToDB; // Byla to nov objednvka nebo update?\n            const message = isNewOrder\n              ? `Objednvka ${orderNumber} byla spn vytvoena`\n              : `Objednvka ${orderNumber} byla spn aktualizovna`;\n            showToast(message, { type: 'success' });\n          }\n\n          //  ADMIN: Zstat na stejn pozici - NEAUTOMATICKY scrollovat\n          // Uivatel m monost pokraovat tam, kde skonil\n          addDebugLog('info', 'INSERT', 'stay-in-place', 'Zsta na stejn pozici po uloen');\n        }\n\n        // RESET isChanged - data jsou synchronizovna s DB\n        setIsChanged(false);\n\n        //  Pepoet erpn smlouvy (pokud je smlouva vybran a objednvka ve fzi 7-8)\n        if (formData.cislo_smlouvy && currentPhase >= 7) {\n          try {\n            await prepocetCerpaniSmluv({\n              token,\n              username,\n              cislo_smlouvy: formData.cislo_smlouvy\n            });\n            addDebugLog('success', 'SMLOUVA', 'prepocet-ok', `Pepoet erpn smlouvy ${formData.cislo_smlouvy} spn`);\n          } catch (error) {\n            addDebugLog('warning', 'SMLOUVA', 'prepocet-error', `Chyba pi pepotu smlouvy: ${error.message}`);\n            // Neperuovat proces ukldn, jen logovat\n          }\n        }\n\n        //  DB RESPONSE LOGGING (INSERT)\n        //  V2 API: result je pmo data objednvky, NE result.data!\n        addDebugLog('info', 'DB-RESPONSE', 'INSERT-complete', {\n          orderId: orderId,\n          orderNumber: orderNumber,\n          workflow: result.stav_workflow_kod,\n          fieldsCount: Object.keys(result).length,\n          polozky: result.polozky?.length || 0,\n          faktury: result.faktury?.length || 0\n        });\n\n        // Odvodit checkboxy z workflow stavu (pro zamykn sekc)\n        //  V2 API: result je pmo data objednvky, NE result.data!\n        const newWorkflowFromDB = result.stav_workflow_kod;\n        const isOdeslana = hasWorkflowState(newWorkflowFromDB, 'ODESLANA');\n        const isZrusena = hasWorkflowState(newWorkflowFromDB, 'ZRUSENA');\n\n        //  WORKFLOW REFACTORING: Po spnm uloen do DB aktualizovat draft s erstvmi daty\n        // Backend vrac kompletn zznam, take draft bude synchronizovan s DB\n        //  KRITICK: Mergovat pvodn formData (s polokami!) + parsovan DB data\n        try {\n          draftManager.setCurrentUser(user_id);\n\n          //  FIX: Mergovat updatedFormDataImmediate (obsahuje poloky + financovn) + parsedInsertData (DB data)\n          //  BUGFIX: Zachovat objednatel_id z pvodnho formData pro jistotu\n          const mergedDraftData = {\n            ...updatedFormDataImmediate, // Pvodn data s polokami\n            ...parsedInsertData,         // Pepsat DB daty (ID, workflow, atd.) + PARSOVAN FINANCOVN!\n            // Zachovat poloky a faktury z pvodnho formData\n            polozky_objednavky: updatedFormDataImmediate.polozky_objednavky || [],\n            faktury: updatedFormDataImmediate.faktury || [],\n            //  ZACHOVAT objednatel_id + osobn daje objednatele (fallback na pvodn data)\n            objednatel_id: parsedInsertData.objednatel_id || updatedFormDataImmediate.objednatel_id,\n            jmeno: parsedInsertData.jmeno || updatedFormDataImmediate.jmeno,\n            email: parsedInsertData.email || updatedFormDataImmediate.email,\n            telefon: parsedInsertData.telefon || updatedFormDataImmediate.telefon\n            //  FINANCOVN je u v parsedInsertData - nepepisovat!\n          };\n\n          await draftManager.saveDraft(mergedDraftData, {\n            step: getCurrentPhase(),\n            attachments: attachments,\n            metadata: {\n              version: '1.4',\n              isConceptSaved: true,\n              isOrderSavedToDB: true,\n              savedOrderId: orderId,\n              isChanged: false, //  FALSE = dn neuloen zmny (ve je v DB)\n              dictionaries: {\n                approvers: approvers || [],\n                users: allUsers || [],\n                strediska: strediskaOptions || [],\n                financovani: financovaniOptions || [],\n                druhyObjednavky: druhyObjednavkyOptions || [],\n                lpKody: lpKodyOptions || []\n              }\n            }\n          });\n          addDebugLog('success', 'INSERT', 'draft-updated', `Draft aktualizovn s PARSOVANMI DB daty (workflow: ${newWorkflowFromDB}, strediska: ${parsedInsertData.strediska_kod.join(', ')}, poloky: ${mergedDraftData.polozky_objednavky?.length || 0}, financovn: ${mergedDraftData.zpusob_financovani || 'none'})`);\n\n          //  AKTUALIZOVAT SNAPSHOT po spnm uloen\n          originalFormDataRef.current = JSON.parse(JSON.stringify(mergedDraftData));\n\n          //  BROADCAST: Aktualizovat MenuBar s novm stavem\n          broadcastOrderState({\n            isEditMode: true,\n            orderId: orderId,\n            orderNumber: orderNumber\n          });\n          addDebugLog('success', 'INSERT', 'broadcast', `Broadcast stavu odesln (isEditMode: true, orderId: ${orderId})`);\n        } catch (error) {\n          addDebugLog('error', 'INSERT', 'draft-update-error', `Chyba pi aktualizaci draftu: ${error.message}`);\n        }\n\n        //  WORKFLOW REFACTORING: FormData ji byl aktualizovn ve (dek ~7079) s parsovanmi stediskami\n        // ODSTRANNO duplicitn setFormData(parsedInsertData) - zpsobovalo pepsn dat\n\n        // Fze se odvod automaticky z DB stavu - BE vrac aktuln stav\n        //  V2 API: result je pmo data objednvky, NE result.data!\n        const newWorkflowKod = result.stav_workflow_kod;\n        addDebugLog('success', 'SAVE', 'order-status', `Objednvka oznaena jako uloen. ID: ${orderId}, EV: ${orderNumber}, DB stav: ${newWorkflowKod}`);\n\n        // FZE se automaticky pepot z aktualizovanho formData.stav_workflow_kod\n        addDebugLog('success', 'SAVE', 'workflow-state', `DB stav: ${newWorkflowKod} - fze se pepot automaticky`);\n\n        // Po spnm INSERT - reset stav a refresh autosave\n        // Reset odemknut pouze pokud je objednvka skuten schvlen\n        if (hasWorkflowState(newWorkflowKod, 'SCHVALENA')) {\n          setIsPhase1Unlocked(false); // Reset odemknut pouze pro schvlenou objednvku\n          addDebugLog('info', 'SAVE', 'lock-sections', 'FZE 1 sekce zameny - objednvka je schvlen');\n        } else {\n          addDebugLog('info', 'SAVE', 'keep-unlocked-phase1', `FZE 1 sekce zstvaj odemen - stav: ${newWorkflowKod}`);\n        }\n\n        // Pro FZE 2: Zamknout pokud DB obsahuje ODESLANA/ZRUSENA\n        const hasOdeslanaInNewState = hasWorkflowState(newWorkflowKod, 'ODESLANA');\n        const hasZrusenaInNewState = hasWorkflowState(newWorkflowKod, 'ZRUSENA');\n\n        // Zamykn e useEffect podle formData.stav_workflow_kod\n\n        // ZAMKNOUT FZE 2 - pokud je objednvka odeslan/zruen\n        // KONTROLA POUZE podle DB workflow stavu - NE podle UI checkboxu stav_stornovano!\n        addDebugLog('success', 'SAVE', 'no-ui-refresh', `Bez UI refresh - pmo zamykn. Nov stav: ${newWorkflowKod}`);\n          const shouldLockPhase2Now = (\n            hasWorkflowState(newWorkflowKod, 'ODESLANA') ||\n            hasWorkflowState(newWorkflowKod, 'ZRUSENA')\n          );\n\n        if (shouldLockPhase2Now) {\n          //  Zkontrolovat pes DraftManager, jestli nen Phase 2 run odemeno\n          let isManuallyUnlocked = false;\n          try {\n            const uiState = draftManager.getUIState();\n            if (uiState) {\n              const currentOrderId = formData.id;\n              // Kontrolovat pouze pokud existuje ID objednvky\n              if (currentOrderId && uiState.phase2OrderId === currentOrderId && uiState.phase2Unlocked === true) {\n                isManuallyUnlocked = true;\n              }\n            }\n          } catch (e) {\n            addDebugLog('warning', 'SAVE', 'unlock-check-error', `Chyba pi kontrole Phase 2 unlock stavu: ${e.message}`);\n          }\n\n          if (isManuallyUnlocked) {\n            addDebugLog('info', 'SAVE', 'phase2-keep-unlocked', `FZE 2 zstv ODEMENA - byla run odemena`);\n          } else {\n            setIsPhase3SectionsUnlocked(false);\n          }\n        }        setHasTriedToSubmit(false); // Reset validace po spnm uloen\n\n        // Aktualizovan data pro localStorage (vetn novho workflow stavu)\n        const updatedFormDataForSave = {\n          ...formData,\n          id: orderId,\n          ev_cislo: orderNumber,\n          stav_workflow_kod: newWorkflowKod,\n          ...(result?.dt_schvaleni && { dt_schvaleni: result.dt_schvaleni })\n        };\n\n        // Debug: Zkontroluj, zda m workflow stav SCHVALENA (INSERT)\n        const hasSchvalenaInsert = hasWorkflowState(newWorkflowKod, 'SCHVALENA');\n        addDebugLog('info', 'INSERT', 'phase-check', `M SCHVALENA: ${hasSchvalenaInsert}, nov fze by mla bt: ${hasSchvalenaInsert ? '2' : '1'}`);\n\n        // KRITICK: Aktualizovat formData pro refresh UI (stejn jako u UPDATE) - s force refresh\n        //  ZACHOVAT parsedInsertData.strediska_kod - nepepisovat!\n        setFormData(prev => {\n          //  Pevst workflow kd na textov popis\n          const stavObjednavky = (() => {\n            try {\n              const stavyArray = Array.isArray(newWorkflowKod)\n                ? newWorkflowKod\n                : JSON.parse(newWorkflowKod || '[\"NOVA\"]');\n              const poslednStav = stavyArray[stavyArray.length - 1];\n              const stavInfo = WORKFLOW_STATES[poslednStav];\n              return stavInfo?.name || poslednStav || 'Nov';\n            } catch (e) {\n              return 'Nov';\n            }\n          })();\n\n          const newData = {\n            ...prev,\n            id: orderId,\n            ev_cislo: orderNumber,\n            stav_workflow_kod: newWorkflowKod,\n            stav_objednavky: stavObjednavky,\n            ...(result?.dt_schvaleni && { dt_schvaleni: result.dt_schvaleni }),\n            strediska_kod: parsedInsertData.strediska_kod\n          };\n\n          return newData;\n        });\n\n        // U nen poteba explicitn DB reload - BE vrac spolehliv stav v response\n\n        // Zobrazit success message - POUZE pro bn uivatele (SUPERADMIN/ADMIN maj toast ve)\n        if (!shouldStayOnForm) {\n          if (result.message) {\n            showToast && showToast(result.message, { type: 'success' });\n          } else if (result.lock_info?.locked_by_user_fullname) {\n            showToast && showToast(\n              `Objednvka byla spn vytvoena (edituje: ${result.lock_info.locked_by_user_fullname})`,\n              { type: 'success' }\n            );\n          } else {\n            showToast && showToast(`Objednvka byla spn vytvoena`, { type: 'success' });\n          }\n        }\n\n        // POZNMKA: Autosave byl pesunut do DraftManager.syncWithDatabase()\n        // Nen poteba volat saveDraftWithData - zpsobovalo duplicitn zpis a race conditions\n        addDebugLog('info', 'AUTOSAVE', 'skip-duplicate-insert', `Autosave peskoen - ji proveden pes DraftManager.syncWithDatabase()`);\n\n        // === SUPERADMIN/ADMIN zachovn draftu ===\n        // Pro SUPERADMIN a ADMIN NEMAZAT draft - zstvaj na formuli v edit reimu\n        // POUIJ ji deklarovan promnn z nadazenho scope (dek ~5203-5205)\n\n        if (!shouldStayOnForm && user_id) {\n          // Bn uivatel - smazat draft (bude pesmrovn)\n          draftManager.setCurrentUser(user_id);\n          await draftManager.deleteDraft();\n          addDebugLog('info', 'DRAFT', 'delete-after-create', 'Draft smazn po spnm CREATE pes DraftManager (bn uivatel)');\n        } else if (shouldStayOnForm) {\n          addDebugLog('info', 'DRAFT', 'keep-after-create', 'Draft ZACHOVN po CREATE - SUPERADMIN/ADMIN zstv na formuli');\n        }\n\n      } else {\n        // Aktualizace existujc objednvky - pouvme partial-update\n        const oldWorkflowKod = formData.stav_workflow_kod;\n\n        addDebugLog('info', 'SAVE-V2', 'update-start', `Volam updateOrderV2(${formData.id})`);\n\n        //  prepareDataForAPI() se vol automaticky uvnit updateOrderV2() - NEMNIT ZNOVU!\n        // const preparedData = prepareDataForAPI(orderData);   DUPLICITN - ji se dl v updateOrderV2()\n\n\n        //  DEBUG: STEDISKA VE FAKTURCH PED ODESLNM (UPDATE)\n        if (orderData.faktury && orderData.faktury.length > 0) {\n        }\n\n        result = await updateOrderV2(formData.id, orderData, token, username);\n\n        addDebugLog('info', 'SAVE-V2', 'update-success', `Order ${formData.id} updated`);\n\n        // DB RESPONSE LOGGING (UPDATE)\n        //  V2 API: Backend vrac cislo_objednavky (ne ev_cislo)\n        addDebugLog('info', 'DB-RESPONSE', 'UPDATE-complete', {\n          orderId: result.id,\n          orderNumber: result.cislo_objednavky || result.ev_cislo,\n          workflow: result.stav_workflow_kod,\n          fieldsCount: Object.keys(result).length,\n          polozky: result.polozky?.length || 0,\n          faktury: result.faktury?.length || 0\n        });\n\n        //  DEBUG: Zkontroluj co backend vrac v dodavatel_zpusob_potvrzeni\n\n        // Odeslat notifikace pi zmn workflow stavu\n        try {\n          const orderNumber = formData.ev_cislo || formData.cislo_objednavky || formData.id;\n          \n          //  STANDARDN NOTIFIKACE (zvoneek) - VDY zavolat!\n          await sendOrderNotifications(formData.id, orderNumber, result.stav_workflow_kod, oldWorkflowKod, formData);\n          \n          //  DUAL-TEMPLATE EMAIL: Pi prvnm odesln ke schvlen (NAVC k zvoneku)\n          const hasKeSchvaleni = hasWorkflowState(result.stav_workflow_kod, 'ODESLANA_KE_SCHVALENI');\n          const hadKeSchvaleni = oldWorkflowKod ? hasWorkflowState(oldWorkflowKod, 'ODESLANA_KE_SCHVALENI') : false;\n          \n          if (hasKeSchvaleni && !hadKeSchvaleni) {\n            // Odeslat POUZE EMAILY (zvoneky u vytoila funkce sendOrderNotifications)\n            try {\n              // Pevst kdy stedisek na nzvy (strediskaOptions m strukturu {value, label})\n              const strediskaNazvy = (formData.strediska_kod || []).map(kod => {\n                const stredisko = strediskaOptions.find(opt => opt.value === kod);\n                return stredisko ? stredisko.label : kod;\n              });\n              \n              await notificationServiceDual.sendOrderApprovalNotifications({\n                token,\n                username,\n                orderData: {\n                  id: formData.id,\n                  ev_cislo: orderNumber,\n                  predmet: formData.predmet || '',\n                  prikazce_id: formData.prikazce_id,\n                  garant_id: formData.garant_uzivatel_id,\n                  vytvoril: formData.objednatel_id,\n                  objednatel_id: formData.objednatel_id,\n                  dodavatel_nazev: formData.dodavatel_nazev || 'Neuvedeno',\n                  //  FINANCOVN - pout ji normalizovan objekt z orderData (stejn jako jde do DB)\n                  financovani_json: JSON.stringify(orderData.financovani || {}),\n                  strediska_nazvy: strediskaNazvy,\n                  max_price_with_dph: formData.max_cena_s_dph || 0,\n                  is_urgent: formData.mimoradna_udalost || false  //  Mimodn udlost\n                }\n              });\n              addDebugLog('success', 'NOTIFICATION', 'dual-email-sent', `Dual-template EMAILY odeslny pro objednvku ${orderNumber}`);\n            } catch (dualError) {\n              addDebugLog('warning', 'NOTIFICATION', 'dual-email-error', `Chyba pi dual-template emailech: ${dualError.message}`);\n            }\n          }\n        } catch (notifError) {\n        }\n\n        //  WORKFLOW REFACTORING: Backend vrac kompletn zznam, pouij ho pmo\n        const updatedFormDataImmediate = result;\n        const updatedWorkflowKod = result.stav_workflow_kod;\n\n        // Odvodit checkboxy z workflow stavu (pro zamykn sekc)\n        const isOdeslana = hasWorkflowState(updatedWorkflowKod, 'ODESLANA');\n        const isZrusena = hasWorkflowState(updatedWorkflowKod, 'ZRUSENA');\n\n        //  V2 API: Backend vrac data PMO v result, ne v result.data!\n        //  POUT CENTRLN TRANSFORMACI: Backend  Frontend\n        const transformedResult = transformBackendDataToFrontend(result);\n\n        //  VALIDACE STEDISEK: Fallback pro neaktivn stediska\n        if (transformedResult.strediska_kod && Array.isArray(transformedResult.strediska_kod)) {\n          transformedResult.strediska_kod = validateAndFixStrediska(\n            transformedResult.strediska_kod,\n            strediskaOptions\n          );\n        }\n\n        // Nyn pracuj s transformovanmi daty (u obsahuje normalized stediska + financovn)\n        const parsedUpdateData = {\n          ...transformedResult  //  U obsahuje: strediska_kod (array), zpusob_financovani (string), polozky_objednavky (array), atd.\n        };\n\n        addDebugLog('success', 'UPDATE', 'data-transformed', `Data transformovna: strediska=${parsedUpdateData.strediska_kod?.join(', ') || 'none'}, financovani=${parsedUpdateData.zpusob_financovani || 'none'}`);\n\n\n        //  Pevst workflow kd na textov popis\n        const stavObjednavky = (() => {\n          try {\n            const stavyArray = Array.isArray(updatedWorkflowKod)\n              ? updatedWorkflowKod\n              : JSON.parse(updatedWorkflowKod || '[\"NOVA\"]');\n            const poslednStav = stavyArray[stavyArray.length - 1];\n            const stavInfo = WORKFLOW_STATES[poslednStav];\n            return stavInfo?.name || poslednStav || 'Nov';\n          } catch (e) {\n            return 'Nov';\n          }\n        })();\n\n        // Pidat stav_objednavky do parsedUpdateData\n        parsedUpdateData.stav_objednavky = stavObjednavky;\n\n        //  KRITICK: Normalizovat dodavatel_zpusob_potvrzeni do jednotnho FE formtu\n        // Podporovan BE formty:\n        // 1. NOV: { potvrzeni: 'ANO', zpusoby: ['email'], platba: 'faktura' }\n        // 2. STAR: { potvrzeno: true, zpusob: ['email'], platba: 'faktura' }\n        // FE oekv: { potvrzeni: 'ANO', zpusoby: ['email'], platba: 'faktura' }\n\n        if (parsedUpdateData.dodavatel_zpusob_potvrzeni && typeof parsedUpdateData.dodavatel_zpusob_potvrzeni === 'object') {\n          const beData = parsedUpdateData.dodavatel_zpusob_potvrzeni;\n\n          //  ULOIT originln hodnotu z DB (pro ppad zamen sekce)\n          parsedUpdateData.dodavatel_zpusob_potvrzeni_original = JSON.stringify(beData);\n\n          //  Pokud u m sprvnou FE strukturu (potvrzeni + zpusoby), jen normalizuj hodnoty\n          if (beData.potvrzeni !== undefined) {\n            parsedUpdateData.dodavatel_zpusob_potvrzeni = {\n              potvrzeni: beData.potvrzeni || 'NE',\n              zpusoby: Array.isArray(beData.zpusoby) ? beData.zpusoby : [],\n              platba: beData.platba || ''\n            };\n            addDebugLog('info', 'UPDATE', 'normalize-potvrzeni-ok',\n              `Normalizovn dodavatel_zpusob_potvrzeni (u sprvn formt): ${JSON.stringify(parsedUpdateData.dodavatel_zpusob_potvrzeni)}`);\n          }\n          //  Transformuj star BE formt (potvrzeno)\n          else if (beData.potvrzeno !== undefined) {\n            parsedUpdateData.dodavatel_zpusob_potvrzeni = {\n              potvrzeni: beData.potvrzeno ? 'ANO' : 'NE',\n              zpusoby: beData.zpusob || beData.zpusob_potvrzeni || [],\n              platba: beData.platba || beData.zpusob_platby || ''\n            };\n            addDebugLog('info', 'UPDATE', 'transform-potvrzeni-old',\n              `Transformovn dodavatel_zpusob_potvrzeni (star BE formt): ${JSON.stringify(parsedUpdateData.dodavatel_zpusob_potvrzeni)}`);\n          }\n          //  Fallback - star formt BEZ potvrzeno (odvo z dt_akceptace)\n          else if (beData.zpusob !== undefined || beData.zpusoby !== undefined) {\n            const maAkceptaci = !!(parsedUpdateData.dt_akceptace && parsedUpdateData.dodavatel_potvrdil_id);\n            parsedUpdateData.dodavatel_zpusob_potvrzeni = {\n              potvrzeni: maAkceptaci ? 'ANO' : 'NE',\n              zpusoby: beData.zpusoby || beData.zpusob || beData.zpusob_potvrzeni || [],\n              platba: beData.platba || beData.zpusob_platby || ''\n            };\n            addDebugLog('info', 'UPDATE', 'transform-potvrzeni-fallback',\n              `Transformovn dodavatel_zpusob_potvrzeni (fallback z dt_akceptace): ${JSON.stringify(parsedUpdateData.dodavatel_zpusob_potvrzeni)}`);\n          }\n        }\n\n        //  NAST PLOHY PRO FAKTURY (PED setFormData)\n        const fakturyWithAttachments = parsedUpdateData.faktury ? await Promise.all(\n          parsedUpdateData.faktury.map(async (fakturaFromDB) => {\n            // Parsovat ISDOC data z rozsirujici_data pokud existuj\n            const isdocData = fakturaFromDB.rozsirujici_data?.isdoc;\n\n            //  PARSOVN STEDISEK z DB JSON stringu na pole STRING (NE objekt!)\n            let parsedStrediska = [];\n            try {\n              if (Array.isArray(fakturaFromDB.fa_strediska_kod)) {\n                parsedStrediska = fakturaFromDB.fa_strediska_kod;\n              } else if (typeof fakturaFromDB.fa_strediska_kod === 'string') {\n                parsedStrediska = JSON.parse(fakturaFromDB.fa_strediska_kod || '[]');\n              }\n\n              //  VYISTIT - zajistit e jsou JEN STRINGY (extrahovat z objekt pokud jsou tam)\n              parsedStrediska = parsedStrediska.map(item => {\n                if (typeof item === 'string') {\n                  return item; // U je string - OK\n                }\n                // Extrahuj z objektu\n                return item.kod_stavu || item.value || item.id || item;\n              });\n\n              //  DEBUG: Co jsme naparsovali?\n            } catch (e) {\n              parsedStrediska = [];\n            }\n\n            //  NAST PLOHY FAKTURY Z DB\n            let attachments = [];\n            if (fakturaFromDB.id && !String(fakturaFromDB.id).startsWith('temp-')) {\n              try {\n                const attachResponse = await listInvoiceAttachments(\n                  fakturaFromDB.id,\n                  username,\n                  token,\n                  formData.id  // orderId\n                );\n                attachments = attachResponse.data?.attachments || attachResponse.data || [];\n              } catch (err) {\n              }\n            }\n\n            return {\n              ...fakturaFromDB,\n              // Mapovn DB -> FE (stejn jako pi INSERT)\n              fa_dorucena: fakturaFromDB.fa_datum_doruceni ? 1 : 0,\n              fa_splatnost: fakturaFromDB.fa_splatnost || (fakturaFromDB.fa_datum_splatnosti ? fakturaFromDB.fa_datum_splatnosti.split(' ')[0] : ''),\n              fa_strediska_kod: parsedStrediska,\n              //  KRITICK: Pidat naten plohy\n              attachments: attachments,\n              // Zachovat originln DB pole pro API odesln\n              fa_datum_doruceni: fakturaFromDB.fa_datum_doruceni,\n              fa_datum_splatnosti: fakturaFromDB.fa_datum_splatnosti,\n              fa_datum_vystaveni: fakturaFromDB.fa_datum_vystaveni,\n              // Obnovit ISDOC metadata z rozsirujici_data\n              ...(isdocData ? {\n                _isdoc_polozky: isdocData.polozky,\n                _isdoc_dodavatel: isdocData.dodavatel,\n                _fromISDOC: true\n              } : {})\n            };\n          })\n        ) : [];\n\n        //  KRITICK: Aktualizovat formData s daty z DB (jedin voln s mergem)\n        // OPRAVENO: Odstranno duplicitn setFormData(parsedUpdateData) kter pepisovalo cel state\n        //  BUGFIX: Zachovat objednatel_id z pvodnho formData, protoe backend ho pi UPDATE NEVRAC\n        setFormData(prev => ({\n          ...prev,\n          ...parsedUpdateData,  // Pouij parsedUpdateData msto updatedFormDataImmediate (obsahuje parsovan stediska + stav_objednavky)\n          //  EXPLICITN nastavit workflow kd z BE odpovdi\n          stav_workflow_kod: updatedWorkflowKod,\n          //  ZACHOVAT objednatel_id + osobn daje objednatele z pvodnho formData\n          objednatel_id: prev.objednatel_id || parsedUpdateData.objednatel_id,\n          jmeno: prev.jmeno || parsedUpdateData.jmeno,\n          email: prev.email || parsedUpdateData.email,\n          telefon: prev.telefon || parsedUpdateData.telefon,\n          //  POUT FAKTURY S NATENMI PLOHAMI\n          faktury: fakturyWithAttachments.length > 0 ? fakturyWithAttachments : prev.faktury\n        }));\n\n        addDebugLog('success', 'UPDATE', 'formdata-updated', `FormData aktualizovn: workflow=${updatedWorkflowKod}, strediska=${parsedUpdateData.strediska_kod.join(', ')}`);\n        \n        //  OPRAVA: RELOAD objednvky po UPDATE pro zskn enriched dat (vetn financovani.lp_nazvy)\n        // Backend UPDATE nevrac enriched financovn  musme zavolat GET s enriched=true\n        try {\n          const freshOrderData = await getOrderV2(formData.id, token, username, true); // enriched=true\n          \n          if (freshOrderData?.financovani?.lp_nazvy && Array.isArray(freshOrderData.financovani.lp_nazvy)) {\n            const lpOptions = freshOrderData.financovani.lp_nazvy\n              .map(lp => ({\n                id: lp.id,\n                kod: lp.cislo_lp || lp.kod || `LP${lp.id}`,\n                nazev: lp.nazev || 'Bez nzvu',\n                kategorie: lp.kategorie,\n                limit: lp.limit || lp.celkovy_limit,\n                cerpano: lp.cerpano || lp.skutecne_cerpano,\n                zbyva: lp.zbyva || lp.zbyva_skutecne,\n                rok: lp.rok,\n                label: `${lp.cislo_lp || lp.kod || `LP${lp.id}`} - ${lp.nazev || 'Bez nzvu'}`\n              }))\n              .sort((a, b) => a.nazev.localeCompare(b.nazev, 'cs'));\n            \n            setLpOptionsForItems(lpOptions);\n            addDebugLog('success', 'UPDATE', 'lp-options-reloaded', `LP options nateny z GET po UPDATE: ${lpOptions.length}`);\n          } else {\n            addDebugLog('warning', 'UPDATE', 'lp-options-missing', 'Enriched data neobsahuj financovani.lp_nazvy');\n          }\n        } catch (reloadError) {\n          addDebugLog('error', 'UPDATE', 'lp-options-reload-failed', `Chyba pi reload LP options: ${reloadError.message}`);\n        }\n\n        //  Pepoet erpn smlouvy (pokud je smlouva vybran a objednvka ve fzi 7-8)\n        if (formData.cislo_smlouvy && currentPhase >= 7) {\n          try {\n            await prepocetCerpaniSmluv({\n              token,\n              username,\n              cislo_smlouvy: formData.cislo_smlouvy\n            });\n            addDebugLog('success', 'SMLOUVA', 'prepocet-ok', `Pepoet erpn smlouvy ${formData.cislo_smlouvy} spn`);\n          } catch (error) {\n            addDebugLog('warning', 'SMLOUVA', 'prepocet-error', `Chyba pi pepotu smlouvy: ${error.message}`);\n            // Neperuovat proces ukldn, jen logovat\n          }\n        }\n\n        //  KRITICK: Nastavit flag, e workflow state byl aktualizovn\n        window.__workflowStateUpdated = true;\n\n        //  FORCE REFRESH workflowManager hned po setFormData\n        workflowForceRefresh();\n\n        //  Reset unlock states - sekce se maj zamknout podle nov fze\n        workflowManager.resetAllUnlocks();\n\n        //  PEPOTN FZE: Explicitn vpoet fze po UPDATE s NOVMI daty z DB\n        // Toto zajist sprvn zobrazen nap. 10/10 msto 9/10 po potvrzen vcn sprvnosti\n        const calculatePhaseFromWorkflow = (workflowKod, hasId, orderData = {}) => {\n          if (!hasId) return 1;\n          if (hasWorkflowState(workflowKod, 'DOKONCENA')) return 10;\n          // ZKONTROLOVANA - fze 10 (ped dokonenm)\n          if (hasWorkflowState(workflowKod, 'ZKONTROLOVANA')) return 10;\n          // VECNA_SPRAVNOST - fze 9 (vcn sprvnost)\n          if (hasWorkflowState(workflowKod, 'VECNA_SPRAVNOST')) return 9;\n          if (hasWorkflowState(workflowKod, 'FAKTURACE')) return 8;\n\n          //  FZE 7: UVEREJNENA - po vyplnn registru smluv\n          if (hasWorkflowState(workflowKod, 'UVEREJNENA')) return 7;\n\n          //  FZE 8: NEUVEREJNIT - rozhodnuto e nebude zveejnna  FZE 8 (Fakturace)\n          if (hasWorkflowState(workflowKod, 'NEUVEREJNIT')) return 8;\n\n          //  FZE 6: UVEREJNIT - rozhodnuto e m bt zveejnna  FZE 6 (vypluj registr)\n          if (hasWorkflowState(workflowKod, 'UVEREJNIT')) return 6;\n\n          if (hasWorkflowState(workflowKod, 'POTVRZENA')) return 5;\n          if (hasWorkflowState(workflowKod, 'ODESLANA')) return 4;\n          if (hasWorkflowState(workflowKod, 'SCHVALENA') || hasWorkflowState(workflowKod, 'ROZPRACOVANA')) return 3;\n          if (hasWorkflowState(workflowKod, 'ODESLANA_KE_SCHVALENI') || hasWorkflowState(workflowKod, 'CEKA_SE')) return 2;\n          return 1;\n        };\n\n        const newPhase = calculatePhaseFromWorkflow(updatedWorkflowKod, parsedUpdateData.id || formData.id, parsedUpdateData);\n        addDebugLog('info', 'UPDATE', 'phase-refreshed', ` Fze EXPLICITN pepotna: ${newPhase}/10, workflow: ${updatedWorkflowKod}`);\n\n\n        //  WORKFLOW REFACTORING: Po spnm UPDATE aktualizovat draft s erstvmi daty z DB\n        // Backend vrac kompletn zznam, take draft bude synchronizovan s DB\n        //  KRITICK: Mergovat pvodn formData (s polokami!) + parsovan DB data\n        try {\n          draftManager.setCurrentUser(user_id);\n\n          //  FIX: Mergovat updatedFormDataImmediate (obsahuje poloky + financovn) + parsedUpdateData (DB data)\n          //  BUGFIX: Zachovat objednatel_id z pvodnho formData, protoe backend ho pi UPDATE NEVRAC\n          //  KRITICK OPRAVA: Zachovat financovn z PVODNHO formData (ped UPDATE), ne z odpovdi BE\n          const mergedDraftData = {\n            ...updatedFormDataImmediate, // Pvodn data s polokami\n            ...parsedUpdateData,         // Pepsat DB daty (workflow, atd.) + PARSOVAN FINANCOVN!\n            // Zachovat poloky a faktury z pvodnho formData\n            polozky_objednavky: updatedFormDataImmediate.polozky_objednavky || [],\n            faktury: fakturyWithAttachments.length > 0 ? fakturyWithAttachments : updatedFormDataImmediate.faktury || [], //  PLOHY!\n            //  ZACHOVAT objednatel_id + osobn daje objednatele z pvodnho formData\n            objednatel_id: updatedFormDataImmediate.objednatel_id || parsedUpdateData.objednatel_id,\n            jmeno: updatedFormDataImmediate.jmeno || parsedUpdateData.jmeno,\n            email: updatedFormDataImmediate.email || parsedUpdateData.email,\n            telefon: updatedFormDataImmediate.telefon || parsedUpdateData.telefon,\n            //  KRITICK: EXPLICITN zachovat dynamick pole financovn Z PVODNHO formData\n            // Backend pi UPDATE nemus vracet vechna pole financovn  pouij PVODN hodnoty z formData\n            zpusob_financovani: parsedUpdateData.zpusob_financovani || formData.zpusob_financovani || updatedFormDataImmediate.zpusob_financovani,\n            lp_kod: parsedUpdateData.lp_kod || formData.lp_kod || updatedFormDataImmediate.lp_kod,\n            cislo_smlouvy: parsedUpdateData.cislo_smlouvy || formData.cislo_smlouvy || updatedFormDataImmediate.cislo_smlouvy,\n            smlouva_poznamka: parsedUpdateData.smlouva_poznamka || formData.smlouva_poznamka || updatedFormDataImmediate.smlouva_poznamka,\n            individualni_schvaleni: parsedUpdateData.individualni_schvaleni || formData.individualni_schvaleni || updatedFormDataImmediate.individualni_schvaleni,\n            individualni_poznamka: parsedUpdateData.individualni_poznamka || formData.individualni_poznamka || updatedFormDataImmediate.individualni_poznamka,\n            pojistna_udalost_cislo: parsedUpdateData.pojistna_udalost_cislo || formData.pojistna_udalost_cislo || updatedFormDataImmediate.pojistna_udalost_cislo,\n            pojistna_udalost_poznamka: parsedUpdateData.pojistna_udalost_poznamka || formData.pojistna_udalost_poznamka || updatedFormDataImmediate.pojistna_udalost_poznamka\n          };\n\n          await draftManager.saveDraft(mergedDraftData, {\n            step: getCurrentPhase(),\n            attachments: attachments,\n            metadata: {\n              version: '1.4',\n              isConceptSaved: true,\n              isOrderSavedToDB: true,\n              savedOrderId: formData.id,\n              isChanged: false, //  FALSE = dn neuloen zmny (ve je v DB)\n              dictionaries: {\n                approvers: approvers || [],\n                users: allUsers || [],\n                strediska: strediskaOptions || [],\n                financovani: financovaniOptions || [],\n                druhyObjednavky: druhyObjednavkyOptions || [],\n                lpKody: lpKodyOptions || []\n              }\n            }\n          });\n          addDebugLog('success', 'UPDATE', 'draft-updated', `Draft aktualizovn s PARSOVANMI DB daty (workflow: ${updatedWorkflowKod}, strediska: ${parsedUpdateData.strediska_kod.join(', ')}, poloky: ${mergedDraftData.polozky_objednavky?.length || 0}, financovn: ${mergedDraftData.zpusob_financovani || 'none'})`);\n\n          //  AKTUALIZOVAT SNAPSHOT po spnm uloen\n          originalFormDataRef.current = JSON.parse(JSON.stringify(mergedDraftData));\n\n          //  BROADCAST: Aktualizovat MenuBar (zstv v edit reimu)\n          broadcastOrderState({\n            isEditMode: true,\n            orderId: formData.id,\n            orderNumber: formData.ev_cislo || formData.cislo_objednavky\n          });\n          addDebugLog('success', 'UPDATE', 'broadcast', `Broadcast stavu odesln (isEditMode: true, orderId: ${formData.id})`);\n        } catch (error) {\n          addDebugLog('error', 'UPDATE', 'draft-update-error', `Chyba pi aktualizaci draftu: ${error.message}`);\n        }\n\n        addDebugLog('success', 'UPDATE', 'workflow-update', `Workflow stav aktualizovn: ${updatedWorkflowKod}`);\n\n        // FZE se automaticky pepot z aktualizovanho formData.stav_workflow_kod\n        addDebugLog('success', 'UPDATE', 'workflow-state', `DB stav: ${updatedWorkflowKod} - fze se pepot automaticky`);\n\n        //  TOAST NOTIFIKACE pro UPDATE - zobrazit A PO aktualizaci state\n        if (shouldStayOnForm) {\n          // SUPERADMIN/ADMIN - zstv na formuli, zobrazit toast\n          const orderNumber = formData.ev_cislo || formData.cislo_objednavky || formData.id;\n          showToast && showToast(`Objednvka ${orderNumber} byla spn aktualizovna`, { type: 'success' });\n        } else {\n          // Bn uivatel - zobrazit obecnou zprvu (bude pesmrovn)\n          if (result.message) {\n            showToast && showToast(result.message, { type: 'success' });\n          } else {\n            const orderNumber = formData.ev_cislo || formData.cislo_objednavky || formData.id;\n            showToast && showToast(`Objednvka ${orderNumber} byla spn aktualizovna`, { type: 'success' });\n          }\n        }\n\n        // Debug: Zkontroluj, zda m workflow stav SCHVALENA\n        const hasSchvalena = hasWorkflowState(updatedWorkflowKod, 'SCHVALENA');\n        addDebugLog('info', 'UPDATE', 'phase-check', `M SCHVALENA: ${hasSchvalena}, nov fze by mla bt: ${hasSchvalena ? '2' : '1'}`);\n\n        // Po spnm UPDATE - reset stav a refresh autosave\n        // Reset odemknut pouze pokud je objednvka skuten schvlen\n        if (hasWorkflowState(updatedWorkflowKod, 'SCHVALENA')) {\n          setIsPhase1Unlocked(false); // Reset odemknut pouze pro schvlenou objednvku\n          addDebugLog('info', 'UPDATE', 'lock-sections', 'FZE 1 sekce zameny - objednvka je schvlen');\n        } else {\n          addDebugLog('info', 'UPDATE', 'keep-unlocked-phase1', `FZE 1 sekce zstvaj odemen - stav: ${updatedWorkflowKod}`);\n        }\n\n        // Pro FZE 2: Zamknout pokud DB obsahuje ODESLANA/ZRUSENA\n        const hasOdeslanaInUpdatedState = hasWorkflowState(updatedWorkflowKod, 'ODESLANA');\n        const hasZrusenaInUpdatedState = hasWorkflowState(updatedWorkflowKod, 'ZRUSENA');\n\n        // Zamykn e useEffect podle formData.stav_workflow_kod\n\n        // ZAMKNOUT FZE 2 - pokud je objednvka odeslan/zruen\n        // KONTROLA POUZE podle DB workflow stavu - NE podle UI checkboxu stav_stornovano!\n        addDebugLog('success', 'UPDATE', 'direct-lock-check', `Pm zamykn FZE 2. Nov stav: ${updatedWorkflowKod}`);\n        const shouldLockPhase2Now = (\n          hasWorkflowState(updatedWorkflowKod, 'ODESLANA') ||\n          hasWorkflowState(updatedWorkflowKod, 'ZRUSENA')\n        );\n\n        if (shouldLockPhase2Now) {\n          //  Zkontrolovat pes DraftManager, jestli nen Phase 2 run odemeno\n          let isManuallyUnlocked = false;\n          try {\n            const uiState = draftManager.getUIState();\n            if (uiState) {\n              const currentOrderId = formData.id;\n              // Kontrolovat pouze pokud existuje ID objednvky\n              if (currentOrderId && uiState.phase2OrderId === currentOrderId && uiState.phase2Unlocked === true) {\n                isManuallyUnlocked = true;\n              }\n            }\n          } catch (e) {\n            addDebugLog('warning', 'UPDATE', 'unlock-check-error', `Chyba pi kontrole Phase 2 unlock stavu: ${e.message}`);\n          }\n\n          if (isManuallyUnlocked) {\n            addDebugLog('info', 'UPDATE', 'phase2-keep-unlocked', `FZE 2 zstv ODEMENA - byla run odemena`);\n          } else {\n            setIsPhase3SectionsUnlocked(false);\n          }\n        }\n        setHasTriedToSubmit(false); // Reset validace po spnm uloen\n\n        // KRITICK: Synchronizace u probhla pes DraftManager.syncWithDatabase()\n        // saveDraftWithData() u nen poteba - data jsou u uloena\n\n        // Pouij explicitn data msto aktulnho stavu formData\n        // KRITICK: orderId potebujeme pro dal operace (me bt pouit i ne)\n        //  V2 API: result je pmo data objednvky, NE result.data!\n        const updateOrderId = result.id || formData.id || formData.id;\n\n        // POZNMKA: Autosave byl pesunut do DraftManager.syncWithDatabase()\n        // Nen poteba volat saveDraftWithData - zpsobovalo duplicitn zpis\n        addDebugLog('info', 'AUTOSAVE', 'skip-duplicate', `Autosave peskoen - ji proveden pes DraftManager.syncWithDatabase()`);\n\n        // === SUPERADMIN/ADMIN zachovn draftu i po UPDATE ===\n        // POUIJ ji deklarovan promnn z nadazenho scope (dek ~5203-5205)\n\n        // RESET isChanged - data jsou synchronizovna s DB\n        setIsChanged(false);\n\n        // KRITICK: Pro bn uivatele spustit progress a pesmrovn (stejn jako u INSERT)\n        const shouldShowProgress = !shouldStayOnForm; // Bn uivatel vid progress\n        const orderNumber = formData.ev_cislo || formData.cislo_objednavky || formData.id;\n\n        if (shouldShowProgress) {\n          //  SYNCHRONN MAZN VECH KL - NESM SE DOSTAT DO RACE CONDITION S NAVIGATE()\n          setDisableAutosave(true);\n          disableAutosaveRef.current = true; //  OKAMIT zakzat autosave (REF)\n          setIsEditMode(false);\n          // NOTE: formData.id removed\n          setIsConceptSaved(false);\n\n          //  Pouij DraftManager pro CENTRALIZOVAN mazn VECH kl (ASYNCHRONN pro verifikaci)\n          if (user_id) {\n            draftManager.setCurrentUser(user_id);\n            const deleted = await draftManager.deleteAllDraftKeys();\n\n            if (deleted) {\n              addDebugLog('success', 'UPDATE', 'draftmanager-delete', `Vechny kle smazny pes DraftManager`);\n            } else {\n            }\n          }\n\n          //  KRITICK: Invaliduj cache PED navigac (aby seznam ml erstv data)\n          try {\n            ordersCacheService.invalidate(user_id);\n            addDebugLog('success', 'UPDATE', 'cache-invalidation', 'Cache invalidovna ped navigac');\n          } catch (e) {\n            addDebugLog('error', 'UPDATE', 'cache-invalidation-error', `Chyba pi invalidaci cache: ${e.message}`);\n          }\n\n          startSaveProgressAndRedirect(orderNumber, updateOrderId);\n        } else {\n          // SUPERADMIN/ADMIN - zstv na formuli v edit reimu\n          //  Povolit autosave zpt (zstvaj editovat)\n          setDisableAutosave(false);\n          disableAutosaveRef.current = false;\n          draftManager.setAutosaveEnabled(true, 'SUPERADMIN/ADMIN stays on form after UPDATE');\n          addDebugLog('info', 'UPDATE', 'stay-on-form', `SUPERADMIN/ADMIN zstv na formuli - koncept NEN smazn`);\n\n          //  ADMIN: Zstat na stejn pozici - NEAUTOMATICKY scrollovat\n          // Uivatel m monost pokraovat tam, kde skonil\n          addDebugLog('info', 'UPDATE', 'stay-in-place', 'Zsta na stejn pozici po uloen');\n        }\n      }\n\n    } catch (error) {\n      const endpoint = (!isOrderSavedToDB || !formData.id) ? 'orders25/partial-insert' : 'orders25/partial-update';\n      addDebugLog('error', 'API', endpoint, error.message);\n\n      // Zpracovat HTTP 423 error (zameno jinm uivatelem)\n      if (error.lock_info) {\n        const lockInfo = error.lock_info;\n        \n        //  FIX: Kontrolovat POUZE locked === true (= zameno JINM uivatelem)\n        // locked === false znamen \"mu editovat\" (voln NEBO moje zamen)\n        if (lockInfo.locked === true) {\n          //  Zameno JINM uivatelem - zobrazit chybu o zamen\n          const userName = lockInfo.locked_by_user_fullname || `uivatel #${lockInfo.locked_by_user_id}`;\n          const lockAge = lockInfo.lock_age_minutes\n            ? ` (zameno ped ${lockInfo.lock_age_minutes} minutami)`\n            : '';\n\n          showToast && showToast(\n            `Nelze uloit zmny. Objednvka je zamena uivatelem ${userName}${lockAge}`,\n            { type: 'error' }\n          );\n          \n          addDebugLog('error', 'LOCK', 'order-locked-by-other', `Objednvka zamena uivatelem ${userName}`);\n        } else {\n          //  locked === false  MOJE objednvka nebo voln, zobrazit obecnou chybu\n          const errorMsg = translateErrorMessageShort(error.message);\n          showToast && showToast(`Nepodailo se uloit objednvku: ${errorMsg}`, { type: 'error' });\n          \n          addDebugLog('info', 'LOCK', 'order-owned-by-me', `Lock info ptomen, ale locked=false (moje objednvka)`);\n        }\n      } else {\n        const errorMsg = translateErrorMessageShort(error.message);\n        showToast && showToast(`Nepodailo se uloit objednvku: ${errorMsg}`, { type: 'error' });\n      }\n\n      //  Povolit autosave zpt pi chyb (uivatel me pokraovat v editaci)\n      setDisableAutosave(false);\n      disableAutosaveRef.current = false;\n      draftManager.setAutosaveEnabled(true, 'Error during save - re-enable autosave');\n\n      setIsSaving(false); // Vyistit saving stav pi chyb\n    } finally {\n      // Trigger user activity update after successful save\n      triggerActivity();\n\n      setIsSavingDraft(false);\n\n      //  KRITICK: Pokat na aktualizaci workflow state ped odemenm UI\n      if (window.__workflowStateUpdated) {\n        addDebugLog('info', 'SAVE', 'waiting-for-workflow', `ekm na propagaci workflow state do React...`);\n\n        // Pokat na render cycle pomoc setTimeout\n        setTimeout(() => {\n          addDebugLog('info', 'SAVE', 'workflow-propagated', `Workflow state propagovn, resetuji isSaving`);\n          window.__workflowStateUpdated = false;\n          setIsSaving(false);\n          addDebugLog('info', 'SAVE', 'finally-cleanup', `isSaving resetovno po workflow update`);\n        }, 200); // Zvil jsem na 200ms pro jistotu\n      } else {\n        addDebugLog('info', 'SAVE', 'no-workflow-update', 'Workflow nebyl aktualizovn, resetuji isSaving hned');\n        setTimeout(() => {\n          setIsSaving(false);\n          addDebugLog('info', 'SAVE', 'finally-cleanup', `isSaving resetovno bez workflow update`);\n        }, 100);\n      }\n\n      //  CACHE: Invaliduj cache po spnm uloen\n      try {\n        addDebugLog('info', 'SAVE', 'cache-invalidation', 'Invaliduji orders cache...');\n        ordersCacheService.invalidate(user_id);\n      } catch (e) {\n      }\n\n      //  Spus background refresh objednvek + notifikac\n      try {\n        addDebugLog('info', 'SAVE', 'background-refresh', 'Spoutm postOrderAction background task...');\n        backgroundTaskService.runTaskNow('postOrderAction');\n      } catch (e) {\n      }\n\n      //  Broadcast zmnu stavu do menu baru po spnm uloen\n      try {\n        //  KRITICK ZMNA: Po spnm uloen NEPROVDT dn draft operace\n        // Draft byl ji smazn v if(shouldShowProgress) bloku ve\n        // Broadcast by mohl zpsobit znovu-vytvoen draftu\n        // Zjisti fzi a slo objednvky pro orderSaved broadcast\n        const orderNumber = formData.ev_cislo || formData.cislo_objednavky || '';\n        const orderId = formData.id || formData.id;\n\n        //  VYPNUTO: Zpsobovalo blikn MenuBaru mezi stavy\n        /*\n        // Pokud byla objednvka uloena do DB, oznmit to ostatnm zlokm\n        if (orderId && orderNumber) {\n          broadcastOrderSaved(orderId, orderNumber);\n        }\n\n        // KRITICK: Urit znovu role uivatele pro broadcast (mus bt i ve finally bloku)\n        const isSuperAdmin = userDetail?.roles?.some(role => role.kod_role === 'SUPERADMIN');\n        const isAdmin = userDetail?.roles?.some(role => role.kod_role === 'ADMINISTRATOR');\n        const shouldStayOnForm = isSuperAdmin || isAdmin;\n\n        // KRITICK: Urit isEditMode podle toho, zda m objednvka ID v DB\n        // ALE: Pro bn uivatele (kte budou pesmrovni) VDY poslat false\n        // Pro SUPERADMIN/ADMIN (kte zstvaj) poslat true pokud m orderId\n        const isEdit = shouldStayOnForm ? !!orderId : false;\n\n        //  KRITICK: Po spnm uloen VDY poslat hasDraft: false\n        // Draft byl ji smazn v deleteAllDraftKeys() ve\n        window.dispatchEvent(new CustomEvent('orderDraftChange', {\n          detail: {\n            hasDraft: false,  //  VDY FALSE po spnm uloen!\n            isEditMode: isEdit,\n            orderId: orderId || formData.id,\n            orderNumber: orderNumber,\n            isLoading: false\n          }\n        }));\n        addDebugLog('success', 'SAVE', 'broadcast', `Broadcast orderDraftChange odesln (hasDraft: false, isEditMode: ${isEdit}, shouldStayOnForm: ${shouldStayOnForm})`);\n        */\n      } catch (e) {\n        // Ignorovat chybu broadcastu\n      }\n    }\n  };\n\n  //  HELPER: Sjednocen funkce pro ukldn draftu s konzistentnm API\n  const saveDraftUnified = async (formDataToSave, options = {}) => {\n    const {\n      isAutoSave = false,\n      explicitSavedOrderId,\n      attachmentsToSave = attachments,\n      isAfterDbSave = false\n    } = options;\n\n    if (!user_id) {\n      if (!isAutoSave) {\n        showToast && showToast('Nelze uloit koncept - nejste pihlen', { type: 'error' });\n      }\n      return false;\n    }\n\n    //  KRITICK: Kontrola zda je autosave povolen\n    if (isAutoSave && !draftManager.isAutosaveEnabled()) {\n      return false;\n    }\n\n    //  EEN PROBLMU #3: NEukldat draft pokud ev_cislo je \"Natm...\"\n    if (formDataToSave.ev_cislo === 'Natm...') {\n      return false;\n    }\n\n    try {\n      if (isAutoSave) {\n        setIsAutoSaving(true);\n      } else {\n        setIsSavingDraft(true);\n      }\n\n      // Nastavit current user\n      draftManager.setCurrentUser(user_id);\n\n      // Zkontroluj existujc draft pro firstSaveDate\n      const existingDraft = await draftManager.hasDraft();\n      let firstSaveDate = null;\n      \n      //  KRITICK: Detekce prvn autosave (NOVA  KONCEPT)\n      const isFirstAutosave = !existingDraft && isAutoSave;\n\n      if (isFirstAutosave) {\n        firstSaveDate = new Date().toISOString();\n        \n        //  BROADCAST: Pechod NOVA  KONCEPT pi prvn zmn!\n        broadcastOrderState({\n          isEditMode: false,\n          isNewOrder: false, // U nen nov, m koncept\n          orderId: null,\n          orderNumber: '',\n          hasDraft: true, //  KLOV: Koncept existuje!\n          currentPhase: currentPhase,\n          mainWorkflowState: mainWorkflowState\n        });\n      } else if (existingDraft) {\n        try {\n          const existing = await draftManager.loadDraft();\n          firstSaveDate = existing?.firstAutoSaveDate || new Date().toISOString();\n        } catch {\n          firstSaveDate = new Date().toISOString();\n        }\n      }\n\n      // Piprav formData kopii - ukld se CEL formData vetn individualni_schvaleni a pojistna_udalost_cislo\n      const draftFormData = { ...formDataToSave };\n\n      if (typeof draftFormData.financovani === 'object' && draftFormData.financovani !== null) {\n        addDebugLog('warning', 'DRAFT', 'deprecated-financovani-block', ' DEPRECATED blok se spustil - ml by bt mrtv kd!');\n        const financovaniObj = {\n          typ_financovani: formDataToSave.typ_financovani || '',\n          uhrada_faktury: formDataToSave.uhrada_faktury || '',\n          doplnujici_data: {}\n        };\n\n        if (formDataToSave.kod_strediska_financovani) financovaniObj.doplnujici_data.kod_strediska_financovani = formDataToSave.kod_strediska_financovani;\n        if (formDataToSave.organizacni_jednotka) financovaniObj.doplnujici_data.organizacni_jednotka = formDataToSave.organizacni_jednotka;\n        if (formDataToSave.ios) financovaniObj.doplnujici_data.ios = formDataToSave.ios;\n        if (formDataToSave.zakazka) financovaniObj.doplnujici_data.zakazka = formDataToSave.zakazka;\n\n        if (formDataToSave.typ_financovani === 'pojistne_udalosti') {\n          if (formDataToSave.pojistna_udalost_cislo) financovaniObj.doplnujici_data.pojistna_udalost_cislo = formDataToSave.pojistna_udalost_cislo;\n          if (formDataToSave.pojistna_udalost_poznamka) financovaniObj.doplnujici_data.pojistna_udalost_poznamka = formDataToSave.pojistna_udalost_poznamka;\n        }\n\n        draftFormData.financovani = JSON.stringify(financovaniObj);\n      }\n\n      // Serializuj attachments (odstra File objekty)\n      const serializableAttachments = attachmentsToSave.map(att => {\n        if (att.file) {\n          const { file, ...rest } = att;\n          return { ...rest, _hadFile: true };\n        }\n        return att;\n      });\n\n      // Urit formData.id\n      //  FIX: Pokud formData.id je null, ale formData.id existuje, pouij formData.id\n      // (objednvka je v DB, ale formData.id state nebyl nastaven pi naten draftu)\n      const effectiveSavedOrderId = explicitSavedOrderId !== undefined\n        ? explicitSavedOrderId\n        : (formData.id || (formDataToSave.id ? formDataToSave.id : null));\n\n      // NOTE: setSavedOrderId removed - formData.id is single source of truth\n\n      //  DEBUG: formData.id tracking\n\n      // Zkontrolovat fze 7/8 data\n      const hasPhase7Or8Data = Boolean(\n        draftFormData.vecna_spravnost_umisteni_majetku ||\n        draftFormData.vecna_spravnost_poznamka ||\n        draftFormData.dokonceni_poznamka\n      );\n\n      //  SPRVN API: saveDraft(formData, options)\n      await draftManager.saveDraft(draftFormData, {\n        orderId: effectiveSavedOrderId,\n        attachments: serializableAttachments,\n        metadata: {\n          firstAutoSaveDate: firstSaveDate,\n          version: '1.4',\n          isConceptSaved: true,\n          isOrderSavedToDB,\n          savedOrderId: effectiveSavedOrderId,\n          isChanged: isAfterDbSave ? hasPhase7Or8Data : true,\n          dictionaries: {\n            approvers: approvers || [],\n            users: allUsers || [],\n            strediska: strediskaOptions || [],\n            financovani: financovaniOptions || [],\n            druhyObjednavky: druhyObjednavkyOptions || [],\n            lpKody: lpKodyOptions || []\n          }\n        }\n      });\n\n      setLastAutoSave(new Date().toISOString());\n      setIsConceptSaved(true);\n\n      setTimeout(() => {\n        setIsAutoSaving(false);\n        setDataSource(null);\n      }, isAutoSave ? 300 : 0);\n\n      if (!isAutoSave) {\n        showToast && showToast('Koncept byl uloen do mstnho loit', { type: 'success' });\n      }\n\n      return true;\n    } catch (error) {\n      if (!isAutoSave) {\n        showToast && showToast('Nepodailo se uloit koncept', { type: 'error' });\n      }\n      setIsAutoSaving(false);\n      setIsSavingDraft(false);\n      return false;\n    }\n  };\n\n  // Pomocn funkce pro uloen draftu s explicitnmi daty\n  const saveDraftWithData = async (explicitFormData, isAutoSave = false, explicitSavedOrderId = undefined) => {\n    return saveDraftUnified(explicitFormData, {\n      isAutoSave,\n      explicitSavedOrderId\n    });\n  };\n\n  const saveDraft = async (isAutoSave = false, isAfterDbSave = false, customFormData = null) => {\n    //  KRITICK KONTROLA: Pokud se formul zavr, ZABLOKOVAT save\n    if (isClosingRef.current) {\n      console.log(' saveDraft BLOCKED - formul se zavr');\n      return { success: false, reason: 'form_closing' };\n    }\n    \n    //  Pout custom data nebo aktuln formData ze state\n    const dataToSave = customFormData || formData;\n\n    return saveDraftUnified(dataToSave, {\n      isAutoSave,\n      isAfterDbSave\n    });\n  };\n\n  //  Nastavit callback pro useAutosave hook\n  useEffect(() => {\n    autosaveCallbackRef.current = saveDraft;\n  }, [saveDraft]);\n\n  // Funkce pro revalidaci objednvky s DB (ov aktuln stav v databzi)\n  /**\n   *  Helper funkce pro extrakci enriched user data z BE\n   * Backend vrac _enriched objekt s detaily uivatel\n   * Formt: _enriched.objednatel, _enriched.garant, _enriched.prikazce atd.\n   */\n  const extractEnrichedUserData = (enrichedField) => {\n    if (!enrichedField) return null;\n\n    const titul_pred_str = enrichedField.titul_pred ? enrichedField.titul_pred + ' ' : '';\n    const jmeno_str = enrichedField.jmeno || '';\n    const prijmeni_str = enrichedField.prijmeni || '';\n    const titul_za_str = enrichedField.titul_za ? ', ' + enrichedField.titul_za : '';\n    const displayName = `${titul_pred_str}${jmeno_str} ${prijmeni_str}${titul_za_str}`.replace(/\\s+/g, ' ').trim();\n\n    return {\n      displayName: displayName || enrichedField.username || '',\n      email: enrichedField.email || '',\n      telefon: enrichedField.telefon || ''\n    };\n  };\n\n  const revalidateOrderWithDB = async (orderId) => {\n    if (!orderId || !token || !username) {\n      addDebugLog('warning', 'REVALIDATE', 'skip', 'Chyb orderId, token nebo username - peskakuji revalidaci');\n      return null;\n    }\n\n    try {\n      addDebugLog('info', 'REVALIDATE', 'start', `Revaliduji objednvku ID ${orderId} s databz... (token: ${token?.substring(0, 10)}..., username: ${username})`);\n\n\n      //  V2 API: Nati objednvku s enriched daty\n      const dbOrder = await getOrderV2(orderId, token, username, true);\n\n      addDebugLog('info', 'REVALIDATE', 'api-response', `API odpov pro ID ${orderId}: ${JSON.stringify(dbOrder, null, 2)}`);\n\n      if (!dbOrder) {\n        addDebugLog('error', 'REVALIDATE', 'null-response', `API vrtilo null pro objednvku ID ${orderId}`);\n        return null;\n      }\n\n      // V2 API vrac pmo data objednvky (ne objekt s .data polem)\n      const orderData = dbOrder;\n\n      //  DEBUG: Zobrazit vechna enriched data z backendu\n      if (orderData._enriched) {\n        addDebugLog('info', 'REVALIDATE', 'enriched-keys', `Enriched kle: ${Object.keys(orderData._enriched).join(', ')}`);\n      }\n\n      //  KRITICK: Doplnit daje objednatele z _enriched NEBO selnku uivatel\n      if (orderData.objednatel_id) {\n        // 1. Priorita: Pouij enriched data z backendu (pokud existuj)\n        if (orderData._enriched?.objednatel) {\n          const enriched = extractEnrichedUserData(orderData._enriched.objednatel);\n          if (enriched) {\n            orderData.jmeno = enriched.displayName;\n            orderData.email = enriched.email;\n            orderData.telefon = enriched.telefon;\n            addDebugLog('success', 'REVALIDATE', 'objednatel-enriched-be', `Pouity enriched data z BE: ${enriched.displayName}`);\n          }\n        }\n        // 2. Fallback: Dohledat v selnku uivatel (pokud enriched data chyb)\n        else if (allUsers && allUsers.length > 0) {\n          const objednatel = allUsers.find(u =>\n            (u.id && u.id === orderData.objednatel_id) ||\n            (u.user_id && u.user_id === orderData.objednatel_id)\n          );\n\n          if (objednatel) {\n            const titul_pred_str = objednatel.titul_pred ? objednatel.titul_pred + ' ' : '';\n            const jmeno_str = objednatel.jmeno || '';\n            const prijmeni_str = objednatel.prijmeni || '';\n            const titul_za_str = objednatel.titul_za ? ', ' + objednatel.titul_za : '';\n            const displayName = `${titul_pred_str}${jmeno_str} ${prijmeni_str}${titul_za_str}`.replace(/\\s+/g, ' ').trim();\n\n            orderData.jmeno = displayName || objednatel.username || '';\n            orderData.email = objednatel.email || '';\n            orderData.telefon = objednatel.telefon || '';\n\n            addDebugLog('success', 'REVALIDATE', 'objednatel-enriched-fe', `Doplnny daje z FE selnku: ${displayName}`);\n          } else {\n            addDebugLog('warning', 'REVALIDATE', 'objednatel-not-found', `Objednatel ID ${orderData.objednatel_id} nenalezen`);\n          }\n        }\n      }\n\n      addDebugLog('success', 'REVALIDATE', 'loaded', `Natena objednvka z DB: ID=${orderData.id}, stav_workflow_kod=\"${orderData.stav_workflow_kod}\", ev_cislo=\"${orderData.cislo_objednavky || orderData.ev_cislo}\"`);\n\n      return orderData;\n    } catch (error) {\n      addDebugLog('error', 'REVALIDATE', 'failed', `Chyba pi revalidaci: ${error.message}`);\n      return null;\n    }\n  };\n  const deleteDraft = async () => {\n    if (!user_id) return;\n\n    try {\n      //  CENTRALIZOVAN MAZN pes DraftManager (ASYNCHRONN pro verifikaci)\n      draftManager.setCurrentUser(user_id);\n      const deleted = await draftManager.deleteAllDraftKeys();\n\n      if (!deleted) {\n      }\n\n      //  RESET STATES po smazn draftu\n      setIsEditMode(false);\n      setIsConceptSaved(false);\n      // NOTE: formData.id removed\n\n      //  Sma draft pes DraftManager (centralizovan)\n      try {\n        draftManager.setCurrentUser(user_id);\n        await draftManager.deleteDraft();\n      } catch (e) {\n      }\n    } catch (error) {\n    }\n  };\n\n  // Vyistit pouze Phase 2 unlock stav (pi nvratu do pedchoz fze)\n  const clearPhase2UnlockState = () => {\n    if (!user_id) return;\n\n    try {\n      //  Pout DraftManager pro vyitn\n      draftManager.saveUIState({ phase2Unlocked: false });\n      setIsPhase3SectionsUnlocked(false);\n    } catch (error) {\n    }\n  };\n\n  // Resetovn formule do vchozho stavu\n  const resetForm = () => {\n    // Reset formData do zkladnho stavu a nastaven pihlenho uivatele jako objednatele\n    setFormData({\n      uzivatel_id: user_id || '',\n      objednatel_id: user_id || '', // Nastav pihlenho uivatele jako objednatele\n      jmeno: userDetail?.jmeno || '', // Nati jmno z userDetail\n      email: userDetail?.email || '', // Nati email z userDetail\n      telefon: userDetail?.telefon || '', // Nati telefon z userDetail\n      predmet: '',\n      popis_pozadavku: '',\n      garant_uzivatel_id: '',\n      prikazce_id: '',\n      strediska_kod: [],\n      max_cena_s_dph: '',\n      mimoradna_udalost: false, // Mimodn udlost (vchoz false)\n      // Objednatel daje - napl z userDetail\n      objednatel_jmeno: userDetail ? getUserNameById(user_id) : '',\n      objednatel_email: userDetail?.email || '',\n      objednatel_telefon: userDetail?.telefon || '',\n      poznamky: '',\n      prilohy: [],\n      ev_cislo: 'Natm...',\n      // Reset pol pro schvlen\n      stav_schvaleni: '',\n      schvalovatel_id: '',\n      dt_schvaleni: '',\n      schvaleni_komentar: '',\n      stav_workflow_kod: '[\"ODESLANA_KE_SCHVALENI\"]', //  Nov objednvka zan rovnou stavem ODESLANA_KE_SCHVALENI\n      //  KRITICK OPRAVA: Nastavit datumov daje pro novou objednvku\n      temp_datum_objednavky: new Date().toISOString().split('T')[0], // Doasn datum objednvky\n      datum_vytvoreni: '', // Datum vytvoen se nastav a pi prvnm uloen do DB\n      datum_splatnosti: '' // Datum splatnosti zatm przdn\n    });\n\n    // Reset stav uloen objednvky\n    setIsConceptSaved(false);\n    // NOTE: isOrderSavedToDB se odvod automaticky z formData.id\n    // NOTE: formData.id removed\n\n    // Reset validanch chyb a touched fields\n    setValidationErrors({});\n    setTouchedSelectFields(new Set());\n\n    // Reset auto-save asovho raztka\n    setLastAutoSave(null);\n\n    // Reset editanho reimu\n    setIsEditMode(false);\n\n    // Reset flag\n    setIsDraftLoaded(false);\n    \n    //  KRITICK: Reset ref pro natn ev. sla - umonit znovu nast pi nov objednvce\n    hasLoadedNextNumberRef.current = false;\n\n    //  Povolit autosave pi resetu formule (nov objednvka)\n    setDisableAutosave(false);\n    disableAutosaveRef.current = false;\n    draftManager.setAutosaveEnabled(true, 'Form reset - new order');\n\n    //  Vyistit uloen stavy UI pes DraftManager\n    if (user_id) {\n      try {\n        draftManager.saveUIState({\n          sectionState: {},\n          scrollPosition: 0\n        });\n        //  KRITICK: Smazat draft z localStorage, aby se pi naten nenaetl star\n        draftManager.deleteDraft();\n      } catch (error) {\n      }\n    }\n\n    addDebugLog('info', 'FORM', 'reset', 'Formul resetovn do vchozho stavu a draft smazn');\n  };\n\n  const hasDraft = () => {\n    if (!user_id) return false;\n    draftManager.setCurrentUser(user_id);\n    return draftManager.hasDraft();\n  };\n\n  // Hlavn inicializan funkce s progress barem\n  const initializeForm = async () => {\n\n    if (!token || !username) {\n      setIsFormInitializing(false);\n      setIsLoadingCiselniky(false); //  NOV: selnky nejsou naten (chyba)\n      setInitializationError('Nejste pihlen');\n      return;\n    }\n\n    try {\n      setIsFormInitializing(true);\n      setIsLoadingCiselniky(true); //  NOV: Zanme natat selnky\n      setInitializationError(null);\n\n      // Start progress bar\n      if (startGlobalProgress) startGlobalProgress();\n      if (setGlobalProgress) setGlobalProgress(10);\n\n      //  REMOVED: FormDataManager.registerStateCallbacks\n      // selnky se nyn nataj pes useFormController  useDictionaries\n      // State settery u neexistuj - data jsou v dictionariesReducer\n\n      if (setGlobalProgress) setGlobalProgress(30);\n\n      //  INICIALIZACE PES MANAGER - NEJDV nati slovnky\n      const cache = await formDataManager.initialize({\n        token,\n        username,\n        formDataId: formData.id\n      });\n\n      if (setGlobalProgress) setGlobalProgress(60);\n\n      if (setGlobalProgress) setGlobalProgress(90);\n\n      // Kontrola, jestli jsou data naten\n      const hasData = (\n        cache.users.length > 0 ||\n        cache.approvers.length > 0 ||\n        cache.strediska.length > 0 ||\n        cache.lpKody.length > 0\n      );\n\n      if (!hasData) {\n        const errorMsg = 'Nepodailo se nast dn data z API';\n        setInitializationError(errorMsg);\n        setIsLoadingCiselniky(false); //  NOV: selnky se nepodailo nast\n\n        if (showToast) showToast(errorMsg, { type: 'error' });\n        if (failGlobalProgress) failGlobalProgress();\n      } else {\n        //  REMOVED: setAreDictionariesReady - u se nepouv\n        // Flag areDictionariesReady je nyn alias na dictionaries.isReady\n        setIsLoadingCiselniky(false); //  NOV: selnky jsou naten!\n        setIsInitialized(true);\n\n        //  RESOLVE PROMISE se dl v useEffect, kter ek na skutenou zmnu options\n        // NE tady - tady se jen nastav flag\n\n        if (doneGlobalProgress) doneGlobalProgress();\n\n        //  ZRUENO: Obnoven pozice scrollu (na dost uivatele)\n        // if (hasDraft() && user_id) {\n        //   draftManager.setCurrentUser(user_id);\n        //   loadScrollPosition();\n        // }\n      }\n\n    } catch (error) {\n      const errorMsg = 'Nepodailo se inicializovat formul';\n      setInitializationError(errorMsg);\n      setIsLoadingCiselniky(false); //  NOV: Chyba pi natn selnk\n\n      if (showToast) showToast(errorMsg, { type: 'error' });\n      if (failGlobalProgress) failGlobalProgress();\n    }\n  };\n\n  //  KRITICK OPRAVA: Spustit initializeForm() JEN PI MOUNT (useEffect s przdnmi dependencies)\n  // POUZE pokud nebylo zamen u zpracovno pi natn z DB\n  useEffect(() => {\n    if (formData.id && user_id && formData.stav_workflow_kod && !isPhase3SectionsLockProcessedFromDB) {\n\n      try {\n        //  Nast stav pes DraftManager\n        const uiState = draftManager.getUIState();\n        if (uiState && uiState.phase2Unlocked) {\n          // Ovit, e se jedn o stejnou objednvku (podle ID)\n          if (uiState.phase2OrderId === formData.id && uiState.phase2Unlocked === true) {\n\n            // Kontrola oprvnn a aktulnho workflow stavu\n            const isOrderSent = hasWorkflowState(formData.stav_workflow_kod, 'ODESLANA');\n            const isOrderCancelled = hasWorkflowState(formData.stav_workflow_kod, 'ZRUSENA');\n            // KONTROLA POUZE podle DB workflow stavu - NE podle UI checkboxu!\n            const isOrderInPhase3OrHigher = isOrderSent || isOrderCancelled;\n\n            // FINLN TVRD KONTROLA: I kdy uiState k unlock, ZKONTROLUJ workflow stav!\n            const currentWorkflowState = formData.stav_workflow_kod || 'NOVA';\n            const hasOdeslano = hasWorkflowState(currentWorkflowState, 'ODESLANA');\n            const hasZruseno = hasWorkflowState(currentWorkflowState, 'ZRUSENA');\n\n            // Smazat unlock stav a zamknout POUZE pokud je stav v DB ODESLANA nebo ZRUSENA\n            if (hasOdeslano || hasZruseno) {\n              draftManager.saveUIState({ phase2Unlocked: false }); // Sma neplatn stav\n              setIsPhase3SectionsUnlocked(false);\n            } else {\n              setIsPhase3SectionsUnlocked(true);\n            }\n          }\n        }\n      } catch (e) {\n        // Chyba pi natn stavu\n      }\n    }\n  }, [formData.id, user_id, formData.stav_workflow_kod, isPhase3SectionsLockProcessedFromDB]);\n\n  // DODATEN OCHRANA: Sledovn setTimeout re-render a blokace dal localStorage kontroly\n  const [preventLocalStorageCheck, setPreventLocalStorageCheck] = useState(false);\n\n  useEffect(() => {\n    if (isPhase3SectionsLockProcessedFromDB && !preventLocalStorageCheck) {\n      setPreventLocalStorageCheck(true);\n      addDebugLog('info', 'PHASE2-UNLOCK', 'prevention-set', `Nastavena prevence localStorage kontroly - zamen zpracovno z DB`);\n    }\n  }, [isPhase3SectionsLockProcessedFromDB, preventLocalStorageCheck]);\n\n  // Sledovn zmn workflow stavu pro vynucen zamen Phase 2\n  useEffect(() => {\n    if (formData.id && formData.stav_workflow_kod && user_id) {\n      const isOrderSent = hasWorkflowState(formData.stav_workflow_kod, 'ODESLANA');\n      const isOrderCancelled = hasWorkflowState(formData.stav_workflow_kod, 'ZRUSENA');\n      // KONTROLA POUZE podle DB workflow stavu - NE podle UI checkboxu!\n      const isOrderInPhase3OrHigher = isOrderSent || isOrderCancelled;\n\n      // VDY ZAMKNOUT pokud je objednvka ve fzi 3+ (ODESLANA/ZRUENA) a nen run odemena\n      if (isOrderInPhase3OrHigher && isPhase3SectionsUnlocked) {\n        //  Zkontrolovat jestli nen run odemeno pes DraftManager\n        let isManuallyUnlocked = false;\n        try {\n          const uiState = draftManager.getUIState();\n          if (uiState) {\n            // Kontrolovat pouze pokud existuje ID objednvky\n            if (formData.id && uiState.phase2OrderId === formData.id && uiState.phase2Unlocked === true) {\n              isManuallyUnlocked = true;\n            }\n          }\n        } catch (e) {\n          // Chyba pi kontrole stavu\n        }\n\n        if (!isManuallyUnlocked) {\n          setIsPhase3SectionsUnlocked(false);\n\n          //  Vyistit stav pes DraftManager pokud nen run odemeno\n          try {\n            draftManager.saveUIState({ phase2Unlocked: false });\n          } catch (e) {\n            // Chyba pi mazn stavu\n          }\n        }\n      }\n    }\n  }, [formData.stav_workflow_kod, formData.id, user_id, isPhase3SectionsUnlocked]);\n\n  // Reset stavu pi pechodu na novou objednvku (po zruen editace)\n  useEffect(() => {\n    if (isNewOrder && userDetail && user_id) {\n\n      // Reset stavu natn draftu\n      setIsDraftLoaded(false);\n      setDataSource(null);\n      setIsPhase3SectionsLockProcessedFromDB(false); // Reset flag pro novou objednvku\n\n      // Vypl daje aktuln pihlenho uivatele\n      const jmeno = `${userDetail.titul_pred ? userDetail.titul_pred + ' ' : ''}${userDetail.jmeno || ''} ${userDetail.prijmeni || ''}${userDetail.titul_za ? ', ' + userDetail.titul_za : ''}`.replace(/\\s+/g, ' ').trim();\n\n      setFormData(prev => ({\n        ...prev,\n        uzivatel_id: user_id,\n        objednatel_id: user_id,\n        jmeno: jmeno,\n        email: userDetail.email || '',\n        telefon: userDetail.telefon || '',\n        // Vymazn dat z pedchoz editace\n        id: null,\n        ev_cislo: '',\n        cislo_objednavky: null,\n        predmet: '',\n        popis_pozadavku: '',\n        max_cena_s_dph: '',\n        polozky_objednavky: [{ id: Date.now(), popis: '', cena_bez_dph: '', sazba_dph: '21', cena_s_dph: '' }]\n      }));\n\n      // Reset validanho stavu\n      setHasTriedToSubmit(false);\n      setValidationErrors({});\n      setTouchedSelectFields(new Set());\n\n      // Success log odstrann\n    }\n  }, [isNewOrder, userDetail, user_id]);\n\n  // Naten stavu sekc pi mount komponentu\n  useEffect(() => {\n    if (user_id) {\n      const savedSectionStates = loadSectionStates();\n      if (savedSectionStates) {\n        setSectionStates(prev => ({\n          ...prev,\n          ...savedSectionStates\n        }));\n        addDebugLog('success', 'UI', 'section-states', `Naten uloen stav sekc: ${JSON.stringify(savedSectionStates)}`);\n      }\n    }\n  }, [user_id]);\n\n  // Debug logger DOASN VYPNUT - zpsobuje nekonenou smyku\n  // useEffect(() => {\n  //   setDebugLogger(addDebugLog);\n  // }, []);\n\n  //  JEDNODUCH LOGIKA: VDY pi mount spus INIT\n  useEffect(() => {\n    // // console.log(' MOUNT OrderForm25 - spoutm INIT');\n\n    if (token && username) {\n      // Inicializace zen useFormController\n    }\n\n    return () => {\n      // // console.log(' UNMOUNT OrderForm25 - istm state');\n      setIsInitialized(false);\n      //  REMOVED: setAreDictionariesReady - u se nepouv (alias na dictionaries.isReady)\n    };\n  }, []);\n\n  //  NAVIGATION FIX: Reset initialization state when editOrderId changes\n  // This ensures form re-initializes when navigating between different orders\n  useEffect(() => {\n    // Reset flags to allow re-initialization\n    setIsInitialized(false);\n    setIsDraftLoaded(false);\n    setIsFormInitializing(true);\n\n    // Reset hasLoadedNextNumberRef to allow loading new order number\n    if (hasLoadedNextNumberRef.current) {\n      hasLoadedNextNumberRef.current = false;\n    }\n\n    //  KRITICK: Vymazat formData pi zmn order ID\n    // Zabrnme zobrazen dat ze STAR objednvky bhem natn NOV\n    if (editOrderId) {\n      // Zachovat pouze zkladn strukturu formData, vymazat vechny hodnoty\n      setFormData({\n        objednatel_id: user_id || '',\n        uzivatel_id: user_id || '',\n        garant_uzivatel_id: user_id || '',\n        jmeno: '',\n        email: '',\n        telefon: '',\n        ev_cislo: 'Natm...',\n        druh_objednavky_kod: '',\n        strediska_kod: [],\n        zpusob_financovani: '',\n        poznamka: '',\n        mimoradna_udalost: false, // Mimodn udlost\n        polozky_objednavky: [{\n          nazev: '',\n          specifikace: '',\n          mnozstvi: 1,\n          merna_jednotka: '',\n          jednotkova_cena: '',\n          celkova_cena: 0\n        }],\n        dodavatel: {},\n        faktury: [],\n        stav_workflow_kod: ['NOVA'],\n        stav_schvaleni: 'ek na schvlen'\n      });\n    }\n  }, [editOrderId, user_id]);\n\n  //  REMOVED: Deprecated useEffect pro natn objednvky (177 dk)\n  // Archivovno v: _DEPRECATED/OrderForm25-deprecated-useEffects.js\n  // Nahrazeno: useFormController.initializeForm()\n\n  //  UKONEN SPLASH SCREEN - a kdy jsou data skuten VYKRESLEN (selnky + objednvka natena)\n  useEffect(() => {\n    // Pro novou objednvku: ekej jen na selnky + draft loaded\n    if (!editOrderId) {\n      if (areDictionariesReady && isInitialized && isDraftLoaded) {\n        setIsFormInitializing(false);\n      }\n      return;\n    }\n\n    // Pro editaci: ekaj na selnky + draft loaded\n    if (areDictionariesReady && isInitialized && isDraftLoaded) {\n      setIsFormInitializing(false);\n    }\n  }, [editOrderId, areDictionariesReady, isInitialized, isDraftLoaded]);\n\n  //  REF: Sleduje zda u bylo ev_cislo nateno (JEDNOU a dost!)\n  const hasLoadedNextNumberRef = useRef(false);\n\n  //  REF: Pm reference na ScrollableContent element pro scroll pozici\n  const scrollableContentRef = useRef(null);\n\n  //  REF: Pm reference na FixedHeader pro dynamick men vky\n  const fixedHeaderRef = useRef(null);\n\n  //  Sdlet ref pes window pro pstup z onDataLoaded\n  //  KRITICK: Pi mount zkontrolovat, jestli mme draft - pokud ne, resetovat ref\n  useEffect(() => {\n    window.__orderForm_hasLoadedNextNumberRef = hasLoadedNextNumberRef;\n    \n    //  FIX: Pokud NEN draft, resetovat ref (ppad hard reload po \"Nov objednvka\")\n    if (user_id) {\n      draftManager.setCurrentUser(user_id);\n      draftManager.hasDraft().then(hasDraft => {\n        if (!hasDraft && !editOrderId) {\n          // Nen draft ANI editace  reset ref, aby se naetlo ev. slo\n          hasLoadedNextNumberRef.current = false;\n        }\n      });\n    }\n  }, [user_id, editOrderId]);\n\n  //  Dynamick men vky FixedHeader a nastaven CSS variable\n  // Vka headeru + konstantn gap 20px = padding-top pro ScrollableInner\n  useLayoutEffect(() => {\n    const GAP = 20; // Konstantn mezera mezi headerem a obsahem\n\n    const updateHeaderHeight = () => {\n      if (fixedHeaderRef.current) {\n        const height = fixedHeaderRef.current.offsetHeight;\n        // Nastavit CSS custom property: vka headeru + konstantn gap\n        document.documentElement.style.setProperty('--fixed-header-height', `${height + GAP}px`);\n      }\n    };\n\n    // Aktualizovat OKAMIT pi mount\n    updateHeaderHeight();\n    \n    // Opakovat nkolikrt po mount pro jistotu (dynamick obsah se me renderovat postupn)\n    const timeouts = [\n      setTimeout(updateHeaderHeight, 50),\n      setTimeout(updateHeaderHeight, 100),\n      setTimeout(updateHeaderHeight, 200),\n      setTimeout(updateHeaderHeight, 500)\n    ];\n\n    window.addEventListener('resize', updateHeaderHeight);\n\n    // Aktualizovat tak pi zmnch obsahu headeru (ResizeObserver)\n    const observer = new ResizeObserver(() => {\n      updateHeaderHeight();\n    });\n\n    if (fixedHeaderRef.current) {\n      observer.observe(fixedHeaderRef.current);\n    }\n\n    return () => {\n      timeouts.forEach(t => clearTimeout(t));\n      window.removeEventListener('resize', updateHeaderHeight);\n      observer.disconnect();\n    };\n  }, []);\n  \n  //  Pepotat vku headeru pi zmn stavu objednvky nebo workflow\n  useEffect(() => {\n    if (fixedHeaderRef.current) {\n      const height = fixedHeaderRef.current.offsetHeight;\n      document.documentElement.style.setProperty('--fixed-header-height', `${height + 20}px`);\n    }\n  }, [isOrderCompleted, shouldLockAllSections, formData.stav_workflow_kod, formData.ev_cislo, formData.dokoncil_id]);\n\n  // Naten evidennho sla - POUZE pro nov objednvky, POUZE JEDNOU!\n  useEffect(() => {\n    //  KRITICK: Nast slo JEN JEDNOU!\n\n    // 0 U bylo nateno  SKIP\n    if (hasLoadedNextNumberRef.current) {\n      return;\n    }\n\n    // 1 Pokud m ID  uloeno v DB  SKIP\n    if (formData.id) {\n      return;\n    }\n\n    // 2 Pokud je v EDIT mode  SKIP\n    if (isEditMode) {\n      return;\n    }\n\n    // 3 Pokud u m ev_cislo (ne \"Natm...\")  SKIP\n    if (formData.ev_cislo && formData.ev_cislo !== 'Natm...') {\n      hasLoadedNextNumberRef.current = true; // Oznait e u mme slo\n      return;\n    }\n\n    //  Vygeneruj slo JEN KDY:\n    // - Nen ID, nen edit mode, nen ev_cislo, mme API pstup\n    if (token && username) {\n      loadNextOrderNumber().then(success => {\n        if (success) {\n          hasLoadedNextNumberRef.current = true; // Oznait e u bylo nateno\n        }\n      });\n    }\n  }, [formData.id, isEditMode, token, username]); //  REMOVED: formData.ev_cislo z dependencies!\n\n  //  Funkce pro naten detail LP (zbvajc stka)\n  const loadLPDetail = useCallback(async (lp_id_or_kod) => {\n    if (!lp_id_or_kod || !token || !username) return;\n\n    // Najt LP option pro zskn cislo_lp\n    const lpOption = lpKodyOptions.find(opt => opt.id === lp_id_or_kod || opt.kod === lp_id_or_kod);\n    if (!lpOption) {\n      return;\n    }\n\n    // Backend oekv cislo_lp (textov kd typu \"LPIA1\")\n    const cislo_lp = lpOption.cislo_lp || lpOption.label || lpOption.kod;\n    if (!cislo_lp) {\n      return;\n    }\n\n    setLoadingLpDetails(prev => {\n      // Pokud u mme detaily nebo se prv nataj, nemusme natat znovu\n      if (prev[lp_id_or_kod]) return prev;\n      return { ...prev, [lp_id_or_kod]: true };\n    });\n\n    try {\n      const detail = await fetchLPDetail({ token, username, cislo_lp });\n      if (detail) {\n        setLpDetails(prev => ({ ...prev, [lp_id_or_kod]: detail }));\n      }\n    } catch (error) {\n      // Netobrazovat toast pokud je to jen 404 - LP nemus existovat\n      if (!error.message.includes('404') && !error.message.includes('400')) {\n        showToast(`Nepodailo se nast detail LP: ${error.message}`, 'error');\n      }\n    } finally {\n      setLoadingLpDetails(prev => ({ ...prev, [lp_id_or_kod]: false }));\n    }\n  }, [token, username, showToast, lpKodyOptions]);\n\n  //  Funkce pro naten seznamu smluv (pro autocomplete)\n  const loadSmlouvyList = useCallback(async () => {\n    if (!token || !username) return;\n    if (loadingSmlouvyList) return; // Zabrnit duplicitnmu natn\n\n    setLoadingSmlouvyList(true);\n\n    try {\n      const response = await getSmlouvyList({\n        token,\n        username,\n        show_inactive: false,\n        limit: 500 // Nast max 500 aktivnch smluv\n      });\n\n      if (response?.data && Array.isArray(response.data)) {\n        setSmlouvyList(response.data);\n      } else {\n        setSmlouvyList([]);\n      }\n    } catch (error) {\n      // Nebudeme zobrazovat toast - me to bt jen chybjc oprvnn\n      setSmlouvyList([]);\n    } finally {\n      setLoadingSmlouvyList(false);\n    }\n  }, [token, username, loadingSmlouvyList]);\n\n  //  Funkce pro naten detailu smlouvy (zbvajc stka)\n  const loadSmlouvaDetail = useCallback(async (cislo_smlouvy) => {\n    if (!cislo_smlouvy || !token || !username) {\n      setSmlouvaDetail(null);\n      return;\n    }\n\n    setLoadingSmlouvaDetail(true);\n\n    try {\n      // Najt smlouvu podle sla v natenm seznamu\n      const smlouva = smlouvyList.find(s => \n        s.cislo_smlouvy === cislo_smlouvy || \n        s.evidencni_cislo === cislo_smlouvy\n      );\n\n      if (smlouva) {\n        // Pout data pmo ze seznamu - u obsahuj vechny potebn informace\n        setSmlouvaDetail(smlouva);\n      } else {\n        // Smlouva nebyla nalezena v seznamu - umonit uivateli zadat vlastn slo\n        setSmlouvaDetail({ notFound: true });\n      }\n    } catch (error) {\n      setSmlouvaDetail({ notFound: true });\n    } finally {\n      setLoadingSmlouvaDetail(false);\n    }\n  }, [token, username, smlouvyList, formData.cislo_smlouvy]);\n\n  //  DEBUG: Monitor formData checkboxy changes\n  // DEBUG: Sledovn zmn checkbox pro zamykn sekc\n  useEffect(() => {\n    // Removed verbose logging - checkbox states tracked internally\n  }, [formData.potvrzeni_vecne_spravnosti, formData.potvrzeni_dokonceni_objednavky, formData.id]);\n\n  //  ODSTRANNO: Reload uivatel - FormDataManager to dl automaticky pi inicializaci\n  // useEffect(() => {\n  //   if (token && username && !isFormInitializing) {\n  //     loadAllUsers();\n  //   }\n  // Automatick naplnn daj objednatele pi prvn interakci s formulem\n  useEffect(() => {\n    // Kontrola: M uivatel daje, jsou daje objednatele przdn, nen editan reim, nen ji naten draft\n    const shouldFillOrdererData = userDetail &&\n                                  user_id &&\n                                  !isEditMode &&\n                                  !isDraftLoaded &&\n                                  !formData.objednatel_id &&\n                                  !formData.jmeno &&\n                                  !formData.email;\n\n    // Kontrola: M formul njak obsah (uivatel zaal vyplovat)?\n    const hasUserInput = (formData.predmet && String(formData.predmet).trim()) ||\n                        formData.garant_uzivatel_id ||\n                        formData.prikazce_id ||\n                        (formData.strediska_kod && Array.isArray(formData.strediska_kod) && formData.strediska_kod.length > 0) ||\n                        (formData.max_cena_s_dph && parseFloat(formData.max_cena_s_dph) > 0) ||\n                        (formData.popis_pozadavku && String(formData.popis_pozadavku).trim());\n\n    if (shouldFillOrdererData && hasUserInput) {\n\n      const jmeno = `${userDetail.titul_pred ? userDetail.titul_pred + ' ' : ''}${userDetail.jmeno || ''} ${userDetail.prijmeni || ''}${userDetail.titul_za ? ', ' + userDetail.titul_za : ''}`.replace(/\\s+/g, ' ').trim();\n\n      setFormData(prev => ({\n        ...prev,\n        objednatel_id: user_id,\n        jmeno: jmeno || 'Neuvedeno',\n        email: userDetail.email || '',\n        telefon: userDetail.telefon || ''\n      }));\n    }\n  }, [userDetail, user_id, isEditMode, isDraftLoaded, formData.objednatel_id, formData.jmeno, formData.email,\n      formData.predmet, formData.garant_uzivatel_id, formData.prikazce_id, formData.strediska_kod,\n      formData.max_cena_s_dph, formData.popis_pozadavku]);\n\n  //  Automatick detekce: M bt zveejnna (cena > 50 000 K bez DPH)\n  useEffect(() => {\n    // Pouze pokud mme poloky objednvky\n    if (!formData.polozky_objednavky || formData.polozky_objednavky.length === 0) {\n      return;\n    }\n\n    // Vypotat celkovou cenu BEZ DPH ze vech poloek\n    const celkovaCenaBezDPH = formData.polozky_objednavky.reduce((sum, polozka) => {\n      //  FIX: Odstranit formtovn ped parseFloat\n      const cena = parseFloat((polozka.cena_bez_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\n      const mnozstvi = parseFloat(polozka.mnozstvi || 0);\n      return sum + (cena * mnozstvi);\n    }, 0);\n\n    // Pokud je cena > 50 000 K bez DPH a checkbox nen jet zakrtnut\n    if (celkovaCenaBezDPH > 50000 && !formData.ma_byt_zverejnena) {\n      setFormData(prev => ({\n        ...prev,\n        ma_byt_zverejnena: true\n      }));\n    }\n  }, [formData.polozky_objednavky, formData.ma_byt_zverejnena]);\n\n  // Fix: Zajitn sprvnho zobrazen LP kd po naten options\n  // Kdy se natou lpKodyOptions a formData.lp_kod u obsahuje ID,\n  // komponenta se mus pekreslit, aby zobrazila nzvy msto ID\n  useEffect(() => {\n    // Kontrola: Mme naten LP kdy options a formData obsahuje lp_kod pole?\n    if (lpKodyOptions.length > 0 &&\n        Array.isArray(formData.lp_kod) &&\n        formData.lp_kod.length > 0) {\n\n      // Zkontroluj, jestli vechna ID v lp_kod existuj v lpKodyOptions\n      const allFound = formData.lp_kod.every(id =>\n        lpKodyOptions.some(opt => (opt.id || opt.kod) === id)\n      );\n\n      if (allFound) {\n        // Vechny LP kdy jsou v options - nen poteba nic dlat\n        // Ale meme vynutit re-render nastavenm dummy state\n        // (toto pome kdy se options naetly a po formData)\n        // Nen poteba - React automaticky pekresl kdy se zmn lpKodyOptions\n      } else {\n        // Nkter ID nejsou v options - mon se jet nenaetly\n        // Pokme na dal render cyklus\n      }\n    }\n  }, [lpKodyOptions, formData.lp_kod]);\n\n  //  Automatick natn detail LP pi vbru\n  useEffect(() => {\n    if (!Array.isArray(formData.lp_kod) || formData.lp_kod.length === 0) {\n      return; // dn LP vybrny\n    }\n\n    // Nast detaily pro kad vybran LP (pokud jet nejsou naten)\n    formData.lp_kod.forEach(lp_id => {\n      if (!lpDetails[lp_id] && !loadingLpDetails[lp_id]) {\n        loadLPDetail(lp_id);\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [formData.lp_kod]);\n\n  //  Naten seznamu smluv pi mount (pro autocomplete)\n  useEffect(() => {\n    if (token && username && smlouvyList.length === 0 && !loadingSmlouvyList) {\n      loadSmlouvyList();\n    }\n  }, [token, username, smlouvyList.length, loadingSmlouvyList, loadSmlouvyList]);\n\n  //  Automatick generovn individualni_schvaleni z ev_cislo (O-  I-)\n  useEffect(() => {\n    // Pouze pro Individuln schvlen\n    const selectedSource = financovaniOptions.find(opt => opt.kod === formData.zpusob_financovani);\n    const nazev = selectedSource?.nazev || '';\n    const isIndividualni = nazev.includes('Individuln') && !nazev.includes('Pojistn');\n    \n    if (!isIndividualni) {\n      return; // Nejedn se o Individuln schvlen\n    }\n\n    // Zskat ev_cislo - me bt string nebo object\n    let evCislo = '';\n    if (typeof formData.ev_cislo === 'string') {\n      evCislo = formData.ev_cislo;\n    } else if (typeof formData.ev_cislo === 'object' && formData.ev_cislo) {\n      evCislo = formData.ev_cislo.order_number_string || \n                formData.ev_cislo.next_order_string || \n                formData.ev_cislo.next_number || '';\n    }\n\n    if (!evCislo || !evCislo.startsWith('O-')) {\n      return; // Nemme validn ev_cislo zanajc O-\n    }\n\n    // Nahradit O- za I-\n    const iCislo = evCislo.replace(/^O-/, 'I-');\n    \n    // Aktualizovat pouze pokud se li\n    if (formData.individualni_schvaleni !== iCislo) {\n      setFormData(prev => ({\n        ...prev,\n        individualni_schvaleni: iCislo\n      }));\n    }\n  }, [formData.ev_cislo, formData.zpusob_financovani, financovaniOptions, formData.individualni_schvaleni]);\n\n  //  Automatick vymazn LP kd pi zmn pkazce\n  useEffect(() => {\n    // Pouze pokud jsou vybran njak LP kdy\n    if (!formData.lp_kod || !Array.isArray(formData.lp_kod) || formData.lp_kod.length === 0) {\n      return;\n    }\n\n    // Zkontrolovat, zda vybran LP kdy odpovdaj novmu filtru\n    const selectedLpIds = formData.lp_kod;\n    const validLpIds = filteredLpKodyOptions.map(lp => lp.id || lp.kod);\n\n    // Pokud njak vybran LP ji nen ve filtru, vymazat vechny LP kdy\n    const hasInvalidLp = selectedLpIds.some(lpId => !validLpIds.includes(lpId));\n\n    if (hasInvalidLp) {\n      console.log(' Mazn LP kd po zmn pkazce:', {\n        puvodniLP: selectedLpIds,\n        platneLP: validLpIds\n      });\n\n      setFormData(prev => ({\n        ...prev,\n        lp_kod: []\n      }));\n\n      showToast('LP kdy byly vymazny - pkazce m jin sek', 'info');\n    }\n  }, [formData.prikazce_id, filteredLpKodyOptions]); // Spust se pi zmn pkazce nebo filtrovanch LP\n\n  //  Automatick naten detailu smlouvy pi zmn sla smlouvy\n  useEffect(() => {\n    if (formData.cislo_smlouvy && formData.cislo_smlouvy.trim()) {\n      loadSmlouvaDetail(formData.cislo_smlouvy.trim());\n    } else {\n      setSmlouvaDetail(null);\n    }\n  }, [formData.cislo_smlouvy, loadSmlouvaDetail]);\n\n  //  AUTOFILL DODAVATELE po schvlen ADMINem\n  // Kdy se objev stav SCHVALENA + financovn SMLOUVA + dodavatel przdn, spustit autofill\n  useEffect(() => {\n    const shouldAutoFill = async () => {\n      // Kontrola podmnek\n      const hasSchvalena = hasWorkflowState(formData.stav_workflow_kod, 'SCHVALENA');\n      const isSmlouva = formData.zpusob_financovani?.toUpperCase() === 'SMLOUVA';\n      const hasCisloSmlouvy = !!formData.cislo_smlouvy?.trim();\n      const nemaDodavatele = !formData.dodavatel_nazev?.trim() && !formData.dodavatel_ico?.trim();\n      \n      if (hasSchvalena && isSmlouva && hasCisloSmlouvy && nemaDodavatele && smlouvaDetail && !smlouvaDetail.notFound) {\n        try {\n          const supplierData = await autoFillSupplierFromContract(formData, currentPhase);\n          \n          if (supplierData) {\n            setFormData(prev => ({\n              ...prev,\n              ...supplierData\n            }));\n            setSupplierAutoFillSource(supplierData.source);\n            setIsChanged(true);\n          }\n        } catch (error) {\n        }\n      }\n    };\n    \n    shouldAutoFill();\n  }, [formData.stav_workflow_kod, formData.zpusob_financovani, formData.cislo_smlouvy, formData.dodavatel_nazev, formData.dodavatel_ico, smlouvaDetail, autoFillSupplierFromContract, currentPhase, hasWorkflowState]);\n\n  // Auto-save konceptu pi zmnch formData (s debounce 2000ms)\n  useEffect(() => {\n    // Neukldej przdn formul - spust se pokud je vyplnn pedmt NEBO garant NEBO jakkoli relevantn pole\n    const hasRelevantData = (\n      formData.predmet ||\n      formData.garant_uzivatel_id ||\n      formData.popis_pozadavku ||\n      formData.max_cena_s_dph ||\n      formData.poznamky ||\n      formData.dodavatel_nazev ||\n      (formData.strediska_kod && formData.strediska_kod.length > 0) ||\n      (formData.polozky_objednavky && formData.polozky_objednavky.some(p => p.popis))\n    );\n\n    //  Kontrola zda je strnka viditeln (uivatel je aktivn na tto zloce)\n    const isPageVisible = !document.hidden;\n\n    //  ZABLOKUJ autosave pokud:\n    // - probh ukldn do DB\n    // - je viditeln progress bar\n    // - byl spn uloen do DB (disableAutosave flag/ref)\n    // - DraftManager m autosave zakzn (centrln kontrola)\n    // - Strnka nen viditeln (uivatel je na jin zloce/aplikaci)\n    // - KRITICK: Draft jet nebyl naten pi mount (prevence pepsn existujcho draftu)\n    if (!user_id || !hasRelevantData || isSaving || showSaveProgress || disableAutosave || disableAutosaveRef.current || !draftManager.isAutosaveEnabled() || !isPageVisible || !isDraftLoaded) {\n      return; // Tich return - dn debug log pi bnm psan\n    }\n\n    // DEBOUNCED autosave - ulo se a 3000ms po posledn zmn\n    // (nastaveno na 3s + autosave pi oputn pole)\n    // Timer se ru a nastavuje nov pi kad zmn formData\n    const debounceTimer = setTimeout(() => {\n      saveDraft(true); // auto-save = true\n    }, 3000);\n\n    // Cleanup - vyisti timer pi dal zmn nebo unmount\n    return () => clearTimeout(debounceTimer);\n  }, [formData, user_id, isSaving, showSaveProgress, disableAutosave, isDraftLoaded]);\n\n  //  Page Visibility listener - pozastav autosave kdy uivatel pepne zloku\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      if (document.hidden) {\n      } else {\n        // NEDLME okamit autosave - nech ho spust hlavn useEffect s debouncem\n      }\n    };\n\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    return () => document.removeEventListener('visibilitychange', handleVisibilityChange);\n  }, [formData, user_id]);\n  // Ochrana ped oputnm strnky s neuloenmi plohami\n  useEffect(() => {\n    const handleBeforeUnload = (e) => {\n      //  Ulo scroll pozici ped oputnm strnky (pomoc ref)\n      try {\n        const scrollContainer = scrollableContentRef.current;\n        const scrollPosition = scrollContainer ? scrollContainer.scrollTop : (window.pageYOffset || document.documentElement.scrollTop);\n        draftManager.saveMetadata({ scrollPosition });\n      } catch (error) {\n      }\n\n      //  EMERGENCY SAVE VYPNUT - zpsoboval problmy s pepsnm dat\n      // Spolhme se na rychl autosave (500ms debounce)\n      // Emergency save nelze spolehliv implementovat kvli:\n      // 1) ifrovan data nelze synchronn deifrovat\n      // 2) formData state me bt star (React batching)\n      // 3) beforeunload event je synchronn a neme ekat na async operace\n      // Zjisti, jestli mme njak neuloen plohy\n      const unsavedAttachments = attachments.filter(att =>\n        !att.serverId && // Nem server ID = nen nahrno na server\n        att.status !== 'uploaded' && // Nen oznaeno jako nahran\n        !att.fromServer && // Nen ze serveru\n        att.file // M skuten soubor\n      );\n\n      const unclassifiedAttachments = attachments.filter(att =>\n        !att.klasifikace || att.klasifikace.trim() === '' // Nen klasifikovno\n      );\n\n      if (unsavedAttachments.length > 0 || unclassifiedAttachments.length > 0) {\n        const message = `Mte ${unsavedAttachments.length} neuloench a ${unclassifiedAttachments.length} neklasifikovanch ploh. Opravdu chcete opustit strnku? Neuloen plohy budou ztraceny.`;\n        e.preventDefault();\n        e.returnValue = message; // For Chrome\n        return message; // For other browsers\n      }\n    };\n\n    const handlePopState = () => {\n      // Stejn kontrola pro browser back/forward\n      const unsavedAttachments = attachments.filter(att =>\n        !att.serverId && att.status !== 'uploaded' && !att.fromServer && att.file\n      );\n      const unclassifiedAttachments = attachments.filter(att =>\n        !att.klasifikace || att.klasifikace.trim() === ''\n      );\n\n      if (unsavedAttachments.length > 0 || unclassifiedAttachments.length > 0) {\n        showToast && showToast(\n          `Mte ${unsavedAttachments.length} neuloench a ${unclassifiedAttachments.length} neklasifikovanch ploh.\\n\\nOpravdu chcete opustit strnku? Neuloen plohy budou ztraceny.`, {\n          type: 'warning',\n          timeout: 0,\n          action: {\n            confirmText: 'ANO, OPUSTIT',\n            cancelText: 'Zstat',\n            onConfirm: () => {\n              // Pokrauj s oputnm strnky - nemusme nic dlat, prohle se postar\n            },\n            onCancel: () => {\n              //  FIX: Zachovat query parametry (nap. ?edit=123)\n              const fullUrl = window.location.pathname + window.location.search;\n              window.history.pushState(null, '', fullUrl);\n            }\n          }\n        });\n      }\n    };\n\n    // Pidej event listenery\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    window.addEventListener('popstate', handlePopState);\n\n    // Cleanup\n    return () => {\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n      window.removeEventListener('popstate', handlePopState);\n    };\n  }, [attachments, formData, user_id, isOrderSavedToDB, formData.id]); // Aktuln data pro emergency save\n\n  // Funkce pro vyitn validan chyby pi ztrt fokusu\n  const handleFieldBlur = useCallback((fieldName, value) => {\n    // Validace probh POUZE pi Save\n    //     return rest;\n    //   });\n    // }\n\n    //  AUTO-SAVE pi oputn pole (onBlur) - NOV CENTRALIZOVAN SYSTM\n    // Pouit triggerAutosave s debounce 3 sekundy\n    const canAutosave = !disableAutosaveRef.current && draftManager.isAutosaveEnabled() && !isSaving && !showSaveProgress && isDraftLoaded;\n\n    if (canAutosave) {\n      triggerAutosave(false); // false = s debouncem 3s\n    } else {\n    }\n  }, [validationErrors, isSaving, showSaveProgress, isDraftLoaded, triggerAutosave]);\n\n  // UseEffect pro inicializaci ablon\n  useEffect(() => {\n    // Nast ablony z localStorage pi mount\n    try {\n      const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n      const stored = localStorage.getItem(key);\n      if (stored) {\n        const templates = JSON.parse(stored);\n        if (Array.isArray(templates)) {\n          setSavedTemplates(templates);\n        }\n      }\n    } catch (error) {\n    }\n\n    // Automaticky nast ablony z DB pi mount (po F5 refresh)\n    if (token && username && user_id) {\n\n      fetchAndMergeTemplates();\n    }\n  }, [user_id, token, username]);\n\n  const toggleSection = (sectionKey) => {\n    setSectionStates(prev => {\n      const newStates = {\n        ...prev,\n        [sectionKey]: !prev[sectionKey]\n      };\n      // Uloit stav sekc\n      saveSectionStates(newStates);\n\n      // AUTOMATICK NATEN PLOH pi rozbalen sekce ploh\n      if (sectionKey === 'prilohy' && prev[sectionKey] && !newStates[sectionKey]) {\n        // Sekce byla sbalen (true) a te se rozbaluje (false)\n\n        // Podmnka pro automatick naten pi rozbalen\n        // POUZE od FZE 3+ (SCHVALENA) - FZE 1 a 2 plohy nee\n        if (formData.id && token && username && !isNewOrder && currentPhase >= 3) {\n          setTimeout(() => {\n            loadAttachmentsSmartly();\n          }, 100); // Krtk zpodn pro sprvn vykreslen UI\n        }\n      }\n\n      return newStates;\n    });\n  };\n\n  // Funkce pro formtovn mny\n  const formatCurrency = (value) => {\n    if (!value) return '';\n\n    // Pevst na slo\n    const numValue = parseFloat(value);\n    if (isNaN(numValue)) return '';\n\n    // Formtovn s mezerami jako oddlovae tisc\n    const formatted = numValue.toLocaleString('cs-CZ', {\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 2,\n    }).replace(/\\s/g, ' '); // Zajistit sprvn mezery\n\n    return formatted + ' K';\n  };\n\n  // Parser pro pevod z formtovan mny zpt na slo\n  const parseCurrency = (formattedValue) => {\n    if (!formattedValue) return '';\n\n    // Odstranit \"K\" a vechny mezery\n    let cleanValue = formattedValue\n      .replace(/\\s/g, '') // Odstranit vechny mezery\n      .replace(/K/g, ''); // Odstranit \"K\"\n\n    // Pokud obsahuje rku jako desetinn oddlova (esk formtovn)\n    if (cleanValue.includes(',')) {\n      cleanValue = cleanValue.replace(',', '.');\n    }\n\n    const numValue = parseFloat(cleanValue);\n    return isNaN(numValue) ? '' : numValue.toString();\n  };\n\n  // Speciln handler pro mnov inputy s debouncing pro zachovn pozice kurzoru\n  const handleCurrencyChange = (field, formattedValue) => {\n    // Pevst formtovanou hodnotu zpt na slo\n    const numericValue = parseCurrency(formattedValue);\n\n    // Uloit selnou hodnotu do formData\n    // POZOR: Toto zpsobuje re-render a resetuje pozici kurzoru!\n    setFormData(prev => ({\n      ...prev,\n      [field]: numericValue\n    }));\n\n    // Nastavit flag, e dolo ke zmn\n    setIsChanged(true);\n  };\n\n  // Detekce duplicitnch nzv soubor - MUS BT PED handleFileUpload\n  const checkDuplicateFileName = (newFileName) => {\n    const existingFiles = attachments.filter(file =>\n      file.name.toLowerCase() === newFileName.toLowerCase()\n    );\n    return existingFiles.length > 0 ? existingFiles[0] : null;\n  };\n\n  // Funkce pro prci s plohami - Orders25 API\n  const handleFileUpload = (files) => {\n    //  CENTRLN ZAMYKN: Blokovat upload pokud je objednvka dokonena/zamtnuta/zruena\n    if (isWorkflowCompleted && !canUnlockAnything) {\n      showToast && showToast('Nelze nahrt plohy - objednvka je dokonena/zamtnuta/zruena', { type: 'warning' });\n      return;\n    }\n\n    if (!files || files.length === 0) {\n      return;\n    }\n\n    setUploadingFiles(true);\n\n    // Pidme soubory do loklnho stavu pro klasifikaci\n    const newFiles = Array.from(files).map((file, index) => {\n      // Validace souboru\n      if (!isAllowedFileType(file.name)) {\n        showToast(`Soubor ${file.name}: Nepodporovan typ souboru`, 'error');\n        return null;\n      }\n\n      if (!isAllowedFileSize(file.size, 20)) {\n        showToast(`Soubor ${file.name}: Pli velk (max 20MB)`, 'error');\n        return null;\n      }\n\n      // Kontrola duplicitnho nzvu\n      const duplicate = checkDuplicateFileName(file.name);\n      if (duplicate) {\n      }\n\n      // Pouij Orders25 metadata genertor\n      const metadata = createAttachmentMetadata(file);\n\n      return {\n        id: metadata.id,\n        guid: metadata.guid,\n        name: file.name,\n        originalName: metadata.originalName,\n        generatedName: metadata.generatedName,\n        systemovy_nazev: metadata.systemovy_nazev,\n        size: file.size,\n        type: file.type,\n        klasifikace: '', // Bude se vybrat uivatelem - po vbru se nahraje na server\n        uploadDate: metadata.createdAt,\n        status: 'pending_classification', // ek na klasifikaci\n        file: file, // Pro budouc upload po klasifikaci\n        uploadError: null,\n        serverId: null,\n        serverGuid: null,\n        isDuplicate: !!duplicate, // Flag pro duplicitn soubor\n        duplicateOf: duplicate?.id || null // ID pvodnho souboru\n      };\n    }).filter(Boolean); // Odfiltruj nevalidn soubory\n\n    // Aktualizuj oba state - formData i attachments\n    setFormData(prev => ({\n      ...prev,\n      prilohy_dokumenty: [...(prev.prilohy_dokumenty || []), ...newFiles]\n    }));\n\n    setAttachments(prev => [...prev, ...newFiles]);\n\n    setUploadingFiles(false);\n\n    // TOAST ODSTRANN - zobraz se a pi skutenm nahrn na server po klasifikaci\n    // const duplicateCount = newFiles.filter(f => f.isDuplicate).length;\n    // if (duplicateCount > 0) {\n    //   showToast(`Pidno ${newFiles.length} soubor ke klasifikaci\\n ${duplicateCount} soubor() m stejn nzev jako existujc ploha - po nastaven klasifikace bude nahrazen!`, 'warning');\n    // } else {\n    //   showToast(`Pidno ${newFiles.length} soubor ke klasifikaci`, 'success');\n    // }\n  };\n\n  //  Funkce pro nahrn dodatench doklad (automatick klasifikace jako \"JINE\")\n  const handleDodatecneDokladyUpload = async (files) => {\n    if (!files || files.length === 0) {\n      return;\n    }\n\n    setUploadingFiles(true);\n\n    // Pidme soubory s automatickou klasifikac \"JINE\"\n    const newFiles = Array.from(files).map((file, index) => {\n      // Validace souboru\n      if (!isAllowedFileType(file.name)) {\n        showToast(`Soubor ${file.name}: Nepodporovan typ souboru`, { type: 'error' });\n        return null;\n      }\n\n      if (!isAllowedFileSize(file.size, 20)) {\n        showToast(`Soubor ${file.name}: Pli velk (max 20MB)`, { type: 'error' });\n        return null;\n      }\n\n      // Kontrola duplicitnho nzvu\n      const duplicate = checkDuplicateFileName(file.name);\n\n      // Pouij Orders25 metadata genertor\n      const metadata = createAttachmentMetadata(file);\n\n      const newFile = {\n        id: metadata.id,\n        guid: metadata.guid,\n        name: file.name,\n        originalName: metadata.originalName,\n        generatedName: metadata.generatedName,\n        systemovy_nazev: metadata.systemovy_nazev,\n        size: file.size,\n        type: file.type,\n        klasifikace: 'JINE', //  Automatick klasifikace jako \"JINE\"\n        file_prefix: 'dd-', //  Prefix pro dodaten dokumenty\n        uploadDate: metadata.createdAt,\n        status: 'pending_upload', //  Ready k uploadu (m ji klasifikaci)\n        file: file,\n        uploadError: null,\n        serverId: null,\n        serverGuid: null,\n        isDuplicate: !!duplicate,\n        duplicateOf: duplicate?.id || null\n      };\n\n      return newFile;\n    }).filter(Boolean);\n\n    if (newFiles.length === 0) {\n      setUploadingFiles(false);\n      return;\n    }\n\n    // Aktualizuj oba state\n    setFormData(prev => ({\n      ...prev,\n      prilohy_dokumenty: [...(prev.prilohy_dokumenty || []), ...newFiles]\n    }));\n\n    setAttachments(prev => [...prev, ...newFiles]);\n\n    //  Automaticky nahraj vechny soubory na server s prefixem \"dd-\"\n    for (const file of newFiles) {\n      await uploadFileToServer25(file.id, 'JINE', 'dd-');\n    }\n\n    setUploadingFiles(false);\n  };\n\n  //  Pomocn funkce pro Dropzone dodatench doklad\n  const handleDodatecneDokladyDrop = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragOver(false);\n\n    // Zkus zskat soubory z items (modern zpsob)\n    let files = null;\n\n    if (e.dataTransfer.items && e.dataTransfer.items.length > 0) {\n      files = Array.from(e.dataTransfer.items)\n        .filter(item => item.kind === 'file')\n        .map(item => item.getAsFile())\n        .filter(Boolean);\n    } else if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {\n      files = e.dataTransfer.files;\n    }\n\n    if (files && files.length > 0) {\n      handleDodatecneDokladyUpload(files);\n    }\n  };\n\n  const handleDodatecneDokladySelect = (e) => {\n    const files = e.target.files;\n\n    if (files && files.length > 0) {\n      handleDodatecneDokladyUpload(files);\n    }\n    e.target.value = '';\n  };\n\n  const handleFileDrop = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragOver(false);\n\n    const files = e.dataTransfer.files;\n\n    if (files && files.length > 0) {\n      handleFileUpload(files);\n    }\n  };\n\n  const handleFileSelect = (e) => {\n    const files = e.target.files;\n    if (files.length > 0) {\n      handleFileUpload(files);\n    }\n    // Reset input pro optovn nahrn stejnho souboru\n    e.target.value = '';\n  };\n\n  const updateFileKlasifikace = async (fileId, klasifikace) => {\n    const file = attachments.find(f => f.id === fileId);\n    if (!file) {\n      return;\n    }\n\n    // Aktualizuj oba state - formData i attachments\n    setFormData(prev => ({\n      ...prev,\n      prilohy_dokumenty: (prev.prilohy_dokumenty || []).map(file =>\n        file.id === fileId ? { ...file, klasifikace } : file\n      )\n    }));\n\n    setAttachments(prev => prev.map(file =>\n      file.id === fileId ? { ...file, klasifikace } : file\n    ));\n\n    //  AUTOSAVE po zmn klasifikace (select) - okamit\n    if (!disableAutosaveRef.current && draftManager.isAutosaveEnabled() && !isSaving && !showSaveProgress && isDraftLoaded) {\n      triggerAutosave(true); // immediate\n    }\n\n    // ROZHODOVN: Lokln soubor vs. ji nahran na serveru\n    if (file.serverId && file.status === 'uploaded') {\n      //  SOUBOR JE JI NA SERVERU - Aktualizuj klasifikaci v DB\n\n      if (!klasifikace || klasifikace.trim() === '') {\n        showToast(' Nelze uloit przdnou klasifikaci pro nahran soubory', 'warning');\n        return;\n      }\n\n      try {\n        const result = await updateAttachmentV2({\n          token,\n          username,\n          objednavka_id: formData.id, //  OPRAVENO: pidn objednavka_id\n          attachment_id: file.serverId,\n          typ_prilohy: klasifikace\n        });\n\n        if (result.status === 'ok' || result.status === 'success') { //  OPRAVENO: backend me vracet 'success'\n\n          //  Aktualizuj lokln stav s daty z backendu\n          if (result.data) {\n            const updatedData = {\n              typ_prilohy: result.data.type || klasifikace,\n              dt_aktualizace: result.data.updated_at,\n              klasifikace: result.data.type || klasifikace\n            };\n\n            setFormData(prev => ({\n              ...prev,\n              prilohy_dokumenty: (prev.prilohy_dokumenty || []).map(f =>\n                f.id === fileId ? { ...f, ...updatedData } : f\n              )\n            }));\n\n            setAttachments(prev => prev.map(f =>\n              f.id === fileId ? { ...f, ...updatedData } : f\n            ));\n          }\n\n          // Zkontroluj existence souboru po aktualizaci (pomoc sync kontroly)\n          await checkAttachmentsSynchronization25(true); // silentMode = true\n\n          showToast(' Klasifikace aktualizovna v databzi + kontrola existence OK', 'success');\n          // Success log odstrann\n\n          addDebugLog('success', 'ATTACHMENTS', 'update-classification-db',\n            `Klasifikace zmnna v DB: ${file.name}  ${klasifikace}`\n          );\n        }\n      } catch (error) {\n\n        const errorMsg = translateErrorMessageShort(error.message);\n\n        showToast(` Chyba pi aktualizaci klasifikace: ${errorMsg}`, 'error');\n\n        addDebugLog('error', 'ATTACHMENTS', 'update-classification-db-failed',\n          `Chyba aktualizace klasifikace v DB: ${errorMsg}`\n        );\n\n        // Vra zpt pvodn klasifikaci pi chyb\n        setFormData(prev => ({\n          ...prev,\n          prilohy_dokumenty: (prev.prilohy_dokumenty || []).map(f =>\n            f.id === fileId ? { ...f, klasifikace: file.klasifikace } : f\n          )\n        }));\n\n        setAttachments(prev => prev.map(f =>\n          f.id === fileId ? { ...f, klasifikace: file.klasifikace } : f\n        ));\n      }\n    } else {\n      //  LOKLN SOUBOR - Standardn chovn pro nahrn na server\n\n      // Pokud je klasifikace nastavena a objednvka je uloen, nahraj soubor na server\n      if (klasifikace && klasifikace.trim() !== '' && formData.id && token && username) {\n        //  Pouij pvodn file_prefix souboru msto hardcoded 'obj-'\n        const filePrefix = file.file_prefix || 'obj-';\n        await uploadFileToServer25(fileId, klasifikace, filePrefix);\n      }\n    }\n  };\n\n  // Upload souboru na server Orders25 po klasifikaci\n  const uploadFileToServer25 = async (fileId, klasifikace, filePrefix = 'obj-') => {\n    const file = formData.prilohy_dokumenty?.find(f => f.id === fileId);\n    if (!file || !file.file || file.status === 'uploaded') {\n      return;\n    }\n\n    try {\n      // Ozna jako nahrvajc se v obou state\n      setFormData(prev => ({\n        ...prev,\n        prilohy_dokumenty: prev.prilohy_dokumenty.map(f =>\n          f.id === fileId\n            ? { ...f, status: 'uploading', uploadError: null, file_prefix: filePrefix }\n            : f\n        )\n      }));\n\n      setAttachments(prev => prev.map(f =>\n        f.id === fileId\n          ? { ...f, status: 'uploading', uploadError: null, file_prefix: filePrefix }\n          : f\n      ));\n\n      addDebugLog('info', 'ATTACHMENTS', 'upload-start',\n        `Nahrvm soubor ${file.name} s klasifikac ${klasifikace} a prefixem ${filePrefix} na server V2 API...`);\n\n      // KONTROLA: pokud nen formData.id, zastav upload a zobraz chybu\n      if (!formData.id) {\n        showToast(' Nelze nahrt plohu - objednvka nem ID! Nejprve ulo objednvku.', 'error');\n        throw new Error('Missing formData.id - order must be saved first');\n      }\n\n      const result = await uploadOrderAttachment(\n        formData.id,      // orderId\n        file.file,         // file\n        username,          // username\n        token,             // token\n        klasifikace,       // typ_prilohy\n        filePrefix         // file_prefix\n      );\n\n      addDebugLog('success', 'ATTACHMENTS', 'upload-success',\n        `Soubor ${file.name} nahrn spn`, result);\n\n      // V2 API vrac: result.data.attachment_id nebo result.data.id\n      const attachmentId = result.data?.attachment_id || result.data?.id;\n\n      // Aktualizuj stav s vsledky ze serveru v obou state\n      setFormData(prev => ({\n        ...prev,\n        prilohy_dokumenty: prev.prilohy_dokumenty.map(f =>\n          f.id === fileId\n            ? {\n                ...f,\n                status: 'uploaded',\n                serverId: attachmentId,\n                serverGuid: result.data?.guid || file.systemovy_nazev,\n                uploadError: null,\n                file: null // Uvolnit pam - soubor je u na serveru\n              }\n            : f\n        )\n      }));\n\n      setAttachments(prev => prev.map(f =>\n        f.id === fileId\n          ? {\n              ...f,\n              status: 'uploaded',\n              serverId: attachmentId,\n              serverGuid: result.data?.guid || file.systemovy_nazev,\n              uploadError: null,\n              file: null // Uvolnit pam - soubor je u na serveru\n            }\n          : f\n      ));\n\n      // Toast pi spnm nahrn na server\n      showToast(` Ploha \"${file.name}\" byla spn nahrna na server`, 'success');\n\n    } catch (error) {\n      addDebugLog('error', 'ATTACHMENTS', 'upload-error',\n        `Chyba pi uploadu ${file.name}: ${error.message}`);\n\n      // Ozna chybu v loklnm stavu v obou state\n      setFormData(prev => ({\n        ...prev,\n        prilohy_dokumenty: prev.prilohy_dokumenty.map(f =>\n          f.id === fileId\n            ? {\n                ...f,\n                status: 'error',\n                uploadError: error.message\n              }\n            : f\n        )\n      }));\n\n      setAttachments(prev => prev.map(f =>\n        f.id === fileId\n          ? {\n              ...f,\n              status: 'error',\n              uploadError: error.message\n            }\n          : f\n      ));\n\n      // Toast s chybou pi uploadu\n      const errorMsg = error.response?.data?.message || error.message || 'Neznm chyba';\n      showToast(` Chyba pi nahrvn plohy \"${file.name}\": ${errorMsg}`, 'error');\n    }\n  };\n\n  // Kontrola synchronizace ploh s DB a diskem\n  const checkAttachmentsSynchronization25 = async (silentMode = false) => {\n    if (!formData.id) {\n      showToast('Nen ID objednvky pro kontrolu synchronizace', 'warning');\n      return;\n    }\n\n    try {\n      setIsCheckingSyncAttachments(true);\n\n      // 1. NATI PLOHY VEDEN V DB\n\n      const serverResult = await listOrderAttachments(\n        formData.id,      // orderId\n        username,          // username\n        token              // token\n      );\n\n      // V2 API vrac: result.data.attachments nebo result.data (array)\n      const dbAttachments = serverResult?.data?.attachments || serverResult?.data || [];\n\n      // 2. OV EXISTENCI SOUBOR NA VZDLENM SERVERU\n\n      let verifyResult = null;\n      if (dbAttachments.length > 0) {\n        try {\n          verifyResult = await verifyOrderAttachments(\n            formData.id,  // orderId\n            username,      // username\n            token          // token\n          );\n\n        } catch (verifyError) {\n        }\n      }\n\n      // 3. ZKONTROLUJ LOKLN KONCEPT PROTI DB\n\n      const issues = {\n        hasIssues: false,\n        // Kategorie problm\n        conceptUnclassified: [],     // Lokln plohy bez klasifikace (po F5)\n        conceptOrphaned: [],         // Lokln plohy kter nejsou v DB\n        dbMissingFiles: [],          // DB zznamy bez soubor na disku\n        dbOrphaned: [],              // DB zznamy kter nejsou v konceptu\n        uploadErrors: [],            // Plohy s chybami nahrvn\n        inconsistentState: []        // Nekonzistentn stavy\n      };\n\n      // ANALZA LOKLNHO KONCEPTU\n      attachments.forEach((localAtt, index) => {\n        try {\n          // A) Neklasifikovan lokln plohy (dleit po F5)\n          if (!localAtt.klasifikace || localAtt.klasifikace === '') {\n            issues.conceptUnclassified.push(localAtt);\n            issues.hasIssues = true;\n          }\n\n          // B) Chyby nahrvn\n          if (localAtt.status === 'error') {\n            issues.uploadErrors.push(localAtt);\n            issues.hasIssues = true;\n          }\n\n          // C) Lokln plohy kter nejsou v DB (osiel)\n          if (localAtt.serverId) {\n            const serverIdStr = String(localAtt.serverId); // Zajistit string pro .replace()\n            const foundInDB = dbAttachments.find(dbAtt =>\n              dbAtt.id.toString() === serverIdStr ||\n              dbAtt.id.toString() === serverIdStr.replace('server_', '')\n            );\n            if (!foundInDB) {\n              issues.conceptOrphaned.push(localAtt);\n              issues.hasIssues = true;\n            }\n          } else if (localAtt.status !== 'uploaded' && localAtt.status !== 'uploading') {\n            // Lokln soubor kter nebyl jet nahrn\n            issues.conceptOrphaned.push(localAtt);\n            issues.hasIssues = true;\n          }\n        } catch (attachmentError) {\n          // Pokrauj s dalmi plohami\n        }\n      });\n\n      // ANALZA DB ZZNAM\n      dbAttachments.forEach((dbAtt, index) => {\n        try {\n          // D) DB zznamy kter nejsou v konceptu (mon ztracen po F5)\n          const foundInConcept = attachments.find(localAtt => {\n            if (!localAtt.serverId) {\n              // Pokud lokln ploha nem serverId, pokus o shodu podle nzvu souboru\n              return localAtt.name === dbAtt.originalni_nazev_souboru && localAtt.status === 'uploaded';\n            }\n\n            const serverIdStr = String(localAtt.serverId); // Zajistit string pro .replace()\n            const dbIdStr = dbAtt.id.toString();\n            return (\n              serverIdStr === dbIdStr ||\n              serverIdStr === `server_${dbIdStr}` ||\n              serverIdStr.replace('server_', '') === dbIdStr ||\n              (localAtt.name === dbAtt.originalni_nazev_souboru && localAtt.status === 'uploaded')\n            );\n          });\n          if (!foundInConcept) {\n            issues.dbOrphaned.push(dbAtt);\n            issues.hasIssues = true;\n          }\n        } catch (dbAttError) {\n          // Pokrauj s dalmi zznamy\n        }\n      });\n\n      // E) SOUBORY CHYBJC NA DISKU nebo POKOZEN (z verify API)\n      // V2 API vrac: verifyResult.data.attachments s detaily o kadm souboru\n      const verifiedAttachments = verifyResult?.data?.attachments || [];\n      if (verifiedAttachments.length > 0) {\n        verifiedAttachments.forEach(att => {\n          // file_exists: false = soubor chyb na disku\n          if (att.file_exists === false) {\n            issues.dbMissingFiles.push({\n              name: att.original_name || 'neznm',\n              serverId: att.attachment_id || att.id,\n              path: att.system_path || att.guid,\n              systemName: att.guid,\n              status: att.status\n            });\n            issues.hasIssues = true;\n          }\n          // size_match: false = velikost nesouhlas (pokozen soubor)\n          else if (att.size_match === false) {\n            issues.inconsistentState.push({\n              name: att.original_name || 'neznm',\n              serverId: att.attachment_id || att.id,\n              issue: `SIZE MISMATCH: DB=${att.db_size}B, Disk=${att.actual_size}B`,\n              status: att.status\n            });\n            issues.hasIssues = true;\n          }\n        });\n      }\n\n      // ZOBRAZ VSLEDKY (pouze od FZE 3+ a pouze warningy/errory)\n      if (!issues.hasIssues) {\n        //  ODSTRANNO: Zbyten success toast \" Synchronizace OK\"\n        // Uivatel nepotebuje vdt e ve je OK - to je default stav\n      } else {\n        //  Zobrazit problmy POUZE od FZE 3+ (kdy se plohy e)\n        if (currentPhase >= 3 && !silentMode) {\n          let reportText = ' SYNC KONTROLA - Nalezen problmy:\\n';\n\n          if (issues.conceptUnclassified.length > 0) {\n            reportText += `\\n KONCEPT - NEKLASIFIKOVAN (${issues.conceptUnclassified.length}):\\n`;\n            issues.conceptUnclassified.forEach(att => {\n              reportText += `   ${att.name} - potebuje klasifikaci\\n`;\n            });\n          }\n\n        if (issues.conceptOrphaned.length > 0) {\n          reportText += `\\n KONCEPT - NENAHRAN/OSIEL (${issues.conceptOrphaned.length}):\\n`;\n          issues.conceptOrphaned.forEach(att => {\n            reportText += `   ${att.name} - ${att.serverId ? 'osiel' : 'nenahrna'}\\n`;\n          });\n        }\n\n        if (issues.dbOrphaned.length > 0) {\n          reportText += `\\n DB - CHYB V KONCEPTU (${issues.dbOrphaned.length}):\\n`;\n          issues.dbOrphaned.forEach(att => {\n            reportText += `   ${att.originalni_nazev_souboru} (ID: ${att.id}) - mon ztraceno po F5\\n`;\n          });\n        }\n\n        if (issues.dbMissingFiles.length > 0) {\n          reportText += `\\n SERVER - CHYB SOUBORY (${issues.dbMissingFiles.length}):\\n`;\n          issues.dbMissingFiles.forEach(att => {\n            reportText += `   ${att.name} (${att.path || att.systemName})\\n`;\n          });\n        }\n\n        if (issues.inconsistentState.length > 0) {\n          reportText += `\\n POKOZEN SOUBORY (${issues.inconsistentState.length}):\\n`;\n          issues.inconsistentState.forEach(att => {\n            reportText += `   ${att.name} - ${att.issue}\\n`;\n          });\n        }\n\n        if (issues.uploadErrors.length > 0) {\n          reportText += `\\n CHYBY NAHRVN (${issues.uploadErrors.length}):\\n`;\n          issues.uploadErrors.forEach(att => {\n            reportText += `   ${att.name}\\n`;\n          });\n        }\n\n        showToast(reportText, 'error');\n\n        // NABDKA AUTOMATICKCH OPRAV (pouze v interaktivnm mdu)\n        if (issues.dbOrphaned.length > 0) {\n          showToast && showToast(\n            `Nalezeno ${issues.dbOrphaned.length} plohy v databzi, kter chyb v konceptu (mon ztracen po obnoven strnky F5).\\n\\n` +\n            `Chcete je automaticky obnovit do konceptu?`, {\n            type: 'info',\n            timeout: 0,\n            action: {\n              confirmText: 'ANO, OBNOVIT',\n              cancelText: 'Ne',\n              onConfirm: async () => {\n                await restoreAttachmentsFromDB(issues.dbOrphaned);\n              }\n            }\n          });\n        }\n        } // Konec: currentPhase >= 3 && !silentMode\n      }\n\n      return issues;\n\n    } catch (error) {\n\n      showToast(\n        `Chyba kontroly synchronizace ploh:\\n${error.message}\\n\\n` +\n        `Zkuste:\\n` +\n        ` Obnovit strnku (F5)\\n` +\n        ` Zkontrolovat pipojen k serveru\\n` +\n        ` Zkontrolovat konzoli prohlee (F12)`,\n        'error'\n      );\n    } finally {\n      setIsCheckingSyncAttachments(false);\n    }\n  };\n\n  // Automatick obnoven ploh z DB do konceptu (po F5)\n  const restoreAttachmentsFromDB = async (dbAttachments) => {\n    try {\n      // Pokud nejsou pedan data, nati z API\n      if (!dbAttachments || !Array.isArray(dbAttachments)) {\n        if (!formData.id) {\n          showToast('Nen ID objednvky pro naten ploh z DB', 'warning');\n          return;\n        }\n\n        try {\n          const result = await listOrderAttachments(\n            formData.id,  // orderId\n            username,      // username\n            token          // token\n          );\n\n          const rawAttachments = result?.data?.attachments || result?.data || [];\n\n          if (!Array.isArray(rawAttachments)) {\n            showToast('Chyba API: neplatn struktura odpovdi pro plohy', 'error');\n            return;\n          }\n\n          dbAttachments = rawAttachments;\n        } catch (error) {\n          showToast('Chyba pi natn ploh z databze', 'error');\n          return;\n        }\n      }\n\n      const restoredAttachments = dbAttachments.map(attachment => ({\n        ...mapApiAttachmentToLocal(attachment),\n        isRestored: true // Flag pro rozpoznn obnovench\n      }));\n\n      // Pidej obnoven plohy k existujcm (bez duplicit)\n      setAttachments(prev => {\n        const existingIds = new Set(prev.map(att => att.serverId || att.id));\n        const newAttachments = restoredAttachments.filter(att =>\n          !existingIds.has(att.serverId) && !existingIds.has(att.id)\n        );\n\n        // Success log odstrann\n        return [...prev, ...newAttachments];\n      });\n\n      showToast(\n        ` Obnoveno ${restoredAttachments.length} ploh z databze do konceptu`,\n        'success'\n      );\n\n    } catch (error) {\n      showToast(`Chyba obnovovn: ${error.message}`, 'error');\n    }\n  };\n\n  // Smart naten: slou DB plohy + lokln neuloen z konceptu\n  // POZOR: Nat se pouze pokud je sekce ploh viditeln\n  // POZOR: Nat se POUZE od FZE 3+ (SCHVALENA) - FZE 1 a 2 plohy nee\n  const loadAttachmentsSmartly = async () => {\n    if (!formData.id || !token || !username) {\n      return;\n    }\n\n    if (sectionStates.prilohy) {\n      return;\n    }\n\n    //  Nast plohy z DB hned, jak m objednvka ID\n    try {\n\n      // 1. Zachovej lokln neuloen plohy z konceptu\n      const localUnsavedAttachments = attachments.filter(att =>\n        !att.serverId &&\n        att.status !== 'uploaded' &&\n        !att.fromServer\n      );\n\n      // 2. Nati plohy z DB\n      const rawAttachments = await fetchAttachmentsFromAPI();\n      const dbAttachments = rawAttachments.map(mapApiAttachmentToLocal);\n\n      // 3. Slouit: DB plohy + lokln neuloen\n      const mergedAttachments = [\n        ...dbAttachments,\n        ...localUnsavedAttachments\n      ];\n\n      // 4. Nastavit slouen plohy\n      setAttachments(mergedAttachments);\n\n      // 5. Automatick sync kontrola po naten\n      if (mergedAttachments.length > 0) {\n\n        setTimeout(() => {\n          checkAttachmentsSynchronization25(true); // Tich md pro auto-kontrolu\n        }, 1000); // Krtk zpodn aby se UI stihlo aktualizovat\n      }\n\n    } catch (error) {\n      showToast(`Chyba smart load: ${error.message}`, 'error');\n    }\n  };\n\n  // Naten existujcch ploh ze serveru (nahrazuje cel koncept)\n  // POZOR: Nat se pouze pokud je sekce ploh viditeln\n  // POZOR: Nat se POUZE od FZE 3+ (SCHVALENA) - FZE 1 a 2 plohy nee\n  const loadAttachmentsFromServer25 = async () => {\n    if (!formData.id || !token || !username) {\n      return;\n    }\n\n    if (sectionStates.prilohy) {\n      return;\n    }\n\n    //  FZE 1 a 2: Plohy se nee - zbyten zatovn\n    if (currentPhase < 3) {\n      return;\n    }\n\n    try {\n      addDebugLog('info', 'ATTACHMENTS', 'load-start',\n        `Natm plohy pro objednvku ${formData.id} ze serveru V2 API...`);\n\n      const result = await listOrderAttachments(\n        formData.id,  // orderId\n        username,      // username\n        token          // token\n      );\n\n      // V2 API vrac: result.data.attachments nebo result.data (array)\n      const rawAttachments = result?.data?.attachments || result?.data || [];\n\n      if (!Array.isArray(rawAttachments)) {\n        showToast('Chyba API: neplatn struktura odpovdi pro plohy', 'error');\n        return;\n      }\n\n      const serverAttachments = rawAttachments.map(mapApiAttachmentToLocal);\n      \n      addDebugLog('success', 'ATTACHMENTS', 'load-success',\n        `Nateno ${serverAttachments.length} ploh ze serveru`);\n\n      // Nahra lokln plohy tmi ze serveru\n      setAttachments(serverAttachments);\n\n      // Success log odstrann\n      // showToast(` Nateno ${serverAttachments.length} ploh z databze`, 'success'); // ODSTRANNO - info je vidt v bloku ploh\n\n    } catch (error) {\n\n      addDebugLog('error', 'ATTACHMENTS', 'load-error',\n        `Chyba pi natn ploh: ${error.message}`);\n\n      // Toast s chybou\n      showToast(`Chyba natn ploh z DB: ${error.message}`, 'error');\n    }\n  };\n\n  // Staen plohy ze serveru\n  const downloadAttachmentFromServer25 = async (attachment) => {\n    if (!attachment.serverId || !token || !username) {\n      showToast('Nelze sthnout plohu - chyb server ID', 'error');\n      return;\n    }\n\n    // Pro archivovan/importovan plohy - sthnout pmo ze star URL\n    if (attachment.typ_prilohy === 'IMPORT' && attachment.originalni_nazev_souboru) {\n      const oldAttachmentsUrl = process.env.REACT_APP_OLD_ATTACHMENTS_URL || 'https://erdms.zachranka.cz/prilohy/';\n      const oldUrl = `${oldAttachmentsUrl}${attachment.originalni_nazev_souboru}`;\n\n      addDebugLog('info', 'ATTACHMENTS', 'download-import',\n        `Stahovn importovan plohy ${attachment.name} ze starho systmu: ${oldUrl}`);\n\n      // Sthnout pmo bez dialogu\n      const link = document.createElement('a');\n      link.href = oldUrl;\n      link.download = attachment.originalni_nazev_souboru;\n      link.style.display = 'none';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n\n      showToast(` Ploha \"${attachment.originalni_nazev_souboru}\" se stahuje ze starho systmu`, 'info');\n      return;\n    }\n\n    try {\n      addDebugLog('info', 'ATTACHMENTS', 'download-start',\n        `Stahovn plohy ${attachment.name} ze serveru...`);\n\n      const blob = await downloadOrderAttachment(\n        formData.id,           // orderId\n        attachment.serverId,    // attachmentId\n        username,               // username\n        token                   // token\n      );\n\n      // Pmo sthnout soubor bez dialog\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = attachment.name || 'priloha';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n\n      addDebugLog('success', 'ATTACHMENTS', 'download-success',\n        `Ploha ${attachment.name} staena spn`);\n\n      // Toast s detaily downloadu - ODSTRANNO (download je okamit a viditeln)\n      // const downloadInfo = `BE Response: ServerID=${attachment.serverId}, GUID=${attachment.serverGuid || 'N/A'}, Size=${blob.size}B`;\n      // showToast(` Download OK: ${attachment.name}\\n${downloadInfo}`, 'success');\n\n    } catch (error) {\n      // Error u byl zpracovn v API vrstv, sta zobrazit error.message\n      const errorMessage = error.message || 'Nepodailo se sthnout plohu';\n      \n      showToast(errorMessage, 'error');\n      \n      addDebugLog('error', 'ATTACHMENTS', 'download-error',\n        `Chyba pi stahovn ${attachment.name}: ${errorMessage}`);\n    }\n  };\n\n  // Smazn plohy ze serveru a loklnho stavu\n  const deleteAttachmentFromServer25 = async (fileId) => {\n    const attachment = attachments.find(f => f.id === fileId);\n    if (!attachment) {\n      return;\n    }\n\n    // Ulo attachment k potvrzen smazn\n    setAttachmentToDelete({ fileId, attachment, isFromServer: true });\n    setShowDeleteAttachmentDialog(true);\n  };\n\n  const performDeleteAttachmentFromServer = async (fileId, attachment, attachmentName) => {\n    if (attachment.serverId && token && username) {\n      try {\n        addDebugLog('info', 'ATTACHMENTS', 'delete-start',\n          `Mazn plohy ${attachment.name} ze serveru...`);\n\n        const deleteResult = await deleteOrderAttachment(\n          formData.id,           // orderId\n          attachment.serverId,    // attachmentId\n          username,               // username\n          token                   // token\n        );\n\n        addDebugLog('success', 'ATTACHMENTS', 'delete-success',\n          `Ploha ${attachment.name} smazna ze serveru`);\n\n        // Toast pi spnm smazn\n        showToast(` Ploha \"${attachment.name}\" byla spn smazna`, 'success');\n\n      } catch (error) {\n\n        addDebugLog('error', 'ATTACHMENTS', 'delete-error',\n          `Chyba pi mazn ${attachment.name}: ${error.message}`);\n\n        // Toast pi chyb smazn\n        const errorMsg = error.response?.data?.message || error.message || 'Neznm chyba';\n        showToast(` Chyba pi mazn plohy \"${attachment.name}\": ${errorMsg}`, 'error');\n        return; // Nepokrauj v mazn z loklnho stavu\n      }\n    }\n\n    // Sma z loklnho stavu BEZ confirm dialogu (u byl potvrzen ve)\n    removeFileDirectly(fileId);\n  };\n\n  // Smazn plohy z loklnho stavu BEZ confirm dialogu (pro voln z jinch funkc)\n  const removeFileDirectly = (fileId) => {\n    // Aktualizuj oba state - formData i attachments\n    setFormData(prev => ({\n      ...prev,\n      prilohy_dokumenty: (prev.prilohy_dokumenty || []).filter(file => file.id !== fileId)\n    }));\n\n    setAttachments(prev => prev.filter(file => file.id !== fileId));\n  };\n\n  // Smazn plohy s confirm dialogem (pro lokln nepipojen soubory)\n  const removeFile = (fileId) => {\n    const file = attachments.find(f => f.id === fileId);\n    if (!file) return;\n\n    // Ulo attachment k potvrzen smazn\n    setAttachmentToDelete({ fileId, attachment: file, isFromServer: false });\n    setShowDeleteAttachmentDialog(true);\n  };\n\n  // Potvrzen smazn plohy z ConfirmDialogu\n  const handleConfirmDeleteAttachment = async () => {\n    if (!attachmentToDelete) return;\n\n    const { fileId, attachment, isFromServer } = attachmentToDelete;\n\n    if (isFromServer) {\n      // Smazn ze serveru\n      await performDeleteAttachmentFromServer(fileId, attachment, attachment.name || 'soubor');\n    } else {\n      // Smazn loklnho souboru\n      removeFileDirectly(fileId);\n      showToast('Soubor byl odstrann', 'info');\n    }\n\n    // Zavi dialog a reset state\n    setShowDeleteAttachmentDialog(false);\n    setAttachmentToDelete(null);\n  };\n\n  // Zruen smazn plohy\n  const handleCancelDeleteAttachment = () => {\n    setShowDeleteAttachmentDialog(false);\n    setAttachmentToDelete(null);\n  };\n\n  const removeAllFiles = () => {\n    if (attachments.length === 0) {\n      showToast('dn plohy k odstrann', 'info');\n      return;\n    }\n\n    // Otevi confirm dialog\n    setShowDeleteAllAttachmentsDialog(true);\n  };\n\n  // Handler pro potvrzen smazn vech ploh\n  const handleConfirmDeleteAllAttachments = () => {\n    // Aktualizuj oba state - formData i attachments\n    setFormData(prev => ({\n      ...prev,\n      prilohy_dokumenty: []\n    }));\n\n    setAttachments([]);\n\n    showToast(`Vechny plohy (${attachments.length} soubor) byly odstranny`, 'warning');\n    \n    // Zavi dialog\n    setShowDeleteAllAttachmentsDialog(false);\n  };\n\n  // Handler pro zruen smazn vech ploh\n  const handleCancelDeleteAllAttachments = () => {\n    setShowDeleteAllAttachmentsDialog(false);\n  };\n\n  // Centrln funkce pro naten ploh z API\n  // POZOR: Nat se pouze pokud je sekce ploh viditeln\n  const fetchAttachmentsFromAPI = async () => {\n    if (!formData.id || !token || !username) {\n      throw new Error('Chyb potebn daje pro naten ploh');\n    }\n\n    if (sectionStates.prilohy) {\n      throw new Error('Sekce ploh je sbalen - natn peskoeno');\n    }\n\n    const result = await listOrderAttachments(\n      formData.id,  // orderId\n      username,      // username\n      token          // token\n    );\n\n    // V2 API vrac: result.data.attachments nebo result.data (array)\n    const rawAttachments = result?.data?.attachments || result?.data || [];\n\n    if (!Array.isArray(rawAttachments)) {\n      throw new Error('API nevrtilo pole ploh');\n    }\n\n    return rawAttachments;\n  };\n\n  // Centrln mapovn plohy z API response na lokln objekt - 1:1 mapovn bez transformac\n  const mapApiAttachmentToLocal = (attachment) => {\n    // V2 API pouv: original_name, file_size, upload_date, uploaded_by_user_id, type, system_path\n\n    //  EXTRAKCE file_prefix ze system_path (backend pole)\n    const systemPath = attachment.system_path || attachment.systemovy_nazev || attachment.final_filename || '';\n    const fileName = systemPath.split('/').pop() || systemPath; // Vezmi nzev souboru (posledn st cesty)\n\n    let filePrefix = 'obj-'; // Default\n    if (fileName.startsWith('dd-')) {\n      filePrefix = 'dd-';\n    } else if (fileName.startsWith('obj-')) {\n      filePrefix = 'obj-';\n    }\n\n    const mapped = {\n      // Pm mapovn z DB/API struktury\n      id: `server_${attachment.id}`,\n      serverId: attachment.id,\n      objednavka_id: attachment.order_id || attachment.objednavka_id,\n      guid: attachment.guid,\n      typ_prilohy: attachment.type || attachment.typ_prilohy,\n      originalni_nazev_souboru: attachment.original_name || attachment.originalni_nazev_souboru,\n      systemovy_nazev: attachment.system_path, //  Backend vrac system_path\n      systemova_cesta: attachment.system_path, //  Backend vrac system_path\n      velikost: attachment.file_size || attachment.velikost || attachment.velikost_souboru_b,\n      dt_vytvoreni: attachment.upload_date || attachment.created_at || attachment.dt_vytvoreni,\n      dt_aktualizace: attachment.updated_at || attachment.dt_aktualizace,\n      nahrano_uzivatel_id: attachment.uploaded_by_user_id || attachment.nahrano_uzivatel_id,\n      nahrano_uzivatel: attachment.nahrano_uzivatel,\n      file_exists: attachment.file_exists,\n      file_prefix: filePrefix, //  Extrahovno ze system_path\n\n      // Kompatibilita s frontendem (aliasy)\n      name: attachment.original_name || attachment.originalni_nazev_souboru,\n      size: attachment.file_size || attachment.velikost || attachment.velikost_souboru_b,\n      type: 'application/octet-stream',\n      lastModified: new Date(attachment.upload_date || attachment.created_at || attachment.dt_vytvoreni || Date.now()).getTime(),\n      klasifikace: attachment.type || attachment.typ_prilohy,\n      cesta_k_souboru: attachment.system_path, //  Backend vrac system_path\n\n      // Status a metadata\n      status: 'uploaded',\n      uploadDate: attachment.upload_date || attachment.created_at || attachment.dt_vytvoreni || new Date().toISOString(),\n      serverGuid: attachment.guid,\n      fromServer: true\n    };\n\n    return mapped;\n  };\n\n  // Pomocn funkce pro detekci file_prefix ze systemov cesty nebo file_prefix\n  const getFilePrefix = (file) => {\n    // Pokud u m file_prefix, pouij ho\n    if (file.file_prefix) {\n      return file.file_prefix;\n    }\n\n    // Extrahuj nzev souboru ze systemov cesty\n    const systemPath = file.systemova_cesta || file.systemovy_nazev || file.cesta_k_souboru || '';\n    const fileName = systemPath.split('/').pop() || systemPath;\n\n    // Kontrola prefixu nzvu souboru\n    if (fileName.startsWith('dd-')) {\n      return 'dd-';\n    }\n    if (fileName.startsWith('obj-')) {\n      return 'obj-';\n    }\n\n    return 'obj-'; // Default\n  };\n\n  // Pomocn funkce pro UI styling ploh\n  const getFileBorderColor = (file) => {\n    if (file.status === 'error') return '#fca5a5';\n    if (!file.klasifikace) return '#fca5a5';\n    if (file.isDuplicate) return '#f59e0b'; // Oranov pro duplicity\n    if (file.status === 'uploading') return '#f59e0b';\n    if (file.status === 'uploaded') return '#10b981';\n    return '#e5e7eb';\n  };\n\n  const getFileBackgroundColor = (file) => {\n    if (file.status === 'error') return '#fef2f2';\n    if (!file.klasifikace) return '#fef2f2';\n    if (file.isDuplicate) return '#fffbeb'; // Svtle oranov pro duplicity\n    if (file.status === 'uploading') return '#fffbeb';\n    if (file.status === 'uploaded') return '#f0fdf4';\n    return 'white';\n  };\n\n  const getFileIconColor = (file) => {\n    if (file.status === 'error') return '#dc2626';\n    if (file.status === 'uploading') return '#f59e0b';\n    if (file.status === 'uploaded') return '#10b981';\n    return '#6b7280';\n  };\n\n  const getFileStatusIndicator = (file) => {\n    switch (file.status) {\n      case 'pending_classification':\n        return (\n          <span style={{\n            color: '#dc2626',\n            fontSize: '0.75rem',\n            marginLeft: '0.5rem',\n            fontWeight: '600'\n          }}>\n             ek na klasifikaci\n          </span>\n        );\n      case 'uploading':\n        return (\n          <span style={{\n            color: '#f59e0b',\n            fontSize: '0.75rem',\n            marginLeft: '0.5rem',\n            fontWeight: '600'\n          }}>\n             Nahrv se...\n          </span>\n        );\n      case 'uploaded':\n        return (\n          <span style={{\n            color: '#10b981',\n            fontSize: '0.75rem',\n            marginLeft: '0.5rem',\n            fontWeight: '600'\n          }}>\n             Nahrno na server\n          </span>\n        );\n      case 'error':\n        return (\n          <span style={{\n            color: '#dc2626',\n            fontSize: '0.75rem',\n            marginLeft: '0.5rem',\n            fontWeight: '600'\n          }}>\n             Chyba uploadu\n          </span>\n        );\n      default:\n        return null;\n    }\n  };\n\n  // Funkce pro prci s polokami objednvky\n  const addPolozka = () => {\n    setFormData(prev => ({\n      ...prev,\n      polozky_objednavky: [\n        ...(prev.polozky_objednavky || []),\n        {\n          id: Date.now(),\n          popis: '',\n          cena_bez_dph: '',\n          sazba_dph: '21',\n          cena_s_dph: '',\n          //  Voliteln lokalizace - inicializace przdnch hodnot\n          usek_kod: '',\n          budova_kod: '',\n          mistnost_kod: '',\n          poznamka: '',\n          //  LP kd na rovni poloky\n          lp_id: null\n        }\n      ]\n    }));\n\n    // Auto-save po pidn poloky\n    setTimeout(() => saveDraft(true), 100);\n  };\n\n  const removePolozka = (id) => {\n    const currentPolozky = formData.polozky_objednavky || [];\n    if (currentPolozky.length <= 1) return; // Minimln jedna poloka\n\n    setFormData(prev => ({\n      ...prev,\n      polozky_objednavky: (prev.polozky_objednavky || []).filter(p => p.id !== id)\n    }));\n\n    // Auto-save po odebrn poloky\n    setTimeout(() => saveDraft(true), 100);\n  };\n\n  const updatePolozka = (id, field, value) => {\n    setFormData(prev => ({\n      ...prev,\n      polozky_objednavky: (prev.polozky_objednavky || []).map(polozka => {\n        if (polozka.id === id) {\n          const updatedPolozka = { ...polozka, [field]: value };\n\n          // Pokud se mn cena bez DPH nebo DPH sazba, pepotej cenu s DPH\n          if (field === 'cena_bez_dph' || field === 'sazba_dph') {\n            const cenaBezDph = parseFloat((updatedPolozka.cena_bez_dph || '0').replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\n            const dphSazba = parseFloat(updatedPolozka.sazba_dph) || 0;\n            const cenaSdph = cenaBezDph * (1 + dphSazba / 100);\n            // Pro faktury/etnictv pesn 2 desetinn msta\n            updatedPolozka.cena_s_dph = cenaSdph.toFixed(2);\n          }\n\n          // Pokud se mn cena s DPH, pepotej cenu bez DPH\n          if (field === 'cena_s_dph') {\n            const cenaSdph = parseFloat((updatedPolozka.cena_s_dph || '0').replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\n            const dphSazba = parseFloat(updatedPolozka.sazba_dph) || 0;\n            const cenaBezDph = cenaSdph / (1 + dphSazba / 100);\n            // Pro faktury/etnictv pesn 2 desetinn msta\n            updatedPolozka.cena_bez_dph = cenaBezDph.toFixed(2);\n          }\n\n          return updatedPolozka;\n        }\n        return polozka;\n      })\n    }));\n\n    //  NOV AUTOSAVE pro poloky objednvky\n    // Pro select DPH - okamit, pro text/ceny - pi blur (e se ve FormatNumberInput)\n    if (field === 'sazba_dph') {\n      // Select DPH - okamit uloen\n      if (!disableAutosaveRef.current && draftManager.isAutosaveEnabled() && !isSaving && !showSaveProgress && isDraftLoaded) {\n        triggerAutosave(true); // immediate\n      }\n    }\n    // Pro popis a ceny se autosave spust pi onBlur z input pole\n  };\n\n  // Pokroil funkce pro dodavatele\n  const handleSupplierLocalSearch = async () => {\n    // Pre-fill search with current supplier name or ICO if available\n    const currentName = formData.dodavatel_nazev || '';\n    const currentIco = formData.dodavatel_ico || '';\n    const searchTerm = currentName || currentIco;\n\n    setSupplierSearchTerm(searchTerm);\n    setSupplierSearchResults([]);\n    setShowSupplierSearchDialog(true);\n\n    // Load all available contacts and apply initial filter if we have search term\n    await loadAllSupplierContacts(searchTerm);\n  };\n\n  //  Kontrola zda jsou vyplnn vechny povinn daje dodavatele pro pidn do adrese\n  const checkSupplierRequiredFields = () => {\n    return !!(\n      formData.dodavatel_nazev?.trim() &&\n      formData.dodavatel_adresa?.trim() &&\n      formData.dodavatel_ico?.trim() &&\n      /^\\d{8}$/.test(formData.dodavatel_ico?.trim()) // IO mus mt 8 slic\n    );\n  };\n\n  //  Handler pro kliknut na ikonu \"Pidat do adrese\"\n  const handleAddSupplierToDirectory = async () => {\n    // DEBUG: Add to directory button click - logging removed\n    // DEBUG: ADD TO DIRECTORY logging removed for performance\n    /*// console.log(' [ADD TO DIRECTORY] formData dodavatele:', {\n      nazev: formData.dodavatel_nazev,\n      adresa: formData.dodavatel_adresa,\n      ico: formData.dodavatel_ico,\n      dic: formData.dodavatel_dic,\n      zastoupeny: formData.dodavatel_zastoupeny,\n      kontakt_jmeno: formData.dodavatel_kontakt_jmeno,\n      kontakt_email: formData.dodavatel_kontakt_email,\n      kontakt_telefon: formData.dodavatel_kontakt_telefon\n    });*/\n\n    if (!checkSupplierRequiredFields()) {\n      showToast?.('Vyplte vechny povinn daje dodavatele (nzev, adresa, IO)', 'warning');\n      return;\n    }\n\n    // Detekce existence dodavatele v DB\n    try {\n      setExistingSupplierCheck({ loading: true });\n\n      // Kontrola podle IO\n      const ico = formData.dodavatel_ico.trim();\n      const result = await fetchSupplierContacts({\n        token,\n        username,\n        user_id,\n        usek_zkr: userDetail?.usek_zkr,\n        ico: ico, // Filtruj podle IO\n        load_all: hasPermission && hasPermission('CONTACT_MANAGE')\n      });\n\n      // Prva pro vbr Global scope\n      const canManageGlobal = hasPermission && hasPermission('CONTACT_MANAGE');\n\n      //  DEBUG: Co backend vrtil\n\n      // Filtruj vsledky podle IO (stejn IO me bt vckrt s rznm scope)\n      const filteredResults = Array.isArray(result)\n        ? result.filter(supplier => supplier.ico?.trim() === ico)\n        : [];\n\n\n      if (filteredResults.length > 0) {\n\n        // Pro kad IO me existovat max 3 zznamy (Personal, sek, Global)\n        // PRAVIDLA DETEKCE:\n        // 1. usek_zkr vyplnn  SEK (priorita! ignoruje user_id)\n        // 2. user_id > 0 && usek_zkr przdn  PERSONAL\n        // 3. user_id = 0 && usek_zkr przdn  GLOBAL\n\n        // 1. SEK: M vyplnn usek_zkr (NEJVY PRIORITA)\n        const existsInUsek = filteredResults.find(s => {\n          const hasUsek = s.usek_zkr && s.usek_zkr.trim() !== '' && s.usek_zkr !== '[]' && s.usek_zkr !== 'null';\n\n          if (hasUsek) {\n            try {\n              const supplierUseky = JSON.parse(s.usek_zkr);\n              const myUsekRaw = userDetail?.usek_zkr;\n\n              // Mj sek me bt string nebo array\n              const myUseky = Array.isArray(myUsekRaw) ? myUsekRaw : [myUsekRaw];\n\n\n              // Zkontroluj jestli NJAK z mch sek je v secch dodavatele\n              const hasCommonUsek = Array.isArray(supplierUseky) &&\n                                   myUseky.some(myUsek => myUsek && supplierUseky.includes(myUsek));\n\n              return hasCommonUsek;\n            } catch (e) {\n              return false;\n            }\n          }\n          return false;\n        });\n\n        // 2. PERSONAL: user_id > 0 && usek_zkr przdn\n        const existsInPersonal = filteredResults.find(s => {\n          const hasUsek = s.usek_zkr && s.usek_zkr.trim() !== '' && s.usek_zkr !== '[]' && s.usek_zkr !== 'null';\n          const isPersonal = (s.user_id && s.user_id !== 0 && s.user_id !== '0') && !hasUsek;\n          return isPersonal;\n        });\n\n        // 3. GLOBAL: user_id = 0 && usek_zkr przdn\n        const existsInGlobal = filteredResults.find(s => {\n          const hasUsek = s.usek_zkr && s.usek_zkr.trim() !== '' && s.usek_zkr !== '[]' && s.usek_zkr !== 'null';\n          const isGlobal = (s.user_id === 0 || s.user_id === '0') && !hasUsek;\n          return isGlobal;\n        });\n\n\n        // Pedme info o tom, ve kterch scope dodavatel existuje\n        setExistingSupplierCheck({\n          exists: true,\n          existsInPersonal: existsInPersonal || null,\n          existsInUsek: existsInUsek || null,\n          existsInGlobal: existsInGlobal || null,\n          // Pro zptnou kompatibilitu - preferuj Personal > sek > Global\n          supplier: existsInPersonal || existsInUsek || existsInGlobal\n        });\n      } else {\n        // Dodavatel neexistuje\n        setExistingSupplierCheck({\n          exists: false,\n          existsInPersonal: null,\n          existsInUsek: null,\n          existsInGlobal: null,\n          supplier: null\n        });\n      }\n\n      // Otevt dialog\n      setShowSupplierAddDialog(true);\n    } catch (error) {\n      showToast?.('Chyba pi kontrole dodavatele v databzi', 'error');\n      setExistingSupplierCheck(null);\n    }\n  };\n\n  //  Handler pro uloen dodavatele do adrese\n  const handleSaveSupplierToDirectory = async (supplierData, scope, useky = null) => {\n    // DEBUG: SAVE TO DIRECTORY logging removed for performance\n    /*// console.log(' [SAVE TO DIRECTORY] Zatek ukldn');\n    // console.log(' [SAVE TO DIRECTORY] Pchoz supplierData:', supplierData);\n    // console.log(' [SAVE TO DIRECTORY] Scope:', scope, 'seky:', useky);*/\n\n    try {\n      // Uren user_id a usek_zkr podle scope\n      let userId;\n      let usekZkr;\n\n      if (scope === 'personal') {\n        userId = user_id; // ID pihlenho uivatele\n        usekZkr = '';  //  Przdn string (NIKDY null!) - Personal scope\n      } else if (scope === 'usek') {\n        userId = 0; // 0 = nen osobn\n        usekZkr = useky || []; // Array zkratek sek\n      } else { // global\n        userId = 0;\n        usekZkr = '';  //  Przdn string (NIKDY null!) - Global scope\n      }\n\n      //  FIX: SupplierAddDialog pouv UNPREFIXED nzvy (nazev, ico, adresa)\n      // OrderForm25 mu ale pedv PREFIXED data (dodavatel_nazev, dodavatel_ico, ...)\n      // SupplierAddDialog je intern mapuje na unprefixed  supplierData obsahuje u .nazev, .ico atd.\n      const dataToSave = {\n        nazev: supplierData.nazev || supplierData.dodavatel_nazev || '',\n        adresa: supplierData.adresa || supplierData.dodavatel_adresa || '',\n        ico: supplierData.ico || supplierData.dodavatel_ico || '',\n        dic: supplierData.dic || supplierData.dodavatel_dic || '',\n        zastoupeny: supplierData.zastoupeny || supplierData.dodavatel_zastoupeny || '',\n        kontakt_jmeno: supplierData.kontakt_jmeno || supplierData.dodavatel_kontakt_jmeno || '',\n        kontakt_email: supplierData.kontakt_email || supplierData.dodavatel_kontakt_email || '',\n        kontakt_telefon: supplierData.kontakt_telefon || supplierData.dodavatel_kontakt_telefon || '',\n        user_id: userId,\n        usek_zkr: usekZkr // Backend oekv array nebo null (NE JSON string!)\n      };\n\n      // console.log(' [SAVE TO DIRECTORY] Data pipraven k odesln:', dataToSave);\n\n      let result;\n\n      if (existingSupplierCheck?.exists && scope === existingSupplierCheck.scope) {\n        // Aktualizace existujcho dodavatele ve stejnm scope\n        // console.log(' [SAVE TO DIRECTORY] Aktualizace existujcho dodavatele');\n        /*console.log(' [SAVE TO DIRECTORY] Parametry pro updateSupplierByIco:', {\n          ico: dataToSave.ico,\n          nazev: dataToSave.nazev,\n          adresa: dataToSave.adresa,\n          userId,\n          usekZkr\n        });*/\n\n        result = await updateSupplierByIco({\n          token,\n          username,\n          user_id: userId,\n          usek_zkr: usekZkr,\n          ico: dataToSave.ico,\n          nazev: dataToSave.nazev,\n          adresa: dataToSave.adresa,\n          dic: dataToSave.dic,\n          zastoupeny: dataToSave.zastoupeny,\n          kontakt_jmeno: dataToSave.kontakt_jmeno,\n          kontakt_email: dataToSave.kontakt_email,\n          kontakt_telefon: dataToSave.kontakt_telefon\n        });\n\n        // console.log(' [SAVE TO DIRECTORY] Update spn, odpov:', result);\n        showToast?.('Dodavatel byl spn aktualizovn v adresi', 'success');\n      } else {\n        // Vytvoen novho dodavatele (nebo pidn do jinho scope)\n        // console.log(' [SAVE TO DIRECTORY] Vytven novho dodavatele');\n        /*console.log(' [SAVE TO DIRECTORY] Parametry pro createSupplier:', {\n          userId,  //  Sprvn userId podle scope\n          usekZkr,  //  Sprvn usekZkr podle scope\n          ...dataToSave\n        });*/\n\n        //  FIX: createSupplier oekv FLAT parametry, ne data objekt!\n        //  FIX 2: Pout SPRVN userId a usekZkr podle vybranho scope!\n        //   - Personal: userId = user_id, usekZkr = null\n        //   - sek: userId = 0, usekZkr = [array sek]\n        //   - Global: userId = 0, usekZkr = null\n        result = await createSupplier({\n          token,\n          username,\n          user_id: userId,  //  Z promnn userId (ne user_id!)\n          usek_zkr: usekZkr,  //  Z promnn usekZkr (ne userDetail.usek_zkr!)\n          // Rozbalit dataToSave FLAT do parametr\n          nazev: dataToSave.nazev,\n          adresa: dataToSave.adresa,\n          ico: dataToSave.ico,\n          dic: dataToSave.dic,\n          zastoupeny: dataToSave.zastoupeny,\n          kontakt_jmeno: dataToSave.kontakt_jmeno,\n          kontakt_email: dataToSave.kontakt_email,\n          kontakt_telefon: dataToSave.kontakt_telefon\n        });\n\n        // console.log(' [SAVE TO DIRECTORY] Create spn, odpov:', result);\n        showToast?.('Dodavatel byl spn pidn do adrese', 'success');\n      }\n\n      // Vyistit cache natench kontakt (aby se znovu naetly s novm zznamem)\n      setAllSupplierContacts([]);\n\n      // Zavt dialog\n      // console.log(' [SAVE TO DIRECTORY] Zavrn dialogu');\n      setShowSupplierAddDialog(false);\n      setExistingSupplierCheck(null);\n    } catch (error) {\n      throw new Error(error.message || 'Chyba pi ukldn dodavatele do databze');\n    }\n  };\n\n  const loadAllSupplierContacts = async (initialSearchTerm = '') => {\n    // Pokud u jsou kontakty naten, nedlme nic - jen aplikujeme filtr\n    if (allSupplierContacts.length > 0) {\n      if (initialSearchTerm && initialSearchTerm.length >= 2) {\n        performSupplierSearch(initialSearchTerm);\n      } else {\n        setSupplierSearchResults(allSupplierContacts);\n      }\n      return;\n    }\n\n    setSupplierSearchLoading(true);\n\n    try {\n      const result = await fetchSupplierContacts({\n        token: token,\n        username: username,\n        user_id: user_id,\n        usek_zkr: userDetail?.usek_zkr || undefined,\n        load_all: hasPermission && hasPermission('CONTACT_MANAGE') // Load all contacts for CONTACT_MANAGE users\n      });\n\n      if (Array.isArray(result)) {\n        setAllSupplierContacts(result); // Ulome si vechny kontakty\n\n        // Aplikovat filtr pokud mme vyhledvac termn, jinak zobrazit vechny\n        if (initialSearchTerm && initialSearchTerm.length >= 2) {\n          // Normalizovat vyhledvac termn\n          const searchNormalized = normalizeText(initialSearchTerm);\n\n          // Filtruji pmo nov naten data\n          const filtered = result.filter(supplier => {\n            const name = normalizeText(supplier.nazev || supplier.name || '');\n            const ico = (supplier.ico || '').toLowerCase(); // IO nen teba normalizovat\n            const email = (supplier.kontakt_email || supplier.email || '').toLowerCase();\n            const contact = normalizeText(supplier.kontakt_jmeno || '');\n\n            return name.includes(searchNormalized) ||\n                   ico.includes(initialSearchTerm.toLowerCase()) || // Pro IO pout pvodn termn\n                   email.includes(initialSearchTerm.toLowerCase()) || // Pro email pout pvodn termn\n                   contact.includes(searchNormalized);\n          });\n          setSupplierSearchResults(filtered);\n        } else {\n          setSupplierSearchResults(result); // Zobrazme vechny kontakty\n        }\n      } else {\n        setAllSupplierContacts([]);\n        setSupplierSearchResults([]);\n      }\n\n    } catch (error) {\n      showToast && showToast('Chyba pi natn kontakt: ' + error.message, { type: 'error' });\n      setAllSupplierContacts([]);\n      setSupplierSearchResults([]);\n    } finally {\n      setSupplierSearchLoading(false);\n    }\n  };\n\n  const performSupplierSearch = (searchTerm) => {\n    if (!searchTerm || searchTerm.length < 2) {\n      // Zobrazit vechny kontakty pokud je search przdn\n      setSupplierSearchResults(allSupplierContacts);\n      return;\n    }\n\n    // Normalizovat vyhledvac termn\n    const searchNormalized = normalizeText(searchTerm);\n\n    // Lokln filtrovn natench kontakt - bez API voln!\n    const filtered = allSupplierContacts.filter(supplier => {\n      const name = normalizeText(supplier.nazev || supplier.name || '');\n      const ico = (supplier.ico || '').toLowerCase(); // IO nen teba normalizovat\n      const email = (supplier.kontakt_email || supplier.email || '').toLowerCase();\n      const contact = normalizeText(supplier.kontakt_jmeno || '');\n\n      return name.includes(searchNormalized) ||\n             ico.includes(searchTerm.toLowerCase()) || // Pro IO pout pvodn termn\n             email.includes(searchTerm.toLowerCase()) || // Pro email pout pvodn termn\n             contact.includes(searchNormalized);\n    });\n\n    setSupplierSearchResults(filtered);\n  };\n\n  const handleSupplierSearchChange = (e) => {\n    const value = e.target.value;\n    setSupplierSearchTerm(value);\n\n    // Okamit lokln filtrovn - dn debounce ani API voln!\n    performSupplierSearch(value);\n  };\n\n  const handleSupplierSearchSelect = (supplier) => {\n    // Fill form with selected supplier data using correct field names\n    setFormData(prev => ({\n      ...prev,\n      dodavatel_nazev: supplier.nazev || supplier.name || '',\n      dodavatel_adresa: supplier.adresa || supplier.address || '',\n      dodavatel_ico: supplier.ico || '',\n      dodavatel_dic: supplier.dic || '',\n      dodavatel_zastoupeny: supplier.zastoupeny || supplier.represented || '',\n      dodavatel_kontakt_jmeno: supplier.kontakt_jmeno || (supplier.contactPerson && supplier.contactPerson.name) || '',\n      dodavatel_kontakt_email: supplier.kontakt_email || (supplier.contactPerson && supplier.contactPerson.email) || supplier.email || '',\n      dodavatel_kontakt_telefon: supplier.kontakt_telefon || (supplier.contactPerson && supplier.contactPerson.phone) || supplier.telefon || ''\n    }));\n\n    setShowSupplierSearchDialog(false);\n    setSupplierSearchTerm('');\n    setSupplierSearchResults([]);\n    showToast && showToast('Dodavatel byl vybrn', { type: 'success' });\n  };\n\n  const handleSupplierSearchClose = () => {\n    setShowSupplierSearchDialog(false);\n    setSupplierSearchTerm('');\n    setSupplierSearchResults([]);\n  };\n\n  const handleSupplierAresSearch = () => {\n    // Pre-fill search with current supplier name or IO if available\n    const currentName = formData.dodavatel_nazev || '';\n    const currentICO = formData.dodavatel_ico || '';\n    const searchTerm = currentName || currentICO;\n\n    setAresSearch(searchTerm);\n    setAresPopupOpen(true);\n    if (searchTerm && searchTerm.length >= 2) {\n      fetchAresData(searchTerm);\n    }\n  };\n\n  const fetchAresData = async (searchTerm = '') => {\n    const trimmedSearchTerm = searchTerm?.trim();\n    if (!trimmedSearchTerm || trimmedSearchTerm.length < 3) {\n      setAresResults([]);\n      return;\n    }\n\n    try {\n      setLoadingAres(true);\n\n      // Check if search term is numeric (IO) or text (nzev)\n      const isICO = /^\\d+$/.test(trimmedSearchTerm);\n\n      let url, requestData;\n\n      if (isICO) {\n        // Search by IO - direct endpoint\n        url = `https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/${trimmedSearchTerm}`;\n        const response = await fetch(url, {\n          method: 'GET',\n          headers: { 'Accept': 'application/json' }\n        });\n\n        if (response.ok) {\n          const data = await response.json();\n          const result = {\n            ico: data.ico,\n            dic: data.dic || '',\n            nazev: data.obchodniJmeno || '',\n            adresa: data.sidlo?.textovaAdresa || '',\n            sidlo: data.sidlo?.textovaAdresa || ''\n          };\n          setAresResults([result]);\n        } else {\n          setAresResults([]);\n          if (trimmedSearchTerm.length >= 8) {\n            showToast && showToast('Dodavatel nebyl v ARES nalezen', { type: 'warning' });\n          }\n        }\n      } else {\n        // Search by nzev - search endpoint\n        url = 'https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/vyhledat';\n\n        // Zkusme vyhledat jak s pvodnm textem, tak s normalizovanm\n        const searchVariants = [\n          trimmedSearchTerm, // Pvodn text\n          normalizeText(trimmedSearchTerm) // Normalizovan text (bez diakritiky)\n        ].filter((term, index, arr) => arr.indexOf(term) === index); // Odstran duplikty\n\n        let allResults = [];\n\n        // Vyhledme pro kadou variantu\n        for (const searchVariant of searchVariants) {\n          if (!searchVariant) continue;\n\n          requestData = {\n            obchodniJmeno: searchVariant,\n            pocet: 25\n          };\n\n          const response = await fetch(url, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(requestData)\n          });\n\n          if (response.ok) {\n            const data = await response.json();\n            const results = (data.ekonomickeSubjekty || []).map(item => ({\n              ico: item.ico,\n              dic: item.dic || '',\n              nazev: item.obchodniJmeno || '',\n              adresa: item.sidlo?.textovaAdresa || '',\n              sidlo: item.sidlo?.textovaAdresa || ''\n            }));\n            allResults.push(...results);\n          }\n        }\n\n        // Odstranit duplikty podle IO\n        const uniqueResults = allResults.filter((item, index, arr) =>\n          arr.findIndex(other => other.ico === item.ico) === index\n        );\n\n        // Seadit podle relevance - nejdve ty kter obsahuj pvodn vyhledvac termn\n        const normalizedSearchTerm = normalizeText(trimmedSearchTerm);\n        uniqueResults.sort((a, b) => {\n          const aNameNorm = normalizeText(a.nazev);\n          const bNameNorm = normalizeText(b.nazev);\n\n          const aContainsOriginal = aNameNorm.includes(normalizedSearchTerm);\n          const bContainsOriginal = bNameNorm.includes(normalizedSearchTerm);\n\n          if (aContainsOriginal && !bContainsOriginal) return -1;\n          if (!aContainsOriginal && bContainsOriginal) return 1;\n          return 0;\n        });\n\n        setAresResults(uniqueResults);\n\n        //  Detekce scope pro kad vsledek\n        if (uniqueResults.length > 0) {\n          const scopeInfoMap = {};\n\n          // Pro kad vsledek zkontroluj zda existuje v DB\n          for (const aresItem of uniqueResults) {\n            if (!aresItem.ico) continue;\n\n            try {\n              const dbResults = await fetchSupplierContacts({\n                token,\n                username,\n                user_id,\n                usek_zkr: userDetail?.usek_zkr,\n                ico: aresItem.ico,\n                load_all: hasPermission && hasPermission('CONTACT_MANAGE')\n              });\n\n              const filteredResults = Array.isArray(dbResults)\n                ? dbResults.filter(s => s.ico?.trim() === aresItem.ico.trim())\n                : [];\n\n              if (filteredResults.length > 0) {\n                // Normalizace userDetail.usek_zkr na pole\n                const myUseky = Array.isArray(userDetail?.usek_zkr)\n                  ? userDetail.usek_zkr\n                  : [userDetail?.usek_zkr];\n\n                // 1. SEK: M vyplnn usek_zkr\n                const existsInUsek = filteredResults.find(s => {\n                  const hasUsek = s.usek_zkr && s.usek_zkr.trim() !== '' && s.usek_zkr !== '[]' && s.usek_zkr !== 'null';\n                  if (hasUsek) {\n                    try {\n                      const supplierUseky = JSON.parse(s.usek_zkr);\n                      const hasCommonUsek = myUseky.some(myUsek => myUsek && supplierUseky.includes(myUsek));\n                      return hasCommonUsek;\n                    } catch (e) {\n                      return false;\n                    }\n                  }\n                  return false;\n                });\n\n                // 2. PERSONAL: user_id > 0 && user_id === currentUserId && usek_zkr przdn\n                const existsInPersonal = filteredResults.find(s => {\n                  const hasUsek = s.usek_zkr && s.usek_zkr.trim() !== '' && s.usek_zkr !== '[]' && s.usek_zkr !== 'null';\n                  return s.user_id > 0 && s.user_id === user_id && !hasUsek;\n                });\n\n                // 3. GLOBAL: user_id = 0 && usek_zkr przdn\n                const existsInGlobal = filteredResults.find(s => {\n                  const hasUsek = s.usek_zkr && s.usek_zkr.trim() !== '' && s.usek_zkr !== '[]' && s.usek_zkr !== 'null';\n                  return s.user_id === 0 && !hasUsek;\n                });\n\n                scopeInfoMap[aresItem.ico] = {\n                  existsInPersonal: !!existsInPersonal,\n                  existsInUsek: !!existsInUsek,\n                  existsInGlobal: !!existsInGlobal\n                };\n              } else {\n                scopeInfoMap[aresItem.ico] = {\n                  existsInPersonal: false,\n                  existsInUsek: false,\n                  existsInGlobal: false\n                };\n              }\n            } catch (error) {\n              scopeInfoMap[aresItem.ico] = {\n                existsInPersonal: false,\n                existsInUsek: false,\n                existsInGlobal: false\n              };\n            }\n          }\n\n          setAresScopeInfo(scopeInfoMap);\n        }\n\n        if (uniqueResults.length === 0) {\n          // dn vsledky nenalezeny ani s normalizac\n        }\n      }\n\n    } catch (error) {\n      setAresResults([]);\n      setAresScopeInfo({});\n      showToast && showToast('Chyba pi pipojen k ARES', { type: 'error' });\n    } finally {\n      setLoadingAres(false);\n    }\n  };\n\n  //  Handler pro pepnut vbru seku v ARES dialogu (stejn jako v SupplierAddDialog)\n  const handleAresUsekToggle = (usekZkr) => {\n    setAresSelectedUseky(prev => {\n      if (prev.includes(usekZkr)) {\n        return prev.filter(zkr => zkr !== usekZkr);\n      } else {\n        return [...prev, usekZkr];\n      }\n    });\n  };\n\n  const handleAresSearchChange = (e) => {\n    const value = e.target.value;\n    setAresSearch(value);\n\n    // Debounce search\n    if (value.length >= 2) {\n      clearTimeout(window.aresSearchTimeout);\n      window.aresSearchTimeout = setTimeout(() => {\n        fetchAresData(value);\n      }, 500);\n    } else {\n      setAresResults([]);\n    }\n  };\n\n  const handleAresSelect = (aresItem) => {\n    setFormData(prev => ({\n      ...prev,\n      dodavatel_nazev: aresItem.nazev || '',\n      dodavatel_adresa: aresItem.adresa || aresItem.sidlo || '',\n      dodavatel_ico: aresItem.ico || '',\n      dodavatel_dic: aresItem.dic || ''\n    }));\n\n    setAresPopupOpen(false);\n    setAresSearch('');\n    setAresResults([]);\n    showToast && showToast('Dodavatel naten z ARES', { type: 'success' });\n  };\n\n  // Funkce pro ukldn ARES zznamu do lokln databze\n  const handleSaveToLocal = async (aresItem, saveLocation) => {\n    if (!token || !username || !user_id) {\n      showToast && showToast('Chyb pihlaovac daje', { type: 'error' });\n      return;\n    }\n\n    setSavingToLocal(aresItem.ico);\n\n    try {\n      // Debug informace\n      addDebugLog('info', 'ARES-SAVE', 'permissions-check', `Uivatel: ${username}, USER_MANAGE: ${canManageUsers}, sek: ${userDetail?.usek_zkr}, Ukldm do: ${JSON.stringify(saveLocation)}`);\n\n      //  Urit user_id a usek_zkr podle vybranho umstn\n      let targetUserId = 0; // 0 = globln nebo sekov\n      let targetUsekZkr = '';\n\n      if (saveLocation === 'personal') {\n        targetUserId = user_id; // Osobn kontakt - jen pro vlastnka\n        targetUsekZkr = '';\n        addDebugLog('info', 'ARES-SAVE', 'target-personal', `Cl: Osobn kontakt pro user_id=${targetUserId}`);\n      } else if (saveLocation?.scope === 'usek' || saveLocation === 'department') {\n        //  SEKOV KONTAKT - pout vybran seky\n        targetUserId = 0;\n        const selectedUseky = saveLocation?.useky || [userDetail?.usek_zkr || ''];\n        targetUsekZkr = JSON.stringify(selectedUseky);\n        addDebugLog('info', 'ARES-SAVE', 'target-usek', `Cl: Kontakty seku pro seky=${selectedUseky.join(', ')}, usek_zkr=${targetUsekZkr}`);\n      } else if (saveLocation === 'global') {\n        targetUserId = 0; // Globln kontakt - vid vichni\n        targetUsekZkr = '';\n        addDebugLog('info', 'ARES-SAVE', 'target-global', `Cl: Globln kontakt (user_id=0, usek_zkr='')`);\n      }\n\n      // Nejdve zkusit aktualizovat existujc zznam\n      try {\n        await updateSupplierByIco({\n          token,\n          username,\n          ico: aresItem.ico,\n          nazev: aresItem.nazev,\n          adresa: aresItem.adresa || aresItem.sidlo || '',\n          dic: aresItem.dic || '',\n          zastoupeny: '',\n          kontakt_jmeno: '',\n          kontakt_email: '',\n          kontakt_telefon: '',\n          user_id: targetUserId,\n          usek_zkr: targetUsekZkr\n        });\n\n        showToast && showToast('Dodavatel byl aktualizovn v lokln databzi', { type: 'success' });\n\n      } catch (updateError) {\n        // Pokud aktualizace sele (zznam neexistuje), vytvo nov\n        await createSupplier({\n          token,\n          username,\n          nazev: aresItem.nazev,\n          adresa: aresItem.adresa || aresItem.sidlo || '',\n          ico: aresItem.ico,\n          dic: aresItem.dic || '',\n          zastoupeny: '',\n          kontakt_jmeno: '',\n          kontakt_email: '',\n          kontakt_telefon: '',\n          user_id: targetUserId,\n          usek_zkr: targetUsekZkr\n        });\n\n        showToast && showToast('Dodavatel byl pidn do lokln databze', { type: 'success' });\n      }\n\n      // Refresh loklnch kontakt po spnm uloen\n      setAllSupplierContacts([]); // Vyma cache aby se pi ptm oteven naetly nov data\n\n    } catch (error) {\n      showToast && showToast(`Chyba pi ukldn: ${error.message}`, { type: 'error' });\n    } finally {\n      setSavingToLocal(null);\n    }\n  };\n\n  const handleSelectAndSave = async (aresItem) => {\n    // Nejdve vypl formul\n    handleAresSelect(aresItem);\n\n    // Pak ulo do lokln DB s vchozm umstnm\n    const defaultLocation = 'personal'; // Vchoz je osobn kontakt\n    await handleSaveToLocal(aresItem, defaultLocation);\n  };\n\n  // Automatick vyhledvn IO pi zmn focus\n  const handleIcoBlur = (ico) => {\n    const trimmedIco = ico?.trim();\n\n    // Auto-save pi blur\n    handleFieldBlur('dodavatel_ico', trimmedIco);\n\n    if (trimmedIco && trimmedIco.length >= 8 && /^\\d+$/.test(trimmedIco)) {\n      checkSupplierByIco(trimmedIco);\n    }\n  };\n\n  // Kontrola dodavatele podle IO (nejdve lokln DB, pak ARES)\n  const checkSupplierByIco = async (ico) => {\n    const trimmedIco = ico?.trim();\n    if (!trimmedIco || trimmedIco.length < 8) return;\n\n    setIsIcoOperation(true);\n    setIcoCheckStatus('checking');\n    setIcoCheckData(null);\n    setShowIcoCheck(true);\n\n    try {\n      // Nejdve zkusme lokln databzi\n      const localResult = await searchSupplierByIco({\n        token: token,\n        username: username,\n        ico: trimmedIco\n      });\n\n      if (localResult?.data && Array.isArray(localResult.data) && localResult.data.length > 0) {\n        // Nalezeno v lokln databzi\n        const supplier = localResult.data[0];\n        setIcoCheckStatus('found-local');\n        setIcoCheckData({\n          ...supplier,\n          source: 'local'\n        });\n      } else {\n        // Nen v lokln DB, zkusme ARES\n        const aresUrl = `https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/${trimmedIco}`;\n        const aresResponse = await fetch(aresUrl, {\n          method: 'GET',\n          headers: { 'Accept': 'application/json' }\n        });\n\n        if (aresResponse.ok) {\n          const aresData = await aresResponse.json();\n          setIcoCheckStatus('found-ares');\n          setIcoCheckData({\n            ico: aresData.ico,\n            dic: aresData.dic || '',\n            nazev: aresData.obchodniJmeno || '',\n            adresa: aresData.sidlo?.textovaAdresa || '',\n            source: 'ares'\n          });\n        } else {\n          setIcoCheckStatus('not-found');\n          setIcoCheckData(null);\n        }\n      }\n    } catch (error) {\n      setIcoCheckStatus('not-found');\n      setIcoCheckData(null);\n    } finally {\n      setIsIcoOperation(false);\n    }\n  };\n\n  // Akce pro IO dialog - pidn do osobnch kontakt\n  const handleIcoUpdate = async () => {\n    if (!icoCheckData) return;\n\n    if (icoCheckData.source === 'ares') {\n      // Z ARES - pidme do osobnch kontakt pod user_id\n      try {\n        const result = await createSupplier({\n          token: token,\n          username: username,\n          nazev: icoCheckData.nazev,\n          ico: icoCheckData.ico,\n          dic: icoCheckData.dic || '',\n          adresa: icoCheckData.adresa || '',\n          zastoupeny: '',\n          kontakt_jmeno: '',\n          kontakt_email: '',\n          kontakt_telefon: '',\n          user_id: user_id,\n          usek_zkr: '' // Osobn kontakt = bez seku\n        });\n\n        if (result?.ok || result?.status === 'ok') {\n          showToast && showToast('Dodavatel byl pidn do vaich osobnch kontakt', { type: 'success' });\n        } else {\n          throw new Error(result?.message || 'Neznm chyba');\n        }\n      } catch (error) {\n        showToast && showToast(`Chyba pi pidvn do kontakt: ${error.message}`, { type: 'error' });\n        return; // Nepokraujeme s vyplnnm\n      }\n    }\n\n    // Vyplnme formul\n    handleIcoFillForm();\n  };\n\n  const handleIcoFillForm = () => {\n    if (!icoCheckData) return;\n\n    setFormData(prev => ({\n      ...prev,\n      dodavatel_nazev: icoCheckData.nazev || icoCheckData.name || '',\n      dodavatel_adresa: icoCheckData.adresa || icoCheckData.address || '',\n      dodavatel_ico: icoCheckData.ico || '',\n      dodavatel_dic: icoCheckData.dic || '',\n      dodavatel_zastoupeny: icoCheckData.zastoupeny || '',\n      dodavatel_kontakt_jmeno: icoCheckData.kontakt_jmeno || '',\n      dodavatel_kontakt_email: icoCheckData.kontakt_email || '',\n      dodavatel_kontakt_telefon: icoCheckData.kontakt_telefon || ''\n    }));\n\n    setShowIcoCheck(false);\n    setIcoCheckStatus(null);\n    setIcoCheckData(null);\n    // showToast && showToast('daje dodavatele byly vyplnny', { type: 'success' }); // Odstranno - nen teba\n  };\n\n  const handleIcoCancel = () => {\n    setShowIcoCheck(false);\n    setIcoCheckStatus(null);\n    setIcoCheckData(null);\n  };\n\n  // ====================== ABLONY - POMOCN FUNKCE ======================\n\n  // Kontrola zda ablona odpovd vyhledvacmu dotazu\n  const matchesTemplateQuery = (entry, query) => {\n    if (!query || !query.trim()) return true;\n    const normalizedQuery = normalizeText(query);\n    const entryName = normalizeText(entry.name || entry.dbName || '');\n    const entryPredmet = normalizeText(entry.data?.poApproval?.predmet || '');\n    const entryFirstItem = normalizeText(entry.data?.polozky?.[0]?.popis || '');\n    return entryName.includes(normalizedQuery) || entryPredmet.includes(normalizedQuery) || entryFirstItem.includes(normalizedQuery);\n  };\n\n  // Kompaktn nhled poloek ablony (pevzato z OrderFormComponent)\n  const compactTemplatePreview = (data) => {\n    try {\n      const preview = {};\n      if (data?.poApproval?.predmet) preview.predmet = data.poApproval.predmet;\n      if (data?.poApproval?.max_cena_s_dph) preview.maxCena = data.poApproval.max_cena_s_dph;\n      if (data?.orderDetails?.dodavatel_nazev) preview.dodavatel = data.orderDetails.dodavatel_nazev;\n      if (Array.isArray(data?.polozky) && data.polozky.length) {\n        preview.polozky = data.polozky.length;\n        if (data.polozky[0]?.popis) preview.prvniPolozka = data.polozky[0].popis;\n      }\n      return preview;\n    } catch { return {}; }\n  };\n\n  // Pokroil preview funkce pro detailn nhled ablony\n  const createDetailedTemplatePreview = (template, data) => {\n    try {\n      const preview = {\n        templateInfo: {\n          name: template.name || 'Bez nzvu',\n          type: template.type || 'mixed',\n          created: template.ts ? formatDateOnly(new Date(template.ts)) : 'Neznmo',\n          isGlobal: template.user_id === 0\n        },\n        poApproval: null,\n        orderDetails: null,\n        items: []\n      };\n\n      // PO Approval sekce\n      if (data?.poApproval) {\n        const po = data.poApproval;\n        preview.poApproval = {\n          predmet: po.predmet || '',\n          maxCena: po.max_cena_s_dph || '',\n          popisPozadavku: po.popis_pozadavku || '',\n          strediska: Array.isArray(po.strediska_kod) ? po.strediska_kod : [],\n          objednatel: po.objednatel_id || '',\n          garant: po.garant_uzivatel_id || '',\n          prikazce: po.prikazce_id || ''\n        };\n      }\n\n      // Order Details sekce\n      if (data?.orderDetails) {\n        const od = data.orderDetails;\n        preview.orderDetails = {\n          dodavatelNazev: od.dodavatel_nazev || '',\n          dodavatelAdresa: od.dodavatel_adresa || '',\n          dodavatelIco: od.dodavatel_ico || '',\n          dodavatelDic: od.dodavatel_dic || '',\n          zpusobFinancovani: od.zpusob_financovani || '',\n          lpKod: od.lp_kod || '',\n          druhObjednavky: od.druh_objednavky_kod || '',\n          poznamka: od.poznamka || '',\n          datumDodani: od.datum_dodani || '',\n          fakturovatNa: od.fakturovat_na || '',\n          dodaciAdresa: od.dodaci_adresa || ''\n        };\n      }\n\n      // Poloky\n      if (Array.isArray(data?.polozky)) {\n        preview.items = data.polozky.map((item, index) => ({\n          index: index + 1,\n          popis: item.popis || '',\n          pocet: item.pocet || 1,\n          jednotka: item.jednotka || '',\n          cenaJednotka: item.cena_jednotka || 0,\n          cenaTotal: (item.pocet || 1) * (item.cena_jednotka || 0)\n        }));\n      }\n\n      return preview;\n    } catch (error) {\n      return null;\n    }\n  };\n\n  // Funkce pro oteven preview modalu\n  const showTemplatePreview = (template, data) => {\n    const previewData = createDetailedTemplatePreview(template, data);\n    if (previewData) {\n      setPreviewModalData({ template, data, preview: previewData });\n    }\n  };\n\n  // Extrakce poloek ze ablony pro nhled\n  const extractTemplateItems = (entry) => {\n    try {\n      const data = entry?.data;\n      if (Array.isArray(data?.polozky)) return data.polozky;\n      return [];\n    } catch { return []; }\n  };\n\n  // Logovn akc se ablonami\n  const logTemplateAction = (action, details) => {\n    try {\n      const logEntry = {\n        ts: Date.now(),\n        action,\n        details: details || {},\n        user: username || 'unknown'\n      };\n      setTemplateActionsLog(prev => [logEntry, ...prev.slice(0, 49)]);\n    } catch {}\n  };\n\n  const handleInputChange = useCallback((field, value) => {\n    //  DEBUG: Loguj zmny critickch pol\n    if (field === 'druh_objednavky_kod') {\n      // DEBUG: Order type change - logging removed\n    }\n\n    //  Prvn zmna v nov objednvce?\n    const isFirstChangeInNewOrder = !isChanged && !isOrderSavedToDB;\n\n    // NASTAVIT isChanged = true pi kad zmn\n    setIsChanged(true);\n\n    //  AUTOMATICK AUTOSAVE - aktivovat isDraftLoaded pi prvn zmn\n    if (!isDraftLoaded) {\n      setIsDraftLoaded(true);\n    }\n\n    //  OKAMIT AUTOSAVE pi prvn zmn v nov objednvce\n    if (isFirstChangeInNewOrder) {\n      // Okamit uloit koncept bez debounce\n      triggerAutosave(true); // force immediate save\n    } else {\n      //  SPUSTIT AUTOSAVE s debounce (3 sekundy po posledn zmn)\n      triggerAutosave();\n    }\n\n    // Validace pro povinn pole v relnm ase\n    const criticalFields = [\n      'garant_uzivatel_id',\n      'prikazce_id',\n      'strediska_kod',\n      'predmet',\n      'max_cena_s_dph',\n      'lp_kod',  //  LP kdy jsou tak povinn v nkterch fzch\n      'zpusob_financovani',  //  Zpsob financovn je povinn\n      'druh_objednavky_kod'  //  Druh objednvky je povinn\n    ];\n    if (criticalFields.includes(field)) {\n      // Pro stediska a LP kdy kontroluj dlku pole\n      const valueToValidate = (field === 'strediska_kod' || field === 'lp_kod') ? value : value;\n      validateField(field, valueToValidate);\n    }\n\n    setFormData(prev => {\n      let processedValue = value;\n\n      // Stediska se ukldaj jako pole kd ve frontend, transformace a pi ukldn do DB\n\n      const newData = {\n        ...prev,\n        [field]: processedValue\n      };\n\n      //  Pi zmn zpsobu financovn VYISTIT vechny dynamick hodnoty z pedchozho typu\n      //  KRITICK: Mus se vyistit VE, aby se do DB i LS uloila jen data pro nov typ\n      if (field === 'zpusob_financovani') {\n        // Vyistit VECHNY dynamick fieldy z vech typ financovn\n        newData.lp_kod = [];\n        newData.cislo_smlouvy = '';\n        newData.smlouva_poznamka = '';\n        newData.individualni_schvaleni = '';\n        newData.individualni_poznamka = '';\n        newData.pojistna_udalost_cislo = '';\n        newData.pojistna_udalost_poznamka = '';\n        // Pokladna nem dn extra fieldy\n      }\n\n      // Financovn se ukld jako kd ve frontend, transformace a pi ukldn do DB\n\n      // Funkce pro pevod na MySQL datetime formt\n      const toMySQLDateTime = () => {\n        const now = new Date();\n        const year = now.getFullYear();\n        const month = String(now.getMonth() + 1).padStart(2, '0');\n        const day = String(now.getDate()).padStart(2, '0');\n        const hours = String(now.getHours()).padStart(2, '0');\n        const minutes = String(now.getMinutes()).padStart(2, '0');\n        const seconds = String(now.getSeconds()).padStart(2, '0');\n        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n      };\n\n      // Funkce pro aktuln datum ve formtu YYYY-MM-DD\n      const getCurrentDate = () => {\n        const now = new Date();\n        const year = now.getFullYear();\n        const month = String(now.getMonth() + 1).padStart(2, '0');\n        const day = String(now.getDate()).padStart(2, '0');\n        return `${year}-${month}-${day}`;\n      };\n\n      // Pokud se mn stav schvlen, nastav pslun daje\n      //  DLEIT: stav_workflow_kod se NIKDY NEMN zde - jen pi ukldn do DB!\n      if (field === 'stav_schvaleni') {\n\n        if (value === 'schvaleno' && user_id) {\n          //  DLEIT: schvalovatel_id a dt_schvaleni nastavit POUZE pokud jet neexistuj\n          if (!prev.schvalovatel_id) {\n            newData.schvalovatel_id = user_id;\n            newData.dt_schvaleni = toMySQLDateTime();\n          } else {\n            // U existuje - ZACHOVAT pvodn hodnoty\n            newData.schvalovatel_id = prev.schvalovatel_id;\n            newData.dt_schvaleni = prev.dt_schvaleni;\n          }\n          //  Pi schvlen VYMAZAT koment (schvlen nepotebuje zdvodnn)\n          newData.schvaleni_komentar = '';\n          // stav_workflow_kod se zmn a pi uloen v backendu\n        }\n        else if (value === 'neschvaleno') {\n          //  DLEIT: schvalovatel_id a dt_schvaleni nastavit POUZE pokud jet neexistuj\n          if (!prev.schvalovatel_id) {\n            newData.schvalovatel_id = user_id;\n            newData.dt_schvaleni = toMySQLDateTime();\n          } else {\n            // U existuje - ZACHOVAT pvodn hodnoty\n            newData.schvalovatel_id = prev.schvalovatel_id;\n            newData.dt_schvaleni = prev.dt_schvaleni;\n          }\n          // Koment ZSTV (dvod zamtnut je povinn)\n          // stav_workflow_kod se zmn a pi uloen v backendu\n        }\n        else if (value === 'ceka_se') {\n          //  DLEIT: schvalovatel_id a dt_schvaleni nastavit POUZE pokud jet neexistuj\n          if (!prev.schvalovatel_id) {\n            newData.schvalovatel_id = user_id;\n            newData.dt_schvaleni = toMySQLDateTime();\n          } else {\n            // U existuje - ZACHOVAT pvodn hodnoty\n            newData.schvalovatel_id = prev.schvalovatel_id;\n            newData.dt_schvaleni = prev.dt_schvaleni;\n          }\n          // Koment ZSTV (dvod vrcen je povinn)\n          // stav_workflow_kod se zmn a pi uloen v backendu\n        }\n        else if (value === '') {\n          // Reset pi zruen vbru - dn radio nen zakrtnut\n          newData.schvalovatel_id = '';\n          newData.dt_schvaleni = '';\n          //  NESMME mnit stav_workflow_kod! Ten se mn jen v DB pi uloen!\n          // Viditelnost bloku schvlen zvis POUZE na stavu z DB, ne na checkboxu!\n        }\n      }\n\n      // Pokud se mn stav odesln, automaticky nastav datum\n      if (field === 'stav_odeslano') {\n        if (value === true && !prev.datum_odeslani) {\n          // Pi zakrtnut \"Odeslno\" automaticky vypl aktuln datum, pokud nen vyplnno\n          newData.datum_odeslani = getCurrentDate();\n\n          //  WORKFLOW se NEMN pi zakrtnut checkboxu!\n          // Zmn se a pi ULOEN formule (handleSave)\n          addDebugLog('info', 'WORKFLOW', 'odeslano-checked', `Checkbox Odeslno zakrtnut - workflow se zmn a pi uloen`);\n\n        } else if (value === false) {\n          // Pi zruen zakrtnut vyma datum odesln\n          newData.datum_odeslani = '';\n\n          //  WORKFLOW se NEMN pi zruen zakrtnut!\n          // Zmn se a pi ULOEN formule (handleSave)\n          addDebugLog('info', 'WORKFLOW', 'odeslano-unchecked', `Checkbox Odeslno odkrtnut - workflow se zmn a pi uloen`);\n\n          // KRITICK KONTROLA: NIKDY nevolat clearPhase2UnlockState pokud je objednvka ODESLAN/ZRUEN\n          const currentWorkflowState = prev.stav_workflow_kod || 'NOVA';\n          const hasOdeslano = hasWorkflowState(currentWorkflowState, 'ODESLANA');\n          const hasZruseno = hasWorkflowState(currentWorkflowState, 'ZRUSENA');\n\n          // Pokud je objednvka ODESLAN/ZRUEN - NIKDY NEISTIT zamen\n          if (hasOdeslano || hasZruseno || prev.stav_stornovano) {\n            addDebugLog('warning', 'PHASE2-UNLOCK', 'clear-blocked-final', `BLOKACE clearPhase2UnlockState - objednvka je ODESLAN/ZRUEN (workflow=${currentWorkflowState})`);\n          } else {\n            // Pouze pro objednvky kter NEJSOU odeslan/zruen\n            addDebugLog('info', 'PHASE2-UNLOCK', 'clear-allowed', `itn Phase 2 unlock povoleno - objednvka nen v zamenm stavu`);\n            clearPhase2UnlockState();\n          }\n        }\n      }\n\n      // Pokud se mn stav stornovn, automaticky nastav datum\n      if (field === 'stav_stornovano') {\n        if (value === true && !prev.datum_storna) {\n          // Pi zakrtnut \"Stornovno\" automaticky vypl aktuln datum, pokud nen vyplnno\n          newData.datum_storna = getCurrentDate();\n\n          // Pidat ID pihlenho uivatele do storno dat (pro DB)\n          if (user_id && !prev.storno_uzivatel_id) {\n            newData.storno_uzivatel_id = user_id;\n          }\n\n          // Pidat jmno pihlenho uivatele do storno dat (pro zobrazen)\n          if (userDetail && !prev.storno_provedl) {\n            const jmeno = `${userDetail.titul_pred ? userDetail.titul_pred + ' ' : ''}${userDetail.jmeno || ''} ${userDetail.prijmeni || ''}${userDetail.titul_za ? ', ' + userDetail.titul_za : ''}`.replace(/\\s+/g, ' ').trim();\n            newData.storno_provedl = jmeno;\n          }\n        } else if (value === false) {\n          // Pi zruen zakrtnut vyma datum storna a souvisejc data\n          newData.datum_storna = '';\n          newData.storno_uzivatel_id = '';\n          newData.storno_provedl = '';\n          newData.odeslani_storno_duvod = '';\n\n          // KRITICK KONTROLA: NIKDY nevolat clearPhase2UnlockState pokud je objednvka ODESLAN/ZRUEN\n          const currentWorkflowState = prev.stav_workflow_kod || 'NOVA';\n          const hasOdeslano = hasWorkflowState(currentWorkflowState, 'ODESLANA');\n          const hasZruseno = hasWorkflowState(currentWorkflowState, 'ZRUSENA');\n\n          // Pokud je objednvka ODESLAN/ZRUEN - NIKDY NEISTIT zamen\n          if (hasOdeslano || hasZruseno) {\n            addDebugLog('warning', 'PHASE2-UNLOCK', 'clear-blocked-storno-final', `BLOKACE clearPhase2UnlockState pi storno zmn - objednvka je ODESLAN/ZRUEN (workflow=${currentWorkflowState})`);\n          } else {\n            // Pouze pro objednvky kter NEJSOU odeslan/zruen\n            addDebugLog('info', 'PHASE2-UNLOCK', 'clear-allowed-storno', `itn Phase 2 unlock po storno zmn povoleno - objednvka nen v zamenm stavu`);\n            clearPhase2UnlockState();\n          }\n        }\n      }\n\n      //  FZE 7: Checkbox vcn sprvnosti\n      // DLEIT: Nastavit ID a timestamp IHNED po zakrtnut, aby byly dostupn pro autosave!\n      if (field === 'potvrzeni_vecne_spravnosti') {\n        if (value === 1 || value === true) {\n          // Pi zakrtnut checkboxu VDY nastav potvrzujcho uivatele a as\n          if (user_id && !prev.potvrdil_vecnou_spravnost_id) {\n            //  OPRAVA: Pout lokln as msto UTC (.toISOString())\n            const now = new Date();\n            const year = now.getFullYear();\n            const month = String(now.getMonth() + 1).padStart(2, '0');\n            const day = String(now.getDate()).padStart(2, '0');\n            const hours = String(now.getHours()).padStart(2, '0');\n            const minutes = String(now.getMinutes()).padStart(2, '0');\n            const seconds = String(now.getSeconds()).padStart(2, '0');\n            const localTimestamp = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n            \n            // Nastavit ID a timestamp pouze pi prvnm zakrtnut (pokud jet nejsou)\n            newData.potvrdil_vecnou_spravnost_id = user_id;\n            newData.dt_potvrzeni_vecne_spravnosti = localTimestamp;\n            addDebugLog('info', 'VECNA-SPRAVNOST', 'checkbox-set', `Automaticky nastaveno: potvrdil_vecnou_spravnost_id=${user_id}, dt=${newData.dt_potvrzeni_vecne_spravnosti}, checkbox_value=${value}`);\n          } else if (!user_id) {\n            addDebugLog('error', 'VECNA-SPRAVNOST', 'no-user-id', 'user_id nen definovno - nemu nastavit potvrdil_vecnou_spravnost_id');\n          } else {\n            addDebugLog('info', 'VECNA-SPRAVNOST', 'checkbox-already-set', `ID u je nastaveno: ${prev.potvrdil_vecnou_spravnost_id}`);\n          }\n        } else if (value === 0 || value === false) {\n          // Pi odkrtnut checkboxu NEMAZAT ID a as - nech zstanou pro historii\n          addDebugLog('info', 'VECNA-SPRAVNOST', 'checkbox-unset', 'Checkbox odkrtnut - ID a datum zstvaj zachovny');\n        }\n      }\n\n      //  FZE 8: Pokud se mn checkbox dokonen objednvky, automaticky nastav ID a timestamp\n      if (field === 'potvrzeni_dokonceni_objednavky') {\n        if (value === 1 || value === true) {\n          //  OPRAVA: Pout lokln as msto UTC (.toISOString())\n          if (user_id) {\n            const now = new Date();\n            const year = now.getFullYear();\n            const month = String(now.getMonth() + 1).padStart(2, '0');\n            const day = String(now.getDate()).padStart(2, '0');\n            const hours = String(now.getHours()).padStart(2, '0');\n            const minutes = String(now.getMinutes()).padStart(2, '0');\n            const seconds = String(now.getSeconds()).padStart(2, '0');\n            const localTimestamp = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n            \n            newData.dokoncil_id = user_id;\n            newData.dt_dokonceni = localTimestamp;\n          } else {\n            addDebugLog('error', 'DOKONCENI', 'no-user-id', 'user_id nen definovno');\n          }\n        } else if (value === 0 || value === false) {\n          // Pi odkrtnut checkboxu vyma ID a as\n          newData.dokoncil_id = null;\n          newData.dt_dokonceni = null;\n        }\n      }\n\n      return newData;\n    });\n\n    //  NOV AUTOSAVE SYSTM:\n    // Pro SELECT/CHECKBOX pole - spus autosave OKAMIT (s debouncem proti opakovanmu voln)\n    // Pro textov pole - autosave se spust pi onBlur v handleFieldBlur\n    // POZNMKA: potvrzeni_vecne_spravnosti a textov pole vcn sprvnosti se NEUKLDAJ automaticky\n    // - uivatel mus kliknout na Save button, aby se uloily sprvn vetn vech dat\n    // POZNMKA 2: potvrzeni_dokonceni_objednavky a dokonceni_poznamka se TAK NEUKLDAJ automaticky\n    // - stejn logika jako Fze 7 - uloen a pi Save button\n    const selectFields = [\n      'garant_uzivatel_id',\n      'prikazce_id',\n      'strediska_kod',\n      'zpusob_financovani',\n      'lp_kod',\n      'druh_objednavky_kod',\n      'stav_schvaleni',\n      'stav_odeslano',\n      'stav_stornovano',\n      // 'potvrzeni_vecne_spravnosti',         //  FZE 7: VYPNUTO - uloen a pi Save button\n      // 'potvrzeni_dokonceni_objednavky'      //  FZE 8: VYPNUTO - uloen a pi Save button (stejn jako Fze 7)\n    ];\n\n    if (selectFields.includes(field)) {\n      // SELECT/CHECKBOX - autosave okamit (s min. intervalem 1s)\n      if (!disableAutosaveRef.current && draftManager.isAutosaveEnabled() && !isSaving && !showSaveProgress && isDraftLoaded) {\n        triggerAutosave(true); // true = immediate (s min intervalem)\n      }\n    }\n    // Pro textov pole se autosave spust v handleFieldBlur (s debouncem 3s)\n  }, [validationErrors, formData, user_id, disableAutosaveRef, draftManager, isSaving, showSaveProgress, isDraftLoaded, triggerAutosave, setIsDraftLoaded]);\n\n  // Speciln handler pro radio buttony - umouje zruit vbr opakovanm kliknutm\n  const handleRadioClick = useCallback((value) => {\n    if (formData.stav_schvaleni === value) {\n      // Opakovan kliknut na stejn radio - zru vbr\n      handleInputChange('stav_schvaleni', '');\n      // Vynuluj i koment pi zruen vbru\n      handleInputChange('schvaleni_komentar', '');\n      // Vynuluj i schvalovatele pi zruen\n      handleInputChange('schvalovatel_id', '');\n    } else {\n      // Normln vbr\n      handleInputChange('stav_schvaleni', value);\n\n      //  AUTOMATICKY nastavit schvalovatele na aktuln pihlenho uivatele\n      // kdy vybere \"Schvleno\", \"Neschvleno\" nebo \"ek se\"\n      if (user_id && (value === 'schvaleno' || value === 'neschvaleno' || value === 'ceka_se')) {\n        handleInputChange('schvalovatel_id', user_id);\n      }\n    }\n\n    //  Radio button - autosave okamit\n    if (!disableAutosaveRef.current && draftManager.isAutosaveEnabled() && !isSaving && !showSaveProgress && isDraftLoaded) {\n      triggerAutosave(true); // true = immediate\n    }\n  }, [formData.stav_schvaleni, user_id, disableAutosaveRef, draftManager, isSaving, showSaveProgress, isDraftLoaded]);\n\n  // Handler pro uloen aktulnho formule jako ablonu\n  const handleSaveAsTemplate = useCallback(() => {\n    setShowTemplateSaveModal(true);\n    setSaveMode('new');\n    setSelectedTargetTemplate(null);\n    setTemplateName('');\n    setTemplateType('po');\n  }, []);\n\n  // Handler pro toggle sbalen/rozbalen sekc\n  const handleToggleSections = useCallback(() => {\n    if (areSectionsCollapsed) {\n      //  EXPAND ALL - Rozbalit vechny sekce\n      setSectionStates(prev => {\n        const newStates = { ...prev };\n        Object.keys(newStates).forEach(key => {\n          newStates[key] = false; // false = expanded\n        });\n        return newStates;\n      });\n      setAreSectionsCollapsed(false);\n    } else {\n      //  COLLAPSE ALL - Sbalit POUZE zamen sekce\n      setSectionStates(prev => {\n        const newStates = { ...prev };\n\n        //  NOV: Pout allSectionStates pmo - obsahuje u unlock states z workflowManager\n        const lockedSections = [];\n        Object.keys(newStates).forEach(sectionKey => {\n          //  VJIMKA: Sekci \"registr_smluv\" NIKDY nesbalovat automaticky\n          // Dvod: I kdy je zamen (read-only), mus zstat viditeln pro bnho uivatele,\n          // aby mohl vidt a ppadn potvrdit checkbox \"M bt zveejnna v registru\"\n          if (sectionKey === 'registr_smluv') {\n            return; // Pesko tuto sekci - zstane v aktulnm stavu\n          }\n\n          //  Pout allSectionStates - workflowManager u zahrnuje unlock states\n          const sectionState = allSectionStates[sectionKey];\n          const isLocked = sectionState && !sectionState.enabled;\n\n          if (isLocked) {\n            newStates[sectionKey] = true; // true = collapsed (sbalit zamen)\n            lockedSections.push(sectionKey);\n          }\n        });\n\n        //  [SECTION LOCK] Logovn zamench sekc\n        if (lockedSections.length > 0) {\n        }\n\n        return newStates;\n      });\n      setAreSectionsCollapsed(true);\n    }\n  }, [\n    areSectionsCollapsed,\n    allSectionStates, //  NOV: jedin zvislost - obsahuje vechny section states vetn unlock\n    workflowManager\n  ]);\n\n  //  SCROLL K SEKCI - umouje scrollovn i k zamenm sekcm pro ten dat\n  const scrollToSection = useCallback((sectionKey, behavior = 'smooth') => {\n    //  Scrollovn funguje i pro zamen sekce - uivatel me st ji vyplnn data\n\n    // Najdi element sekce pomoc data-section atributu\n    const scrollContainer = scrollableContentRef.current;\n    if (!scrollContainer) {\n      return false;\n    }\n\n    const sectionElement = scrollContainer.querySelector(`[data-section=\"${sectionKey}\"]`);\n    if (!sectionElement) {\n      return false;\n    }\n\n    //  SPRVN EEN: Scroll na lut roh + vka titulku\n    try {\n      // CLOVKA: Zobrazit lut roh sekce + titulek nad nm\n      // Struktura sekce:\n      // - FormSection (obsahuje data-section atribut) <- sectionElement\n      //   - SectionHeader (lut pozad s titulkem) <- tohle chceme vidt cel\n      //   - SectionBody (obsah)\n      //\n      // scrollIntoView() na FormSection by zobrazil jen zatek FormSection\n      // Potebujeme scrollovat o vku SectionHeader v\n\n      // Najdi SectionHeader uvnit sekce\n      const sectionHeader = sectionElement.querySelector('[class*=\"SectionHeader\"]') ||\n                           sectionElement.querySelector('div:first-child');\n\n      const targetElement = sectionHeader || sectionElement;\n\n      // Vypotej pozici elementu relativn k scroll containeru\n      const elementTop = targetElement.offsetTop;\n\n      //  Dynamick offset: peti CSS variable --fixed-header-height (vka headeru + 20px gap)\n      const fixedHeaderHeight = parseInt(\n        getComputedStyle(document.documentElement).getPropertyValue('--fixed-header-height') || '200'\n      );\n\n      // Odeti dynamickou vku headeru pro sprvn zobrazen pod FixedHeader\n      const targetScrollTop = elementTop - fixedHeaderHeight;\n\n      // Smooth scroll\n      if (behavior === 'smooth') {\n        scrollContainer.scrollTo({\n          top: targetScrollTop,\n          behavior: 'smooth'\n        });\n      } else {\n        scrollContainer.scrollTop = targetScrollTop;\n      }\n\n      return true;\n    } catch (error) {\n      return false;\n    }\n  }, [\n    allSectionStates, //  NOV: jedin zvislost - obsahuje vechny section states vetn unlock\n    canEditApprovedSections,\n    workflowManager,\n    showToast\n  ]);\n\n  //  Handler pro kliknut na sekci v FloatingNavigator\n  const handleNavigatorSectionClick = useCallback((sectionId) => {\n    //  VCN SPRVNOST: Scrolluj na FAKTURACE (vcn sprvnost je per-invoice v rmci faktur)\n    const targetSection = sectionId === 'vecna_spravnost' ? 'fakturace' : sectionId;\n    scrollToSection(targetSection, 'smooth');\n  }, [scrollToSection]);\n\n  //  Handler pro drop soubor z FloatingNavigator\n  const handleNavigatorFilesDrop = useCallback((files) => {\n    if (files && files.length > 0) {\n      handleFileUpload(files);\n      showToast && showToast(` Nahrvm ${files.length} soubor()...`, { type: 'info' });\n    }\n  }, [handleFileUpload, showToast]);\n\n  const handleReloadFromDB = useCallback(async () => {\n    if (!formData.id) {\n      showToast && showToast('Nelze nast stav z databze - objednvka nen uloena', { type: 'error' });\n      return;\n    }\n\n    if (!userDetail?.id) {\n      showToast && showToast('Nelze nast stav z databze - nen pihlen uivatel', { type: 'error' });\n      return;\n    }\n\n    try {\n      addDebugLog('info', 'STATUS-RELOAD', 'start', `Natm aktuln stav objednvky ID: ${formData.id}, uivatel: ${userDetail.id}`);\n\n      //  V2 API: GET order by ID (enriched=false pro rychlej reload)\n      const orderData = await getOrderV2(parseInt(formData.id), token, username, false);\n\n      if (!orderData || !orderData.id) {\n        throw new Error('Nepodailo se nast stav objednvky z databze');\n      }\n\n      addDebugLog('success', 'STATUS-RELOAD', 'loaded', `Naten aktuln stav: stav_objednavky=\"${orderData.stav_objednavky}\", stav_workflow_kod=\"${orderData.stav_workflow_kod}\"`);\n\n      // Aktualizuj POUZE workflow stavy v formData\n      setFormData(prev => ({\n        ...prev,\n        stav_workflow_kod: orderData.stav_workflow_kod,\n        stav_objednavky: orderData.stav_objednavky\n      }));\n\n      // Uloit aktualizovan stav do konceptu\n      const updatedFormData = {\n        ...formData,\n        stav_workflow_kod: orderData.stav_workflow_kod,\n        stav_objednavky: orderData.stav_objednavky\n      };\n\n      saveDraft(updatedFormData, {\n        isOrderSavedToDB: true,\n        savedOrderId: formData.id,\n        isChanged: isChanged\n      });\n\n      // Toast odstrann - zbyten um, stav se aktualizuje automaticky\n\n      addDebugLog('success', 'STATUS-RELOAD', 'complete', 'Stav aktualizovn a uloen do konceptu');\n\n    } catch (error) {\n      addDebugLog('error', 'STATUS-RELOAD', 'failed', error.message);\n      showToast && showToast(`Chyba pi natn stavu z databze: ${error.message}`, { type: 'error' });\n    }\n  }, [formData, userDetail, token, username, showToast, isChanged]);\n\n  //  Helper pro kontrolu, zda je mon generovat DOCX\n  const canGenerateDocx = useCallback(() => {\n    // Kontrola: objednvka mus bt uloena v DB\n    if (!formData.id) {\n      return false;\n    }\n\n    // Kontrola: minimln fze 3 (schvlen + rozpracovan nebo vy)\n    if (currentPhase < 3) {\n      return false;\n    }\n\n    // Kontrola: stav workflow mus bt alespo \"ROZPRACOVANA\" nebo vy\n    // Pouij workflowManager.hasWorkflowState() pro sprvnou kontrolu\n    const hasRozpracovana = hasWorkflowState(formData.stav_workflow_kod, 'ROZPRACOVANA');\n    const hasOdeslana = hasWorkflowState(formData.stav_workflow_kod, 'ODESLANA');\n    const hasPotvrzena = hasWorkflowState(formData.stav_workflow_kod, 'POTVRZENA');\n    const hasSchvalena = hasWorkflowState(formData.stav_workflow_kod, 'SCHVALENA');\n\n    // Mus mt SCHVALENA A (ROZPRACOVANA nebo vy stav)\n    if (!hasSchvalena) {\n      return false;\n    }\n\n    if (!hasRozpracovana && !hasOdeslana && !hasPotvrzena) {\n      return false;\n    }\n\n    return true;\n  }, [formData.id, formData.stav_workflow_kod, currentPhase, hasWorkflowState, mainWorkflowState]);\n\n  //  Handler pro generovn DOCX dokumentu\n  const handleGenerateDocx = useCallback(() => {\n    if (!canGenerateDocx()) {\n      // Zobraz specifickou chybu podle toho, co chyb\n      if (!formData.id) {\n        showToast && showToast('DOCX lze generovat pouze u uloench objednvek', { type: 'warning' });\n      } else if (currentPhase < 3) {\n        showToast && showToast('DOCX lze generovat a od fze \"Odesln objednvky\"', { type: 'warning' });\n      } else {\n        showToast && showToast('DOCX lze generovat a kdy je objednvka v procesu zpracovn', { type: 'warning' });\n      }\n      return;\n    }\n\n    try {\n      addDebugLog('info', 'DOCX-GENERATOR', 'open-dialog', `Otevrm DOCX genertor pro objednvku ID: ${formData.id}`);\n\n      // Vytvo order objekt kompatibiln s DocxGeneratorModal\n      const orderForDocx = {\n        objednavka_id: formData.id,\n        cislo_objednavky: formData.cislo_objednavky,\n        nazev_objednavky: formData.nazev_objednavky || formData.nazev,\n        ...formData\n      };\n\n      setDocxModalOrder(orderForDocx);\n      setDocxModalOpen(true);\n\n    } catch (error) {\n      addDebugLog('error', 'DOCX-GENERATOR', 'error', error.message);\n      showToast && showToast(`Chyba pi otevrn DOCX genertoru: ${error.message}`, { type: 'error' });\n    }\n  }, [formData, currentPhase, showToast]);\n\n  const handleDocxModalClose = useCallback(() => {\n    setDocxModalOpen(false);\n    setDocxModalOrder(null);\n  }, []);\n\n  const handleCancelOrder = useCallback(async () => {\n    //  Pokud je objednvka v KONENM STAVU (DOKONENA/ZAMTNUTA/STORNOVNA), zavi rovnou bez dotazu\n    // (u je uloen v DB, nen co ztratit)\n    if (isWorkflowCompleted) {\n      try {\n        //  KRITICK: OKAMIT ZABLOKOVAT VECHNY SAVE OPERACE \n        \n        // 0. GLOBLN FLAG - zablokuje saveDraft na rovni funkce (prvn linie obrany)\n        isClosingRef.current = true;\n        \n        // 1. Zablokovat autosave v DraftManager\n        draftManager.setAutosaveEnabled(false, 'Closing completed/rejected/cancelled order');\n        \n        // 2. Zablokovat autosave pes ref (okamit kontrola)\n        disableAutosaveRef.current = true;\n        \n        // 3. Zablokovat autosave pes state (pro useEffect)\n        setDisableAutosave(true);\n        \n        // 4. Zruit useAutosave hook timer\n        if (cancelAutosave) {\n          cancelAutosave();\n        }\n        \n        // 5. Zruit vechny setTimeout pro autosave\n        if (autoSaveTimerRef.current) {\n          clearTimeout(autoSaveTimerRef.current);\n          autoSaveTimerRef.current = null;\n        }\n\n        // Vyistit draft data\n        if (user_id) {\n          draftManager.setCurrentUser(user_id);\n          await draftManager.deleteAllDraftKeys();\n          \n          //  EXPLICITN vymazat metadata (isEditMode) - dleit pro MenuBar\n          try {\n            localStorage.removeItem(`order_form_isEditMode_${user_id}`);\n            localStorage.removeItem(`openOrderInConcept-${user_id}`);\n            localStorage.removeItem(`order_form_savedOrderId_${user_id}`);\n            localStorage.removeItem(`savedOrderId-${user_id}`);\n          } catch (e) {\n            // ignoruj chybu\n          }\n        }\n        \n        // NOTE: formData.id and sourceOrderIdForUnlock removed - using formData.id\n\n        // Odemkni objednvku (pokud je editace) - pouij editOrderId nebo formData.id\n        //  FIX: editOrderId je stabilnj ne formData.id (me bt undefined po smazn draftu)\n        const unlockOrderId = editOrderId || formData.id;\n        if (unlockOrderId && token && username) {\n          try {\n            await unlockOrderV2({ token, username, orderId: unlockOrderId });\n            //  KRITICK: Zabrnit duplicitnmu unlock z useEffect cleanup (ji neexistuje)\n          } catch (error) {\n            // Ignoruj chybu odemykn\n          }\n        }\n\n        // Reset MenuBaru\n        try {\n          //  KRITICK: Nastavit isEditMode state na false PED broadcastem\n          setIsEditMode(false);\n          \n          broadcastDraftDeleted(user_id);\n          broadcastOrderState({\n            isEditMode: false,\n            isNewOrder: false,\n            orderId: null,\n            orderNumber: ''\n          });\n          \n          //  KRITICK: Pokat 50ms, aby se broadcast stihl propagovat\n          await new Promise(resolve => setTimeout(resolve, 50));\n        } catch (e) {\n          // Ignoruj chybu broadcastu\n        }\n\n        // Pesmruj na seznam s force reload z DB\n        navigate('/orders25-list', { state: { forceReload: true } });\n      } catch (error) {\n        showToast && showToast(`Chyba pi zavrn: ${error.message}`, { type: 'error' });\n      }\n      return;\n    }\n\n    // Zkontroluj neuloen a neklasifikovan plohy\n    const unsavedAttachments = attachments.filter(att =>\n      !att.serverId && att.status !== 'uploaded' && !att.fromServer && att.file\n    );\n    const unclassifiedAttachments = attachments.filter(att =>\n      !att.klasifikace || att.klasifikace.trim() === ''\n    );\n\n    let warningMessage = 'Koncept bude zruen a neuloen zmny nebudou uloeny.';\n\n    if (unsavedAttachments.length > 0 || unclassifiedAttachments.length > 0) {\n      warningMessage += `\\n\\n Informace o plohch:\\n ${unsavedAttachments.length} neuloench ploh\\n ${unclassifiedAttachments.length} neklasifikovanch ploh`;\n    }\n\n    // Zobraz confirm modal msto toast\n    setCancelWarningMessage(warningMessage);\n    setShowCancelConfirmModal(true);\n  }, [attachments, isWorkflowCompleted, user_id, formData.id, token, username, showToast, navigate]);\n\n  const handleCancelConfirm = useCallback(async () => {\n    //  ZJEDNODUEN ZAVEN pes DraftManager\n    addDebugLog('info', 'CANCEL', 'draftmanager-close', 'Zavrm formul pes DraftManager');\n\n    try {\n      //  KRITICK: OKAMIT ZABLOKOVAT VECHNY SAVE OPERACE \n      \n      // 0. GLOBLN FLAG - zablokuje saveDraft na rovni funkce (prvn linie obrany)\n      isClosingRef.current = true;\n      \n      // 1. Zablokovat autosave v DraftManager\n      draftManager.setAutosaveEnabled(false, 'Form closing - prevent save during cleanup');\n      \n      // 2. Zablokovat autosave pes ref (okamit kontrola)\n      disableAutosaveRef.current = true;\n      \n      // 3. Zablokovat autosave pes state (pro useEffect)\n      setDisableAutosave(true);\n      \n      // 4. Zruit useAutosave hook timer\n      if (cancelAutosave) {\n        cancelAutosave();\n      }\n      \n      // 5. Zruit vechny setTimeout pro autosave\n      if (autoSaveTimerRef.current) {\n        clearTimeout(autoSaveTimerRef.current);\n        autoSaveTimerRef.current = null;\n      }\n\n      //  OKAMIT resetovat vechny saving stavy\n      setIsSaving(false);\n      setShowSaveProgress(false);\n      setSaveProgressText('');\n      setSaveProgress(0);\n      setIsConceptSaved(false);\n\n      //  Zruit aktivn progress (pokud b)\n      if (window._activeProgressControl) {\n        window._activeProgressControl.cancel();\n        window._activeProgressControl = null;\n      }\n\n      // NOTE: unlockOrderIdRef removed\n      // NOTE: formData.id and sourceOrderIdForUnlock removed - using formData.id\n\n      //  1. Vyistit VECHNY draft data pes DraftManager (centralizovan)\n      if (user_id) {\n        draftManager.setCurrentUser(user_id);\n        const deleted = await draftManager.deleteAllDraftKeys();\n\n        if (deleted) {\n          addDebugLog('success', 'CANCEL', 'draftmanager-cleanup', 'Vechny draft kle smazny pes DraftManager');\n        } else {\n        }\n\n        //  VERIFIKACE: Zkontroluj e draft opravdu neexistuje\n        const stillHasDraft = await draftManager.hasDraft();\n        if (stillHasDraft) {\n          // Zkus znovu smazat\n          await draftManager.deleteAllDraftKeys();\n        } else {\n        }\n        \n        //  EXPLICITN vymazat metadata (isEditMode) - dleit pro MenuBar\n        try {\n          localStorage.removeItem(`order_form_isEditMode_${user_id}`);\n          localStorage.removeItem(`openOrderInConcept-${user_id}`);\n          localStorage.removeItem(`order_form_savedOrderId_${user_id}`);\n          localStorage.removeItem(`savedOrderId-${user_id}`);\n        } catch (e) {\n          // ignoruj chybu\n        }\n      }\n\n      // 2. Odemkni objednvku (pokud je editace) - graceful handling\n      //  FIX: Pout editOrderId msto formData.id (po smazn draftu me bt formData przdn)\n      const unlockOrderId = editOrderId || formData.id;\n      \n      if (unlockOrderId && token && username) {\n        try {\n          await unlockOrderV2({ token, username, orderId: unlockOrderId });\n          addDebugLog('success', 'CANCEL', 'unlock', `Objednvka ${unlockOrderId} byla odemknuta`);\n        } catch (error) {\n          addDebugLog('warning', 'CANCEL', 'unlock-error', `Chyba pi odemykn: ${error.message} - ignorovno`);\n          // Ignoruj chybu - formul se zave i kdy odemykn sele\n        }\n      }\n\n      // 3. Reset MenuBaru\n      try {\n        //  KRITICK: Nastavit isEditMode state na false PED broadcastem\n        setIsEditMode(false);\n        \n        broadcastDraftDeleted(user_id);\n\n        // Pokej krtce, aby se broadcast stihl zpracovat\n        await new Promise(resolve => setTimeout(resolve, 50));\n\n        broadcastOrderState({\n          isEditMode: false,\n          isNewOrder: false,\n          orderId: null,\n          orderNumber: ''\n        });\n\n        addDebugLog('success', 'CANCEL', 'broadcast', 'Broadcast stavu odesln (formul zaven)');\n      } catch (e) {\n        addDebugLog('warning', 'CANCEL', 'broadcast-error', `Chyba pi broadcastu: ${e.message}`);\n      }\n\n      // 4. Zavi modal\n      setShowCancelConfirmModal(false);\n      setCancelWarningMessage('');\n\n      addDebugLog('info', 'CANCEL', 'redirect', 'Pesmrovvm na seznam objednvek');\n\n      // 5. Pesmruj s dostatenm zpodnm, aby se stihly dokonit vechny async operace\n      setTimeout(() => {\n        navigate('/orders25-list', { state: { forceReload: true } });\n      }, 200);\n\n    } catch (error) {\n      addDebugLog('error', 'CANCEL', 'error', `Chyba pi zavrn: ${error.message}`);\n      showToast && showToast(`Chyba pi zavrn: ${error.message}`, { type: 'error' });\n\n      // I pi chyb resetuj stavy a pesmruj\n      setIsSaving(false);\n      setShowSaveProgress(false);\n      setShowCancelConfirmModal(false);\n      setCancelWarningMessage('');\n\n      // Pesmruj i pes chybu (lep ne zstat na formuli)\n      setTimeout(() => {\n        navigate('/orders25-list', { state: { forceReload: true } });\n      }, 100);\n    }\n  }, [user_id, draftManager, formData.id, token, username, showToast, navigate]);\n\n  const handleCancelCancel = useCallback(() => {\n    setShowCancelConfirmModal(false);\n    setCancelWarningMessage('');\n  }, []);\n\n  // Funkce pro odemykn FZE 1 sekc - IST FUNKCE BEZ TOAST\n  //  Handler pro odemen FZE 1 - nyn pouv workflowManager.unlockPhase2()\n  //  SJEDNOCENO s handleResetToPhase3Sections (unlock z PO sekce)\n  const handleResetToPhase1 = async () => {\n    //  Pouij centralizovanou logiku z WorkflowManager\n    const { updatedFormData, unlockState, newPhase } = workflowManager.unlockPhase2();\n\n    // Aktualizuj formData state okamit\n    setFormData(updatedFormData);\n\n    //  WorkflowManager se automaticky pepot dky zmn formData.stav_workflow_kod\n\n    // Okamit uloen do localStorage pes triggerAutosave\n    setTimeout(() => {\n      triggerAutosave(true);\n      addDebugLog('success', 'UNLOCK', unlockState, `FZE ${newPhase} odemena, workflow: ${updatedFormData.stav_workflow_kod}`);\n    }, 100);\n  };\n\n  const [pendingUnlock, setPendingUnlock] = useState(false);\n\n  // useEffect pro automatick uloen po odemen FZE 2\n  useEffect(() => {\n    //  GUARD: Nespoutt pokud u probh jin ukldn (nap. z saveOrderToAPI)\n    if (pendingUnlock && isPhase3SectionsUnlocked && !isSaving) {\n      const doSave = async () => {\n        try {\n          //  TICH ULOEN - bez progress baru a pesmrovn\n          setIsSaving(true);\n\n          // Piprav data pro UPDATE (stejn logika jako saveOrderToAPI)\n          const orderData = {};\n          if (formData.predmet) orderData.predmet = formData.predmet;\n          if (formData.garant_uzivatel_id) orderData.garant_uzivatel_id = formData.garant_uzivatel_id;\n\n          // Workflow stav (bez ODESLANA/ZRUSENA)\n          const existingStates = parseWorkflowStates(formData.stav_workflow_kod);\n          const cleanStates = existingStates.filter(s => s !== 'ODESLANA' && s !== 'ZRUSENA');\n          orderData.stav_workflow_kod = JSON.stringify(cleanStates);\n\n          // Storno checkboxy - false\n          orderData.stav_odeslano = false;\n          orderData.stav_stornovano = false;\n\n          // Zavolej API pmo (bez progress baru) - V2 API\n          //  prepareDataForAPI() se vol automaticky uvnit updateOrderV2() - NEMNIT ZNOVU!\n          // const preparedData = prepareDataForAPI(orderData);   DUPLICITN - ji se dl v updateOrderV2()\n          await updateOrderV2(formData.id, orderData, token, username);\n\n        } catch (error) {\n          showToast && showToast(`Chyba pi ukldn: ${error.message}`, { type: 'error' });\n        } finally {\n          setPendingUnlock(false);\n          setIsSaving(false);\n        }\n      };\n      doSave();\n    }\n  }, [pendingUnlock, isPhase3SectionsUnlocked, isSaving]); // Pidna zvislost isSaving\n\n  //  Univerzln helper pro reset vych fz pi odemen ni sekce\n  const resetHigherPhaseCheckboxes = (sectionName) => {\n    addDebugLog('info', 'UNLOCK', sectionName, 'Odemen ni sekce  automaticky rum checkboxy vych fz');\n\n    // Zruit checkbox Vcn sprvnosti\n    handleInputChange('potvrzeni_vecne_spravnosti', 0);\n\n    // Zruit checkbox Dokonen objednvky\n    handleInputChange('potvrzeni_dokonceni_objednavky', 0);\n\n    // Force re-render pro aktualizaci viditelnosti sekc\n    workflowForceRefresh();\n\n    //  OKAMIT ULOEN: Trigger autosave pro aktualizaci stavu\n    setTimeout(() => triggerAutosave(true), 100);\n  };\n\n  //  Funkce pro odemykn FZE 2 sekc - DELEGOVNO na WorkflowManager\n  const handleResetToPhase3Sections = async () => {\n    //  PMO ODEMKNI - confirm dialog je vnj (showUnlockPhase2Confirm)\n    //  DELEGACE NA WORKFLOWMANAGER\n    const { updatedFormData, unlockState, newPhase } = workflowManager.unlockPhase2();\n\n    // Aktualizuj formData state okamit\n    setFormData(updatedFormData);\n\n    //  FZE 2 se odemyk zmnou workflow na ODESLANA_KE_SCHVALENI\n\n    //  WorkflowManager se automaticky pepot dky zmn formData.stav_workflow_kod\n\n    // Okamit uloen do localStorage pes triggerAutosave\n    setTimeout(() => {\n      triggerAutosave(true);\n      addDebugLog('success', 'UNLOCK', unlockState, `FZE ${newPhase} odemena, workflow: ${updatedFormData.stav_workflow_kod}`);\n    }, 100);\n  };\n\n  //  Handler pro odemknut FZE 3 (Dodavatel a Stav odesln) - DELEGOVNO na WorkflowManager\n  //  POZNMKA: Financovn je soust FZE 1-2, ne FZE 3!\n  const handleResetToPhase3Workflow = async () => {\n    //  DELEGACE NA WORKFLOWMANAGER\n    const { updatedFormData, unlockState, newPhase } = workflowManager.unlockPhase3();\n\n    //  KRITICK: Nastav unlock state pro FZI 3 PED zmnou formData!\n    setIsPhase3SectionsUnlocked(true);\n\n    // Aktualizuj formData state s malm zpodnm pro zajitn sprvnho poad\n    setTimeout(() => {\n      setFormData(updatedFormData);\n\n      // Reset vych checkbox\n      resetHigherPhaseCheckboxes('phase3');\n\n      // Okamit uloen do DB pes triggerAutosave\n      setTimeout(() => {\n        triggerAutosave(true);\n        addDebugLog('success', 'UNLOCK', unlockState, `FZE ${newPhase} odemena, workflow: ${updatedFormData.stav_workflow_kod}`);\n      }, 100);\n    }, 10);\n  };\n\n  //  Handler pro odemknut FZE 4 (Potvrzen dodavatele) - DELEGOVNO na WorkflowManager\n  const handleResetToPhase4Confirmation = async () => {\n    // Kontrola jestli je uivatel SUPER/ADMIN nebo m prva\n    if (!canUnlockAnything && currentPhase > 4) {\n      showToast && showToast('Bn uivatel me odemknout pouze posledn fzi!', { type: 'error' });\n      return;\n    }\n\n    //  Zobraz ConfirmDialog msto Toast\n    setConfirmDialog({\n      isOpen: true,\n      title: \"Odemknout sekci Potvrzen dodavatele\",\n      message: \" Odemen sekce umon editaci, ale objednvka je ji POTVRZENA!\\n\\nOpravdu chcete pokraovat?\",\n      onConfirm: async () => {\n        //  DELEGACE NA WORKFLOWMANAGER\n        const { updatedFormData, unlockState, newPhase } = workflowManager.unlockPhase4();\n\n        //  KRITICK: Nastav unlock state pro potvrzen PED zmnou formData!\n        workflowManager.unlockSection('potvrzeni');\n        workflowManager.unlockSection('registr');\n\n        // Aktualizuj formData state s malm zpodnm pro zajitn sprvnho poad\n        setTimeout(() => {\n          setFormData(updatedFormData);\n\n          //  Reset vych checkbox\n          resetHigherPhaseCheckboxes('phase4');\n\n          // Okamit uloen do localStorage pes triggerAutosave\n          setTimeout(() => {\n            triggerAutosave(true);\n            addDebugLog('success', 'UNLOCK', unlockState, `FZE ${newPhase} odemena, workflow: ${updatedFormData.stav_workflow_kod}`);\n          }, 100);\n        }, 10);\n\n        // Zavi ConfirmDialog\n        setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null });\n      }\n    });\n  };\n\n  // Funkce pro validaci jednoho pole\n  const validateField = (fieldName, value) => {\n    // Pouij aktuln formData s novou hodnotou pro validaci\n    const tempFormData = { ...formData, [fieldName]: value };\n    // KRITICK: Validovat podle aktuln VIDITELN fze i pro jednotliv pole\n    const validationWorkflowCode = currentPhase === 1 ? 'NOVA' : mainWorkflowState;\n    const allErrors = validateWorkflowData(tempFormData, validationWorkflowCode);\n\n    // Aktualizuj pouze chybu pro toto pole\n    setValidationErrors(prev => {\n      const newErrors = { ...prev };\n      if (allErrors[fieldName]) {\n        newErrors[fieldName] = allErrors[fieldName];\n      } else {\n        delete newErrors[fieldName];\n      }\n      return newErrors;\n    });\n  };\n\n  // Funkce pro validace formule s novm workflow systmem\n  // VALIDACE SE SPOUT JEN PI POKUSU O ULOEN DO DATABZE\n  const validateFormForSave = () => {\n    //  SPECILN PRAVIDLA: Archivovan objednvky - BEZ VALIDACE\n    // Umonit partial update bez kontroly povinnch pol\n    if (isArchivedOrder) {\n      setValidationErrors({});\n      return true; //  Vdy platn\n    }\n\n    //  OPRAVA: Nastavit hasTriedToSubmit synchronn pomoc flushSync\n    // aby se erven ormovn zobrazilo IHNED pi prvnm pokusu\n    flushSync(() => {\n      setHasTriedToSubmit(true);\n    });\n\n    let errors = {};\n\n    // SPECILN LOGIKA: Pi stornovn validovat pouze storno pole\n    if (formData.stav_stornovano) {\n      // Pro stornovan objednvky validovat pouze dvod stornovn\n      if (!formData.odeslani_storno_duvod?.trim()) {\n        errors.odeslani_storno_duvod = 'Dvod stornovn je povinn';\n      }\n    } else {\n      // Normln validace pro nestornovan objednvky\n      // KRITICK: Validovat podle aktuln VIDITELN fze, ne podle stav_workflow_kod!\n      // Pokud jsme v FZI 1, validovat jen FZI 1, i kdy je zakrtnuto \"schvleno\"\n      const validationWorkflowCode = currentPhase === 1 ? 'NOVA' : mainWorkflowState;\n\n      //  Piprav informaci o viditelnosti a zamen sekc\n      const sectionStates = {\n        phase1: { visible: currentPhase >= 1, locked: shouldLockPhase1Sections },\n        phase2: { visible: currentPhase >= 2, locked: shouldLockPhase2Sections },\n        financovani: { visible: financovaniState.visible, locked: !financovaniState.enabled }, // Samostatn sekce pro financovn\n        phase3: { visible: currentPhase >= 3, locked: shouldLockPhase3Sections },\n        phase4to6: { visible: currentPhase >= 4, locked: shouldLockPhase4to6Sections },\n        registr_smluv_vyplneni: { visible: registrVyplneniState.visible, locked: isRegistrVyplneniLocked } // FZE 5: Zveejnn\n      };\n\n      //  FIX: Merge errors msto pepsn - jinak ztratme FZE 5 validaci!\n      const workflowErrors = validateWorkflowData(formData, validationWorkflowCode, sectionStates);\n      errors = { ...errors, ...workflowErrors };\n\n      //  VALIDACE DYNAMICKCH POL PODLE ZDROJE FINANCOVN\n      //  Kontrola povinnch dynamickch pol od FZE 1+ (pokud je financovn vyplnno)\n      //  Validovat POUZE pokud je sekce financovn viditeln A odemen\n      const shouldValidateFinancovani = sectionStates.financovani.visible && !sectionStates.financovani.locked;\n      if (currentPhase >= 1 && formData.zpusob_financovani && shouldValidateFinancovani) {\n        const selectedFinancovani = financovaniOptions.find(opt =>\n          opt.kod === formData.zpusob_financovani ||\n          opt.kod_stavu === formData.zpusob_financovani ||\n          opt.value === formData.zpusob_financovani\n        );\n\n        if (selectedFinancovani) {\n          const nazev = selectedFinancovani.nazev_stavu || selectedFinancovani.nazev || '';\n\n          // Limitovan pslib - LP kd je POVINN\n          if (nazev.includes('Limitovan') || nazev.includes('pslib')) {\n            if (!formData.lp_kod ||\n                (Array.isArray(formData.lp_kod) && formData.lp_kod.length === 0)) {\n              errors.lp_kod = \"LP kd je povinn pi financovn z Limitovanho pslibu\";\n            }\n            \n            //  VALIDACE LP U POLOEK: Pokud je financovn LP, vechny poloky MUS mt vyplnn LP\n            //  VALIDOVAT POUZE VE FZI 3+ (poloky jsou dostupn a od fze 3)\n            if (currentPhase >= 3 && formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n              formData.polozky_objednavky.forEach((polozka, index) => {\n                if (!polozka.polozka_lp_id && !polozka.lp_id) {\n                  errors[`polozka_${index}_lp`] = `Poloka ${index + 1}: LP je povinn pi financovn z Limitovanho pslibu`;\n                }\n              });\n            }\n          }\n\n          // Smlouva - slo smlouvy je POVINN a mus existovat v seznamu aktivnch smluv\n          if (nazev.includes('Smlouva')) {\n            if (!formData.cislo_smlouvy?.trim()) {\n              errors.cislo_smlouvy = 'slo smlouvy je povinn pi financovn ze Smlouvy';\n            } else {\n              //  PSN VALIDACE: Ovit, e slo smlouvy existuje v seznamu aktivnch smluv\n              const existujeSmlouva = smlouvyList.some(s => \n                (s.aktivni !== 0 && s.aktivni !== false) &&\n                (s.cislo_smlouvy === formData.cislo_smlouvy || s.evidencni_cislo === formData.cislo_smlouvy)\n              );\n              \n              if (!existujeSmlouva) {\n                errors.cislo_smlouvy = 'Zadan slo smlouvy neexistuje v seznamu aktivnch smluv. Vyberte prosm platnou smlouvu.';\n              }\n            }\n          }\n\n          // Individuln schvlen - Identifiktor je POVINN\n          if (nazev.includes('Individuln')) {\n            const individualniValue = typeof formData.individualni_schvaleni === 'string'\n              ? formData.individualni_schvaleni\n              : '';\n            if (!individualniValue.trim()) {\n              errors.individualni_schvaleni = 'Zadejte identifiktor - referenn slo nebo oznaen schvlen je povinn';\n            }\n          }\n\n          // Pojistn udlost - slo udlosti je POVINN\n          if (nazev.includes('Pojistn')) {\n            if (!formData.pojistna_udalost_cislo?.trim()) {\n              errors.pojistna_udalost_cislo = 'Zadejte slo pojistn udlosti - referenn slo kodn udlosti je povinn';\n            }\n          }\n        }\n      }\n\n      // SPECILN VALIDACE PRO FZI 4: Potvrzen dodavatele\n      //  VALIDOVAT POUZE VE FZI 4 (ODESLANA) - ve FZI 3 jet nemus bt vyplnno\n      if (currentPhase === 4 && formData.dodavatel_zpusob_potvrzeni?.potvrzeni === \"ANO\") {\n        // Zpsob potvrzen je povinn (alespo jeden zpsob mus bt v poli zpusoby)\n        const zpusobyPotvrzeni = formData.dodavatel_zpusob_potvrzeni;\n        const maZpusob = zpusobyPotvrzeni?.zpusoby && zpusobyPotvrzeni.zpusoby.length > 0;\n\n        if (!maZpusob) {\n          errors.dodavatel_zpusob_potvrzeni = 'Vyberte zpsob potvrzen (e-mail, telefon nebo psemn) - pi odpovdi \"ANO\" je povinn alespo jeden';\n        }\n\n        //  Zpsob platby - kontrola, e je nastavena hodnota (vdy \"faktura\")\n        // POZNMKA: Platba je v kdu pevn nastavena na \"faktura\" (readonly checkbox)\n        if (!zpusobyPotvrzeni?.platba || zpusobyPotvrzeni.platba.trim() === '') {\n          errors.zpusob_platby = 'Vyberte zpsob platby (faktura/pokladna) - pole je povinn pi potvrzen dodavatele';\n        }\n\n        //  Datum akceptace je VDY povinn (nezvisle na zpsobu potvrzen)\n        if (!formData.dt_akceptace?.trim()) {\n          errors.dt_akceptace = 'Zadejte datum akceptace - kdy dodavatel potvrdil objednvku';\n        }\n      }\n\n      // POZNMKA: IO, Nzev, Adresa dodavatele pat do bloku \"Dodavatel\" ve FZI 3\n      // Validuj se pes validateWorkflowData(), ne zde!\n\n      //  VALIDACE ZVEEJNN: Pesunuto do workflowUtils.js (validateWorkflowData)\n      // Validace dt_zverejneni a registr_iddt se provd automaticky pes workflow manager\n      // kdy je zakrtnuto ma_byt_zverejnena a sekce registr_smluv_vyplneni je viditeln a odemen\n\n      //  VALIDACE SEK, BUDOVA, MSTNOST U POLOEK: Pouze u majetkovch objednvek\n      //  VALIDOVAT POUZE VE FZI 3+ (lokalizan pole jsou dostupn a od fze 3)\n      const isMaterialOrderValue = isMaterialOrder;\n      \n      if (currentPhase >= 3 && isMaterialOrderValue && formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n        formData.polozky_objednavky.forEach((polozka, index) => {\n          if (!polozka.usek_kod || !polozka.usek_kod.trim()) {\n            errors[`polozka_${index}_usek_kod`] = `Poloka ${index + 1}: Vyberte sek - uren lokace je povinn u majetkovch poloek`;\n          }\n          if (!polozka.budova_kod || !polozka.budova_kod.trim()) {\n            errors[`polozka_${index}_budova_kod`] = `Poloka ${index + 1}: Vyberte budovu - uren lokace je povinn u majetkovch poloek`;\n          }\n          if (!polozka.mistnost_kod || !polozka.mistnost_kod.trim()) {\n            errors[`polozka_${index}_mistnost_kod`] = `Poloka ${index + 1}: Vyberte mstnost - uren lokace je povinn u majetkovch poloek`;\n          }\n        });\n      }\n\n      // VALIDACE FAKTUR - kontrola povinnch pol\n      //  POUZE validovat faktury ve FZI 6+ (kdy je sekce Fakturace viditeln)\n      //  NEvalidovat faktury kdy je vybran POKLADNA (faktury se v tom ppad nezobrazuj)\n      const isPlatbaPokladnaObj = formData.financovani?.platba === 'pokladna';\n      const isPlatbaPokladnaDodavatel = formData.dodavatel_zpusob_potvrzeni?.platba === 'pokladna';\n      const isPokladna = isPlatbaPokladnaObj || isPlatbaPokladnaDodavatel;\n\n      if (currentPhase >= 6 && !isPokladna && formData.faktury && formData.faktury.length > 0) {\n        formData.faktury.forEach((faktura, index) => {\n          const fakturaPrefix = `faktura_${index + 1}`;\n\n          // Variabiln symbol je povinn\n          if (!faktura.fa_cislo_vema || (typeof faktura.fa_cislo_vema === 'string' && faktura.fa_cislo_vema.trim() === '')) {\n            errors[`${fakturaPrefix}_cislo`] = `Faktura ${index + 1}: Zadejte variabiln symbol faktury`;\n          }\n\n          // stka je povinn a mus bt vt ne 0\n          if (!faktura.fa_castka || parseFloat(faktura.fa_castka) <= 0) {\n            errors[`${fakturaPrefix}_castka`] = `Faktura ${index + 1}: Zadejte stku faktury (mus bt vt ne 0 K)`;\n          }\n\n          // Datum doruen je povinn - kontroluj fa_datum_doruceni (ne fa_dorucena, to je boolean)\n          if (!faktura.fa_datum_doruceni || (typeof faktura.fa_datum_doruceni === 'string' && faktura.fa_datum_doruceni.trim() === '')) {\n            errors[`${fakturaPrefix}_dorucena`] = `Faktura ${index + 1}: Zadejte datum, kdy byla faktura doruena`;\n          }\n\n          // Datum splatnosti je povinn\n          if (!faktura.fa_splatnost || (typeof faktura.fa_splatnost === 'string' && faktura.fa_splatnost.trim() === '')) {\n            errors[`${fakturaPrefix}_splatnost`] = `Faktura ${index + 1}: Zadejte datum splatnosti faktury`;\n          }\n\n          //  Stediska faktury jsou VOLITELN a NEvaliduj se proti strediskaOptions\n          // Dvod: Stediska z faktury mohou bt jin ne stediska v naem systmu\n          // (mohou pijt od dodavatele s vlastnm slovnm)\n          // POZNMKA: Validace byla odstranna - stediska jsou ist informativn pole\n        });\n      }\n\n      //  FZE 7+: VALIDACE VCN SPRVNOSTI (per-invoice)\n      if (currentPhase >= 7 && !isPokladna && formData.faktury && formData.faktury.length > 0) {\n        const maxCena = parseFloat(formData.max_cena_s_dph) || 0;\n        \n        formData.faktury.forEach((faktura, index) => {\n          // Potvrzen vcn sprvnosti je POVINN ve FZI 7+\n          if (faktura.vecna_spravnost_potvrzeno !== 1 && faktura.vecna_spravnost_potvrzeno !== true) {\n            errors[`faktura_${index + 1}_vecna_spravnost`] = `Faktura ${index + 1}: Zakrtnte polko \"Potvrzuji vcnou sprvnost\" po kontrole faktury`;\n          }\n          \n          // Poznmka je POVINN pokud faktura pekrauje MAX cenu objednvky\n          const fakturaCastka = parseFloat(faktura.fa_castka) || 0;\n          if (fakturaCastka > maxCena && (!faktura.vecna_spravnost_poznamka || faktura.vecna_spravnost_poznamka.trim() === '')) {\n            errors[`faktura_${index + 1}_poznamka_vs`] = `Faktura ${index + 1}: Vysvtlete v poznmce, pro faktura pekrauje max. cenu objednvky (${maxCena.toFixed(2)} K)`;\n          }\n        });\n      }\n    }\n\n    const hasErrors = Object.keys(errors).length > 0;\n    \n    //  KRITICK: Pout flushSync k okamitmu nastaven validationErrors\n    // PED otevenm panel - jinak se panely otevou ale chyby jet nebudou v DOM\n    flushSync(() => {\n      setValidationErrors(errors);\n    });\n\n    //  AUTOMATICK OTEVEN LOKALIZANCH PANEL u poloek s chybami\n    // Pokud jsou chyby v lokanch polch (SEK, BUDOVA, MSTNOST), musme otevt panel,\n    // jinak se erven rmeky nezobraz (protoe pole jsou podmnn renderovna)\n    const locationErrorKeys = Object.keys(errors).filter(k => \n      k.includes('_usek_kod') || k.includes('_budova_kod') || k.includes('_mistnost_kod')\n    );\n    \n    if (locationErrorKeys.length > 0) {\n      // Najdi indexy poloek s chybami\n      const polozkyIndexesWithErrors = new Set();\n      locationErrorKeys.forEach(key => {\n        const match = key.match(/polozka_(\\d+)_/);\n        if (match) {\n          polozkyIndexesWithErrors.add(parseInt(match[1]));\n        }\n      });\n      \n      // Otevi panely pro tyto poloky - TAK pomoc flushSync\n      const newLokalizacePanelStates = { ...lokalizacePanelStates };\n      formData.polozky_objednavky?.forEach((polozka, index) => {\n        if (polozkyIndexesWithErrors.has(index)) {\n          newLokalizacePanelStates[polozka.id] = true;\n        }\n      });\n      \n      flushSync(() => {\n        setLokalizacePanelStates(newLokalizacePanelStates);\n      });\n    }\n\n    // Zobrazit toast s konkrtnmi chybami a scrollovat na prvn chybu\n    if (hasErrors) {\n      const errorCount = Object.keys(errors).length;\n      \n      if (formData.stav_stornovano) {\n        // Speciln zprva pro stornovn\n        showToast && showToast(`Nelze stornovat - zkontrolujte vyznaen pole`, { type: 'error' });\n      } else {\n        // Strukturovan chybov zprva\n        const structuredMessage = formatValidationErrors(errors);\n        \n        showToast && showToast(structuredMessage, { \n          type: 'error', \n          timeout: 10000\n        });\n      }\n\n      // Scroll na prvn chybov element s mrnm zpodnm\n      setTimeout(() => {\n        scrollToFirstError(errors);\n      }, 100);\n    }\n\n    return !hasErrors;\n  };\n\n  // Lehk validace pro zobrazen ervench pol (bez toast zprv)\n  const validateFormSilently = () => {\n    let errors = {};\n\n    // SPECILN LOGIKA: Pi stornovn validovat pouze storno pole\n    if (formData.stav_stornovano) {\n      if (!formData.odeslani_storno_duvod?.trim()) {\n        errors.odeslani_storno_duvod = 'Dvod stornovn je povinn';\n      }\n    } else {\n      //  Validace podle workflow - validuj ve VECH fzch\n      const validationWorkflowCode = currentPhase === 1 ? 'NOVA' : mainWorkflowState;\n\n      //  Piprav informaci o viditelnosti a zamen sekc\n      const sectionStates = {\n        phase1: { visible: currentPhase >= 1, locked: shouldLockPhase1Sections },\n        phase2: { visible: currentPhase >= 2, locked: shouldLockPhase2Sections },\n        financovani: { visible: financovaniState.visible, locked: !financovaniState.enabled }, // Samostatn sekce pro financovn\n        phase3: { visible: currentPhase >= 3, locked: shouldLockPhase3Sections },\n        phase4to6: { visible: currentPhase >= 4, locked: shouldLockPhase4to6Sections }\n      };\n\n      //  FIX: Merge errors msto pepsn - jinak ztratme FZE 5 validaci!\n      const workflowErrors = validateWorkflowData(formData, validationWorkflowCode, sectionStates);\n      errors = { ...errors, ...workflowErrors };\n\n      //  VALIDACE DYNAMICKCH POL PODLE ZDROJE FINANCOVN (tich validace)\n      //  Financovn je soust FZE 1-2 (validuje se hned od zatku!)\n      //  Validovat POUZE pokud je sekce financovn viditeln A odemen\n      const shouldValidateFinancovani = financovaniState.visible && financovaniState.enabled;\n      if (currentPhase >= 1 && formData.zpusob_financovani && shouldValidateFinancovani) {\n        const selectedFinancovani = financovaniOptions.find(opt =>\n          opt.kod === formData.zpusob_financovani ||\n          opt.kod_stavu === formData.zpusob_financovani ||\n          opt.value === formData.zpusob_financovani\n        );\n\n        if (selectedFinancovani) {\n          const nazev = selectedFinancovani.nazev_stavu || selectedFinancovani.nazev || '';\n\n          // Limitovan pslib - LP kd je POVINN\n          if (nazev.includes('Limitovan') || nazev.includes('pslib')) {\n            if (!formData.lp_kod ||\n                (Array.isArray(formData.lp_kod) && formData.lp_kod.length === 0)) {\n              errors.lp_kod = 'LP kd je povinn';\n            }\n            \n            //  VALIDACE LP U POLOEK: Pokud je financovn LP, vechny poloky MUS mt vyplnn LP\n            //  VALIDOVAT POUZE VE FZI 3+ (poloky jsou dostupn a od fze 3)\n            if (currentPhase >= 3 && formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n              formData.polozky_objednavky.forEach((polozka, index) => {\n                if (!polozka.polozka_lp_id && !polozka.lp_id) {\n                  errors[`polozka_${index}_lp`] = `Poloka ${index + 1}: LP je povinn`;\n                }\n              });\n            }\n          }\n\n          // Smlouva - slo smlouvy je POVINN a mus existovat v seznamu aktivnch smluv\n          if (nazev.includes('Smlouva')) {\n            if (!formData.cislo_smlouvy?.trim()) {\n              errors.cislo_smlouvy = 'slo smlouvy je povinn';\n            } else {\n              //  PSN VALIDACE: Ovit, e slo smlouvy existuje v seznamu aktivnch smluv\n              const existujeSmlouva = smlouvyList.some(s => \n                (s.aktivni !== 0 && s.aktivni !== false) &&\n                (s.cislo_smlouvy === formData.cislo_smlouvy || s.evidencni_cislo === formData.cislo_smlouvy)\n              );\n              \n              if (!existujeSmlouva) {\n                errors.cislo_smlouvy = 'Zadan slo smlouvy nen platn';\n              }\n            }\n          }\n\n          // Individuln schvlen - Identifiktor je POVINN\n          if (nazev.includes('Individuln')) {\n            if (!formData.individualni_schvaleni?.trim()) {\n              errors.individualni_schvaleni = 'Identifiktor je povinn';\n            }\n          }\n\n          // Pojistn udlost - slo udlosti je POVINN\n          if (nazev.includes('Pojistn')) {\n            if (!formData.pojistna_udalost_cislo?.trim()) {\n              errors.pojistna_udalost_cislo = 'slo pojistn udlosti je povinn';\n            }\n          }\n        }\n      }\n\n      //  VALIDACE SEK, BUDOVA, MSTNOST U POLOEK: Pouze u majetkovch objednvek\n      //  VALIDOVAT POUZE VE FZI 3+ (lokalizan pole jsou dostupn a od fze 3)\n      const isMaterialOrderValue = isMaterialOrder;\n      \n      if (currentPhase >= 3 && isMaterialOrderValue && formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n        formData.polozky_objednavky.forEach((polozka, index) => {\n          if (!polozka.usek_kod || !polozka.usek_kod.trim()) {\n            errors[`polozka_${index}_usek_kod`] = `Poloka ${index + 1}: sek je povinn u majetkovch objednvek`;\n          }\n          if (!polozka.budova_kod || !polozka.budova_kod.trim()) {\n            errors[`polozka_${index}_budova_kod`] = `Poloka ${index + 1}: Budova je povinn u majetkovch objednvek`;\n          }\n          if (!polozka.mistnost_kod || !polozka.mistnost_kod.trim()) {\n            errors[`polozka_${index}_mistnost_kod`] = `Poloka ${index + 1}: Mstnost je povinn u majetkovch objednvek`;\n          }\n        });\n      }\n\n      // SPECILN VALIDACE PRO FZI 4: Potvrzen dodavatele\n      //  VALIDOVAT POUZE VE FZI 4 (ODESLANA) - ve FZI 3 jet nemus bt vyplnno\n      if (currentPhase === 4 && formData.dodavatel_zpusob_potvrzeni?.potvrzeni === \"ANO\") {\n        const zpusobyPotvrzeni = formData.dodavatel_zpusob_potvrzeni;\n        const maZpusob = zpusobyPotvrzeni?.zpusoby && zpusobyPotvrzeni.zpusoby.length > 0;\n\n        if (!maZpusob) {\n          errors.dodavatel_zpusob_potvrzeni = 'Pi potvrzen \"ANO\" mus bt vybrn alespo jeden zpsob potvrzen';\n        }\n\n        //  Zpsob platby - kontrola, e je nastavena hodnota (vdy \"faktura\")\n        // POZNMKA: Platba je v kdu pevn nastavena na \"faktura\" (readonly checkbox)\n        if (!zpusobyPotvrzeni?.platba || zpusobyPotvrzeni.platba.trim() === '') {\n          errors.zpusob_platby = 'Pi potvrzen dodavatele \"ANO\" je zpsob platby povinn';\n        }\n\n        //  Datum akceptace je VDY povinn (nezvisle na zpsobu potvrzen)\n        if (!formData.dt_akceptace?.trim()) {\n          errors.dt_akceptace = 'Pi potvrzen dodavatele \"ANO\" je datum akceptace povinn';\n        }\n      }\n\n      //  TICH VALIDACE REGISTRU SMLUV - pouze pro zobrazen ervench pol\n      //  POUZE validovat ve FZI 5 (Vyplnn registru smluv) - pokud m bt zveejnna\n      //  VALIDOVAT POUZE pokud m uivatel prvo ORDER_PUBLISH_REGISTRY (sekce mus bt viditeln)\n      if ((formData.ma_byt_zverejnena === true || formData.ma_byt_zverejnena === 1) && \n          currentPhase === 5 && \n          sectionStates.phase4to6?.visible && \n          !sectionStates.phase4to6?.locked) {\n        if (!formData.dt_zverejneni?.trim()) {\n          errors.dt_zverejneni = 'Datum zveejnn je povinn';\n        }\n        if (!formData.registr_iddt?.trim()) {\n          errors.registr_iddt = 'Identifiktor IDDT je povinn';\n        }\n      }\n\n      //  TICH VALIDACE FAKTUR - pouze pro zobrazen ervench pol\n      //  POUZE validovat faktury ve FZI 6+ (kdy je sekce Fakturace viditeln)\n      if (currentPhase >= 6 && formData.faktury && formData.faktury.length > 0) {\n        formData.faktury.forEach((faktura, index) => {\n          const fakturaPrefix = `faktura_${index + 1}`;\n\n          if (!faktura.fa_cislo_vema || (typeof faktura.fa_cislo_vema === 'string' && faktura.fa_cislo_vema.trim() === '')) {\n            errors[`${fakturaPrefix}_cislo`] = `Variabiln symbol je povinn`;\n          }\n\n          if (!faktura.fa_castka || parseFloat(faktura.fa_castka) <= 0) {\n            errors[`${fakturaPrefix}_castka`] = `stka je povinn`;\n          }\n\n          // Datum doruen - kontroluj fa_datum_doruceni (ne fa_dorucena, to je boolean)\n          if (!faktura.fa_datum_doruceni || (typeof faktura.fa_datum_doruceni === 'string' && faktura.fa_datum_doruceni.trim() === '')) {\n            errors[`${fakturaPrefix}_dorucena`] = `Datum doruen je povinn`;\n          }\n\n          if (!faktura.fa_splatnost || (typeof faktura.fa_splatnost === 'string' && faktura.fa_splatnost.trim() === '')) {\n            errors[`${fakturaPrefix}_splatnost`] = `Datum splatnosti je povinn`;\n          }\n        });\n      }\n    }\n\n    setValidationErrors(errors);\n    return Object.keys(errors).length === 0;\n  };\n\n  //  ZAKOMENTOVNO: Tento useEffect zpsobuje PEPSN validanch chyb!\n  // Problm: Po validateFormForSave() (kter vytvo vechny chyby vetn lokac),\n  // se tento useEffect spust a zavol validateFormSilently(), kter PEPE chyby\n  //  EEN: Live validace nen poteba - validujeme pouze pi kliknut na \"Uloit\"\n  /*\n  useEffect(() => {\n    // Spustit validaci pouze pokud u uivatel zkusil uloit\n    if (hasTriedToSubmit) {\n      validateFormSilently();\n    }\n    //  FIX: hasTriedToSubmit NEN v dependencies!\n    // Dvod: Nechceme spustit validaci pi zmn hasTriedToSubmit z falsetrue\n    // To by zpsobilo race condition s validateFormForSave()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    formData.dodavatel_zpusob_potvrzeni,\n    formData.dt_akceptace,\n    formData.dodavatel_ico,\n    formData.dodavatel_nazev,\n    formData.dodavatel_adresa,\n    formData.zpusob_financovani,\n    formData.lp_kod,\n    formData.cislo_smlouvy,\n    formData.individualni_schvaleni,\n    formData.pojistna_udalost_cislo,\n    formData.ma_byt_zverejnena,\n    formData.dt_zverejneni,\n    formData.registr_iddt\n  ]);\n  */\n\n  // Kontrola, zda je formul validn pro zkladn poadavky (pro sekci schvlen)\n  const isFormBasicallyValid = () => {\n    const errors = validateWorkflowData(formData, 'NOVA');\n    return Object.keys(errors).length === 0;\n  };\n\n  // Funkce pro kontrolu zkladnch pol (bez stavu schvlen)\n  // Ignoruje pole \"schvaleni_komentar\" - to se validuje a pi uloen\n  const areBasicFieldsValid = () => {\n    const errors = validateWorkflowData(formData, 'NOVA');\n    // Vyfiltrovat chybu schvaleni_komentar\n    const { schvaleni_komentar, ...otherErrors } = errors;\n    return Object.keys(otherErrors).length === 0;\n  };\n\n  // Funkce pro scroll na prvn chybov element\n  const scrollToFirstError = (errors) => {\n    if (!errors || Object.keys(errors).length === 0) return;\n\n    // Definice poad pol podle vizulnho poad ve formuli\n    const fieldOrder = [\n      'jmeno',\n      'email',\n      'garant_uzivatel_id',\n      'predmet',\n      'prikazce_id',\n      'max_cena_s_dph',\n      'strediska_kod',\n      'schvaleni_komentar',\n      'dodavatel_nazev',\n      'dodavatel_adresa',\n      'dodavatel_ico',\n      'druh_objednavky_kod',\n      'polozky_objednavky',\n      'zpusob_financovani',\n      'lp_kod',\n      'datum_odeslani',\n      'dodavatel_zpusob_potvrzeni',\n      'zpusob_platby',\n      'dt_akceptace',\n      'dt_zverejneni',        //  FZE 5: Datum zveejnn VZ\n      'registr_iddt'          //  FZE 5: Identifiktor IDDT\n    ];\n\n    // Najdi prvn chybov pole podle poad\n    for (const field of fieldOrder) {\n      if (errors[field]) {\n        // Mapovn field names na selektory\n        let element = null;\n        let parentSection = null;\n\n        switch (field) {\n          case 'jmeno':\n            element = document.querySelector('input[name=\"jmeno\"]');\n            break;\n          case 'email':\n            element = document.querySelector('input[type=\"email\"][name=\"email\"]');\n            break;\n          case 'garant_uzivatel_id':\n            element = document.querySelector('[data-field=\"garant\"]');\n            break;\n          case 'predmet':\n            element = document.querySelector('input[name=\"predmet\"]');\n            break;\n          case 'prikazce_id':\n            element = document.querySelector('[data-field=\"prikazce\"]');\n            break;\n          case 'max_cena_s_dph':\n            element = document.querySelector('input[name=\"max_cena_s_dph\"]');\n            break;\n          case 'strediska_kod':\n            element = document.querySelector('[data-field=\"strediska\"]');\n            break;\n          case 'schvaleni_komentar':\n            element = document.querySelector('textarea[name=\"schvaleni_komentar\"]');\n            break;\n          case 'dodavatel_nazev':\n            element = document.querySelector('input[name=\"dodavatel_nazev\"]');\n            break;\n          case 'dodavatel_adresa':\n            element = document.querySelector('input[name=\"dodavatel_adresa\"]');\n            break;\n          case 'dodavatel_ico':\n            element = document.querySelector('input[name=\"dodavatel_ico\"]');\n            break;\n          case 'druh_objednavky_kod':\n            element = document.querySelector('[data-field=\"druh_objednavky_kod\"]');\n            break;\n          case 'polozky_objednavky':\n            // Najdi prvn nevalidn poloku\n            const polozkyKeys = Object.keys(errors).filter(k => k.startsWith('polozka_'));\n            if (polozkyKeys.length > 0) {\n              const firstPolozkaError = polozkyKeys[0];\n              const index = parseInt(firstPolozkaError.split('_')[1]);\n              element = document.querySelector(`[data-polozka-index=\"${index}\"]`);\n              if (!element) {\n                // Fallback - najdi sekci s polokami\n                element = document.querySelector('[data-section=\"detaily\"]');\n              }\n            }\n            break;\n          case 'zpusob_financovani':\n            element = document.querySelector('[data-field=\"zpusob_financovani\"]');\n            break;\n          case 'lp_kod':\n            element = document.querySelector('[data-field=\"lp_kod\"]');\n            break;\n          case 'datum_odeslani':\n            element = document.querySelector('input[name=\"datum_odeslani\"]');\n            break;\n          case 'dodavatel_zpusob_potvrzeni':\n            element = document.querySelector('[name=\"dodavatel_zpusob_potvrzeni\"]');\n            break;\n          case 'zpusob_platby':\n            element = document.querySelector('[name=\"zpusob_platby\"]');\n            break;\n          case 'dt_akceptace':\n            element = document.querySelector('input[name=\"dt_akceptace\"]');\n            break;\n          case 'dt_zverejneni':\n            // DatePicker nem input s name, ale m fieldName prop - najdi button\n            element = document.querySelector('[data-field=\"dt_zverejneni\"]') ||\n                      document.querySelector('button[data-datepicker=\"dt_zverejneni\"]');\n            break;\n          case 'registr_iddt':\n            element = document.querySelector('input[name=\"registr_iddt\"]');\n            break;\n          default:\n            // Fallback - hledej podle nzvu pole\n            element = document.querySelector(`[name=\"${field}\"], [data-field=\"${field}\"]`);\n        }\n\n        if (element) {\n          // Najdi parent sekci a rozbal ji, pokud je sbalen\n          parentSection = element.closest('[data-section]');\n          if (parentSection) {\n            const sectionName = parentSection.getAttribute('data-section');\n            if (sectionName && sectionStates[sectionName]) {\n              // Sekce je sbalen, rozbal ji\n              setSectionStates(prev => ({ ...prev, [sectionName]: false }));\n\n              // Pokej na rozbalen a pak scrolluj\n              setTimeout(() => {\n                element.scrollIntoView({\n                  behavior: 'smooth',\n                  block: 'center',\n                  inline: 'nearest'\n                });\n\n                // Pokus o focus s mrnm zpodnm\n                setTimeout(() => {\n                  try {\n                    // Pro custom select komponenty, najdi input uvnit\n                    const inputInside = element.querySelector('input');\n                    if (inputInside) {\n                      inputInside.focus();\n                    } else {\n                      element.focus();\n                    }\n                  } catch (e) {\n                    // Focus me selhat u nkterch komponent\n                  }\n                }, 300);\n              }, 300);\n              break;\n            }\n          }\n\n          // Sekce je ji rozbalen, scrolluj ihned\n          element.scrollIntoView({\n            behavior: 'smooth',\n            block: 'center',\n            inline: 'nearest'\n          });\n\n          // Pokus o focus s mrnm zpodnm\n          setTimeout(() => {\n            try {\n              // Pro custom select komponenty, najdi input uvnit\n              const inputInside = element.querySelector('input');\n              if (inputInside) {\n                inputInside.focus();\n              } else {\n                element.focus();\n              }\n            } catch (e) {\n              // Focus me selhat u nkterch komponent\n            }\n          }, 300);\n          break;\n        }\n      }\n    }\n  };\n\n  const handleSaveOrder = async () => {\n    // Vymazat debug konzoli ped uloenm\n    clearDebugLogs();\n    addDebugLog('info', 'SAVE', 'order-save-start', 'Zanm ukldn objednvky...');\n\n    // Zavolej nai API funkci\n    await saveOrderToAPI();\n  };\n\n  // ====================== ABLONY - POKROIL FUNKCE ======================\n\n  // Koprovn peddefinovan ablony do uivatelskch ablon\n  const copyPredefinedToUser = async (predefinedEntry) => {\n    if (!token || !user_id || !predefinedEntry) {\n      return;\n    }\n\n    try {\n      const templateData = predefinedEntry.data || {};\n      const templateName = predefinedEntry.name || predefinedEntry.dbName || 'Kopie ablony';\n      const copyName = `${templateName} (kopie)`;\n\n      // Pprava dat pro API\n      const polozky_po = (templateData.poApproval) ? JSON.stringify(templateData.poApproval) : '';\n      const polozky_detail = (templateData.orderDetails) ? JSON.stringify(templateData.orderDetails) : '';\n\n      // Uren typu ablony\n      const typ = predefinedEntry.type?.toString().toUpperCase() || 'OBEJD';\n\n      const resp = await createTemplate({\n        username: user?.username || username,\n        token,\n        user_id: user_id || 0,\n        nazev_sablony: copyName,\n        polozky_po,\n        polozky_detail,\n        typ,\n        kategorie: 'OBJEDNAVKA25'\n      });\n\n      if (resp && (resp.success || resp.status === 'ok')) {\n        const created = resp.data || resp || {};\n        const entry = {\n          name: copyName,\n          data: templateData,\n          ts: Date.now(),\n          type: typ === 'PO' ? 'po' : (typ === 'DETAIL' ? 'details' : 'mixed'),\n          id: created.id || created.insertId,\n          user_id: user_id,\n          __fromServer: true\n        };\n\n        // Pidat do uivatelskch ablon\n        setSavedTemplates(prev => {\n          const existing = Array.isArray(prev) ? prev : [];\n          const filtered = existing.filter(e => (e.name || '').trim().toLowerCase() !== copyName.trim().toLowerCase());\n          const updatedTemplates = [entry, ...filtered].slice(0, 200);\n\n          // Uloit do localStorage\n          try {\n            const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n            localStorage.setItem(key, JSON.stringify(updatedTemplates));\n          } catch (error) {\n          }\n\n          return updatedTemplates;\n        });\n\n        logTemplateAction('copy', { originalName: templateName, copyName, type: typ.toLowerCase(), mode: 'server' });\n\n        if (showToast) {\n          showToast(`ablona \"${templateName}\" byla zkoprovna jako \"${copyName}\"`, { type: 'success' });\n        }\n\n        return entry;\n      }\n    } catch (err) {\n      if (showToast) {\n        showToast(`Chyba pi koprovn ablony: ${err?.message || 'Neznm chyba'}`, { type: 'error' });\n      }\n    }\n  };\n\n  // Koprovn uivatelsk ablony do globlnch ablon (jen pro TEMPLATE_MANAGE)\n  const copyUserTemplateToGlobal = async (userEntry) => {\n    if (!userEntry || !token || !user_id) {\n      return;\n    }\n\n    try {\n      const templateName = userEntry.name || userEntry.dbName || 'Kopie uivatelsk ablony';\n      const globalName = `${templateName} (GLO)`;\n\n      // Urit typ ablony\n      const data = userEntry.data || {};\n      const hasPo = data.poApproval && Object.keys(data.poApproval).length > 0;\n      const hasDet = data.orderDetails && Object.keys(data.orderDetails).length > 0;\n      let typ = 'PO';\n      if (hasPo && hasDet) typ = 'PO+detail';\n      else if (hasDet) typ = 'detail';\n\n      const result = await createTemplate({\n        username: user?.username || username,\n        token,\n        user_id: 0, // Globln ablona (user_id = 0)\n        nazev_sablony: globalName,\n        polozky_po: hasPo ? JSON.stringify(data.poApproval) : '',\n        polozky_detail: hasDet ? JSON.stringify(data.orderDetails) : '',\n        typ: typ.toLowerCase(),\n        kategorie: 'OBJEDNAVKA25'\n      });\n\n      if (result?.status === 'ok') {\n\n        // Refresh ablon pro aktualizaci\n        await fetchAndMergeTemplates();\n\n        logTemplateAction('copyToGlobal', { originalName: templateName, globalName, type: typ.toLowerCase(), mode: 'global' });\n\n        if (showToast) {\n          showToast(`ablona \"${templateName}\" byla zkoprovna do globlnch jako \"${globalName}\"`, { type: 'success' });\n        }\n      } else {\n        const errorMsg = result?.message || result?.data?.message || 'Nepodailo se zkoprovat ablonu do globlnch';\n        throw new Error(errorMsg);\n      }\n    } catch (err) {\n      if (showToast) {\n        showToast(`Chyba pi koprovn do globlnch ablon: ${err?.message || 'Neznm chyba'}`, { type: 'error' });\n      }\n    }\n  };\n\n  // Potvrzen mazn ablony\n  const confirmDeleteSavedTemplate = () => {\n    if (!templatePendingDelete) return;\n\n    try {\n      const target = templatePendingDelete;\n\n      // Pokud je ablona na serveru, sma ji tam\n      if (target && (target.__fromServer || target.id) && token && username) {\n        (async () => {\n          try {\n            const payloadUserId = (target && (target.user_id !== undefined && target.user_id !== null)) ? target.user_id : (user_id || 0);\n\n            // Pokud mazn globln ablony (user_id === 0), zkontroluj prva\n            if (Number(payloadUserId) === 0 && (!hasPermission || !hasPermission('TEMPLATE_MANAGE'))) {\n              if (showToast) {\n                showToast('Nemte oprvnn smazat peddefinovanou ablonu.', { type: 'error' });\n              }\n              return;\n            }\n\n            const resp = await deleteTemplate({\n              username: user?.username || username,\n              token,\n              user_id: payloadUserId || 0,\n              id: target.id\n            });\n\n            const serverStatus = resp && resp.data && (resp.data.status || resp.data.result || (resp.data.ok ? 'ok' : null));\n            const serverData = resp && resp.data && (resp.data.data || resp.data);\n            const isDeleted = serverStatus && String(serverStatus).toLowerCase() === 'ok' && serverData && (serverData.deleted === true || serverData.deleted === 'true');\n\n            if (isDeleted || resp?.success || resp?.status === 'ok') {\n              // Odstranit ze serverTemplates pokud je tam\n              setServerTemplates(prev => Array.isArray(prev) ? prev.filter(p => String(p.id) !== String(target.id)) : prev);\n\n              // Odstranit z uivatelskch ablon\n              setSavedTemplates(prev => {\n                const updatedTemplates = prev.filter(e => !(e.id && target.id && String(e.id) === String(target.id)));\n                // Uloit do localStorage\n                try {\n                  const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n                  localStorage.setItem(key, JSON.stringify(updatedTemplates));\n                } catch (error) {\n                }\n                return updatedTemplates;\n              });\n\n              logTemplateAction('delete', { name: target?.name, id: target?.id, mode: 'server' });\n\n              if (showToast) {\n                showToast('ablona byla smazna.', { type: 'success' });\n              }\n            } else {\n              throw new Error('Smazn na serveru se nezdailo');\n            }\n          } catch (err) {\n\n            // Fallback na lokln mazn\n            setSavedTemplates(prev => {\n              const updatedTemplates = prev.filter(e => !(e.ts === target.ts && e.name === target.name));\n              // Uloit do localStorage\n              try {\n                const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n                localStorage.setItem(key, JSON.stringify(updatedTemplates));\n              } catch (error) {\n              }\n              return updatedTemplates;\n            });\n\n            if (showToast) {\n              showToast(`Smazn ablony selhalo: ${err?.message || 'Chyba serveru'}`, { type: 'error' });\n            }\n          }\n        })();\n      } else {\n        // Pouze lokln ablona\n        setSavedTemplates(prev => {\n          const updatedTemplates = prev.filter(e => !(e.ts === templatePendingDelete.ts && e.name === templatePendingDelete.name));\n          // Uloit do localStorage\n          try {\n            const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n            localStorage.setItem(key, JSON.stringify(updatedTemplates));\n          } catch (error) {\n          }\n          return updatedTemplates;\n        });\n\n        logTemplateAction('delete', { name: templatePendingDelete?.name, ts: templatePendingDelete?.ts, mode: 'local' });\n      }\n    } finally {\n      setShowDeleteTemplateConfirm(false);\n      setTemplatePendingDelete(null);\n    }\n  };\n\n  // Zruen mazn ablony\n  const cancelDeleteSavedTemplate = () => {\n    setShowDeleteTemplateConfirm(false);\n    setTemplatePendingDelete(null);\n  };\n\n  // Zatek editace nzvu ablony\n  const startEditingTemplateName = (template) => {\n    setEditingTemplateId(template.id || template.ts);\n    setEditingTemplateName(template.name || '');\n  };\n\n  // Zruen editace nzvu ablony\n  const cancelEditingTemplateName = () => {\n    setEditingTemplateId(null);\n    setEditingTemplateName('');\n  };\n\n  // Uloen novho nzvu ablony\n  const saveTemplateName = async (template) => {\n    if (!editingTemplateName.trim()) {\n      if (showToast) {\n        showToast('Nzev ablony neme bt przdn', { type: 'error' });\n      }\n      return;\n    }\n\n    try {\n      const newName = editingTemplateName.trim();\n\n      if (template.__fromServer && template.id) {\n        // Serverov ablona - aktualizace na serveru\n\n        const result = await updateTemplate({\n          username: user?.username || username,\n          token,\n          user_id: template.user_id || 0, // Zachovej pvodn user_id ablony\n          id: template.id,\n          nazev_sablony: newName,\n          kategorie: \"OBJEDNAVKA25\"\n        });\n\n        if (result?.status === 'ok' && result?.data?.updated) {\n\n          // Refresh ablon pro aktualizaci\n          await fetchAndMergeTemplates();\n\n          logTemplateAction('rename', { oldName: template.name, newName, id: template.id, mode: 'server' });\n\n          if (showToast) {\n            showToast(`ablona pejmenovna na \"${newName}\"`, { type: 'success' });\n          }\n        } else {\n          const errorMsg = result?.message || result?.data?.message || 'Nepodailo se pejmenovat ablonu na serveru';\n          throw new Error(errorMsg);\n        }\n      } else {\n        // Lokln ablona - aktualizace v localStorage\n        setSavedTemplates(prev => {\n          const updated = prev.map(t => {\n            if ((t.id && template.id && String(t.id) === String(template.id)) ||\n                (t.ts === template.ts && t.name === template.name)) {\n              return { ...t, name: newName };\n            }\n            return t;\n          });\n\n          // Uloit do localStorage\n          try {\n            const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n            localStorage.setItem(key, JSON.stringify(updated));\n          } catch (error) {\n          }\n\n          return updated;\n        });\n\n        logTemplateAction('rename', { oldName: template.name, newName, mode: 'local' });\n\n        if (showToast) {\n          showToast(`ablona pejmenovna na \"${newName}\"`, { type: 'success' });\n        }\n      }\n\n      // Reset editace\n      setEditingTemplateId(null);\n      setEditingTemplateName('');\n\n    } catch (err) {\n      if (showToast) {\n        showToast(`Chyba pi pejmenovn ablony: ${err?.message || 'Neznm chyba'}`, { type: 'error' });\n      }\n    }\n  };\n\n  // ====================== ABLONY - HLAVN FUNKCE ======================\n\n  // Natn ablon ze serveru\n  const fetchAndMergeTemplates = async () => {\n    if (!token || !user_id) return;\n\n    setTemplatesLoading(true);\n    try {\n\n      // Zkusme nejprve OBJEDNAVKA25, pokud nebudou vsledky, zkusme OBJEDNAVKA\n      let response = await fetchTemplatesListWithMeta({\n        username: user?.username || username,\n        token,\n        user_id: user_id || 0,\n        kategorie: 'OBJEDNAVKA25', // DLEIT: Pro nov objednvky pouvme kategorii OBJEDNAVKA25\n        debug: true // Pidme debug parameter jako v pvodn implementaci\n      });\n\n      // Pro OrderForm25 pouvme vhradn OBJEDNAVKA25 kategorie - bez fallbacku na OBJEDNAVKA\n\n      // Zpracovn odpovdi podle pvodn logiky z OrderFormComponent\n      let templates = [];\n      if (Array.isArray(response?.items)) {\n        templates = response.items;\n      } else if (Array.isArray(response?.data)) {\n        templates = response.data;\n      } else if (response?.success && Array.isArray(response?.data)) {\n        templates = response.data;\n      }\n\n      if (templates.length > 0) {\n        // Rozdlen ablon na serverov a uivatelsk\n        const serverTpls = templates.filter(t => t.user_id === 0 || String(t.user_id) === '0');\n        const userTpls = templates.filter(t => t.user_id !== 0 && String(t.user_id) !== '0');\n\n        // Zpracovn serverovch ablon s nzvy podle pvodn logiky\n        const processedServerTemplates = serverTpls.map(t => {\n          const name = t.nazev_sablony || t.nazev || t.name || `sablona-${t.id}`;\n          const ts = t.dt_aktualizace || t.dt_vytvoreni || Date.now();\n          const data = parseTemplateData(t);\n\n          // Uren typu ablony podle pvodn logiky\n          const rawTyp = (t.typ || t.type || '');\n          const rawTypStr = (typeof rawTyp === 'string' ? rawTyp : String(rawTyp || '')).trim().toLowerCase();\n          let serverType = null;\n          if (rawTypStr) {\n            if (rawTypStr === 'po' || rawTypStr === 'p_o' || rawTypStr === 'p.o' || rawTypStr === 'p') serverType = 'PO';\n            else if (rawTypStr === 'detail' || rawTypStr === 'det' || rawTypStr === 'details') serverType = 'DETAIL';\n            else if (rawTypStr === 'obejd' || rawTypStr === 'po+detail' || rawTypStr === 'po_detail' || rawTypStr === 'both') serverType = 'OBEJD';\n            else {\n              // Heuristika: obsahuje klov slova\n              if (rawTypStr.includes('po') && rawTypStr.includes('detail')) serverType = 'OBEJD';\n              else if (rawTypStr.includes('po')) serverType = 'PO';\n              else if (rawTypStr.includes('det')) serverType = 'DETAIL';\n            }\n          }\n\n          // Pokud typ nen uren ze serveru, odvo z dat\n          const type = serverType || ((data.poApproval && data.orderDetails) ? 'OBEJD' : (data.poApproval ? 'PO' : (data.orderDetails ? 'DETAIL' : 'PO')));\n\n          return {\n            ...t,\n            name,\n            dbName: t.nazev_sablony || null,\n            ts: (new Date(ts)).getTime ? (new Date(ts)).getTime() : Date.now(),\n            type,\n            __fromServer: true,\n            data\n          };\n        });\n\n        setServerTemplates(processedServerTemplates);\n\n        // Zpracovn uivatelskch ablon s nzvy\n        const processedUserTemplates = userTpls.map(t => {\n          const name = t.nazev_sablony || t.nazev || t.name || `sablona-${t.id}`;\n          const ts = t.dt_aktualizace || t.dt_vytvoreni || Date.now();\n          const data = parseTemplateData(t);\n\n          // Uren typu ablony podle pvodn logiky\n          const rawTyp = (t.typ || t.type || '');\n          const rawTypStr = (typeof rawTyp === 'string' ? rawTyp : String(rawTyp || '')).trim().toLowerCase();\n          let serverType = null;\n          if (rawTypStr) {\n            if (rawTypStr === 'po' || rawTypStr === 'p_o' || rawTypStr === 'p.o' || rawTypStr === 'p') serverType = 'PO';\n            else if (rawTypStr === 'detail' || rawTypStr === 'det' || rawTypStr === 'details') serverType = 'DETAIL';\n            else if (rawTypStr === 'obejd' || rawTypStr === 'po+detail' || rawTypStr === 'po_detail' || rawTypStr === 'both') serverType = 'OBEJD';\n            else {\n              // Heuristika: obsahuje klov slova\n              if (rawTypStr.includes('po') && rawTypStr.includes('detail')) serverType = 'OBEJD';\n              else if (rawTypStr.includes('po')) serverType = 'PO';\n              else if (rawTypStr.includes('det')) serverType = 'DETAIL';\n            }\n          }\n\n          // Pokud typ nen uren ze serveru, odvo z dat\n          const type = serverType || ((data.poApproval && data.orderDetails) ? 'OBEJD' : (data.poApproval ? 'PO' : (data.orderDetails ? 'DETAIL' : 'PO')));\n\n          return {\n            ...t,\n            name,\n            dbName: t.nazev_sablony || null,\n            ts: (new Date(ts)).getTime ? (new Date(ts)).getTime() : Date.now(),\n            type,\n            __fromServer: true,\n            data\n          };\n        });\n\n        setSavedTemplates(processedUserTemplates);\n\n        // Uloit uivatelsk ablony do localStorage pro cache\n        try {\n          const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n          localStorage.setItem(key, JSON.stringify(processedUserTemplates));\n\n        } catch (error) {\n        }\n\n        // Debug: ukzat zpracovan nzvy ablon - nyn skryto pro produkci\n\n        setTemplatesFetchStatus({\n          status: response?.status || 'success',\n          error: response?.error || null,\n          raw: response?.raw || null\n        });\n        logTemplateAction('fetch', { count: templates.length, serverCount: processedServerTemplates.length, userCount: processedUserTemplates.length });\n      } else {\n        setTemplatesFetchStatus({\n          status: response?.status || 'empty',\n          error: response?.error || 'dn ablony nenalezeny',\n          raw: response?.raw || null\n        });\n      }\n    } catch (error) {\n      setTemplatesFetchStatus({ status: 'error', error: error.message });\n    } finally {\n      setTemplatesLoading(false);\n    }\n  };\n\n  // Parsovn dat ablony z DB podle pvodn logiky z OrderFormComponent\n  const parseTemplateData = (template) => {\n    try {\n      // Helper funkce pro bezpen parsovn template pol (pevzato z OrderFormComponent)\n      const safeParseTemplateField = (val) => {\n        if (val === null || val === undefined) return null;\n        if (typeof val !== 'string') return val;\n        const raw = val.trim();\n        if (!raw) return null;\n\n        // Zkusme pm JSON parse\n        try { return JSON.parse(raw); } catch (e) {}\n\n        // Normalizace: odstrann novch dk, trim\n        let s = raw.replace(/\\r?\\n/g, ' ').trim();\n\n        // Quote unquoted object keys: {key: -> {\"key\": a tak po rkch\n        try {\n          s = s.replace(/([\\{,\\s])(\\w[\\w\\-]*)\\s*:/g, '$1\"$2\":');\n        } catch (e) {}\n\n        // Nahrazen single quotes za double quotes\n        s = s.replace(/'/g, '\"');\n\n        // Zkusme parsovat normalizovan string\n        try { return JSON.parse(s); } catch (e) {}\n\n        // Posledn monost: evaluace JS-like objektu pomoc Function\n        try {\n          // eslint-disable-next-line no-new-func\n          const fn = new Function('return (' + raw + ');');\n          return fn();\n        } catch (e) {\n          return null;\n        }\n      };\n\n      const rawPo = template.polozky_po ? safeParseTemplateField(template.polozky_po) : null;\n      const rawDetail = template.polozky_detail ? safeParseTemplateField(template.polozky_detail) : null;\n\n      // Helper: expand flat/dotted keys do nested object struktury\n      const expandFlatKeys = (obj) => {\n        if (!obj || typeof obj !== 'object' || Array.isArray(obj)) return obj;\n        const out = {};\n        Object.keys(obj).forEach(k => {\n          const val = obj[k];\n          if (k.includes('.')) {\n            const parts = k.split('.');\n            let cur = out;\n            parts.forEach((p, idx) => {\n              if (idx === parts.length - 1) {\n                cur[p] = val;\n              } else {\n                if (!cur[p] || typeof cur[p] !== 'object') cur[p] = {};\n                cur = cur[p];\n              }\n            });\n          } else {\n            // Merge objects if needed\n            if (typeof val === 'object' && val !== null && !Array.isArray(val) && typeof out[k] === 'object') {\n              out[k] = { ...out[k], ...val };\n            } else {\n              out[k] = val;\n            }\n          }\n        });\n        return out;\n      };\n\n      const parsedPo = rawPo ? expandFlatKeys(rawPo) : null;\n      const parsedDetail = rawDetail ? expandFlatKeys(rawDetail) : null;\n\n      const data = {};\n      if (parsedPo) data.poApproval = parsedPo;\n      if (parsedDetail) data.orderDetails = parsedDetail;\n\n      return data;\n    } catch (error) {\n      return {};\n    }\n  };\n\n  // Natn PO ze ablony\n  const fillPoApprovalSaved = (entry) => {\n    if (currentPhase >= 2) return; // Nelze mnit PO po schvlen\n\n    const data = entry?.data;\n    if (data?.poApproval) {\n      const prev = { ...formData };\n      const next = {\n        ...prev,\n        ...data.poApproval,\n        // Zachovat ID a evidenn slo\n        id: prev.id,\n        ev_cislo: prev.ev_cislo\n      };\n\n      setFormData(next);\n      logTemplateAction('apply-po', {\n        name: entry.name,\n        source: 'saved',\n        ts: entry.ts,\n        preview: compactTemplatePreview(data)\n      });\n\n      //  KRITICK: Po naten ablony POVOLIT autosave a okamit uloit draft\n      draftManager.setAutosaveEnabled(true); //  Povolit autosave\n\n      //  SYNCHRONN voln saveDraft s pedanmi daty (bez setTimeout)\n      saveDraft(true, false, next).catch(e => {\n      });\n    }\n  };\n\n  // Helper: Mapovn pol na sekce (FZE 2)\n  const getFieldsForSections = () => ({\n    financovani: [\n      'zpusob_financovani', 'financovani', 'lp_kod', 'cislo_smlouvy', 'smlouva_poznamka',\n      'individualni_schvaleni', 'individualni_poznamka', 'pojistna_udalost_cislo', 'pojistna_udalost_poznamka'\n    ],\n    dodavatel: [\n      'dodavatel_id', 'dodavatel_nazev', 'dodavatel_adresa', 'dodavatel_ico',\n      'dodavatel_dic', 'dodavatel_zastoupeny'\n    ],\n    kontakt: [\n      'dodavatel_kontakt_jmeno', 'dodavatel_kontakt_email', 'dodavatel_kontakt_telefon'\n    ],\n    detaily: [\n      'druh_objednavky', 'druh_objednavky_kod', 'poznamka_objednavky'\n    ],\n    dodaci_podminky: [\n      'dt_predpokladany_termin_dodani', 'misto_dodani', 'zaruka'\n    ],\n    polozky: ['polozky_objednavky'] // Speciln pole - poloky objednvky\n  });\n\n  // Natn detail ze ablony - respektuje viditelnost sekc podle fze\n  const fillAllFieldsSaved = (entry) => {\n    if (currentPhase < 2) return; // Detaily lze plnit a po schvlen\n\n    const data = entry?.data;\n    if (!data?.orderDetails) {\n      return;\n    }\n\n    // Zjistit, kter sekce jsou viditeln v aktuln fzi\n    const visibility = getSectionVisibility(mainWorkflowState, currentPhase, isArchived);\n    const fieldMap = getFieldsForSections();\n\n    const prev = { ...formData };\n    const next = { ...prev };\n\n    // Naplnit pouze pole z viditelnch sekc\n    Object.entries(fieldMap).forEach(([sectionKey, fields]) => {\n      // Zkontrolovat, zda je sekce viditeln (krom poloek, kter maj speciln kontrolu)\n      const isSectionVisible = sectionKey === 'polozky' ? visibility.detaily : visibility[sectionKey];\n\n      if (isSectionVisible) {\n        fields.forEach(field => {\n          if (data.orderDetails[field] !== undefined) {\n            next[field] = data.orderDetails[field];\n          }\n        });\n      }\n    });\n\n    // Pidn poloek pokud jsou v ablon a sekce detaily je viditeln\n    if (visibility.detaily && Array.isArray(data.polozky) && data.polozky.length > 0) {\n      next.polozky_objednavky = data.polozky;\n    }\n\n    // Zachovat PO data a ID (vdy)\n    next.predmet = prev.predmet;\n    next.prikazce_id = prev.prikazce_id;\n    next.max_cena_s_dph = prev.max_cena_s_dph;\n    next.strediska_kod = prev.strediska_kod;\n    next.garant_uzivatel_id = prev.garant_uzivatel_id;\n    next.id = prev.id;\n    next.ev_cislo = prev.ev_cislo;\n\n    //  Zachovat financovn (soust PO sekce ve FZI 1)\n    next.zpusob_financovani = prev.zpusob_financovani;\n    next.lp_kod = prev.lp_kod;\n    next.cislo_smlouvy = prev.cislo_smlouvy;\n    next.smlouva_poznamka = prev.smlouva_poznamka;\n    next.individualni_schvaleni = prev.individualni_schvaleni;\n    next.individualni_poznamka = prev.individualni_poznamka;\n    next.pojistna_udalost_cislo = prev.pojistna_udalost_cislo;\n    next.pojistna_udalost_poznamka = prev.pojistna_udalost_poznamka;\n\n    setFormData(next);\n    logTemplateAction('apply-details', {\n      name: entry.name,\n      source: 'saved',\n      ts: entry.ts,\n      preview: compactTemplatePreview(data),\n      appliedSections: Object.keys(fieldMap).filter(k => k === 'polozky' ? visibility.detaily : visibility[k])\n    });\n\n    //  KRITICK: Po naten ablony POVOLIT autosave a okamit uloit draft\n    draftManager.setAutosaveEnabled(true); //  Povolit autosave\n\n    //  SYNCHRONN voln saveDraft s pedanmi daty (bez setTimeout)\n    saveDraft(true, false, next).catch(e => {\n    });\n\n  };\n\n  // Uloen ablony\n  const saveTemplateToStorage = async (name, data, type) => {\n    if (!token || !user_id) {\n      return;\n    }\n\n    try {\n      // Pprava dat pro API\n      const polozky_po = (type === 'po' || type === 'mixed') && data.poApproval\n        ? JSON.stringify(data.poApproval)\n        : '';\n      const polozky_detail = (type === 'details' || type === 'mixed') && data.orderDetails\n        ? JSON.stringify(data.orderDetails)\n        : '';\n\n      const typ = type === 'po' ? 'PO' : type === 'details' ? 'DETAIL' : 'OBEJD';\n\n      const response = await createTemplate({\n        username: user?.username || username,\n        token,\n        user_id: user_id || 0,\n        nazev_sablony: name,\n        polozky_po,\n        polozky_detail,\n        typ,\n        kategorie: 'OBJEDNAVKA25' // DLEIT: Pro nov objednvky\n      });\n\n      if (response?.success || response?.status === 'ok') {\n        // Aktualizace loklnho stavu\n        const newTemplate = {\n          name,\n          data,\n          ts: Date.now(),\n          type,\n          id: response.insertId || response.id || response.data?.id,\n          user_id,\n          __fromServer: true\n        };\n\n        setSavedTemplates(prev => {\n          const updatedTemplates = [newTemplate, ...prev];\n          // Uloit do localStorage\n          try {\n            const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n            localStorage.setItem(key, JSON.stringify(updatedTemplates));\n          } catch (error) {\n          }\n          return updatedTemplates;\n        });\n\n        logTemplateAction('save', { name, type, mode: 'server' });\n\n        if (showToast) {\n          showToast(`ablona \"${name}\" byla uloena`, { type: 'success' });\n        }\n      } else {\n        const errorMsg = response?.message || response?.data?.message || 'Chyba pi ukldn';\n        throw new Error(errorMsg);\n      }\n    } catch (error) {\n      if (showToast) {\n        showToast(`Chyba pi ukldn ablony: ${error.message}`, { type: 'error' });\n      }\n    }\n  };\n\n  // Funkce pro ovldn vlastnch select\n  const toggleSelect = (selectName) => {\n    setSelectStates(prev => {\n      // Zavi vechny selecty\n      const newState = {\n        garant: false,\n        prikazce: false,\n        strediska: false,\n        financovani: false,\n      };\n      // Otevi pouze vybran select (pokud byl zaven)\n      newState[selectName] = !prev[selectName];\n      return newState;\n    });\n  };\n\n  const closeAllSelects = () => {\n    setSelectStates({\n      garant: false,\n      prikazce: false,\n      strediska: false,\n      financovani: false,\n      lp_kod: false,\n    });\n  };\n\n  // Funkce pro filtraci monost podle vyhledvn\n  const filterOptions = (options, searchTerm, searchField) => {\n    if (!searchTerm) return options;\n    return options.filter(option => {\n      const label = getOptionLabel(option, searchField);\n      return label.toLowerCase().includes(searchTerm.toLowerCase());\n    });\n  };\n\n  // Funkce pro zskn labelu monosti\n  const getOptionLabel = useCallback((option, field) => {\n    if (!option) return '';\n\n    switch (field) {\n      case 'garant':\n        return `${option.titul_pred ? option.titul_pred + ' ' : ''}${option.jmeno || ''} ${option.prijmeni || ''}${option.titul_za ? ', ' + option.titul_za : ''}`.replace(/\\s+/g, ' ').trim();\n      case 'prikazce':\n        // Pokud je option null, 0 nebo przdn ID, vra \"Neznm\"\n        if (!option || option === 0 || option.id === 0 || option.user_id === 0 || option.id === null || option.user_id === null) {\n          return 'Neznm';\n        }\n        const fullName = `${option.titul_pred ? option.titul_pred + ' ' : ''}${option.jmeno || ''} ${option.prijmeni || ''}${option.titul_za ? ', ' + option.titul_za : ''}`.replace(/\\s+/g, ' ').trim();\n        const usekSuffix = option.usek_zkr ? ` (${option.usek_zkr})` : '';\n        return (fullName || 'Neznm') + usekSuffix;\n      case 'strediska':\n      case 'strediska_kod':\n        // Pro hierarchick stediska pouij label (u obsahuje odsazen)\n        if (option.label) {\n          return option.label;\n        }\n        // Fallback pro pvodn formt\n        return option.name || option.nazev_stavu || option.toString();\n      case 'financovani':\n      case 'zpusob_financovani':\n        //  OPRAVA: Pouvat nazev_stavu stejn jako u stedisek\n        return option.nazev_stavu || option.nazev || option.label || (typeof option === 'string' ? option : 'Neznm');\n      case 'lp_kod':\n        //  OPRAVA: Pout cislo_lp a nazev_uctu msto kod a nazev\n        return option.cislo_lp\n          ? `${option.cislo_lp} - ${option.nazev_uctu || 'Bez nzvu'}`\n          : `${option.id || option} - ${option.nazev_uctu || option.nazev || option.label || 'Bez nzvu'}`;\n      case 'druh_objednavky_kod':\n        //  OPRAVA: Pouvat nazev_stavu stejn jako u stedisek + indiktor majetku\n        const druhLabel = option.nazev_stavu || option.nazev || option.label || (typeof option === 'string' ? option : 'Neznm');\n        const isMajetek = option.atribut_objektu === 1 || option.atribut_objektu === '1';\n        // Pidat (majetek) tag malm psmem jako st labelu\n        return isMajetek ? `${druhLabel}   (majetek)` : druhLabel;\n      // Pro Orders25List compatibility\n      case 'statusFilter':\n        return option.nazev_stavu || option.nazev || option.popis || option.kod_stavu || option.kod || String(option);\n      case 'selectedObjednatel':\n      case 'selectedGarant':\n        return option.displayName || `${option.jmeno || ''} ${option.prijmeni || ''}`.trim() || 'Bez jmna';\n      case 'selectedSchvalovatel':\n        // Pokud je option null, 0 nebo przdn ID, vra \"Neznm\"\n        if (!option || option === 0 || option.id === 0 || option.user_id === 0 || option.id === null || option.user_id === null) {\n          return 'Neznm';\n        }\n        return option.displayName || option.jmeno_prijmeni || `${option.jmeno || ''} ${option.prijmeni || ''}`.trim() || 'Neznm';\n      case 'pageSize':\n        return option.label || String(option.value || option);\n      default:\n        //  FALLBACK: Pokud field zan na \"polozka_\" a kon na \"_lp\", je to LP poloky\n        if (field && typeof field === 'string' && field.startsWith('polozka_') && field.endsWith('_lp')) {\n          // LP pro poloky - pouij label nebo vytvoit z kod a nazev\n          return option.label || (option.kod && option.nazev ? `${option.kod} - ${option.nazev}` : String(option));\n        }\n        // Obecn fallback - pokud m option.label, pouij ho\n        return option.label || (typeof option === 'string' ? option : String(option));\n    }\n  }, []); // dn dependencies - funkce je ist zvisl na vstupnch parametrech\n\n  // React komponenty pro vlastn selecty\n  // CustomSelect wrapper - pouv globln komponentu\n  const CustomSelectLocal = (props) => (\n    <CustomSelect\n      {...props}\n      selectStates={selectStates}\n      setSelectStates={setSelectStates}\n      searchStates={searchStates}\n      setSearchStates={setSearchStates}\n      touchedSelectFields={touchedSelectFields}\n      setTouchedSelectFields={setTouchedSelectFields}\n      hasTriedToSubmit={hasTriedToSubmit}\n      toggleSelect={toggleSelect}\n      filterOptions={filterOptions}\n      getOptionLabel={getOptionLabel}\n    />\n  );\n\n  // Multi-select komponenta pro stediska\n  const MultiSelect = ({\n    values = [],\n    onChange,\n    options = [],\n    placeholder,\n    disabled = false,\n    hasError = false,\n    icon = null\n  }) => {\n    // Zajistit, e values je vdy pole\n    const safeValues = Array.isArray(values) ? values : [];\n    const isOpen = selectStates.strediska;\n    const searchTerm = searchStates.strediska;\n    const dropdownRef = useRef(null);\n    const buttonRef = useRef(null);\n    const searchInputRef = useRef(null);\n\n    const filteredOptions = filterOptions(options, searchTerm, 'strediska');\n\n    // Pozicovn pro fixed dropdown s optimalizovanm scroll handlerem\n    useEffect(() => {\n      if (isOpen && buttonRef.current && dropdownRef.current) {\n        const updatePosition = () => {\n          if (!buttonRef.current || !dropdownRef.current) return;\n          const buttonRect = buttonRef.current.getBoundingClientRect();\n          const dropdown = dropdownRef.current;\n\n          const dropdownMaxHeight = 300;\n          const footerHeight = 54; // Vka fixn patiky\n          const buffer = 20; // Extra buffer pro bezpenost\n          const spaceBelow = window.innerHeight - buttonRect.bottom - footerHeight - buffer;\n          const spaceAbove = buttonRect.top - buffer;\n          // Otevi nahoru pokud: nen dost msta dole NEBO je nahoe vrazn vce msta\n          const shouldOpenUpward = spaceBelow < 200 || (spaceBelow < dropdownMaxHeight && spaceAbove > spaceBelow + 50);\n\n          dropdown.style.left = buttonRect.left + 'px';\n          dropdown.style.width = buttonRect.width + 'px';\n          dropdown.style.maxHeight = dropdownMaxHeight + 'px';\n\n          if (shouldOpenUpward) {\n            // Otevt nahoru\n            dropdown.style.bottom = (window.innerHeight - buttonRect.top + 2) + 'px';\n            dropdown.style.top = 'auto';\n          } else {\n            // Otevt dol (standardn chovn)\n            dropdown.style.top = (buttonRect.bottom + 2) + 'px';\n            dropdown.style.bottom = 'auto';\n          }\n        };\n\n        updatePosition();\n\n        const handleScroll = (event) => {\n          // OPRAVA: Neaktualizovat pozici pi scrollu uvnit dropdown menu\n          if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\n            // Pro scroll cel strnky - okamit aktualizace bez throttling\n            updatePosition();\n          }\n        };\n\n        // Pouvat passive listener pro lep performance\n        window.addEventListener('scroll', handleScroll, { passive: true, capture: true });\n        window.addEventListener('resize', updatePosition, { passive: true });\n\n        return () => {\n          window.removeEventListener('scroll', handleScroll, { capture: true });\n          window.removeEventListener('resize', updatePosition);\n        };\n      }\n    }, [isOpen]);\n\n    // Auto-focus search inputu pi oteven (pouze prvn oteven)\n    useEffect(() => {\n      if (isOpen && searchInputRef.current) {\n        // Mal zpodn pro zajitn, e dropdown je u vyrendrovan\n        // Ale pouze pokud nen ji focused jin element v dropdown\n        setTimeout(() => {\n          if (searchInputRef.current && !document.activeElement?.closest('[data-custom-select]')) {\n            searchInputRef.current.focus();\n          }\n        }, 100);\n      }\n    }, [isOpen]);\n\n    const displayValue = safeValues.length > 0\n      ? safeValues.map(val => {\n          const option = options.find(opt => opt.value === val || opt === val);\n          return option ? getOptionLabel(option, 'strediska') : val;\n        }).join(', ')\n      : placeholder;\n\n    const handleToggleOption = (option) => {\n      const optionValue = option.value || option;\n      const newValues = safeValues.includes(optionValue)\n        ? safeValues.filter(v => v !== optionValue)\n        : [...safeValues, optionValue];\n\n      // Zachovat scroll pozici ped zmnou\n      const scrollPosition = dropdownRef.current?.scrollTop || 0;\n\n      onChange({ target: { value: newValues } });\n\n      // OPRAVA: Obnovit scroll pozici a focus bez skoku na zatek\n      requestAnimationFrame(() => {\n        if (dropdownRef.current) {\n          dropdownRef.current.scrollTop = scrollPosition;\n        }\n        if (searchInputRef.current) {\n          // Deaktivovat automatick focus, kter zpsobuje problmy\n          // searchInputRef.current.focus();\n        }\n      });\n    };\n\n    return (\n      <MultiSelectWrapper data-custom-select isOpen={isOpen}>\n        <MultiSelectButton\n          ref={buttonRef}\n          onClick={() => !disabled && toggleSelect('strediska')}\n          disabled={disabled}\n          hasError={hasError}\n          placeholder={safeValues.length === 0 ? \"true\" : \"false\"}\n          value={safeValues.length > 0 ? 'selected' : ''}\n          isOpen={isOpen}\n          data-field=\"strediska\"\n          tabIndex={disabled ? -1 : 0}\n          onKeyDown={(e) => {\n            if (!disabled && e.key === 'Enter') {\n              toggleSelect('strediska');\n            }\n          }}\n          hasIcon={!!icon}\n        >\n          {icon && <span style={{\n            position: 'absolute',\n            left: '12px',\n            color: '#9ca3af',\n            width: '16px',\n            height: '16px',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center'\n          }}>\n            {React.cloneElement(icon, { size: 16 })}\n          </span>}\n          <SelectedValue isEmpty={safeValues.length === 0} title={displayValue}>{displayValue}</SelectedValue>\n        </MultiSelectButton>\n\n        {isOpen && !disabled && (\n          <CustomSelectDropdown ref={dropdownRef}>\n            <SearchBox>\n              <SearchIcon>\n                <Search size={16} />\n              </SearchIcon>\n              <SearchInput\n                ref={searchInputRef}\n                type=\"text\"\n                placeholder=\"Vyhledat stedisko...\"\n                value={searchTerm}\n                onChange={(e) => setSearchStates(prev => ({\n                  ...prev,\n                  strediska: e.target.value\n                }))}\n                onKeyDown={(e) => {\n                  if (e.key === 'ArrowDown') {\n                    // ipka dol - pejdi na prvn option\n                    e.preventDefault();\n                    if (filteredOptions.length > 0) {\n                      const firstOption = dropdownRef.current?.querySelector('[role=\"option\"]');\n                      if (firstOption) {\n                        firstOption.focus();\n                      }\n                    }\n                  } else if (e.key === 'ArrowUp') {\n                    // ipka nahoru - pejdi na posledn option\n                    e.preventDefault();\n                    if (filteredOptions.length > 0) {\n                      const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]') || []);\n                      const lastOption = options[options.length - 1];\n                      if (lastOption) {\n                        lastOption.focus();\n                      }\n                    }\n                  } else if (e.key === 'Tab') {\n                    // Pokud je dropdown oteven, pejdi na prvn option msto zaven\n                    if (filteredOptions.length > 0) {\n                      e.preventDefault();\n                      const firstOption = dropdownRef.current?.querySelector('[class*=\"SelectOption\"]');\n                      if (firstOption) {\n                        firstOption.focus();\n                      }\n                    } else {\n                      // Pokud nejsou dn options, zavi dropdown a pokrauj na dal prvek\n                      toggleSelect('strediska');\n                    }\n                  } else if (e.key === 'Escape') {\n                    e.preventDefault();\n                    toggleSelect('strediska');\n                  } else if (e.key === 'Enter') {\n                    e.preventDefault();\n                    e.stopPropagation();\n                  }\n                }}\n              />\n            </SearchBox>\n\n            {filteredOptions.map((option, index) => {\n              const optionValue = option.value || option;\n              const isChecked = safeValues.includes(optionValue);\n\n              return (\n                <MultiSelectOption\n                  key={option.value || index}\n                  level={option.level || 0}\n                  tabIndex={0}\n                  role=\"option\"\n                  aria-selected={isChecked}\n                  onClick={(e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    handleToggleOption(option);\n                  }}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter' || e.key === ' ') {\n                      e.preventDefault();\n                      handleToggleOption(option);\n                    } else if (e.key === 'ArrowDown') {\n                      // ipka dol - pejdi na dal option\n                      e.preventDefault();\n                      const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]') || []);\n                      const currentIdx = options.indexOf(e.target);\n                      const nextIdx = currentIdx + 1;\n                      if (nextIdx < options.length) {\n                        options[nextIdx].focus();\n                      } else {\n                        // Cyklicky na zatek\n                        options[0]?.focus();\n                      }\n                    } else if (e.key === 'ArrowUp') {\n                      // ipka nahoru - pejdi na pedchoz option\n                      e.preventDefault();\n                      const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]') || []);\n                      const currentIdx = options.indexOf(e.target);\n                      const prevIdx = currentIdx - 1;\n                      if (prevIdx >= 0) {\n                        options[prevIdx].focus();\n                      } else {\n                        // Cyklicky zpt do search inputu\n                        if (searchInputRef.current) {\n                          searchInputRef.current.focus();\n                        } else {\n                          options[options.length - 1]?.focus();\n                        }\n                      }\n                    } else if (e.key === 'Escape') {\n                      e.preventDefault();\n                      toggleSelect('strediska');\n                    } else if (e.key === 'Tab') {\n                      // Tab navigace v rmci dropdownu\n                      const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]') || []);\n                      const currentIdx = options.indexOf(e.target);\n\n                      if (e.shiftKey) {\n                        // Shift+Tab - pokud jsme na prvn option, vra se na search input\n                        if (currentIdx === 0) {\n                          e.preventDefault();\n                          if (searchInputRef.current) {\n                            searchInputRef.current.focus();\n                          }\n                        }\n                      } else {\n                        // Tab - pokud jsme na posledn option, zavi dropdown\n                        if (currentIdx === options.length - 1) {\n                          e.preventDefault();\n                          toggleSelect('strediska');\n                        }\n                      }\n                    }\n                  }}\n                >\n                  <input\n                    type=\"checkbox\"\n                    checked={isChecked}\n                    readOnly\n                  />\n                  <span>\n                    {getOptionLabel(option, 'strediska')}\n                  </span>\n                </MultiSelectOption>\n              );\n            })}\n\n            {filteredOptions.length === 0 && (\n              <CustomSelectOption>dn vsledky</CustomSelectOption>\n            )}\n          </CustomSelectDropdown>\n        )}\n      </MultiSelectWrapper>\n    );\n  };\n\n  // Clicked outside handler\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      // Zavt vechny selecty pi kliknut mimo\n      if (!event.target.closest('[data-custom-select]')) {\n        closeAllSelects();\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, []);\n\n  // AUTOSAVE JE VYPNUT - ukldn pouze pi onBlur (handleFieldBlur)\n  // Pvodn useEffect s debouncem byl odstrann, aby se autosave nespoutl pi kad zmn\n  // Autosave se nyn spout POUZE pi ztrt fokusu input pole (viz handleFieldBlur)\n\n  //  TAB NAVIGATION HANDLER - inteligentn navigace pouze po viditelnch a ne-disabled prvcch\n  const handleFormKeyDown = useCallback((e) => {\n    if (e.key !== 'Tab') return;\n\n    // Najdi aktuln fokusnut prvek\n    const activeElement = document.activeElement;\n\n    // Pokud jsme v otevenm dropdownu, nech dropdown zvldat tab sm\n    const isInDropdown = activeElement?.closest('[class*=\"Dropdown\"]') ||\n                        activeElement?.closest('[class*=\"SelectDropdown\"]') ||\n                        activeElement?.closest('[class*=\"TemplateDropdown\"]');\n\n    if (isInDropdown) {\n      // Nechme dropdown zvldat tab navigaci\n      return;\n    }\n\n    // Zskej ScrollableContent kontejner - pouze prvky uvnit nj\n    const formContainer = document.querySelector('[class*=\"ScrollableContent\"]');\n    if (!formContainer) return;\n\n    // Kontrola zda je aktivn prvek uvnit formule\n    if (!formContainer.contains(activeElement)) {\n      // Pokud jsme mimo formul, nech prohle zvldat tab normln\n      return;\n    }\n\n    const focusableSelectors = [\n      'input:not([disabled]):not([tabindex=\"-1\"])',\n      'textarea:not([disabled]):not([tabindex=\"-1\"])',\n      'select:not([disabled]):not([tabindex=\"-1\"])',\n      'button:not([disabled]):not([tabindex=\"-1\"])',\n      '[tabindex]:not([tabindex=\"-1\"]):not([disabled])',\n      '[data-field]:not([disabled]):not([tabindex=\"-1\"])'\n    ].join(',');\n\n    const allElements = Array.from(formContainer.querySelectorAll(focusableSelectors));\n\n    // Filtruj pouze viditeln prvky (offsetParent !== null znamen e je prvek viditeln)\n    const visibleElements = allElements.filter(el => {\n      // Kontrola viditelnosti\n      if (!el.offsetParent && el.tagName !== 'INPUT' && el.tagName !== 'TEXTAREA') {\n        return false;\n      }\n\n      // Kontrola zda nen skryt pomoc display: none nebo visibility: hidden\n      const style = window.getComputedStyle(el);\n      if (style.display === 'none' || style.visibility === 'hidden') {\n        return false;\n      }\n\n      // Kontrola zda nen disabled (i kdy u mme v selektoru, dvojit kontrola)\n      if (el.disabled || el.getAttribute('aria-disabled') === 'true') {\n        return false;\n      }\n\n      return true;\n    });\n\n    if (visibleElements.length === 0) return;\n\n    // Najdi index aktulnho prvku\n    const currentIndex = visibleElements.indexOf(activeElement);\n\n    if (currentIndex === -1) {\n      // Pokud aktuln prvek nen v seznamu, fokusni prvn prvek\n      e.preventDefault();\n      visibleElements[0]?.focus();\n      return;\n    }\n\n    // Vypotej nov index podle smru (Tab vs Shift+Tab)\n    let newIndex;\n    if (e.shiftKey) {\n      // Shift+Tab - jdi zpt\n      newIndex = currentIndex - 1;\n      if (newIndex < 0) {\n        newIndex = visibleElements.length - 1; // Cyklicky na konec\n      }\n    } else {\n      // Tab - jdi vped\n      newIndex = currentIndex + 1;\n      if (newIndex >= visibleElements.length) {\n        newIndex = 0; // Cyklicky na zatek\n      }\n    }\n\n    // Fokusni nov prvek\n    e.preventDefault();\n    visibleElements[newIndex]?.focus();\n\n    // Pokud je to dropdown button, NEOTEVREJ ho automaticky - uivatel me pout Enter\n    // Toto zjednoduuje UX - tab jen naviguje, Enter otvr\n  }, []);\n\n  //  ZAKOMENTOVNO: Tento useEffect zpsobuje PEPSN validanch chyb!\n  // Problm: Po validateFormForSave() (kter vytvo vechny chyby vetn lokac),\n  // se tento useEffect spust (kvli zmn hasTriedToSubmit z falsetrue) a zavol\n  // validateWorkflowData(), kter NEVALIDUJE lokalizan pole (sek, budova, mstnost).\n  // Tm dojde k PEPSN validationErrors objektem BEZ lokalizanch chyb!\n  //  EEN: Live validace nen poteba - validujeme pouze pi kliknut na \"Uloit\"\n  //            ve funkci validateFormForSave(), kter validuje VE vetn lokac.\n  /*\n  useEffect(() => {\n    // KRITICK: Spus validaci pouze pokud uivatel u se pokusil odeslat formul!\n    if (currentPhase >= 2 && formData.id && hasTriedToSubmit) {\n      // Mal zpodn aby se stihly pepotat vechny derived values\n      const timeout = setTimeout(() => {\n        const validationWorkflowCode = mainWorkflowState;\n        const errors = validateWorkflowData(formData, validationWorkflowCode);\n        setValidationErrors(errors);\n      }, 100);\n\n      return () => clearTimeout(timeout);\n    }\n  }, [currentPhase, mainWorkflowState, formData.id, hasTriedToSubmit]);\n  */\n\n  //  NOV LOADING GATE: Souhrn vech natn pro RACE CONDITION FIX\n  // Tato promnn uruje, zda jsou vechna potebn data pipravena\n  const isFormLoading = React.useMemo(() => {\n    // 1. Pokud se nataj selnky, formul NEN pipraven\n    if (isLoadingCiselniky) {\n      return true;\n    }\n\n    // 2. Pokud se nataj data formule (editace NEBO nov objednvka s draftem), formul NEN pipraven\n    if (isLoadingFormData) {\n      return true;\n    }\n\n    // 3. Vechna data jsou pipravena!\n    return false;\n  }, [isLoadingCiselniky, isLoadingFormData]);\n\n  //  AUTH GATE: Pokud nen token/username, zobrazit loading a pokat\n  // MUS BT A PO VECH HOOKS (React Rules of Hooks)\n  if (!token || !username) {\n    return (\n      <LoadingOverlay $visible={true}>\n        <LoadingSpinner $visible={true} />\n        <LoadingMessage $visible={true}>Ovuji pihlen...</LoadingMessage>\n        <LoadingSubtext $visible={true}>ekm na autentizaci...</LoadingSubtext>\n      </LoadingOverlay>\n    );\n  }\n  //       <LoadingMessage $visible={true}>\n  //         {isLoadingCiselniky && !isLoadingFormData && 'Natm selnky...'}\n  //         {isLoadingCiselniky && isLoadingFormData && 'Natm selnky a data objednvky...'}\n  //         {!isLoadingCiselniky && isLoadingFormData && 'Natm data objednvky...'}\n  //       </LoadingMessage>\n  //       <LoadingSubtext $visible={true}>\n  //         {isLoadingCiselniky && 'Zpracovvm seznamy pro vbrov pole...'}\n  //         {!isLoadingCiselniky && isLoadingFormData && 'Zpracovvm data z databze...'}\n  //       </LoadingSubtext>\n  //     </LoadingOverlay>\n  //   );\n  // }\n\n  //  NOV LOADING GATE: Zobrazit splash screen dokud nen lifecycle.isReady\n  // d useFormController lifecycle phases: MOUNTING  LOADING_DICTIONARIES  READY\n\n  if (!lifecycle.isReady) {\n    return (\n      <LoadingOverlay $visible={true}>\n        <LoadingSpinner $visible={true} />\n        <LoadingMessage $visible={true}>\n          {lifecycle.phase === 'MOUNTING' && 'Inicializuji formul...'}\n          {lifecycle.phase === 'LOADING_DICTIONARIES' && 'Natm selnky...'}\n          {lifecycle.phase === 'READY_FOR_DATA' && 'Pipravuji data...'}\n          {lifecycle.phase === 'LOADING_DATA' && 'Natm data objednvky...'}\n          {lifecycle.phase === 'DATA_LOADED' && 'Dokonuji natn...'}\n          {lifecycle.phase === 'READY' && 'Pipravuji formul...'}\n          {!lifecycle.phase && 'Natm formul objednvky'}\n        </LoadingMessage>\n        <LoadingSubtext $visible={true}>\n          {!dictionaries.isReady && `Natm ${dictionaries.loadedCount || 0}/${dictionaries.totalToLoad || 8} selnk...`}\n          {dictionaries.isReady && lifecycle.isLoadingFormData && 'Natm data objednvky...'}\n          {dictionaries.isReady && !lifecycle.isLoadingFormData && !lifecycle.isReady && 'Zpracovvm data...'}\n        </LoadingSubtext>\n      </LoadingOverlay>\n    );\n  }\n  //       <LoadingMessage $visible={true}>Natm formul objednvky</LoadingMessage>\n  //       <LoadingSubtext $visible={true}>Zpracovvm data z databze...</LoadingSubtext>\n  //     </LoadingOverlay>\n  //   );\n  // }\n\n  // Error state pi inicializaci\n  if (initializationError && !token) {\n    return (\n      <Container isFullscreen={isFullscreen}>\n        <div style={{ padding: '2rem', textAlign: 'center' }}>\n          <ErrorMessage>\n            Chyba inicializace: {initializationError}\n          </ErrorMessage>\n        </div>\n      </Container>\n    );\n  }\n\n  // Obsah formule\n  const formContent = (\n    <Container isFullscreen={isFullscreen}>\n      {/*  Plovouc navigtor po sekcch formule */}\n      <FloatingNavigator\n        onSectionClick={handleNavigatorSectionClick}\n        onFilesDrop={handleNavigatorFilesDrop}\n        onToggleSections={handleToggleSections}\n        areSectionsCollapsed={areSectionsCollapsed}\n        currentPhase={getCurrentPhase()}\n        validationErrors={validationErrors}\n        formData={navigatorFormData}\n        isFullscreen={isFullscreen}\n        isSectionActive={isSectionActive}\n        allSectionStates={extendedSectionStates}\n        isWorkflowCompleted={isWorkflowCompleted}\n        canPublishRegistry={canPublishRegistry}\n        canUnlockAnything={canUnlockAnything}\n        onSaveAsTemplate={handleSaveAsTemplate}\n        onGenerateDocx={handleGenerateDocx}\n        onToggleFullscreen={() => setIsFullscreen(!isFullscreen)}\n        canGenerateDocx={canGenerateDocx() && !isOrderCompleted}\n        canSaveTemplate={!showSaveProgress && !isSaving && !!token && !!user_id && !isOrderCompleted}\n        serverTemplates={serverTemplates}\n        savedTemplates={savedTemplates}\n        templatesLoading={templatesLoading}\n        searchQuery={searchPredefs}\n        showSearch={showSearchPredefs}\n        token={token}\n        hasPermission={hasPermission}\n        onTemplateSearch={setSearchPredefs}\n        onToggleTemplateSearch={() => setShowSearchPredefs(s => !s)}\n        onRefreshTemplates={fetchAndMergeTemplates}\n        onFillPoApproval={fillPoApprovalSaved}\n        onFillDetails={fillAllFieldsSaved}\n        canFillTemplate={!isOrderCompleted}\n        onCopyTemplateToUser={copyPredefinedToUser}\n        onCopyTemplateToGlobal={copyUserTemplateToGlobal}\n        onShowTemplatePreview={showTemplatePreview}\n        onDeleteTemplate={(template) => { setTemplatePendingDelete(template); setShowDeleteTemplateConfirm(true); }}\n        onEditTemplateName={startEditingTemplateName}\n        editingTemplateId={editingTemplateId}\n        editingTemplateName={editingTemplateName}\n        matchesTemplateQuery={matchesTemplateQuery}\n        isArchived={isArchived}\n      />\n\n      {/*  Indiktor hlasovho nahrvn je v Layout.js - globln pro celou aplikaci */}\n\n      {/* Varovn pi sten chyb inicializace */}\n      {initializationError && (\n        <ErrorMessage style={{ margin: '1rem' }}>\n          sten chyba pi natn dat: {initializationError}\n        </ErrorMessage>\n      )}\n\n      <FormWrapper>\n        {/* Fixn hlavika */}\n        <FixedHeader ref={fixedHeaderRef}>\n          <FixedHeaderContent>\n            {/* Hlavika formule */}\n            <FormHeader>\n              <HeaderLeft>\n                <TitleWithButtons>\n                  <HeaderTitle\n                    title={isEditMode && formData.ev_cislo ? `Editace objednvky ev.. ${formData.ev_cislo}` : ''}\n                  >\n                    Objednvka\n                    {formData.id && (\n                      <span className=\"order-id-badge\"> #{formData.id}</span>\n                    )}\n                  </HeaderTitle>\n                  {/*  ablony pesunuty do FloatingNavigator toolbaru */}\n                </TitleWithButtons>\n\n                {/*  Souhrn cen vedle nadpisu */}\n                {maxPrice > 0 && (\n                  <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '8px',\n                    padding: '4px 10px',\n                    marginLeft: '0.5rem',\n                    background: isPriceExceeded\n                      ? 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)'\n                      : 'linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)',\n                    border: `2px solid ${isPriceExceeded ? '#fca5a5' : '#bbf7d0'}`,\n                    borderRadius: '6px',\n                    fontSize: '0.75rem',\n                    fontWeight: 600,\n                    color: isPriceExceeded ? '#991b1b' : '#166534',\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\n                    whiteSpace: 'nowrap'\n                  }}>\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '1px', alignItems: 'flex-start' }}>\n                      <div style={{ fontSize: '0.6rem', opacity: 0.8, fontWeight: 500 }}>MAX CENA</div>\n                      <div style={{ fontSize: '0.85rem', fontWeight: 700 }}>\n                        {maxPrice.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K\n                      </div>\n                    </div>\n                    <div style={{ fontSize: '14px', fontWeight: 'bold', opacity: 0.5 }}></div>\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '1px', alignItems: 'flex-end' }}>\n                      <div style={{ fontSize: '0.6rem', opacity: 0.8, fontWeight: 500 }}>SOUET POLOEK</div>\n                      <div style={{ fontSize: '0.85rem', fontWeight: 700 }}>\n                        {totalPrice.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </HeaderLeft>\n\n              {/* EV. SLO a slo objednvky - vpravo */}\n              <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'flex-end' }}>\n                  <div style={{ fontSize: '12px', color: '#666', marginBottom: '2px' }}>\n                    {isOrderSavedToDB ? 'EV. SLO' : 'PEDPOKLDAN EV. SLO'}\n                  </div>\n                  {/* Status informace - pod EV. SLO */}\n                  {(lastAutoSave || isAutoSaving || dataSource) && (\n                    <div style={{\n                      fontSize: '10px',\n                      color: '#666',\n                      padding: '2px 6px',\n                      borderRadius: '4px',\n                      textAlign: 'right',\n                      backgroundColor: isAutoSaving\n                        ? '#fef2f2'  //  erven pi ukldn\n                        : dataSource === 'database'\n                          ? '#eff6ff'  //  modr pro DB\n                          : dataSource === 'concept'\n                            ? '#fefbf2'  //  lut pro koncept\n                            : '#f0fdf4', //  zelen pro auto-save\n                      border: `1px solid ${\n                        isAutoSaving\n                          ? '#fca5a5'  // erven\n                          : dataSource === 'database'\n                            ? '#bfdbfe'  // modr\n                            : dataSource === 'concept'\n                              ? '#fed7aa'  // oranov\n                              : '#bbf7d0'  // zelen\n                      }`,\n                      transition: 'all 0.2s ease'\n                    }}>\n                      {isAutoSaving ? (\n                        <span style={{ color: '#dc2626' }}> Ukldn konceptu...</span>\n                      ) : dataSource === 'database' ? (\n                        <span style={{ color: '#2563eb' }}> Nateno z DB</span>\n                      ) : dataSource === 'concept' ? (\n                        <span style={{ color: '#d97706' }}> Formul naten z Konceptu</span>\n                      ) : lastAutoSave ? (\n                        <>\n                          <span style={{ color: '#16a34a' }}> {isOrderSavedToDB ? 'Uloeno' : 'Koncept'}</span> {new Date(lastAutoSave).toLocaleTimeString('cs-CZ', {\n                            hour: '2-digit',\n                            minute: '2-digit',\n                            second: '2-digit'\n                          })}\n                        </>\n                      ) : null}\n                    </div>\n                  )}\n                </div>\n                <EvidenceNumber>\n                  <EvidenceValue $isEmergency={formData.mimoradna_udalost || false}>\n                    {/* API next-number vrac next_order_string nebo order_number_string */}\n                    {/*  DLEIT: Toto slo je POUZE pro ZOBRAZEN! */}\n                    {/* Backend si pidl finln slo pi CREATE - my ho NIKDY neposlme */}\n                    {isLoadingEvCislo ? (\n                      <span style={{\n                        color: '#666',\n                        fontStyle: 'italic',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem'\n                      }}>\n                        <Spinner />\n                        Natm...\n                      </span>\n                    ) : !isValidEvCislo(formData.ev_cislo) ? (\n                      <span style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem',\n                        color: '#d97706'\n                      }}>\n                        <FontAwesomeIcon icon={faExclamationTriangle} style={{ color: '#f59e0b' }} />\n                        <span style={{ fontSize: '13px' }}>Natn selhalo</span>\n                        <RetryButton\n                          onClick={(e) => {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            loadNextOrderNumber();\n                          }}\n                          title=\"Zkusit nast ev. slo znovu\"\n                        >\n                           Zkusit znovu\n                        </RetryButton>\n                      </span>\n                    ) : typeof formData.ev_cislo === 'object' ? (\n                      formData.ev_cislo?.next_order_string ||\n                      formData.ev_cislo?.order_number_string ||\n                      formData.ev_cislo?.next_number ||\n                      'Natm...'\n                    ) : (\n                      formData.ev_cislo || 'Natm...'\n                    )}\n                  </EvidenceValue>\n                </EvidenceNumber>\n              </div>\n            </FormHeader>\n\n            {/*  ERPN LP - zobrazit v hlavice nad fz */}\n            {(() => {\n              // Zobrazit kdy mme LP financovn\n              const selectedSource = financovaniOptions.find(opt => opt.kod_stavu === formData.zpusob_financovani || opt.kod === formData.zpusob_financovani);\n              const nazev = selectedSource?.nazev_stavu || selectedSource?.nazev || '';\n              const hasLPFinancing = (nazev.includes('Limitovan') || nazev.includes('pslib')) && Array.isArray(formData.lp_kod) && formData.lp_kod.length > 0;\n              \n              if (!hasLPFinancing) return null;\n              \n              return (\n                <div style={{\n                  marginTop: '0.75rem',\n                  marginBottom: '3px',\n                  padding: '0.5rem 0.75rem',\n                  background: 'linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)',\n                  border: '1px solid #93c5fd',\n                  borderRadius: '6px',\n                  fontSize: '0.7rem',\n                  display: 'flex',\n                  flexWrap: 'wrap',\n                  gap: '0.5rem',\n                  alignItems: 'center'\n                }}>\n                  {formData.lp_kod.map(lp_id => {\n                    const detail = lpDetails[lp_id];\n                    if (!detail) return null;\n                    \n                    //  Vybrat sprvn typ erpn podle fze\n                    let zbyva, typCerpani, aktualneCerpani;\n                    \n                    if (currentPhase <= 2) {\n                      // Fze 1-2: Pomrn rozdlen MAX CENY mezi vybran LP\n                      const maxCena = parseFloat(formData.max_cena_s_dph) || 0;\n                      const pocetLP = formData.lp_kod.length;\n                      const pomernaCast = pocetLP > 0 ? maxCena / pocetLP : 0;\n                      \n                      const rezervace = parseFloat(detail.zbyva_rezervace || 0);\n                      zbyva = rezervace - pomernaCast;\n                      aktualneCerpani = pomernaCast;\n                      typCerpani = 'Rezervace';\n                    } else if (currentPhase >= 3 && currentPhase <= 6) {\n                      // Fze 3-6: Pedpokldan erpn (souet poloek)\n                      zbyva = parseFloat(detail.zbyva_predpoklad || 0);\n                      typCerpani = 'Pedpoklad';\n                    } else {\n                      // Fze 7-8: Skuten erpn (faktury)\n                      zbyva = parseFloat(detail.zbyva_skutecne || 0);\n                      typCerpani = 'Skuten';\n                    }\n                    \n                    const isNegative = zbyva < 0;\n                    const lpOption = lpKodyOptions.find(opt => (opt.id || opt.kod) === lp_id);\n                    const lpCislo = lpOption?.cislo_lp || lp_id;\n                    const lpNazev = lpOption?.nazev_uctu || lpOption?.nazev || '';\n                    \n                    // Zskat informaci o sprvci z detail (pokud je naten)\n                    const spravce = detail?.spravce;\n                    const spravceText = spravce ? `${spravce.jmeno || ''} ${spravce.prijmeni || ''}`.trim() : '';\n                    const tooltipText = [\n                      lpNazev ? `${lpCislo} - ${lpNazev}` : lpCislo,\n                      spravceText ? `PO: ${spravceText}` : ''\n                    ].filter(Boolean).join('\\n');\n                    \n                    return (\n                      <div key={lp_id} style={{\n                        padding: '0.3rem 0.6rem',\n                        background: isNegative ? '#fee2e2' : 'white',\n                        border: `1px solid ${isNegative ? '#fca5a5' : '#bfdbfe'}`,\n                        borderRadius: '4px',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.4rem',\n                        fontSize: '0.7rem'\n                      }}>\n                        <div \n                          style={{ fontWeight: 700, color: '#1e40af', fontSize: '0.7rem', cursor: 'help' }}\n                          title={tooltipText}\n                        >\n                          {lpCislo}\n                        </div>\n                        <div style={{ fontWeight: 700, color: isNegative ? '#dc2626' : '#059669', fontSize: '0.7rem' }}>\n                          {zbyva < 0 && ''}\n                          {Math.abs(zbyva).toLocaleString('cs-CZ', { minimumFractionDigits: 0, maximumFractionDigits: 0 })} K\n                        </div>\n                        {currentPhase <= 2 && aktualneCerpani > 0 && (\n                          <>\n                            <div style={{ fontSize: '0.65rem', opacity: 0.7, color: '#64748b' }}>\n                              {aktualneCerpani.toLocaleString('cs-CZ', { minimumFractionDigits: 0, maximumFractionDigits: 0 })} K\n                            </div>\n                            <div \n                              style={{ fontSize: '0.65rem', opacity: 0.7, color: '#64748b', cursor: 'help' }}\n                              title='Rezervace - MAX CENA rozdlen pomrn mezi vybran LP'\n                            >\n                              (R)\n                            </div>\n                          </>\n                        )}\n                        {currentPhase >= 3 && (\n                          <div \n                            style={{ fontSize: '0.65rem', opacity: 0.7, color: '#64748b', cursor: 'help' }}\n                            title={currentPhase >= 3 && currentPhase <= 6 ? 'Pedpokldan erpn podle piazench poloek' : 'Skuten erpn podle faktur'}\n                          >\n                            ({currentPhase >= 3 && currentPhase <= 6 ? 'P' : 'S'})\n                          </div>\n                        )}\n                      </div>\n                    );\n                  })}\n                </div>\n              );\n            })()}\n\n            {/* dek s fz a akcemi NEBO zelen info box pro dokonenou objednvku NEBO erven pro zamtnutou NEBO oranov pro stornovanou */}\n            {isWorkflowRejected ? (\n              //  erven info box pro zamtnutou objednvku\n              <div style={{\n                padding: '1rem 1.5rem',\n                marginTop: '1rem',\n                backgroundColor: '#fee2e2',\n                border: '2px solid #dc2626',\n                borderRadius: '8px',\n                display: 'flex',\n                alignItems: 'flex-start',\n                gap: '1rem',\n                fontWeight: '600',\n                color: '#991b1b'\n              }}>\n                <Lock size={20} style={{ marginTop: '0.25rem', flexShrink: 0 }} />\n                <div style={{ flex: 1 }}>\n                  <div style={{ marginBottom: '0.5rem', fontSize: '1.1rem' }}>\n                     Objednvka zamtnuta\n                  </div>\n                  {formData.schvaleni_komentar && (\n                    <div style={{ fontWeight: 'normal', fontSize: '0.875rem', marginBottom: '0.5rem' }}>\n                      <strong>Dvod zamtnut:</strong> {formData.schvaleni_komentar}\n                    </div>\n                  )}\n                  {formData.schvalovatel_id && (\n                    <div style={{ fontWeight: 'normal', fontSize: '0.875rem' }}>\n                      <strong>Zamtl:</strong> {getUserNameById(formData.schvalovatel_id)}\n                      {formData.dt_schvaleni && `  ${new Date(formData.dt_schvaleni).toLocaleDateString('cs-CZ')} ${new Date(formData.dt_schvaleni).toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' })}`}\n                    </div>\n                  )}\n                </div>\n                {/* Tlatka vpravo */}\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem', flexShrink: 0 }}>\n                  <ActionButton\n                    className=\"cancel-btn\"\n                    onClick={handleCancelOrder}\n                    title=\"Zavt formul a vrtit se na seznam objednvek\"\n                    style={{\n                      padding: '0.5rem 1rem',\n                      fontSize: '0.875rem',\n                      backgroundColor: '#dc2626',\n                      color: 'white',\n                      border: 'none',\n                      borderRadius: '6px',\n                      cursor: 'pointer',\n                      fontWeight: '600',\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '0.5rem',\n                      whiteSpace: 'nowrap',\n                      transition: 'background-color 0.2s'\n                    }}\n                    onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#b91c1c'}\n                    onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#dc2626'}\n                  >\n                    <FontAwesomeIcon icon={faTimes} />\n                    Zavt\n                  </ActionButton>\n                  {/*  Tlatko Odemknout pro admin/ORDER_MANAGE */}\n                  {canUnlockAnything && (\n                    <ActionButton\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        setShowUnlockPhase2Confirm(true);\n                      }}\n                      title=\"Odemknout zamtnutou objednvku (vrtit na FZI 2 - ODESLANA_KE_SCHVALENI)\"\n                      style={{\n                        padding: '0.5rem 1rem',\n                        fontSize: '0.875rem',\n                        backgroundColor: '#f59e0b',\n                        color: 'white',\n                        border: 'none',\n                        borderRadius: '6px',\n                        cursor: 'pointer',\n                        fontWeight: '600',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem',\n                        whiteSpace: 'nowrap',\n                        transition: 'background-color 0.2s'\n                      }}\n                      onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#d97706'}\n                      onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#f59e0b'}\n                    >\n                      <Unlock size={16} />\n                      Odemknout\n                    </ActionButton>\n                  )}\n                </div>\n              </div>\n            ) : isWorkflowCancelled ? (\n              //  Oranov info box pro stornovanou objednvku\n              <div style={{\n                padding: '1rem 1.5rem',\n                marginTop: '1rem',\n                backgroundColor: '#fff7ed',\n                border: '2px solid #f97316',\n                borderRadius: '8px',\n                display: 'flex',\n                alignItems: 'flex-start',\n                gap: '1rem',\n                fontWeight: '600',\n                color: '#9a3412'\n              }}>\n                <Lock size={20} style={{ marginTop: '0.25rem', flexShrink: 0 }} />\n                <div style={{ flex: 1 }}>\n                  <div style={{ marginBottom: '0.5rem', fontSize: '1.1rem' }}>\n                     Objednvka stornovna\n                  </div>\n                  {formData.odeslani_storno_duvod && (\n                    <div style={{ fontWeight: 'normal', fontSize: '0.875rem', marginBottom: '0.5rem' }}>\n                      <strong>Dvod stornovn:</strong> {formData.odeslani_storno_duvod}\n                    </div>\n                  )}\n                  {formData.odesilatel_id && (\n                    <div style={{ fontWeight: 'normal', fontSize: '0.875rem' }}>\n                      <strong>Stornoval:</strong> {getUserNameById(formData.odesilatel_id)}\n                      {formData.dt_odeslani && `  ${new Date(formData.dt_odeslani).toLocaleDateString('cs-CZ')} ${new Date(formData.dt_odeslani).toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' })}`}\n                    </div>\n                  )}\n                </div>\n                {/* Tlatka vpravo */}\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem', flexShrink: 0 }}>\n                  <ActionButton\n                    className=\"cancel-btn\"\n                    onClick={handleCancelOrder}\n                    title=\"Zavt formul a vrtit se na seznam objednvek\"\n                    style={{\n                      padding: '0.5rem 1rem',\n                      fontSize: '0.875rem',\n                      backgroundColor: '#f97316',\n                      color: 'white',\n                      border: 'none',\n                      borderRadius: '6px',\n                      cursor: 'pointer',\n                      fontWeight: '600',\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '0.5rem',\n                      whiteSpace: 'nowrap',\n                      transition: 'background-color 0.2s'\n                    }}\n                    onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#ea580c'}\n                    onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#f97316'}\n                  >\n                    <FontAwesomeIcon icon={faTimes} />\n                    Zavt\n                  </ActionButton>\n                  {canUnlockAnything && (\n                    <ActionButton\n                      className=\"unlock-btn\"\n                      onClick={() => setShowUnlockStornoConfirm(true)}\n                      title=\"Odemknout stornovanou objednvku\"\n                      style={{\n                        padding: '0.5rem 1rem',\n                        fontSize: '0.875rem',\n                        backgroundColor: '#f97316',\n                        color: 'white',\n                        border: 'none',\n                        borderRadius: '6px',\n                        cursor: 'pointer',\n                        fontWeight: '600',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem',\n                        whiteSpace: 'nowrap',\n                        transition: 'background-color 0.2s'\n                      }}\n                      onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#ea580c'}\n                      onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#f97316'}\n                    >\n                      <Unlock size={16} />\n                      Odemknout\n                    </ActionButton>\n                  )}\n                </div>\n              </div>\n            ) : isWorkflowCompleted ? (\n              //  Zelen info box pro dokonenou objednvku\n              <div style={{\n                padding: '1rem 1.5rem',\n                marginTop: '1rem',\n                backgroundColor: '#dcfce7',\n                border: '2px solid #16a34a',\n                borderRadius: '8px',\n                display: 'flex',\n                alignItems: 'flex-start',\n                gap: '1rem',\n                fontWeight: '600',\n                color: '#166534'\n              }}>\n                <Lock size={20} style={{ marginTop: '0.25rem', flexShrink: 0 }} />\n                <div style={{ flex: 1 }}>\n                  <div style={{ marginBottom: '0.5rem' }}>\n                     Objednvka byla spn dokonena. Vechny kroky byly splnny.\n                  </div>\n                  {formData.dokoncil_id && (\n                    <div style={{ fontWeight: 'normal', fontSize: '0.875rem' }}>\n                      <strong>Dokonil:</strong> {getUserNameById(formData.dokoncil_id)}\n                      {formData.dt_dokonceni && `  ${new Date(formData.dt_dokonceni).toLocaleDateString('cs-CZ')} ${new Date(formData.dt_dokonceni).toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' })}`}\n                    </div>\n                  )}\n                </div>\n\n                {/* Tlatka vpravo - POD sebou */}\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem', flexShrink: 0 }}>\n                  <ActionButton\n                    className=\"cancel-btn\"\n                    onClick={handleCancelOrder}\n                    title=\"Zavt formul a vrtit se na seznam objednvek\"\n                    style={{\n                      padding: '0.5rem 1rem',\n                      fontSize: '0.875rem',\n                      backgroundColor: '#16a34a',\n                      color: 'white',\n                      border: 'none',\n                      borderRadius: '6px',\n                      cursor: 'pointer',\n                      fontWeight: '600',\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '0.5rem',\n                      whiteSpace: 'nowrap',\n                      transition: 'background-color 0.2s'\n                    }}\n                    onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#15803d'}\n                    onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#16a34a'}\n                  >\n                    <FontAwesomeIcon icon={faTimes} />\n                    Zavt\n                  </ActionButton>\n\n                  {/*  Tlatko Odemknout pro admin/ORDER_MANAGE - POD tlatkem Zavt */}\n                  {canUnlockAnything && (\n                    <ActionButton\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        setShowUnlockDokonceniConfirm(true);\n                      }}\n                      title=\"Odemknout dokonenou objednvku (vrtit na FZI 8 - ZKONTROLOVANA)\"\n                      style={{\n                        padding: '0.5rem 1rem',\n                        fontSize: '0.875rem',\n                        backgroundColor: '#f59e0b',\n                        color: 'white',\n                        border: 'none',\n                        borderRadius: '6px',\n                        cursor: 'pointer',\n                        fontWeight: '600',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem',\n                        whiteSpace: 'nowrap',\n                        transition: 'background-color 0.2s'\n                      }}\n                      onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#d97706'}\n                      onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#f59e0b'}\n                    >\n                      <Unlock size={16} />\n                      Odemknout\n                    </ActionButton>\n                  )}\n                </div>\n              </div>\n            ) : (\n            //  Standardn dek s fz a akcemi\n            <PhaseRow>\n              <div style={{ display: 'flex', alignItems: 'center', gap: '2rem', flex: 1 }}>\n                <PhaseProgressContainer>\n                  <PhaseText>\n                    {(() => {\n                      // Pouv novou 8-fzovou logiku\n                      if (formData.stav_stornovano || hasWorkflowState(formData.stav_workflow_kod, 'ZRUSENA')) {\n                        return \"Stornovan objednvka\";\n                      }\n\n                      // Pouit currentPhase z getCurrentPhase()\n                      const phaseLabels = {\n                        1: isChanged ? \"Fze 1/8: Koncept\" : \"Fze 1/8: Nov objednvka\",\n                        2: \"Fze 2/8: Ke schvlen\",\n                        3: \"Fze 3/8: Schvlen objednvka\",\n                        4: \"Fze 4/8: Dodavatel + Registr\",\n                        5: \"Fze 5/8: Vyplnn registru\",\n                        6: \"Fze 6/8: Fakturace\",\n                        7: \"Fze 7/8: Vcn sprvnost\",\n                        8: \"Fze 8/8: Zkontrolovno\"\n                      };\n\n                      return phaseLabels[currentPhase] || (isChanged ? \"Fze 1/8: Koncept\" : \"Fze 1/8: Nov objednvka\");\n                    })()}\n                  </PhaseText>\n\n                  {/* Progresn barevn indiktor */}\n                  <PhaseProgressBar>\n                    {phaseProgressOverride.phases.map((phase, index) => (\n                      <PhaseSegment key={phase.id}>\n                        <PhaseSegmentFill\n                          className={phase.fillClass}\n                          style={{\n                            opacity: phase.isVisible ? 1 : 0.15,\n                            transform: phase.isVisible ? 'scaleX(1)' : 'scaleX(0.1)',\n                            transformOrigin: 'left'\n                          }}\n                        />\n                      </PhaseSegment>\n                    ))}\n                  </PhaseProgressBar>\n                </PhaseProgressContainer>\n\n                {/*  Zbvajc stka Smlouvy - zobrazit pouze pokud je vybrn zpsob \"Smlouva\" */}\n                {(() => {\n                  const selectedSource = financovaniOptions.find(opt => opt.kod === formData.zpusob_financovani);\n                  const nazev = selectedSource?.nazev || '';\n                  const isSmlouvaActive = nazev.includes('Smlouva');\n                  return isSmlouvaActive;\n                })() && formData.cislo_smlouvy && smlouvaDetail && !smlouvaDetail.notFound && !loadingSmlouvaDetail && (\n                  (() => {\n                    const celkovaCastka = parseFloat(\n                      smlouvaDetail.hodnota_s_dph || \n                      smlouvaDetail.celkova_castka || \n                      0\n                    );\n                    const cerpano = parseFloat(\n                      smlouvaDetail.cerpano_celkem ||\n                      smlouvaDetail.cerpano || \n                      0\n                    );\n                    \n                    //  Vpoet rezervovan stky podle fze objednvky\n                    let rezervovanaCastka = 0;\n                    \n                    // Pro EDITOVANOU objednvku (m ID) ve fzi 7-8:\n                    // Backend ji m tuto objednvku zapotanou v cerpano_celkem\n                    // Proto neodetme znovu, jinak bychom odeetli dvakrt!\n                    const jeUlozenaObjednavka = formData.id && formData.id > 0;\n                    const jeVeFazi78 = currentPhase >= 7; // VECNA_SPRAVNOST, DOKONCENA\n                    \n                    if (!jeUlozenaObjednavka || !jeVeFazi78) {\n                      // Pro NOVOU objednvku NEBO pro objednvku ped fz 7-8:\n                      // Odetme rezervovanou stku\n                      \n                      const isPhase12 = currentPhase <= 2; // NOVA, KE_SCHVALENI\n                      const isPhase36 = currentPhase >= 3 && currentPhase <= 6; // SCHVALENA a FAKTURACE\n                      \n                      if (isPhase12) {\n                        // Fze 1-2: Rezervovat max_cena_s_dph\n                        rezervovanaCastka = parseFloat(formData.max_cena_s_dph || 0);\n                      } else if (isPhase36) {\n                        // Fze 3-6: Rezervovat souet poloek objednvky\n                        if (formData.polozky_objednavky && Array.isArray(formData.polozky_objednavky) && formData.polozky_objednavky.length > 0) {\n                          rezervovanaCastka = formData.polozky_objednavky.reduce((sum, polozka) => {\n                            //  FIX: Odstranit formtovn ped parseFloat\n                            const cena = parseFloat((polozka.cena_s_dph || polozka.celkova_cena || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\n                            const mnozstvi = parseFloat(polozka.mnozstvi || 1);\n                            return sum + (cena * mnozstvi);\n                          }, 0);\n                        }\n                        // Pokud nejsou poloky nebo je souet 0, pouij max_cena_s_dph\n                        if (rezervovanaCastka === 0) {\n                          rezervovanaCastka = parseFloat(formData.max_cena_s_dph || 0);\n                        }\n                      } else if (jeVeFazi78) {\n                        // Fze 7-8 pro NOVOU objednvku: Rezervovat skutenou stku z faktur\n                        if (formData.faktury && Array.isArray(formData.faktury)) {\n                          rezervovanaCastka = formData.faktury.reduce((sum, faktura) => {\n                            return sum + parseFloat(faktura.celkova_castka || faktura.castka || 0);\n                          }, 0);\n                        }\n                      }\n                    }\n                    \n                    // Zbvajc stka = celkov stka smlouvy - erpno - rezervovno (pokud nen zapotno)\n                    const zbyva = celkovaCastka - cerpano - rezervovanaCastka;\n                    const isNegative = zbyva < 0;\n                    \n                    return (\n                      <div style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '8px',\n                        padding: '4px 10px',\n                        background: isNegative\n                          ? 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)'\n                          : 'linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)',\n                        border: `2px solid ${isNegative ? '#fca5a5' : '#86efac'}`,\n                        borderRadius: '6px',\n                        fontSize: '0.75rem',\n                        fontWeight: 600,\n                        color: isNegative ? '#991b1b' : '#15803d',\n                        boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\n                        whiteSpace: 'nowrap'\n                      }}>\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1px', alignItems: 'flex-end' }}>\n                          <div style={{ fontSize: '0.6rem', opacity: 0.8, fontWeight: 500 }}>\n                            SMLOUVA {formData.cislo_smlouvy}\n                          </div>\n                          <div style={{ fontSize: '0.85rem', fontWeight: 700 }}>\n                            {Math.abs(zbyva).toLocaleString('cs-CZ', { minimumFractionDigits: 0, maximumFractionDigits: 0 })} K\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })()\n                )}\n              </div>\n              <PhaseDivider />\n\n              <FormActions>\n                <ActionButton\n                  className=\"save-btn\"\n                  onClick={handleSaveOrder}\n                  disabled={\n                    isSaving ||\n                    showSaveProgress ||\n                    !canSaveOrder ||\n                    (isWorkflowCompleted && !canUnlockAnything) ||\n                    isLoadingEvCislo ||  //  EEN #1: Blokovat bhem loading\n                    !isValidEvCislo(formData.ev_cislo)  //  EEN #3: Blokovat pokud nen platn\n                  }\n                  title={\n                    isLoadingEvCislo\n                      ? 'Nat se evidenn slo...'\n                      : !isValidEvCislo(formData.ev_cislo)\n                        ? 'Evidenn slo se nepodailo nast'\n                        : (isWorkflowCompleted && !canUnlockAnything)\n                          ? 'Objednvka je dokonena/zamtnuta/stornovna a uzamena'\n                          : !canSaveOrder\n                            ? 'Nemte oprvnn k ukldn objednvek'\n                            : 'Uloit objednvku'\n                  }\n                >\n                  <FontAwesomeIcon icon={faSave} />\n                  {isLoadingEvCislo ? 'Natm slo...' : isSaving ? 'Ukldm...' : 'ULOIT'}\n                </ActionButton>\n\n                <ActionButton\n                  className=\"cancel-btn\"\n                  onClick={handleCancelOrder}\n                  title=\"Zavt formul\"\n                  disabled={showSaveProgress || isSaving}\n                >\n                  <FontAwesomeIcon icon={faTimes} />\n                  ZAVT\n                </ActionButton>\n              </FormActions>\n            </PhaseRow>\n            )}\n\n            {/* Progress indiktor po uloen objednvky */}\n            {showSaveProgress && (\n              <div style={{\n                padding: '1rem',\n                backgroundColor: '#f0f9ff',\n                borderTop: '1px solid #0ea5e9',\n                borderBottom: '1px solid #0ea5e9',\n              }}>\n                <div style={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: '1rem',\n                  marginBottom: '0.75rem'\n                }}>\n                  <div style={{\n                    fontSize: '1.5rem'\n                  }}>\n                    \n                  </div>\n                  <div>\n                    <div style={{\n                      fontWeight: '600',\n                      color: '#0c4a6e',\n                      fontSize: '1rem',\n                      marginBottom: '0.25rem'\n                    }}>\n                      Objednvka byla spn uloena!\n                    </div>\n                    <div style={{\n                      color: '#075985',\n                      fontSize: '0.875rem'\n                    }}>\n                      {saveProgressText}\n                    </div>\n                  </div>\n                </div>\n\n                {/* Progress bar */}\n                <div style={{\n                  width: '100%',\n                  height: '8px',\n                  backgroundColor: '#e0f2fe',\n                  borderRadius: '4px',\n                  overflow: 'hidden'\n                }}>\n                  <div style={{\n                    width: `${saveProgress}%`,\n                    height: '100%',\n                    backgroundColor: '#0ea5e9',\n                    transition: 'width 2s linear',\n                    borderRadius: '4px'\n                  }} />\n                </div>\n\n                <div style={{\n                  marginTop: '0.5rem',\n                  fontSize: '0.75rem',\n                  color: '#0369a1',\n                  textAlign: 'center'\n                }}>\n                  Pesmrovvm na seznam objednvek...\n                </div>\n              </div>\n            )}\n          </FixedHeaderContent>\n        </FixedHeader>\n\n        {/* Scrollovateln obsah s tab navigac */}\n        <ScrollableContent ref={scrollableContentRef} onKeyDown={handleFormKeyDown}>\n          <ScrollableInner>\n\n          {/* Sekce: Informace o objednateli */}\n          <FormSection data-section=\"objednatel\">\n        <SectionHeader\n          sectionTheme={getSectionTheme('objednatel')}\n          isActive={isSectionActive('objednatel')}\n        >\n          <SectionTitle sectionTheme={getSectionTheme('objednatel')}>\n            <SectionIcon sectionTheme={getSectionTheme('objednatel')}>\n              <FontAwesomeIcon icon={faUser} />\n            </SectionIcon>\n            Informace o objednateli\n            {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n            {shouldLockPhase1Sections && !shouldLockAllSections && (\n              <LockWarning title=\"FZE 1 a FZE 2 sekce jsou zameny pokud je aktivn FZE 3. Odemen resetuje workflow na ODESLNA KE SCHVLEN a vymae data FZE 3+.\">\n                 Sekce zamena\n              </LockWarning>\n            )}\n          </SectionTitle>\n          <SectionControls>\n            {/*  Nezobrazovat tlatko odemknut kdy je globln lock (shouldLockAllSections) */}\n            {shouldLockPhase1Sections && !shouldLockAllSections && canEditApprovedSections && (\n              <UnlockButton\n                onClick={(e) => {\n                  e.stopPropagation();\n                  setShowUnlockPhase1Confirm(true);\n                }}\n                title=\"Odemknout FZI 2 (Info o objednateli) - resetuje workflow na ODESLNA KE SCHVLEN\"\n              >\n                <Unlock />\n              </UnlockButton>\n            )}\n            <CollapseIcon\n              collapsed={sectionStates.objednatel}\n              sectionTheme={getSectionTheme('objednatel')}\n              onClick={() => toggleSection('objednatel')}\n              style={{ cursor: 'pointer' }}\n            >\n              <FontAwesomeIcon icon={faChevronUp} />\n            </CollapseIcon>\n          </SectionControls>\n        </SectionHeader>\n        <SectionContent collapsed={sectionStates.objednatel}>\n          <FormRow>\n            <FormGroup>\n              <Label required>JMNO</Label>\n              <InputWithIcon hasIcon>\n                <User />\n                <Input\n                  type=\"text\"\n                  name=\"jmeno\"\n                  placeholder=\"Jmno objednatele\"\n                  value={formData.jmeno || ''}\n                  disabled\n                  title={isEditMode ? \"Nateno z DB podle objednatele objednvky\" : (formData.jmeno ? \"Nateno z profilu pihlenho uivatele\" : \"Vypln se automaticky pi prvn interakci\")}\n                  hasError={!!validationErrors.jmeno}\n                  hasIcon\n                />\n              </InputWithIcon>\n              {validationErrors.jmeno && (\n                <ErrorText>{validationErrors.jmeno}</ErrorText>\n              )}\n            </FormGroup>\n            <FormGroup>\n              <Label required>E-MAIL</Label>\n              <InputWithIcon hasIcon>\n                <Mail />\n                <Input\n                  type=\"email\"\n                  name=\"email\"\n                  value={formData.email || ''}\n                  disabled\n                  title={isEditMode ? \"Nateno z DB podle objednatele objednvky\" : (formData.email ? \"Nateno z profilu pihlenho uivatele\" : \"Vypln se automaticky pi prvn interakci\")}\n                  hasError={!!validationErrors.email}\n                  hasIcon\n                />\n              </InputWithIcon>\n              {validationErrors.email && (\n                <ErrorText>{validationErrors.email}</ErrorText>\n              )}\n            </FormGroup>\n            <FormGroup>\n              <Label>TELEFON</Label>\n              <InputWithIcon hasIcon>\n                <Phone />\n                <Input\n                  type=\"tel\"\n                  value={formData.telefon || ''}\n                  disabled\n                  placeholder={formData.telefon ? '' : (isEditMode ? \"Telefon nen v DB uveden\" : \"Vypln se automaticky pi prvn interakci\")}\n                  title={isEditMode ? \"Nateno z DB podle objednatele objednvky\" : (formData.telefon ? \"Nateno z profilu pihlenho uivatele\" : \"Vypln se automaticky pi prvn interakci\")}\n                  hasIcon\n                />\n              </InputWithIcon>\n            </FormGroup>\n          </FormRow>\n          <FormRow>\n            <FormGroup data-custom-select>\n              <LabelWithClear>\n                <LabelText required>GARANT</LabelText>\n                <ClearSelectButton\n                  type=\"button\"\n                  $visible={!!formData.garant_uzivatel_id}\n                  onClick={() => handleInputChange('garant_uzivatel_id', '')}\n                  title=\"Vymazat vbr\"\n                >\n                  <X size={12} />\n                </ClearSelectButton>\n              </LabelWithClear>\n              <StableCustomSelect\n                value={formData.garant_uzivatel_id || ''}\n                onChange={(selectedValue) => handleInputChange('garant_uzivatel_id', selectedValue)}\n                onBlur={(field, value) => handleFieldBlur('garant_uzivatel_id', value)}\n                options={garantOptions}\n                placeholder=\"Vyberte garanta\"\n                disabled={shouldLockPhase1Sections}\n                hasError={!!validationErrors.garant_uzivatel_id}\n                required={true}\n                field=\"garant\"\n                loading={false}\n                loadingText=\"\"\n                icon={<User />}\n                getOptionLabel={getOptionLabel}\n                getOptionValue={(option, field) => option.id || option.user_id || option}\n                hasTriedToSubmit={hasTriedToSubmit}\n              />\n              {(validationErrors.garant_uzivatel_id || (hasTriedToSubmit && !formData.garant_uzivatel_id)) && (\n                <ErrorText>\n                  {validationErrors.garant_uzivatel_id || 'Garant je povinn'}\n                </ErrorText>\n              )}\n            </FormGroup>\n          </FormRow>\n        </SectionContent>\n      </FormSection>\n\n      {/* Sekce: Schvlen nkupu PO */}\n      <FormSection data-section=\"schvaleni\">\n        <SectionHeader\n          sectionTheme={getSectionTheme('schvaleni')}\n          isActive={isSectionActive('schvaleni')}\n        >\n          <SectionTitle sectionTheme={getSectionTheme('schvaleni')}>\n            <SectionIcon sectionTheme={getSectionTheme('schvaleni')}>\n              <FontAwesomeIcon icon={faClipboardCheck} />\n            </SectionIcon>\n            Schvlen nkupu PO\n            {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n            {shouldLockPhase1Sections && !shouldLockAllSections && (\n              <LockWarning title=\"FZE 1 a FZE 2 sekce jsou zameny pokud je aktivn FZE 3. Odemen umon editaci FZE 1 a 2.\">\n                 Sekce zamena\n              </LockWarning>\n            )}\n          </SectionTitle>\n          <SectionControls>\n            {/*  Nezobrazovat tlatko odemknut kdy je globln lock (shouldLockAllSections) */}\n            {shouldLockPhase1Sections && !shouldLockAllSections && canEditApprovedSections && (\n              <UnlockButton\n                onClick={(e) => {\n                  e.stopPropagation();\n                  setShowUnlockPhase2Confirm(true);\n                }}\n                title=\"Odemknout FZI 2 (PO sekce) - resetuje workflow na ODESLNA KE SCHVLEN\"\n              >\n                <Unlock />\n              </UnlockButton>\n            )}\n            <CollapseIcon\n              collapsed={sectionStates.schvaleni}\n              sectionTheme={getSectionTheme('schvaleni')}\n              onClick={() => toggleSection('schvaleni')}\n              style={{ cursor: 'pointer' }}\n            >\n              <FontAwesomeIcon icon={faChevronUp} />\n            </CollapseIcon>\n          </SectionControls>\n        </SectionHeader>\n        <SectionContent collapsed={sectionStates.schvaleni}>\n          <FormRow>\n            <FormGroup style={{gridColumn: '1 / -1'}}>\n              <Label required>PEDMT</Label>\n              <InputWithIcon hasIcon>\n                <FileText />\n                <Input\n                  type=\"text\"\n                  name=\"predmet\"\n                  placeholder=\"Zadejte pedmt objednvky\"\n                  value={formData.predmet || ''}\n                  onChange={(e) => handleInputChange('predmet', e.target.value)}\n                  onBlur={() => handleFieldBlur('predmet', formData.predmet)}\n                  disabled={shouldLockPhase1Sections}\n                  hasError={!!validationErrors.predmet}\n                  hasIcon\n                />\n              </InputWithIcon>\n              {validationErrors.predmet && (\n                <ErrorText>{validationErrors.predmet}</ErrorText>\n              )}\n            </FormGroup>\n          </FormRow>\n          <FormRow>\n            <FormGroup data-custom-select>\n              <LabelWithClear>\n                <LabelText required>PKAZCE</LabelText>\n                <ClearSelectButton\n                  type=\"button\"\n                  $visible={!!formData.prikazce_id}\n                  onClick={() => handleInputChange('prikazce_id', '')}\n                  title=\"Vymazat vbr\"\n                >\n                  <X size={12} />\n                </ClearSelectButton>\n              </LabelWithClear>\n              <StableCustomSelect\n                value={formData.prikazce_id || ''}\n                onChange={(selectedValue) => handleInputChange('prikazce_id', selectedValue)}\n                onBlur={(field, value) => handleFieldBlur('prikazce_id', value)}\n                options={approvers}\n                placeholder=\"Vyberte pkazce operace\"\n                disabled={shouldLockPhase1Sections}\n                hasError={!!validationErrors.prikazce_id}\n                required={true}\n                field=\"prikazce\"\n                loading={false}\n                loadingText=\"\"\n                icon={<Users />}\n                getOptionLabel={getOptionLabel}\n                getOptionValue={(option, field) => option.id || option.user_id || option}\n                hasTriedToSubmit={hasTriedToSubmit}\n              />\n              {(validationErrors.prikazce_id || (hasTriedToSubmit && !formData.prikazce_id)) && (\n                <ErrorText>\n                  {validationErrors.prikazce_id || 'Pkazce je povinn'}\n                </ErrorText>\n              )}\n            </FormGroup>\n            <FormGroup>\n              <Label required>MAXIMLN CENA S DPH</Label>\n              <CurrencyInput\n                fieldName=\"max_cena_s_dph\"\n                value={formData.max_cena_s_dph || ''}\n                onChange={handleCurrencyChange}\n                onBlur={handleFieldBlur}\n                disabled={shouldLockPhase1Sections}\n                hasError={!!validationErrors.max_cena_s_dph}\n                placeholder=\"380 000 K\"\n              />\n              {validationErrors.max_cena_s_dph && (\n                <ErrorText>{validationErrors.max_cena_s_dph}</ErrorText>\n              )}\n            </FormGroup>\n            <FormGroup>\n              <Label>MIMODN UDLOST</Label>\n              <EmergencyToggleWrapper disabled={shouldLockPhase1Sections} style={{ height: '50px' }}>\n                <EmergencyToggleSwitch \n                  checked={formData.mimoradna_udalost || false}\n                  disabled={shouldLockPhase1Sections}\n                  >\n                  <input\n                    type=\"checkbox\"\n                    checked={formData.mimoradna_udalost || false}\n                    onChange={(e) => handleInputChange('mimoradna_udalost', e.target.checked)}\n                    disabled={shouldLockPhase1Sections}\n                  />\n                  <span />\n                </EmergencyToggleSwitch>\n                <EmergencyToggleLabel checked={formData.mimoradna_udalost || false}>\n                  {formData.mimoradna_udalost ? 'Krize / Havrie' : 'Bn objednvka'}\n                </EmergencyToggleLabel>\n              </EmergencyToggleWrapper>\n            </FormGroup>\n          </FormRow>\n          <FormRow>\n            <FormGroup data-custom-select style={{gridColumn: '1 / -1'}}>\n              <LabelWithClear>\n                <LabelText required>STEDISKO</LabelText>\n                <ClearSelectButton\n                  type=\"button\"\n                  $visible={Array.isArray(formData.strediska_kod) && formData.strediska_kod.length > 0}\n                  onClick={() => handleInputChange('strediska_kod', [])}\n                  title=\"Vymazat vbr\"\n                >\n                  <X size={12} />\n                </ClearSelectButton>\n              </LabelWithClear>\n              <StableCustomSelect\n                value={formData.strediska_kod || []}\n                onChange={(selectedValues) => handleInputChange('strediska_kod', selectedValues)}\n                onBlur={(field, value) => handleFieldBlur('strediska_kod', value)}\n                options={strediskaOptions}\n                placeholder=\"Vyberte stediska pro objednvku\"\n                field=\"strediska\"\n                disabled={shouldLockPhase1Sections}\n                hasError={!!validationErrors.strediska_kod}\n                required={true}\n                multiple={true}\n                icon={<Building />}\n                getOptionLabel={getOptionLabel}\n                getOptionValue={(option, field) => option.value || option.id || option}\n                hasTriedToSubmit={hasTriedToSubmit}\n              />\n              {validationErrors.strediska_kod && (\n                <ErrorText style={{ marginTop: '0.5rem', display: 'block' }}>\n                  {validationErrors.strediska_kod}\n                </ErrorText>\n              )}\n            </FormGroup>\n          </FormRow>\n\n          {/*  Sekce: Financovn objednvky - PESUNUTO Z FZE 3 DO FZE 1/2 */}\n          <FormRow style={{ marginTop: '1.5rem' }}>\n            <FormGroup style={{gridColumn: '1 / -1'}}>\n              {/* ediv oddlovac linka NAD sekc financovn */}\n              <div style={{\n                borderTop: '1px solid #d1d5db',\n                marginBottom: '1.5rem'\n              }} />\n\n              <FormRow>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  <LabelWithClear>\n                    <LabelText required>ZPSOB FINANCOVN</LabelText>\n                    <ClearSelectButton\n                      type=\"button\"\n                      $visible={!!formData.zpusob_financovani}\n                      onClick={() => handleInputChange('zpusob_financovani', '')}\n                      title=\"Vymazat vbr\"\n                    >\n                      <X size={12} />\n                    </ClearSelectButton>\n                  </LabelWithClear>\n                  <StableCustomSelect\n                    value={formData.zpusob_financovani || ''}\n                    onChange={(selectedValue) => handleInputChange('zpusob_financovani', selectedValue)}\n                    onBlur={(field, value) => handleFieldBlur('zpusob_financovani', value)}\n                    options={financovaniOptions}\n                    placeholder=\"Vyberte zdroj financovn...\"\n                    field=\"zpusob_financovani\"\n                    loading={false}\n                    loadingText=\"\"\n                    icon={<Coins />}\n                    disabled={shouldLockFinancovaniSection}\n                    hasError={!!validationErrors.zpusob_financovani}\n                    required={true}\n                    getOptionLabel={getOptionLabel}\n                    getOptionValue={(option, field) => option.kod_stavu || option.kod || option.id || option}\n                  />\n                  {validationErrors.zpusob_financovani && (\n                    <ErrorText>{validationErrors.zpusob_financovani}</ErrorText>\n                  )}\n                </FormGroup>\n              </FormRow>\n\n              {/* LP KD - zobrazit pouze kdy je vybran Limitovan pslib */}\n              {(() => {\n                const selectedSource = financovaniOptions.find(opt => opt.kod_stavu === formData.zpusob_financovani || opt.kod === formData.zpusob_financovani);\n                const nazev = selectedSource?.nazev_stavu || selectedSource?.nazev || '';\n                return nazev.includes('Limitovan') || nazev.includes('pslib');\n              })() && (\n                <FormRow>\n                  <FormGroup style={{gridColumn: '1 / -1'}}>\n                    <LabelWithClear>\n                      <LabelText required>LP KD</LabelText>\n                      <ClearSelectButton\n                        type=\"button\"\n                        $visible={Array.isArray(formData.lp_kod) && formData.lp_kod.length > 0}\n                        onClick={() => handleInputChange('lp_kod', [])}\n                        title=\"Vymazat vbr\"\n                      >\n                        <X size={12} />\n                      </ClearSelectButton>\n                    </LabelWithClear>\n                    <StableCustomSelect\n                      value={formData.lp_kod || []}\n                      onChange={(selectedValues) => handleInputChange('lp_kod', selectedValues)}\n                      onBlur={(field, value) => handleFieldBlur('lp_kod', value)}\n                      options={filteredLpKodyOptions}\n                      placeholder={(() => {\n                        if (!formData.prikazce_id) return \"Nejprve vyberte pkazce\";\n                        if (filteredLpKodyOptions.length === 0) return \"dn dostupn LP kdy\";\n                        \n                        // Zobrazit prvnch 4-5 LP kd\n                        const maxShow = 5;\n                        const lpCodes = filteredLpKodyOptions\n                          .slice(0, maxShow)\n                          .map(lp => lp.cislo_lp || lp.kod)\n                          .join(', ');\n                        \n                        const hasMore = filteredLpKodyOptions.length > maxShow;\n                        return hasMore ? `nap. ${lpCodes}, ...` : `nap. ${lpCodes}`;\n                      })()}\n                      field=\"lp_kod\"\n                      loading={false}\n                      loadingText=\"\"\n                      icon={<Hash />}\n                      disabled={shouldLockFinancovaniSection || !formData.prikazce_id}\n                      hasError={!!validationErrors.lp_kod}\n                      required={true}\n                      multiple={true}\n                      getOptionLabel={getOptionLabel}\n                      // getOptionValue ODEBRN - pouij default (opt.id || opt.value || opt)\n                    />\n                    {validationErrors.lp_kod && (\n                      <ErrorText>{validationErrors.lp_kod}</ErrorText>\n                    )}\n                  </FormGroup>\n                </FormRow>\n              )}\n\n              {(() => {\n                const selectedSource = financovaniOptions.find(opt => opt.kod === formData.zpusob_financovani);\n                const nazev = selectedSource?.nazev || '';\n                return nazev.includes('Smlouva');\n              })() && (\n                <>\n                  <FormRow style={{gridTemplateColumns: '1fr 2fr'}}>\n                    <FormGroup>\n                      <Label required>SLO SMLOUVY</Label>\n                      <SmlouvaAutocompleteContainer>\n                        <InputWithIcon hasIcon style={\n                          formData.cislo_smlouvy && smlouvaDetail && !smlouvaDetail.notFound && \n                          (smlouvaDetail.stav === 'VYPRSELA' || smlouvaDetail.stav === 'UKONCENA')\n                            ? { border: '2px solid #f97316', borderRadius: '6px' }\n                            : {}\n                        }>\n                          <Search />\n                          <Input\n                            type=\"text\"\n                            name=\"cislo_smlouvy\"\n                            placeholder=\"Zante pst slo smlouvy...\"\n                            value={smlouvaSearchTerm}\n                            onChange={(e) => {\n                              const value = e.target.value;\n                              setSmlouvaSearchTerm(value);\n                              setShowSmlouvySuggestions(value.length > 0);\n                              setSelectedSmlouvaSuggestionIndex(-1);\n                              \n                              // Pokud uivatel mae text, vyistit i formData\n                              if (!value) {\n                                handleInputChange('cislo_smlouvy', '');\n                              }\n                            }}\n                            onKeyDown={(e) => {\n                              if (!showSmlouvySuggestions) return;\n                              \n                              const searchLower = normalizeText(smlouvaSearchTerm);\n                              const filtered = smlouvyList.filter(s => {\n                                if (s.aktivni == 0 || s.aktivni === false) return false;\n                                const cislo = normalizeText(s.cislo_smlouvy || s.evidencni_cislo || '');\n                                const nazev = normalizeText(s.nazev_smlouvy || s.predmet || '');\n                                const firma = normalizeText(s.nazev_firmy || '');\n                                const ico = normalizeText(s.ico || '');\n                                const usek = normalizeText(s.usek_zkr || '');\n                                return cislo.includes(searchLower) || \n                                       nazev.includes(searchLower) || \n                                       firma.includes(searchLower) || \n                                       ico.includes(searchLower) || \n                                       usek.includes(searchLower);\n                              }).slice(0, 10);\n                              \n                              if (e.key === 'ArrowDown') {\n                                e.preventDefault();\n                                setSelectedSmlouvaSuggestionIndex(prev => \n                                  prev < filtered.length - 1 ? prev + 1 : prev\n                                );\n                              } else if (e.key === 'ArrowUp') {\n                                e.preventDefault();\n                                setSelectedSmlouvaSuggestionIndex(prev => \n                                  prev > 0 ? prev - 1 : -1\n                                );\n                              } else if (e.key === 'Enter' && selectedSmlouvaSuggestionIndex >= 0) {\n                                e.preventDefault();\n                                const selected = filtered[selectedSmlouvaSuggestionIndex];\n                                if (selected) {\n                                  const cislo = selected.cislo_smlouvy || selected.evidencni_cislo;\n                                  handleInputChange('cislo_smlouvy', cislo);\n                                  setSmlouvaSearchTerm(cislo);\n                                  setShowSmlouvySuggestions(false);\n                                  setSelectedSmlouvaSuggestionIndex(-1);\n                                }\n                              } else if (e.key === 'Escape') {\n                                setShowSmlouvySuggestions(false);\n                                setSelectedSmlouvaSuggestionIndex(-1);\n                              }\n                            }}\n                            onFocus={() => {\n                              // Zobrazit suggestions pi focusu, pokud u m njak search term\n                              if (smlouvaSearchTerm && smlouvaSearchTerm.length > 0) {\n                                setShowSmlouvySuggestions(true);\n                              }\n                            }}\n                            onBlur={(e) => {\n                              // Delay hiding to allow click on suggestion\n                              setTimeout(() => {\n                                setShowSmlouvySuggestions(false);\n                                setSelectedSmlouvaSuggestionIndex(-1);\n                                \n                                //  VALIDACE: Pokud search term neodpovd dn aktivn smlouv, vyistit pole\n                                const searchValue = smlouvaSearchTerm.trim();\n                                if (searchValue) {\n                                  const existsInList = smlouvyList.some(s => \n                                    (s.aktivni !== 0 && s.aktivni !== false) &&\n                                    (s.cislo_smlouvy === searchValue || s.evidencni_cislo === searchValue)\n                                  );\n                                  \n                                  if (existsInList) {\n                                    // Je platn smlouva - zajistit, e je uloen do formData\n                                    if (formData.cislo_smlouvy !== searchValue) {\n                                      handleInputChange('cislo_smlouvy', searchValue);\n                                    }\n                                  } else {\n                                    // Nevybral dnou platnou smlouvu - vyistit\n                                    handleInputChange('cislo_smlouvy', '');\n                                    setSmlouvaSearchTerm('');\n                                    showToast('Vyberte prosm smlouvu ze seznamu', 'warning');\n                                  }\n                                }\n                              }, 200);\n                            }}\n                            disabled={shouldLockFinancovaniSection}\n                            hasError={!!validationErrors.cislo_smlouvy}\n                            hasIcon\n                          />\n                        </InputWithIcon>\n                        \n                        {/* Autocomplete dropdown */}\n                        {showSmlouvySuggestions && smlouvaSearchTerm && smlouvaSearchTerm.length > 0 && (\n                          <SmlouvaSuggestionsList>\n                            {(() => {\n                              const searchLower = normalizeText(smlouvaSearchTerm);\n                              //  FILTR: Vylouit neaktivn smlouvy (aktivni == 0)\n                              const filtered = smlouvyList.filter(s => {\n                                // Vylouit neaktivn (aktivni == 0)\n                                if (s.aktivni == 0 || s.aktivni === false) return false;\n                                \n                                const cislo = normalizeText(s.cislo_smlouvy || s.evidencni_cislo || '');\n                                const nazev = normalizeText(s.nazev_smlouvy || s.predmet || '');\n                                const firma = normalizeText(s.nazev_firmy || '');\n                                const ico = normalizeText(s.ico || '');\n                                const usek = normalizeText(s.usek_zkr || '');\n                                \n                                return cislo.includes(searchLower) || \n                                       nazev.includes(searchLower) || \n                                       firma.includes(searchLower) || \n                                       ico.includes(searchLower) || \n                                       usek.includes(searchLower);\n                              }).slice(0, 10);\n\n                              if (loadingSmlouvyList) {\n                                return (\n                                  <SmlouvaSuggestionEmpty>\n                                     Natm smlouvy...\n                                  </SmlouvaSuggestionEmpty>\n                                );\n                              }\n\n                              if (filtered.length === 0) {\n                                return (\n                                  <SmlouvaSuggestionEmpty>\n                                     dn smlouva nenalezena\n                                  </SmlouvaSuggestionEmpty>\n                                );\n                              }\n\n                              return filtered.map((smlouva, index) => {\n                                //  Kontrola vypren smlouvy\n                                const jeVyprsela = smlouva.stav === 'VYPRSELA' || smlouva.stav === 'UKONCENA';\n                                const isSelected = index === selectedSmlouvaSuggestionIndex;\n                                \n                                return (\n                                  <SmlouvaSuggestionItem\n                                    key={smlouva.id}\n                                    onMouseDown={(e) => {\n                                      // onMouseDown se spust PED onBlur inputu, take hodnota se nastav vas\n                                      e.preventDefault(); // Zabrn blur eventu\n                                      const cislo = smlouva.cislo_smlouvy || smlouva.evidencni_cislo;\n                                      handleInputChange('cislo_smlouvy', cislo);\n                                      setSmlouvaSearchTerm(cislo);\n                                      setShowSmlouvySuggestions(false);\n                                      setSelectedSmlouvaSuggestionIndex(-1);\n                                    }}\n                                    style={{\n                                      ...(jeVyprsela ? { borderLeft: '3px solid #f97316', opacity: 0.8 } : {}),\n                                      ...(isSelected ? { backgroundColor: '#eff6ff', borderLeft: '3px solid #3b82f6' } : {})\n                                    }}\n                                  >\n                                    <SmlouvaSuggestionTitle>\n                                      {smlouva.cislo_smlouvy || smlouva.evidencni_cislo}\n                                      {jeVyprsela && <span style={{ color: '#f97316', marginLeft: '8px', fontSize: '0.85em' }}> VYPRELA</span>}\n                                    </SmlouvaSuggestionTitle>\n                                    <SmlouvaSuggestionMeta>\n                                      {smlouva.nazev_smlouvy && <span>{smlouva.nazev_smlouvy}</span>}\n                                      {smlouva.celkova_castka && (\n                                        <span>\n                                          {new Intl.NumberFormat('cs-CZ', { \n                                            style: 'currency', \n                                            currency: 'CZK',\n                                            minimumFractionDigits: 0,\n                                            maximumFractionDigits: 0\n                                          }).format(smlouva.celkova_castka)}\n                                        </span>\n                                      )}\n                                    </SmlouvaSuggestionMeta>\n                                    {smlouva.nazev_firmy && (\n                                      <SmlouvaSuggestionMeta style={{ fontSize: '0.8em', color: '#6b7280', marginTop: '2px' }}>\n                                        <span> {smlouva.nazev_firmy}{smlouva.ico ? ` (${smlouva.ico})` : ''}{smlouva.usek_zkr ? ` | ${smlouva.usek_zkr}` : ''}</span>\n                                      </SmlouvaSuggestionMeta>\n                                    )}\n                                  </SmlouvaSuggestionItem>\n                                );\n                              });\n                            })()}\n                          </SmlouvaSuggestionsList>\n                        )}\n                      </SmlouvaAutocompleteContainer>\n                      \n                      {validationErrors.cislo_smlouvy && (\n                        <ErrorText>{validationErrors.cislo_smlouvy}</ErrorText>\n                      )}\n                    </FormGroup>\n                    <FormGroup>\n                      <Label>POZNMKA KE SMLOUV</Label>\n                      <InputWithIcon hasIcon>\n                        <FileText />\n                        <Input\n                          type=\"text\"\n                          name=\"smlouva_poznamka\"\n                          placeholder=\"Dodaten informace o smlouv\"\n                          value={formData.smlouva_poznamka || ''}\n                          onChange={(e) => handleInputChange('smlouva_poznamka', e.target.value)}\n                          onBlur={() => handleFieldBlur('smlouva_poznamka', formData.smlouva_poznamka)}\n                          disabled={shouldLockFinancovaniSection}\n                          hasError={!!validationErrors.smlouva_poznamka}\n                          hasIcon\n                        />\n                      </InputWithIcon>\n                      {validationErrors.smlouva_poznamka && (\n                        <ErrorText>{validationErrors.smlouva_poznamka}</ErrorText>\n                      )}\n                    </FormGroup>\n                  </FormRow>\n                  \n                  {/*  VAROVN PRO VYPRELOU SMLOUVU - pes celou ku */}\n                  {formData.cislo_smlouvy && smlouvaDetail && !smlouvaDetail.notFound && \n                    (smlouvaDetail.stav === 'VYPRSELA' || smlouvaDetail.stav === 'UKONCENA') && (\n                    <div style={{\n                      marginTop: '-8px',\n                      marginBottom: '16px',\n                      padding: '8px 12px',\n                      background: '#fff7ed',\n                      border: '2px solid #f97316',\n                      borderRadius: '6px',\n                      color: '#c2410c',\n                      fontSize: '0.9rem',\n                      fontWeight: 600,\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '8px'\n                    }}>\n                       Smlouva ji vyprela!!! \n                      {smlouvaDetail.platnost_do && (\n                        <span style={{ fontSize: '0.85rem', fontWeight: 500 }}>\n                          Platnost byla do {new Date(smlouvaDetail.platnost_do).toLocaleDateString('cs-CZ')}\n                        </span>\n                      )}\n                    </div>\n                  )}\n\n\n                </>\n              )}\n\n              {(() => {\n                const selectedSource = financovaniOptions.find(opt => opt.kod === formData.zpusob_financovani);\n                const nazev = selectedSource?.nazev || '';\n                return nazev.includes('Individuln') && !nazev.includes('Pojistn');\n              })() && (\n                <FormRow style={{gridTemplateColumns: '1fr 2fr'}}>\n                  <FormGroup>\n                    <Label required>IDENTIFIKTOR SCHVLEN</Label>\n                    <InputWithIcon hasIcon>\n                      <Hash />\n                      <Input\n                        type=\"text\"\n                        name=\"individualni_schvaleni\"\n                        placeholder=\"Automaticky generovno z ev. sla\"\n                        value={formData.individualni_schvaleni || ''}\n                        onChange={(e) => handleInputChange('individualni_schvaleni', e.target.value)}\n                        disabled={true}\n                        readOnly={true}\n                        hasError={!!validationErrors.individualni_schvaleni}\n                        hasIcon\n                        style={{ backgroundColor: '#f3f4f6', cursor: 'not-allowed' }}\n                      />\n                    </InputWithIcon>\n                    {validationErrors.individualni_schvaleni && (\n                      <ErrorText>{validationErrors.individualni_schvaleni}</ErrorText>\n                    )}\n                  </FormGroup>\n                  <FormGroup>\n                    <Label>POZNMKA</Label>\n                    <InputWithIcon hasIcon>\n                      <FileText />\n                      <Input\n                        type=\"text\"\n                        name=\"individualni_poznamka\"\n                        placeholder=\"Dvod nebo podmnky schvlen\"\n                        value={formData.individualni_poznamka || ''}\n                        onChange={(e) => handleInputChange('individualni_poznamka', e.target.value)}\n                        disabled={shouldLockFinancovaniSection}\n                        hasError={!!validationErrors.individualni_poznamka}\n                        hasIcon\n                      />\n                    </InputWithIcon>\n                    {validationErrors.individualni_poznamka && (\n                      <ErrorText>{validationErrors.individualni_poznamka}</ErrorText>\n                    )}\n                  </FormGroup>\n                </FormRow>\n              )}\n\n              {(() => {\n                const selectedSource = financovaniOptions.find(opt => opt.kod === formData.zpusob_financovani);\n                const nazev = selectedSource?.nazev || '';\n                return nazev.includes('Pojistn') && nazev.includes('udlost');\n              })() && (\n                <FormRow style={{gridTemplateColumns: '1fr 2fr'}}>\n                  <FormGroup>\n                    <Label required>SLO POJISTN UDLOSTI</Label>\n                    <InputWithIcon hasIcon>\n                      <Hash />\n                      <Input\n                        type=\"text\"\n                        name=\"pojistna_udalost_cislo\"\n                        placeholder=\"Evidenn slo kody/udlosti\"\n                        value={formData.pojistna_udalost_cislo || ''}\n                        onChange={(e) => handleInputChange('pojistna_udalost_cislo', e.target.value)}\n                        disabled={shouldLockFinancovaniSection}\n                        hasError={!!validationErrors.pojistna_udalost_cislo}\n                        hasIcon\n                      />\n                    </InputWithIcon>\n                    {validationErrors.pojistna_udalost_cislo && (\n                      <ErrorText>{validationErrors.pojistna_udalost_cislo}</ErrorText>\n                    )}\n                  </FormGroup>\n                  <FormGroup>\n                    <Label>POZNMKA K POJISTN UDLOSTI</Label>\n                    <InputWithIcon hasIcon>\n                      <FileText />\n                      <Input\n                        type=\"text\"\n                        name=\"pojistna_udalost_poznamka\"\n                        placeholder=\"Popis kody nebo okolnost udlosti\"\n                        value={formData.pojistna_udalost_poznamka || ''}\n                        onChange={(e) => handleInputChange('pojistna_udalost_poznamka', e.target.value)}\n                        disabled={shouldLockFinancovaniSection}\n                        hasError={!!validationErrors.pojistna_udalost_poznamka}\n                        hasIcon\n                      />\n                    </InputWithIcon>\n                    {validationErrors.pojistna_udalost_poznamka && (\n                      <ErrorText>{validationErrors.pojistna_udalost_poznamka}</ErrorText>\n                    )}\n                  </FormGroup>\n                </FormRow>\n              )}\n            </FormGroup>\n          </FormRow>\n\n          {/*  Sekce: Stav schvlen - v samostatnm bloku */}\n          <FormRow>\n            <FormGroup style={{gridColumn: '1 / -1'}}>\n              {/*  Sekce STAV SCHVLEN se zobraz kdy:\n                  1. Objednvka je uloena v DB (m ID)\n                  2. Workflow NEN ve stavu NOVA (tzn. m jin stav ne nov objednvka)\n                  3. Uivatel m oprvnn ke schvalovn (admin nebo ORDER_APPROVAL role)\n\n                  Zobrazuje se pro stavy: CEKA_SE, ZAMITNUTO, SCHVALENO, ODESLAN_KE_SCHVALENI a dal\n                  Skrv se pouze pro stav NOVA nebo pokud uivatel nem oprvnn */}\n              {!!formData.id &&\n               !hasWorkflowState(formData.stav_workflow_kod, 'NOVA') &&\n               (canApproveOrders || canManageOrders) && (\n                <>\n                  {/* ediv oddlovac linka NAD celou sekc schvlen */}\n                  <div style={{\n                    borderTop: '1px solid #d1d5db',\n                    marginBottom: '1.5rem',\n                    marginTop: '1rem'\n                  }} />\n\n                  <div style={{gridColumn: '1 / -1'}}>\n                    {/* Checkboxy - zobrazit JEN kdy je objednvka ULOENA v DB */}\n                    {!!formData.id && (\n                      <>\n                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>\n                          <Label style={{ fontSize: '1rem', fontWeight: '600', margin: 0 }}>\n                            STAV SCHVLEN OBJEDNVKY\n                          </Label>\n                          {isFormBasicallyValid() && formData.stav_schvaleni && (\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                              <span style={{ fontWeight: 'bold' , color: '#374151', fontSize: '0.875rem' }}>\n                                Schvaluje:\n                              </span>\n                              <span style={{\n                                fontWeight: '600',\n                                color: '#059669',\n                                backgroundColor: '#d1fae5',\n                                padding: '0.25rem 0.5rem',\n                                borderRadius: '4px',\n                                fontSize: '0.875rem'\n                              }}>\n                                {getUserNameById(user_id)}\n                              </span>\n                            </div>\n                          )}\n                        </div>\n\n                    {/* ek se */}\n                    <label style={{\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '1rem',\n                      padding: '1rem',\n                      border: '1px solid #e5e7eb',\n                      borderRadius: '8px',\n                      backgroundColor: formData.stav_schvaleni === 'ceka_se' ? '#fef3c7' : '#f9fafb',\n                      cursor: shouldLockSchvaleniCheckboxes ? 'not-allowed' : 'pointer',\n                      opacity: shouldLockSchvaleniCheckboxes ? 0.6 : 1,\n                      marginBottom: '1rem',\n                      fontSize: '1rem',\n                      fontWeight: '500',\n                      color: formData.stav_schvaleni === 'ceka_se' ? '#f59e0b' : '#374151',\n                      pointerEvents: shouldLockSchvaleniCheckboxes ? 'none' : 'auto'\n                    }}\n                    onClick={(e) => {\n                      e.preventDefault();\n                      handleRadioClick('ceka_se');\n                    }}\n                    >\n                      <input\n                        type=\"radio\"\n                        name=\"stav_schvaleni\"\n                        value=\"ceka_se\"\n                        checked={formData.stav_schvaleni === 'ceka_se'}\n                        onChange={() => {}}\n                        disabled={shouldLockSchvaleniCheckboxes}\n                        style={{\n                          width: '20px',\n                          height: '20px',\n                          accentColor: '#f59e0b',\n                          margin: 0,\n                          flexShrink: 0\n                        }}\n                      />\n                      <FontAwesomeIcon icon={faClock} size=\"lg\" />\n                      ek se\n                      {formData.stav_schvaleni === 'ceka_se' && (\n                        <span style={{\n                          marginLeft: '0.5rem',\n                          fontSize: '0.875rem',\n                          color: '#f59e0b',\n                          fontWeight: '600'\n                        }}>\n                          \n                        </span>\n                      )}\n                    </label>\n\n                    {/* Neschvleno */}\n                    <label style={{\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '1rem',\n                      padding: '1rem',\n                      border: '1px solid #e5e7eb',\n                      borderRadius: '8px',\n                      backgroundColor: formData.stav_schvaleni === 'neschvaleno' ? '#fef2f2' : '#f9fafb',\n                      cursor: shouldLockSchvaleniCheckboxes ? 'not-allowed' : 'pointer',\n                      opacity: shouldLockSchvaleniCheckboxes ? 0.6 : 1,\n                      marginBottom: '1rem',\n                      fontSize: '1rem',\n                      fontWeight: '500',\n                      color: formData.stav_schvaleni === 'neschvaleno' ? '#dc2626' : '#374151',\n                      pointerEvents: shouldLockSchvaleniCheckboxes ? 'none' : 'auto'\n                    }}\n                    onClick={(e) => {\n                      e.preventDefault();\n                      handleRadioClick('neschvaleno');\n                    }}\n                    >\n                      <input\n                        type=\"radio\"\n                        name=\"stav_schvaleni\"\n                        value=\"neschvaleno\"\n                        checked={formData.stav_schvaleni === 'neschvaleno'}\n                        onChange={() => {}}\n                        disabled={shouldLockSchvaleniCheckboxes}\n                        style={{\n                          width: '20px',\n                          height: '20px',\n                          accentColor: '#dc2626',\n                          margin: 0,\n                          flexShrink: 0\n                        }}\n                      />\n                      <FontAwesomeIcon icon={faTimes} size=\"lg\" />\n                      Neschvleno\n                      {formData.stav_schvaleni === 'neschvaleno' && (\n                        <span style={{\n                          marginLeft: '0.5rem',\n                          fontSize: '0.875rem',\n                          color: '#dc2626',\n                          fontWeight: '600'\n                        }}>\n                          \n                        </span>\n                      )}\n                    </label>\n\n                    {/* Schvleno */}\n                    <label style={{\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '1rem',\n                      padding: '1rem',\n                      border: '1px solid #e5e7eb',\n                      borderRadius: '8px',\n                      backgroundColor: formData.stav_schvaleni === 'schvaleno' ? '#f0fdf4' : '#f9fafb',\n                      cursor: shouldLockSchvaleniCheckboxes ? 'not-allowed' : 'pointer',\n                      opacity: shouldLockSchvaleniCheckboxes ? 0.6 : 1,\n                      fontSize: '1rem',\n                      fontWeight: '500',\n                      color: formData.stav_schvaleni === 'schvaleno' ? '#15803d' : '#374151',\n                      pointerEvents: shouldLockSchvaleniCheckboxes ? 'none' : 'auto'\n                    }}\n                    onClick={(e) => {\n                      e.preventDefault();\n                      handleRadioClick('schvaleno');\n                    }}\n                    >\n                      <input\n                        type=\"radio\"\n                        name=\"stav_schvaleni\"\n                        value=\"schvaleno\"\n                        checked={formData.stav_schvaleni === 'schvaleno'}\n                        onChange={() => {}}\n                        disabled={shouldLockSchvaleniCheckboxes}\n                        style={{\n                          width: '20px',\n                          height: '20px',\n                          accentColor: '#16a34a',\n                          margin: 0,\n                          flexShrink: 0\n                        }}\n                      />\n                      <FontAwesomeIcon icon={faCheck} size=\"lg\" />\n                      Schvleno\n                      {formData.stav_schvaleni === 'schvaleno' && (\n                        <span style={{\n                          marginLeft: '0.5rem',\n                          fontSize: '0.875rem',\n                          color: '#15803d',\n                          fontWeight: '600'\n                        }}>\n                          \n                        </span>\n                      )}\n                    </label>\n\n                    {/* Dvod na stejnm dku */}\n                    {(formData.stav_schvaleni === 'neschvaleno' || formData.stav_schvaleni === 'ceka_se') && (\n                      <div style={{ flex: '1', minWidth: '300px' }}>\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                          <label style={{\n                            fontWeight: '500',\n                            color: '#374151',\n                            fontSize: '0.875rem',\n                            whiteSpace: 'nowrap'\n                          }}>\n                            Dvod:\n                            <span style={{ color: '#dc2626', marginLeft: '2px' }}>*</span>\n                          </label>\n                          <InputWithIcon hasIcon style={{ flex: 1 }}>\n                            <FileText />\n                            <Input\n                              type=\"text\"\n                              value={formData.schvaleni_komentar || ''}\n                              onChange={(e) => handleInputChange('schvaleni_komentar', e.target.value)}\n                              onBlur={() => handleFieldBlur('schvaleni_komentar', formData.schvaleni_komentar)}\n                              placeholder={\n                                formData.stav_schvaleni === 'neschvaleno'\n                                  ? \"Uvete dvod neschvlen...\"\n                                  : \"Uvete dvod ekn na schvlen...\"\n                              }\n                              hasIcon\n                              hasError={!!validationErrors.schvaleni_komentar}\n                            />\n                          </InputWithIcon>\n                        </div>\n                        {validationErrors.schvaleni_komentar && (\n                          <ErrorText style={{ marginTop: '0.25rem' }}>{validationErrors.schvaleni_komentar}</ErrorText>\n                        )}\n                      </div>\n                    )}\n                    </>\n                  )}\n\n                  {/*  INFO BOX - Zobraz se POD checkboxy A PO ULOEN DO DATABZE */}\n                  {/* Zobraz se pouze kdy workflow stav obsahuje SCHVALENA (= uloeno v DB se schvlenm) */}\n                  {hasWorkflowState(formData.stav_workflow_kod, 'SCHVALENA') && formData.stav_schvaleni && !!formData.schvalovatel_id && formData.dt_schvaleni && (\n                    <div style={{\n                      marginTop: '1rem',\n                      padding: '1rem',\n                      backgroundColor: formData.stav_schvaleni === 'schvaleno' ? '#dcfce7' :\n                                      formData.stav_schvaleni === 'neschvaleno' ? '#fef2f2' : '#fef3c7',\n                      border: formData.stav_schvaleni === 'schvaleno' ? '1px solid #16a34a' :\n                              formData.stav_schvaleni === 'neschvaleno' ? '1px solid #f87171' : '1px solid #f59e0b',\n                      borderRadius: '8px',\n                      color: formData.stav_schvaleni === 'schvaleno' ? '#166534' :\n                             formData.stav_schvaleni === 'neschvaleno' ? '#991b1b' : '#92400e',\n                    }}>\n                      <div style={{\n                        fontSize: '1rem',\n                        fontWeight: '600',\n                        marginBottom: '0.75rem',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem'\n                      }}>\n                        <span style={{ fontSize: '1.25rem' }}>\n                          {formData.stav_schvaleni === 'schvaleno' ? '' :\n                           formData.stav_schvaleni === 'neschvaleno' ? '' : ''}\n                        </span>\n                        {formData.stav_schvaleni === 'schvaleno' ? 'Objednvka m stav: Schvlen objednvka' :\n                         formData.stav_schvaleni === 'neschvaleno' ? 'Objednvka m stav: Zamtnuta objednvka' :\n                         'Objednvka ek na doplnn podklad'}\n                      </div>\n                      <div style={{ fontSize: '0.875rem', lineHeight: '1.6' }}>\n                        <div style={{ marginBottom: '0.5rem' }}>\n                          <strong>Datum schvlen:</strong> {prettyDate(formData.dt_schvaleni)}  <strong>\n                            {formData.stav_schvaleni === 'schvaleno' ? 'Schvlil:' :\n                             formData.stav_schvaleni === 'neschvaleno' ? 'Zamtl:' : 'Vrtil:'}\n                          </strong> {getUserNameById(formData.schvalovatel_id)}\n                        </div>\n                        {/* Koment se NEZOBRAZUJE pro stav schvaleno (schvlen nepotebuje zdvodnn) */}\n                        {formData.schvaleni_komentar && formData.stav_schvaleni !== 'schvaleno' && (\n                          <div>\n                            <strong>\n                              {formData.stav_schvaleni === 'neschvaleno' ? 'Dvod zamtnut:' :\n                               formData.stav_schvaleni === 'ceka_se' ? 'Dvod vrcen:' : 'Koment:'}\n                            </strong> {formData.schvaleni_komentar}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )}\n                  </div>\n                </>\n              )}\n\n              {/*  INFO BOX PRO UIVATELE BEZ PRV SCHVALOVN */}\n              {/* Zobraz se uivatelm bez prva ke schvalovn, pokud m objednvka stav schvlen */}\n              {!!formData.id &&\n               !hasWorkflowState(formData.stav_workflow_kod, 'NOVA') &&\n               !(canApproveOrders || canManageOrders) &&\n               formData.stav_schvaleni && !!formData.schvalovatel_id && formData.dt_schvaleni && (\n                <div style={{\n                  marginTop: '1rem',\n                  padding: '1rem',\n                  backgroundColor: formData.stav_schvaleni === 'schvaleno' ? '#dcfce7' :\n                                  formData.stav_schvaleni === 'neschvaleno' ? '#fef2f2' : '#fef3c7',\n                  border: formData.stav_schvaleni === 'schvaleno' ? '1px solid #16a34a' :\n                          formData.stav_schvaleni === 'neschvaleno' ? '1px solid #f87171' : '1px solid #f59e0b',\n                  borderRadius: '8px',\n                  color: formData.stav_schvaleni === 'schvaleno' ? '#166534' :\n                         formData.stav_schvaleni === 'neschvaleno' ? '#991b1b' : '#92400e',\n                }}>\n                  <div style={{\n                    fontSize: '1rem',\n                    fontWeight: '600',\n                    marginBottom: '0.75rem',\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '0.5rem'\n                  }}>\n                    <span style={{ fontSize: '1.25rem' }}>\n                      {formData.stav_schvaleni === 'schvaleno' ? '' :\n                       formData.stav_schvaleni === 'neschvaleno' ? '' : ''}\n                    </span>\n                    {formData.stav_schvaleni === 'schvaleno' ? 'Objednvka m stav: Schvlen objednvka' :\n                     formData.stav_schvaleni === 'neschvaleno' ? 'Objednvka m stav: Zamtnuta objednvka' :\n                     'Objednvka ek na doplnn podklad'}\n                  </div>\n                  <div style={{ fontSize: '0.875rem', lineHeight: '1.6' }}>\n                    <div style={{ marginBottom: '0.5rem' }}>\n                      <strong>Datum schvlen:</strong> {prettyDate(formData.dt_schvaleni)}  <strong>\n                        {formData.stav_schvaleni === 'schvaleno' ? 'Schvlil:' :\n                         formData.stav_schvaleni === 'neschvaleno' ? 'Zamtl:' : 'Vrtil:'}\n                      </strong> {getUserNameById(formData.schvalovatel_id)}\n                    </div>\n                    {/* Koment se NEZOBRAZUJE pro stav schvaleno (schvlen nepotebuje zdvodnn) */}\n                    {formData.schvaleni_komentar && formData.stav_schvaleni !== 'schvaleno' && (\n                      <div>\n                        <strong>\n                          {formData.stav_schvaleni === 'neschvaleno' ? 'Dvod zamtnut:' :\n                           formData.stav_schvaleni === 'ceka_se' ? 'Dvod vrcen:' : 'Koment:'}\n                        </strong> {formData.schvaleni_komentar}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n\n            </FormGroup>\n          </FormRow>\n        </SectionContent>\n      </FormSection>\n\n      {/* INFORMAN BLOK - KONEC FZE 1 */}\n      {(isArchived || currentPhase === 1) && !formData.stav_schvaleni && (\n        <div style={{\n          margin: '2rem 0',\n          padding: '1rem 1.25rem',\n          backgroundColor: '#f0f9ff',\n          border: '1px solid #0ea5e9',\n          borderRadius: '8px',\n          color: '#0c4a6e'\n        }}>\n          <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n             Objednvka zatm nebyla schvlena\n          </div>\n          <div style={{ fontSize: '0.875rem' }}>\n            Abyste mohli pokraovat ve vyplovn detail objednvky, pidvn ploh a zadvn informac o dodavateli, je nutn nejprve objednvku nechat schvlit.\n          </div>\n        </div>\n      )}\n\n      {/* ROZEN SEKCE - VIDITELN PODLE WORKFLOW STAVU */}\n      {sectionVisibility.financovani && (\n        <>\n          {/* Sekce: Informace o dodavateli */}\n          <FormSection data-section=\"dodavatel\">\n            {(() => {\n              // Helper: Check if Pokladna is selected\n              const selectedFinancovani = financovaniOptions.find(opt =>\n                opt.kod === formData.zpusob_financovani ||\n                opt.value === formData.zpusob_financovani\n              );\n              const nazev = selectedFinancovani?.nazev || '';\n              const isPokladna = nazev.toLowerCase().includes('pokladna');\n\n              return (\n                <>\n                  <SectionHeader\n                    sectionTheme={getSectionTheme('dodavatel')}\n                    isActive={isSectionActive('dodavatel')}\n                  >\n                    <SectionTitle sectionTheme={getSectionTheme('dodavatel')}>\n                      <SectionIcon sectionTheme={getSectionTheme('dodavatel')}>\n                        <Building />\n                      </SectionIcon>\n                      Dodavatel\n                      {isPokladna && (\n                        <LockWarning title=\"Sekce Dodavatel nen potebn pro objednvky financovan z pokladny\" style={{ marginLeft: '8px', color: '#ff9800' }}>\n                           Pokladna - dodavatel nen vyadovn\n                        </LockWarning>\n                      )}\n                    </SectionTitle>\n                    <SectionControls>\n                      {/*  Ikona \"Pidat do adrese\" - zobraz se pouze pokud m prvo CONTACT_MANAGE nebo CONTACT_EDIT */}\n                      {checkSupplierRequiredFields() &&\n                       !shouldLockPhase3Sections &&\n                       !isPokladna &&\n                       hasPermission &&\n                       (hasPermission('CONTACT_MANAGE') || hasPermission('CONTACT_EDIT')) && (\n                        <AddToDirectoryIcon\n                          isActive={true}\n                          onClick={handleAddSupplierToDirectory}\n                          title=\"Pidat dodavatele do adrese\"\n                          style={{\n                            position: 'relative',\n                            right: 'auto',\n                            top: 'auto',\n                            transform: 'none',\n                            marginRight: '8px'\n                          }}\n                        >\n                          <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                            <path d=\"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"/>\n                            <circle cx=\"8.5\" cy=\"7\" r=\"4\"/>\n                            <line x1=\"20\" y1=\"8\" x2=\"20\" y2=\"14\"/>\n                            <line x1=\"23\" y1=\"11\" x2=\"17\" y2=\"11\"/>\n                          </svg>\n                        </AddToDirectoryIcon>\n                      )}\n                      {isPokladna ? (\n                        <CollapseIcon\n                          collapsed={true}\n                          sectionTheme={getSectionTheme('dodavatel')}\n                          style={{ cursor: 'not-allowed', opacity: 0.5 }}\n                          title=\"Sekce je zablokovan pro platbu z pokladny\"\n                        >\n                          <FontAwesomeIcon icon={faTimes} />\n                        </CollapseIcon>\n                      ) : (\n                        <CollapseIcon\n                          collapsed={sectionStates.dodavatel}\n                          sectionTheme={getSectionTheme('dodavatel')}\n                          onClick={() => toggleSection('dodavatel')}\n                          style={{ cursor: 'pointer' }}\n                        >\n                          <FontAwesomeIcon icon={faChevronUp} />\n                        </CollapseIcon>\n                      )}\n                    </SectionControls>\n                  </SectionHeader>\n                </>\n              );\n            })()}\n            <SectionContent collapsed={sectionStates.dodavatel}>\n              <FormRow>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  <Label required>\n                    NZEV DODAVATELE\n                    {supplierAutoFillSource && (\n                      <span style={{fontWeight: 'normal', fontSize: '0.85em', color: '#666', marginLeft: '8px'}}>\n                        (vyplnno z {\n                          supplierAutoFillSource === 'local' ? 'loklnho adrese' :\n                          supplierAutoFillSource === 'ares' ? 'ARES' :\n                          supplierAutoFillSource === 'smlouva' ? 'smlouvy' :\n                          supplierAutoFillSource === 'smlouva-fallback' ? 'smlouvy' :\n                          'automatickho zdroje'\n                        })\n                      </span>\n                    )}\n                  </Label>\n                  <InputWithIcon hasIcon style={{position: 'relative'}}>\n                    <Building />\n                    <Input\n                      type=\"text\"\n                      name=\"dodavatel_nazev\"\n                      placeholder=\"Nzev spolenosti\"\n                      value={formData.dodavatel_nazev || ''}\n                      onChange={(e) => {\n                        handleInputChange('dodavatel_nazev', e.target.value);\n                        // Reset source pi manuln prav\n                        if (supplierAutoFillSource) {\n                          setSupplierAutoFillSource(null);\n                        }\n                      }}\n                      onBlur={() => handleFieldBlur('dodavatel_nazev', formData.dodavatel_nazev)}\n                      hasError={!!validationErrors.dodavatel_nazev}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                      style={{paddingRight: '80px'}}\n                    />\n                    {/* Ikony pro vbr dodavatele */}\n                    <div style={{\n                      position: 'absolute',\n                      right: '8px',\n                      top: '50%',\n                      transform: 'translateY(-50%)',\n                      display: 'flex',\n                      gap: '4px',\n                      zIndex: 10\n                    }}>\n                      <SupplierSearchIcon\n                        onClick={shouldLockPhase3Sections ? undefined : handleSupplierLocalSearch}\n                        title={shouldLockPhase3Sections ? \"Zameno - sekce FZE 3\" : \"Vyhledat v lokln databzi dodavatel\"}\n                        style={{ opacity: shouldLockPhase3Sections ? 0.5 : 1, cursor: shouldLockPhase3Sections ? 'not-allowed' : 'pointer' }}\n                      >\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                          <path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"/>\n                          <circle cx=\"9\" cy=\"7\" r=\"4\"/>\n                          <path d=\"M23 21v-2a4 4 0 0 0-3-3.87\"/>\n                          <path d=\"M16 3.13a4 4 0 0 1 0 7.75\"/>\n                        </svg>\n                      </SupplierSearchIcon>\n                      <AresSearchIcon\n                        onClick={shouldLockPhase3Sections ? undefined : handleSupplierAresSearch}\n                        title={shouldLockPhase3Sections ? \"Zameno - sekce FZE 3\" : \"Vyhledat v ARES registru\"}\n                        style={{ opacity: shouldLockPhase3Sections ? 0.5 : 1, cursor: shouldLockPhase3Sections ? 'not-allowed' : 'pointer' }}\n                      >\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                          <ellipse cx=\"12\" cy=\"5\" rx=\"9\" ry=\"3\"/>\n                          <path d=\"M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5\"/>\n                          <path d=\"M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3\"/>\n                        </svg>\n                      </AresSearchIcon>\n                    </div>\n                  </InputWithIcon>\n                  {validationErrors.dodavatel_nazev && (\n                    <ErrorText>{validationErrors.dodavatel_nazev}</ErrorText>\n                  )}\n                </FormGroup>\n              </FormRow>\n              <FormRow style={{gridTemplateColumns: '2fr 1fr 1fr'}}>\n                <FormGroup>\n                  <Label required>ADRESA</Label>\n                  <InputWithIcon hasIcon>\n                    <MapPin />\n                    <Input\n                      type=\"text\"\n                      name=\"dodavatel_adresa\"\n                      placeholder=\"Adresa sdla\"\n                      value={formData.dodavatel_adresa || ''}\n                      onChange={(e) => handleInputChange('dodavatel_adresa', e.target.value)}\n                      onBlur={() => handleFieldBlur('dodavatel_adresa', formData.dodavatel_adresa)}\n                      hasError={!!validationErrors.dodavatel_adresa}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                    />\n                  </InputWithIcon>\n                  {validationErrors.dodavatel_adresa && (\n                    <ErrorText>{validationErrors.dodavatel_adresa}</ErrorText>\n                  )}\n                </FormGroup>\n                <FormGroup>\n                  <Label required>IO</Label>\n                  <InputWithIcon hasIcon style={{position: 'relative'}}>\n                    <Hash />\n                    <Input\n                      type=\"text\"\n                      name=\"dodavatel_ico\"\n                      placeholder=\"12345678\"\n                      value={formData.dodavatel_ico || ''}\n                      onChange={(e) => handleInputChange('dodavatel_ico', e.target.value)}\n                      onBlur={(e) => handleIcoBlur(e.target.value)}\n                      hasError={!!validationErrors.dodavatel_ico}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                      style={{paddingRight: '36px'}}\n                    />\n                    {/* Ikona pro ARES vyhledvn */}\n                    <AresSearchIcon\n                      onClick={shouldLockPhase3Sections ? undefined : handleSupplierAresSearch}\n                      title={shouldLockPhase3Sections ? \"Zameno - sekce FZE 3\" : \"Vyhledat IO v ARES registru\"}\n                      style={{ opacity: shouldLockPhase3Sections ? 0.5 : 1, cursor: shouldLockPhase3Sections ? 'not-allowed' : 'pointer' }}\n                    >\n                      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                        <ellipse cx=\"12\" cy=\"5\" rx=\"9\" ry=\"3\"/>\n                        <path d=\"M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5\"/>\n                        <path d=\"M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3\"/>\n                      </svg>\n                    </AresSearchIcon>\n\n                    {/* IO Check Notification */}\n                    {showIcoCheck && (\n                      <IcoNotification data-status={icoCheckStatus}>\n                        {icoCheckStatus === 'checking' && (\n                          <>\n                            <IcoNotificationTitle status=\"checking\">Kontroluji IO...</IcoNotificationTitle>\n                            <IcoNotificationMessage status=\"checking\">\n                              Vyhledvm dodavatele podle IO v databzi a ARES.\n                            </IcoNotificationMessage>\n                          </>\n                        )}\n\n                        {(icoCheckStatus === 'found-local' || icoCheckStatus === 'found-ares') && icoCheckData && (\n                          <>\n                            <IcoNotificationTitle status=\"found\">\n                              {icoCheckStatus === 'found-local' ? 'Dodavatel v databzi!' : 'Dodavatel nalezen v ARES!'}\n                            </IcoNotificationTitle>\n                            <IcoNotificationMessage status=\"found\">\n                              <strong>{icoCheckData.nazev || icoCheckData.name || 'Nzev nen k dispozici'}</strong><br/>\n                              IO: {icoCheckData.ico}<br/>\n                              {icoCheckData.dic && (<>DI: {icoCheckData.dic}<br/></>)}\n                              {(icoCheckData.adresa || icoCheckData.address) && <>{icoCheckData.adresa || icoCheckData.address}<br/></>}\n                              {icoCheckData.zastoupeny && (<>Zastoupen: {icoCheckData.zastoupeny}<br/></>)}\n                              {icoCheckData.kontakt_jmeno && (\n                                <>Kontakt: {icoCheckData.kontakt_jmeno}\n                                {icoCheckData.kontakt_email && (<>, {icoCheckData.kontakt_email}</>)}\n                                {icoCheckData.kontakt_telefon && (<>, {icoCheckData.kontakt_telefon}</>)}\n                                <br/></>\n                              )}\n                              <div style={{fontSize: '11px', color: '#666', marginTop: '8px'}}>\n                                Zdroj: {icoCheckData.source === 'local' ? 'Lokln databze' : 'ARES registr'}\n                              </div>\n                            </IcoNotificationMessage>\n                            <IcoNotificationActions>\n                              <IcoActionButton className=\"fill-form\" onClick={handleIcoFillForm}>\n                                Vyplnit formul\n                              </IcoActionButton>\n                              {icoCheckStatus === 'found-ares' && (\n                                <IcoActionButton className=\"primary\" onClick={handleIcoUpdate}>\n                                  Pidat do osobnch kontakt\n                                </IcoActionButton>\n                              )}\n                              <IcoActionButton className=\"secondary\" onClick={handleIcoCancel}>\n                                Zruit\n                              </IcoActionButton>\n                            </IcoNotificationActions>\n                          </>\n                        )}\n\n                        {icoCheckStatus === 'not-found' && (\n                          <>\n                            <IcoNotificationTitle status=\"not-found\">Dodavatel nebyl nalezen</IcoNotificationTitle>\n                            <IcoNotificationMessage status=\"not-found\">\n                              Dodavatel s tmto IO nen v lokln databzi ani v ARES. Mete pokraovat s runm zadnm.\n                            </IcoNotificationMessage>\n                            <IcoNotificationActions>\n                              <IcoActionButton className=\"secondary\" onClick={handleIcoCancel}>\n                                Pokraovat run\n                              </IcoActionButton>\n                            </IcoNotificationActions>\n                          </>\n                        )}\n                      </IcoNotification>\n                    )}\n                  </InputWithIcon>\n                  {validationErrors.dodavatel_ico && (\n                    <ErrorText>{validationErrors.dodavatel_ico}</ErrorText>\n                  )}\n                </FormGroup>\n                <FormGroup>\n                  <Label>DI</Label>\n                  <InputWithIcon hasIcon>\n                    <Hash />\n                    <Input\n                      type=\"text\"\n                      name=\"dodavatel_dic\"\n                      placeholder=\"CZ12345678\"\n                      value={formData.dodavatel_dic || ''}\n                      onChange={(e) => handleInputChange('dodavatel_dic', e.target.value)}\n                      onBlur={() => handleFieldBlur('dodavatel_dic', formData.dodavatel_dic)}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                    />\n                  </InputWithIcon>\n                </FormGroup>\n              </FormRow>\n              <FormRow>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  <Label>ZASTOUPEN</Label>\n                  <InputWithIcon hasIcon>\n                    <User />\n                    <Input\n                      type=\"text\"\n                      name=\"dodavatel_zastoupeny\"\n                      placeholder=\"Zastoupen Jim Novkem\"\n                      value={formData.dodavatel_zastoupeny || ''}\n                      onChange={(e) => handleInputChange('dodavatel_zastoupeny', e.target.value)}\n                      onBlur={() => handleFieldBlur('dodavatel_zastoupeny', formData.dodavatel_zastoupeny)}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                    />\n                  </InputWithIcon>\n                </FormGroup>\n              </FormRow>\n\n              {/* Kontaktn osoba dodavatele */}\n              <FormRow>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  {/* Dlc ra */}\n                  <div style={{\n                    width: '100%',\n                    height: '1px',\n                    background: 'linear-gradient(to right, #e5e7eb, transparent)',\n                    margin: '1.5rem 0 1rem 0'\n                  }}></div>\n                  <Label style={{\n                    fontSize: '1rem',\n                    fontWeight: '600',\n                    color: '#374151',\n                    marginBottom: '1rem',\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '0.5rem',\n                    marginTop: '0.5rem'\n                  }}>\n                    <User size={18} />\n                    Kontaktn osoba dodavatele\n                  </Label>\n                </FormGroup>\n              </FormRow>\n              <FormRow>\n                <FormGroup>\n                  <Label>JMNO A PJMEN</Label>\n                  <InputWithIcon hasIcon>\n                    <User />\n                    <Input\n                      type=\"text\"\n                      name=\"dodavatel_kontakt_jmeno\"\n                      placeholder=\"Jan Novk\"\n                      value={formData.dodavatel_kontakt_jmeno || ''}\n                      onChange={(e) => handleInputChange('dodavatel_kontakt_jmeno', e.target.value)}\n                      onBlur={() => handleFieldBlur('dodavatel_kontakt_jmeno', formData.dodavatel_kontakt_jmeno)}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                    />\n                  </InputWithIcon>\n                </FormGroup>\n                <FormGroup>\n                  <Label>E-MAIL</Label>\n                  <InputWithIcon hasIcon>\n                    <Mail />\n                    <Input\n                      type=\"email\"\n                      name=\"dodavatel_kontakt_email\"\n                      placeholder=\"jan.novak@dodavatel.cz\"\n                      value={formData.dodavatel_kontakt_email || ''}\n                      onChange={(e) => handleInputChange('dodavatel_kontakt_email', e.target.value)}\n                      onBlur={() => handleFieldBlur('dodavatel_kontakt_email', formData.dodavatel_kontakt_email)}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                    />\n                  </InputWithIcon>\n                </FormGroup>\n                <FormGroup>\n                  <Label>TELEFON</Label>\n                  <InputWithIcon hasIcon>\n                    <Phone />\n                    <Input\n                      type=\"tel\"\n                      name=\"dodavatel_kontakt_telefon\"\n                      placeholder=\"+420 123 456 789\"\n                      value={formData.dodavatel_kontakt_telefon || ''}\n                      onChange={(e) => handleInputChange('dodavatel_kontakt_telefon', e.target.value)}\n                      onBlur={() => handleFieldBlur('dodavatel_kontakt_telefon', formData.dodavatel_kontakt_telefon)}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                    />\n                  </InputWithIcon>\n                </FormGroup>\n              </FormRow>\n            </SectionContent>\n          </FormSection>\n\n          {/* Sekce: Detaily objednvky */}\n          {(isArchived || currentPhase >= 3) && (() => {\n            //  FAILSAFE: Pokud se sekce zobraz, ale nejsou dn poloky, vytvoit jednu\n            if (currentPhase >= 3 && (!formData.polozky_objednavky || formData.polozky_objednavky.length === 0)) {\n              // DEBUG: FAILSAFE item creation - logging removed\n              setTimeout(() => {\n                if (!formData.polozky_objednavky || formData.polozky_objednavky.length === 0) {\n                  setFormData(prev => ({\n                    ...prev,\n                    polozky_objednavky: [{\n                      id: `failsafe_item_${Date.now()}`,\n                      popis: '',\n                      mnozstvi: '1',\n                      jednotka: 'ks',\n                      cena_bez_dph: '',\n                      sazba_dph: '21',\n                      cena_s_dph: ''\n                    }]\n                  }));\n                }\n              }, 100);\n            }\n            return true;\n          })() && (\n          <FormSection data-section=\"detaily\">\n            <SectionHeader\n              sectionTheme={getSectionTheme('detaily')}\n              isActive={isSectionActive('detaily')}\n            >\n              <SectionTitle sectionTheme={getSectionTheme('detaily')}>\n                <SectionIcon sectionTheme={getSectionTheme('detaily')}>\n                  <Package />\n                </SectionIcon>\n                Detaily objednvky\n                {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n                {shouldLockPhase3Sections && !shouldLockAllSections && (\n                  <LockWarning title=\"FZE 3 sekce je zamena ve FZI 4+. Odemen umon editaci FZE 3.\">\n                     Sekce zamena\n                  </LockWarning>\n                )}\n              </SectionTitle>\n              <SectionControls>\n                {/* Celkov cena s DPH a porovnn s maximem */}\n                <div style={{\n                  fontSize: '0.875rem',\n                  fontWeight: '600',\n                  color: '#92400e',\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: '0.5rem'\n                }}>\n                  <span>Celkem s DPH: {totalPrice.toLocaleString('cs-CZ')} K</span>\n                  {maxPrice > 0 && (\n                    <span style={{\n                      color: totalPrice > maxPrice ? '#dc2626' : '#059669',\n                      fontSize: '0.75rem',\n                      padding: '2px 6px',\n                      borderRadius: '4px',\n                      backgroundColor: totalPrice > maxPrice ? '#fef2f2' : '#f0fdf4',\n                      border: `1px solid ${totalPrice > maxPrice ? '#fecaca' : '#bbf7d0'}`\n                    }}>\n                      {totalPrice > maxPrice\n                        ? `+${(totalPrice - maxPrice).toLocaleString('cs-CZ')} K nad limit`\n                        : `${(maxPrice - totalPrice).toLocaleString('cs-CZ')} K do limitu`\n                      }\n                    </span>\n                  )}\n                </div>\n                <CollapseIcon\n                  collapsed={sectionStates.detaily}\n                  sectionTheme={getSectionTheme('detaily')}\n                  onClick={() => toggleSection('detaily')}\n                  style={{ cursor: 'pointer' }}\n                >\n                  <FontAwesomeIcon icon={faChevronUp} />\n                </CollapseIcon>\n              </SectionControls>\n            </SectionHeader>\n            <SectionContent collapsed={sectionStates.detaily}>\n              <FormRow>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  <LabelWithClear>\n                    <LabelText required>DRUH OBJ.</LabelText>\n                    <ClearSelectButton\n                      type=\"button\"\n                      $visible={!!formData.druh_objednavky_kod}\n                      onClick={() => handleInputChange('druh_objednavky_kod', '')}\n                      title=\"Vymazat vbr\"\n                    >\n                      <X size={12} />\n                    </ClearSelectButton>\n                  </LabelWithClear>\n                  <StableCustomSelect\n                    value={formData.druh_objednavky_kod}\n                    onChange={(selectedValue) => handleInputChange('druh_objednavky_kod', selectedValue)}\n                    onBlur={(field, value) => handleFieldBlur('druh_objednavky_kod', value)}\n                    options={druhyObjednavkyOptions}\n                    placeholder=\"Vyberte druh objednvky...\"\n                    field=\"druh_objednavky_kod\"\n                    icon={<Package />}\n                    disabled={shouldLockPhase3Sections}\n                    hasError={!!validationErrors.druh_objednavky_kod}\n                    required={true}\n                    loading={false}\n                    getOptionLabel={getOptionLabel}\n                    getOptionValue={(option, field) => option.kod_stavu || option.value || option.kod || option.id || option}\n                  />\n                  {validationErrors.druh_objednavky_kod && (\n                    <ErrorText>{validationErrors.druh_objednavky_kod}</ErrorText>\n                  )}\n                </FormGroup>\n              </FormRow>\n\n              {/* Poloky objednvky */}\n              <div style={{marginTop: '1.5rem'}}>\n                <div style={{\n                  display: 'flex',\n                  justifyContent: 'space-between',\n                  alignItems: 'center',\n                  marginBottom: '1rem'\n                }}>\n                  <h4 style={{margin: 0, fontSize: '1rem', fontWeight: '600', color: '#374151'}}>\n                    Poloky objednvky <span style={{color: '#ef4444'}}>*</span>\n                  </h4>\n                </div>\n\n                {validationErrors.polozky_objednavky && (\n                  <ErrorText style={{marginBottom: '1rem'}}>{validationErrors.polozky_objednavky}</ErrorText>\n                )}\n\n                {(formData.polozky_objednavky || []).map((polozka, index) => (\n                  <div key={polozka.id} style={{\n                    border: '1px solid #e5e7eb',\n                    borderRadius: '8px',\n                    padding: '1rem',\n                    marginBottom: '1rem',\n                    background: '#fafafa'\n                  }}>\n                    <div style={{\n                      display: 'flex',\n                      justifyContent: 'space-between',\n                      alignItems: 'center',\n                      marginBottom: '1rem'\n                    }}>\n                      <div style={{display: 'flex', alignItems: 'center', gap: '1rem', flex: 1}}>\n                        <span style={{fontWeight: '600', color: '#374151', display: 'flex', alignItems: 'center', gap: '0.5rem'}}>\n                          <ShoppingCart size={18} style={{ color: '#10b981' }} />\n                          POLOKA {index + 1} {index === 0 && <span style={{color: '#ef4444'}}>*</span>}\n                        </span>\n                        \n                        {/*  LP Select - POUZE ve fzi 3+ s LP financovnm */}\n                        {currentPhase >= 3 && (() => {\n                          // Zkontrolovat LP financovn\n                          const selectedSource = financovaniOptions.find(opt => opt.kod_stavu === formData.zpusob_financovani || opt.kod === formData.zpusob_financovani);\n                          const nazev = selectedSource?.nazev_stavu || selectedSource?.nazev || '';\n                          const hasLPFinancing = (nazev.includes('Limitovan') || nazev.includes('pslib')) && Array.isArray(formData.lp_kod) && formData.lp_kod.length > 0;\n                          \n                          if (!hasLPFinancing) return null;\n                          \n                          return (\n                            <div style={{flex: 1, marginRight: '0.5rem', display: 'flex', flexDirection: 'column', gap: '0.25rem'}} data-custom-select>\n                              <StableCustomSelect\n                                value={polozka.lp_id || ''}\n                                onChange={(selectedValue) => updatePolozka(polozka.id, 'lp_id', selectedValue)}\n                                options={lpOptionsForItems}\n                                placeholder={\n                                  !formData.id \n                                    ? 'Ulote objednvku...' \n                                    : lpOptionsForItems.length === 0 \n                                      ? 'dn LP dostupn' \n                                      : '-- Vybrat LP --'\n                                }\n                                field={`polozka_${polozka.id}_lp`}\n                                disabled={shouldLockPhase3Sections || !formData.id}\n                                hasError={!!validationErrors[`polozka_${index}_lp`]}\n                                required={true}\n                                hasTriedToSubmit={hasTriedToSubmit}\n                                icon={<Hash />}\n                                getOptionLabel={getOptionLabel}\n                                getOptionValue={(option) => option.id}\n                              />\n                              {validationErrors[`polozka_${index}_lp`] && (\n                                <ErrorText style={{fontSize: '0.7rem', marginTop: '0.1rem'}}>\n                                  {validationErrors[`polozka_${index}_lp`]}\n                                </ErrorText>\n                              )}\n                            </div>\n                          );\n                        })()}\n                      </div>\n                      \n                      {/* Tlatko smazat poloku */}\n                      {(formData.polozky_objednavky || []).length > 1 && (\n                        <DeleteItemButton\n                          type=\"button\"\n                          onClick={shouldLockPhase3Sections ? undefined : () => removePolozka(polozka.id)}\n                          disabled={shouldLockPhase3Sections}\n                          title={shouldLockPhase3Sections ? \"Zameno - sekce FZE 3\" : \"Smazat poloku\"}\n                          style={{ opacity: shouldLockPhase3Sections ? 0.5 : 1, cursor: shouldLockPhase3Sections ? 'not-allowed' : 'pointer' }}\n                        >\n                          <Trash size={16} />\n                        </DeleteItemButton>\n                      )}\n                    </div>\n\n                    <FormRow style={{marginBottom: '1rem'}}>\n                      <FormGroup style={{gridColumn: '1 / -1'}}>\n                        <Label required>Nzev / popis</Label>\n                        <InputWithIcon hasIcon>\n                          <FileText />\n                          <Input\n                            type=\"text\"\n                            placeholder=\"Nzev / popis poloky\"\n                            value={polozka.popis}\n                            onChange={(e) => updatePolozka(polozka.id, 'popis', e.target.value)}\n                            onBlur={() => handleFieldBlur(`polozka_${index}_popis`, polozka.popis)}\n                            hasError={!!validationErrors[`polozka_${index}_popis`]}\n                            hasIcon={true}\n                            disabled={shouldLockPhase3Sections}\n                          />\n                        </InputWithIcon>\n                        {validationErrors[`polozka_${index}_popis`] && (\n                          <ErrorText>{validationErrors[`polozka_${index}_popis`]}</ErrorText>\n                        )}\n                      </FormGroup>\n                    </FormRow>\n\n                    <FormRow style={{gridTemplateColumns: '1fr auto 1fr', gap: '1rem', alignItems: 'end'}}>\n                      <FormGroup>\n                        <Label required>CENA BEZ DPH</Label>\n                        <CurrencyInput\n                          fieldName={`polozka_${index}_cena_bez_dph`}\n                          value={polozka.cena_bez_dph || ''}\n                          onChange={(field, value) => updatePolozka(polozka.id, 'cena_bez_dph', value)}\n                          onBlur={(field, value) => handleFieldBlur(`polozka_${index}_cena_bez_dph`, value)}\n                          disabled={shouldLockPhase3Sections}\n                          placeholder=\"0.00\"\n                          hasError={!!validationErrors[`polozka_${index}_cena_bez_dph`]}\n                        />\n                        {validationErrors[`polozka_${index}_cena_bez_dph`] && (\n                          <ErrorText>{validationErrors[`polozka_${index}_cena_bez_dph`]}</ErrorText>\n                        )}\n                      </FormGroup>\n\n                      <FormGroup>\n                        <Label>DPH</Label>\n                        <select\n                          value={polozka.sazba_dph}\n                          onChange={(e) => updatePolozka(polozka.id, 'sazba_dph', e.target.value)}\n                          onBlur={() => handleFieldBlur(`polozka_${index}_sazba_dph`, polozka.sazba_dph)}\n                          disabled={shouldLockPhase3Sections}\n                          style={{\n                            padding: '0.75rem',\n                            border: '1px solid #d1d5db',\n                            borderRadius: '8px',\n                            fontSize: '0.875rem',\n                            backgroundColor: 'white',\n                            width: '80px'\n                          }}\n                        >\n                          <option value=\"12\">12%</option>\n                          <option value=\"21\">21%</option>\n                        </select>\n                      </FormGroup>\n\n                      <FormGroup>\n                        <Label required>CENA S DPH</Label>\n                        <CurrencyInput\n                          fieldName={`polozka_${index}_cena_s_dph`}\n                          value={polozka.cena_s_dph || ''}\n                          onChange={(field, value) => updatePolozka(polozka.id, 'cena_s_dph', value)}\n                          onBlur={(field, value) => handleFieldBlur(`polozka_${index}_cena_s_dph`, value)}\n                          disabled={shouldLockPhase3Sections}\n                          placeholder=\"0.00\"\n                          hasError={!!validationErrors[`polozka_${index}_cena_s_dph`]}\n                        />\n                        {validationErrors[`polozka_${index}_cena_s_dph`] && (\n                          <ErrorText>{validationErrors[`polozka_${index}_cena_s_dph`]}</ErrorText>\n                        )}\n                      </FormGroup>\n                    </FormRow>\n\n                    {/*  Lokalizace poloky - rozkldac panel */}\n                    <div style={{ marginTop: '1rem' }}>\n                      {(() => {\n                        // Zkontrolovat, zda druh objednvky m atribut_objektu = 1 (majetek)\n                        const isMaterialOrderValue = isMaterialOrder;\n                        \n                        return (\n                          <button\n                            type=\"button\"\n                            onClick={() => {\n                              // Pro materilov objednvky nelze panel zavt\n                              if (!isMaterialOrderValue) {\n                                setLokalizacePanelStates(prev => ({\n                                  ...prev,\n                                  [polozka.id]: !prev[polozka.id]\n                                }));\n                              }\n                            }}\n                            disabled={shouldLockPhase3Sections || isMaterialOrderValue}\n                            style={{\n                              display: 'flex',\n                              alignItems: 'center',\n                              gap: '0.5rem',\n                              padding: '0.5rem 0',\n                              background: 'transparent',\n                              border: 'none',\n                              color: isMaterialOrderValue ? '#ef4444' : '#6b7280',\n                              fontSize: '0.875rem',\n                              fontWeight: isMaterialOrderValue ? '600' : '500',\n                              cursor: (shouldLockPhase3Sections || isMaterialOrderValue) ? 'not-allowed' : 'pointer',\n                              opacity: shouldLockPhase3Sections ? 0.5 : 1,\n                              transition: 'color 0.2s'\n                            }}\n                            onMouseOver={(e) => !shouldLockPhase3Sections && !isMaterialOrderValue && (e.currentTarget.style.color = '#374151')}\n                            onMouseOut={(e) => !shouldLockPhase3Sections && !isMaterialOrderValue && (e.currentTarget.style.color = '#6b7280')}\n                          >\n                            {!isMaterialOrderValue && (\n                              <svg\n                                width=\"14\"\n                                height=\"14\"\n                                viewBox=\"0 0 24 24\"\n                                fill=\"none\"\n                                stroke=\"currentColor\"\n                                strokeWidth=\"2\"\n                                style={{\n                                  transform: lokalizacePanelStates[polozka.id] ? 'rotate(180deg)' : 'rotate(0deg)',\n                                  transition: 'transform 0.2s'\n                                }}\n                              >\n                                <polyline points=\"6 9 12 15 18 9\"></polyline>\n                              </svg>\n                            )}\n                            Upesnn msta dodn {isMaterialOrderValue ? (<span style={{color: '#ef4444'}}>*</span>) : '(voliteln)'}\n                          </button>\n                        );\n                      })()}\n\n                      {lokalizacePanelStates[polozka.id] && (() => {\n                        // Zkontrolovat, zda druh objednvky m atribut_objektu = 1 (majetek)\n                        const isMaterialOrderValue = isMaterialOrder;\n                        \n                        return (\n                          <div style={{\n                            marginTop: '0.75rem',\n                            padding: '1rem',\n                            background: isMaterialOrderValue ? '#fef2f2' : '#f9fafb',\n                            borderRadius: '6px',\n                            border: isMaterialOrderValue ? '1px solid #fca5a5' : '1px dashed #d1d5db'\n                          }}>\n                            <FormRow style={{gridTemplateColumns: '1fr 1fr 1fr'}}>\n                              <FormGroup>\n                                <Label>SEK {isMaterialOrderValue && <span style={{color: '#ef4444'}}>*</span>}</Label>\n                                <InputWithIcon hasIcon>\n                                  <MapPin size={16} />\n                                  <Input\n                                    type=\"text\"\n                                    name={`polozka_${index}_usek_kod`}\n                                    placeholder=\"sek...\"\n                                    value={polozka.usek_kod || ''}\n                                    onChange={(e) => updatePolozka(polozka.id, 'usek_kod', e.target.value)}\n                                    onBlur={() => handleFieldBlur(`polozka_${index}_usek_kod`, polozka.usek_kod)}\n                                    disabled={shouldLockPhase3Sections}\n                                    hasError={!!validationErrors[`polozka_${index}_usek_kod`]}\n                                    style={{ paddingLeft: '2.5rem' }}\n                                  />\n                                </InputWithIcon>\n                                {validationErrors[`polozka_${index}_usek_kod`] && (\n                                  <ErrorText>{validationErrors[`polozka_${index}_usek_kod`]}</ErrorText>\n                                )}\n                              </FormGroup>\n\n                              <FormGroup>\n                                <Label>BUDOVA {isMaterialOrderValue && <span style={{color: '#ef4444'}}>*</span>}</Label>\n                                <InputWithIcon hasIcon>\n                                  <MapPin size={16} />\n                                  <Input\n                                    type=\"text\"\n                                    name={`polozka_${index}_budova_kod`}\n                                    placeholder=\"Budova...\"\n                                    value={polozka.budova_kod || ''}\n                                    onChange={(e) => updatePolozka(polozka.id, 'budova_kod', e.target.value)}\n                                    onBlur={() => handleFieldBlur(`polozka_${index}_budova_kod`, polozka.budova_kod)}\n                                    disabled={shouldLockPhase3Sections}\n                                    hasError={!!validationErrors[`polozka_${index}_budova_kod`]}\n                                    style={{ paddingLeft: '2.5rem' }}\n                                  />\n                                </InputWithIcon>\n                                {validationErrors[`polozka_${index}_budova_kod`] && (\n                                  <ErrorText>{validationErrors[`polozka_${index}_budova_kod`]}</ErrorText>\n                                )}\n                              </FormGroup>\n\n                              <FormGroup>\n                                <Label>MSTNOST {isMaterialOrderValue && <span style={{color: '#ef4444'}}>*</span>}</Label>\n                                <InputWithIcon hasIcon>\n                                  <MapPin size={16} />\n                                  <Input\n                                    type=\"text\"\n                                    name={`polozka_${index}_mistnost_kod`}\n                                    placeholder=\"Mstnost...\"\n                                    value={polozka.mistnost_kod || ''}\n                                    onChange={(e) => updatePolozka(polozka.id, 'mistnost_kod', e.target.value)}\n                                    onBlur={() => handleFieldBlur(`polozka_${index}_mistnost_kod`, polozka.mistnost_kod)}\n                                    disabled={shouldLockPhase3Sections}\n                                    hasError={!!validationErrors[`polozka_${index}_mistnost_kod`]}\n                                    style={{ paddingLeft: '2.5rem' }}\n                                  />\n                                </InputWithIcon>\n                                {validationErrors[`polozka_${index}_mistnost_kod`] && (\n                                  <ErrorText>{validationErrors[`polozka_${index}_mistnost_kod`]}</ErrorText>\n                                )}\n                              </FormGroup>\n                            </FormRow>\n\n                            <FormRow style={{gridTemplateColumns: '1fr'}}>\n                              <FormGroup>\n                                <Label>POZNMKA K MSTU</Label>\n                                <TextArea\n                                  name={`polozka_${index}_poznamka_lokalizace`}\n                                  placeholder=\"Doplujc informace k mstu dodn...\"\n                                  value={polozka.poznamka || ''}\n                                  onChange={(e) => updatePolozka(polozka.id, 'poznamka', e.target.value)}\n                                  onBlur={() => handleFieldBlur(`polozka_${index}_poznamka_lokalizace`, polozka.poznamka)}\n                                  disabled={shouldLockPhase3Sections}\n                                  rows={2}\n                                />\n                              </FormGroup>\n                            </FormRow>\n                          </div>\n                        );\n                      })()}\n                    </div>\n                  </div>\n                ))}\n                \n                {/* Tlatko pidat dal poloku - zobrazit pouze kdy NEN zameno */}\n                {!shouldLockPhase3Sections && (\n                  <button\n                    type=\"button\"\n                    onClick={addPolozka}\n                    style={{\n                      width: '100%',\n                      marginTop: '1rem',\n                      padding: '1rem',\n                      background: 'transparent',\n                      border: '2px dashed #10b981',\n                      borderRadius: '8px',\n                      color: '#10b981',\n                      fontSize: '0.875rem',\n                      fontWeight: '500',\n                      cursor: 'pointer',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      gap: '0.5rem',\n                      transition: 'all 0.2s ease'\n                    }}\n                    onMouseOver={(e) => {\n                      e.currentTarget.style.background = '#f0fdf4';\n                      e.currentTarget.style.borderColor = '#059669';\n                    }}\n                    onMouseOut={(e) => {\n                      e.currentTarget.style.background = 'transparent';\n                      e.currentTarget.style.borderColor = '#10b981';\n                    }}\n                  >\n                    <Plus size={16} />\n                    <span>Pidat dal poloku</span>\n                  </button>\n                )}\n              </div>\n\n              <FormRow style={{marginTop: '1.5rem'}}>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  <Label>POZNMKA:</Label>\n                  <TextArea\n                    name=\"poznamka_objednavky\"\n                    placeholder=\"Dodaten poznmky a poadavky...\"\n                    value={formData.poznamka_objednavky || ''}\n                    onChange={(e) => handleInputChange('poznamka_objednavky', e.target.value)}\n                    onBlur={(e) => handleFieldBlur('poznamka_objednavky', e.target.value)}\n                    disabled={shouldLockPhase3Sections}\n                    rows={3}\n                  />\n                </FormGroup>\n              </FormRow>\n            </SectionContent>\n          </FormSection>\n          )}\n\n          {/* Sekce: Dodac a zrun podmnky */}\n          <FormSection data-section=\"dodaci_podminky\">\n            <SectionHeader\n              sectionTheme={getSectionTheme('dodaci_podminky')}\n              isActive={isSectionActive('dodaci_podminky')}\n            >\n              <SectionTitle sectionTheme={getSectionTheme('dodaci_podminky')}>\n                <SectionIcon sectionTheme={getSectionTheme('dodaci_podminky')}>\n                  <Calendar />\n                </SectionIcon>\n                Dodac a zrun podmnky\n                {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n                {shouldLockPhase3Sections && !shouldLockAllSections && (\n                  <LockWarning title=\"FZE 3 sekce je zamena ve FZI 4+. Odemen umon editaci FZE 3.\">\n                     Sekce zamena\n                  </LockWarning>\n                )}\n              </SectionTitle>\n              <SectionControls>\n                <CollapseIcon\n                  collapsed={sectionStates.dodaci_podminky}\n                  sectionTheme={getSectionTheme('dodaci_podminky')}\n                  onClick={() => toggleSection('dodaci_podminky')}\n                  style={{ cursor: 'pointer' }}\n                >\n                  <FontAwesomeIcon icon={faChevronUp} />\n                </CollapseIcon>\n              </SectionControls>\n            </SectionHeader>\n            <SectionContent collapsed={sectionStates.dodaci_podminky}>\n              <FormRow style={{gridTemplateColumns: '2fr 3fr'}}>\n                <FormGroup>\n                  <Label>PEDPOKLDAN TERMN DODN</Label>\n                  <DatePicker\n                    fieldName=\"dt_predpokladany_termin_dodani\"\n                    value={formData.dt_predpokladany_termin_dodani}\n                    onChange={(value) => handleInputChange('dt_predpokladany_termin_dodani', value)}\n                    onBlur={(value) => handleFieldBlur('dt_predpokladany_termin_dodani', value)}\n                    disabled={shouldLockPhase3Sections}\n                    hasError={!!validationErrors.dt_predpokladany_termin_dodani}\n                    placeholder=\"Vyberte datum\"\n                  />\n                </FormGroup>\n                <FormGroup>\n                  <Label>MSTO DODN</Label>\n                  <InputWithIcon hasIcon>\n                    <MapPin />\n                    <Input\n                      type=\"text\"\n                      name=\"misto_dodani\"\n                      placeholder=\"Adresa msta dodn\"\n                      value={formData.misto_dodani || ''}\n                      onChange={(e) => handleInputChange('misto_dodani', e.target.value)}\n                      onBlur={(e) => handleFieldBlur('misto_dodani', e.target.value)}\n                      disabled={shouldLockPhase3Sections}\n                      hasIcon\n                    />\n                  </InputWithIcon>\n                </FormGroup>\n              </FormRow>\n              <FormRow>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  <Label>ZRUKA</Label>\n                  <InputWithIcon hasIcon>\n                    <FileText />\n                    <Input\n                      type=\"text\"\n                      name=\"zaruka\"\n                      placeholder=\"Zrun podmnky a lhty\"\n                      value={formData.zaruka || ''}\n                      onChange={(e) => handleInputChange('zaruka', e.target.value)}\n                      onBlur={(e) => handleFieldBlur('zaruka', e.target.value)}\n                      disabled={shouldLockPhase3Sections}\n                      hasIcon\n                    />\n                  </InputWithIcon>\n                </FormGroup>\n              </FormRow>\n            </SectionContent>\n          </FormSection>\n\n          {/*  SEKCE PLOHY ODEBRNA - bude pidna na konec formule jako vdy aktivn */}\n\n          {/* FZE 3: Sekce: Stav odesln objednvky */}\n          <FormSection data-section=\"stav_odeslani\">\n            <SectionHeader\n              sectionTheme={getSectionTheme('stav_odeslani')}\n              isActive={isSectionActive('stav_odeslani')}\n            >\n              <SectionTitle sectionTheme={getSectionTheme('stav_odeslani')}>\n                <SectionIcon sectionTheme={getSectionTheme('stav_odeslani')}>\n                  <Package />\n                </SectionIcon>\n                Stav odesln objednvky\n                {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n                {shouldLockPhase3Sections && !shouldLockAllSections && (\n                  <LockWarning title=\"FZE 3 sekce je zamena ve FZI 4+. Odemen umon editaci FZE 3.\">\n                     Sekce zamena\n                  </LockWarning>\n                )}\n              </SectionTitle>\n              <SectionControls>\n                {/*  Nezobrazovat tlatko odemknut kdy je globln lock (shouldLockAllSections) */}\n                {shouldLockPhase3Sections && !shouldLockAllSections && canEditPhase3 && (\n                  <UnlockButton\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      setShowUnlockPhase3Confirm(true);\n                    }}\n                    title=\"Odemknout FZE 3 sekce\"\n                  >\n                    <Unlock />\n                  </UnlockButton>\n                )}\n                <CollapseIcon\n                  collapsed={sectionStates.stav_odeslani}\n                  sectionTheme={getSectionTheme('stav_odeslani')}\n                  onClick={() => toggleSection('stav_odeslani')}\n                  style={{ cursor: 'pointer' }}\n                >\n                  <FontAwesomeIcon icon={faChevronUp} />\n                </CollapseIcon>\n              </SectionControls>\n            </SectionHeader>\n              <SectionContent collapsed={sectionStates.stav_odeslani}>\n              <FormRow>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  <Label style={{ marginBottom: '1rem', fontSize: '1rem', fontWeight: '600' }}>\n                    KONEN STAV OBJEDNVKY\n                  </Label>\n\n                  {/* Odeslno */}\n                  <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '1rem',\n                    padding: '1rem',\n                    border: '1px solid #e5e7eb',\n                    borderRadius: '8px',\n                    backgroundColor: formData.stav_odeslano ? '#f0fdf4' : '#f9fafb',\n                    marginBottom: '1rem',\n                    opacity: (shouldLockPhase3Sections || showSaveProgress || isSaving) ? 0.6 : 1\n                  }}>\n                    <label style={{\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '0.75rem',\n                      fontSize: '1rem',\n                      fontWeight: '500',\n                      cursor: (shouldLockPhase3Sections || showSaveProgress || isSaving) ? 'not-allowed' : 'pointer',\n                      color: formData.stav_odeslano ? '#15803d' : '#374151'\n                    }}>\n                      <input\n                        type=\"checkbox\"\n                        name=\"stav_odeslano\"\n                        checked={formData.stav_odeslano || false}\n                        disabled={shouldLockPhase3Sections || showSaveProgress || isSaving}\n                        onChange={(e) => {\n                          const isChecked = e.target.checked;\n\n                          // Pi zakrtnut \"Odeslno\" odkrtnout \"Stornovno\" a smazat storno data\n                          if (isChecked) {\n                            handleInputChange('stav_stornovano', false);\n                            handleInputChange('datum_storna', '');\n                            handleInputChange('odeslani_storno_duvod', ''); // Smazat dvod storna pi odesln\n                            handleInputChange('storno_uzivatel_id', '');\n                            handleInputChange('storno_provedl', '');\n                          }\n\n                          // Hlavn zmna stavu - handleInputChange u obsahuje logiku pro nastaven datumu\n                          handleInputChange('stav_odeslano', isChecked);\n                        }}\n                        style={{\n                          width: '20px',\n                          height: '20px',\n                          accentColor: '#16a34a'\n                        }}\n                      />\n                      <Package size={20} />\n                      Odeslno\n                      {formData.stav_odeslano && (\n                        <span style={{\n                          marginLeft: '0.5rem',\n                          fontSize: '0.875rem',\n                          color: '#15803d',\n                          fontWeight: '600'\n                        }}>\n                          \n                        </span>\n                      )}\n                    </label>\n\n                    {/* Datum odesln vedle checkboxu */}\n                    {(formData.stav_odeslano || formData.dt_odeslani) && (\n                      <div style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem',\n                        marginLeft: 'auto'\n                      }}>\n                        <Label style={{ margin: 0, fontSize: '0.875rem' }}>DATUM:</Label>\n                        <div style={{ width: '280px' }}>\n                          <DatePicker\n                            fieldName=\"datum_odeslani\"\n                            value={formData.datum_odeslani}\n                            onChange={(value) => handleInputChange('datum_odeslani', value)}\n                            onBlur={(value) => handleFieldBlur('datum_odeslani', value)}\n                            disabled={shouldLockPhase3Sections}\n                            hasError={!!validationErrors.datum_odeslani}\n                            placeholder=\"Datum\"\n                          />\n                        </div>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Stornovno */}\n                  <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '1rem',\n                    padding: '1rem',\n                    border: '1px solid #e5e7eb',\n                    borderRadius: '8px',\n                    backgroundColor: formData.stav_stornovano ? '#fef2f2' : '#f9fafb',\n                    opacity: (shouldLockPhase3Sections || showSaveProgress || isSaving) ? 0.6 : 1\n                  }}>\n                    <label style={{\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '0.75rem',\n                      fontSize: '1rem',\n                      fontWeight: '500',\n                      cursor: (shouldLockPhase3Sections || showSaveProgress || isSaving) ? 'not-allowed' : 'pointer',\n                      color: formData.stav_stornovano ? '#dc2626' : '#374151'\n                    }}>\n                      <input\n                        type=\"checkbox\"\n                        name=\"stav_stornovano\"\n                        checked={formData.stav_stornovano || false}\n                        disabled={shouldLockPhase3Sections || showSaveProgress || isSaving}\n                        onChange={(e) => {\n                          const isChecked = e.target.checked;\n\n                          // Pi zakrtnut \"Stornovno\" odkrtnout \"Odeslno\"\n                          if (isChecked) {\n                            handleInputChange('stav_odeslano', false);\n                            handleInputChange('datum_odeslani', '');\n                          }\n\n                          //  HLAVN ZMNA - handleInputChange automaticky nastav datum v logice\n                          handleInputChange('stav_stornovano', isChecked);\n                        }}\n                        style={{\n                          width: '20px',\n                          height: '20px',\n                          accentColor: '#dc2626'\n                        }}\n                      />\n                      <FontAwesomeIcon icon={faTimes} size=\"lg\" />\n                      Stornovno\n                      {formData.stav_stornovano && (\n                        <span style={{\n                          marginLeft: '0.5rem',\n                          fontSize: '0.875rem',\n                          color: '#dc2626',\n                          fontWeight: '600'\n                        }}>\n                          \n                        </span>\n                      )}\n                    </label>\n\n                    {/* Datum storna vedle checkboxu */}\n                    {(formData.stav_stornovano || formData.datum_storna) && (\n                      <div style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem',\n                        marginLeft: 'auto'\n                      }}>\n                        <Label style={{ margin: 0, fontSize: '0.875rem' }}>DATUM:</Label>\n                        <div style={{ width: '280px' }}>\n                          <DatePicker\n                            fieldName=\"datum_storna\"\n                            value={formData.datum_storna}\n                            onChange={(value) => handleInputChange('datum_storna', value)}\n                            onBlur={(value) => handleFieldBlur('datum_storna', value)}\n                            disabled={shouldLockPhase3Sections}\n                            hasError={!!validationErrors.datum_storna}\n                            placeholder=\"Vyberte datum...\"\n                          />\n                        </div>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Dvod stornovn - zobraz se pouze kdy je stornovno zakrtnuto */}\n                  {formData.stav_stornovano && (\n                    <div style={{ marginTop: '1rem' }}>\n                      <Label style={{ marginBottom: '0.5rem' }}>\n                        DVOD STORNOVN\n                        <span style={{ color: '#dc2626', marginLeft: '0.25rem' }}>*</span>\n                      </Label>\n                      <TextArea\n                        name=\"odeslani_storno_duvod\"\n                        placeholder=\"Uvete dvod stornovn objednvky...\"\n                        value={formData.odeslani_storno_duvod || ''}\n                        onChange={(e) => handleInputChange('odeslani_storno_duvod', e.target.value)}\n                        onBlur={(e) => handleFieldBlur('odeslani_storno_duvod', e.target.value)}\n                        rows={3}\n                        style={{\n                          border: '1px solid #fca5a5',\n                          backgroundColor: '#fef2f2'\n                        }}\n                      />\n                      {validationErrors.odeslani_storno_duvod && (\n                        <ErrorText style={{ marginTop: '0.5rem' }}>{validationErrors.odeslani_storno_duvod}</ErrorText>\n                      )}\n                    </div>\n                  )}\n\n                  {validationErrors.datum_odeslani && (\n                    <ErrorText style={{ marginTop: '0.5rem' }}>{validationErrors.datum_odeslani}</ErrorText>\n                  )}\n                  {validationErrors.datum_storna && (\n                    <ErrorText style={{ marginTop: '0.5rem' }}>{validationErrors.datum_storna}</ErrorText>\n                  )}\n\n                  {/* Informace o stavu */}\n                  {formData.stav_odeslano ? (\n                    <div style={{\n                      marginTop: '1rem',\n                      padding: '0.75rem 1rem',\n                      backgroundColor: '#dcfce7',\n                      border: '1px solid #16a34a',\n                      borderRadius: '6px',\n                      color: '#166534',\n                      fontSize: '0.875rem'\n                    }}>\n                      <div style={{ fontWeight: '600' }}>\n                        {formData.dt_odeslani && formData.odesilatel_id && hasWorkflowState(formData.stav_workflow_kod, 'ODESLANA') ? (\n                          // Data existuj + stav ODESLANA = byla ji odeslna\n                          <>\n                             Objednvka byla odeslna\n                            <div style={{ marginTop: '0.25rem', fontSize: '0.875rem', fontWeight: 'normal' }}>\n                              <strong>Datum odesln:</strong> {(() => {\n                                // Formtovn jen data bez asu (dt_odeslani z DB me obsahovat datetime)\n                                const dateStr = formData.dt_odeslani.split(' ')[0]; // Odstranit as\n                                const [year, month, day] = dateStr.split('-');\n                                return `${day}. ${month}. ${year}`;\n                              })()}  <strong>Odeslal:</strong> {getUserNameById(formData.odesilatel_id)}\n                            </div>\n                          </>\n                        ) : formData.datum_odeslani ? (\n                          // M datum ale jet nebyla odeslna - bude odeslna\n                          ` Objednvka bude oznaena jako odeslan dne ${formatDateOnly(new Date(formData.datum_odeslani))}`\n                        ) : (\n                          // Nem datum - bude odeslna po uloen\n                          ` Objednvka bude oznaena jako odeslan po uloen`\n                        )}\n                      </div>\n                    </div>\n                  ) : formData.stav_stornovano ? (\n                    <div style={{\n                      marginTop: '1rem',\n                      padding: '0.75rem 1rem',\n                      backgroundColor: '#fef2f2',\n                      border: '1px solid #f87171',\n                      borderRadius: '6px',\n                      color: '#991b1b',\n                      fontSize: '0.875rem'\n                    }}>\n                      <div style={{ fontWeight: '600' }}>\n                        {formData.dt_odeslani && formData.odesilatel_id && hasWorkflowState(formData.stav_workflow_kod, 'STORNOVANA') ? (\n                          // Data existuj + stav STORNOVANA = byla ji stornovna\n                          <>\n                             Objednvka byla stornovna\n                            <div style={{ marginTop: '0.5rem', fontSize: '0.875rem', fontWeight: 'normal' }}>\n                              <strong>Datum stornovn:</strong> {formData.dt_odeslani}\n                              {'  '}\n                              <strong>Stornoval:</strong> {getUserNameById(formData.odesilatel_id)}\n                            </div>\n                            {formData.odeslani_storno_duvod && (\n                              <div style={{ marginTop: '0.5rem', fontSize: '0.875rem', fontWeight: 'normal' }}>\n                                <strong>Dvod stornovn:</strong> {formData.odeslani_storno_duvod}\n                              </div>\n                            )}\n                          </>\n                        ) : (\n                          // Byla stornovna po uloen\n                          <>\n                             Objednvka byla stornovna {formData.datum_storna ? `dne ${formatDateOnly(new Date(formData.datum_storna))}` : 'po uloen'}\n                            {formData.odeslani_storno_duvod && (\n                              <div style={{ marginTop: '0.5rem', fontSize: '0.875rem', fontWeight: 'normal' }}>\n                                <strong>Dvod stornovn:</strong> {formData.odeslani_storno_duvod}\n                              </div>\n                            )}\n                          </>\n                        )}\n                      </div>\n                    </div>\n                  ) : null}\n                </FormGroup>\n              </FormRow>\n            </SectionContent>\n          </FormSection>\n\n          {/* INFORMAN BLOK - KONEC FZE 2 */}\n          {(isArchived || currentPhase >= 2) && hasWorkflowState(formData.stav_workflow_kod, 'SCHVALENA') && !formData.stav_odeslano && !formData.stav_stornovano && (\n            <div style={{\n              margin: '2rem 0',\n              padding: '1rem 1.25rem',\n              backgroundColor: '#fef3c7',\n              border: '1px solid #f59e0b',\n              borderRadius: '8px',\n              color: '#92400e'\n            }}>\n              <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                 Objednvka zatm nebyla dokonena\n              </div>\n              <div style={{ fontSize: '0.875rem' }}>\n                Zakrtnte \"Odeslno\" kdy bude objednvka skuten odeslna dodavateli, nebo \"Stornovno\" pokud se objednvka nebude realizovat.\n              </div>\n            </div>\n          )}\n\n          {/* FZE 3: Dal sekce zobrazen ve FZI 3 (pouze pokud nen stornovno) */}\n          {(isArchived || currentPhase >= 3) && !formData.stav_stornovano && (\n            <>\n              {/* FZE 4+: Sekce potvrzen dodavatelem - zobraz se a po ODESLN dodavateli */}\n\n              {/* Sekce: Potvrzen objednvky dodavatelem */}\n              {/*  ZOBRAZIT vdy kdy workflow prolo pes ODESLANA nebo POTVRZENA - jako HISTORIE */}\n              {(() => {\n                const phaseCheck = currentPhase >= 4;\n                const workflowCheck = hasWorkflowState(formData.stav_workflow_kod, 'ODESLANA') ||\n                                       hasWorkflowState(formData.stav_workflow_kod, 'POTVRZENA');\n                const shouldShow = phaseCheck && workflowCheck;\n\n                return shouldShow;\n              })() && (\n              <FormSection data-section=\"potvrzeni_objednavky\">\n                <SectionHeader\n                  sectionTheme={getSectionTheme('potvrzeni_objednavky')}\n                  isActive={isSectionActive('potvrzeni_objednavky')}\n                >\n                  <SectionTitle sectionTheme={getSectionTheme('potvrzeni_objednavky')}>\n                    <SectionIcon sectionTheme={getSectionTheme('potvrzeni_objednavky')}>\n                      <FontAwesomeIcon icon={faCheckCircle} />\n                    </SectionIcon>\n                    Potvrzen objednvky dodavatelem\n                    {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n                    {isPotvrzeniLocked && !shouldLockAllSections && (\n                      <LockWarning title=\"Sekce z minul fze je uzamena (read-only historie). Odemknout me administrtor nebo uivatel s prvem ORDER_MANAGE.\">\n                         Sekce zamena\n                      </LockWarning>\n                    )}\n                  </SectionTitle>\n                  <SectionControls>\n                    {/*  Nezobrazovat tlatko odemknut kdy je globln lock (shouldLockAllSections) */}\n                    {isPotvrzeniLocked && !shouldLockAllSections && canUnlockAnything && (\n                      <UnlockButton\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setShowUnlockPotvrzeniConfirm(true);\n                        }}\n                        title=\"Odemknout sekci Potvrzen od dodavatele\"\n                      >\n                        <Unlock />\n                      </UnlockButton>\n                    )}\n\n                    <CollapseIcon\n                      collapsed={sectionStates.potvrzeni_objednavky}\n                      sectionTheme={getSectionTheme('potvrzeni_objednavky')}\n                      onClick={() => toggleSection('potvrzeni_objednavky')}\n                      style={{ cursor: 'pointer' }}\n                    >\n                      <FontAwesomeIcon icon={faChevronUp} />\n                    </CollapseIcon>\n                  </SectionControls>\n                </SectionHeader>\n                <SectionContent collapsed={sectionStates.potvrzeni_objednavky} data-section=\"potvrzeni_objednavky\">\n                  <FormRow>\n                    <FormGroup style={{gridColumn: '1 / -1'}}>\n                      {/* Potvrzen od dodavatele - ANO/NE */}\n                      <div style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '1rem',\n                        padding: '1rem',\n                        border: '1px solid #e5e7eb',\n                        borderRadius: '8px',\n                        backgroundColor: formData.dodavatel_zpusob_potvrzeni?.potvrzeni === 'ANO' ? '#f0fdf4' : '#f9fafb',\n                        marginBottom: '1rem'\n                      }}>\n                        <span style={{\n                          fontSize: '1rem',\n                          fontWeight: '500',\n                          color: '#374151'\n                        }}>\n                          Dodavatel objednvku potvrdil:\n                        </span>\n                        <div style={{ display: 'flex', gap: '1rem' }}>\n                          {['ANO', 'NE'].map(option => (\n                            <label key={option} style={{\n                              display: 'flex',\n                              alignItems: 'center',\n                              gap: '0.5rem',\n                              padding: '0.5rem 1rem',\n                              border: '1px solid #e5e7eb',\n                              borderRadius: '6px',\n                              cursor: shouldLockPhase4to6Sections ? 'not-allowed' : 'pointer',\n                              backgroundColor: formData.dodavatel_zpusob_potvrzeni?.potvrzeni === option ? '#f0f9ff' : '#fff',\n                              opacity: shouldLockPhase4to6Sections ? 0.6 : 1,\n                              fontWeight: '500'\n                            }}>\n                              <input\n                                type=\"radio\"\n                                name=\"potvrzeni_dodavatele\"\n                                value={option}\n                                checked={formData.dodavatel_zpusob_potvrzeni?.potvrzeni === option}\n                                disabled={shouldLockPhase4to6Sections}\n                                onChange={() => {}} // Przdn onChange\n                                onClick={(e) => {\n                                  const currentValue = formData.dodavatel_zpusob_potvrzeni?.potvrzeni;\n                                  let newValue;\n\n                                  // Pokud klikm na ji vybranou monost, odkrtni ji\n                                  if (currentValue === e.target.value) {\n                                    newValue = '';\n                                  } else {\n                                    newValue = e.target.value;\n                                  }\n\n                                  const newData = {\n                                    ...formData.dodavatel_zpusob_potvrzeni,\n                                    potvrzeni: newValue,\n                                    zpusoby: newValue === 'ANO' ? formData.dodavatel_zpusob_potvrzeni?.zpusoby || [] : [],\n                                    platba: newValue === 'ANO' ? 'faktura' : '' //  Vdy \"faktura\" kdy je ANO\n                                  };\n                                  handleInputChange('dodavatel_zpusob_potvrzeni', newData);\n\n                                  //  AUTOMATICKY nastavit dodavatel_potvrdil_id pi zmn potvrzen\n                                  if (newValue === 'ANO' && user_id) {\n                                    handleInputChange('dodavatel_potvrdil_id', user_id);\n                                    addDebugLog('info', 'AKCEPTACE', 'dodavatel-potvrdil', `Automaticky nastaven dodavatel_potvrdil_id: ${user_id}`);\n                                  } else if (newValue !== 'ANO') {\n                                    handleInputChange('dodavatel_potvrdil_id', null);\n                                    addDebugLog('info', 'AKCEPTACE', 'dodavatel-reset', `Vymazn dodavatel_potvrdil_id (potvrzen nen ANO)`);\n                                  }\n                                }}\n                                style={{ cursor: 'pointer' }}\n                              />\n                              {option}\n                            </label>\n                          ))}\n                        </div>\n                      </div>\n\n                      {/* Zpsob potvrzen - zobraz se pouze pokud je ANO */}\n                      {formData.dodavatel_zpusob_potvrzeni?.potvrzeni === 'ANO' && (\n                        <>\n                          <FormRow>\n                            {/* Lev sloupec: Zpsob potvrzen */}\n                            <FormGroup>\n                              <Label required>Zpsob potvrzen</Label>\n                              <div style={{\n                                display: 'flex',\n                                flexDirection: 'column',\n                                gap: '0.5rem',\n                                marginTop: '0.5rem'\n                              }}>\n                                {[\n                                  { value: 'email', label: 'E-mail' },\n                                  { value: 'telefon', label: 'Telefont' },\n                                  { value: 'podepsana_objednavka', label: 'Podepsan objednvka' },\n                                  { value: 'eshop', label: 'e-Shop' }\n                                ].map(option => {\n                                  const isChecked = Array.isArray(formData.dodavatel_zpusob_potvrzeni?.zpusoby)\n                                    ? formData.dodavatel_zpusob_potvrzeni.zpusoby.includes(option.value)\n                                    : false;\n\n                                  const isDisabled = formData.dodavatel_zpusob_potvrzeni?.potvrzeni !== 'ANO' ||\n                                    shouldLockPhase4to6Sections ||\n                                    showSaveProgress ||\n                                    isSaving;\n\n                                  const hasValidationError = !!validationErrors.dodavatel_zpusob_potvrzeni;\n\n                                  return (\n                                    <label key={option.value} style={{\n                                      display: 'flex',\n                                      alignItems: 'center',\n                                      gap: '0.5rem',\n                                      padding: '0.5rem 1rem',\n                                      border: hasValidationError ? '2px solid #dc2626' : '1px solid #e5e7eb',\n                                      borderRadius: '6px',\n                                      cursor: isDisabled ? 'not-allowed' : 'pointer',\n                                      backgroundColor: isChecked ? '#f0f9ff' : '#fff',\n                                      opacity: isDisabled ? 0.5 : 1\n                                    }}>\n                                      <input\n                                        type=\"checkbox\"\n                                        checked={isChecked}\n                                        disabled={isDisabled}\n                                        onChange={(e) => {\n                                          const currentZpusoby = Array.isArray(formData.dodavatel_zpusob_potvrzeni?.zpusoby)\n                                            ? formData.dodavatel_zpusob_potvrzeni.zpusoby\n                                            : [];\n\n                                          let newZpusoby;\n                                          if (e.target.checked) {\n                                            newZpusoby = [...currentZpusoby, option.value];\n                                          } else {\n                                            newZpusoby = currentZpusoby.filter(val => val !== option.value);\n                                          }\n\n                                          const newData = {\n                                            ...formData.dodavatel_zpusob_potvrzeni,\n                                            zpusoby: newZpusoby\n                                          };\n                                          \n                                          //  OPRAVA: Aktualizovat OBA fieldy NAJEDNOU pomoc setFormData\n                                          const now = new Date().toISOString();\n                                          setFormData(prev => ({\n                                            ...prev,\n                                            dodavatel_zpusob_potvrzeni: newData,\n                                            dt_akceptace: newZpusoby.length > 0 ? now : ''\n                                          }));\n                                          setIsChanged(true);\n                                        }}\n                                        style={{ cursor: 'pointer' }}\n                                      />\n                                      {option.label}\n                                    </label>\n                                  );\n                                })}\n                              </div>\n                              {validationErrors.dodavatel_zpusob_potvrzeni && (\n                                <div style={{\n                                  color: '#dc2626',\n                                  fontSize: '0.875rem',\n                                  marginTop: '0.5rem',\n                                  fontWeight: '500'\n                                }}>\n                                  {validationErrors.dodavatel_zpusob_potvrzeni}\n                                </div>\n                              )}\n                            </FormGroup>\n\n                            {/* Prav sloupec: Datum akceptace + Zpsob platby */}\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\n                              {/* Datum akceptace - zobraz se vdy kdy je ANO zakrtnuto */}\n                              {formData.dodavatel_zpusob_potvrzeni?.potvrzeni === 'ANO' && (\n                              <FormGroup>\n                                <Label required>Datum akceptace</Label>\n                                <DatePicker\n                                  fieldName=\"dt_akceptace\"\n                                  value={formData.dt_akceptace}\n                                  onChange={(value) => handleInputChange('dt_akceptace', value)}\n                                  onBlur={(value) => handleFieldBlur('dt_akceptace', value)}\n                                  disabled={\n                                    shouldLockPhase4to6Sections ||\n                                    showSaveProgress ||\n                                    isSaving\n                                  }\n                                  hasError={!!validationErrors.dt_akceptace}\n                                  placeholder=\"Vyberte datum...\"\n                                />\n                                {validationErrors.dt_akceptace && (\n                                  <div style={{\n                                    color: '#dc2626',\n                                    fontSize: '0.875rem',\n                                    marginTop: '0.5rem',\n                                    fontWeight: '500'\n                                  }}>\n                                    {validationErrors.dt_akceptace}\n                                  </div>\n                                )}\n                              </FormGroup>\n                              )}\n\n                              {/* Zpsob platby - pouze Faktura */}\n                              <FormGroup style={{ marginTop: 'calc(2.5rem + 2px)' }}>\n                                <Label required>Zpsob platby</Label>\n                                <div style={{\n                                  display: 'flex',\n                                  flexDirection: 'column',\n                                  gap: '0.5rem',\n                                  marginTop: '0.5rem'\n                                }}>\n                                  <label style={{\n                                    display: 'flex',\n                                    alignItems: 'center',\n                                    gap: '0.5rem',\n                                    padding: '0.5rem 1rem',\n                                    border: '1px solid #e5e7eb',\n                                    borderRadius: '6px',\n                                    cursor: 'default',\n                                    backgroundColor: '#f0f9ff',\n                                    marginTop: '2px'\n                                  }}>\n                                    <input\n                                      type=\"radio\"\n                                      name=\"platba_dodavatel\"\n                                      value=\"faktura\"\n                                      checked={true}\n                                      disabled={shouldLockPhase4to6Sections || showSaveProgress || isSaving}\n                                      readOnly\n                                      style={{ cursor: 'default' }}\n                                    />\n                                    Faktura\n                                  </label>\n                                </div>\n                                {validationErrors.zpusob_platby && (\n                                  <div style={{\n                                    color: '#dc2626',\n                                    fontSize: '0.875rem',\n                                    marginTop: '0.5rem',\n                                    fontWeight: '500'\n                                  }}>\n                                    {validationErrors.zpusob_platby}\n                                  </div>\n                                )}\n                              </FormGroup>\n                            </div>\n                          </FormRow>\n                        </>\n                      )}\n\n                      {/* Informan zprva o dalch sekcch - zobraz se po potvrzen dodavatelem, ale ne kdy je ji odeslno */}\n                      {formData.dodavatel_zpusob_potvrzeni?.potvrzeni === 'ANO' &&\n                       formData.dodavatel_zpusob_potvrzeni?.zpusoby?.length > 0 &&\n                       formData.dodavatel_zpusob_potvrzeni?.platba &&\n                       !formData.stav_odeslano &&\n                       currentPhase < 4 && (\n                        <div style={{\n                          backgroundColor: '#f0f9ff',\n                          border: '1px solid #bfdbfe',\n                          borderRadius: '8px',\n                          padding: '1rem',\n                          marginTop: '1rem',\n                          display: 'flex',\n                          flexDirection: 'column',\n                          gap: '0.5rem'\n                        }}>\n                          <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                            <FontAwesomeIcon\n                              icon={faInfoCircle}\n                              style={{ color: '#3b82f6', fontSize: '1rem' }}\n                            />\n                            <span style={{ fontSize: '0.875rem', color: '#1e40af' }}>\n                              Po vyplnn daj o dodavateli budou dostupn dal sekce.\n                            </span>\n                          </div>\n                          {formData.dt_akceptace && (\n                            <div style={{ fontSize: '0.875rem', color: '#1e40af', marginTop: '0.25rem' }}>\n                              <strong>Datum potvrzen:</strong> {formatDateOnly(formData.dt_akceptace)}\n                              {formData.dodavatel_potvrdil_id && (\n                                <div style={{ marginTop: '0.25rem' }}>\n                                  <strong>Potvrdil:</strong> {getUserNameById(formData.dodavatel_potvrdil_id)}\n                                </div>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                      )}\n                    </FormGroup>\n                  </FormRow>\n\n                  {/* Info blok - Dodavatel potvrdil objednvku */}\n                  {/*  ZOBRAZ SE JEN PO ULOEN DO DB (workflow POTVRZENA) */}\n                  {hasWorkflowState(formData.stav_workflow_kod, 'POTVRZENA') && formData.dodavatel_potvrdil_id && formData.dt_akceptace ? (\n                    <div style={{\n                      backgroundColor: '#dcfce7',\n                      border: '1px solid #16a34a',\n                      borderRadius: '6px',\n                      padding: '1rem',\n                      marginTop: '1rem',\n                      color: '#166534',\n                      fontSize: '0.875rem'\n                    }}>\n                      <div style={{ fontWeight: '600', marginBottom: '0.25rem' }}>\n                         Dodavatel potvrdil objednvku\n                      </div>\n                      <div>\n                        <strong>Datum potvrzen:</strong> {formatDateOnly(formData.dt_akceptace)}  <strong>Potvrdil:</strong> {getUserNameById(formData.dodavatel_potvrdil_id)}\n                      </div>\n                      {/* Zpsob potvrzen a platba - na jednom dku */}\n                      {(formData.dodavatel_zpusob_potvrzeni?.zpusoby?.length > 0 || formData.dodavatel_zpusob_potvrzeni?.platba) && (\n                        <div>\n                          {formData.dodavatel_zpusob_potvrzeni?.zpusoby?.length > 0 && (\n                            <>\n                              <strong>Zpsob potvrzen:</strong> {formData.dodavatel_zpusob_potvrzeni.zpusoby.map(zpusob => {\n                                const labels = {\n                                  'email': 'E-mail',\n                                  'telefon': 'Telefont',\n                                  'podepsana_objednavka': 'Podepsan objednvka',\n                                  'eshop': 'e-Shop'\n                                };\n                                return labels[zpusob] || zpusob;\n                              }).join(', ')}\n                            </>\n                          )}\n                          {formData.dodavatel_zpusob_potvrzeni?.zpusoby?.length > 0 && formData.dodavatel_zpusob_potvrzeni?.platba && '  '}\n                          {formData.dodavatel_zpusob_potvrzeni?.platba && (\n                            <>\n                              <strong>Platba:</strong> {formData.dodavatel_zpusob_potvrzeni.platba === 'faktura' ? 'Fakturou' :\n                                                          formData.dodavatel_zpusob_potvrzeni.platba === 'hotove' ? 'Hotov (pokladna)' :\n                                                          formData.dodavatel_zpusob_potvrzeni.platba}\n                            </>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  ) : (\n                    <div style={{\n                      backgroundColor: '#dbeafe',\n                      border: '2px solid #3b82f6',\n                      borderRadius: '8px',\n                      padding: '1rem',\n                      marginTop: '1rem',\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '0.5rem'\n                    }}>\n                      <FontAwesomeIcon\n                        icon={faInfoCircle}\n                        style={{ color: '#3b82f6', fontSize: '1.25rem' }}\n                      />\n                      <div style={{ flex: 1 }}>\n                        <div style={{ fontWeight: '600', color: '#1e40af', marginBottom: '0.25rem' }}>\n                           ek se na potvrzen dodavatelem\n                        </div>\n                        <div style={{ fontSize: '0.875rem', color: '#1e40af' }}>\n                          Po potvrzen objednvky dodavatelem se zde zobraz daje o potvrzen.\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                </SectionContent>\n              </FormSection>\n              )}\n\n              {/* Sekce: Uveejnn v registru smluv */}\n              {/*  FZE 4: Pouze checkbox \"M bt zveejnna\" */}\n              {registrState.visible && (\n              <FormSection data-section=\"registr_smluv\">\n                <SectionHeader\n                  sectionTheme={getSectionTheme('registr_smluv')}\n                  isActive={isSectionActive('registr_smluv')}\n                >\n                  <SectionTitle sectionTheme={getSectionTheme('registr_smluv')}>\n                    <SectionIcon sectionTheme={getSectionTheme('registr_smluv')}>\n                      <FontAwesomeIcon icon={faFileContract} />\n                    </SectionIcon>\n                    <span>Rozhodnut o zveejnn v registru smluv</span>\n\n                    {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n                    {isRegistrLocked && !shouldLockAllSections && (\n                      <LockWarning title={\n                        (formData.dt_zverejneni && formData.registr_iddt && formData.ma_byt_zverejnena)\n                          ? 'Registr je zveejnn a zamen. Odemknout me pouze uivatel s oprvnnm ORDER_PUBLISH_REGISTRY.'\n                          : ((formData.ma_byt_zverejnena === false && currentPhase >= 6)\n                            ? 'Registr nen k zveejnn a je zamen. Odemknout me pouze uivatel s oprvnnm ORDER_PUBLISH_REGISTRY.'\n                            : 'Registr je zamen. Odemknout me pouze uivatel s oprvnnm ORDER_PUBLISH_REGISTRY.'\n                          )\n                      }>\n                         Sekce zamena\n                      </LockWarning>\n                    )}\n                  </SectionTitle>\n\n                  <SectionControls>\n                    {/*  Nezobrazovat tlatko odemknut kdy je globln lock (shouldLockAllSections) */}\n                    {isRegistrLocked && !shouldLockAllSections && canPublishRegistry && (\n                      <UnlockButton\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setShowUnlockRegistrConfirm(true);\n                        }}\n                        title=\"Odemknout sekci Registr smluv\"\n                      >\n                        <Unlock />\n                      </UnlockButton>\n                    )}\n\n                    <CollapseIcon\n                      collapsed={sectionStates.registr_smluv}\n                      sectionTheme={getSectionTheme('registr_smluv')}\n                      onClick={() => toggleSection('registr_smluv')}\n                      style={{ cursor: 'pointer' }}\n                    >\n                      <FontAwesomeIcon icon={faChevronUp} />\n                    </CollapseIcon>\n                  </SectionControls>\n                </SectionHeader>\n                <SectionContent collapsed={sectionStates.registr_smluv}>\n                  {/* CHECKBOX \"M bt zveejnna\" - zobraz se vdy kdy je sekce viditeln */}\n                  <div style={{ marginBottom: '1.5rem' }}>\n                    <Label style={{ marginBottom: '0.5rem' }}>Zveejnn</Label>\n                    <label style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.75rem',\n                        padding: '0.625rem 1rem',\n                        backgroundColor: formData.ma_byt_zverejnena ? '#dcfce7' : '#fff',\n                        border: formData.ma_byt_zverejnena ? '2px solid #16a34a' : '2px solid #e5e7eb',\n                        borderRadius: '8px',\n                        cursor: (isRegistrLocked) ? 'not-allowed' : 'pointer',\n                        fontSize: '0.95rem',\n                        fontWeight: '500',\n                        color: formData.ma_byt_zverejnena ? '#166534' : '#374151',\n                        opacity: (isRegistrLocked) ? 0.6 : 1,\n                        minHeight: '44px',\n                        boxSizing: 'border-box'\n                      }}>\n                        <input\n                          type=\"checkbox\"\n                          checked={formData.ma_byt_zverejnena || false}\n                          onChange={(e) => {\n                            // Pokud je sekce zamena, nedlej nic\n                            if (isRegistrLocked) return;\n\n                            // Pokud odkrtv a cena >= 50K, zobrazit confirm dialog\n                            if (!e.target.checked && formData.ma_byt_zverejnena && celkovaCenaBezDPH >= 50000) {\n                              setShowCancelPublishConfirm(true);\n                            } else {\n                              // Bu zakrtv, nebo odkrtv pod 50K  prost zm\n                              handleInputChange('ma_byt_zverejnena', e.target.checked);\n                            }\n                          }}\n                          disabled={isRegistrLocked}\n                          style={{\n                            width: '18px',\n                            height: '18px',\n                            cursor: (isRegistrLocked) ? 'not-allowed' : 'pointer',\n                            flexShrink: 0\n                          }}\n                        />\n                        <span style={{ flex: 1 }}>\n                          {currentPhase >= 5\n                            ? 'Objednvka m bt zveejnna v registru smluv'\n                            : 'M bt zveejnna'}\n                        </span>\n                      </label>\n\n                      {/* Informan text o povinnosti zveejnn */}\n                      <div style={{\n                        marginTop: '0.75rem',\n                        padding: '0.75rem 1rem',\n                        backgroundColor: celkovaCenaBezDPH >= 50000 ? '#dbeafe' : '#f3f4f6',\n                        border: `1px solid ${celkovaCenaBezDPH >= 50000 ? '#3b82f6' : '#d1d5db'}`,\n                        borderRadius: '6px',\n                        fontSize: '0.875rem',\n                        color: celkovaCenaBezDPH >= 50000 ? '#1e40af' : '#6b7280'\n                      }}>\n                        <div style={{ display: 'flex', alignItems: 'flex-start', gap: '0.5rem' }}>\n                          <FontAwesomeIcon\n                            icon={faInfoCircle}\n                            style={{ fontSize: '1rem', marginTop: '0.125rem', flexShrink: 0 }}\n                          />\n                          <div>\n                            <div style={{ fontWeight: '600', marginBottom: '0.25rem' }}>\n                              {celkovaCenaBezDPH >= 50000 ? 'Povinn zveejnn' : 'Voliteln zveejnn'}\n                            </div>\n                            <div>\n                              {celkovaCenaBezDPH >= 50000 ? (\n                                <>\n                                  Celkov cena <strong>{celkovaCenaBezDPH.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K bez DPH</strong> je nad limitem 50 000 K.\n                                  Objednvka <strong>mus bt zveejnna</strong> v registru smluv podle zkona.\n                                </>\n                              ) : (\n                                <>\n                                  Celkov cena <strong>{celkovaCenaBezDPH.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K bez DPH</strong> je pod limitem 50 000 K.\n                                  Zveejnn v registru smluv je voliteln.\n                                </>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n\n                  {/* FZE 4: Instrukce a varovn */}\n                  {(isArchived || currentPhase === 4) && (\n                    <>\n                      {!formData.ma_byt_zverejnena && celkovaCenaBezDPH < 50000 && (\n                        <div style={{\n                          padding: '1rem',\n                          backgroundColor: '#fef3c7',\n                          border: '1px solid #f59e0b',\n                          borderRadius: '6px',\n                          fontSize: '0.875rem',\n                          color: '#92400e'\n                        }}>\n                           Po uloen s odkrtnutm checkboxem se pesko vyplovn registru smluv a pokrauje se pmo k fakturaci.\n                        </div>\n                      )}\n                    </>\n                  )}\n                </SectionContent>\n              </FormSection>\n              )}\n              {/* KONEC: Sekce Registr smluv (FZE 4 - checkbox) */}\n\n              {/*  INFORMAN BLOK: Pro uivatele BEZ prva ORDER_PUBLISH_REGISTRY - pouze kdy EK na vyplnn */}\n              {(() => {\n                const isRegistrFilled = formData.dt_zverejneni && formData.registr_iddt;\n                const showInfoBlock = registrVyplneniState.visible && !canPublishRegistry && !isRegistrFilled;\n                return showInfoBlock && (\n                  <div style={{\n                    margin: '2rem 0',\n                    padding: '1rem 1.25rem',\n                    backgroundColor: '#fef3c7',\n                    border: '1px solid #f59e0b',\n                    borderRadius: '8px',\n                    color: '#92400e'\n                  }}>\n                    <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                       Zveejnn v registru smluv\n                    </div>\n                    <div style={{ fontSize: '0.875rem' }}>\n                      Objednvka ek na zveejnn v registru smluv. Tuto akci me provst pouze uivatel s oprvnnm pro sprvu registru.\n                    </div>\n                  </div>\n                );\n              })()}\n\n              {/*  SEKCE: VYPLNN REGISTRU SMLUV - ZOBRAZ SE VE FZI 5 (UVEREJNIT) */}\n              {/*  FZE 5: Datum + IDDT + checkbox (VOLITELN - pouze kdy ANO ve FZI 4) */}\n              {/*  PRVA: \n                  - Uivatel S prvem ORDER_PUBLISH_REGISTRY vid sekci ve FZI 5 (mohou vyplnit registr)\n                  - Uivatel BEZ prva vid sekci kdy je ji vyplnn (dt_zverejneni + registr_iddt)\n              */}\n              {(() => {\n                const isRegistrFilled = formData.dt_zverejneni && formData.registr_iddt;\n                const shouldShowRegistrVyplneni = registrVyplneniState.visible && (\n                  canPublishRegistry || isRegistrFilled\n                );\n                return shouldShowRegistrVyplneni && (\n              <FormSection data-section=\"registr_smluv_vyplneni\">\n                <SectionHeader\n                  sectionTheme={getSectionTheme('registr_smluv_vyplneni')}\n                  isActive={isSectionActive('registr_smluv_vyplneni')}\n                >\n                  <SectionTitle sectionTheme={getSectionTheme('registr_smluv_vyplneni')}>\n                    <SectionIcon sectionTheme={getSectionTheme('registr_smluv_vyplneni')}>\n                      <FontAwesomeIcon icon={faFileContract} />\n                    </SectionIcon>\n                    <span>Potvrzen zveejnn objednvky v registru smluv</span>\n\n                    {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n                    {isRegistrVyplneniLocked && !shouldLockAllSections && (\n                      <LockWarning title=\"Registr je zamen. Odemknout me pouze uivatel s oprvnnm ORDER_PUBLISH_REGISTRY.\">\n                         Sekce zamena\n                      </LockWarning>\n                    )}\n                  </SectionTitle>\n\n                  <SectionControls>\n                    {/*  Nezobrazovat tlatko odemknut kdy je globln lock (shouldLockAllSections) */}\n                    {isRegistrVyplneniLocked && !shouldLockAllSections && canPublishRegistry && (\n                      <UnlockButton\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setShowUnlockRegistrConfirm(true);\n                        }}\n                        title=\"Odemknout sekci Registr smluv\"\n                      >\n                        <Unlock />\n                      </UnlockButton>\n                    )}\n\n                    <CollapseIcon\n                      collapsed={sectionStates.registr_smluv_vyplneni}\n                      sectionTheme={getSectionTheme('registr_smluv_vyplneni')}\n                      onClick={() => toggleSection('registr_smluv_vyplneni')}\n                      style={{ cursor: 'pointer' }}\n                    >\n                      <FontAwesomeIcon icon={faChevronUp} />\n                    </CollapseIcon>\n                  </SectionControls>\n                </SectionHeader>\n                <SectionContent collapsed={sectionStates.registr_smluv_vyplneni}>\n                  {/* Grid 3 sloupce: Checkbox | Datum | Identifiktor */}\n                  <div style={{\n                    display: 'grid',\n                    gridTemplateColumns: '300px 1fr 1fr',\n                    gap: '1.5rem',\n                    alignItems: 'start'\n                  }}>\n                    {/* 1. CHECKBOX - M bt zveejnna */}\n                    <div>\n                      <Label style={{ marginBottom: '0.5rem' }}>Zveejnn</Label>\n                      <label style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.75rem',\n                        padding: '0.625rem 1rem',\n                        backgroundColor: formData.ma_byt_zverejnena ? '#dcfce7' : '#fff',\n                        border: formData.ma_byt_zverejnena ? '2px solid #16a34a' : '2px solid #e5e7eb',\n                        borderRadius: '8px',\n                        cursor: isRegistrVyplneniLocked ? 'not-allowed' : 'pointer',\n                        fontSize: '0.95rem',\n                        fontWeight: '500',\n                        color: formData.ma_byt_zverejnena ? '#166534' : '#374151',\n                        opacity: isRegistrVyplneniLocked ? 0.6 : 1,\n                        minHeight: '44px',\n                        boxSizing: 'border-box'\n                      }}>\n                        <input\n                          type=\"checkbox\"\n                          checked={formData.ma_byt_zverejnena || false}\n                          onChange={(e) => {\n                            if (isRegistrVyplneniLocked) return;\n\n                            // Pokud odkrtv a cena >= 50K, zobrazit confirm dialog\n                            if (!e.target.checked && formData.ma_byt_zverejnena && celkovaCenaBezDPH >= 50000) {\n                              setShowCancelPublishConfirm(true);\n                            } else {\n                              handleInputChange('ma_byt_zverejnena', e.target.checked);\n                            }\n                          }}\n                          disabled={isRegistrVyplneniLocked}\n                          style={{\n                            width: '18px',\n                            height: '18px',\n                            cursor: isRegistrVyplneniLocked ? 'not-allowed' : 'pointer',\n                            flexShrink: 0\n                          }}\n                        />\n                        <span style={{ flex: 1, whiteSpace: 'nowrap' }}>M bt zveejnna</span>\n                      </label>\n                    </div>\n\n                    {/* 2. DATUM ZVEEJNN */}\n                    <div>\n                      <Label required={formData.ma_byt_zverejnena}>Datum zveejnn (VZ)</Label>\n                      <DatePicker\n                        fieldName=\"dt_zverejneni\"\n                        value={formData.dt_zverejneni}\n                        onChange={(value) => {\n                          handleInputChange('dt_zverejneni', value);\n                          if (value && !formData.zverejnil_id) {\n                            const user_id = localStorage.getItem('user_id');\n                            if (user_id) {\n                              handleInputChange('zverejnil_id', parseInt(user_id, 10));\n                            }\n                          }\n                        }}\n                        onBlur={(value) => handleFieldBlur('dt_zverejneni', value)}\n                        disabled={!formData.ma_byt_zverejnena || isRegistrVyplneniLocked}\n                        hasError={!!validationErrors.dt_zverejneni}\n                        placeholder=\"Vyberte datum...\"\n                      />\n                      {validationErrors.dt_zverejneni && (\n                        <ErrorText style={{ marginTop: '0.5rem' }}>{validationErrors.dt_zverejneni}</ErrorText>\n                      )}\n                    </div>\n\n                    {/* 3. IDENTIFIKTOR */}\n                    <div>\n                      <Label required={formData.ma_byt_zverejnena}>Identifiktor</Label>\n                      <InputWithIcon hasIcon>\n                        <FontAwesomeIcon icon={faHashtag} />\n                        <Input\n                          type=\"text\"\n                          name=\"registr_iddt\"\n                          value={formData.registr_iddt || ''}\n                          onChange={(e) => {\n                            handleInputChange('registr_iddt', e.target.value);\n                            if (e.target.value && !formData.zverejnil_id) {\n                              const user_id = localStorage.getItem('user_id');\n                              if (user_id) {\n                                handleInputChange('zverejnil_id', parseInt(user_id, 10));\n                              }\n                            }\n                          }}\n                          disabled={!formData.ma_byt_zverejnena || isRegistrVyplneniLocked}\n                          hasError={!!validationErrors.registr_iddt}\n                          hasIcon\n                          placeholder=\"Zadejte identifiktor...\"\n                        />\n                      </InputWithIcon>\n                      {validationErrors.registr_iddt && (\n                        <ErrorText style={{ marginTop: '0.5rem' }}>{validationErrors.registr_iddt}</ErrorText>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* LUT ALERT - kdy NEN zakrtnuto */}\n                  {!formData.ma_byt_zverejnena && (\n                    <div style={{\n                      padding: '0.875rem 1rem',\n                      backgroundColor: '#fef3c7',\n                      border: '1px solid #f59e0b',\n                      borderRadius: '6px',\n                      fontSize: '0.875rem',\n                      color: '#92400e',\n                      marginTop: '1rem',\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '0.5rem'\n                    }}>\n                      <FontAwesomeIcon icon={faInfoCircle} style={{ fontSize: '1rem' }} />\n                      <div>\n                        <strong>Objednvka nebude zveejnna v registru smluv.</strong>\n                      </div>\n                    </div>\n                  )}\n\n                  {/*  ZELEN BOX - Objednvka byla zveejnna (pouze kdy UVEREJNENA) */}\n                  {hasWorkflowState(formData.stav_workflow_kod, 'UVEREJNENA') && (\n                    <div style={{\n                      marginTop: '1.5rem',\n                      padding: '1rem',\n                      backgroundColor: '#dcfce7',\n                      border: '1px solid #16a34a',\n                      borderRadius: '6px',\n                      fontSize: '0.875rem',\n                      color: '#166534'\n                    }}>\n                      <div style={{ fontWeight: '600', marginBottom: '0.25rem' }}>\n                         Objednvka byla zveejnna v registru smluv\n                      </div>\n                      <div>\n                        <strong>Datum zveejnn:</strong> {formatDateOnly(formData.dt_zverejneni)}  <strong>Zveejnil:</strong> {getUserNameById(formData.zverejnil_id)}\n                        {formData.registr_iddt && (\n                          <>\n                            {'  '}\n                            <strong>ID registru:</strong> {formData.registr_iddt}\n                          </>\n                        )}\n                      </div>\n                    </div>\n                  )}\n                </SectionContent>\n              </FormSection>\n                );\n              })()}\n              {/* KONEC: Sekce Vyplnn registru smluv (FZE 5 - voliteln) */}\n\n              {/*  SEKCE: FAKTURACE / DOKLADY - ZOBRAZ SE VE FZI 6+ (FAKTURACE a ve) */}\n              {/* Podmnky zobrazen:\n                  1. currentPhase >= 6 (FZE 6 a ve - 6, 7, 8, 9)\n                  2.  Zobrazuje se i ve vych fzch, ale je zamen (lockLogic v workflowManager)\n                  3.  SKRT kdy platba = 'pokladna' (msto toho se zobraz Dodaten dokumenty)\n                  4.  Pokud platba = 'faktura'  \"Fakturace\" s plnm blokem faktur\n              */}\n              {(() => {\n                //  Urit typ platby: pokladna nebo faktura\n                // Kontroluje platbu z financovn objednvky A z potvrzen dodavatele\n                const isPlatbaPokladnaObj = formData.financovani?.platba === 'pokladna';\n                const isPlatbaPokladnaDodavatel = formData.dodavatel_zpusob_potvrzeni?.platba === 'pokladna';\n                const isPokladna = isPlatbaPokladnaObj || isPlatbaPokladnaDodavatel;\n\n                //  SKRT sekci Fakturace kdy je pokladna\n                //  PRVA: \n                // - Uivatel S prvem INVOICE_MANAGE vid sekci od FZE 6 (mohou pidvat faktury)\n                // - Uivatel BEZ prva vid sekci kdy:\n                //   a) jsou ve FZI 7+ (aktivn fze po fakturaci)\n                //   b) existuj faktury (sekce je ji vyplnn)\n                const hasFaktury = formData.faktury && formData.faktury.length > 0;\n                const shouldShow = !isPokladna && (\n                  canManageInvoices \n                    ? currentPhase >= 6  // S prvem: vid od FZE 6\n                    : (currentPhase >= 7 || hasFaktury)  // Bez prva: vid od FZE 7 nebo kdy jsou faktury\n                );\n\n                // Pokud nen uren typ platby, zobrazit jako fakturu (default)\n                const sectionTitle = 'Fakturace k objednvce';\n                const sectionDescription = `(poet: ${formData.faktury?.length || 0})`;\n\n                return shouldShow ? (\n                <FormSection data-section=\"fakturace\">\n                  <SectionHeader\n                    sectionTheme=\"section-invoice\"\n                    isActive={true}\n                    style={{\n                      background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n                      borderColor: '#2563eb'\n                    }}\n                  >\n                    <SectionTitle sectionTheme=\"section-invoice\" style={{ color: '#fff' }}>\n                      <SectionIcon sectionTheme=\"section-invoice\" style={{ color: '#fff' }}>\n                        <FontAwesomeIcon icon={faCreditCard} />\n                      </SectionIcon>\n                      {sectionTitle}\n                      <span style={{\n                        fontSize: '0.75rem',\n                        marginLeft: '0.5rem',\n                        fontWeight: '400',\n                        opacity: 0.9\n                      }}>\n                        {sectionDescription}\n                      </span>\n                      {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) - odemknout lze pouze z hlaviky */}\n                      {isFakturaceLockedPhase7 && !shouldLockAllSections && (\n                        <LockWarning title=\"Sekce je zamena. Odemknout me administrtor nebo uivatel s prvem ORDER_MANAGE.\">\n                           Sekce zamena\n                        </LockWarning>\n                      )}\n                    </SectionTitle>\n\n                    <SectionControls>\n                      {/*  Nezobrazovat tlatko odemknut kdy je globln lock (shouldLockAllSections) */}\n                      {isFakturaceLockedPhase7 && !shouldLockAllSections && canManageInvoices && (\n                        <UnlockButton\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            setShowUnlockFakturaceConfirm(true);\n                          }}\n                          title=\"Odemknout sekci Fakturace\"\n                        >\n                          <Unlock />\n                        </UnlockButton>\n                      )}\n\n                      <CollapseIcon\n                        collapsed={sectionStates.fakturace}\n                        onClick={() => toggleSection('fakturace')}\n                        style={{ color: '#fff', cursor: 'pointer' }}\n                      >\n                        <FontAwesomeIcon icon={faChevronUp} />\n                      </CollapseIcon>\n                    </SectionControls>\n                  </SectionHeader>\n\n                  <SectionContent collapsed={sectionStates.fakturace}>\n                    <div>\n                      {/*  POKLADNA: Zobrazit jen dropzone pro plohy (paragony) */}\n                      {isPokladna ? (\n                        <div style={{ padding: '1.5rem' }}>\n                          {(() => {\n                            //  ZAJISTIT: Vdy alespo jedna \"faktura\" (pokladn doklad) ve fzi 7+\n                            if ((!formData.faktury || formData.faktury.length === 0) && !fakturyLoading) {\n                              const dnesniDatum = formatDateForPicker(new Date());\n                              const pokladniDoklad = {\n                                id: `temp-pokladna-${Date.now()}`,\n                                objednavka_id: formData.id,\n                                fa_datum_doruceni: dnesniDatum,\n                                fa_dorucena: 1,\n                                fa_castka: null, // Nepovinn pro pokladnu\n                                fa_cislo_vema: '', // Nepovinn pro pokladnu\n                                fa_strediska_kod: formData.strediska_kod || [],\n                                fa_splatnost: null, // Nepovinn pro pokladnu\n                                fa_poznamka: '',\n                                vytvoril_uzivatel_id: user_id,\n                                vytvoril_jmeno: getUserNameById(user_id),\n                                dt_vytvoreni: new Date().toISOString(),\n                                dt_aktualizace: null,\n                                aktivni: 1,\n                                _isNew: true,\n                               _isPokladna: true, //  Pznak pro pokladn doklad\n                                attachments: []\n                              };\n\n                              setTimeout(() => {\n                                updateFaktury([pokladniDoklad]);\n                              }, 0);\n                            }\n                            return null;\n                          })()}\n\n                          <div style={{\n                            background: '#f8fafc',\n                            border: '2px solid #e2e8f0',\n                            borderRadius: '8px',\n                            padding: '2rem'\n                          }}>\n                            <div style={{\n                              fontSize: '2.5rem',\n                              marginBottom: '1rem',\n                              textAlign: 'center',\n                              color: '#64748b'\n                            }}>\n                              \n                            </div>\n                            <div style={{\n                              fontSize: '1.125rem',\n                              fontWeight: '500',\n                              color: '#334155',\n                              marginBottom: '0.5rem',\n                              textAlign: 'center'\n                            }}>\n                              Plohy doklad z pokladny\n                            </div>\n                            <div style={{\n                              fontSize: '0.875rem',\n                              color: '#64748b',\n                              marginBottom: '1.5rem',\n                              textAlign: 'center'\n                            }}>\n                              Nahrajte paragony, pokladn doklady a dal dokumenty k platb\n                            </div>\n\n                            {/* DROPZONE PRO PLOHY POKLADNY - pouv stejnou logiku jako faktury */}\n                            {formData.faktury && formData.faktury.length > 0 && formData.faktury[0] && (\n                              <>\n                                <InvoiceAttachmentsCompact\n                                  key={`pokladna-attachments-${formData.faktury[0].id}-${formData.id}`}\n                                  fakturaId={formData.faktury[0].id}\n                                  objednavkaId={formData.id}\n                                  fakturaTypyPrilohOptions={fakturaTypyPrilohOptions}\n                                  readOnly={shouldLockFaktury}\n                                  onISDOCParsed={handleISDOCParsed}\n                                  formData={formData}\n                                  faktura={formData.faktury[0]}\n                                  validateInvoiceForAttachments={validateInvoiceForAttachments}\n                                  isPokladna={true}\n                                  attachments={formData.faktury[0].attachments || []}\n                                  onAttachmentsChange={(newAttachments) => {\n                                    handleInvoiceAttachmentsChange(formData.faktury[0].id, newAttachments);\n                                  }}\n                                  onAttachmentUploaded={(uploadedAttachment) => {\n                                    handleInvoiceAttachmentUploaded(formData.faktury[0].id, uploadedAttachment);\n                                  }}\n                                  onCreateInvoiceInDB={handleCreateInvoiceInDB}\n                                />\n\n                                {/* POLE POZNMKA */}\n                                <FormRow style={{ marginTop: '1.5rem' }}>\n                                  <FormGroup style={{ gridColumn: '1 / -1' }}>\n                                    <Label>\n                                      Poznmka k platb\n                                      <span style={{ fontSize: '0.75rem', color: '#64748b', fontWeight: 'normal', marginLeft: '0.5rem' }}>\n                                        (Voliteln)\n                                      </span>\n                                    </Label>\n                                    <TextArea\n                                      value={formData.faktury[0].fa_poznamka || ''}\n                                      onChange={(e) => {\n                                        const updatedFaktury = formData.faktury.map((f, idx) =>\n                                          idx === 0\n                                            ? { ...f, fa_poznamka: e.target.value }\n                                            : f\n                                        );\n                                        updateFaktury(updatedFaktury);\n                                      }}\n                                      disabled={shouldLockFaktury}\n                                      placeholder=\"Nap.: Platba za materil, paragony ze dne 1.11.2025, apod.\"\n                                      rows={3}\n                                    />\n                                  </FormGroup>\n                                </FormRow>\n                              </>\n                            )}\n\n                            {/* Info poznmka */}\n                            <div style={{\n                              marginTop: '1.5rem',\n                              padding: '1rem',\n                              background: '#fef3c7',\n                              border: '1px solid #fbbf24',\n                              borderRadius: '6px',\n                              fontSize: '0.875rem',\n                              color: '#92400e',\n                              textAlign: 'left'\n                            }}>\n                              <strong> Poznmka:</strong> Pi platb pokladnou nen nutn vyplovat sla faktur ani stky.\n                              Sta nahrt paragony nebo pokladn doklady jako plohy a ppadn doplnit poznmku.\n                            </div>\n                          </div>\n                        </div>\n                      ) : (\n                        /* FAKTURA: Pln blok s fakturami */\n                        <>\n                      {(() => {\n                        //  ZAJISTIT: Vdy alespo jedna faktura ve fzi 7+\n                        // Pokud pole je przdn, okamit ho napl\n                        if ((!formData.faktury || formData.faktury.length === 0) && !fakturyLoading) {\n                          const dnesniDatum = formatDateForPicker(new Date());\n                          const novaFaktura = {\n                            id: `temp-${Date.now()}`,\n                            objednavka_id: formData.id,\n                            fa_datum_doruceni: dnesniDatum,\n                            fa_dorucena: 1,\n                            fa_castka: '',\n                            fa_cislo_vema: '',\n                            fa_strediska_kod: formData.strediska_kod || [],\n                            fa_splatnost: '',\n                            fa_poznamka: '',\n                            vytvoril_uzivatel_id: user_id,\n                            vytvoril_jmeno: getUserNameById(user_id),\n                            dt_vytvoreni: new Date().toISOString(),\n                            dt_aktualizace: null,\n                            aktivni: 1,\n                            _isNew: true,\n                            attachments: [] // Przdn pole pro plohy\n                          };\n\n                          // Okamit aktualizuj stav\n                          setTimeout(() => {\n                            updateFaktury([novaFaktura]);\n                          }, 0);\n                        }\n                        return null;\n                      })()}\n\n                      {fakturyLoading ? (\n                        <div style={{ textAlign: 'center', padding: '2rem', color: '#64748b' }}>\n                          Natn faktur...\n                        </div>\n                      ) : (\n                        <div style={{ marginTop: '1.5rem' }}>\n                          {/*  FALLBACK: Pokud i pes ve uveden je pole przdn, zobraz placeholder */}\n                          {(!formData.faktury || formData.faktury.length === 0) ? (\n                            <div style={{\n                              border: '2px dashed #cbd5e1',\n                              borderRadius: '8px',\n                              padding: '2rem',\n                              textAlign: 'center',\n                              color: '#64748b',\n                              background: '#f8fafc'\n                            }}>\n                              <div style={{ fontSize: '1.25rem', marginBottom: '0.5rem' }}></div>\n                              <div style={{ fontWeight: '500', marginBottom: '0.5rem' }}>Natm prvn fakturu...</div>\n                              <div style={{ fontSize: '0.875rem' }}>Prosm chvli strpen</div>\n                            </div>\n                          ) : (\n                            formData.faktury.map((faktura, index) => {\n                            const isEditing = editingFaktura?.id === faktura.id;\n                            const currentData = isEditing ? fakturaFormData : faktura;\n                            const isVecnaPotvrzena = faktura.vecna_spravnost_potvrzeno === 1;\n\n                            return (\n                            <div key={faktura.id} style={{\n                              border: '2px solid #3b82f6',\n                              borderRadius: '12px',\n                              padding: '0',\n                              marginBottom: '1.5rem',\n                              background: isEditing ? '#f0f9ff' : (isVecnaPotvrzena ? '#f0fdf4' : '#ffffff'),\n                              boxShadow: '0 2px 8px rgba(0, 0, 0, 0.08)',\n                              overflow: 'visible'\n                            }}>\n                              {/* Zhlav faktury - vrazn */}\n                              <div style={{\n                                background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n                                color: 'white',\n                                padding: '1rem 1.25rem',\n                                fontWeight: '700',\n                                fontSize: '1.1rem',\n                                display: 'flex',\n                                alignItems: 'center',\n                                justifyContent: 'space-between',\n                                gap: '1rem',\n                                borderBottom: '3px solid #1e40af',\n                                letterSpacing: '0.5px',\n                                textTransform: 'uppercase'\n                              }}>\n                                <div style={{display: 'flex', alignItems: 'center', gap: '0.75rem'}}>\n                                  <FontAwesomeIcon icon={faCreditCard} style={{ fontSize: '1.2rem' }} />\n                                  Faktura #{index + 1}\n                                  {index === 0 && <span style={{color: '#fef3c7', fontSize: '1.3rem'}}>*</span>}\n                                  {faktura.fa_cislo_vema && (\n                                    <span style={{ \n                                      fontWeight: '600',\n                                      fontSize: '0.9rem',\n                                      background: 'rgba(255, 255, 255, 0.2)',\n                                      padding: '0.25rem 0.75rem',\n                                      borderRadius: '6px',\n                                      letterSpacing: 'normal',\n                                      textTransform: 'none'\n                                    }}>\n                                      {faktura.fa_cislo_vema}\n                                    </span>\n                                  )}\n\n                                  {/*  Info tooltip s detaily faktury */}\n                                  <FakturaInfoIconWrapper>\n                                    <FakturaInfoIcon className=\"help-icon\">\n                                      <Info />\n                                    </FakturaInfoIcon>\n                                    <FakturaTooltipBubble className=\"tooltip-bubble\">\n                                      {/* DODAVATEL z ISDOC */}\n                                      {faktura._isdoc_dodavatel && (\n                                        <>\n                                          <FakturaTooltipRow>\n                                            <FakturaTooltipLabel>Vystavil:</FakturaTooltipLabel>\n                                            <FakturaTooltipValue style={{ display: 'flex', alignItems: 'center', gap: '6px', fontWeight: '600' }}>\n                                              {faktura._isdoc_dodavatel.nazev || '---'}\n                                              {faktura._isdoc_dodavatel.nazev && (\n                                                <Copy\n                                                  size={14}\n                                                  style={{ cursor: 'pointer', color: '#6b7280' }}\n                                                  onClick={() => {\n                                                    navigator.clipboard.writeText(faktura._isdoc_dodavatel.nazev);\n                                                    showToast && showToast('Nzev zkoprovn', { type: 'success' });\n                                                  }}\n                                                  title=\"Zkoprovat nzev\"\n                                                />\n                                              )}\n                                            </FakturaTooltipValue>\n                                          </FakturaTooltipRow>\n                                          <FakturaTooltipRow>\n                                            <FakturaTooltipLabel>IO:</FakturaTooltipLabel>\n                                            <FakturaTooltipValue style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\n                                              {faktura._isdoc_dodavatel.ico || '---'}\n                                              {faktura._isdoc_dodavatel.ico && (\n                                                <Copy\n                                                  size={14}\n                                                  style={{ cursor: 'pointer', color: '#6b7280' }}\n                                                  onClick={() => {\n                                                    navigator.clipboard.writeText(faktura._isdoc_dodavatel.ico);\n                                                    showToast && showToast('IO zkoprovno', { type: 'success' });\n                                                  }}\n                                                  title=\"Zkoprovat IO\"\n                                                />\n                                              )}\n                                            </FakturaTooltipValue>\n                                          </FakturaTooltipRow>\n                                          <div style={{ borderTop: '1px solid #e5e7eb', margin: '8px 0' }}></div>\n                                        </>\n                                      )}\n\n                                      {/*  EMAIL SMROVN z ISDOC */}\n                                      {faktura._isdoc_email && (\n                                        <>\n                                          <FakturaTooltipRow>\n                                            <FakturaTooltipLabel>Smrovno na:</FakturaTooltipLabel>\n                                            <FakturaTooltipValue style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\n                                              {faktura._isdoc_email}\n                                              <Copy\n                                                size={14}\n                                                style={{ cursor: 'pointer', color: '#6b7280' }}\n                                                onClick={() => {\n                                                  navigator.clipboard.writeText(faktura._isdoc_email);\n                                                  showToast && showToast('Email zkoprovn', { type: 'success' });\n                                                }}\n                                                title=\"Zkoprovat email\"\n                                              />\n                                            </FakturaTooltipValue>\n                                          </FakturaTooltipRow>\n                                          <div style={{ borderTop: '1px solid #e5e7eb', margin: '8px 0' }}></div>\n                                        </>\n                                      )}\n\n                                      <FakturaTooltipRow>\n                                        <FakturaTooltipLabel>slo faktury:</FakturaTooltipLabel>\n                                        <FakturaTooltipValue>{faktura.fa_cislo_vema || '---'}</FakturaTooltipValue>\n                                      </FakturaTooltipRow>\n                                      <FakturaTooltipRow>\n                                        <FakturaTooltipLabel>stka:</FakturaTooltipLabel>\n                                        <FakturaTooltipValue>\n                                          {faktura.fa_castka ? `${parseFloat(faktura.fa_castka).toLocaleString('cs-CZ')} K` : '---'}\n                                        </FakturaTooltipValue>\n                                      </FakturaTooltipRow>\n                                      <FakturaTooltipRow>\n                                        <FakturaTooltipLabel>Datum vystaven:</FakturaTooltipLabel>\n                                        <FakturaTooltipValue>\n                                          {faktura.fa_datum_vystaveni ? formatDateOnly(faktura.fa_datum_vystaveni) : '---'}\n                                        </FakturaTooltipValue>\n                                      </FakturaTooltipRow>\n                                      <FakturaTooltipRow>\n                                        <FakturaTooltipLabel>Datum splatnosti:</FakturaTooltipLabel>\n                                        <FakturaTooltipValue>\n                                          {(faktura.fa_datum_splatnosti || faktura.fa_splatnost)\n                                            ? formatDateOnly(faktura.fa_datum_splatnosti || faktura.fa_splatnost)\n                                            : '---'}\n                                        </FakturaTooltipValue>\n                                      </FakturaTooltipRow>\n                                      <FakturaTooltipRow>\n                                        <FakturaTooltipLabel>Datum doruen:</FakturaTooltipLabel>\n                                        <FakturaTooltipValue>\n                                          {faktura.fa_datum_doruceni ? formatDateOnly(faktura.fa_datum_doruceni) : '---'}\n                                        </FakturaTooltipValue>\n                                      </FakturaTooltipRow>\n                                      <FakturaTooltipRow>\n                                        <FakturaTooltipLabel>Vcn sprvnost:</FakturaTooltipLabel>\n                                        <FakturaTooltipValue>\n                                          {faktura.vecna_spravnost_potvrzeno === 'ANO' && (\n                                            <span style={{ \n                                              display: 'inline-flex', \n                                              alignItems: 'center', \n                                              gap: '0.25rem',\n                                              background: '#d1fae5',\n                                              color: '#065f46',\n                                              padding: '2px 8px',\n                                              borderRadius: '4px',\n                                              fontSize: '0.75rem',\n                                              fontWeight: '600'\n                                            }}>\n                                              <FontAwesomeIcon icon={faCheckCircle} />\n                                              ANO\n                                            </span>\n                                          )}\n                                          {faktura.vecna_spravnost_potvrzeno === 'NE' && (\n                                            <span style={{ \n                                              display: 'inline-flex', \n                                              alignItems: 'center', \n                                              gap: '0.25rem',\n                                              background: '#fee2e2',\n                                              color: '#991b1b',\n                                              padding: '2px 8px',\n                                              borderRadius: '4px',\n                                              fontSize: '0.75rem',\n                                              fontWeight: '600'\n                                            }}>\n                                              <FontAwesomeIcon icon={faTimesCircle} />\n                                              NE\n                                            </span>\n                                          )}\n                                          {!faktura.vecna_spravnost_potvrzeno && (\n                                            <span style={{ color: '#9ca3af', fontSize: '0.875rem' }}>\n                                              Neoveno\n                                            </span>\n                                          )}\n                                        </FakturaTooltipValue>\n                                      </FakturaTooltipRow>\n                                      {faktura.vecna_spravnost_umisteni_majetku && (\n                                        <FakturaTooltipRow>\n                                          <FakturaTooltipLabel>Umstn majetku:</FakturaTooltipLabel>\n                                          <FakturaTooltipValue>\n                                            {faktura.vecna_spravnost_umisteni_majetku}\n                                          </FakturaTooltipValue>\n                                        </FakturaTooltipRow>\n                                      )}\n                                      {faktura.vecna_spravnost_poznamka && (\n                                        <FakturaTooltipRow>\n                                          <FakturaTooltipLabel>Poznmka VS:</FakturaTooltipLabel>\n                                          <FakturaTooltipValue>\n                                            {faktura.vecna_spravnost_poznamka}\n                                          </FakturaTooltipValue>\n                                        </FakturaTooltipRow>\n                                      )}\n                                      <FakturaTooltipRow>\n                                        <FakturaTooltipLabel>Stediska:</FakturaTooltipLabel>\n                                        <FakturaTooltipValue title={\n                                          (() => {\n                                            const strediska = faktura.fa_strediska_kod;\n                                            if (!strediska) return '---';\n                                            if (Array.isArray(strediska)) {\n                                              return strediska\n                                                .map(s => typeof s === 'object' ? (s.label || s.nazev || s.value || s.kod || s) : s)\n                                                .filter(Boolean)\n                                                .join(', ') || '---';\n                                            }\n                                            if (typeof strediska === 'string') {\n                                              return strediska || '---';\n                                            }\n                                            return '---';\n                                          })()\n                                        }>\n                                          {(() => {\n                                            const strediska = faktura.fa_strediska_kod;\n                                            if (!strediska) return '---';\n                                            if (Array.isArray(strediska)) {\n                                              return strediska\n                                                .map(s => typeof s === 'object' ? (s.label || s.nazev || s.value || s.kod || s) : s)\n                                                .filter(Boolean)\n                                                .join(', ') || '---';\n                                            }\n                                            if (typeof strediska === 'string') {\n                                              return strediska || '---';\n                                            }\n                                            return '---';\n                                          })()}\n                                        </FakturaTooltipValue>\n                                      </FakturaTooltipRow>\n                                    </FakturaTooltipBubble>\n                                  </FakturaInfoIconWrapper>\n                                </div>\n                                <div style={{display: 'flex', gap: '0.5rem'}}>\n                                  {/* Tlatko smazat fakturu */}\n                                  <button\n                                    type=\"button\"\n                                    disabled={shouldLockFaktury}\n                                    onClick={() => {\n                                      if (faktura._isNew) {\n                                        // Pokud je nov (neuloen), jen odebrat ze seznamu\n                                        const currentFaktury = Array.isArray(formData.faktury) ? formData.faktury : [];\n                                        updateFaktury(currentFaktury.filter(f => f.id !== faktura.id));\n                                        if (isEditing) {\n                                          setEditingFaktura(null);\n                                          const predpokladanaCastka = totalPrice.toString();\n                                          const dnesniDatum = formatDateForPicker(new Date());\n\n                                          setFakturaFormData({\n                                            fa_datum_doruceni: dnesniDatum,\n    fa_dorucena: 1, //  Boolean flag\n                                            fa_castka: predpokladanaCastka,\n                                            fa_cislo_vema: '',\n                                            fa_strediska_kod: formData.strediska_kod || [],\n                                            fa_poznamka: '',\n                                            fa_splatnost: ''\n                                          });\n                                        }\n                                      } else {\n                                        // Pokud je uloen, smazat pes API\n                                        handleDeleteFaktura(faktura.id);\n                                      }\n                                    }}\n                                    title=\"Smazat fakturu\"\n                                    style={{\n                                      background: shouldLockFaktury ? 'rgba(255,255,255,0.3)' : 'rgba(220, 38, 38, 0.9)',\n                                      color: 'white',\n                                      border: '1px solid rgba(255,255,255,0.5)',\n                                      borderRadius: '6px',\n                                      padding: '0.4rem',\n                                      cursor: shouldLockFaktury ? 'not-allowed' : 'pointer',\n                                      display: 'flex',\n                                      alignItems: 'center',\n                                      justifyContent: 'center',\n                                      width: '32px',\n                                      height: '32px',\n                                      opacity: shouldLockFaktury ? 0.6 : 1,\n                                      transition: 'all 0.2s ease'\n                                    }}\n                                  >\n                                    <Trash size={16} />\n                                  </button>\n                                </div>\n                              </div>\n\n                              {/* Content wrapper pro fakturu */}\n                              <div style={{ padding: '1.25rem' }}>\n\n                              {/* INLINE EDITOVATELN POLE - 3 sloupce: datum fixn, zbytek proporcionln */}\n                              <FormRow style={{gridTemplateColumns: '280px 1fr 1fr'}}>\n                                <FormGroup>\n                                  <Label required>Datum doruen</Label>\n                                  <DatePicker\n                                    fieldName={`fa_${index + 1}_datum_doruceni`}\n                                    value={faktura.fa_datum_doruceni ?? (faktura._isNew ? formatDateForPicker(new Date()) : '')}\n                                    hasError={!!validationErrors[`faktura_${index + 1}_datum_doruceni`]}\n                                    disabled={shouldLockFaktury}\n                                    onChange={(value) => {\n                                      const updatedFaktury = formData.faktury.map(f =>\n                                        f.id === faktura.id\n                                          ? { \n                                              ...f, \n                                              fa_datum_doruceni: value, \n                                              fa_dorucena: value ? 1 : 0,\n                                              _isNew: false //  Odstranit _isNew flag pi jakkoliv zmn\n                                            }\n                                          : f\n                                      );\n                                      updateFaktury(updatedFaktury);\n                                    }}\n                                    placeholder=\"Vyberte datum doruen\"\n                                  />\n                                </FormGroup>\n\n                                <FormGroup>\n                                  <Label required>Variabiln symbol</Label>\n                                  <InputWithIcon hasIcon>\n                                    <FontAwesomeIcon icon={faHashtag} />\n                                    <Input\n                                      type=\"text\"\n                                      value={faktura.fa_cislo_vema || ''}\n                                      hasError={!!validationErrors[`faktura_${index + 1}_cislo`]}\n                                      disabled={shouldLockFaktury}\n                                      onChange={(e) => {\n                                        const updatedFaktury = formData.faktury.map(f =>\n                                          f.id === faktura.id\n                                            ? { ...f, fa_cislo_vema: e.target.value, _isNew: false }\n                                            : f\n                                        );\n                                        updateFaktury(updatedFaktury);\n                                      }}\n                                      required\n                                      placeholder=\"12345678\"\n                                      hasIcon\n                                    />\n                                  </InputWithIcon>\n                                </FormGroup>\n\n                                <FormGroup>\n                                  <Label required>stka v. DPH</Label>\n                                  <CurrencyInput\n                                    fieldName=\"fa_castka\"\n                                    value={faktura.fa_castka ?? ''}\n                                    hasError={!!validationErrors[`faktura_${index + 1}_castka`]}\n                                    disabled={shouldLockFaktury}\n                                    onChange={(field, value) => {\n                                      const updatedFaktury = formData.faktury.map(f =>\n                                        f.id === faktura.id\n                                          ? { ...f, fa_castka: value, _isNew: false }\n                                          : f\n                                      );\n                                      updateFaktury(updatedFaktury);\n                                    }}\n                                    placeholder=\"25000.50\"\n                                  />\n                                </FormGroup>\n                              </FormRow>\n\n                              <FormRow style={{gridTemplateColumns: '280px 1fr'}}>\n                                <FormGroup>\n                                  <Label required>Datum splatnosti</Label>\n                                  <DatePicker\n                                    fieldName={`fa_${index + 1}_splatnost`}\n                                    value={(() => {\n                                      //  Po editaci (_isNew: false) ignoruj fa_datum_splatnosti fallback\n                                      if (faktura._isNew === false) {\n                                        return faktura.fa_splatnost ?? '';\n                                      }\n                                      // Nov faktura - zkus fa_splatnost, pak fa_datum_splatnosti (z DB), pak przdn\n                                      return faktura.fa_splatnost ?? (faktura.fa_datum_splatnosti ? faktura.fa_datum_splatnosti.split(' ')[0] : '');\n                                    })()}\n                                    hasError={!!validationErrors[`faktura_${index + 1}_splatnost`]}\n                                    disabled={shouldLockFaktury}\n                                    onChange={(value) => {\n                                      const updatedFaktury = formData.faktury.map(f =>\n                                        f.id === faktura.id\n                                          ? { ...f, fa_splatnost: value, _isNew: false }\n                                          : f\n                                      );\n                                      updateFaktury(updatedFaktury);\n                                    }}\n                                    placeholder=\"Vyberte datum splatnosti\"\n                                  />\n                                </FormGroup>\n\n                                <FormGroup data-custom-select style={{gridColumn: '2 / -1'}}>\n                                  <LabelWithClear>\n                                    <LabelText>Stediska</LabelText>\n                                    <ClearSelectButton\n                                      type=\"button\"\n                                      $visible={(() => {\n                                        const strediska = faktura.fa_strediska_kod || [];\n                                        return Array.isArray(strediska) && strediska.length > 0;\n                                      })()}\n                                      onClick={() => {\n                                        const updatedFaktury = formData.faktury.map(f =>\n                                          f.id === faktura.id ? { ...f, fa_strediska_kod: [], _isNew: false } : f\n                                        );\n                                        updateFaktury(updatedFaktury);\n                                      }}\n                                      title=\"Vymazat vbr\"\n                                    >\n                                      <X size={12} />\n                                    </ClearSelectButton>\n                                  </LabelWithClear>\n                                  <StableCustomSelect\n                                    value={(() => {\n                                      const rawValue = faktura.fa_strediska_kod || formData.strediska_kod || [];\n                                      if (typeof rawValue === 'string' && rawValue.trim()) {\n                                        return rawValue.split(',').map(s => s.trim()).filter(Boolean);\n                                      }\n                                      return Array.isArray(rawValue) ? rawValue : [];\n                                    })()}\n                                    disabled={shouldLockFaktury}\n                                    onChange={(selectedValues) => {\n                                      const strediskaKody = Array.isArray(selectedValues)\n                                        ? selectedValues.map(item => {\n                                            if (typeof item === 'string') return item;\n                                            return item.value || item.kod_stavu || item.id || item;\n                                          })\n                                        : [];\n\n                                      const updatedFaktury = formData.faktury.map(f =>\n                                        f.id === faktura.id\n                                          ? { ...f, fa_strediska_kod: strediskaKody, _isNew: false }\n                                          : f\n                                      );\n                                      updateFaktury(updatedFaktury);\n                                    }}\n                                    options={strediskaOptions}\n                                    placeholder=\"Vyberte stediska (auto-vyplnno z objednvky)\"\n                                    field=\"strediska\"\n                                    required={false}\n                                    multiple={true}\n                                    icon={<Building />}\n                                    getOptionLabel={getOptionLabel}\n                                    getOptionValue={(option, field) => option.value || option.id || option}\n                                  />\n                                </FormGroup>\n                              </FormRow>\n\n                              <FormRow>\n                                <FormGroup style={{gridColumn: '1 / -1'}}>\n                                  <Label>Poznmka</Label>\n                                  <TextArea\n                                    value={faktura.fa_poznamka || ''}\n                                    disabled={shouldLockFaktury}\n                                    onChange={(e) => {\n                                      const updatedFaktury = formData.faktury.map(f =>\n                                        f.id === faktura.id\n                                          ? { ...f, fa_poznamka: e.target.value, _isNew: false }\n                                          : f\n                                      );\n                                      updateFaktury(updatedFaktury);\n                                    }}\n                                    placeholder=\"Voliteln poznmka...\"\n                                    rows={2}\n                                  />\n                                </FormGroup>\n                              </FormRow>\n\n                              {/*  NOV: Per-invoice VCN SPRVNOST (FZE 7/8) */}\n                              {currentPhase >= 7 && (\n                                <div style={{\n                                  marginTop: '1.5rem',\n                                  padding: '1rem',\n                                  background: isVecnaPotvrzena \n                                    ? 'linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)' \n                                    : 'linear-gradient(135deg, #fefefe 0%, #f3f4f6 100%)',\n                                  border: isVecnaPotvrzena ? '2px solid #22c55e' : '2px solid #d1d5db',\n                                  borderRadius: '8px'\n                                }}>\n                                  <div style={{ \n                                    fontWeight: '700', \n                                    fontSize: '0.95rem', \n                                    color: '#166534', \n                                    marginBottom: '1rem',\n                                    display: 'flex',\n                                    alignItems: 'center',\n                                    gap: '0.5rem'\n                                  }}>\n                                    <FontAwesomeIcon icon={faCheckCircle} />\n                                    Vcn sprvnost faktury #{index + 1}\n                                  </div>\n\n                                  {/* Porovnn MAX CENA vs FAKTURA */}\n                                  {(() => {\n                                    const maxCena = parseFloat(formData.max_cena_s_dph) || 0;\n                                    const fakturaCastka = parseFloat(faktura.fa_castka) || 0;\n                                    const rozdil = fakturaCastka - maxCena;\n                                    const prekroceno = rozdil > 0;\n\n                                    return (\n                                      <div style={{\n                                        background: prekroceno ? '#fef2f2' : '#f0fdf4',\n                                        border: `1px solid ${prekroceno ? '#ef4444' : '#22c55e'}`,\n                                        borderRadius: '6px',\n                                        padding: '0.75rem',\n                                        marginBottom: '1rem',\n                                        fontSize: '0.85rem'\n                                      }}>\n                                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem' }}>\n                                          <span style={{ color: '#6b7280' }}>Max. cena objednvky s DPH:</span>\n                                          <span style={{ fontWeight: '600', color: '#374151' }}>\n                                            {maxCena.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K\n                                          </span>\n                                        </div>\n                                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem' }}>\n                                          <span style={{ color: '#6b7280' }}>stka faktury s DPH:</span>\n                                          <span style={{ fontWeight: '600', color: '#374151' }}>\n                                            {fakturaCastka.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K\n                                          </span>\n                                        </div>\n                                        <div style={{ \n                                          display: 'flex', \n                                          justifyContent: 'space-between', \n                                          paddingTop: '0.5rem', \n                                          borderTop: '1px solid #e5e7eb',\n                                          fontWeight: '700'\n                                        }}>\n                                          <span style={{ color: prekroceno ? '#dc2626' : '#16a34a' }}>\n                                            {prekroceno ? ' Pekroen:' : ' Rozdl:'}\n                                          </span>\n                                          <span style={{ color: prekroceno ? '#dc2626' : '#16a34a' }}>\n                                            {prekroceno ? '+' : ''}{rozdil.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K\n                                          </span>\n                                        </div>\n                                      </div>\n                                    );\n                                  })()}\n\n                                  <FormRow>\n                                    <FormGroup style={{gridColumn: '1 / -1'}}>\n                                      <Label>Umstn majetku</Label>\n                                      <Input\n                                        value={faktura.vecna_spravnost_umisteni_majetku || ''}\n                                        disabled={shouldLockVecnaSpravnost}\n                                        onChange={(e) => {\n                                          const updatedFaktury = formData.faktury.map(f =>\n                                            f.id === faktura.id\n                                              ? { ...f, vecna_spravnost_umisteni_majetku: e.target.value, _isNew: false }\n                                              : f\n                                          );\n                                          updateFaktury(updatedFaktury);\n                                        }}\n                                        placeholder=\"Nap. Kladno, budova K2, mstnost 203\"\n                                      />\n                                    </FormGroup>\n\n                                    <FormGroup style={{gridColumn: '1 / -1'}}>\n                                      {(() => {\n                                        const maxCena = parseFloat(formData.max_cena_s_dph) || 0;\n                                        const fakturaCastka = parseFloat(faktura.fa_castka) || 0;\n                                        const prekroceno = fakturaCastka > maxCena;\n                                        return <Label required={prekroceno} style={prekroceno ? {color: '#dc2626', fontWeight: '700'} : {}}>Poznmka k vcn sprvnosti{prekroceno ? ' (POVINN - faktura pekrauje MAX cenu)' : ''}</Label>;\n                                      })()}\n                                      <TextArea\n                                        value={faktura.vecna_spravnost_poznamka || ''}\n                                        disabled={shouldLockVecnaSpravnost}\n                                        hasError={!!validationErrors[`faktura_${index + 1}_poznamka_vs`]}\n                                        onChange={(e) => {\n                                          const updatedFaktury = formData.faktury.map(f =>\n                                            f.id === faktura.id\n                                              ? { ...f, vecna_spravnost_poznamka: e.target.value, _isNew: false }\n                                              : f\n                                          );\n                                          updateFaktury(updatedFaktury);\n                                        }}\n                                        placeholder=\"Voliteln poznmka k vcn sprvnosti...\"\n                                        rows={2}\n                                      />\n                                      {validationErrors[`faktura_${index + 1}_poznamka_vs`] && (\n                                        <ErrorText>{validationErrors[`faktura_${index + 1}_poznamka_vs`]}</ErrorText>\n                                      )}\n                                    </FormGroup>\n                                  </FormRow>\n\n                                  {/* Checkbox potvrzen vcn sprvnosti */}\n                                  {(() => {\n                                    const hasError = !!validationErrors[`faktura_${index + 1}_vecna_spravnost`];\n                                    return (\n                                      <>\n                                        <div style={{\n                                          marginTop: '1rem',\n                                          padding: '0.75rem',\n                                          background: hasError ? '#fef2f2' : '#ffffff',\n                                          border: hasError ? '2px solid #ef4444' : '1px solid #d1d5db',\n                                          borderRadius: '6px'\n                                        }}>\n                                          <label style={{\n                                            display: 'flex',\n                                            alignItems: 'center',\n                                            gap: '0.75rem',\n                                            cursor: shouldLockVecnaSpravnost ? 'not-allowed' : 'pointer',\n                                            fontSize: '0.9rem',\n                                            fontWeight: shouldLockVecnaSpravnost ? '400' : '600',\n                                            color: hasError ? '#dc2626' : (shouldLockVecnaSpravnost ? '#9ca3af' : '#374151')\n                                          }}>\n                                            <input\n                                              type=\"checkbox\"\n                                              checked={faktura.vecna_spravnost_potvrzeno === 1}\n                                              disabled={shouldLockVecnaSpravnost}\n                                        onChange={(e) => {\n                                          const newValue = e.target.checked ? 1 : 0;\n\n                                          let updatedFields = { vecna_spravnost_potvrzeno: newValue, _isNew: false };\n                                          if (newValue === 1 && user_id && !faktura.potvrdil_vecnou_spravnost_id) {\n                                            const now = new Date();\n                                            const year = now.getFullYear();\n                                            const month = String(now.getMonth() + 1).padStart(2, '0');\n                                            const day = String(now.getDate()).padStart(2, '0');\n                                            const hours = String(now.getHours()).padStart(2, '0');\n                                            const minutes = String(now.getMinutes()).padStart(2, '0');\n                                            const seconds = String(now.getSeconds()).padStart(2, '0');\n                                            const localTimestamp = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n                                            \n                                            updatedFields.potvrdil_vecnou_spravnost_id = user_id;\n                                            updatedFields.dt_potvrzeni_vecne_spravnosti = localTimestamp;\n                                            addDebugLog('info', 'VECNA-FAKTURA', 'metadata-set', `Faktura #${faktura.id}: Nastaveno ID=${user_id}, dt=${localTimestamp}`);\n                                          }\n\n                                          const updatedFaktury = formData.faktury.map(f =>\n                                            f.id === faktura.id\n                                              ? { ...f, ...updatedFields }\n                                              : f\n                                          );\n                                          updateFaktury(updatedFaktury);\n                                        }}\n                                        style={{\n                                          width: '18px',\n                                          height: '18px',\n                                          cursor: shouldLockVecnaSpravnost ? 'not-allowed' : 'pointer',\n                                          accentColor: shouldLockVecnaSpravnost ? '#9ca3af' : '#16a34a'\n                                        }}\n                                      />\n                                      <span style={{ flex: 1 }}>\n                                        Potvrzuji vcnou sprvnost faktury #{index + 1}\n                                      </span>\n                                      {(faktura.vecna_spravnost_potvrzeno === 1) && (\n                                        <span style={{\n                                          fontSize: '0.75rem',\n                                          color: '#16a34a',\n                                          background: '#dcfce7',\n                                          padding: '0.25rem 0.5rem',\n                                          borderRadius: '4px',\n                                          fontWeight: '600'\n                                        }}>\n                                           ZKONTROLOVNO\n                                        </span>\n                                      )}\n                                    </label>\n                                    \n                                    {/* Info dek - kdo a kdy potvrdil (POUZE ve fzi ZKONTROLOVANA 8+) */}\n                                    {(() => {\n                                      const isChecked = (isEditing ? (currentData.vecna_spravnost_potvrzeno === 1) : (faktura.vecna_spravnost_potvrzeno === 1));\n                                      const hasRealId = faktura.id && !String(faktura.id).startsWith('temp-');\n                                      const hasTimestamp = faktura.dt_potvrzeni_vecne_spravnosti;\n                                      const isZkontrolovanaPhase = currentPhase >= 8; // Fze ZKONTROLOVANA a ve\n                                      \n                                      if (!isChecked || !hasRealId || !hasTimestamp || !isZkontrolovanaPhase) return null;\n                                      \n                                      // Urit jmno potvrzujcho\n                                      const userName = faktura.potvrdil_vecnou_spravnost_jmeno \n                                        ? `${faktura.potvrdil_vecnou_spravnost_jmeno} ${faktura.potvrdil_vecnou_spravnost_prijmeni || ''}`.trim()\n                                        : (faktura.potvrdil_vecnou_spravnost_id ? getUserNameById(faktura.potvrdil_vecnou_spravnost_id) : null);\n                                      \n                                      return (\n                                        <div style={{\n                                          marginTop: '0.5rem',\n                                          padding: '0.5rem 0.75rem',\n                                          background: '#f0fdf4',\n                                          border: '1px solid #86efac',\n                                          borderRadius: '4px',\n                                          fontSize: '0.8rem',\n                                          color: '#15803d'\n                                        }}>\n                                          <strong>Potvrdil:</strong> {userName || 'Systm'}\n                                          {' '}<strong></strong>{' '}\n                                          <strong>Datum:</strong> {prettyDate(faktura.dt_potvrzeni_vecne_spravnosti)}\n                                        </div>\n                                      );\n                                    })()}\n                                  </div>\n                                  {hasError && (\n                                    <ErrorText style={{ marginTop: '0.5rem' }}>\n                                      {validationErrors[`faktura_${index + 1}_vecna_spravnost`]}\n                                    </ErrorText>\n                                  )}\n                                </>\n                                    );\n                                  })()}\n                                </div>\n                              )}\n\n                              {/*  PLOHY FAKTURY - Kompaktn komponenta s API validac */}\n                              <InvoiceAttachmentsCompact\n                                key={`invoice-attachments-${index}-${formData.id}`}\n                                fakturaId={faktura.id}\n                                objednavkaId={formData.id}\n                                fakturaTypyPrilohOptions={fakturaTypyPrilohOptions}\n                                readOnly={shouldLockFaktury}\n                                onISDOCParsed={handleISDOCParsed}\n                                formData={formData}\n                                faktura={faktura}\n                                validateInvoiceForAttachments={validateInvoiceForAttachments}\n                                attachments={faktura.attachments || []}\n                                onAttachmentsChange={(newAttachments) => {\n                                  handleInvoiceAttachmentsChange(faktura.id, newAttachments);\n                                }}\n                                onAttachmentUploaded={(uploadedAttachment) => {\n                                  //  Po uploadu plohy\n                                  handleInvoiceAttachmentUploaded(faktura.id, uploadedAttachment);\n                                }}\n                                onCreateInvoiceInDB={handleCreateInvoiceInDB}\n                              />\n\n                              {/* Faktury se ukldaj automaticky s objednvkou - tlatko \"Uloit fakturu\" odstranno */}\n\n                              {/* Info footer */}\n                              {!faktura._isNew && (\n                                <div style={{\n                                  borderTop: '1px solid #e5e7eb',\n                                  paddingTop: '0.5rem',\n                                  marginTop: '0.75rem',\n                                  fontSize: '0.75rem',\n                                  color: '#9ca3af',\n                                  display: 'flex',\n                                  justifyContent: 'space-between'\n                                }}>\n                                  <div>\n                                    <strong>Vytvoil:</strong> {faktura.vytvoril_jmeno || getUserNameById(faktura.vytvoril_uzivatel_id)}\n                                  </div>\n                                  <div>\n                                    <strong>Vytvoeno:</strong> {prettyDate(faktura.dt_vytvoreni)}\n                                  </div>\n                                </div>\n                              )}\n\n                              </div>\n                              {/* Konec content wrapper */}\n\n                            </div>\n                          )}))}\n\n                          {/*  TLATKO PIDAT DAL FAKTURU - pod seznamem faktur */}\n                          {!shouldLockFaktury && (\n                            <button\n                              type=\"button\"\n                              onClick={() => {\n                                const dnesniDatum = formatDateForPicker(new Date());\n                                const newFaktura = {\n                                  id: `temp-${Date.now()}`,\n                                  objednavka_id: formData.id,\n                                  fa_datum_doruceni: dnesniDatum,\n                                  fa_dorucena: 1,\n                                  fa_castka: '',\n                                  fa_cislo_vema: '',\n                                  fa_strediska_kod: Array.isArray(formData.strediska_kod) ? formData.strediska_kod : [],\n                                  fa_poznamka: '',\n                                  fa_splatnost: '',\n                                  vytvoril_uzivatel_id: user_id,\n                                  vytvoril_jmeno: getUserNameById(user_id),\n                                  dt_vytvoreni: new Date().toISOString(),\n                                  dt_aktualizace: null,\n                                  aktivni: 1,\n                                  _isNew: true,\n                                  vecna_spravnost_umisteni_majetku: '',\n                                  vecna_spravnost_poznamka: '',\n                                  vecna_spravnost_potvrzeno: 0\n                                };\n                                const currentFaktury = Array.isArray(formData.faktury) ? formData.faktury : [];\n                                updateFaktury([...currentFaktury, newFaktura]);\n                                setEditingFaktura(newFaktura);\n                                setFakturaFormData({\n                                  fa_datum_doruceni: dnesniDatum,\n                                  fa_dorucena: 1,\n                                  fa_castka: '',\n                                  fa_cislo_vema: '',\n                                  fa_strediska_kod: formData.strediska_kod || [],\n                                  fa_poznamka: '',\n                                  fa_splatnost: '',\n                                  vecna_spravnost_umisteni_majetku: '',\n                                  vecna_spravnost_poznamka: '',\n                                  vecna_spravnost_potvrzeno: 0\n                                });\n                              }}\n                              style={{\n                                width: '100%',\n                                marginTop: '1rem',\n                                padding: '1rem',\n                                background: 'transparent',\n                                color: '#3b82f6',\n                                border: '2px dashed #3b82f6',\n                                borderRadius: '8px',\n                                fontSize: '0.9rem',\n                                fontWeight: '600',\n                                cursor: 'pointer',\n                                display: 'flex',\n                                alignItems: 'center',\n                                justifyContent: 'center',\n                                gap: '0.5rem',\n                                transition: 'all 0.2s ease'\n                              }}\n                              onMouseEnter={(e) => {\n                                e.currentTarget.style.background = 'rgba(59, 130, 246, 0.05)';\n                                e.currentTarget.style.borderColor = '#2563eb';\n                              }}\n                              onMouseLeave={(e) => {\n                                e.currentTarget.style.background = 'transparent';\n                                e.currentTarget.style.borderColor = '#3b82f6';\n                              }}\n                            >\n                              <Plus size={18} />\n                              Pidat dal fakturu\n                            </button>\n                          )}\n                        </div>\n                      )}\n\n                      {/* INFORMAN BOX - Fakturace zpracovna - ZOBRAZIT kdy je pidna faktura */}\n                      {formData.faktury && formData.faktury.length > 0 && formData.fakturant_id && formData.dt_faktura_pridana && (\n                        <div style={{\n                          marginTop: '1.5rem',\n                          padding: '1rem',\n                          backgroundColor: '#dcfce7',\n                          border: '1px solid #16a34a',\n                          borderRadius: '6px',\n                          color: '#166534',\n                          fontSize: '0.875rem'\n                        }}>\n                          <div style={{ fontWeight: '600', marginBottom: '0.25rem' }}>\n                             Fakturace byla zpracovna\n                          </div>\n                          <div>\n                            <strong>Datum zpracovn:</strong> {prettyDate(formData.dt_faktura_pridana)}  <strong>Zpracoval:</strong> {getUserNameById(formData.fakturant_id)}\n                          </div>\n                        </div>\n                      )}\n                      </>\n                      )}\n                    </div>\n                  </SectionContent>\n                </FormSection>\n              ) : null;\n              })()}\n\n              {/*  INFO BOX PRO UIVATELE BEZ PRV INVOICE_MANAGE - ek se na doplnn faktur */}\n              {(() => {\n                const isPokladna = (() => {\n                  const selectedFinancovani = financovaniOptions.find(opt =>\n                    opt.kod === formData.zpusob_financovani ||\n                    opt.value === formData.zpusob_financovani\n                  );\n                  const nazev = selectedFinancovani?.nazev || '';\n                  return nazev.toLowerCase().includes('pokladna');\n                })();\n                const hasFaktury = formData.faktury && formData.faktury.length > 0;\n                const showInfoBlock = !isPokladna && currentPhase === 6 && !canManageInvoices && !hasFaktury;\n                return showInfoBlock && (\n                  <div style={{\n                    margin: '2rem 0',\n                    padding: '1rem 1.25rem',\n                    backgroundColor: '#fef3c7',\n                    border: '1px solid #f59e0b',\n                    borderRadius: '8px',\n                    color: '#92400e'\n                  }}>\n                    <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                       ek se na doplnn fakturace\n                    </div>\n                    <div style={{ fontSize: '0.875rem' }}>\n                      Objednvka ek na pidn faktur ekonomickm oddlenm. Po doplnn faktur budete moci pokraovat k <strong>vcn kontrole</strong>. Tuto akci me provst pouze uivatel s oprvnnm pro sprvu faktur.\n                    </div>\n                  </div>\n                );\n              })()}\n\n              {/* INFORMAN BLOK - AKTIVN FAKTURACE: Info o dalm kroku */}\n              {(isArchived || currentPhase === 6) && formData.faktury && formData.faktury.length > 0 && (\n                <div style={{\n                  margin: '2rem 0',\n                  padding: '1rem 1.25rem',\n                  backgroundColor: '#fefce8',\n                  border: '1px solid #eab308',\n                  borderRadius: '8px',\n                  color: '#854d0e'\n                }}>\n                  <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                     Pidn faktur k objednvce\n                  </div>\n                  <div style={{ fontSize: '0.875rem' }}>\n                    {formData.fakturant_id && formData.dt_faktura_pridana && (\n                      <div style={{ marginBottom: '0.5rem' }}>\n                        <strong>Pidal fakturu:</strong> {getUserNameById(formData.fakturant_id)}\n                        {'  '}\n                        <strong>Datum:</strong> {prettyDate(formData.dt_faktura_pridana)}\n                      </div>\n                    )}\n                    V tto sekci pidejte faktury k objednvce. Po pidn a uloen mete pokraovat k <strong>vcn kontrole</strong>.\n                  </div>\n                </div>\n              )}\n\n              {/*  SEKCE: DOKONEN OBJEDNVKY - FZE 10 */}\n              {/* ZOBRAZIT pouze pokud: */}\n              {/* 1. Uivatel je ADMIN nebo m prvo ORDER_MANAGE NEBO objednvka je ji DOKONCENA */}\n              {/* 2. Workflow obsahuje ZKONTROLOVANA nebo DOKONCENA (vcn sprvnost potvrzena) */}\n              {(canUnlockAnything || hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA')) && \n               (hasWorkflowState(formData.stav_workflow_kod, 'ZKONTROLOVANA') || hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA')) &&\n               (() => {\n                //  Logika zamen sekce dokonen - STEJN JAKO U VCN SPRVNOSTI\n                // ZAMENO pouze pokud:\n                // 1. Workflow obsahuje DOKONCENA (ne jen ZKONTROLOVANA!)\n                // 2. Checkbox JE ZAKRTNUT (potvrzeni_dokonceni_objednavky = 1)\n                // 3. JE ULOENO v DB (m formData.id)\n                // DLEIT: dokoncil_id a dt_dokonceni se nastavuj HNED pi zakrtnut,\n                // take nememe podle nich zjistit, jestli je uloeno v DB!\n                const isDokonceniSaved = !!(\n                  formData.id &&\n                  formData.potvrzeni_dokonceni_objednavky === 1 &&\n                  hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA')\n                );\n                //  Pout dokonceniState z workflowManager (u zahrnuje unlock logic)\n                const isDokonceniLockedLocal = !dokonceniState.enabled;\n\n                // Kho me odemknout? Pouze admin + ORDER_MANAGE\n                const canUnlockDokonceni = canUnlockAnything; // Pouze admin/ORDER_MANAGE\n\n                return (\n                <FormSection data-section=\"dokonceni\">\n                  <SectionHeader\n                    sectionTheme=\"section-dokonceni\"\n                    isActive={true}\n                    style={{\n                      background: 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)',\n                      borderColor: '#16a34a'\n                    }}\n                  >\n                    <SectionTitle sectionTheme=\"section-dokonceni\" style={{ color: '#fff', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                      <SectionIcon sectionTheme=\"section-dokonceni\" style={{ color: '#fff' }}>\n                        <FontAwesomeIcon icon={faCheckCircle} />\n                      </SectionIcon>\n                      Dokonen objednvky\n                    </SectionTitle>\n                    <SectionControls style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>\n                      <CollapseIcon\n                        collapsed={sectionStates.dokonceni}\n                        onClick={() => toggleSection('dokonceni')}\n                        style={{ color: '#fff', cursor: 'pointer' }}\n                      >\n                        <FontAwesomeIcon icon={faChevronUp} />\n                      </CollapseIcon>\n                    </SectionControls>\n                  </SectionHeader>\n\n                  <SectionContent collapsed={sectionStates.dokonceni}>\n                    <div style={{ padding: '1rem 0' }}>\n                      {/* Informace o dokonen */}\n                      <div style={{\n                        background: '#f0fdf4',\n                        border: '1px solid #22c55e',\n                        borderRadius: '8px',\n                        padding: '1rem',\n                        marginBottom: '1.5rem'\n                      }}>\n                        <div style={{ fontWeight: '600', color: '#166534', marginBottom: '0.75rem' }}>\n                           Finln krok - Dokonen objednvky\n                        </div>\n                        <div style={{ fontSize: '0.875rem', color: '#166534', lineHeight: '1.6' }}>\n                          Objednvka prola vemi fzemi:\n                          <ul style={{ marginTop: '0.5rem', marginLeft: '1.5rem', listStyle: 'none', paddingLeft: 0 }}>\n                            <li style={{ display: 'flex', alignItems: 'center', marginBottom: '0.4rem' }}>\n                               Schvlen ({formData.dt_schvaleni ? prettyDate(formData.dt_schvaleni) : ''}  {formData.schvalovatel_id ? getUserNameById(formData.schvalovatel_id) : ''})\n                            </li>\n                            <li style={{ display: 'flex', alignItems: 'center', marginBottom: '0.4rem' }}>\n                               Odesln dodavateli ({formData.dt_odeslani ? prettyDate(formData.dt_odeslani) : ''}  {formData.odesilatel_id ? getUserNameById(formData.odesilatel_id) : ''})\n                            </li>\n                            <li style={{ display: 'flex', alignItems: 'center', marginBottom: '0.4rem' }}>\n                               Potvrzen od dodavatele ({formData.dt_akceptace ? formatDateOnly(formData.dt_akceptace) : ''}  {formData.dodavatel_potvrdil_id ? getUserNameById(formData.dodavatel_potvrdil_id) : ''})\n                            </li>\n                            <li style={{ display: 'flex', alignItems: 'center', marginBottom: '0.4rem' }}>\n                               Registr smluv {formData.dt_zverejneni && formData.dt_zverejneni !== '0000-00-00' ? \n                                `(${formatDateOnly(formData.dt_zverejneni)}  ${formData.zverejnil_id ? getUserNameById(formData.zverejnil_id) : ''})` : \n                                '(nepodlh zveejnn v registru)'}\n                            </li>\n                            <li style={{ display: 'flex', alignItems: 'center', marginBottom: '0.4rem' }}>\n                               Fakturace ({formData.dt_faktura_pridana ? prettyDate(formData.dt_faktura_pridana) : ''}  {formData.fakturant_id ? getUserNameById(formData.fakturant_id) : ''})\n                            </li>\n                            {/*  PER-INVOICE: Vcn sprvnost jednotlivch faktur */}\n                            {formData.faktury && formData.faktury.length > 0 && formData.faktury.map((faktura, index) => {\n                              const isPotvrzeno = faktura.vecna_spravnost_potvrzeno === 1;\n                              const userName = faktura.potvrdil_vecnou_spravnost_jmeno \n                                ? `${faktura.potvrdil_vecnou_spravnost_jmeno} ${faktura.potvrdil_vecnou_spravnost_prijmeni || ''}`.trim()\n                                : (faktura.potvrdil_vecnou_spravnost_id ? getUserNameById(faktura.potvrdil_vecnou_spravnost_id) : '');\n                              const datum = faktura.dt_potvrzeni_vecne_spravnosti ? prettyDate(faktura.dt_potvrzeni_vecne_spravnosti) : '';\n                              \n                              return (\n                                <li key={faktura.id || index} style={{ display: 'flex', alignItems: 'center', marginBottom: '0.4rem' }}>\n                                  {isPotvrzeno ? '' : ''} Vcn sprvnost faktury #{index + 1} {datum ? `(${datum}  ${userName})` : ''}\n                                </li>\n                              );\n                            })}\n                          </ul>\n                          <div style={{ marginTop: '0.75rem', fontWeight: '500' }}>\n                            Nyn potvrte finln dokonen objednvky.\n                          </div>\n                        </div>\n                      </div>\n\n                      {/*  KONTROLA PEKROEN CENY - zobrazit JEN pokud je fakturace vy ne MAX cena */}\n                      {(() => {\n                        const maxCena = parseFloat(formData.max_cena_s_dph) || 0;\n                        const fakturyCelkem = formData.faktury ? formData.faktury.reduce((sum, faktura) => {\n                          const amount = parseFloat(faktura.fa_castka) || 0;\n                          return sum + amount;\n                        }, 0) : 0;\n\n                        const rozdil = fakturyCelkem - maxCena;\n                        const prekroceno = rozdil > 0;\n\n                        // Zobrazit POUZE pokud je pekroena MAX cena\n                        if (!prekroceno || maxCena === 0 || fakturyCelkem === 0) return null;\n\n                        return (\n                          <div style={{\n                            background: 'linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%)',\n                            border: '2px solid #ef4444',\n                            borderRadius: '12px',\n                            padding: '1rem',\n                            marginBottom: '1.5rem',\n                            boxShadow: '0 4px 12px rgba(239, 68, 68, 0.15)',\n                            display: 'flex',\n                            alignItems: 'flex-start',\n                            gap: '0.75rem'\n                          }}>\n                            <div style={{ fontSize: '1.5rem', marginTop: '0.1rem' }}></div>\n                            <div style={{ flex: 1 }}>\n                              <div style={{ fontWeight: '700', fontSize: '1rem', color: '#b91c1c', marginBottom: '0.5rem' }}>\n                                POZOR: Fakturace pekroila MAX cenu s DPH objednvky schvlenou PO\n                              </div>\n                              <div style={{\n                                display: 'grid',\n                                gridTemplateColumns: 'auto auto',\n                                gap: '0.5rem 1rem',\n                                fontSize: '0.875rem',\n                                color: '#7f1d1d',\n                                marginBottom: '0.75rem'\n                              }}>\n                                <span style={{ fontWeight: '600' }}>MAX cena s DPH (schvlen):</span>\n                                <span style={{ fontFamily: 'monospace', fontWeight: '700', textAlign: 'right' }}>{maxCena.toLocaleString('cs-CZ')} K</span>\n                                \n                                <span style={{ fontWeight: '600' }}>Fakturovan stka s DPH celkem:</span>\n                                <span style={{ fontFamily: 'monospace', fontWeight: '700', textAlign: 'right' }}>{fakturyCelkem.toLocaleString('cs-CZ')} K</span>\n                                \n                                <span style={{ fontWeight: '600' }}>Pekroen o:</span>\n                                <span style={{ fontFamily: 'monospace', fontWeight: '700', color: '#dc2626', textAlign: 'right' }}>\n                                  +{rozdil.toLocaleString('cs-CZ')} K\n                                </span>\n                              </div>\n                              {formData.vecna_spravnost_poznamka && (\n                                <div style={{\n                                  borderTop: '1px solid #fca5a5',\n                                  paddingTop: '0.75rem',\n                                  fontSize: '0.875rem',\n                                  color: '#7f1d1d'\n                                }}>\n                                  <div style={{ lineHeight: '1.5' }}>\n                                    <span style={{ fontWeight: '600' }}>Vysvtlen:</span>\n                                    {' '}\n                                    <span style={{ fontStyle: 'italic' }}>\n                                      \"{formData.vecna_spravnost_poznamka}\"\n                                    </span>\n                                  </div>\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        );\n                      })()}\n\n                      {/* POZNMKA K DOKONEN */}\n                      <FormRow>\n                        <FormGroup style={{ gridColumn: '1 / -1' }}>\n                          <Label>POZNMKA K DOKONEN (nepovinn)</Label>\n                          <TextArea\n                            value={formData.dokonceni_poznamka || ''}\n                            onChange={(e) => handleInputChange('dokonceni_poznamka', e.target.value)}\n                            placeholder=\"Voliteln poznmka k dokonen objednvky...\"\n                            rows={3}\n                            disabled={isDokonceniLockedLocal}\n                            style={{\n                              background: isDokonceniLockedLocal ? '#f3f4f6' : undefined,\n                              cursor: isDokonceniLockedLocal ? 'not-allowed' : undefined,\n                              opacity: isDokonceniLockedLocal ? 0.6 : 1\n                            }}\n                          />\n                        </FormGroup>\n                      </FormRow>\n\n                      {/* ANO/NE CHECKBOX - FINLN POTVRZEN */}\n                      <FormRow style={{ marginTop: '1.5rem' }}>\n                        <FormGroup style={{ gridColumn: '1 / -1' }}>\n                          <div style={{\n                            background: isDokonceniLockedLocal ? '#dcfce7' : '#fef3c7',\n                            border: `2px solid ${isDokonceniLockedLocal ? '#16a34a' : '#eab308'}`,\n                            borderRadius: '8px',\n                            padding: '1.25rem',\n                            opacity: isDokonceniLockedLocal ? 0.7 : 1\n                          }}>\n                            <label style={{\n                              display: 'flex',\n                              alignItems: 'center',\n                              gap: '1rem',\n                              cursor: isDokonceniLockedLocal ? 'not-allowed' : 'pointer',\n                              fontSize: '1rem',\n                              fontWeight: '600',\n                              color: formData.dokoncil_id ? '#166534' : '#713f12',\n                              opacity: formData.dokoncil_id ? 0.7 : 1\n                            }}>\n                              <input\n                                type=\"checkbox\"\n                                checked={\n                                  formData.potvrzeni_dokonceni_objednavky === 1 ||\n                                  formData.potvrzeni_dokonceni_objednavky === true ||\n                                  hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA')\n                                }\n                                onChange={(e) => {\n                                  handleInputChange('potvrzeni_dokonceni_objednavky', e.target.checked ? 1 : 0);\n                                }}\n                                required\n                                disabled={hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA')}\n                                style={{\n                                  width: '24px',\n                                  height: '24px',\n                                  cursor: isDokonceniLockedLocal ? 'not-allowed' : 'pointer',\n                                  accentColor: '#16a34a'\n                                }}\n                              />\n                              <span>\n                                 Potvrzuji finln dokonen objednvky\n                                <span style={{ color: '#dc2626', marginLeft: '0.25rem' }}>*</span>\n                              </span>\n                            </label>\n                            <div style={{\n                              fontSize: '0.875rem',\n                              color: isDokonceniLockedLocal ? '#166534' : '#92400e',\n                              marginTop: '0.75rem',\n                              marginLeft: '2.5rem'\n                            }}>\n                              {isDokonceniLockedLocal ? (\n                                <div>\n                                  <div style={{\n                                    fontWeight: '600',\n                                    display: 'flex',\n                                    alignItems: 'center',\n                                    gap: '0.5rem',\n                                    marginBottom: '0.5rem'\n                                  }}>\n                                    <span style={{ fontSize: '1.1rem' }}></span>\n                                    <strong>Objednvka je dokonena a uzamena</strong>\n                                  </div>\n                                  <div style={{ fontSize: '0.8rem', color: '#166534', lineHeight: '1.5' }}>\n                                    Workflow je kompletn uzameno. Zmny me provdt pouze oprvnn uivatel.\n                                  </div>\n                                </div>\n                              ) : (\n                                'Zakrtnutm potvrdte dokonen objednvky. Cel workflow bude uzamen.'\n                              )}\n                            </div>\n                          </div>\n                        </FormGroup>\n                      </FormRow>\n                    </div>\n                  </SectionContent>\n                </FormSection>\n                );\n              })()}\n\n              {/*  INFO BOX PRO BN UIVATELE - ek se na vcnou kontrolu */}\n              {(() => {\n                // Zobrazit info box pro uivatele BEZ prv ke kontrole vcn sprvnosti\n                //  DISABLED: Info block o vcn sprvnosti - ji nen poteba\n                const showInfoBlock = false; // Pvodn: currentPhase === 7 && !canUnlockAnything && !formData.potvrdil_vecnou_spravnost_id && !vecnaSpravnostState.visible\n                return showInfoBlock && (\n                  <div style={{\n                    margin: '2rem 0',\n                    padding: '1rem 1.25rem',\n                    backgroundColor: '#fef3c7',\n                    border: '1px solid #f59e0b',\n                    borderRadius: '8px',\n                    color: '#92400e'\n                  }}>\n                    <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                       ek se na vcnou kontrolu\n                    </div>\n                    <div style={{ fontSize: '0.875rem' }}>\n                      Objednvka ek na proveden vcn kontroly oprvnnm uivatelem. Po kontrole a potvrzen vcn sprvnosti bude mon pokraovat k <strong>dokonen objednvky</strong>.\n                    </div>\n                  </div>\n                );\n              })()}\n\n              {/* INFORMAN BLOK - FZE 7: VCN SPRVNOST - zobraz se pouze kdy workflow obsahuje ZKONTROLOVANA a jet nen potvrzena */}\n              {hasWorkflowState(formData.stav_workflow_kod, 'ZKONTROLOVANA') && !formData.potvrdil_vecnou_spravnost_id && (\n                <div style={{\n                  margin: '2rem 0',\n                  padding: '1rem 1.25rem',\n                  backgroundColor: '#f0fdfa',\n                  border: '1px solid #14b8a6',\n                  borderRadius: '8px',\n                  color: '#0f766e'\n                }}>\n                  <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                     FZE 7/8: Vcn sprvnost - Zkontrolujte a potvrte sprvnost objednvky\n                  </div>\n                  <div style={{ fontSize: '0.875rem' }}>\n                    Zkontrolujte vcnou sprvnost objednvky vetn vech faktur a daj. Po kontrole potvrte vcnou sprvnost v pslun sekci ne.\n                    {formData.faktury && formData.faktury.length > 0 && (\n                      <div style={{ marginTop: '0.5rem' }}>\n                        <strong>Faktury ke kontrole:</strong> {formData.faktury.length}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {/* INFORMAN BLOK - FZE 8: EK NA DOKONEN - pro bn uivatele (bez ORDER_MANAGE) */}\n              {!canUnlockAnything && \n               (hasWorkflowState(formData.stav_workflow_kod, 'ZKONTROLOVANA') || hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA')) &&\n               formData.potvrdil_vecnou_spravnost_id && \n               !hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA') && (\n                <div style={{\n                  margin: '2rem 0',\n                  padding: '1.5rem',\n                  backgroundColor: '#eff6ff',\n                  border: '2px solid #3b82f6',\n                  borderRadius: '8px',\n                  textAlign: 'center'\n                }}>\n                  <div style={{ fontSize: '3rem', marginBottom: '1rem' }}></div>\n                  <div style={{ fontWeight: '700', color: '#1e40af', marginBottom: '0.75rem', fontSize: '1.1rem' }}>\n                    Objednvka ek na dokonen\n                  </div>\n                  <div style={{ fontSize: '0.875rem', color: '#1e40af', lineHeight: '1.6' }}>\n                    Objednvka prola vemi fzemi workflow a ek na finln potvrzen dokonen.\n                  </div>\n                  <div style={{ fontSize: '0.875rem', color: '#1e40af', marginTop: '0.75rem', fontStyle: 'italic' }}>\n                     Dokonen objednvky provede oprvnn uivatel.\n                  </div>\n                </div>\n              )}\n\n              {/* INFORMAN BLOK - FZE 4/8: ekn na potvrzen dodavatelem */}\n              {(isArchived || currentPhase >= 4) && !formData.stav_stornovano && formData.dodavatel_zpusob_potvrzeni?.potvrzeni !== 'ANO' && (\n                <div style={{\n                  margin: '2rem 0',\n                  padding: '1rem 1.25rem',\n                  backgroundColor: '#f0fdf4',\n                  border: '1px solid #10b981',\n                  borderRadius: '8px',\n                  color: '#065f46'\n                }}>\n                  <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                     ekn na potvrzen od dodavatele\n                  </div>\n                  <div style={{ fontSize: '0.875rem' }}>\n                    Objednvka byla odeslna dodavateli. Po obdren potvrzen od dodavatele zakrtnte \"Dodavatel objednvku potvrdil\" a vyplte zpsob potvrzen.\n                    {formData.datum_odeslani && (\n                      <div style={{ marginTop: '0.5rem' }}>\n                        <strong>Datum odesln:</strong> {(() => {\n                          // Formtovn jen data bez asu (datum_odeslani je z datepickeru)\n                          const dateStr = formData.datum_odeslani.split(' ')[0]; // Odstranit ppadn as\n                          const [year, month, day] = dateStr.split('-');\n                          return `${day}. ${month}. ${year}`;\n                        })()}\n                        {formData.odesilatel_id && (\n                          <>\n                            {'  '}\n                            <strong>Odeslal:</strong> {getUserNameById(formData.odesilatel_id)}\n                          </>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {/* SCHOVAN SEKCE - Prbh objednvky a Dodac informace natvrdo zakzan */}\n              {/*\n              <FormSection>\n                <SectionHeader\n                  sectionTheme={getSectionTheme('prubeh_objednavky')}\n                  isActive={isSectionActive('prubeh_objednavky')}\n                >\n                  <SectionTitle sectionTheme={getSectionTheme('prubeh_objednavky')}>\n                    <SectionIcon sectionTheme={getSectionTheme('prubeh_objednavky')}>\n                      <FontAwesomeIcon icon={faClipboardCheck} />\n                    </SectionIcon>\n                    Prbh objednvky\n                  </SectionTitle>\n                  <CollapseIcon\n                    collapsed={sectionStates.prubeh_objednavky}\n                    sectionTheme={getSectionTheme('prubeh_objednavky')}\n                    onClick={() => toggleSection('prubeh_objednavky')}\n                    style={{ cursor: 'pointer' }}\n                  >\n                    <FontAwesomeIcon icon={faChevronUp} />\n                  </CollapseIcon>\n                </SectionHeader>\n                <SectionContent collapsed={sectionStates.prubeh_objednavky}>\n                  <FormRow>\n                    <FormGroup>\n                      <Label>STAV U DODAVATELE</Label>\n                      <InputWithIcon hasIcon>\n                        <Package />\n                        <select\n                          name=\"stav_u_dodavatele\"\n                          value={formData.stav_u_dodavatele || ''}\n                          onChange={(e) => handleInputChange('stav_u_dodavatele', e.target.value)}\n                          style={{\n                            width: '100%',\n                            padding: '0.75rem 3rem 0.75rem 3rem',\n                            border: '1px solid #d1d5db',\n                            borderRadius: '8px',\n                            fontSize: '0.875rem',\n                            backgroundColor: 'white'\n                          }}\n                        >\n                          <option value=\"\">Vyberte stav...</option>\n                          <option value=\"potvrzeno\">Potvrzeno dodavatelem</option>\n                          <option value=\"ve_vyrobe\">Ve vrob/pprav</option>\n                          <option value=\"pripraveno\">Pipraveno k odesln</option>\n                          <option value=\"odeslano\">Odeslno dodavatelem</option>\n                          <option value=\"doruceno\">Dorueno</option>\n                          <option value=\"stornovno\">Stornovno</option>\n                        </select>\n                      </InputWithIcon>\n                    </FormGroup>\n                    <FormGroup>\n                      <Label>DATUM ZMNY STAVU</Label>\n                      <DatePicker\n                        fieldName=\"datum_zmeny_stavu\"\n                        value={formData.datum_zmeny_stavu || ''}\n                        onChange={(value) => handleInputChange('datum_zmeny_stavu', value)}\n                        onBlur={(value) => handleFieldBlur('datum_zmeny_stavu', value)}\n                        placeholder=\"Vyberte datum zmny stavu\"\n                      />\n                    </FormGroup>\n                  </FormRow>\n                  <FormRow>\n                    <FormGroup style={{gridColumn: '1 / -1'}}>\n                      <Label>POZNMKA KE STAVU</Label>\n                      <TextArea\n                        name=\"poznamka_stav\"\n                        placeholder=\"Dodaten informace o prbhu objednvky...\"\n                        value={formData.poznamka_stav || ''}\n                        onChange={(e) => handleInputChange('poznamka_stav', e.target.value)}\n                        onBlur={(e) => handleFieldBlur('poznamka_stav', e.target.value)}\n                        rows={3}\n                      />\n                    </FormGroup>\n                  </FormRow>\n                </SectionContent>\n              </FormSection>\n\n              <FormSection>\n                <SectionHeader\n                  sectionTheme={getSectionTheme('dodaci_informace')}\n                  isActive={isSectionActive('dodaci_informace')}\n                >\n                  <SectionTitle sectionTheme={getSectionTheme('dodaci_informace')}>\n                    <SectionIcon sectionTheme={getSectionTheme('dodaci_informace')}>\n                      <Package />\n                    </SectionIcon>\n                    Dodac informace\n                  </SectionTitle>\n                  <CollapseIcon\n                    collapsed={sectionStates.dodaci_informace}\n                    sectionTheme={getSectionTheme('dodaci_informace')}\n                    onClick={() => toggleSection('dodaci_informace')}\n                    style={{ cursor: 'pointer' }}\n                  >\n                    <FontAwesomeIcon icon={faChevronUp} />\n                  </CollapseIcon>\n                </SectionHeader>\n                <SectionContent collapsed={sectionStates.dodaci_informace}>\n                  <FormRow>\n                    <FormGroup>\n                      <Label>SLO ZSILKY</Label>\n                      <InputWithIcon hasIcon>\n                        <Hash />\n                        <Input\n                          type=\"text\"\n                          name=\"cislo_zasilky\"\n                          placeholder=\"Sledovac slo zsilky\"\n                          value={formData.cislo_zasilky || ''}\n                          onChange={(e) => handleInputChange('cislo_zasilky', e.target.value)}\n                          hasIcon\n                        />\n                      </InputWithIcon>\n                    </FormGroup>\n                    <FormGroup>\n                      <Label>PEPRAVCE</Label>\n                      <InputWithIcon hasIcon>\n                        <Package />\n                        <Input\n                          type=\"text\"\n                          name=\"prepravce\"\n                          placeholder=\"Nzev pepravn spolenosti\"\n                          value={formData.prepravce || ''}\n                          onChange={(e) => handleInputChange('prepravce', e.target.value)}\n                          hasIcon\n                        />\n                      </InputWithIcon>\n                    </FormGroup>\n                  </FormRow>\n                  <FormRow>\n                    <FormGroup>\n                      <Label>OEKVAN DORUEN</Label>\n                      <DatePicker\n                        fieldName=\"ocekavane_doruceni\"\n                        value={formData.ocekavane_doruceni || ''}\n                        onChange={(value) => handleInputChange('ocekavane_doruceni', value)}\n                        onBlur={(value) => handleFieldBlur('ocekavane_doruceni', value)}\n                        placeholder=\"Vyberte oekvan datum doruen\"\n                      />\n                    </FormGroup>\n                    <FormGroup>\n                      <Label>SKUTEN DORUEN</Label>\n                      <DatePicker\n                        fieldName=\"skutecne_doruceni\"\n                        value={formData.skutecne_doruceni || ''}\n                        onChange={(value) => handleInputChange('skutecne_doruceni', value)}\n                        onBlur={(value) => handleFieldBlur('skutecne_doruceni', value)}\n                        placeholder=\"Vyberte skuten datum doruen\"\n                      />\n                    </FormGroup>\n                  </FormRow>\n                </SectionContent>\n              </FormSection>\n              */}\n\n              {/* SEKCE FAKTURACE DOASN SKRYTA - BUDE PIDNA POZDJI */}\n              {/* Sekce: Fakturace - zobraz se a po potvrzen ANO od dodavatele */}\n              {false && formData.dodavatel_zpusob_potvrzeni?.potvrzeni === 'ANO' && (\n                <FormSection>\n                  <SectionHeader\n                    sectionTheme={getSectionTheme('fakturace')}\n                    isActive={isSectionActive('fakturace')}\n                  >\n                    <SectionTitle sectionTheme={getSectionTheme('fakturace')}>\n                      <SectionIcon sectionTheme={getSectionTheme('fakturace')}>\n                        <Calculator />\n                      </SectionIcon>\n                      Fakturace\n                    </SectionTitle>\n                    <CollapseIcon\n                      collapsed={sectionStates.fakturace}\n                      sectionTheme={getSectionTheme('fakturace')}\n                      onClick={() => toggleSection('fakturace')}\n                      style={{ cursor: 'pointer' }}\n                    >\n                      <FontAwesomeIcon icon={faChevronUp} />\n                    </CollapseIcon>\n                  </SectionHeader>\n                  <SectionContent collapsed={sectionStates.fakturace}>\n                    <FormRow>\n                      <FormGroup>\n                        <Label>SLO FAKTURY</Label>\n                        <InputWithIcon hasIcon>\n                          <Hash />\n                          <Input\n                            type=\"text\"\n                            name=\"cislo_faktury\"\n                            placeholder=\"slo pijat faktury\"\n                            value={formData.cislo_faktury || ''}\n                            onChange={(e) => handleInputChange('cislo_faktury', e.target.value)}\n                            hasIcon\n                          />\n                        </InputWithIcon>\n                      </FormGroup>\n                      <FormGroup>\n                        <Label>DATUM FAKTURY</Label>\n                        <DatePicker\n                          fieldName=\"datum_faktury\"\n                          value={formData.datum_faktury || ''}\n                          onChange={(value) => handleInputChange('datum_faktury', value)}\n                          onBlur={(value) => handleFieldBlur('datum_faktury', value)}\n                          placeholder=\"Vyberte datum faktury\"\n                        />\n                      </FormGroup>\n                    </FormRow>\n                  <FormRow>\n                    <FormGroup>\n                      <Label>STKA BEZ DPH</Label>\n                      <InputWithIcon hasIcon>\n                        <Calculator />\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          name=\"castka_bez_dph\"\n                          placeholder=\"0.00\"\n                          value={formData.castka_bez_dph || ''}\n                          onChange={(e) => handleInputChange('castka_bez_dph', e.target.value)}\n                          style={{textAlign: 'right'}}\n                          hasIcon\n                        />\n                      </InputWithIcon>\n                    </FormGroup>\n                    <FormGroup>\n                      <Label>STKA S DPH</Label>\n                      <InputWithIcon hasIcon>\n                        <Calculator />\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          name=\"castka_s_dph\"\n                          placeholder=\"0.00\"\n                          value={formData.castka_s_dph || ''}\n                          onChange={(e) => handleInputChange('castka_s_dph', e.target.value)}\n                          style={{textAlign: 'right'}}\n                          hasIcon\n                        />\n                      </InputWithIcon>\n                    </FormGroup>\n                  </FormRow>\n                  <FormRow>\n                    <FormGroup>\n                      <Label>DATUM SPLATNOSTI</Label>\n                      <DatePicker\n                        fieldName=\"datum_splatnosti\"\n                        value={formData.datum_splatnosti || ''}\n                        onChange={(value) => handleInputChange('datum_splatnosti', value)}\n                        onBlur={(value) => handleFieldBlur('datum_splatnosti', value)}\n                        placeholder=\"Vyberte datum splatnosti\"\n                      />\n                    </FormGroup>\n                    <FormGroup>\n                      <Label>DATUM ZAPLACEN</Label>\n                      <DatePicker\n                        fieldName=\"datum_zaplaceni\"\n                        value={formData.datum_zaplaceni || ''}\n                        onChange={(value) => handleInputChange('datum_zaplaceni', value)}\n                        onBlur={(value) => handleFieldBlur('datum_zaplaceni', value)}\n                        placeholder=\"Vyberte datum zaplacen\"\n                      />\n                    </FormGroup>\n                  </FormRow>\n                </SectionContent>\n                </FormSection>\n              )}\n            </>\n          )}\n        </>\n      )}\n\n          {/*  NOV POZICE: Sekce Plohy k objednvce - zobraz se JEN kdy m objednvka ID (po prvnm uloen) */}\n          {formData.id && (() => {\n            //  isPrilohyLocked je definovno globln na dku ~5203 jako: isWorkflowCompleted && !canUnlockAnything\n\n            return (\n            <FormSection data-section=\"prilohy\">\n              <SectionHeader\n                sectionTheme={getSectionTheme('prilohy')}\n                isActive={isSectionActive('prilohy')}\n              >\n                <SectionTitle sectionTheme={getSectionTheme('prilohy')}>\n                  <SectionIcon sectionTheme={getSectionTheme('prilohy')}>\n                    <FontAwesomeIcon icon={faClipboard} />\n                  </SectionIcon>\n                  Plohy k objednvce\n                  {/*  Badge kdy je objednvka dokonena/zamtnuta/zruena */}\n                  {isPrilohyLocked && (\n                    <LockWarning title=\"Sekce Plohy k objednvce je zamena - objednvka je dokonena/zamtnuta/zruena.\">\n                      \n                    </LockWarning>\n                  )}\n                </SectionTitle>\n                <CollapseIcon\n                  collapsed={sectionStates.prilohy}\n                  sectionTheme={getSectionTheme('prilohy')}\n                  onClick={() => toggleSection('prilohy')}\n                  style={{ cursor: 'pointer' }}\n                >\n                  <FontAwesomeIcon icon={faChevronUp} />\n                </CollapseIcon>\n              </SectionHeader>\n              <SectionContent collapsed={sectionStates.prilohy}>\n                <FormRow>\n                  <FormGroup style={{gridColumn: '1 / -1'}}>\n                    {/*  Informace o zamen */}\n                    {isPrilohyLocked && (\n                      <div style={{\n                        background: '#fef3c7',\n                        border: '2px solid #f59e0b',\n                        borderRadius: '8px',\n                        padding: '1rem',\n                        marginBottom: '1rem',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.75rem'\n                      }}>\n                        <span style={{ fontSize: '1.5rem' }}></span>\n                        <div>\n                          <div style={{ fontWeight: '600', color: '#92400e', marginBottom: '0.25rem' }}>\n                            Pidvn ploh je zameno\n                          </div>\n                          <div style={{ fontSize: '0.875rem', color: '#92400e' }}>\n                            Objednvka je dokonena - nelze pidvat ani upravovat plohy.\n                          </div>\n                        </div>\n                      </div>\n                    )}\n\n                    {/* Drag & Drop Oblast */}\n                    <div\n                      style={{\n                        border: `2px dashed ${isPrilohyLocked ? '#d1d5db' : (dragOver ? '#dc2626' : '#fca5a5')}`,\n                        borderRadius: '8px',\n                        padding: '2rem',\n                        textAlign: 'center',\n                        backgroundColor: isPrilohyLocked ? '#f3f4f6' : (dragOver ? 'rgba(254, 202, 202, 0.5)' : 'rgba(254, 226, 226, 0.3)'),\n                        marginBottom: '1rem',\n                        transition: 'all 0.2s ease',\n                        cursor: isPrilohyLocked ? 'not-allowed' : 'pointer',\n                        opacity: isPrilohyLocked ? 0.5 : 1,\n                        pointerEvents: isPrilohyLocked ? 'none' : 'auto'\n                      }}\n                      onDrop={(e) => {\n                        if (isPrilohyLocked) return;\n                        e.preventDefault();\n                        e.stopPropagation();\n                        setDragOver(false);\n                        handleFileDrop(e);\n                      }}\n                      onDragOver={(e) => {\n                        if (isPrilohyLocked) return;\n                        e.preventDefault();\n                        e.stopPropagation();\n                        setDragOver(true);\n                      }}\n                      onDragEnter={(e) => {\n                        if (isPrilohyLocked) return;\n                        e.preventDefault();\n                        e.stopPropagation();\n                        setDragOver(true);\n                      }}\n                      onDragLeave={(e) => {\n                        if (isPrilohyLocked) return;\n                        e.preventDefault();\n                        e.stopPropagation();\n                        // Zkontroluj, zda opravdu opoutme celou oblast\n                        if (!e.currentTarget.contains(e.relatedTarget)) {\n                          setDragOver(false);\n                        }\n                      }}\n                      onClick={() => !isPrilohyLocked && document.getElementById('fileInput').click()}\n                    >\n                      {uploadingFiles ? (\n                        <div style={{\n                          width: '32px',\n                          height: '32px',\n                          border: '3px solid #f3f4f6',\n                          borderTop: '3px solid #3b82f6',\n                          borderRadius: '50%',\n                          animation: 'spin 1s linear infinite',\n                          margin: '0 auto 1rem auto'\n                        }}></div>\n                      ) : (\n                        <div style={{\n                          fontSize: '3rem',\n                          marginBottom: '1rem',\n                          color: dragOver ? '#dc2626' : '#991b1b',\n                          transition: 'color 0.2s ease'\n                        }}>\n                          \n                        </div>\n                      )}\n                      <div style={{\n                        fontSize: '1rem',\n                        fontWeight: '500',\n                        marginBottom: '0.5rem',\n                        color: dragOver ? '#dc2626' : uploadingFiles ? '#f59e0b' : '#991b1b'\n                      }}>\n                        {uploadingFiles ? 'Nahrvm soubory...' : dragOver ? 'Pus soubory zde!' : 'Pethni nebo vyber soubory'}\n                      </div>\n                      <div style={{ fontSize: '0.875rem', color: '#6b7280', marginBottom: '1rem' }}>\n                        Kad ploha mus bt klasifikovna: Objednvka / Faktura / Koilka / Jin.\n                      </div>\n                      <div style={{ fontSize: '0.75rem', color: '#991b1b', fontWeight: '500' }}>\n                         Orders25 API: Plohy se automaticky nahraj na server po klasifikaci pomoc Orders25 attachment API.\n                      </div>\n                      <button\n                        type=\"button\"\n                        disabled={isPrilohyLocked}\n                        style={{\n                          marginTop: '1rem',\n                          background: isPrilohyLocked ? '#9ca3af' : '#3b82f6',\n                          color: 'white',\n                          border: 'none',\n                          borderRadius: '6px',\n                          padding: '0.5rem 1rem',\n                          fontSize: '0.875rem',\n                          fontWeight: '500',\n                          cursor: isPrilohyLocked ? 'not-allowed' : 'pointer',\n                          opacity: isPrilohyLocked ? 0.6 : 1\n                        }}\n                        onClick={(e) => {\n                          if (isPrilohyLocked) return;\n                          e.stopPropagation();\n                          document.getElementById('fileInput').click();\n                        }}\n                      >\n                        Vybrat\n                      </button>\n                    </div>\n\n                    {/* Skryt file input */}\n                    <input\n                      id=\"fileInput\"\n                      type=\"file\"\n                      multiple\n                      accept=\".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif,.txt\"\n                      onChange={handleFileSelect}\n                      disabled={isPrilohyLocked}\n                      style={{ display: 'none' }}\n                    />\n\n                    {/* Seznam nahranch soubor - pouze obj- prefix */}\n                    {attachments && attachments.filter(a => getFilePrefix(a) === 'obj-').length > 0 && (\n                      <div style={{ marginTop: '1rem' }}>\n                        <div style={{\n                          display: 'flex',\n                          justifyContent: 'space-between',\n                          alignItems: 'center',\n                          marginBottom: '1rem'\n                        }}>\n                          <Label>\n                            Poet ploh: <strong>{attachments.filter(a => getFilePrefix(a) === 'obj-').length}</strong> |\n                            Nahrno: <span style={{color: '#16a34a'}}><strong>{attachments.filter(f => getFilePrefix(f) === 'obj-' && f.status === 'uploaded').length}</strong></span>\n                          </Label>\n\n                          <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                            {/* Sync tlatko */}\n                            <button\n                              type=\"button\"\n                              onClick={() => checkAttachmentsSynchronization25(false)}\n                              disabled={isCheckingSyncAttachments}\n                              style={{\n                                background: '#10b981',\n                                color: 'white',\n                                border: 'none',\n                                borderRadius: '6px',\n                                padding: '0.375rem',\n                                fontSize: '0.875rem',\n                                cursor: isCheckingSyncAttachments ? 'not-allowed' : 'pointer',\n                                display: 'flex',\n                                alignItems: 'center',\n                                justifyContent: 'center',\n                                opacity: isCheckingSyncAttachments ? 0.6 : 1\n                              }}\n                              title=\"Kontrola synchronizace ploh s databz a diskem - zkontroluje, jestli jsou plohy v DB i fyzicky na disku\"\n                            >\n                              <FontAwesomeIcon icon={faSync} />\n                            </button>\n\n                            {/* Smart tlatko */}\n                            <button\n                              type=\"button\"\n                              onClick={loadAttachmentsSmartly}\n                              style={{\n                                background: '#3b82f6',\n                                color: 'white',\n                                border: 'none',\n                                borderRadius: '6px',\n                                padding: '0.375rem',\n                                fontSize: '0.875rem',\n                                cursor: 'pointer',\n                                display: 'flex',\n                                alignItems: 'center',\n                                justifyContent: 'center'\n                              }}\n                              title=\"Chytr naten ploh - slou DB plohy s loklnmi neuloenmi plohami, ideln pi obnoven formule\"\n                            >\n                              <FontAwesomeIcon icon={faBrain} />\n                            </button>\n\n                            {/* DB tlatko */}\n                            <button\n                              type=\"button\"\n                              onClick={() => restoreAttachmentsFromDB(false)}\n                              style={{\n                                background: '#7c3aed',\n                                color: 'white',\n                                border: 'none',\n                                borderRadius: '6px',\n                                padding: '0.375rem',\n                                fontSize: '0.875rem',\n                                cursor: 'pointer',\n                                display: 'flex',\n                                alignItems: 'center',\n                                justifyContent: 'center'\n                              }}\n                              title=\"Naten z databze - nate pouze plohy uloen v databzi, pepe lokln stav\"\n                            >\n                              <FontAwesomeIcon icon={faDatabase} />\n                            </button>\n\n                            {/* Vymazat vechny - SKRT kdy je zameno */}\n                            {!isPrilohyLocked && (\n                              <button\n                                type=\"button\"\n                                onClick={removeAllFiles}\n                                style={{\n                                  background: '#dc2626',\n                                  color: 'white',\n                                  border: 'none',\n                                  borderRadius: '6px',\n                                  padding: '0.25rem 0.75rem',\n                                  fontSize: '0.75rem',\n                                  cursor: 'pointer'\n                                }}\n                              >\n                                Vymazat vechny\n                              </button>\n                            )}\n                          </div>\n                        </div>\n                        {attachments.filter(a => getFilePrefix(a) === 'obj-').map((file, index) => (\n                          <div key={file.id} style={{\n                            display: 'flex',\n                            alignItems: 'center',\n                            gap: '0.75rem',\n                            padding: '0.75rem',\n                            border: `1px solid ${getFileBorderColor(file)}`,\n                            borderRadius: '6px',\n                            backgroundColor: getFileBackgroundColor(file),\n                            marginBottom: '0.5rem',\n                            opacity: file.status === 'uploading' ? 0.6 : 1\n                          }}>\n                            {/* Ikona PDF/souboru s indiktorem stavu - fit pro 2 dky */}\n                            <div style={{\n                              width: '32px',\n                              height: '44px',\n                              display: 'flex',\n                              alignItems: 'center',\n                              justifyContent: 'center',\n                              flexShrink: 0,\n                              position: 'relative'\n                            }}>\n                              <FontAwesomeIcon\n                                icon={file.file_exists === false ? faFileCircleXmark : faFileAlt}\n                                style={{\n                                  color: file.file_exists === false ? '#dc2626' : (file.status === 'uploaded' ? '#10b981' : '#dc2626'),\n                                  fontSize: '24px'\n                                }}\n                              />\n                              {file.status === 'uploading' && (\n                                <div style={{\n                                  position: 'absolute',\n                                  top: '-2px',\n                                  right: '-2px',\n                                  width: '12px',\n                                  height: '12px',\n                                  backgroundColor: '#f59e0b',\n                                  borderRadius: '50%',\n                                  animation: 'spin 1s linear infinite'\n                                }} />\n                              )}\n                              {file.status === 'uploaded' && (\n                                <div style={{\n                                  position: 'absolute',\n                                  top: '-2px',\n                                  right: '-2px',\n                                  width: '12px',\n                                  height: '12px',\n                                  backgroundColor: '#10b981',\n                                  borderRadius: '50%'\n                                }} />\n                              )}\n                            </div>\n\n                            {/* Informace o souboru */}\n                            <div style={{ flex: 1, minWidth: 0 }}>\n                              <div style={{\n                                fontWeight: '500',\n                                fontSize: '0.875rem',\n                                color: '#374151',\n                                marginBottom: '2px'\n                              }}>\n                                {/* Jeden dek - nzev, velikost, staen, ko */}\n                                <div style={{\n                                  display: 'flex',\n                                  alignItems: 'center',\n                                  gap: '0.5rem'\n                                }}>\n                                  {/* Nzev souboru s hvzdikou jako horn index */}\n                                  <span style={{\n                                    overflow: 'hidden',\n                                    textOverflow: 'ellipsis',\n                                    whiteSpace: 'nowrap',\n                                    flex: 1,\n                                    minWidth: 0,\n                                    position: 'relative'\n                                  }}>\n                                    {file.name}\n                                    {/* erven hvzdika jako horn index hned za nzvem */}\n                                    {!file.klasifikace && (\n                                      <span style={{\n                                        color: '#dc2626',\n                                        fontSize: '0.7rem',\n                                        fontWeight: 'bold',\n                                        position: 'absolute',\n                                        top: '-2px',\n                                        marginLeft: '2px'\n                                      }}>\n                                        *\n                                      </span>\n                                    )}\n                                  </span>\n\n                                  {/* Warning pro soubory, kter neexistuj na disku */}\n                                  {file.file_exists === false && (\n                                    <span style={{\n                                      color: '#dc2626',\n                                      fontSize: '0.7rem',\n                                      fontWeight: 'bold',\n                                      backgroundColor: '#fee2e2',\n                                      padding: '1px 4px',\n                                      borderRadius: '3px',\n                                      flexShrink: 0\n                                    }}>\n                                       SOUBOR NENALEZEN\n                                    </span>\n                                  )}\n\n                                  {/* Warning pro duplicity */}\n                                  {file.isDuplicate && (\n                                    <span style={{\n                                      color: '#f59e0b',\n                                      fontSize: '0.7rem',\n                                      fontWeight: 'bold',\n                                      backgroundColor: '#fef3c7',\n                                      padding: '1px 4px',\n                                      borderRadius: '3px',\n                                      flexShrink: 0\n                                    }}>\n                                      DUPLIKT\n                                    </span>\n                                  )}\n\n                                  {/* Velikost souboru - pouvej velikost z BE nebo size z loklnho */}\n                                  <span style={{\n                                    color: '#6b7280',\n                                    fontWeight: 'normal',\n                                    fontSize: '0.75rem',\n                                    flexShrink: 0\n                                  }}>\n                                    ({Math.round((file.velikost || file.size || 0) / 1024)} kB)\n                                  </span>\n\n                                  {/* Staen pro nahran soubory */}\n                                  {file.status === 'uploaded' && file.serverId && (\n                                    <button\n                                      type=\"button\"\n                                      onClick={() => downloadAttachmentFromServer25(file)}\n                                      style={{\n                                        background: 'none',\n                                        border: 'none',\n                                        color: '#2563eb',\n                                        cursor: 'pointer',\n                                        padding: '2px',\n                                        display: 'flex',\n                                        alignItems: 'center',\n                                        fontSize: '12px',\n                                        flexShrink: 0\n                                      }}\n                                      title=\"Sthnout soubor\"\n                                    >\n                                      <FileText size={14} />\n                                    </button>\n                                  )}\n\n                                  {/* Ko - SKRT kdy je zameno */}\n                                  {!isPrilohyLocked && (\n                                    <button\n                                      type=\"button\"\n                                      onClick={() => file.serverId ? deleteAttachmentFromServer25(file.id) : removeFile(file.id)}\n                                      disabled={file.status === 'uploading'}\n                                      style={{\n                                        background: 'none',\n                                        border: 'none',\n                                        color: file.status === 'uploading' ? '#9ca3af' : '#dc2626',\n                                        cursor: file.status === 'uploading' ? 'not-allowed' : 'pointer',\n                                        padding: '2px',\n                                        display: 'flex',\n                                        alignItems: 'center',\n                                        opacity: file.status === 'uploading' ? 0.6 : 1,\n                                        fontSize: '12px',\n                                        flexShrink: 0\n                                      }}\n                                      title={file.serverId ? \"Smazat ze serveru\" : \"Smazat soubor\"}\n                                    >\n                                      <FontAwesomeIcon icon={faTrash} />\n                                    </button>\n                                  )}\n                                </div>\n                              </div>\n                              <div style={{\n                                fontSize: '0.75rem',\n                                color: '#6b7280',\n                                display: 'flex',\n                                alignItems: 'center',\n                                gap: '0.5rem'\n                              }}>\n                                <span>{formatDateOnly(new Date(file.uploadDate))} {new Date(file.uploadDate).toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' })}</span>\n                                <span></span>\n                                <span style={{\n                                  textTransform: 'uppercase',\n                                  backgroundColor: '#fef3c7',\n                                  color: '#92400e',\n                                  padding: '2px 6px',\n                                  borderRadius: '4px',\n                                  fontSize: '0.6875rem',\n                                  fontWeight: '500'\n                                }}>\n                                  {file.type.includes('pdf') ? 'PDF' : file.name.split('.').pop()}\n                                </span>\n                                <span></span>\n                                <span style={{\n                                  backgroundColor: '#e0e7ff',\n                                  color: '#3730a3',\n                                  padding: '2px 6px',\n                                  borderRadius: '4px',\n                                  fontSize: '0.6875rem',\n                                  fontWeight: '500'\n                                }}>\n                                  Nahrno: {file.nahrano_uzivatel?.prijmeni || 'ADMIN'} {file.nahrano_uzivatel?.jmeno || 'Super'}\n                                </span>\n                              </div>\n                            </div>\n\n                            {/* Dropdown pro klasifikaci */}\n                            <div style={{ minWidth: '180px', flexShrink: 0 }}>\n                              {(() => {\n                                // Debug log pro hodnotu selectu\n                                // Debug disabled for production\n                                return null;\n                              })()}\n                              <select\n                                value={file.klasifikace || ''}\n                                onChange={(e) => updateFileKlasifikace(file.id, e.target.value)}\n                                disabled={file.status === 'uploading' || file.typ_prilohy === 'IMPORT' || isPrilohyLocked}\n                                style={{\n                                  width: '100%',\n                                  padding: '0.5rem 0.75rem',\n                                  border: `1px solid ${!file.klasifikace ? '#fca5a5' : file.typ_prilohy === 'IMPORT' ? '#f59e0b' : '#d1d5db'}`,\n                                  borderRadius: '6px',\n                                  fontSize: '0.875rem',\n                                  backgroundColor: file.status === 'uploading' ? '#f3f4f6' : file.typ_prilohy === 'IMPORT' ? '#fef3c7' : isPrilohyLocked ? '#f3f4f6' : 'white',\n                                  color: file.klasifikace ? '#374151' : '#6b7280',\n                                  cursor: file.status === 'uploading' || file.typ_prilohy === 'IMPORT' || isPrilohyLocked ? 'not-allowed' : 'pointer',\n                                  opacity: file.status === 'uploading' || isPrilohyLocked ? 0.6 : 1,\n                                  fontWeight: file.typ_prilohy === 'IMPORT' ? '600' : 'normal'\n                                }}\n                                title={isPrilohyLocked ? 'Klasifikace je zamena - objednvka dokonena' : (file.typ_prilohy === 'IMPORT' ? 'Importovan ploha - nelze mnit typ' : '')}\n                              >\n                                <option value=\"\" style={{ color: '#6b7280' }}>Vyberte...</option>\n                                {prilohyTypyOptions.map(typ => (\n                                  <option key={typ.kod || typ.id} value={typ.kod || typ.id}>\n                                    {typ.nazev || typ.name}\n                                  </option>\n                                ))}\n                              </select>\n                            </div>\n\n                          </div>\n                        ))}\n                      </div>\n                    )}\n\n                    {/* Varovn zprva o okamitch zmnch v plohch */}\n                    <div style={{\n                      backgroundColor: '#fef3c7',\n                      border: '1px solid #f59e0b',\n                      borderRadius: '8px',\n                      padding: '1rem',\n                      marginTop: '1rem',\n                      display: 'flex',\n                      alignItems: 'flex-start',\n                      gap: '0.75rem'\n                    }}>\n                      <div style={{\n                        fontSize: '1.25rem',\n                        flexShrink: 0,\n                        lineHeight: 1\n                      }}>\n                        \n                      </div>\n                      <div style={{\n                        fontSize: '0.875rem',\n                        color: '#92400e',\n                        lineHeight: '1.5'\n                      }}>\n                        <strong>Dleit upozornn:</strong> Vechny zmny v plohch (nahrn, klasifikace, mazn)\n                        jsou provdny okamit a automaticky se ukldaj do databze.\n                        Tyto akce nelze vzt zpt pomoc tlatka \"Zruit\".\n                      </div>\n                    </div>\n                  </FormGroup>\n                </FormRow>\n              </SectionContent>\n            </FormSection>\n            );\n          })()}\n\n          </ScrollableInner>\n        </ScrollableContent>\n      </FormWrapper>\n\n      {/* Supplier Search Dialog */}\n      {showSupplierSearchDialog && ReactDOM.createPortal(\n        <SupplierPopupOverlay>\n          <SupplierPopupModal onClick={(e) => e.stopPropagation()}>\n            <SupplierPopupHeader>\n              <SupplierPopupTitle>\n                <Users size={24} />\n                Adres dodavatel\n              </SupplierPopupTitle>\n              <SupplierPopupCloseButton onClick={handleSupplierSearchClose}>\n                \n              </SupplierPopupCloseButton>\n            </SupplierPopupHeader>\n\n            <SupplierPopupContent>\n              {/* Search Input */}\n              <div style={{ marginBottom: '20px' }}>\n                <SupplierSearchInput\n                  type=\"text\"\n                  value={supplierSearchTerm}\n                  onChange={handleSupplierSearchChange}\n                  placeholder=\"Vyhledat podle nzvu nebo IO...\"\n                  autoFocus\n                />\n              </div>\n\n              {/* Search Results */}\n              <div style={{ minHeight: '200px' }}>\n                {supplierSearchLoading ? (\n                  <div style={{\n                    display: 'flex',\n                    flexDirection: 'column',\n                    alignItems: 'center',\n                    padding: '40px 20px',\n                    textAlign: 'center'\n                  }}>\n                    <div style={{\n                      width: '32px',\n                      height: '32px',\n                      border: '3px solid #f3f4f6',\n                      borderTop: '3px solid #3b82f6',\n                      borderRadius: '50%',\n                      animation: 'spin 1s linear infinite',\n                      marginBottom: '16px'\n                    }}></div>\n                    <p style={{ color: '#6b7280', margin: 0 }}>Vyhledvm dodavatele...</p>\n                  </div>\n                ) : supplierSearchResults.length > 0 ? (\n                  <SupplierList>\n                    {supplierSearchResults.map((supplier, index) => (\n                      <SupplierItem\n                        key={supplier.id || index}\n                        onClick={() => handleSupplierSearchSelect(supplier)}\n                      >\n                        <div style={{ fontWeight: '600', color: '#111827', marginBottom: '8px' }}>\n                          {supplier.nazev || supplier.name}\n                        </div>\n                        <div style={{ fontSize: '0.875rem', color: '#6b7280', marginBottom: '4px' }}>\n                          {supplier.adresa || supplier.address || supplier.sidlo}\n                        </div>\n                        <div style={{ fontSize: '0.875rem', color: '#6b7280', marginBottom: '4px' }}>\n                          {supplier.ico && `IO: ${supplier.ico}`} {supplier.dic && ` DI: ${supplier.dic}`}\n                        </div>\n                        {(supplier.kontakt_jmeno || supplier.kontakt_email) && (\n                          <div style={{ fontSize: '0.75rem', color: '#9ca3af' }}>\n                            Kontakt: {supplier.kontakt_jmeno} {supplier.kontakt_email && ` ${supplier.kontakt_email}`}\n                          </div>\n                        )}\n                      </SupplierItem>\n                    ))}\n                  </SupplierList>\n                ) : allSupplierContacts.length === 0 ? (\n                  <div style={{\n                    textAlign: 'center',\n                    padding: '40px 20px',\n                    color: '#6b7280'\n                  }}>\n                    <p>dn dodavatel nejsou k dispozici.</p>\n                  </div>\n                ) : supplierSearchTerm.length >= 2 ? (\n                  <div style={{\n                    textAlign: 'center',\n                    padding: '40px 20px',\n                    color: '#6b7280'\n                  }}>\n                    <p>dn dodavatel nevyhovuj vyhledvn \"{supplierSearchTerm}\".</p>\n                  </div>\n                ) : (\n                  <div style={{\n                    textAlign: 'center',\n                    padding: '40px 20px',\n                    color: '#6b7280'\n                  }}>\n                    <p>Zante pst pro filtrovn dodavatel...</p>\n                  </div>\n                )}\n              </div>\n            </SupplierPopupContent>\n          </SupplierPopupModal>\n        </SupplierPopupOverlay>,\n        document.body\n      )}\n\n      {/* ARES Search Popup */}\n      {aresPopupOpen && ReactDOM.createPortal(\n        <AresPopupOverlay>\n          <AresPopupModal onClick={(e) => e.stopPropagation()}>\n            <AresPopupHeader>\n              <AresPopupTitle>\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <ellipse cx=\"12\" cy=\"5\" rx=\"9\" ry=\"3\"/>\n                  <path d=\"M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5\"/>\n                  <path d=\"M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3\"/>\n                </svg>\n                ARES - Administrativn registr ekonomickch subjekt\n              </AresPopupTitle>\n              <AresPopupCloseButton\n                onClick={() => {\n                  setAresPopupOpen(false);\n                  setAresSearch('');\n                }}\n              >\n                <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/>\n                  <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\n                </svg>\n              </AresPopupCloseButton>\n            </AresPopupHeader>\n\n            <AresPopupContent>\n              <AresSearchInputField\n                type=\"text\"\n                placeholder=\"Vyhledat podle nzvu firmy nebo IO...\"\n                value={aresSearch}\n                onChange={handleAresSearchChange}\n                autoFocus\n              />\n\n              {/*  ROZSAH ULOEN - PRESNE STEJN jako SupplierAddDialog */}\n              <div style={{ marginBottom: '16px' }}>\n                <div style={{ fontSize: '14px', fontWeight: '600', color: '#262626', marginBottom: '8px', textTransform: 'uppercase', letterSpacing: '0.5px' }}>\n                  Rozsah uloen\n                </div>\n                <AresScopeSelector>\n                  {/* Osobn */}\n                  <AresScopeOption\n                    type=\"button\"\n                    selected={aresSelectedScope === 'personal'}\n                    onClick={() => setAresSelectedScope('personal')}\n                  >\n                    <FontAwesomeIcon icon={faUser} />\n                    <span>Osobn</span>\n                  </AresScopeOption>\n\n                  {/* sek */}\n                  <AresScopeOption\n                    type=\"button\"\n                    selected={aresSelectedScope === 'usek'}\n                    onClick={() => hasPermission && hasPermission('CONTACT_EDIT') && setAresSelectedScope('usek')}\n                    disabled={!hasPermission || !hasPermission('CONTACT_EDIT')}\n                    title={(!hasPermission || !hasPermission('CONTACT_EDIT')) ? \"Nemte oprvnn pro sekov kontakt\" : \"\"}\n                  >\n                    <FontAwesomeIcon icon={faBuilding} />\n                    <span>sek</span>\n                  </AresScopeOption>\n\n                  {/* Globln */}\n                  <AresScopeOption\n                    type=\"button\"\n                    selected={aresSelectedScope === 'global'}\n                    onClick={() => hasPermission && hasPermission('CONTACT_MANAGE') && setAresSelectedScope('global')}\n                    disabled={!hasPermission || !hasPermission('CONTACT_MANAGE')}\n                    title={(!hasPermission || !hasPermission('CONTACT_MANAGE')) ? \"Nemte oprvnn pro globln kontakt\" : \"\"}\n                  >\n                    <FontAwesomeIcon icon={faGlobe} />\n                    <span>Globln</span>\n                  </AresScopeOption>\n                </AresScopeSelector>\n              </div>\n\n              {/*  Vbr sek - zobraz se pouze pokud je vybran scope \"usek\" */}\n              {aresSelectedScope === 'usek' && (\n                <div style={{ marginBottom: '16px' }}>\n                  <div style={{ fontSize: '14px', fontWeight: '600', color: '#262626', marginBottom: '12px', textTransform: 'uppercase', letterSpacing: '0.5px' }}>\n                    {canManageUsers ? 'Vbr sek' : `V sek: ${userDetail?.usek_zkr || 'N/A'}`}\n                  </div>\n                  {usekyLoading ? (\n                    <div style={{ padding: '1rem', textAlign: 'center', color: '#6b7280' }}>\n                      Natm seky...\n                    </div>\n                  ) : availableUseky.length === 0 ? (\n                    <div style={{ padding: '1rem', background: '#fef2f2', border: '1px solid #fecaca', borderRadius: '8px', color: '#dc2626' }}>\n                       dn seky nebyly nateny\n                    </div>\n                  ) : (\n                    <AresUsekGrid>\n                      {(canManageUsers ? availableUseky :\n                        availableUseky.filter(usek => usek.usek_zkr === userDetail?.usek_zkr)\n                      ).map((usek, index) => (\n                        <AresUsekItem\n                          key={usek.usek_zkr || index}\n                          selected={aresSelectedUseky.includes(usek.usek_zkr)}\n                          onClick={() => handleAresUsekToggle(usek.usek_zkr)}\n                        >\n                          <input\n                            type=\"checkbox\"\n                            checked={aresSelectedUseky.includes(usek.usek_zkr)}\n                            onChange={() => handleAresUsekToggle(usek.usek_zkr)}\n                          />\n                          {usek.usek_zkr}\n                        </AresUsekItem>\n                      ))}\n                    </AresUsekGrid>\n                  )}\n                  {aresSelectedUseky.length === 0 && !usekyLoading && availableUseky.length > 0 && (\n                    <div style={{ marginTop: '8px', padding: '8px', background: '#e0f2fe', border: '1px solid #0ea5e9', borderRadius: '6px', fontSize: '12px', color: '#0c4a6e' }}>\n                       Pokud nevyberete dn sek, kontakt se ulo jako osobn\n                    </div>\n                  )}\n                </div>\n              )}\n\n              <AresList>\n                {loadingAres ? (\n                  <AresLoadingSpinner>\n                    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" style={{ animation: 'spin 1s linear infinite' }}>\n                      <path d=\"M21 12a9 9 0 11-6.219-8.56\"/>\n                    </svg>\n                    <span style={{ marginLeft: '12px' }}>Vyhledvm v ARES...</span>\n                  </AresLoadingSpinner>\n                ) : aresResults.length > 0 ? (\n                  aresResults.map((aresItem, index) => {\n                    const isCurrentlySaving = savingToLocal === aresItem.ico;\n\n                    return (\n                      <AresItem key={index}>\n                        <AresItemContent\n                          hasButtons={true}\n                          onClick={() => handleAresSelect(aresItem)}\n                        >\n                          <div style={{ fontWeight: '600', color: '#111827', marginBottom: '8px' }}>\n                            {aresItem.nazev}\n                          </div>\n                          <div style={{ fontSize: '0.875rem', color: '#6b7280', marginBottom: '4px' }}>\n                            {aresItem.sidlo || aresItem.adresa}\n                          </div>\n                          <div style={{ fontSize: '0.875rem', color: '#6b7280' }}>\n                            IO: {aresItem.ico} {aresItem.dic && ` DI: ${aresItem.dic}`}\n                          </div>\n\n                          {/*  Scope indiktory */}\n                          {aresScopeInfo[aresItem.ico] && (\n                            aresScopeInfo[aresItem.ico].existsInGlobal ||\n                            aresScopeInfo[aresItem.ico].existsInUsek ||\n                            aresScopeInfo[aresItem.ico].existsInPersonal\n                          ) && (\n                            <AresScopeBadges>\n                              {aresScopeInfo[aresItem.ico].existsInGlobal && (\n                                <AresScopeBadge scope=\"global\">\n                                  <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                                    <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\n                                  </svg>\n                                  Globln\n                                </AresScopeBadge>\n                              )}\n                              {aresScopeInfo[aresItem.ico].existsInUsek && (\n                                <AresScopeBadge scope=\"usek\">\n                                  <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                                    <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\n                                  </svg>\n                                  sek\n                                </AresScopeBadge>\n                              )}\n                              {aresScopeInfo[aresItem.ico].existsInPersonal && (\n                                <AresScopeBadge scope=\"personal\">\n                                  <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                                    <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\n                                  </svg>\n                                  Osobn\n                                </AresScopeBadge>\n                              )}\n                            </AresScopeBadges>\n                          )}\n                        </AresItemContent>\n\n                        <AresItemButtons>\n                          <AresActionButton\n                            className=\"primary\"\n                            onClick={() => handleAresSelect(aresItem)}\n                          >\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                              <path d=\"M9 11l3 3L22 4\"/>\n                              <path d=\"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11\"/>\n                            </svg>\n                            Pout\n                          </AresActionButton>\n\n                          <AresActionButton\n                            className=\"success\"\n                            onClick={() => {\n                              //  Pout vybran scope namiesto hardcoded 'personal'\n                              const saveLocation = aresSelectedScope === 'usek'\n                                ? { scope: 'usek', useky: aresSelectedUseky }\n                                : aresSelectedScope;\n                              handleSaveToLocal(aresItem, saveLocation);\n                              handleAresSelect(aresItem);\n                            }}\n                            disabled={isCurrentlySaving || (aresSelectedScope === 'usek' && aresSelectedUseky.length === 0)}\n                            title={(aresSelectedScope === 'usek' && aresSelectedUseky.length === 0) ? \"Vyberte alespo jeden sek\" : \"\"}\n                          >\n                            {isCurrentlySaving ? (\n                              <>\n                                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" style={{ animation: 'spin 1s linear infinite' }}>\n                                  <path d=\"M21 12a9 9 0 11-6.219-8.56\"/>\n                                </svg>\n                                Ukldm...\n                              </>\n                            ) : (\n                              <>\n                                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                                  <path d=\"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z\"/>\n                                  <polyline points=\"17,21 17,13 7,13 7,21\"/>\n                                  <polyline points=\"7,3 7,8 15,8\"/>\n                                </svg>\n                                Pout + Uloit\n                              </>\n                            )}\n                          </AresActionButton>\n                        </AresItemButtons>\n                      </AresItem>\n                    );\n                  })\n                ) : aresSearch.length >= 2 ? (\n                  <div style={{\n                    textAlign: 'center',\n                    padding: '40px 20px',\n                    color: '#6b7280'\n                  }}>\n                    <p>V ARES nebyli nalezeni dn dodavatel.</p>\n                  </div>\n                ) : (\n                  <div style={{\n                    textAlign: 'center',\n                    padding: '40px 20px',\n                    color: '#6b7280'\n                  }}>\n                    <p>Zadejte alespo 2 znaky pro vyhledvn v ARES.</p>\n                  </div>\n                )}\n              </AresList>\n            </AresPopupContent>\n          </AresPopupModal>\n        </AresPopupOverlay>,\n        document.body\n      )}\n\n      {/* Modal pro uloen ablony */}\n      {showTemplateSaveModal && ReactDOM.createPortal(\n        <TemplateModalOverlay>\n          <TemplateModal onClick={(e) => e.stopPropagation()}>\n            <TemplateModalCloseButton\n              type=\"button\"\n              onClick={() => {\n                setShowTemplateSaveModal(false);\n                setTemplateName('');\n                setTemplateType('po');\n                setSaveMode('new');\n                setSelectedTargetTemplate(null);\n              }}\n            >\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n                <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n              </svg>\n            </TemplateModalCloseButton>\n\n            <TemplateModalHeader>\n              <TemplateModalTitle>\n                Uloit ablonu\n              </TemplateModalTitle>\n            </TemplateModalHeader>\n\n            <TemplateModalBody>\n              {/* Reim */}\n              <TemplateFormGroup>\n                <TemplateLabel>REIM</TemplateLabel>\n                <div style={{ display: 'flex', gap: '8px' }}>\n                  {[\n                    { value: 'new', label: ' Nov', disabled: false },\n                    { value: 'update', label: ' Aktualizovat', disabled: [...savedTemplates, ...serverTemplates].length === 0 },\n                    { value: 'merge', label: ' Slouit', disabled: [...savedTemplates, ...serverTemplates].length === 0 }\n                  ].map(option => (\n                    <label key={option.value} style={{\n                      flex: 1,\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      gap: '4px',\n                      padding: '10px 16px',\n                      borderRadius: '6px',\n                      border: `2px solid ${saveMode === option.value ? '#10b981' : '#e5e7eb'}`,\n                      backgroundColor: saveMode === option.value ? '#d1fae5' : 'white',\n                      cursor: option.disabled ? 'not-allowed' : 'pointer',\n                      opacity: option.disabled ? 0.5 : 1,\n                      fontSize: '0.875rem',\n                      fontWeight: '600',\n                      transition: 'all 0.2s'\n                    }}>\n                      <input\n                        type=\"radio\"\n                        name=\"saveMode\"\n                        value={option.value}\n                        checked={saveMode === option.value}\n                        onChange={(e) => setSaveMode(e.target.value)}\n                        disabled={option.disabled}\n                        style={{ display: 'none' }}\n                      />\n                      {option.label}\n                    </label>\n                  ))}\n                </div>\n              </TemplateFormGroup>\n\n              {/* Vbr existujc ablony (pro update/merge) */}\n              {(saveMode === 'update' || saveMode === 'merge') && (\n                <TemplateFormGroup>\n                  <TemplateLabel>VYBERTE ABLONU</TemplateLabel>\n                  <StableCustomSelect\n                    field=\"templateSelect\"\n                    value={selectedTargetTemplate?.id || selectedTargetTemplate?.ts || ''}\n                    onChange={(selectedValue) => {\n                      //  OPRAVA: StableCustomSelect posl hodnotu pmo, ne event!\n                      const allTemplates = [...savedTemplates, ...serverTemplates];\n                      const selected = allTemplates.find(t => (t.id || t.ts).toString() === String(selectedValue));\n                      setSelectedTargetTemplate(selected);\n                      if (saveMode === 'update' && selected) {\n                        setTemplateName(selected.name || '');\n                      }\n                    }}\n                    options={[...savedTemplates, ...serverTemplates]}\n                    placeholder=\"Vyberte ablonu...\"\n                    getOptionLabel={(option) => {\n                      const source = option.__fromServer ? 'server' : 'lokln';\n                      return `${option.name} (${source})`;\n                    }}\n                    getOptionValue={(option) => option.id || option.ts}\n                  />\n                </TemplateFormGroup>\n              )}\n\n              {/* Nzev ablony (pro new/merge) */}\n              {(saveMode === 'new' || saveMode === 'merge') && (\n                <TemplateFormGroup>\n                  <TemplateLabel>NZEV</TemplateLabel>\n                  <TemplateInput\n                    type=\"text\"\n                    value={templateName}\n                    onChange={(e) => setTemplateName(e.target.value)}\n                    placeholder={saveMode === 'merge' ? 'Nzev slouen ablony' : 'Nzev ablony'}\n                    autoFocus={saveMode === 'new'}\n                  />\n                </TemplateFormGroup>\n              )}\n\n              {/* Typ ablony - omezen podle fze */}\n              <TemplateFormGroup>\n                <TemplateLabel>TYP</TemplateLabel>\n                <div style={{ display: 'flex', gap: '8px' }}>\n                  {[\n                    { value: 'po', label: 'PO', disabled: false },\n                    { value: 'details', label: 'Detaily', disabled: !isArchived && currentPhase < 2 },\n                    { value: 'mixed', label: 'Ve', disabled: !isArchived && currentPhase < 2 }\n                  ].map(option => (\n                    <label key={option.value} style={{\n                      flex: 1,\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      padding: '10px 16px',\n                      borderRadius: '6px',\n                      border: `2px solid ${templateType === option.value ? '#3b82f6' : '#e5e7eb'}`,\n                      backgroundColor: templateType === option.value ? '#dbeafe' : 'white',\n                      cursor: option.disabled ? 'not-allowed' : 'pointer',\n                      opacity: option.disabled ? 0.4 : 1,\n                      fontSize: '0.875rem',\n                      fontWeight: '600',\n                      transition: 'all 0.2s'\n                    }}>\n                      <input\n                        type=\"radio\"\n                        name=\"templateType\"\n                        value={option.value}\n                        checked={templateType === option.value}\n                        onChange={(e) => setTemplateType(e.target.value)}\n                        disabled={option.disabled}\n                        style={{ display: 'none' }}\n                      />\n                      {option.label}\n                    </label>\n                  ))}\n                </div>\n                {(!isArchived && currentPhase < 2) && (\n                  <div style={{\n                    marginTop: '8px',\n                    padding: '8px 12px',\n                    backgroundColor: '#fef3c7',\n                    border: '1px solid #fbbf24',\n                    borderRadius: '6px',\n                    fontSize: '0.75rem',\n                    color: '#92400e'\n                  }}>\n                     Ve FZI 1 lze ukldat pouze <strong>PO</strong> (Pedbn objednvka). Detaily budou dostupn po schvlen.\n                  </div>\n                )}\n              </TemplateFormGroup>\n            </TemplateModalBody>\n\n            <TemplateModalActions>\n              <TemplateActionButton\n                type=\"button\"\n                variant=\"cancel\"\n                onClick={() => {\n                  setShowTemplateSaveModal(false);\n                  setTemplateName('');\n                  setTemplateType('po');\n                }}\n              >\n                Zruit\n              </TemplateActionButton>\n              <TemplateActionButton\n                type=\"button\"\n                variant=\"primary\"\n                onClick={async () => {\n                  if (!templateName.trim()) return;\n\n                  // Sestaven dat ablony podle fze a viditelnosti sekc\n                  const templateData = {};\n                  const visibility = getSectionVisibility(mainWorkflowState, currentPhase, isArchived);\n                  const fieldMap = getFieldsForSections();\n\n                  // PO st (vdy dostupn)\n                  if (templateType === 'po' || templateType === 'mixed') {\n                    templateData.poApproval = {\n                      predmet: formData.predmet || '',\n                      prikazce_id: formData.prikazce_id || '',\n                      max_cena_s_dph: formData.max_cena_s_dph || '',\n                      strediska_kod: formData.strediska_kod || '',\n                      garant_uzivatel_id: formData.garant_uzivatel_id || '',\n                      //  Financovn - pesunuto z FZE 3 do FZE 1, lze ukldat do PO ablony\n                      zpusob_financovani: formData.zpusob_financovani || '',\n                      lp_kod: formData.lp_kod || [],\n                      cislo_smlouvy: formData.cislo_smlouvy || '',\n                      smlouva_poznamka: formData.smlouva_poznamka || '',\n                      individualni_schvaleni: formData.individualni_schvaleni || '',\n                      individualni_poznamka: formData.individualni_poznamka || '',\n                      pojistna_udalost_cislo: formData.pojistna_udalost_cislo || '',\n                      pojistna_udalost_poznamka: formData.pojistna_udalost_poznamka || ''\n                    };\n                  }\n\n                  // Detailn st (pouze od FZE 3++ a z viditelnch sekc)\n                  if (templateType === 'details' || templateType === 'mixed') {\n                    if (currentPhase < 2) {\n                      showToast?.('Nelze uloit Detaily ve FZI 1. Pouijte typ \"PO\".', 'warning');\n                      return;\n                    }\n\n                    templateData.orderDetails = {};\n\n                    // Naplnit pouze pole z viditelnch sekc\n                    Object.entries(fieldMap).forEach(([sectionKey, fields]) => {\n                      const isSectionVisible = sectionKey === 'polozky' ? visibility.detaily : visibility[sectionKey];\n\n                      if (isSectionVisible) {\n                        fields.forEach(field => {\n                          if (field !== 'polozky_objednavky' && formData[field] !== undefined) {\n                            templateData.orderDetails[field] = formData[field] || '';\n                          }\n                        });\n                      }\n                    });\n\n                    // Poloky objednvky (pokud je sekce detaily viditeln)\n                    if (visibility.detaily && Array.isArray(formData.polozky_objednavky) && formData.polozky_objednavky.length > 0) {\n                      templateData.polozky = formData.polozky_objednavky.map(item => ({\n                        popis: item.popis || '',\n                        cena_bez_dph: item.cena_bez_dph || '',\n                        sazba_dph: item.sazba_dph || 21,\n                        cena_s_dph: item.cena_s_dph || ''\n                      }));\n                    }\n                  }\n\n                  if (saveMode === 'new') {\n                    // Nov ablona\n                    await saveTemplateToStorage(templateName.trim(), templateData, templateType);\n                  } else if (saveMode === 'update') {\n                    // Aktualizace existujc ablony\n                    if (selectedTargetTemplate.__fromServer) {\n                      // Serverov ablona - aktualizace pes API\n                      try {\n                        const polozky_po = (templateType === 'po' || templateType === 'mixed') && templateData.poApproval\n                          ? JSON.stringify(templateData.poApproval)\n                          : '';\n                        const polozky_detail = (templateType === 'details' || templateType === 'mixed') && templateData.orderDetails\n                          ? JSON.stringify(templateData.orderDetails)\n                          : '';\n\n                        const result = await updateTemplate({\n                          username: user?.username || username,\n                          token,\n                          user_id: selectedTargetTemplate.user_id || 0,\n                          id: selectedTargetTemplate.id,\n                          nazev_sablony: selectedTargetTemplate.name,\n                          polozky_po,\n                          polozky_detail,\n                          typ: templateType,\n                          kategorie: \"OBJEDNAVKA25\"\n                        });\n\n                        if (result?.status === 'ok') {\n                          await fetchAndMergeTemplates();\n                          if (showToast) {\n                            showToast(`ablona \"${selectedTargetTemplate.name}\" byla aktualizovna`, { type: 'success' });\n                          }\n                        }\n                      } catch (error) {\n                        if (showToast) {\n                          showToast('Chyba pi aktualizaci ablony na serveru', { type: 'error' });\n                        }\n                      }\n                    } else {\n                      // Lokln ablona - aktualizace v localStorage\n                      setSavedTemplates(prev => prev.map(template =>\n                        template.ts === selectedTargetTemplate.ts\n                          ? { ...template, data: templateData, type: templateType }\n                          : template\n                      ));\n                      if (showToast) {\n                        showToast(`ablona \"${selectedTargetTemplate.name}\" byla aktualizovna`, { type: 'success' });\n                      }\n                    }\n                  } else if (saveMode === 'merge') {\n                    // Slouen s existujc ablonou\n                    const mergedData = { ...selectedTargetTemplate.data };\n                    if (templateData.poApproval) {\n                      mergedData.poApproval = { ...mergedData.poApproval, ...templateData.poApproval };\n                    }\n                    if (templateData.orderDetails) {\n                      mergedData.orderDetails = { ...mergedData.orderDetails, ...templateData.orderDetails };\n                      // Slouit poloky\n                      if (templateData.orderDetails.polozky?.length > 0) {\n                        mergedData.orderDetails.polozky = [\n                          ...(mergedData.orderDetails.polozky || []),\n                          ...templateData.orderDetails.polozky\n                        ];\n                      }\n                    }\n\n                    await saveTemplateToStorage(templateName.trim(), mergedData, 'mixed');\n                    if (showToast) {\n                      showToast(`ablona \"${templateName}\" byla vytvoena slouenm`, { type: 'success' });\n                    }\n                  }\n\n                  setShowTemplateSaveModal(false);\n                  setTemplateName('');\n                  setTemplateType('po');\n                  setSaveMode('new');\n                  setSelectedTargetTemplate(null);\n                }}\n                disabled={\n                  (saveMode === 'new' && !templateName.trim()) ||\n                  ((saveMode === 'update' || saveMode === 'merge') && !selectedTargetTemplate) ||\n                  (saveMode === 'merge' && !templateName.trim())\n                }\n              >\n                {saveMode === 'new' ? ' Uloit' :\n                 saveMode === 'update' ? ' Aktualizovat' :\n                 ' Slouit'}\n              </TemplateActionButton>\n            </TemplateModalActions>\n          </TemplateModal>\n        </TemplateModalOverlay>,\n        document.body\n      )}\n\n      {/* Modal pro potvrzen mazn ablony */}\n      {showDeleteTemplateConfirm && ReactDOM.createPortal(\n        <DeleteConfirmOverlay onClick={(e) => { if (e.target === e.currentTarget) cancelDeleteSavedTemplate(); }}>\n          <DeleteConfirmModal onClick={(e) => e.stopPropagation()}>\n            <DeleteConfirmTitle>\n              Potvrdit smazn ablony\n            </DeleteConfirmTitle>\n            <DeleteConfirmMessage>\n              Opravdu chcete smazat ablonu <strong>\"{templatePendingDelete?.name}\"</strong>?\n              <br /><br />\n              Tato akce je nevratn.\n            </DeleteConfirmMessage>\n            <DeleteConfirmActions>\n              <DeleteConfirmButton onClick={cancelDeleteSavedTemplate}>\n                Zruit\n              </DeleteConfirmButton>\n              <DeleteConfirmButton variant=\"danger\" onClick={confirmDeleteSavedTemplate}>\n                Smazat\n              </DeleteConfirmButton>\n            </DeleteConfirmActions>\n          </DeleteConfirmModal>\n        </DeleteConfirmOverlay>,\n        document.body\n      )}\n\n      {/* Template Preview Modal */}\n      {previewModalData && ReactDOM.createPortal(\n        <PreviewModal onClick={() => setPreviewModalData(null)}>\n          <PreviewContent onClick={e => e.stopPropagation()}>\n            <PreviewHeader>\n              <PreviewTitle>\n                <Eye size={20} />\n                Nhled ablony\n              </PreviewTitle>\n              <PreviewCloseButton onClick={() => setPreviewModalData(null)}>\n                <X size={18} />\n              </PreviewCloseButton>\n            </PreviewHeader>\n\n            {/* Template Info */}\n            <PreviewSection>\n              <PreviewSectionTitle>\n                <FileText size={16} />\n                Informace o ablon\n              </PreviewSectionTitle>\n              <PreviewField>\n                <PreviewFieldLabel>Nzev:</PreviewFieldLabel>\n                <PreviewFieldValue>{previewModalData.preview.templateInfo.name}</PreviewFieldValue>\n              </PreviewField>\n              <PreviewField>\n                <PreviewFieldLabel>Typ:</PreviewFieldLabel>\n                <PreviewFieldValue>\n                  <PreviewBadge type={previewModalData.preview.templateInfo.type}>\n                    {previewModalData.preview.templateInfo.type === 'po' ? 'Schvlen' :\n                     previewModalData.preview.templateInfo.type === 'details' ? 'Detaily' : 'Kombinovan'}\n                  </PreviewBadge>\n                </PreviewFieldValue>\n              </PreviewField>\n              <PreviewField>\n                <PreviewFieldLabel>Vytvoena:</PreviewFieldLabel>\n                <PreviewFieldValue>{previewModalData.preview.templateInfo.created}</PreviewFieldValue>\n              </PreviewField>\n              <PreviewField>\n                <PreviewFieldLabel>Dostupnost:</PreviewFieldLabel>\n                <PreviewFieldValue>\n                  {previewModalData.preview.templateInfo.isGlobal ? 'Globln kontakt' : 'Osobn kontakt'}\n                </PreviewFieldValue>\n              </PreviewField>\n            </PreviewSection>\n\n            {/* PO Approval Section */}\n            {previewModalData.preview.poApproval && (\n              <PreviewSection>\n                <PreviewSectionTitle>\n                  <CheckCircle size={16} />\n                  Schvlen nkupu\n                </PreviewSectionTitle>\n                {previewModalData.preview.poApproval.predmet && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Pedmt:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.poApproval.predmet}</PreviewFieldValue>\n                  </PreviewField>\n                )}\n                {previewModalData.preview.poApproval.maxCena && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Max. cena s DPH:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.poApproval.maxCena} K</PreviewFieldValue>\n                  </PreviewField>\n                )}\n                {previewModalData.preview.poApproval.popisPozadavku && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Popis poadavku:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.poApproval.popisPozadavku}</PreviewFieldValue>\n                  </PreviewField>\n                )}\n                {previewModalData.preview.poApproval.strediska.length > 0 && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Stediska:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.poApproval.strediska.length} vybrno</PreviewFieldValue>\n                  </PreviewField>\n                )}\n              </PreviewSection>\n            )}\n\n            {/* Order Details Section */}\n            {previewModalData.preview.orderDetails && (\n              <PreviewSection>\n                <PreviewSectionTitle>\n                  <Package size={16} />\n                  Detaily objednvky\n                </PreviewSectionTitle>\n                {previewModalData.preview.orderDetails.dodavatelNazev && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Dodavatel:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.orderDetails.dodavatelNazev}</PreviewFieldValue>\n                  </PreviewField>\n                )}\n                {previewModalData.preview.orderDetails.dodavatelIco && (\n                  <PreviewField>\n                    <PreviewFieldLabel>IO:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.orderDetails.dodavatelIco}</PreviewFieldValue>\n                  </PreviewField>\n                )}\n                {previewModalData.preview.orderDetails.zpusobFinancovani && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Financovn:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.orderDetails.zpusobFinancovani}</PreviewFieldValue>\n                  </PreviewField>\n                )}\n                {previewModalData.preview.orderDetails.datumDodani && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Datum dodn:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.orderDetails.datumDodani}</PreviewFieldValue>\n                  </PreviewField>\n                )}\n                {previewModalData.preview.orderDetails.poznamka && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Poznmka:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.orderDetails.poznamka}</PreviewFieldValue>\n                  </PreviewField>\n                )}\n              </PreviewSection>\n            )}\n\n            {/* Items Section */}\n            {previewModalData.preview.items.length > 0 && (\n              <PreviewSection>\n                <PreviewSectionTitle>\n                  <ShoppingCart size={16} />\n                  Poloky ({previewModalData.preview.items.length})\n                </PreviewSectionTitle>\n                <PreviewItemsList>\n                  {previewModalData.preview.items.slice(0, 5).map((item, index) => (\n                    <PreviewItem key={index}>\n                      <PreviewItemTitle>\n                        {item.index}. {item.popis || 'Bez popisu'}\n                      </PreviewItemTitle>\n                      <PreviewItemDetails>\n                        <span>{item.pocet} {item.cenaJednotka} K/{item.jednotka || 'ks'}</span>\n                        <strong>{item.cenaTotal.toLocaleString('cs-CZ')} K</strong>\n                      </PreviewItemDetails>\n                    </PreviewItem>\n                  ))}\n                  {previewModalData.preview.items.length > 5 && (\n                    <PreviewEmptyState>\n                      ... a dalch {previewModalData.preview.items.length - 5} poloek\n                    </PreviewEmptyState>\n                  )}\n                  {previewModalData.preview.items.length > 0 && (\n                    <PreviewField style={{ marginTop: '0.75rem', paddingTop: '0.75rem', borderTop: '2px solid #f3f4f6' }}>\n                      <PreviewFieldLabel>Celkov cena:</PreviewFieldLabel>\n                      <PreviewFieldValue style={{ fontWeight: 'bold', color: '#059669' }}>\n                        {previewModalData.preview.items.reduce((sum, item) => sum + item.cenaTotal, 0).toLocaleString('cs-CZ')} K\n                      </PreviewFieldValue>\n                    </PreviewField>\n                  )}\n                </PreviewItemsList>\n              </PreviewSection>\n            )}\n\n            {/* Empty State */}\n            {!previewModalData.preview.poApproval && !previewModalData.preview.orderDetails && previewModalData.preview.items.length === 0 && (\n              <PreviewEmptyState>\n                Tato ablona neobsahuje dn data\n              </PreviewEmptyState>\n            )}\n          </PreviewContent>\n        </PreviewModal>,\n        document.body\n      )}\n\n      {/* Cancel Confirm Modal - GRADIENT-MODERN ORANGE style */}\n      <ConfirmDialog\n        isOpen={showCancelConfirmModal}\n        onClose={handleCancelCancel}\n        onConfirm={handleCancelConfirm}\n        title=\"Zavt formul\"\n        icon={faExclamationTriangle}\n        variant=\"warning\"\n        confirmText=\"Ano, zavt\"\n        cancelText=\"Ne, zstat\"\n      >\n        {cancelWarningMessage || 'Koncept bude zruen a neuloen zmny nebudou uloeny.'}\n      </ConfirmDialog>\n\n    {/*  Confirm Dialog pro smazn plohy - GRADIENT-MODERN RED */}\n    <ConfirmDialog\n      isOpen={showDeleteAttachmentDialog}\n      onClose={handleCancelDeleteAttachment}\n      onConfirm={handleConfirmDeleteAttachment}\n      title=\"Smazat plohu\"\n      icon={faTrash}\n      variant=\"danger\"\n      confirmText=\"Ano, smazat\"\n      cancelText=\"Zruit\"\n    >\n      <p>Opravdu chcete smazat <strong>\"{attachmentToDelete?.attachment?.name || 'tento soubor'}\"</strong>?</p>\n      {attachmentToDelete?.isFromServer && (\n        <p style={{ \n          background: 'linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%)', \n          padding: '0.75rem', \n          borderRadius: '6px', \n          border: '1px solid rgba(239, 68, 68, 0.2)',\n          color: '#991b1b',\n          fontSize: '0.9rem',\n          margin: '0.75rem 0' \n        }}>\n          <strong> Pozor:</strong> Po smazn ji nebude mon soubor obnovit.\n        </p>\n      )}\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro smazn VECH ploh - GRADIENT-MODERN RED */}\n    <ConfirmDialog\n      isOpen={showDeleteAllAttachmentsDialog}\n      onClose={handleCancelDeleteAllAttachments}\n      onConfirm={handleConfirmDeleteAllAttachments}\n      title=\"Smazat vechny plohy\"\n      icon={faTrash}\n      variant=\"danger\"\n      confirmText=\"Ano, smazat ve\"\n      cancelText=\"Zruit\"\n    >\n      <p>Opravdu chcete smazat <strong>vechny plohy ({attachments.length} soubor)</strong>?</p>\n      <p style={{ \n        background: 'linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%)', \n        padding: '0.75rem', \n        borderRadius: '6px', \n        border: '1px solid rgba(239, 68, 68, 0.2)',\n        color: '#991b1b',\n        fontSize: '0.9rem',\n        margin: '0.75rem 0' \n      }}>\n        <strong> Pozor:</strong> Tato akce odstran vechny nahran soubory. Operaci nelze vrtit zpt.\n      </p>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro smazn faktury - GRADIENT-MODERN RED */}\n    <ConfirmDialog\n      isOpen={deleteFacturaDialog.isOpen}\n      onClose={() => setDeleteFacturaDialog({ isOpen: false, fakturaId: null, fakturaNazev: '', pocetPriloh: 0 })}\n      onConfirm={confirmDeleteFaktura}\n      title=\"Smazat fakturu\"\n      icon={faTrash}\n      variant=\"danger\"\n      confirmText=\"Smazat\"\n      cancelText=\"Zruit\"\n    >\n      <p>Opravdu chcete smazat fakturu <strong>\"{deleteFacturaDialog.fakturaNazev}\"</strong>?</p>\n      {deleteFacturaDialog.pocetPriloh > 0 && (\n        <p style={{ background: '#fee2e2', padding: '0.75rem', borderRadius: '6px', border: '1px solid #ef4444', margin: '0.75rem 0' }}>\n          <strong> POZOR:</strong> Faktura m <strong>{deleteFacturaDialog.pocetPriloh} plohu/ploh</strong>, kter budou tak smazny!\n        </p>\n      )}\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro odemen FZE 1 sekc - GRADIENT-MODERN RED */}\n    <ConfirmDialog\n      isOpen={showUnlockPhase1Confirm}\n      onClose={() => setShowUnlockPhase1Confirm(false)}\n      onConfirm={() => {\n        setShowUnlockPhase1Confirm(false);\n        handleResetToPhase1();\n      }}\n      title=\" Odemknout FZI 2 (Info o objednateli)\"\n      icon={faExclamationTriangle}\n      variant=\"danger\"\n      confirmText=\"ANO, ODEMKNOUT A SMAZAT\"\n      cancelText=\"Zruit\"\n    >\n      <p style={{ background: '#fee2e2', padding: '0.75rem', borderRadius: '6px', border: '1px solid #ef4444', margin: '0.75rem 0' }}>\n        <strong> VAROVN:</strong> Odemen FZE 2 vymae <strong>vechna data vych fz (FZE 3-10)</strong>!\n      </p>\n      <p>Workflow se resetuje na stav <strong>ODESLNA KE SCHVLEN</strong>.</p>\n      <p><strong>Opravdu chcete pokraovat?</strong></p>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro odemen zamtnut objednvky */}\n    <ConfirmDialog\n      isOpen={showUnlockPhase2Confirm}\n      onClose={() => setShowUnlockPhase2Confirm(false)}\n      onConfirm={() => {\n        setShowUnlockPhase2Confirm(false);\n        handleResetToPhase3Sections();\n      }}\n      title=\"Odemknout zamtnutou objednvku\"\n      icon={faExclamationTriangle}\n      variant=\"danger\"\n      confirmText=\"Ano, odemknout\"\n      cancelText=\"Zruit\"\n    >\n      <p>Opravdu chcete odemknout zamtnutou objednvku?</p>\n      <p style={{ marginTop: '0.5rem', color: '#dc2626' }}>\n        <strong> UPOZORNN:</strong> Objednvka bude odemena a zpstupnna pro dal prbh workflow.\n      </p>\n      <p style={{ marginTop: '0.5rem' }}>\n        Budete moci provst potebn pravy a objednvku znovu odeslat ke schvlen.\n      </p>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro odemen FZE 3 sekce */}\n    <ConfirmDialog\n      isOpen={showUnlockPhase3Confirm}\n      onClose={() => setShowUnlockPhase3Confirm(false)}\n      onConfirm={() => {\n        setShowUnlockPhase3Confirm(false);\n        handleResetToPhase3Workflow(); //  Reset workflow + vymazn dat + uloen do DB\n      }}\n      title=\" Odemknout FZE 3\"\n      icon={faExclamationTriangle}\n      variant=\"danger\"\n      confirmText=\"ANO, ODEMKNOUT A SMAZAT\"\n      cancelText=\"Zruit\"\n    >\n      <div style={{\n        display: 'flex',\n        gap: '12px',\n        padding: '12px',\n        backgroundColor: 'rgba(239, 68, 68, 0.1)',\n        border: '1px solid rgba(239, 68, 68, 0.3)',\n        borderRadius: '6px',\n        marginBottom: '1rem'\n      }}>\n        <FontAwesomeIcon icon={faExclamationTriangle} style={{ color: '#ef4444', fontSize: '20px', marginTop: '2px' }} />\n        <div>\n          <strong>Varovn:</strong> Odemen FZE 3 vymae vechna data vych fz (FZE 4-10)!\n        </div>\n      </div>\n      <p>\n        Workflow se resetuje na stav <strong>ODESLNA</strong>.\n      </p>\n      <p style={{ marginTop: '0.5rem' }}>\n        Opravdu chcete pokraovat?\n      </p>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro odemen sekce Registr smluv */}\n    <ConfirmDialog\n      isOpen={showUnlockRegistrConfirm}\n      onClose={() => setShowUnlockRegistrConfirm(false)}\n      onConfirm={() => {\n        setShowUnlockRegistrConfirm(false);\n        workflowManager.unlockSection('registr_vyplneni'); //  Odemknout sekci vyplnn registru (FZE 5)\n\n        //  Nastavit workflow na FZI 5 - UVEREJNIT\n        const currentStates = Array.isArray(formData.stav_workflow_kod)\n          ? formData.stav_workflow_kod\n          : (formData.stav_workflow_kod ? [formData.stav_workflow_kod] : []);\n\n        // Odebrat UVEREJNENA (pokud existuje) a pidat UVEREJNIT\n        const updatedStates = currentStates.filter(s => s !== 'UVEREJNENA');\n        if (!updatedStates.includes('UVEREJNIT')) {\n          updatedStates.push('UVEREJNIT');\n        }\n\n        // Ujistit se, e jsou tam zkladn stavy pro FZI 5\n        if (!updatedStates.includes('ODESLANA')) updatedStates.push('ODESLANA');\n        if (!updatedStates.includes('POTVRZENA')) updatedStates.push('POTVRZENA');\n\n        setFormData(prev => ({\n          ...prev,\n          stav_workflow_kod: updatedStates\n        }));\n\n        addDebugLog('info', 'UNLOCK', 'registr-vyplneni', 'Odemena sekce Registr smluv - nastaveno UVEREJNIT (FZE 5)');\n\n        // Okamit uloen\n        setTimeout(() => {\n          triggerAutosave(true);\n        }, 100);\n      }}\n      title=\"Odemknout sekci Registr smluv\"\n      icon={faExclamationTriangle}\n      variant=\"danger\"\n      confirmText=\"Odemknout\"\n      cancelText=\"Zruit\"\n    >\n      <p>\n        Opravdu chcete odemknout sekci <strong>Registr smluv</strong> pro editaci?\n      </p>\n      <p style={{ marginTop: '0.5rem' }}>\n        Workflow se nastav na FZI 5 se stavem <strong>UVEREJNIT</strong>.\n      </p>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro odemen sekce Potvrzen od dodavatele */}\n    <ConfirmDialog\n      isOpen={showUnlockPotvrzeniConfirm}\n      title=\"Odemknout sekci Potvrzen od dodavatele\"\n      confirmText=\"Ano, odemknout\"\n      cancelText=\"Zruit\"\n      variant=\"warning\"\n      icon={faExclamationTriangle}\n      onConfirm={() => {\n        setShowUnlockPotvrzeniConfirm(false);\n        workflowManager.unlockSection('potvrzeni');\n        workflowManager.unlockSection('registr'); //  Tak odemknout sekci Registr smluv\n\n        //  Vrtit workflow na ODESLANA (FZE 4)\n        const { updatedFormData } = workflowManager.unlockPhase4();\n        setFormData(updatedFormData);\n\n        resetHigherPhaseCheckboxes('potvrzeni'); // Reset vych checkbox\n\n        // Okamit uloen\n        setTimeout(() => {\n          triggerAutosave(true);\n        }, 100);\n      }}\n      onClose={() => setShowUnlockPotvrzeniConfirm(false)}\n    >\n      <p>Opravdu chcete odemknout sekci <strong>Potvrzen od dodavatele</strong> pro editaci?</p>\n      <p style={{ marginTop: '0.5rem' }}>\n        Zrove bude odemena i sekce <strong>Registr smluv</strong> a workflow se vrt na stav <strong>ODESLNA (FZE 4)</strong>.\n      </p>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro zruen zveejnn */}\n    <ConfirmDialog\n      isOpen={showCancelPublishConfirm}\n      title=\"Zruit zveejnn v registru smluv\"\n      confirmText=\"Ano, odkrtnout\"\n      cancelText=\"Ne, ponechat zakrtnut\"\n      variant=\"danger\"\n      icon={faExclamationTriangle}\n      onConfirm={() => {\n        setShowCancelPublishConfirm(false);\n        handleInputChange('ma_byt_zverejnena', false);\n        handleInputChange('dt_zverejneni', '');\n        handleInputChange('registr_iddt', '');\n        handleInputChange('zverejnil_id', null);\n        addDebugLog('info', 'REGISTR', 'zrusit-zverejneni', 'Zruena povinnost zveejnn');\n      }}\n      onClose={() => setShowCancelPublishConfirm(false)}\n    >\n      <div>\n        <p style={{ marginBottom: '1rem' }}>\n          Celkov cena objednvky je <strong>{celkovaCenaBezDPH.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K bez DPH</strong>, co je nad limitem 50 000 K.\n        </p>\n        <p style={{\n          fontSize: '0.95rem',\n          color: '#dc2626',\n          fontWeight: '600',\n          marginBottom: '0.75rem',\n          padding: '0.75rem',\n          backgroundColor: '#fee2e2',\n          borderRadius: '6px',\n          border: '1px solid #fca5a5'\n        }}>\n           Podle zkona mus bt objednvka zveejnna v registru smluv.\n        </p>\n        <p style={{\n          fontSize: '0.9rem',\n          color: '#6b7280',\n          marginBottom: '0.5rem'\n        }}>\n          Opravdu chcete odkrtnout checkbox? Tato akce vymae vyplnn daje:\n        </p>\n        <ul style={{\n          fontSize: '0.9rem',\n          color: '#374151',\n          paddingLeft: '1.5rem',\n          margin: 0\n        }}>\n          <li>Datum zveejnn</li>\n          <li>Identifiktor</li>\n          <li>Zveejnil (uivatel)</li>\n        </ul>\n      </div>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro odemen sekce Fakturace */}\n    <ConfirmDialog\n      isOpen={showUnlockFakturaceConfirm}\n      title=\"Odemknout sekci Fakturace\"\n      confirmText=\"Odemknout\"\n      variant=\"warning\"\n      onConfirm={() => {\n        setShowUnlockFakturaceConfirm(false);\n        workflowManager.unlockSection('fakturace');\n\n        //  Odebrat FAKTURACE + VE CO NSLEDUJE  nvrat na FZI 6\n        const currentStates = Array.isArray(formData.stav_workflow_kod)\n          ? formData.stav_workflow_kod\n          : (formData.stav_workflow_kod ? [formData.stav_workflow_kod] : []);\n\n        // Odebrat FAKTURACE a vechny vy stavy\n        const updatedStates = currentStates.filter(s =>\n          !['FAKTURACE', 'VECNA_SPRAVNOST', 'ZKONTROLOVANA', 'DOKONCENA'].includes(s)\n        );\n\n        setFormData(prev => ({\n          ...prev,\n          stav_workflow_kod: updatedStates\n        }));\n\n        addDebugLog('info', 'UNLOCK', 'fakturace', 'Odemena sekce Fakturace - odebrny stavy FAKTURACE, KONTROLA, ZKONTROLOVANA, DOKONCENA  FZE 6/8');\n\n        //  Reset vych checkbox\n        resetHigherPhaseCheckboxes('fakturace');\n\n        // Okamit uloen\n        setTimeout(() => {\n          triggerAutosave(true);\n        }, 100);\n      }}\n      onClose={() => setShowUnlockFakturaceConfirm(false)}\n    >\n      <p>Opravdu chcete odemknout sekci <strong>Fakturace</strong> pro editaci?</p>\n      <p style={{ marginTop: '0.5rem', color: '#dc2626' }}>\n        Budou odebrny stavy <strong>FAKTURACE, VECNA_SPRAVNOST, ZKONTROLOVANA, DOKONCENA</strong> a workflow se vrt na <strong>FZI 6/8</strong>.\n      </p>\n    </ConfirmDialog>\n\n    {/*  DISABLED: Confirm Dialog pro odemen sekce Vcn sprvnost - ji nen poteba */}\n\n    {/*  Confirm Dialog pro odemen Dokonen objednvky (pro ORDER_MANAGE) */}\n    <ConfirmDialog\n      isOpen={showUnlockDokonceniConfirm}\n      title=\"Odemknout dokonenou objednvku\"\n      confirmText=\"Ano, odemknout\"\n      cancelText=\"Zruit\"\n      variant=\"warning\"\n      icon={faExclamationTriangle}\n      onConfirm={() => {\n        setShowUnlockDokonceniConfirm(false);\n\n        addDebugLog('info', 'UNLOCK', 'dokonceni', ' Dokonen objednvka odemena');\n\n\n        //  Upravit workflow: odebrat DOKONCENA, zachovat ve ostatn\n        const currentWorkflow = formData.stav_workflow_kod || '';\n        let workflowArray;\n        \n        if (Array.isArray(currentWorkflow)) {\n          workflowArray = [...currentWorkflow];\n        } else {\n          workflowArray = String(currentWorkflow).split(',').map(s => s.trim()).filter(s => s);\n        }\n        \n        // Odebrat pouze DOKONCENA\n        workflowArray = workflowArray.filter(s => s !== 'DOKONCENA');\n        \n        // Zajistit ZKONTROLOVANA\n        if (!workflowArray.includes('ZKONTROLOVANA')) {\n          workflowArray.push('ZKONTROLOVANA');\n        }\n\n\n        //  Nastavit nov state\n        setFormData(prev => ({\n          ...prev,\n          potvrzeni_dokonceni_objednavky: 0,\n          vecna_spravnost_potvrzeno: 1,\n          stav_workflow_kod: workflowArray\n        }));\n\n        //  VEKER ODEMEN PES WORKFLOW MANAGER\n        workflowManager.unlockSection('dokonceni');\n        workflowForceRefresh(); // Force pepoet vech sekc a stav\n\n        addDebugLog('info', 'UNLOCK', 'completed', ` Objednvka odemena (workflow manager refresh)`);\n      }}\n      onClose={() => setShowUnlockDokonceniConfirm(false)}\n    >\n      <p>Opravdu chcete odemknout dokonenou objednvku?</p>\n      <p style={{ marginTop: '0.5rem', color: '#16a34a' }}>\n        <strong> UPOZORNN:</strong> Objednvka bude zpstupnna k pravm a opravm.\n      </p>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro odemknut stornovan objednvky */}\n    <ConfirmDialog\n      isOpen={showUnlockStornoConfirm}\n      title=\"Odemknout stornovanou objednvku\"\n      confirmText=\"Ano, odemknout\"\n      cancelText=\"Zruit\"\n      variant=\"danger\"\n      icon={faExclamationTriangle}\n      onConfirm={async () => {\n        setShowUnlockStornoConfirm(false);\n        \n        addDebugLog('info', 'UNLOCK', 'cancelled', ` Odemykm stornovanou objednvku ID: ${formData.id}`);\n        \n        // Odebrat ZRUSENA stav z workflow\n        const updatedWorkflow = (formData.stav_workflow_kod || '')\n          .split(',')\n          .filter(s => s.trim() !== 'ZRUSENA')\n          .join(',');\n        \n        // Vymazat storno data\n        const clearedData = {\n          ...formData,\n          stav_workflow_kod: updatedWorkflow,\n          storno_duvod: null,\n          storno_user_id: null,\n          dt_storno: null,\n          stav_stornovano: 0\n        };\n        \n        // Uloit do DB pes useWorkflowManager\n        await workflowManager.unlockSection('storno');\n        \n        // Force update form data\n        setFormData(clearedData);\n        workflowForceRefresh();\n        \n        addDebugLog('info', 'UNLOCK', 'cancelled', ` Stornovan objednvka odemena, workflow refresh dokonen`);\n      }}\n      onClose={() => setShowUnlockStornoConfirm(false)}\n    >\n      <p>Opravdu chcete odemknout stornovanou objednvku?</p>\n      <p style={{ marginTop: '0.5rem', color: '#16a34a' }}>\n        <strong> UPOZORNN:</strong> Objednvka bude odemena a zpstupnna pro dal prbh workflow.\n      </p>\n      <p style={{ marginTop: '0.5rem' }}>\n        Budete moci provst potebn pravy nebo opravy.\n      </p>\n    </ConfirmDialog>\n\n    {/*  Univerzln Confirm Dialog (pro Phase unlock handlery) */}\n    {confirmDialog.isOpen && (\n      <ConfirmDialog\n        isOpen={confirmDialog.isOpen}\n        title={confirmDialog.title}\n        message={confirmDialog.message}\n        confirmText=\"Ano, odemknout\"\n        cancelText=\"Zruit\"\n        variant=\"danger\"\n        icon={faExclamationTriangle}\n        onConfirm={() => {\n          if (confirmDialog.onConfirm) {\n            confirmDialog.onConfirm();\n          }\n          setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null });\n        }}\n        onClose={() => setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null })}\n      />\n    )}\n\n    {/*  Dialog pro pidn dodavatele do adrese */}\n    <SupplierAddDialog\n      isOpen={showSupplierAddDialog}\n      onClose={() => {\n        setShowSupplierAddDialog(false);\n        setExistingSupplierCheck(null);\n      }}\n      onSave={handleSaveSupplierToDirectory}\n      supplierData={{\n        dodavatel_nazev: formData.dodavatel_nazev,\n        dodavatel_adresa: formData.dodavatel_adresa,\n        dodavatel_ico: formData.dodavatel_ico,\n        dodavatel_dic: formData.dodavatel_dic,\n        dodavatel_zastoupeny: formData.dodavatel_zastoupeny,\n        dodavatel_kontakt_jmeno: formData.dodavatel_kontakt_jmeno,\n        dodavatel_kontakt_email: formData.dodavatel_kontakt_email,\n        dodavatel_kontakt_telefon: formData.dodavatel_kontakt_telefon\n      }}\n      existsInPersonal={existingSupplierCheck?.existsInPersonal || null}\n      existsInUsek={existingSupplierCheck?.existsInUsek || null}\n      existsInGlobal={existingSupplierCheck?.existsInGlobal || null}\n      userPermissions={{\n        canAddPersonal: hasPermission && (hasPermission('CONTACT_MANAGE') || hasPermission('CONTACT_EDIT')), // CONTACT_MANAGE nebo CONTACT_EDIT\n        canAddUsek: hasPermission && (hasPermission('CONTACT_MANAGE') || hasPermission('CONTACT_EDIT')), // CONTACT_MANAGE nebo CONTACT_EDIT pro sv seky\n        canAddGlobal: hasPermission && hasPermission('CONTACT_MANAGE') // Pouze CONTACT_MANAGE\n      }}\n    />\n\n    {/*  Modern Sponka helper - kontextov npovda pro formul objednvky */}\n    {hasPermission('HELPER_VIEW') && (\n      <ModernHelper\n        pageContext=\"orderDetail\"\n      />\n    )}\n\n    {/*  DOCX Generator Modal */}\n    {docxModalOpen && (\n      <DocxGeneratorModal\n        order={docxModalOrder}\n        isOpen={docxModalOpen}\n        onClose={handleDocxModalClose}\n      />\n    )}\n\n    {/*  Save Overlay - rozmae zbytek strnky pi ukldn (krom hlaviky s progress barem) */}\n    {(showSaveProgress || isSaving) && (\n      <SaveOverlay $visible={true} />\n    )}\n\n    </Container>\n  );\n\n  // Pokud je fullscreen, pout React Portal pro vykreslen mimo app strukturu\n  if (isFullscreen) {\n    return ReactDOM.createPortal(formContent, document.body);\n  }\n\n  // Normln render\n  return formContent;\n}\n\n// Obal OrderForm25 v React.memo() pro optimalizaci re-render\n// Zabrauje zbytenm re-renderm kdy se props nemn\nexport default React.memo(OrderForm25);\n\n// ========================================\n// NOV STABILN CUSTOM SELECT KOMPONENTY\n// ========================================\n\n// Nov styled komponenty pro stabiln custom select\nconst StableSelectWrapper = styled.div`\n  position: relative;\n  width: 100%;\n`;\n\nconst StableSelectButton = styled.button`\n  width: 100%;\n  min-height: 2.5rem;\n  padding: 0.75rem 3rem 0.75rem ${props => props.hasIcon ? '3rem' : '1rem'};\n  background: white;\n  border: 2px solid ${props => props.hasError ? '#dc2626' : props.isOpen ? '#3b82f6' : '#e5e7eb'};\n  border-radius: 8px;\n  font-size: 0.875rem;\n  text-align: left;\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  font-family: inherit;\n  font-weight: ${props => props.disabled ? '400' : (props.hasValue ? '600' : '400')};\n  color: ${props => props.disabled ? '#9ca3af' : props.hasValue ? '#1f2937' : '#6b7280'};\n\n  &:hover:not(:disabled) {\n    border-color: ${props => props.hasError ? '#dc2626' : '#3b82f6'};\n  }\n\n  &:focus {\n    outline: none;\n    border-color: ${props => props.hasError ? '#dc2626' : '#3b82f6'};\n    box-shadow: 0 0 0 3px ${props => props.hasError ? 'rgba(220, 38, 38, 0.1)' : 'rgba(59, 130, 246, 0.1)'};\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    cursor: not-allowed;\n  }\n\n  /* Chevron ikona */\n  &::after {\n    content: '';\n    position: absolute;\n    right: 12px;\n    top: 50%;\n    transform: translateY(-50%) rotate(${props => props.isOpen ? '180deg' : '0deg'});\n    width: 0;\n    height: 0;\n    border-left: 4px solid transparent;\n    border-right: 4px solid transparent;\n    border-top: 4px solid #6b7280;\n    transition: transform 0.2s ease;\n  }\n`;\n\nconst StableSelectDropdown = styled.div`\n  position: fixed;\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n  max-height: 300px;\n  overflow-y: auto;\n  z-index: 4000;\n  min-width: 200px;\n\n  /* Optimalizace pro plynul scrollovn */\n  scroll-behavior: smooth;\n  overscroll-behavior: contain;\n\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #f8f9fa;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background: #9ca3af;\n  }\n`;\n\nconst StableSelectSearchBox = styled.div`\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  padding: 0.5rem;\n  border-bottom: 1px solid #f3f4f6;\n  background: #f8f9fa;\n`;\n\nconst StableSelectSearchInput = styled.input`\n  width: 100%;\n  padding: 0.5rem 0.75rem 0.5rem 2.5rem;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  font-size: 0.875rem;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n  }\n`;\n\nconst StableSelectSearchIcon = styled.div`\n  position: absolute;\n  left: 1rem;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #9ca3af;\n  pointer-events: none;\n`;\n\nconst StableSelectOption = styled.div`\n  padding: ${props => props.level === 0 ? '0.75rem 1rem' : '0.5rem 1rem 0.5rem 2rem'};\n  cursor: ${props => props.isHeader ? 'default' : 'pointer'};\n  font-size: 0.875rem;\n  color: ${props => props.level === 0 ? '#111827' : '#4b5563'};\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  background: ${props =>\n    props.isHeader ? '#f9fafb' :\n    props.selected ? '#eff6ff' : 'white'\n  };\n  border-left: ${props => props.selected ? '3px solid #3b82f6' : '3px solid transparent'};\n  border-bottom: ${props => props.level === 0 ? '1px solid #e5e7eb' : 'none'};\n  font-weight: ${props => props.selected ? '600' : '400'} !important; /* Bold jen pro vybranou monost */\n  /* Focusable pro tab navigaci */\n  outline: none;\n\n  &:hover {\n    background: ${props =>\n      props.isHeader ? '#f3f4f6' :\n      props.selected ? '#dbeafe' : '#f8fafc'\n    };\n    font-weight: ${props => props.selected ? '600' : '400'} !important; /* Zstv stejn i pi hover */\n  }\n\n  &:focus {\n    background: #dbeafe;\n    box-shadow: inset 0 0 0 2px #3b82f6;\n  }\n\n  &:last-child {\n    border-bottom-left-radius: 8px;\n    border-bottom-right-radius: 8px;\n  }\n\n  input[type=\"checkbox\"] {\n    margin: 0;\n    cursor: pointer;\n  }\n\n  span {\n    padding-left: ${props => (props.level || 0) * 20}px;\n    font-weight: ${props => props.selected ? '600' : '400'} !important; /* Bold jen pro vybranou monost */\n  }\n`;\n\nconst StableSelectValue = styled.span`\n  flex: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n`;\n\n// Helper funkce pro normalizaci textu (odstrann diakritiky pro vyhledvn)\nconst normalizeSearchText = (text) => {\n  if (!text) return '';\n  return text\n    .toLowerCase()\n    .normalize('NFD')\n    .replace(/[\\u0300-\\u036f]/g, '');\n};\n\n// Nov stabiln CustomSelect s jednoduchm state managementem\nconst StableCustomSelect = React.memo(({\n  value,\n  onChange,\n  onBlur,\n  options = [],\n  placeholder = \"Vyberte...\",\n  disabled = false,\n  hasError = false,\n  required = false,\n  field,\n  loading = false,\n  loadingText = 'Natn...',\n  icon = null,\n  multiple = false,\n  isClearable = false,\n  getOptionLabel,\n  getOptionValue,\n  hasTriedToSubmit = false\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [internalScroll, setInternalScroll] = useState(0);\n\n  const wrapperRef = useRef(null);\n  const buttonRef = useRef(null);\n  const dropdownRef = useRef(null);\n  const searchInputRef = useRef(null);\n  const voiceInputFlagRef = useRef(false); // Flag pro hlasov vstup\n\n  // Zpracovn hodnot\n  const normalizedValue = multiple ? (Array.isArray(value) ? value : []) : value;\n\n  // Filtrovan monosti\n  const filteredOptions = useMemo(() => {\n    if (!searchTerm || loading) return options;\n\n    // Normalizace hledanho textu (bez diakritiky)\n    const normalizedSearch = normalizeSearchText(searchTerm);\n\n    return options.filter(option => {\n      let label;\n      if (getOptionLabel) {\n        label = getOptionLabel(option, field);\n      } else {\n        // Fallback pro rzn typy objekt\n        if (field === 'strediska' || field === 'strediska_kod') {\n          label = option.label || option.name || option.nazev_stavu || String(option);\n        } else if (field === 'lp_kod') {\n          label = option.cislo_lp ? `${option.cislo_lp} - ${option.nazev_uctu || ''}` : option.label || String(option);\n        } else {\n          label = option.label || option.nazev || option.name || String(option);\n        }\n      }\n\n      // Normalizace labelu (bez diakritiky) pro porovnn\n      const normalizedLabel = normalizeSearchText(label);\n      return normalizedLabel.includes(normalizedSearch);\n    });\n  }, [options, searchTerm, loading, getOptionLabel, field]);\n\n  // Display hodnota\n  const displayValue = useMemo(() => {\n    if (multiple) {\n      if (normalizedValue.length === 0) return placeholder;\n\n      const result = normalizedValue.map(val => {\n        const option = options.find(opt => {\n          const optVal = getOptionValue ? getOptionValue(opt, field) : (opt.id || opt.value || opt.kod_stavu || opt.kod || opt);\n          // OPRAVA: Porovnn i pro string vs number (nap. '26' vs 26)\n          return optVal == val;\n        });\n\n        if (option) {\n          // Pouij extern getOptionLabel funkci nebo fallback\n          if (getOptionLabel) {\n            return getOptionLabel(option, field);\n          }\n          // Fallback pro rzn typy objekt\n          if (field === 'strediska' || field === 'strediska_kod') {\n            return option.label || option.name || option.nazev_stavu || String(option);\n          }\n          if (field === 'lp_kod') {\n            // OPRAVA: Pouij label, kter u je sprvn naformtovan pi natn LP kd\n            return option.label || (option.cislo_lp ? `${option.cislo_lp} - ${option.nazev_uctu || ''}` : String(option));\n          }\n          return option.label || option.nazev || option.name || String(option);\n        }\n\n        return String(val);\n      }).join(', ');\n\n      return result;\n    } else {\n      if (!normalizedValue) return placeholder;\n      const option = options.find(opt => {\n        const optVal = getOptionValue ? getOptionValue(opt, field) : (opt.id || opt.value || opt.kod_stavu || opt.kod || opt);\n        // OPRAVA: Porovnn i pro string vs number (nap. '26' vs 26)\n        return optVal == normalizedValue; // Pouvme == msto === pro type coercion\n      });\n      if (option) {\n        if (getOptionLabel) {\n          return getOptionLabel(option, field);\n        }\n        return option.label || option.nazev || option.name || String(option);\n      }\n      // Pokud nen nalezen option a jde o prikazce nebo schvalovatel s hodnotou 0 nebo null, zobraz \"Neznm\"\n      if ((field === 'prikazce' || field === 'schvalovatel') && (normalizedValue === 0 || normalizedValue === null || normalizedValue === '0')) {\n        return 'Neznm';\n      }\n      return String(normalizedValue);\n    }\n  }, [normalizedValue, options, placeholder, multiple, getOptionLabel, getOptionValue, field]);\n\n  // Zaven pi kliknut mimo\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {\n        setIsOpen(false);\n        setSearchTerm('');\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n      return () => document.removeEventListener('mousedown', handleClickOutside);\n    }\n  }, [isOpen]);\n\n  // Auto-focus search pi oteven\n  useEffect(() => {\n    if (isOpen && searchInputRef.current && filteredOptions.length > 0) {\n      setTimeout(() => searchInputRef.current?.focus(), 100);\n    }\n  }, [isOpen, filteredOptions.length]);\n\n  // Detekce hlasovho vstupu (nastaveno v useGlobalVoiceRecognition.js)\n  useEffect(() => {\n    if (!wrapperRef.current) return;\n\n    const checkVoiceInputAttribute = () => {\n      const hasVoiceInput = wrapperRef.current?.hasAttribute('data-voice-input');\n      if (hasVoiceInput && !voiceInputFlagRef.current) {\n        voiceInputFlagRef.current = true;\n        // NEODSTRAUJ atribut hned - nech ho tam pro ppad dalch kontrol\n      }\n    };\n\n    // Kontroluj okamit\n    checkVoiceInputAttribute();\n\n    // A tak pi zmn searchTerm (voice input mn hodnotu)\n    if (searchTerm) {\n      checkVoiceInputAttribute();\n    }\n  }, [searchTerm, field]);\n\n  // Automatick vbr pi 1 vsledku po filtrovn (pouze pro hlasov ovldn)\n  useEffect(() => {\n    if (isOpen && searchTerm && filteredOptions.length === 1 && !multiple && voiceInputFlagRef.current) {\n      // Pokud je jen 1 vsledek po filtrovn A je to hlasov vstup  automaticky vyber po krtkm delay\n      const timer = setTimeout(() => {\n        const option = filteredOptions[0];\n        const optionValue = getOptionValue ? getOptionValue(option, field) : (option.id || option.value || option);\n\n        // Zkontroluj, jestli u nen vybran\n        if (normalizedValue !== optionValue) {\n          onChange(optionValue);\n          if (onBlur) onBlur(field, optionValue);\n          setIsOpen(false);\n          setSearchTerm('');\n          voiceInputFlagRef.current = false; // Reset flag\n          // Odstra atribut po auto-vbru\n          if (wrapperRef.current) {\n            wrapperRef.current.removeAttribute('data-voice-input');\n          }\n        }\n      }, 500); // 500ms delay pro jistotu, e uivatel u nepe\n\n      return () => clearTimeout(timer);\n    }\n  }, [isOpen, searchTerm, filteredOptions, multiple, getOptionValue, field, normalizedValue, onChange, onBlur]);\n\n  // Pozicovn dropdown\n  useEffect(() => {\n    if (isOpen && buttonRef.current && dropdownRef.current) {\n      const updatePosition = () => {\n        if (!buttonRef.current || !dropdownRef.current) return;\n        const buttonRect = buttonRef.current.getBoundingClientRect();\n        const dropdown = dropdownRef.current;\n\n        const dropdownMaxHeight = 300;\n        const footerHeight = 54; // Vka fixn patiky\n        const buffer = 20; // Extra buffer pro bezpenost\n        const spaceBelow = window.innerHeight - buttonRect.bottom - footerHeight - buffer;\n        const spaceAbove = buttonRect.top - buffer;\n        // Otevi nahoru pokud: nen dost msta dole NEBO je nahoe vrazn vce msta\n        const shouldOpenUpward = spaceBelow < 200 || (spaceBelow < dropdownMaxHeight && spaceAbove > spaceBelow + 50);\n\n        dropdown.style.left = buttonRect.left + 'px';\n        dropdown.style.width = buttonRect.width + 'px';\n        dropdown.style.maxHeight = dropdownMaxHeight + 'px';\n\n        if (shouldOpenUpward) {\n          // Otevt nahoru\n          dropdown.style.bottom = (window.innerHeight - buttonRect.top + 2) + 'px';\n          dropdown.style.top = 'auto';\n        } else {\n          // Otevt dol (standardn chovn)\n          dropdown.style.top = (buttonRect.bottom + 2) + 'px';\n          dropdown.style.bottom = 'auto';\n        }\n      };\n\n      updatePosition();\n\n      const handleScroll = (event) => {\n        // Neaktualizovat pi scrollu uvnit dropdown\n        if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\n          updatePosition();\n        }\n      };\n\n      // Pouvat capture: true pro zachycen vech scroll event\n      window.addEventListener('scroll', handleScroll, { passive: true, capture: true });\n      window.addEventListener('resize', updatePosition, { passive: true });\n\n      return () => {\n        window.removeEventListener('scroll', handleScroll, { capture: true });\n        window.removeEventListener('resize', updatePosition);\n      };\n    }\n  }, [isOpen]);\n\n  // Zachovn scroll pozice\n  useEffect(() => {\n    if (dropdownRef.current && internalScroll > 0) {\n      dropdownRef.current.scrollTop = internalScroll;\n    }\n  }, [filteredOptions, internalScroll]);\n\n  const handleToggle = () => {\n    if (disabled) return;\n\n    const newState = !isOpen;\n    setIsOpen(newState);\n\n    if (isOpen) {\n      setSearchTerm('');\n    }\n  };\n\n  const handleOptionClick = (option) => {\n    // Zachovat scroll pozici\n    if (dropdownRef.current) {\n      setInternalScroll(dropdownRef.current.scrollTop);\n    }\n\n    const optionValue = getOptionValue ? getOptionValue(option, field) : (option.id || option.value || option);\n\n    if (multiple) {\n      const currentValues = Array.isArray(normalizedValue) ? normalizedValue : [];\n      const newValues = currentValues.includes(optionValue)\n        ? currentValues.filter(v => v !== optionValue)\n        : [...currentValues, optionValue];\n\n      // Pro multiselect poli pole pmo\n      onChange(newValues);\n      if (onBlur) onBlur(field, newValues);\n    } else {\n      // Pro single select poli hodnotu pmo\n      onChange(optionValue);\n      if (onBlur) onBlur(field, optionValue);\n      setIsOpen(false);\n      setSearchTerm('');\n      // Reset voice input flag pi runm vbru\n      voiceInputFlagRef.current = false;\n      if (wrapperRef.current) {\n        wrapperRef.current.removeAttribute('data-voice-input');\n      }\n    }\n  };\n\n  const isSelected = (option) => {\n    const optionValue = getOptionValue ? getOptionValue(option, field) : (option.id || option.value || option);\n    return multiple\n      ? normalizedValue.includes(optionValue)\n      : normalizedValue === optionValue;\n  };\n\n  // Automatick detekce chyby pro povinn pole (stejn jako v CustomSelect.js)\n  const hasValue = multiple\n    ? (Array.isArray(normalizedValue) && normalizedValue.length > 0)\n    : !!normalizedValue;\n  const shouldShowError = hasError || (required && !hasValue && !loading && !disabled && hasTriedToSubmit);\n\n  return (\n    <StableSelectWrapper ref={wrapperRef} data-stable-select data-field={field}>\n      <StableSelectButton\n        ref={buttonRef}\n        type=\"button\"\n        onClick={handleToggle}\n        disabled={disabled}\n        hasError={shouldShowError}\n        isOpen={isOpen}\n        hasValue={hasValue}\n        hasIcon={!!icon}\n        data-field={field}\n      >\n        {icon && (\n          <span style={{\n            position: 'absolute',\n            left: '12px',\n            color: '#9ca3af',\n            width: '16px',\n            height: '16px',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center'\n          }}>\n            {React.cloneElement(icon, { size: 16 })}\n          </span>\n        )}\n        <StableSelectValue title={displayValue}>\n          {(() => {\n            //  Check if selected option is majetek for druh_objednavky_kod\n            if (field === 'druh_objednavky_kod' && normalizedValue) {\n              const selectedOption = options.find(opt => {\n                const optVal = getOptionValue ? getOptionValue(opt, field) : (opt.id || opt.value || opt.kod_stavu || opt.kod || opt);\n                return optVal == normalizedValue;\n              });\n              if (selectedOption && (selectedOption.atribut_objektu === 1 || selectedOption.atribut_objektu === '1')) {\n                const cleanLabel = displayValue.replace('   (majetek)', '');\n                return (\n                  <>\n                    <span>{cleanLabel}</span>\n                    <span style={{\n                      marginLeft: '8px',\n                      fontSize: '0.75rem',\n                      color: '#dc2626',\n                      fontWeight: '500',\n                      padding: '2px 6px',\n                      backgroundColor: '#fee2e2',\n                      borderRadius: '4px',\n                      border: '1px solid #fca5a5'\n                    }}>\n                      (majetek)\n                    </span>\n                  </>\n                );\n              }\n            }\n            return displayValue;\n          })()}\n        </StableSelectValue>\n        {isClearable && !disabled && hasValue && (\n          <span\n            role=\"button\"\n            tabIndex={0}\n            onClick={(e) => {\n              e.stopPropagation();\n              const clearedValue = multiple ? [] : '';\n              onChange(clearedValue);\n            }}\n            onKeyDown={(e) => {\n              if (e.key === 'Enter' || e.key === ' ') {\n                e.preventDefault();\n                e.stopPropagation();\n                const clearedValue = multiple ? [] : '';\n                onChange(clearedValue);\n              }\n            }}\n            title=\"Smazat hodnotu\"\n            style={{\n              position: 'absolute',\n              right: '32px',\n              top: '50%',\n              transform: 'translateY(-50%)',\n              background: 'none',\n              border: 'none',\n              padding: '4px',\n              cursor: 'pointer',\n              color: '#6b7280',\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              width: '20px',\n              height: '20px',\n              borderRadius: '4px',\n              transition: 'all 0.2s ease',\n              zIndex: 2\n            }}\n            onMouseEnter={(e) => {\n              e.currentTarget.style.background = '#f3f4f6';\n              e.currentTarget.style.color = '#374151';\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.background = 'none';\n              e.currentTarget.style.color = '#6b7280';\n            }}\n          >\n            <X size={14} />\n          </span>\n        )}\n      </StableSelectButton>\n\n      {isOpen && !disabled && (\n        <StableSelectDropdown ref={dropdownRef}>\n          <StableSelectSearchBox>\n            <StableSelectSearchIcon>\n              <Search size={16} />\n            </StableSelectSearchIcon>\n            <StableSelectSearchInput\n              ref={searchInputRef}\n              type=\"text\"\n              placeholder=\"Vyhledat...\"\n              value={searchTerm}\n              onChange={(e) => {\n                // Pi runm psan resetuj voice flag\n                if (e.nativeEvent.inputType && e.nativeEvent.inputType.startsWith('insert')) {\n                  voiceInputFlagRef.current = false;\n                }\n                setSearchTerm(e.target.value);\n              }}\n              onClick={(e) => e.stopPropagation()}\n              onKeyDown={(e) => {\n                if (e.key === 'ArrowDown') {\n                  // ipka dol - pejdi na prvn option\n                  e.preventDefault();\n                  if (filteredOptions.length > 0) {\n                    const firstOption = dropdownRef.current?.querySelector('[role=\"option\"]:not([tabindex=\"-1\"])');\n                    if (firstOption) {\n                      firstOption.focus();\n                    }\n                  }\n                } else if (e.key === 'ArrowUp') {\n                  // ipka nahoru - pejdi na posledn option\n                  e.preventDefault();\n                  if (filteredOptions.length > 0) {\n                    const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]:not([tabindex=\"-1\"])') || []);\n                    const lastOption = options[options.length - 1];\n                    if (lastOption) {\n                      lastOption.focus();\n                    }\n                  }\n                } else if (e.key === 'Tab') {\n                  // Pokud je dropdown oteven, pejdi na prvn option msto zaven\n                  if (filteredOptions.length > 0) {\n                    e.preventDefault();\n                    const firstOption = dropdownRef.current?.querySelector('[role=\"option\"], [class*=\"SelectOption\"]');\n                    if (firstOption) {\n                      firstOption.focus();\n                    }\n                  } else {\n                    // Pokud nejsou dn options, zavi dropdown a pokrauj na dal prvek\n                    setIsOpen(false);\n                  }\n                } else if (e.key === 'Escape') {\n                  e.preventDefault();\n                  setIsOpen(false);\n                  // Vra focus na select button\n                  if (buttonRef.current) {\n                    buttonRef.current.focus();\n                  }\n                } else if (e.key === 'Enter') {\n                  e.preventDefault();\n                  e.stopPropagation();\n                }\n              }}\n            />\n          </StableSelectSearchBox>\n\n          {loading ? (\n            <StableSelectOption>{loadingText}</StableSelectOption>\n          ) : filteredOptions.length > 0 ? (\n            filteredOptions.map((option, index) => {\n              const optionValue = getOptionValue ? getOptionValue(option, field) : (option.id || option.value || option);\n              let optionLabel;\n\n              if (getOptionLabel) {\n                optionLabel = getOptionLabel(option, field);\n              } else {\n                // Fallback pro rzn typy objekt\n                if (field === 'strediska' || field === 'strediska_kod') {\n                  optionLabel = option.label || option.name || option.nazev_stavu || String(option);\n                } else if (field === 'lp_kod') {\n                  optionLabel = option.cislo_lp ? `${option.cislo_lp} - ${option.nazev_uctu || ''}` : option.label || String(option);\n                } else {\n                  optionLabel = option.label || option.nazev || option.name || String(option);\n                }\n              }\n\n              const selected = isSelected(option);\n              const level = option.level || 0;\n              const isHeader = option.isHeader || (level === 0 && !option.value && !option.id);\n              \n              //  Check if this is druh_objednavky with majetek flag\n              const isMajetekOption = field === 'druh_objednavky_kod' && (option.atribut_objektu === 1 || option.atribut_objektu === '1');\n\n              return (\n                <StableSelectOption\n                  key={optionValue || index}\n                  selected={selected}\n                  level={level}\n                  isHeader={isHeader}\n                  tabIndex={isHeader ? -1 : 0}\n                  role=\"option\"\n                  aria-selected={selected}\n                  onClick={(e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    // Neumoni kliknout na header\n                    if (!isHeader) {\n                      handleOptionClick(option);\n                    }\n                  }}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter' || e.key === ' ') {\n                      e.preventDefault();\n                      if (!isHeader) {\n                        handleOptionClick(option);\n                      }\n                    } else if (e.key === 'ArrowDown') {\n                      // ipka dol - pejdi na dal option\n                      e.preventDefault();\n                      const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]:not([tabindex=\"-1\"])') || []);\n                      const currentIdx = options.indexOf(e.target);\n                      const nextIdx = currentIdx + 1;\n                      if (nextIdx < options.length) {\n                        options[nextIdx].focus();\n                      } else {\n                        // Cyklicky na zatek\n                        options[0]?.focus();\n                      }\n                    } else if (e.key === 'ArrowUp') {\n                      // ipka nahoru - pejdi na pedchoz option\n                      e.preventDefault();\n                      const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]:not([tabindex=\"-1\"])') || []);\n                      const currentIdx = options.indexOf(e.target);\n                      const prevIdx = currentIdx - 1;\n                      if (prevIdx >= 0) {\n                        options[prevIdx].focus();\n                      } else {\n                        // Cyklicky na konec nebo zpt do search inputu\n                        if (searchInputRef.current) {\n                          searchInputRef.current.focus();\n                        } else {\n                          options[options.length - 1]?.focus();\n                        }\n                      }\n                    } else if (e.key === 'Escape') {\n                      e.preventDefault();\n                      setIsOpen(false);\n                      if (buttonRef.current) {\n                        buttonRef.current.focus();\n                      }\n                    } else if (e.key === 'Tab') {\n                      // Nech prohle zvldat tab - pejde na dal option nebo zave dropdown\n                      const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]:not([tabindex=\"-1\"])') || []);\n                      const currentIdx = options.indexOf(e.target);\n\n                      if (e.shiftKey) {\n                        // Shift+Tab - pokud jsme na prvn option, vra se na search input\n                        if (currentIdx === 0) {\n                          e.preventDefault();\n                          if (searchInputRef.current) {\n                            searchInputRef.current.focus();\n                          }\n                        }\n                      } else {\n                        // Tab - pokud jsme na posledn option, zavi dropdown a pokrauj dl\n                        if (currentIdx === options.length - 1) {\n                          e.preventDefault();\n                          setIsOpen(false);\n                          // Nech hlavn tab handler najt dal prvek ve formuli\n                        }\n                      }\n                    }\n                  }}\n                >\n                  {multiple && !isHeader && (\n                    <input\n                      type=\"checkbox\"\n                      checked={selected}\n                      readOnly\n                      onChange={() => {}} // Przdn handler aby nedval warning\n                    />\n                  )}\n                  {isMajetekOption ? (\n                    <>\n                      <span>{optionLabel.replace('   (majetek)', '')}</span>\n                      <span style={{\n                        marginLeft: '8px',\n                        fontSize: '0.75rem',\n                        color: '#dc2626',\n                        fontWeight: '500',\n                        padding: '2px 6px',\n                        backgroundColor: '#fee2e2',\n                        borderRadius: '4px',\n                        border: '1px solid #fca5a5'\n                      }}>\n                        (majetek)\n                      </span>\n                    </>\n                  ) : (\n                    <span>{optionLabel}</span>\n                  )}\n                </StableSelectOption>\n              );\n            })\n          ) : (\n            <StableSelectOption>dn vsledky</StableSelectOption>\n          )}\n        </StableSelectDropdown>\n      )}\n    </StableSelectWrapper>\n  );\n}, (prevProps, nextProps) => {\n  // Custom comparison funkce pro React.memo\n  // Vrac true pokud jsou props STEJN (skip re-render)\n  // Vrac false pokud jsou props RZN (provede re-render)\n\n  // Porovnej primitivn hodnoty\n  if (prevProps.value !== nextProps.value) return false;\n  if (prevProps.placeholder !== nextProps.placeholder) return false;\n  if (prevProps.disabled !== nextProps.disabled) return false;\n  if (prevProps.hasError !== nextProps.hasError) return false;\n  if (prevProps.required !== nextProps.required) return false;\n  if (prevProps.field !== nextProps.field) return false;\n  if (prevProps.loading !== nextProps.loading) return false;\n  if (prevProps.loadingText !== nextProps.loadingText) return false;\n  if (prevProps.multiple !== nextProps.multiple) return false;\n  if (prevProps.hasTriedToSubmit !== nextProps.hasTriedToSubmit) return false;\n\n  // Porovnej arrays (options) - kontrola dlky a referenc\n  if (prevProps.options.length !== nextProps.options.length) return false;\n  // Pro performance nekontrolujeme deep equality jednotlivch items\n  // sta porovnat reference pole (kter se mn pi naten dat)\n  if (prevProps.options !== nextProps.options) return false;\n\n  // Icon me bt React element, take pouijeme reference check\n  if (prevProps.icon !== nextProps.icon) return false;\n\n  // onChange, onBlur, getOptionLabel, getOptionValue jsou funkce\n  // Pokud jsou zmemoizovan pes useCallback, reference zstane stejn\n  // Zde je nememe deep compare, tak pouijeme reference check\n  if (prevProps.onChange !== nextProps.onChange) return false;\n  if (prevProps.onBlur !== nextProps.onBlur) return false;\n  if (prevProps.getOptionLabel !== nextProps.getOptionLabel) return false;\n  if (prevProps.getOptionValue !== nextProps.getOptionValue) return false;\n\n  // Vechny props jsou stejn - skip re-render\n  return true;\n});\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2', key: '1yyitq' }],\n  ['path', { d: 'M16 3.128a4 4 0 0 1 0 7.744', key: '16gr8j' }],\n  ['path', { d: 'M22 21v-2a4 4 0 0 0-3-3.87', key: 'kshegd' }],\n  ['circle', { cx: '9', cy: '7', r: '4', key: 'nufk8' }],\n];\n\n/**\n * @component @name Users\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTYgMjF2LTJhNCA0IDAgMCAwLTQtNEg2YTQgNCAwIDAgMC00IDR2MiIgLz4KICA8cGF0aCBkPSJNMTYgMy4xMjhhNCA0IDAgMCAxIDAgNy43NDQiIC8+CiAgPHBhdGggZD0iTTIyIDIxdi0yYTQgNCAwIDAgMC0zLTMuODciIC8+CiAgPGNpcmNsZSBjeD0iOSIgY3k9IjciIHI9IjQiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/users\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Users = createLucideIcon('users', __iconNode);\n\nexport default Users;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2', key: '975kel' }],\n  ['circle', { cx: '12', cy: '7', r: '4', key: '17ys0d' }],\n];\n\n/**\n * @component @name User\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTkgMjF2LTJhNCA0IDAgMCAwLTQtNEg5YTQgNCAwIDAgMC00IDR2MiIgLz4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/user\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst User = createLucideIcon('user', __iconNode);\n\nexport default User;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0',\n      key: '1r0f0z',\n    },\n  ],\n  ['circle', { cx: '12', cy: '10', r: '3', key: 'ilqhr7' }],\n];\n\n/**\n * @component @name MapPin\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjAgMTBjMCA0Ljk5My01LjUzOSAxMC4xOTMtNy4zOTkgMTEuNzk5YTEgMSAwIDAgMS0xLjIwMiAwQzkuNTM5IDIwLjE5MyA0IDE0Ljk5MyA0IDEwYTggOCAwIDAgMSAxNiAwIiAvPgogIDxjaXJjbGUgY3g9IjEyIiBjeT0iMTAiIHI9IjMiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/map-pin\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst MapPin = createLucideIcon('map-pin', __iconNode);\n\nexport default MapPin;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0',\n      key: '1nclc0',\n    },\n  ],\n  ['circle', { cx: '12', cy: '12', r: '3', key: '1v7zrd' }],\n];\n\n/**\n * @component @name Eye\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMi4wNjIgMTIuMzQ4YTEgMSAwIDAgMSAwLS42OTYgMTAuNzUgMTAuNzUgMCAwIDEgMTkuODc2IDAgMSAxIDAgMCAxIDAgLjY5NiAxMC43NSAxMC43NSAwIDAgMS0xOS44NzYgMCIgLz4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIzIiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/eye\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Eye = createLucideIcon('eye', __iconNode);\n\nexport default Eye;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'm22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7', key: '132q7q' }],\n  ['rect', { x: '2', y: '4', width: '20', height: '16', rx: '2', key: 'izxlao' }],\n];\n\n/**\n * @component @name Mail\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMjIgNy04Ljk5MSA1LjcyN2EyIDIgMCAwIDEtMi4wMDkgMEwyIDciIC8+CiAgPHJlY3QgeD0iMiIgeT0iNCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjE2IiByeD0iMiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/mail\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Mail = createLucideIcon('mail', __iconNode);\n\nexport default Mail;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'm21 21-4.34-4.34', key: '14j7rj' }],\n  ['circle', { cx: '11', cy: '11', r: '8', key: '4ej97u' }],\n];\n\n/**\n * @component @name Search\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMjEgMjEtNC4zNC00LjM0IiAvPgogIDxjaXJjbGUgY3g9IjExIiBjeT0iMTEiIHI9IjgiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/search\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Search = createLucideIcon('search', __iconNode);\n\nexport default Search;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8', key: 'v9h5vc' }],\n  ['path', { d: 'M21 3v5h-5', key: '1q7to0' }],\n  ['path', { d: 'M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16', key: '3uifl3' }],\n  ['path', { d: 'M8 16H3v5', key: '1cv678' }],\n];\n\n/**\n * @component @name RefreshCw\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMyAxMmE5IDkgMCAwIDEgOS05IDkuNzUgOS43NSAwIDAgMSA2Ljc0IDIuNzRMMjEgOCIgLz4KICA8cGF0aCBkPSJNMjEgM3Y1aC01IiAvPgogIDxwYXRoIGQ9Ik0yMSAxMmE5IDkgMCAwIDEtOSA5IDkuNzUgOS43NSAwIDAgMS02Ljc0LTIuNzRMMyAxNiIgLz4KICA8cGF0aCBkPSJNOCAxNkgzdjUiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/refresh-cw\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst RefreshCw = createLucideIcon('refresh-cw', __iconNode);\n\nexport default RefreshCw;\n","/**\n * Pekld anglick error messages do etiny\n * @param {string} errorMessage - Pvodn error message\n * @returns {string} - Peloen error message\n */\nexport function translateErrorMessage(errorMessage) {\n  if (!errorMessage || typeof errorMessage !== 'string') {\n    return errorMessage || 'Neznm chyba';\n  }\n\n  // Pekldme timeout chyby\n  if (errorMessage.includes('timeout') && errorMessage.includes('exceeded')) {\n    const match = errorMessage.match(/timeout of (\\d+)ms exceeded/);\n    if (match) {\n      const timeoutMs = match[1];\n      const timeoutSec = Math.round(timeoutMs / 1000);\n      return `Pekroen asov limit ${timeoutSec}s - server neodpovdl vas`;\n    } else {\n      return 'Pekroen asov limit - server neodpovdl vas';\n    }\n  }\n\n  // Pekldme dal bn axios/network chyby\n  if (errorMessage.includes('Network Error')) {\n    return 'Chyba st - zkontrolujte internetov pipojen';\n  }\n\n  if (errorMessage.includes('Request failed with status code 500')) {\n    return 'Chyba serveru (kd 500) - zkuste to znovu pozdji';\n  }\n\n  if (errorMessage.includes('Request failed with status code 404')) {\n    return 'Poadovan zdroj nebyl nalezen (kd 404)';\n  }\n\n  if (errorMessage.includes('Request failed with status code 403')) {\n    return 'Nemte oprvnn k tto operaci (kd 403)';\n  }\n\n  if (errorMessage.includes('Request failed with status code 401')) {\n    return 'Neautorizovan pstup - zkuste se znovu pihlsit (kd 401)';\n  }\n\n  if (errorMessage.includes('ECONNREFUSED') || errorMessage.includes('connection refused')) {\n    return 'Nelze se pipojit k serveru - server je pravdpodobn nedostupn';\n  }\n\n  if (errorMessage.includes('ENOTFOUND') || errorMessage.includes('getaddrinfo ENOTFOUND')) {\n    return 'Server nenalezen - zkontrolujte adresu serveru';\n  }\n\n  // Pokud nen rozpoznan chyba, vra pvodn message\n  return errorMessage;\n}\n\n/**\n * Zkrcen verze pro timeout chyby bez dodatenho textu\n * @param {string} errorMessage - Pvodn error message\n * @returns {string} - Peloen error message (krat verze)\n */\nexport function translateErrorMessageShort(errorMessage) {\n  if (!errorMessage || typeof errorMessage !== 'string') {\n    return errorMessage || 'Neznm chyba';\n  }\n\n  // Pekldme timeout chyby\n  if (errorMessage.includes('timeout') && errorMessage.includes('exceeded')) {\n    const match = errorMessage.match(/timeout of (\\d+)ms exceeded/);\n    if (match) {\n      const timeoutMs = match[1];\n      const timeoutSec = Math.round(timeoutMs / 1000);\n      return `Pekroen asov limit ${timeoutSec}s`;\n    } else {\n      return 'Pekroen asov limit';\n    }\n  }\n\n  // Pro ostatn chyby pouij plnou funkci\n  return translateErrorMessage(errorMessage);\n}","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['line', { x1: '4', x2: '20', y1: '9', y2: '9', key: '4lhtct' }],\n  ['line', { x1: '4', x2: '20', y1: '15', y2: '15', key: 'vyu0kd' }],\n  ['line', { x1: '10', x2: '8', y1: '3', y2: '21', key: '1ggp8o' }],\n  ['line', { x1: '16', x2: '14', y1: '3', y2: '21', key: 'weycgp' }],\n];\n\n/**\n * @component @name Hash\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8bGluZSB4MT0iNCIgeDI9IjIwIiB5MT0iOSIgeTI9IjkiIC8+CiAgPGxpbmUgeDE9IjQiIHgyPSIyMCIgeTE9IjE1IiB5Mj0iMTUiIC8+CiAgPGxpbmUgeDE9IjEwIiB4Mj0iOCIgeTE9IjMiIHkyPSIyMSIgLz4KICA8bGluZSB4MT0iMTYiIHgyPSIxNCIgeTE9IjMiIHkyPSIyMSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/hash\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Hash = createLucideIcon('hash', __iconNode);\n\nexport default Hash;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['rect', { width: '18', height: '11', x: '3', y: '11', rx: '2', ry: '2', key: '1w4ew1' }],\n  ['path', { d: 'M7 11V7a5 5 0 0 1 10 0v4', key: 'fwvmzm' }],\n];\n\n/**\n * @component @name Lock\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cmVjdCB3aWR0aD0iMTgiIGhlaWdodD0iMTEiIHg9IjMiIHk9IjExIiByeD0iMiIgcnk9IjIiIC8+CiAgPHBhdGggZD0iTTcgMTFWN2E1IDUgMCAwIDEgMTAgMHY0IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/lock\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Lock = createLucideIcon('lock', __iconNode);\n\nexport default Lock;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M5 12h14', key: '1ays0h' }],\n  ['path', { d: 'M12 5v14', key: 's699le' }],\n];\n\n/**\n * @component @name Plus\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNNSAxMmgxNCIgLz4KICA8cGF0aCBkPSJNMTIgNXYxNCIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/plus\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Plus = createLucideIcon('plus', __iconNode);\n\nexport default Plus;\n","/**\n * API sluby pro smlouvy\n * \n * Endpointy:\n * - POST /ciselniky/smlouvy/list - seznam smluv s filtry\n * - POST /ciselniky/smlouvy/detail - detail smlouvy + objednvky + statistiky\n * - POST /ciselniky/smlouvy/insert - vytvoen smlouvy\n * - POST /ciselniky/smlouvy/update - aktualizace smlouvy\n * - POST /ciselniky/smlouvy/delete - smazn smlouvy\n * - POST /ciselniky/smlouvy/bulk-import - hromadn import z Excel/CSV\n * - POST /ciselniky/smlouvy/prepocet-cerpani - pepoet erpn\n * \n * @author Frontend Team\n * @date 2025-11-23\n */\n\nimport axios from 'axios';\n\nconst API_BASE_URL = process.env.REACT_APP_API2_BASE_URL || 'https://erdms.zachranka.cz/api.eeo/';\n\nconst api = axios.create({\n  baseURL: `${API_BASE_URL}`,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n// =============================================================================\n// ERROR HANDLING\n// =============================================================================\n\nconst handleApiError = (error, defaultMessage = 'Chyba serveru') => {\n  if (error.response) {\n    const { status, data } = error.response;\n    const errorMessage = data?.err || data?.error || data?.message || defaultMessage;\n\n    switch (status) {\n      case 401:\n        throw new Error('Neplatn token. Pihlaste se znovu.');\n      case 403:\n        throw new Error('Nemte oprvnn k tto akci.');\n      case 404:\n        throw new Error('Zznam nebyl nalezen.');\n      case 400:\n        throw new Error(errorMessage);\n      case 409:\n        throw new Error(errorMessage); // Duplicita\n      default:\n        throw new Error(errorMessage);\n    }\n  } else if (error.request) {\n    throw new Error('Server neodpovd. Zkontrolujte pipojen.');\n  } else {\n    throw new Error(error.message || defaultMessage);\n  }\n};\n\nconst checkResponse = (response, operation = 'operace') => {\n  if (response.data?.err) {\n    throw new Error(response.data.err);\n  }\n  if (response.data?.status === 'error') {\n    throw new Error(response.data.message || `${operation} se nezdaila`);\n  }\n  if (response.data?.status !== 'ok') {\n    throw new Error(`${operation} se nezdaila - neplatn status`);\n  }\n  return response.data;\n};\n\n// =============================================================================\n// API FUNKCE\n// =============================================================================\n\n/**\n * Nate seznam smluv s filtry\n */\nexport async function getSmlouvyList({\n  token,\n  username,\n  show_inactive = false,\n  usek_id = null,\n  druh_smlouvy = null,\n  stav = null,\n  search = null,\n  platnost_od = null,\n  platnost_do = null,\n  limit = 1000,\n  offset = 0\n}) {\n  try {\n    const payload = {\n      username,\n      token,\n      show_inactive,\n      usek_id,\n      druh_smlouvy,\n      stav,\n      search,\n      platnost_od,\n      platnost_do,\n      limit,\n      offset\n    };\n\n    const response = await api.post('ciselniky/smlouvy/list', payload);\n\n    return checkResponse(response, 'Natn smluv');\n  } catch (error) {\n    handleApiError(error, 'Chyba pi natn smluv');\n    throw error;\n  }\n}\n\n/**\n * Nate detail smlouvy vetn objednvek a statistik\n */\nexport async function getSmlouvaDetail({ token, username, id }) {\n  try {\n    const response = await api.post('ciselniky/smlouvy/detail', {\n      username,\n      token,\n      id\n    });\n\n    const data = checkResponse(response, 'Natn detailu smlouvy');\n    return data.data || null;\n  } catch (error) {\n    handleApiError(error, 'Chyba pi natn detailu smlouvy');\n    throw error;\n  }\n}\n\n/**\n * Vytvo novou smlouvu\n */\nexport async function createSmlouva({ token, username, smlouvaData }) {\n  try {\n    const response = await api.post('ciselniky/smlouvy/insert', {\n      username,\n      token,\n      ...smlouvaData\n    });\n\n    const data = checkResponse(response, 'Vytven smlouvy');\n    return data.data;\n  } catch (error) {\n    handleApiError(error, 'Chyba pi vytven smlouvy');\n    throw error;\n  }\n}\n\n/**\n * Aktualizuje existujc smlouvu\n */\nexport async function updateSmlouva({ token, username, id, smlouvaData }) {\n  try {\n    const response = await api.post('ciselniky/smlouvy/update', {\n      username,\n      token,\n      id,\n      ...smlouvaData\n    });\n\n    const data = checkResponse(response, 'Aktualizace smlouvy');\n    return data.data;\n  } catch (error) {\n    handleApiError(error, 'Chyba pi aktualizaci smlouvy');\n    throw error;\n  }\n}\n\n/**\n * Smae smlouvu\n */\nexport async function deleteSmlouva({ token, username, id }) {\n  try {\n    const response = await api.post('ciselniky/smlouvy/delete', {\n      username,\n      token,\n      id\n    });\n\n    const data = checkResponse(response, 'Mazn smlouvy');\n    return data.data;\n  } catch (error) {\n    handleApiError(error, 'Chyba pi mazn smlouvy');\n    throw error;\n  }\n}\n\n/**\n * Hromadn import smluv z Excel/CSV\n */\nexport async function bulkImportSmlouvy({\n  token,\n  username,\n  data,\n  overwrite_existing = false,\n  nazev_souboru = null,\n  typ_souboru = null,\n  velikost_souboru = null\n}) {\n  try {\n    const response = await api.post('ciselniky/smlouvy/bulk-import', {\n      username,\n      token,\n      data,\n      overwrite_existing,\n      nazev_souboru,\n      typ_souboru,\n      velikost_souboru\n    });\n\n    const result = checkResponse(response, 'Import smluv');\n    return result.data;\n  } catch (error) {\n    handleApiError(error, 'Chyba pi importu smluv');\n    throw error;\n  }\n}\n\n/**\n * Pepot erpn smluv\n */\nexport async function prepocetCerpaniSmluv({\n  token,\n  username,\n  cislo_smlouvy = null,\n  usek_id = null\n}) {\n  try {\n    const response = await api.post('ciselniky/smlouvy/prepocet-cerpani', {\n      username,\n      token,\n      cislo_smlouvy,\n      usek_id\n    });\n\n    const data = checkResponse(response, 'Pepoet erpn');\n    return data.data;\n  } catch (error) {\n    handleApiError(error, 'Chyba pi pepotu erpn');\n    throw error;\n  }\n}\n\n// =============================================================================\n// KONSTANTY PRO FRONTEND\n// =============================================================================\n\nexport const DRUH_SMLOUVY_OPTIONS = [\n  { value: 'SLUBY', label: 'Smlouva o poskytovn slueb' },\n  { value: 'KUPN', label: 'Kupn smlouva' },\n  { value: 'RMCOV', label: 'Rmcov smlouva' }\n];\n\n// Stavy smluv - BE vrac ENUM bez diakritiky (AKTIVNI, UKONCENA, PRERUSENA, PRIPRAVOVANA, NEAKTIVNI)\n// \n// NEAKTIVNI = soft delete, smlouva existuje v DB ale nen aktivn (aktivni = 0)\n// PRIPRAVOVANA = smlouva vytvoen, ale platnost jet nezaala (dnes < platnost_od)\n// AKTIVNI = platn smlouva v aktulnm obdob (platnost_od <= dnes <= platnost_do)\n// UKONCENA = smlouva vyprela (dnes > platnost_do)\n// PRERUSENA = smlouva doasn peruena (manuln nastaven)\nexport const STAV_SMLOUVY_OPTIONS = [\n  { value: 'AKTIVNI', label: 'Platn', color: '#10b981', icon: '', popis: 'Smlouva je v platnosti a lze ji pouvat' },\n  { value: 'UKONCENA', label: 'Vyprela', color: '#dc2626', icon: '', popis: 'Smlouva pekroila datum konce platnosti' },\n  { value: 'PRERUSENA', label: 'Peruena', color: '#f59e0b', icon: '', popis: 'Smlouva je doasn pozastavena' },\n  { value: 'PRIPRAVOVANA', label: 'Pipraven', color: '#f97316', icon: '', popis: 'Smlouva ek na zatek platnosti' },\n  { value: 'NEAKTIVNI', label: 'Neaktivn', color: '#6b7280', icon: '', popis: 'Smlouva je deaktivovna (soft delete)' }\n];\n\n// Helper funkce pro prci se stavy smluv\nexport const getStavSmlouvyConfig = (stav) => {\n  return STAV_SMLOUVY_OPTIONS.find(opt => opt.value === stav) || {\n    value: stav,\n    label: stav,\n    color: '#6b7280',\n    icon: ''\n  };\n};\n\nexport const getStavSmlouvyLabel = (stav) => {\n  return getStavSmlouvyConfig(stav).label;\n};\n\nexport const getStavSmlouvyColor = (stav) => {\n  return getStavSmlouvyConfig(stav).color;\n};\n\nexport const SAZBA_DPH_OPTIONS = [\n  { value: 0, label: '0% (osvobozeno)' },\n  { value: 12, label: '12% (snen)' },\n  { value: 21, label: '21% (zkladn)' }\n];\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['rect', { width: '16', height: '20', x: '4', y: '2', rx: '2', key: '1nb95v' }],\n  ['line', { x1: '8', x2: '16', y1: '6', y2: '6', key: 'x4nwl0' }],\n  ['line', { x1: '16', x2: '16', y1: '14', y2: '18', key: 'wjye3r' }],\n  ['path', { d: 'M16 10h.01', key: '1m94wz' }],\n  ['path', { d: 'M12 10h.01', key: '1nrarc' }],\n  ['path', { d: 'M8 10h.01', key: '19clt8' }],\n  ['path', { d: 'M12 14h.01', key: '1etili' }],\n  ['path', { d: 'M8 14h.01', key: '6423bh' }],\n  ['path', { d: 'M12 18h.01', key: 'mhygvu' }],\n  ['path', { d: 'M8 18h.01', key: 'lrp35t' }],\n];\n\n/**\n * @component @name Calculator\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cmVjdCB3aWR0aD0iMTYiIGhlaWdodD0iMjAiIHg9IjQiIHk9IjIiIHJ4PSIyIiAvPgogIDxsaW5lIHgxPSI4IiB4Mj0iMTYiIHkxPSI2IiB5Mj0iNiIgLz4KICA8bGluZSB4MT0iMTYiIHgyPSIxNiIgeTE9IjE0IiB5Mj0iMTgiIC8+CiAgPHBhdGggZD0iTTE2IDEwaC4wMSIgLz4KICA8cGF0aCBkPSJNMTIgMTBoLjAxIiAvPgogIDxwYXRoIGQ9Ik04IDEwaC4wMSIgLz4KICA8cGF0aCBkPSJNMTIgMTRoLjAxIiAvPgogIDxwYXRoIGQ9Ik04IDE0aC4wMSIgLz4KICA8cGF0aCBkPSJNMTIgMThoLjAxIiAvPgogIDxwYXRoIGQ9Ik04IDE4aC4wMSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/calculator\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Calculator = createLucideIcon('calculator', __iconNode);\n\nexport default Calculator;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384',\n      key: '9njp5v',\n    },\n  ],\n];\n\n/**\n * @component @name Phone\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTMuODMyIDE2LjU2OGExIDEgMCAwIDAgMS4yMTMtLjMwM2wuMzU1LS40NjVBMiAyIDAgMCAxIDE3IDE1aDNhMiAyIDAgMCAxIDIgMnYzYTIgMiAwIDAgMS0yIDJBMTggMTggMCAwIDEgMiA0YTIgMiAwIDAgMSAyLTJoM2EyIDIgMCAwIDEgMiAydjNhMiAyIDAgMCAxLS44IDEuNmwtLjQ2OC4zNTFhMSAxIDAgMCAwLS4yOTIgMS4yMzMgMTQgMTQgMCAwIDAgNi4zOTIgNi4zODQiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/phone\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Phone = createLucideIcon('phone', __iconNode);\n\nexport default Phone;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'm6 9 6 6 6-6', key: 'qrunsl' }]];\n\n/**\n * @component @name ChevronDown\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtNiA5IDYgNiA2LTYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/chevron-down\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ChevronDown = createLucideIcon('chevron-down', __iconNode);\n\nexport default ChevronDown;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '8', cy: '8', r: '6', key: '3yglwk' }],\n  ['path', { d: 'M18.09 10.37A6 6 0 1 1 10.34 18', key: 't5s6rm' }],\n  ['path', { d: 'M7 6h1v4', key: '1obek4' }],\n  ['path', { d: 'm16.71 13.88.7.71-2.82 2.82', key: '1rbuyh' }],\n];\n\n/**\n * @component @name Coins\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSI4IiBjeT0iOCIgcj0iNiIgLz4KICA8cGF0aCBkPSJNMTguMDkgMTAuMzdBNiA2IDAgMSAxIDEwLjM0IDE4IiAvPgogIDxwYXRoIGQ9Ik03IDZoMXY0IiAvPgogIDxwYXRoIGQ9Im0xNi43MSAxMy44OC43LjcxLTIuODIgMi44MiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/coins\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Coins = createLucideIcon('coins', __iconNode);\n\nexport default Coins;\n"],"names":["LockOpen","createLucideIcon","width","height","x","y","rx","ry","key","d","ShoppingCart","cx","cy","r","Trash","Copy","DialogOverlay","styled","div","_templateObject","_taggedTemplateLiteral","DialogContainer","_templateObject2","DialogHeader","_templateObject3","DialogTitle","h2","_templateObject4","CloseButton","button","_templateObject5","DialogContent","_templateObject6","InfoBox","_templateObject7","props","type","InfoText","_templateObject8","FormSection","_templateObject9","SectionTitle","h3","_templateObject0","FormRow","_templateObject1","columns","FormGroup","_templateObject10","Label","label","_templateObject11","required","InputWithIcon","_templateObject12","Input","input","_templateObject13","hasIcon","hasError","disabled","ScopeSelector","_templateObject14","optionsCount","ScopeOption","_templateObject15","selected","ExistingIndicator","_templateObject16","scope","UsekGrid","_templateObject17","UsekItem","_templateObject18","UsekCode","_templateObject19","span","_templateObject20","ErrorText","_templateObject21","_templateObject22","DialogFooter","_templateObject23","Button","_templateObject24","variant","_ref","isOpen","onClose","onSave","supplierData","existsInPersonal","existsInUsek","existsInGlobal","userPermissions","canAddPersonal","canAddUsek","canAddGlobal","token","username","userDetail","useContext","AuthContext","editedData","setEditedData","useState","selectedScope","setSelectedScope","selectedUseky","setSelectedUseky","availableUseky","setAvailableUseky","usekyLoading","setUsekyLoading","isSaving","setIsSaving","errors","setErrors","useEffect","nazev","dodavatel_nazev","adresa","dodavatel_adresa","ico","dodavatel_ico","dic","dodavatel_dic","zastoupeny","dodavatel_zastoupeny","kontakt_jmeno","dodavatel_kontakt_jmeno","kontakt_email","dodavatel_kontakt_email","kontakt_telefon","dodavatel_kontakt_telefon","async","result","fetchUskyList","error","loadUseky","usek_zkr","usekArray","JSON","parse","Array","isArray","e","handleInputChange","field","value","prev","_objectSpread","newErrors","handleUsekToggle","usekZkr","includes","filter","zkr","actionType","isUpdatingExisting","_jsx","children","_jsxs","onClick","stopPropagation","FontAwesomeIcon","icon","faBuilding","faTimes","faCheckCircle","title","faUser","faGlobe","style","padding","textAlign","color","length","background","border","borderRadius","usek","map","myUseky","checked","onChange","marginTop","fontSize","Building","target","placeholder","MapPin","Hash","maxLength","User","Mail","Phone","general","display","validateData","_editedData$nazev","_editedData$ico","trim","test","Object","keys","finalScope","finalUseky","message","faCheck","getButtonText","Menu","Maximize2","Minimize2","ChevronLeft","FileDown","Minus","ChevronRight","Upload","DropdownContainer","$left","$right","SectionHeader","HeaderTitle","HeaderActions","IconButton","$color","SearchBox","SearchIcon","SearchInput","SearchClearButton","TemplateList","TemplateItem","$type","TemplateInfo","TemplateName","TemplateBadge","TemplateActions","ActionButton","LoadButton","EmptyMessage","$muted","$italic","Divider","hr","show","serverTemplates","savedTemplates","templatesLoading","searchQuery","showSearch","currentPhase","isArchived","hasPermission","onSearch","onToggleSearch","onRefresh","onFillPo","onFillDetails","canFillTemplate","onCopyToUser","onCopyToGlobal","onShowPreview","onDelete","onEditName","editingTemplateId","editingTemplateName","matchesQuery","searchInputRef","useRef","dropdownRef","position","setPosition","left","right","current","rect","getBoundingClientRect","viewportWidth","window","innerWidth","setTimeout","_searchInputRef$curre","focus","filteredServerTemplates","entry","user_id","String","filteredSavedTemplates","ref","faDatabase","RefreshCw","size","Search","X","idx","_t$poApproval","t","data","typ","toString","toUpperCase","allowedPo","allowedDet","displayName","name","dbName","poApproval","predmet","concat","id","badge","viewBox","fill","stroke","strokeWidth","Plus","Eye","gap","ts","_entry$data","_entry$data2","hasPo","hasDet","orderDetails","NavigatorContainer","$position","$isMinimized","$isCompact","$isFullscreen","$isDragging","NavigatorHeader","MinimizedText","NavigatorTitle","HeaderControls","ToolbarSection","ToolbarButtons","ToolbarButton","$withPlus","MinimizedExpandButton","NavigatorContent","SectionItem","$isDisabled","$bgColor","$borderColor","$isActive","SectionItemContent","SectionIcon","SectionInfo","$textColor","SectionName","ValidationBadge","$hasErrors","$hasMissingFields","DropzoneContainer","$isDragOver","DropzoneIcon","DropzoneText","FORM_SECTIONS","bgColor","borderColor","phase","faClipboardCheck","iconType","Package","Calendar","FileTextIcon","faFileContract","Calculator","CheckCircle2","onSectionClick","onFilesDrop","onToggleSections","areSectionsCollapsed","validationErrors","formData","isFullscreen","isSectionActive","allSectionStates","isWorkflowCompleted","canPublishRegistry","canUnlockAnything","onTemplateClick","onSaveAsTemplate","onGenerateDocx","onToggleFullscreen","canGenerateDocx","canSaveTemplate","showTemplateDropdown","onTemplateSearch","onToggleTemplateSearch","onRefreshTemplates","onFillPoApproval","onCopyTemplateToUser","onCopyTemplateToGlobal","onShowTemplatePreview","onDeleteTemplate","onEditTemplateName","matchesTemplateQuery","isMinimized","setIsMinimized","isCompact","setIsCompact","isDragging","setIsDragging","isDragOver","setIsDragOver","dragOffset","setDragOffset","isTemplateDropdownOpen","setIsTemplateDropdownOpen","containerRef","fileInputRef","contentRef","savePosition","useCallback","newPosition","localStorage","setItem","stringify","constrainToViewport","pos","_containerRef$current","navigatorWidth","navigatorHeight","offsetHeight","maxX","Math","max","maxY","innerHeight","min","saved","getItem","savedPos","constrainedPos","console","warn","savedScroll","scrollPos","parseInt","scrollTop","handleWindowResize","prevPosition","handleResize","clearTimeout","timeoutId","addEventListener","removeEventListener","saveMinimizedState","minimized","saveCompactState","compact","scrollTimeoutRef","saveScrollPosition","handleMouseDown","clientX","clientY","top","handleMouseMove","newX","newY","constrainedPosition","handleMouseUp","document","toggleMinimized","newMinimized","prevPos","toggleCompact","newCompact","handleDragEnter","preventDefault","handleDragLeave","currentTarget","contains","relatedTarget","handleDragOver","handleDrop","files","from","dataTransfer","handleDropzoneClick","_fileInputRef$current","click","handleFileSelect","handleToggleTemplateDropdown","handleClickOutside","event","dropdown","closest","toolbarButton","handleSectionClick","section","getSectionValidationInfo","_section$required","sectionErrors","category","log","startsWith","categorizeErrorKey","errorCount","allValidationErrors","allErrorKeys","missingCount","faktury","forEach","faktura","potvrzeni_vecne_spravnosti","maxCena","parseFloat","max_cena_s_dph","fa_castka","vecna_spravnost_poznamka","fieldName","totalRequired","isSectionVisibleAndEnabled","sectionId","sectionState","visible","enabled","renderSectionIcon","IconComponent","navigatorContent","onMouseDown","_Fragment","faBookmark","ChevronDown","faCompress","faExpand","TemplateDropdown","onScroll","isDisabled","isActive","validationInfo","hasErrors","hasMissingFields","showBadge","prilohy","isDropzoneDisabled","onDragEnter","onDragLeave","onDragOver","onDrop","multiple","margin","fontWeight","lineHeight","marginBottom","faClipboard","ReactDOM","body","normalizeStrediskaFromBackend","every","item","kod","Boolean","parsed","kod_stavu","some","normalizeStrediskaForBackend","codes","normalizeFinancovaniFromBackend","financing","zpusob_financovani","zdroj","lp_kody","lp_kod","cislo_smlouvy","smlouva_poznamka","individualni_schvaleni","individualni_poznamka","pojistna_udalost_cislo","pojistna_udalost_poznamka","doplnujici_data","normalizeFinancovaniForBackend","financovaniOptions","arguments","undefined","selectedOption","find","opt","nazev_stavu","constructor","this","isInitialized","isInitializing","initPromise","cache","users","approvers","strediska","financovani","druhyObjednavky","lpKody","metadata","lastInitTime","initDuration","stateCallbacks","registerStateCallbacks","callbacks","setAllUsers","setApprovers","setStrediskaOptions","setFinancovaniOptions","setDruhyObjednavkyOptions","setLpKodyOptions","setLoadingUsers","setLoadingApprovers","setLoadingStrediska","setLoadingFinancovani","setLoadingDruhyObjednavky","setLoadingLpKody","initialize","formDataId","_updateReactState","startTime","Date","now","_performInitialization","duration","push","timestamp","_ref2","isLoadingFromDB","usersResult","approversResult","strediskaResult","financovaniResult","druhyObjednavkyResult","lpKodyResult","Promise","allSettled","_loadUsers","_loadApprovers","_loadStrediska","_loadFinancovani","_loadDruhyObjednavky","_loadLpKody","results","_handleResult","entries","_ref3","_","success","_ref4","_this$stateCallbacks$","_this$stateCallbacks","call","fetchAllUsers","user","aktivni","_this$stateCallbacks$2","_this$stateCallbacks2","_this$stateCallbacks$3","_this$stateCallbacks3","active","fetchApprovers","a","approver","titul_pred_str","titul_pred","jmeno_str","jmeno","prijmeni_str","prijmeni","titul_za_str","titul_za","replace","_this$stateCallbacks$4","_this$stateCallbacks4","_this$stateCallbacks$5","_this$stateCallbacks5","getStrediska25","_this$stateCallbacks$6","_this$stateCallbacks6","_this$stateCallbacks$7","_this$stateCallbacks7","getFinancovaniZdroj25","_this$stateCallbacks$8","_this$stateCallbacks8","_this$stateCallbacks$9","_this$stateCallbacks9","response","getDruhyObjednavky25","druhy","_this$stateCallbacks$0","_this$stateCallbacks0","_this$stateCallbacks$1","_this$stateCallbacks1","fetchLimitovanePrisliby","_this$stateCallbacks$10","_this$stateCallbacks10","status","_this$stateCallbacks$11","_this$stateCallbacks11","_this$stateCallbacks$12","_this$stateCallbacks12","_this$stateCallbacks$13","_this$stateCallbacks13","_this$stateCallbacks$14","_this$stateCallbacks14","_this$stateCallbacks$15","_this$stateCallbacks15","_this$stateCallbacks$16","_this$stateCallbacks16","_hasDataChanged","newData","prevKey","prevData","loadOrder","_ref5","orderId","archivovano","order","getOrderV2","Error","assign","strediska_kod","reset","getState","useAutosave","saveFunction","options","delay","dependencies","timeoutRef","isScheduledRef","lastSaveTimeRef","cancelAutosave","triggerAutosave","immediate","timeSinceLastSave","currentTime","isScheduled","api","axios","create","baseURL","process","headers","order_id","action_user_id","to_user_id","to_users","additional_data","priority","send_email","template_override","payload","post","preview","getTemplates","active_only","sendBulk","recipients","notifyOrderApproved","creator_id","notifyOrderRejected","_ref6","rejection_reason","notifyPendingApproval","_ref7","garant_id","notifyWaitingForChanges","_ref8","waiting_reason","notifySentToSupplier","_ref9","notifyConfirmedBySupplier","_ref0","notifyRegistryPublished","_ref1","notifyInvoiceAdded","_ref10","notifyInvoiceApproved","_ref11","notifyInvoicePaid","_ref12","notifyVecnaSpravnostConfirmed","_ref13","notifyVecnaSpravnostRejected","_ref14","sendOrderApprovalNotifications","_ref15","orderData","fromSet","Set","toSet","prikazce_id","add","vytvoril","objednatel_id","to","sent","order_number","ev_cislo","order_subject","commander_id","supplier_name","financovani_json","strediska_names","strediska_nazvy","max_price","max_price_with_dph","toLocaleString","is_urgent","fromCount","toCount","urgent","WORKFLOW_STATES","NOVA","code","description","ODESLANA_KE_SCHVALENI","SCHVALENA","ZAMITNUTA","CEKA_POTVRZENI","POTVRZENA","DOKONCENA","ZRUSENA","ROZPRACOVANA","getWorkflowPhase","stateCode","state","FIELD_LABELS","values","garant_uzivatel_id","email","dodavatel_kontakt","druh_objednavky_kod","polozky_objednavky","datum_odeslani","schvaleni_komentar","odeslani_storno_duvod","dodavatel_zpusob_potvrzeni","zpusob_platby","dt_akceptace","dt_zverejneni","registr_iddt","ma_byt_zverejnena","validateWorkflowData","_formData$schvaleni_k","_formData$schvaleni_k2","workflowCode","sectionStates","requiredFields","baseFields","getRequiredFields","FIELD_TO_PHASE","isPokladnaFinancing","zpusob","toLowerCase","_formData$datum_odesl","_formData$odeslani_st","_formData$datum_faktu","_formData$cislo_faktu","_formData$predmet","_formData$jmeno","_formData$email","_formData$dodavatel_n","_formData$dodavatel_a","_formData$dodavatel_i","_formData$druh_objedn","_formData$dodavatel_k","_formData$druh_objedn2","_formData$cislo_smlou","_formData$individualn","_formData$pojistna_ud","shouldValidateField","fieldPhase","locked","hasItemError","polozka","index","_polozka$popis","popis","cena_bez_dph","cena_s_dph","stav_schvaleni","stav_odeslani","stav_stornovano","registrSection","registr_smluv_vyplneni","stav_fakturace","datum_fakturace","cislo_faktury","fakturovana_cena_bez_dph","fakturovana_cena_s_dph","getSectionVisibility","orderPhase","objednatel","schvaleni","dodavatel","kontakt","detaily","dodaci_podminky","visibleSections","baseSections","getVisibleSections","baseVisibility","extendedVisibility","LIFECYCLE_PHASES","initialLifecycleState","isLoadingDictionaries","isLoadingFormData","isReady","phaseHistory","LIFECYCLE_ACTIONS","lifecycleReducer","action","addToHistory","initialDictionariesState","allUsers","strediskaOptions","druhyObjednavkyOptions","druhyObjednavkyRawData","lpKodyOptions","prilohyTypyOptions","typyFakturOptions","stavyWorkflowMap","loading","prilohyTypy","typyFaktur","stavyWorkflow","loadedCount","totalToLoad","DICTIONARIES_ACTIONS","dictionariesReducer","rawData","initialUIState","modals","cancelConfirm","supplierSearch","aresPopup","templateSave","templateDeleteConfirm","icoCheck","saveProgress","addFaktura","unlockPhase1Confirm","unlockPhase2Confirm","unlockRegistrConfirm","unlockFakturaceConfirm","unlockVecnaSpravnostConfirm","unlockDokonceniConfirm","dropdowns","template","sections","collapsed","selectStates","searchStates","fullscreen","debug","pinned","text","icoCheckStatus","icoCheckData","dragOver","UI_ACTIONS","uiReducer","closedModals","closedDropdowns","__orderFormCurrentInstanceId","__orderFormInitInProgress","useFormController","userId","editOrderId","archivovanoParam","onDataLoaded","onError","onReady","lifecycle","useFormLifecycle","dispatch","useReducer","startDictionariesLoad","dictionariesLoaded","startDataLoad","dataLoaded","setReady","setError","isInPhase","canLoadData","dictionaries","loadingRef","resolveRef","promiseRef","abortControllerRef","loadAll","signal","resolve","cancelled","druhyData","getTypyPriloh25","getTypyFaktur25","getStavyWorkflow25","loadAllRef","abort","readyPromise","useDictionaries","orderDataLoader","setLoading","extractEnrichedUserData","enrichedUser","telefon","transformOrderData","dbOrder","_dbOrder$financovani","_dbOrder$financovani2","_dbOrder$financovani3","_dbOrder$financovani4","objednatelData","_dbOrder$_enriched","_dictionaries$data","_enriched","enriched","u","strediskaKod","_dbOrder$_enriched2","s","zpusobFinancovani","financovaniVnorena","lp_nazev","paragraf","investice","druhObjednavky","stavObjednavky","stavyArray","stav_workflow_kod","poslednSta","stavInfo","transformedData","cislo_objednavky","stav_objednavky","mimoradna_udalost","stav_odeslano","maOdeslanu","maDatum","dt_odeslani","maOdesilatele","odesilatel_id","dt_odeslano","split","datum_storna","datum_vytvoreni","dt_vytvoreni","datum_splatnosti","dt_splatnost","temp_datum_objednavky","datum_objednavky","dt_objednavky","dodavatel_potvrdil_id","zverejnil_id","dt_zverejneni_potvrzeni","potvrdil_vecnou_spravnost_id","dt_potvrzeni_vecne_spravnosti","rawValue","vecna_spravnost_umisteni_majetku","fakturant_id","dt_faktura_pridana","dokoncil_id","dt_dokonceni","dokonceni_poznamka","potvrzeni_dokonceni_objednavky","polozky","fa_dorucena","fa_datum_doruceni","fa_splatnost","fa_datum_splatnosti","fa_datum_vystaveni","maAkceptaci","potvrzeni","zpusoby","platba","beData","potvrzeno","zpusob_potvrzeni","trimmed","currentStates","toISOString","schvalovatel_id","loadOrderForEdit","err","loadOrderForCopy","nextNumberResponse","getNextOrderNumberV2","newEvCislo","order_number_string","next_order_string","next_number","objednavka_id","dt_schvaleni","datum_posledni_zmeny","vytvoril_uzivatel_id","uzivatel_id","prilohy_dokumenty","sourceOrderId","useOrderDataLoader","ui","useUIState","openModal","modalKey","closeModal","closeAllModals","toggleDropdown","dropdownKey","closeAllDropdowns","collapseSection","sectionKey","expandSection","toggleSection","collapseAllSections","expandAllSections","lockSection","unlockSection","setSelectState","setSearchState","toggleFullscreen","setFullscreen","toggleDebug","pinDebug","setSaveProgress","showSaveProgress","hideSaveProgress","setIcoCheckStatus","setIcoCheckData","setDragOver","instanceIdRef","random","substr","initLockRef","cleanupRef","hasInitializedRef","isMountedRef","strictModeUnmountRef","lifecycleRef","dictionariesRef","orderDataLoaderRef","onDataLoadedRef","onErrorRef","onReadyRef","instanceId","wasInitializing","timeSinceMount","init","reason","currentLifecycle","currentDictionaries","currentOrderDataLoader","currentOnDataLoaded","currentOnReady","loadedData","currentOnError","_loggedWarnings","parseWorkflowStates","_unused","hasWorkflowState","states","msg","meta","has","_err","warnOnce","typeofState","parsedStates","SECTION_DEFINITIONS","visibilityLogic","context","lockLogic","_context$unlockStates","_context$unlockStates2","unlockStates","phase1","phase2","_context$unlockStates3","_context$unlockStates4","_context$unlockStates5","phase3_sections","_context$unlockStates6","_context$unlockStates7","_context$unlockStates8","_context$unlockStates9","potvrzeni_objednavky","isPokladna","_context$unlockStates0","registr_smluv","_context$formData$dod","_context$unlockStates1","registr","hasUverejnit","hasUverejnena","_context$unlockStates10","registr_vyplneni","prubeh_objednavky","dodaci_informace","fakturace","_context$unlockStates11","vecna_spravnost","_context$unlockStates12","dokonceni","_context$unlockStates13","calculateSectionState","evalContext","calculateCurrentPhase","phase3","canEditApprovedSections","isWorkflowLocked","shouldLockPhase1Sections","shouldLockPhase2Sections","shouldLockPhase3Sections","isRegistrLocked","isFakturaceDisplayLocked","isVecnaSpravnostLocked","isDokonceniLocked","PHASE_DEFINITIONS","class","workflowStates","useWorkflowManager","_formData$financovani2","_formData$dodavatel_z2","workflowRefreshKey","setWorkflowRefreshKey","useMemo","_formData$financovani","_formData$dodavatel_z","isPlatbaPokladnaObj","isPlatbaPokladnaDodavatel","unlockedSections","setUnlockedSections","isSectionUnlocked","resetAllUnlocks","forceRefresh","phaseTheme","getPhaseTheme","phaseProgress","isStorno","phases","phaseNum","fillClass","isVisible","isCurrent","getCurrentPhaseCallback","getPhaseProgressCallback","getPhaseThemeCallback","parseWorkflowStatesCallback","hasWorkflowStateCallback","workflowCodeOrState","maybeState","mainWorkflowState","stateHierarchy","hierarchyState","lastState","getSectionState","additionalContext","getSectionLockState","calculateSectionLockState","getAllSectionLockStates","lockStates","isWorkflowRejected","isWorkflowCancelled","isFormLocked","getAllSectionStates","contextWithLock","unlockPhase2","newWorkflowCode","updatedFormData","datum","poznamka","stav_u_dodavatele","datum_zmeny_stavu","poznamka_stav","cislo_zasilky","prepravce","ocekavane_doruceni","skutecne_doruceni","datum_faktury","castka_bez_dph","castka_s_dph","datum_platby","unlockState","newPhase","preparePhase2Unlock","unlockPhase3","preparePhase3Unlock","unlockPhase4","preparePhase4Unlock","getCurrentPhase","getPhaseProgress","sectionDefinitions","phaseDefinitions","formatDateForPicker","date","isNaN","getTime","year","getFullYear","month","getMonth","padStart","day","getDate","normalizeText","normalize","getCurrentDateFormatted","Container","FormWrapper","debugPinned","FixedHeader","theme","colors","gray100","FixedHeaderContent","ScrollableContent","ScrollableInner","FormHeader","HeaderLeft","TitleWithButtons","isOverBudget","h1","PhaseRow","PhaseProgressContainer","PhaseText","isOver","PhaseProgressBar","PhaseSegment","PhaseSegmentFill","_templateObject25","PhaseDivider","_templateObject26","FormActions","_templateObject27","_templateObject28","spin","keyframes","_templateObject29","Spinner","_templateObject30","RetryButton","_templateObject31","EvidenceNumber","_templateObject32","EvidenceValue","_templateObject33","_templateObject34","$isEmergency","_templateObject35","_templateObject36","sectionTheme","bg","hover","getBaseColors","opacity","_templateObject37","_templateObject38","CollapseIcon","_templateObject39","SectionControls","_templateObject40","LockWarning","_templateObject41","SectionContent","_templateObject42","EmergencyToggleWrapper","_templateObject43","EmergencyToggleSwitch","_templateObject44","EmergencyToggleLabel","_templateObject45","_templateObject46","_templateObject47","_templateObject48","_templateObject49","LabelWithClear","_templateObject50","LabelText","_templateObject51","ClearSelectButton","_templateObject52","$visible","_templateObject53","_templateObject54","TextArea","textarea","_templateObject55","SmlouvaAutocompleteContainer","_templateObject56","$loading","$notFound","$isNegative","_templateObject57","_templateObject58","_templateObject59","_templateObject60","_templateObject61","_templateObject62","SmlouvaSuggestionsList","_templateObject63","SmlouvaSuggestionItem","_templateObject64","SmlouvaSuggestionTitle","_templateObject65","SmlouvaSuggestionMeta","_templateObject66","SmlouvaSuggestionEmpty","_templateObject67","select","_templateObject68","_templateObject69","_templateObject70","_templateObject71","isEmpty","_templateObject72","_templateObject73","_templateObject74","_templateObject75","_templateObject76","TemplateModalOverlay","_templateObject77","_templateObject78","_templateObject79","_templateObject80","_templateObject81","DeleteConfirmOverlay","_templateObject82","DeleteConfirmModal","_templateObject83","DeleteConfirmTitle","_templateObject84","DeleteConfirmMessage","_templateObject85","DeleteConfirmActions","_templateObject86","DeleteConfirmButton","_templateObject87","TemplateModal","_templateObject88","TemplateModalHeader","_templateObject89","TemplateModalTitle","_templateObject90","TemplateModalCloseButton","_templateObject91","TemplateModalBody","_templateObject92","TemplateFormGroup","_templateObject93","TemplateLabel","_templateObject94","TemplateInput","_templateObject95","TemplateModalActions","_templateObject96","_templateObject97","_templateObject98","_templateObject99","_templateObject100","_templateObject101","TemplateActionButton","_templateObject102","UnlockButton","_templateObject103","level","_templateObject104","_templateObject105","_templateObject106","_templateObject107","LoadingOverlay","_templateObject108","LoadingSpinner","_templateObject109","LoadingMessage","_templateObject110","LoadingSubtext","_templateObject111","SaveOverlay","_templateObject112","ErrorMessage","_templateObject113","$blurred","_templateObject114","_templateObject115","_templateObject116","SupplierSearchIcon","_templateObject117","AresSearchIcon","_templateObject118","AddToDirectoryIcon","_templateObject119","DeleteItemButton","_templateObject120","SupplierPopupOverlay","_templateObject121","SupplierPopupModal","_templateObject122","SupplierPopupHeader","_templateObject123","SupplierPopupTitle","_templateObject124","SupplierPopupCloseButton","_templateObject125","SupplierSearchInput","_templateObject126","SupplierPopupContent","_templateObject127","SupplierList","_templateObject128","SupplierItem","_templateObject129","AresPopupOverlay","_templateObject130","AresPopupModal","_templateObject131","AresPopupHeader","_templateObject132","AresPopupTitle","_templateObject133","AresPopupCloseButton","_templateObject134","AresPopupContent","_templateObject135","AresSearchInputField","_templateObject136","AresList","_templateObject137","AresItem","_templateObject138","AresItemContent","_templateObject139","hasButtons","AresScopeBadges","_templateObject140","AresScopeBadge","_templateObject141","AresItemButtons","_templateObject142","AresActionButton","_templateObject143","AresLoadingSpinner","_templateObject144","_templateObject145","AresScopeSelector","_templateObject146","AresScopeOption","_templateObject147","AresUsekGrid","_templateObject148","AresUsekItem","_templateObject149","IcoNotification","_templateObject150","IcoNotificationTitle","h4","_templateObject151","IcoNotificationMessage","_templateObject152","IcoNotificationActions","_templateObject153","IcoActionButton","_templateObject154","PreviewModal","_templateObject155","PreviewContent","_templateObject156","PreviewHeader","_templateObject157","PreviewTitle","_templateObject158","PreviewCloseButton","_templateObject159","PreviewSection","_templateObject160","PreviewSectionTitle","_templateObject161","PreviewField","_templateObject162","PreviewFieldLabel","_templateObject163","PreviewFieldValue","_templateObject164","PreviewItemsList","_templateObject165","PreviewItem","_templateObject166","PreviewItemTitle","_templateObject167","PreviewItemDetails","_templateObject168","PreviewBadge","_templateObject169","PreviewEmptyState","_templateObject170","CurrencyInputWrapper","_templateObject171","CurrencySymbol","_templateObject172","CurrencyInput","onBlur","inputRef","localValue","setLocalValue","isFocused","setIsFocused","formatCurrency","val","num","toFixed","formattedValue","newValue","cleanValue","numValue","finalValue","onFocus","handleFocus","handleBlurLocal","formatted","paddingRight","DatePicker","setIsOpen","currentMonth","setCurrentMonth","openUpwards","setOpenUpwards","wrapperRef","calendarRef","selectedDate","checkPosition","buttonRect","spaceBelow","bottom","spaceAbove","scrollContainer","querySelector","handleDateSelect","formattedDate","formatInputDate","today","calendarDays","getCalendarDays","firstDay","lastDay","days","i","getDay","isOtherMonth","remainingDays","displayText","toLocaleDateString","formatDisplayDate","DatePickerWrapper","DateInputButton","hasValue","DateClearButton","handleClear","DateTodayButton","handleToday","DateCalendarPopup","CalendarHeader","CalendarNav","prevMonth","CalendarTitle","nextMonth","CalendarGrid","CalendarDay","isToday","toDateString","isSelected","CalendarDate","CalendarFooter","CalendarButton","className","_templateObject173","_templateObject174","_templateObject175","_templateObject176","_templateObject177","_templateObject178","_templateObject179","_templateObject180","_templateObject181","_templateObject182","_templateObject183","_templateObject184","_templateObject185","FakturaInfoIconWrapper","_templateObject186","FakturaInfoIcon","_templateObject187","FakturaTooltipBubble","_templateObject188","FakturaTooltipRow","_templateObject189","FakturaTooltipLabel","_templateObject190","FakturaTooltipValue","_templateObject191","validateAndFixStrediska","strediskaCodes","transformBackendDataToFrontend","backendData","transformed","sazba_dph","poznamkaText","maxIterations","poznamka_objednavky","OrderForm25","_dictionaries$data2","_dictionaries$data3","_dictionaries$data4","_dictionaries$data5","_dictionaries$data6","_dictionaries$data7","_dictionaries$data8","_dictionaries$data9","_dictionaries$data0","_formData$polozky_obj","_formData$polozky_obj2","_userDetail$roles","_userDetail$roles2","_formData$polozky_obj4","_formData$faktury4","_formData$ev_cislo","_formData$ev_cislo2","_formData$ev_cislo3","_formData$dodavatel_z8","_formData$dodavatel_z11","_formData$dodavatel_z15","_formData$dodavatel_z16","_formData$dodavatel_z17","_formData$dodavatel_z18","_formData$dodavatel_z19","_formData$dodavatel_z20","_formData$dodavatel_z21","_formData$dodavatel_z22","_formData$dodavatel_z23","_formData$dodavatel_z24","_formData$dodavatel_z25","_formData$dodavatel_z26","_formData$dodavatel_z27","_formData$dodavatel_z28","_formData$dodavatel_z30","_attachmentToDelete$a","navigate","useNavigate","showToast","ToastContext","triggerActivity","useActivity","progress","start","startGlobalProgress","setProgress","setGlobalProgress","done","doneGlobalProgress","fail","failGlobalProgress","resetGlobalProgress","ProgressContext","onDataLoadedCalledRef","location","useLocation","urlParams","URLSearchParams","search","editOrderIdFromUrl","get","draftManager","getMetadata","editOrderIdFromLS","menuBarState","orderNumber","setCurrentUser","hasDraft","draftData","loadDraft","savedOrderId","saveMetadata","isEditMode","isNewOrder","__orderFormState","dispatchEvent","CustomEvent","detail","checkInitialState","setSectionStates","storno_detail","setSelectStates","garant","prikazce","setSearchStates","touchedSelectFields","setTouchedSelectFields","isLoadingEvCislo","setIsLoadingEvCislo","setIsFullscreen","lpDetailsState","setLpDetailsState","details","smlouvyState","setSmlouvyState","list","loadingList","loadingDetail","searchTerm","showSuggestions","selectedSuggestionIndex","handleEscKey","attachments","setAttachments","attachmentUI","setAttachmentUI","uploading","checkingSync","showDeleteDialog","deleteTarget","showDeleteAllDialog","setSupplierSearch","showDialog","allContacts","aresState","setAresState","popupOpen","savingToLocal","scopeInfo","usekyState","setUsekyState","available","icoCheckState","setIcoCheckState","isOperation","saveProgressState","setSaveProgressState","isPhase3SectionsLocked","setIsPhase3SectionsLocked","isPhase3SectionsUnlocked","setIsPhase3SectionsUnlocked","isPhase3SectionsLockProcessedFromDB","setIsPhase3SectionsLockProcessedFromDB","setAreSectionsCollapsed","supplierDialog","setSupplierDialog","showAddDialog","existingCheck","autoFillSource","docxModal","setDocxModal","open","loadingState","setLoadingState","ciselniky","initializing","initialized","setIsEditMode","usekyData","scrollTimeout","handleScroll","scrollableContentRef","userNamesCache","setUserNamesCache","_setFormData","popis_pozadavku","dodavatel_id","druh_objednavky","dt_predpokladany_termin_dodani","misto_dodani","zaruka","storno_uzivatel_id","storno_provedl","storno_poznamky","datum_zaplaceni","faktury_objednavky","setFormData","_stack$split$","stack","__activeOrderFormId","__activeOrderFormEvCislo","originalFormDataRef","original","fieldsToCompare","originalPolozky","currentPolozky","origItem","currItem","mnozstvi","cena_jednotkova","workflowManager","currentPhaseTheme","workflowForceRefresh","isArchivedOrder","phaseProgressOverride","isChanged","setIsChanged","isDraftLoaded","setIsDraftLoaded","broadcastMenuBarState","_state$isEditMode","_state$isNewOrder","_state$orderId","_state$orderNumber","_state$currentPhase","_state$mainWorkflowSt","_state$hasDraft","fullState","broadcastMenuBarStateRef","broadcastOrderState","overrides","hasRealId","saveState","setSaveState","saving","savingDraft","disableAutosave","lastAutoSave","autoSaving","dataSource","disableAutosaveRef","autoSaveTimerRef","isClosingRef","autosaveCallbackRef","performSaveDraft","isAutoSave","showCancelConfirmModal","setShowCancelConfirmModal","cancelWarningMessage","setCancelWarningMessage","templateState","setTemplateState","server","fetchStatus","showSaveModal","saveChecked","saveMode","selectedTarget","selectedTargetTs","showDeleteConfirm","pendingDelete","unlockDialogs","setUnlockDialogs","cancelPublish","storno","fakturyState","setFakturyState","showAddForm","editing","fa_cislo_vema","fa_strediska_kod","fa_poznamka","deleteFacturaDialog","setDeleteFacturaDialog","fakturaId","fakturaNazev","pocetPriloh","confirmDialog","setConfirmDialog","onConfirm","templateUI","setTemplateUI","actionsLog","hoveredPreviewKey","previewModalData","editingId","editingName","showSearchPredefs","searchPredefs","setValidationErrors","hasTriedToSubmit","setHasTriedToSubmit","lokalizacePanelStates","setLokalizacePanelStates","lpState","setLpState","showSupplierSearchDialog","setShowSupplierSearchDialog","supplierSearchTerm","setSupplierSearchTerm","supplierSearchResults","setSupplierSearchResults","supplierSearchLoading","setSupplierSearchLoading","allSupplierContacts","setAllSupplierContacts","aresPopupOpen","setAresPopupOpen","aresSearch","setAresSearch","aresResults","setAresResults","loadingAres","setLoadingAres","setSavingToLocal","aresScopeInfo","setAresScopeInfo","aresSelectedScope","setAresSelectedScope","aresSelectedUseky","showIcoCheck","setShowIcoCheck","setIsIcoOperation","setShowSaveProgress","saveProgressText","setSaveProgressText","uploadingFiles","setUploadingFiles","isCheckingSyncAttachments","setIsCheckingSyncAttachments","showDeleteAttachmentDialog","setShowDeleteAttachmentDialog","attachmentToDelete","setAttachmentToDelete","showDeleteAllAttachmentsDialog","setShowDeleteAllAttachmentsDialog","showSupplierAddDialog","setShowSupplierAddDialog","existingSupplierCheck","setExistingSupplierCheck","supplierAutoFillSource","setSupplierAutoFillSource","docxModalOpen","setDocxModalOpen","docxModalOrder","setDocxModalOrder","isLoadingCiselniky","setIsFormInitializing","setIsInitialized","initializationError","setIsSavingDraft","setDisableAutosave","setLastAutoSave","isAutoSaving","setIsAutoSaving","setDataSource","lpDetails","loadingLpDetails","setLoadingLpDetails","smlouvyList","setSmlouvyList","loadingSmlouvyList","setLoadingSmlouvyList","smlouvaDetail","setSmlouvaDetail","loadingSmlouvaDetail","setLoadingSmlouvaDetail","smlouvaSearchTerm","setSmlouvaSearchTerm","showSmlouvySuggestions","setShowSmlouvySuggestions","selectedSmlouvaSuggestionIndex","setSelectedSmlouvaSuggestionIndex","setSavedTemplates","setServerTemplates","setTemplatesFetchStatus","setTemplatesLoading","showTemplateSaveModal","setShowTemplateSaveModal","templateName","setTemplateName","templateType","setTemplateType","setSaveMode","selectedTargetTemplate","setSelectedTargetTemplate","showDeleteTemplateConfirm","setShowDeleteTemplateConfirm","templatePendingDelete","setTemplatePendingDelete","showUnlockPhase1Confirm","setShowUnlockPhase1Confirm","showUnlockPhase2Confirm","setShowUnlockPhase2Confirm","showUnlockPhase3Confirm","setShowUnlockPhase3Confirm","showUnlockRegistrConfirm","setShowUnlockRegistrConfirm","showUnlockPotvrzeniConfirm","setShowUnlockPotvrzeniConfirm","showCancelPublishConfirm","setShowCancelPublishConfirm","showUnlockFakturaceConfirm","setShowUnlockFakturaceConfirm","showUnlockDokonceniConfirm","setShowUnlockDokonceniConfirm","showUnlockStornoConfirm","setShowUnlockStornoConfirm","fakturyLoading","editingFaktura","setEditingFaktura","fakturaFormData","setFakturaFormData","setPreviewModalData","setEditingTemplateId","setEditingTemplateName","lpOptionsForItems","setLpOptionsForItems","stavy","lp","stav","fetchLPDetail","cislo_lp","limit","celkovy_limit","cerpano","skutecne_cerpano","zbyva","zbyva_skutecne","loadLPStavy","autoFillSupplierFromContract","_orderData$zpusob_fin","_orderData$dodavatel_","_orderData$dodavatel_2","_orderData$cislo_smlo","_smlouva$ico","hasSchvalena","isSmlouvaFinancing","cisloSmlouvy","currentSmlouvyList","getSmlouvyList","show_inactive","loadError","smlouva","evidencni_cislo","icoZeSmlouvy","nazev_firmy","source","localResult","searchSupplierByIco","supplier","address","represented","localError","aresUrl","aresResponse","fetch","method","ok","_aresData$sidlo","aresData","json","obchodniJmeno","sidlo","textovaAdresa","aresError","handleDataLoaded","currentEditId","finalData","hasDbData","_draftData$formData","draftOrderId","currentOrderId","wasAutoFilled","supplierFromContract","_loadedData$financova","lp_nazvy","lpOptions","kategorie","rok","sort","b","localeCompare","lpMappingData","validLpOptions","all","lpKod","lpValue","originalValue","lpOption","Number","lpDetail","nazev_uctu","saveDraft","draftError","__orderForm_hasLoadedNextNumberRef","setAutosaveEnabled","formatToastMessage","styles","AlertCircle","warning","AlertTriangle","info","InfoIcon","alignItems","fontFamily","flexShrink","flex","handleError","handleReady","formController","approversBase","isMaterialOrder","React","druhObj","atribut_objektu","formatValidationErrors","errorKeys","categories","ostatni","cleanMessage","cat","backgroundColor","errIdx","marginLeft","marginRight","areDictionariesReady","combined","uniqueMap","Map","set","garantOptions","setGarantOptions","deaktivovan","fakturaTypyPrilohOptions","newPanelStates","isMaterialOrderValue","hasLocationData","usek_kod","budova_kod","mistnost_kod","p","budova","mistnost","isConceptSaved","setIsConceptSaved","isPhase1Unlocked","setIsPhase1Unlocked","_draftData$formData2","syncCheck","checkDBSync","getOrderTimestampV2","_error$response","needsSync","dbData","mergedData","syncWithDatabase","cleanedDraftData","_cleanedDraftData$dod","_cleanedDraftData$dod2","loadDraftData","isOrderSavedToDB","sectionVisibility","getSectionTheme","sectionName","canEditPhase2","phase2SectionsForAuthorizedUsers","canApproveOrders","canManageOrders","canManageUsers","canEditPhase3","canManageInvoices","canSaveOrder","isSuperAdmin","roles","role","kod_role","isAdmin","hasOrderManagePermission","filteredLpKodyOptions","_prikazceWithRoles$ro","selectedPrikazce","prikazceWithRoles","setHours","platneOd","platne_od","platneDo","platne_do","prikazceUsekId","usek_id","filtered","lpUsekId","dnesniDatum","vsechnyLP","filtrovaneLP","filtrovaneKody","isPrilohyLocked","navigatorFormData","extendedSectionStates","hasFaktury","isRegistrFilled","isFieldDisabled","registrState","registrVyplneniState","isRegistrVyplneniLocked","potvrzeniState","isPotvrzeniLocked","shouldLockSchvaleniCheckboxes","financovaniState","shouldLockFinancovaniSection","shouldLockPhase4to6Sections","fakturaceState","isFakturaceLockedPhase7","shouldLockFaktury","dokonceniState","isOrderCompleted","shouldLockAllSections","isZkontrolovana","shouldLockVecnaSpravnost","userRoleRef","_userDetail$roles3","_userDetail$roles4","openConceptNumber","hasCreatedInitialItem","lastPhaseRef","_formData$polozky_obj3","polozkyLength","jednotka","dodavatelPotvrzeni","celkovaCenaBezDPH","reduce","sum","defaultValue","addDebugLog","updateFaktury","newFaktury","selectedFinancovani","preventDefaults","eventName","totalPrice","total","maxPrice","_formData$max_cena_s_","isPriceExceeded","loadAttachmentsSmartly","getUserNameById","getUserDetailApi2","then","fullName","catch","isValidEvCislo","activeUsers","garantInAllUsers","inactiveGarantDetail","normalizedGarant","login","loadGarantOptions","novaFaktura","vytvoril_jmeno","dt_aktualizace","_isNew","handleISDOCParsed","isdocData","realFakturaId","currentFaktury","_updateExisting","updatedFaktury","fa_datum_zdanitelneho_plneni","fa_castka_bez_dph","fa_dph","_isdoc_parsed","_isdoc_polozky","_isdoc_dodavatel","_isdoc_email","_fromISDOC","_isdocRefresh","newFaktura","vecna_spravnost_potvrzeno","f","validateInvoiceForAttachments","_file$name","_file$name2","file","missingFields","endsWith","isValid","valid","isISDOC","join","handleInvoiceAttachmentsChange","newAttachments","faktura_id","hasPokladniDoklad","att","klasifikace","typ_prilohy","_isPokladna","handleCreateInvoiceInDB","_formData$faktury2","_response$data3","tempFakturaId","strediskaKody","invoicePayload","rozsirujici_data","createInvoiceV2","invoice_id","group","groupEnd","handleInvoiceAttachmentUploaded","uploadedAttachment","firstFaktura","loadNextOrderNumber","orderNumberData","nextNumber","startSaveProgressAndRedirect","skipUnlock","unlockOrderId","unlockOrderV2","progressControl","startProgress","onProgress","percent","onComplete","saveUIState","highlightOrderId","_activeProgressControl","sendOrderNotifications","newWorkflowState","oldWorkflowState","notificationType","recipientUserIds","hasKeSchvaleni","hadKeSchvaleni","hadSchvalena","hasZamitnuta","hadZamitnuta","hasCekaSe","hadCekaSe","hasOdeslana","hadOdeslana","hasPotvrzena","hadPotvrzena","hadUverejnena","hasNeuverejnena","hadNeuverejnena","hasFakturace","hadFakturace","hasVecnaSpravnost","hadVecnaSpravnost","hasZkontrolovana","hadZkontrolovana","hasDokoncena","hadDokoncena","hasZrusena","hadZrusena","currentUserIdInt","isUserCreator","delete","validRecipients","notificationService","saveDraftUnified","formDataToSave","explicitSavedOrderId","attachmentsToSave","isAfterDbSave","isAutosaveEnabled","existingDraft","firstSaveDate","existing","firstAutoSaveDate","_unused2","draftFormData","financovaniObj","typ_financovani","uhrada_faktury","kod_strediska_financovani","organizacni_jednotka","ios","zakazka","serializableAttachments","rest","_objectWithoutProperties","_excluded","_hadFile","effectiveSavedOrderId","hasPhase7Or8Data","version","customFormData","clearPhase2UnlockState","phase2Unlocked","uiState","getUIState","phase2OrderId","currentWorkflowState","hasOdeslano","hasZruseno","preventLocalStorageCheck","setPreventLocalStorageCheck","isOrderSent","isOrderCancelled","isManuallyUnlocked","savedSectionStates","loadSectionStates","hasLoadedNextNumberRef","specifikace","merna_jednotka","jednotkova_cena","celkova_cena","fixedHeaderRef","useLayoutEffect","updateHeaderHeight","documentElement","setProperty","timeouts","observer","ResizeObserver","observe","disconnect","loadLPDetail","lp_id_or_kod","loadSmlouvyList","loadSmlouvaDetail","notFound","shouldFillOrdererData","hasUserInput","lp_id","selectedSource","evCislo","iCislo","selectedLpIds","validLpIds","lpId","puvodniLP","platneLP","_formData$zpusob_fina","isSmlouva","hasCisloSmlouvy","nemaDodavatele","shouldAutoFill","hasRelevantData","poznamky","isPageVisible","hidden","debounceTimer","handleVisibilityChange","handleBeforeUnload","scrollPosition","pageYOffset","unsavedAttachments","serverId","fromServer","unclassifiedAttachments","returnValue","handlePopState","timeout","confirmText","cancelText","onCancel","fullUrl","pathname","history","pushState","handleFieldBlur","stored","templates","fetchAndMergeTemplates","newStates","saveSectionStates","checkDuplicateFileName","newFileName","existingFiles","handleFileUpload","newFiles","isAllowedFileType","isAllowedFileSize","duplicate","createAttachmentMetadata","guid","originalName","generatedName","systemovy_nazev","uploadDate","createdAt","uploadError","serverGuid","isDuplicate","duplicateOf","uploadFileToServer25","fileId","_formData$prilohy_dok","filePrefix","_result$data","_result$data2","file_prefix","uploadOrderAttachment","attachmentId","attachment_id","_result$data3","_result$data4","_error$response2","_error$response2$data","errorMsg","checkAttachmentsSynchronization25","silentMode","_serverResult$data","_verifyResult","_verifyResult$data","serverResult","listOrderAttachments","dbAttachments","verifyResult","verifyOrderAttachments","verifyError","issues","hasIssues","conceptUnclassified","conceptOrphaned","dbMissingFiles","dbOrphaned","uploadErrors","inconsistentState","localAtt","serverIdStr","dbAtt","attachmentError","originalni_nazev_souboru","dbIdStr","dbAttError","verifiedAttachments","file_exists","original_name","path","system_path","systemName","size_match","issue","db_size","actual_size","reportText","restoreAttachmentsFromDB","_result$data5","rawAttachments","restoredAttachments","attachment","mapApiAttachmentToLocal","isRestored","existingIds","localUnsavedAttachments","fetchAttachmentsFromAPI","mergedAttachments","removeFileDirectly","removeAllFiles","_result$data7","systemPath","final_filename","fileName","pop","systemova_cesta","velikost","file_size","velikost_souboru_b","upload_date","created_at","updated_at","nahrano_uzivatel_id","uploaded_by_user_id","nahrano_uzivatel","lastModified","cesta_k_souboru","getFilePrefix","getFileBorderColor","getFileBackgroundColor","updatePolozka","updatedPolozka","cenaSdph","cenaBezDph","checkSupplierRequiredFields","_formData$dodavatel_n2","_formData$dodavatel_i2","_formData$dodavatel_i3","handleAddSupplierToDirectory","fetchSupplierContacts","load_all","filteredResults","_supplier$ico","supplierUseky","myUsekRaw","myUsek","hasUsek","exists","loadAllSupplierContacts","initialSearchTerm","performSupplierSearch","searchNormalized","contact","handleSupplierAresSearch","currentName","currentICO","fetchAresData","trimmedSearchTerm","url","requestData","_data$sidlo","_data$sidlo2","searchVariants","term","arr","indexOf","allResults","searchVariant","pocet","ekonomickeSubjekty","_item$sidlo","_item$sidlo2","uniqueResults","findIndex","other","normalizedSearchTerm","aNameNorm","bNameNorm","aContainsOriginal","bContainsOriginal","scopeInfoMap","aresItem","dbResults","_s$ico","handleAresUsekToggle","handleAresSelect","handleSaveToLocal","saveLocation","targetUserId","targetUsekZkr","useky","updateSupplierByIco","updateError","createSupplier","checkSupplierByIco","trimmedIco","_aresData$sidlo2","handleIcoFillForm","handleIcoCancel","compactTemplatePreview","_data$poApproval","_data$poApproval2","_data$orderDetails","_data$polozky$","prvniPolozka","_unused3","logTemplateAction","logEntry","slice","_unused5","isFirstChangeInNewOrder","validateField","processedValue","toMySQLDateTime","hours","getHours","minutes","getMinutes","seconds","getSeconds","getCurrentDate","localTimestamp","handleRadioClick","handleSaveAsTemplate","handleToggleSections","lockedSections","scrollToSection","behavior","sectionElement","sectionHeader","elementTop","offsetTop","targetScrollTop","getComputedStyle","getPropertyValue","scrollTo","handleNavigatorSectionClick","handleNavigatorFilesDrop","hasRozpracovana","handleGenerateDocx","orderForDocx","nazev_objednavky","handleDocxModalClose","handleCancelOrder","deleteAllDraftKeys","removeItem","broadcastDraftDeleted","forceReload","warningMessage","handleCancelConfirm","cancel","handleCancelCancel","pendingUnlock","setPendingUnlock","cleanStates","updateOrderV2","doSave","resetHigherPhaseCheckboxes","tempFormData","allErrors","validateFormForSave","flushSync","_formData$dodavatel_z5","_formData$financovani4","_formData$dodavatel_z6","validationWorkflowCode","phase4to6","workflowErrors","shouldValidateFinancovani","_formData$cislo_smlou2","polozka_lp_id","_formData$dt_akceptac","zpusobyPotvrzeni","fakturaPrefix","locationErrorKeys","k","_formData$polozky_obj5","polozkyIndexesWithErrors","match","newLokalizacePanelStates","structuredMessage","scrollToFirstError","fieldOrder","element","parentSection","polozkyKeys","firstPolozkaError","getAttribute","scrollIntoView","block","inline","inputInside","cancelDeleteSavedTemplate","fetchTemplatesListWithMeta","items","serverTpls","userTpls","processedServerTemplates","nazev_sablony","parseTemplateData","rawTyp","rawTypStr","serverType","__fromServer","processedUserTemplates","raw","count","serverCount","userCount","safeParseTemplateField","Function","fn","rawPo","polozky_po","rawDetail","polozky_detail","expandFlatKeys","obj","out","parts","cur","parsedPo","parsedDetail","saveTemplateToStorage","createTemplate","_response$data5","_response$data4","newTemplate","insertId","updatedTemplates","mode","getOptionLabel","option","druhLabel","jmeno_prijmeni","handleFormKeyDown","_visibleElements$newI","activeElement","formContainer","focusableSelectors","visibleElements","querySelectorAll","el","offsetParent","tagName","visibility","currentIndex","_visibleElements$","newIndex","shiftKey","formContent","FloatingNavigator","setShowSearchPredefs","next","fieldMap","fields","appliedSections","predefinedEntry","_predefinedEntry$type","templateData","copyName","resp","created","userEntry","globalName","_result$data8","showTemplatePreview","previewData","createDetailedTemplatePreview","templateInfo","formatDateOnly","isGlobal","po","popisPozadavku","od","dodavatelNazev","dodavatelAdresa","dodavatelIco","dodavatelDic","datumDodani","datum_dodani","fakturovatNa","fakturovat_na","dodaciAdresa","dodaci_adresa","cenaJednotka","cena_jednotka","cenaTotal","query","_entry$data$poApprova","_entry$data2$polozky","_entry$data2$polozky$","normalizedQuery","entryName","entryPredmet","entryFirstItem","boxShadow","whiteSpace","flexDirection","minimumFractionDigits","maximumFractionDigits","transition","toLocaleTimeString","hour","minute","second","fontStyle","faExclamationTriangle","flexWrap","typCerpani","aktualneCerpani","pocetLP","pomernaCast","zbyva_rezervace","zbyva_predpoklad","isNegative","lpCislo","lpNazev","spravce","spravceText","tooltipText","cursor","abs","Lock","onMouseEnter","onMouseLeave","Unlock","transform","transformOrigin","celkovaCastka","hodnota_s_dph","celkova_castka","cerpano_celkem","rezervovanaCastka","jeUlozenaObjednavka","jeVeFazi78","isPhase36","castka","__workflowStateUpdated","faze_objednavky","schvalil_uzivatel_id","poznamka_schvaleni","poznamka_vecna_spravnost","currentDateTime","getMySQLDateTime","freshOrderData","updatedData","nadlimit","_userDetail$roles5","_userDetail$roles6","_formData$dodavatel_z3","_formData$financovani3","_formData$dodavatel_z4","getMySQLDate","shouldStayOnForm","uzivatelIdNumber","objednatelIdNumber","druhObjednavkyObj","vecnaSpravnostValue","objednatel_jmeno","objednatel_email","objednatel_telefon","existingStates","hasOrderId","approvalChoice","wasAlreadyApproved","isJustNowApproved","isDodavatelPotvrzeno","nepotvrzeneFaktury","jeDokonceniPotvrzeno","jeVecnaSprvnostPotvrzena","workflowOrder","indexA","indexB","lastWorkflowCode","stavZCiselniku","workflowState","dokonceniValue","datumOdeslani","datumStorna","dodavatel_zpusob_potvrzeni_original","potvrzeniData","dataToSave","akceptaceValue","zverejneniValue","updatedFormDataImmediate","_faktura$attachments","strediskaArray","typ_platby","pokladni_doklad","prilohy_count","isdoc","datum_vystaveni","dph_celkem","_result$polozky2","_result$faktury2","_parsedUpdateData$str","oldWorkflowKod","workflow","fieldsCount","strediskaNazvy","stredisko","notificationServiceDual","dualError","notifError","updatedWorkflowKod","transformedResult","parsedUpdateData","poslednStav","fakturyWithAttachments","_fakturaFromDB$rozsir2","fakturaFromDB","parsedStrediska","_attachResponse$data2","attachResponse","listInvoiceAttachments","_freshOrderData$finan","reloadError","prepocetCerpaniSmluv","workflowKod","_mergedDraftData$polo2","mergedDraftData","step","updateOrderId","shouldShowProgress","ordersCacheService","invalidate","_result$lock_info","_result$lock_info2","_parsedInsertData$str","_parsedInsertData$str2","_fakturyWithAttachmen","_result$financovani","_result$polozky","_result$faktury","_result2","phase1Fields","createOrderV2","lock_info","locked_by_user_id","unlockError","fakturyFromBE","originalFaktury","_fakturaFromDB$rozsir","originalFaktura","_attachResponse$data","parsedInsertData","fallback","_result","newWorkflowFromDB","_mergedDraftData$polo","newWorkflowKod","hasSchvalenaInsert","_result$lock_info3","_result3","locked_by_user_fullname","deleteDraft","endpoint","lockInfo","userName","lockAge","lock_age_minutes","translateErrorMessageShort","backgroundTaskService","runTaskNow","saveOrderToAPI","faSave","borderTop","borderBottom","overflow","onKeyDown","faChevronUp","StableCustomSelect","selectedValue","loadingText","getOptionValue","gridColumn","FileText","Users","handleCurrencyChange","numericValue","parseCurrency","selectedValues","Coins","lpCodes","gridTemplateColumns","searchLower","cislo","nazev_smlouvy","firma","searchValue","jeVyprsela","borderLeft","Intl","NumberFormat","currency","format","platnost_do","readOnly","justifyContent","isFormBasicallyValid","pointerEvents","accentColor","faClock","minWidth","prettyDate","x1","y1","x2","y2","zIndex","currentIco","handleIcoBlur","removePolozka","onMouseOver","onMouseOut","points","paddingLeft","rows","addPolozka","isChecked","dateStr","phaseCheck","workflowCheck","_formData$dodavatel_z9","_formData$dodavatel_z0","_formData$dodavatel_z1","_formData$dodavatel_z10","_formData$dodavatel_z12","_formData$dodavatel_z13","hasValidationError","_formData$dodavatel_z14","currentZpusoby","newZpusoby","faInfoCircle","minHeight","boxSizing","faHashtag","_formData$financovani5","_formData$dodavatel_z29","_formData$faktury5","shouldShow","sectionDescription","faCreditCard","pokladniDoklad","InvoiceAttachmentsCompact","objednavkaId","onISDOCParsed","onAttachmentsChange","onAttachmentUploaded","onCreateInvoiceInDB","_faktura$fa_datum_dor","_faktura$fa_castka","isEditing","currentData","isVecnaPotvrzena","letterSpacing","textTransform","Info","navigator","clipboard","writeText","faTimesCircle","predpokladanaCastka","_formData$faktury","prilohyCount","_response$data","handleDeleteFaktura","_faktura$fa_splatnost2","_faktura$fa_splatnost","fakturaCastka","rozdil","prekroceno","paddingTop","updatedFields","hasTimestamp","potvrdil_vecnou_spravnost_jmeno","potvrdil_vecnou_spravnost_prijmeni","isDokonceniLockedLocal","listStyle","isPotvrzeno","fakturyCelkem","handleFileDrop","getElementById","animation","accept","faSync","faBrain","_file$nahrano_uzivate","_file$nahrano_uzivate2","faFileCircleXmark","faFileAlt","textOverflow","round","oldUrl","link","createElement","href","download","appendChild","removeChild","blob","downloadOrderAttachment","URL","createObjectURL","revokeObjectURL","errorMessage","downloadAttachmentFromServer25","isFromServer","deleteAttachmentFromServer25","removeFile","faTrash","updateAttachmentV2","updateFileKlasifikace","handleSupplierSearchClose","autoFocus","contactPerson","phone","handleSupplierSearchSelect","aresSearchTimeout","isCurrentlySaving","updateTemplate","_templateData$orderDe","confirmDeleteSavedTemplate","payloadUserId","deleteTemplate","serverStatus","serverData","deleted","CheckCircle","ConfirmDialog","handleCancelDeleteAttachment","deleteOrderAttachment","_error$response3","_error$response3$data","performDeleteAttachmentFromServer","handleCancelDeleteAllAttachments","handleConfirmDeleteAllAttachments","isRealInvoice","_response$data2","priloha","deleteInvoiceAttachment","deleteInvoiceV2","handleResetToPhase1","handleResetToPhase3Sections","handleResetToPhase3Workflow","updatedStates","currentWorkflow","workflowArray","updatedWorkflow","clearedData","storno_duvod","storno_user_id","dt_storno","SupplierAddDialog","ModernHelper","pageContext","DocxGeneratorModal","StableSelectWrapper","_templateObject192","StableSelectButton","_templateObject193","StableSelectDropdown","_templateObject194","StableSelectSearchBox","_templateObject195","StableSelectSearchInput","_templateObject196","StableSelectSearchIcon","_templateObject197","StableSelectOption","_templateObject198","isHeader","StableSelectValue","_templateObject199","normalizeSearchText","isClearable","setSearchTerm","internalScroll","setInternalScroll","buttonRef","voiceInputFlagRef","normalizedValue","filteredOptions","normalizedSearch","displayValue","checkVoiceInputAttribute","_wrapperRef$current","hasAttribute","timer","optionValue","removeAttribute","updatePosition","shouldOpenUpward","maxHeight","dropdownMaxHeight","passive","capture","handleOptionClick","currentValues","newValues","v","shouldShowError","handleToggle","cleanLabel","tabIndex","nativeEvent","inputType","_dropdownRef$current8","firstOption","_dropdownRef$current9","lastOption","_dropdownRef$current0","optionLabel","isMajetekOption","_dropdownRef$current1","nextIdx","_options$2","_dropdownRef$current10","prevIdx","_options2","_dropdownRef$current11","currentIdx","prevProps","nextProps","translateErrorMessage","timeoutMs","timeoutSec","handleApiError","defaultMessage","request","checkResponse","operation","druh_smlouvy","platnost_od","offset","getSmlouvaDetail","createSmlouva","smlouvaData","updateSmlouva","deleteSmlouva","bulkImportSmlouvy","overwrite_existing","nazev_souboru","typ_souboru","velikost_souboru","DRUH_SMLOUVY_OPTIONS","STAV_SMLOUVY_OPTIONS","getStavSmlouvyConfig","getStavSmlouvyLabel","getStavSmlouvyColor","SAZBA_DPH_OPTIONS"],"sourceRoot":""}