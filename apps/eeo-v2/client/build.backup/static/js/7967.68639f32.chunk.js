"use strict";(self.webpackChunkr_app_zzs_eeo=self.webpackChunkr_app_zzs_eeo||[]).push([[4795,7967,8319,9690],{27967:(e,a,o)=>{o.r(a),o.d(a,{default:()=>M});var n=o(89379),t=o(65043),i=o(27837),s=o(96427),l=o(83910),c=o(97929),r=o(70579);const d=function(e){var a;let{title:n,onMenuClick:s,notificationCount:d=0,showBackButton:u=!1,onBackClick:m,onActivityClick:v,activityCount:h=0}=e;const{isLoggedIn:p,token:b,user:j}=(0,t.useContext)(i.cy),[g,y]=(0,t.useState)(null),f="1.89 (Hierarchy edge persistence fix, template variants DB save/load)",k=(null===(a=f.match(/(\d+\.\d+[a-z]?)/))||void 0===a?void 0:a[1])||f;return(0,t.useEffect)(()=>{if(!p||!b||null===j||void 0===j||!j.username)return void y(null);(async()=>{try{var e;const{getGlobalSettings:a}=await Promise.resolve().then(o.bind(o,58319)),{getUserDetailApi2:n}=await Promise.resolve().then(o.bind(o,75949)),t=await a(b,j.username),i=await n(j.username,b,j.id),s=(null===i||void 0===i||null===(e=i.roles)||void 0===e?void 0:e.some(e=>{var a;return null===(a=e.prava)||void 0===a?void 0:a.some(e=>"HIERARCHY_IMMUNE"===e.kod_prava)}))||!1;t.hierarchy_enabled&&t.hierarchy_profile_id?(y({profileId:t.hierarchy_profile_id,enabled:!0,isImmune:s}),console.log("\ud83d\udcf1 [MobileHeader] Hierarchie na\u010dtena:",t.hierarchy_profile_id,"Imunita:",s)):y({enabled:!1})}catch(a){console.error("\ud83d\udcf1 [MobileHeader] Chyba p\u0159i na\u010d\xedt\xe1n\xed hierarchie:",a),y(null)}})()},[p,b,null===j||void 0===j?void 0:j.username,null===j||void 0===j?void 0:j.id]),(0,r.jsx)("header",{className:"mobile-header",children:(0,r.jsxs)("div",{className:"mobile-header-container",children:[u?(0,r.jsx)("button",{className:"mobile-back-btn",onClick:m,"aria-label":"Zp\u011bt",children:(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24",children:(0,r.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})})}):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"mobile-logo",children:(0,r.jsx)("img",{src:"/eeo-v2/logo-ZZS.png",alt:"ZZS Logo",className:"mobile-logo-img"})})}),(0,r.jsxs)("div",{className:"mobile-app-title",children:[(0,r.jsxs)("h1",{children:[n||"EEO",!n&&(0,r.jsxs)("sup",{style:{fontSize:"0.45em",marginLeft:"4px",fontWeight:"600",color:"#fbbf24",textShadow:"0 1px 2px rgba(0,0,0,0.3)"},children:[k,(null===g||void 0===g?void 0:g.enabled)&&(null===g||void 0===g?void 0:g.profileId)&&(0,r.jsxs)("span",{style:{color:g.isImmune?"#9ca3af":"#10b981",fontWeight:"700",opacity:g.isImmune?.6:1},children:[".H",g.profileId]})]})]}),!n&&(0,r.jsx)("span",{className:"mobile-app-subtitle",children:"Elektronick\xe1 evidence objedn\xe1vek"})]}),(0,r.jsxs)("div",{className:"mobile-header-actions",children:[!u&&v&&(0,r.jsxs)("button",{className:"mobile-activity-btn",onClick:v,"aria-label":"Historie aktivit",children:[(0,r.jsx)(l.g,{icon:c.Yj9}),h>0&&(0,r.jsx)("span",{className:"mobile-activity-badge",children:h>9?"9+":h})]}),d>0&&(0,r.jsxs)("button",{className:"mobile-notification-btn","aria-label":"Notifikace",children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"})}),d>0&&(0,r.jsx)("span",{className:"mobile-notification-badge",children:d>99?"99+":d})]}),(0,r.jsxs)("button",{className:"mobile-menu-btn",onClick:s,"aria-label":"Menu",children:[(0,r.jsx)("span",{}),(0,r.jsx)("span",{}),(0,r.jsx)("span",{})]})]})]})})};const u=function(e){var a,o;let{isOpen:n,onClose:l,user:c,userDetail:d,authUser:u,onNavigate:m}=e;const{logout:v}=(0,t.useContext)(i.cy),{mode:h,preference:p,setThemePreference:b}=(0,s.A)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mobile-menu-overlay ".concat(n?"open":""),onClick:e=>{e.target===e.currentTarget&&l()}}),(0,r.jsxs)("div",{className:"mobile-menu ".concat(n?"open":""),children:[(0,r.jsxs)("div",{className:"mobile-menu-header",children:[(0,r.jsx)("button",{className:"mobile-menu-close",onClick:l,"aria-label":"Zav\u0159\xedt menu",children:(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})}),(0,r.jsx)("h3",{children:"Menu"})]}),(0,r.jsxs)("div",{className:"mobile-menu-content",children:[c&&(0,r.jsxs)("div",{className:"mobile-menu-user",children:[(0,r.jsx)("div",{className:"mobile-menu-user-avatar",children:null!==d&&void 0!==d&&d.jmeno?d.jmeno.charAt(0).toUpperCase():null!==u&&void 0!==u&&u.displayName?u.displayName.charAt(0).toUpperCase():"U"}),(0,r.jsxs)("div",{className:"mobile-menu-user-info",children:[(0,r.jsx)("div",{className:"mobile-menu-user-name",children:(()=>{if(!d)return(null===u||void 0===u?void 0:u.displayName)||(null===u||void 0===u?void 0:u.username)||"U\u017eivatel";const e=[];return d.titul_pred&&e.push(d.titul_pred),d.jmeno&&e.push(d.jmeno),d.prijmeni&&e.push(d.prijmeni),d.titul_za&&e.push(d.titul_za),e.length>0?e.join(" "):(null===u||void 0===u?void 0:u.displayName)||(null===u||void 0===u?void 0:u.username)||"U\u017eivatel"})()}),(0,r.jsxs)("div",{className:"mobile-menu-user-details",children:[(null===d||void 0===d?void 0:d.usek_nazev)&&(0,r.jsx)("span",{className:"user-detail-item",children:"object"===typeof d.usek_nazev?null===(a=d.usek_nazev)||void 0===a?void 0:a.nazev:d.usek_nazev}),(null===d||void 0===d?void 0:d.lokalita_nazev)&&(0,r.jsx)("span",{className:"user-detail-item",children:"object"===typeof d.lokalita_nazev?null===(o=d.lokalita_nazev)||void 0===o?void 0:o.nazev:d.lokalita_nazev})]}),(0,r.jsx)("div",{className:"mobile-menu-user-email",children:(null===d||void 0===d?void 0:d.email)||(null===u||void 0===u?void 0:u.mail)||(null===u||void 0===u?void 0:u.upn)||(null===u||void 0===u?void 0:u.username)||""})]})]}),(0,r.jsxs)("nav",{className:"mobile-menu-nav",children:[(0,r.jsxs)("button",{className:"mobile-menu-item",onClick:()=>{m("dashboard"),l()},children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),(0,r.jsx)("span",{children:"Dashboard"})]}),(0,r.jsxs)("button",{className:"mobile-menu-item",onClick:()=>{m("activity"),l()},children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"})}),(0,r.jsx)("span",{children:"Aktivita"})]})]}),(0,r.jsxs)("div",{className:"mobile-menu-section",children:[(0,r.jsx)("div",{className:"mobile-menu-section-title",children:"Re\u017eim zobrazen\xed"}),(0,r.jsxs)("div",{className:"mobile-menu-theme-options",children:[(0,r.jsxs)("button",{className:"mobile-menu-theme-btn ".concat("auto"===p?"active":""),onClick:()=>b("auto"),children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),(0,r.jsx)("span",{children:"Automaticky"}),"auto"===p&&(0,r.jsxs)("span",{className:"mobile-menu-theme-current",children:["(","dark"===h?"Tmav\xfd":"Sv\u011btl\xfd",")"]})]}),(0,r.jsxs)("button",{className:"mobile-menu-theme-btn ".concat("light"===p?"active":""),onClick:()=>b("light"),children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"})}),(0,r.jsx)("span",{children:"Sv\u011btl\xfd"})]}),(0,r.jsxs)("button",{className:"mobile-menu-theme-btn ".concat("dark"===p?"active":""),onClick:()=>b("dark"),children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M9 2c-1.05 0-2.05.16-3 .46 4.06 1.27 7 5.06 7 9.54 0 4.48-2.94 8.27-7 9.54.95.3 1.95.46 3 .46 5.52 0 10-4.48 10-10S14.52 2 9 2z"})}),(0,r.jsx)("span",{children:"Tmav\xfd"})]})]})]}),(0,r.jsx)("div",{className:"mobile-menu-footer",children:(0,r.jsxs)("button",{className:"mobile-menu-logout",onClick:async()=>{try{await v()}catch(e){console.error("Logout failed:",e)}},children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"})}),(0,r.jsx)("span",{children:"Odhl\xe1sit se"})]})})]})]})]})},m="eeo_activity_log",v={ORDER_APPROVED:"order_approved",ORDER_REJECTED:"order_rejected",ORDER_WAITING:"order_waiting",ORDER_CREATED:"order_created",ORDER_UPDATED:"order_updated",ORDER_DELETED:"order_deleted",INVOICE_APPROVED:"invoice_approved",INVOICE_REJECTED:"invoice_rejected",INVOICE_CREATED:"invoice_created",INVOICE_UPDATED:"invoice_updated",CASHBOOK_CREATED:"cashbook_created",CASHBOOK_UPDATED:"cashbook_updated",CASHBOOK_DELETED:"cashbook_deleted"},h={ORDER:"order",INVOICE:"invoice",CASHBOOK:"cashbook"},p=()=>{try{const e=localStorage.getItem(m);if(!e)return[];const a=JSON.parse(e),o=Date.now(),n=864e5,t=a.filter(e=>o-e.timestamp<n);return t.length!==a.length&&localStorage.setItem(m,JSON.stringify(t)),t.sort((e,a)=>a.timestamp-e.timestamp)}catch(e){return console.error("[ActivityLog] Chyba p\u0159i na\u010d\xedt\xe1n\xed aktivit:",e),[]}},b=e=>{let{entityType:a,entityId:o,activityType:n,title:t,amount:i=null,userName:s,description:l,metadata:c={}}=e;try{const e=p(),r={id:"".concat(a,"_").concat(o,"_").concat(Date.now()),timestamp:Date.now(),entityType:a,entityId:o,activityType:n,title:t,amount:i,userName:s,description:l,metadata:c};e.unshift(r);const d=e.slice(0,100);return localStorage.setItem(m,JSON.stringify(d)),console.log("[ActivityLog] Aktivita p\u0159id\xe1na:",r),r}catch(r){return console.error("[ActivityLog] Chyba p\u0159i p\u0159id\xe1v\xe1n\xed aktivity:",r),null}},j=()=>{try{return localStorage.removeItem(m),console.log("[ActivityLog] V\u0161echny aktivity vymaz\xe1ny"),!0}catch(e){return console.error("[ActivityLog] Chyba p\u0159i maz\xe1n\xed aktivit:",e),!1}},g=e=>e.includes("approved")?"activity-success":e.includes("rejected")?"activity-danger":e.includes("waiting")?"activity-warning":e.includes("created")||e.includes("updated")?"activity-info":e.includes("deleted")?"activity-danger":"activity-default",y=e=>{const a=Date.now()-e,o=Math.floor(a/6e4),n=Math.floor(a/36e5);return o<1?"pr\xe1v\u011b te\u010f":o<60?"p\u0159ed ".concat(o," min"):n<24?"p\u0159ed ".concat(n," h"):"p\u0159ed 1 dnem"};const f=function(e){let{isOpen:a,onClose:o}=e;const[n,i]=(0,t.useState)([]);(0,t.useEffect)(()=>{a&&s()},[a]);const s=()=>{const e=p();i(e)};return a?(0,r.jsx)("div",{className:"mobile-activity-overlay",onClick:o,children:(0,r.jsxs)("div",{className:"mobile-activity-panel",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"mobile-activity-header",children:[(0,r.jsxs)("h2",{children:["\ud83d\udccb Historie aktivit",(0,r.jsx)("span",{className:"mobile-activity-count",children:n.length})]}),(0,r.jsx)("button",{className:"mobile-activity-close",onClick:o,"aria-label":"Zav\u0159\xedt",children:(0,r.jsx)(l.g,{icon:c.GRI})})]}),(0,r.jsx)("div",{className:"mobile-activity-subtitle",children:"Posledn\xed aktivity za 24 hodin"}),(0,r.jsx)("div",{className:"mobile-activity-list",children:0===n.length?(0,r.jsxs)("div",{className:"mobile-activity-empty",children:[(0,r.jsx)(l.g,{icon:c.iW_,className:"empty-icon"}),(0,r.jsx)("p",{children:"Zat\xedm \u017e\xe1dn\xe9 aktivity"}),(0,r.jsx)("span",{className:"empty-hint",children:"Schv\xe1len\xed a dal\u0161\xed akce se zobraz\xed zde"})]}):n.map(e=>{var a,o,n,t;return(0,r.jsxs)("div",{className:"mobile-activity-card ".concat(g(e.activityType)),"data-entity-id":(null===(a=e.metadata)||void 0===a?void 0:a.orderId)||e.id,children:[(0,r.jsx)("div",{className:"activity-icon",children:(0,r.jsx)(l.g,{icon:(t=e.activityType,t.includes("approved")?c.SGM:t.includes("rejected")?c.s0Q:t.includes("waiting")?c.TuH:t.includes("created")?c.OQW:t.includes("updated")?c.MT7:t.includes("deleted")?c.yLS:c.iW_)})}),(0,r.jsxs)("div",{className:"activity-content",children:[(0,r.jsxs)("div",{className:"activity-meta",children:[(0,r.jsx)("span",{className:"activity-entity",children:(n=e.entityType,{[h.ORDER]:"Objedn\xe1vka",[h.INVOICE]:"Faktura",[h.CASHBOOK]:"Pokladna"}[n]||n)}),(0,r.jsx)("span",{className:"activity-time",children:y(e.timestamp)})]}),(0,r.jsxs)("div",{className:"activity-title",children:["Ev. \u010d\xedslo: ",(null===(o=e.metadata)||void 0===o?void 0:o.orderNumber)||e.entityId]}),e.title&&!e.title.startsWith("Objedn\xe1vka")&&(0,r.jsx)("div",{className:"activity-description",style:{fontWeight:600,color:"#212529",marginBottom:"0.25rem"},children:e.title}),(0,r.jsx)("div",{className:"activity-description",children:e.description}),e.amount&&(0,r.jsx)("div",{className:"activity-amount",children:new Intl.NumberFormat("cs-CZ",{style:"currency",currency:"CZK",minimumFractionDigits:0,maximumFractionDigits:0}).format(e.amount)})]})]},e.id)})}),n.length>0&&(0,r.jsx)("div",{className:"mobile-activity-footer",children:(0,r.jsxs)("button",{className:"mobile-activity-clear-btn",onClick:()=>{window.confirm("Opravdu smazat celou historii aktivit?")&&(j(),i([]))},children:[(0,r.jsx)(l.g,{icon:c.yLS}),"Vymazat historii"]})})]})}):null};const k=function(e){let{show:a,type:o="approved",message:n="\xdasp\u011b\u0161n\u011b provedeno",onComplete:i}=e;const[s,d]=(0,t.useState)("hidden");return(0,t.useEffect)(()=>{if(a){d("show");const e=setTimeout(()=>{d("flyaway")},1200),a=setTimeout(()=>{d("hidden"),i&&i()},2e3);return()=>{clearTimeout(e),clearTimeout(a)}}},[a,i]),"hidden"===s?null:(0,r.jsx)("div",{className:"mobile-success-animation ".concat(s," ").concat((()=>{switch(o){case"approved":default:return"success-animation-approved";case"rejected":return"success-animation-rejected";case"waiting":return"success-animation-waiting"}})()),children:(0,r.jsxs)("div",{className:"success-animation-content",children:[(0,r.jsx)("div",{className:"success-animation-icon",children:(0,r.jsx)(l.g,{icon:(()=>{switch(o){case"approved":default:return c.SGM;case"rejected":return c.s0Q;case"waiting":return c.TuH}})()})}),(0,r.jsx)("div",{className:"success-animation-message",children:n})]})})};const x=function(e){var a,o,n,i,s,d,u;let{order:m,onApprove:v,onReject:h,onWait:p,loading:b}=e;const[j,g]=(0,t.useState)(null),y=async(e,a)=>{g(e);try{await a(m)}finally{g(null)}},f=parseFloat(m.max_cena_s_dph||0);let k="Neuvedeno",x=null,N=null;if(m.financovani){if("object"===typeof m.financovani)N=m.financovani;else if("string"===typeof m.financovani)try{N=JSON.parse(m.financovani)}catch(z){k=m.financovani}if(N){const e=N.kod_stavu||N.typ||"",a={LP:"Limitovan\xfd p\u0159\xedslib",SMLOUVA:"Smlouva",INDIVIDUALNI_SCHVALENI:"Individu\xe1ln\xed schv\xe1len\xed",INDIVIDUALNI:"Individu\xe1ln\xed schv\xe1len\xed",POJISTNA_UDALOST:"Pojistn\xe1 ud\xe1lost",POJISTNE_UDALOSTI:"Pojistn\xe1 ud\xe1lost"};if(k=N.nazev_stavu||N.nazev||a[e]||e||"Neuvedeno","LP"===e)if(N.lp_nazvy&&Array.isArray(N.lp_nazvy)){x=N.lp_nazvy.map(e=>e.cislo_lp||e.id).filter(Boolean).join(", ")||"LP"}else N.lp_kody&&Array.isArray(N.lp_kody)&&(x=N.lp_kody.join(", "));else"SMLOUVA"===e&&N.cislo_smlouvy?x=N.cislo_smlouvy:"INDIVIDUALNI_SCHVALENI"!==e&&"INDIVIDUALNI"!==e||!N.individualni_schvaleni?"POJISTNA_UDALOST"!==e&&"POJISTNE_UDALOSTI"!==e||!N.pojistna_udalost_cislo||(x=N.pojistna_udalost_cislo):x=N.individualni_schvaleni}}else m.zpusob_financovani&&(k=m.zpusob_financovani);const _=m.predmet||"Bez n\xe1zvu",A=m.cislo_objednavky||m.ev_cislo||"#".concat(m.id),w=1===m.mimoradna_udalost||!0===m.mimoradna_udalost;let C="Nezn\xe1m\xfd";null!==(a=m.objednatel)&&void 0!==a&&a.cele_jmeno?C=m.objednatel.cele_jmeno:null!==(o=m._enriched)&&void 0!==o&&null!==(n=o.objednatel)&&void 0!==n&&n.cele_jmeno?C=m._enriched.objednatel.cele_jmeno:m.objednatel_cele_jmeno?C=m.objednatel_cele_jmeno:m.objednatel_jmeno?C=m.objednatel_jmeno:m.jmeno&&(C=m.jmeno);let S=null;return null!==(i=m.garant_uzivatel)&&void 0!==i&&i.cele_jmeno?S=m.garant_uzivatel.cele_jmeno:null!==(s=m._enriched)&&void 0!==s&&null!==(d=s.garant)&&void 0!==d&&d.cele_jmeno?S=m._enriched.garant.cele_jmeno:m.garant_cele_jmeno?S=m.garant_cele_jmeno:m.garant_jmeno&&(S=m.garant_jmeno),(0,r.jsxs)("div",{className:"mobile-approval-card ".concat(w?"urgent":""),children:[(0,r.jsxs)("div",{className:"mobile-approval-header",children:[(0,r.jsxs)("span",{className:"mobile-approval-number",children:[A,w&&(0,r.jsx)("span",{className:"mobile-approval-urgent-badge",children:" \u26a0\ufe0f"})]}),(0,r.jsx)("span",{className:"mobile-approval-objednatel",children:C})]}),(0,r.jsx)("div",{className:"mobile-approval-subject",children:_}),(0,r.jsxs)("div",{className:"mobile-approval-details",children:[(0,r.jsxs)("div",{className:"mobile-approval-detail-row",children:[S&&(0,r.jsxs)("div",{className:"mobile-approval-detail mobile-approval-detail-half",children:[(0,r.jsx)("span",{className:"mobile-approval-label",children:"Garant:"}),(0,r.jsx)("span",{className:"mobile-approval-value",children:S})]}),(0,r.jsxs)("div",{className:"mobile-approval-detail mobile-approval-detail-half",children:[(0,r.jsx)("span",{className:"mobile-approval-label",children:"Max. cena s DPH:"}),(0,r.jsx)("span",{className:"mobile-approval-value",children:(E=f,new Intl.NumberFormat("cs-CZ",{style:"currency",currency:"CZK",minimumFractionDigits:0,maximumFractionDigits:0}).format(E))})]})]}),(0,r.jsxs)("div",{className:"mobile-approval-detail",children:[(0,r.jsx)("span",{className:"mobile-approval-label",children:"Zdroj financov\xe1n\xed:"}),(0,r.jsx)("span",{className:"mobile-approval-value",children:x?"".concat(k," : ").concat(x):k})]}),(null===(u=m.financovani)||void 0===u?void 0:u.poznamka)&&(0,r.jsxs)("div",{className:"mobile-approval-detail",children:[(0,r.jsx)("span",{className:"mobile-approval-label",children:"Pozn\xe1mka:"}),(0,r.jsx)("span",{className:"mobile-approval-value",children:m.financovani.poznamka})]})]}),(0,r.jsxs)("div",{className:"mobile-approval-actions",children:[(0,r.jsxs)("button",{className:"mobile-approval-btn approve",onClick:()=>y("approve",v),disabled:b||null!==j,title:"Schv\xe1lit objedn\xe1vku",children:["approve"===j?(0,r.jsx)(l.g,{icon:c.z1G,spin:!0}):(0,r.jsx)(l.g,{icon:c.e68}),(0,r.jsx)("span",{children:"Schv\xe1lit"})]}),(0,r.jsxs)("button",{className:"mobile-approval-btn reject",onClick:()=>y("reject",h),disabled:b||null!==j,title:"Zam\xedtnout objedn\xe1vku",children:["reject"===j?(0,r.jsx)(l.g,{icon:c.z1G,spin:!0}):(0,r.jsx)(l.g,{icon:c.GRI}),(0,r.jsx)("span",{children:"Zam\xedtnout"})]}),(0,r.jsxs)("button",{className:"mobile-approval-btn wait",onClick:()=>y("wait",p),disabled:b||null!==j,title:"Ozna\u010dit jako \u010dek\xe1 se",children:["wait"===j?(0,r.jsx)(l.g,{icon:c.z1G,spin:!0}):(0,r.jsx)(l.g,{icon:c.a$}),(0,r.jsx)("span",{children:"\u010cek\xe1 se"})]})]})]});var E};const N=function(e){let{isOpen:a,onClose:o,onConfirm:n,title:i,message:s,confirmText:l="Potvrdit",cancelText:c="Zru\u0161it",requireReason:d=!1,reasonPlaceholder:u="Zadejte d\u016fvod...",variant:m="primary"}=e;const[v,h]=(0,t.useState)(""),[p,b]=(0,t.useState)("");(0,t.useEffect)(()=>{a&&(h(""),b(""))},[a]),(0,t.useEffect)(()=>(document.body.style.overflow=a?"hidden":"",()=>{document.body.style.overflow=""}),[a]);const j=()=>{o()};return a?(0,r.jsx)("div",{className:"mobile-confirm-overlay",onClick:j,children:(0,r.jsxs)("div",{className:"mobile-confirm-dialog ".concat(m),onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("div",{className:"mobile-confirm-header",children:(0,r.jsx)("h3",{children:i})}),(0,r.jsxs)("div",{className:"mobile-confirm-body",children:[s&&(0,r.jsx)("p",{className:"mobile-confirm-message",children:s}),d&&(0,r.jsxs)("div",{className:"mobile-confirm-reason",children:[(0,r.jsx)("textarea",{value:v,onChange:e=>{h(e.target.value),b("")},placeholder:u,rows:4,autoFocus:!0}),p&&(0,r.jsx)("div",{className:"mobile-confirm-error",children:p})]})]}),(0,r.jsxs)("div",{className:"mobile-confirm-actions",children:[(0,r.jsx)("button",{className:"mobile-confirm-btn cancel",onClick:j,children:c}),(0,r.jsx)("button",{className:"mobile-confirm-btn confirm ".concat(m),onClick:()=>{!d||v.trim()?(n(v.trim()),o()):b("D\u016fvod je povinn\xfd")},children:l})]})]})}):null};var _=o(49690),A=o(44649),w=o(30264),C=o(95680),S=o(34795);const E={async getAllMobileData(e){let{token:a,username:o,year:n=(new Date).getFullYear(),userId:t=null,isAdmin:i=!1}=e;try{var s,l,c,r,d,u;const e=(new Date).getMonth()+1;console.log("[MobileData] Loading data for year:",n,"token:",a?"present":"MISSING","username:",o);const m=await S.Ay.getHierarchyConfigCached(a,o);console.log("[MobileData] \ud83c\udfe2 Hierarchy status:",m.status,"for orders:",m.modules.orders);const[v,h,p]=await Promise.allSettled([(0,A.cn)({rok:n},a,o,!1,!0),(0,w.uA)({token:a,username:o,year:n,page:1,per_page:1e3}),C.default.getCashboxListByPeriod(n,e,!0,!0)]);console.log("[MobileData] Orders result:",v.status,"fulfilled"===v.status?"".concat((null===(s=v.value)||void 0===s?void 0:s.length)||0," items"):v.reason),console.log("[MobileData] Invoices result:",h.status,"fulfilled"===h.status?"".concat((null===(l=h.value)||void 0===l||null===(c=l.faktury)||void 0===c?void 0:c.length)||0," items"):h.reason),console.log("[MobileData] Cashbook result:",p.status,"fulfilled"===p.status?null===(r=p.value)||void 0===r?void 0:r.status:p.reason);let b=null;"fulfilled"===v.status&&Array.isArray(v.value)?(console.log("[MobileData] \u2705 Processing orders from API:",v.value.length),b=this.calculateOrdersStats(v.value,t,i)):(console.error("[MobileData] \u274c Orders API FAILED! Reason:",v.reason),b={total:0,totalAmount:0,pending:{count:0,amount:0},approved:{count:0,amount:0},inProgress:{count:0,amount:0},completed:{count:0,amount:0},rejected:{count:0,amount:0},cancelled:{count:0,amount:0}});let j=null;"fulfilled"===h.status&&null!==(d=h.value)&&void 0!==d&&d.faktury?(console.log("[MobileData] \u2705 Processing invoices from API:",h.value.faktury.length),j=this.calculateInvoicesStats(h.value.faktury)):(console.error("[MobileData] \u274c Invoices API FAILED! Reason:",h.reason),j={total:0,totalAmount:0,paid:{count:0,amount:0},unpaid:{count:0,amount:0},overdue:{count:0,amount:0},regular:{count:0,amount:0},advance:{count:0,amount:0},corrective:{count:0,amount:0},proforma:{count:0,amount:0},creditNote:{count:0,amount:0},withoutAssignment:{count:0,amount:0}});let g=null;return"fulfilled"===p.status&&"ok"===(null===(u=p.value)||void 0===u?void 0:u.status)?(console.log("[MobileData] \u2705 Processing cashbook from API"),g=this.calculateCashbookStats(p.value.data)):(console.error("[MobileData] \u274c Cashbook API FAILED! Reason:",p.reason),g={count:0,balance:0,pokladny:[]}),{success:!0,data:{orders:b,invoices:j,cashbook:g,notifications:{unread:0}},meta:{year:n,period:"Rok ".concat(n),dataSource:{orders:"fulfilled"===v.status?"API":"MOCK",invoices:"fulfilled"===h.status?"API":"MOCK",cashbook:"fulfilled"===p.status?"API":"MOCK"},hierarchy:{status:m.status,enabled:m.enabled,profileName:m.profileName,logic:m.logic,message:S.Ay.getHierarchyInfoMessage(m,S.fb.ORDERS)}}}}catch(m){return console.error("[MobileData] \u274c CRITICAL ERROR loading mobile data:",m),{success:!1,error:m.message,data:{orders:{total:0,totalAmount:0,pending:{count:0,amount:0},approved:{count:0,amount:0},inProgress:{count:0,amount:0},completed:{count:0,amount:0},rejected:{count:0,amount:0},cancelled:{count:0,amount:0}},invoices:{total:0,totalAmount:0,paid:{count:0,amount:0},unpaid:{count:0,amount:0},overdue:{count:0,amount:0},regular:{count:0,amount:0},advance:{count:0,amount:0},corrective:{count:0,amount:0},proforma:{count:0,amount:0},creditNote:{count:0,amount:0},withoutAssignment:{count:0,amount:0}},cashbook:{count:0,balance:0,pokladny:[]},notifications:{unread:0}},meta:{year:(new Date).getFullYear(),period:"ERROR",dataSource:{orders:"ERROR",invoices:"ERROR",cashbook:"ERROR"}}}}},calculateOrdersStats(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=e=>{const a=t(e);if(("DOKONCENA"===a||"VYRIZENA"===a||"COMPLETED"===a)&&e.faktury&&Array.isArray(e.faktury)&&e.faktury.length>0){const a=e.faktury.reduce((e,a)=>{const o=parseFloat(a.fa_castka||0);return e+(isNaN(o)?0:o)},0);if(a>0)return a}if(null!=e.polozky_celkova_cena_s_dph&&""!==e.polozky_celkova_cena_s_dph){const a=parseFloat(e.polozky_celkova_cena_s_dph);if(!isNaN(a)&&a>0)return a}if(e.polozky&&Array.isArray(e.polozky)&&e.polozky.length>0){const a=e.polozky.reduce((e,a)=>{const o=parseFloat(a.cena_s_dph||0);return e+(isNaN(o)?0:o)},0);if(a>0)return a}if(null!=e.max_cena_s_dph&&""!==e.max_cena_s_dph){const a=parseFloat(e.max_cena_s_dph);if(!isNaN(a))return a}return 0},t=e=>{if(e.isDraft||e.je_koncept)return"NOVA";let a;if(e.stav_workflow_kod)try{const o=Array.isArray(e.stav_workflow_kod)?e.stav_workflow_kod:JSON.parse(e.stav_workflow_kod);a=Array.isArray(o)?o[o.length-1]:e.stav_workflow_kod}catch(o){a=e.stav_workflow_kod}else a="DRAFT";return a};let i=e.filter(e=>e.id&&e.id>1&&!e.isLocalConcept);!o&&a&&(i=i.filter(e=>e.prikazce_id===a),console.log("[MobileData] Non-admin user",a,"- filtered to",i.length,"orders (where prikazce_id matches)"));const s=i.length,l=i.reduce((e,a)=>{const o=t(a);return e[o]=(e[o]||0)+1,e},{}),c=i.reduce((e,a)=>{const o=n(a);return e+(isNaN(o)?0:o)},0);return console.log("[MobileData] Stats:",{total:s,totalAmount:c,validOrders:i.length,allOrders:e.length,byStatus:l}),{total:s,totalAmount:c,pending:{count:l.ODESLANA_KE_SCHVALENI||0,amount:i.filter(e=>"ODESLANA_KE_SCHVALENI"===t(e)).reduce((e,a)=>e+n(a),0)},approved:{count:l.SCHVALENA||0,amount:i.filter(e=>"SCHVALENA"===t(e)).reduce((e,a)=>e+n(a),0)},maBytZverejnena:{count:l.K_UVEREJNENI_DO_REGISTRU||0,amount:i.filter(e=>"K_UVEREJNENI_DO_REGISTRU"===t(e)).reduce((e,a)=>e+n(a),0)},uverejnena:{count:l.UVEREJNENA||0,amount:i.filter(e=>"UVEREJNENA"===t(e)).reduce((e,a)=>e+n(a),0)},vecnaSpravnost:{count:l.VECNA_SPRAVNOST||0,amount:i.filter(e=>"VECNA_SPRAVNOST"===t(e)).reduce((e,a)=>e+n(a),0)},completed:{count:l.DOKONCENA||0,amount:i.filter(e=>"DOKONCENA"===t(e)).reduce((e,a)=>e+n(a),0)},rejected:{count:l.ZAMITNUTA||0,amount:i.filter(e=>"ZAMITNUTA"===t(e)).reduce((e,a)=>e+n(a),0)},cancelled:{count:l.ZRUSENA||0,amount:i.filter(e=>"ZRUSENA"===t(e)).reduce((e,a)=>e+n(a),0)}}},calculateInvoicesStats(e){const a=new Date;a.setHours(0,0,0,0);const o={total:e.length,totalAmount:0,paid:{count:0,amount:0},unpaid:{count:0,amount:0},overdue:{count:0,amount:0},regular:{count:0,amount:0},advance:{count:0,amount:0},corrective:{count:0,amount:0},proforma:{count:0,amount:0},creditNote:{count:0,amount:0},withoutAssignment:{count:0,amount:0}};return e.forEach(e=>{const n=parseFloat(e.fa_castka||0);o.totalAmount+=n;const t=(e=>{if(1===e.fa_zaplacena||!0===e.fa_zaplacena)return"paid";if(e.fa_datum_splatnosti){const o=new Date(e.fa_datum_splatnosti);if(o.setHours(0,0,0,0),o<a)return"overdue"}return"unpaid"})(e);"paid"===t?(o.paid.count++,o.paid.amount+=n):(o.unpaid.count++,o.unpaid.amount+=n,"overdue"===t&&(o.overdue.count++,o.overdue.amount+=n));const i=e.fa_typ;switch(i&&"string"===typeof i?i.toUpperCase():"BEZNA"){case"BEZNA":default:o.regular.count++,o.regular.amount+=n;break;case"ZALOHOVA":o.advance.count++,o.advance.amount+=n;break;case"OPRAVNA":o.corrective.count++,o.corrective.amount+=n;break;case"PROFORMA":o.proforma.count++,o.proforma.amount+=n;break;case"DOBROPIS":o.creditNote.count++,o.creditNote.amount+=n}e.objednavka_id||e.smlouva_id||(o.withoutAssignment.count++,o.withoutAssignment.amount+=n)}),o},calculateCashbookStats(e){const a=(null===e||void 0===e?void 0:e.pokladny)||[];if(0===a.length)return{count:0,balance:0,pokladny:[]};let o=0,n=0;const t=a.map(e=>{const a=parseInt(e.pocet_zaznamu||0,10),t=parseFloat(e.koncovy_stav||0),i=parseFloat(e.pocatecni_stav||0),s=parseFloat(e.celkove_prijmy||0),l=parseFloat(e.celkove_vydaje||0),c=parseInt(e.prijmy_pocet||0,10),r=parseInt(e.vydaje_pocet||0,10);o+=a,n+=t;const d=parseFloat(e.prevod_z_predchoziho||0);return{id:e.id,cislo_pokladny:e.cislo_pokladny,nazev:e.nazev,pocet_zaznamu:a,koncovy_stav:t,pocatecni_stav:i,prevod:d,aktivni:1===e.aktivni||"1"===e.aktivni,prijmy_castka:s,prijmy_pocet:c,vydaje_castka:l,vydaje_pocet:r}});return{count:o,balance:n,pokladny:t}}};var z=o(75949),O=o(33637),I=o(98951);function D(e){let{widget:a}=e;return(0,r.jsxs)("div",{className:"mobile-widget-card ".concat(a.color),children:[(0,r.jsxs)("div",{className:"mobile-widget-header",children:[null!==a.count&&void 0!==a.count&&(0,r.jsx)("div",{className:"mobile-widget-count",children:a.count}),(0,r.jsx)("div",{className:"mobile-widget-icon",children:(0,r.jsx)(l.g,{icon:a.icon})})]}),(0,r.jsxs)("div",{className:"mobile-widget-info",children:[(0,r.jsx)("div",{className:"mobile-widget-title",children:a.title}),null!==a.amount&&void 0!==a.amount&&(0,r.jsx)("div",{className:"mobile-widget-amount",children:(o=a.amount,new Intl.NumberFormat("cs-CZ",{style:"currency",currency:"CZK",minimumFractionDigits:0,maximumFractionDigits:0}).format(o))})]}),a.subtitle&&(0,r.jsx)("div",{className:"mobile-widget-subtitle",children:a.subtitle})]});var o}function R(e){let{cashbook:a,formatCurrency:o}=e;const n=a.cislo?"Pokladna ".concat(a.cislo):"Pokladna";return(0,r.jsxs)("div",{className:"mobile-cashbook-card",children:[a.nazev&&(0,r.jsxs)("div",{className:"mobile-cashbook-title",children:[n," - ",a.nazev]}),(0,r.jsxs)("div",{className:"mobile-cashbook-grid",children:[(0,r.jsxs)("div",{className:"mobile-cashbook-item",children:[(0,r.jsx)("div",{className:"mobile-cashbook-label",children:"P\u0159evod"}),(0,r.jsx)("div",{className:"mobile-cashbook-value",children:o(a.prevod)})]}),(0,r.jsxs)("div",{className:"mobile-cashbook-item highlight",children:[(0,r.jsx)("div",{className:"mobile-cashbook-label",children:"Z\u016fstatek"}),(0,r.jsx)("div",{className:"mobile-cashbook-value",children:o(a.zustatek)})]}),(0,r.jsxs)("div",{className:"mobile-cashbook-item",children:[(0,r.jsx)("div",{className:"mobile-cashbook-label",children:"P\u0159\xedjmy"}),(0,r.jsxs)("div",{className:"mobile-cashbook-count",children:[a.prijmy," ks"]}),(0,r.jsx)("div",{className:"mobile-cashbook-amount",children:o(a.prijmyCastka)})]}),(0,r.jsxs)("div",{className:"mobile-cashbook-item",children:[(0,r.jsx)("div",{className:"mobile-cashbook-label",children:"V\xfddaje"}),(0,r.jsxs)("div",{className:"mobile-cashbook-count",children:[a.vydaje," ks"]}),(0,r.jsx)("div",{className:"mobile-cashbook-amount",children:o(a.vydajeCastka)})]})]})]})}const M=function(){var e,a,o;const{user:m,userDetail:j,token:g,username:y}=(0,t.useContext)(i.cy),{mode:w}=(0,s.A)(),[C,S]=(0,t.useState)(!1),[M,L]=(0,t.useState)(!0),[T,H]=(0,t.useState)({orders:null,invoices:null,cashbook:null,notifications:null}),[P,V]=(0,t.useState)(!1),[F,Z]=(0,t.useState)((new Date).getFullYear()),[B,U]=(0,t.useState)([]),[K,J]=(0,t.useState)([]),[G,W]=(0,t.useState)(!1),[q,Y]=(0,t.useState)(!1),[Q,$]=(0,t.useState)("all"),[X,ee]=(0,t.useState)(""),[ae,oe]=(0,t.useState)(!1),[ne,te]=(0,t.useState)(!1),[ie,se]=(0,t.useState)(null),[le,ce]=(0,t.useState)({}),[re,de]=(0,t.useState)(!1),[ue,me]=(0,t.useState)(0),[ve,he]=(0,t.useState)({show:!1,type:"approved",message:""});(0,t.useEffect)(()=>{(async()=>{if(g&&y)if("function"===typeof O.IA)try{const e=await(0,O.IA)({token:g,username:y});ce(e||{}),console.log("[MobileDashboard] \u010c\xedseln\xedk stav\u016f na\u010dten:",Object.keys(e||{}).length,"stav\u016f")}catch(e){console.error("[MobileDashboard] Chyba na\u010d\xedt\xe1n\xed \u010d\xedseln\xedku stav\u016f:",e)}else console.error("[MobileDashboard] getStavyWorkflow25 nen\xed dostupn\xe1 funkce!")})()},[g,y]);const pe=e=>{const a=le[e];if(console.log("[getStavObjednavky]",e,"\u2192",a?a.nazev:"FALLBACK"),a)return a.nazev;return{SCHVALENA:"Schv\xe1len\xe1",ZAMITNUTA:"Zam\xedtnut\xe1",CEKA_SE:"\u010cek\xe1 se",ODESLANA_KE_SCHVALENI:"Ke schv\xe1len\xed",NOVA:"Nov\xe1"}[e]||e},be=()=>{const e=new Date,a=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),t=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");return"".concat(a,"-").concat(o,"-").concat(n," ").concat(t,":").concat(i,":").concat(s)},je=m?(0,n.A)((0,n.A)({},m),{},{displayName:(null===j||void 0===j?void 0:j.jmeno_prijmeni_titul)||(null===j||void 0===j?void 0:j.jmeno_prijmeni)||m.username,mail:(null===j||void 0===j?void 0:j.email)||"",upn:m.username}):null,ge=(null===j||void 0===j||null===(e=j.roles)||void 0===e?void 0:e.some(e=>"SUPERADMIN"===e.kod_role||"ADMINISTRATOR"===e.kod_role))||!1,ye=ge||(null===j||void 0===j||null===(a=j.permissions)||void 0===a?void 0:a.some(e=>"ORDER_APPROVE"===e.kod_opravneni))||!1,fe=e=>{const a=document.querySelector('[data-section="'.concat(e,'"]'));if(a){const e=.5*parseFloat(getComputedStyle(document.documentElement).fontSize),o=a.offsetTop-108-e;window.scrollTo({top:o,behavior:"smooth"})}};(0,t.useEffect)(()=>{xe(),ke()},[F]);const ke=()=>{const e=p();me(e.length)},xe=async()=>{try{L(!0),await _e()}catch(e){}finally{L(!1)}},Ne=async()=>{if(g&&y&&ye&&null!==j&&void 0!==j&&j.id)try{W(!0);const e=await(0,A.cn)({rok:F},g,y,!1,!0);if(Array.isArray(e)){const a=e.filter(e=>{if(!e.id||e.id<=1)return!1;try{const a=Array.isArray(e.stav_workflow_kod)?e.stav_workflow_kod:JSON.parse(e.stav_workflow_kod||"[]");return Array.isArray(a)&&a.includes("ODESLANA_KE_SCHVALENI")}catch(a){return!1}}).filter(e=>e.prikazce_id===(null===j||void 0===j?void 0:j.id));J(a)}}catch(e){J([])}finally{W(!1)}},_e=async()=>{try{var e;if(!g||!y)return void H({orders:null,invoices:null,cashbook:null,notifications:{unread:0}});console.log("[MobileDashboard] Loading real data for year:",F,"token:",g?"present":"MISSING","username:",y);const a=await E.getAllMobileData({token:g,username:y,year:F,userId:null===j||void 0===j?void 0:j.id,isAdmin:ge});console.log("[MobileDashboard] Result received:",a),console.log("[MobileDashboard] Data sources:",null===(e=a.meta)||void 0===e?void 0:e.dataSource),a.success&&(H(a.data),ge&&await(async()=>{if(g&&y&&ge)try{const e=await(0,z.m1)({token:g,username:y});U(e||[])}catch(e){console.error("[MobileDashboard] Error loading active users:",e)}})(),ye&&await Ne())}catch(a){}},Ae=e=>new Intl.NumberFormat("cs-CZ",{style:"currency",currency:"CZK",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);if(M)return(0,r.jsx)(_.default,{message:P?"Obnovuji data...":"Na\u010d\xedt\xe1m dashboard..."});const we=(null===(o=T.notifications)||void 0===o?void 0:o.unread)||0,Ce=[];var Se,Ee,ze,Oe,Ie,De,Re,Me,Le,Te,He;T.orders&&(Ce.push({id:"orders-pending",title:"Ke schv\xe1len\xed",count:(null===(Se=T.orders.pending)||void 0===Se?void 0:Se.count)||0,amount:(null===(Ee=T.orders.pending)||void 0===Ee?void 0:Ee.amount)||0,icon:(0,I.cR)("ke_schvaleni"),color:"orange",category:"orders"}),(null===(ze=T.orders.approved)||void 0===ze?void 0:ze.count)>0&&Ce.push({id:"orders-approved",title:"Schv\xe1leno",count:T.orders.approved.count,amount:T.orders.approved.amount,icon:(0,I.cR)("schvalena"),color:"green",category:"orders"}),Ce.push({id:"orders-ma-byt-zverejnena",title:"M\xe1 b\xfdt zve\u0159ejn\u011bna",count:(null===(Oe=T.orders.maBytZverejnena)||void 0===Oe?void 0:Oe.count)||0,amount:(null===(Ie=T.orders.maBytZverejnena)||void 0===Ie?void 0:Ie.amount)||0,icon:(0,I.cR)("k_uverejneni_do_registru"),color:"teal",category:"orders"}),Ce.push({id:"orders-uverejnena",title:"Uve\u0159ejn\u011bn\xe1",count:(null===(De=T.orders.uverejnena)||void 0===De?void 0:De.count)||0,amount:(null===(Re=T.orders.uverejnena)||void 0===Re?void 0:Re.amount)||0,icon:(0,I.cR)("uverejnena"),color:"blue",category:"orders"}),(null===(Me=T.orders.vecnaSpravnost)||void 0===Me?void 0:Me.count)>0&&Ce.push({id:"orders-vecna-spravnost",title:"V\u011bcn\xe1 spr\xe1vnost",count:T.orders.vecnaSpravnost.count,amount:T.orders.vecnaSpravnost.amount,icon:(0,I.cR)("vecna_spravnost"),color:"purple",category:"orders"}),(null===(Le=T.orders.completed)||void 0===Le?void 0:Le.count)>0&&Ce.push({id:"orders-completed",title:"Dokon\u010deno",count:T.orders.completed.count,amount:T.orders.completed.amount,icon:(0,I.cR)("dokoncena"),color:"teal",category:"orders"}),(null===(Te=T.orders.rejected)||void 0===Te?void 0:Te.count)>0&&Ce.push({id:"orders-rejected",title:"Zam\xedtnuto",count:T.orders.rejected.count,amount:T.orders.rejected.amount,icon:(0,I.cR)("zamitnuta"),color:"red",category:"orders"}),(null===(He=T.orders.cancelled)||void 0===He?void 0:He.count)>0&&Ce.push({id:"orders-cancelled",title:"Zru\u0161eno",count:T.orders.cancelled.count,amount:T.orders.cancelled.amount,icon:(0,I.cR)("zrusena"),color:"gray",category:"orders"}));const Pe=[],Ve=[];var Fe,Ze,Be,Ue,Ke,Je,Ge,We,qe;T.invoices&&((null===(Fe=T.invoices.paid)||void 0===Fe?void 0:Fe.count)>0&&Pe.push({id:"invoices-paid",title:"Zaplaceno",count:T.invoices.paid.count,amount:T.invoices.paid.amount,icon:c.SGM,color:"green",category:"invoices-status"}),(null===(Ze=T.invoices.unpaid)||void 0===Ze?void 0:Ze.count)>0&&Pe.push({id:"invoices-unpaid",title:"Nezaplaceno",count:T.invoices.unpaid.count,amount:T.invoices.unpaid.amount,icon:c.TuH,color:"orange",category:"invoices-status"}),(null===(Be=T.invoices.overdue)||void 0===Be?void 0:Be.count)>0&&Pe.push({id:"invoices-overdue",title:"Po splatnosti",count:T.invoices.overdue.count,amount:T.invoices.overdue.amount,icon:c.zpE,color:"red",category:"invoices-status"}),(null===(Ue=T.invoices.regular)||void 0===Ue?void 0:Ue.count)>0&&Ve.push({id:"invoices-regular",title:"B\u011b\u017en\xe1",count:T.invoices.regular.count,amount:T.invoices.regular.amount,icon:(0,I.cR)("schvalena"),color:"blue",category:"invoices"}),(null===(Ke=T.invoices.advance)||void 0===Ke?void 0:Ke.count)>0&&Ve.push({id:"invoices-advance",title:"Z\xe1lohov\xe1",count:T.invoices.advance.count,amount:T.invoices.advance.amount,icon:(0,I.cR)("ke_schvaleni"),color:"purple",category:"invoices"}),(null===(Je=T.invoices.corrective)||void 0===Je?void 0:Je.count)>0&&Ve.push({id:"invoices-corrective",title:"Opravn\xe1",count:T.invoices.corrective.count,amount:T.invoices.corrective.amount,icon:(0,I.cR)("rozpracovana"),color:"teal",category:"invoices"}),(null===(Ge=T.invoices.proforma)||void 0===Ge?void 0:Ge.count)>0&&Ve.push({id:"invoices-proforma",title:"Proforma",count:T.invoices.proforma.count,amount:T.invoices.proforma.amount,icon:(0,I.cR)("potvrzena"),color:"blue",category:"invoices"}),(null===(We=T.invoices.creditNote)||void 0===We?void 0:We.count)>0&&Ve.push({id:"invoices-creditnote",title:"Dobropis",count:T.invoices.creditNote.count,amount:T.invoices.creditNote.amount,icon:(0,I.cR)("zrusena"),color:"gray",category:"invoices"}),(null===(qe=T.invoices.withoutAssignment)||void 0===qe?void 0:qe.count)>0&&Ve.push({id:"invoices-without-assignment",title:"Bez p\u0159i\u0159azen\xed",count:T.invoices.withoutAssignment.count,amount:T.invoices.withoutAssignment.amount,icon:c.s0Q,color:"gray",category:"invoices"}));const Ye=[];if(T.cashbook&&T.cashbook.pokladny&&T.cashbook.pokladny.length>0){T.cashbook.pokladny.forEach(e=>{e.aktivni&&Ye.push({id:e.id,cislo:e.cislo_pokladny,nazev:e.nazev||"",zaznamy:e.pocet_zaznamu||0,prevod:e.prevod||0,zustatek:e.koncovy_stav||0,prijmy:e.prijmy_pocet||0,prijmyCastka:e.prijmy_castka||0,vydaje:e.vydaje_pocet||0,vydajeCastka:e.vydaje_castka||0})})}return(0,r.jsxs)("div",{className:"mobile-dashboard",children:[(0,r.jsx)(d,{onMenuClick:()=>S(!0),notificationCount:we,onActivityClick:()=>de(!0),activityCount:ue}),q&&(0,r.jsxs)("div",{className:"mobile-subheader",children:[(0,r.jsxs)("button",{className:"mobile-subheader-back",onClick:()=>Y(!1),children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:(0,r.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})}),"Zp\u011bt"]}),(0,r.jsxs)("h2",{className:"mobile-subheader-title",children:["Ke schv\xe1len\xed (",(()=>{const e=K.length,a=K.filter(e=>!e.mimoradna_udalost).length,o=K.filter(e=>e.mimoradna_udalost).length;return"all"===Q?"".concat(e,"/").concat(a,"/").concat(o):"normal"===Q?a:o})(),")"]}),(0,r.jsxs)("div",{className:"mobile-subheader-filters",children:[(0,r.jsx)("button",{className:"mobile-filter-btn ".concat("all"===Q?"active":""),onClick:()=>$("all"),title:"V\u0161echny objedn\xe1vky",children:(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18",children:(0,r.jsx)("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"})})}),(0,r.jsx)("button",{className:"mobile-filter-btn ".concat("normal"===Q?"active":""),onClick:()=>$("normal"),title:"Norm\xe1ln\xed objedn\xe1vky",children:(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18",children:(0,r.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})})}),(0,r.jsx)("button",{className:"mobile-filter-btn ".concat("urgent"===Q?"active":""),onClick:()=>$("urgent"),title:"Mimo\u0159\xe1dn\xe9 objedn\xe1vky",children:(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18",children:(0,r.jsx)("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"})})})]})]}),(0,r.jsx)(u,{isOpen:C,onClose:()=>S(!1),user:je,userDetail:j,authUser:m,onNavigate:e=>{"dashboard"===e?(Y(!1),window.scrollTo({top:0,behavior:"smooth"}),_e(),ke()):"activity"===e&&de(!0)}}),q?(0,r.jsx)(r.Fragment,{children:G?(0,r.jsx)("div",{className:"mobile-dashboard-content",children:(0,r.jsxs)("div",{className:"mobile-refresh-indicator",children:[(0,r.jsx)("div",{className:"spinner-circle small"}),(0,r.jsx)("span",{children:"Na\u010d\xedt\xe1m objedn\xe1vky..."})]})}):K.length>0?(0,r.jsxs)("div",{className:"mobile-approval-list",children:[(0,r.jsx)("div",{className:"mobile-approval-search",children:(0,r.jsxs)("div",{className:"mobile-approval-search-wrapper",children:[(0,r.jsx)("input",{type:"text",placeholder:"Vyhledat objedn\xe1vku...",value:X,onChange:e=>ee(e.target.value)}),X&&(0,r.jsx)("button",{className:"mobile-approval-search-clear",onClick:()=>ee(""),title:"Vymazat vyhled\xe1v\xe1n\xed",children:(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:(0,r.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]})}),K.filter(e=>{if("urgent"===Q&&!e.mimoradna_udalost)return!1;if("normal"===Q&&e.mimoradna_udalost)return!1;if(X.trim()){var a,o;const n=X.toLowerCase(),t=(e.cislo_objednavky||e.ev_cislo||"").toLowerCase(),i=(e.predmet||"").toLowerCase(),s=((null===(a=e.objednatel)||void 0===a?void 0:a.cele_jmeno)||"").toLowerCase(),l=((null===(o=e.garant_uzivatel)||void 0===o?void 0:o.cele_jmeno)||"").toLowerCase();return t.includes(n)||i.includes(n)||s.includes(n)||l.includes(n)}return!0}).map(e=>(0,r.jsx)(x,{order:e,onApprove:async e=>{await(async e=>{if(g&&y&&e.id)try{const o=await(0,A.Hj)(e.id,g,y,!0);if(!o)return void alert("Objedn\xe1vku se nepoda\u0159ilo na\u010d\xedst");let n=[];try{n=Array.isArray(o.stav_workflow_kod)?o.stav_workflow_kod:JSON.parse(o.stav_workflow_kod||"[]")}catch(a){n=[]}n=n.filter(e=>!["ODESLANA_KE_SCHVALENI","CEKA_SE","ZAMITNUTA"].includes(e)),n.includes("SCHVALENA")||n.push("SCHVALENA");const t={stav_workflow_kod:JSON.stringify(n),stav_objednavky:pe("SCHVALENA"),schvalovatel_id:(null===j||void 0===j?void 0:j.id)||null,dt_schvaleni:be(),schvaleni_komentar:""};await(0,A.qA)(e.id,t,g,y),b({entityType:h.ORDER,entityId:e.ev_cislo||e.cislo_objednavky||e.id,activityType:v.ORDER_APPROVED,title:e.nazev_obj||"Objedn\xe1vka ".concat(e.ev_cislo||e.cislo_objednavky||e.id),amount:e.castka_obj||null,userName:y,description:"\u2705 Objedn\xe1vka byla schv\xe1lena",metadata:{orderNumber:e.ev_cislo||e.cislo_objednavky,orderId:e.id}}),he({show:!0,type:"approved",message:"\u2705 Objedn\xe1vka schv\xe1lena!"}),await Ne(),await _e(),ke()}catch(o){alert("Chyba: ".concat(o.message||"Nepoda\u0159ilo se schv\xe1lit objedn\xe1vku"))}})(e),1===K.length&&Y(!1)},onReject:async e=>{await(e=>{se(e),oe(!0)})(e),1===K.length&&Y(!1)},onWait:async e=>{await(e=>{se(e),te(!0)})(e),1===K.length&&Y(!1)},loading:G},e.id))]}):(0,r.jsx)("div",{className:"mobile-dashboard-content",children:(0,r.jsx)("div",{className:"mobile-empty-state-inline",children:(0,r.jsx)("p",{children:"\u2705 \u017d\xe1dn\xe9 objedn\xe1vky ke schv\xe1len\xed"})})})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("nav",{className:"mobile-quick-nav",children:[ge&&B.length>0&&(0,r.jsx)("button",{className:"mobile-quick-nav-btn",onClick:()=>fe("users"),children:"UZI"}),(0,r.jsx)("button",{className:"mobile-quick-nav-btn",onClick:()=>fe("orders"),children:"OBJ"}),(0,r.jsx)("button",{className:"mobile-quick-nav-btn",onClick:()=>fe("invoices"),children:"FAK"}),(0,r.jsx)("button",{className:"mobile-quick-nav-btn",onClick:()=>fe("cashbook"),children:"POK"})]}),(0,r.jsxs)("main",{className:"mobile-dashboard-content",children:[P&&(0,r.jsxs)("div",{className:"mobile-refresh-indicator",children:[(0,r.jsx)("div",{className:"spinner-circle small"}),(0,r.jsx)("span",{children:"Obnovuji data..."})]}),ge&&B.length>0&&(0,r.jsxs)("section",{"data-section":"users",className:"mobile-widget-section",children:[(0,r.jsxs)("div",{className:"mobile-section-header",children:[(0,r.jsx)("h2",{children:"Aktivn\xed u\u017eivatel\xe9"}),(0,r.jsx)("div",{className:"mobile-section-summary",children:(0,r.jsxs)("span",{className:"mobile-summary-count",children:[B.length," online"]})})]}),(0,r.jsxs)("div",{className:"mobile-users-card",children:[(0,r.jsx)("div",{className:"mobile-users-list",children:B.slice(0,5).map((e,a)=>{const o=new Date,n=new Date(e.dt_posledni_aktivita),t=Math.floor((o-n)/1e3),i=Math.floor(t/60);let s="";if(t<60)s="".concat(t,"s");else if(i<60)s="".concat(i,"m");else{const e=Math.floor(i/60);s="".concat(e,"h")}const l=t<270?"#22c55e":t<300?"#f59e0b":"#ef4444",c=n.toLocaleString("cs-CZ",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),d=e.stats||{},u=[];if(d.objednavky>0&&u.push("OBJ: ".concat(d.objednavky)),d.faktury>0&&u.push("FA: ".concat(d.faktury)),null!==d.pokladna_zustatek){const e=new Intl.NumberFormat("cs-CZ",{style:"currency",currency:"CZK",minimumFractionDigits:0,maximumFractionDigits:0}).format(d.pokladna_zustatek);u.push("POKL: ".concat(e))}return(0,r.jsxs)("div",{className:"mobile-user-item",children:[(0,r.jsx)("div",{className:"mobile-user-status",style:{background:l}}),(0,r.jsxs)("div",{className:"mobile-user-info",children:[(0,r.jsxs)("div",{className:"mobile-user-row",children:[(0,r.jsx)("span",{className:"mobile-user-name",children:e.cele_jmeno||e.username}),(0,r.jsxs)("span",{className:"mobile-user-time",children:[c," (",s,")"]})]}),u.length>0&&(0,r.jsxs)("span",{className:"mobile-user-stats",children:["(",u.join(", "),")"]})]})]},a)})}),B.length>5&&(0,r.jsxs)("div",{className:"mobile-users-more",children:[(0,r.jsxs)("div",{className:"mobile-users-more-title",children:["+",B.length-5," dal\u0161\xedch aktivn\xedch"]}),(0,r.jsx)("div",{className:"mobile-users-more-list",children:B.slice(5).map((e,a)=>(0,r.jsx)("span",{className:"mobile-users-more-name",children:e.cele_jmeno||e.username},a))})]})]})]}),ye&&(G||K.length>0)&&(()=>{const e=K.filter(e=>!e.mimoradna_udalost).length,a=K.filter(e=>e.mimoradna_udalost).length,o=K.reduce((e,a)=>{const o=parseFloat(a.max_cena_s_dph||0);return e+(isNaN(o)?0:o)},0);return(0,r.jsxs)("section",{"data-section":"approvals",className:"mobile-widget-section",children:[(0,r.jsx)("div",{className:"mobile-section-header",children:(0,r.jsx)("h2",{children:"Objedn\xe1vky \u010dekaj\xed na m\xe9 schv\xe1len\xed"})}),(0,r.jsxs)("div",{className:"mobile-approval-widget",onClick:()=>!G&&K.length>0&&Y(!0),children:[(0,r.jsxs)("div",{className:"mobile-approval-widget-header",children:[(0,r.jsx)("div",{className:"mobile-approval-widget-count",children:G?"...":K.length}),(0,r.jsx)("div",{className:"mobile-approval-widget-breakdown",children:G?(0,r.jsx)("div",{className:"mobile-approval-loading",children:"Na\u010d\xedt\xe1m..."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mobile-approval-normal",children:[e," norm\xe1ln\xedch"]}),a>0&&(0,r.jsxs)("div",{className:"mobile-approval-urgent",children:[a," mimo\u0159\xe1dn\xfdch \u26a0\ufe0f"]})]})}),(0,r.jsx)("div",{className:"mobile-approval-widget-icon",children:(0,r.jsx)(l.g,{icon:(0,I.cR)("ke_schvaleni")})})]}),(0,r.jsxs)("div",{className:"mobile-approval-widget-info",children:[(0,r.jsxs)("div",{className:"mobile-approval-widget-title-row",children:[(0,r.jsx)("div",{className:"mobile-approval-widget-title",children:"Ke schv\xe1len\xed"}),(0,r.jsx)("div",{className:"mobile-approval-widget-action",children:"Klikn\u011bte pro schv\xe1len\xed"})]}),(0,r.jsxs)("div",{className:"mobile-approval-widget-title-row",children:[(0,r.jsx)("div",{className:"mobile-approval-widget-subtitle",children:"Max. celkem s DPH"}),(0,r.jsx)("div",{className:"mobile-approval-widget-price",children:Ae(o)})]})]})]})]})})(),Ce.length>0&&(0,r.jsxs)("section",{"data-section":"orders",className:"mobile-widget-section",children:[(0,r.jsxs)("div",{className:"mobile-section-header",children:[(0,r.jsx)("h2",{children:"Objedn\xe1vky"}),(0,r.jsx)("div",{className:"mobile-section-summary",children:T.orders.total>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"mobile-summary-count",children:[T.orders.total," ks"]}),T.orders.totalAmount>0&&(0,r.jsx)("span",{className:"mobile-summary-amount",children:Ae(T.orders.totalAmount)})]})})]}),(0,r.jsx)("div",{className:"mobile-widget-grid",children:Ce.map(e=>(0,r.jsx)(D,{widget:e},e.id))})]}),Pe.length>0&&(0,r.jsxs)("section",{"data-section":"invoices",className:"mobile-widget-section",children:[(0,r.jsxs)("div",{className:"mobile-section-header",children:[(0,r.jsx)("h2",{children:"Faktury - stavy"}),(0,r.jsx)("div",{className:"mobile-section-summary",children:T.invoices.total>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"mobile-summary-count",children:[T.invoices.total," ks"]}),T.invoices.totalAmount>0&&(0,r.jsx)("span",{className:"mobile-summary-amount",children:Ae(T.invoices.totalAmount)})]})})]}),(0,r.jsx)("div",{className:"mobile-widget-grid",children:Pe.map(e=>(0,r.jsx)(D,{widget:e},e.id))})]}),Ve.length>0&&(0,r.jsxs)("section",{className:"mobile-widget-section",children:[(0,r.jsx)("div",{className:"mobile-section-header",children:(0,r.jsx)("h2",{children:"Faktury - typy"})}),(0,r.jsx)("div",{className:"mobile-widget-grid",children:Ve.map(e=>(0,r.jsx)(D,{widget:e},e.id))})]}),Ye.length>0&&(0,r.jsxs)("section",{"data-section":"cashbook",className:"mobile-widget-section",children:[(0,r.jsxs)("div",{className:"mobile-section-header",children:[(0,r.jsx)("h2",{children:"Pokladna"}),(0,r.jsx)("div",{className:"mobile-section-summary",children:(0,r.jsx)("span",{className:"mobile-summary-count",children:"Aktu\xe1ln\xed m\u011bs\xedc"})})]}),Ye.map(e=>(0,r.jsx)(R,{cashbook:e,formatCurrency:Ae},e.id))]}),0===Ce.length&&0===Pe.length&&0===Ve.length&&0===Ye.length&&(0,r.jsxs)("div",{className:"mobile-empty-state",children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"})}),(0,r.jsx)("p",{children:"\u017d\xe1dn\xe1 data k zobrazen\xed"})]})]}),(0,r.jsx)("footer",{className:"mobile-footer",children:(0,r.jsxs)("button",{className:"mobile-footer-refresh-btn",onClick:async()=>{V(!0),await _e(),V(!1)},disabled:P,children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:P?"spinning":"",children:(0,r.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})}),(0,r.jsx)("span",{children:P?"Obnovuji...":"Obnovit data"})]})})]}),(0,r.jsx)(N,{isOpen:ae,onClose:()=>oe(!1),onConfirm:async e=>{if(g&&y&&null!==ie&&void 0!==ie&&ie.id)try{const o=await(0,A.Hj)(ie.id,g,y,!0);if(!o)return alert("Objedn\xe1vku se nepoda\u0159ilo na\u010d\xedst"),void oe(!1);let n=[];try{n=Array.isArray(o.stav_workflow_kod)?o.stav_workflow_kod:JSON.parse(o.stav_workflow_kod||"[]")}catch(a){n=[]}n=n.filter(e=>!["ODESLANA_KE_SCHVALENI","CEKA_SE","SCHVALENA"].includes(e)),n.includes("ZAMITNUTA")||n.push("ZAMITNUTA");const t={stav_workflow_kod:JSON.stringify(n),stav_objednavky:pe("ZAMITNUTA"),schvalovatel_id:(null===j||void 0===j?void 0:j.id)||null,dt_schvaleni:be(),schvaleni_komentar:e};await(0,A.qA)(ie.id,t,g,y),b({entityType:h.ORDER,entityId:ie.ev_cislo||ie.cislo_objednavky||ie.id,activityType:v.ORDER_REJECTED,title:ie.nazev_obj||"Objedn\xe1vka ".concat(ie.ev_cislo||ie.cislo_objednavky||ie.id),amount:ie.castka_obj||null,userName:y,description:"\u274c Objedn\xe1vka byla zam\xedtnuta".concat(e?": ".concat(e):""),metadata:{orderNumber:ie.ev_cislo||ie.cislo_objednavky,orderId:ie.id}}),he({show:!0,type:"rejected",message:"\u274c Objedn\xe1vka zam\xedtnuta"}),oe(!1),se(null),await Ne(),await _e(),ke()}catch(o){alert("Chyba: ".concat(o.message||"Nepoda\u0159ilo se zam\xedtnout objedn\xe1vku")),oe(!1)}else oe(!1)},title:"Zam\xedtnout objedn\xe1vku",message:"Opravdu chcete zam\xedtnout objedn\xe1vku ".concat((null===ie||void 0===ie?void 0:ie.cislo_objednavky)||(null===ie||void 0===ie?void 0:ie.ev_cislo)||"","?"),confirmText:"Zam\xedtnout",cancelText:"Zru\u0161it",requireReason:!0,reasonPlaceholder:"Zadejte d\u016fvod zam\xedtnut\xed (povinn\xe9)...",variant:"danger"}),(0,r.jsx)(N,{isOpen:ne,onClose:()=>te(!1),onConfirm:async e=>{if(g&&y&&null!==ie&&void 0!==ie&&ie.id)try{const o=await(0,A.Hj)(ie.id,g,y,!0);if(!o)return alert("Objedn\xe1vku se nepoda\u0159ilo na\u010d\xedst"),void te(!1);let n=[];try{n=Array.isArray(o.stav_workflow_kod)?o.stav_workflow_kod:JSON.parse(o.stav_workflow_kod||"[]")}catch(a){n=[]}n=n.filter(e=>!["ODESLANA_KE_SCHVALENI","SCHVALENA","ZAMITNUTA"].includes(e)),n.includes("CEKA_SE")||n.push("CEKA_SE");JSON.stringify(n),pe("CEKA_SE"),null===j||void 0===j||j.id,be();b({entityType:h.ORDER,entityId:ie.ev_cislo||ie.cislo_objednavky||ie.id,activityType:v.ORDER_WAITING,title:ie.nazev_obj||"Objedn\xe1vka ".concat(ie.ev_cislo||ie.cislo_objednavky||ie.id),amount:ie.castka_obj||null,userName:y,description:'\u23f3 Objedn\xe1vka ozna\u010dena jako "\u010cek\xe1 se"'.concat(e?": ".concat(e):""),metadata:{orderNumber:ie.ev_cislo||ie.cislo_objednavky,orderId:ie.id}}),he({show:!0,type:"waiting",message:"\u23f3 Objedn\xe1vka pozastavena"}),te(!1),se(null),await Ne(),await _e(),ke()}catch(o){alert("Chyba: ".concat(o.message||"Nepoda\u0159ilo se pozastavit objedn\xe1vku")),te(!1)}else te(!1)},title:"Pozastavit objedn\xe1vku",message:"Objedn\xe1vka ".concat((null===ie||void 0===ie?void 0:ie.cislo_objednavky)||(null===ie||void 0===ie?void 0:ie.ev_cislo)||"",' bude ozna\u010dena jako "\u010cek\xe1 se".'),confirmText:"Pozastavit",cancelText:"Zru\u0161it",requireReason:!0,reasonPlaceholder:"Zadejte d\u016fvod pozastaven\xed (povinn\xe9)...",variant:"warning"}),(0,r.jsx)(f,{isOpen:re,onClose:()=>{de(!1),ke()}}),(0,r.jsx)(k,{show:ve.show,type:ve.type,message:ve.message,onComplete:()=>he({show:!1,type:"approved",message:""})})]})}},34795:(e,a,o)=>{o.d(a,{Ay:()=>r,fb:()=>t,getHierarchyConfig:()=>s});var n=o(58319);const t={ORDERS:"orders",INVOICES:"invoices",CASHBOOK:"cashbook"},i={DISABLED:"disabled",IMMUNE:"immune",ACTIVE:"active",NO_PROFILE:"no_profile",ERROR:"error"},s=async(e,a)=>{try{const s=await(0,n.getGlobalSettings)(e,a),c=Boolean(s.hierarchy_enabled),r=s.hierarchy_profile_id||null,d=s.hierarchy_logic||"OR";let u=null;if(r)try{const{getHierarchyProfiles:n}=await o.e(6102).then(o.bind(o,96102)),t=(await n(e,a)).find(e=>e.id===parseInt(r,10));u=t?t.name:null}catch(t){console.warn("\u26a0\ufe0f [HierarchyService] Nelze na\u010d\xedst n\xe1zev profilu:",t)}let m=i.DISABLED;return c&&(m=r?i.ACTIVE:i.NO_PROFILE),{status:m,enabled:c,profileId:r,profileName:u,logic:d,logicDescription:l(d),modules:{orders:c&&null!==r,invoices:!1,cashbook:!1}}}catch(t){return console.error("\u274c [HierarchyService] Chyba p\u0159i na\u010d\xedt\xe1n\xed nastaven\xed:",t),{status:i.ERROR,enabled:!1,profileId:null,profileName:null,logic:"OR",logicDescription:l("OR"),error:t.message,modules:{orders:!1,invoices:!1,cashbook:!1}}}},l=e=>"AND"===e?"Restriktivn\xed (A Z\xc1ROVE\u0147) - mus\xed spl\u0148ovat v\u0161echny \xfarovn\u011b sou\u010dasn\u011b":"Liber\xe1ln\xed (NEBO) - sta\u010d\xed splnit alespo\u0148 jednu \xfarove\u0148",c=(()=>{let e=null,a=0;return async function(o,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=Date.now();return!t&&e&&i-a<6e4?(console.log("\ud83d\udd04 [HierarchyService] Using cached config"),e):(console.log("\ud83d\udce1 [HierarchyService] Fetching fresh config"),e=await s(o,n),a=i,e)}})(),r={HierarchyModules:t,HierarchyStatus:i,getHierarchyConfig:s,getHierarchyConfigCached:c,isHierarchyActiveForModule:async(e,a,o)=>{try{const n=await s(a,o);switch(e){case t.ORDERS:return n.modules.orders;case t.INVOICES:return n.modules.invoices;case t.CASHBOOK:return n.modules.cashbook;default:return console.warn("\u26a0\ufe0f [HierarchyService] Nezn\xe1m\xfd modul: ".concat(e)),!1}}catch(n){return console.error("\u274c [HierarchyService] Chyba p\u0159i kontrole modulu:",n),!1}},getLogicDescription:l,getHierarchyInfoMessage:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.ORDERS;if(!e)return null;switch(e.status){case i.DISABLED:return null;case i.NO_PROFILE:return"\u26a0\ufe0f Hierarchie je zapnut\xe1, ale nen\xed vybr\xe1n \u017e\xe1dn\xfd profil. Kontaktujte administr\xe1tora.";case i.IMMUNE:return"\ud83d\udee1\ufe0f M\xe1te neomezen\xfd p\u0159\xedstup k dat\u016fm (HIERARCHY_IMMUNE).";case i.ACTIVE:const o={[t.ORDERS]:"objedn\xe1vky",[t.INVOICES]:"faktury",[t.CASHBOOK]:"pokladnu"}[a]||"data";return"\ud83c\udfe2 Hierarchie aktivn\xed: Vid\xedte ".concat(o,' podle organiza\u010dn\xedho \u0159\xe1du "').concat(e.profileName,'" (').concat(e.logicDescription,").");case i.ERROR:return"\u274c Chyba p\u0159i na\u010d\xedt\xe1n\xed hierarchie. Kontaktujte administr\xe1tora.";default:return null}},getHierarchyBannerColor:e=>{if(!e)return"info";switch(e.status){case i.DISABLED:return"info";case i.NO_PROFILE:return"warning";case i.IMMUNE:return"success";case i.ACTIVE:return"info";case i.ERROR:return"error";default:return"info"}},clearHierarchyCache:()=>{console.log("\ud83e\uddf9 [HierarchyService] Cache cleared")}}},49690:(e,a,o)=>{o.r(a),o.d(a,{default:()=>O});var n,t,i,s,l,c,r,d,u,m,v,h,p=o(57528),b=(o(65043),o(83290)),j=o(45903),g=o(70579);const y=(0,b.i7)(n||(n=(0,p.A)(["\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n"]))),f=(0,b.i7)(t||(t=(0,p.A)(["\n  from { opacity: 0; }\n  to { opacity: 1; }\n"]))),k=(0,b.i7)(i||(i=(0,p.A)(["\n  0%, 100% { opacity: 1; }\n  50% { opacity: 0.5; }\n"]))),x=j.A.div(s||(s=(0,p.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(135deg, #1f2a57 0%, #2c3e7a 100%);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n  animation: "," 0.3s ease-in;\n"])),f),N=j.A.div(l||(l=(0,p.A)(["\n  margin-bottom: 2rem;\n  animation: "," 0.5s ease-in;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 1rem;\n"])),f),_=j.A.img(c||(c=(0,p.A)(["\n  width: 225px;\n  height: 225px;\n  object-fit: contain;\n  filter: drop-shadow(0 4px 20px rgba(0, 0, 0, 0.3));\n  animation: "," 0.6s ease-in;\n"])),f),A=j.A.div(r||(r=(0,p.A)(["\n  font-size: 2.5rem;\n  font-weight: 700;\n  color: #ffffff;\n  text-align: center;\n  letter-spacing: 3px;\n  text-shadow: 0 4px 20px rgba(37, 99, 235, 0.5);\n  background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n"]))),w=j.A.div(d||(d=(0,p.A)(["\n  font-size: 1rem;\n  color: rgba(255, 255, 255, 0.8);\n  text-align: center;\n  margin-top: 0.5rem;\n  letter-spacing: 1px;\n"]))),C=j.A.div(u||(u=(0,p.A)(["\n  margin: 2rem 0;\n"]))),S=j.A.div(m||(m=(0,p.A)(["\n  width: 50px;\n  height: 50px;\n  border: 4px solid rgba(255, 255, 255, 0.1);\n  border-top: 4px solid #ffffff;\n  border-radius: 50%;\n  animation: "," 1s linear infinite;\n"])),y),E=j.A.div(v||(v=(0,p.A)(["\n  color: rgba(255, 255, 255, 0.9);\n  font-size: 0.95rem;\n  margin-top: 1.5rem;\n  animation: "," 1.5s ease-in-out infinite;\n  letter-spacing: 0.5px;\n"])),k),z=j.A.div(h||(h=(0,p.A)(["\n  position: absolute;\n  bottom: 2rem;\n  color: rgba(255, 255, 255, 0.4);\n  font-size: 0.85rem;\n"]))),O=e=>{let{message:a="Na\u010d\xedt\xe1n\xed aplikace..."}=e;return(0,g.jsxs)(x,{children:[(0,g.jsxs)(N,{children:[(0,g.jsx)(_,{src:"".concat("/eeo-v2","/logo512.png"),alt:"ZZS Logo"}),(0,g.jsx)(A,{children:"ERDMS"}),(0,g.jsx)(w,{children:"Syst\xe9m spr\xe1vy a workflow objedn\xe1vek"})]}),(0,g.jsx)(C,{children:(0,g.jsx)(S,{})}),(0,g.jsx)(E,{children:a}),(0,g.jsxs)(z,{children:["verze ","1.89 (Hierarchy edge persistence fix, template variants DB save/load)"]})]})}},58319:(e,a,o)=>{o.d(a,{checkMaintenanceMode:()=>l,getGlobalSettings:()=>t,l:()=>s,saveGlobalSettings:()=>i});const n="https://erdms.zachranka.cz/api.eeo/".replace(/\/$/,""),t=async(e,a)=>{try{const o=await fetch("".concat(n,"/global-settings"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,username:a,operation:"get"})});if(!o.ok)throw new Error("HTTP ".concat(o.status,": ").concat(o.statusText));const t=await o.json();return t.data||t}catch(o){throw console.error("Chyba p\u0159i na\u010d\xedt\xe1n\xed glob\xe1ln\xedho nastaven\xed:",o),o}},i=async(e,a,o)=>{try{const t={token:a,username:o,operation:"save",settings:e};console.group("\ud83d\udcbe SAVE GLOBAL SETTINGS"),console.log("Settings to save:",e),console.log("Full payload:",t),console.groupEnd();const i=await fetch("".concat(n,"/global-settings"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok)throw new Error("HTTP ".concat(i.status,": ").concat(i.statusText));return await i.json()}catch(t){throw console.error("Chyba p\u0159i ukl\xe1d\xe1n\xed glob\xe1ln\xedho nastaven\xed:",t),t}},s=async(e,a)=>{try{const o=await fetch("".concat(n,"/maintenance-message"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,username:a})});if(!o.ok)throw new Error("HTTP ".concat(o.status,": ").concat(o.statusText));return(await o.json()).message||"Syst\xe9m je moment\xe1ln\u011b v \xfadr\u017eb\u011b. Omlouv\xe1me se za komplikace."}catch(o){throw console.error("Chyba p\u0159i na\u010d\xedt\xe1n\xed \xfadr\u017ebov\xe9 zpr\xe1vy:",o),o}},l=async()=>{try{const e=await fetch("".concat(n,"/maintenance-status"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)return!1;const a=await e.json();return!0===a.maintenance_mode||1===a.maintenance_mode}catch(e){return console.error("Chyba p\u0159i kontrole maintenance mode:",e),!1}}},96427:(e,a,o)=>{o.d(a,{A:()=>t});var n=o(65043);const t=()=>{const[e,a]=(0,n.useState)(()=>{if("undefined"!==typeof window)try{const e=localStorage.getItem("app_theme_preference");if(e)return e}catch(e){}return"auto"}),[o,t]=(0,n.useState)("light");(0,n.useEffect)(()=>{const a=window.matchMedia("(prefers-color-scheme: dark)"),o=()=>{t("auto"===e?a.matches?"dark":"light":e)};return o(),a.addEventListener("change",o),()=>a.removeEventListener("change",o)},[e]),(0,n.useEffect)(()=>{document.documentElement.setAttribute("data-theme",o)},[o]),(0,n.useEffect)(()=>{try{localStorage.setItem("app_theme_preference",e)}catch(a){}},[e]);const i=(0,n.useCallback)(e=>{a(e)},[]),s=(0,n.useCallback)(()=>{t(e=>"light"===e?"dark":"light")},[]);return{mode:o,preference:e,setThemePreference:i,toggle:s}}},98951:(e,a,o)=>{o.d(a,{cR:()=>t,eL:()=>i,zJ:()=>l});var n=o(97929);const t=e=>{switch(null===e||void 0===e?void 0:e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")){case"nova":return n.ijD;case"ke_schvaleni":case"keSchvaleni":return n.TuH;case"schvalena":case"kontrola_potvrzena":case"vecnaSpravnost":case"vecna_spravnost":return n.SGM;case"zamitnuta":case"zrusena":return n.s0Q;case"rozpracovana":case"kontrola_ceka":case"cekaKontrola":return n.a$;case"odeslana":return n.raf;case"potvrzena":return n.V2x;case"uverejnena":case"registr_zverejnena":case"registrzverejnena":return n.IJd;case"dokoncena":return n.pvD;case"ceka_potvrzeni":case"cekaPotvrzeni":case"ceka_se":case"cekaSe":return n.G1Y;case"archivovano":case"archivovana":return n.Oh6;default:return n.iW_}},i=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal";if(null!==e&&void 0!==e&&e.startsWith("order_status_")){const a=e.replace("order_status_","");return l(a)}switch(e){case"todo_alarm":return"\ud83d\udd14";case"todo_alarm_high":return"\u26a0\ufe0f";case"todo_alarm_expired":return"\ud83d\udea8";case"order_unlock_forced":return"\u26a1";case"order_approved":return"\u2705";case"order_rejected":return"\u274c";case"order_created":return"\ud83d\udcdd";default:return s(a)}},s=e=>{switch(e){case"urgent":return"\ud83d\udea8";case"high":return"\u26a0\ufe0f";case"normal":return"\ud83d\udd14";default:return"\u2139\ufe0f"}},l=e=>{switch(null===e||void 0===e?void 0:e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")){case"nova":case"koncept":return"\ud83d\udcdd";case"ke_schvaleni":case"keschvaleni":return"\ud83d\udccb";case"schvalena":return"\ud83d\udc4d";case"zamitnuta":return"\u274c";case"rozpracovana":return"\ud83d\udd50";case"odeslana":return"\ud83d\udce4";case"potvrzena":return"\u2714\ufe0f";case"uverejnena":case"registr_zverejnena":case"registrzverejnena":return"\ud83d\udce2";case"dokoncena":return"\ud83c\udfaf";case"ceka_potvrzeni":case"cekapotvrzeni":case"ceka_se":case"cekase":return"\u23f8\ufe0f";case"zrusena":return"\ud83d\udeab";case"smazana":return"\ud83d\uddd1\ufe0f";case"archivovano":case"archivovana":return"\ud83d\udce6";case"ceka_kontrola":case"cekakontrola":return"\ud83d\udd0d";case"vecna_spravnost":case"vecnaspravnost":return"\u2705";default:return"\ud83d\udcca"}}}}]);
//# sourceMappingURL=7967.68639f32.chunk.js.map