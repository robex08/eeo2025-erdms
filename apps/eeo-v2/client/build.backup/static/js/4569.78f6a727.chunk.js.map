{"version":3,"file":"static/js/4569.78f6a727.chunk.js","mappings":"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","sources":["components/invoices/InvoiceAttachmentUploadButton.js","components/invoices/ISDOCDetectionBadge.js","components/invoices/InvoiceAttachmentItem.js","components/invoices/ISDOCParsingDialog.js","components/invoices/InvoiceAttachmentsSection.js","components/invoices/InvoiceAttachmentsCompact.js","utils/isdocParser.js","utils/invoiceOCR.js"],"sourcesContent":["import React, { useRef, useState } from 'react';\nimport styled from '@emotion/styled';\nimport { Upload, File, AlertCircle, CheckCircle } from 'lucide-react';\nimport {\n  isAllowedInvoiceFileType,\n  isAllowedInvoiceFileSize,\n  isISDOCFile,\n  formatFileSize\n} from '../../services/api25invoices';\n\n/**\n * InvoiceAttachmentUploadButton Component\n *\n * Upload button s podporou drag & drop pro plohy faktur\n * Validuje typ a velikost souboru ped uploadem\n * Zobraz progress bhem nahrvn\n */\n\nconst UploadContainer = styled.div`\n  position: relative;\n  width: 100%;\n`;\n\nconst UploadArea = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 24px;\n  border: 2px dashed ${props => {\n    if (props.error) return '#fca5a5';\n    if (props.isDragging) return '#3b82f6';\n    return '#cbd5e1';\n  }};\n  border-radius: 8px;\n  background: ${props => {\n    if (props.error) return '#fef2f2';\n    if (props.isDragging) return '#eff6ff';\n    return '#f8fafc';\n  }};\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &:hover {\n    border-color: ${props => props.error ? '#f87171' : '#3b82f6'};\n    background: ${props => props.error ? '#fee2e2' : '#eff6ff'};\n  }\n\n  ${props => props.uploading && `\n    opacity: 0.7;\n    pointer-events: none;\n  `}\n`;\n\nconst UploadIcon = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  background: ${props => {\n    if (props.error) return '#fee2e2';\n    if (props.isDragging) return '#dbeafe';\n    return '#e0e7ff';\n  }};\n  color: ${props => {\n    if (props.error) return '#dc2626';\n    if (props.isDragging) return '#3b82f6';\n    return '#4f46e5';\n  }};\n\n  svg {\n    width: 24px;\n    height: 24px;\n  }\n`;\n\nconst UploadText = styled.div`\n  text-align: center;\n`;\n\nconst MainText = styled.div`\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: ${props => props.error ? '#dc2626' : '#1f2937'};\n  margin-bottom: 4px;\n`;\n\nconst SubText = styled.div`\n  font-size: 0.75rem;\n  color: #6b7280;\n`;\n\nconst HiddenInput = styled.input`\n  display: none;\n`;\n\nconst ProgressBar = styled.div`\n  width: 100%;\n  height: 4px;\n  background: #e5e7eb;\n  border-radius: 2px;\n  overflow: hidden;\n  margin-top: 12px;\n`;\n\nconst ProgressFill = styled.div`\n  height: 100%;\n  background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);\n  border-radius: 2px;\n  transition: width 0.3s ease;\n  width: ${props => props.progress}%;\n`;\n\nconst Message = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  margin-top: 12px;\n  background: ${props => props.type === 'error' ? '#fef2f2' : '#f0fdf4'};\n  border: 1px solid ${props => props.type === 'error' ? '#fecaca' : '#bbf7d0'};\n  color: ${props => props.type === 'error' ? '#dc2626' : '#16a34a'};\n\n  svg {\n    width: 18px;\n    height: 18px;\n    flex-shrink: 0;\n  }\n`;\n\nconst InvoiceAttachmentUploadButton = ({\n  onUpload,\n  disabled = false,\n  maxFileSize = 10 * 1024 * 1024, // 10 MB\n  acceptedTypes = ['pdf', 'isdoc', 'jpg', 'jpeg', 'png', 'xml']\n}) => {\n  const fileInputRef = useRef(null);\n  const [isDragging, setIsDragging] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [error, setError] = useState(null);\n  const [success, setSuccess] = useState(null);\n\n  // Validace souboru\n  const validateFile = (file) => {\n    // Reset messages\n    setError(null);\n    setSuccess(null);\n\n    // Validace typu\n    if (!isAllowedInvoiceFileType(file.name)) {\n      const allowed = acceptedTypes.join(', ').toUpperCase();\n      throw new Error(`Nepodporovan formt souboru. Povolen: ${allowed}`);\n    }\n\n    // Validace velikosti\n    if (!isAllowedInvoiceFileSize(file.size)) {\n      const maxSizeFormatted = formatFileSize(maxFileSize);\n      throw new Error(`Soubor je pli velk (max ${maxSizeFormatted})`);\n    }\n\n    return true;\n  };\n\n  // Zpracovn uploadu\n  const handleFileUpload = async (file) => {\n    try {\n      validateFile(file);\n\n      setUploading(true);\n      setProgress(0);\n      setError(null);\n      setSuccess(null);\n\n      // Detekce ISDOC\n      const isISDOC = isISDOCFile(file.name);\n\n      // Simulace progressu (reln progress by byl z axios onUploadProgress)\n      const progressInterval = setInterval(() => {\n        setProgress(prev => {\n          if (prev >= 90) {\n            clearInterval(progressInterval);\n            return 90;\n          }\n          return prev + 10;\n        });\n      }, 100);\n\n      // Voln parent callback\n      if (onUpload) {\n        await onUpload(file, isISDOC);\n      }\n\n      clearInterval(progressInterval);\n      setProgress(100);\n\n      // Success message\n      const fileName = file.name;\n      const successMsg = isISDOC\n        ? `ISDOC soubor \"${fileName}\" byl spn nahrn`\n        : `Soubor \"${fileName}\" byl spn nahrn`;\n\n      setSuccess(successMsg);\n\n      // Auto-hide success message\n      setTimeout(() => {\n        setSuccess(null);\n        setProgress(0);\n        setUploading(false);\n      }, 3000);\n\n    } catch (err) {\n      setError(err.message || 'Chyba pi nahrvn souboru');\n      setUploading(false);\n      setProgress(0);\n    }\n  };\n\n  // Click handler\n  const handleClick = () => {\n    if (disabled || uploading) return;\n    fileInputRef.current?.click();\n  };\n\n  // File input change\n  const handleFileChange = (e) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      handleFileUpload(file);\n    }\n    // Reset input\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  // Drag handlers\n  const handleDragEnter = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!disabled && !uploading) {\n      setIsDragging(true);\n    }\n  };\n\n  const handleDragLeave = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(false);\n  };\n\n  const handleDragOver = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleDrop = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(false);\n\n    if (disabled || uploading) return;\n\n    const file = e.dataTransfer.files?.[0];\n    if (file) {\n      handleFileUpload(file);\n    }\n  };\n\n  return (\n    <UploadContainer>\n      <UploadArea\n        onClick={handleClick}\n        onDragEnter={handleDragEnter}\n        onDragLeave={handleDragLeave}\n        onDragOver={handleDragOver}\n        onDrop={handleDrop}\n        isDragging={isDragging}\n        uploading={uploading}\n        error={!!error}\n      >\n        <UploadIcon isDragging={isDragging} error={!!error}>\n          {error ? <AlertCircle /> : <Upload />}\n        </UploadIcon>\n\n        <UploadText>\n          <MainText error={!!error}>\n            {error ? 'Chyba pi nahrvn' :\n             isDragging ? 'Puste soubor zde' :\n             uploading ? 'Nahrvm...' :\n             'Kliknte nebo pethnte soubor'}\n          </MainText>\n\n          {!error && (\n            <SubText>\n              {uploading\n                ? `Nahrvn ${progress}%...`\n                : `Podporovan formty: ${acceptedTypes.join(', ').toUpperCase()} (max ${formatFileSize(maxFileSize)})`\n              }\n            </SubText>\n          )}\n        </UploadText>\n\n        {uploading && (\n          <ProgressBar>\n            <ProgressFill progress={progress} />\n          </ProgressBar>\n        )}\n      </UploadArea>\n\n      <HiddenInput\n        ref={fileInputRef}\n        type=\"file\"\n        accept={acceptedTypes.map(ext => `.${ext}`).join(',')}\n        onChange={handleFileChange}\n        disabled={disabled || uploading}\n      />\n\n      {error && (\n        <Message type=\"error\">\n          <AlertCircle />\n          {error}\n        </Message>\n      )}\n\n      {success && (\n        <Message type=\"success\">\n          <CheckCircle />\n          {success}\n        </Message>\n      )}\n    </UploadContainer>\n  );\n};\n\nexport default InvoiceAttachmentUploadButton;\n","import React from 'react';\nimport styled from '@emotion/styled';\nimport { FileCheck } from 'lucide-react';\n\n/**\n * ISDOCDetectionBadge Component\n *\n * Zobraz badge s informac o detekci ISDOC formtu\n * Pouv se u plohy faktury pro rychlou vizuln indikaci\n */\n\nconst Badge = styled.div`\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 4px 10px;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  background: ${props => props.detected ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : '#e5e7eb'};\n  color: ${props => props.detected ? '#ffffff' : '#6b7280'};\n  border: 1px solid ${props => props.detected ? '#059669' : '#d1d5db'};\n  transition: all 0.2s ease;\n  cursor: ${props => props.onClick ? 'pointer' : 'default'};\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n\n  &:hover {\n    ${props => props.onClick && `\n      transform: translateY(-1px);\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    `}\n  }\n`;\n\nconst TooltipWrapper = styled.div`\n  position: relative;\n  display: inline-block;\n`;\n\nconst Tooltip = styled.div`\n  position: absolute;\n  bottom: calc(100% + 8px);\n  left: 50%;\n  transform: translateX(-50%);\n  background: #1f2937;\n  color: #ffffff;\n  padding: 8px 12px;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  white-space: nowrap;\n  z-index: 1000;\n  opacity: ${props => props.show ? 1 : 0};\n  visibility: ${props => props.show ? 'visible' : 'hidden'};\n  transition: opacity 0.2s ease, visibility 0.2s ease;\n  pointer-events: none;\n\n  &::after {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    border: 6px solid transparent;\n    border-top-color: #1f2937;\n  }\n`;\n\nconst ISDOCDetectionBadge = ({\n  detected = false,\n  parsed = false,\n  onClick,\n  showTooltip = true\n}) => {\n  const [tooltipVisible, setTooltipVisible] = React.useState(false);\n\n  const getTooltipText = () => {\n    if (detected && parsed) {\n      return 'ISDOC formt - data extrahovna';\n    }\n    if (detected && !parsed) {\n      return 'ISDOC formt - detekovn (neparsovn)';\n    }\n    return 'Standardn ploha';\n  };\n\n  const getBadgeText = () => {\n    if (detected && parsed) {\n      return 'ISDOC ';\n    }\n    if (detected && !parsed) {\n      return 'ISDOC';\n    }\n    return 'PDF/IMG';\n  };\n\n  const badge = (\n    <Badge\n      detected={detected}\n      onClick={onClick}\n      onMouseEnter={() => showTooltip && setTooltipVisible(true)}\n      onMouseLeave={() => setTooltipVisible(false)}\n    >\n      {detected && <FileCheck />}\n      {getBadgeText()}\n    </Badge>\n  );\n\n  if (!showTooltip) {\n    return badge;\n  }\n\n  return (\n    <TooltipWrapper>\n      {badge}\n      <Tooltip show={tooltipVisible}>\n        {getTooltipText()}\n      </Tooltip>\n    </TooltipWrapper>\n  );\n};\n\nexport default ISDOCDetectionBadge;\n","import React, { useState } from 'react';\nimport styled from '@emotion/styled';\nimport { FileText, Download, Trash2, AlertCircle } from 'lucide-react';\nimport ISDOCDetectionBadge from './ISDOCDetectionBadge';\nimport { formatFileSize } from '../../services/api25invoices';\nimport { prettyDate } from '../../utils/format';\n\n/**\n * InvoiceAttachmentItem Component\n *\n * Jednotliv poloka v seznamu ploh faktury\n * Zobraz nzev, velikost, datum, ISDOC badge a akce (download, delete)\n */\n\nconst ItemContainer = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  background: ${props => props.deleting ? '#fef2f2' : '#ffffff'};\n  border: 1px solid ${props => props.deleting ? '#fecaca' : '#e5e7eb'};\n  border-radius: 8px;\n  transition: all 0.2s ease;\n  gap: 12px;\n\n  &:hover {\n    ${props => !props.deleting && `\n      border-color: #cbd5e1;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n    `}\n  }\n\n  ${props => props.deleting && `\n    opacity: 0.6;\n    pointer-events: none;\n  `}\n`;\n\nconst LeftSection = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  flex: 1;\n  min-width: 0;\n`;\n\nconst FileIcon = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  border-radius: 8px;\n  color: #ffffff;\n  flex-shrink: 0;\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n`;\n\nconst FileInfo = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  min-width: 0;\n  flex: 1;\n`;\n\nconst FileName = styled.div`\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #1f2937;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n`;\n\nconst FileMeta = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 0.75rem;\n  color: #6b7280;\n  flex-wrap: wrap;\n`;\n\nconst MetaItem = styled.span`\n  display: flex;\n  align-items: center;\n  gap: 4px;\n\n  &::before {\n    content: '';\n    margin-right: 4px;\n\n    &:first-of-type {\n      display: none;\n    }\n  }\n\n  &:first-of-type::before {\n    display: none;\n  }\n`;\n\nconst RightSection = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  flex-shrink: 0;\n`;\n\nconst ActionButton = styled.button`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 36px;\n  height: 36px;\n  border: none;\n  border-radius: 6px;\n  background: ${props => props.variant === 'danger' ? '#fef2f2' : '#f3f4f6'};\n  color: ${props => props.variant === 'danger' ? '#dc2626' : '#6b7280'};\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n\n  &:hover {\n    background: ${props => props.variant === 'danger' ? '#fee2e2' : '#e5e7eb'};\n    transform: translateY(-1px);\n  }\n\n  &:active {\n    transform: translateY(0);\n  }\n\n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    transform: none;\n  }\n`;\n\nconst ErrorMessage = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 12px;\n  background: #fef2f2;\n  border: 1px solid #fecaca;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  color: #dc2626;\n  margin-top: 8px;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    flex-shrink: 0;\n  }\n`;\n\nconst InvoiceAttachmentItem = ({\n  attachment,\n  onDownload,\n  onDelete,\n  readOnly = false,\n  showUploader = true\n}) => {\n  const [downloading, setDownloading] = useState(false);\n  const [deleting, setDeleting] = useState(false);\n  const [error, setError] = useState(null);\n\n  // Zpracovn downloadu\n  const handleDownload = async () => {\n    if (downloading || !onDownload) return;\n\n    setDownloading(true);\n    setError(null);\n\n    try {\n      await onDownload(attachment);\n    } catch (err) {\n      setError(err.message || 'Chyba pi stahovn souboru');\n    } finally {\n      setDownloading(false);\n    }\n  };\n\n  // Zpracovn smazn\n  const handleDelete = async () => {\n    if (!onDelete) return;\n\n    // Support both API v2 (original_name) and old API (originalni_nazev_souboru)\n    const fileName = attachment.original_name || attachment.originalni_nazev_souboru || 'tento soubor';\n    const confirmMessage = `Opravdu chcete smazat plohu \"${fileName}\"?`;\n    if (!window.confirm(confirmMessage)) return;\n\n    setDeleting(true);\n    setError(null);\n\n    try {\n      await onDelete(attachment);\n    } catch (err) {\n      setError(err.message || 'Chyba pi mazn souboru');\n      setDeleting(false);\n    }\n  };\n\n  // Zskn nzvu souboru - support both API v2 and old API\n  const fileName = attachment.original_name || attachment.originalni_nazev_souboru || 'Neznm soubor';\n\n  // Formtovn velikosti - support both API v2 (file_size) and old API (velikost_souboru_b)\n  const fileSize = formatFileSize(attachment.file_size || attachment.velikost_souboru_b || 0);\n\n  // Datum vytvoen\n  const uploadDate = attachment.dt_vytvoreni\n    ? prettyDate(attachment.dt_vytvoreni)\n    : null;\n\n  // Uivatel kter nahrl\n  const uploader = attachment.nahrano_uzivatel\n    ? `${attachment.nahrano_uzivatel.prijmeni || ''} ${attachment.nahrano_uzivatel.jmeno || ''}`.trim()\n    : null;\n\n  return (\n    <>\n      <ItemContainer deleting={deleting}>\n        <LeftSection>\n          <FileIcon>\n            <FileText />\n          </FileIcon>\n\n          <FileInfo>\n            <FileName title={fileName}>\n              {fileName}\n            </FileName>\n\n            <FileMeta>\n              <MetaItem>{fileSize}</MetaItem>\n\n              {uploadDate && (\n                <MetaItem>{uploadDate}</MetaItem>\n              )}\n\n              {showUploader && uploader && (\n                <MetaItem>{uploader}</MetaItem>\n              )}\n            </FileMeta>\n          </FileInfo>\n        </LeftSection>\n\n        <RightSection>\n          <ISDOCDetectionBadge\n            detected={attachment.je_isdoc === 1 || attachment.je_isdoc === true}\n            parsed={attachment.isdoc_parsed === 1 || attachment.isdoc_parsed === true}\n          />\n\n          <ActionButton\n            onClick={handleDownload}\n            disabled={downloading}\n            title=\"Sthnout soubor\"\n          >\n            <Download />\n          </ActionButton>\n\n          {!readOnly && (\n            <ActionButton\n              variant=\"danger\"\n              onClick={handleDelete}\n              disabled={deleting}\n              title=\"Smazat soubor\"\n            >\n              <Trash2 />\n            </ActionButton>\n          )}\n        </RightSection>\n      </ItemContainer>\n\n      {error && (\n        <ErrorMessage>\n          <AlertCircle />\n          {error}\n        </ErrorMessage>\n      )}\n    </>\n  );\n};\n\nexport default InvoiceAttachmentItem;\n","import React from 'react';\nimport styled from '@emotion/styled';\nimport { FileText, Info, AlertCircle, CheckCircle, Building, Calendar, Banknote, Package, X } from 'lucide-react';\n\n/**\n * Formtuje datum do CZ formtu DD.MM.YYYY\n */\nconst formatDateCZ = (dateString) => {\n  if (!dateString) return '---';\n\n  try {\n    const date = new Date(dateString);\n    if (isNaN(date)) return dateString; // Fallback na pvodn string\n\n    const day = String(date.getDate()).padStart(2, '0');\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const year = date.getFullYear();\n\n    return `${day}.${month}.${year}`;\n  } catch (e) {\n    return dateString;\n  }\n};\n\nconst Overlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n  animation: fadeIn 0.2s ease;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n`;\n\nconst Modal = styled.div`\n  background: #ffffff;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  max-width: 1100px;\n  width: 95%;\n  max-height: 85vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp 0.3s ease;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n`;\n\nconst Header = styled.div`\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  color: #ffffff;\n  padding: 24px;\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  position: relative;\n`;\n\nconst CloseButton = styled.button`\n  position: absolute;\n  top: 16px;\n  right: 16px;\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  border-radius: 6px;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: background 0.2s;\n  color: #ffffff;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n`;\n\nconst HeaderIcon = styled.div`\n  width: 48px;\n  height: 48px;\n  border-radius: 10px;\n  background: rgba(255, 255, 255, 0.2);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  svg {\n    width: 28px;\n    height: 28px;\n  }\n`;\n\nconst HeaderTitle = styled.div`\n  flex: 1;\n`;\n\nconst HeaderTitleText = styled.h2`\n  margin: 0;\n  font-size: 1.375rem;\n  font-weight: 700;\n`;\n\nconst HeaderSubtitle = styled.p`\n  margin: 4px 0 0 0;\n  font-size: 0.875rem;\n  opacity: 0.95;\n`;\n\nconst Content = styled.div`\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n`;\n\nconst InfoBox = styled.div`\n  background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);\n  border: 1px solid #93c5fd;\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 24px;\n  display: flex;\n  gap: 12px;\n\n  svg {\n    width: 20px;\n    height: 20px;\n    color: #2563eb;\n    flex-shrink: 0;\n    margin-top: 2px;\n  }\n`;\n\nconst InfoText = styled.p`\n  margin: 0;\n  font-size: 0.875rem;\n  color: #1e40af;\n  line-height: 1.5;\n`;\n\nconst Section = styled.div`\n  margin-bottom: 24px;\n`;\n\nconst SectionTitle = styled.h3`\n  font-size: 0.9375rem;\n  font-weight: 600;\n  color: #374151;\n  margin: 0 0 12px 0;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  svg {\n    width: 18px;\n    height: 18px;\n    color: #6b7280;\n  }\n`;\n\nconst TwoColumnLayout = styled.div`\n  display: grid;\n  grid-template-columns: 400px 1fr;\n  gap: 20px;\n  margin-bottom: 16px;\n\n  @media (max-width: 900px) {\n    grid-template-columns: 1fr;\n  }\n`;\n\nconst LeftColumn = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n`;\n\nconst RightColumn = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n`;\n\nconst TopRowGrid = styled.div`\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 12px;\n`;\n\nconst DataItem = styled.div`\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 12px;\n`;\n\nconst DataLabel = styled.div`\n  font-size: 0.75rem;\n  color: #6b7280;\n  font-weight: 500;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n  margin-bottom: 6px;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    flex-shrink: 0;\n    opacity: 0.7;\n  }\n`;\n\nconst DataValue = styled.div`\n  font-size: 0.9375rem;\n  color: #111827;\n  font-weight: 600;\n\n  &.highlight {\n    color: #10b981;\n    font-size: 1.125rem;\n  }\n`;\n\nconst FullWidthItem = styled(DataItem)`\n  grid-column: 1 / -1;\n`;\n\nconst Footer = styled.div`\n  background: #f9fafb;\n  border-top: 1px solid #e5e7eb;\n  padding: 16px 24px;\n  display: flex;\n  gap: 12px;\n  justify-content: flex-end;\n`;\n\nconst Button = styled.button`\n  padding: 10px 20px;\n  border-radius: 6px;\n  font-size: 0.9375rem;\n  font-weight: 600;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  &.primary {\n    background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n    color: #ffffff;\n\n    &:hover {\n      background: linear-gradient(135deg, #059669 0%, #047857 100%);\n      transform: translateY(-1px);\n      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);\n    }\n  }\n\n  &.secondary {\n    background: #ffffff;\n    color: #374151;\n    border: 1px solid #d1d5db;\n\n    &:hover {\n      background: #f9fafb;\n      border-color: #9ca3af;\n    }\n  }\n\n  &:active {\n    transform: translateY(0);\n  }\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n`;\n\nconst WarningBox = styled.div`\n  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n  border: 1px solid #fbbf24;\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 24px;\n  display: flex;\n  gap: 12px;\n\n  svg {\n    width: 20px;\n    height: 20px;\n    color: #f59e0b;\n    flex-shrink: 0;\n    margin-top: 2px;\n  }\n`;\n\nconst WarningText = styled.p`\n  margin: 0;\n  font-size: 0.875rem;\n  color: #92400e;\n  line-height: 1.5;\n`;\n\nconst CheckboxContainer = styled.div`\n  background: #e0f2fe;\n  border: 1px solid #0ea5e9;\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 16px;\n  display: flex;\n  align-items: flex-start;\n  gap: 12px;\n`;\n\nconst CheckboxLabel = styled.label`\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  cursor: pointer;\n  font-size: 0.9375rem;\n  color: #0c4a6e;\n  font-weight: 500;\n  user-select: none;\n  flex: 1;\n\n  input[type=\"checkbox\"] {\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n    accent-color: #0ea5e9;\n  }\n\n  &:hover {\n    color: #075985;\n  }\n`;\n\nconst CheckboxHint = styled.div`\n  font-size: 0.8125rem;\n  color: #0c4a6e;\n  margin-top: 8px;\n  margin-left: 30px;\n  line-height: 1.4;\n  font-style: italic;\n  font-weight: 500;\n`;\n\nconst ItemsSection = styled.div`\n  display: flex;\n  flex-direction: column;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 12px;\n`;\n\nconst ItemsSectionTitle = styled.h3`\n  font-size: 0.8125rem;\n  font-weight: 600;\n  color: #374151;\n  margin: 0 0 8px 0;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    color: #10b981;\n  }\n`;\n\nconst ItemsList = styled.div`\n  max-height: 300px;\n  overflow-y: auto;\n  margin-top: 8px;\n\n  &::-webkit-scrollbar {\n    width: 6px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #e5e7eb;\n    border-radius: 3px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #10b981;\n    border-radius: 3px;\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background: #059669;\n  }\n`;\n\nconst ItemRow = styled.div`\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 10px;\n  margin-bottom: 6px;\n\n  &:last-child {\n    margin-bottom: 0;\n  }\n\n  &:hover {\n    border-color: #10b981;\n    box-shadow: 0 1px 3px rgba(16, 185, 129, 0.15);\n    transform: translateX(2px);\n    transition: all 0.2s ease;\n  }\n`;\n\nconst ItemHeader = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 8px;\n`;\n\nconst ItemName = styled.div`\n  font-size: 0.9375rem;\n  font-weight: 600;\n  color: #111827;\n  flex: 1;\n`;\n\nconst ItemPrice = styled.div`\n  font-size: 0.9375rem;\n  font-weight: 700;\n  color: #10b981;\n  white-space: nowrap;\n  margin-left: 16px;\n`;\n\nconst ItemDetails = styled.div`\n  display: flex;\n  gap: 16px;\n  flex-wrap: wrap;\n  font-size: 0.8125rem;\n  color: #6b7280;\n`;\n\nconst ItemDetail = styled.span`\n  display: flex;\n  align-items: center;\n  gap: 4px;\n\n  strong {\n    color: #374151;\n  }\n`;\n\n/**\n * ISDOCParsingDialog Component\n *\n * Dialog pro potvrzen extrakce dat z ISDOC souboru\n * Zobrazuje nhled dat a pt se uivatele, zda chce data vyplnit\n */\nconst ISDOCParsingDialog = ({\n  isdocSummary,\n  isdocData,\n  onConfirm,\n  onCancel,\n  onUploadWithoutParsing\n}) => {\n  //  State pro checkbox - vchoz hodnota TRUE (variabiln symbol)\n  const [useVariableSymbol, setUseVariableSymbol] = React.useState(true);\n\n  //  Zskat poloky z isdocData nebo isdocSummary\n  const polozky = isdocData?.polozky || isdocSummary?.polozky || [];\n\n  return (\n    <Overlay onClick={(e) => e.stopPropagation()}>\n      <Modal onClick={(e) => e.stopPropagation()}>\n        <Header>\n          <HeaderIcon>\n            <FileText />\n          </HeaderIcon>\n          <HeaderTitle>\n            <HeaderTitleText>Detekovn ISDOC formt!</HeaderTitleText>\n            <HeaderSubtitle>Elektronick faktura byla spn natena</HeaderSubtitle>\n          </HeaderTitle>\n          <CloseButton onClick={onCancel} aria-label=\"Zavt\">\n            <X />\n          </CloseButton>\n        </Header>\n\n        <Content>\n          <InfoBox>\n            <Info />\n            <InfoText>\n              ISDOC je standardn formt pro elektronickou vmnu faktur.\n              Systm me automaticky vyplnit daje faktury z tohoto souboru.\n            </InfoText>\n          </InfoBox>\n\n          {/*  DVOUSLOUPCOV LAYOUT: LEV (pod sebou) + PRAV (dodavatel + poloky) */}\n          <TwoColumnLayout>\n            {/* LEV STRANA - 22 GRID (50/50) */}\n            <LeftColumn>\n              <TopRowGrid>\n                <DataItem>\n                  <DataLabel>\n                    <Calendar />\n                    Datum vystaven\n                  </DataLabel>\n                  <DataValue>{formatDateCZ(isdocSummary.datum_vystaveni)}</DataValue>\n                </DataItem>\n\n                <DataItem>\n                  <DataLabel>\n                    <Banknote />\n                    Celkov stka\n                  </DataLabel>\n                  <DataValue className=\"highlight\">\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px', flexWrap: 'wrap' }}>\n                      <span>{isdocSummary.castka_s_dph}</span>\n                      {isdocSummary.ma_slevu && isdocSummary.sleva_celkem > 0 && (\n                        <span style={{\n                          fontSize: '0.75rem',\n                          color: '#059669',\n                          fontWeight: 500,\n                          display: 'inline-flex',\n                          alignItems: 'center',\n                          gap: '4px'\n                        }}>\n                           Sleva: -{isdocSummary.sleva_celkem.toLocaleString('cs-CZ', {\n                            minimumFractionDigits: 2\n                          })} K\n                          {isdocSummary.sleva_procenta > 0 && (\n                            <span style={{\n                              fontSize: '0.7rem',\n                              opacity: 0.8\n                            }}>\n                              ({isdocSummary.sleva_procenta.toFixed(1)}%)\n                            </span>\n                          )}\n                        </span>\n                      )}\n                    </div>\n                  </DataValue>\n                </DataItem>\n              </TopRowGrid>\n\n              <TopRowGrid>\n                <DataItem>\n                  <DataLabel>\n                    <FileText />\n                    slo faktury\n                  </DataLabel>\n                  <DataValue>{isdocSummary.cislo_faktury}</DataValue>\n                </DataItem>\n\n                <DataItem>\n                  <DataLabel>\n                    <FileText />\n                    Variabiln symbol\n                  </DataLabel>\n                  <DataValue>{isdocSummary.variabilni_symbol}</DataValue>\n                </DataItem>\n              </TopRowGrid>\n            </LeftColumn>\n\n            {/* PRAV STRANA - Dodavatel + Poet na jednom dku, pak poloky */}\n            <RightColumn>\n              {/* Prvn dek: Dodavatel + Poet poloek */}\n              <TopRowGrid>\n                <DataItem>\n                  <DataLabel>\n                    <Building />\n                    Dodavatel\n                  </DataLabel>\n                  <DataValue>{isdocSummary.dodavatel}</DataValue>\n                </DataItem>\n\n                <DataItem>\n                  <DataLabel>\n                    <Package />\n                    Poet poloek\n                  </DataLabel>\n                  <DataValue>{isdocSummary.pocet_polozek}</DataValue>\n                </DataItem>\n              </TopRowGrid>\n\n              {/* Poloky - pes celou ku */}\n              {polozky && polozky.length > 0 && (\n                <ItemsSection>\n                  <ItemsSectionTitle>\n                    <Package />\n                    Poloky faktury\n                  </ItemsSectionTitle>\n                  <ItemsList>\n                    {polozky.map((polozka, index) => (\n                      <ItemRow key={index}>\n                        <ItemHeader>\n                          <ItemName>\n                            {index + 1}. {polozka.popis || 'Poloka bez popisu'}\n                          </ItemName>\n                          <ItemPrice>\n                            {polozka.cena_celkem_s_dph?.toLocaleString('cs-CZ', {\n                              minimumFractionDigits: 2,\n                              maximumFractionDigits: 2\n                            })} K\n                          </ItemPrice>\n                        </ItemHeader>\n                        <ItemDetails>\n                          <ItemDetail>\n                            <strong>Mnostv:</strong> {polozka.mnozstvi} {polozka.jednotka}\n                          </ItemDetail>\n                          <ItemDetail>\n                            <strong>Cena/jedn.:</strong> {polozka.cena_za_jednotku?.toLocaleString('cs-CZ', {\n                              minimumFractionDigits: 2\n                            })} K\n                          </ItemDetail>\n                          <ItemDetail>\n                            <strong>Bez DPH:</strong> {polozka.cena_celkem_bez_dph?.toLocaleString('cs-CZ', {\n                              minimumFractionDigits: 2\n                            })} K\n                          </ItemDetail>\n                          <ItemDetail>\n                            <strong>DPH:</strong> {polozka.sazba_dph}%\n                          </ItemDetail>\n                        </ItemDetails>\n                      </ItemRow>\n                    ))}\n                  </ItemsList>\n                </ItemsSection>\n              )}\n            </RightColumn>\n          </TwoColumnLayout>\n\n          {/*  CHECKBOX PRO VBR MEZI SLEM FAKTURY A VARIABILNM SYMBOLEM */}\n          <CheckboxContainer>\n            <div style={{ flex: 1 }}>\n              <CheckboxLabel>\n                <input\n                  type=\"checkbox\"\n                  checked={useVariableSymbol}\n                  onChange={(e) => setUseVariableSymbol(e.target.checked)}\n                />\n                <span>\n                  Do pole <strong>slo FA/VPD</strong> pout <strong>variabiln symbol</strong> msto sla faktury\n                </span>\n              </CheckboxLabel>\n              <CheckboxHint>\n                {useVariableSymbol\n                  ? ` Bude pouit variabiln symbol: ${isdocSummary.variabilni_symbol}`\n                  : ` Bude pouito slo faktury: ${isdocSummary.cislo_faktury}`\n                }\n              </CheckboxHint>\n            </div>\n          </CheckboxContainer>\n\n          <WarningBox>\n            <AlertCircle />\n            <WarningText>\n              <strong>Datum doruen</strong> bude automaticky nastaven na dnen datum.\n              Po vyplnn daj zkontrolujte vechna pole ped uloenm!\n            </WarningText>\n          </WarningBox>\n        </Content>\n\n        <Footer>\n          <Button className=\"secondary\" onClick={onUploadWithoutParsing}>\n            Nahrt bez extrakce\n          </Button>\n          <Button className=\"secondary\" onClick={onCancel}>\n            Zruit\n          </Button>\n          <Button className=\"primary\" onClick={() => onConfirm(useVariableSymbol)}>\n            <CheckCircle />\n            Vyplnit daje faktury\n          </Button>\n        </Footer>\n      </Modal>\n    </Overlay>\n  );\n};\n\nexport default ISDOCParsingDialog;\n","import React, { useState, useEffect, useContext } from 'react';\nimport ReactDOM from 'react-dom';\nimport styled from '@emotion/styled';\nimport { Paperclip, ChevronDown, ChevronUp, AlertCircle, Loader } from 'lucide-react';\nimport InvoiceAttachmentUploadButton from './InvoiceAttachmentUploadButton';\nimport InvoiceAttachmentItem from './InvoiceAttachmentItem';\nimport ISDOCParsingDialog from './ISDOCParsingDialog';\nimport {\n  uploadInvoiceAttachment25,\n  listInvoiceAttachments25,\n  downloadInvoiceAttachment25,\n  deleteInvoiceAttachment25\n} from '../../services/api25invoices';\nimport { AuthContext } from '../../context/AuthContext';\nimport { ToastContext } from '../../context/ToastContext';\nimport { parseISDOCFile, isISDOCFile, createISDOCSummary } from '../../utils/isdocParser';\n\n/**\n * InvoiceAttachmentsSection Component\n *\n * Hlavn komponenta pro sprvu ploh faktury\n * Zahrnuje: seznam ploh, upload, download, delete\n * Automaticky nate plohy pi mount nebo zmn faktura_id\n */\n\nconst Section = styled.div`\n  margin-top: 16px;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  background: #ffffff;\n  overflow: hidden;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n  border-bottom: 1px solid #e5e7eb;\n  cursor: pointer;\n  user-select: none;\n  transition: background 0.2s ease;\n\n  &:hover {\n    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);\n  }\n`;\n\nconst HeaderLeft = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 10px;\n`;\n\nconst HeaderIcon = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  color: #ffffff;\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n`;\n\nconst HeaderTitle = styled.div`\n  font-size: 0.9375rem;\n  font-weight: 600;\n  color: #1f2937;\n`;\n\nconst Badge = styled.span`\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 20px;\n  height: 20px;\n  padding: 0 6px;\n  border-radius: 10px;\n  background: #3b82f6;\n  color: #ffffff;\n  font-size: 0.75rem;\n  font-weight: 600;\n  margin-left: 8px;\n`;\n\nconst ToggleIcon = styled.div`\n  display: flex;\n  align-items: center;\n  color: #6b7280;\n  transition: transform 0.2s ease;\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n`;\n\nconst Content = styled.div`\n  padding: 16px;\n  display: ${props => props.collapsed ? 'none' : 'block'};\n`;\n\nconst UploadSection = styled.div`\n  margin-bottom: ${props => props.hasAttachments ? '20px' : '0'};\n`;\n\nconst AttachmentsList = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n`;\n\nconst EmptyState = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 32px 16px;\n  text-align: center;\n  color: #6b7280;\n  gap: 8px;\n\n  svg {\n    width: 48px;\n    height: 48px;\n    opacity: 0.3;\n  }\n`;\n\nconst EmptyText = styled.div`\n  font-size: 0.875rem;\n  font-weight: 500;\n`;\n\nconst LoadingState = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 32px 16px;\n  gap: 12px;\n  color: #6b7280;\n  font-size: 0.875rem;\n\n  svg {\n    width: 20px;\n    height: 20px;\n    animation: spin 1s linear infinite;\n  }\n\n  @keyframes spin {\n    from { transform: rotate(0deg); }\n    to { transform: rotate(360deg); }\n  }\n`;\n\nconst ErrorState = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  background: #fef2f2;\n  border: 1px solid #fecaca;\n  border-radius: 6px;\n  color: #dc2626;\n  font-size: 0.875rem;\n\n  svg {\n    width: 18px;\n    height: 18px;\n    flex-shrink: 0;\n  }\n`;\n\nconst InvoiceAttachmentsSection = ({\n  fakturaId,\n  objednavkaId,\n  readOnly = false,\n  onAttachmentsChange,\n  defaultCollapsed = false,\n  onISDOCParsed //  Callback pro vyplnn faktury z ISDOC\n}) => {\n  const { username, token } = useContext(AuthContext);\n  const { addToast } = useContext(ToastContext);\n\n  const [collapsed, setCollapsed] = useState(defaultCollapsed);\n  const [loading, setLoading] = useState(false);\n  const [attachments, setAttachments] = useState([]);\n  const [error, setError] = useState(null);\n\n  //  ISDOC parsing state\n  const [showISDOCDialog, setShowISDOCDialog] = useState(false);\n  const [pendingISDOCFile, setPendingISDOCFile] = useState(null);\n  const [isdocSummary, setIsdocSummary] = useState(null);\n\n  // Naten ploh pi mount nebo zmn faktura_id\n  useEffect(() => {\n    if (fakturaId) {\n      loadAttachments();\n    } else {\n      setAttachments([]);\n    }\n  }, [fakturaId]);\n\n  // Naten ploh z API\n  const loadAttachments = async () => {\n    if (!fakturaId) return;\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      const response = await listInvoiceAttachments25({\n        token: token,\n        username: username,\n        faktura_id: fakturaId,\n        objednavka_id: objednavkaId //  PIDNO pro nov Order V2 API\n      });\n\n      //  V2 API response structure: response.data.attachments\n      const attachmentsList = response?.data?.attachments || response.prilohy || [];\n\n      //  DEBUG: Kompletn vpis vech ploh\n\n      //  Kontrola existence fyzickch soubor\n      const processedAttachments = attachmentsList.map(att => {\n        const fileExists = att.file_exists !== false; // Backend by ml vrtit file_exists: false pokud soubor chyb\n        const hasError = att.error || att.file_error;\n\n        if (!fileExists || hasError) {\n          console.warn(' Ploha faktury m problm:', {\n            id: att.id,\n            name: att.original_name || att.originalni_nazev_souboru,\n            file_exists: fileExists,\n            error: hasError,\n            path: att.systemova_cesta\n          });\n        }\n\n        return {\n          ...att,\n          file_exists: fileExists,\n          error: hasError || (!fileExists ? 'Fyzick soubor chyb na disku' : null)\n        };\n      });\n\n      setAttachments(processedAttachments);\n\n      // Callback pro parent\n      if (onAttachmentsChange) {\n        onAttachmentsChange(processedAttachments);\n      }\n\n    } catch (err) {\n      setError(err.message || 'Chyba pi natn ploh');\n      addToast?.('error', 'Chyba pi natn ploh faktury');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Upload handler\n  const handleUpload = async (file, isISDOC) => {\n    if (!fakturaId || !objednavkaId) {\n      throw new Error('Chyb ID faktury nebo objednvky');\n    }\n\n    try {\n      //  Pokud je ISDOC, nabdnout parsing\n      if (isISDOC && onISDOCParsed) {\n        // Naparsovat ISDOC\n        try {\n          const isdocData = await parseISDOCFile(file);\n          const summary = createISDOCSummary(isdocData);\n\n          // Uloit pro pozdj pouit\n          setPendingISDOCFile({ file, isdocData });\n          setIsdocSummary(summary);\n          setShowISDOCDialog(true);\n\n          // Nechat uivatele rozhodnout v dialogu\n          return;\n\n        } catch (parseError) {\n          addToast?.('warning', 'Nepodailo se naparsovat ISDOC soubor. Nahrno jako bn ploha.');\n          // Pokraovat jako bn upload\n        }\n      }\n\n      // Bn upload (nebo ISDOC bez parsingu)\n      await performUpload(file, isISDOC);\n\n    } catch (err) {\n      addToast?.('error', err.message || 'Chyba pi nahrvn plohy');\n      throw err;\n    }\n  };\n\n  // Provede skuten upload na server\n  const performUpload = async (file, isISDOC) => {\n    // Uren typu plohy\n    const typ_prilohy = isISDOC ? 'ISDOC' : 'FAKTURA';\n\n    const response = await uploadInvoiceAttachment25({\n      token: token,\n      username: username,\n      faktura_id: fakturaId,\n      objednavka_id: objednavkaId,\n      typ_prilohy: typ_prilohy,\n      file: file\n    });\n\n\n    addToast?.('success', isISDOC\n      ? 'ISDOC soubor byl spn nahrn'\n      : 'Ploha byla spn nahrna'\n    );\n\n    // Reload attachments\n    await loadAttachments();\n  };\n\n  //  Potvrzen ISDOC parsingu - vyplnit fakturu\n  const handleISDOCConfirm = async () => {\n    if (!pendingISDOCFile) return;\n\n    try {\n      const { file, isdocData } = pendingISDOCFile;\n\n      // 1. Zavolat callback pro vyplnn faktury\n      if (onISDOCParsed) {\n        onISDOCParsed(isdocData);\n      }\n\n      // 2. Nahrt ISDOC soubor jako plohu\n      await performUpload(file, true);\n\n      // 3. Zavt dialog\n      setShowISDOCDialog(false);\n      setPendingISDOCFile(null);\n      setIsdocSummary(null);\n\n      addToast?.('success', 'ISDOC faktura byla spn natena a daje vyplnny');\n\n    } catch (err) {\n      addToast?.('error', err.message || 'Chyba pi zpracovn ISDOC');\n    }\n  };\n\n  //  Nahrt ISDOC bez parsingu\n  const handleISDOCUploadWithoutParsing = async () => {\n    if (!pendingISDOCFile) return;\n\n    try {\n      const { file } = pendingISDOCFile;\n\n      // Nahrt jako bnou plohu\n      await performUpload(file, true);\n\n      // Zavt dialog\n      setShowISDOCDialog(false);\n      setPendingISDOCFile(null);\n      setIsdocSummary(null);\n\n    } catch (err) {\n      addToast?.('error', err.message || 'Chyba pi nahrvn ISDOC');\n    }\n  };\n\n  //  Zruen ISDOC dialogu\n  const handleISDOCCancel = () => {\n    setShowISDOCDialog(false);\n    setPendingISDOCFile(null);\n    setIsdocSummary(null);\n  };\n\n  // Download handler\n  const handleDownload = async (attachment) => {\n    try {\n      const blob = await downloadInvoiceAttachment25({\n        token: token,\n        username: username,\n        faktura_id: fakturaId, //  Order V2 API\n        priloha_id: attachment.id,\n        objednavka_id: objednavkaId //  Order V2 API - required\n      });\n\n      // Nzev souboru - support both API v2 and old API\n      const filename = attachment.original_name || attachment.originalni_nazev_souboru || 'priloha.pdf';\n\n      // Importovat utility funkce\n      const { isPreviewableInBrowser, openInBrowser25 } = await import('../../services/api25orders');\n\n      // Zkontrolovat, zda lze soubor zobrazit v prohlei\n      if (isPreviewableInBrowser(filename)) {\n        const opened = openInBrowser25(blob, filename);\n        \n        if (opened) {\n          // Nabdnout monost staen\n          const shouldDownload = window.confirm(\n            `Ploha \"${filename}\" byla otevena v novm okn.\\n\\nChcete ji tak sthnout?`\n          );\n          \n          if (shouldDownload) {\n            // Create download link\n            const url = window.URL.createObjectURL(blob);\n            const link = document.createElement('a');\n            link.href = url;\n            link.download = filename;\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n            window.URL.revokeObjectURL(url);\n            \n            addToast?.('success', 'Soubor byl staen');\n          }\n          return;\n        }\n      }\n\n      // Pokud nelze zobrazit v prohlei, pmo sthnout\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n\n      addToast?.('success', 'Soubor byl staen');\n\n    } catch (err) {\n      addToast?.('error', err.message || 'Chyba pi stahovn plohy');\n      throw err;\n    }\n  };\n\n  // Delete handler\n  const handleDelete = async (attachment) => {\n    try {\n      //  HARD DELETE - fyzick smazn souboru z disku i DB\n      const response = await deleteInvoiceAttachment25({\n        token: token,\n        username: username,\n        faktura_id: fakturaId, //  Order V2 API\n        priloha_id: attachment.id,\n        objednavka_id: objednavkaId, //  Order V2 API - required\n        hard_delete: 1 //  HARD DELETE - smae soubor z disku\n      });\n\n\n      //  Kontrola response ped reloadem\n      if (response && (response.status === 'ok' || response.status === 'success')) {\n        // Log informac o smazn\n        if (response.data) {\n          const { file_existed, file_deleted_from_disk, db_record_deleted } = response.data;\n\n          //  Zobrazit detailn toast notifikaci podle BE response\n          if (db_record_deleted) {\n            if (file_existed && file_deleted_from_disk) {\n              //  Scn 1: Ve OK\n              addToast?.('success', ' Ploha spn smazna (DB + soubor)');\n            } else if (!file_existed) {\n              //  Scn 2: Soubor u neexistoval\n              addToast?.('warning', ' DB zznam smazn, ale soubor ji na disku neexistoval');\n            } else if (file_existed && !file_deleted_from_disk) {\n              //  Scn 3: Chyba oprvnn\n              addToast?.('warning', ' DB zznam smazn, ale soubor se nepodailo smazat z disku');\n            } else {\n              addToast?.('success', 'Ploha smazna z databze');\n            }\n          } else {\n            addToast?.('error', ' Nepodailo se smazat DB zznam');\n          }\n\n          // Zobrazit warning pokud je v response\n          if (response.warning) {\n          }\n        } else {\n          addToast?.('success', 'Ploha byla smazna');\n        }\n\n        // Reload attachments\n        await loadAttachments();\n      } else {\n        throw new Error(response?.message || 'Neoekvan odpov serveru');\n      }\n\n    } catch (err) {\n      addToast?.('error', ` Chyba pi mazn: ${err.message}`);\n      throw err;\n    }\n  };\n\n  const hasAttachments = attachments.length > 0;\n\n  return (\n    <>\n      <Section>\n        <Header onClick={() => setCollapsed(!collapsed)}>\n          <HeaderLeft>\n            <HeaderIcon>\n              <Paperclip />\n            </HeaderIcon>\n            <HeaderTitle>\n              Plohy faktury\n              {hasAttachments && <Badge>{attachments.length}</Badge>}\n            </HeaderTitle>\n          </HeaderLeft>\n\n          <ToggleIcon>\n            {collapsed ? <ChevronDown /> : <ChevronUp />}\n          </ToggleIcon>\n        </Header>\n\n        <Content collapsed={collapsed}>\n          {/* Upload sekce - VDY dostupn pokud nen readOnly */}\n          {!readOnly && (\n            <UploadSection hasAttachments={hasAttachments}>\n              <InvoiceAttachmentUploadButton\n                onUpload={handleUpload}\n                disabled={loading}\n              />\n            </UploadSection>\n          )}\n\n          {/* Error state */}\n          {error && (\n            <ErrorState>\n              <AlertCircle />\n              {error}\n            </ErrorState>\n          )}\n\n          {/* Loading state */}\n          {loading && (\n            <LoadingState>\n              <Loader />\n              Natm plohy...\n            </LoadingState>\n          )}\n\n          {/* Attachments list */}\n          {!loading && hasAttachments && (\n            <AttachmentsList>\n              {attachments.map((attachment) => (\n                <InvoiceAttachmentItem\n                  key={attachment.id}\n                  attachment={attachment}\n                  onDownload={handleDownload}\n                  onDelete={handleDelete}\n                  readOnly={readOnly}\n                />\n              ))}\n            </AttachmentsList>\n          )}\n\n          {/* Empty state */}\n          {!loading && !error && !hasAttachments && (\n            <EmptyState>\n              <Paperclip />\n              <EmptyText>\n                {readOnly\n                  ? 'Zatm nebyly nahrny dn plohy'\n                  : 'Nahrajte plohy k tto faktue'\n                }\n              </EmptyText>\n            </EmptyState>\n          )}\n        </Content>\n      </Section>\n\n      {/*  ISDOC Parsing Dialog */}\n      {showISDOCDialog && isdocSummary && ReactDOM.createPortal(\n        <ISDOCParsingDialog\n          isdocSummary={isdocSummary}\n          onConfirm={handleISDOCConfirm}\n          onCancel={handleISDOCCancel}\n          onUploadWithoutParsing={handleISDOCUploadWithoutParsing}\n        />,\n        document.body\n      )}\n    </>\n  );\n};\n\nexport default InvoiceAttachmentsSection;\n","import React, { useState, useEffect, useContext, useCallback, useMemo } from 'react';\nimport ReactDOM from 'react-dom';\nimport styled from '@emotion/styled';\nimport { Paperclip, Upload, Download, Trash2, AlertCircle, Loader, FileText, FileX, X, Info, AlertTriangle, CheckCircle2, Sparkles } from 'lucide-react';\nimport {\n  uploadInvoiceAttachment25,\n  listInvoiceAttachments25,\n  downloadInvoiceAttachment25,\n  deleteInvoiceAttachment25,\n  updateInvoiceAttachment25,\n  verifyInvoiceAttachments25,\n  createInvoiceWithAttachment25,\n  isAllowedInvoiceFileType,\n  isAllowedInvoiceFileSize,\n  isISDOCFile,\n  formatFileSize\n} from '../../services/api25invoices';\nimport { AuthContext } from '../../context/AuthContext';\nimport { ToastContext } from '../../context/ToastContext';\nimport { prettyDate } from '../../utils/format';\nimport ISDOCParsingDialog from './ISDOCParsingDialog';\nimport { parseISDOCFile, createISDOCSummary, mapISDOCToFaktura } from '../../utils/isdocParser';\nimport ConfirmDialog from '../ConfirmDialog'; //  Vlastn confirm dialog\nimport { extractTextFromPDF, extractInvoiceData } from '../../utils/invoiceOCR'; //  OCR\n\n/**\n * InvoiceAttachmentsCompact Component\n *\n * PESN PODLE VZORU OBJEDNVKY PLOH:\n * - attachments[] array (lokln + server)\n * - status: 'pending_classification' | 'uploaded'\n * - Klasifikace ped uploadem pomoc <select>\n */\n\nconst Wrapper = styled.div`\n  margin-top: 16px;\n  padding-top: 16px;\n  border-top: 1px solid #e5e7eb;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 12px;\n`;\n\nconst Title = styled.div`\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #374151;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  svg {\n    width: 16px;\n    height: 16px;\n    color: #3b82f6;\n  }\n`;\n\nconst Badge = styled.span`\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 18px;\n  height: 18px;\n  padding: 0 6px;\n  border-radius: 9px;\n  background: #3b82f6;\n  color: #ffffff;\n  font-size: 0.6875rem;\n  font-weight: 600;\n  margin-left: 6px;\n`;\n\nconst DropZone = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 16px;\n  margin-bottom: 12px;\n  border: 2px dashed ${props => props.isDragging ? '#3b82f6' : '#d1d5db'};\n  border-radius: 8px;\n  background: ${props => props.isDragging ? '#eff6ff' : '#ffffff'};\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &:hover {\n    border-color: #3b82f6;\n    background: #f0f9ff;\n  }\n\n  ${props => props.disabled && `\n    opacity: 0.5;\n    cursor: not-allowed;\n    &:hover {\n      border-color: #d1d5db;\n      background: #ffffff;\n    }\n  `}\n`;\n\nconst DropZoneIcon = styled.div`\n  font-size: 1.5rem;\n  color: ${props => props.isDragging ? '#3b82f6' : '#9ca3af'};\n`;\n\nconst DropZoneText = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n`;\n\nconst DropZoneTitle = styled.div`\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: #374151;\n`;\n\nconst DropZoneSubtitle = styled.div`\n  font-size: 0.75rem;\n  color: #9ca3af;\n`;\n\nconst HiddenInput = styled.input`\n  display: none;\n`;\n\nconst AttachmentsList = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n`;\n\nconst AttachmentItem = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 10px 12px;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  gap: 12px;\n  transition: all 0.2s ease;\n\n  &:hover {\n    border-color: #cbd5e1;\n    background: #f3f4f6;\n  }\n`;\n\nconst AttachmentLeft = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  flex: 1;\n  min-width: 0;\n`;\n\nconst AttachmentIcon = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  border-radius: 6px;\n  color: #ffffff;\n  flex-shrink: 0;\n\n  svg {\n    width: 16px;\n    height: 16px;\n  }\n`;\n\nconst AttachmentInfo = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n  min-width: 0;\n  flex: 1;\n`;\n\nconst AttachmentName = styled.div`\n  font-size: 0.8125rem;\n  font-weight: 500;\n  color: #1f2937;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n`;\n\nconst AttachmentMeta = styled.div`\n  font-size: 0.6875rem;\n  color: #6b7280;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n`;\n\nconst ISDOCBadge = styled.span`\n  display: inline-flex;\n  align-items: center;\n  padding: 2px 6px;\n  border-radius: 4px;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  color: #ffffff;\n  font-size: 0.625rem;\n  font-weight: 600;\n`;\n\nconst AttachmentActions = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  flex-shrink: 0;\n`;\n\nconst ActionButton = styled.button`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 28px;\n  height: 28px;\n  border: none;\n  border-radius: 4px;\n  background: ${props => props.variant === 'danger' ? '#fef2f2' : '#ffffff'};\n  color: ${props => props.variant === 'danger' ? '#dc2626' : '#6b7280'};\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n\n  &:hover {\n    background: ${props => props.variant === 'danger' ? '#fee2e2' : '#f3f4f6'};\n    transform: translateY(-1px);\n  }\n\n  &:active {\n    transform: translateY(0);\n  }\n\n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    transform: none;\n  }\n`;\n\nconst EmptyState = styled.div`\n  padding: 16px;\n  text-align: center;\n  color: #9ca3af;\n  font-size: 0.8125rem;\n  background: #f9fafb;\n  border: 1px dashed #d1d5db;\n  border-radius: 6px;\n`;\n\nconst LoadingState = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 16px;\n  gap: 8px;\n  color: #6b7280;\n  font-size: 0.8125rem;\n\n  svg {\n    width: 16px;\n    height: 16px;\n    animation: spin 1s linear infinite;\n  }\n\n  @keyframes spin {\n    from { transform: rotate(0deg); }\n    to { transform: rotate(360deg); }\n  }\n`;\n\nconst ErrorMessage = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 10px;\n  background: #fef2f2;\n  border: 1px solid #fecaca;\n  border-radius: 6px;\n  color: #dc2626;\n  font-size: 0.75rem;\n  margin-top: 8px;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    flex-shrink: 0;\n  }\n`;\n\nconst InfoText = styled.div`\n  font-size: 0.75rem;\n  color: #6b7280;\n  padding: 12px;\n  background: #f9fafb;\n  border-radius: 6px;\n  border: 1px solid #e5e7eb;\n`;\n\nconst InvoiceAttachmentsCompact = ({\n  fakturaId,\n  objednavkaId,\n  fakturaTypyPrilohOptions = [], // FAKTURA_TYP z OrderForm25\n  readOnly = false,\n  onISDOCParsed, //  Callback pro vyplnn faktury z ISDOC\n  formData, //  Pro mapovn stedisek z objednvky\n  faktura, //  Objekt faktury pro validaci povinnch poloek\n  validateInvoiceForAttachments, //  Validan funkce pro fakturu\n  isPokladna = false, //  Je to pokladn doklad? (bez validace povinnch poloek)\n  onAttachmentUploaded, //  Callback po spnm uploadu jakkoliv plohy (vetn ISDOC)\n  attachments: externalAttachments = [], //  Attachments z formData.faktury[].attachments (controlled)\n  onAttachmentsChange, //  Callback pro aktualizaci attachments (controlled component pattern)\n  onCreateInvoiceInDB, //  Callback pro vytvoen faktury v DB (temp  real ID)\n  onOCRDataExtracted //  Callback pro pedn OCR vytench dat\n}) => {\n  const { username, token } = useContext(AuthContext);\n  const { showToast } = useContext(ToastContext); //  OPRAVENO: showToast msto addToast\n\n  const [loading, setLoading] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [error, setError] = useState(null);\n  const [dragging, setDragging] = useState(false);\n  const fileInputRef = React.useRef(null);\n\n  //  ISDOC parsing state\n  const [showISDOCDialog, setShowISDOCDialog] = useState(false);\n  const [pendingISDOCFile, setPendingISDOCFile] = useState(null);\n  const [isdocSummary, setIsdocSummary] = useState(null);\n\n  //  Confirm dialog state\n  const [confirmDialog, setConfirmDialog] = useState({\n    isOpen: false,\n    title: '',\n    message: '',\n    onConfirm: null\n  });\n\n  //  Pout external attachments jako zdroj pravdy (controlled component)\n  const attachments = externalAttachments;\n\n  //  Helper funkce pro aktualizaci attachments (vol onAttachmentsChange callback)\n  const updateAttachments = useCallback((updater) => {\n    if (!onAttachmentsChange) {\n      return;\n    }\n\n    // Pokud je updater funkce, zavolej ji s aktulnmi attachments\n    const newAttachments = typeof updater === 'function' ? updater(attachments) : updater;\n\n    onAttachmentsChange(newAttachments);\n  }, [attachments, onAttachmentsChange]);\n\n  // Naten ploh pi mount nebo zmn faktura_id\n  useEffect(() => {\n\n    if (fakturaId && !String(fakturaId).startsWith('temp-')) {\n      loadAttachmentsFromServer();\n    } else {\n      // NEnulovat attachments - plohy se vytvo a po uploadu\n    }\n  }, [fakturaId]);\n\n  //  AUTO-UPLOAD pending ploh kdy se ID zmn z temp na reln\n  const prevFakturaIdRef = React.useRef(fakturaId);\n\n  useEffect(() => {\n    const uploadPendingAttachments = async () => {\n      // Kontrola: ID se zmnilo z temp na reln\n      const prevId = prevFakturaIdRef.current;\n      const currentId = fakturaId;\n\n      const wasTemp = String(prevId).startsWith('temp-');\n      const isRealNow = currentId && !String(currentId).startsWith('temp-');\n\n      if (!wasTemp || !isRealNow) {\n        // Nen to zmna z temp na reln - ukonit\n        prevFakturaIdRef.current = currentId;\n        return;\n      }\n      // Najdi vechny plohy se statusem 'pending_upload' nebo 'pending'\n      const pendingAttachments = attachments.filter(att => \n        (att.status === 'pending' || att.status === 'pending_upload') && att.file\n      );\n\n      if (pendingAttachments.length === 0) {\n        prevFakturaIdRef.current = currentId;\n        return;\n      }\n      // Nahrt kadou pending plohu\n      for (const attachment of pendingAttachments) {\n        try {\n\n          // Update status -> uploading\n          updateAttachments(prev => prev.map(a =>\n            a.id === attachment.id ? { ...a, status: 'uploading' } : a\n          ));\n\n          const response = await uploadInvoiceAttachment25({\n            token: token,\n            username: username,\n            faktura_id: currentId,\n            objednavka_id: objednavkaId,\n            typ_prilohy: attachment.klasifikace || 'FAKTURA',\n            file: attachment.file\n          });\n          \n          // Zskej ID plohy z rznch monch struktur\n          const attachmentId = response.priloha?.id || \n                              response.priloha_id || \n                              response.data?.priloha?.id || \n                              response.data?.id || \n                              response.id;\n          \n          // Update status -> uploaded\n          updateAttachments(prev => prev.map(a =>\n            a.id === attachment.id ? {\n              ...a,\n              status: 'uploaded',\n              serverId: attachmentId,\n              file: undefined // Odstra File object\n            } : a\n          ));\n\n          showToast&&showToast(` Ploha \"${attachment.name}\" byla spn nahrna`, { type: 'success' });\n\n        } catch (uploadError) {\n\n          // Update status -> error\n          updateAttachments(prev => prev.map(a =>\n            a.id === attachment.id ? { ...a, status: 'error', error: uploadError.message } : a\n          ));\n\n          showToast&&showToast(`Nepodailo se nahrt plohu \"${attachment.name}\"`, { type: 'error' });\n        }\n      }\n\n      // Zavolat callback pro autosave\n      if (onAttachmentUploaded) {\n        onAttachmentUploaded();\n      }\n\n      // Uloit aktuln ID pro pt porovnn\n      prevFakturaIdRef.current = currentId;\n    };\n\n    uploadPendingAttachments();\n  }, [fakturaId, attachments]); // Sleduj fakturaId i attachments\n\n  // Naten ploh ze serveru\n  const loadAttachmentsFromServer = async () => {\n    if (!fakturaId || String(fakturaId).startsWith('temp-')) return;\n    setLoading(true);\n    setError(null);\n\n    try {\n      const response = await listInvoiceAttachments25({\n        token: token,\n        username: username,\n        faktura_id: fakturaId,\n        objednavka_id: objednavkaId //  PIDNO pro nov Order V2 API\n      });\n\n      //  NOV V2 STRUKTURA: response.data.attachments (msto response.prilohy)\n      const attachmentsList = response.data?.attachments || response.prilohy || [];\n\n      //  DEBUG: Kompletn vpis vech ploh\n\n      const serverAttachments = attachmentsList.map(att => {\n        //  Kontrola existence fyzickho souboru\n        const fileExists = att.file_exists !== false; // Backend by ml vrtit file_exists: false pokud soubor chyb\n        const hasError = att.error || att.file_error;\n\n        return {\n          id: att.id,\n          serverId: att.id,\n          name: att.original_name || att.originalni_nazev_souboru,\n          size: att.file_size || att.velikost_souboru_b,\n          type: (att.original_name || att.originalni_nazev_souboru || '').endsWith('.pdf') ? 'application/pdf' : 'application/octet-stream',\n          klasifikace: att.type || att.typ_prilohy || 'FILE', //  Fallback na 'FILE' pokud chyb\n          faktura_typ_nazev: att.faktura_typ_nazev,\n          uploadDate: att.upload_date || att.dt_vytvoreni || new Date().toISOString(), //  Fallback na aktuln as\n          status: fileExists ? 'uploaded' : 'error', //  Oznait pokozen plohy\n          je_isdoc: att.je_isdoc,\n          error: hasError || (!fileExists ? 'Fyzick soubor chyb na disku' : null) //  Chybov zprva\n        };\n      });\n      updateAttachments(serverAttachments);\n\n      //  VERIFY - Zkontrolovat fyzickou existenci soubor na serveru\n      //  OPRAVA: Pout invoice_id msto faktura_id + objednavka_id\n      const numFakturaId = fakturaId ? Number(fakturaId) : null;\n      const isFakturaValid = numFakturaId && !isNaN(numFakturaId) && !String(fakturaId).startsWith('temp-');\n\n      if (isFakturaValid) {\n        try {\n          const verifyResult = await verifyInvoiceAttachments25({\n            token,\n            username,\n            invoice_id: numFakturaId,\n            objednavka_id: objednavkaId\n          });\n\n          if (verifyResult && verifyResult.attachments) {\n            //  OPRAVA: Aktualizovat serverAttachments (ne prev!), pak zavolat updateAttachments\n            const verifiedAttachments = serverAttachments.map(att => {\n              const verifiedAtt = verifyResult.attachments.find(v => v.attachment_id === att.serverId);\n              if (verifiedAtt && !verifiedAtt.file_exists) {\n                return {\n                  ...att,\n                  status: 'error',\n                  error: `Fyzick soubor chyb na serveru (${verifiedAtt.status})`\n                };\n              }\n              return att;\n            });\n\n            // Pouze pokud se nco zmnilo, aktualizuj\n            if (verifiedAttachments.some((att, i) => att.status !== serverAttachments[i].status)) {\n              updateAttachments(verifiedAttachments);\n            }\n\n            // Zobrazit summary pokud jsou njak chybjc soubory\n            const summary = verifyResult.summary || {};\n            if (summary.missing_files > 0) {\n              showToast&&showToast(` ${summary.missing_files} ploha(y) faktury nemaj fyzick soubor na serveru`, { type: 'warning' });\n            }\n          }\n        } catch (verifyErr) {\n          console.error(' Chyba pi verify attachments:', verifyErr);\n          // Neblokovat natn kvli chyb verify\n        }\n      } else {\n        // VERIFY ATTACHMENTS peskoeno - neplatn ID faktury\n      }\n\n    } catch (err) {\n      console.error(' Chyba pi natn ploh faktury:', err);\n      setError(err.message || 'Chyba pi natn ploh');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Validace souboru\n  const validateFile = (file) => {\n    if (!isAllowedInvoiceFileType(file.name)) {\n      throw new Error('Nepodporovan formt souboru');\n    }\n\n    if (!isAllowedInvoiceFileSize(file.size)) {\n      throw new Error('Soubor je pli velk (max 10 MB)');\n    }\n  };\n\n  // Pidn soubor do attachments s pending_classification\n  const handleFileUpload = async (files) => {\n    const fileArray = Array.from(files);\n\n    // Najt ISDOC soubory a nabdnout parsing\n    const isdocFiles = fileArray.filter(f => isISDOCFile(f.name));\n    const nonIsdocFiles = fileArray.filter(f => !isISDOCFile(f.name));\n\n    //  NOV LOGIKA: Validace bnch soubor (ne-ISDOC) pi uploadu\n    // Pro kad ne-ISDOC soubor zkontroluj validaci faktury\n    if (nonIsdocFiles.length > 0 && !isPokladna) {\n      // Zkontroluj validaci (bez file parametru = kontrola zkladnch pol)\n      const validation = validateInvoiceForAttachments ? validateInvoiceForAttachments(faktura) : { isValid: true };\n      \n      if (!validation.isValid) {\n        //  ZAMTNOUT bn soubory - chyb povinn pole\n        //  Strukturovan chybov zprva (PESN jako OrderForm25)\n        const errorMessage = (\n          <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n            <div style={{ \n              fontSize: '15px', \n              fontWeight: '600', \n              marginBottom: '12px', \n              color: '#1a1a1a',\n              display: 'flex',\n              alignItems: 'center',\n              gap: '8px'\n            }}>\n              <AlertCircle size={20} color=\"#ff4d4f\" style={{ flexShrink: 0 }} />\n              <span>Pro uloen je nutn vyplnit nsledujc poloky:</span>\n            </div>\n            {Object.values(validation.categories).map((cat, idx) => \n              cat.errors.length > 0 && (\n                <div key={idx} style={{ \n                  marginBottom: '10px',\n                  padding: '10px',\n                  backgroundColor: '#fff1f0',\n                  borderRadius: '4px'\n                }}>\n                  <div style={{ \n                    fontWeight: '600', \n                    fontSize: '13px',\n                    color: '#d32f2f',\n                    marginBottom: '6px'\n                  }}>\n                    {cat.label}\n                  </div>\n                  {cat.errors.map((err, errIdx) => (\n                    <div key={errIdx} style={{ \n                      fontSize: '12px',\n                      color: '#666',\n                      marginLeft: '8px',\n                      marginTop: '4px',\n                      display: 'flex',\n                      alignItems: 'flex-start'\n                    }}>\n                      <span style={{ marginRight: '6px', color: '#ff4d4f', fontWeight: 'bold' }}></span>\n                      <span>{err}</span>\n                    </div>\n                  ))}\n                </div>\n              )\n            )}\n          </div>\n        );\n        \n        showToast && showToast(errorMessage, { type: 'error' });\n        return; // Ukonit upload\n      }\n    }\n\n    //  Pokud je prv 1 ISDOC soubor a mme callback, nabdnout parsing\n    if (isdocFiles.length === 1 && onISDOCParsed) {\n      const isdocFile = isdocFiles[0];\n\n      try {\n        // Validace souboru\n        validateFile(isdocFile);\n\n        // Naparsovat ISDOC\n        const isdocData = await parseISDOCFile(isdocFile);\n        const summary = createISDOCSummary(isdocData);\n\n        // Uloit pro pozdj pouit\n        setPendingISDOCFile({\n          file: isdocFile,\n          isdocData,\n          otherFiles: nonIsdocFiles // Ppadn dal soubory\n        });\n        setIsdocSummary(summary);\n        setShowISDOCDialog(true);\n\n        // Zpracovn probh v dialogu\n        return;\n\n      } catch (parseError) {\n        showToast&&showToast('Nepodailo se naparsovat ISDOC soubor. Nahrno jako bn ploha.', { type: 'error' });\n        // Pokraovat jako bn upload (spadne do kdu ne)\n      }\n    }\n\n    // Bn upload (vechny soubory nebo ISDOC po chyb parsingu)\n    const newFiles = fileArray.map((file, index) => {\n      try {\n        validateFile(file);\n\n        //  Automatick klasifikace podle typu souboru\n        const jeISDOC = isISDOCFile(file.name);\n        // ISDOC -> 'ISDOC', ostatn soubory (PDF, JPG, atd.) -> 'FAKTURA' (vchoz)\n        const autoKlasifikace = jeISDOC ? 'ISDOC' : 'FAKTURA';\n\n        return {\n          id: `pending-${Date.now()}-${index}`,\n          file: file,\n          name: file.name,\n          size: file.size,\n          type: file.type,\n          klasifikace: autoKlasifikace, //  Automatick klasifikace\n          uploadDate: new Date().toISOString(),\n          status: 'pending_upload', //  Ready k uploadu s auto-klasifikac\n          je_isdoc: jeISDOC ? 1 : 0\n        };\n      } catch (err) {\n        showToast&&showToast(`${file.name}: ${err.message}`, { type: 'error' });\n        return null;\n      }\n    }).filter(Boolean);\n\n    if (newFiles.length > 0) {\n      updateAttachments(prev => [...prev, ...newFiles]);\n\n      // New files added\n\n      //  Automatick upload vech soubor (maj ji klasifikaci)\n      //  Toast \"Nahrvm...\" odstrann - zbyten info, uivatel vid progress\n\n      //  Pro temp faktury pouze uloit lokln, pro reln faktury uploadnout\n      const isTempFaktura = String(fakturaId).startsWith('temp-');\n      \n      // Auto-uploading files\n      \n      //  State update je async, musme pokat na dal render\n      // Msto toho pouvme newFiles pmo\n      if (!isTempFaktura) {\n        // Starting upload for non-temp faktura\n        for (const file of newFiles) {\n          await uploadFileToServer(file.id, file.klasifikace, file);\n        }\n      } else {\n        // Starting upload for temp faktura\n        // Pro temp faktury zavolat uploadFileToServer (kter je ulo lokln s pending_upload)\n        for (const file of newFiles) {\n          await uploadFileToServer(file.id, file.klasifikace, file);\n        }\n      }\n    }\n  };\n\n  // Pomocn funkce pro UI styling ploh - STEJN JAKO U OBJEDNVEK\n  const getFileBorderColor = (file) => {\n    if (!file) return '#e5e7eb'; // Default pro undefined\n    if (file.status === 'error') return '#fca5a5';\n    if (!file.klasifikace) return '#fca5a5';\n    if (file.status === 'uploading') return '#f59e0b';\n    if (file.status === 'uploaded') return '#10b981';\n    if (file.status === 'pending_upload') return '#3b82f6'; // Modr pro ekajc\n    return '#e5e7eb';\n  };\n\n  const getFileBackgroundColor = (file) => {\n    if (!file) return 'white'; // Default pro undefined\n    if (file.status === 'error') return '#fef2f2';\n    if (!file.klasifikace) return '#fef2f2';\n    if (file.status === 'uploading') return '#fffbeb';\n    if (file.status === 'uploaded') return '#f0fdf4';\n    if (file.status === 'pending_upload') return '#eff6ff'; // Svtle modr pro ekajc\n    return 'white';\n  };\n\n  // Update klasifikace\n  const updateFileKlasifikace = async (fileId, klasifikace) => {\n    const file = attachments.find(f => f.id === fileId);\n    if (!file) return;\n\n    // Update lokln\n    updateAttachments(prev => prev.map(f =>\n      f.id === fileId ? { ...f, klasifikace } : f\n    ));\n\n    //  Pokud m klasifikaci a ek na upload -> automaticky upload\n    // (pending_classification i pending_upload)\n    if (klasifikace && klasifikace.trim() !== '' && (file.status === 'pending_classification' || file.status === 'pending_upload')) {\n      // Triggering auto-upload for pending file\n      // Upload s aktualizovanou klasifikac\n      await uploadFileToServer(fileId, klasifikace);\n    }\n    // Pokud je ji nahran na serveru -> update pes API\n    else if (klasifikace && klasifikace.trim() !== '' && file.status === 'uploaded' && file.serverId) {\n      try {\n        //  Pokud je klasifikace stejn jako pvodn, pesko update\n        if (file.klasifikace === klasifikace) {\n          // Klasifikace se nezmnila, skip update\n          return;\n        }\n\n        await updateInvoiceAttachment25({\n          token: token,\n          username: username,\n          faktura_id: fakturaId,\n          priloha_id: file.serverId,\n          objednavka_id: objednavkaId,\n          typ_prilohy: klasifikace,\n          type: klasifikace  //  Poli OBA parametry pro jistotu (type m pednost)\n        });\n\n        // Najdi nzev typu plohy pro zobrazen\n        const typPrilohy = fakturaTypyPrilohOptions.find(t => t.kod === klasifikace);\n\n        // Update lokln s nzvem\n        updateAttachments(prev => prev.map(f =>\n          f.id === fileId ? {\n            ...f,\n            klasifikace,\n            faktura_typ_nazev: typPrilohy?.nazev || klasifikace\n          } : f\n        ));\n\n        showToast&&showToast('Klasifikace byla aktualizovna', { type: 'success' });\n\n      } catch (err) {\n        showToast&&showToast(`Chyba pi aktualizaci: ${err.message}`, { type: 'error' });\n\n        // Vrtit zpt pvodn klasifikaci\n        updateAttachments(prev => prev.map(f =>\n          f.id === fileId ? { ...f, klasifikace: file.klasifikace } : f\n        ));\n      }\n    }\n  };\n\n  // Upload na server\n  const uploadFileToServer = async (fileId, klasifikaceOverride = null, fileObj = null) => {\n    // Pouij pedan fileObj nebo hledej v attachments state\n    const file = fileObj || attachments.find(f => f.id === fileId);\n    if (!file || !file.file) {\n      // File not found or no file object\n      return;\n    }\n\n    const klasifikace = klasifikaceOverride || file.klasifikace;\n\n    if (!klasifikace || klasifikace.trim() === '') {\n      showToast&&showToast('Vyberte typ plohy', { type: 'error' });\n      return;\n    }\n\n    //  Pokud m faktura temp-ID, NEJDV vytvoit fakturu v DB\n    const isTempFaktura = String(fakturaId).startsWith('temp-');\n    \n    // uploadFileToServer\n    \n    if (isTempFaktura) {\n      // Validace povinnch pol faktury ped vytvoenm v DB\n      if (!isPokladna) {\n        const validation = validateInvoiceForAttachments?.(faktura, file.file);\n        \n        // Validace faktury\n        \n        //  Pro ISDOC povolit upload i bez validnch pol\n        if (!validation?.isValid && !validation?.isISDOC) {\n          showToast&&showToast(\n            `Pro nahrn tto plohy vyplte nejprve: ${validation?.missingFields?.join(', ') || 'povinn pole'}`,\n            { type: 'error' }\n          );\n          return;\n        }\n        \n        // Info pro ISDOC s chybjcmi poli\n        if (validation?.isISDOC && validation?.missingFields?.length > 0) {\n          showToast&&showToast(\n            ' ISDOC soubor - data faktury budou extrahovna po nahrn',\n            { type: 'info' }\n          );\n        }\n      }\n\n      // Ozna jako \"uploading\" - vytvme fakturu v DB\n      updateAttachments(prev => prev.map(f =>\n        f.id === fileId ? {\n          ...f,\n          status: 'uploading',\n          klasifikace\n        } : f\n      ));\n\n      try {\n        //  CALLBACK: Vytvo fakturu v DB a zskej reln ID\n        if (!onCreateInvoiceInDB) {\n          throw new Error('Chyb callback pro vytvoen faktury v DB');\n        }\n\n        // Volm onCreateInvoiceInDB callback\n        showToast&&showToast(' Vytvm fakturu v databzi...', { type: 'info' });\n        \n        const realFakturaId = await onCreateInvoiceInDB(fakturaId);\n        \n        // Faktura vytvoena\n        \n        if (!realFakturaId || String(realFakturaId).startsWith('temp-')) {\n          throw new Error('Nepodailo se zskat reln ID faktury');\n        }\n\n        showToast&&showToast(' Faktura vytvoena, nahrvm plohu...', { type: 'info' });\n\n        // Najdi nzev typu plohy pro zobrazen\n        const typPrilohy = fakturaTypyPrilohOptions.find(t => t.kod === klasifikace);\n\n        //  DEBUG: Payload ped uploadem plohy\n        const attachmentPayload = {\n          token: token,\n          username: username,\n          faktura_id: realFakturaId,\n          objednavka_id: objednavkaId,\n          typ_prilohy: klasifikace,\n          file: {\n            name: file.file.name,\n            size: file.file.size,\n            type: file.file.type\n          }\n        };\n        console.group(' DEBUG: Upload plohy faktury');\n        // REQUEST Payload\n\n        // Te nahrajeme plohu s relnm ID faktury\n        const response = await uploadInvoiceAttachment25({\n          token: token,\n          username: username,\n          faktura_id: realFakturaId, //  Reln ID\n          objednavka_id: objednavkaId,\n          typ_prilohy: klasifikace,\n          file: file.file\n        });\n\n        //  DEBUG: Response z backendu\n        // RESPONSE\n        console.groupEnd();\n\n        // Zskej ID plohy z rznch monch struktur\n        const attachmentId = response.priloha?.id || \n                            response.priloha_id || \n                            response.data?.priloha?.id || \n                            response.data?.id || \n                            response.id;\n\n        // Attachment ID (temp upload)\n\n        // Update s server ID\n        updateAttachments(prev => prev.map(f =>\n          f.id === fileId ? {\n            ...f,\n            status: 'uploaded',\n            serverId: attachmentId,\n            klasifikace: klasifikace, //  Uloit klasifikaci pro pozdj porovnn\n            faktura_typ_nazev: typPrilohy?.nazev || klasifikace,\n            file: undefined // Odstra File object\n          } : f\n        ));\n\n        // Ploha spn nahrna - zelen stylovan toast\n        const successMessage = (\n          <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n            <div style={{ \n              fontSize: '15px', \n              fontWeight: '600', \n              marginBottom: '8px', \n              color: '#1a1a1a',\n              display: 'flex',\n              alignItems: 'center',\n              gap: '8px'\n            }}>\n              <CheckCircle2 size={20} color=\"#10b981\" style={{ flexShrink: 0 }} />\n              <span>Ploha spn nahrna</span>\n            </div>\n            <div style={{ \n              padding: '8px',\n              backgroundColor: '#f0fdf4',\n              borderRadius: '4px',\n              fontSize: '13px',\n              color: '#166534'\n            }}>\n              {file.file.name}\n            </div>\n          </div>\n        );\n        showToast&&showToast(successMessage, { type: 'success' });\n\n        //  Refresh attachments ze serveru pro synchronizaci\n        await loadAttachmentsFromServer();\n\n        //  Zavolat callback pro autosave s uploadnutou plohou\n        if (onAttachmentUploaded) {\n          const uploadedAttachment = {\n            id: attachmentId,\n            faktura_id: realFakturaId,\n            typ_prilohy: klasifikace,\n            typ_prilohy_nazev: typPrilohy?.nazev || klasifikace,\n            nazev_souboru: file.file.name,\n            velikost: file.file.size,\n            status: 'uploaded',\n            datum_vytvoreni: new Date().toISOString()\n          };\n          onAttachmentUploaded(realFakturaId, uploadedAttachment);\n        }\n\n        return;\n\n      } catch (err) {\n        console.group(' CHYBA pi uploadu s temp ID');\n        console.error('Error object:', err);\n        console.error('Error message:', err.message);\n        console.error('Error stack:', err.stack);\n        if (err.response) {\n          console.error('Response data:', err.response.data);\n          console.error('Response status:', err.response.status);\n        }\n        console.groupEnd();\n        \n        // Status -> error\n        updateAttachments(prev => prev.map(f =>\n          f.id === fileId ? { \n            ...f, \n            status: 'error',\n            error: err.message || 'Chyba pi nahrvn'\n          } : f\n        ));\n\n        // Lep error zprva s nzvem souboru\n        const fileName = fileObj?.name || 'soubor';\n        let errorMsg = err.message || 'Nepodailo se nahrt plohu';\n        \n        // Zkontrolovat, jestli jde o nepodporovan typ souboru\n        if (errorMsg.includes('Nepodporovan typ souboru') || errorMsg.includes('Povolen typy')) {\n          showToast&&showToast(\n            ` Soubor \"${fileName}\" nelze nahrt\\n\\n${errorMsg}`,\n            { type: 'error' }\n          );\n        } else {\n          showToast&&showToast(\n            ` Chyba pi nahrvn \"${fileName}\": ${errorMsg}`,\n            { type: 'error' }\n          );\n        }\n        return;\n      }\n    }\n\n    // Status -> uploading\n    updateAttachments(prev => prev.map(f =>\n      f.id === fileId ? { ...f, status: 'uploading' } : f\n    ));\n    try {\n      const response = await uploadInvoiceAttachment25({\n        token: token,\n        username: username,\n        faktura_id: fakturaId,\n        objednavka_id: objednavkaId,\n        typ_prilohy: klasifikace, // Pouij klasifikaci z parametru\n        file: file.file\n      });\n      \n      // Upload response\n      \n      // Najdi nzev typu plohy pro zobrazen\n      const typPrilohy = fakturaTypyPrilohOptions.find(t => t.kod === klasifikace);\n\n      // Zskej ID plohy z rznch monch struktur\n      const attachmentId = response.priloha?.id || \n                          response.priloha_id || \n                          response.data?.priloha?.id || \n                          response.data?.id || \n                          response.id;\n\n      // Attachment ID\n\n      // Update s server ID\n      updateAttachments(prev => prev.map(f =>\n        f.id === fileId ? {\n          ...f,\n          status: 'uploaded',\n          serverId: attachmentId,\n          klasifikace: klasifikace, //  Uloit klasifikaci\n          faktura_typ_nazev: typPrilohy?.nazev || klasifikace, // Nzev pro zobrazen\n          file: undefined // Odstra File object\n        } : f\n      ));\n\n      // Zelen stylovan success toast\n      const successMessage = (\n        <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n          <div style={{ \n            fontSize: '15px', \n            fontWeight: '600', \n            marginBottom: '8px', \n            color: '#1a1a1a',\n            display: 'flex',\n            alignItems: 'center',\n            gap: '8px'\n          }}>\n            <CheckCircle2 size={20} color=\"#10b981\" style={{ flexShrink: 0 }} />\n            <span>Ploha spn nahrna</span>\n          </div>\n          <div style={{ \n            padding: '8px',\n            backgroundColor: '#f0fdf4',\n            borderRadius: '4px',\n            fontSize: '13px',\n            color: '#166534'\n          }}>\n            {file.file.name}\n          </div>\n        </div>\n      );\n      showToast&&showToast(successMessage, { type: 'success' });\n\n      //  Refresh attachments ze serveru pro synchronizaci\n      await loadAttachmentsFromServer();\n\n      //  Zavolat callback pro autosave s uploadnutou plohou\n      if (onAttachmentUploaded) {\n        const uploadedAttachment = {\n          id: attachmentId,\n          faktura_id: fakturaId,\n          typ_prilohy: klasifikace,\n          typ_prilohy_nazev: typPrilohy?.nazev || klasifikace,\n          nazev_souboru: file.file.name,\n          velikost: file.file.size,\n          status: 'uploaded',\n          datum_vytvoreni: new Date().toISOString()\n        };\n        onAttachmentUploaded(fakturaId, uploadedAttachment);\n      }\n\n    } catch (err) {\n\n      // Status -> error (pending znovu)\n      updateAttachments(prev => prev.map(f =>\n        f.id === fileId ? { ...f, status: 'pending_classification' } : f\n      ));\n\n      showToast&&showToast('Nepodailo se nahrt plohu', { type: 'error' });\n    }\n  };\n\n  // Odstrann souboru (lokln ped uploadem)\n  const removeFile = (fileId) => {\n    const file = attachments.find(f => f.id === fileId);\n    if (!file) return;\n\n    //  Zobrazit confirm dialog\n    setConfirmDialog({\n      isOpen: true,\n      title: 'Odstranit plohu',\n      message: `Opravdu chcete odstranit plohu \"${file.name}\"?`,\n      onConfirm: () => {\n        //  Odstranit z loklnho stavu\n        updateAttachments(prev => prev.filter(f => f.id !== fileId));\n        showToast&&showToast(' Ploha odstranna', { type: 'success' });\n        setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null });\n      }\n    });\n  };\n\n  // Smazn ze serveru\n  const deleteFromServer = async (fileId) => {\n    const file = attachments.find(f => f.id === fileId);\n    if (!file || !file.serverId) {\n      return;\n    }\n\n    //  Zobrazit confirm dialog\n    setConfirmDialog({\n      isOpen: true,\n      title: 'Smazat plohu',\n      message: `Opravdu chcete smazat plohu \"${file.name}\"?`,\n      onConfirm: async () => {\n\n        try {\n          //  HARD DELETE - fyzick smazn souboru z disku i DB\n          const response = await deleteInvoiceAttachment25({\n            token: token,\n            username: username,\n            faktura_id: fakturaId, //  Order V2 API\n            priloha_id: file.serverId,\n            objednavka_id: objednavkaId, //  Order V2 API - required\n            hard_delete: 1 //  HARD DELETE - smae soubor z disku\n          });\n\n          // DELETE Response\n\n          //  Kontrola response ped aktualizac UI\n          if (response && (response.status === 'ok' || response.status === 'success' || response.success === true)) {\n            // Log informac o smazn\n            if (response.data) {\n              //  Podle BE dokumentace: Pokud je status='ok', DB zznam JE smazn (vdy)\n              // Zobraz success, ale upozorni na warning pokud nco bylo patn se souborem\n              if (response.warning) {\n                //  Warning = DB smazno, ale problm se souborem na disku\n                showToast&&showToast(' Ploha smazna (s varovnm)', { type: 'warning' });\n                console.warn(' Warning:', response.warning);\n              } else {\n                //  Ve OK - DB i soubor smazny\n                showToast&&showToast(' Ploha byla spn smazna', { type: 'success' });\n              }\n            } else {\n              // Star struktura bez detail\n              showToast&&showToast(' Ploha byla spn smazna', { type: 'success' });\n            }\n\n            //  Zavt dialog\n            setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null });\n\n            //  RELOAD ploh ze serveru (synchronizace)\n            await loadAttachmentsFromServer();\n\n            //  Zavolat callback pro autosave (pokud existuje)\n            if (onAttachmentUploaded) {\n              onAttachmentUploaded();\n            }\n          } else {\n            throw new Error(response?.message || 'Neoekvan odpov serveru');\n          }\n\n        } catch (err) {\n          console.error(' DELETE Error:', err);\n          console.error('Error message:', err.message);\n          console.error('Error response:', err.response?.data);\n          showToast&&showToast(`Nepodailo se smazat plohu: ${err.message}`, { type: 'error' });\n          setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null });\n        }\n      }\n    });\n  };\n\n  // Download\n  const handleDownload = async (fileId) => {\n    const file = attachments.find(f => f.id === fileId);\n    if (!file || !file.serverId) return;\n\n    try {\n      const blob = await downloadInvoiceAttachment25({\n        token: token,\n        username: username,\n        faktura_id: fakturaId, //  Order V2 API\n        priloha_id: file.serverId,\n        objednavka_id: objednavkaId //  Order V2 API - required\n      });\n\n      const filename = file.name || 'priloha.pdf';\n\n      // Importovat utility funkce\n      const { isPreviewableInBrowser, openInBrowser25 } = await import('../../services/api25orders');\n\n      // Zkontrolovat, zda lze soubor zobrazit v prohlei\n      if (isPreviewableInBrowser(filename)) {\n        const opened = openInBrowser25(blob, filename);\n        \n        if (opened) {\n          //  Soubor oteven v novm okn - neptat se na staen\n          showToast&&showToast('Ploha otevena v novm okn', { type: 'success' });\n          return;\n        }\n      }\n\n      // Pokud nelze zobrazit v prohlei, pmo sthnout\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n\n      showToast&&showToast('Soubor sten', { type: 'success' });\n\n    } catch (err) {\n      showToast&&showToast(`Chyba: ${err.message}`, { type: 'error' });\n    }\n  };\n\n  //  OCR EXTRAKCE Z PDF\n  const handleOCRExtraction = async (fileId) => {\n    const file = attachments.find(f => f.id === fileId);\n    if (!file) return;\n\n    // Kontrola, zda je soubor PDF\n    const isPDF = file.name?.toLowerCase().endsWith('.pdf') || file.type === 'application/pdf';\n    if (!isPDF) {\n      showToast&&showToast('OCR funguje pouze pro PDF soubory', { type: 'error' });\n      return;\n    }\n\n    // Zskme file object - bu z nahranho souboru nebo sthneme ze serveru\n    let fileBlob = file.file;\n    \n    if (!fileBlob && file.serverId) {\n      // Pokud je soubor ji nahrn na serveru, musme ho sthnout\n      try {\n        fileBlob = await downloadInvoiceAttachment25({\n          token: token,\n          username: username,\n          faktura_id: fakturaId,\n          priloha_id: file.serverId,\n          objednavka_id: objednavkaId\n        });\n      } catch (err) {\n        showToast&&showToast('Nepodailo se sthnout PDF pro OCR: ' + err.message, { type: 'error' });\n        return;\n      }\n    }\n\n    if (!fileBlob) {\n      showToast&&showToast('Soubor nen k dispozici pro OCR', { type: 'error' });\n      return;\n    }\n\n    // Vytvome File object, pokud mme jen Blob\n    const fileObject = fileBlob instanceof File \n      ? fileBlob \n      : new File([fileBlob], file.name, { type: 'application/pdf' });\n\n    // Zobrazme progress toast\n    let currentToastId = null;\n    \n    const updateProgress = (progress, message) => {\n      const progressContent = (\n        <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n          <div style={{ fontSize: '15px', fontWeight: '600', marginBottom: '8px', color: '#1a1a1a', display: 'flex', alignItems: 'center', gap: '8px' }}>\n            <Sparkles size={20} color=\"#8b5cf6\" style={{ flexShrink: 0 }} />\n            <span>OCR extrakce z PDF</span>\n          </div>\n          <div style={{ padding: '8px', backgroundColor: '#f5f3ff', borderRadius: '4px', fontSize: '13px', color: '#6d28d9' }}>\n            <div style={{ marginBottom: '4px' }}>{message}</div>\n            <div style={{ height: '4px', backgroundColor: '#e9d5ff', borderRadius: '2px', overflow: 'hidden' }}>\n              <div style={{ \n                height: '100%', \n                width: `${progress}%`, \n                backgroundColor: '#8b5cf6', \n                transition: 'width 0.3s ease' \n              }} />\n            </div>\n          </div>\n        </div>\n      );\n\n      if (currentToastId) {\n        // Update existing toast - musme najt a aktualizovat v ToastContext\n        // Pro jednoduchost vytvome nov toast\n        showToast&&showToast(progressContent, { type: 'info', duration: 999999 });\n      } else {\n        currentToastId = showToast&&showToast(progressContent, { type: 'info', duration: 999999 });\n      }\n    };\n\n    try {\n      // Spustme OCR extrakci\n      const extractedText = await extractTextFromPDF(fileObject, updateProgress);\n      \n      // Vytme data faktury z textu\n      const extractedData = extractInvoiceData(extractedText);\n      \n      console.log(' OCR Extracted Data:', extractedData);\n\n      // Zaveme progress toast\n      if (currentToastId) {\n        // ToastContext by ml mt metodu na zaven konkrtnho toastu\n        // Pro te jen nechme vymizet automaticky\n      }\n\n      // Zobrazit varovn, pokud dokument nen faktura\n      if (extractedData.warning) {\n        const warningContent = (\n          <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n            <div style={{ fontSize: '15px', fontWeight: '600', marginBottom: '8px', color: '#1a1a1a', display: 'flex', alignItems: 'center', gap: '8px' }}>\n              <AlertTriangle size={20} color=\"#f59e0b\" style={{ flexShrink: 0 }} />\n              <span>Varovn - Nen faktura</span>\n            </div>\n            <div style={{ padding: '8px', backgroundColor: '#fffbeb', borderRadius: '4px', fontSize: '13px', color: '#92400e' }}>\n              {extractedData.warning}\n            </div>\n          </div>\n        );\n        showToast&&showToast(warningContent, { type: 'warning', duration: 8000 });\n      }\n\n      // Zkontrolujeme, co se podailo vytit\n      const foundFields = [];\n      if (extractedData.variabilniSymbol) foundFields.push('Variabiln symbol');\n      if (extractedData.datumVystaveni) foundFields.push('Datum vystaven');\n      if (extractedData.datumSplatnosti) foundFields.push('Datum splatnosti');\n      if (extractedData.castka) foundFields.push('stka');\n\n      if (foundFields.length === 0) {\n        showToast&&showToast(' Nepodailo se vytit dn data z PDF', { type: 'error' });\n        return;\n      }\n\n      // Zobrazme nalezen daje\n      const successContent = (\n        <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n          <div style={{ fontSize: '15px', fontWeight: '600', marginBottom: '8px', color: '#1a1a1a', display: 'flex', alignItems: 'center', gap: '8px' }}>\n            <CheckCircle2 size={20} color=\"#10b981\" style={{ flexShrink: 0 }} />\n            <span>OCR extrakce spn</span>\n          </div>\n          <div style={{ padding: '8px', backgroundColor: '#f0fdf4', borderRadius: '4px', fontSize: '13px', color: '#166534' }}>\n            <div style={{ marginBottom: '4px', fontWeight: '500' }}>Nalezen daje:</div>\n            {extractedData.variabilniSymbol && (\n              <div> Variabiln symbol: {extractedData.variabilniSymbol}</div>\n            )}\n            {extractedData.datumVystaveni && (\n              <div> Datum vystaven: {extractedData.datumVystaveni}</div>\n            )}\n            {extractedData.datumSplatnosti && (\n              <div> Datum splatnosti: {extractedData.datumSplatnosti}</div>\n            )}\n            {extractedData.castka && (\n              <div> stka v. DPH: {extractedData.castka.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K</div>\n            )}\n          </div>\n        </div>\n      );\n\n      showToast&&showToast(successContent, { type: 'success', duration: 10000 });\n\n      //  CALLBACK: Pedat vyten data zpt do formule\n      if (onOCRDataExtracted) {\n        onOCRDataExtracted(extractedData);\n      }\n\n    } catch (err) {\n      console.error(' OCR Error:', err);\n      \n      const errorContent = (\n        <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n          <div style={{ fontSize: '15px', fontWeight: '600', marginBottom: '8px', color: '#1a1a1a', display: 'flex', alignItems: 'center', gap: '8px' }}>\n            <AlertCircle size={20} color=\"#dc2626\" style={{ flexShrink: 0 }} />\n            <span>Chyba pi OCR extrakci</span>\n          </div>\n          <div style={{ padding: '8px', backgroundColor: '#fef2f2', borderRadius: '4px', fontSize: '13px', color: '#991b1b' }}>\n            {err.message}\n            <div style={{ marginTop: '8px', fontSize: '12px', color: '#6b7280' }}>\n               Mete vyplnit daje manuln z nhledu PDF\n            </div>\n          </div>\n        </div>\n      );\n      \n      showToast&&showToast(errorContent, { type: 'error', duration: 8000 });\n    }\n  };\n\n  //  Validace faktury pro pidn ploh - VYPOTAT PED HANDLERS\n  const invoiceValidation = useMemo(() => {\n    if (isPokladna) {\n      // Pokladn doklad nem povinn poloky\n      return { isValid: true, missingFields: [] };\n    }\n    if (!faktura) {\n      // Pokud nen faktura pedna, nelze validovat\n      return { isValid: false, missingFields: ['Faktura'] };\n    }\n    if (!validateInvoiceForAttachments) {\n      // Pokud nen validan funkce, pedpokldme e je validn (fallback)\n      return { isValid: true, missingFields: [] };\n    }\n    return validateInvoiceForAttachments(faktura);\n  }, [faktura, validateInvoiceForAttachments, isPokladna]);\n\n  //  NOV LOGIKA: Dropzona je VDY aktivn (validace probh pi uploadu)\n  // Disabled pouze kdy: uploading, loading nebo readOnly\n  const isDropzoneDisabled = uploading || loading || readOnly;\n\n  // Drag & Drop handlers\n  const handleDragOver = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!isDropzoneDisabled) {\n      setDragging(true);\n    }\n  };\n\n  const handleDragLeave = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.currentTarget === e.target || !e.currentTarget.contains(e.relatedTarget)) {\n      setDragging(false);\n    }\n  };\n\n  const handleDrop = async (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragging(false);\n\n    if (isDropzoneDisabled) return;\n\n    //  PRIORITA 1a: Kontrola drag & drop VECH ploh faktury ze spisovky\n    const spisovkaAttachmentsJson = e.dataTransfer.getData('text/spisovka-attachments');\n    \n    if (spisovkaAttachmentsJson) {\n      try {\n        const attachments = JSON.parse(spisovkaAttachmentsJson);\n        \n        if (!Array.isArray(attachments) || attachments.length === 0) {\n          showToast && showToast(' dn plohy k nahrn', { type: 'error' });\n          return;\n        }\n\n        //  VALIDACE PED STAENM (jen pro ne-ISDOC soubory)\n        const hasISDOC = attachments.some(a => isISDOCFile(a.filename));\n        \n        if (!hasISDOC && !isPokladna) {\n          const validation = validateInvoiceForAttachments ? validateInvoiceForAttachments(faktura) : { isValid: true };\n          \n          if (!validation.isValid) {\n            const errorMessage = (\n              <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n                <div style={{ \n                  fontSize: '15px', \n                  fontWeight: '600', \n                  marginBottom: '12px', \n                  color: '#1a1a1a',\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: '8px'\n                }}>\n                  <AlertCircle size={20} color=\"#ff4d4f\" style={{ flexShrink: 0 }} />\n                  <span>Pro uloen je nutn vyplnit nsledujc poloky:</span>\n                </div>\n                {Object.values(validation.categories).map((cat, idx) => \n                  cat.errors.length > 0 && (\n                    <div key={idx} style={{ \n                      marginBottom: '10px',\n                      padding: '10px',\n                      backgroundColor: '#fff1f0',\n                      borderRadius: '4px'\n                    }}>\n                      <div style={{ \n                        fontWeight: '600', \n                        fontSize: '13px',\n                        color: '#d32f2f',\n                        marginBottom: '6px'\n                      }}>\n                        {cat.label}\n                      </div>\n                      {cat.errors.map((err, errIdx) => (\n                        <div key={errIdx} style={{ \n                          fontSize: '12px',\n                          color: '#666',\n                          marginLeft: '8px',\n                          marginTop: '4px',\n                          display: 'flex',\n                          alignItems: 'flex-start'\n                        }}>\n                          <span style={{ marginRight: '6px', color: '#ff4d4f', fontWeight: 'bold' }}></span>\n                          <span>{err}</span>\n                        </div>\n                      ))}\n                    </div>\n                  )\n                )}\n              </div>\n            );\n            showToast && showToast(errorMessage, { type: 'error' });\n            return;\n          }\n        }\n\n        // Sthnout vechny soubory paraleln\n        const downloadPromises = attachments.map(async (attachment) => {\n          const proxyUrl = `${process.env.REACT_APP_API2_BASE_URL}spisovka.php/proxy-file?url=${encodeURIComponent(attachment.url)}`;\n          const response = await fetch(proxyUrl);\n          if (!response.ok) throw new Error(`Chyba pi stahovn ${attachment.filename}`);\n          \n          const originalFilename = response.headers.get('X-Original-Filename');\n          const finalFilename = originalFilename || attachment.filename;\n          \n          const blob = await response.blob();\n          return new File([blob], finalFilename, { type: attachment.mime_type || blob.type });\n        });\n\n        const files = await Promise.all(downloadPromises);\n        \n        // Zpracovat vechny soubory najednou\n        await handleFileUpload(files);\n        \n        // Zelen success toast po nahrn\n        const successMessage = (\n          <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n            <div style={{ \n              fontSize: '15px', \n              fontWeight: '600', \n              marginBottom: '8px', \n              color: '#1a1a1a',\n              display: 'flex',\n              alignItems: 'center',\n              gap: '8px'\n            }}>\n              <CheckCircle2 size={20} color=\"#10b981\" style={{ flexShrink: 0 }} />\n              <span>Plohy spn nahrny</span>\n            </div>\n            <div style={{ \n              padding: '8px',\n              backgroundColor: '#f0fdf4',\n              borderRadius: '4px',\n              fontSize: '13px',\n              color: '#166534'\n            }}>\n              Nahrno {files.length} {files.length === 1 ? 'ploha' : files.length < 5 ? 'plohy' : 'ploh'} ze spisovky\n            </div>\n          </div>\n        );\n        showToast && showToast(successMessage, { type: 'success' });\n      } catch (error) {\n        console.error(' Chyba pi stahovn ploh ze spisovky:', error);\n        \n        // Lep error zprva - extrahovat nzev souboru z chybov zprvy\n        let errorMsg = error.message;\n        if (errorMsg.includes('Chyba pi stahovn')) {\n          showToast && showToast(` ${errorMsg}`, { type: 'error' });\n        } else {\n          showToast && showToast(` Chyba pi zpracovn ploh: ${errorMsg}`, { type: 'error' });\n        }\n      }\n      return;\n    }\n\n    //  PRIORITA 1b: Kontrola drag & drop jedn plohy ze spisovky (CORS proxy)\n    const spisovkaFileUrl = e.dataTransfer.getData('text/spisovka-file-url');\n    const spisovkaFileName = e.dataTransfer.getData('text/spisovka-file-name');\n    const spisovkaFileMime = e.dataTransfer.getData('text/spisovka-file-mime');\n    \n    if (spisovkaFileUrl && spisovkaFileName) {\n      //  VALIDACE PED STAENM (pro bn soubory)\n      const isISDOC = isISDOCFile(spisovkaFileName);\n      \n      if (!isISDOC && !isPokladna) {\n        // Zkontroluj validaci faktury ped staenm\n        const validation = validateInvoiceForAttachments ? validateInvoiceForAttachments(faktura) : { isValid: true };\n        \n        if (!validation.isValid) {\n          //  ZAMTNOUT - chyb povinn pole\n          const errorMessage = (\n            <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n              <div style={{ \n                fontSize: '15px', \n                fontWeight: '600', \n                marginBottom: '12px', \n                color: '#1a1a1a',\n                display: 'flex',\n                alignItems: 'center',\n                gap: '8px'\n              }}>\n                <AlertCircle size={20} color=\"#ff4d4f\" style={{ flexShrink: 0 }} />\n                <span>Pro uloen je nutn vyplnit nsledujc poloky:</span>\n              </div>\n              {Object.values(validation.categories).map((cat, idx) => \n                cat.errors.length > 0 && (\n                  <div key={idx} style={{ \n                    marginBottom: '10px',\n                    padding: '10px',\n                    backgroundColor: '#fff1f0',\n                    borderRadius: '4px'\n                  }}>\n                    <div style={{ \n                      fontWeight: '600', \n                      fontSize: '13px',\n                      color: '#d32f2f',\n                      marginBottom: '6px'\n                    }}>\n                      {cat.label}\n                    </div>\n                    {cat.errors.map((err, errIdx) => (\n                      <div key={errIdx} style={{ \n                        fontSize: '12px',\n                        color: '#666',\n                        marginLeft: '8px',\n                        marginTop: '4px',\n                        display: 'flex',\n                        alignItems: 'flex-start'\n                      }}>\n                        <span style={{ marginRight: '6px', color: '#ff4d4f', fontWeight: 'bold' }}></span>\n                        <span>{err}</span>\n                      </div>\n                    ))}\n                  </div>\n                )\n              )}\n            </div>\n          );\n          showToast && showToast(errorMessage, { type: 'error' });\n          return; // Ukonit upload\n        }\n      }\n\n      // Staen souboru ze spisovky pes proxy a vytvoen File objektu\n      try {\n        // Pout proxy endpoint pro staen (een CORS)\n        const proxyUrl = `${process.env.REACT_APP_API2_BASE_URL}spisovka.php/proxy-file?url=${encodeURIComponent(spisovkaFileUrl)}`;\n        const response = await fetch(proxyUrl);\n        if (!response.ok) throw new Error('Chyba pi stahovn souboru');\n        \n        //  Zskat pvodn nzev souboru z HTTP hlaviky (pokud je k dispozici)\n        const originalFilename = response.headers.get('X-Original-Filename');\n        const finalFilename = originalFilename || spisovkaFileName;\n        \n        const blob = await response.blob();\n        const file = new File([blob], finalFilename, { type: spisovkaFileMime || blob.type });\n        \n        // Zpracovat jako bn soubor\n        await handleFileUpload([file]);\n        \n        // Zelen success toast po nahrn\n        const successMessage = (\n          <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n            <div style={{ \n              fontSize: '15px', \n              fontWeight: '600', \n              marginBottom: '8px', \n              color: '#1a1a1a',\n              display: 'flex',\n              alignItems: 'center',\n              gap: '8px'\n            }}>\n              <CheckCircle2 size={20} color=\"#10b981\" style={{ flexShrink: 0 }} />\n              <span>Ploha spn nahrna</span>\n            </div>\n            <div style={{ \n              padding: '8px',\n              backgroundColor: '#f0fdf4',\n              borderRadius: '4px',\n              fontSize: '13px',\n              color: '#166534'\n            }}>\n              {finalFilename}\n            </div>\n          </div>\n        );\n        showToast && showToast(successMessage, { type: 'success' });\n      } catch (error) {\n        console.error(' Chyba pi stahovn souboru ze spisovky:', error);\n        showToast && showToast(' Chyba pi stahovn souboru ze spisovky', { type: 'error' });\n      }\n      return;\n    }\n    \n    // PRIORITA 2: Standardn drag & drop z filesystmu\n    const files = e.dataTransfer.files;\n    if (!files || files.length === 0) return;\n\n    await handleFileUpload(files);\n  };\n\n  // File input handler\n  const handleFileSelect = async (e) => {\n    const files = e.target.files;\n    if (!files || files.length === 0) return;\n\n    await handleFileUpload(files);\n\n    // Reset input\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  // Click handler\n  const handleDropZoneClick = () => {\n    if (!isDropzoneDisabled) {\n      fileInputRef.current?.click();\n    }\n  };\n\n  //  ISDOC Dialog Handlers - NOV ATOMICK WORKFLOW\n  const handleISDOCConfirm = async (useVariableSymbol = true) => {\n    if (!pendingISDOCFile) return;\n    try {\n      const { file, isdocData, otherFiles } = pendingISDOCFile;\n\n      // 1. Namapovat ISDOC data na fakturu\n      if (!formData) {\n        throw new Error('Chyb data formule objednvky');\n      }\n\n      //  Pedat useVariableSymbol do mapovn\n      const mappedData = mapISDOCToFaktura(isdocData, formData, useVariableSymbol);\n\n      //  KONTROLA: M u faktura reln ID?\n      const hasRealId = fakturaId && !String(fakturaId).startsWith('temp-');\n\n      let response;\n\n      if (hasRealId) {\n        //  FAKTURA U EXISTUJE  POUZE NAHRT PLOHU\n\n        const uploadResponse = await uploadInvoiceAttachment25({\n          token: token,\n          username: username,\n          faktura_id: fakturaId,\n          objednavka_id: objednavkaId,\n          typ_prilohy: 'FAKTURA',\n          file: file\n        });\n\n        response = {\n          faktura_id: fakturaId, // Pout existujc ID\n          priloha_id: uploadResponse.priloha_id,\n          priloha: uploadResponse.priloha\n        };\n      } else {\n        //  NOV FAKTURA  ATOMICKY VYTVOIT FAKTURU + PLOHU\n\n        response = await createInvoiceWithAttachment25({\n          token: token,\n          username: username,\n          objednavka_id: objednavkaId,\n          // Faktura metadata z ISDOC\n          fa_castka: mappedData.fa_castka,\n          fa_cislo_vema: mappedData.fa_cislo_vema,\n          fa_datum_vystaveni: mappedData.fa_datum_vystaveni,\n          fa_datum_splatnosti: mappedData.fa_datum_splatnosti,\n          fa_datum_doruceni: mappedData.fa_datum_doruceni,\n          fa_strediska_kod: mappedData.fa_strediska_kod,\n          fa_poznamka: mappedData.fa_poznamka,\n          fa_dorucena: 1,\n          // Ploha\n          file: file,\n          typ_prilohy: 'FAKTURA'\n        });\n\n      }\n\n      // 3. Aktualizovat UI s RELNMI ID z BE\n      if (onISDOCParsed) {\n        //  KRITICK: Pedat VDY mappedData, a u faktura byla nov nebo existujc\n        // Callback v OrderForm25 UPDATNE fakturu novmi daty z ISDOC\n        const dataToPass = {\n          ...mappedData,\n          id: response.faktura_id, //  RELN ID faktury z BE\n          _realId: response.faktura_id,\n          _updateExisting: hasRealId // Flag pro OrderForm25 - m se UPDATOVAT existujc faktura\n        };\n        onISDOCParsed(dataToPass, response.faktura_id);\n      }\n\n      // 4. Pidat plohu do loklnho stavu (u s relnm ID)\n      const typPrilohy = fakturaTypyPrilohOptions.find(t => t.kod === 'FAKTURA');\n\n      const serverAttachment = {\n        id: response.priloha_id, // RELN ID z BE\n        serverId: response.priloha_id,\n        faktura_id: response.faktura_id,\n        objednavka_id: objednavkaId,\n        name: file.name,\n        size: file.size,\n        type: file.type,\n        klasifikace: 'FAKTURA',\n        faktura_typ_nazev: typPrilohy?.nazev || 'FAKTURA',\n        uploadDate: response.priloha?.dt_vytvoreni || new Date().toISOString(),\n        status: 'uploaded',\n        je_isdoc: 1,\n        guid: response.priloha?.guid\n      };\n\n      updateAttachments(prev => [...prev, serverAttachment]);\n\n      // 5. Zpracovat ostatn soubory (pokud byly nahrny spolen)\n      if (otherFiles && otherFiles.length > 0) {\n        await handleFileUpload(otherFiles);\n      }\n\n      // 6. Zavt dialog\n      setShowISDOCDialog(false);\n      setPendingISDOCFile(null);\n      setIsdocSummary(null);\n\n      showToast&&showToast('Faktura vetn ISDOC plohy byla spn vytvoena', { type: 'success' });\n\n      //  Zavolat callback pro refresh\n      if (onAttachmentUploaded) {\n        onAttachmentUploaded();\n      }\n\n    } catch (err) {\n      showToast&&showToast(err.message || 'Chyba pi vytven faktury s plohou', { type: 'error' });\n    }\n  };\n\n  const handleISDOCUploadWithoutParsing = async () => {\n    if (!pendingISDOCFile) return;\n\n    try {\n      const { file, otherFiles } = pendingISDOCFile;\n\n      // Pidat ISDOC soubor bez parsingu - klasifikace ISDOC\n      const isdocAttachment = {\n        id: `pending-${Date.now()}`,\n        file: file,\n        name: file.name,\n        size: file.size,\n        type: file.type,\n        klasifikace: 'ISDOC', //  ISDOC typ pro ISDOC soubory\n        uploadDate: new Date().toISOString(),\n        status: 'pending_upload',\n        je_isdoc: 1\n      };\n\n      updateAttachments(prev => [...prev, isdocAttachment]);\n      await uploadFileToServer(isdocAttachment.id, 'ISDOC'); //  Upload s ISDOC typem\n\n      // Zpracovat ostatn soubory\n      if (otherFiles && otherFiles.length > 0) {\n        await handleFileUpload(otherFiles);\n      }\n\n      // Zavt dialog\n      setShowISDOCDialog(false);\n      setPendingISDOCFile(null);\n      setIsdocSummary(null);\n\n      showToast&&showToast('ISDOC soubor byl nahrn bez extrakce dat', { type: 'success' });\n\n    } catch (err) {\n      showToast&&showToast(err.message || 'Chyba pi nahrvn ISDOC', { type: 'error' });\n    }\n  };\n\n  const handleISDOCCancel = () => {\n    setShowISDOCDialog(false);\n    setPendingISDOCFile(null);\n    setIsdocSummary(null);\n    showToast&&showToast('Nahrn ISDOC zrueno', { type: 'info' });\n  };\n\n  return (\n    <>\n    <Wrapper>\n      <Header>\n        <Title>\n          <Paperclip />\n          Plohy faktury\n          {attachments.length > 0 && <Badge>{attachments.length}</Badge>}\n        </Title>\n      </Header>\n\n      {/* Hidden file input */}\n      <HiddenInput\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\".pdf,.isdoc,.jpg,.jpeg,.png,.xml\"\n        multiple\n        onChange={handleFileSelect}\n        disabled={isDropzoneDisabled}\n      />\n\n      {/*  Validan hlen - zobrazit kdy nejsou vyplnny povinn poloky */}\n      {!invoiceValidation.isValid && !readOnly && (\n        <div style={{\n          background: '#fef3c7',\n          border: '1px solid #f59e0b',\n          borderRadius: '6px',\n          padding: '1rem',\n          marginBottom: '1rem',\n          display: 'flex',\n          alignItems: 'flex-start',\n          gap: '0.75rem'\n        }}>\n          <Info size={20} style={{ color: '#f59e0b', flexShrink: 0, marginTop: '2px' }} />\n          <div style={{ flex: 1 }}>\n            <div style={{\n              fontWeight: '500',\n              color: '#92400e',\n              marginBottom: '0.25rem'\n            }}>\n              Vyplte povinn poloky faktury\n            </div>\n            <div style={{\n              fontSize: '0.875rem',\n              color: '#78350f'\n            }}>\n              Pro pidn ploh je nutn vyplnit: {invoiceValidation.missingFields?.join(', ') || 'povinn pole'}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Drag & Drop zna */}\n      {!readOnly && (\n        <DropZone\n          onClick={handleDropZoneClick}\n          onDragOver={handleDragOver}\n          onDragLeave={handleDragLeave}\n          onDrop={handleDrop}\n          isDragging={dragging}\n          disabled={isDropzoneDisabled}\n        >\n          <DropZoneIcon isDragging={dragging}>\n            {dragging ? '' : ''}\n          </DropZoneIcon>\n          <DropZoneText>\n            <DropZoneTitle>\n              {uploading\n                ? 'Nahrvm...'\n                : dragging\n                  ? 'Puste soubor'\n                  : 'Pethnte PDF, ISDOC, JPG, PNG, DOC, DOCX, XLS, XLSX nebo XML (max 10 MB)'}\n            </DropZoneTitle>\n            <DropZoneSubtitle>\n              Kliknutm otevete dialog  Po pidn vyberte typ plohy\n            </DropZoneSubtitle>\n          </DropZoneText>\n        </DropZone>\n      )}\n\n      {error && (\n        <ErrorMessage>\n          <AlertCircle />\n          {error}\n        </ErrorMessage>\n      )}\n\n      {loading && (\n        <LoadingState>\n          <Loader />\n          Natm plohy...\n        </LoadingState>\n      )}\n\n      {/* Attachments list - PESN JAKO OBJEDNVKY */}\n      {!loading && attachments.length > 0 && (\n        <AttachmentsList>\n          {attachments.filter(file => file && file.id).map((file) => (\n            <div key={file.id} style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: '0.75rem',\n              padding: '0.75rem',\n              border: `1px solid ${getFileBorderColor(file)}`,\n              borderRadius: '6px',\n              backgroundColor: getFileBackgroundColor(file),\n              marginBottom: '0.5rem',\n              opacity: file.status === 'uploading' ? 0.6 : 1\n            }}>\n              {/* Ikona s indiktorem stavu - 32x44px aby se vely 2 dky textu */}\n              <div style={{\n                width: '32px',\n                height: '44px',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                flexShrink: 0,\n                position: 'relative'\n              }}>\n                {file.file_exists === false ? (\n                  <FileX\n                    size={24}\n                    style={{\n                      color: '#dc2626'\n                    }}\n                  />\n                ) : (\n                  <FileText\n                    size={24}\n                    style={{\n                      color: file.status === 'uploaded' ? '#10b981' : '#dc2626'\n                    }}\n                  />\n                )}\n                {file.status === 'uploaded' && (\n                  <div style={{\n                    position: 'absolute',\n                    top: '-2px',\n                    right: '-2px',\n                    width: '12px',\n                    height: '12px',\n                    backgroundColor: '#10b981',\n                    borderRadius: '50%'\n                  }} />\n                )}\n                {file.status === 'uploading' && (\n                  <div style={{\n                    position: 'absolute',\n                    top: '-2px',\n                    right: '-2px',\n                    width: '12px',\n                    height: '12px',\n                    backgroundColor: '#f59e0b',\n                    borderRadius: '50%',\n                    animation: 'spin 1s linear infinite'\n                  }} />\n                )}\n              </div>\n\n              {/* Informace o souboru - 2 dky */}\n              <div style={{ flex: 1, minWidth: 0 }}>\n                {/* DEK 1: Nzev + velikost + akce (staen + ko) */}\n                <div style={{\n                  fontWeight: '500',\n                  fontSize: '0.875rem',\n                  color: '#374151',\n                  marginBottom: '2px'\n                }}>\n                  <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '0.5rem'\n                  }}>\n                    {/* Nzev souboru s hvzdikou */}\n                    <span style={{\n                      overflow: 'hidden',\n                      textOverflow: 'ellipsis',\n                      whiteSpace: 'nowrap',\n                      flex: 1,\n                      minWidth: 0,\n                      position: 'relative'\n                    }}>\n                      {file.name}\n                      {/* erven hvzdika jako horn index */}\n                      {!file.klasifikace && (\n                        <span style={{\n                          color: '#dc2626',\n                          fontSize: '0.7rem',\n                          fontWeight: 'bold',\n                          position: 'absolute',\n                          top: '-2px',\n                          marginLeft: '2px'\n                        }}>\n                          *\n                        </span>\n                      )}\n                    </span>\n\n                    {/* Warning pro soubory, kter neexistuj na disku */}\n                    {file.file_exists === false && (\n                      <span style={{\n                        color: '#dc2626',\n                        fontSize: '0.7rem',\n                        fontWeight: 'bold',\n                        backgroundColor: '#fee2e2',\n                        padding: '1px 4px',\n                        borderRadius: '3px',\n                        flexShrink: 0\n                      }}>\n                         SOUBOR NENALEZEN\n                      </span>\n                    )}\n\n                    {/* Velikost souboru */}\n                    <span style={{\n                      color: '#6b7280',\n                      fontWeight: 'normal',\n                      fontSize: '0.75rem',\n                      flexShrink: 0\n                    }}>\n                      ({Math.round((file.size || 0) / 1024)} kB)\n                    </span>\n\n                    {/* Staen pro nahran soubory */}\n                    {file.status === 'uploaded' && file.serverId && (\n                      <button\n                        type=\"button\"\n                        onClick={() => handleDownload(file.id)}\n                        style={{\n                          background: 'none',\n                          border: 'none',\n                          color: '#2563eb',\n                          cursor: 'pointer',\n                          padding: '2px',\n                          display: 'flex',\n                          alignItems: 'center',\n                          fontSize: '12px',\n                          flexShrink: 0\n                        }}\n                        title=\"Sthnout soubor\"\n                      >\n                        <Download size={14} />\n                      </button>\n                    )}\n\n                    {/* OCR Extrakce - pouze pro PDF */}\n                    {(file.name?.toLowerCase().endsWith('.pdf') || file.type === 'application/pdf') && (\n                      <button\n                        type=\"button\"\n                        onClick={() => handleOCRExtraction(file.id)}\n                        disabled={file.status === 'uploading'}\n                        style={{\n                          background: 'none',\n                          border: 'none',\n                          color: file.status === 'uploading' ? '#9ca3af' : '#8b5cf6',\n                          cursor: file.status === 'uploading' ? 'not-allowed' : 'pointer',\n                          padding: '2px',\n                          display: 'flex',\n                          alignItems: 'center',\n                          opacity: file.status === 'uploading' ? 0.6 : 1,\n                          fontSize: '12px',\n                          flexShrink: 0\n                        }}\n                        title=\"Vytit daje pomoc OCR\"\n                      >\n                        <Sparkles size={14} />\n                      </button>\n                    )}\n\n                    {/* Ko */}\n                    {!readOnly && (\n                      <button\n                        type=\"button\"\n                        onClick={() => file.serverId ? deleteFromServer(file.id) : removeFile(file.id)}\n                        disabled={file.status === 'uploading'}\n                        style={{\n                          background: 'none',\n                          border: 'none',\n                          color: file.status === 'uploading' ? '#9ca3af' : '#dc2626',\n                          cursor: file.status === 'uploading' ? 'not-allowed' : 'pointer',\n                          padding: '2px',\n                          display: 'flex',\n                          alignItems: 'center',\n                          opacity: file.status === 'uploading' ? 0.6 : 1,\n                          fontSize: '12px',\n                          flexShrink: 0\n                        }}\n                        title={file.serverId ? \"Smazat ze serveru\" : \"Smazat soubor\"}\n                      >\n                        <Trash2 size={14} />\n                      </button>\n                    )}\n                  </div>\n                </div>\n\n                {/* DEK 2: Datum + typ souboru + uivatel */}\n                <div style={{\n                  fontSize: '0.75rem',\n                  color: '#6b7280',\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: '0.5rem'\n                }}>\n                  <span>\n                    {file.uploadDate && !isNaN(new Date(file.uploadDate).getTime())\n                      ? `${new Date(file.uploadDate).toLocaleDateString('cs-CZ')} ${new Date(file.uploadDate).toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' })}`\n                      : ''\n                    }\n                  </span>\n                  <span></span>\n                  <span style={{\n                    textTransform: 'uppercase',\n                    backgroundColor: '#fef3c7',\n                    color: '#92400e',\n                    padding: '2px 6px',\n                    borderRadius: '4px',\n                    fontSize: '0.6875rem',\n                    fontWeight: '500'\n                  }}>\n                    {file.name ? (file.name.endsWith('.pdf') ? 'PDF' : file.name.split('.').pop().toUpperCase()) : 'FILE'}\n                  </span>\n                  <span></span>\n                  <span style={{\n                    backgroundColor: '#e0e7ff',\n                    color: '#3730a3',\n                    padding: '2px 6px',\n                    borderRadius: '4px',\n                    fontSize: '0.6875rem',\n                    fontWeight: '500'\n                  }}>\n                    Nahrno: {username || 'Super ADMIN'}\n                  </span>\n                  {file.faktura_typ_nazev && (\n                    <>\n                      <span></span>\n                      <span style={{\n                        backgroundColor: '#dbeafe',\n                        color: '#1e40af',\n                        padding: '2px 6px',\n                        borderRadius: '4px',\n                        fontSize: '0.6875rem',\n                        fontWeight: '500'\n                      }}>\n                        {file.faktura_typ_nazev}\n                      </span>\n                    </>\n                  )}\n                </div>\n              </div>\n\n              {/* Dropdown pro klasifikaci - PESN JAKO OBJEDNVKY */}\n              <div style={{ minWidth: '180px', flexShrink: 0 }}>\n                <select\n                  value={file.klasifikace || ''}\n                  onChange={(e) => updateFileKlasifikace(file.id, e.target.value)}\n                  disabled={file.status === 'uploading' || readOnly}\n                  style={{\n                    width: '100%',\n                    padding: '0.5rem 0.75rem',\n                    border: `1px solid ${!file.klasifikace ? '#fca5a5' : '#d1d5db'}`,\n                    borderRadius: '6px',\n                    fontSize: '0.875rem',\n                    backgroundColor: (file.status === 'uploading' || readOnly) ? '#f3f4f6' : 'white',\n                    color: file.klasifikace ? '#374151' : '#6b7280',\n                    cursor: (file.status === 'uploading' || readOnly) ? 'not-allowed' : 'pointer',\n                    opacity: (file.status === 'uploading' || readOnly) ? 0.6 : 1\n                  }}\n                >\n                  <option value=\"\" style={{ color: '#6b7280' }}>Vyberte...</option>\n                  {fakturaTypyPrilohOptions.map(typ => (\n                    <option key={typ.kod} value={typ.kod}>\n                      {typ.nazev}\n                    </option>\n                  ))}\n                </select>\n              </div>\n            </div>\n          ))}\n        </AttachmentsList>\n      )}\n    </Wrapper>\n\n    {/*  ISDOC Parsing Dialog */}\n    {showISDOCDialog && isdocSummary && ReactDOM.createPortal(\n      <ISDOCParsingDialog\n        isdocSummary={isdocSummary}\n        isdocData={pendingISDOCFile?.isdocData}\n        onConfirm={handleISDOCConfirm}\n        onCancel={handleISDOCCancel}\n        onUploadWithoutParsing={handleISDOCUploadWithoutParsing}\n      />,\n      document.body\n    )}\n\n    {/*  Confirm Dialog pro mazn ploh */}\n    <ConfirmDialog\n      isOpen={confirmDialog.isOpen}\n      title={confirmDialog.title}\n      confirmText=\"Smazat\"\n      variant=\"danger\"\n      onConfirm={confirmDialog.onConfirm}\n      onClose={() => setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null })}\n    >\n      {confirmDialog.message}\n    </ConfirmDialog>\n    </>\n  );\n};\n\nexport default InvoiceAttachmentsCompact;\n","/**\n *  ISDOC Parser Utility\n *\n * Parsuje ISDOC XML soubory a extrahuje data pro faktury\n * Inspirovno: plugins/ISDOC/isdoc-to-pdf.js\n */\n\n/**\n * Parsuje ISDOC XML soubor a vrac strukturovan data\n * @param {File} file - ISDOC soubor\n * @returns {Promise<Object>} - Naparsovan data faktury\n */\nexport async function parseISDOCFile(file) {\n  try {\n    const text = await file.text();\n    const parser = new DOMParser();\n    const xmlDoc = parser.parseFromString(text, 'text/xml');\n\n    // Zkontroluj parsing errors\n    const parserError = xmlDoc.querySelector('parsererror');\n    if (parserError) {\n      throw new Error('Chyba pi parsovn ISDOC XML: ' + parserError.textContent);\n    }\n\n    // Extrahuj invoice root element\n    const invoice = xmlDoc.querySelector('Invoice') || xmlDoc.documentElement;\n\n    // === ZKLADN DAJE FAKTURY ===\n    const invoiceId = getTextContent(invoice, 'ID');\n    const issueDate = getTextContent(invoice, 'IssueDate');\n    const taxPointDate = getTextContent(invoice, 'TaxPointDate');\n\n    //  Datum splatnosti - vce variant selektor pro rzn ISDOC verze\n    const dueDate = getTextContent(invoice, [\n      'PaymentMeans Payment Details PaymentDueDate',\n      'PaymentMeans Payment Details DueDate',\n      'PaymentMeans Payment PaymentDueDate',\n      'PaymentMeans PaymentDueDate',\n      'DueDate',\n      'PaymentDueDate'\n    ].join(', '));\n\n    const note = getTextContent(invoice, 'Note');\n\n    // === DODAVATEL (AccountingSupplierParty) ===\n    const supplier = invoice.querySelector('AccountingSupplierParty Party');\n    const supplierName = getTextContent(supplier, 'PartyName Name');\n    const supplierICO = getTextContent(supplier, 'PartyIdentification RegisterIdentificationID, PartyIdentification ID');\n    const supplierDIC = getTextContent(supplier, 'PartyTaxScheme CompanyID, TaxRegistration');\n    const supplierAddress = supplier ? extractAddress(supplier.querySelector('PostalAddress')) : null;\n\n    // === ODBRATEL (AccountingCustomerParty) ===\n    const customer = invoice.querySelector('AccountingCustomerParty Party');\n    const customerName = getTextContent(customer, 'PartyName Name');\n    const customerICO = getTextContent(customer, 'PartyIdentification RegisterIdentificationID, PartyIdentification ID');\n    const customerDIC = getTextContent(customer, 'PartyTaxScheme CompanyID');\n    const customerAddress = customer ? extractAddress(customer.querySelector('PostalAddress')) : null;\n\n    //  === KONTAKTN DAJE (Email pro smrovn) ===\n    const electronicMail = getTextContent(customer, 'Contact ElectronicMail') ||\n                           getTextContent(invoice, 'AccountingCustomerParty Party Contact ElectronicMail') ||\n                           getTextContent(invoice, 'Contact ElectronicMail');\n\n    // === POLOKY FAKTURY (InvoiceLines) ===\n    const items = [];\n    const invoiceLines = invoice.querySelectorAll('InvoiceLine');\n\n    invoiceLines.forEach((line) => {\n      //  Extrahuj popis poloky (NIKDY NE SellersItemIdentification/ID!)\n      const itemElement = line.querySelector('Item');\n      let popis = '';\n      if (itemElement) {\n        // Preferuj Description, pak Name - ale NIKDY ne SellersItemIdentification\n        const descElement = itemElement.querySelector(':scope > Description');\n        const nameElement = itemElement.querySelector(':scope > Name');\n        popis = (descElement?.textContent || nameElement?.textContent || '').trim();\n      }\n\n      const item = {\n        id: getTextContent(line, 'ID'),\n        popis: popis,\n        mnozstvi: parseFloat(getTextContent(line, 'InvoicedQuantity')) || 1,\n        jednotka: getTextContent(line, 'InvoicedQuantity').match(/unitCode=\"([^\"]+)\"/)?.[1] || 'ks',\n        cena_za_jednotku: parseFloat(getTextContent(line, 'Item ClassifiedTaxCategory UnitPricePrimaryAmount, UnitPrice')) || 0,\n        cena_celkem_bez_dph: parseFloat(getTextContent(line, 'LineExtensionAmount')) || 0,\n        sazba_dph: parseFloat(getTextContent(line, 'Item ClassifiedTaxCategory Percent')) || 21,\n        cena_celkem_s_dph: 0 // Vypoteme pozdji\n      };\n\n      // Vypoti cenu s DPH\n      item.cena_celkem_s_dph = item.cena_celkem_bez_dph * (1 + item.sazba_dph / 100);\n\n      items.push(item);\n    });\n\n    // === CELKOV STKY (TaxTotal, LegalMonetaryTotal) ===\n    const taxTotal = parseFloat(getTextContent(invoice, 'TaxTotal TaxAmount')) || 0;\n    const taxExclusiveAmount = parseFloat(getTextContent(invoice, 'LegalMonetaryTotal TaxExclusiveAmount')) || 0;\n    const taxInclusiveAmount = parseFloat(getTextContent(invoice, 'LegalMonetaryTotal TaxInclusiveAmount')) || 0;\n    const payableAmount = parseFloat(getTextContent(invoice, 'LegalMonetaryTotal PayableAmount')) || taxInclusiveAmount;\n\n    //  === SLEVY (AllowanceCharge, AllowanceTotalAmount) ===\n    const allowanceTotalAmount = parseFloat(getTextContent(invoice, 'LegalMonetaryTotal AllowanceTotalAmount')) || 0;\n    const chargeTotalAmount = parseFloat(getTextContent(invoice, 'LegalMonetaryTotal ChargeTotalAmount')) || 0;\n\n    // Extrahuj jednotliv slevy/pplatky\n    const allowanceCharges = [];\n    const allowanceChargeElements = invoice.querySelectorAll('AllowanceCharge');\n    allowanceChargeElements.forEach((ac) => {\n      const chargeIndicator = getTextContent(ac, 'ChargeIndicator') === 'true';\n      const amount = parseFloat(getTextContent(ac, 'Amount')) || 0;\n      const reason = getTextContent(ac, 'AllowanceChargeReason');\n\n      if (amount > 0) {\n        allowanceCharges.push({\n          typ: chargeIndicator ? 'PRIPLATEK' : 'SLEVA',\n          castka: amount,\n          duvod: reason\n        });\n      }\n    });\n\n    //  Vypoti skutenou slevu (rozdl mezi soutem poloek a finln stkou)\n    const itemsTotalWithVat = items.reduce((sum, item) => sum + item.cena_celkem_s_dph, 0);\n    const calculatedDiscount = itemsTotalWithVat - payableAmount;\n    const actualDiscount = calculatedDiscount > 0 ? calculatedDiscount : allowanceTotalAmount;\n\n    //  Vypoti procento slevy\n    const discountPercent = itemsTotalWithVat > 0 ? (actualDiscount / itemsTotalWithVat) * 100 : 0;\n\n    // === BANKOVN DAJE (PaymentMeans) ===\n    const paymentMeans = invoice.querySelector('PaymentMeans');\n    const bankAccount = getTextContent(paymentMeans, 'PayeeFinancialAccount ID, PayeeFinancialAccount AccountNumber');\n    const bankCode = getTextContent(paymentMeans, 'PayeeFinancialAccount FinancialInstitutionBranch ID, PayeeFinancialAccount BankCode');\n    const iban = getTextContent(paymentMeans, 'PayeeFinancialAccount IBAN');\n    const swift = getTextContent(paymentMeans, 'PayeeFinancialAccount FinancialInstitutionBranch FinancialInstitution ID, PayeeFinancialAccount SWIFT');\n\n    //  Variabiln symbol - vce variant selektor pro rzn ISDOC verze\n    const variableSymbol = getTextContent(paymentMeans, [\n      'Payment Details VariableSymbol',\n      'Payment VariableSymbol',\n      'Details VariableSymbol',\n      'VariableSymbol'\n    ].join(', '));\n\n    const constantSymbol = getTextContent(paymentMeans, [\n      'Payment Details ConstantSymbol',\n      'Payment ConstantSymbol',\n      'Details ConstantSymbol',\n      'ConstantSymbol'\n    ].join(', '));\n\n    const specificSymbol = getTextContent(paymentMeans, [\n      'Payment Details SpecificSymbol',\n      'Payment SpecificSymbol',\n      'Details SpecificSymbol',\n      'SpecificSymbol'\n    ].join(', '));\n\n    // === VRCEN STRUKTUROVANCH DAT ===\n    return {\n      // Zkladn daje\n      cislo_faktury: invoiceId,\n      datum_vystaveni: issueDate,\n      datum_zdanitelneho_plneni: taxPointDate || issueDate,\n      datum_splatnosti: dueDate,\n      poznamka: note,\n\n      // Dodavatel\n      dodavatel: {\n        nazev: supplierName,\n        ico: supplierICO,\n        dic: supplierDIC,\n        adresa: supplierAddress\n      },\n\n      // Odbratel (pro kontrolu)\n      odberatel: {\n        nazev: customerName,\n        ico: customerICO,\n        dic: customerDIC,\n        adresa: customerAddress,\n        email: electronicMail //  Email pro smrovn\n      },\n\n      // Poloky\n      polozky: items,\n      pocet_polozek: items.length,\n\n      // stky\n      castka_bez_dph: taxExclusiveAmount,\n      dph_celkem: taxTotal,\n      castka_s_dph: payableAmount,\n\n      //  Slevy a pplatky\n      sleva_celkem: actualDiscount,\n      sleva_procenta: discountPercent,\n      sleva_deklarovana: allowanceTotalAmount,\n      priplatek_celkem: chargeTotalAmount,\n      slevy_a_priplatky: allowanceCharges,\n      ma_slevu: actualDiscount > 0 || allowanceTotalAmount > 0,\n      soucet_polozek_s_dph: itemsTotalWithVat,\n\n      // Platebn daje\n      platba: {\n        bankovni_ucet: bankAccount,\n        kod_banky: bankCode,\n        iban: iban,\n        swift: swift,\n        variabilni_symbol: variableSymbol,\n        konstantni_symbol: constantSymbol,\n        specificky_symbol: specificSymbol\n      },\n\n      // Meta\n      _parsed: true,\n      _parsedAt: new Date().toISOString(),\n      _fileName: file.name\n    };\n\n  } catch (error) {\n    throw new Error(`Nepodailo se naparsovat ISDOC soubor: ${error.message}`);\n  }\n}\n\n/**\n * Pomocn funkce pro zskn textovho obsahu elementu\n * Podporuje CSS selektory s fallback\n */\nfunction getTextContent(parent, selector) {\n  if (!parent) return '';\n\n  const selectors = selector.split(',').map(s => s.trim());\n\n  for (const sel of selectors) {\n    const element = parent.querySelector(sel);\n    if (element && element.textContent.trim()) {\n      return element.textContent.trim();\n    }\n  }\n\n  return '';\n}\n\n/**\n * Extrahuje adresu z PostalAddress elementu\n */\nfunction extractAddress(postalAddress) {\n  if (!postalAddress) return null;\n\n  const street = getTextContent(postalAddress, 'StreetName');\n  const buildingNumber = getTextContent(postalAddress, 'BuildingNumber');\n  const city = getTextContent(postalAddress, 'CityName');\n  const zip = getTextContent(postalAddress, 'PostalZone');\n  const country = getTextContent(postalAddress, 'Country IdentificationCode, Country Name');\n\n  const parts = [\n    street && buildingNumber ? `${street} ${buildingNumber}` : (street || buildingNumber),\n    zip && city ? `${zip} ${city}` : (zip || city),\n    country\n  ].filter(Boolean);\n\n  return parts.join(', ') || null;\n}\n\n/**\n * Formtuje ISDOC poloky do tabulkov podoby pro poznmku\n * @param {Array} polozky - Pole poloek z ISDOC\n * @returns {string} - Textov tabulka\n */\nfunction formatPolozkyToTable(polozky) {\n  if (!polozky || polozky.length === 0) return '';\n\n  const lines = [\n    '=== FAKTUROVAN POLOKY ===',\n    ''\n  ];\n\n  polozky.forEach((item, index) => {\n    lines.push(`${index + 1}. ${item.popis || 'Poloka'}`);\n    lines.push(`   Mnostv: ${item.mnozstvi} ${item.jednotka}`);\n    lines.push(`   Cena/jedn.: ${item.cena_za_jednotku.toLocaleString('cs-CZ', { minimumFractionDigits: 2 })} K`);\n    lines.push(`   Celkem bez DPH: ${item.cena_celkem_bez_dph.toLocaleString('cs-CZ', { minimumFractionDigits: 2 })} K`);\n    lines.push(`   DPH ${item.sazba_dph}%: ${((item.cena_celkem_s_dph - item.cena_celkem_bez_dph)).toLocaleString('cs-CZ', { minimumFractionDigits: 2 })} K`);\n    lines.push(`   Celkem s DPH: ${item.cena_celkem_s_dph.toLocaleString('cs-CZ', { minimumFractionDigits: 2 })} K`);\n    lines.push('');\n  });\n\n  return lines.join('\\n');\n}\n\n/**\n * Mapuje ISDOC data na strukturu faktury v naem systmu\n * @param {Object} isdocData - Data z parseISDOCFile\n * @param {Object} formData - Aktuln formData z OrderForm25\n * @returns {Object} - Namapovan data pro fakturu\n */\nexport function mapISDOCToFaktura(isdocData, formData = {}, useVariableSymbol = true) {\n  const dnesniDatum = new Date().toISOString().split('T')[0]; // YYYY-MM-DD\n\n  //  Sestavit poznmku POUZE s polokami (ZRUIT pvodn poznmku z ISDOC)\n  const polozkyText = formatPolozkyToTable(isdocData.polozky);\n\n  //  NOV LOGIKA: Vbr mezi slem faktury nebo variabilnm symbolem\n  const cisloFaVpd = useVariableSymbol\n    ? (isdocData.platba?.variabilni_symbol || isdocData.cislo_faktury || '')\n    : (isdocData.cislo_faktury || '');\n\n  return {\n    // slo faktury - podle volby uivatele (slo FA nebo variabiln symbol)\n    fa_cislo_vema: cisloFaVpd,\n\n    // Data\n    fa_datum_vystaveni: isdocData.datum_vystaveni || '',\n    fa_datum_zdanitelneho_plneni: isdocData.datum_zdanitelneho_plneni || isdocData.datum_vystaveni || '',\n    fa_datum_splatnosti: isdocData.datum_splatnosti || '',\n    fa_datum_doruceni: dnesniDatum, //  DLEIT: Aktuln datum doruen\n\n    // stky\n    fa_castka: isdocData.castka_s_dph || 0,\n    fa_castka_bez_dph: isdocData.castka_bez_dph || 0,\n    fa_dph: isdocData.dph_celkem || 0,\n\n    // Poznmka - JEN poloky, BEZ pvodn poznmky z ISDOC\n    fa_poznamka: polozkyText,\n\n    // Stediska - zkoprujeme z objednvky\n    fa_strediska_kod: formData.strediska_kod || [],\n\n    //  ISDOC raw JSON pro uloen do DB\n    isdoc_data_json: JSON.stringify(isdocData),\n\n    // Platebn daje (pro tooltip/info)\n    _isdoc_platba: isdocData.platba,\n\n    // Poloky (pro tooltip/info)\n    _isdoc_polozky: isdocData.polozky,\n    _isdoc_pocet_polozek: isdocData.pocet_polozek,\n\n    // Dodavatel (pro kontrolu)\n    _isdoc_dodavatel: isdocData.dodavatel,\n\n    //  Email smrovn (pro info bublinu)\n    _isdoc_email: isdocData.odberatel?.email,\n\n    //  Pvodn hodnoty pro info\n    _isdoc_cislo_faktury: isdocData.cislo_faktury,\n    _isdoc_variabilni_symbol: isdocData.platba?.variabilni_symbol,\n\n    // Meta\n    _isdoc_parsed: true,\n    _isdoc_parsed_at: isdocData._parsedAt,\n    _isdoc_file_name: isdocData._fileName\n  };\n}\n\n/**\n * Zjist, zda je soubor ISDOC\n * @param {File} file - Soubor k oven\n * @returns {boolean}\n */\nexport function isISDOCFile(file) {\n  if (!file) return false;\n  const extension = file.name.split('.').pop().toLowerCase();\n  return extension === 'isdoc';\n}\n\n/**\n * Vytvo souhrn ISDOC dat pro zobrazen v dialogu\n * @param {Object} isdocData - Data z parseISDOCFile\n * @returns {Object} - Souhrn pro UI\n */\nexport function createISDOCSummary(isdocData) {\n  return {\n    cislo_faktury: isdocData.cislo_faktury || '---',\n    variabilni_symbol: isdocData.platba?.variabilni_symbol || '---',\n    datum_vystaveni: isdocData.datum_vystaveni || '---',\n    dodavatel: isdocData.dodavatel?.nazev || '---',\n    castka_s_dph: isdocData.castka_s_dph\n      ? `${parseFloat(isdocData.castka_s_dph).toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K`\n      : '---',\n    pocet_polozek: isdocData.pocet_polozek || 0,\n    celkova_castka_polozek: isdocData.polozky?.reduce((sum, p) => sum + (p.cena_celkem_s_dph || 0), 0) || 0,\n    polozky: isdocData.polozky || [], //  Pidat poloky pro zobrazen\n    //  Slevy\n    ma_slevu: isdocData.ma_slevu || false,\n    sleva_celkem: isdocData.sleva_celkem || 0,\n    sleva_procenta: isdocData.sleva_procenta || 0,\n    slevy_a_priplatky: isdocData.slevy_a_priplatky || []\n  };\n}\n","import { createWorker } from 'tesseract.js';\n\n/**\n * Pevede PDF na canvas obrzek pomoc PDF.js\n */\nasync function pdfToCanvas(arrayBuffer) {\n  // Dynamicky importujeme pdfjs-dist\n  const pdfjsLib = await import('pdfjs-dist/webpack');\n  \n  console.log(` Loading PDF from ArrayBuffer (${arrayBuffer.byteLength} bytes)...`);\n  \n  // Nateme PDF z ArrayBuffer\n  const loadingTask = pdfjsLib.getDocument({ \n    data: arrayBuffer,\n    verbosity: 0 // Snme rove logovn\n  });\n  \n  const pdf = await loadingTask.promise;\n  console.log(` PDF loaded: ${pdf.numPages} pages`);\n  \n  // Zskme prvn stranu\n  const page = await pdf.getPage(1);\n  console.log(` Page 1 loaded`);\n  \n  // Nastavme viewport (scale 2 pro lep kvalitu OCR)\n  const viewport = page.getViewport({ scale: 2.0 });\n  console.log(` Viewport: ${viewport.width}x${viewport.height}px`);\n  \n  // Vytvome canvas\n  const canvas = document.createElement('canvas');\n  const context = canvas.getContext('2d');\n  canvas.width = viewport.width;\n  canvas.height = viewport.height;\n  \n  // Renderujeme strnku na canvas\n  const renderTask = page.render({\n    canvasContext: context,\n    viewport: viewport\n  });\n  \n  await renderTask.promise;\n  console.log(` PDF rendered to canvas`);\n  \n  return canvas;\n}\n\n/**\n * Extrahuje text z PDF pomoc OCR\n * @param {ArrayBuffer} arrayBuffer - PDF data jako ArrayBuffer\n * @param {Function} onProgress - Callback pro progress (0-100)\n * @returns {Promise<string>} - Extrahovan text\n */\nexport async function extractTextFromPDF(arrayBuffer, onProgress = () => {}, retryCount = 0) {\n  const MAX_RETRIES = 2;\n  const TIMEOUT_MS = 90000; // 90 sekund timeout (del kvli konverzi)\n  \n  try {\n    // Validace vstupu\n    if (!arrayBuffer || !(arrayBuffer instanceof ArrayBuffer)) {\n      throw new Error('Neplatn ArrayBuffer');\n    }\n\n    console.log(` Starting OCR extraction (${arrayBuffer.byteLength} bytes, attempt ${retryCount + 1}/${MAX_RETRIES + 1})`);\n    onProgress(0, 'Natm PDF...');\n    \n    // Validace velikosti\n    if (arrayBuffer.byteLength === 0) {\n      throw new Error('PDF soubor je przdn');\n    }\n    \n    if (arrayBuffer.byteLength < 100) {\n      throw new Error('PDF soubor je pli mal (mon nen kompletn)');\n    }\n    \n    onProgress(10, 'Pevdm PDF na obrzek...');\n    \n    // Pevedeme PDF na canvas (prvn strana)\n    let canvas;\n    try {\n      canvas = await Promise.race([\n        pdfToCanvas(arrayBuffer),\n        new Promise((_, reject) => \n          setTimeout(() => reject(new Error('Timeout pi konverzi PDF (30s)')), 30000)\n        )\n      ]);\n      console.log(` PDF converted to canvas: ${canvas.width}x${canvas.height}px`);\n    } catch (conversionError) {\n      console.error(' PDF conversion error:', conversionError);\n      \n      // Retry logic\n      if (retryCount < MAX_RETRIES) {\n        console.log(` Retrying PDF conversion (attempt ${retryCount + 2}/${MAX_RETRIES + 1})...`);\n        onProgress(5, `Opakuji pokus ${retryCount + 2}/${MAX_RETRIES + 1}...`);\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        return extractTextFromPDF(arrayBuffer, onProgress, retryCount + 1);\n      }\n      \n      throw new Error(`Nepodailo se pevst PDF na obrzek: ${conversionError.message}`);\n    }\n    \n    onProgress(30, 'Pipravuji optimalizovan OCR engine...');\n    \n    //  SINGLE OPTIMALIZOVAN PRCHOD s nejlepm nastavenm\n    let worker;\n    try {\n      worker = await Promise.race([\n        createWorker('ces', 1, {\n          logger: m => {\n            if (m.status === 'recognizing text') {\n              const progress = 30 + (m.progress * 60);\n              onProgress(progress, `Rozpoznvm text: ${Math.round(m.progress * 100)}%`);\n            }\n          }\n        }),\n        new Promise((_, reject) => \n          setTimeout(() => reject(new Error('Timeout pi inicializaci OCR (30s)')), 30000)\n        )\n      ]);\n      \n      //  OPTIMLN NASTAVEN pro faktury\n      await worker.setParameters({\n        tessedit_pageseg_mode: '3', // PSM 3 = Automatic page segmentation (nejspolehlivj)\n        preserve_interword_spaces: '1', // Zachovat mezery mezi slovy\n        tessedit_char_whitelist: '0123456789.,/:- ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz', // Povolen znaky\n      });\n      \n      console.log(` Canvas size: ${canvas.width}x${canvas.height}px (scale: 2.0x)`);\n      \n    } catch (workerError) {\n      console.error(' Worker creation error:', workerError);\n      \n      if (retryCount < MAX_RETRIES) {\n        console.log(` Retrying OCR init (attempt ${retryCount + 2}/${MAX_RETRIES + 1})...`);\n        onProgress(5, `Opakuji pokus ${retryCount + 2}/${MAX_RETRIES + 1}...`);\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        return extractTextFromPDF(arrayBuffer, onProgress, retryCount + 1);\n      }\n      \n      throw new Error('Nepodailo se spustit OCR engine. Zkuste obnovit strnku.');\n    }\n    \n    let text = '';\n    try {\n      onProgress(90, 'Dokonuji rozpoznvn...');\n      \n      // Rozpoznme text z canvas\n      const result = await Promise.race([\n        worker.recognize(canvas),\n        new Promise((_, reject) => \n          setTimeout(() => reject(new Error(`Timeout pi OCR (${TIMEOUT_MS/1000}s)`)), TIMEOUT_MS)\n        )\n      ]);\n      \n      text = result?.data?.text || '';\n      const confidence = result?.data?.confidence || 0;\n      \n      console.log(` OCR completed: ${text.length} characters, confidence: ${confidence.toFixed(1)}%`);\n      \n      if (!text || text.trim().length === 0) {\n        throw new Error('PDF neobsahuje rozpoznateln text. Dokument me bt przdn nebo ve patn kvalit.');\n      }\n    } catch (recognizeError) {\n      console.error(' Recognition error:', recognizeError);\n      \n      if (retryCount < MAX_RETRIES && !recognizeError.message.includes('Timeout')) {\n        console.log(` Retrying recognition (attempt ${retryCount + 2}/${MAX_RETRIES + 1})...`);\n        await worker.terminate();\n        return extractTextFromPDF(arrayBuffer, onProgress, retryCount + 1);\n      }\n      \n      throw new Error('OCR selhalo: ' + (recognizeError.message || 'Neznm chyba'));\n    } finally {\n      try {\n        await worker.terminate();\n      } catch (e) {\n        console.warn(' Worker termination error:', e);\n      }\n    }\n    \n    onProgress(100, 'Hotovo!');\n    \n    return text;\n  } catch (error) {\n    console.error(' OCR extraction error:', error, error.stack);\n    throw error;\n  }\n}\n\n/**\n * Vyt daje o faktue z textu\n * @param {string} text - Text z OCR\n * @returns {Object} - Vyten daje\n */\nexport function extractInvoiceData(text) {\n  const result = {\n    datumVystaveni: null,\n    datumSplatnosti: null,\n    variabilniSymbol: null,\n    castka: null,\n    isFaktura: false,\n    warning: null\n  };\n\n  // Normalizujeme text - odstrann diakritiky pro robustnj hledn\n  const normalizedText = text.toLowerCase();\n  \n  // Rozdlme na dky pro lep analzu\n  const lines = text.split('\\n').map(line => line.trim()).filter(line => line.length > 0);\n\n  // ========== DETEKCE TYPU DOKUMENTU ==========\n  // Kontrola, zda dokument obsahuje slovo \"FAKTURA\"\n  const fakturaKeywords = ['faktura', 'invoice', 'daov doklad', 'tax invoice'];\n  const isFaktura = fakturaKeywords.some(keyword => normalizedText.includes(keyword));\n  \n  result.isFaktura = isFaktura;\n  \n  if (!isFaktura) {\n    // Detekce jinch typ dokument\n    if (normalizedText.includes('objednvka') || normalizedText.includes('order')) {\n      result.warning = 'Dokument se zd bt objednvkou, ne fakturou. OCR extrakce nemus bt relevantn.';\n    } else if (normalizedText.includes('dodac list') || normalizedText.includes('delivery note')) {\n      result.warning = 'Dokument se zd bt dodacm listem, ne fakturou. OCR extrakce nemus bt relevantn.';\n    } else if (normalizedText.includes('nabdka') || normalizedText.includes('quotation')) {\n      result.warning = 'Dokument se zd bt cenovou nabdkou, ne fakturou. OCR extrakce nemus bt relevantn.';\n    } else {\n      result.warning = 'Dokument neobsahuje slovo \"FAKTURA\". Me se jednat o jin typ dokumentu (objednvku, dodac list, nabdku).';\n    }\n  }\n  \n  // ========== Hledn Variabilnho symbolu ==========\n  // Mon varianty: \"Variabiln symbol\", \"slo faktury\", \"Faktura slo\", \"VS\", \"Faktura .\"\n  const vsPatterns = [\n    /(?:variabiln[i]\\s*symbol|var\\.?\\s*symbol|vs)[:\\s]*(\\d{4,})/i,\n    /(?:slo\\s*faktury|faktura\\s*slo|faktura\\s*\\.?)[:\\s]*(\\d{4,})/i,\n    /\\b(\\d{8,})\\b/  // Fallback: 8+ slic\n  ];\n  \n  for (const pattern of vsPatterns) {\n    const match = text.match(pattern);\n    if (match && match[1]) {\n      result.variabilniSymbol = match[1].trim();\n      break;\n    }\n  }\n\n  // ========== ROBUSTN HLEDN DATUM S MULTI-LINE KONTEXTEM ==========\n  // Najdeme vechny datumy v textu a analyzujeme jejich kontext (i pes dky)\n  const allDateMatches = [];\n  \n  // Vce variant datumovch formt (pro patn OCR)\n  const dateRegex = /(\\d{1,2}[\\s./-]*\\d{1,2}[\\s./-]*\\d{4})/g;\n  let match;\n  \n  while ((match = dateRegex.exec(text)) !== null) {\n    const dateStr = match[1];\n    const startPos = match.index;\n    const endPos = startPos + dateStr.length;\n    \n    // Zskme irok kontext (100 znak ped, 50 po) pro multi-line analzu\n    const contextBefore = text.substring(Math.max(0, startPos - 100), startPos);\n    const contextAfter = text.substring(endPos, Math.min(text.length, endPos + 50));\n    const fullContext = contextBefore + ' ' + contextAfter;\n    \n    // Normalizace kontextu - odstrann nadbytench mezer/newlines\n    const normalizedContext = fullContext.toLowerCase()\n      .replace(/\\s+/g, ' ')  // Vce mezer  jedna mezera\n      .replace(/[^\\w\\s:.-]/g, ''); // Odstranit speciln znaky krom : . -\n    \n    // Parsovn data (s toleranc k mezerm)\n    const cleanDateStr = dateStr.replace(/\\s+/g, '');\n    const parsed = parseCzechDate(cleanDateStr);\n    \n    if (parsed) {\n      allDateMatches.push({\n        date: cleanDateStr,\n        originalDate: dateStr,\n        parsed,\n        contextBefore: contextBefore.toLowerCase(),\n        contextAfter: contextAfter.toLowerCase(),\n        fullContext: normalizedContext,\n        position: startPos\n      });\n    }\n  }\n  \n  console.log(` Found ${allDateMatches.length} dates in document:`);\n  allDateMatches.forEach((d, i) => {\n    console.log(`  ${i + 1}. ${d.date} (${d.parsed}) - context: ...${d.contextBefore.slice(-30)}[DATE]${d.contextAfter.slice(0, 30)}...`);\n  });\n  \n  // ========== ROBUSTN Hledn Datumu vystaven ==========\n  // Vce variant klovch slov (vetn OCR chyb: i, e, r, atd.)\n  const issueDateKeywords = [\n    // Pesn varianty - VYSOK SKRE\n    { word: 'datum vystaveni', score: 20, aliases: ['datumvystaveni', 'dat vystaveni', 'dat.vystaveni'] },\n    { word: 'datum vystaven', score: 20, aliases: ['datumvystaven'] },\n    { word: 'vystaveni dokladu', score: 18, aliases: ['vystavndokladu', 'vystaveni dokl'] },\n    { word: 'datum dokladu', score: 16, aliases: ['datdokladu', 'dat.dokladu'] },\n    { word: 'vystaveno', score: 14, aliases: ['vystavno'] },\n    { word: 'date of issue', score: 15, aliases: [] },\n    { word: 'datum vytvoreni', score: 12, aliases: ['datumvytvoreni'] },\n    { word: 'datum vytvoen', score: 12, aliases: ['datumvytvoen'] },\n    { word: 'issued', score: 10, aliases: [] },\n    // OCR typo varianty\n    { word: 'daturn vystaveni', score: 18, aliases: [] }, // OCR: mrn\n    { word: 'oatum vystaveni', score: 18, aliases: [] }, // OCR: do\n    { word: 'vystavem', score: 12, aliases: [] }, // OCR: nom\n  ];\n  \n  let bestIssueDate = null;\n  let bestIssueScore = 0;\n  let bestIssueDebug = '';\n  \n  for (const dateMatch of allDateMatches) {\n    let score = 0;\n    let foundKeywords = [];\n    \n    // Skre podle klovch slov v kontextu\n    for (const keywordObj of issueDateKeywords) {\n      const mainWord = keywordObj.word;\n      const wordScore = keywordObj.score;\n      const aliases = keywordObj.aliases || [];\n      \n      // Kontrola hlavnho slova\n      if (dateMatch.fullContext.includes(mainWord)) {\n        score += wordScore;\n        foundKeywords.push(mainWord);\n        \n        // Extra body pokud je tsn ped datem (30 znak)\n        const closeContext = dateMatch.contextBefore.slice(-30);\n        if (closeContext.includes(mainWord)) {\n          score += Math.floor(wordScore * 0.5); // +50% bonusu\n        }\n      }\n      \n      // Kontrola alias\n      for (const alias of aliases) {\n        if (dateMatch.fullContext.includes(alias)) {\n          score += Math.floor(wordScore * 0.8); // 80% skre pro alias\n          foundKeywords.push(`${alias}(alias)`);\n        }\n      }\n    }\n    \n    // SILN penalizace pro slova typick pro splatnost\n    const antiKeywords = ['splatnost', 'splatnosti', 'splatno', 'splatne', 'due date', 'payment due', \n                          'zaplatit', 'uhradit', 'uhrazen', 'zaplaceno'];\n    for (const antiWord of antiKeywords) {\n      if (dateMatch.fullContext.includes(antiWord)) {\n        score -= 30; // Zveno z 25\n        foundKeywords.push(`-${antiWord}(penalty)`);\n      }\n    }\n    \n    // SILN penalizace pro \"zdanitelnho plnn\" (asto tam je jin datum)\n    if (dateMatch.fullContext.includes('zdanitelneho') || dateMatch.fullContext.includes('zdanitelnho') ||\n        dateMatch.fullContext.includes('zdanitelne') || dateMatch.fullContext.includes('plneni')) {\n      score -= 20; // Zveno z 15\n      foundKeywords.push('-zdanitelneho/plneni(penalty)');\n    }\n    \n    // SILN penalizace pro \"dne\" bez dalho kontextu (slab indiktor)\n    const hasWeakDne = dateMatch.contextBefore.includes(' dne ') || dateMatch.contextBefore.includes(' dne:');\n    const hasStrongKeyword = foundKeywords.some(kw => \n      kw.includes('datum') || kw.includes('vystaveni') || kw.includes('dokladu')\n    );\n    if (hasWeakDne && !hasStrongKeyword) {\n      score -= 10;\n      foundKeywords.push('-weak_dne(penalty)');\n    }\n    \n    if (foundKeywords.length > 0) {\n      console.log(`   Date ${dateMatch.date}: Keywords: ${foundKeywords.join(', ')}  score: ${score}`);\n    }\n    \n    if (score > bestIssueScore) {\n      bestIssueScore = score;\n      bestIssueDate = dateMatch.parsed;\n      bestIssueDebug = `${dateMatch.date} [${foundKeywords.join(', ')}]`;\n    }\n  }\n  \n  result.datumVystaveni = bestIssueDate;\n  console.log(` Best datum vystaven: ${bestIssueDate} (score: ${bestIssueScore}) - ${bestIssueDebug}`);\n  \n  // ========== ROBUSTN Hledn Datumu splatnosti ==========\n  // Vce variant klovch slov (vetn OCR chyb)\n  const dueDateKeywords = [\n    // Pesn varianty - VYSOK SKRE\n    { word: 'datum splatnosti', score: 20, aliases: ['datumsplatnosti', 'dat splatnosti', 'dat.splatnosti'] },\n    { word: 'termin splatnosti', score: 18, aliases: ['terminsplatnosti'] },\n    { word: 'splatnost:', score: 16, aliases: ['splatnost :'] }, // S dvojtekou = silnj\n    { word: 'splatnost', score: 14, aliases: [] }, // Bez dvojteky = slab\n    { word: 'due date', score: 17, aliases: ['duedate'] },\n    { word: 'payment due', score: 17, aliases: ['paymentdue'] },\n    { word: 'splatne', score: 13, aliases: ['splatn'] },\n    { word: 'splatno', score: 13, aliases: [] },\n    { word: 'splatna dne', score: 15, aliases: ['splatnadne'] },\n    { word: 'zaplatit do', score: 12, aliases: ['zaplatitdo'] },\n    { word: 'uhradit do', score: 12, aliases: ['uhraditdo'] },\n    // OCR typo varianty\n    { word: 'oatum splatnosti', score: 18, aliases: [] }, // OCR: do\n    { word: 'splamost', score: 13, aliases: [] }, // OCR: tnm\n  ];\n  \n  let bestDueDate = null;\n  let bestDueScore = 0;\n  let bestDueDebug = '';\n  \n  for (const dateMatch of allDateMatches) {\n    let score = 0;\n    let foundKeywords = [];\n    \n    // Skre podle klovch slov v kontextu\n    for (const keywordObj of dueDateKeywords) {\n      const mainWord = keywordObj.word;\n      const wordScore = keywordObj.score;\n      const aliases = keywordObj.aliases || [];\n      \n      // Kontrola hlavnho slova\n      if (dateMatch.fullContext.includes(mainWord)) {\n        score += wordScore;\n        foundKeywords.push(mainWord);\n        \n        // Extra body pokud je tsn ped datem (30 znak)\n        const closeContext = dateMatch.contextBefore.slice(-30);\n        if (closeContext.includes(mainWord)) {\n          score += Math.floor(wordScore * 0.5); // +50% bonusu\n        }\n      }\n      \n      // Kontrola alias\n      for (const alias of aliases) {\n        if (dateMatch.fullContext.includes(alias)) {\n          score += Math.floor(wordScore * 0.8); // 80% skre pro alias\n          foundKeywords.push(`${alias}(alias)`);\n        }\n      }\n    }\n    \n    // SILN penalizace pro slova typick pro vystaven\n    const antiKeywords = ['vystaveni', 'vystaven', 'vystaveno', 'datum dokladu', 'issued', \n                          'date of issue', 'vytvoreni', 'vytvoen', 'datum vytvoreni'];\n    for (const antiWord of antiKeywords) {\n      if (dateMatch.fullContext.includes(antiWord)) {\n        score -= 30; // Zveno z 25\n        foundKeywords.push(`-${antiWord}(penalty)`);\n      }\n    }\n    \n    // SILN penalizace pro \"zdanitelnho plnn\" (nen to splatnost)\n    if (dateMatch.fullContext.includes('zdanitelneho') || dateMatch.fullContext.includes('zdanitelnho') ||\n        dateMatch.fullContext.includes('zdanitelne') || dateMatch.fullContext.includes('plneni')) {\n      score -= 20; // Zveno z 15\n      foundKeywords.push('-zdanitelneho/plneni(penalty)');\n    }\n    \n    // SILN bonus pokud je datum POZDJI ne datum vystaven (logick kontrola)\n    if (result.datumVystaveni && dateMatch.parsed > result.datumVystaveni) {\n      score += 10; // Zveno z 5\n      foundKeywords.push('+later_than_issue(+10)');\n    } else if (result.datumVystaveni && dateMatch.parsed === result.datumVystaveni) {\n      // Penalizace pokud je STEJN jako datum vystaven (nesmysl)\n      score -= 15;\n      foundKeywords.push('-same_as_issue(penalty)');\n    }\n    \n    if (foundKeywords.length > 0) {\n      console.log(`   Date ${dateMatch.date}: Keywords: ${foundKeywords.join(', ')}  score: ${score}`);\n    }\n    \n    if (score > bestDueScore) {\n      bestDueScore = score;\n      bestDueDate = dateMatch.parsed;\n      bestDueDebug = `${dateMatch.date} [${foundKeywords.join(', ')}]`;\n    }\n  }\n  \n  result.datumSplatnosti = bestDueDate;\n  console.log(` Best datum splatnosti: ${bestDueDate} (score: ${bestDueScore}) - ${bestDueDebug}`);\n\n  // ========== Hledn stky v. DPH ==========\n  // Hledme stku s oznaenm rznch variant\n  const amountPatterns = [\n    // Primrn varianty - nejpesnj\n    /(?:celkem|vetn\\s*dph|s\\s*dph|k\\s*hrad|k\\s*zaplacen)[:\\s]*(\\d+(?:[,\\s]\\d{3})*[,.]?\\d{0,2})\\s*(?:k|czk)?/i,\n    /(?:cena\\s*celkem|celkov\\s*cena|total\\s*price)[:\\s]*(\\d+(?:[,\\s]\\d{3})*[,.]?\\d{0,2})\\s*(?:k|czk)?/i,\n    // Sekundrn varianty\n    /(?:stka|cena|amount|price)[:\\s]*(\\d+(?:[,\\s]\\d{3})*[,.]?\\d{0,2})\\s*(?:k|czk)?/i,\n    // Celkem na konci dku\n    /(\\d+(?:[,\\s]\\d{3})*[,.]?\\d{2})\\s*(?:k|czk)?\\s*celkem/i,\n    // S mezerou mezi sly (formt tisce)\n    /(?:celkem|cena)[:\\s]*(\\d{1,3}(?:\\s\\d{3})*[,.]?\\d{0,2})\\s*(?:k|czk)?/i\n  ];\n  \n  for (const pattern of amountPatterns) {\n    const match = text.match(pattern);\n    if (match && match[1]) {\n      result.castka = parseAmount(match[1]);\n      break;\n    }\n  }\n\n  // Pokud jsme nenali stku s klovmi slovy, zkusme nejvt stku v dokumentu\n  if (!result.castka) {\n    const allAmounts = text.match(/(\\d+(?:[,\\s]\\d{3})*[,.]?\\d{2})\\s*(?:k|czk)/gi);\n    if (allAmounts && allAmounts.length > 0) {\n      const amounts = allAmounts.map(a => parseAmount(a));\n      result.castka = Math.max(...amounts);\n    }\n  }\n\n  return result;\n}\n\n/**\n * Parsuje esk datum do ISO formtu\n */\nfunction parseCzechDate(dateStr) {\n  // Formty: DD.MM.YYYY, DD/MM/YYYY, DD-MM-YYYY\n  const parts = dateStr.split(/[./-]/);\n  if (parts.length === 3) {\n    const day = parts[0].padStart(2, '0');\n    const month = parts[1].padStart(2, '0');\n    const year = parts[2];\n    return `${year}-${month}-${day}`;\n  }\n  return null;\n}\n\n/**\n * Parsuje stku (odstran mezery, sprvn zpracuje rky a teky)\n */\nfunction parseAmount(amountStr) {\n  if (!amountStr) return null;\n  \n  // Odstrann neselnch znak krom rky a teky\n  let cleaned = amountStr.replace(/[^\\d,.]/g, '');\n  \n  // Odstrann mezer pouvanch jako oddlovae tisc\n  cleaned = cleaned.replace(/\\s/g, '');\n  \n  //  INTELIGENTN detekce formtu:\n  // Formt: 18 400,40 nebo 18.400,40  rka = des. teka\n  // Formt: 18,400.40  teka = des. teka (EN formt)\n  \n  const commaCount = (cleaned.match(/,/g) || []).length;\n  const dotCount = (cleaned.match(/\\./g) || []).length;\n  \n  let normalized = cleaned;\n  \n  if (commaCount === 1 && dotCount === 0) {\n    // Formt: 18400,40  rka je desetinn teka (CZ)\n    normalized = cleaned.replace(',', '.');\n  } else if (commaCount === 0 && dotCount === 1) {\n    // Formt: 18400.40  teka je desetinn teka (OK)\n    normalized = cleaned;\n  } else if (commaCount > 0 && dotCount > 0) {\n    // Smen formt - zjistit, co je oddlova tisc\n    const lastCommaPos = cleaned.lastIndexOf(',');\n    const lastDotPos = cleaned.lastIndexOf('.');\n    \n    if (lastCommaPos > lastDotPos) {\n      // Posledn je rka  rka = des. teka, teky = tisce\n      // Nap: 18.400,40\n      normalized = cleaned.replace(/\\./g, '').replace(',', '.');\n    } else {\n      // Posledn je teka  teka = des. teka, rky = tisce\n      // Nap: 18,400.40\n      normalized = cleaned.replace(/,/g, '');\n    }\n  } else if (commaCount > 1) {\n    // Vce rek  vechny jsou oddlovae tisc\n    // Nap: 1,000,000  odstranme\n    normalized = cleaned.replace(/,/g, '');\n  } else if (dotCount > 1) {\n    // Vce teek  vechny jsou oddlovae tisc\n    // Nap: 1.000.000  odstranme\n    normalized = cleaned.replace(/\\./g, '');\n  }\n  \n  const result = parseFloat(normalized);\n  console.log(` parseAmount: \"${amountStr}\"  \"${cleaned}\"  \"${normalized}\"  ${result}`);\n  \n  return isNaN(result) ? null : result;\n}\n"],"names":["styled","div","_templateObject","_taggedTemplateLiteral","_templateObject2","props","error","isDragging","uploading","_templateObject3","_templateObject4","_templateObject5","_templateObject6","input","_templateObject7","_templateObject8","_templateObject9","progress","_templateObject0","type","detected","onClick","show","deleting","span","button","variant","formatDateCZ","dateString","date","Date","isNaN","day","String","getDate","padStart","month","getMonth","year","getFullYear","concat","e","Overlay","Modal","Header","CloseButton","HeaderIcon","HeaderTitle","HeaderTitleText","h2","HeaderSubtitle","p","Content","InfoBox","InfoText","_templateObject1","TwoColumnLayout","_templateObject10","h3","_templateObject11","_templateObject12","LeftColumn","_templateObject13","RightColumn","_templateObject14","TopRowGrid","_templateObject15","DataItem","_templateObject16","DataLabel","_templateObject17","DataValue","_templateObject18","Footer","_templateObject19","_templateObject20","Button","_templateObject21","WarningBox","_templateObject22","WarningText","_templateObject23","CheckboxContainer","_templateObject24","CheckboxLabel","label","_templateObject25","CheckboxHint","_templateObject26","ItemsSection","_templateObject27","ItemsSectionTitle","_templateObject28","ItemsList","_templateObject29","ItemRow","_templateObject30","ItemHeader","_templateObject31","ItemName","_templateObject32","ItemPrice","_templateObject33","ItemDetails","_templateObject34","ItemDetail","_templateObject35","_ref","isdocSummary","isdocData","onConfirm","onCancel","onUploadWithoutParsing","useVariableSymbol","setUseVariableSymbol","React","polozky","_jsx","stopPropagation","children","_jsxs","FileText","X","Info","Calendar","datum_vystaveni","Banknote","className","style","display","alignItems","gap","flexWrap","castka_s_dph","ma_slevu","sleva_celkem","fontSize","color","fontWeight","toLocaleString","minimumFractionDigits","sleva_procenta","opacity","toFixed","cislo_faktury","variabilni_symbol","Building","dodavatel","Package","pocet_polozek","length","map","polozka","index","_polozka$cena_celkem_","_polozka$cena_za_jedn","_polozka$cena_celkem_2","popis","cena_celkem_s_dph","maximumFractionDigits","mnozstvi","jednotka","cena_za_jednotku","cena_celkem_bez_dph","sazba_dph","flex","checked","onChange","target","AlertCircle","CheckCircle","collapsed","hasAttachments","Wrapper","Title","Badge","DropZone","disabled","DropZoneIcon","DropZoneText","DropZoneTitle","DropZoneSubtitle","HiddenInput","AttachmentsList","LoadingState","ErrorMessage","_invoiceValidation$mi","fakturaId","objednavkaId","fakturaTypyPrilohOptions","readOnly","onISDOCParsed","formData","faktura","validateInvoiceForAttachments","isPokladna","onAttachmentUploaded","attachments","externalAttachments","onAttachmentsChange","onCreateInvoiceInDB","onOCRDataExtracted","username","token","useContext","AuthContext","showToast","ToastContext","loading","setLoading","useState","setUploading","setError","dragging","setDragging","fileInputRef","showISDOCDialog","setShowISDOCDialog","pendingISDOCFile","setPendingISDOCFile","setIsdocSummary","confirmDialog","setConfirmDialog","isOpen","title","message","updateAttachments","useCallback","updater","newAttachments","useEffect","startsWith","loadAttachmentsFromServer","prevFakturaIdRef","async","prevId","current","currentId","wasTemp","isRealNow","pendingAttachments","filter","att","status","file","attachment","_response$priloha","_response$data","_response$data$priloh","_response$data2","prev","a","id","_objectSpread","response","uploadInvoiceAttachment25","faktura_id","objednavka_id","typ_prilohy","klasifikace","attachmentId","priloha","priloha_id","data","serverId","undefined","name","uploadError","uploadPendingAttachments","_response$data3","listInvoiceAttachments25","serverAttachments","prilohy","fileExists","file_exists","hasError","file_error","original_name","originalni_nazev_souboru","size","file_size","velikost_souboru_b","endsWith","faktura_typ_nazev","uploadDate","upload_date","dt_vytvoreni","toISOString","je_isdoc","numFakturaId","Number","verifyResult","verifyInvoiceAttachments25","invoice_id","verifiedAttachments","verifiedAtt","find","v","attachment_id","some","i","summary","missing_files","verifyErr","console","err","validateFile","isAllowedInvoiceFileType","Error","isAllowedInvoiceFileSize","handleFileUpload","fileArray","Array","from","files","isdocFiles","f","isISDOCFile","nonIsdocFiles","validation","isValid","errorMessage","fontFamily","lineHeight","marginBottom","flexShrink","Object","values","categories","cat","idx","errors","padding","backgroundColor","borderRadius","errIdx","marginLeft","marginTop","marginRight","isdocFile","parseISDOCFile","createISDOCSummary","otherFiles","parseError","newFiles","jeISDOC","autoKlasifikace","now","Boolean","uploadFileToServer","getFileBorderColor","getFileBackgroundColor","fileId","klasifikaceOverride","arguments","fileObj","trim","_validation$missingFi2","_validation$missingFi","isISDOC","missingFields","join","_response$priloha2","_response$data4","_response$data4$prilo","_response$data5","realFakturaId","typPrilohy","t","kod","group","groupEnd","nazev","successMessage","CheckCircle2","uploadedAttachment","typ_prilohy_nazev","nazev_souboru","velikost","datum_vytvoreni","stack","fileName","errorMsg","includes","_response$priloha3","_response$data6","_response$data6$prilo","_response$data7","invoiceValidation","useMemo","isDropzoneDisabled","_Fragment","Paperclip","ref","accept","multiple","value","background","border","handleDropZoneClick","_fileInputRef$current","click","onDragOver","preventDefault","onDragLeave","currentTarget","contains","relatedTarget","onDrop","spisovkaAttachmentsJson","dataTransfer","getData","JSON","parse","isArray","filename","downloadPromises","proxyUrl","process","encodeURIComponent","url","fetch","ok","finalFilename","headers","get","blob","File","mime_type","Promise","all","spisovkaFileUrl","spisovkaFileName","spisovkaFileMime","Loader","_file$name2","width","height","justifyContent","position","FileX","top","right","animation","minWidth","overflow","textOverflow","whiteSpace","Math","round","downloadInvoiceAttachment25","isPreviewableInBrowser","openInBrowser25","window","URL","createObjectURL","link","document","createElement","href","download","body","appendChild","removeChild","revokeObjectURL","handleDownload","cursor","Download","toLowerCase","_file$name","fileBlob","fileObject","currentToastId","updateProgress","progressContent","Sparkles","transition","duration","extractedText","extractTextFromPDF","extractedData","extractInvoiceData","log","warning","warningContent","AlertTriangle","foundFields","variabilniSymbol","push","datumVystaveni","datumSplatnosti","castka","successContent","errorContent","handleOCRExtraction","deleteInvoiceAttachment25","hard_delete","success","warn","_err$response","deleteFromServer","removeFile","Trash2","getTime","toLocaleDateString","toLocaleTimeString","hour","minute","textTransform","split","pop","toUpperCase","updateInvoiceAttachment25","updateFileKlasifikace","typ","ReactDOM","ISDOCParsingDialog","_response$priloha4","_response$priloha5","mappedData","mapISDOCToFaktura","hasRealId","uploadResponse","createInvoiceWithAttachment25","fa_castka","fa_cislo_vema","fa_datum_vystaveni","fa_datum_splatnosti","fa_datum_doruceni","fa_strediska_kod","fa_poznamka","fa_dorucena","dataToPass","_realId","_updateExisting","serverAttachment","guid","handleISDOCCancel","isdocAttachment","ConfirmDialog","confirmText","onClose","text","xmlDoc","DOMParser","parseFromString","parserError","querySelector","textContent","invoice","documentElement","invoiceId","getTextContent","issueDate","taxPointDate","dueDate","note","supplier","supplierName","supplierICO","supplierDIC","supplierAddress","extractAddress","customer","customerName","customerICO","customerDIC","customerAddress","electronicMail","items","querySelectorAll","forEach","line","_getTextContent$match","itemElement","descElement","nameElement","item","parseFloat","match","taxTotal","taxExclusiveAmount","taxInclusiveAmount","payableAmount","allowanceTotalAmount","chargeTotalAmount","allowanceCharges","ac","chargeIndicator","amount","reason","duvod","itemsTotalWithVat","reduce","sum","calculatedDiscount","actualDiscount","discountPercent","paymentMeans","bankAccount","bankCode","iban","swift","variableSymbol","constantSymbol","specificSymbol","datum_zdanitelneho_plneni","datum_splatnosti","poznamka","ico","dic","adresa","odberatel","email","castka_bez_dph","dph_celkem","sleva_deklarovana","priplatek_celkem","slevy_a_priplatky","soucet_polozek_s_dph","platba","bankovni_ucet","kod_banky","konstantni_symbol","specificky_symbol","_parsed","_parsedAt","_fileName","parent","selector","selectors","s","sel","element","postalAddress","street","buildingNumber","city","zip","country","_isdocData$platba","_isdocData$odberatel","_isdocData$platba2","dnesniDatum","polozkyText","lines","formatPolozkyToTable","fa_datum_zdanitelneho_plneni","fa_castka_bez_dph","fa_dph","strediska_kod","isdoc_data_json","stringify","_isdoc_platba","_isdoc_polozky","_isdoc_pocet_polozek","_isdoc_dodavatel","_isdoc_email","_isdoc_cislo_faktury","_isdoc_variabilni_symbol","_isdoc_parsed","_isdoc_parsed_at","_isdoc_file_name","_isdocData$platba3","_isdocData$dodavatel","_isdocData$polozky","celkova_castka_polozek","pdfToCanvas","arrayBuffer","pdfjsLib","byteLength","loadingTask","getDocument","verbosity","pdf","promise","numPages","page","getPage","viewport","getViewport","scale","canvas","context","getContext","renderTask","render","canvasContext","onProgress","retryCount","ArrayBuffer","MAX_RETRIES","worker","race","_","reject","setTimeout","conversionError","resolve","createWorker","logger","m","setParameters","tessedit_pageseg_mode","preserve_interword_spaces","tessedit_char_whitelist","workerError","_result$data","_result$data2","result","recognize","TIMEOUT_MS","confidence","recognizeError","terminate","isFaktura","normalizedText","keyword","vsPatterns","pattern","allDateMatches","dateRegex","exec","dateStr","startPos","endPos","contextBefore","substring","max","contextAfter","min","normalizedContext","replace","cleanDateStr","parsed","parseCzechDate","originalDate","fullContext","d","slice","issueDateKeywords","word","score","aliases","bestIssueDate","bestIssueScore","bestIssueDebug","dateMatch","foundKeywords","keywordObj","mainWord","wordScore","floor","alias","antiKeywords","antiWord","hasWeakDne","hasStrongKeyword","kw","dueDateKeywords","bestDueDate","bestDueScore","bestDueDebug","amountPatterns","parseAmount","allAmounts","amounts","parts","amountStr","cleaned","commaCount","dotCount","normalized","lastIndexOf"],"sourceRoot":""}