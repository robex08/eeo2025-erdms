/*! For license information please see 6418.cb5a7547.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkr_app_zzs_eeo=self.webpackChunkr_app_zzs_eeo||[]).push([[6418],{1973:(e,n,a)=>{a.r(n),a.d(n,{default:()=>Gc});var o=a(53986),t=a(89379),r=a(57528),i=a(65043),s=a(97950),d=a(91357),l=a(45903),c=a(83290),p=a(83910),u=a(97929),v=a(87260),_=a(28646),m=a(77819),k=a(76833),f=a(37719),h=a(57856),y=a(39292),b=a(65727),g=a(77784);const x=(0,g.A)("lock-open",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);var j=a(14459),z=a(35327),A=a(91286),w=a(40614),S=a(41680),E=a(7118),C=a(95264),O=a(99432),N=a(56804),D=a(28006),T=a(81990);const I=(0,g.A)("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),P=(0,g.A)("trash",[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);var R=a(71360);const L=(0,g.A)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var V,F,M,U,Z,K,B,W,H,$,J,G,q,Y,X,Q,ee,ne,ae,oe,te,re,ie,se,de,le,ce=a(35087),pe=a(82054),ue=(a(63974),a(4569)),ve=a(51833),_e=a(27837),me=a(75949),ke=a(70579);const fe=l.A.div(V||(V=(0,r.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n"]))),he=l.A.div(F||(F=(0,r.A)(["\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 700px;\n  max-height: 90vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp 0.3s ease-out;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n"]))),ye=l.A.div(M||(M=(0,r.A)(["\n  padding: 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n"]))),be=l.A.h2(U||(U=(0,r.A)(["\n  margin: 0;\n  font-size: 20px;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n\n  svg {\n    font-size: 24px;\n  }\n"]))),ge=l.A.button(Z||(Z=(0,r.A)(["\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n"]))),xe=l.A.div(K||(K=(0,r.A)(["\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n"]))),je=l.A.div(B||(B=(0,r.A)(["\n  background: ",";\n  border: 1px solid ",";\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 20px;\n  display: flex;\n  align-items: flex-start;\n  gap: 12px;\n\n  svg {\n    font-size: 20px;\n    margin-top: 2px;\n    color: ",";\n  }\n"])),e=>"update"===e.type?"#fff4e6":"exists-own"===e.type?"#e6f7ff":"exists-global"===e.type?"#fff0f6":"#f0f9ff",e=>"update"===e.type?"#ffd591":"exists-own"===e.type?"#91d5ff":"exists-global"===e.type?"#ffadd2":"#bae7ff",e=>"update"===e.type?"#fa8c16":"exists-own"===e.type?"#1890ff":"exists-global"===e.type?"#eb2f96":"#1890ff"),ze=l.A.div(W||(W=(0,r.A)(["\n  flex: 1;\n\n  strong {\n    display: block;\n    margin-bottom: 4px;\n    font-size: 14px;\n    color: #262626;\n  }\n\n  p {\n    margin: 0;\n    font-size: 13px;\n    color: #595959;\n    line-height: 1.5;\n  }\n"]))),Ae=l.A.div(H||(H=(0,r.A)(["\n  margin-bottom: 20px;\n"]))),we=l.A.h3($||($=(0,r.A)(["\n  font-size: 14px;\n  font-weight: 600;\n  color: #262626;\n  margin: 0 0 12px 0;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n"]))),Se=l.A.div(J||(J=(0,r.A)(["\n  display: grid;\n  grid-template-columns: ",";\n  gap: 16px;\n  margin-bottom: 16px;\n"])),e=>e.columns||"1fr"),Ee=l.A.div(G||(G=(0,r.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n"]))),Ce=l.A.label(q||(q=(0,r.A)(["\n  font-size: 13px;\n  font-weight: 500;\n  color: #595959;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n\n  ","\n"])),e=>e.required&&"\n    &:after {\n      content: '*';\n      color: #ff4d4f;\n      margin-left: 2px;\n    }\n  "),Oe=l.A.div(Y||(Y=(0,r.A)(["\n  position: relative;\n  display: flex;\n  align-items: center;\n\n  svg {\n    position: absolute;\n    left: 12px;\n    width: 16px;\n    height: 16px;\n    color: #8c8c8c;\n    pointer-events: none;\n  }\n"]))),Ne=l.A.input(X||(X=(0,r.A)(["\n  width: 100%;\n  padding: 10px 12px 10px ",";\n  border: 1px solid ",";\n  border-radius: 6px;\n  font-size: 14px;\n  transition: all 0.2s;\n  background: ",";\n  color: ",";\n\n  &:focus {\n    outline: none;\n    border-color: ",";\n    box-shadow: 0 0 0 2px ",";\n  }\n\n  &:disabled {\n    cursor: not-allowed;\n  }\n"])),e=>e.hasIcon?"38px":"12px",e=>e.hasError?"#ff4d4f":"#d9d9d9",e=>e.disabled?"#f5f5f5":"white",e=>e.disabled?"#8c8c8c":"#262626",e=>e.hasError?"#ff4d4f":"#40a9ff",e=>e.hasError?"rgba(255,77,79,0.1)":"rgba(24,144,255,0.1)"),De=l.A.div(Q||(Q=(0,r.A)(["\n  display: grid;\n  grid-template-columns: repeat(",", 1fr);\n  gap: 8px;\n  margin-top: 8px;\n"])),e=>e.optionsCount),Te=l.A.button(ee||(ee=(0,r.A)(["\n  padding: 12px;\n  border: 2px solid ",";\n  border-radius: 8px;\n  background: ",";\n  color: ",";\n  cursor: ",";\n  opacity: ",";\n  transition: all 0.2s;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 6px;\n  font-size: 13px;\n  font-weight: 500;\n  position: relative;\n\n  &:hover:not(:disabled) {\n    border-color: #667eea;\n    background: ",";\n  }\n\n  svg {\n    font-size: 18px;\n  }\n"])),e=>e.selected?"#667eea":"#e5e7eb",e=>e.selected?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"white",e=>e.selected?"white":"#595959",e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?.5:1,e=>e.selected?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"#f9fafb"),Ie=l.A.div(ne||(ne=(0,r.A)(["\n  position: absolute;\n  top: 6px;\n  right: 6px;\n  background: ",";\n  color: white;\n  width: 20px;\n  height: 20px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 11px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\n  svg {\n    font-size: 11px;\n  }\n"])),e=>"global"===e.scope?"#10b981":"usek"===e.scope?"#3b82f6":"#06b6d4"),Pe=l.A.div(ae||(ae=(0,r.A)(["\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));\n  gap: 8px;\n  margin-top: 12px;\n"]))),Re=l.A.label(oe||(oe=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  padding: 8px 10px;\n  border: 2px solid ",";\n  border-radius: 6px;\n  background: ",";\n  cursor: ",";\n  opacity: ",";\n  transition: all 0.2s;\n  font-size: 13px;\n  font-weight: 600;\n  color: ",';\n\n  &:hover:not([disabled]) {\n    border-color: #667eea;\n    background: rgba(102, 126, 234, 0.05);\n  }\n\n  input[type="checkbox"] {\n    width: 16px;\n    height: 16px;\n    cursor: ',";\n  }\n"])),e=>e.selected?"#667eea":"#e5e7eb",e=>e.selected?"rgba(102, 126, 234, 0.05)":"white",e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?.5:1,e=>e.selected?"#667eea":"#374151",e=>e.disabled?"not-allowed":"pointer"),Le=(l.A.div(te||(te=(0,r.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n  flex: 1;\n"]))),l.A.span(re||(re=(0,r.A)(["\n  font-weight: 600;\n  color: #667eea;\n"])))),Ve=(l.A.span(ie||(ie=(0,r.A)(["\n  font-size: 11px;\n  color: #6b7280;\n"]))),l.A.span(se||(se=(0,r.A)(["\n  color: #ff4d4f;\n  font-size: 12px;\n  margin-top: 4px;\n"])))),Fe=l.A.div(de||(de=(0,r.A)(["\n  padding: 16px 24px;\n  border-top: 1px solid #e5e7eb;\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  background: #fafafa;\n"]))),Me=l.A.button(le||(le=(0,r.A)(["\n  padding: 10px 20px;\n  border: none;\n  border-radius: 6px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  ","\n\n  ","\n"])),e=>"primary"===e.variant&&"\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n\n    &:hover:not(:disabled) {\n      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n      transform: translateY(-1px);\n    }\n\n    &:disabled {\n      opacity: 0.6;\n      cursor: not-allowed;\n    }\n  ",e=>"secondary"===e.variant&&"\n    background: white;\n    color: #595959;\n    border: 1px solid #d9d9d9;\n\n    &:hover:not(:disabled) {\n      border-color: #40a9ff;\n      color: #40a9ff;\n    }\n  "),Ue=e=>{let{isOpen:n,onClose:a,onSave:o,supplierData:r,existsInPersonal:s=null,existsInUsek:d=null,existsInGlobal:l=null,userPermissions:c={canAddPersonal:!0,canAddUsek:!1,canAddGlobal:!1}}=e;const{token:v,username:_,userDetail:m}=(0,i.useContext)(_e.cy),[k,f]=(0,i.useState)({}),[h,y]=(0,i.useState)("personal"),[b,g]=(0,i.useState)([]),[x,w]=(0,i.useState)([]),[S,E]=(0,i.useState)(!1),[O,T]=(0,i.useState)(!1),[I,P]=(0,i.useState)({});(0,i.useEffect)(()=>{n&&r&&(f({nazev:r.dodavatel_nazev||"",adresa:r.dodavatel_adresa||"",ico:r.dodavatel_ico||"",dic:r.dodavatel_dic||"",zastoupeny:r.dodavatel_zastoupeny||"",kontakt_jmeno:r.dodavatel_kontakt_jmeno||"",kontakt_email:r.dodavatel_kontakt_email||"",kontakt_telefon:r.dodavatel_kontakt_telefon||""}),s?y("personal"):d?y("usek"):l&&c.canAddGlobal?y("global"):y("personal"),P({}))},[n,r,s,d,l,c.canAddGlobal]),(0,i.useEffect)(()=>{(async()=>{if(n&&c.canAddUsek)try{E(!0);const e=await(0,me.nw)({token:v,username:_});w(e||[])}catch(e){}finally{E(!1)}})()},[n,c.canAddUsek,v,_]),(0,i.useEffect)(()=>{if(n)if(d&&d.usek_zkr)try{const e="string"===typeof d.usek_zkr?JSON.parse(d.usek_zkr):d.usek_zkr;Array.isArray(e)&&g(e)}catch(e){}else g([])},[n,d]);const R=(e,n)=>{f(a=>(0,t.A)((0,t.A)({},a),{},{[e]:n})),I[e]&&P(n=>{const a=(0,t.A)({},n);return delete a[e],a})},L=e=>{g(n=>n.includes(e)?n.filter(n=>n!==e):[...n,e])};if(!n)return null;const V=s||d||l?"exists":"add",F="personal"===h&&s||"usek"===h&&d||"global"===h&&l;return(0,ke.jsx)(fe,{children:(0,ke.jsxs)(he,{onClick:e=>e.stopPropagation(),children:[(0,ke.jsxs)(ye,{children:[(0,ke.jsxs)(be,{children:[(0,ke.jsx)(p.g,{icon:u.URI}),F?"Aktualizovat dodavatele":"P\u0159idat dodavatele do adres\xe1\u0159e"]}),(0,ke.jsx)(ge,{onClick:a,children:(0,ke.jsx)(p.g,{icon:u.GRI})})]}),(0,ke.jsxs)(xe,{children:["add"===V&&(0,ke.jsxs)(je,{type:"add",children:[(0,ke.jsx)(p.g,{icon:u.URI}),(0,ke.jsxs)(ze,{children:[(0,ke.jsx)("strong",{children:"Nov\xfd dodavatel"}),(0,ke.jsx)("p",{children:"Dodavatel s t\xedmto I\u010cO nebyl nalezen v datab\xe1zi. M\u016f\u017eete ho p\u0159idat."})]})]}),"exists"===V&&(0,ke.jsxs)(je,{type:"exists-own",children:[(0,ke.jsx)(p.g,{icon:u.SGM}),(0,ke.jsxs)(ze,{children:[(0,ke.jsx)("strong",{children:"Dodavatel ji\u017e existuje v adres\xe1\u0159i"}),(0,ke.jsxs)("p",{children:["Fajfky u scope ozna\u010duj\xed, kde je dodavatel ji\u017e ulo\u017een.",s&&" M\xe1te ho ve sv\xe9m osobn\xedm adres\xe1\u0159i.",d&&" Existuje v \xfasekov\xe9m adres\xe1\u0159i.",l&&" Existuje v glob\xe1ln\xedm adres\xe1\u0159i."]})]})]}),(0,ke.jsxs)(Ae,{children:[(0,ke.jsx)(we,{children:"Rozsah ulo\u017een\xed"}),(0,ke.jsxs)(De,{optionsCount:3,children:[(0,ke.jsxs)(Te,{selected:"personal"===h,onClick:()=>c.canAddPersonal&&y("personal"),disabled:!c.canAddPersonal,children:[s&&(0,ke.jsx)(Ie,{scope:"personal",title:"Kontakt ji\u017e existuje v osobn\xedm adres\xe1\u0159i",children:(0,ke.jsx)(p.g,{icon:u.SGM})}),(0,ke.jsx)(p.g,{icon:u.X46}),(0,ke.jsx)("span",{children:"Osobn\xed"})]}),(0,ke.jsxs)(Te,{selected:"usek"===h,onClick:()=>c.canAddUsek&&y("usek"),disabled:!c.canAddUsek,children:[d&&(0,ke.jsx)(Ie,{scope:"usek",title:"Kontakt ji\u017e existuje v adres\xe1\u0159i \xfaseku",children:(0,ke.jsx)(p.g,{icon:u.SGM})}),(0,ke.jsx)(p.g,{icon:u.URI}),(0,ke.jsx)("span",{children:"\xdasek"})]}),(0,ke.jsxs)(Te,{selected:"global"===h,onClick:()=>c.canAddGlobal&&y("global"),disabled:!c.canAddGlobal,children:[l&&(0,ke.jsx)(Ie,{scope:"global",title:"Kontakt ji\u017e existuje v glob\xe1ln\xedm adres\xe1\u0159i",children:(0,ke.jsx)(p.g,{icon:u.SGM})}),(0,ke.jsx)(p.g,{icon:u.Bwz}),(0,ke.jsx)("span",{children:"Glob\xe1ln\xed"})]})]})]}),"usek"===h&&(0,ke.jsxs)(Ae,{children:[(0,ke.jsx)(we,{children:"V\xfdb\u011br \xfasek\u016f"}),S?(0,ke.jsx)("div",{style:{padding:"1rem",textAlign:"center",color:"#6b7280"},children:"Na\u010d\xedt\xe1m \xfaseky..."}):0===x.length?(0,ke.jsx)("div",{style:{padding:"1rem",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",color:"#dc2626"},children:"\u274c \u017d\xe1dn\xe9 \xfaseky nebyly na\u010dteny"}):(0,ke.jsx)(Pe,{children:(c.canAddGlobal?x:x.filter(e=>(Array.isArray(null===m||void 0===m?void 0:m.usek_zkr)?m.usek_zkr:[null===m||void 0===m?void 0:m.usek_zkr]).includes(e.usek_zkr))).map(e=>(0,ke.jsxs)(Re,{selected:b.includes(e.usek_zkr),disabled:!c.canAddGlobal&&!(Array.isArray(null===m||void 0===m?void 0:m.usek_zkr)?m.usek_zkr:[null===m||void 0===m?void 0:m.usek_zkr]).includes(e.usek_zkr),onClick:()=>{const n=Array.isArray(null===m||void 0===m?void 0:m.usek_zkr)?m.usek_zkr:[null===m||void 0===m?void 0:m.usek_zkr];(c.canAddGlobal||n.includes(e.usek_zkr))&&L(e.usek_zkr)},children:[(0,ke.jsx)("input",{type:"checkbox",checked:b.includes(e.usek_zkr),onChange:()=>L(e.usek_zkr),disabled:!c.canAddGlobal&&!(Array.isArray(null===m||void 0===m?void 0:m.usek_zkr)?m.usek_zkr:[null===m||void 0===m?void 0:m.usek_zkr]).includes(e.usek_zkr)}),(0,ke.jsx)(Le,{children:e.usek_zkr})]},e.usek_zkr))}),0===b.length&&!S&&(0,ke.jsx)("div",{style:{marginTop:"8px",padding:"8px",background:"#e0f2fe",border:"1px solid #0ea5e9",borderRadius:"6px",fontSize:"12px",color:"#0c4a6e"},children:"\u2139\ufe0f Pokud nevyberete \u017e\xe1dn\xfd \xfasek, kontakt se ulo\u017e\xed jako osobn\xed"})]}),(0,ke.jsxs)(Ae,{children:[(0,ke.jsx)(we,{children:"Z\xe1kladn\xed \xfadaje"}),(0,ke.jsx)(Se,{columns:"1fr",children:(0,ke.jsxs)(Ee,{children:[(0,ke.jsx)(Ce,{required:!0,children:"N\xe1zev spole\u010dnosti"}),(0,ke.jsxs)(Oe,{children:[(0,ke.jsx)(C.A,{}),(0,ke.jsx)(Ne,{type:"text",value:k.nazev||"",onChange:e=>R("nazev",e.target.value),hasError:!!I.nazev,hasIcon:!0,placeholder:"N\xe1zev dodavatele"})]}),I.nazev&&(0,ke.jsx)(Ve,{children:I.nazev})]})}),(0,ke.jsxs)(Se,{columns:"2fr 1fr 1fr",children:[(0,ke.jsxs)(Ee,{children:[(0,ke.jsx)(Ce,{required:!0,children:"Adresa"}),(0,ke.jsxs)(Oe,{children:[(0,ke.jsx)(D.A,{}),(0,ke.jsx)(Ne,{type:"text",value:k.adresa||"",onChange:e=>R("adresa",e.target.value),hasError:!!I.adresa,hasIcon:!0,placeholder:"Adresa s\xeddla"})]}),I.adresa&&(0,ke.jsx)(Ve,{children:I.adresa})]}),(0,ke.jsxs)(Ee,{children:[(0,ke.jsx)(Ce,{required:!0,children:"I\u010cO"}),(0,ke.jsxs)(Oe,{children:[(0,ke.jsx)(N.A,{}),(0,ke.jsx)(Ne,{type:"text",value:k.ico||"",onChange:e=>R("ico",e.target.value),hasError:!!I.ico,hasIcon:!0,placeholder:"12345678",maxLength:8})]}),I.ico&&(0,ke.jsx)(Ve,{children:I.ico})]}),(0,ke.jsxs)(Ee,{children:[(0,ke.jsx)(Ce,{children:"DI\u010c"}),(0,ke.jsxs)(Oe,{children:[(0,ke.jsx)(N.A,{}),(0,ke.jsx)(Ne,{type:"text",value:k.dic||"",onChange:e=>R("dic",e.target.value),hasIcon:!0,placeholder:"CZ12345678"})]})]})]}),(0,ke.jsx)(Se,{columns:"1fr",children:(0,ke.jsxs)(Ee,{children:[(0,ke.jsx)(Ce,{children:"Zastoupen(a)"}),(0,ke.jsxs)(Oe,{children:[(0,ke.jsx)(j.A,{}),(0,ke.jsx)(Ne,{type:"text",value:k.zastoupeny||"",onChange:e=>R("zastoupeny",e.target.value),hasIcon:!0,placeholder:"Jm\xe9no jednaj\xedc\xedho"})]})]})})]}),(0,ke.jsxs)(Ae,{children:[(0,ke.jsx)(we,{children:"Kontaktn\xed osoba"}),(0,ke.jsx)(Se,{columns:"1fr",children:(0,ke.jsxs)(Ee,{children:[(0,ke.jsx)(Ce,{children:"Jm\xe9no kontaktn\xed osoby"}),(0,ke.jsxs)(Oe,{children:[(0,ke.jsx)(j.A,{}),(0,ke.jsx)(Ne,{type:"text",value:k.kontakt_jmeno||"",onChange:e=>R("kontakt_jmeno",e.target.value),hasIcon:!0,placeholder:"Jm\xe9no a p\u0159\xedjmen\xed"})]})]})}),(0,ke.jsxs)(Se,{columns:"1fr 1fr",children:[(0,ke.jsxs)(Ee,{children:[(0,ke.jsx)(Ce,{children:"Email"}),(0,ke.jsxs)(Oe,{children:[(0,ke.jsx)(z.A,{}),(0,ke.jsx)(Ne,{type:"email",value:k.kontakt_email||"",onChange:e=>R("kontakt_email",e.target.value),hasError:!!I.kontakt_email,hasIcon:!0,placeholder:"email@example.com"})]}),I.kontakt_email&&(0,ke.jsx)(Ve,{children:I.kontakt_email})]}),(0,ke.jsxs)(Ee,{children:[(0,ke.jsx)(Ce,{children:"Telefon"}),(0,ke.jsxs)(Oe,{children:[(0,ke.jsx)(A.A,{}),(0,ke.jsx)(Ne,{type:"tel",value:k.kontakt_telefon||"",onChange:e=>R("kontakt_telefon",e.target.value),hasIcon:!0,placeholder:"+420 123 456 789"})]})]})]})]}),I.general&&(0,ke.jsx)(Ve,{style:{display:"block",marginTop:"16px",fontSize:"14px"},children:I.general})]}),(0,ke.jsxs)(Fe,{children:[(0,ke.jsxs)(Me,{variant:"secondary",onClick:a,disabled:O,children:[(0,ke.jsx)(p.g,{icon:u.GRI}),"Zru\u0161it"]}),(0,ke.jsxs)(Me,{variant:"primary",onClick:async()=>{if(!(()=>{var e,n;const a={};return null!==(e=k.nazev)&&void 0!==e&&e.trim()||(a.nazev="N\xe1zev je povinn\xfd"),null!==(n=k.ico)&&void 0!==n&&n.trim()?/^\d{8}$/.test(k.ico.trim())||(a.ico="I\u010cO mus\xed m\xedt 8 \u010d\xedslic"):a.ico="I\u010cO je povinn\xe9",k.kontakt_email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(k.kontakt_email)&&(a.kontakt_email="Neplatn\xfd email"),P(a),0===Object.keys(a).length})())return;let e=h,n=null;"usek"===h?0===b.length?(e="personal",n=null):n=b:"global"===h&&(n=null),T(!0);try{await o(k,e,n),a()}catch(t){P({general:t.message||"Chyba p\u0159i ukl\xe1d\xe1n\xed dodavatele"})}finally{T(!1)}},disabled:O,children:[(0,ke.jsx)(p.g,{icon:u.e68}),(()=>{if(O)return"Ukl\xe1d\xe1m...";return"personal"===h&&s||"usek"===h&&d||"global"===h&&l?"Aktualizovat":"P\u0159idat dodavatele"})()]})]})]})})};var Ze=a(200);const Ke=(0,g.A)("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]),Be=(0,g.A)("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),We=(0,g.A)("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]),He=(0,g.A)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),$e=(0,g.A)("file-down",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);var Je=a(92382);const Ge=(0,g.A)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),qe=(0,g.A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Ye=(0,g.A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var Xe,Qe,en,nn,an,on,tn,rn,sn,dn,ln,cn,pn,un,vn,_n,mn,kn,fn,hn=a(50516);const yn=l.A.div(Xe||(Xe=(0,r.A)(["\n  position: absolute;\n  top: calc(100% + 3px);\n  left: ",";\n  right: ",";\n  z-index: 999999;\n  width: 450px;\n  background-color: white;\n  border: 2px solid #10b981;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  max-height: 500px;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n"])),e=>e.$left||"0",e=>e.$right||"auto"),bn=l.A.div(Qe||(Qe=(0,r.A)(["\n  padding: 0.5rem 0.75rem;\n  font-weight: 700;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n  border-bottom: 1px solid #e5e7eb;\n"]))),gn=l.A.span(en||(en=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n"]))),xn=l.A.span(nn||(nn=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n"]))),jn=l.A.button(an||(an=(0,r.A)(["\n  background: none;\n  border: none;\n  padding: 0;\n  cursor: ",";\n  color: ",";\n  \n  &:hover:not(:disabled) {\n    opacity: 0.7;\n  }\n"])),e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?"#9ca3af":e.$color||"#374151"),zn=l.A.div(on||(on=(0,r.A)(["\n  position: relative;\n  padding: 0 0.75rem 0.5rem;\n"]))),An=l.A.div(tn||(tn=(0,r.A)(["\n  position: absolute;\n  left: 1.5rem;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #9ca3af;\n  pointer-events: none;\n"]))),wn=l.A.input(rn||(rn=(0,r.A)(["\n  width: 100%;\n  padding: 0.5rem 2.5rem 0.5rem 2.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  outline: none;\n  \n  &:focus {\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n"]))),Sn=l.A.button(sn||(sn=(0,r.A)(["\n  position: absolute;\n  right: 1.5rem;\n  top: 50%;\n  transform: translateY(-50%);\n  background: none;\n  border: none;\n  padding: 0;\n  cursor: pointer;\n  color: #6b7280;\n  \n  &:hover {\n    color: #374151;\n  }\n"]))),En=l.A.div(dn||(dn=(0,r.A)(["\n  max-height: 14rem;\n  overflow-y: auto;\n  \n  &::-webkit-scrollbar {\n    width: 6px;\n  }\n  \n  &::-webkit-scrollbar-track {\n    background: #f3f4f6;\n  }\n  \n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 3px;\n    \n    &:hover {\n      background: #9ca3af;\n    }\n  }\n"]))),Cn=l.A.div(ln||(ln=(0,r.A)(["\n  padding: 0.5rem 0.75rem;\n  display: flex;\n  justify-content: space-between;\n  gap: 0.5rem;\n  align-items: flex-start;\n  transition: background-color 0.15s ease, border-left 0.15s ease;\n  cursor: pointer;\n  border-left: 3px solid transparent;\n  \n  &:hover {\n    background-color: ",";\n    border-left-color: ",";\n  }\n  \n  &:not(:last-child) {\n    border-bottom: 0.5px solid #f3f4f6;\n  }\n"])),e=>"user"===e.$type?"#f0fdf4":"#f8fafc",e=>"user"===e.$type?"#22c55e":"#3b82f6"),On=l.A.div(cn||(cn=(0,r.A)(["\n  flex: 1;\n  min-width: 0;\n"]))),Nn=l.A.div(pn||(pn=(0,r.A)(["\n  font-weight: 600;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n"]))),Dn=l.A.div(un||(un=(0,r.A)(["\n  margin-top: 3px;\n  color: #1e40af;\n  font-size: 0.7rem;\n  background: #dbeafe;\n  padding: 0.1rem 0.4rem;\n  border-radius: 0.25rem;\n  display: inline-block;\n"]))),Tn=l.A.div(vn||(vn=(0,r.A)(["\n  display: flex;\n  gap: 0.25rem;\n  align-items: center;\n"]))),In=l.A.button(_n||(_n=(0,r.A)(["\n  background: none;\n  border: none;\n  color: ",";\n  padding: 0.125rem;\n  cursor: pointer;\n  \n  &:hover {\n    opacity: 0.7;\n  }\n"])),e=>e.$color||"#6b7280"),Pn=l.A.button(mn||(mn=(0,r.A)(["\n  font-size: 0.75rem;\n  padding: 0.25rem 0.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 0.25rem;\n  background: ",";\n  color: ",";\n  cursor: ",";\n  pointer-events: ",";\n  opacity: ",";\n  \n  &:hover:not(:disabled) {\n    background: #dbeafe;\n  }\n"])),e=>e.disabled?"#f3f4f6":"#eff6ff",e=>e.disabled?"#9ca3af":"#1e3a8a",e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?"none":"auto",e=>e.disabled?.6:1),Rn=l.A.div(kn||(kn=(0,r.A)(["\n  padding: 0.5rem 0.75rem;\n  color: ",";\n  ","\n"])),e=>e.$muted?"#9ca3af":"#6b7280",e=>e.$italic&&"font-style: italic;"),Ln=l.A.hr(fn||(fn=(0,r.A)(["\n  margin: 0.5rem 0;\n  border-color: #d1d5db;\n  border-width: 2px;\n  border-style: double;\n"]))),Vn=e=>{let{show:n,serverTemplates:a=[],savedTemplates:o=[],templatesLoading:t=!1,searchQuery:r="",showSearch:s=!1,currentPhase:d=1,isArchived:l=!1,token:c=null,hasPermission:v,onSearch:_,onToggleSearch:m,onRefresh:k,onFillPo:f,onFillDetails:h,canFillTemplate:b=!0,onCopyToUser:g,onCopyToGlobal:x,onShowPreview:j,onDelete:z,onEditName:A,editingTemplateId:S=null,editingTemplateName:E="",matchesQuery:C}=e;const O=(0,i.useRef)(null),N=(0,i.useRef)(null),[D,T]=(0,i.useState)({left:"0",right:"auto"});if((0,i.useEffect)(()=>{if(n&&N.current){const e=N.current.getBoundingClientRect(),n=window.innerWidth;e.right>n?T({left:"auto",right:"0"}):(e.left<0||e.left>=0&&e.right<=n)&&T({left:"0",right:"auto"})}},[n]),(0,i.useEffect)(()=>{s&&O.current&&setTimeout(()=>{var e;return null===(e=O.current)||void 0===e?void 0:e.focus()},50)},[s]),!n)return null;const I=a.filter(e=>e&&(0===e.user_id||"0"===String(e.user_id))).filter(e=>C(e,r)),L=o.filter(e=>C(e,r));return(0,ke.jsxs)(yn,{ref:N,$left:D.left,$right:D.right,children:[(0,ke.jsxs)(bn,{children:[(0,ke.jsxs)(gn,{children:[(0,ke.jsx)(p.g,{icon:u.hem,style:{color:"#3b82f6",fontSize:"14px"}}),(0,ke.jsx)("span",{children:"P\u0159eddefinovan\xe9 \u0161ablony"})]}),(0,ke.jsxs)(xn,{children:[(0,ke.jsx)(jn,{onClick:e=>{e.stopPropagation(),k()},title:"Aktualizovat \u0161ablony z DB",disabled:!c||t,$color:"#10b981",children:(0,ke.jsx)(hn.A,{size:16})}),(0,ke.jsx)(jn,{onClick:m,title:s?"Skr\xfdt hled\xe1n\xed":"Hledat",children:(0,ke.jsx)(y.A,{size:16})})]})]}),s&&(0,ke.jsxs)(zn,{children:[(0,ke.jsx)(An,{children:(0,ke.jsx)(y.A,{size:16})}),(0,ke.jsx)(wn,{ref:O,type:"text",value:r,onChange:e=>_(e.target.value),placeholder:"Hledat v \u0161ablon\xe1ch..."}),r&&(0,ke.jsx)(Sn,{onClick:()=>_(""),title:"Vymazat vyhled\xe1v\xe1n\xed",children:(0,ke.jsx)(w.A,{size:14})})]}),(0,ke.jsxs)(En,{children:[I.map((e,n)=>{var a;const o=e.data||{},t=(e.type||"").toString().toUpperCase(),r=t.includes("PO")||"OBEJD"===t||"MIXED"===t,i=t.includes("DET")||"OBEJD"===t||"MIXED"===t,s=e.name||e.dbName||(null===(a=o.poApproval)||void 0===a?void 0:a.predmet)||"\u0160ablona ".concat(e.id||"?"),c="OBEJD"===t||r&&i?"PO+Detaily":i?"Detaily":"PO";return(0,ke.jsxs)(Cn,{$type:"server",children:[(0,ke.jsxs)(On,{children:[(0,ke.jsxs)(Nn,{children:[s,(null===v||void 0===v?void 0:v("TEMPLATE_MANAGE"))&&(0,ke.jsx)(In,{onClick:n=>{n.stopPropagation(),A(e)},title:"P\u0159ejmenovat \u0161ablonu",children:(0,ke.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,ke.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,ke.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})]}),(0,ke.jsx)(Dn,{children:c})]}),(0,ke.jsxs)(Tn,{children:[(0,ke.jsx)(In,{onClick:()=>g(e),title:"Kop\xedrovat do m\xfdch \u0161ablon",$color:"#065f46",children:(0,ke.jsx)(R.A,{size:16})}),(0,ke.jsx)(In,{onClick:()=>j(e,e.data),title:"Detailn\xed n\xe1hled \u0161ablony",children:(0,ke.jsx)(ce.A,{size:16})}),(null===v||void 0===v?void 0:v("TEMPLATE_MANAGE"))&&(0,ke.jsx)(In,{onClick:()=>z(e),title:"Smazat",$color:"#dc2626",children:(0,ke.jsx)(P,{size:16})})]}),(0,ke.jsxs)("div",{style:{display:"flex",gap:"0.25rem"},children:[(0,ke.jsx)(Pn,{onClick:()=>f(e),disabled:!b||!l&&d>=2||!r,title:b?!l&&d>=2?"Nelze vlo\u017eit PO po schv\xe1len\xed":r?"Na\u010d\xedst PO":"Tato \u0161ablona neobsahuje PO":"Vypl\u0148ov\xe1n\xed nelze - objedn\xe1vka je dokon\u010dena nebo m\xe1 neulo\u017een\xe9 zm\u011bny",children:"PO"}),(0,ke.jsx)(Pn,{onClick:()=>h(e),disabled:!b||!l&&d<3||!i,title:b?!l&&d<3?"Detaily se na\u010d\xedtaj\xed a\u017e ve f\xe1zi 3 (po schv\xe1len\xed)":i?"Na\u010d\xedst detaily":"Tato \u0161ablona neobsahuje Detaily":"Vypl\u0148ov\xe1n\xed nelze - objedn\xe1vka je dokon\u010dena nebo m\xe1 neulo\u017een\xe9 zm\u011bny",children:"Detaily"})]})]},"predef-".concat(e.id,"-").concat(e.ts,"-").concat(n))}),r.trim()&&0===I.length&&(0,ke.jsx)(Rn,{$muted:!0,children:"Nenalezeno"})]}),(0,ke.jsx)(Ln,{}),(0,ke.jsx)(bn,{children:(0,ke.jsxs)(gn,{children:[(0,ke.jsx)(p.g,{icon:u.X46,style:{color:"#22c55e",fontSize:"14px"}}),(0,ke.jsx)("span",{children:"Moje \u0161ablony"})]})}),0===o.length&&(0,ke.jsx)(Rn,{children:"\u017d\xe1dn\xe9 \u0161ablony"}),(0,ke.jsxs)(En,{children:[L.map((e,n)=>{var a,o;const t=(e.type||"").toString().toUpperCase(),r="PO"===t||"OBEJD"===t||"MIXED"===t||!(null===e||void 0===e||null===(a=e.data)||void 0===a||!a.poApproval),i="DETAIL"===t||"OBEJD"===t||"MIXED"===t||!(null===e||void 0===e||null===(o=e.data)||void 0===o||!o.orderDetails),s="OBEJD"===t||r&&i?"PO+Detaily":i?"Detaily":"PO";return(0,ke.jsxs)(Cn,{$type:"user",children:[(0,ke.jsxs)(On,{children:[(0,ke.jsxs)(Nn,{children:[e.name,(0,ke.jsx)(In,{onClick:n=>{n.stopPropagation(),A(e)},title:"P\u0159ejmenovat \u0161ablonu",children:(0,ke.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,ke.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,ke.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})]}),(0,ke.jsx)(Dn,{children:s})]}),(0,ke.jsxs)(Tn,{children:[(0,ke.jsx)(In,{onClick:()=>j(e,e.data),title:"Detailn\xed n\xe1hled \u0161ablony",children:(0,ke.jsx)(ce.A,{size:16})}),(null===v||void 0===v?void 0:v("TEMPLATE_MANAGE"))&&(0,ke.jsx)(In,{onClick:()=>x(e),title:"Kop\xedrovat do glob\xe1ln\xedch \u0161ablon",$color:"#059669",children:(0,ke.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,ke.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,ke.jsx)("path",{d:"m9 12 2 2 4-4"})]})}),(0,ke.jsx)(In,{onClick:()=>z(e),title:"Smazat",$color:"#dc2626",children:(0,ke.jsx)(P,{size:16})})]}),(0,ke.jsxs)("div",{style:{display:"flex",gap:"0.25rem"},children:[(0,ke.jsx)(Pn,{onClick:()=>f(e),disabled:!b||!l&&d>=2||!r,title:b?!l&&d>=2?"Nelze vlo\u017eit PO po schv\xe1len\xed":r?"Na\u010d\xedst PO":"Tato \u0161ablona neobsahuje PO":"Vypl\u0148ov\xe1n\xed nelze - objedn\xe1vka je dokon\u010dena nebo m\xe1 neulo\u017een\xe9 zm\u011bny",children:"PO"}),(0,ke.jsx)(Pn,{onClick:()=>h(e),disabled:!b||!l&&d<3||!i,title:b?!l&&d<3?"Detaily se na\u010d\xedtaj\xed a\u017e ve f\xe1zi 3 (po schv\xe1len\xed)":i?"Na\u010d\xedst detaily":"Tato \u0161ablona neobsahuje Detaily":"Vypl\u0148ov\xe1n\xed nelze - objedn\xe1vka je dokon\u010dena nebo m\xe1 neulo\u017een\xe9 zm\u011bny",children:"Detaily"})]})]},"user-".concat(e.id,"-").concat(e.ts,"-").concat(n))}),r.trim()&&0===L.length&&(0,ke.jsx)(Rn,{$muted:!0,children:"Nenalezeno"})]})]})};var Fn,Mn,Un,Zn,Kn,Bn,Wn,Hn,$n,Jn,Gn,qn,Yn,Xn,Qn,ea,na,aa,oa,ta;const ra=l.A.div(Fn||(Fn=(0,r.A)(["\n  position: fixed;\n  top: ","px;\n  left: ","px;\n  width: ",";\n  background: ",";\n  backdrop-filter: blur(12px);\n  border-radius: ",";\n  box-shadow: ",";\n  z-index: ",";\n  cursor: ",";\n  transition: ",";\n  display: flex;\n  flex-direction: column;\n  max-height: ",";\n  user-select: none;\n  will-change: width, left, border-radius, box-shadow;\n\n  ","\n"])),e=>e.$position.y,e=>e.$position.x,e=>e.$isMinimized?"".concat(40,"px"):(e.$isCompact,"".concat(305,"px")),e=>(e.$isMinimized,"linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.98) 100%)"),e=>e.$isMinimized?"0 8px 8px 0":"12px",e=>e.$isMinimized?"0 4px 16px rgba(0, 0, 0, 0.1), 0 1px 4px rgba(0, 0, 0, 0.06)":"0 8px 32px rgba(0, 0, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(0, 0, 0, 0.08)",e=>e.$isFullscreen?"999999":"99999",e=>e.$isDragging?"grabbing":"default",e=>e.$isDragging?"none":"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",e=>e.$isMinimized?"400px":"80vh",e=>e.$isMinimized&&"\n    left: 0;\n    border-radius: 0 8px 8px 0;\n  "),ia=l.A.div(Mn||(Mn=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: ",";\n  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n  border-bottom: 2px solid #e2e8f0;\n  cursor: ",";\n  border-radius: ",";\n  transition: padding 0.4s cubic-bezier(0.4, 0, 0.2, 1), border-radius 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n\n  &:active {\n    cursor: ",";\n  }\n"])),e=>e.$isMinimized?"12px 8px":"16px 20px",e=>e.$isMinimized?"default":"grab",e=>e.$isMinimized?"0 8px 0 0":"12px 12px 0 0",e=>e.$isMinimized?"default":"grabbing"),sa=l.A.div(Un||(Un=(0,r.A)(["\n  writing-mode: vertical-rl;\n  text-orientation: mixed;\n  font-size: 14px;\n  font-weight: 600;\n  color: #334155;\n  letter-spacing: 2px;\n  text-transform: uppercase;\n  line-height: 1.2;\n  animation: fadeInScaleDelayed 0.3s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;\n\n  @keyframes fadeInScaleDelayed {\n    from {\n      opacity: 0;\n      transform: scale(0.9) translateY(10px);\n    }\n    to {\n      opacity: 1;\n      transform: scale(1) translateY(0);\n    }\n  }\n"]))),da=l.A.div(Zn||(Zn=(0,r.A)(["\n  font-size: 15px;\n  font-weight: 600;\n  color: #1e293b;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  animation: fadeInSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n\n  @keyframes fadeInSlide {\n    from {\n      opacity: 0;\n      transform: translateX(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateX(0);\n    }\n  }\n\n  svg {\n    width: 18px;\n    height: 18px;\n    color: #3b82f6;\n  }\n"]))),la=l.A.div(Kn||(Kn=(0,r.A)(["\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  animation: fadeInSlideLeft 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n\n  @keyframes fadeInSlideLeft {\n    from {\n      opacity: 0;\n      transform: translateX(10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateX(0);\n    }\n  }\n"]))),ca=l.A.div(Bn||(Bn=(0,r.A)(["\n  padding: 12px 16px;\n  border-bottom: 2px solid #e2e8f0;\n  background: linear-gradient(135deg, #fefefe 0%, #f8fafc 100%);\n  animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n      transform: translateY(-5px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n"]))),pa=l.A.div(Wn||(Wn=(0,r.A)(["\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n"]))),ua=l.A.button(Hn||(Hn=(0,r.A)(["\n  background: #ffffff;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: ",";\n  transition: all 0.2s ease;\n  color: #475569;\n  opacity: ",";\n  position: relative;\n\n  &:hover:not(:disabled) {\n    background: #f8fafc;\n    border-color: #cbd5e1;\n    color: #1e293b;\n    transform: scale(1.05);\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n  }\n\n  &:active:not(:disabled) {\n    transform: scale(0.95);\n  }\n\n  ","\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n"])),e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?.4:1,e=>e.$withPlus&&"\n    &::after {\n      content: '+';\n      position: absolute;\n      top: -2px;\n      right: -2px;\n      width: 14px;\n      height: 14px;\n      background: #f59e0b;\n      color: white;\n      border-radius: 50%;\n      font-size: 10px;\n      font-weight: bold;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border: 2px solid white;\n    }\n  "),va=l.A.button($n||($n=(0,r.A)(["\n  background: #ffffff;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  color: #475569;\n\n  &:hover {\n    background: #f8fafc;\n    border-color: #cbd5e1;\n    color: #1e293b;\n    transform: scale(1.05);\n  }\n\n  &:active {\n    transform: scale(0.95);\n  }\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n"]))),_a=(0,l.A)(va)(Jn||(Jn=(0,r.A)(["\n  margin: 8px auto;\n  display: flex;\n  animation: fadeInBounce 0.3s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;\n\n  @keyframes fadeInBounce {\n    0% {\n      opacity: 0;\n      transform: scale(0.8) translateY(-10px);\n    }\n    60% {\n      transform: scale(1.05) translateY(0);\n    }\n    100% {\n      opacity: 1;\n      transform: scale(1) translateY(0);\n    }\n  }\n"]))),ma=l.A.div(Gn||(Gn=(0,r.A)(["\n  flex: 1;\n  overflow: hidden;\n  padding: ",";\n  transition: padding 0.4s cubic-bezier(0.4, 0, 0.2, 1),\n              opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1),\n              transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n  opacity: ",";\n  transform: ",";\n  transform-origin: left center;\n\n  ","\n\n  &::-webkit-scrollbar {\n    width: 6px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: rgba(226, 232, 240, 0.3);\n    border-radius: 3px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: rgba(148, 163, 184, 0.5);\n    border-radius: 3px;\n\n    &:hover {\n      background: rgba(100, 116, 139, 0.7);\n    }\n  }\n"])),e=>e.$isMinimized?"8px 4px":"12px 8px",e=>e.$isMinimized?"0":"1",e=>e.$isMinimized?"scale(0.95) translateX(-10px)":"scale(1) translateX(0)",e=>!e.$isMinimized&&"\n    overflow-y: auto;\n  "),ka=l.A.div(qn||(qn=(0,r.A)(["\n  padding: ",";\n  margin-bottom: 6px;\n  border-radius: 8px;\n  cursor: pointer; /* \u2705 V\u017edy pointer - umo\u017e\u0148uje scrollov\xe1n\xed i k zam\u010den\xfdm sekc\xedm */\n  transition: all 0.2s ease;\n  opacity: ",";\n  background: ",";\n  border: 2px solid ",";\n  box-shadow: ",";\n\n  &:hover {\n    opacity: ","; /* \u2705 M\xedrn\xe9 zesv\u011btlen\xed i pro disabled */\n    transform: translateX(2px); /* \u2705 Hover efekt i pro disabled - ukazuje \u017ee je to klikateln\xe9 */\n    box-shadow: ",";\n  }\n"])),e=>e.$isMinimized?"8px 4px":"10px 14px",e=>e.$isDisabled?.45:1,e=>e.$isDisabled?"linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)":e.$bgColor||"rgba(255, 255, 255, 0.8)",e=>e.$isDisabled?"#cbd5e1":e.$borderColor||"#94a3b8",e=>e.$isActive?"0 2px 8px rgba(0, 0, 0, 0.12), inset 0 0 0 1px rgba(59, 130, 246, 0.3)":"0 1px 3px rgba(0, 0, 0, 0.05)",e=>e.$isDisabled?.55:1,e=>e.$isDisabled?"0 2px 6px rgba(0, 0, 0, 0.08)":"0 4px 12px rgba(0, 0, 0, 0.12)"),fa=l.A.div(Yn||(Yn=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: ",";\n  justify-content: ",";\n"])),e=>e.$isMinimized?"0":"12px",e=>e.$isMinimized?"center":"flex-start"),ha=l.A.div(Xn||(Xn=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  color: ",";\n  flex-shrink: 0;\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n"])),e=>e.$isDisabled?"#64748b":e.$color||"#94a3b8"),ya=l.A.div(Qn||(Qn=(0,r.A)(["\n  flex: 1;\n  min-width: 0;\n  color: ",";\n"])),e=>e.$textColor||"#1e293b"),ba=l.A.div(ea||(ea=(0,r.A)(["\n  font-size: 13px;\n  font-weight: 600;\n  line-height: 1.4;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n"]))),ga=l.A.span(na||(na=(0,r.A)(["\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background: ",";\n  color: white;\n  font-size: 11px;\n  font-weight: 600;\n  padding: ",";\n  border-radius: 50%;\n  width: ",";\n  height: ",";\n  min-width: ",";\n  min-height: ",";\n  margin-left: auto;\n  flex-shrink: 0;\n  line-height: 1;\n"])),e=>e.$hasErrors?"#ef4444":e.$hasMissingFields?"#f59e0b":"#10b981",e=>e.$hasMissingFields&&!e.$hasErrors?"5px":"2px 6px",e=>e.$hasMissingFields&&!e.$hasErrors?"8px":"20px",e=>e.$hasMissingFields&&!e.$hasErrors?"8px":"20px",e=>e.$hasMissingFields&&!e.$hasErrors?"8px":"20px",e=>e.$hasMissingFields&&!e.$hasErrors?"8px":"20px"),xa=l.A.div(aa||(aa=(0,r.A)(["\n  margin: 12px 8px 12px 8px;\n  padding: ",";\n  border: 2px dashed ",";\n  border-radius: 8px;\n  background: ",";\n  transition: all 0.2s ease;\n  cursor: ",";\n  opacity: ",";\n  pointer-events: ",";\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: ",";\n  height: ",";\n\n  &:hover {\n    border-color: ",";\n    background: ",";\n  }\n"])),e=>e.$isMinimized?"12px 8px":"20px",e=>e.$isDisabled?"#d1d5db":e.$isDragOver?"#dc2626":"#fca5a5",e=>e.$isDisabled?"#f3f4f6":e.$isDragOver?"linear-gradient(135deg, rgba(254, 202, 202, 0.5) 0%, rgba(252, 165, 165, 0.5) 100%)":"linear-gradient(135deg, rgba(254, 226, 226, 0.3) 0%, rgba(254, 202, 202, 0.3) 100%)",e=>e.$isDisabled?"not-allowed":"pointer",e=>e.$isDisabled?.5:1,e=>e.$isDisabled?"none":"auto",e=>e.$isMinimized?"4px":"8px",e=>e.$isMinimized?"60px":"".concat(120,"px"),e=>e.$isDisabled?"#d1d5db":"#dc2626",e=>e.$isDisabled?"#f3f4f6":"linear-gradient(135deg, rgba(254, 202, 202, 0.5) 0%, rgba(252, 165, 165, 0.5) 100%)"),ja=l.A.div(oa||(oa=(0,r.A)(["\n  color: ",";\n  transition: all 0.2s ease;\n\n  svg {\n    width: ",";\n    height: ",";\n  }\n"])),e=>e.$isDisabled?"#9ca3af":e.$isDragOver?"#dc2626":"#991b1b",e=>e.$isMinimized?"20px":"32px",e=>e.$isMinimized?"20px":"32px"),za=l.A.div(ta||(ta=(0,r.A)(["\n  font-size: ",";\n  font-weight: 600;\n  color: ",";\n  text-align: center;\n  line-height: 1.4;\n"])),e=>e.$isMinimized?"10px":"13px",e=>e.$isDisabled?"#9ca3af":e.$isDragOver?"#dc2626":"#991b1b"),Aa=[{id:"objednatel",name:"Informace o objednateli",icon:u.X46,color:"#4b5563",bgColor:"linear-gradient(135deg, rgba(249, 250, 251, 0.95) 0%, rgba(243, 244, 246, 0.95) 100%)",borderColor:"#9ca3af",phase:1,required:["jmeno","prijmeni"]},{id:"schvaleni",name:"Schv\xe1len\xed n\xe1kupu PO",icon:u.Iae,color:"#4b5563",bgColor:"linear-gradient(135deg, rgba(249, 250, 251, 0.95) 0%, rgba(243, 244, 246, 0.95) 100%)",borderColor:"#9ca3af",phase:1,required:["schvalovatel_id"]},{id:"dodavatel",name:"Dodavatel",icon:C.A,iconType:"lucide",color:"#92400e",bgColor:"linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)",borderColor:"#f59e0b",phase:2,required:["dodavatel_ico","dodavatel_nazev"]},{id:"detaily",name:"Detaily objedn\xe1vky",icon:T.A,iconType:"lucide",color:"#92400e",bgColor:"linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)",borderColor:"#f59e0b",phase:2,required:["predmet","celkova_cena"]},{id:"dodaci_podminky",name:"Dodac\xed a z\xe1ru\u010dn\xed podm\xednky",icon:_.A,iconType:"lucide",color:"#92400e",bgColor:"linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)",borderColor:"#f59e0b",phase:2,required:[]},{id:"prilohy",name:"P\u0159\xedlohy k objedn\xe1vce",icon:S.A,iconType:"lucide",color:"#991b1b",bgColor:"linear-gradient(135deg, rgba(254, 226, 226, 0.95) 0%, rgba(254, 202, 202, 0.95) 100%)",borderColor:"#dc2626",phase:2,required:[]},{id:"stav_odeslani",name:"Stav odesl\xe1n\xed objedn\xe1vky",icon:T.A,iconType:"lucide",color:"#92400e",bgColor:"linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)",borderColor:"#f59e0b",phase:3,required:[]},{id:"potvrzeni_objednavky",name:"Potvrzen\xed objedn\xe1vky",icon:u.SGM,color:"#1e40af",bgColor:"linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)",borderColor:"#3b82f6",phase:3,required:[]},{id:"registr_smluv",name:"Registr smluv",icon:u.IJd,color:"#1e40af",bgColor:"linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)",borderColor:"#3b82f6",phase:4,required:[]},{id:"registr_smluv_vyplneni",name:"Potvrzen\xed zve\u0159ejn\u011bn\xed",icon:u.IJd,color:"#7e22ce",bgColor:"linear-gradient(135deg, rgba(243, 232, 255, 0.95) 0%, rgba(233, 213, 255, 0.95) 100%)",borderColor:"#a855f7",phase:5,required:[]},{id:"fakturace",name:"Fakturace",icon:v.A,iconType:"lucide",color:"#1e40af",bgColor:"linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)",borderColor:"#3b82f6",phase:6,required:[]},{id:"vecna_spravnost",name:"V\u011bcn\xe1 spr\xe1vnost",icon:k.A,iconType:"lucide",color:"#1e40af",bgColor:"linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)",borderColor:"#3b82f6",phase:7,required:[]},{id:"dokonceni",name:"Dokon\u010den\xed",icon:u.SGM,color:"#059669",bgColor:"linear-gradient(135deg, rgba(209, 250, 229, 0.95) 0%, rgba(167, 243, 208, 0.95) 100%)",borderColor:"#10b981",phase:8,required:[]}],wa=e=>{let{onSectionClick:n,onFilesDrop:a,onToggleSections:o,areSectionsCollapsed:r=!1,currentPhase:d=1,validationErrors:l={},formData:c={},isFullscreen:v=!1,isSectionActive:_,allSectionStates:m={},isWorkflowCompleted:k=!1,canPublishRegistry:f=!1,canUnlockAnything:h=!1,onTemplateClick:y,onSaveAsTemplate:b,onGenerateDocx:g,onToggleFullscreen:x,canGenerateDocx:j=!1,canSaveTemplate:z=!1,showTemplateDropdown:A=!1,serverTemplates:w=[],savedTemplates:S=[],templatesLoading:E=!1,searchQuery:C="",showSearch:O=!1,token:N=null,hasPermission:D,onTemplateSearch:T,onToggleTemplateSearch:I,onRefreshTemplates:P,onFillPoApproval:R,onFillDetails:L,canFillTemplate:V=!0,onCopyTemplateToUser:F,onCopyTemplateToGlobal:M,onShowTemplatePreview:U,onDeleteTemplate:Z,onEditTemplateName:K,editingTemplateId:B=null,editingTemplateName:W="",matchesTemplateQuery:H,isArchived:$=!1}=e;const[J,G]=(0,i.useState)(!1),[q,Y]=(0,i.useState)(!1),[X,Q]=(0,i.useState)(!1),[ee,ne]=(0,i.useState)(!1),[ae,oe]=(0,i.useState)({x:20,y:150}),[te,re]=(0,i.useState)({x:0,y:0}),[ie,se]=(0,i.useState)(!1),de=(0,i.useRef)(null),le=(0,i.useRef)(null),ce=(0,i.useRef)(null),pe=(0,i.useCallback)(e=>{localStorage.setItem("floatingNavigatorPosition",JSON.stringify(e))},[]),ue=(0,i.useCallback)(e=>{var n;const a=J?40:305,o=(null===(n=de.current)||void 0===n?void 0:n.offsetHeight)||400,t=Math.max(0,window.innerWidth-a-20),r=Math.max(0,window.innerHeight-o-20);return{x:Math.max(0,Math.min(e.x,t)),y:Math.max(0,Math.min(e.y,r))}},[J,q]);(0,i.useEffect)(()=>{const e=localStorage.getItem("floatingNavigatorPosition");if(e)try{const n=JSON.parse(e),a=ue(n);oe(a),a.x===n.x&&a.y===n.y||pe(a)}catch(a){console.warn("Failed to parse saved navigator position")}"true"===localStorage.getItem("floatingNavigatorMinimized")&&G(!0);"true"===localStorage.getItem("floatingNavigatorCompact")&&Y(!0);const n=localStorage.getItem("floatingNavigatorScroll");if(n&&ce.current)try{const e=parseInt(n,10);ce.current.scrollTop=e}catch(a){console.warn("Failed to restore scroll position")}},[ue,pe]);const ve=(0,i.useCallback)(()=>{oe(e=>{const n=ue(e);return n.x!==e.x||n.y!==e.y?(pe(n),n):e})},[ue,pe]);(0,i.useEffect)(()=>{const e=()=>{clearTimeout(e.timeoutId),e.timeoutId=setTimeout(ve,150)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),clearTimeout(e.timeoutId)}},[ve]);const _e=(0,i.useCallback)(e=>{localStorage.setItem("floatingNavigatorMinimized",e.toString())},[]),me=(0,i.useCallback)(e=>{localStorage.setItem("floatingNavigatorCompact",e.toString())},[]),fe=(0,i.useRef)(null),he=(0,i.useCallback)(()=>{fe.current&&clearTimeout(fe.current),fe.current=setTimeout(()=>{ce.current&&localStorage.setItem("floatingNavigatorScroll",ce.current.scrollTop.toString())},300)},[]),ye=(0,i.useCallback)(e=>{if(J)return;const n=de.current.getBoundingClientRect();re({x:e.clientX-n.left,y:e.clientY-n.top}),Q(!0)},[J]),be=(0,i.useCallback)(e=>{if(!X)return;const n=e.clientX-te.x,a=e.clientY-te.y,o=ue({x:n,y:a});oe(o)},[X,te,ue]),ge=(0,i.useCallback)(()=>{X&&(Q(!1),pe(ae))},[X,ae,pe]);(0,i.useEffect)(()=>{if(X)return document.addEventListener("mousemove",be),document.addEventListener("mouseup",ge),()=>{document.removeEventListener("mousemove",be),document.removeEventListener("mouseup",ge)}},[X,be,ge]);const xe=(0,i.useCallback)(()=>{const e=!J;if(G(e),_e(e),e){const e=(0,t.A)((0,t.A)({},ae),{},{x:0});oe(e),pe(e)}else oe(e=>{const n=ue(e);return n.x===e.x&&n.y===e.y||pe(n),n})},[J,ae,_e,pe,ue]),je=(0,i.useCallback)(()=>{const e=!q;Y(e),me(e),setTimeout(()=>{oe(e=>{const n=ue(e);return n.x===e.x&&n.y===e.y||pe(n),n})},50)},[q,me,ue,pe]),ze=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),ne(!0)},[]),Ae=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.contains(e.relatedTarget)||ne(!1)},[]),we=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),ne(!0)},[]),Se=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),ne(!1);const n=Array.from(e.dataTransfer.files);n.length>0&&a&&a(n)},[a]),Ee=(0,i.useCallback)(()=>{var e;null===(e=le.current)||void 0===e||e.click()},[]),Ce=(0,i.useCallback)(e=>{const n=Array.from(e.target.files);n.length>0&&a&&a(n),e.target.value=""},[a]),Oe=(0,i.useCallback)(()=>{se(e=>!e),!ie&&P&&P()},[ie,P]);(0,i.useEffect)(()=>{if(!ie)return;const e=e=>{const n=e.target.closest("[data-template-dropdown]"),a=e.target.closest("[data-template-button]");n||a||se(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[ie]);const Ne=(0,i.useCallback)(e=>{n&&n(e.id)},[n]),De=(0,i.useCallback)(e=>{var n;const a=Object.keys(l).filter(n=>{const a=(e=>e.includes("jmeno")||e.includes("email")||e.includes("ev_cislo")||e.includes("garant")?(console.log('\ud83d\udd0d categorizeErrorKey: "'.concat(e,'" \u2192 objednatel')),"objednatel"):e.includes("prikazce")||e.includes("max_cena")||e.includes("strediska")||e.includes("predmet")||e.includes("financovani")||e.includes("lp_kod")||e.includes("cislo_smlouvy")||e.includes("individualni_schvaleni")||e.includes("pojistna_udalost")?(console.log('\ud83d\udd0d categorizeErrorKey: "'.concat(e,'" \u2192 schvaleni')),"schvaleni"):e.startsWith("polozka_")||e.includes("druh_objednavky")?"detaily":e.includes("zpusob_potvrzeni")||e.includes("dt_akceptace")||e.includes("zpusob_platby")?"potvrzeni_objednavky":e.includes("dodavatel")||e.includes("ico")||e.includes("adresa")||e.includes("kontakt")?"dodavatel":e.includes("datum_odeslani")||e.includes("stav_odeslani")?"stav_odeslani":e.startsWith("faktura_")&&e.includes("vecna_spravnost")?"vecna_spravnost":e.startsWith("faktura_")?"fakturace":e.includes("dt_zverejneni")||e.includes("registr")||e.includes("ma_byt_zverejnena")?"registr_smluv_vyplneni":null)(n);return a===e.id}),o=a.length;Object.keys(l).length>0&&"schvaleni"===e.id&&console.log('\ud83e\udded NaviPanel - sekce "'.concat(e.id,'":'),{allValidationErrors:l,allErrorKeys:Object.keys(l),sectionErrors:a,errorCount:o});let t=0;return 0===o&&"vecna_spravnost"===e.id&&c.faktury&&c.faktury.length>0?c.faktury.forEach(e=>{1!==e.potvrzeni_vecne_spravnosti&&!0!==e.potvrzeni_vecne_spravnosti&&t++;const n=parseFloat(c.max_cena_s_dph)||0;(parseFloat(e.fa_castka)||0)>n&&(!e.vecna_spravnost_poznamka||""===e.vecna_spravnost_poznamka.trim())&&t++}):0===o&&e.required&&e.required.length>0&&e.required.forEach(e=>{const n=c[e];(!n||"string"===typeof n&&""===n.trim()||Array.isArray(n)&&0===n.length)&&t++}),{missingCount:t,errorCount:o,totalRequired:(null===(n=e.required)||void 0===n?void 0:n.length)||0}},[l,c]),Te=(0,i.useCallback)(e=>{const n=m[e];return n?{visible:!1!==n.visible,enabled:!1!==n.enabled}:{visible:!0,enabled:!0}},[m]),Ie=e=>{if("lucide"===e.iconType){const n=e.icon;return(0,ke.jsx)(n,{})}return(0,ke.jsx)(p.g,{icon:e.icon})},Pe=(0,ke.jsxs)(ra,{ref:de,$position:ae,$isMinimized:J,$isCompact:q,$isDragging:X,$isFullscreen:v,children:[(0,ke.jsx)(ia,{$isMinimized:J,onMouseDown:ye,children:J?(0,ke.jsx)(sa,{children:"NAVIGATOR"}):(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsxs)(da,{children:[(0,ke.jsx)(Ke,{}),"Navigace"]}),(0,ke.jsxs)(la,{children:[(0,ke.jsx)(va,{onClick:je,title:q?"Zobrazit v\u0161echny sekce":"Zobrazit jen P\u0159\xedlohy + Dropzone",children:q?(0,ke.jsx)(Be,{}):(0,ke.jsx)(We,{})}),(0,ke.jsx)(va,{onClick:xe,title:"Minimalizovat (schovat na levou stranu)",children:(0,ke.jsx)(He,{})})]})]})}),!J&&(0,ke.jsxs)(ca,{children:[(0,ke.jsxs)(pa,{children:[(0,ke.jsx)(ua,{"data-template-button":!0,onClick:Oe,title:V?"Na\u010d\xedst \u0161ablonu objedn\xe1vky":"Na\u010d\xedt\xe1n\xed \u0161ablon nen\xed k dispozici - objedn\xe1vka je dokon\u010dena nebo m\xe1 neulo\u017een\xe9 zm\u011bny",disabled:!V,children:(0,ke.jsx)(p.g,{icon:u.G06})}),b&&(0,ke.jsx)(ua,{$withPlus:!0,onClick:b,title:"Ulo\u017eit aktu\xe1ln\xed formul\xe1\u0159 jako \u0161ablonu",disabled:!z,children:(0,ke.jsx)(p.g,{icon:u.G06})}),g&&(0,ke.jsx)(ua,{onClick:g,title:"Generovat DOCX ze \u0161ablony",disabled:!j,children:(0,ke.jsx)($e,{size:16})}),o&&(0,ke.jsx)(ua,{onClick:o,title:r?"Rozbalit v\u0161echny sekce":"Sbalit zam\u010den\xe9 sekce",children:r?(0,ke.jsx)(Je.A,{size:16}):(0,ke.jsx)(Ge,{size:16})}),x&&(0,ke.jsx)(ua,{onClick:x,title:v?"Ukon\u010dit fullscreen re\u017eim":"P\u0159epnout do fullscreen re\u017eimu",children:(0,ke.jsx)(p.g,{icon:v?u.gr3:u.oZK})})]}),(0,ke.jsx)("div",{"data-template-dropdown":!0,style:{position:"relative"},children:(0,ke.jsx)(Vn,{show:ie,serverTemplates:w,savedTemplates:S,templatesLoading:E,searchQuery:C,showSearch:O,currentPhase:d,isArchived:$,token:N,hasPermission:D,onSearch:T,onToggleSearch:I,onRefresh:P,onFillPo:R,onFillDetails:L,canFillTemplate:V,onCopyToUser:F,onCopyToGlobal:M,onShowPreview:U,onDelete:Z,onEditName:K,editingTemplateId:B,editingTemplateName:W,matchesQuery:H})})]}),J&&(0,ke.jsx)(_a,{onClick:xe,title:"Rozbalit navig\xe1tor",children:(0,ke.jsx)(qe,{})}),!J&&(0,ke.jsx)(ma,{ref:ce,$isMinimized:J,onScroll:he,children:Aa.map(e=>{if("prilohy"===e.id)return null;if(q)return null;const{visible:n,enabled:a}=Te(e.id);if(!n)return null;const o=!a,t=!!_&&_(e.id),r=De(e),i=r.errorCount>0,s=!i&&r.missingCount>0,d=i||s;return(0,ke.jsx)(ka,{$isDisabled:o,$isActive:t,$color:e.color,$bgColor:e.bgColor,$borderColor:e.borderColor,$isMinimized:J,onClick:()=>Ne(e),title:o?"".concat(e.name," (zam\u010deno - kliknut\xedm zobraz\xedte vypln\u011bn\xe1 data)"):e.name,children:(0,ke.jsxs)(fa,{$isMinimized:J,children:[(0,ke.jsx)(ha,{$color:e.color,$isDisabled:o,children:Ie(e)}),!J&&(0,ke.jsx)(ya,{$textColor:o?"#64748b":e.color,children:(0,ke.jsxs)(ba,{$isDisabled:o,children:[e.name,d&&(0,ke.jsx)(ga,{$hasErrors:i,$hasMissingFields:s,children:i?r.errorCount:""})]})})]})},e.id)})}),!J&&c.id&&(()=>{const e=null===m||void 0===m?void 0:m.prilohy,n=e?!e.enabled:k;return(0,ke.jsxs)(xa,{$isDragOver:ee,$isMinimized:J,$isDisabled:n,onDragEnter:ze,onDragLeave:Ae,onDragOver:we,onDrop:Se,onClick:Ee,children:[(0,ke.jsx)("input",{ref:le,type:"file",multiple:!0,style:{display:"none"},onChange:Ce}),(0,ke.jsx)(ja,{$isDragOver:ee,$isMinimized:J,$isDisabled:n,children:(0,ke.jsx)(Ye,{})}),(0,ke.jsx)(za,{$isDragOver:ee,$isMinimized:J,$isDisabled:n,children:ee?"Pus\u0165te soubory zde":"P\u0159et\xe1hn\u011bte soubory"})]})})(),!J&&c.id&&(()=>{const e=null===m||void 0===m?void 0:m.prilohy;return(e?!e.enabled:k)&&(0,ke.jsxs)("div",{style:{margin:"12px 8px",padding:"16px",background:"linear-gradient(135deg, rgba(229, 229, 229, 0.95) 0%, rgba(209, 213, 219, 0.95) 100%)",border:"2px solid #9ca3af",borderRadius:"8px",textAlign:"center",color:"#4b5563",fontSize:"13px",fontWeight:"600",lineHeight:"1.4"},children:[(0,ke.jsx)("div",{style:{marginBottom:"4px"},children:"\ud83d\udd12 Objedn\xe1vka zam\u010dena"}),(0,ke.jsx)("div",{style:{fontSize:"11px",fontWeight:"400"},children:"P\u0159\xedlohy jsou uzam\u010den\xe9"})]})})(),!J&&c.id&&(()=>{const e={id:"prilohy",name:"P\u0159\xedlohy k objedn\xe1vce",icon:u.KTq,color:"#991b1b",bgColor:"linear-gradient(135deg, rgba(254, 226, 226, 0.95) 0%, rgba(254, 202, 202, 0.95) 100%)",borderColor:"#dc2626"},n=null===m||void 0===m?void 0:m.prilohy,a=n?!n.enabled:k,o=!!_&&_(e.id),t=De(e),r=t.errorCount>0,i=!r&&t.missingCount>0,s=r||i;return(0,ke.jsx)(ma,{$isMinimized:J,children:(0,ke.jsx)(ka,{$isDisabled:a,$isActive:o,$color:e.color,$bgColor:e.bgColor,$borderColor:e.borderColor,$isMinimized:J,onClick:()=>Ne(e),title:a?"".concat(e.name," (zam\u010deno - kliknut\xedm zobraz\xedte vypln\u011bn\xe1 data)"):e.name,children:(0,ke.jsxs)(fa,{$isMinimized:J,children:[(0,ke.jsx)(ha,{$color:e.color,$isDisabled:a,children:(0,ke.jsx)(p.g,{icon:e.icon})}),!J&&(0,ke.jsx)(ya,{$textColor:a?"#64748b":e.color,children:(0,ke.jsxs)(ba,{$isDisabled:a,children:[e.name,s&&(0,ke.jsx)(ga,{$hasErrors:r,$hasMissingFields:i,children:r?t.errorCount:""})]})})]})})})})()]});return"undefined"!==typeof document?s.createPortal(Pe,document.body):Pe};var Sa=a(88720),Ea=a(1356),Ca=a(32730),Oa=a(21397),Na=a(65757),Da=a(90087),Ta=a(33637),Ia=a(44649);function Pa(e){if(!e)return[];if(Array.isArray(e)&&e.every(e=>"string"===typeof e))return e.map(e=>String(e).toUpperCase().trim()).filter(Boolean);if("string"===typeof e)try{const n=JSON.parse(e);if(Array.isArray(n))return n.map(e=>"string"===typeof e?e.toUpperCase().trim():null!==e&&void 0!==e&&e.kod_stavu?String(e.kod_stavu).toUpperCase().trim():null!==e&&void 0!==e&&e.kod?String(e.kod).toUpperCase().trim():String(e).toUpperCase().trim()).filter(Boolean)}catch(n){return console.error("\u274c [normalizeStrediskaFromBackend] Chyba parsov\xe1n\xed JSON:",n,"Data:",e),[]}return Array.isArray(e)&&e.some(e=>"object"===typeof e&&null!==e)?e.map(e=>null!==e&&void 0!==e&&e.kod_stavu?String(e.kod_stavu).toUpperCase().trim():null!==e&&void 0!==e&&e.kod?String(e.kod).toUpperCase().trim():"string"===typeof e?e.toUpperCase().trim():String(e).toUpperCase().trim()).filter(Boolean):(console.warn("\u26a0\ufe0f [normalizeStrediskaFromBackend] Nezn\xe1m\xfd form\xe1t dat:",typeof e,e),[])}function Ra(e){return Array.isArray(e)?e.map(e=>String(e).toUpperCase().trim()).filter(Boolean):[]}function La(e){if(!e)return{};let n=e;if("string"===typeof e)try{n=JSON.parse(e)}catch(o){return console.error("\u274c [normalizeFinancovaniFromBackend] Chyba parsov\xe1n\xed JSON:",o,"Data:",e),{}}const a={zpusob_financovani:n.typ||n.kod_stavu||n.zdroj||""};if(n.lp_kody?a.lp_kod=n.lp_kody:n.lp_kod&&(a.lp_kod=n.lp_kod),n.cislo_smlouvy&&(a.cislo_smlouvy=n.cislo_smlouvy),n.smlouva_poznamka&&(a.smlouva_poznamka=n.smlouva_poznamka),n.individualni_schvaleni&&(a.individualni_schvaleni=n.individualni_schvaleni),n.individualni_poznamka&&(a.individualni_poznamka=n.individualni_poznamka),n.pojistna_udalost_cislo&&(a.pojistna_udalost_cislo=n.pojistna_udalost_cislo),n.pojistna_udalost_poznamka&&(a.pojistna_udalost_poznamka=n.pojistna_udalost_poznamka),n.doplnujici_data){const e=n.doplnujici_data;e.lp_kod&&!a.lp_kod&&(a.lp_kod=e.lp_kod),e.lp_kody&&!a.lp_kod&&(a.lp_kod=e.lp_kody),e.cislo_smlouvy&&!a.cislo_smlouvy&&(a.cislo_smlouvy=e.cislo_smlouvy),e.smlouva_poznamka&&!a.smlouva_poznamka&&(a.smlouva_poznamka=e.smlouva_poznamka),e.individualni_schvaleni&&!a.individualni_schvaleni&&(a.individualni_schvaleni=e.individualni_schvaleni),e.individualni_poznamka&&!a.individualni_poznamka&&(a.individualni_poznamka=e.individualni_poznamka),e.pojistna_udalost_cislo&&!a.pojistna_udalost_cislo&&(a.pojistna_udalost_cislo=e.pojistna_udalost_cislo),e.pojistna_udalost_poznamka&&!a.pojistna_udalost_poznamka&&(a.pojistna_udalost_poznamka=e.pojistna_udalost_poznamka)}return a}function Va(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e||!e.zpusob_financovani)return null;const a=n.find(n=>n.kod===e.zpusob_financovani||n.kod_stavu===e.zpusob_financovani||n.value===e.zpusob_financovani),o={typ:e.zpusob_financovani,nazev:(null===a||void 0===a?void 0:a.nazev)||(null===a||void 0===a?void 0:a.nazev_stavu)||(null===a||void 0===a?void 0:a.label)||e.zpusob_financovani,nazev_stavu:(null===a||void 0===a?void 0:a.nazev_stavu)||(null===a||void 0===a?void 0:a.nazev)||(null===a||void 0===a?void 0:a.label)||e.zpusob_financovani},t=e.zpusob_financovani;return"LP"===t?e.lp_kod&&Array.isArray(e.lp_kod)&&e.lp_kod.length>0&&(o.lp_kody=e.lp_kod.map(e=>parseInt(e,10))):"SMLOUVA"===t?(e.cislo_smlouvy&&(o.cislo_smlouvy=e.cislo_smlouvy),e.smlouva_poznamka&&(o.smlouva_poznamka=e.smlouva_poznamka)):"INDIVIDUALNI_SCHVALENI"===t||"INDIVIDU\xc1LN\xcd"===t||"INDIVIDUALNI"===t?(e.individualni_schvaleni&&(o.individualni_schvaleni=e.individualni_schvaleni),e.individualni_poznamka&&(o.individualni_poznamka=e.individualni_poznamka)):"POJISTNA_UDALOST"!==t&&"POJISTN\xc1 UD\xc1LOST"!==t&&"POJISTNA UDALOST"!==t||(e.pojistna_udalost_cislo&&(o.pojistna_udalost_cislo=e.pojistna_udalost_cislo),e.pojistna_udalost_poznamka&&(o.pojistna_udalost_poznamka=e.pojistna_udalost_poznamka)),o}new class{constructor(){this.isInitialized=!1,this.isInitializing=!1,this.initPromise=null,this.cache={users:[],approvers:[],strediska:[],financovani:[],druhyObjednavky:[],lpKody:[]},this.metadata={lastInitTime:null,initDuration:null,errors:[]},this.stateCallbacks={}}registerStateCallbacks(e){this.stateCallbacks={setAllUsers:e.setAllUsers||(()=>{}),setApprovers:e.setApprovers||(()=>{}),setStrediskaOptions:e.setStrediskaOptions||(()=>{}),setFinancovaniOptions:e.setFinancovaniOptions||(()=>{}),setDruhyObjednavkyOptions:e.setDruhyObjednavkyOptions||(()=>{}),setLpKodyOptions:e.setLpKodyOptions||(()=>{}),setLoadingUsers:e.setLoadingUsers||(()=>{}),setLoadingApprovers:e.setLoadingApprovers||(()=>{}),setLoadingStrediska:e.setLoadingStrediska||(()=>{}),setLoadingFinancovani:e.setLoadingFinancovani||(()=>{}),setLoadingDruhyObjednavky:e.setLoadingDruhyObjednavky||(()=>{}),setLoadingLpKody:e.setLoadingLpKody||(()=>{})}}async initialize(e){let{token:n,username:a,formDataId:o=null}=e;if(this.isInitializing)return await this.initPromise,this._updateReactState(),this.cache;if(this.isInitialized)return this._updateReactState(),this.cache;this.isInitializing=!0;const t=Date.now();this.initPromise=this._performInitialization({token:n,username:a,formDataId:o});try{await this.initPromise;const e=Date.now()-t;return this.metadata.lastInitTime=new Date,this.metadata.initDuration=e,this.isInitialized=!0,this.cache}catch(r){throw this.metadata.errors.push({timestamp:new Date,error:r.message}),r}finally{this.isInitializing=!1}}async _performInitialization(e){let{token:n,username:a,formDataId:o}=e;const t=!!o,[r,i,s,d,l,c]=await Promise.allSettled([this._loadUsers(n,a,t),this._loadApprovers(n,a),this._loadStrediska(n,a),this._loadFinancovani(n,a),this._loadDruhyObjednavky(n,a),this._loadLpKody(n,a)]),p={users:this._handleResult(r,"U\u017eivatel\xe9"),approvers:this._handleResult(i,"Schvalovatel\xe9"),strediska:this._handleResult(s,"St\u0159ediska"),financovani:this._handleResult(d,"Financov\xe1n\xed"),druhyObjednavky:this._handleResult(l,"Druhy objedn\xe1vky"),lpKody:this._handleResult(c,"LP k\xf3dy")};this.cache={users:p.users.data,approvers:p.approvers.data,strediska:p.strediska.data,financovani:p.financovani.data,druhyObjednavky:p.druhyObjednavky.data,lpKody:p.lpKody.data},this._updateReactState();return Object.entries(p).filter(e=>{let[n,a]=e;return!a.success}).map(e=>{let[n]=e;return n}).length,this.cache}async _loadUsers(e,n,a){var o,t;null===(o=(t=this.stateCallbacks).setLoadingUsers)||void 0===o||o.call(t,!0);try{const o=await(0,me.Ym)({token:e,username:n});return a?o||[]:(o||[]).filter(e=>1===e.aktivni||"1"===e.aktivni)}catch(s){return[]}finally{var r,i;null===(r=(i=this.stateCallbacks).setLoadingUsers)||void 0===r||r.call(i,!1)}}async _loadApprovers(e,n){var a,o;null===(a=(o=this.stateCallbacks).setLoadingApprovers)||void 0===a||a.call(o,!0);try{const a=(await(0,me.lF)({token:e,username:n})||[]).filter(e=>void 0===e.aktivni||null===e.aktivni||(1===e.aktivni||"1"===e.aktivni));return a.map(e=>{const n=e.titul_pred?e.titul_pred+" ":"",a=e.jmeno||"",o=e.prijmeni||"",r=e.titul_za?", "+e.titul_za:"",i="".concat(n).concat(a," ").concat(o).concat(r).replace(/\s+/g," ").trim()||e.username||"User ".concat(e.id||e.user_id);return(0,t.A)((0,t.A)({},e),{},{displayName:i,label:i,value:e.id||e.user_id})})}catch(s){return[]}finally{var r,i;null===(r=(i=this.stateCallbacks).setLoadingApprovers)||void 0===r||r.call(i,!1)}}async _loadStrediska(e,n){var a,o;null===(a=(o=this.stateCallbacks).setLoadingStrediska)||void 0===a||a.call(o,!0);try{return await(0,Ta.CR)({token:e,username:n})||[]}catch(i){return[]}finally{var t,r;null===(t=(r=this.stateCallbacks).setLoadingStrediska)||void 0===t||t.call(r,!1)}}async _loadFinancovani(e,n){var a,o;null===(a=(o=this.stateCallbacks).setLoadingFinancovani)||void 0===a||a.call(o,!0);try{const a=await(0,Ta.hP)({token:e,username:n});return Array.isArray(a)?(a.length,a):[]}catch(i){return[]}finally{var t,r;null===(t=(r=this.stateCallbacks).setLoadingFinancovani)||void 0===t||t.call(r,!1)}}async _loadDruhyObjednavky(e,n){var a,o;null===(a=(o=this.stateCallbacks).setLoadingDruhyObjednavky)||void 0===a||a.call(o,!0);try{const a=await(0,Ta.je)({token:e,username:n}),o=Array.isArray(a)?a:[];return o.length,o}catch(i){return[]}finally{var t,r;null===(t=(r=this.stateCallbacks).setLoadingDruhyObjednavky)||void 0===t||t.call(r,!1)}}async _loadLpKody(e,n){var a,o;null===(a=(o=this.stateCallbacks).setLoadingLpKody)||void 0===a||a.call(o,!0);try{return await(0,me.Hy)({token:e,username:n})||[]}catch(i){return[]}finally{var t,r;null===(t=(r=this.stateCallbacks).setLoadingLpKody)||void 0===t||t.call(r,!1)}}_handleResult(e,n){return"fulfilled"===e.status&&void 0!==e.value&&null!==e.value?{success:!0,data:e.value}:{success:!1,data:[]}}_updateReactState(){var e,n,a,o,t,r,i,s,d,l,c,p;this._hasDataChanged("users",this.cache.users)&&(null===(e=(n=this.stateCallbacks).setAllUsers)||void 0===e||e.call(n,this.cache.users));this._hasDataChanged("approvers",this.cache.approvers)&&(null===(a=(o=this.stateCallbacks).setApprovers)||void 0===a||a.call(o,this.cache.approvers));this._hasDataChanged("strediska",this.cache.strediska)&&(null===(t=(r=this.stateCallbacks).setStrediskaOptions)||void 0===t||t.call(r,this.cache.strediska));this._hasDataChanged("financovani",this.cache.financovani)&&(null===(i=(s=this.stateCallbacks).setFinancovaniOptions)||void 0===i||i.call(s,this.cache.financovani));this._hasDataChanged("druhyObjednavky",this.cache.druhyObjednavky)&&(null===(d=(l=this.stateCallbacks).setDruhyObjednavkyOptions)||void 0===d||d.call(l,this.cache.druhyObjednavky));this._hasDataChanged("lpKody",this.cache.lpKody)&&(null===(c=(p=this.stateCallbacks).setLpKodyOptions)||void 0===c||c.call(p,this.cache.lpKody))}_hasDataChanged(e,n){const a="_prev_".concat(e),o=this[a];return o?o.length!==n.length&&(this[a]=n,!0):(this[a]=n,!0)}async loadOrder(e){let{token:n,username:a,orderId:o,archivovano:t=0}=e;try{const e=await(0,Ia.Hj)(o,n,a,!0);if(!e)throw new Error("Objedn\xe1vka ID ".concat(o," nebyla nalezena"));if(e.financovani){const n=La(e.financovani);Object.assign(e,n)}return e.strediska_kod&&(e.strediska_kod=Pa(e.strediska_kod)),e}catch(r){throw r}}reset(){this.isInitialized=!1,this.isInitializing=!1,this.initPromise=null,this.cache={users:[],approvers:[],strediska:[],financovani:[],druhyObjednavky:[],lpKody:[]},this.metadata={lastInitTime:null,initDuration:null,errors:[]}}getState(){return{isInitialized:this.isInitialized,isInitializing:this.isInitializing,cache:(0,t.A)({},this.cache),metadata:(0,t.A)({},this.metadata)}}};const Fa=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{delay:a=3e3,enabled:o=!0,dependencies:t=[]}=n,r=(0,i.useRef)(null),s=(0,i.useRef)(!1),d=(0,i.useRef)(0),l=(0,i.useCallback)(()=>{r.current&&(clearTimeout(r.current),r.current=null,s.current=!1)},[]),c=(0,i.useCallback)(function(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!o)return;l();const t=Date.now(),i=t-d.current;if(n&&i>=1e3)return d.current=t,void e(!0);s.current=!0,r.current=setTimeout(()=>{const n=Date.now();n-d.current>=1e3&&(d.current=n,e(!0)),s.current=!1,r.current=null},n?0:a)},[o,a,e,l,...t]);return(0,i.useEffect)(()=>()=>{r.current&&clearTimeout(r.current)},[]),{triggerAutosave:c,cancelAutosave:l,isScheduled:()=>s.current}};var Ma=a(19439),Ua=a(77220),Za=a(30264),Ka=a(43548);const Ba=a(56263).A.create({baseURL:"https://erdms.zachranka.cz/api.eeo/",headers:{"Content-Type":"application/json"}});const Wa=new class{async create(e){let{token:n,username:a,type:o,order_id:t,action_user_id:r,to_user_id:i,to_users:s,additional_data:d={},priority:l,send_email:c,template_override:p}=e;try{const e={token:n,username:a,type:o,order_id:t,action_user_id:r};i&&(e.to_user_id=i),s&&(e.to_users=s),Object.keys(d).length>0&&(e.additional_data=d),l&&(e.priority=l),void 0!==c&&(e.send_email=c),p&&(e.template_override=p);return await Ba.post("/notifications/create",e)}catch(u){throw u}}async preview(e){let{token:n,username:a,type:o,order_id:t,action_user_id:r,additional_data:i={}}=e;try{return await Ba.post("/notifications/preview",{token:n,username:a,type:o,order_id:t,action_user_id:r,additional_data:i})}catch(s){throw s}}async getTemplates(e){let{token:n,username:a,active_only:o=!0}=e;try{return(await Ba.post("/notifications/templates",{token:n,username:a,active_only:o})).data||[]}catch(t){throw t}}async sendBulk(e){let{token:n,username:a,type:o,order_id:t,action_user_id:r,recipients:i,additional_data:s={}}=e;try{return await Ba.post("/notifications/send-bulk",{token:n,username:a,type:o,order_id:t,action_user_id:r,recipients:i,additional_data:s})}catch(d){throw d}}async notifyOrderApproved(e){let{token:n,username:a,order_id:o,action_user_id:t,creator_id:r}=e;return this.create({token:n,username:a,type:"order_status_schvalena",order_id:o,action_user_id:t,to_user_id:r,send_email:!0})}async notifyOrderRejected(e){let{token:n,username:a,order_id:o,action_user_id:t,creator_id:r,rejection_reason:i}=e;return this.create({token:n,username:a,type:"order_status_zamitnuta",order_id:o,action_user_id:t,to_user_id:r,additional_data:{rejection_reason:i||"Bez uveden\xed d\u016fvodu"},send_email:!0,priority:"high"})}async notifyPendingApproval(e){let{token:n,username:a,order_id:o,action_user_id:t,garant_id:r}=e;return this.create({token:n,username:a,type:"order_status_ke_schvaleni",order_id:o,action_user_id:t,to_user_id:r,send_email:!0,priority:"high"})}async notifyWaitingForChanges(e){let{token:n,username:a,order_id:o,action_user_id:t,creator_id:r,waiting_reason:i}=e;return this.create({token:n,username:a,type:"order_status_ceka_se",order_id:o,action_user_id:t,to_user_id:r,additional_data:{waiting_reason:i||"Po\u017eadov\xe1no dopln\u011bn\xed \xfadaj\u016f"},send_email:!0,priority:"normal"})}async notifySentToSupplier(e){let{token:n,username:a,order_id:o,action_user_id:t,recipients:r}=e;return this.sendBulk({token:n,username:a,type:"order_status_odeslana",order_id:o,action_user_id:t,recipients:r,send_email:!0})}async notifyConfirmedBySupplier(e){let{token:n,username:a,order_id:o,action_user_id:t,recipients:r}=e;return this.sendBulk({token:n,username:a,type:"order_status_potvrzena",order_id:o,action_user_id:t,recipients:r,send_email:!0})}async notifyRegistryPublished(e){let{token:n,username:a,order_id:o,action_user_id:t,recipients:r}=e;return this.sendBulk({token:n,username:a,type:"order_status_registr_zverejnena",order_id:o,action_user_id:t,recipients:r,send_email:!0})}async notifyInvoiceAdded(e){let{token:n,username:a,order_id:o,action_user_id:t,garant_id:r}=e;return this.create({token:n,username:a,type:"order_status_faktura_pridana",order_id:o,action_user_id:t,to_user_id:r,send_email:!0})}async notifyInvoiceApproved(e){let{token:n,username:a,order_id:o,action_user_id:t,creator_id:r}=e;return this.create({token:n,username:a,type:"order_status_faktura_schvalena",order_id:o,action_user_id:t,to_user_id:r,send_email:!0})}async notifyInvoicePaid(e){let{token:n,username:a,order_id:o,action_user_id:t,recipients:r}=e;return this.sendBulk({token:n,username:a,type:"order_status_faktura_uhrazena",order_id:o,action_user_id:t,recipients:r,send_email:!0})}async notifyVecnaSpravnostConfirmed(e){let{token:n,username:a,order_id:o,action_user_id:t,recipients:r}=e;return this.sendBulk({token:n,username:a,type:"order_status_kontrola_potvrzena",order_id:o,action_user_id:t,recipients:r,send_email:!0})}async notifyVecnaSpravnostRejected(e){let{token:n,username:a,order_id:o,action_user_id:t,recipients:r,rejection_reason:i}=e;return this.sendBulk({token:n,username:a,type:"order_status_kontrola_zamitnuta",order_id:o,action_user_id:t,recipients:r,additional_data:{rejection_reason:i||"Vadn\xe9 pln\u011bn\xed - nutn\xe1 reklamace"},send_email:!0,priority:"high"})}async sendOrderApprovalNotifications(e){let{token:n,username:a,orderData:o}=e;try{const e=new Set,t=new Set;o.prikazce_id&&t.add(o.prikazce_id),o.garant_id&&o.garant_id!==o.prikazce_id&&e.add(o.garant_id),o.vytvoril&&o.vytvoril!==o.prikazce_id&&e.add(o.vytvoril),o.objednatel_id&&o.objednatel_id!==o.prikazce_id&&e.add(o.objednatel_id);const r=Array.from(e),i=Array.from(t);if(0===r.length&&0===i.length)return console.warn("sendOrderApprovalNotifications: \u017d\xe1dn\xed p\u0159\xedjemci k odesl\xe1n\xed"),{status:"warning",message:"No recipients",sent:0};const s={token:n,username:a,order_id:o.id,order_number:o.ev_cislo,order_subject:o.predmet,commander_id:o.prikazce_id,garant_id:o.garant_id,creator_id:o.vytvoril,supplier_name:o.dodavatel_nazev||"Neuvedeno",financovani_json:o.financovani_json||"{}",strediska_names:o.strediska_nazvy||[],max_price:o.max_price_with_dph?"".concat(o.max_price_with_dph.toLocaleString("cs-CZ")," K\u010d"):"Neuvedeno",is_urgent:o.is_urgent||!1,from:r,to:i};console.log("Dual notification payload:",{fromCount:r.length,toCount:i.length,strediska:s.strediska_names.length,urgent:s.is_urgent});const d=await Ba.post("/notifications/send-dual",s);return console.log("sendOrderApprovalNotifications SUCCESS:",d),d}catch(t){return console.error("sendOrderApprovalNotifications ERROR:",t),{status:"error",message:t.message||"Failed to send notifications",sent:0}}}},Ha={NOVA:{code:"NOVA",name:"Nov\xe1",description:"Objedn\xe1vka je v p\u0159\xedprav\u011b, viditeln\xe1 pouze pro autora",color:"#94a3b8",icon:"\ud83d\udcdd",phase:"draft"},ODESLANA_KE_SCHVALENI:{code:"ODESLANA_KE_SCHVALENI",name:"Ke schv\xe1len\xed",description:"Objedn\xe1vka byla odesl\xe1na a \u010dek\xe1 na akci schvalovatele",color:"#f59e0b",icon:"\u23f3",phase:"approval"},SCHVALENA:{code:"SCHVALENA",name:"Schv\xe1len\xe1",description:"Objedn\xe1vka byla schv\xe1lena p\u0159\xedslu\u0161n\xfdm mana\u017eerem",color:"#10b981",icon:"\u2705",phase:"approved"},ZAMITNUTA:{code:"ZAMITNUTA",name:"Zam\xedtnuta",description:"Objedn\xe1vka byla schvalovatelem zam\xedtnuta",color:"#ef4444",icon:"\u274c",phase:"rejected"},CEKA_POTVRZENI:{code:"CEKA_POTVRZENI",name:"\u010cek\xe1 na potvrzen\xed",description:"Objedn\xe1vka byla odesl\xe1na, \u010dek\xe1 na potvrzen\xed dodavatele",color:"#3b82f6",icon:"\ud83d\udce4",phase:"supplier_pending"},POTVRZENA:{code:"POTVRZENA",name:"Potvrzen\xe1 dodavatelem",description:"Dodavatel potvrdil p\u0159ijet\xed a akceptaci objedn\xe1vky",color:"#059669",icon:"\u2705",phase:"supplier_confirmed"},DOKONCENA:{code:"DOKONCENA",name:"Dokon\u010den\xe1",description:"Zbo\u017e\xed/slu\u017eba bylo dod\xe1no, proces je uzav\u0159en",color:"#6b7280",icon:"\ud83c\udfc1",phase:"completed"},ZRUSENA:{code:"ZRUSENA",name:"Zru\u0161ena",description:"Objedn\xe1vka byla stornov\xe1na p\u0159ed dokon\u010den\xedm",color:"#9ca3af",icon:"\ud83d\uddd1\ufe0f",phase:"cancelled"},ROZPRACOVANA:{code:"ROZPRACOVANA",name:"Rozpracovan\xe1",description:"Schv\xe1len\xe1 objedn\xe1vka je v procesu zpracov\xe1n\xed",color:"#8b5cf6",icon:"\ud83d\udd27",phase:"in_progress"}},$a=e=>{const n=Ha[e];return n?n.phase:"draft"},Ja=(Object.values(Ha),{predmet:"P\u0159edm\u011bt objedn\xe1vky",garant_uzivatel_id:"Garant",prikazce_id:"P\u0159\xedkazce",max_cena_s_dph:"Maxim\xe1ln\xed cena s DPH",strediska_kod:"St\u0159edisko",jmeno:"Jm\xe9no objednatele",email:"E-mail objednatele",dodavatel_nazev:"N\xe1zev dodavatele",dodavatel_adresa:"Adresa dodavatele",dodavatel_ico:"I\u010cO dodavatele",dodavatel_kontakt:"Kontakt na dodavatele",druh_objednavky_kod:"Druh objedn\xe1vky",polozky_objednavky:"Polo\u017eky objedn\xe1vky",zpusob_financovani:"Zp\u016fsob financov\xe1n\xed",lp_kod:"LP k\xf3d",cislo_smlouvy:"\u010c\xedslo smlouvy",smlouva_poznamka:"Pozn\xe1mka ke smlouv\u011b",individualni_schvaleni:"Identifik\xe1tor schv\xe1len\xed",individualni_poznamka:"Pozn\xe1mka k schv\xe1len\xed",pojistna_udalost_cislo:"\u010c\xedslo pojistn\xe9 ud\xe1losti",pojistna_udalost_poznamka:"Pozn\xe1mka k pojistn\xe9 ud\xe1losti",datum_odeslani:"Datum odesl\xe1n\xed",schvaleni_komentar:"Koment\xe1\u0159",odeslani_storno_duvod:"D\u016fvod stornov\xe1n\xed",dodavatel_zpusob_potvrzeni:"Zp\u016fsob potvrzen\xed",zpusob_platby:"Zp\u016fsob platby",dt_akceptace:"Datum akceptace",dt_zverejneni:"Datum zve\u0159ejn\u011bn\xed (VZ)",registr_iddt:"Identifik\xe1tor IDDT",ma_byt_zverejnena:"Zve\u0159ejn\u011bn\xed"}),Ga=function(e){var n,a;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"NOVA",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r={},i=(e=>{const n=["predmet","max_cena_s_dph","strediska_kod","zpusob_financovani","prikazce_id","garant_uzivatel_id"];switch(e){case"NOVA":default:return n;case"ODESLANA_KE_SCHVALENI":return[...n,"garant_uzivatel_id","prikazce_id","jmeno","email"];case"SCHVALENA":return[...n,"garant_uzivatel_id","prikazce_id","jmeno","email","schvalovatel_id","dt_schvaleni","dodavatel_nazev","dodavatel_adresa","dodavatel_ico","druh_objednavky_kod","polozky_objednavky"];case"CEKA_POTVRZENI":return[...n,"garant_uzivatel_id","prikazce_id","jmeno","email","dodavatel_nazev","dodavatel_kontakt"]}})(o),s={predmet:"phase1",garant_uzivatel_id:"phase1",prikazce_id:"phase1",max_cena_s_dph:"phase1",strediska_kod:"phase1",jmeno:"phase1",email:"phase1",zpusob_financovani:"financovani",lp_kod:"financovani",cislo_smlouvy:"financovani",smlouva_poznamka:"financovani",individualni_schvaleni:"financovani",individualni_poznamka:"financovani",pojistna_udalost_cislo:"financovani",pojistna_udalost_poznamka:"financovani",dodavatel_nazev:"phase3",dodavatel_adresa:"phase3",dodavatel_ico:"phase3",dodavatel_kontakt:"phase3",druh_objednavky_kod:"phase3",polozky_objednavky:"phase3",datum_odeslani:"phase4to6",dodavatel_zpusob_potvrzeni:"phase4to6",zpusob_platby:"phase4to6",dt_akceptace:"phase4to6",schvaleni_komentar:"phase2",odeslani_storno_duvod:"phase2"},d=(()=>{const n=e.zpusob_financovani;if(!n)return!1;if("string"===typeof n)return n.toLowerCase().includes("pokladna");if("object"===typeof n&&null!==n){return(n.nazev_stavu||n.nazev||"").toLowerCase().includes("pokladna")}return!1})();var l,c,p,u;(i.forEach(n=>{var a,o,i,l,c,p,u,v,_,m,k,f;if(((e,n)=>{if(!t||!e)return!0;const a=t[e];if(!a)return!0;if(["dodavatel_nazev","dodavatel_adresa","dodavatel_ico","dodavatel_kontakt","prikazce_id","max_cena_s_dph","garant_uzivatel_id","predmet","strediska_kod"].includes(n))return a.visible;return a.visible&&!a.locked})(s[n],n)&&(!d||!["dodavatel_nazev","dodavatel_adresa","dodavatel_ico","dodavatel_kontakt"].includes(n)))switch(n){case"predmet":null!==(a=e.predmet)&&void 0!==a&&a.trim()||(r.predmet="".concat(Ja.predmet," je povinn\xfd - zadejte stru\u010dn\xfd popis toho, co objedn\xe1v\xe1te"));break;case"max_cena_s_dph":(!e.max_cena_s_dph||e.max_cena_s_dph<=0)&&(r.max_cena_s_dph="".concat(Ja.max_cena_s_dph," je povinn\xe1 - zadejte p\u0159edpokl\xe1danou celkovou cenu v\u010detn\u011b DPH"));break;case"strediska_kod":(!e.strediska_kod||Array.isArray(e.strediska_kod)&&0===e.strediska_kod.length)&&(r.strediska_kod="".concat(Ja.strediska_kod," - vyberte alespo\u0148 jedno st\u0159edisko, ke kter\xe9mu se objedn\xe1vka vztahuje"));break;case"garant_uzivatel_id":e.garant_uzivatel_id&&""!==e.garant_uzivatel_id||(r.garant_uzivatel_id="".concat(Ja.garant_uzivatel_id," je povinn\xfd - vyberte osobu zodpov\u011bdnou za objedn\xe1vku"));break;case"prikazce_id":e.prikazce_id&&""!==e.prikazce_id||(r.prikazce_id="".concat(Ja.prikazce_id," je povinn\xfd - vyberte osobu, kter\xe1 schvaluje objedn\xe1vku"));break;case"jmeno":null!==(o=e.jmeno)&&void 0!==o&&o.trim()&&"Neuvedeno"!==e.jmeno||(r.jmeno="".concat(Ja.jmeno," je povinn\xe9 - zkontrolujte sv\xe9 u\u017eivatelsk\xe9 \xfadaje"));break;case"email":null!==(i=e.email)&&void 0!==i&&i.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(r.email="E-mail m\xe1 neplatn\xfd form\xe1t - zkontrolujte, zda obsahuje @ a dom\xe9nu"):r.email="".concat(Ja.email," je povinn\xfd - zadejte platnou e-mailovou adresu");break;case"dodavatel_nazev":null!==(l=e.dodavatel_nazev)&&void 0!==l&&l.trim()||(r.dodavatel_nazev="".concat(Ja.dodavatel_nazev," je povinn\xfd - zadejte n\xe1zev firmy dodavatele"));break;case"dodavatel_adresa":null!==(c=e.dodavatel_adresa)&&void 0!==c&&c.trim()||(r.dodavatel_adresa="".concat(Ja.dodavatel_adresa," je povinn\xe1 - zadejte \xfaplnou adresu dodavatele"));break;case"dodavatel_ico":null!==(p=e.dodavatel_ico)&&void 0!==p&&p.trim()||(r.dodavatel_ico="".concat(Ja.dodavatel_ico," je povinn\xe9 - zadejte I\u010cO dodavatele (8 \u010d\xedslic)"));break;case"druh_objednavky_kod":null!==(u=e.druh_objednavky_kod)&&void 0!==u&&u.trim()||(r.druh_objednavky_kod="".concat(Ja.druh_objednavky_kod," je povinn\xfd - vyberte typ objedn\xe1vky"));break;case"polozky_objednavky":if(e.polozky_objednavky&&0!==e.polozky_objednavky.length){let n=!1;e.polozky_objednavky.forEach((e,a)=>{var o;null!==(o=e.popis)&&void 0!==o&&o.trim()||(r["polozka_".concat(a,"_popis")]="Polo\u017eka ".concat(a+1,": Vypl\u0148te n\xe1zev nebo popis polo\u017eky"),n=!0),(!e.cena_bez_dph||parseFloat(e.cena_bez_dph)<=0)&&(r["polozka_".concat(a,"_cena_bez_dph")]="Polo\u017eka ".concat(a+1,": Zadejte cenu bez DPH (mus\xed b\xfdt v\u011bt\u0161\xed ne\u017e 0)"),n=!0),(!e.cena_s_dph||parseFloat(e.cena_s_dph)<=0)&&(r["polozka_".concat(a,"_cena_s_dph")]="Polo\u017eka ".concat(a+1,": Zadejte cenu s DPH (mus\xed b\xfdt v\u011bt\u0161\xed ne\u017e 0)"),n=!0)}),n&&(r.polozky_objednavky="N\u011bkter\xe9 polo\u017eky obsahuj\xed chyby - zkontrolujte n\xe1zev a ceny v\u0161ech polo\u017eek")}else r.polozky_objednavky="".concat(Ja.polozky_objednavky," - p\u0159idejte alespo\u0148 jednu polo\u017eku s n\xe1zvem a cenou");break;case"dodavatel_kontakt":null!==(v=e.dodavatel_kontakt)&&void 0!==v&&v.trim()||(r.dodavatel_kontakt="".concat(Ja.dodavatel_kontakt," je povinn\xfd - zadejte e-mail nebo telefon na dodavatele"));break;case"druh_objednavky":null!==(_=e.druh_objednavky_kod)&&void 0!==_&&_.trim()||(r.druh_objednavky_kod="".concat(Ja.druh_objednavky_kod," je povinn\xfd - vyberte typ objedn\xe1vky"));break;case"financovani":case"zpusob_financovani":e.zpusob_financovani&&("string"!==typeof e.zpusob_financovani||e.zpusob_financovani.trim())||(r.zpusob_financovani="".concat(Ja.zpusob_financovani," je povinn\xfd - vyberte zdroj financov\xe1n\xed"));break;case"lp_kod":e.lp_kod&&(Array.isArray(e.lp_kod)?0!==e.lp_kod.length:"string"===typeof e.lp_kod?e.lp_kod.trim():e.lp_kod)||(r.lp_kod="".concat(Ja.lp_kod," je povinn\xfd - vyberte limitovan\xfd p\u0159\xedslib pro financov\xe1n\xed"));break;case"cislo_smlouvy":null!==(m=e.cislo_smlouvy)&&void 0!==m&&m.trim()||(r.cislo_smlouvy="".concat(Ja.cislo_smlouvy," je povinn\xe9 - zadejte eviden\u010dn\xed \u010d\xedslo smlouvy"));break;case"individualni_schvaleni":null!==(k=e.individualni_schvaleni)&&void 0!==k&&k.trim()||(r.individualni_schvaleni="".concat(Ja.individualni_schvaleni," je povinn\xfd - zadejte identifik\xe1tor schv\xe1len\xed"));break;case"pojistna_udalost_cislo":null!==(f=e.pojistna_udalost_cislo)&&void 0!==f&&f.trim()||(r.pojistna_udalost_cislo="".concat(Ja.pojistna_udalost_cislo," je povinn\xe9 - zadejte \u010d\xedslo pojistn\xe9 ud\xe1losti"))}}),"ZAMITNUTA"!==o||null!==(n=e.schvaleni_komentar)&&void 0!==n&&n.trim()||(r.schvaleni_komentar="".concat(Ja.schvaleni_komentar," - uve\u010fte d\u016fvod zam\xedtnut\xed objedn\xe1vky")),"neschvaleno"!==e.stav_schvaleni&&"ceka_se"!==e.stav_schvaleni||null!==(a=e.schvaleni_komentar)&&void 0!==a&&a.trim()||(r.schvaleni_komentar="neschvaleno"===e.stav_schvaleni?"".concat(Ja.schvaleni_komentar," - vysv\u011btlete, pro\u010d objedn\xe1vku neschvalujete"):"".concat(Ja.schvaleni_komentar," - uve\u010fte d\u016fvod odlo\u017een\xed schv\xe1len\xed")),e.stav_odeslani&&""!==e.stav_odeslani.trim())&&(null!==(l=e.datum_odeslani)&&void 0!==l&&l.trim()||(r.datum_odeslani="".concat(Ja.datum_odeslani," je povinn\xe9 p\u0159i vybran\xe9m stavu odesl\xe1n\xed")));e.stav_stornovano&&(null!==(c=e.odeslani_storno_duvod)&&void 0!==c&&c.trim()||(r.odeslani_storno_duvod="".concat(Ja.odeslani_storno_duvod," je povinn\xfd - uve\u010fte, pro\u010d objedn\xe1vku stornujete")));if(!0===e.ma_byt_zverejnena||1===e.ma_byt_zverejnena){const n=null===t||void 0===t?void 0:t.registr_smluv_vyplneni;(!n||n.visible&&!n.locked)&&(e.dt_zverejneni&&String(e.dt_zverejneni).trim()||(r.dt_zverejneni="Datum zve\u0159ejn\u011bn\xed je povinn\xe9 kdy\u017e m\xe1 b\xfdt objedn\xe1vka zve\u0159ejn\u011bna"),e.registr_iddt&&String(e.registr_iddt).trim()||(r.registr_iddt="Identifik\xe1tor IDDT je povinn\xfd kdy\u017e m\xe1 b\xfdt objedn\xe1vka zve\u0159ejn\u011bna"))}e.stav_fakturace&&""!==e.stav_fakturace.trim()&&(null!==(p=e.datum_fakturace)&&void 0!==p&&p.trim()||(r.datum_fakturace="".concat(Ja.datum_fakturace," je povinn\xe9 p\u0159i vybran\xe9m stavu fakturace")),null!==(u=e.cislo_faktury)&&void 0!==u&&u.trim()||(r.cislo_faktury="".concat(Ja.cislo_faktury," je povinn\xe9 - zadejte \u010d\xedslo p\u0159ijat\xe9 faktury")),(!e.fakturovana_cena_bez_dph||parseFloat(e.fakturovana_cena_bez_dph)<=0)&&(r.fakturovana_cena_bez_dph="".concat(Ja.fakturovana_cena_bez_dph," je povinn\xe1 a mus\xed b\xfdt v\u011bt\u0161\xed ne\u017e 0 - zadejte \u010d\xe1stku z faktury bez DPH")),(!e.fakturovana_cena_s_dph||parseFloat(e.fakturovana_cena_s_dph)<=0)&&(r.fakturovana_cena_s_dph="".concat(Ja.fakturovana_cena_s_dph," je povinn\xe1 a mus\xed b\xfdt v\u011bt\u0161\xed ne\u017e 0 - zadejte celkovou \u010d\xe1stku z faktury v\u010detn\u011b DPH")));return r},qa=function(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return{objednatel:!0,schvaleni:!0,financovani:!0,dodavatel:!0,kontakt:!0,detaily:!0,dodaci_podminky:!0,stav_odeslani:!0};const n=(e=>{const n=["objednatel","schvaleni"];switch(e){case"NOVA":case"ODESLANA_KE_SCHVALENI":case"ZAMITNUTA":default:return n;case"SCHVALENA":case"CEKA_POTVRZENI":case"POTVRZENA":case"DOKONCENA":return[...n,"financovani","dodavatel","kontakt","detaily","dodaci_podminky","stav_odeslani"];case"ZRUSENA":return[...n,"stav_odeslani"]}})(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"NOVA"),a={objednatel:n.includes("objednatel"),schvaleni:n.includes("schvaleni")},o={financovani:n.includes("financovani"),dodavatel:e>=2&&n.includes("dodavatel"),kontakt:e>=2&&n.includes("kontakt"),detaily:e>=2&&n.includes("detaily"),dodaci_podminky:e>=2&&n.includes("dodaci_podminky"),stav_odeslani:e>=2&&n.includes("stav_odeslani")};return(0,t.A)((0,t.A)({},a),o)};var Ya=a(1574),Xa=a(54153);const Qa="LOADING_DICTIONARIES",eo="READY_FOR_DATA",no="LOADING_DATA",ao="DATA_LOADED",oo="READY",to="ERROR",ro={phase:"MOUNTING",isInitializing:!0,isLoadingDictionaries:!1,isLoadingFormData:!1,isReady:!1,error:null,startTime:Date.now(),phaseHistory:[]},io="START_DICTIONARIES_LOAD",so="DICTIONARIES_LOADED",lo="START_DATA_LOAD",co="DATA_LOADED",po="READY",uo="ERROR",vo="RESET",_o=(e,n)=>{const a=n=>[...e.phaseHistory,{phase:n,timestamp:Date.now()}];switch(n.type){case io:return(0,t.A)((0,t.A)({},e),{},{phase:Qa,isLoadingDictionaries:!0,phaseHistory:a(Qa)});case so:return(0,t.A)((0,t.A)({},e),{},{phase:eo,isLoadingDictionaries:!1,phaseHistory:a(eo)});case lo:return(0,t.A)((0,t.A)({},e),{},{phase:no,isLoadingFormData:!0,phaseHistory:a(no)});case co:return(0,t.A)((0,t.A)({},e),{},{phase:ao,isLoadingFormData:!1,phaseHistory:a(ao)});case po:return(0,t.A)((0,t.A)({},e),{},{phase:oo,isInitializing:!1,isReady:!0,phaseHistory:a(oo)});case uo:return(0,t.A)((0,t.A)({},e),{},{phase:to,error:n.payload,isInitializing:!1,isLoadingDictionaries:!1,isLoadingFormData:!1,phaseHistory:a(to)});case vo:return(0,t.A)((0,t.A)({},ro),{},{startTime:Date.now()});default:return e}},mo={data:{allUsers:[],approvers:[],strediskaOptions:[],financovaniOptions:[],druhyObjednavkyOptions:[],druhyObjednavkyRawData:null,lpKodyOptions:[],prilohyTypyOptions:[],typyFakturOptions:[],stavyWorkflowMap:{}},loading:{users:!1,approvers:!1,strediska:!1,financovani:!1,druhy:!1,lpKody:!1,prilohyTypy:!1,typyFaktur:!1,stavyWorkflow:!1},errors:{users:null,approvers:null,strediska:null,financovani:null,druhy:null,lpKody:null,prilohyTypy:null,typyFaktur:null,stavyWorkflow:null},isReady:!1,loadedCount:0,totalToLoad:9},ko="START_LOADING",fo="SET_USERS",ho="SET_APPROVERS",yo="SET_STREDISKA",bo="SET_FINANCOVANI",go="SET_DRUHY",xo="SET_LP_KODY",jo="SET_PRILOHY_TYPY",zo="SET_TYPY_FAKTUR",Ao="SET_STAVY_WORKFLOW",wo="SET_ERROR",So="ALL_LOADED",Eo="RESET",Co=(e,n)=>{switch(n.type){case ko:return(0,t.A)((0,t.A)({},e),{},{loading:(0,t.A)((0,t.A)({},e.loading),{},{[n.payload.key]:!0}),errors:(0,t.A)((0,t.A)({},e.errors),{},{[n.payload.key]:null})});case fo:return(0,t.A)((0,t.A)({},e),{},{data:(0,t.A)((0,t.A)({},e.data),{},{allUsers:n.payload}),loading:(0,t.A)((0,t.A)({},e.loading),{},{users:!1}),loadedCount:e.loadedCount+1});case ho:return(0,t.A)((0,t.A)({},e),{},{data:(0,t.A)((0,t.A)({},e.data),{},{approvers:n.payload}),loading:(0,t.A)((0,t.A)({},e.loading),{},{approvers:!1}),loadedCount:e.loadedCount+1});case yo:return(0,t.A)((0,t.A)({},e),{},{data:(0,t.A)((0,t.A)({},e.data),{},{strediskaOptions:n.payload}),loading:(0,t.A)((0,t.A)({},e.loading),{},{strediska:!1}),loadedCount:e.loadedCount+1});case bo:return(0,t.A)((0,t.A)({},e),{},{data:(0,t.A)((0,t.A)({},e.data),{},{financovaniOptions:n.payload}),loading:(0,t.A)((0,t.A)({},e.loading),{},{financovani:!1}),loadedCount:e.loadedCount+1});case go:return(0,t.A)((0,t.A)({},e),{},{data:(0,t.A)((0,t.A)({},e.data),{},{druhyObjednavkyOptions:n.payload.options,druhyObjednavkyRawData:n.payload.rawData}),loading:(0,t.A)((0,t.A)({},e.loading),{},{druhy:!1}),loadedCount:e.loadedCount+1});case xo:return(0,t.A)((0,t.A)({},e),{},{data:(0,t.A)((0,t.A)({},e.data),{},{lpKodyOptions:n.payload}),loading:(0,t.A)((0,t.A)({},e.loading),{},{lpKody:!1}),loadedCount:e.loadedCount+1});case jo:return(0,t.A)((0,t.A)({},e),{},{data:(0,t.A)((0,t.A)({},e.data),{},{prilohyTypyOptions:n.payload}),loading:(0,t.A)((0,t.A)({},e.loading),{},{prilohyTypy:!1}),loadedCount:e.loadedCount+1});case zo:return(0,t.A)((0,t.A)({},e),{},{data:(0,t.A)((0,t.A)({},e.data),{},{typyFakturOptions:n.payload}),loading:(0,t.A)((0,t.A)({},e.loading),{},{typyFaktur:!1}),loadedCount:e.loadedCount+1});case Ao:return(0,t.A)((0,t.A)({},e),{},{data:(0,t.A)((0,t.A)({},e.data),{},{stavyWorkflowMap:n.payload}),loading:(0,t.A)((0,t.A)({},e.loading),{},{stavyWorkflow:!1}),loadedCount:e.loadedCount+1});case wo:return(0,t.A)((0,t.A)({},e),{},{loading:(0,t.A)((0,t.A)({},e.loading),{},{[n.payload.key]:!1}),errors:(0,t.A)((0,t.A)({},e.errors),{},{[n.payload.key]:n.payload.error})});case So:return(0,t.A)((0,t.A)({},e),{},{isReady:!0});case Eo:return mo;default:return e}},Oo={modals:{cancelConfirm:!1,supplierSearch:!1,aresPopup:!1,templateSave:!1,templateDeleteConfirm:!1,icoCheck:!1,saveProgress:!1,addFaktura:!1,unlockPhase1Confirm:!1,unlockPhase2Confirm:!1,unlockRegistrConfirm:!1,unlockFakturaceConfirm:!1,unlockVecnaSpravnostConfirm:!1,unlockDokonceniConfirm:!1},dropdowns:{template:!1},sections:{collapsed:{},locked:{}},selectStates:{},searchStates:{},fullscreen:!1,areSectionsCollapsed:!1,debug:{visible:!1,pinned:!1},saveProgress:{visible:!1,value:0,text:""},icoCheckStatus:null,icoCheckData:null,dragOver:!1},No="OPEN_MODAL",Do="CLOSE_MODAL",To="CLOSE_ALL_MODALS",Io="TOGGLE_DROPDOWN",Po="CLOSE_ALL_DROPDOWNS",Ro="COLLAPSE_SECTION",Lo="EXPAND_SECTION",Vo="TOGGLE_SECTION",Fo="COLLAPSE_ALL_SECTIONS",Mo="EXPAND_ALL_SECTIONS",Uo="LOCK_SECTION",Zo="UNLOCK_SECTION",Ko="SET_SELECT_STATE",Bo="SET_SEARCH_STATE",Wo="TOGGLE_FULLSCREEN",Ho="SET_FULLSCREEN",$o="TOGGLE_DEBUG",Jo="PIN_DEBUG",Go="SET_SAVE_PROGRESS",qo="SHOW_SAVE_PROGRESS",Yo="HIDE_SAVE_PROGRESS",Xo="SET_ICO_CHECK_STATUS",Qo="SET_ICO_CHECK_DATA",et="SET_DRAG_OVER",nt="RESET",at=(e,n)=>{switch(n.type){case No:return(0,t.A)((0,t.A)({},e),{},{modals:(0,t.A)((0,t.A)({},e.modals),{},{[n.payload]:!0})});case Do:return(0,t.A)((0,t.A)({},e),{},{modals:(0,t.A)((0,t.A)({},e.modals),{},{[n.payload]:!1})});case To:const a={};return Object.keys(e.modals).forEach(e=>{a[e]=!1}),(0,t.A)((0,t.A)({},e),{},{modals:a});case Io:return(0,t.A)((0,t.A)({},e),{},{dropdowns:(0,t.A)((0,t.A)({},e.dropdowns),{},{[n.payload]:!e.dropdowns[n.payload]})});case Po:const o={};return Object.keys(e.dropdowns).forEach(e=>{o[e]=!1}),(0,t.A)((0,t.A)({},e),{},{dropdowns:o});case Ro:return(0,t.A)((0,t.A)({},e),{},{sections:(0,t.A)((0,t.A)({},e.sections),{},{collapsed:(0,t.A)((0,t.A)({},e.sections.collapsed),{},{[n.payload]:!0})})});case Lo:return(0,t.A)((0,t.A)({},e),{},{sections:(0,t.A)((0,t.A)({},e.sections),{},{collapsed:(0,t.A)((0,t.A)({},e.sections.collapsed),{},{[n.payload]:!1})})});case Vo:return(0,t.A)((0,t.A)({},e),{},{sections:(0,t.A)((0,t.A)({},e.sections),{},{collapsed:(0,t.A)((0,t.A)({},e.sections.collapsed),{},{[n.payload]:!e.sections.collapsed[n.payload]})})});case Fo:return(0,t.A)((0,t.A)({},e),{},{areSectionsCollapsed:!0});case Mo:return(0,t.A)((0,t.A)({},e),{},{areSectionsCollapsed:!1});case Uo:return(0,t.A)((0,t.A)({},e),{},{sections:(0,t.A)((0,t.A)({},e.sections),{},{locked:(0,t.A)((0,t.A)({},e.sections.locked),{},{[n.payload]:!0})})});case Zo:return(0,t.A)((0,t.A)({},e),{},{sections:(0,t.A)((0,t.A)({},e.sections),{},{locked:(0,t.A)((0,t.A)({},e.sections.locked),{},{[n.payload]:!1})})});case Ko:return(0,t.A)((0,t.A)({},e),{},{selectStates:(0,t.A)((0,t.A)({},e.selectStates),{},{[n.payload.key]:n.payload.value})});case Bo:return(0,t.A)((0,t.A)({},e),{},{searchStates:(0,t.A)((0,t.A)({},e.searchStates),{},{[n.payload.key]:n.payload.value})});case Wo:return(0,t.A)((0,t.A)({},e),{},{fullscreen:!e.fullscreen});case Ho:return(0,t.A)((0,t.A)({},e),{},{fullscreen:n.payload});case $o:return(0,t.A)((0,t.A)({},e),{},{debug:(0,t.A)((0,t.A)({},e.debug),{},{visible:!e.debug.visible})});case Jo:return(0,t.A)((0,t.A)({},e),{},{debug:(0,t.A)((0,t.A)({},e.debug),{},{pinned:n.payload})});case Go:return(0,t.A)((0,t.A)({},e),{},{saveProgress:(0,t.A)((0,t.A)({},e.saveProgress),{},{value:n.payload.value,text:n.payload.text})});case qo:return(0,t.A)((0,t.A)({},e),{},{saveProgress:(0,t.A)((0,t.A)({},e.saveProgress),{},{visible:!0})});case Yo:return(0,t.A)((0,t.A)({},e),{},{saveProgress:(0,t.A)((0,t.A)({},e.saveProgress),{},{visible:!1})});case Xo:return(0,t.A)((0,t.A)({},e),{},{icoCheckStatus:n.payload});case Qo:return(0,t.A)((0,t.A)({},e),{},{icoCheckData:n.payload});case et:return(0,t.A)((0,t.A)({},e),{},{dragOver:n.payload});case nt:return Oo;default:return e}};"undefined"!==typeof window&&(window.__orderFormCurrentInstanceId||(window.__orderFormCurrentInstanceId=null),window.__orderFormInitInProgress||(window.__orderFormInitInProgress=!1));const ot=e=>{let{token:n,username:a,userId:o,editOrderId:r,archivovanoParam:s,onDataLoaded:d,onError:l,onReady:c}=e;const p=(()=>{const[e,n]=(0,i.useReducer)(_o,ro),a=(0,i.useCallback)(()=>{n({type:io})},[]),o=(0,i.useCallback)(()=>{n({type:so})},[]),t=(0,i.useCallback)(()=>{n({type:lo})},[]),r=(0,i.useCallback)(()=>{n({type:co})},[]),s=(0,i.useCallback)(()=>{n({type:po})},[]),d=(0,i.useCallback)(e=>{n({type:uo,payload:e})},[]),l=(0,i.useCallback)(()=>{n({type:vo})},[]);return{phase:e.phase,isInitializing:e.isInitializing,isLoadingDictionaries:e.isLoadingDictionaries,isLoadingFormData:e.isLoadingFormData,isReady:e.isReady,error:e.error,phaseHistory:e.phaseHistory,startDictionariesLoad:a,dictionariesLoaded:o,startDataLoad:t,dataLoaded:r,setReady:s,setError:d,reset:l,isInPhase:n=>e.phase===n,canLoadData:()=>e.phase===eo}})(),u=(e=>{let{token:n,username:a,enabled:o=!0}=e;const[r,s]=(0,i.useReducer)(Co,mo),d=(0,i.useRef)(!1),l=(0,i.useRef)(null),c=(0,i.useRef)(null),p=(0,i.useRef)(null),u=(0,i.useCallback)(async()=>{if(!n||!a)return!1;if(d.current)return c.current;d.current=!0;const e=!1;c.current||(c.current=new Promise(e=>{l.current=e}));try{const o=await Promise.allSettled([(async()=>{if(e)return{key:"users",success:!1,cancelled:!0};try{s({type:ko,payload:{key:"users"}});const o=await(0,me.Ym)({token:n,username:a});return e?{key:"users",success:!1,cancelled:!0}:(s({type:fo,payload:o||[]}),{key:"users",success:!0})}catch(o){return"AbortError"===o.name||e?{key:"users",success:!1,cancelled:!0}:(s({type:wo,payload:{key:"users",error:o.message}}),{key:"users",success:!1,error:o})}})(),(async()=>{if(e)return{key:"approvers",success:!1,cancelled:!0};try{s({type:ko,payload:{key:"approvers"}});const o=await(0,me.lF)({token:n,username:a});return e?{key:"approvers",success:!1,cancelled:!0}:(s({type:ho,payload:o||[]}),{key:"approvers",success:!0})}catch(o){return"AbortError"===o.name||e?{key:"approvers",success:!1,cancelled:!0}:(s({type:wo,payload:{key:"approvers",error:o.message}}),{key:"approvers",success:!1,error:o})}})(),(async()=>{if(e)return{key:"strediska",success:!1,cancelled:!0};try{s({type:ko,payload:{key:"strediska"}});const o=await(0,Ta.CR)({token:n,username:a});return e?{key:"strediska",success:!1,cancelled:!0}:(s({type:yo,payload:o||[]}),{key:"strediska",success:!0})}catch(o){return"AbortError"===o.name||e?{key:"strediska",success:!1,cancelled:!0}:(s({type:wo,payload:{key:"strediska",error:o.message}}),{key:"strediska",success:!1,error:o})}})(),(async()=>{if(e)return{key:"financovani",success:!1,cancelled:!0};try{s({type:ko,payload:{key:"financovani"}});const o=await(0,Ta.hP)({token:n,username:a});return e?{key:"financovani",success:!1,cancelled:!0}:(s({type:bo,payload:o||[]}),{key:"financovani",success:!0})}catch(o){return"AbortError"===o.name||e?{key:"financovani",success:!1,cancelled:!0}:(s({type:wo,payload:{key:"financovani",error:o.message}}),{key:"financovani",success:!1,error:o})}})(),(async()=>{if(e)return{key:"druhy",success:!1,cancelled:!0};try{s({type:ko,payload:{key:"druhy"}});const o=await(0,Ta.je)({token:n,username:a});return e?{key:"druhy",success:!1,cancelled:!0}:(s({type:go,payload:{options:o||[],rawData:o}}),{key:"druhy",success:!0})}catch(o){return"AbortError"===o.name||e?{key:"druhy",success:!1,cancelled:!0}:(s({type:wo,payload:{key:"druhy",error:o.message}}),{key:"druhy",success:!1,error:o})}})(),(async()=>{if(e)return{key:"lpKody",success:!1,cancelled:!0};try{s({type:ko,payload:{key:"lpKody"}});const o=await(0,me.Hy)({token:n,username:a});return e?{key:"lpKody",success:!1,cancelled:!0}:(s({type:xo,payload:o||[]}),{key:"lpKody",success:!0})}catch(o){return"AbortError"===o.name||e?{key:"lpKody",success:!1,cancelled:!0}:(s({type:wo,payload:{key:"lpKody",error:o.message}}),{key:"lpKody",success:!1,error:o})}})(),(async()=>{if(e)return{key:"prilohyTypy",success:!1,cancelled:!0};try{s({type:ko,payload:{key:"prilohyTypy"}});const o=await(0,Ta.iH)({token:n,username:a});return e?{key:"prilohyTypy",success:!1,cancelled:!0}:(s({type:jo,payload:o||[]}),{key:"prilohyTypy",success:!0})}catch(o){return"AbortError"===o.name||e?{key:"prilohyTypy",success:!1,cancelled:!0}:(s({type:wo,payload:{key:"prilohyTypy",error:o.message}}),{key:"prilohyTypy",success:!1,error:o})}})(),(async()=>{if(e)return{key:"typyFaktur",success:!1,cancelled:!0};try{s({type:ko,payload:{key:"typyFaktur"}});const o=await(0,Ta.Zz)({token:n,username:a});return e?{key:"typyFaktur",success:!1,cancelled:!0}:(s({type:zo,payload:o||[]}),{key:"typyFaktur",success:!0})}catch(o){return"AbortError"===o.name||e?{key:"typyFaktur",success:!1,cancelled:!0}:(s({type:wo,payload:{key:"typyFaktur",error:o.message}}),{key:"typyFaktur",success:!1,error:o})}})(),(async()=>{if(e)return{key:"stavyWorkflow",success:!1,cancelled:!0};try{s({type:ko,payload:{key:"stavyWorkflow"}});const o=await(0,Ta.IA)({token:n,username:a});return e?{key:"stavyWorkflow",success:!1,cancelled:!0}:(s({type:Ao,payload:o||{}}),{key:"stavyWorkflow",success:!0})}catch(o){return"AbortError"===o.name||e?{key:"stavyWorkflow",success:!1,cancelled:!0}:(s({type:wo,payload:{key:"stavyWorkflow",error:o.message}}),{key:"stavyWorkflow",success:!1,error:o})}})()]);return o.filter(e=>"fulfilled"===e.status&&e.value.success&&!e.value.cancelled).length,o.filter(e=>"rejected"===e.status||"fulfilled"===e.status&&!e.value.success&&!e.value.cancelled).length,o.filter(e=>"fulfilled"===e.status&&e.value.cancelled).length,o.forEach((e,n)=>{"fulfilled"===e.status&&e.value.cancelled}),!o.some(e=>"fulfilled"===e.status&&e.value.cancelled&&("users"===e.value.key||"approvers"===e.value.key))&&(s({type:So}),l.current&&l.current(!0),!0)}catch(o){return l.current&&l.current(!1),!1}finally{d.current=!1}},[n,a]),v=(0,i.useRef)();return v.current=u,(0,i.useEffect)(()=>{o&&n&&a&&!r.isReady&&!d.current&&v.current()},[o,n,a,r.isReady]),(0,i.useEffect)(()=>()=>{},[]),(0,t.A)((0,t.A)({},r),{},{loadAll:u,abort:()=>{p.current&&p.current.abort()},readyPromise:c.current})})({token:n,username:a,enabled:!0}),v=(e=>{let{token:n,username:a,dictionaries:o}=e;const[r,s]=(0,i.useState)(!1),[d,l]=(0,i.useState)(null),c=(0,i.useRef)(!1),p=(0,i.useCallback)(e=>{if(!e)return null;const n=e.titul_pred||"",a=e.jmeno||"",o=e.prijmeni||"",t=e.titul_za||"";return{displayName:"".concat(n?n+" ":"").concat(a," ").concat(o).concat(t?", "+t:"").trim(),email:e.email||"",telefon:e.telefon||""}},[]),u=(0,i.useCallback)((e,n)=>{var a,o,r,i;if(!e)return null;let s={};if(e.objednatel_id){var d,l;if(null!==(d=e._enriched)&&void 0!==d&&d.objednatel){const n=p(e._enriched.objednatel);n&&(s={jmeno:n.displayName,email:n.email,telefon:n.telefon})}if(!s.jmeno&&null!==n&&void 0!==n&&null!==(l=n.data)&&void 0!==l&&l.allUsers){const a=n.data.allUsers.find(n=>n.id&&n.id===e.objednatel_id||n.user_id&&n.user_id===e.objednatel_id);if(a){const e=a.titul_pred?a.titul_pred+" ":"",n=a.jmeno||"",o=a.prijmeni||"",t=a.titul_za?", "+a.titul_za:"";s={jmeno:"".concat(e).concat(n," ").concat(o).concat(t).replace(/\s+/g," ").trim()||a.username||"",email:a.email||"",telefon:a.telefon||""}}}}const c=Array.isArray(e.strediska_kod)?e.strediska_kod.map(e=>String(e).toUpperCase()):null!==(v=e._enriched)&&void 0!==v&&v.strediska&&Array.isArray(e._enriched.strediska)?e._enriched.strediska.map(e=>e.kod.toUpperCase()):[],u=(()=>{if(e.financovani&&"object"===typeof e.financovani)return e.financovani.typ||"";if(e.financovani&&"string"===typeof e.financovani)try{const n=JSON.parse(e.financovani);return n.typ||n.kod_stavu||""}catch(n){return e.zpusob_financovani||""}return e.zpusob_financovani||""})();var v;let _={};e.financovani&&"object"===typeof e.financovani&&(_={lp_kod:e.financovani.lp_kody||[],lp_nazev:e.financovani.nazev||"",paragraf:e.financovani.paragraf||"",polozka:e.financovani.polozka||"",investice:e.financovani.investice||"",cislo_smlouvy:e.cislo_smlouvy||e.financovani.cislo_smlouvy||"",smlouva_poznamka:e.smlouva_poznamka||e.financovani.smlouva_poznamka||""});const m=e.individualni_schvaleni?String(e.individualni_schvaleni):null!==(a=e.financovani)&&void 0!==a&&a.individualni_schvaleni?String(e.financovani.individualni_schvaleni):"",k=e.individualni_poznamka||(null===(o=e.financovani)||void 0===o?void 0:o.individualni_poznamka)||"",f=e.pojistna_udalost_cislo||(null===(r=e.financovani)||void 0===r?void 0:r.pojistna_udalost_cislo)||"",h=e.pojistna_udalost_poznamka||(null===(i=e.financovani)||void 0===i?void 0:i.pojistna_udalost_poznamka)||"",y="string"===typeof e.druh_objednavky_kod?e.druh_objednavky_kod:e.druh_objednavky_kod&&"object"===typeof e.druh_objednavky_kod&&(e.druh_objednavky_kod.kod_stavu||e.druh_objednavky_kod.kod)||"",b=(()=>{try{const n=Array.isArray(e.stav_workflow_kod)?e.stav_workflow_kod:JSON.parse(e.stav_workflow_kod||'["NOVA"]');if(!Array.isArray(n)||0===n.length)return"Nov\xe1";const a=n[n.length-1],o=Ha[a];return o?o.name:a||"Nov\xe1"}catch(n){return"Nov\xe1"}})(),g=(0,t.A)((0,t.A)((0,t.A)((0,t.A)({},e),s),{},{id:e.id,ev_cislo:e.cislo_objednavky||e.ev_cislo,stav_workflow_kod:e.stav_workflow_kod||"NOVA",stav_objednavky:b,mimoradna_udalost:e.mimoradna_udalost||!1,stav_odeslano:(()=>{try{const n=Array.isArray(e.stav_workflow_kod)?e.stav_workflow_kod:JSON.parse(e.stav_workflow_kod||"[]"),a=Array.isArray(n)&&n.includes("ODESLANA"),o=!!e.dt_odeslani,t=!!e.odesilatel_id;return a&&o&&t}catch(n){return!1}})(),stav_stornovano:(()=>{try{const n=Array.isArray(e.stav_workflow_kod)?e.stav_workflow_kod:JSON.parse(e.stav_workflow_kod||"[]");return Array.isArray(n)&&n.includes("STORNOVANA")}catch(n){return!1}})(),stav_schvaleni:(()=>{try{const n=Array.isArray(e.stav_workflow_kod)?e.stav_workflow_kod:JSON.parse(e.stav_workflow_kod||"[]");return Array.isArray(n)?n.includes("SCHVALENA")?"schvaleno":n.includes("ZAMITNUTA")?"neschvaleno":n.includes("CEKA_SE")?"ceka_se":"":""}catch(n){return""}})(),datum_odeslani:e.dt_odeslani||e.dt_odeslano?(e.dt_odeslani||e.dt_odeslano).split(" ")[0]:"",datum_storna:e.dt_odeslani||e.dt_odeslano?(e.dt_odeslani||e.dt_odeslano).split(" ")[0]:"",dt_akceptace:e.dt_akceptace?e.dt_akceptace.split(" ")[0]:"",datum_vytvoreni:e.dt_vytvoreni?e.dt_vytvoreni.split(" ")[0]:"",datum_splatnosti:e.dt_splatnost?e.dt_splatnost.split(" ")[0]:"",temp_datum_objednavky:e.datum_objednavky?e.datum_objednavky.split(" ")[0]:e.dt_objednavky?e.dt_objednavky.split(" ")[0]:"",odesilatel_id:e.odesilatel_id||null,dodavatel_potvrdil_id:e.dodavatel_potvrdil_id||null,zverejnil_id:e.zverejnil_id||null,dt_zverejneni_potvrzeni:e.dt_zverejneni_potvrzeni?e.dt_zverejneni_potvrzeni.split(" ")[0]:"",potvrdil_vecnou_spravnost_id:e.potvrdil_vecnou_spravnost_id||null,dt_potvrzeni_vecne_spravnosti:e.dt_potvrzeni_vecne_spravnosti||"",potvrzeni_vecne_spravnosti:(()=>{const n=e.potvrzeni_vecne_spravnosti;return"boolean"===typeof n?n?1:0:"number"===typeof n?n:"string"===typeof n&&parseInt(n,10)||0})(),vecna_spravnost_umisteni_majetku:e.vecna_spravnost_umisteni_majetku||"",vecna_spravnost_poznamka:e.vecna_spravnost_poznamka||"",fakturant_id:e.fakturant_id||null,dt_faktura_pridana:e.dt_faktura_pridana||"",dokoncil_id:e.dokoncil_id||null,dt_dokonceni:e.dt_dokonceni||"",dokonceni_poznamka:e.dokonceni_poznamka||"",potvrzeni_dokonceni_objednavky:(()=>{const n=e.potvrzeni_dokonceni_objednavky;return"boolean"===typeof n?n?1:0:"number"===typeof n?n:"string"===typeof n&&parseInt(n,10)||0})(),strediska_kod:c,zpusob_financovani:u},_),{},{individualni_schvaleni:m,individualni_poznamka:k,pojistna_udalost_cislo:f,pojistna_udalost_poznamka:h,druh_objednavky_kod:y,polozky_objednavky:Array.isArray(e.polozky)?e.polozky:[],faktury:Array.isArray(e.faktury)?e.faktury.map(e=>(0,t.A)((0,t.A)({},e),{},{fa_dorucena:e.fa_datum_doruceni?1:0,fa_splatnost:e.fa_datum_splatnosti?e.fa_datum_splatnosti.split(" ")[0]:"",fa_datum_doruceni:e.fa_datum_doruceni,fa_datum_splatnosti:e.fa_datum_splatnosti,fa_datum_vystaveni:e.fa_datum_vystaveni})):[],dodavatel_zpusob_potvrzeni:(()=>{try{const n=!(!e.dt_akceptace||!e.dodavatel_potvrdil_id);if(!e.dodavatel_zpusob_potvrzeni||""===e.dodavatel_zpusob_potvrzeni||"string"===typeof e.dodavatel_zpusob_potvrzeni&&""===e.dodavatel_zpusob_potvrzeni.trim())return n?{potvrzeni:"ANO",zpusoby:[],platba:"faktura"}:{potvrzeni:"NE",zpusoby:[],platba:"faktura"};if("object"===typeof e.dodavatel_zpusob_potvrzeni){const a=e.dodavatel_zpusob_potvrzeni;return{potvrzeni:(void 0!==a.potvrzeno?a.potvrzeno:n)?"ANO":"NE",zpusoby:a.zpusoby||a.zpusob||a.zpusob_potvrzeni||[],platba:"faktura"}}if("string"===typeof e.dodavatel_zpusob_potvrzeni){const a=e.dodavatel_zpusob_potvrzeni.trim();if(0===a.length)return{potvrzeni:"NE",zpusoby:[],platba:""};const o=JSON.parse(a);return{potvrzeni:(void 0!==o.potvrzeno?o.potvrzeno:n)?"ANO":"NE",zpusoby:o.zpusoby||o.zpusob||o.zpusob_potvrzeni||[],platba:"faktura"}}return{potvrzeni:"NE",zpusoby:[],platba:"faktura"}}catch(n){return{potvrzeni:"NE",zpusoby:[],platba:""}}})()}),x=Array.isArray(g.stav_workflow_kod)?g.stav_workflow_kod:g.stav_workflow_kod?[g.stav_workflow_kod]:[];return"ARCHIVOVANO"===e.stav_objednavky||"Archivov\xe1no"===e.stav_objednavky||x.includes("ARCHIVOVANO")?(g.stav_workflow_kod=["ARCHIVOVANO"],g.stav_objednavky="Archivov\xe1no",g.stav_odeslano=!0,g.stav_schvaleni="schvaleno",(g.ma_byt_zverejnena||1===g.ma_byt_zverejnena)&&(g.dt_zverejneni=g.dt_zverejneni||(new Date).toISOString().split("T")[0]),g.potvrzeni_vecne_spravnosti=1,0===g.prikazce_id||null===g.prikazce_id||""===g.prikazce_id?g.prikazce_id="0":g.prikazce_id&&(g.prikazce_id=String(g.prikazce_id)),0===g.schvalovatel_id||null===g.schvalovatel_id||""===g.schvalovatel_id?g.schvalovatel_id="0":g.schvalovatel_id&&(g.schvalovatel_id=String(g.schvalovatel_id))):(null!==g.prikazce_id&&void 0!==g.prikazce_id&&""!==g.prikazce_id&&(g.prikazce_id=String(g.prikazce_id)),null!==g.schvalovatel_id&&void 0!==g.schvalovatel_id&&""!==g.schvalovatel_id&&(g.schvalovatel_id=String(g.schvalovatel_id))),g},[p]);return{loading:r,error:d,loadOrderForEdit:(0,i.useCallback)(async e=>{let{orderId:t,archivovano:r=0}=e;if(!n||!a)throw console.error("\u274c [useOrderDataLoader] Missing token or username!"),new Error("Missing token or username");if(c.current)return null;c.current=!0,s(!0),l(null);try{const e=await(0,Ia.Hj)(t,n,a,!0);if(!e)throw console.error("\u274c [useOrderDataLoader] dbOrder is null!"),new Error("Order ".concat(t," not found"));return u(e,o)}catch(i){throw console.error("\u274c [useOrderDataLoader] Error in loadOrderForEdit:",i),l(i.message),i}finally{s(!1),c.current=!1}},[n,a,o,u]),loadOrderForCopy:(0,i.useCallback)(async e=>{let{orderId:r,archivovano:i=0,userId:d}=e;if(!n||!a)throw new Error("Missing token or username");if(c.current)return null;c.current=!0,s(!0),l(null);try{const e=await(0,Ia.Hj)(r,n,a,!0);if(!e)throw new Error("Order ".concat(r," not found"));const i=await(0,Ia.XY)(n,a),s=(null===i||void 0===i?void 0:i.order_number_string)||(null===i||void 0===i?void 0:i.next_order_string)||(null===i||void 0===i?void 0:i.next_number);if(!s)throw new Error("Failed to get new order number");const l=u(e,o);return{data:(0,t.A)((0,t.A)({},l),{},{id:null,objednavka_id:null,ev_cislo:s,temp_datum_objednavky:(new Date).toISOString().split("T")[0],stav_workflow_kod:"NOVA",schvalovatel_id:"",dt_schvaleni:"",schvaleni_komentar:"",datum_vytvoreni:"",datum_posledni_zmeny:"",vytvoril_uzivatel_id:d,uzivatel_id:d,stav_odeslano:!1,datum_odeslani:"",stav_stornovano:!1,datum_storna:"",prilohy_dokumenty:[],faktury:[]}),sourceOrderId:r}}catch(p){throw l(p.message),p}finally{s(!1),c.current=!1}},[n,a,o,u])}})({token:n,username:a,dictionaries:u}),_=(()=>{const[e,n]=(0,i.useReducer)(at,Oo),a=(0,i.useCallback)(e=>{n({type:No,payload:e})},[]),o=(0,i.useCallback)(e=>{n({type:Do,payload:e})},[]),t=(0,i.useCallback)(()=>{n({type:To})},[]),r=(0,i.useCallback)(e=>{n({type:Io,payload:e})},[]),s=(0,i.useCallback)(()=>{n({type:Po})},[]),d=(0,i.useCallback)(e=>{n({type:Ro,payload:e})},[]),l=(0,i.useCallback)(e=>{n({type:Lo,payload:e})},[]),c=(0,i.useCallback)(e=>{n({type:Vo,payload:e})},[]),p=(0,i.useCallback)(()=>{n({type:Fo})},[]),u=(0,i.useCallback)(()=>{n({type:Mo})},[]),v=(0,i.useCallback)(e=>{n({type:Uo,payload:e})},[]),_=(0,i.useCallback)(e=>{n({type:Zo,payload:e})},[]),m=(0,i.useCallback)((e,a)=>{n({type:Ko,payload:{key:e,value:a}})},[]),k=(0,i.useCallback)((e,a)=>{n({type:Bo,payload:{key:e,value:a}})},[]),f=(0,i.useCallback)(()=>{n({type:Wo})},[]),h=(0,i.useCallback)(e=>{n({type:Ho,payload:e})},[]),y=(0,i.useCallback)(()=>{n({type:$o})},[]),b=(0,i.useCallback)(e=>{n({type:Jo,payload:e})},[]),g=(0,i.useCallback)((e,a)=>{n({type:Go,payload:{value:e,text:a}})},[]),x=(0,i.useCallback)(()=>{n({type:qo})},[]),j=(0,i.useCallback)(()=>{n({type:Yo})},[]),z=(0,i.useCallback)(e=>{n({type:Xo,payload:e})},[]),A=(0,i.useCallback)(e=>{n({type:Qo,payload:e})},[]),w=(0,i.useCallback)(e=>{n({type:et,payload:e})},[]),S=(0,i.useCallback)(()=>{n({type:nt})},[]);return{modals:e.modals,dropdowns:e.dropdowns,sections:e.sections,selectStates:e.selectStates,searchStates:e.searchStates,fullscreen:e.fullscreen,areSectionsCollapsed:e.areSectionsCollapsed,debug:e.debug,saveProgress:e.saveProgress,icoCheckStatus:e.icoCheckStatus,icoCheckData:e.icoCheckData,dragOver:e.dragOver,openModal:a,closeModal:o,closeAllModals:t,toggleDropdown:r,closeAllDropdowns:s,collapseSection:d,expandSection:l,toggleSection:c,collapseAllSections:p,expandAllSections:u,lockSection:v,unlockSection:_,setSelectState:m,setSearchState:k,toggleFullscreen:f,setFullscreen:h,toggleDebug:y,pinDebug:b,setSaveProgress:g,showSaveProgress:x,hideSaveProgress:j,setIcoCheckStatus:z,setIcoCheckData:A,setDragOver:w,reset:S}})(),m=(0,i.useRef)("form_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))),k=(0,i.useRef)(!1),f=(0,i.useRef)(!1),h=(0,i.useRef)(!1),y=(0,i.useRef)(!0),b=(0,i.useRef)(!1),g=(0,i.useRef)(),x=(0,i.useRef)(),j=(0,i.useRef)(),z=(0,i.useRef)(),A=(0,i.useRef)(),w=(0,i.useRef)();return g.current=p,x.current=u,j.current=v,z.current=d,A.current=l,w.current=c,(0,i.useEffect)(()=>{const e=m.current;return()=>{const n=window.__orderFormInitInProgress&&window.__orderFormCurrentInstanceId===e,a=Date.now()-parseInt(e.split("_")[1]);a<100&&n?b.current=!0:a<500?setTimeout(()=>{window.__orderFormCurrentInstanceId===e&&(window.__orderFormInitInProgress=!1,window.__orderFormCurrentInstanceId=null),f.current=!0},1e3):setTimeout(()=>{window.__orderFormCurrentInstanceId===e&&(window.__orderFormInitInProgress=!1,window.__orderFormCurrentInstanceId=null),f.current=!0},200)}},[]),(0,i.useEffect)(()=>{m.current;if(y.current=!0,h.current=!1,k.current=!1,f.current=!1,b.current=!1,window.__orderFormCurrentInstanceId===m.current&&(window.__orderFormInitInProgress=!1,window.__orderFormCurrentInstanceId=null),p.reset(),(!f.current||b.current)&&(b.current&&(b.current=!1),n&&a)){h.current=!0;const e=async()=>{const e=m.current;if(k.current)return{success:!1,reason:"already_running"};if(window.__orderFormInitInProgress&&window.__orderFormCurrentInstanceId!==e)return{success:!1,reason:"other_instance_running"};k.current=!0,window.__orderFormInitInProgress=!0,window.__orderFormCurrentInstanceId=e;try{const e=g.current,n=x.current,a=j.current,o=z.current,t=(A.current,w.current);if(n.isReady)e.dictionariesLoaded();else{e.startDictionariesLoad();if(!await n.loadAll())throw new Error("Failed to load dictionaries");0,e.dictionariesLoaded()}let i=null,d=null;return r?(e.startDataLoad(),i=await a.loadOrderForEdit({orderId:r,archivovano:"1"===s?1:0}),e.dataLoaded()):(e.dataLoaded(),i={}),e.setReady(),o&&o(i,d),t&&t(),k.current=!1,window.__orderFormInitInProgress=!1,{success:!0,data:i,sourceOrderId:d}}catch(n){const a=g.current,o=A.current;return a.setError(n.message),k.current=!1,window.__orderFormInitInProgress=!1,window.__orderFormCurrentInstanceId===e&&(window.__orderFormCurrentInstanceId=null),o&&o(n),{success:!1,error:n.message}}};e()}},[n,a,r]),{lifecycle:{phase:p.phase,isInitializing:p.isInitializing,isLoadingDictionaries:p.isLoadingDictionaries,isLoadingFormData:p.isLoadingFormData,isReady:p.isReady,error:p.error,isInPhase:p.isInPhase,canLoadData:p.canLoadData},dictionaries:{data:u.data,loading:u.loading,errors:u.errors,isReady:u.isReady,loadedCount:u.loadedCount,totalToLoad:u.totalToLoad},orderDataLoader:{loading:v.loading,error:v.error,loadOrderForEdit:v.loadOrderForEdit},ui:_,reset:()=>{const e=m.current;p.reset(),_.reset(),k.current=!1,f.current=!1,h.current=!1,window.__orderFormCurrentInstanceId===e&&(window.__orderFormInitInProgress=!1,window.__orderFormCurrentInstanceId=null)}}},tt=new Set;const rt=e=>{if(!e)return["ODESLANA_KE_SCHVALENI"];if("string"===typeof e)try{const n=JSON.parse(e);return Array.isArray(n)?n.length>0?n:["ODESLANA_KE_SCHVALENI"]:[e]}catch(a){return[e]}const n=Array.isArray(e)?e:[e];return n.length>0?n:["ODESLANA_KE_SCHVALENI"]},it=(e,n)=>{const a=rt(e),o=a.includes(n);return("string"!==typeof n||"string"===typeof n&&n.includes(",")||Array.isArray(n))&&function(e,n,a){try{const n=e+"|"+(a&&"object"===typeof a?JSON.stringify(a):String(a));if(tt.has(n))return;tt.add(n)}catch(o){if(tt.has(e))return;tt.add(e)}"undefined"!==typeof console&&(console.error?console.error(n,a):console.warn&&console.warn(n,a))}("hasWorkflowState","\u26a0\ufe0f [hasWorkflowState] CHYBA: state by m\u011bl b\xfdt string, ne pole!",{state:n,typeofState:typeof n,isArray:Array.isArray(n),workflowCode:e,parsedStates:a}),o},st={objednatel:{name:"Objednatel",phase:1,visibilityLogic:e=>e.currentPhase>=1,lockLogic:e=>{var n,a;return!(1===e.currentPhase&&!e.formData.id)&&((null===(n=e.unlockStates)||void 0===n||!n.phase1)&&((null===(a=e.unlockStates)||void 0===a||!a.phase2)&&e.currentPhase>2))}},schvaleni:{name:"Schv\xe1len\xed",phase:1,visibilityLogic:e=>e.currentPhase>=1,lockLogic:e=>{var n,a;return!(1===e.currentPhase&&!e.formData.id)&&((null===(n=e.unlockStates)||void 0===n||!n.phase1)&&((null===(a=e.unlockStates)||void 0===a||!a.phase2)&&e.currentPhase>2))}},financovani:{name:"Financov\xe1n\xed",phase:1,visibilityLogic:e=>e.currentPhase>=1,lockLogic:e=>!(e.currentPhase>=1&&e.currentPhase<=2)&&e.currentPhase>=3},dodavatel:{name:"Dodavatel",phase:3,visibilityLogic:e=>e.currentPhase>=3,lockLogic:e=>{var n;return(null===(n=e.unlockStates)||void 0===n||!n.phase3_sections)&&e.currentPhase>3}},kontakt:{name:"Kontakt",phase:3,visibilityLogic:e=>e.currentPhase>=3,lockLogic:e=>{var n;return(null===(n=e.unlockStates)||void 0===n||!n.phase3_sections)&&e.currentPhase>3}},detaily:{name:"Detaily",phase:3,visibilityLogic:e=>e.currentPhase>=3,lockLogic:e=>{var n;return(null===(n=e.unlockStates)||void 0===n||!n.phase3_sections)&&e.currentPhase>3}},dodaci_podminky:{name:"Dodac\xed podm\xednky",phase:3,visibilityLogic:e=>e.currentPhase>=3,lockLogic:e=>{var n;return(null===(n=e.unlockStates)||void 0===n||!n.phase3_sections)&&e.currentPhase>3}},stav_odeslani:{name:"Stav odesl\xe1n\xed",phase:3,visibilityLogic:e=>e.currentPhase>=3,lockLogic:e=>{var n;return(null===(n=e.unlockStates)||void 0===n||!n.phase3_sections)&&e.currentPhase>3}},potvrzeni_objednavky:{name:"Potvrzen\xed objedn\xe1vky",phase:3,visibilityLogic:e=>!e.isPokladna&&e.currentPhase>=4,lockLogic:e=>{var n;return e.currentPhase>=5&&!(null!==(n=e.unlockStates)&&void 0!==n&&n.potvrzeni)}},registr_smluv:{name:"Registr smluv",phase:4,visibilityLogic:e=>{var n;if(e.isPokladna)return!1;return"ANO"===(null===(n=e.formData.dodavatel_zpusob_potvrzeni)||void 0===n?void 0:n.potvrzeni)&&e.currentPhase>=4},lockLogic:e=>{var n;return e.currentPhase>=5&&!(null!==(n=e.unlockStates)&&void 0!==n&&n.registr)}},registr_smluv_vyplneni:{name:"Vypln\u011bn\xed registru smluv",phase:5,visibilityLogic:e=>{if(e.isPokladna)return!1;const n=it(e.formData.stav_workflow_kod,"UVEREJNIT"),a=it(e.formData.stav_workflow_kod,"UVEREJNENA");return n||a},lockLogic:e=>{var n;return e.currentPhase>=6&&!(null!==(n=e.unlockStates)&&void 0!==n&&n.registr_vyplneni)}},prubeh_objednavky:{name:"Pr\u016fb\u011bh objedn\xe1vky",phase:null,visibilityLogic:()=>!0,lockLogic:()=>!1},dodaci_informace:{name:"Dodac\xed informace",phase:null,visibilityLogic:()=>!0,lockLogic:()=>!1},fakturace:{name:"Fakturace",phase:6,visibilityLogic:e=>!e.isPokladna&&e.currentPhase>=6,lockLogic:e=>{var n;return e.currentPhase>=7&&!(null!==(n=e.unlockStates)&&void 0!==n&&n.fakturace)}},vecna_spravnost:{name:"V\u011bcn\xe1 spr\xe1vnost",phase:7,visibilityLogic:e=>e.currentPhase>=7,lockLogic:e=>{var n;return e.currentPhase>=8&&!(null!==(n=e.unlockStates)&&void 0!==n&&n.vecna_spravnost)}},dokonceni:{name:"Dokon\u010den\xed",phase:8,visibilityLogic:e=>it(e.formData.stav_workflow_kod,"DOKONCENA"),lockLogic:e=>{var n;return it(e.formData.stav_workflow_kod,"DOKONCENA")&&!(null!==(n=e.unlockStates)&&void 0!==n&&n.dokonceni)}}},dt=function(e,n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const t=st[e];if(!t)return{visible:!1,enabled:!1};const r=o.isArchived||!1,i={formData:n,currentPhase:o.currentPhase||ct(n),isArchived:r,unlockStates:{phase1:a.phase1||!1,phase2:a.phase2||!1,phase3:a.phase3||!1,registr:a.registr||!1,fakturace:a.fakturace||!1,vecna_spravnost:a.vecna_spravnost||!1,dokonceni:a.dokonceni||!1,potvrzeni:a.potvrzeni||!1},canEditApprovedSections:o.canEditApprovedSections||!1,showSaveProgress:o.showSaveProgress||!1,isSaving:o.isSaving||!1,isWorkflowLocked:o.isWorkflowLocked||!1,shouldLockPhase1Sections:o.shouldLockPhase1Sections||!1,shouldLockPhase2Sections:o.shouldLockPhase2Sections||!1,shouldLockPhase3Sections:o.shouldLockPhase3Sections||!1,isRegistrLocked:o.isRegistrLocked||!1,isFakturaceDisplayLocked:o.isFakturaceDisplayLocked||!1,isVecnaSpravnostLocked:o.isVecnaSpravnostLocked||!1,isDokonceniLocked:o.isDokonceniLocked||!1},s=r||t.visibilityLogic(i);if(i.isWorkflowLocked)return{visible:s,enabled:!1};return{visible:s,enabled:!(!!s&&(!r&&t.lockLogic(i)))}},lt=[{id:1,name:"Vytvo\u0159en\xed",class:"phase-1",description:"Vytvo\u0159en\xed konceptu"},{id:2,name:"Ke schv\xe1len\xed",class:"phase-2",description:"\u010cek\xe1 na schv\xe1len\xed"},{id:3,name:"Schv\xe1len\xe1",class:"phase-3",description:"Schv\xe1len\xe1, rozpracovan\xe1"},{id:4,name:"Odesl\xe1no",class:"phase-4",description:"Odesl\xe1no dodavateli"},{id:5,name:"Potvrzen\xe1",class:"phase-5",description:"Potvrzena dodavatelem"},{id:6,name:"Rozhodnut\xed",class:"phase-6",description:"Rozhodnut\xed o zve\u0159ejn\u011bn\xed"},{id:7,name:"Uve\u0159ejn\u011bn\xed",class:"phase-7",description:"Vypln\u011bn\xed \xfadaj\u016f o zve\u0159ejn\u011bn\xed"},{id:8,name:"Fakturace",class:"phase-8",description:"Faktury p\u0159id\xe1ny"},{id:9,name:"V\u011bcn\xe1 spr\xe1vnost",class:"phase-9",description:"V\u011bcn\xe1 spr\xe1vnost"},{id:10,name:"Dokon\u010den\xe1",class:"phase-10",description:"Hotovo"}],ct=e=>{if(!e.id||it(e.stav_workflow_kod,"NOVA"))return 1;const n=rt(e.stav_workflow_kod);return{DOKONCENA:8,ZKONTROLOVANA:8,VECNA_SPRAVNOST:7,FAKTURACE:6,NEUVEREJNIT:6,UVEREJNENA:6,UVEREJNIT:5,POTVRZENA:4,ODESLANA:4,ROZPRACOVANA:3,SCHVALENA:3,ZRUSENA:3,ZAMITNUTA:3,CEKA_SE:2,ODESLANA_KE_SCHVALENI:2,NOVA:1}[n[n.length-1]]||1},pt=function(e){var n,a;let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[r,s]=(0,i.useState)(0),d=(0,i.useMemo)(()=>{var n,a;const o="pokladna"===(null===(n=e.financovani)||void 0===n?void 0:n.platba),t="pokladna"===(null===(a=e.dodavatel_zpusob_potvrzeni)||void 0===a?void 0:a.platba);return o||t},[null===(n=e.financovani)||void 0===n?void 0:n.platba,null===(a=e.dodavatel_zpusob_potvrzeni)||void 0===a?void 0:a.platba]),[l,c]=(0,i.useState)({phase1:!1,phase2:!1,phase3_sections:!1,potvrzeni:!1,registr:!1,registr_vyplneni:!1,fakturace:!1,vecna_spravnost:!1,dokonceni:!1}),p=(0,i.useCallback)(e=>{c(n=>(0,t.A)((0,t.A)({},n),{},{[e]:!0}))},[]),u=(0,i.useCallback)(e=>{c(n=>(0,t.A)((0,t.A)({},n),{},{[e]:!1}))},[]),v=(0,i.useCallback)(e=>l[e]||!1,[l]),_=(0,i.useCallback)(()=>{c({phase1:!1,phase2:!1,phase3_sections:!1,potvrzeni:!1,registr:!1,registr_vyplneni:!1,fakturace:!1,vecna_spravnost:!1,dokonceni:!1})},[]),m=(0,i.useCallback)(()=>{s(e=>e+1)},[]),k=(0,i.useMemo)(()=>{if(o)return 8;return ct(e)},[e.id,e.stav_workflow_kod,r,o]),f=(0,i.useMemo)(()=>{return n=e.stav_workflow_kod,e.stav_stornovano||it(n,"ZRUSENA")?"phase-error":it(n,"POTVRZENA")||it(n,"DOKONCENA")?"phase-4":it(n,"SCHVALENA")&&it(n,"ODESLANA")?"phase-3":it(n,"SCHVALENA")?"phase-2":"phase-1";var n},[e.stav_workflow_kod,e.stav_stornovano]),h=(0,i.useMemo)(()=>{const n=e.stav_stornovano,a=e.stav_workflow_kod;return{currentPhase:k,phases:lt.map((e,o)=>{const r=o+1;let i=e.class,s=!1;return(n||it(a,"ZRUSENA"))&&r>=2?(i="phase-error",s=r<=Math.max(k,2)):s=r<=k,(0,t.A)((0,t.A)({},e),{},{isVisible:s,isCurrent:r===k,fillClass:i})})}},[k,e.stav_stornovano,e.stav_workflow_kod]),y=(0,i.useCallback)(()=>k,[k]),b=(0,i.useCallback)(()=>h,[h]),g=(0,i.useCallback)(()=>f,[f]),x=(0,i.useCallback)(n=>rt(n||e.stav_workflow_kod),[e.stav_workflow_kod]),j=(0,i.useCallback)((n,a)=>void 0===a?it(e.stav_workflow_kod,n):it(n,a),[e.stav_workflow_kod]),z=(0,i.useMemo)(()=>{const n=rt(e.stav_workflow_kod),a=["DOKONCENA","POTVRZENA","CEKA_POTVRZENI","SCHVALENA","ODESLANA_KE_SCHVALENI","ZAMITNUTA","ZRUSENA","NOVA"];for(const e of a)if(n.includes(e)){return{CEKA_SE:"ODESLANA_KE_SCHVALENI",ODESLANA:"CEKA_POTVRZENI"}[e]||e}const o=n.length>0?n[n.length-1]:"NOVA";return"ROZPRACOVANA"===o&&n.includes("SCHVALENA")?"SCHVALENA":o||"NOVA"},[e.stav_workflow_kod]),A=(0,i.useCallback)(function(n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return dt(n,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},(0,t.A)({currentPhase:k,isPokladna:d,isArchived:o},a))},[e,k,d,o]),w=(0,i.useCallback)(function(n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(e,n){return!dt(e,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).enabled}(n,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},(0,t.A)({currentPhase:k,isPokladna:d},a))},[e,k,d]),S=(0,i.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a={};return Object.keys(st).forEach(o=>{a[o]=w(o,e,n)}),a},[w]),E=(0,i.useMemo)(()=>!(!e.id||!(j(e.stav_workflow_kod,"DOKONCENA")||j(e.stav_workflow_kod,"ZAMITNUTA")||j(e.stav_workflow_kod,"ZRUSENA"))),[e.id,e.stav_workflow_kod,j,r]),C=(0,i.useMemo)(()=>!(!e.id||!j(e.stav_workflow_kod,"ZAMITNUTA")),[e.id,e.stav_workflow_kod,j,r]),O=(0,i.useMemo)(()=>!(!e.id||!j(e.stav_workflow_kod,"ZRUSENA")),[e.id,e.stav_workflow_kod,j,r]),N=(0,i.useMemo)(()=>E||C||O,[E,C,O]),D=(0,i.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n={},a=(0,t.A)((0,t.A)({},e),{},{isWorkflowLocked:N});return Object.keys(st).forEach(e=>{n[e]=A(e,l,a)}),n},[A,k,e.id,l,N]),T=(0,i.useCallback)(()=>(e=>{const n=JSON.stringify(["ODESLANA_KE_SCHVALENI"]);return{updatedFormData:(0,t.A)((0,t.A)({},e),{},{stav_odeslano:!1,datum_odeslani:"",stav_stornovano:!1,datum_storna:"",odeslani_storno_duvod:"",stav_workflow_kod:n,dodavatel_zpusob_potvrzeni:{potvrzeni:"",datum:"",zpusob:"",poznamka:""},dt_akceptace:"",stav_u_dodavatele:"",datum_zmeny_stavu:"",poznamka_stav:"",cislo_zasilky:"",prepravce:"",ocekavane_doruceni:"",skutecne_doruceni:"",cislo_faktury:"",datum_faktury:"",castka_bez_dph:"",castka_s_dph:"",datum_platby:"",dt_zverejneni:"",registr_iddt:"",ma_byt_zverejnena:!1,faktury:[]}),unlockState:"phase2",newPhase:2}})(e),[e]),I=(0,i.useCallback)(()=>(e=>{const n=JSON.stringify(["SCHVALENA"]);return{updatedFormData:(0,t.A)((0,t.A)({},e),{},{stav_workflow_kod:n,stav_odeslano:!1,datum_odeslani:"",dodavatel_zpusob_potvrzeni:{potvrzeni:"",datum:"",zpusob:"",poznamka:""},dt_akceptace:"",stav_u_dodavatele:"",datum_zmeny_stavu:"",poznamka_stav:"",cislo_zasilky:"",prepravce:"",ocekavane_doruceni:"",skutecne_doruceni:"",cislo_faktury:"",datum_faktury:"",castka_bez_dph:"",castka_s_dph:"",datum_platby:"",faktury:[],dt_zverejneni:"",registr_iddt:"",ma_byt_zverejnena:!1,potvrdil_vecnou_spravnost_id:"",dt_potvrzeni_vecne_spravnosti:"",vecna_spravnost_poznamka:""}),unlockState:"phase3_sections",newPhase:3}})(e),[e]),P=(0,i.useCallback)(()=>(e=>{const n=JSON.stringify(["SCHVALENA","ODESLANA"]);return{updatedFormData:(0,t.A)((0,t.A)({},e),{},{stav_workflow_kod:n,dodavatel_zpusob_potvrzeni:{potvrzeni:"",datum:"",zpusob:"",poznamka:""},dt_akceptace:"",dt_zverejneni:"",registr_iddt:"",faktury:[],potvrdil_vecnou_spravnost_id:null,dt_potvrzeni_vecne_spravnosti:"",potvrzeni_vecne_spravnosti:0,dokoncil_id:null,dt_dokonceni:"",potvrzeni_dokonceni_objednavky:0}),unlockState:"potvrzeni",newPhase:4}})(e),[e]);return{currentPhase:k,phaseTheme:f,phaseProgress:h,mainWorkflowState:z,isPokladna:d,isArchived:o,isWorkflowCompleted:E,isWorkflowRejected:C,isWorkflowCancelled:O,forceRefresh:m,unlockSection:p,lockSection:u,isSectionUnlocked:v,resetAllUnlocks:_,unlockPhase2:T,unlockPhase3:I,unlockPhase4:P,getCurrentPhase:y,getPhaseProgress:b,getPhaseTheme:g,parseWorkflowStates:x,hasWorkflowState:j,getSectionState:A,getAllSectionStates:D,getSectionLockState:w,getAllSectionLockStates:S,sectionDefinitions:st,phaseDefinitions:lt}};var ut=a(56366);const vt=["file"];var _t,mt,kt,ft,ht,yt,bt,gt,xt,jt,zt,At,wt,St,Et,Ct,Ot,Nt,Dt,Tt,It,Pt,Rt,Lt,Vt,Ft,Mt,Ut,Zt,Kt,Bt,Wt,Ht,$t,Jt,Gt,qt,Yt,Xt,Qt,er,nr,ar,or,tr,rr,ir,sr,dr,lr,cr,pr,ur,vr,_r,mr,kr,fr,hr,yr,br,gr,xr,jr,zr,Ar,wr,Sr,Er,Cr,Or,Nr,Dr,Tr,Ir,Pr,Rr,Lr,Vr,Fr,Mr,Ur,Zr,Kr,Br,Wr,Hr,$r,Jr,Gr,qr,Yr,Xr,Qr,ei,ni,ai,oi,ti,ri,ii,si,di,li,ci,pi,ui,vi,_i,mi,ki,fi,hi,yi,bi,gi,xi,ji,zi,Ai,wi,Si,Ei,Ci,Oi,Ni,Di,Ti,Ii,Pi,Ri,Li,Vi,Fi,Mi,Ui,Zi,Ki,Bi,Wi,Hi,$i,Ji,Gi,qi,Yi,Xi,Qi,es,ns,as,os,ts,rs,is,ss,ds,ls,cs,ps,us,vs,_s,ms,ks,fs,hs,ys,bs,gs,xs,js,zs,As,ws,Ss,Es,Cs,Os,Ns,Ds,Ts,Is,Ps,Rs,Ls,Vs,Fs,Ms,Us,Zs,Ks,Bs,Ws,Hs,$s,Js,Gs,qs,Ys,Xs;const Qs=e=>{if(!e)return"";const n=new Date(e);if(isNaN(n.getTime()))return"";const a=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),t=String(n.getDate()).padStart(2,"0");return"".concat(a,"-").concat(o,"-").concat(t)},ed=e=>e?e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g,"").trim():"",nd=()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(o)},ad=l.A.div(_t||(_t=(0,r.A)(["\n  background: #f8fafc;\n  padding: 0;\n  position: fixed;\n  top: ",";\n  left: 0;\n  right: 0;\n  bottom: ",";\n  width: 100%;\n  height: ",";\n  overflow: hidden;\n  z-index: ",";\n  transition: all 0.3s ease-in-out;\n\n  /* Animace pro loading spinner */\n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n"])),e=>e.isFullscreen?"0":"var(--app-fixed-offset-actual, calc(var(--app-header-height, 96px) + var(--app-menu-height, 48px)))",e=>e.isFullscreen?"0":"var(--app-footer-height, 54px)",e=>e.isFullscreen?"100vh":"calc(100vh - var(--app-fixed-offset-actual, calc(var(--app-header-height, 96px) + var(--app-menu-height, 48px))) - var(--app-footer-height, 54px))",e=>e.isFullscreen?"99999":"auto"),od=l.A.div(mt||(mt=(0,r.A)(["\n  width: 100%;\n  max-width: 990px;\n  margin: 0 auto;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  ","\n  background: transparent;\n  transition: margin-left 0.3s ease-in-out, margin-right 0.3s ease-in-out;\n\n  @media (max-width: 1400px) {\n    ","\n  }\n\n  @media (max-width: 1200px) {\n    margin-left: auto;\n    margin-right: auto;\n    max-width: 990px;\n  }\n\n  @media (max-width: 768px) {\n    max-width: 100%;\n    padding: 0 0.5rem;\n    margin-left: auto;\n    margin-right: auto;\n  }\n"])),e=>e.debugPinned?"\n    margin-left: 420px;\n    margin-right: auto;\n  ":"",e=>e.debugPinned?"\n      margin-left: 380px;\n      margin-right: auto;\n    ":""),td=l.A.div(kt||(kt=(0,r.A)(["\n  position: absolute;\n  top: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 100%;\n  max-width: 990px;\n  z-index: 100;\n  background: ",";\n  border-bottom: 1px solid #e5e7eb;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  padding: 1rem 0 1rem 0;\n"])),e=>{let{theme:n}=e;return n.colors.gray100||"#f8fafc"}),rd=l.A.div(ft||(ft=(0,r.A)(["\n  width: 100%;\n  max-width: 990px;\n  margin: 0 auto;\n  ","\n  padding: 0 1rem;\n  transition: margin-left 0.3s ease-in-out, margin-right 0.3s ease-in-out;\n\n  @media (max-width: 1400px) {\n    ","\n  }\n\n  @media (max-width: 1200px) {\n    margin-left: auto;\n    margin-right: auto;\n    max-width: 990px;\n  }\n\n  @media (max-width: 768px) {\n    max-width: 100%;\n    padding: 0 1rem;\n  }\n"])),e=>e.debugPinned?"\n    margin-left: 420px;\n    margin-right: auto;\n  ":"",e=>e.debugPinned?"\n      margin-left: 380px;\n      margin-right: auto;\n    ":""),id=l.A.div(ht||(ht=(0,r.A)(["\n  /* Scrollovateln\xfd obsah - scrollbar na prav\xe9m okraji okna prohl\xed\u017ee\u010de */\n  position: absolute;\n  top: 0px;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 0;\n\n  /* Decentn\xed scrollbar - 80% pr\u016fhledn\xfd ve v\xfdchoz\xedm stavu */\n  scrollbar-width: thin;\n  scrollbar-color: rgba(148, 163, 184, 0.2) transparent;\n\n  /* P\u0159i hover v\xedce viditeln\xfd */\n  &:hover {\n    scrollbar-color: rgba(148, 163, 184, 0.8) transparent;\n  }\n\n  /* Webkit browsers (Chrome, Safari, Edge) */\n  &::-webkit-scrollbar {\n    width: 10px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: transparent;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background-color: rgba(148, 163, 184, 0.2);\n    border-radius: 5px;\n    border: 2px solid transparent;\n    background-clip: content-box;\n    transition: background-color 0.3s ease;\n  }\n\n  &:hover::-webkit-scrollbar-thumb {\n    background-color: rgba(148, 163, 184, 0.8);\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background-color: rgba(100, 116, 139, 0.95);\n  }\n\n  @media (max-width: 768px) {\n    padding: 0;\n  }\n"]))),sd=l.A.div(yt||(yt=(0,r.A)(["\n  /* Vnit\u0159n\xed wrapper pro centrov\xe1n\xed obsahu */\n  max-width: 990px;\n  margin: 0 auto;\n  /* \ud83d\udccf Dynamick\xfd padding-top: v\xfd\u0161ka headeru + 20px gap (u\u017e zapo\u010d\xedt\xe1no v CSS variable) */\n  padding: var(--fixed-header-height, 200px) 1rem 2rem 1rem;\n\n  @media (max-width: 768px) {\n    padding: var(--fixed-header-height, 200px) 0.5rem 2rem 0.5rem;\n  }\n"]))),dd=l.A.div(bt||(bt=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 0.75rem;\n\n  @media (max-width: 768px) {\n    flex-direction: column;\n    gap: 0.75rem;\n    align-items: stretch;\n  }\n"]))),ld=l.A.div(gt||(gt=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  flex-wrap: wrap;\n  flex: 1;\n\n  @media (max-width: 768px) {\n    justify-content: space-between;\n  }\n"]))),cd=(l.A.div(xt||(xt=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 8px 16px;\n  background: ",";\n  border: 2px solid ",";\n  border-radius: 8px;\n  font-size: 14px;\n  font-weight: 600;\n  color: ",";\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n\n  @media (max-width: 768px) {\n    font-size: 12px;\n    padding: 6px 12px;\n    gap: 8px;\n  }\n"])),e=>e.isOverBudget?"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)":"linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)",e=>e.isOverBudget?"#fca5a5":"#bbf7d0",e=>e.isOverBudget?"#991b1b":"#166534"),l.A.div(jt||(jt=(0,r.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n\n  .label {\n    font-size: 10px;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    opacity: 0.8;\n    font-weight: 500;\n  }\n\n  .value {\n    font-size: 16px;\n    font-weight: 700;\n\n    @media (max-width: 768px) {\n      font-size: 14px;\n    }\n  }\n"]))),l.A.div(zt||(zt=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  position: relative;\n"])))),pd=l.A.h1(At||(At=(0,r.A)(["\n  font-size: 1.8125rem;\n  font-weight: 700;\n  color: #b45309;\n  margin: 0;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-variant: small-caps;\n  position: relative;\n\n  /* V\u011bt\u0161\xed prvn\xed p\xedsmeno s gradientn\xedm zv\xfdrazn\u011bn\xedm */\n  &::first-letter {\n    font-size: 1.3em;\n    font-variant: normal;\n    font-weight: 800;\n    background: linear-gradient(135deg, #d97706 0%, #b45309 50%, #92400e 100%);\n    background-clip: text;\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    text-shadow: 0 2px 4px rgba(180, 83, 9, 0.3);\n  }\n\n  /* Horn\xed index pro ID objedn\xe1vky */\n  .order-id-badge {\n    font-size: 0.4em;\n    font-weight: 500;\n    color: #6b7280;\n    margin-left: 0.1em;\n    vertical-align: top;\n    line-height: 1;\n    position: relative;\n    top: -0.5em;\n    left: -6px;\n  }\n\n  @media (max-width: 768px) {\n    font-size: 1.75rem;\n\n    .order-id-badge {\n      font-size: 0.55em;\n    }\n  }\n"]))),ud=(l.A.div(wt||(wt=(0,r.A)(["\n  font-size: 0.875rem;\n  color: #6b7280;\n  font-weight: 500;\n"]))),l.A.div(St||(St=(0,r.A)(["\n  display: flex;\n  gap: 0.75rem;\n  align-items: center;\n"]))),l.A.button(Et||(Et=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border-radius: 8px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &.template-btn {\n    background: #10b981;\n    color: white;\n    cursor: pointer;\n    opacity: 1;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:hover {\n      background: #059669;\n      transform: scale(1.05);\n    }\n  }\n\n  &.reload-btn {\n    background: #0ea5e9;\n    color: white;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:disabled {\n      cursor: not-allowed;\n      opacity: 0.6;\n\n      &:hover {\n        background: #0ea5e9;\n      }\n    }\n\n    &:not(:disabled) {\n      cursor: pointer;\n      opacity: 1;\n\n      &:hover {\n        background: #0284c7;\n        transform: translateY(-1px);\n      }\n    }\n  }\n\n  &.cancel-btn {\n    background: #dc2626;\n    color: white;\n\n    &:hover {\n      background: #b91c1c;\n    }\n  }\n\n  &.draft-btn {\n    background: #059669;\n    color: white;\n\n    &:hover {\n      background: #047857;\n    }\n\n    &:disabled {\n      background: #9ca3af;\n      cursor: not-allowed;\n    }\n  }\n\n  &.fullscreen-btn {\n    background: #10b981;\n    color: white;\n    cursor: pointer;\n    opacity: 1;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:hover {\n      background: #059669;\n      transform: scale(1.05);\n    }\n  }\n\n  &.toggle-sections-btn {\n    background: #8b5cf6;\n    color: white;\n    cursor: pointer;\n    opacity: 1;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:hover {\n      background: #7c3aed;\n      transform: scale(1.05);\n    }\n  }\n\n  &.generate-docx-btn {\n    background: #f97316;\n    color: white;\n    cursor: pointer;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:disabled {\n      background: #9ca3af;\n      cursor: not-allowed;\n      opacity: 0.6;\n\n      &:hover {\n        background: #9ca3af;\n        transform: none;\n      }\n    }\n\n    &:not(:disabled):hover {\n      background: #ea580c;\n      transform: scale(1.05);\n    }\n  }\n"]))),l.A.div(Ct||(Ct=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: #f3f4f6;\n  border: 1px solid #d1d5db;\n  border-radius: 8px;\n  padding: 0.5rem 1rem;\n  margin-bottom: 0;\n  gap: 1rem;\n\n  @media (max-width: 768px) {\n    flex-direction: column;\n    gap: 0.75rem;\n    align-items: stretch;\n  }\n"])))),vd=(l.A.div(Ot||(Ot=(0,r.A)(["\n  font-size: 0.875rem;\n  font-weight: 700;\n  text-align: center;\n  position: relative;\n  flex: 1;\n\n  @media (max-width: 768px) {\n    text-align: left;\n  }\n"]))),l.A.div(Nt||(Nt=(0,r.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  flex: 1;\n"])))),_d=(l.A.div(Dt||(Dt=(0,r.A)(["\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  gap: 0.25rem;\n  padding-right: 1rem;\n"]))),l.A.div(Tt||(Tt=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.875rem;\n  font-weight: 600;\n"]))),l.A.span(It||(It=(0,r.A)(["\n  color: #dc2626;\n  font-size: 0.8rem;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  font-weight: 700;\n"]))),l.A.span(Pt||(Pt=(0,r.A)(["\n  color: #dc2626;\n  font-size: 1.1rem;\n  font-weight: 800;\n  font-family: 'Courier New', monospace;\n"]))),l.A.span(Rt||(Rt=(0,r.A)(["\n  font-size: 0.75rem;\n  padding: 3px 8px;\n  border-radius: 4px;\n  font-weight: 600;\n  background: ",";\n  color: ",";\n  border: 1px solid ",";\n"])),e=>e.isOver?"#fef2f2":"#f0fdf4",e=>e.isOver?"#dc2626":"#059669",e=>e.isOver?"#fecaca":"#bbf7d0"),l.A.div(Lt||(Lt=(0,r.A)(["\n  font-size: 0.875rem;\n  color: #374151;\n  font-weight: 700;\n  text-align: left;\n"])))),md=l.A.div(Vt||(Vt=(0,r.A)(["\n  display: flex;\n  height: 6px;\n  background: #e5e7eb;\n  border-radius: 3px;\n  overflow: hidden;\n  position: relative;\n  border: 1px solid #d1d5db;\n"]))),kd=l.A.div(Ft||(Ft=(0,r.A)(["\n  flex: 1;\n  position: relative;\n\n  &:not(:last-child)::after {\n    content: '';\n    position: absolute;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    width: 1px;\n    background: #d1d5db;\n    z-index: 2;\n  }\n"]))),fd=l.A.div(Mt||(Mt=(0,r.A)(["\n  height: 100%;\n  transition: all 0.3s ease;\n\n  /* Barevn\xe9 p\u0159echody pro jednotliv\xe9 f\xe1ze */\n  &.phase-1 {\n    background: linear-gradient(90deg, #9ca3af 0%, #6b7280 100%); /* \u0160ed\xe1 - za\u010d\xe1tek */\n  }\n\n  &.phase-2 {\n    background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%); /* Oran\u017eov\xe1 - v procesu */\n  }\n\n  &.phase-3 {\n    background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%); /* Modr\xe1 - odesl\xe1no */\n  }\n\n  &.phase-4 {\n    background: linear-gradient(90deg, #10b981 0%, #059669 100%); /* Zelen\xe1 - potvrzeno */\n  }\n\n  &.phase-5 {\n    background: linear-gradient(90deg, #8b5cf6 0%, #7c3aed 100%); /* Fialov\xe1 - registr */\n  }\n\n  &.phase-6 {\n    background: linear-gradient(90deg, #06b6d4 0%, #0891b2 100%); /* Tyrkysov\xe1 - fakturace */\n  }\n\n  &.phase-7 {\n    background: linear-gradient(90deg, #14b8a6 0%, #0d9488 100%); /* Teal - v\u011bcn\xe1 spr\xe1vnost */\n  }\n\n  &.phase-8 {\n    background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%); /* Sv\u011btle zelen\xe1 - dokon\u010deno */\n  }\n\n  &.phase-error {\n    background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%); /* \u010cerven\xe1 - chyba/storno */\n  }\n"]))),hd=l.A.div(Ut||(Ut=(0,r.A)(["\n  width: 2px;\n  height: 40px;\n  background: linear-gradient(to bottom, transparent, #d1d5db 20%, #d1d5db 80%, transparent);\n  border-radius: 1px;\n\n  @media (max-width: 768px) {\n    width: 100%;\n    height: 2px;\n    background: linear-gradient(to right, transparent, #d1d5db 20%, #d1d5db 80%, transparent);\n  }\n"]))),yd=l.A.div(Zt||(Zt=(0,r.A)(["\n  display: flex;\n  gap: 0.75rem;\n  align-items: center;\n"]))),bd=l.A.button(Kt||(Kt=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &.save-btn {\n    background: #10b981;\n    color: white;\n\n    &:hover:not(:disabled) {\n      background: #059669;\n    }\n\n    &:disabled {\n      background: #6b7280;\n      cursor: not-allowed;\n    }\n  }\n\n  &.cancel-btn {\n    background: #dc2626;\n    color: white;\n\n    &:hover {\n      background: #b91c1c;\n    }\n  }\n\n  &.icon-only {\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n"]))),gd=(0,c.i7)(Bt||(Bt=(0,r.A)(["\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n"]))),xd=l.A.span(Wt||(Wt=(0,r.A)(["\n  display: inline-block;\n  width: 14px;\n  height: 14px;\n  border: 2px solid #ddd;\n  border-top: 2px solid #666;\n  border-radius: 50%;\n  animation: "," 0.8s linear infinite;\n"])),gd),jd=l.A.button(Ht||(Ht=(0,r.A)(["\n  padding: 2px 8px;\n  fontSize: 11px;\n  backgroundColor: #fef3c7;\n  border: 1px solid #fbbf24;\n  borderRadius: 4px;\n  color: #92400e;\n  cursor: pointer;\n  fontWeight: 500;\n  transition: all 0.2s ease;\n\n  &:hover {\n    background-color: #fde68a;\n    border-color: #f59e0b;\n  }\n\n  &:active {\n    transform: scale(0.95);\n  }\n"]))),zd=l.A.div($t||($t=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n\n  @media (max-width: 768px) {\n    flex-direction: column;\n    gap: 0.25rem;\n    align-items: flex-start;\n  }\n"]))),Ad=(l.A.div(Jt||(Jt=(0,r.A)(["\n  font-size: 0.75rem;\n  color: #6b7280;\n  font-weight: 500;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  white-space: nowrap;\n"]))),l.A.div(Gt||(Gt=(0,r.A)(["\n  font-size: 1rem;\n  font-weight: 700;\n  color: ",";\n  font-family: 'Courier New', monospace;\n  background: ",";\n  padding: 0.4rem 0.6rem;\n  border-radius: 6px;\n  border: 1px solid ",";\n  white-space: nowrap;\n"])),e=>e.$isEmergency?"#fde047":"#1e40af",e=>e.$isEmergency?"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)":"linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)",e=>e.$isEmergency?"#991b1b":"#93c5fd")),wd=l.A.div(qt||(qt=(0,r.A)(["\n  background: #ffffff;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n  margin-bottom: 1.5rem;\n  overflow: visible;\n  border: 1px solid #e2e8f0;\n"]))),Sd=l.A.div(Yt||(Yt=(0,r.A)(["\n  padding: 1rem 1.25rem;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  transition: all 0.3s ease;\n\n  /* Barevn\xe9 sch\xe9ma podle typu sekce */\n  ","\n"])),e=>{const n=(e=>{switch(e){case"section-grey":return{bg:["#f9fafb","#f3f4f6"],border:"#9ca3af",hover:["#f3f4f6","#e5e7eb"]};case"section-orange":default:return{bg:["#fef3c7","#fde68a"],border:"#f59e0b",hover:["#fde68a","#facc15"]};case"section-blue":return{bg:["#dbeafe","#bfdbfe"],border:"#3b82f6",hover:["#bfdbfe","#93c5fd"]};case"section-purple":return{bg:["#f3e8ff","#e9d5ff"],border:"#a855f7",hover:["#e9d5ff","#d8b4fe"]};case"section-red":return{bg:["#fee2e2","#fecaca"],border:"#dc2626",hover:["#fecaca","#fca5a5"]}}})(e.sectionTheme),a=e.isActive?"1":"0.6";return"\n      background: linear-gradient(135deg, ".concat(n.bg[0]," 0%, ").concat(n.bg[1]," 100%);\n      border-bottom: 1px solid ").concat(n.border,";\n      opacity: ").concat(a,";\n\n      &:hover {\n        background: linear-gradient(135deg, ").concat(n.hover[0]," 0%, ").concat(n.hover[1]," 100%);\n        opacity: 1;\n      }\n    ")}),Ed=l.A.div(Xt||(Xt=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  font-weight: 600;\n  font-size: 1.1rem;\n\n  ","\n"])),e=>{switch(e.sectionTheme){case"section-grey":return"color: #4b5563;";case"section-orange":default:return"color: #92400e;";case"section-blue":return"color: #1e40af;";case"section-purple":return"color: #7e22ce;";case"section-red":return"color: #991b1b;"}}),Cd=l.A.div(Qt||(Qt=(0,r.A)(["\n  font-size: 1.2rem;\n\n  ","\n"])),e=>{switch(e.sectionTheme){case"section-grey":return"color: #6b7280;";case"section-orange":default:return"color: #f59e0b;";case"section-blue":return"color: #3b82f6;";case"section-purple":return"color: #a855f7;";case"section-red":return"color: #dc2626;"}}),Od=l.A.div(er||(er=(0,r.A)(["\n  transition: transform 0.2s ease;\n  transform: ",";\n\n  ","\n"])),e=>e.collapsed?"rotate(0deg)":"rotate(180deg)",e=>{switch(e.sectionTheme){case"section-grey":return"color: #4b5563;";case"section-orange":default:return"color: #92400e;";case"section-blue":return"color: #1e40af;";case"section-purple":return"color: #7e22ce;";case"section-red":return"color: #991b1b;"}}),Nd=l.A.div(nr||(nr=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n"]))),Dd=l.A.span(ar||(ar=(0,r.A)(["\n  margin-left: 0.75rem;\n  color: #dc2626;\n  font-size: 0.7rem;\n  font-weight: 500;\n  background: rgba(255, 255, 255, 0.2);\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n  cursor: help;\n"]))),Td=l.A.div(or||(or=(0,r.A)(["\n  padding: 1.5rem 1.25rem;\n  display: ",";\n"])),e=>e.collapsed?"none":"block"),Id=l.A.div(tr||(tr=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  opacity: ",";\n  pointer-events: ",";\n"])),e=>e.disabled?.6:1,e=>e.disabled?"none":"auto"),Pd=l.A.label(rr||(rr=(0,r.A)(["\n  position: relative;\n  display: inline-block;\n  width: 56px;\n  height: 28px;\n  cursor: ",";\n  flex-shrink: 0;\n\n  input {\n    opacity: 0;\n    width: 0;\n    height: 0;\n  }\n\n  span {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: ",";\n    border-radius: 28px;\n    transition: all 0.3s ease;\n\n    &::before {\n      content: '';\n      position: absolute;\n      height: 20px;\n      width: 20px;\n      left: 4px;\n      bottom: 4px;\n      background-color: white;\n      border-radius: 50%;\n      transition: all 0.3s ease;\n      transform: ",";\n    }\n  }\n\n  input:focus + span {\n    box-shadow: 0 0 0 3px ",";\n  }\n"])),e=>e.disabled?"not-allowed":"pointer",e=>e.checked?"#ef4444":"#cbd5e1",e=>e.checked?"translateX(28px)":"translateX(0)",e=>e.checked?"rgba(239, 68, 68, 0.1)":"rgba(59, 130, 246, 0.1)"),Rd=l.A.span(ir||(ir=(0,r.A)(["\n  font-size: 0.9rem;\n  font-weight: ",";\n  color: ",";\n"])),e=>e.checked?"700":"400",e=>e.checked?"#dc2626":"#374151"),Ld=l.A.div(sr||(sr=(0,r.A)(["\n  display: grid;\n  grid-template-columns: 1fr 1fr 1fr;\n  gap: 1rem;\n  margin-bottom: 1rem;\n\n  @media (max-width: 1024px) {\n    grid-template-columns: 1fr 1fr;\n  }\n\n  @media (max-width: 768px) {\n    grid-template-columns: 1fr;\n  }\n"]))),Vd=l.A.div(dr||(dr=(0,r.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n"]))),Fd=l.A.div(lr||(lr=(0,r.A)(["\n  color: #dc2626;\n  font-size: 0.75rem;\n  font-weight: 500;\n  margin-top: 0.25rem;\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n"]))),Md=l.A.label(cr||(cr=(0,r.A)(["\n  font-weight: 600;\n  font-size: 0.875rem;\n  color: #374151;\n\n  &::after {\n    content: ",";\n    color: #dc2626;\n    margin-left: 2px;\n  }\n"])),e=>e.required?'" *"':'""'),Ud=l.A.div(pr||(pr=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n  width: 100%;\n  margin-bottom: 0.5rem;\n"]))),Zd=l.A.label(ur||(ur=(0,r.A)(["\n  font-weight: 600;\n  font-size: 0.875rem;\n  color: #374151;\n\n  &::after {\n    content: ",";\n    color: #dc2626;\n    margin-left: 2px;\n  }\n"])),e=>e.required?'" *"':'""'),Kd=l.A.button(vr||(vr=(0,r.A)(["\n  background: none;\n  border: none;\n  padding: 0.25rem 0.5rem;\n  cursor: pointer;\n  color: #9ca3af;\n  font-size: 0.75rem;\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  transition: all 0.2s ease;\n  border-radius: 4px;\n  opacity: ",";\n  pointer-events: ",";\n\n  &:hover {\n    color: #ef4444;\n    background: rgba(239, 68, 68, 0.1);\n  }\n\n  svg {\n    width: 12px;\n    height: 12px;\n  }\n"])),e=>e.$visible?1:0,e=>e.$visible?"auto":"none"),Bd=l.A.div(_r||(_r=(0,r.A)(["\n  position: relative;\n  width: 100%;\n\n  > svg {\n    position: absolute;\n    left: 0.75rem;\n    top: 50%;\n    transform: translateY(-50%);\n    color: #9ca3af;\n    z-index: 1;\n    pointer-events: none;\n    width: 16px !important;\n    height: 16px !important;\n  }\n"]))),Wd=l.A.input(mr||(mr=(0,r.A)(["\n  width: 100%;\n  box-sizing: border-box;\n  padding: ",";\n  border: 2px solid ",";\n  border-radius: 8px;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n  background: #ffffff;\n\n  /* Zv\xfdrazn\u011bn\xe9 vypln\u011bn\xe9 hodnoty vs. placeholder - slad\u011bno s CustomSelect */\n  color: ",";\n  font-weight: ",";\n\n  &:focus {\n    outline: none;\n    border-color: ",";\n    box-shadow: 0 0 0 3px ",";\n  }\n\n  &:focus + svg {\n    color: ",';\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    color: #6b7280;\n    cursor: not-allowed;\n  }\n\n  /* Sjednocen\xed placeholder barvy se selecty */\n  &::placeholder {\n    color: #9ca3af;\n    opacity: 1;\n    font-weight: 400;\n  }\n\n  &::-webkit-input-placeholder {\n    color: #9ca3af;\n    font-weight: 400;\n  }\n\n  &::-moz-placeholder {\n    color: #9ca3af;\n    opacity: 1;\n    font-weight: 400;\n  }\n\n  /* Odstran\u011bn\xed spinner arrows u number input\u016f */\n  &[type="number"] {\n    -moz-appearance: textfield; /* Firefox */\n    appearance: textfield;\n\n    &::-webkit-outer-spin-button,\n    &::-webkit-inner-spin-button {\n      -webkit-appearance: none;\n      margin: 0;\n    }\n  }\n'])),e=>e.hasIcon?"0.75rem 0.75rem 0.75rem 2.5rem":"0.75rem",e=>e.hasError?"#dc2626":"#e5e7eb",e=>e.value&&""!==e.value?"#1f2937":"#6b7280",e=>e.disabled?"400":e.value&&""!==e.value?"600":"400",e=>e.hasError?"#dc2626":"#3b82f6",e=>e.hasError?"rgba(220, 38, 38, 0.1)":"rgba(59, 130, 246, 0.1)",e=>e.hasError?"#dc2626":"#3b82f6"),Hd=l.A.textarea(kr||(kr=(0,r.A)(["\n  width: 100%;\n  box-sizing: border-box;\n  padding: 0.75rem;\n  border: 2px solid ",";\n  border-radius: 8px;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n  background: #ffffff;\n  font-family: inherit;\n  resize: vertical;\n  min-height: 80px;\n\n  /* Zv\xfdrazn\u011bn\xe9 vypln\u011bn\xe9 hodnoty vs. placeholder - slad\u011bno s CustomSelect */\n  color: ",";\n  font-weight: ",";\n\n  &:focus {\n    outline: none;\n    border-color: ",";\n    box-shadow: 0 0 0 3px ",";\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    color: #6b7280;\n    cursor: not-allowed;\n  }\n\n  &::placeholder {\n    color: #9ca3af;\n    opacity: 1;\n    font-weight: 400;\n  }\n"])),e=>e.hasError?"#dc2626":"#e5e7eb",e=>e.value&&""!==e.value?"#1f2937":"#6b7280",e=>e.disabled?"400":e.value&&""!==e.value?"600":"400",e=>e.hasError?"#dc2626":"#3b82f6",e=>e.hasError?"rgba(220, 38, 38, 0.1)":"rgba(59, 130, 246, 0.1)"),$d=(l.A.div(fr||(fr=(0,r.A)(["\n  margin-top: 0.75rem;\n  padding: 0.75rem;\n  border-radius: 8px;\n  background: ",";\n  border: 2px solid ",";\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  animation: slideDown 0.3s ease;\n\n  @keyframes slideDown {\n    from {\n      opacity: 0;\n      transform: translateY(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n"])),e=>e.$loading?"#f3f4f6":e.$notFound||e.$isNegative?"#fef2f2":"#f0fdf4",e=>e.$loading?"#e5e7eb":e.$notFound?"#fecaca":e.$isNegative?"#fca5a5":"#86efac"),l.A.div(hr||(hr=(0,r.A)(["\n  font-size: 1.5rem;\n  flex-shrink: 0;\n"]))),l.A.div(yr||(yr=(0,r.A)(["\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n"]))),l.A.div(br||(br=(0,r.A)(["\n  font-size: 0.75rem;\n  font-weight: 500;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n  color: ",";\n"])),e=>e.$loading?"#6b7280":e.$notFound?"#991b1b":e.$isNegative?"#b91c1c":"#15803d"),l.A.div(gr||(gr=(0,r.A)(["\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: ",";\n  font-variant-numeric: tabular-nums;\n"])),e=>e.$loading?"#6b7280":e.$notFound?"#991b1b":e.$isNegative?"#dc2626":"#16a34a"),l.A.div(xr||(xr=(0,r.A)(["\n  font-size: 0.75rem;\n  color: #6b7280;\n  margin-top: 0.125rem;\n"]))),l.A.div(jr||(jr=(0,r.A)(["\n  position: relative;\n  width: 100%;\n"])))),Jd=l.A.div(zr||(zr=(0,r.A)(["\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  margin-top: 0.25rem;\n  background: white;\n  border: 2px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  max-height: 300px;\n  overflow-y: auto;\n  z-index: 1000;\n  animation: slideDown 0.2s ease;\n\n  @keyframes slideDown {\n    from {\n      opacity: 0;\n      transform: translateY(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n"]))),Gd=l.A.div(Ar||(Ar=(0,r.A)(["\n  padding: 0.75rem;\n  cursor: pointer;\n  border-bottom: 1px solid #f3f4f6;\n  transition: all 0.15s ease;\n\n  &:hover {\n    background: #f3f4f6;\n  }\n\n  &:last-child {\n    border-bottom: none;\n  }\n"]))),qd=l.A.div(wr||(wr=(0,r.A)(["\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #1f2937;\n  margin-bottom: 0.25rem;\n"]))),Yd=l.A.div(Sr||(Sr=(0,r.A)(["\n  font-size: 0.75rem;\n  color: #6b7280;\n  display: flex;\n  gap: 1rem;\n"]))),Xd=l.A.div(Er||(Er=(0,r.A)(["\n  padding: 1rem;\n  text-align: center;\n  color: #6b7280;\n  font-size: 0.875rem;\n"]))),Qd=(l.A.select(Cr||(Cr=(0,r.A)(["\n  width: 100%;\n  box-sizing: border-box;\n  padding: 0.75rem;\n  border: 2px solid ",";\n  border-radius: 8px;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n  background: #ffffff;\n  cursor: pointer;\n\n  /* Zv\xfdrazn\u011bn\xe9 vybran\xe9 hodnoty vs. placeholder - slad\u011bno s CustomSelect */\n  color: ",";\n  font-weight: ",";\n\n  &:focus {\n    outline: none;\n    border-color: ",";\n    box-shadow: 0 0 0 3px ",";\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    color: #6b7280;\n    cursor: not-allowed;\n  }\n\n  /* Placeholder styl pro prvn\xed option */\n  option:first-child {\n    color: #9ca3af;\n    font-weight: 400;\n  }\n"])),e=>e.hasError?"#dc2626":"#e5e7eb",e=>e.value&&""!==e.value&&"placeholder"!==e.value?"#1f2937":"#6b7280",e=>e.disabled?"400":e.value&&""!==e.value&&"placeholder"!==e.value?"600":"400",e=>e.hasError?"#dc2626":"#3b82f6",e=>e.hasError?"rgba(220, 38, 38, 0.1)":"rgba(59, 130, 246, 0.1)"),l.A.div(Or||(Or=(0,r.A)(["\n  position: relative;\n  width: 100%;\n  z-index: ",";\n"])),e=>e.isOpen?1e4:1),l.A.div(Nr||(Nr=(0,r.A)(["\n  width: 100%;\n  box-sizing: border-box;\n  padding: 0.75rem 1.75rem 0.75rem 0.75rem;\n  border: 2px solid ",";\n  border-radius: 8px;\n  font-size: 0.875rem;\n  background: ",";\n  cursor: ",";\n  color: ",";\n\n  font-weight: ",";\n  min-height: 2.5rem;\n\n  display: flex;\n  align-items: center;\n  position: relative;\n  transition: all 0.2s ease;\n\n  /* Custom arrow */\n  appearance: none;\n  -moz-appearance: none;\n  -webkit-appearance: none;\n  background-image: ",";\n  background-repeat: no-repeat;\n  background-position: right 0.5rem center;\n  background-size: 16px 16px;\n\n  &:hover {\n    border-color: ",";\n  }\n\n  &:focus {\n    outline: none;\n    border-color: ",";\n    box-shadow: 0 0 0 3px ",";\n  }\n"])),e=>e.hasError?"#dc2626":"#e5e7eb",e=>e.disabled?"#f9fafb":"#ffffff",e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?"#6b7280":e.placeholder||!e.value||""===e.value?"#9ca3af":"#1f2937",e=>e.disabled?"400":e.value&&""!==e.value&&"true"!==e.placeholder?"600":"400",e=>e.disabled?e.isOpen?"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='18 15 12 9 6 15'%3E%3C/polyline%3E%3C/svg%3E\")":"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")":e.hasError?e.isOpen?"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23b91c1c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='18 15 12 9 6 15'%3E%3C/polyline%3E%3C/svg%3E\")":"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23b91c1c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")":e.isOpen?"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23374151' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='18 15 12 9 6 15'%3E%3C/polyline%3E%3C/svg%3E\")":"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23374151' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")",e=>e.disabled?"#e5e7eb":e.hasError?"#dc2626":"#3b82f6",e=>e.hasError?"#dc2626":"#3b82f6",e=>e.hasError?"rgba(220, 38, 38, 0.1)":"rgba(59, 130, 246, 0.1)"),l.A.span(Dr||(Dr=(0,r.A)(["\n  flex: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  color: ",";\n  font-weight: ",";\n"])),e=>e.isEmpty?"#9ca3af":"#1f2937",e=>e.isEmpty?"400":"600"),l.A.div(Tr||(Tr=(0,r.A)(["\n  position: fixed;\n  z-index: 40;\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.1);\n  max-height: 300px;\n  overflow-y: auto;\n  min-width: 200px;\n\n  /* Prevent text selection while scrolling */\n  user-select: none;\n\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #f9fafb;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 4px;\n  }\n"]))),l.A.div(Ir||(Ir=(0,r.A)(["\n  padding: 0.75rem;\n  cursor: pointer;\n  font-size: 0.875rem;\n  border-bottom: 1px solid #f3f4f6;\n  color: #1f2937;\n  font-weight: 400 !important; /* Normal font pro v\u0161echny mo\u017enosti - s !important */\n\n  &:hover {\n    background: #f8fafc;\n    font-weight: 400 !important; /* Z\u016fst\xe1v\xe1 normal i p\u0159i hover */\n  }\n\n  &:last-child {\n    border-bottom: none;\n  }\n\n  ","\n"])),e=>e.selected&&"\n    background: #eff6ff;\n    border-left: 3px solid #3b82f6;\n    font-weight: 600 !important; /* Bold jen pro vybranou mo\u017enost */\n  "),l.A.div(Pr||(Pr=(0,r.A)(["\n  position: fixed;\n  z-index: 40;\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.1);\n  max-height: 300px;\n  overflow-y: auto;\n  min-width: 200px;\n\n  /* Prevent text selection while scrolling */\n  user-select: none;\n\n  /* Optimalizace pro plynulej\u0161\xed scrollov\xe1n\xed */\n  scroll-behavior: auto;\n  contain: layout style paint;\n  will-change: scroll-position;\n  transform: translateZ(0); /* Force hardware acceleration */\n\n  /* Lep\u0161\xed scrollbar styling */\n  scrollbar-width: thin;\n  scrollbar-color: #d1d5db #f9fafb;\n\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #f9fafb;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background: #9ca3af;\n  }\n"]))),l.A.div(Rr||(Rr=(0,r.A)(["\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n  padding: 0.75rem;\n  border-bottom: 1px solid #e5e7eb;\n"]))),l.A.input(Lr||(Lr=(0,r.A)(["\n  width: 100%;\n  padding: 0.75rem 0.75rem 0.75rem 2.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  font-size: 0.875rem;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n  }\n"])))),el=(l.A.div(Vr||(Vr=(0,r.A)(["\n  position: absolute;\n  left: 1rem;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #6b7280;\n  pointer-events: none;\n"]))),l.A.div(Fr||(Fr=(0,r.A)(["\n  position: relative;\n  width: 100%;\n"]))),l.A.button(Mr||(Mr=(0,r.A)(["\n  position: absolute;\n  right: 0.75rem;\n  top: 50%;\n  transform: translateY(-50%);\n  background: none;\n  border: none;\n  color: #9ca3af;\n  cursor: pointer;\n  padding: 0.25rem;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n\n  &:hover {\n    color: #6b7280;\n    background: #f3f4f6;\n  }\n\n  &:active {\n    transform: translateY(-50%) scale(0.95);\n  }\n"]))),(0,l.A)(Qd)(Ur||(Ur=(0,r.A)(["\n  padding-right: 2.5rem;\n"]))),l.A.div(Zr||(Zr=(0,r.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.4);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 999999;\n  padding: 1rem;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n"])))),nl=l.A.div(Kr||(Kr=(0,r.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n"]))),al=l.A.div(Br||(Br=(0,r.A)(["\n  background: white;\n  padding: 2rem;\n  border-radius: 8px;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n  max-width: 400px;\n  width: 90%;\n  z-index: 100001;\n"]))),ol=l.A.div(Wr||(Wr=(0,r.A)(["\n  font-size: 1.125rem;\n  font-weight: 600;\n  margin-bottom: 1rem;\n  color: #dc2626;\n"]))),tl=l.A.div(Hr||(Hr=(0,r.A)(["\n  margin-bottom: 1.5rem;\n  color: #374151;\n  line-height: 1.5;\n"]))),rl=l.A.div($r||($r=(0,r.A)(["\n  display: flex;\n  gap: 0.75rem;\n  justify-content: flex-end;\n"]))),il=l.A.button(Jr||(Jr=(0,r.A)(["\n  padding: 0.75rem 1.5rem;\n  background-color: ",";\n  color: ",";\n  border: none;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.15s ease;\n\n  &:hover {\n    background-color: ",";\n  }\n"])),e=>"danger"===e.variant?"#dc2626":"#f3f4f6",e=>"danger"===e.variant?"white":"#374151",e=>"danger"===e.variant?"#b91c1c":"#e5e7eb"),sl=l.A.div(Gr||(Gr=(0,r.A)(["\n  background: white;\n  border-radius: 8px;\n  width: 100%;\n  max-width: 600px;\n  padding: 2rem;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n"]))),dl=l.A.div(qr||(qr=(0,r.A)(["\n  margin-bottom: 1.5rem;\n  border-bottom: 1px solid #e5e7eb;\n  padding-bottom: 1rem;\n"]))),ll=l.A.h2(Yr||(Yr=(0,r.A)(["\n  margin: 0;\n  color: #1e293b;\n  font-size: 1.25rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n"]))),cl=l.A.button(Xr||(Xr=(0,r.A)(["\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  background: transparent;\n  border: none;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: #64748b;\n  transition: all 0.2s;\n  border-radius: 4px;\n\n  &:hover {\n    background: #f1f5f9;\n    color: #1e293b;\n  }\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n"]))),pl=l.A.div(Qr||(Qr=(0,r.A)(["\n  /* \u017d\xe1dn\xfd padding - u\u017e je v hlavn\xedm modalu */\n"]))),ul=l.A.div(ei||(ei=(0,r.A)(["\n  margin-bottom: 1.25rem;\n"]))),vl=l.A.label(ni||(ni=(0,r.A)(["\n  display: block;\n  font-size: 0.75rem;\n  font-weight: 700;\n  color: #64748b;\n  margin-bottom: 0.5rem;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n"]))),_l=l.A.input(ai||(ai=(0,r.A)(["\n  width: 100%;\n  padding: 10px 12px;\n  border: 2px solid #e5e7eb;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n  background: white;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n\n  &::placeholder {\n    color: #9ca3af;\n  }\n"]))),ml=(l.A.select(oi||(oi=(0,r.A)(["\n  width: 100%;\n  padding: 10px 12px;\n  border: 2px solid #e5e7eb;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n  background: white;\n  cursor: pointer;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n\n  option {\n    padding: 8px;\n  }\n"]))),l.A.div(ti||(ti=(0,r.A)(["\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n  gap: 1rem;\n  margin-top: 0.75rem;\n"]))),l.A.label(ri||(ri=(0,r.A)(["\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  padding: 1rem;\n  border: 2px solid ",";\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  background: ",";\n\n  &:hover {\n    border-color: #10b981;\n    background: ",";\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);\n  }\n"])),e=>e.checked?"#10b981":"#e5e7eb",e=>e.checked?"linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)":"white",e=>e.checked?"linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)":"#f8fafc"),l.A.input(ii||(ii=(0,r.A)(["\n  appearance: none;\n  width: 20px;\n  height: 20px;\n  border: 2px solid #d1d5db;\n  border-radius: 50%;\n  position: relative;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  margin-top: 2px;\n\n  &:checked {\n    border-color: #10b981;\n    background: #10b981;\n  }\n\n  &:checked::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 8px;\n    height: 8px;\n    background: white;\n    border-radius: 50%;\n  }\n"]))),l.A.div(si||(si=(0,r.A)(["\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: ",";\n  line-height: 1.4;\n"])),e=>e.checked?"#065f46":"#374151"),l.A.div(di||(di=(0,r.A)(["\n  display: flex;\n  gap: 0.75rem;\n  justify-content: flex-end;\n  margin-top: 1.5rem;\n  padding-top: 1.5rem;\n  border-top: 1px solid #e5e7eb;\n"])))),kl=l.A.button(li||(li=(0,r.A)(["\n  padding: 0.625rem 1.25rem;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  cursor: ",";\n  transition: all 0.2s;\n\n  ","\n"])),e=>e.disabled?"not-allowed":"pointer",e=>"cancel"===e.variant?"\n    background: white;\n    color: #64748b;\n    border: 1px solid #e2e8f0;\n\n    &:hover {\n      background: #f8fafc;\n      border-color: #cbd5e1;\n    }\n  ":"\n    background: ".concat(e.disabled?"#cbd5e1":"#3b82f6",";\n    color: white;\n    border: 1px solid ").concat(e.disabled?"#cbd5e1":"#3b82f6",";\n\n    &:hover:not(:disabled) {\n      background: #2563eb;\n      border-color: #2563eb;\n    }\n\n    &:disabled {\n      cursor: not-allowed;\n    }\n  ")),fl=(l.A.div(ci||(ci=(0,r.A)(["\n  padding: ",";\n  cursor: pointer;\n  font-size: 0.875rem;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  background: ",";\n  border-bottom: ",";\n  font-weight: ",";\n  color: ",";\n  position: relative;\n  /* Optimalizace pro plynulej\u0161\xed scrollov\xe1n\xed */\n  will-change: transform;\n  backface-visibility: hidden;\n  /* Focusable pro tab navigaci */\n  outline: none;\n\n  &:hover {\n    background: ",';\n  }\n\n  &:focus {\n    background: #dbeafe;\n    box-shadow: inset 0 0 0 2px #3b82f6;\n  }\n\n  &:last-child {\n    border-bottom: none;\n  }\n\n  input[type="checkbox"] {\n    margin: 0;\n    /* Zabr\xe1nit p\u0159efokusov\xe1n\xed p\u0159i kliknut\xed na checkbox */\n    pointer-events: none;\n  }\n\n  span {\n    padding-left: ',"px;\n    font-weight: ",";\n  }\n"])),e=>0===e.level?"0.75rem":"0.5rem 0.75rem 0.5rem 2rem",e=>0===e.level?"#f9fafb":"#ffffff",e=>0===e.level?"2px solid #e5e7eb":"1px solid #f3f4f6",e=>0===e.level?"600":"400",e=>0===e.level?"#111827":"#4b5563",e=>0===e.level?"#f3f4f6":"#f8fafc",e=>20*(e.level||0),e=>0===(e.level||0)?"600":"400"),l.A.div(pi||(pi=(0,r.A)(["\n  display: flex;\n  gap: 1rem;\n  align-items: center;\n  margin-top: 0.5rem;\n"]))),l.A.label(ui||(ui=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-size: 0.875rem;\n  color: #374151;\n"]))),l.A.input(vi||(vi=(0,r.A)(["\n  width: 16px;\n  height: 16px;\n  cursor: pointer;\n"]))),l.A.button(_i||(_i=(0,r.A)(["\n  background: transparent;\n  color: #f59e0b;\n  border: none;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n  padding: 0;\n  margin-right: 8px;\n\n  &:hover {\n    color: #d97706;\n    transform: scale(1.1);\n  }\n\n  &:active {\n    transform: scale(0.95);\n  }\n\n  svg {\n    width: 16px;\n    height: 16px;\n  }\n"])))),hl=l.A.div(mi||(mi=(0,r.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(248, 250, 252, 0.95);\n  backdrop-filter: blur(",");\n  -webkit-backdrop-filter: blur(",");\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  z-index: 999999;\n  opacity: ",";\n  transition: opacity 0.5s ease-in-out, backdrop-filter 0.6s ease-in-out;\n  pointer-events: ",";\n\n  @media (max-width: 768px) {\n    padding: 1rem;\n  }\n"])),e=>e.$visible?"8px":"0px",e=>e.$visible?"8px":"0px",e=>e.$visible?1:0,e=>e.$visible?"auto":"none"),yl=l.A.div(ki||(ki=(0,r.A)(["\n  width: 64px;\n  height: 64px;\n  border: 4px solid #e2e8f0;\n  border-top: 4px solid #f59e0b;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n  margin-bottom: 1.5rem;\n  transform: scale(",");\n  transition: transform 0.5s ease-in-out;\n\n  @keyframes spin {\n    0% { transform: rotate(0deg) scale(1); }\n    100% { transform: rotate(360deg) scale(1); }\n  }\n"])),e=>e.$visible?1:.8),bl=l.A.div(fi||(fi=(0,r.A)(["\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #374151;\n  text-align: center;\n  margin-bottom: 0.5rem;\n  transform: translateY(",");\n  opacity: ",";\n  transition: transform 0.5s ease-in-out 0.1s, opacity 0.5s ease-in-out 0.1s;\n"])),e=>e.$visible?"0":"10px",e=>e.$visible?1:0),gl=l.A.div(hi||(hi=(0,r.A)(["\n  font-size: 0.875rem;\n  color: #6b7280;\n  text-align: center;\n  transform: translateY(",");\n  opacity: ",";\n  transition: transform 0.5s ease-in-out 0.15s, opacity 0.5s ease-in-out 0.15s;\n"])),e=>e.$visible?"0":"10px",e=>e.$visible?1:0),xl=l.A.div(yi||(yi=(0,r.A)(["\n  position: fixed;\n  top: var(--fixed-header-height, 0px);\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.2);\n  backdrop-filter: blur(",");\n  -webkit-backdrop-filter: blur(",");\n  z-index: 99;\n  opacity: ",";\n  transition: opacity 0.3s ease-in-out, backdrop-filter 0.3s ease-in-out;\n  pointer-events: ",";\n  visibility: ",";\n"])),e=>e.$visible?"5px":"0px",e=>e.$visible?"5px":"0px",e=>e.$visible?1:0,e=>e.$visible?"auto":"none",e=>e.$visible?"visible":"hidden"),jl=(l.A.div(bi||(bi=(0,r.A)(["\n  filter: blur(",");\n  transition: filter 0.6s ease-in-out;\n  pointer-events: ",";\n"])),e=>e.$blurred?"3px":"0px",e=>e.$blurred?"none":"auto"),l.A.div(gi||(gi=(0,r.A)(["\n  width: 300px;\n  height: 6px;\n  background: #e2e8f0;\n  border-radius: 3px;\n  overflow: hidden;\n  margin-top: 1.5rem;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) inset;\n"]))),l.A.div(xi||(xi=(0,r.A)(["\n  height: 100%;\n  background: linear-gradient(90deg, #2e7d32, #4caf50 40%, #66bb6a);\n  border-radius: 3px;\n  transition: width 250ms ease;\n  box-shadow: 0 0 6px rgba(76, 175, 80, 0.55);\n"]))),l.A.div(ji||(ji=(0,r.A)(["\n  background: #fee2e2;\n  border: 1px solid #fecaca;\n  border-radius: 8px;\n  padding: 1rem;\n  color: #dc2626;\n  font-size: 0.875rem;\n  margin: 1rem 0;\n  text-align: center;\n"])))),zl=l.A.div(zi||(zi=(0,r.A)(["\n  position: absolute;\n  right: 35px;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #059669;\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n\n  &:hover {\n    background-color: #f0fdf4;\n    color: #047857;\n  }\n\n  &:active {\n    background-color: #dcfce7;\n  }\n"]))),Al=l.A.div(Ai||(Ai=(0,r.A)(["\n  position: absolute;\n  right: 8px;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #059669;\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n\n  &:hover {\n    background-color: #f0fdf4;\n    color: #047857;\n  }\n\n  &:active {\n    background-color: #dcfce7;\n  }\n"]))),wl=l.A.div(wi||(wi=(0,r.A)(["\n  color: ",";\n  cursor: ",";\n  padding: 6px;\n  border-radius: 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  transition: all 0.2s;\n  opacity: ",";\n  background: ",";\n\n  ","\n"])),e=>e.isActive?"#667eea":"#d1d5db",e=>e.isActive?"pointer":"not-allowed",e=>e.isActive?1:.5,e=>e.isActive?"rgba(102, 126, 234, 0.1)":"transparent",e=>e.isActive&&"\n    &:hover {\n      background-color: rgba(102, 126, 234, 0.2);\n      color: #764ba2;\n      transform: scale(1.1);\n    }\n\n    &:active {\n      background-color: rgba(118, 75, 162, 0.2);\n      transform: scale(1.05);\n    }\n  "),Sl=l.A.button(Si||(Si=(0,r.A)(["\n  background: #ef4444;\n  color: white;\n  border: 2px solid white;\n  border-radius: 6px;\n  padding: 0.375rem;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  transition: all 0.2s;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\n  &:hover {\n    background-color: #dc2626;\n    transform: scale(1.1);\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);\n  }\n\n  &:active {\n    background-color: #b91c1c;\n    transform: scale(0.95);\n  }\n"]))),El=l.A.div(Ei||(Ei=(0,r.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n"]))),Cl=l.A.div(Ci||(Ci=(0,r.A)(["\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 800px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  animation: slideUp 0.3s ease-out;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n"]))),Ol=l.A.div(Oi||(Oi=(0,r.A)(["\n  padding: 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n"]))),Nl=l.A.h2(Ni||(Ni=(0,r.A)(["\n  margin: 0;\n  font-size: 20px;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  color: white;\n\n  svg {\n    font-size: 24px;\n  }\n"]))),Dl=l.A.button(Di||(Di=(0,r.A)(["\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 24px;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n"]))),Tl=l.A.input(Ti||(Ti=(0,r.A)(["\n  width: 100%;\n  padding: 10px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 6px;\n  font-size: 14px;\n  transition: all 0.2s;\n\n  &:focus {\n    outline: none;\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 2px rgba(24,144,255,0.1);\n  }\n\n  &::placeholder {\n    color: #8c8c8c;\n  }\n"]))),Il=l.A.div(Ii||(Ii=(0,r.A)(["\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n"]))),Pl=l.A.div(Pi||(Pi=(0,r.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  max-height: 400px;\n  overflow-y: auto;\n"]))),Rl=l.A.div(Ri||(Ri=(0,r.A)(["\n  padding: 16px;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s;\n  background: white;\n\n  &:hover {\n    border-color: #667eea;\n    background-color: #f9fafb;\n    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);\n  }\n"]))),Ll=l.A.div(Li||(Li=(0,r.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n"]))),Vl=l.A.div(Vi||(Vi=(0,r.A)(["\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 900px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  animation: slideUp 0.3s ease-out;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n"]))),Fl=l.A.div(Fi||(Fi=(0,r.A)(["\n  padding: 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n"]))),Ml=l.A.h2(Mi||(Mi=(0,r.A)(["\n  margin: 0;\n  font-size: 18px;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  color: white;\n\n  svg {\n    width: 24px;\n    height: 24px;\n  }\n"]))),Ul=l.A.button(Ui||(Ui=(0,r.A)(["\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n"]))),Zl=l.A.div(Zi||(Zi=(0,r.A)(["\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n"]))),Kl=l.A.input(Ki||(Ki=(0,r.A)(["\n  width: 100%;\n  padding: 10px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 6px;\n  font-size: 14px;\n  margin-bottom: 20px;\n  transition: all 0.2s;\n\n  &:focus {\n    outline: none;\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 2px rgba(24,144,255,0.1);\n  }\n\n  &::placeholder {\n    color: #8c8c8c;\n  }\n"]))),Bl=l.A.div(Bi||(Bi=(0,r.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  max-height: 400px;\n  overflow-y: auto;\n"]))),Wl=l.A.div(Wi||(Wi=(0,r.A)(["\n  padding: 16px;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  background: white;\n  position: relative;\n\n  &:hover {\n    border-color: #667eea;\n    background-color: #f9fafb;\n    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);\n  }\n"]))),Hl=l.A.div(Hi||(Hi=(0,r.A)(["\n  cursor: pointer;\n  margin-bottom: ",";\n"])),e=>e.hasButtons?"12px":"0"),$l=l.A.div($i||($i=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  margin-top: 8px;\n  flex-wrap: wrap;\n"]))),Jl=l.A.div(Ji||(Ji=(0,r.A)(["\n  display: inline-flex;\n  align-items: center;\n  gap: 4px;\n  padding: 4px 10px;\n  border-radius: 12px;\n  font-size: 11px;\n  font-weight: 600;\n  background: ",";\n  color: white;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\n  svg {\n    width: 12px;\n    height: 12px;\n  }\n"])),e=>"global"===e.scope?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"usek"===e.scope?"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)":"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)"),Gl=l.A.div(Gi||(Gi=(0,r.A)(["\n  display: flex;\n  gap: 8px;\n  margin-top: 12px;\n  padding-top: 12px;\n  border-top: 1px solid #e5e7eb;\n"]))),ql=l.A.button(qi||(qi=(0,r.A)(["\n  padding: 10px 16px;\n  border: none;\n  border-radius: 6px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  white-space: nowrap;\n\n  &:disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n  }\n\n  &.primary {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);\n\n    &:hover:not(:disabled) {\n      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);\n      transform: translateY(-1px);\n    }\n\n    &:active:not(:disabled) {\n      transform: translateY(0);\n    }\n  }\n\n  &.success {\n    background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n    color: white;\n    box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);\n\n    &:hover:not(:disabled) {\n      box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);\n      transform: translateY(-1px);\n    }\n\n    &:active:not(:disabled) {\n      transform: translateY(0);\n    }\n  }\n"]))),Yl=(l.A.select(Yi||(Yi=(0,r.A)(["\n  width: 100%;\n  padding: 10px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 6px;\n  background: white;\n  font-size: 14px;\n  color: #262626;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n\n  &:focus {\n    outline: none;\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 2px rgba(24,144,255,0.1);\n  }\n\n  &:hover {\n    border-color: #40a9ff;\n  }\n"]))),l.A.div(Xi||(Xi=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 40px 20px;\n  color: #6b7280;\n\n  @keyframes spin {\n    to { transform: rotate(360deg); }\n  }\n"])))),Xl=l.A.div(Qi||(Qi=(0,r.A)(["\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 8px;\n  margin-top: 8px;\n  margin-bottom: 16px;\n"]))),Ql=l.A.button(es||(es=(0,r.A)(["\n  padding: 12px;\n  border: 2px solid ",";\n  border-radius: 8px;\n  background: ",";\n  color: ",";\n  cursor: ",";\n  opacity: ",";\n  transition: all 0.2s;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 6px;\n  font-size: 13px;\n  font-weight: 500;\n  position: relative;\n\n  &:hover:not(:disabled) {\n    border-color: #667eea;\n    background: ",";\n  }\n\n  svg {\n    font-size: 18px;\n  }\n"])),e=>e.selected?"#667eea":"#e5e7eb",e=>e.selected?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"white",e=>e.selected?"white":"#595959",e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?.5:1,e=>e.selected?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"#f9fafb"),ec=l.A.div(ns||(ns=(0,r.A)(["\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));\n  gap: 8px;\n  margin-top: 12px;\n"]))),nc=l.A.label(as||(as=(0,r.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  padding: 8px 10px;\n  border: 2px solid ",";\n  border-radius: 6px;\n  background: ",";\n  cursor: ",";\n  opacity: ",";\n  transition: all 0.2s;\n  font-size: 13px;\n  font-weight: 600;\n  color: ",';\n\n  &:hover:not([disabled]) {\n    border-color: #667eea;\n    background: rgba(102, 126, 234, 0.05);\n  }\n\n  input[type="checkbox"] {\n    width: 16px;\n    height: 16px;\n    cursor: ',";\n  }\n"])),e=>e.selected?"#667eea":"#e5e7eb",e=>e.selected?"rgba(102, 126, 234, 0.05)":"white",e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?.5:1,e=>e.selected?"#667eea":"#374151",e=>e.disabled?"not-allowed":"pointer"),ac=l.A.div(os||(os=(0,r.A)(['\n  position: absolute;\n  top: calc(100% + 8px);\n  left: 0;\n  right: 0;\n  background: white;\n  border: 2px solid #e5e7eb;\n  border-radius: 8px;\n  padding: 16px;\n  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);\n  z-index: 100;\n\n  &[data-status="checking"] {\n    border-color: #3b82f6;\n  }\n\n  &[data-status="found-local"], &[data-status="found-ares"] {\n    border-color: #10b981;\n  }\n\n  &[data-status="not-found"] {\n    border-color: #ef4444;\n  }\n']))),oc=l.A.h4(ts||(ts=(0,r.A)(["\n  margin: 0 0 8px 0;\n  font-size: 14px;\n  font-weight: 600;\n  color: ",";\n"])),e=>"checking"===e.status?"#3b82f6":"found"===e.status?"#10b981":"not-found"===e.status?"#ef4444":"#111827"),tc=l.A.div(rs||(rs=(0,r.A)(["\n  font-size: 13px;\n  color: #6b7280;\n  margin-bottom: 12px;\n  line-height: 1.4;\n"]))),rc=l.A.div(is||(is=(0,r.A)(["\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n"]))),ic=l.A.button(ss||(ss=(0,r.A)(["\n  padding: 6px 12px;\n  border-radius: 6px;\n  font-size: 12px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n\n  &.primary {\n    background: #10b981;\n    color: white;\n    border: 1px solid #10b981;\n\n    &:hover {\n      background: #059669;\n    }\n  }\n\n  &.fill-form {\n    background: #3b82f6;\n    color: white;\n    border: 1px solid #3b82f6;\n\n    &:hover {\n      background: #2563eb;\n    }\n  }\n\n  &.secondary {\n    background: white;\n    color: #6b7280;\n    border: 1px solid #d1d5db;\n\n    &:hover {\n      background: #f9fafb;\n      color: #374151;\n    }\n  }\n"]))),sc=l.A.div(ds||(ds=(0,r.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 999999;\n  padding: 1rem;\n"]))),dc=l.A.div(ls||(ls=(0,r.A)(["\n  background: white;\n  border-radius: 8px;\n  padding: 2rem;\n  max-width: 700px;\n  width: 100%;\n  max-height: 85vh;\n  overflow-y: auto;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n  position: relative;\n"]))),lc=l.A.div(cs||(cs=(0,r.A)(["\n  margin-bottom: 1.5rem;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid #e5e7eb;\n"]))),cc=l.A.h3(ps||(ps=(0,r.A)(["\n  margin: 0;\n  color: #1e293b;\n  font-size: 1.25rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n"]))),pc=l.A.button(us||(us=(0,r.A)(["\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  background: transparent;\n  border: none;\n  border-radius: 4px;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: #64748b;\n  transition: all 0.2s;\n\n  &:hover {\n    background: #f1f5f9;\n    color: #1e293b;\n  }\n"]))),uc=l.A.div(vs||(vs=(0,r.A)(["\n  margin-bottom: 1.5rem;\n  padding: 1.25rem;\n  background: #f8fafc;\n  border-radius: 8px;\n  border: 1px solid #e5e7eb;\n"]))),vc=l.A.h4(_s||(_s=(0,r.A)(["\n  margin: 0 0 1rem 0;\n  color: #1e293b;\n  font-size: 0.875rem;\n  font-weight: 700;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n"]))),_c=l.A.div(ms||(ms=(0,r.A)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  padding: 0.625rem 0;\n  border-bottom: 1px solid #e5e7eb;\n\n  &:last-child {\n    border-bottom: none;\n    padding-bottom: 0;\n  }\n"]))),mc=l.A.span(ks||(ks=(0,r.A)(["\n  color: #64748b;\n  font-size: 0.875rem;\n  font-weight: 500;\n  min-width: 120px;\n  flex-shrink: 0;\n"]))),kc=l.A.span(fs||(fs=(0,r.A)(["\n  color: #1e293b;\n  font-size: 0.875rem;\n  font-weight: 600;\n  text-align: right;\n  flex: 1;\n  margin-left: 1rem;\n  word-break: break-word;\n"]))),fc=l.A.div(hs||(hs=(0,r.A)(["\n  margin-top: 0.75rem;\n"]))),hc=l.A.div(ys||(ys=(0,r.A)(["\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 0.75rem;\n  margin-bottom: 0.5rem;\n\n  &:last-child {\n    margin-bottom: 0;\n  }\n"]))),yc=l.A.div(bs||(bs=(0,r.A)(["\n  font-weight: 600;\n  color: #1e293b;\n  font-size: 0.875rem;\n  margin-bottom: 0.375rem;\n"]))),bc=l.A.div(gs||(gs=(0,r.A)(["\n  font-size: 0.75rem;\n  color: #64748b;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n"]))),gc=l.A.span(xs||(xs=(0,r.A)(["\n  background: ",";\n  color: white;\n  padding: 0.25rem 0.625rem;\n  border-radius: 4px;\n  font-size: 0.6875rem;\n  font-weight: 700;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n"])),e=>"po"===e.type?"#3b82f6":"details"===e.type?"#10b981":"#8b5cf6"),xc=l.A.div(js||(js=(0,r.A)(["\n  text-align: center;\n  padding: 2rem;\n  color: #9ca3af;\n  font-style: italic;\n"]))),jc=l.A.div(zs||(zs=(0,r.A)(["\n  position: relative;\n  display: flex;\n  align-items: center;\n"]))),zc=l.A.span(As||(As=(0,r.A)(["\n  position: absolute;\n  right: 12px;\n  color: ",";\n  font-weight: 600;\n  font-size: 0.875rem;\n  font-family: inherit;\n  pointer-events: none;\n  user-select: none;\n  display: flex;\n  align-items: center;\n  height: 100%;\n"])),e=>e.disabled?"#9ca3af":"#374151");function Ac(e){let{fieldName:n,value:a,onChange:o,onBlur:t,disabled:r,hasError:s,placeholder:d}=e;const l=(0,i.useRef)(null),[c,p]=(0,i.useState)(""),[u,_]=(0,i.useState)(!1),m=e=>{if(!e&&0!==e)return"";const n=parseFloat(e.toString().replace(/[^0-9.-]/g,""));return isNaN(n)?"":n.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g," ").replace(".",",")};(0,i.useEffect)(()=>{if(!u){const e=m(a||"");c!==e&&p(e)}},[a,u]);return(0,ke.jsxs)(jc,{children:[(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(v.A,{}),(0,ke.jsx)(Wd,{ref:l,type:"text",name:n,placeholder:d,value:c,onChange:e=>{const a=e.target.value;p(a);const t=a.replace(/[^\d,.-]/g,"").replace(",","."),r=parseFloat(t),i=isNaN(r)?"":r.toFixed(2);o(n,i)},onFocus:()=>{_(!0)},onBlur:()=>{_(!1);const e=m(c);p(e);const a=c.replace(/[^\d,.-]/g,"").replace(",","."),o=parseFloat(a),r=isNaN(o)?"":o.toFixed(2);t&&t(n,r)},disabled:r,style:{textAlign:"right",paddingRight:"40px"},hasError:s,hasIcon:!0})]}),(0,ke.jsx)(zc,{disabled:r,children:"K\u010d"})]})}function wc(e){let{fieldName:n,value:a,onChange:o,onBlur:t,disabled:r,hasError:s,placeholder:d="Vyberte datum"}=e;const[l,c]=(0,i.useState)(!1),[p,u]=(0,i.useState)(new Date),[v,m]=(0,i.useState)(!1),k=(0,i.useRef)(null),f=(0,i.useRef)(null),h=a?new Date(a):null;(0,i.useEffect)(()=>{if(a){const e=new Date(a);isNaN(e.getTime())||u(e)}},[a]),(0,i.useEffect)(()=>{const e=e=>{k.current&&!k.current.contains(e.target)&&c(!1)};return l&&document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[l]),(0,i.useEffect)(()=>{if(l&&k.current){const e=()=>{if(!k.current)return;const e=k.current.getBoundingClientRect(),n=window.innerHeight-e.bottom-54-20,a=e.top-20;m(n<300||n<380&&a>n+50)};e();const n=document.querySelector('[class*="ScrollableContent"]');if(n)return n.addEventListener("scroll",e),()=>n.removeEventListener("scroll",e)}},[l]);const y=e=>{const n=(e=>{const n=new Date(e),a=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),t=String(n.getDate()).padStart(2,"0");return"".concat(a,"-").concat(o,"-").concat(t)})(e);o(n),t&&t(n),c(!1)},b=new Date,g=(()=>{const e=p.getFullYear(),n=p.getMonth(),a=new Date(e,n,1),o=new Date(e,n+1,0),t=[];for(let i=(0===a.getDay()?6:a.getDay()-1)-1;i>=0;i--){const a=new Date(e,n,-i);t.push({date:a,isOtherMonth:!0})}for(let i=1;i<=o.getDate();i++){const a=new Date(e,n,i);t.push({date:a,isOtherMonth:!1})}const r=42-t.length;for(let i=1;i<=r;i++){const a=new Date(e,n+1,i);t.push({date:a,isOtherMonth:!0})}return t})(),x=a?(e=>{if(!e)return"";try{const n=new Date(e);return isNaN(n.getTime())?"":n.toLocaleDateString("cs-CZ",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(n){return""}})(a):d;return(0,ke.jsxs)(Sc,{ref:k,"data-field":n,children:[(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(_.A,{}),(0,ke.jsx)(Ec,{type:"button",onClick:()=>!r&&c(!l),disabled:r,hasError:s,hasValue:!!a,"data-datepicker":n,children:x}),a&&!r&&(0,ke.jsx)(Cc,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),(e=>{e&&(e.preventDefault(),e.stopPropagation()),o(""),t&&t(""),c(!1)})(e)},title:"Smazat datum",children:"\u2715"}),!r&&(0,ke.jsx)(Oc,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),(e=>{e&&(e.preventDefault(),e.stopPropagation()),y(new Date)})(e)},title:"Nastavit dne\u0161n\xed datum",children:"\ud83d\udcc5"})]}),l&&!r&&(0,ke.jsxs)(Nc,{ref:f,openUpwards:v,children:[(0,ke.jsxs)(Dc,{children:[(0,ke.jsx)(Tc,{onClick:e=>{e.preventDefault(),e.stopPropagation(),(e=>{e&&(e.preventDefault(),e.stopPropagation()),u(new Date(p.getFullYear(),p.getMonth()-1))})(e)},children:"\u25c0"}),(0,ke.jsxs)(Ic,{children:[(0,ke.jsx)("span",{children:p.toLocaleDateString("cs-CZ",{month:"long"})}),(0,ke.jsx)("span",{children:p.getFullYear()})]}),(0,ke.jsx)(Tc,{onClick:e=>{e.preventDefault(),e.stopPropagation(),(e=>{e&&(e.preventDefault(),e.stopPropagation()),u(new Date(p.getFullYear(),p.getMonth()+1))})(e)},children:"\u25b6"})]}),(0,ke.jsxs)(Pc,{children:[(0,ke.jsx)(Rc,{children:"Po"}),(0,ke.jsx)(Rc,{children:"\xdat"}),(0,ke.jsx)(Rc,{children:"St"}),(0,ke.jsx)(Rc,{children:"\u010ct"}),(0,ke.jsx)(Rc,{children:"P\xe1"}),(0,ke.jsx)(Rc,{children:"So"}),(0,ke.jsx)(Rc,{children:"Ne"}),g.map((e,n)=>{const a=e.date.toDateString()===b.toDateString(),o=h&&e.date.toDateString()===h.toDateString();return(0,ke.jsx)(Lc,{onClick:n=>{n.stopPropagation(),y(e.date)},isToday:a,isSelected:o,isOtherMonth:e.isOtherMonth,children:e.date.getDate()},n)})]}),(0,ke.jsxs)(Vc,{children:[(0,ke.jsx)(Fc,{className:"today",onClick:e=>{e.preventDefault(),e.stopPropagation(),y(new Date)},children:"Dnes"}),(0,ke.jsx)(Fc,{className:"clear",onClick:e=>{e.preventDefault(),e.stopPropagation(),o(""),t&&t(""),c(!1)},children:"Smazat"})]})]})]})}const Sc=l.A.div(ws||(ws=(0,r.A)(["\n  position: relative;\n  width: 100%;\n"]))),Ec=l.A.button(Ss||(Ss=(0,r.A)(["\n  width: 100%;\n  display: block;\n  padding: 0.75rem;\n  padding-left: 2.75rem;\n  padding-right: ",";\n  border: 2px solid ",";\n  border-radius: 8px;\n  background: ",";\n  color: ",";\n  font-size: 0.875rem;\n  font-weight: ",";\n  line-height: 1.5;\n  cursor: ",";\n  transition: all 0.2s ease;\n  text-align: left;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  min-height: 42px;\n  box-sizing: border-box;\n\n  &:hover:not(:disabled) {\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n"])),e=>e.disabled?"0.75rem":e.hasValue?"4.5rem":"3rem",e=>e.hasError?"#ef4444":"#e5e7eb",e=>e.disabled?"#f9fafb":"white",e=>e.disabled?"#6b7280":e.hasValue?"#1f2937":"#9ca3af",e=>e.hasValue&&!e.disabled?"600":"400",e=>e.disabled?"not-allowed":"pointer"),Cc=l.A.button(Es||(Es=(0,r.A)(["\n  position: absolute;\n  right: 36px;\n  top: 50%;\n  transform: translateY(-50%);\n  background: #ef4444;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: bold;\n  transition: all 0.2s ease;\n  z-index: 1;\n\n  &:hover {\n    background: #dc2626;\n    transform: translateY(-50%) scale(1.1);\n  }\n"]))),Oc=l.A.button(Cs||(Cs=(0,r.A)(["\n  position: absolute;\n  right: 8px;\n  top: 50%;\n  transform: translateY(-50%);\n  background: transparent;\n  color: #3b82f6;\n  border: none;\n  border-radius: 4px;\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  font-size: 13px;\n  font-weight: bold;\n  transition: all 0.2s ease;\n  z-index: 1;\n\n  &:hover {\n    background: transparent;\n    color: #2563eb;\n    transform: translateY(-50%) scale(1.15);\n  }\n"]))),Nc=l.A.div(Os||(Os=(0,r.A)(["\n  position: absolute;\n  ","\n  left: 0;\n  right: 0;\n  z-index: 10001;\n  background: white;\n  border: 2px solid #3b82f6;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n  padding: 0.5rem;\n"])),e=>e.openUpwards?"\n    bottom: calc(100% + 4px);\n    top: auto;\n  ":"\n    top: calc(100% + 4px);\n    bottom: auto;\n  "),Dc=l.A.div(Ns||(Ns=(0,r.A)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n  padding-bottom: 0.35rem;\n  border-bottom: 1px solid #e5e7eb;\n"]))),Tc=l.A.button(Ds||(Ds=(0,r.A)(["\n  background: #f3f4f6;\n  border: none;\n  border-radius: 4px;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: #374151;\n  font-weight: 600;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n\n  &:hover {\n    background: #3b82f6;\n    color: white;\n    transform: scale(1.1);\n  }\n"]))),Ic=l.A.div(Ts||(Ts=(0,r.A)(["\n  font-weight: 600;\n  font-size: 0.85rem;\n  color: #111827;\n  display: flex;\n  gap: 0.35rem;\n"]))),Pc=l.A.div(Is||(Is=(0,r.A)(["\n  display: grid;\n  grid-template-columns: repeat(7, 1fr);\n  gap: 1px;\n"]))),Rc=l.A.div(Ps||(Ps=(0,r.A)(["\n  aspect-ratio: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 0.65rem;\n  font-weight: 600;\n  color: #6b7280;\n  padding: 0.15rem;\n"]))),Lc=l.A.button(Rs||(Rs=(0,r.A)(["\n  aspect-ratio: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 0.75rem;\n  border: none;\n  border-radius: 4px;\n  background: ",";\n  color: ",";\n  font-weight: ",";\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &:hover {\n    background: ",";\n    transform: scale(1.1);\n    color: ",";\n  }\n"])),e=>e.isToday?"#dbeafe":e.isSelected?"#3b82f6":"transparent",e=>e.isSelected?"white":e.isOtherMonth?"#9ca3af":"#374151",e=>e.isToday||e.isSelected?"600":"400",e=>e.isSelected?"#2563eb":"#f3f4f6",e=>e.isSelected?"white":"#111827"),Vc=l.A.div(Ls||(Ls=(0,r.A)(["\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 0.5rem;\n  padding-top: 0.5rem;\n  border-top: 2px solid #e5e7eb;\n"]))),Fc=l.A.button(Vs||(Vs=(0,r.A)(["\n  flex: 1;\n  padding: 0.5rem;\n  border: none;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &.today {\n    background: #dbeafe;\n    color: #1e40af;\n\n    &:hover {\n      background: #bfdbfe;\n    }\n  }\n\n  &.clear {\n    background: #fee2e2;\n    color: #991b1b;\n\n    &:hover {\n      background: #fecaca;\n    }\n  }\n"]))),Mc=l.A.div(Fs||(Fs=(0,r.A)(["\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 6px;\n  cursor: help;\n\n  &:hover .tooltip-bubble {\n    opacity: 1;\n    visibility: visible;\n    transform: translateY(0);\n  }\n\n  &:hover .help-icon {\n    color: #3b82f6;\n  }\n"]))),Uc=l.A.span(Ms||(Ms=(0,r.A)(["\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  width: 16px;\n  height: 16px;\n  color: #6b7280;\n  transition: color 0.2s ease;\n\n  svg {\n    width: 16px;\n    height: 16px;\n  }\n"]))),Zc=l.A.div(Us||(Us=(0,r.A)(["\n  position: absolute;\n  bottom: calc(100% + 8px);\n  left: 50%;\n  transform: translateX(-50%) translateY(-4px);\n  width: 320px;\n  padding: 12px;\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);\n  opacity: 0;\n  visibility: hidden;\n  transition: all 0.2s ease;\n  z-index: 1000;\n  pointer-events: none;\n\n  /* \u0160ipka dol\u016f */\n  &::after {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    width: 0;\n    height: 0;\n    border-left: 6px solid transparent;\n    border-right: 6px solid transparent;\n    border-top: 6px solid #ffffff;\n  }\n\n  &::before {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    width: 0;\n    height: 0;\n    border-left: 7px solid transparent;\n    border-right: 7px solid transparent;\n    border-top: 7px solid #e5e7eb;\n    margin-top: 1px;\n    z-index: -1;\n  }\n"]))),Kc=l.A.div(Zs||(Zs=(0,r.A)(["\n  display: flex;\n  justify-content: space-between;\n  padding: 6px 0;\n  font-size: 0.75rem;\n  border-bottom: 1px solid #f3f4f6;\n\n  &:last-child {\n    border-bottom: none;\n  }\n"]))),Bc=l.A.span(Ks||(Ks=(0,r.A)(["\n  color: #6b7280;\n  font-weight: 500;\n"]))),Wc=l.A.span(Bs||(Bs=(0,r.A)(["\n  color: #1f2937;\n  font-weight: 600;\n  text-align: right;\n  max-width: 180px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n"]))),Hc=(e,n)=>{if(!Array.isArray(e)||0===e.length)return e;return e.map(e=>n.find(n=>n.value&&n.value===e||n.kod&&n.kod===e||n.kod_stavu&&n.kod_stavu===e)?e:"100")},$c=e=>{if(!e)return{};const n=(0,t.A)({},e);if(e.polozky&&!e.polozky_objednavky&&(n.polozky_objednavky=Array.isArray(e.polozky)?e.polozky.map(e=>(0,t.A)((0,t.A)({},e),{},{cena_bez_dph:"number"===typeof e.cena_bez_dph?e.cena_bez_dph.toFixed(2):(parseFloat((e.cena_bez_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0).toFixed(2),cena_s_dph:"number"===typeof e.cena_s_dph?e.cena_s_dph.toFixed(2):(parseFloat((e.cena_s_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0).toFixed(2),sazba_dph:parseInt(e.sazba_dph)||21})):[],delete n.polozky),e.strediska_kod&&(n.strediska_kod=Pa(e.strediska_kod)),e.financovani){const a=La(e.financovani);Object.assign(n,a)}if(e.cislo_objednavky&&!e.ev_cislo&&(n.ev_cislo=e.cislo_objednavky),e.stav_workflow_kod&&"string"===typeof e.stav_workflow_kod&&e.stav_workflow_kod.trim().startsWith("["))try{const a=JSON.parse(e.stav_workflow_kod);Array.isArray(a)&&(n.stav_workflow_kod=a)}catch(a){}void 0!==e.potvrzeni_dokonceni_objednavky&&(n.potvrzeni_dokonceni_objednavky=parseInt(e.potvrzeni_dokonceni_objednavky,10)||0),void 0!==e.stav_odeslano&&(n.stav_odeslano=Boolean(e.stav_odeslano)),void 0!==e.stav_stornovano&&(n.stav_stornovano=Boolean(e.stav_stornovano));if(["datum_storna","odeslani_storno_duvod","identifikator","dt_odeslani","storno_uzivatel_id","storno_provedl"].forEach(a=>{void 0!==e[a]&&(n[a]=e[a])}),e.poznamka){let o=e.poznamka,t=5;for(;"string"===typeof o&&o.trim().startsWith("{")&&t>0;){try{const e=JSON.parse(o);if(void 0===e.text)break;o=e.text}catch(a){break}t--}n.poznamka_objednavky=o,delete n.poznamka}if(e.dodavatel_zpusob_potvrzeni&&"string"===typeof e.dodavatel_zpusob_potvrzeni)try{const a=JSON.parse(e.dodavatel_zpusob_potvrzeni);n.dodavatel_zpusob_potvrzeni=a}catch(a){}return n};function Jc(){var e,n,a,r,l,c,v,g,V,F,M,U,Z,K,B,W,H,$,J,G,q,Y,X,Q,ee,ne,ae,oe,te,re,ie,se,de,le,fe,he,ye,be,ge;const xe=(0,d.Zp)(),{showToast:je}=(0,i.useContext)(Sa.$o)||{},{userDetail:ze,user_id:Ae,username:we,token:Se,user:Ee,userPermissions:Ce,hasPermission:Oe}=(0,i.useContext)(_e.cy)||{},{triggerActivity:Ne}=(0,Ea.v5)(),{progress:De,start:Te,setProgress:Ie,done:Pe,fail:Re,reset:Le}=(0,i.useContext)(Ca.z)||{},Ve=(0,i.useRef)(!1),Fe=(0,d.zy)(),Me=(0,i.useMemo)(()=>new URLSearchParams(Fe.search),[Fe.search]),Ke=Me.get("edit"),Be=Da.default.getMetadata(),We=null===Be||void 0===Be?void 0:Be.editOrderId,He=Ke||We;(0,i.useEffect)(()=>{(async()=>{let e="NOVA",n=null,a="";try{if(Ae){Da.default.setCurrentUser(Ae);Da.default.getMetadata();if(await Da.default.hasDraft()){const o=await Da.default.loadDraft();o&&o.formData&&(o.savedOrderId&&o.formData.id?(e="EDITACE",n=o.savedOrderId,a=o.formData.cislo_objednavky||o.formData.ev_cislo||""):(e="KONCEPT",n=null,a=""))}else He&&(e="EDITACE",n=parseInt(He),a="",Da.default.saveMetadata({editOrderId:He}))}else He&&(e="EDITACE",n=parseInt(He),a="")}catch(t){He&&(e="EDITACE",n=parseInt(He),a="")}const o={isEditMode:"EDITACE"===e,isNewOrder:"NOVA"===e,orderId:n,orderNumber:a,currentPhase:1,mainWorkflowState:"NOVA",hasDraft:"NOVA"!==e,timestamp:Date.now()};window.__orderFormState=o,window.dispatchEvent(new CustomEvent("orderFormStateChange",{detail:o}))})()},[He,Ae]);const $e=Me.get("archivovano"),[Je,Ge]=(0,i.useState)({objednatel:!1,schvaleni:!1,prilohy:!1,financovani:!1,dodavatel:!1,kontakt:!1,detaily:!1,dodaci_podminky:!1,stav_odeslani:!1,potvrzeni_objednavky:!1,registr_smluv:!1,registr_smluv_vyplneni:!1,prubeh_objednavky:!1,dodaci_informace:!1,fakturace:!1,dokonceni:!1,storno_detail:!1}),[qe,Ye]=(0,i.useState)({garant:!1,prikazce:!1,strediska:!1,financovani:!1,lp_kod:!1}),[Xe,Qe]=(0,i.useState)({garant:"",prikazce:"",strediska:"",financovani:"",lp_kod:""}),[en,nn]=(0,i.useState)(new Set),[an,on]=(0,i.useState)(!1),[tn,rn]=(0,i.useState)(!1),[sn,dn]=(0,i.useState)({details:{},loading:{}}),[ln,cn]=(0,i.useState)({list:[],loadingList:!1,detail:null,loadingDetail:!1,searchTerm:"",showSuggestions:!1,selectedSuggestionIndex:-1});(0,i.useEffect)(()=>{if(!tn)return;const e=e=>{"Escape"===e.key&&rn(!1)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[tn]);const[pn,un]=(0,i.useState)([]),[vn,_n]=(0,i.useState)({uploading:!1,dragOver:!1,checkingSync:!1,showDeleteDialog:!1,deleteTarget:null,showDeleteAllDialog:!1}),[mn,kn]=(0,i.useState)({showDialog:!1,searchTerm:"",results:[],loading:!1,allContacts:[]}),[fn,hn]=(0,i.useState)({popupOpen:!1,search:"",results:[],loading:!1,savingToLocal:null,scopeInfo:{},selectedScope:"personal",selectedUseky:[]}),[yn,bn]=(0,i.useState)({available:[],loading:!1}),[gn,xn]=(0,i.useState)({show:!1,status:null,data:null,isOperation:!1}),[jn,zn]=(0,i.useState)({show:!1,progress:0,text:""}),[An,wn]=(0,i.useState)(!1),[Sn,En]=(0,i.useState)(!1),[Cn,On]=(0,i.useState)(!1),[Nn,Dn]=(0,i.useState)(!1),[Tn,In]=(0,i.useState)({showAddDialog:!1,existingCheck:null,autoFillSource:null}),[Pn,Rn]=(0,i.useState)({open:!1,orderData:null}),[Ln,Vn]=(0,i.useState)({ciselniky:!0,formData:!1,initializing:!0,initialized:!1,error:null}),[Fn,Mn]=(0,i.useState)(()=>{try{const e=Da.default.getMetadata();if(e&&!0===e.isEditMode){if(e.editOrderId||e.formData.id){e.editOrderId||e.formData.id}return!0}return!1}catch(e){return!1}});(0,i.useEffect)(()=>{(async()=>{if(Se&&we){qo(!0);try{const e=await(0,me.nw)({token:Se,username:we});Jo(e||[])}catch(e){Jo([])}finally{qo(!1)}}})()},[Se,we]),(0,i.useEffect)(()=>{if(Ae)try{const e=Da.default.getMetadata();e&&e.isEditMode}catch(e){}},[Ae]),(0,i.useEffect)(()=>{if(Ae)try{Da.default.saveMetadata({isEditMode:Fn})}catch(e){}},[Fn,Ae]),(0,i.useEffect)(()=>{if(!Ae)return;let e;const n=n=>{clearTimeout(e)},a=Nc.current;return a?a.addEventListener("scroll",n):window.addEventListener("scroll",n),()=>{clearTimeout(e),a?a.removeEventListener("scroll",n):window.removeEventListener("scroll",n)}},[Ae]);const[Un,Zn]=(0,i.useState)({}),[Kn,Bn]=(0,i.useState)({objednatel_id:"",uzivatel_id:"",garant_uzivatel_id:"",prikazce_id:"",jmeno:"",email:"",telefon:"",predmet:"",strediska_kod:[],max_cena_s_dph:"",popis_pozadavku:"",mimoradna_udalost:!1,stav_workflow_kod:JSON.stringify(["NOVA"]),schvalovatel_id:"",dt_schvaleni:"",schvaleni_komentar:"",zpusob_financovani:"",financovani:"",lp_kod:[],cislo_smlouvy:"",smlouva_poznamka:"",individualni_schvaleni:"",individualni_poznamka:"",pojistna_udalost_cislo:"",pojistna_udalost_poznamka:"",dodavatel_id:"",dodavatel_nazev:"",dodavatel_adresa:"",dodavatel_ico:"",dodavatel_dic:"",dodavatel_zastoupeny:"",dodavatel_kontakt_jmeno:"",dodavatel_kontakt_email:"",dodavatel_kontakt_telefon:"",druh_objednavky:"",druh_objednavky_kod:"",polozky_objednavky:[],faktury:[],poznamka_objednavky:"",dt_predpokladany_termin_dodani:"",misto_dodani:"",zaruka:"",stav_odeslano:!1,datum_odeslani:"",stav_stornovano:!1,datum_storna:"",storno_uzivatel_id:"",odeslani_storno_duvod:"",storno_provedl:"",storno_poznamky:"",dodavatel_zpusob_potvrzeni:{potvrzeni:"NE",zpusoby:[],platba:"faktura"},dt_akceptace:"",dt_zverejneni:"",registr_iddt:"",ma_byt_zverejnena:!1,stav_u_dodavatele:"",datum_zmeny_stavu:"",poznamka_stav:"",cislo_zasilky:"",prepravce:"",ocekavane_doruceni:"",skutecne_doruceni:"",cislo_faktury:"",datum_faktury:"",castka_bez_dph:"",castka_s_dph:"",datum_splatnosti:"",datum_zaplaceni:"",faktury_objednavky:[],potvrzeni_dokonceni_objednavky:0,prilohy_dokumenty:[],ev_cislo:"",temp_datum_objednavky:(new Date).toISOString().split("T")[0],datum_vytvoreni:""}),Wn=(0,i.useCallback)(e=>{var n;null===(n=(new Error).stack.split("\n")[2])||void 0===n||n.trim();Bn("function"===typeof e?n=>e(n):e)},[]);(0,i.useEffect)(()=>(Kn.id&&(window.__activeOrderFormId=Kn.id,window.__activeOrderFormEvCislo=Kn.cislo_objednavky||Kn.ev_cislo||"#".concat(Kn.id)),()=>{delete window.__activeOrderFormId,delete window.__activeOrderFormEvCislo}),[Kn.id,Kn.cislo_objednavky,Kn.ev_cislo]);const Hn=(0,i.useRef)(null),$n=((0,i.useMemo)(()=>{if(!Hn.current||!Kn.id)return!1;const e=Hn.current,n=["predmet","max_cena_s_dph","popis_pozadavku","zpusob_financovani","dodavatel_nazev","dodavatel_ico","druh_objednavky_kod","poznamka_objednavky","dt_predpokladany_termin_dodani","misto_dodani","zaruka"];for(const t of n)if(e[t]!==Kn[t])return!0;const a=e.polozky_objednavky||[],o=Kn.polozky_objednavky||[];if(a.length!==o.length)return!0;for(let t=0;t<a.length;t++){const e=a[t],n=o[t];if(e.popis!==n.popis||e.mnozstvi!==n.mnozstvi||e.cena_jednotkova!==n.cena_jednotkova)return!0}return!1},[Kn]),(0,i.useMemo)(()=>"ARCHIVOVANO"===Kn.stav_objednavky||"Archivov\xe1no"===Kn.stav_objednavky,[Kn.stav_objednavky])),Jn=pt(Kn,$n),{currentPhase:Gn,phaseTheme:qn,phaseProgress:Yn,mainWorkflowState:Xn,getCurrentPhase:Qn,getPhaseProgress:ea,getPhaseTheme:na,parseWorkflowStates:aa,hasWorkflowState:oa,isPokladna:ta,isWorkflowCompleted:ra,isWorkflowRejected:ia,isWorkflowCancelled:sa,forceRefresh:da,getSectionState:la}=Jn,ca=(0,i.useMemo)(()=>!Kn.id,[Kn.id]),pa=$n,ua=(0,i.useMemo)(()=>pa?(0,t.A)((0,t.A)({},Yn),{},{phases:Yn.phases.map(e=>(0,t.A)((0,t.A)({},e),{},{isVisible:!0,fillClass:"completed"}))}):Yn,[pa,Yn]),[va,_a]=(0,i.useState)(!1),[ma,ka]=(0,i.useState)(!1),fa=(0,i.useCallback)(e=>{var n,a,o,t,r,i,s;const d={isEditMode:null!==(n=e.isEditMode)&&void 0!==n?n:Fn,isNewOrder:null!==(a=e.isNewOrder)&&void 0!==a?a:!Fn,orderId:null!==(o=e.orderId)&&void 0!==o?o:Kn.id,orderNumber:null!==(t=e.orderNumber)&&void 0!==t?t:Kn.cislo_objednavky||Kn.ev_cislo,currentPhase:null!==(r=e.currentPhase)&&void 0!==r?r:Gn,mainWorkflowState:null!==(i=e.mainWorkflowState)&&void 0!==i?i:Xn,hasDraft:null!==(s=e.hasDraft)&&void 0!==s?s:va||ma,timestamp:Date.now()};return window.__orderFormState=d,window.dispatchEvent(new CustomEvent("orderFormStateChange",{detail:d})),d},[Fn,Kn.id,Kn.cislo_objednavky,Kn.ev_cislo,Gn,Xn,va,ma]),ha=(0,i.useRef)(fa);(0,i.useEffect)(()=>{ha.current=fa},[fa]);const ya=e=>ha.current(e);(0,i.useEffect)(()=>{if(!ma)return;const e=!!Kn.id;let n="NOVA";e?n="EDITACE":(va||!!He)&&(n="KONCEPT");const a={isEditMode:"EDITACE"===n,isNewOrder:"NOVA"===n,orderId:e?Kn.id:null,orderNumber:Kn.cislo_objednavky||Kn.ev_cislo||"",currentPhase:Gn,mainWorkflowState:Xn,hasDraft:"KONCEPT"===n||"EDITACE"===n,timestamp:Date.now()};return window.__orderFormState=a,window.dispatchEvent(new CustomEvent("orderFormStateChange",{detail:a})),()=>{window.__orderFormState={isEditMode:!1,isNewOrder:!1,orderId:null,orderNumber:"",currentPhase:1,mainWorkflowState:"NOVA",hasDraft:!1,timestamp:Date.now()},window.dispatchEvent(new CustomEvent("orderFormStateChange",{detail:window.__orderFormState}))}},[ma,Kn.id,Kn.cislo_objednavky,Kn.ev_cislo,Gn,Xn,va,He]);const[ba,ga]=(0,i.useState)({saving:!1,savingDraft:!1,disableAutosave:!1,lastAutoSave:null,autoSaving:!1,dataSource:null}),xa=(0,i.useRef)(!1),ja=(0,i.useRef)(null),za=(0,i.useRef)(!1),Aa=(0,i.useRef)(null),Ta=(0,i.useCallback)(e=>{Aa.current&&Aa.current(e)},[]),{triggerAutosave:Pa,cancelAutosave:La}=Fa(Ta,{delay:3e3,enabled:!ba.disableAutosave&&ma,dependencies:[ba.disableAutosave,ma,Kn.faktury]}),[Ba,Ja]=(0,i.useState)(!1),[Qa,eo]=(0,i.useState)(""),[no,ao]=(0,i.useState)({saved:[],server:[],fetchStatus:{status:null,error:null},loading:!1,showSaveModal:!1,name:"",type:"po",saveChecked:!1,saveMode:"new",selectedTarget:null,selectedTargetTs:null,showDeleteConfirm:!1,pendingDelete:null}),[oo,to]=(0,i.useState)({phase1:!1,phase2:!1,phase3:!1,registr:!1,potvrzeni:!1,cancelPublish:!1,fakturace:!1,dokonceni:!1,storno:!1}),[ro,io]=(0,i.useState)({loading:!1,showAddForm:!1,editing:null,formData:{fa_datum_doruceni:Qs(new Date),fa_dorucena:1,fa_castka:"",fa_cislo_vema:"",fa_strediska_kod:[],fa_poznamka:"",fa_splatnost:""}}),[so,lo]=(0,i.useState)({isOpen:!1,fakturaId:null,fakturaNazev:"",pocetPriloh:0}),[co,po]=(0,i.useState)({isOpen:!1,title:"",message:"",onConfirm:null}),[uo,vo]=(0,i.useState)({actionsLog:[],hoveredPreviewKey:null,previewModalData:null,editingId:null,editingName:"",showSearchPredefs:!1,searchPredefs:""}),[_o,mo]=((0,i.useRef)(null),(0,i.useState)({})),[ko,fo]=(0,i.useState)(!1),[ho,yo]=(0,i.useState)({}),[bo,go]=(0,i.useState)({options:[],loading:!1,financovani:{}}),xo=mn.showDialog,jo=e=>kn(n=>(0,t.A)((0,t.A)({},n),{},{showDialog:e})),zo=mn.searchTerm,Ao=e=>kn(n=>(0,t.A)((0,t.A)({},n),{},{searchTerm:e})),wo=mn.results,So=e=>kn(n=>(0,t.A)((0,t.A)({},n),{},{results:e})),Eo=mn.loading,Co=e=>kn(n=>(0,t.A)((0,t.A)({},n),{},{loading:e})),Oo=mn.allContacts,No=e=>kn(n=>(0,t.A)((0,t.A)({},n),{},{allContacts:e})),Do=fn.popupOpen,To=e=>hn(n=>(0,t.A)((0,t.A)({},n),{},{popupOpen:e})),Io=fn.search,Po=e=>hn(n=>(0,t.A)((0,t.A)({},n),{},{search:e})),Ro=fn.results,Lo=e=>hn(n=>(0,t.A)((0,t.A)({},n),{},{results:e})),Vo=fn.loading,Fo=e=>hn(n=>(0,t.A)((0,t.A)({},n),{},{loading:e})),Mo=fn.savingToLocal,Uo=e=>hn(n=>(0,t.A)((0,t.A)({},n),{},{savingToLocal:e})),Zo=fn.scopeInfo,Ko=e=>hn(n=>(0,t.A)((0,t.A)({},n),{},{scopeInfo:e})),Bo=fn.selectedScope,Wo=e=>hn(n=>(0,t.A)((0,t.A)({},n),{},{selectedScope:e})),Ho=fn.selectedUseky,$o=yn.available,Jo=e=>bn(n=>(0,t.A)((0,t.A)({},n),{},{available:e})),Go=yn.loading,qo=e=>bn(n=>(0,t.A)((0,t.A)({},n),{},{loading:e})),Yo=gn.show,Xo=e=>xn(n=>(0,t.A)((0,t.A)({},n),{},{show:e})),Qo=gn.status,et=e=>xn(n=>(0,t.A)((0,t.A)({},n),{},{status:e})),nt=gn.data,at=e=>xn(n=>(0,t.A)((0,t.A)({},n),{},{data:e})),tt=(gn.isOperation,e=>xn(n=>(0,t.A)((0,t.A)({},n),{},{isOperation:e}))),rt=jn.show,it=e=>zn(n=>(0,t.A)((0,t.A)({},n),{},{show:e})),st=jn.progress,dt=e=>zn(n=>(0,t.A)((0,t.A)({},n),{},{progress:e})),lt=jn.text,ct=e=>zn(n=>(0,t.A)((0,t.A)({},n),{},{text:e})),_t=vn.uploading,mt=e=>_n(n=>(0,t.A)((0,t.A)({},n),{},{uploading:e})),kt=vn.dragOver,ft=e=>_n(n=>(0,t.A)((0,t.A)({},n),{},{dragOver:e})),ht=vn.checkingSync,yt=e=>_n(n=>(0,t.A)((0,t.A)({},n),{},{checkingSync:e})),bt=vn.showDeleteDialog,gt=e=>_n(n=>(0,t.A)((0,t.A)({},n),{},{showDeleteDialog:e})),xt=vn.deleteTarget,jt=e=>_n(n=>(0,t.A)((0,t.A)({},n),{},{deleteTarget:e})),zt=vn.showDeleteAllDialog,At=e=>_n(n=>(0,t.A)((0,t.A)({},n),{},{showDeleteAllDialog:e})),wt=Tn.showAddDialog,St=e=>In(n=>(0,t.A)((0,t.A)({},n),{},{showAddDialog:e})),Et=Tn.existingCheck,Ct=e=>In(n=>(0,t.A)((0,t.A)({},n),{},{existingCheck:e})),Ot=Tn.autoFillSource,Nt=e=>In(n=>(0,t.A)((0,t.A)({},n),{},{autoFillSource:e})),Dt=Pn.open,Tt=e=>Rn(n=>(0,t.A)((0,t.A)({},n),{},{open:e})),It=Pn.orderData,Pt=e=>Rn(n=>(0,t.A)((0,t.A)({},n),{},{orderData:e})),Rt=Ln.ciselniky,Lt=Ln.formData,Vt=(Ln.initializing,e=>Vn(n=>(0,t.A)((0,t.A)({},n),{},{initializing:e}))),Ft=Ln.initialized,Mt=e=>Vn(n=>(0,t.A)((0,t.A)({},n),{},{initialized:e})),Ut=Ln.error,Zt=ba.saving,Kt=e=>ga(n=>(0,t.A)((0,t.A)({},n),{},{saving:e})),Bt=(ba.savingDraft,e=>ga(n=>(0,t.A)((0,t.A)({},n),{},{savingDraft:e}))),Wt=ba.disableAutosave,Ht=e=>{ga(n=>(0,t.A)((0,t.A)({},n),{},{disableAutosave:e})),xa.current=e},$t=ba.lastAutoSave,Jt=e=>ga(n=>(0,t.A)((0,t.A)({},n),{},{lastAutoSave:e})),Gt=ba.autoSaving,qt=e=>ga(n=>(0,t.A)((0,t.A)({},n),{},{autoSaving:e})),Yt=ba.dataSource,Xt=e=>ga(n=>(0,t.A)((0,t.A)({},n),{},{dataSource:e})),Qt=sn.details,er=sn.loading,nr=e=>dn(n=>(0,t.A)((0,t.A)({},n),{},{loading:e})),ar=ln.list,or=e=>cn(n=>(0,t.A)((0,t.A)({},n),{},{list:e})),tr=ln.loadingList,rr=e=>cn(n=>(0,t.A)((0,t.A)({},n),{},{loadingList:e})),ir=ln.detail,sr=e=>cn(n=>(0,t.A)((0,t.A)({},n),{},{detail:e})),dr=ln.loadingDetail,lr=e=>cn(n=>(0,t.A)((0,t.A)({},n),{},{loadingDetail:e})),cr=ln.searchTerm,pr=e=>cn(n=>(0,t.A)((0,t.A)({},n),{},{searchTerm:e})),ur=ln.showSuggestions,vr=e=>cn(n=>(0,t.A)((0,t.A)({},n),{},{showSuggestions:e})),_r=ln.selectedSuggestionIndex,mr=e=>cn(n=>(0,t.A)((0,t.A)({},n),{},{selectedSuggestionIndex:e})),kr=no.saved,fr=e=>ao(n=>(0,t.A)((0,t.A)({},n),{},{saved:e})),hr=no.server,yr=e=>ao(n=>(0,t.A)((0,t.A)({},n),{},{server:e})),br=(no.fetchStatus,e=>ao(n=>(0,t.A)((0,t.A)({},n),{},{fetchStatus:e}))),gr=no.loading,xr=e=>ao(n=>(0,t.A)((0,t.A)({},n),{},{loading:e})),jr=no.showSaveModal,zr=e=>ao(n=>(0,t.A)((0,t.A)({},n),{},{showSaveModal:e})),Ar=no.name,wr=e=>ao(n=>(0,t.A)((0,t.A)({},n),{},{name:e})),Sr=no.type,Er=e=>ao(n=>(0,t.A)((0,t.A)({},n),{},{type:e})),Cr=(no.saveChecked,no.saveMode),Or=e=>ao(n=>(0,t.A)((0,t.A)({},n),{},{saveMode:e})),Nr=no.selectedTarget,Dr=e=>ao(n=>(0,t.A)((0,t.A)({},n),{},{selectedTarget:e})),Tr=(no.selectedTargetTs,no.showDeleteConfirm),Ir=e=>ao(n=>(0,t.A)((0,t.A)({},n),{},{showDeleteConfirm:e})),Pr=no.pendingDelete,Rr=e=>ao(n=>(0,t.A)((0,t.A)({},n),{},{pendingDelete:e})),Lr=oo.phase1,Vr=e=>to(n=>(0,t.A)((0,t.A)({},n),{},{phase1:e})),Fr=oo.phase2,Mr=e=>to(n=>(0,t.A)((0,t.A)({},n),{},{phase2:e})),Ur=oo.phase3,Zr=e=>to(n=>(0,t.A)((0,t.A)({},n),{},{phase3:e})),Kr=oo.registr,Br=e=>to(n=>(0,t.A)((0,t.A)({},n),{},{registr:e})),Wr=oo.potvrzeni,Hr=e=>to(n=>(0,t.A)((0,t.A)({},n),{},{potvrzeni:e})),$r=oo.cancelPublish,Jr=e=>to(n=>(0,t.A)((0,t.A)({},n),{},{cancelPublish:e})),Gr=oo.fakturace,qr=e=>to(n=>(0,t.A)((0,t.A)({},n),{},{fakturace:e})),Yr=oo.dokonceni,Xr=e=>to(n=>(0,t.A)((0,t.A)({},n),{},{dokonceni:e})),Qr=oo.storno,ei=e=>to(n=>(0,t.A)((0,t.A)({},n),{},{storno:e})),ni=ro.loading,ai=(ro.showAddForm,ro.editing),oi=e=>io(n=>(0,t.A)((0,t.A)({},n),{},{editing:e})),ti=ro.formData,ri=e=>io(n=>(0,t.A)((0,t.A)({},n),{},{formData:e})),ii=(uo.actionsLog,uo.hoveredPreviewKey,uo.previewModalData),si=e=>vo(n=>(0,t.A)((0,t.A)({},n),{},{previewModalData:e})),di=uo.editingId,li=e=>vo(n=>(0,t.A)((0,t.A)({},n),{},{editingId:e})),ci=uo.editingName,pi=e=>vo(n=>(0,t.A)((0,t.A)({},n),{},{editingName:e})),ui=uo.showSearchPredefs,vi=uo.searchPredefs,_i=bo.options,mi=e=>go(n=>(0,t.A)((0,t.A)({},n),{},{options:e}));bo.loading,bo.financovani;(0,i.useEffect)(()=>{if(!_i||0===_i.length||!Se||!we)return;(async()=>{const e={};for(const o of _i)try{const n=await(0,me.WZ)({token:Se,username:we,cislo_lp:o.kod});n&&(e[o.id]={limit:parseFloat(n.celkovy_limit)||0,cerpano:parseFloat(n.skutecne_cerpano)||0,zbyva:parseFloat(n.zbyva_skutecne)||0})}catch(a){console.warn("Nelze na\u010d\xedst stav LP ".concat(o.kod,":"),a.message)}var n;n=e,go(e=>(0,t.A)((0,t.A)({},e),{},{financovani:n}))})()},[_i,Se,we]);const ki=(0,i.useCallback)(async(e,n)=>{try{var a,o,t,r,i;const n=e.stav_workflow_kod?"string"===typeof e.stav_workflow_kod?JSON.parse(e.stav_workflow_kod):e.stav_workflow_kod:[],p=Array.isArray(n)&&n.includes("SCHVALENA");if(Array.isArray(n)&&n.includes("ODESLANA"))return null;const u=null===(a=e.zpusob_financovani)||void 0===a?void 0:a.toLowerCase().includes("smlouva");if(!p&&!u)return null;if(!u)return null;if((null===(o=e.dodavatel_nazev)||void 0===o?void 0:o.trim())||(null===(t=e.dodavatel_ico)||void 0===t?void 0:t.trim()))return null;const v=null===(r=e.cislo_smlouvy)||void 0===r?void 0:r.trim();if(!v)return null;let _=[];try{const e=await(0,Ua.iE)({token:Se,username:we,show_inactive:!1,limit:500});null!==e&&void 0!==e&&e.data&&Array.isArray(e.data)&&(_=e.data)}catch(d){return null}const m=_.find(e=>e.cislo_smlouvy===v||e.evidencni_cislo===v);if(!m)return null;const k=null===(i=m.ico)||void 0===i?void 0:i.trim();if(!k||k.length<8)return{dodavatel_nazev:m.nazev_firmy||"",dodavatel_ico:"",source:"smlouva-fallback"};try{const e=await(0,me.d0)({token:Se,username:we,ico:k});if(null!==e&&void 0!==e&&e.data&&Array.isArray(e.data)&&e.data.length>0){const n=e.data[0];return{dodavatel_nazev:n.nazev||n.name||m.nazev_firmy||"",dodavatel_adresa:n.adresa||n.address||"",dodavatel_ico:n.ico||k,dodavatel_dic:n.dic||"",dodavatel_zastoupeny:n.zastoupeny||n.represented||"",dodavatel_kontakt_jmeno:n.kontakt_jmeno||"",dodavatel_kontakt_email:n.kontakt_email||n.email||"",dodavatel_kontakt_telefon:n.kontakt_telefon||n.telefon||"",source:"local"}}}catch(l){}try{const e="https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/".concat(k),n=await fetch(e,{method:"GET",headers:{Accept:"application/json"}});if(n.ok){var s;const e=await n.json();return{dodavatel_nazev:e.obchodniJmeno||m.nazev_firmy||"",dodavatel_adresa:(null===(s=e.sidlo)||void 0===s?void 0:s.textovaAdresa)||"",dodavatel_ico:e.ico||k,dodavatel_dic:e.dic||"",dodavatel_zastoupeny:"",dodavatel_kontakt_jmeno:"",dodavatel_kontakt_email:"",dodavatel_kontakt_telefon:"",source:"ares"}}}catch(c){}return{dodavatel_nazev:m.nazev_firmy||"",dodavatel_ico:k,source:"smlouva"}}catch(p){return null}},[Se,we]),fi=(0,i.useCallback)(async(e,n)=>{const a=He||(null===e||void 0===e?void 0:e.id)||"NEW";if(Ve.current===a)return void 0;Ve.current=a,setTimeout(()=>{Ve.current===a&&(Ve.current=null)},5e3);const o=!He;o&&(ka(!0),Mt(!0)),null!==e&&void 0!==e&&e.id&&(Mn(!0),Da.default.saveMetadata({editOrderId:String(e.id)})),He&&(Mn(!0),Da.default.saveMetadata({editOrderId:String(He)}));let r=e||{};const i=e&&Object.keys(e).length>0;if(Ae)try{Da.default.setCurrentUser(Ae);if(await Da.default.hasDraft()){const n=await Da.default.loadDraft();if(null!==n&&void 0!==n&&n.formData){var s;const a=n.formData.id||(null===(s=n.formData)||void 0===s?void 0:s.id),o=He||(null===e||void 0===e?void 0:e.id);a&&(Mn(!0),Da.default.saveMetadata({editOrderId:String(a)})),o&&a&&String(a)!==String(o)?console.warn("\u26a0\ufe0f Draft pat\u0159\xed k jin\xe9 objedn\xe1vce, ignoruji:",{draftOrderId:a,currentOrderId:o}):r=i?(0,t.A)((0,t.A)((0,t.A)({},e),n.formData),{},{id:e.id,ev_cislo:e.ev_cislo||e.cislo_objednavky,cislo_objednavky:e.cislo_objednavky,datum_vytvoreni:e.datum_vytvoreni,datum_posledni_zmeny:e.datum_posledni_zmeny,faktury:n.formData.faktury&&n.formData.faktury.length>0?n.formData.faktury:e.faktury||[]}):n.formData}}}catch(c){console.error("\u274c Chyba p\u0159i na\u010d\xedt\xe1n\xed draftu:",c)}let d=!1;if(Object.keys(r).length>0){const e=$a(r.stav_workflow_kod);try{const n=await ki(r,e);n&&(r=(0,t.A)((0,t.A)({},r),n),Nt(n.source),d=!0)}catch(c){}}if(Object.keys(r).length>0){var l;if(Wn(r),null!==e&&void 0!==e&&null!==(l=e.financovani)&&void 0!==l&&l.lp_nazvy&&Array.isArray(e.financovani.lp_nazvy)){const n=e.financovani.lp_nazvy.map(e=>({id:e.id,kod:e.cislo_lp||e.kod||"LP".concat(e.id),nazev:e.nazev||"Bez n\xe1zvu",kategorie:e.kategorie,limit:e.limit||e.celkovy_limit,cerpano:e.cerpano||e.skutecne_cerpano,zbyva:e.zbyva||e.zbyva_skutecne,rok:e.rok,label:"".concat(e.cislo_lp||e.kod||"LP".concat(e.id)," - ").concat(e.nazev||"Bez n\xe1zvu")})).sort((e,n)=>e.nazev.localeCompare(n.nazev,"cs"));mi(n)}else if(r.lp_kod&&Array.isArray(r.lp_kod)&&r.lp_kod.length>0)try{let e=Ni||[];if(!Ni||0===Ni.length)try{e=await(0,me.Hy)({token:Se,username:we})}catch(p){console.error("\u274c Chyba na\u010d\xedt\xe1n\xed LP mapov\xe1n\xed:",p),e=[]}const n=(await Promise.all(r.lp_kod.map(async n=>{let a=n;const o=n;try{if(e&&e.length>0){const o=e.find(e=>e.id===n||e.id===Number(n)||e.kod===n||e.cislo_lp===n);o?a=o.cislo_lp||o.kod||n:console.warn("\u26a0\ufe0f LP ".concat(n," nebylo nalezeno v LP mapov\xe1n\xed (").concat(e.length," z\xe1znam\u016f)"))}else console.warn("\u26a0\ufe0f LP mapov\xe1n\xed nen\xed dostupn\xe9, zkus\xedm hodnotu p\u0159\xedmo:",n);const t=await(0,me.WZ)({token:Se,username:we,cislo_lp:a});return t&&t.id?{id:t.id,kod:t.cislo_lp||t.kod||"LP".concat(t.id),nazev:t.nazev_uctu||t.nazev||"Bez n\xe1zvu",kategorie:t.kategorie,limit:t.celkovy_limit||0,cerpano:t.skutecne_cerpano||0,zbyva:t.zbyva_skutecne||0,rok:t.rok,label:"".concat(t.cislo_lp||t.kod||"LP".concat(t.id)," - ").concat(t.nazev_uctu||t.nazev||"Bez n\xe1zvu")}:(console.warn("\u26a0\ufe0f LP ".concat(a," (ID: ").concat(o,") nebylo nalezeno nebo nem\xe1 platn\xe1 data")),null)}catch(p){return console.error("\u274c Chyba na\u010d\xedt\xe1n\xed LP ".concat(a," (ID: ").concat(o,"):"),p),null}}))).filter(e=>null!==e).sort((e,n)=>e.nazev.localeCompare(n.nazev,"cs"));mi(n)}catch(p){console.error("\u274c Chyba p\u0159i na\u010d\xedt\xe1n\xed LP z API:",p),mi([])}else mi([]);if(r.id&&(Hn.current=JSON.parse(JSON.stringify(r))),d&&He&&Da.default)try{Da.default.setCurrentUser(Ae),await Da.default.saveDraft(r,{orderId:parseInt(He)})}catch(u){}r.ev_cislo&&"Na\u010d\xedt\xe1m..."!==r.ev_cislo&&window.__orderForm_hasLoadedNextNumberRef&&(window.__orderForm_hasLoadedNextNumberRef.current=!0),Mt(!0)}o||(ka(!0),Da.default.setAutosaveEnabled(!0,"EDIT order initialization"),ya({isEditMode:!0,isNewOrder:!1,orderId:r.id||He,orderNumber:r.cislo_objednavky||r.ev_cislo||""}))},[He,Ae,Da.default,Wn,Mn,ka,Mt,ki,Nt,ya]),hi=(0,i.useCallback)(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const a={error:{bg:"#fff1f0",color:"#d32f2f",icon:(0,ke.jsx)(m.A,{size:18,color:"#ff4d4f"})},success:{bg:"#f0f9ff",color:"#0d7d3e",icon:(0,ke.jsx)(k.A,{size:18,color:"#10b981"})},warning:{bg:"#fff7e6",color:"#d46b08",icon:(0,ke.jsx)(f.A,{size:18,color:"#f59e0b"})},info:{bg:"#f5f5f5",color:"#4b5563",icon:(0,ke.jsx)(h.A,{size:18,color:"#6b7280"})}},o=a[n]||a.info;return(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"10px",padding:"4px",fontFamily:"system-ui, -apple-system, sans-serif"},children:[(0,ke.jsx)("div",{style:{flexShrink:0,marginTop:"2px"},children:o.icon}),(0,ke.jsx)("div",{style:{flex:1,fontSize:"14px",lineHeight:"1.5",color:o.color},children:e})]})},[]),yi=(0,i.useCallback)(e=>{null===je||void 0===je||je(hi("Nepoda\u0159ilo se na\u010d\xedst formul\xe1\u0159: ".concat(e.message),"error"),{type:"error"})},[hi]),bi=(0,i.useCallback)(()=>{},[]),gi=ot({token:Se,username:we,userId:Ae,editOrderId:He,archivovanoParam:$e,onDataLoaded:fi,onError:yi,onReady:bi}),{lifecycle:xi,dictionaries:ji,orderDataLoader:zi,ui:Ai}=gi,wi=(null===(e=ji.data)||void 0===e?void 0:e.allUsers)||[],Si=(null===(n=ji.data)||void 0===n?void 0:n.approvers)||[],Ei=(null===(a=ji.data)||void 0===a?void 0:a.strediskaOptions)||[],Ci=(null===(r=ji.data)||void 0===r?void 0:r.financovaniOptions)||[],Oi=(null===(l=ji.data)||void 0===l?void 0:l.druhyObjednavkyOptions)||[],Ni=(null===(c=ji.data)||void 0===c||c.druhyObjednavkyRawData,(null===(v=ji.data)||void 0===v?void 0:v.lpKodyOptions)||[]),Di=(null===(g=ji.data)||void 0===g?void 0:g.prilohyTypyOptions)||[],Ti=(null===(V=ji.data)||void 0===V?void 0:V.typyFakturOptions)||[],Ii=(null===(F=ji.data)||void 0===F?void 0:F.stavyWorkflowMap)||{},Pi=i.useMemo(()=>{if(!Kn.druh_objednavky_kod)return!1;const e=Oi.find(e=>e.kod_stavu&&e.kod_stavu===Kn.druh_objednavky_kod||e.kod&&e.kod===Kn.druh_objednavky_kod||e.value&&e.value===Kn.druh_objednavky_kod);return 1===(null===e||void 0===e?void 0:e.atribut_objektu)},[Kn.druh_objednavky_kod,Oi]),Ri=i.useCallback(e=>{if(!e||0===Object.keys(e).length)return null;console.log("\ud83d\udcdd formatValidationErrors - vstup:",{errorKeys:Object.keys(e),errorCount:Object.keys(e).length,errors:e});const n={objednatel:{label:"Informace o objednateli",errors:[]},schvaleni:{label:"Schv\xe1len\xed n\xe1kupu PO",errors:[]},dodavatel:{label:"Dodavatel",errors:[]},detaily:{label:"Detaily objedn\xe1vky",errors:[]},stav_odeslani:{label:"Odesl\xe1n\xed objedn\xe1vky",errors:[]},potvrzeni_objednavky:{label:"Potvrzen\xed objedn\xe1vky dodavatelem",errors:[]},fakturace:{label:"Fakturace",errors:[]},vecna_spravnost:{label:"V\u011bcn\xe1 spr\xe1vnost",errors:[]},registr_smluv_vyplneni:{label:"Registr smluv",errors:[]},ostatni:{label:"Ostatn\xed",errors:[]}};return Object.entries(e).forEach(e=>{let[a,o]=e,t=o;a.includes("jmeno")||a.includes("email")||a.includes("ev_cislo")||a.includes("garant")?n.objednatel.errors.push(t):a.includes("prikazce")||a.includes("max_cena")||a.includes("strediska")||a.includes("predmet")||a.includes("financovani")||a.includes("lp_kod")||a.includes("cislo_smlouvy")||a.includes("individualni_schvaleni")||a.includes("pojistna_udalost")?n.schvaleni.errors.push(t):a.startsWith("polozka_")||a.includes("druh_objednavky")||o.includes("Polo\u017eka")?n.detaily.errors.push(t):a.includes("zpusob_potvrzeni")||a.includes("dt_akceptace")||a.includes("zpusob_platby")?n.potvrzeni_objednavky.errors.push(t):a.includes("dodavatel")||a.includes("ico")||a.includes("adresa")||a.includes("kontakt")?n.dodavatel.errors.push(t):a.includes("datum_odeslani")||a.includes("stav_odeslani")?n.stav_odeslani.errors.push(t):a.startsWith("faktura_")&&a.includes("vecna_spravnost")?n.vecna_spravnost.errors.push(t):a.startsWith("faktura_")?n.fakturace.errors.push(t):a.includes("dt_zverejneni")||a.includes("registr")||a.includes("ma_byt_zverejnena")?n.registr_smluv_vyplneni.errors.push(t):n.ostatni.errors.push(t)}),(0,ke.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,ke.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"12px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,ke.jsx)(m.A,{size:20,color:"#ff4d4f",style:{flexShrink:0}}),(0,ke.jsx)("span",{children:"Pro ulo\u017een\xed je nutn\xe9 vyplnit n\xe1sleduj\xedc\xed polo\u017eky:"})]}),Object.values(n).map((e,n)=>e.errors.length>0&&(0,ke.jsxs)("div",{style:{marginBottom:"10px",padding:"10px",backgroundColor:"#fff1f0",borderRadius:"4px"},children:[(0,ke.jsx)("div",{style:{fontWeight:"600",fontSize:"13px",color:"#d32f2f",marginBottom:"6px"},children:e.label}),e.errors.map((e,n)=>(0,ke.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginLeft:"8px",marginTop:"4px",display:"flex",alignItems:"flex-start"},children:[(0,ke.jsx)("span",{style:{marginRight:"6px",color:"#ff4d4f",fontWeight:"bold"},children:"\u2022"}),(0,ke.jsx)("span",{children:e})]},n))]},n))]})},[]),Li=(i.useMemo(()=>{const e=[...Di,...Ti],n=new Map;return e.forEach(e=>{n.has(e.value)||n.set(e.value,e)}),Array.from(n.values())},[Di,Ti]),ji.isReady),[Vi,Fi]=(0,i.useState)(()=>wi.filter(e=>1===e.aktivni||"1"===e.aktivni||1===e.active||"1"===e.active)),Mi=(0,i.useMemo)(()=>"0"===Kn.prikazce_id||"0"===Kn.schvalovatel_id?[{id:"0",jmeno:"SYSTEM",prijmeni:"",displayName:"SYSTEM",aktivni:1,deaktivovan:0},...Si]:Si,[Si,Kn.prikazce_id,Kn.schvalovatel_id]),Ui=Ti;(0,i.useEffect)(()=>{const e=!He;ka(!1),e&&Ae&&(ka(!0),Da.default.setAutosaveEnabled(!0,"NEW order initialization"))},[He,Ae]),(0,i.useEffect)(()=>{if(Kn.polozky_objednavky&&Array.isArray(Kn.polozky_objednavky)){const e={},n=Pi;Kn.polozky_objednavky.forEach(a=>{const o=a.usek_kod&&""!==a.usek_kod.trim()||a.budova_kod&&""!==a.budova_kod.trim()||a.mistnost_kod&&""!==a.mistnost_kod.trim()||a.poznamka&&""!==a.poznamka.trim();e[a.id]=!(!n&&!o)}),yo(e)}},[null===(M=Kn.polozky_objednavky)||void 0===M?void 0:M.length,Kn.druh_objednavky_kod,Pi,JSON.stringify(null===(U=Kn.polozky_objednavky)||void 0===U?void 0:U.map(e=>({id:e.id,usek:e.usek_kod,budova:e.budova_kod,mistnost:e.mistnost_kod,poznamka:e.poznamka})))]),(0,i.useEffect)(()=>{Kn.cislo_smlouvy&&Kn.cislo_smlouvy!==cr&&pr(Kn.cislo_smlouvy)},[Kn.cislo_smlouvy,cr]);const[Zi,Ki]=(0,i.useState)(!1),[Bi,Wi]=(0,i.useState)(!1);(0,i.useEffect)(()=>()=>{if(ma&&Ae&&Kn){if(!(Object.keys(Kn).length>=40))return;try{Da.default.setCurrentUser(Ae),Da.default.saveDraft(Kn,{orderId:Kn.id||null})}catch(e){}}},[]),(0,i.useEffect)(()=>{if(!Ae||!ma||He)return;let e=!0;return(async()=>{try{var n;Da.default.setCurrentUser(Ae);if(!await Da.default.hasDraft())return;const a=await Da.default.loadDraft();if(null===a||void 0===a||!a.formData||!e)return;if(a.formData.id){const n=await Da.default.checkDBSync(async e=>{try{return await(0,Ia.jq)(e,Se,we)}catch(n){return null}},async e=>{try{const n=await(0,Ia.Hj)(e,Se,we);return(null===n||void 0===n?void 0:n.data)||null}catch(a){var n;return 403!==(null===a||void 0===a?void 0:a.status)&&403!==(null===a||void 0===a||null===(n=a.response)||void 0===n?void 0:n.status)||console.warn("\u26d4 HIERARCHY: P\u0159\xedstup k objedn\xe1vce zam\xedtnut hierarchi\xed"),null}});if(!e)return;if(n.needsSync&&n.dbData){const e=(0,t.A)({},n.dbData);return e.polozky_objednavky&&0!==e.polozky_objednavky.length||Kn.polozky_objednavky&&Kn.polozky_objednavky.length>0&&(e.polozky_objednavky=Kn.polozky_objednavky),Wn(e),_a(!1),Mn(!0),ya({isEditMode:!0,isNewOrder:!1,orderId:n.dbData.id,orderNumber:n.dbData.cislo_objednavky||n.dbData.ev_cislo}),void await Da.default.syncWithDatabase(n.dbData,n.dbData.id)}}const o=(0,t.A)({},a.formData);o.faktury&&Array.isArray(o.faktury)&&(o.faktury=o.faktury.map(e=>(e.fa_strediska_kod&&Array.isArray(e.fa_strediska_kod)&&(e.fa_strediska_kod=e.fa_strediska_kod.map(e=>"string"===typeof e?e:e.value||e.kod_stavu||e.id||e)),e))),Wn(e=>{var n,r;return(0,t.A)((0,t.A)((0,t.A)({},e),o),{},{id:(null===e||void 0===e?void 0:e.id)||a.formData.id,datum_posledni_zmeny:(null===e||void 0===e?void 0:e.datum_posledni_zmeny)||a.formData.datum_posledni_zmeny,stav_schvaleni:o.stav_schvaleni||(null===e||void 0===e?void 0:e.stav_schvaleni)||"",strediska_kod:o.strediska_kod&&Array.isArray(o.strediska_kod)&&o.strediska_kod.length>0?o.strediska_kod:(null===e||void 0===e?void 0:e.strediska_kod)||[],dodavatel_zpusob_potvrzeni:(null===(n=o.dodavatel_zpusob_potvrzeni)||void 0===n||null===(r=n.zpusoby)||void 0===r?void 0:r.length)>0?o.dodavatel_zpusob_potvrzeni:(null===e||void 0===e?void 0:e.dodavatel_zpusob_potvrzeni)||o.dodavatel_zpusob_potvrzeni})}),_a(!0===a.isChanged),(a.formData.id||null!==(n=a.formData)&&void 0!==n&&n.id)&&(Mn(!0),ya({isEditMode:!0,isNewOrder:!1,orderId:a.formData.id,orderNumber:a.formData.cislo_objednavky||a.formData.ev_cislo}))}catch(a){}})(),()=>{e=!1}},[Ae,ma,He]);const Hi=(0,i.useMemo)(()=>!!Kn.id,[Kn.id]),$i=((0,i.useMemo)(()=>(Array.isArray(Kn.stav_workflow_kod)?Kn.stav_workflow_kod:aa(Kn.stav_workflow_kod)).includes("SCHVALENA"),[Kn.stav_workflow_kod]),qa(Xn,Gn,$n)),Ji=e=>({objednatel:"section-grey",schvaleni:"section-grey",financovani:"section-orange",dodavatel:"section-orange",detaily:"section-orange",dodaci_podminky:"section-orange",stav_odeslani:"section-orange",prilohy:"section-red",potvrzeni_objednavky:"section-blue",registr_smluv:"section-blue",prubeh_objednavky:"section-blue",dodaci_informace:"section-blue",fakturace:"section-blue",storno_detail:"section-blue",registr_smluv_vyplneni:"section-purple"}[e]||"section-orange"),Gi=Oe&&(Oe("ORDER_MANAGE")||Oe("ORDER_APPROVE")||Oe("ORDER_EDIT_OWN")||Oe("ORDER_EDIT_ALL")),qi=(0,i.useCallback)(e=>{const n=Gn;if(1===n){const n=["financovani","detaily"];return!!["objednatel","schvaleni"].includes(e)||!(!Gi||!n.includes(e))}return 2===n?["financovani","dodavatel","detaily","dodaci_podminky","prilohy","stav_odeslani"].includes(e):n>=3&&["potvrzeni_objednavky","registr_smluv","prubeh_objednavky","dodaci_informace","fakturace","storno_detail"].includes(e)},[Gn,Gi]),Yi=Oe&&Oe("ORDER_APPROVE"),Xi=Oe&&Oe("ORDER_MANAGE"),Qi=Oe&&Oe("USER_MANAGE"),es=Oe&&(Oe("ORDER_MANAGE")||Oe("ORDER_EDIT_OWN")||Oe("ORDER_EDIT_ALL")),ns=Yi||Xi,as=Oe&&Oe("ORDER_PUBLISH_REGISTRY"),os=Oe&&Oe("INVOICE_MANAGE"),ts=Oe&&(Oe("ORDER_MANAGE")||Oe("ORDER_EDIT_OWN")||Oe("ORDER_EDIT_ALL")),rs=null===ze||void 0===ze||null===(Z=ze.roles)||void 0===Z?void 0:Z.some(e=>"SUPERADMIN"===e.kod_role),is=null===ze||void 0===ze||null===(K=ze.roles)||void 0===K?void 0:K.some(e=>"ADMINISTRATOR"===e.kod_role),ss=Oe&&Oe("ORDER_MANAGE"),ds=rs||is||ss,ls=i.useMemo(()=>{var e;if(!Kn.prikazce_id)return Ni;const n=Mi.find(e=>(e.id||e.user_id)===parseInt(Kn.prikazce_id));if(!n)return console.warn("\u26a0\ufe0f P\u0159\xedkazce nenalezen v approvers!"),Ni;const a=wi.find(e=>(e.id||e.user_id)===parseInt(Kn.prikazce_id));if(null===a||void 0===a||null===(e=a.roles)||void 0===e?void 0:e.some(e=>"SUPERADMIN"===e.kod_role)){const e=new Date;return e.setHours(0,0,0,0),Ni.filter(n=>{const a=n.platne_od?new Date(n.platne_od):null,o=n.platne_do?new Date(n.platne_do):null;return a&&a.setHours(0,0,0,0),o&&o.setHours(0,0,0,0),(!a||a<=e)&&(!o||o>=e)})}const o=n.usek_id;if(!o)return console.warn("\u26a0\ufe0f P\u0159\xedkazce nem\xe1 usek_id:",n),Ni;const t=new Date;t.setHours(0,0,0,0);const r=Ni.filter(e=>{const n=e.usek_id||e.usek;if(!n||String(n)!==String(o))return!1;const a=e.platne_od?new Date(e.platne_od):null,r=e.platne_do?new Date(e.platne_do):null;a&&a.setHours(0,0,0,0),r&&r.setHours(0,0,0,0);return(!a||a<=t)&&(!r||r>=t)});return console.log("\ud83c\udfaf LP filtrov\xe1n\xed:",{prikazce:"".concat(n.jmeno," ").concat(n.prijmeni),prikazceUsekId:o,dnesniDatum:t.toISOString().split("T")[0],vsechnyLP:Ni.length,filtrovaneLP:r.length,filtrovaneKody:r.map(e=>({kod:e.cislo_lp||e.kod,platneOd:e.platne_od,platneDo:e.platne_do}))}),r},[Kn.prikazce_id,Ni,Mi,wi]),cs=(0,i.useMemo)(()=>ra,[ra]),ps=(0,i.useMemo)(()=>Jn.getAllSectionStates(),[Gn,Kn.id,$n,Kn.stav_workflow_kod,Kn.potvrzeni_dokonceni_objednavky,Jn]),us=(0,i.useMemo)(()=>({id:Kn.id,faktury:Kn.faktury,max_cena_s_dph:Kn.max_cena_s_dph}),[Kn.id,Kn.faktury,Kn.max_cena_s_dph]),vs=(0,i.useMemo)(()=>{var e,n;const a=(0,t.A)({},ps);Kn.id&&(a.prilohy={visible:!0,enabled:!cs});const o="pokladna"===(null===(e=Kn.financovani)||void 0===e?void 0:e.platba),r="pokladna"===(null===(n=Kn.dodavatel_zpusob_potvrzeni)||void 0===n?void 0:n.platba),i=o||r,s=Kn.faktury&&Kn.faktury.length>0;a.fakturace&&(a.fakturace=(0,t.A)((0,t.A)({},a.fakturace),{},{visible:!i&&(os?Gn>=6:Gn>=7||s)}));const d=Kn.dt_zverejneni&&Kn.registr_iddt;return a.registr_smluv_vyplneni&&(a.registr_smluv_vyplneni=(0,t.A)((0,t.A)({},a.registr_smluv_vyplneni),{},{visible:a.registr_smluv_vyplneni.visible&&(as||d)})),a.dokonceni&&ds&&Gn>=8&&(a.dokonceni=(0,t.A)((0,t.A)({},a.dokonceni),{},{visible:!0})),a},[ps,Gn,os,as,null===(B=Kn.financovani)||void 0===B?void 0:B.platba,null===(W=Kn.dodavatel_zpusob_potvrzeni)||void 0===W?void 0:W.platba,Kn.faktury,Kn.dt_zverejneni,Kn.registr_iddt,Kn.id,cs,ds]),_s=(0,i.useCallback)(e=>!e.enabled||rt||Zt,[rt,Zt]),ms=ps.registr_smluv,ks=!ms.enabled,fs=ps.registr_smluv_vyplneni,hs=!fs.enabled,ys=ps.potvrzeni_objednavky,bs=!ys.enabled,gs=_s(ps.objednatel),xs=_s(ps.schvaleni),js=!$n&&Gn>=3&&!Jn.isSectionUnlocked("phase2"),zs=ps.financovani,As=_s(zs),ws=_s(ps.dodavatel),Ss=_s(ys),Es=ps.fakturace,Cs=!Es.enabled&&(Gn>=8||oa(Kn.stav_workflow_kod,"FAKTURACE")),Os=!Es.enabled,Ns=ps.dokonceni,Ds=(Ns.enabled,oa(Kn.stav_workflow_kod,"DOKONCENA")),Ts=Ds&&!Jn.isSectionUnlocked("dokonceni"),Is=oa(Kn.stav_workflow_kod,"ZKONTROLOVANA"),Ps=Gn<7||Gn>=8||Is||Ts||$n;oa(Kn.stav_workflow_kod,"ODESLANA"),oa(Kn.stav_workflow_kod,"ZRUSENA");(0,i.useEffect)(()=>{He&&(ka(!1),Mt(!1),Ve.current=null)},[He,Se,we]),(0,i.useEffect)(()=>{},[He,Se,we,ma,Li]);const Rs=(0,i.useRef)({isSuperAdmin:!1,isAdmin:!1});(0,i.useEffect)(()=>{var e,n;const a=null===ze||void 0===ze||null===(e=ze.roles)||void 0===e?void 0:e.some(e=>"SUPERADMIN"===e.kod_role),o=null===ze||void 0===ze||null===(n=ze.roles)||void 0===n?void 0:n.some(e=>"ADMINISTRATOR"===e.kod_role);Rs.current={isSuperAdmin:a,isAdmin:o}},[ze]),(0,i.useEffect)(()=>{if(ca&&ma&&!Kn.jmeno&&ze&&Ae){const e="".concat(ze.titul_pred?ze.titul_pred+" ":"").concat(ze.jmeno||""," ").concat(ze.prijmeni||"").concat(ze.titul_za?", "+ze.titul_za:"").replace(/\s+/g," ").trim();Wn(n=>(0,t.A)((0,t.A)({},n),{},{jmeno:e,email:ze.email||"",telefon:ze.telefon||"",uzivatel_id:Ae,objednatel_id:Ae}))}},[ca,ma,Kn.jmeno,ze,Ae]),(0,i.useEffect)(()=>()=>{},[]),(0,i.useEffect)(()=>{Kn.id&&(ko||(mo({}),nn(new Set)),Ae&&Kn.ev_cislo&&Da.default.saveMetadata({openConceptNumber:Kn.ev_cislo}))},[Kn.id]);const Ls=(0,i.useRef)(!1),Vs=(0,i.useRef)(Gn);(0,i.useEffect)(()=>{var e;const n=(null===(e=Kn.polozky_objednavky)||void 0===e?void 0:e.length)||0;ma&&(Vs.current!==Gn&&(Ls.current=!1,Vs.current=Gn),Gn>=3&&0===n&&!Ls.current&&(Ls.current=!0,Wn(e=>(0,t.A)((0,t.A)({},e),{},{polozky_objednavky:[{id:"new_item_".concat(Date.now()),popis:"",mnozstvi:"1",jednotka:"ks",cena_bez_dph:"",sazba_dph:"21",cena_s_dph:""}]}))))},[Gn,ma,Kn.druh_objednavky_kod,null===(H=Kn.polozky_objednavky)||void 0===H?void 0:H.length]),(0,i.useEffect)(()=>{if(!Kn.polozky_objednavky||0===Kn.polozky_objednavky.length)return;if(4!==Gn)return;const e=Kn.dodavatel_zpusob_potvrzeni;if(!("ANO"===(null===e||void 0===e?void 0:e.potvrzeni)||!0===(null===e||void 0===e?void 0:e.potvrzeno)))return;if(oa(Kn.stav_workflow_kod,"UVEREJNIT"))return;if(oa(Kn.stav_workflow_kod,"NEUVEREJNIT"))return;if(void 0!==Kn.ma_byt_zverejnena&&null!==Kn.ma_byt_zverejnena)return;const n=Kn.polozky_objednavky.reduce((e,n)=>e+(parseFloat((n.cena_bez_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0)*(parseFloat(n.mnozstvi)||1),0),a=n>5e4;Wn(e=>(0,t.A)((0,t.A)({},e),{},{ma_byt_zverejnena:a})),Bs("info","REGISTR","auto-detect","Cena ".concat(n.toFixed(2)," K\u010d ").concat(a?">":"\u2264",' 50 000 K\u010d \u2192 v\xfdchoz\xed hodnota "M\xe1 b\xfdt zve\u0159ejn\u011bna" = ').concat(a))},[Gn,Kn.polozky_objednavky,Kn.dodavatel_zpusob_potvrzeni,Kn.stav_workflow_kod,Kn.ma_byt_zverejnena]);const Fs=(0,i.useCallback)(e=>{Wn(n=>(0,t.A)((0,t.A)({},n),{},{faktury:e})),_a(!0)},[]);(0,i.useEffect)(()=>{if(!Kn.zpusob_financovani||!Ci.length)return;const e=Ci.find(e=>e.kod===Kn.zpusob_financovani||e.value===Kn.zpusob_financovani);((null===e||void 0===e?void 0:e.nazev)||"").toLowerCase().includes("pokladna")?(Ge(e=>(0,t.A)((0,t.A)({},e),{},{dodavatel:!0})),Wn(e=>(0,t.A)((0,t.A)({},e),{},{dodavatel_id:null,dodavatel_nazev:"",dodavatel_adresa:"",dodavatel_ico:"",dodavatel_dic:"",dodavatel_zastoupeny:"",dodavatel_kontakt_jmeno:"",dodavatel_kontakt_email:"",dodavatel_kontakt_telefon:""}))):Ge(e=>(0,t.A)((0,t.A)({},e),{},{dodavatel:!1}))},[Kn.zpusob_financovani,Ci,ko]),(0,i.useEffect)(()=>{const e=e=>{e.preventDefault(),e.stopPropagation()},n=n=>{e(n)};return["dragenter","dragover","dragleave","drop"].forEach(n=>{document.addEventListener(n,e,!1)}),document.addEventListener("drop",n,!1),()=>{["dragenter","dragover","dragleave","drop"].forEach(n=>{document.removeEventListener(n,e,!1)}),document.removeEventListener("drop",n,!1)}},[]);const Ms=(0,i.useMemo)(()=>Kn.polozky_objednavky&&0!==Kn.polozky_objednavky.length?Kn.polozky_objednavky.reduce((e,n)=>e+(parseFloat((n.cena_s_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0),0):0,[Kn.polozky_objednavky]),Us=(0,i.useMemo)(()=>{var e;return parseFloat(null===(e=Kn.max_cena_s_dph)||void 0===e?void 0:e.toString().replace(/[^0-9.-]/g,""))||0},[Kn.max_cena_s_dph]),Zs=Ms>Us&&Us>0,Ks=(0,i.useMemo)(()=>Kn.polozky_objednavky&&0!==Kn.polozky_objednavky.length?Kn.polozky_objednavky.reduce((e,n)=>e+(parseFloat((n.cena_bez_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0)*(parseFloat(n.mnozstvi)||1),0):0,[Kn.polozky_objednavky]);(0,i.useMemo)(()=>Ms/1.21,[Ms]);(0,i.useEffect)(()=>{Qn()>=3&&Ks>5e4&&!Kn.ma_byt_zverejnena&&Kn.id&&xp("ma_byt_zverejnena",!0)},[Qn(),Ks,Kn.id,Kn.id]),(0,i.useEffect)(()=>{Gn<2&&"po"!==Sr&&Er("po")},[Gn,Sr]),(0,i.useEffect)(()=>{Kn.id&&Se&&we&&!ca&&!Je.prilohy&&Xc()},[Kn.id,Kn.id,Se,we,ca,Je.prilohy]);const Bs=(e,n,a,o)=>{},Ws=e=>{if(!e)return"";let n=wi.find(n=>(n.id||n.user_id)===parseInt(e));if(n||(n=Mi.find(n=>(n.id||n.user_id)===parseInt(e))),!n&&parseInt(e)===parseInt(Ae)&&ze&&(n=ze),!n&&Un[e])return Un[e];if(n){const e=n.titul_pred?n.titul_pred+" ":"",a=n.jmeno||"",o=n.prijmeni||"",t=n.titul_za?", "+n.titul_za:"";return"".concat(e).concat(a," ").concat(o).concat(t).replace(/\s+/g," ").trim()}return Un[e]||(0,me.getUserDetailApi2)(we,Se,e).then(n=>{if(n){const a=n.titul_pred?n.titul_pred+" ":"",o=n.jmeno||"",r=n.prijmeni||"",i=n.titul_za?", "+n.titul_za:"",s="".concat(a).concat(o," ").concat(r).concat(i).replace(/\s+/g," ").trim();Zn(n=>(0,t.A)((0,t.A)({},n),{},{[e]:s}))}else Zn(n=>(0,t.A)((0,t.A)({},n),{},{[e]:"U\u017eivatel ID ".concat(e)}))}).catch(n=>{Zn(n=>(0,t.A)((0,t.A)({},n),{},{[e]:"U\u017eivatel ID ".concat(e)}))}),"Na\u010d\xedt\xe1m..."},Hs=e=>!!e&&("Na\u010d\xedt\xe1m..."!==e&&("string"!==typeof e||""!==e.trim()));(0,i.useEffect)(()=>{(async()=>{if(!Li||0===wi.length)return;const e=wi.filter(e=>1===e.aktivni||"1"===e.aktivni||1===e.active||"1"===e.active),n=Kn.id||Kn.id;if(!Kn.garant_uzivatel_id||!n)return void Fi(e);if(e.find(e=>e.id===Kn.garant_uzivatel_id||e.user_id===Kn.garant_uzivatel_id))return void Fi(e);const a=wi.find(e=>e.id===Kn.garant_uzivatel_id||e.user_id===Kn.garant_uzivatel_id);if(a)Fi([a,...e]);else if(we&&Se)try{const n=await(0,me.getUserDetailApi2)(we,Se,Kn.garant_uzivatel_id);if(n){const a={id:n.id||n.uzivatel_id,user_id:n.id||n.uzivatel_id,username:n.username||n.login,jmeno:n.jmeno||"",prijmeni:n.prijmeni||"",titul_pred:n.titul_pred||"",titul_za:n.titul_za||"",email:n.email||"",aktivni:0};Fi([a,...e])}else Fi(e)}catch(o){Fi(e)}else Fi(e)})()},[Kn.garant_uzivatel_id,Kn.id,wi,Kn.id,we,Se,Li]);i.useCallback(()=>{if(!(!Kn.id||Gn<7||ni)&&(!Kn.faktury||0===Kn.faktury.length)){const e=Qs(new Date),n={id:"temp-".concat(Date.now()),objednavka_id:Kn.id,fa_datum_doruceni:e,fa_dorucena:1,fa_castka:"",fa_cislo_vema:"",fa_strediska_kod:Kn.strediska_kod||[],fa_splatnost:"",fa_poznamka:"",vytvoril_uzivatel_id:Ae,vytvoril_jmeno:Ws(Ae),dt_vytvoreni:(new Date).toISOString(),dt_aktualizace:null,aktivni:1,_isNew:!0};Fs([n])}},[Kn.id,Gn,ni,Kn.faktury,Kn.strediska_kod,Ae]);const $s=(e,n)=>{const a=Array.isArray(Kn.faktury)?Kn.faktury:[];if(e._updateExisting){const o=a.map(a=>{if(Number(a.id)===Number(n)){return(0,t.A)((0,t.A)({},a),{},{fa_cislo_vema:e.fa_cislo_vema||a.fa_cislo_vema,fa_datum_vystaveni:e.fa_datum_vystaveni||a.fa_datum_vystaveni,fa_datum_zdanitelneho_plneni:e.fa_datum_zdanitelneho_plneni||a.fa_datum_zdanitelneho_plneni,fa_datum_splatnosti:e.fa_datum_splatnosti||a.fa_datum_splatnosti,fa_splatnost:e.fa_datum_splatnosti||a.fa_splatnost,fa_datum_doruceni:e.fa_datum_doruceni||a.fa_datum_doruceni,fa_castka:e.fa_castka||a.fa_castka,fa_castka_bez_dph:e.fa_castka_bez_dph||a.fa_castka_bez_dph,fa_dph:e.fa_dph||a.fa_dph,fa_poznamka:e.fa_poznamka||a.fa_poznamka,fa_strediska_kod:e.fa_strediska_kod||a.fa_strediska_kod,fa_dorucena:1,dt_aktualizace:(new Date).toISOString(),_isdoc_parsed:!0,_isdoc_polozky:e._isdoc_polozky,_isdoc_dodavatel:e._isdoc_dodavatel,_isdoc_email:e._isdoc_email,_fromISDOC:!0})}return a});return Fs(o),Wn(n=>(0,t.A)((0,t.A)({},n),{},{cislo_faktury:e.fa_cislo_vema||n.cislo_faktury,datum_faktury:e.fa_datum_vystaveni||n.datum_faktury,datum_splatnosti:e.fa_datum_splatnosti||n.datum_splatnosti,castka_bez_dph:e.fa_castka_bez_dph||n.castka_bez_dph,castka_s_dph:e.fa_castka||n.castka_s_dph,_isdocRefresh:Date.now()})),void setTimeout(()=>Pa(!0),300)}const o={id:n,objednavka_id:Kn.id,fa_cislo_vema:e.fa_cislo_vema||"",fa_datum_vystaveni:e.fa_datum_vystaveni||"",fa_datum_zdanitelneho_plneni:e.fa_datum_zdanitelneho_plneni||"",fa_datum_splatnosti:e.fa_datum_splatnosti||"",fa_splatnost:e.fa_datum_splatnosti||"",fa_datum_doruceni:e.fa_datum_doruceni||nd(),fa_castka:e.fa_castka||"",fa_castka_bez_dph:e.fa_castka_bez_dph||"",fa_dph:e.fa_dph||"",fa_poznamka:e.fa_poznamka||"",fa_strediska_kod:e.fa_strediska_kod||(Array.isArray(Kn.strediska_kod)?Kn.strediska_kod:[]),fa_dorucena:1,vytvoril_uzivatel_id:Ae,vytvoril_jmeno:Ws(Ae),dt_vytvoreni:(new Date).toISOString(),dt_aktualizace:null,aktivni:1,_isdoc_parsed:!0,_isdoc_polozky:e._isdoc_polozky,_isdoc_dodavatel:e._isdoc_dodavatel,_fromISDOC:!0,vecna_spravnost_umisteni_majetku:"",vecna_spravnost_poznamka:"",vecna_spravnost_potvrzeno:0},r=[...a.filter(e=>!String(e.id).startsWith("temp-")),o];Fs(r),oi(o),ri(o),Wn(e=>(0,t.A)((0,t.A)({},e),{},{cislo_faktury:o.fa_cislo_vema||"",datum_faktury:o.fa_datum_vystaveni||"",datum_splatnosti:o.fa_datum_splatnosti||"",castka_bez_dph:o.fa_castka_bez_dph||"",castka_s_dph:o.fa_castka||"",_isdocRefresh:Date.now()})),setTimeout(()=>Pa(!0),300)},Js=(0,i.useCallback)(function(e){var n,a;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const t=[];(!e.fa_cislo_vema||"string"===typeof e.fa_cislo_vema&&""===e.fa_cislo_vema.trim())&&t.push("\u010c\xedslo faktury VEMA"),(!e.fa_castka||parseFloat(e.fa_castka)<=0)&&t.push("\u010c\xe1stka"),(!e.fa_datum_doruceni||"string"===typeof e.fa_datum_doruceni&&""===e.fa_datum_doruceni.trim())&&t.push("Datum doru\u010den\xed"),(!e.fa_splatnost||"string"===typeof e.fa_splatnost&&""===e.fa_splatnost.trim())&&t.push("Datum splatnosti");return o&&((null===(n=o.name)||void 0===n?void 0:n.toLowerCase().endsWith(".isdoc"))||(null===(a=o.name)||void 0===a?void 0:a.toLowerCase().endsWith(".isdocx"))||"text/isdoc"===o.type)?{isValid:!0,valid:!0,isISDOC:!0,missingFields:t,message:t.length>0?"ISDOC soubor - data lze automaticky vyt\u011b\u017eit po nahr\xe1n\xed":"ISDOC soubor p\u0159ipraven k nahr\xe1n\xed"}:t.length>0?{isValid:!1,valid:!1,isISDOC:!1,missingFields:t,message:"Pro nahr\xe1n\xed p\u0159\xedlohy vypl\u0148te nejprve: ".concat(t.join(", "))}:{isValid:!0,valid:!0,isISDOC:!1,missingFields:[],message:"P\u0159ipraven k nahr\xe1n\xed"}},[]),Gs=(0,i.useCallback)((e,n)=>{let a=e;n.length>0&&n[0].faktura_id&&(a=n[0].faktura_id);const o=n.some(e=>{const n=e.klasifikace||e.typ_prilohy||"";return n.toLowerCase().includes("pokladn")||n.toLowerCase().includes("paragon")});Wn(r=>{const i=(r.faktury||[]).map(r=>r.id===e||r.id===a||String(r.id)===String(a)?(0,t.A)((0,t.A)({},r),{},{attachments:n,_isPokladna:o}):r);return(0,t.A)((0,t.A)({},r),{},{faktury:i})}),Pa(!0)},[]),qs=(0,i.useCallback)(async e=>{try{var n,a;const o=null===(n=Kn.faktury)||void 0===n?void 0:n.find(n=>n.id===e);if(!o)throw new Error("Faktura s ID ".concat(e," nebyla nalezena"));if(!o.fa_cislo_vema)throw new Error("Vypl\u0148te \u010d\xedslo faktury");if(!o.fa_datum_doruceni)throw new Error("Vypl\u0148te datum doru\u010den\xed");if(!o.fa_castka)throw new Error("Vypl\u0148te \u010d\xe1stku faktury");if(!o.fa_strediska_kod||0===o.fa_strediska_kod.length)throw new Error("Vyberte alespo\u0148 jedno st\u0159edisko");const r=Kn.id||Kn.id;if(!r)throw new Error("Nejd\u0159\xedv ulo\u017ete objedn\xe1vku");let i=[];o.fa_strediska_kod&&Array.isArray(o.fa_strediska_kod)&&(i=o.fa_strediska_kod.map(e=>"object"===typeof e&&e.kod_stavu?e.kod_stavu:e));const s={token:Se,username:we,order_id:r,fa_cislo_vema:o.fa_cislo_vema,fa_datum_vystaveni:o.fa_datum_doruceni,fa_castka:o.fa_castka,fa_datum_splatnosti:o.fa_splatnost||null,fa_datum_doruceni:o.fa_datum_doruceni,fa_dorucena:o.fa_dorucena||1,fa_strediska_kod:JSON.stringify(i),fa_poznamka:o.fa_poznamka||null,rozsirujici_data:o.rozsirujici_data||null},d=await(0,Za.We)(s),l=(null===(a=d.data)||void 0===a?void 0:a.invoice_id)||d.invoice_id;if(!l)throw new Error("Backend nevr\xe1til ID faktury");return Wn(n=>{const a=(n.faktury||[]).map(n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{id:l,_isNew:!1}):n);return(0,t.A)((0,t.A)({},n),{},{faktury:a})}),l}catch(o){throw console.group("\u274c CHYBA p\u0159i vytv\xe1\u0159en\xed faktury v DB"),o.response,console.groupEnd(),o}},[Kn,Kn.id,Se,we]),Ys=(0,i.useCallback)(async(e,n)=>{String(e).startsWith("temp-"),Pa(!0)},[]);(0,i.useEffect)(()=>{const e=Kn.faktury||[];if(Kn.id&&0===e.length&&!Os&&Gn>=7){const e=Qs(new Date),n=parseInt(localStorage.getItem("user_id"),10),a={id:"temp-".concat(Date.now()),objednavka_id:Kn.id,fa_datum_doruceni:e,fa_dorucena:1,fa_castka:"",fa_cislo_vema:"",fa_strediska_kod:Array.isArray(Kn.strediska_kod)?Kn.strediska_kod:[],fa_poznamka:"",fa_splatnost:"",vytvoril_uzivatel_id:n,vytvoril_jmeno:Ws(n),dt_vytvoreni:(new Date).toISOString(),dt_aktualizace:null,aktivni:1,_isNew:!0,vecna_spravnost_umisteni_majetku:"",vecna_spravnost_poznamka:"",vecna_spravnost_potvrzeno:0};Fs([a]),oi(a),ri({fa_datum_doruceni:e,fa_dorucena:1,fa_castka:"",fa_cislo_vema:"",fa_strediska_kod:Kn.strediska_kod||[],fa_poznamka:"",fa_splatnost:"",vecna_spravnost_umisteni_majetku:"",vecna_spravnost_poznamka:"",vecna_spravnost_potvrzeno:0})}},[Kn.id,null===($=Kn.faktury)||void 0===$?void 0:$.length,Os,Gn]);const Xs=async()=>{if(Kn.id)return!1;const e=Da.default.getMetadata();if(Fn||!0===(null===e||void 0===e?void 0:e.isEditMode))return!1;if(Kn.ev_cislo&&"Na\u010d\xedt\xe1m..."!==Kn.ev_cislo)return!1;const n=new URLSearchParams(window.location.search).get("edit");if(n)return!1;on(!0);try{const a=await(0,Ia.XY)(Se,we),o=a.next_order_string||a.order_number_string||a.next_number;if(!o)throw new Error("API nevr\xe1tilo next_order_string");return!(Kn.id||Fn||!0===(null===e||void 0===e?void 0:e.isEditMode)||n)&&(Wn(e=>(0,t.A)((0,t.A)({},e),{},{ev_cislo:o})),!0)}catch(a){return Wn(e=>(0,t.A)((0,t.A)({},e),{},{ev_cislo:null})),null===je||void 0===je||je(hi("Nepoda\u0159ilo se na\u010d\xedst eviden\u010dn\xed \u010d\xedslo. Zkuste str\xe1nku obnovit.","error"),{type:"error"}),!1}finally{on(!1)}},gd=function(e,n){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];it(!0),dt(0),ct("Ukl\xe1d\xe1m objedn\xe1vku..."),(async()=>{const e=n;if(e&&Se&&we&&!a)try{await(0,Ia.$_)({token:Se,username:we,orderId:e})}catch(o){}_a(!1)})();const o=Da.default.startProgress({duration:1e3,onProgress:e=>{dt(e)},onComplete:()=>{e&&Ae&&Da.default.saveUIState({highlightOrderId:e}),ya({isEditMode:!1,orderId:null,orderNumber:""}),Mn(!1),setTimeout(()=>{xe("/orders25-list",{replace:!0}),it(!1),Kt(!1)},50)}});window._activeProgressControl=o},Qd=async(e,n,a,o,t)=>{try{if(o&&a===o)return;let n=null,r=new Set;const i=oa(a,"ODESLANA_KE_SCHVALENI"),s=!!o&&oa(o,"ODESLANA_KE_SCHVALENI");i&&!s&&(n="order_status_ke_schvaleni",t.garant_uzivatel_id&&r.add(parseInt(t.garant_uzivatel_id)),t.prikazce_id&&r.add(parseInt(t.prikazce_id)),t.schvalovatel_id&&r.add(parseInt(t.schvalovatel_id)));const d=oa(a,"SCHVALENA"),l=!!o&&oa(o,"SCHVALENA"),c=oa(a,"ZAMITNUTA"),p=!!o&&oa(o,"ZAMITNUTA");(d&&!l||c&&!p)&&(n=d?"order_status_schvalena":"order_status_zamitnuta",t.objednatel_id&&r.add(parseInt(t.objednatel_id)),t.garant_uzivatel_id&&r.add(parseInt(t.garant_uzivatel_id)),t.prikazce_id&&t.schvalovatel_id&&parseInt(t.prikazce_id)!==parseInt(t.schvalovatel_id)?r.add(parseInt(t.prikazce_id)):t.prikazce_id);const u=oa(a,"CEKA_SE"),v=!!o&&oa(o,"CEKA_SE");u&&!v&&(n="order_status_ceka_se",t.objednatel_id&&r.add(parseInt(t.objednatel_id)),t.garant_uzivatel_id&&r.add(parseInt(t.garant_uzivatel_id)));const _=oa(a,"ODESLANA"),m=!!o&&oa(o,"ODESLANA");_&&!m&&(n="order_status_odeslana",t.objednatel_id&&r.add(parseInt(t.objednatel_id)),t.garant_uzivatel_id&&r.add(parseInt(t.garant_uzivatel_id)),t.prikazce_id&&r.add(parseInt(t.prikazce_id)),t.schvalovatel_id&&r.add(parseInt(t.schvalovatel_id)));const k=oa(a,"POTVRZENA"),f=!!o&&oa(o,"POTVRZENA");k&&!f&&(n="order_status_potvrzena",t.objednatel_id&&r.add(parseInt(t.objednatel_id)),t.garant_uzivatel_id&&r.add(parseInt(t.garant_uzivatel_id)),t.prikazce_id&&r.add(parseInt(t.prikazce_id)),t.schvalovatel_id&&r.add(parseInt(t.schvalovatel_id)));const h=oa(a,"UVEREJNENA"),y=!!o&&oa(o,"UVEREJNENA");h&&!y&&(n="order_status_registr_zverejnena",t.garant_uzivatel_id&&r.add(parseInt(t.garant_uzivatel_id)),t.objednatel_id&&r.add(parseInt(t.objednatel_id)),t.prikazce_id&&r.add(parseInt(t.prikazce_id)),t.schvalovatel_id&&r.add(parseInt(t.schvalovatel_id)));const b=oa(a,"NEUVEREJNENA"),g=!!o&&oa(o,"NEUVEREJNENA");b&&!g&&(n="order_status_registr_ceka",t.garant_uzivatel_id&&r.add(parseInt(t.garant_uzivatel_id)));const x=oa(a,"FAKTURACE"),j=!!o&&oa(o,"FAKTURACE");x&&!j&&(n="order_status_faktura_ceka",t.garant_uzivatel_id&&r.add(parseInt(t.garant_uzivatel_id)),t.objednatel_id&&r.add(parseInt(t.objednatel_id)));const z=oa(a,"VECNA_SPRAVNOST"),A=!!o&&oa(o,"VECNA_SPRAVNOST");z&&!A&&(n="order_status_kontrola_ceka",t.garant_uzivatel_id&&r.add(parseInt(t.garant_uzivatel_id)),t.objednatel_id&&r.add(parseInt(t.objednatel_id)));const w=oa(a,"ZKONTROLOVANA"),S=!!o&&oa(o,"ZKONTROLOVANA");w&&!S&&(n="order_status_kontrola_potvrzena",t.objednatel_id&&r.add(parseInt(t.objednatel_id)),t.garant_uzivatel_id&&r.add(parseInt(t.garant_uzivatel_id)));const E=oa(a,"DOKONCENA"),C=!!o&&oa(o,"DOKONCENA");E&&!C&&(n="order_status_dokoncena",t.objednatel_id&&r.add(parseInt(t.objednatel_id)),t.garant_uzivatel_id&&r.add(parseInt(t.garant_uzivatel_id)),t.prikazce_id&&r.add(parseInt(t.prikazce_id)),t.schvalovatel_id&&r.add(parseInt(t.schvalovatel_id)));const O=oa(a,"ZRUSENA"),N=!!o&&oa(o,"ZRUSENA");if(O&&!N&&(n="order_status_zrusena",t.objednatel_id&&r.add(parseInt(t.objednatel_id)),t.garant_uzivatel_id&&r.add(parseInt(t.garant_uzivatel_id)),t.prikazce_id&&r.add(parseInt(t.prikazce_id))),Ae){const e=parseInt(Ae),n=t.prikazce_id&&parseInt(t.prikazce_id)===e;r.has(e)&&(n||r.delete(e))}const D=Array.from(r).filter(e=>e&&!isNaN(e)&&e>0);if(!n)return;if(0===D.length)return;await Ka.lY.create({token:Se,username:we,type:n,order_id:e,action_user_id:Ae,recipients:D})}catch(r){}},jc=async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{isAutoSave:a=!1,explicitSavedOrderId:r,attachmentsToSave:i=pn,isAfterDbSave:s=!1}=n;if(!Ae)return a||je&&je("Nelze ulo\u017eit koncept - nejste p\u0159ihl\xe1\u0161en",{type:"error"}),!1;if(a&&!Da.default.isAutosaveEnabled())return!1;if("Na\u010d\xedt\xe1m..."===e.ev_cislo)return!1;try{a?qt(!0):Bt(!0),Da.default.setCurrentUser(Ae);const n=await Da.default.hasDraft();let l=null;if(!n&&a)l=(new Date).toISOString(),ya({isEditMode:!1,isNewOrder:!1,orderId:null,orderNumber:"",hasDraft:!0,currentPhase:Gn,mainWorkflowState:Xn});else if(n)try{const e=await Da.default.loadDraft();l=(null===e||void 0===e?void 0:e.firstAutoSaveDate)||(new Date).toISOString()}catch(d){l=(new Date).toISOString()}const c=(0,t.A)({},e);if("object"===typeof c.financovani&&null!==c.financovani){Bs("warning","DRAFT","deprecated-financovani-block","\u26a0\ufe0f DEPRECATED blok se spustil - m\u011bl by b\xfdt mrtv\xfd k\xf3d!");const n={typ_financovani:e.typ_financovani||"",uhrada_faktury:e.uhrada_faktury||"",doplnujici_data:{}};e.kod_strediska_financovani&&(n.doplnujici_data.kod_strediska_financovani=e.kod_strediska_financovani),e.organizacni_jednotka&&(n.doplnujici_data.organizacni_jednotka=e.organizacni_jednotka),e.ios&&(n.doplnujici_data.ios=e.ios),e.zakazka&&(n.doplnujici_data.zakazka=e.zakazka),"pojistne_udalosti"===e.typ_financovani&&(e.pojistna_udalost_cislo&&(n.doplnujici_data.pojistna_udalost_cislo=e.pojistna_udalost_cislo),e.pojistna_udalost_poznamka&&(n.doplnujici_data.pojistna_udalost_poznamka=e.pojistna_udalost_poznamka)),c.financovani=JSON.stringify(n)}const p=i.map(e=>{if(e.file){const{file:n}=e,a=(0,o.A)(e,vt);return(0,t.A)((0,t.A)({},a),{},{_hadFile:!0})}return e}),u=void 0!==r?r:Kn.id||(e.id?e.id:null),v=Boolean(c.vecna_spravnost_umisteni_majetku||c.vecna_spravnost_poznamka||c.dokonceni_poznamka);return await Da.default.saveDraft(c,{orderId:u,attachments:p,metadata:{firstAutoSaveDate:l,version:"1.4",isConceptSaved:!0,isOrderSavedToDB:Hi,savedOrderId:u,isChanged:!s||v,dictionaries:{approvers:Mi||[],users:wi||[],strediska:Ei||[],financovani:Ci||[],druhyObjednavky:Oi||[],lpKody:Ni||[]}}}),Jt((new Date).toISOString()),Ki(!0),setTimeout(()=>{qt(!1),Xt(null)},a?300:0),a||je&&je("Koncept byl ulo\u017een do m\xedstn\xedho \xfalo\u017ei\u0161t\u011b",{type:"success"}),!0}catch(l){return a||je&&je("Nepoda\u0159ilo se ulo\u017eit koncept",{type:"error"}),qt(!1),Bt(!1),!1}},zc=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(za.current)return console.log("\ud83d\udeab saveDraft BLOCKED - formul\xe1\u0159 se zav\xedr\xe1"),{success:!1,reason:"form_closing"};return jc(a||Kn,{isAutoSave:e,isAfterDbSave:n})};(0,i.useEffect)(()=>{Aa.current=zc},[zc]);const Sc=()=>{if(Ae)try{Da.default.saveUIState({phase2Unlocked:!1}),En(!1)}catch(e){}};(0,i.useEffect)(()=>{if(Kn.id&&Ae&&Kn.stav_workflow_kod&&!Cn)try{const e=Da.default.getUIState();if(e&&e.phase2Unlocked&&e.phase2OrderId===Kn.id&&!0===e.phase2Unlocked){oa(Kn.stav_workflow_kod,"ODESLANA"),oa(Kn.stav_workflow_kod,"ZRUSENA");const e=Kn.stav_workflow_kod||"NOVA",n=oa(e,"ODESLANA"),a=oa(e,"ZRUSENA");n||a?(Da.default.saveUIState({phase2Unlocked:!1}),En(!1)):En(!0)}}catch(e){}},[Kn.id,Ae,Kn.stav_workflow_kod,Cn]);const[Ec,Cc]=(0,i.useState)(!1);(0,i.useEffect)(()=>{Cn&&!Ec&&(Cc(!0),Bs("info","PHASE2-UNLOCK","prevention-set","Nastavena prevence localStorage kontroly - zam\u010den\xed zpracov\xe1no z DB"))},[Cn,Ec]),(0,i.useEffect)(()=>{if(Kn.id&&Kn.stav_workflow_kod&&Ae){const n=oa(Kn.stav_workflow_kod,"ODESLANA"),a=oa(Kn.stav_workflow_kod,"ZRUSENA");if((n||a)&&Sn){let n=!1;try{const e=Da.default.getUIState();e&&Kn.id&&e.phase2OrderId===Kn.id&&!0===e.phase2Unlocked&&(n=!0)}catch(e){}if(!n){En(!1);try{Da.default.saveUIState({phase2Unlocked:!1})}catch(e){}}}}},[Kn.stav_workflow_kod,Kn.id,Ae,Sn]),(0,i.useEffect)(()=>{if(ca&&ze&&Ae){ka(!1),Xt(null),On(!1);const e="".concat(ze.titul_pred?ze.titul_pred+" ":"").concat(ze.jmeno||""," ").concat(ze.prijmeni||"").concat(ze.titul_za?", "+ze.titul_za:"").replace(/\s+/g," ").trim();Wn(n=>(0,t.A)((0,t.A)({},n),{},{uzivatel_id:Ae,objednatel_id:Ae,jmeno:e,email:ze.email||"",telefon:ze.telefon||"",id:null,ev_cislo:"",cislo_objednavky:null,predmet:"",popis_pozadavku:"",max_cena_s_dph:"",polozky_objednavky:[{id:Date.now(),popis:"",cena_bez_dph:"",sazba_dph:"21",cena_s_dph:""}]})),fo(!1),mo({}),nn(new Set)}},[ca,ze,Ae]),(0,i.useEffect)(()=>{if(Ae){const e=(()=>{if(!Ae)return null;try{const e=Da.default.getUIState();return(null===e||void 0===e?void 0:e.sectionState)||null}catch(e){return null}})();e&&(Ge(n=>(0,t.A)((0,t.A)({},n),e)),Bs("success","UI","section-states","Na\u010dten ulo\u017een\xfd stav sekc\xed: ".concat(JSON.stringify(e))))}},[Ae]),(0,i.useEffect)(()=>()=>{Mt(!1)},[]),(0,i.useEffect)(()=>{Mt(!1),ka(!1),Vt(!0),Oc.current&&(Oc.current=!1),He&&Wn({objednatel_id:Ae||"",uzivatel_id:Ae||"",garant_uzivatel_id:Ae||"",jmeno:"",email:"",telefon:"",ev_cislo:"Na\u010d\xedt\xe1m...",druh_objednavky_kod:"",strediska_kod:[],zpusob_financovani:"",poznamka:"",mimoradna_udalost:!1,polozky_objednavky:[{nazev:"",specifikace:"",mnozstvi:1,merna_jednotka:"",jednotkova_cena:"",celkova_cena:0}],dodavatel:{},faktury:[],stav_workflow_kod:["NOVA"],stav_schvaleni:"\u010dek\xe1 na schv\xe1len\xed"})},[He,Ae]),(0,i.useEffect)(()=>{Li&&Ft&&ma&&Vt(!1)},[He,Li,Ft,ma]);const Oc=(0,i.useRef)(!1),Nc=(0,i.useRef)(null),Dc=(0,i.useRef)(null);(0,i.useEffect)(()=>{window.__orderForm_hasLoadedNextNumberRef=Oc,Ae&&(Da.default.setCurrentUser(Ae),Da.default.hasDraft().then(e=>{e||He||(Oc.current=!1)}))},[Ae,He]),(0,i.useLayoutEffect)(()=>{const e=()=>{if(Dc.current){const e=Dc.current.offsetHeight;document.documentElement.style.setProperty("--fixed-header-height","".concat(e+20,"px"))}};e();const n=[setTimeout(e,50),setTimeout(e,100),setTimeout(e,200),setTimeout(e,500)];window.addEventListener("resize",e);const a=new ResizeObserver(()=>{e()});return Dc.current&&a.observe(Dc.current),()=>{n.forEach(e=>clearTimeout(e)),window.removeEventListener("resize",e),a.disconnect()}},[]),(0,i.useEffect)(()=>{if(Dc.current){const e=Dc.current.offsetHeight;document.documentElement.style.setProperty("--fixed-header-height","".concat(e+20,"px"))}},[Ds,Ts,Kn.stav_workflow_kod,Kn.ev_cislo,Kn.dokoncil_id]),(0,i.useEffect)(()=>{Oc.current||Kn.id||Fn||(Kn.ev_cislo&&"Na\u010d\xedt\xe1m..."!==Kn.ev_cislo?Oc.current=!0:Se&&we&&Xs().then(e=>{e&&(Oc.current=!0)}))},[Kn.id,Fn,Se,we]);const Tc=(0,i.useCallback)(async e=>{if(!e||!Se||!we)return;const n=Ni.find(n=>n.id===e||n.kod===e);if(!n)return;const a=n.cislo_lp||n.label||n.kod;if(a){nr(n=>n[e]?n:(0,t.A)((0,t.A)({},n),{},{[e]:!0}));try{const n=await(0,me.WZ)({token:Se,username:we,cislo_lp:a});n&&(o=a=>(0,t.A)((0,t.A)({},a),{},{[e]:n}),dn(e=>(0,t.A)((0,t.A)({},e),{},{details:o})))}catch(r){r.message.includes("404")||r.message.includes("400")||je("Nepoda\u0159ilo se na\u010d\xedst detail LP: ".concat(r.message),"error")}finally{nr(n=>(0,t.A)((0,t.A)({},n),{},{[e]:!1}))}var o}},[Se,we,je,Ni]),Ic=(0,i.useCallback)(async()=>{if(Se&&we&&!tr){rr(!0);try{const e=await(0,Ua.iE)({token:Se,username:we,show_inactive:!1,limit:500});null!==e&&void 0!==e&&e.data&&Array.isArray(e.data)?or(e.data):or([])}catch(e){or([])}finally{rr(!1)}}},[Se,we,tr]),Pc=(0,i.useCallback)(async e=>{if(e&&Se&&we){lr(!0);try{const n=ar.find(n=>n.cislo_smlouvy===e||n.evidencni_cislo===e);sr(n||{notFound:!0})}catch(n){sr({notFound:!0})}finally{lr(!1)}}else sr(null)},[Se,we,ar,Kn.cislo_smlouvy]);(0,i.useEffect)(()=>{},[Kn.potvrzeni_vecne_spravnosti,Kn.potvrzeni_dokonceni_objednavky,Kn.id]),(0,i.useEffect)(()=>{const e=ze&&Ae&&!Fn&&!ma&&!Kn.objednatel_id&&!Kn.jmeno&&!Kn.email,n=Kn.predmet&&String(Kn.predmet).trim()||Kn.garant_uzivatel_id||Kn.prikazce_id||Kn.strediska_kod&&Array.isArray(Kn.strediska_kod)&&Kn.strediska_kod.length>0||Kn.max_cena_s_dph&&parseFloat(Kn.max_cena_s_dph)>0||Kn.popis_pozadavku&&String(Kn.popis_pozadavku).trim();if(e&&n){const e="".concat(ze.titul_pred?ze.titul_pred+" ":"").concat(ze.jmeno||""," ").concat(ze.prijmeni||"").concat(ze.titul_za?", "+ze.titul_za:"").replace(/\s+/g," ").trim();Wn(n=>(0,t.A)((0,t.A)({},n),{},{objednatel_id:Ae,jmeno:e||"Neuvedeno",email:ze.email||"",telefon:ze.telefon||""}))}},[ze,Ae,Fn,ma,Kn.objednatel_id,Kn.jmeno,Kn.email,Kn.predmet,Kn.garant_uzivatel_id,Kn.prikazce_id,Kn.strediska_kod,Kn.max_cena_s_dph,Kn.popis_pozadavku]),(0,i.useEffect)(()=>{if(!Kn.polozky_objednavky||0===Kn.polozky_objednavky.length)return;Kn.polozky_objednavky.reduce((e,n)=>e+(parseFloat((n.cena_bez_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0)*parseFloat(n.mnozstvi||0),0)>5e4&&!Kn.ma_byt_zverejnena&&Wn(e=>(0,t.A)((0,t.A)({},e),{},{ma_byt_zverejnena:!0}))},[Kn.polozky_objednavky,Kn.ma_byt_zverejnena]),(0,i.useEffect)(()=>{if(Ni.length>0&&Array.isArray(Kn.lp_kod)&&Kn.lp_kod.length>0){Kn.lp_kod.every(e=>Ni.some(n=>(n.id||n.kod)===e))}},[Ni,Kn.lp_kod]),(0,i.useEffect)(()=>{Array.isArray(Kn.lp_kod)&&0!==Kn.lp_kod.length&&Kn.lp_kod.forEach(e=>{Qt[e]||er[e]||Tc(e)})},[Kn.lp_kod]),(0,i.useEffect)(()=>{Se&&we&&0===ar.length&&!tr&&Ic()},[Se,we,ar.length,tr,Ic]),(0,i.useEffect)(()=>{const e=Ci.find(e=>e.kod===Kn.zpusob_financovani),n=(null===e||void 0===e?void 0:e.nazev)||"";if(!(n.includes("Individu\xe1ln\xed")&&!n.includes("Pojistn\xe1")))return;let a="";if("string"===typeof Kn.ev_cislo?a=Kn.ev_cislo:"object"===typeof Kn.ev_cislo&&Kn.ev_cislo&&(a=Kn.ev_cislo.order_number_string||Kn.ev_cislo.next_order_string||Kn.ev_cislo.next_number||""),!a||!a.startsWith("O-"))return;const o=a.replace(/^O-/,"I-");Kn.individualni_schvaleni!==o&&Wn(e=>(0,t.A)((0,t.A)({},e),{},{individualni_schvaleni:o}))},[Kn.ev_cislo,Kn.zpusob_financovani,Ci,Kn.individualni_schvaleni]),(0,i.useEffect)(()=>{if(!Kn.lp_kod||!Array.isArray(Kn.lp_kod)||0===Kn.lp_kod.length)return;const e=Kn.lp_kod,n=ls.map(e=>e.id||e.kod);e.some(e=>!n.includes(e))&&(console.log("\ud83d\uddd1\ufe0f Maz\xe1n\xed LP k\xf3d\u016f po zm\u011bn\u011b p\u0159\xedkazce:",{puvodniLP:e,platneLP:n}),Wn(e=>(0,t.A)((0,t.A)({},e),{},{lp_kod:[]})),je("LP k\xf3dy byly vymaz\xe1ny - p\u0159\xedkazce m\xe1 jin\xfd \xfasek","info"))},[Kn.prikazce_id,ls]),(0,i.useEffect)(()=>{Kn.cislo_smlouvy&&Kn.cislo_smlouvy.trim()?Pc(Kn.cislo_smlouvy.trim()):sr(null)},[Kn.cislo_smlouvy,Pc]),(0,i.useEffect)(()=>{(async()=>{var e,n,a,o;const r=oa(Kn.stav_workflow_kod,"SCHVALENA"),i="SMLOUVA"===(null===(e=Kn.zpusob_financovani)||void 0===e?void 0:e.toUpperCase()),s=!(null===(n=Kn.cislo_smlouvy)||void 0===n||!n.trim()),d=!(null!==(a=Kn.dodavatel_nazev)&&void 0!==a&&a.trim())&&!(null!==(o=Kn.dodavatel_ico)&&void 0!==o&&o.trim());if(r&&i&&s&&d&&ir&&!ir.notFound)try{const e=await ki(Kn,Gn);e&&(Wn(n=>(0,t.A)((0,t.A)({},n),e)),Nt(e.source),_a(!0))}catch(l){}})()},[Kn.stav_workflow_kod,Kn.zpusob_financovani,Kn.cislo_smlouvy,Kn.dodavatel_nazev,Kn.dodavatel_ico,ir,ki,Gn,oa]),(0,i.useEffect)(()=>{const e=Kn.predmet||Kn.garant_uzivatel_id||Kn.popis_pozadavku||Kn.max_cena_s_dph||Kn.poznamky||Kn.dodavatel_nazev||Kn.strediska_kod&&Kn.strediska_kod.length>0||Kn.polozky_objednavky&&Kn.polozky_objednavky.some(e=>e.popis),n=!document.hidden;if(!Ae||!e||Zt||rt||Wt||xa.current||!Da.default.isAutosaveEnabled()||!n||!ma)return;const a=setTimeout(()=>{zc(!0)},3e3);return()=>clearTimeout(a)},[Kn,Ae,Zt,rt,Wt,ma]),(0,i.useEffect)(()=>{const e=()=>{document.hidden};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[Kn,Ae]),(0,i.useEffect)(()=>{const e=e=>{try{const e=Nc.current,n=e?e.scrollTop:window.pageYOffset||document.documentElement.scrollTop;Da.default.saveMetadata({scrollPosition:n})}catch(o){}const n=pn.filter(e=>!e.serverId&&"uploaded"!==e.status&&!e.fromServer&&e.file),a=pn.filter(e=>!e.klasifikace||""===e.klasifikace.trim());if(n.length>0||a.length>0){const o="M\xe1te ".concat(n.length," neulo\u017een\xfdch a ").concat(a.length," neklasifikovan\xfdch p\u0159\xedloh. Opravdu chcete opustit str\xe1nku? Neulo\u017een\xe9 p\u0159\xedlohy budou ztraceny.");return e.preventDefault(),e.returnValue=o,o}},n=()=>{const e=pn.filter(e=>!e.serverId&&"uploaded"!==e.status&&!e.fromServer&&e.file),n=pn.filter(e=>!e.klasifikace||""===e.klasifikace.trim());(e.length>0||n.length>0)&&je&&je("M\xe1te ".concat(e.length," neulo\u017een\xfdch a ").concat(n.length," neklasifikovan\xfdch p\u0159\xedloh.\n\nOpravdu chcete opustit str\xe1nku? Neulo\u017een\xe9 p\u0159\xedlohy budou ztraceny."),{type:"warning",timeout:0,action:{confirmText:"ANO, OPUSTIT",cancelText:"Z\u016fstat",onConfirm:()=>{},onCancel:()=>{const e=window.location.pathname+window.location.search;window.history.pushState(null,"",e)}}})};return window.addEventListener("beforeunload",e),window.addEventListener("popstate",n),()=>{window.removeEventListener("beforeunload",e),window.removeEventListener("popstate",n)}},[pn,Kn,Ae,Hi,Kn.id]);const Rc=(0,i.useCallback)((e,n)=>{!xa.current&&Da.default.isAutosaveEnabled()&&!Zt&&!rt&&ma&&Pa(!1)},[_o,Zt,rt,ma,Pa]);(0,i.useEffect)(()=>{try{const e=Ae?"order_templates_".concat(Ae):"order_templates",n=localStorage.getItem(e);if(n){const e=JSON.parse(n);Array.isArray(e)&&fr(e)}}catch(e){}Se&&we&&Ae&&Zp()},[Ae,Se,we]);const Lc=e=>{Ge(n=>{const a=(0,t.A)((0,t.A)({},n),{},{[e]:!n[e]});return(e=>{if(Ae)try{Da.default.saveUIState({sectionState:e})}catch(n){}})(a),"prilohy"===e&&n[e]&&!a[e]&&Kn.id&&Se&&we&&!ca&&Gn>=3&&setTimeout(()=>{Xc()},100),a})},Vc=e=>{const n=pn.filter(n=>n.name.toLowerCase()===e.toLowerCase());return n.length>0?n[0]:null},Fc=e=>{if(ra&&!ds)return void(je&&je("Nelze nahr\xe1t p\u0159\xedlohy - objedn\xe1vka je dokon\u010dena/zam\xedtnuta/zru\u0161ena",{type:"warning"}));if(!e||0===e.length)return;mt(!0);const n=Array.from(e).map((e,n)=>{if(!(0,Ia.VW)(e.name))return je("Soubor ".concat(e.name,": Nepodporovan\xfd typ souboru"),"error"),null;if(!(0,Ia.io)(e.size,20))return je("Soubor ".concat(e.name,": P\u0159\xedli\u0161 velk\xfd (max 20MB)"),"error"),null;const a=Vc(e.name),o=(0,Ia.h0)(e);return{id:o.id,guid:o.guid,name:e.name,originalName:o.originalName,generatedName:o.generatedName,systemovy_nazev:o.systemovy_nazev,size:e.size,type:e.type,klasifikace:"",uploadDate:o.createdAt,status:"pending_classification",file:e,uploadError:null,serverId:null,serverGuid:null,isDuplicate:!!a,duplicateOf:(null===a||void 0===a?void 0:a.id)||null}}).filter(Boolean);Wn(e=>(0,t.A)((0,t.A)({},e),{},{prilohy_dokumenty:[...e.prilohy_dokumenty||[],...n]})),un(e=>[...e,...n]),mt(!1)},Jc=e=>{const n=e.target.files;n.length>0&&Fc(n),e.target.value=""},Gc=async function(e,n){var a;let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"obj-";const r=null===(a=Kn.prilohy_dokumenty)||void 0===a?void 0:a.find(n=>n.id===e);if(r&&r.file&&"uploaded"!==r.status)try{var i,s;if(Wn(n=>(0,t.A)((0,t.A)({},n),{},{prilohy_dokumenty:n.prilohy_dokumenty.map(n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{status:"uploading",uploadError:null,file_prefix:o}):n)})),un(n=>n.map(n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{status:"uploading",uploadError:null,file_prefix:o}):n)),Bs("info","ATTACHMENTS","upload-start","Nahr\xe1v\xe1m soubor ".concat(r.name," s klasifikac\xed ").concat(n," a prefixem ").concat(o," na server V2 API...")),!Kn.id)throw je("\u274c Nelze nahr\xe1t p\u0159\xedlohu - objedn\xe1vka nem\xe1 ID! Nejprve ulo\u017e objedn\xe1vku.","error"),new Error("Missing formData.id - order must be saved first");const a=await(0,Ia.Fg)(Kn.id,r.file,we,Se,n,o);Bs("success","ATTACHMENTS","upload-success","Soubor ".concat(r.name," nahr\xe1n \xfasp\u011b\u0161n\u011b"),a);const d=(null===(i=a.data)||void 0===i?void 0:i.attachment_id)||(null===(s=a.data)||void 0===s?void 0:s.id);Wn(n=>(0,t.A)((0,t.A)({},n),{},{prilohy_dokumenty:n.prilohy_dokumenty.map(n=>{var o;return n.id===e?(0,t.A)((0,t.A)({},n),{},{status:"uploaded",serverId:d,serverGuid:(null===(o=a.data)||void 0===o?void 0:o.guid)||r.systemovy_nazev,uploadError:null,file:null}):n})})),un(n=>n.map(n=>{var o;return n.id===e?(0,t.A)((0,t.A)({},n),{},{status:"uploaded",serverId:d,serverGuid:(null===(o=a.data)||void 0===o?void 0:o.guid)||r.systemovy_nazev,uploadError:null,file:null}):n})),je('\u2705 P\u0159\xedloha "'.concat(r.name,'" byla \xfasp\u011b\u0161n\u011b nahr\xe1na na server'),"success")}catch(c){var d,l;Bs("error","ATTACHMENTS","upload-error","Chyba p\u0159i uploadu ".concat(r.name,": ").concat(c.message)),Wn(n=>(0,t.A)((0,t.A)({},n),{},{prilohy_dokumenty:n.prilohy_dokumenty.map(n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{status:"error",uploadError:c.message}):n)})),un(n=>n.map(n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{status:"error",uploadError:c.message}):n));const n=(null===(d=c.response)||void 0===d||null===(l=d.data)||void 0===l?void 0:l.message)||c.message||"Nezn\xe1m\xe1 chyba";je('\u274c Chyba p\u0159i nahr\xe1v\xe1n\xed p\u0159\xedlohy "'.concat(r.name,'": ').concat(n),"error")}},qc=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(Kn.id)try{var n,a,o;yt(!0);const r=await(0,Ia.ne)(Kn.id,we,Se),i=(null===r||void 0===r||null===(n=r.data)||void 0===n?void 0:n.attachments)||(null===r||void 0===r?void 0:r.data)||[];let s=null;if(i.length>0)try{s=await(0,Ia.sK)(Kn.id,we,Se)}catch(t){}const d={hasIssues:!1,conceptUnclassified:[],conceptOrphaned:[],dbMissingFiles:[],dbOrphaned:[],uploadErrors:[],inconsistentState:[]};pn.forEach((e,n)=>{try{if(e.klasifikace&&""!==e.klasifikace||(d.conceptUnclassified.push(e),d.hasIssues=!0),"error"===e.status&&(d.uploadErrors.push(e),d.hasIssues=!0),e.serverId){const n=String(e.serverId);i.find(e=>e.id.toString()===n||e.id.toString()===n.replace("server_",""))||(d.conceptOrphaned.push(e),d.hasIssues=!0)}else"uploaded"!==e.status&&"uploading"!==e.status&&(d.conceptOrphaned.push(e),d.hasIssues=!0)}catch(a){}}),i.forEach((e,n)=>{try{pn.find(n=>{if(!n.serverId)return n.name===e.originalni_nazev_souboru&&"uploaded"===n.status;const a=String(n.serverId),o=e.id.toString();return a===o||a==="server_".concat(o)||a.replace("server_","")===o||n.name===e.originalni_nazev_souboru&&"uploaded"===n.status})||(d.dbOrphaned.push(e),d.hasIssues=!0)}catch(a){}});const l=(null===(a=s)||void 0===a||null===(o=a.data)||void 0===o?void 0:o.attachments)||[];if(l.length>0&&l.forEach(e=>{!1===e.file_exists?(d.dbMissingFiles.push({name:e.original_name||"nezn\xe1m\xfd",serverId:e.attachment_id||e.id,path:e.system_path||e.guid,systemName:e.guid,status:e.status}),d.hasIssues=!0):!1===e.size_match&&(d.inconsistentState.push({name:e.original_name||"nezn\xe1m\xfd",serverId:e.attachment_id||e.id,issue:"SIZE MISMATCH: DB=".concat(e.db_size,"B, Disk=").concat(e.actual_size,"B"),status:e.status}),d.hasIssues=!0)}),d.hasIssues){if(Gn>=3&&!e){let e="\ud83d\udea8 SYNC KONTROLA - Nalezen\xe9 probl\xe9my:\n";d.conceptUnclassified.length>0&&(e+="\n\ud83d\udcdd KONCEPT - NEKLASIFIKOVAN\xc9 (".concat(d.conceptUnclassified.length,"):\n"),d.conceptUnclassified.forEach(n=>{e+="  \u2022 ".concat(n.name," - pot\u0159ebuje klasifikaci\n")})),d.conceptOrphaned.length>0&&(e+="\n\ud83d\udcc4 KONCEPT - NENAHRAN\xc9/OSI\u0158EL\xc9 (".concat(d.conceptOrphaned.length,"):\n"),d.conceptOrphaned.forEach(n=>{e+="  \u2022 ".concat(n.name," - ").concat(n.serverId?"osi\u0159el\xe1":"nenahr\xe1na","\n")})),d.dbOrphaned.length>0&&(e+="\n\ud83d\udccb DB - CHYB\xcd V KONCEPTU (".concat(d.dbOrphaned.length,"):\n"),d.dbOrphaned.forEach(n=>{e+="  \u2022 ".concat(n.originalni_nazev_souboru," (ID: ").concat(n.id,") - mo\u017en\xe1 ztraceno po F5\n")})),d.dbMissingFiles.length>0&&(e+="\n\ud83d\udcbe SERVER - CHYB\xcd SOUBORY (".concat(d.dbMissingFiles.length,"):\n"),d.dbMissingFiles.forEach(n=>{e+="  \u2022 ".concat(n.name," (").concat(n.path||n.systemName,")\n")})),d.inconsistentState.length>0&&(e+="\n\u26a0\ufe0f PO\u0160KOZEN\xc9 SOUBORY (".concat(d.inconsistentState.length,"):\n"),d.inconsistentState.forEach(n=>{e+="  \u2022 ".concat(n.name," - ").concat(n.issue,"\n")})),d.uploadErrors.length>0&&(e+="\n\u274c CHYBY NAHR\xc1V\xc1N\xcd (".concat(d.uploadErrors.length,"):\n"),d.uploadErrors.forEach(n=>{e+="  \u2022 ".concat(n.name,"\n")})),je(e,"error"),d.dbOrphaned.length>0&&je&&je("Nalezeno ".concat(d.dbOrphaned.length," p\u0159\xedlohy v datab\xe1zi, kter\xe9 chyb\xed v konceptu (mo\u017en\xe1 ztracen\xe9 po obnoven\xed str\xe1nky F5).\n\n")+"Chcete je automaticky obnovit do konceptu?",{type:"info",timeout:0,action:{confirmText:"ANO, OBNOVIT",cancelText:"Ne",onConfirm:async()=>{await Yc(d.dbOrphaned)}}})}}else;return d}catch(r){je("Chyba kontroly synchronizace p\u0159\xedloh:\n".concat(r.message,"\n\n")+"Zkuste:\n\u2022 Obnovit str\xe1nku (F5)\n\u2022 Zkontrolovat p\u0159ipojen\xed k serveru\n\u2022 Zkontrolovat konzoli prohl\xed\u017ee\u010de (F12)","error")}finally{yt(!1)}else je("Nen\xed ID objedn\xe1vky pro kontrolu synchronizace","warning")},Yc=async e=>{try{if(!e||!Array.isArray(e)){if(!Kn.id)return void je("Nen\xed ID objedn\xe1vky pro na\u010dten\xed p\u0159\xedloh z DB","warning");try{var n;const a=await(0,Ia.ne)(Kn.id,we,Se),o=(null===a||void 0===a||null===(n=a.data)||void 0===n?void 0:n.attachments)||(null===a||void 0===a?void 0:a.data)||[];if(!Array.isArray(o))return void je("Chyba API: neplatn\xe1 struktura odpov\u011bdi pro p\u0159\xedlohy","error");e=o}catch(a){return void je("Chyba p\u0159i na\u010d\xedt\xe1n\xed p\u0159\xedloh z datab\xe1ze","error")}}const o=e.map(e=>(0,t.A)((0,t.A)({},ap(e)),{},{isRestored:!0}));un(e=>{const n=new Set(e.map(e=>e.serverId||e.id)),a=o.filter(e=>!n.has(e.serverId)&&!n.has(e.id));return[...e,...a]}),je("\u2705 Obnoveno ".concat(o.length," p\u0159\xedloh z datab\xe1ze do konceptu"),"success")}catch(a){je("Chyba obnovov\xe1n\xed: ".concat(a.message),"error")}},Xc=async()=>{if(Kn.id&&Se&&we&&!Je.prilohy)try{const e=pn.filter(e=>!e.serverId&&"uploaded"!==e.status&&!e.fromServer),n=await np(),a=[...n.map(ap),...e];un(a),a.length>0&&setTimeout(()=>{qc(!0)},1e3)}catch(e){je("Chyba smart load: ".concat(e.message),"error")}},Qc=e=>{Wn(n=>(0,t.A)((0,t.A)({},n),{},{prilohy_dokumenty:(n.prilohy_dokumenty||[]).filter(n=>n.id!==e)})),un(n=>n.filter(n=>n.id!==e))},ep=()=>{0!==pn.length?At(!0):je("\u017d\xe1dn\xe9 p\u0159\xedlohy k odstran\u011bn\xed","info")},np=async()=>{var e;if(!Kn.id||!Se||!we)throw new Error("Chyb\xed pot\u0159ebn\xe9 \xfadaje pro na\u010dten\xed p\u0159\xedloh");if(Je.prilohy)throw new Error("Sekce p\u0159\xedloh je sbalen\xe1 - na\u010d\xedt\xe1n\xed p\u0159esko\u010deno");const n=await(0,Ia.ne)(Kn.id,we,Se),a=(null===n||void 0===n||null===(e=n.data)||void 0===e?void 0:e.attachments)||(null===n||void 0===n?void 0:n.data)||[];if(!Array.isArray(a))throw new Error("API nevr\xe1tilo pole p\u0159\xedloh");return a},ap=e=>{const n=e.system_path||e.systemovy_nazev||e.final_filename||"",a=n.split("/").pop()||n;let o="obj-";a.startsWith("dd-")?o="dd-":a.startsWith("obj-")&&(o="obj-");return{id:"server_".concat(e.id),serverId:e.id,objednavka_id:e.order_id||e.objednavka_id,guid:e.guid,typ_prilohy:e.type||e.typ_prilohy,originalni_nazev_souboru:e.original_name||e.originalni_nazev_souboru,systemovy_nazev:e.system_path,systemova_cesta:e.system_path,velikost:e.file_size||e.velikost||e.velikost_souboru_b,dt_vytvoreni:e.upload_date||e.created_at||e.dt_vytvoreni,dt_aktualizace:e.updated_at||e.dt_aktualizace,nahrano_uzivatel_id:e.uploaded_by_user_id||e.nahrano_uzivatel_id,nahrano_uzivatel:e.nahrano_uzivatel,file_exists:e.file_exists,file_prefix:o,name:e.original_name||e.originalni_nazev_souboru,size:e.file_size||e.velikost||e.velikost_souboru_b,type:"application/octet-stream",lastModified:new Date(e.upload_date||e.created_at||e.dt_vytvoreni||Date.now()).getTime(),klasifikace:e.type||e.typ_prilohy,cesta_k_souboru:e.system_path,status:"uploaded",uploadDate:e.upload_date||e.created_at||e.dt_vytvoreni||(new Date).toISOString(),serverGuid:e.guid,fromServer:!0}},op=e=>{if(e.file_prefix)return e.file_prefix;const n=e.systemova_cesta||e.systemovy_nazev||e.cesta_k_souboru||"",a=n.split("/").pop()||n;return a.startsWith("dd-")?"dd-":(a.startsWith("obj-"),"obj-")},tp=e=>"error"===e.status?"#fca5a5":e.klasifikace?e.isDuplicate||"uploading"===e.status?"#f59e0b":"uploaded"===e.status?"#10b981":"#e5e7eb":"#fca5a5",ip=e=>"error"===e.status?"#fef2f2":e.klasifikace?e.isDuplicate||"uploading"===e.status?"#fffbeb":"uploaded"===e.status?"#f0fdf4":"white":"#fef2f2",sp=(e,n,a)=>{Wn(o=>(0,t.A)((0,t.A)({},o),{},{polozky_objednavky:(o.polozky_objednavky||[]).map(o=>{if(o.id===e){const e=(0,t.A)((0,t.A)({},o),{},{[n]:a});if("cena_bez_dph"===n||"sazba_dph"===n){const n=(parseFloat((e.cena_bez_dph||"0").replace(/[^\d,.-]/g,"").replace(",","."))||0)*(1+(parseFloat(e.sazba_dph)||0)/100);e.cena_s_dph=n.toFixed(2)}if("cena_s_dph"===n){const n=(parseFloat((e.cena_s_dph||"0").replace(/[^\d,.-]/g,"").replace(",","."))||0)/(1+(parseFloat(e.sazba_dph)||0)/100);e.cena_bez_dph=n.toFixed(2)}return e}return o})})),"sazba_dph"===n&&(xa.current||!Da.default.isAutosaveEnabled()||Zt||rt||!ma||Pa(!0))},dp=()=>{var e,n,a,o;return!!(null!==(e=Kn.dodavatel_nazev)&&void 0!==e&&e.trim()&&null!==(n=Kn.dodavatel_adresa)&&void 0!==n&&n.trim()&&null!==(a=Kn.dodavatel_ico)&&void 0!==a&&a.trim()&&/^\d{8}$/.test(null===(o=Kn.dodavatel_ico)||void 0===o?void 0:o.trim()))},lp=async()=>{if(dp())try{Ct({loading:!0});const e=Kn.dodavatel_ico.trim(),n=await(0,me.e5)({token:Se,username:we,user_id:Ae,usek_zkr:null===ze||void 0===ze?void 0:ze.usek_zkr,ico:e,load_all:Oe&&Oe("CONTACT_MANAGE")}),a=(Oe&&Oe("CONTACT_MANAGE"),Array.isArray(n)?n.filter(n=>{var a;return(null===(a=n.ico)||void 0===a?void 0:a.trim())===e}):[]);if(a.length>0){const e=a.find(e=>{if(e.usek_zkr&&""!==e.usek_zkr.trim()&&"[]"!==e.usek_zkr&&"null"!==e.usek_zkr)try{const n=JSON.parse(e.usek_zkr),a=null===ze||void 0===ze?void 0:ze.usek_zkr,o=Array.isArray(a)?a:[a];return Array.isArray(n)&&o.some(e=>e&&n.includes(e))}catch(n){return!1}return!1}),n=a.find(e=>{const n=e.usek_zkr&&""!==e.usek_zkr.trim()&&"[]"!==e.usek_zkr&&"null"!==e.usek_zkr;return e.user_id&&0!==e.user_id&&"0"!==e.user_id&&!n}),o=a.find(e=>{const n=e.usek_zkr&&""!==e.usek_zkr.trim()&&"[]"!==e.usek_zkr&&"null"!==e.usek_zkr;return(0===e.user_id||"0"===e.user_id)&&!n});Ct({exists:!0,existsInPersonal:n||null,existsInUsek:e||null,existsInGlobal:o||null,supplier:n||e||o})}else Ct({exists:!1,existsInPersonal:null,existsInUsek:null,existsInGlobal:null,supplier:null});St(!0)}catch(e){null===je||void 0===je||je("Chyba p\u0159i kontrole dodavatele v datab\xe1zi","error"),Ct(null)}else null===je||void 0===je||je("Vypl\u0148te v\u0161echny povinn\xe9 \xfadaje dodavatele (n\xe1zev, adresa, I\u010cO)","warning")},cp=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(Oo.length>0)e&&e.length>=2?pp(e):So(Oo);else{Co(!0);try{const n=await(0,me.e5)({token:Se,username:we,user_id:Ae,usek_zkr:(null===ze||void 0===ze?void 0:ze.usek_zkr)||void 0,load_all:Oe&&Oe("CONTACT_MANAGE")});if(Array.isArray(n))if(No(n),e&&e.length>=2){const a=ed(e),o=n.filter(n=>{const o=ed(n.nazev||n.name||""),t=(n.ico||"").toLowerCase(),r=(n.kontakt_email||n.email||"").toLowerCase(),i=ed(n.kontakt_jmeno||"");return o.includes(a)||t.includes(e.toLowerCase())||r.includes(e.toLowerCase())||i.includes(a)});So(o)}else So(n);else No([]),So([])}catch(n){je&&je("Chyba p\u0159i na\u010d\xedt\xe1n\xed kontakt\u016f: "+n.message,{type:"error"}),No([]),So([])}finally{Co(!1)}}},pp=e=>{if(!e||e.length<2)return void So(Oo);const n=ed(e),a=Oo.filter(a=>{const o=ed(a.nazev||a.name||""),t=(a.ico||"").toLowerCase(),r=(a.kontakt_email||a.email||"").toLowerCase(),i=ed(a.kontakt_jmeno||"");return o.includes(n)||t.includes(e.toLowerCase())||r.includes(e.toLowerCase())||i.includes(n)});So(a)},up=()=>{const e=Kn.dodavatel_nazev||"",n=Kn.dodavatel_ico||"",a=e||n;Po(a),To(!0),a&&a.length>=2&&vp(a)},vp=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const n=null===e||void 0===e?void 0:e.trim();if(!n||n.length<3)Lo([]);else try{Fo(!0);let e,r;if(/^\d+$/.test(n)){e="https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/".concat(n);const t=await fetch(e,{method:"GET",headers:{Accept:"application/json"}});if(t.ok){var a,o;const e=await t.json(),n={ico:e.ico,dic:e.dic||"",nazev:e.obchodniJmeno||"",adresa:(null===(a=e.sidlo)||void 0===a?void 0:a.textovaAdresa)||"",sidlo:(null===(o=e.sidlo)||void 0===o?void 0:o.textovaAdresa)||""};Lo([n])}else Lo([]),n.length>=8&&je&&je("Dodavatel nebyl v ARES nalezen",{type:"warning"})}else{e="https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/vyhledat";const a=[n,ed(n)].filter((e,n,a)=>a.indexOf(e)===n);let o=[];for(const n of a){if(!n)continue;r={obchodniJmeno:n,pocet:25};const a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(a.ok){const e=((await a.json()).ekonomickeSubjekty||[]).map(e=>{var n,a;return{ico:e.ico,dic:e.dic||"",nazev:e.obchodniJmeno||"",adresa:(null===(n=e.sidlo)||void 0===n?void 0:n.textovaAdresa)||"",sidlo:(null===(a=e.sidlo)||void 0===a?void 0:a.textovaAdresa)||""}});o.push(...e)}}const i=o.filter((e,n,a)=>a.findIndex(n=>n.ico===e.ico)===n),s=ed(n);if(i.sort((e,n)=>{const a=ed(e.nazev),o=ed(n.nazev),t=a.includes(s),r=o.includes(s);return t&&!r?-1:!t&&r?1:0}),Lo(i),i.length>0){const e={};for(const n of i)if(n.ico)try{const a=await(0,me.e5)({token:Se,username:we,user_id:Ae,usek_zkr:null===ze||void 0===ze?void 0:ze.usek_zkr,ico:n.ico,load_all:Oe&&Oe("CONTACT_MANAGE")}),o=Array.isArray(a)?a.filter(e=>{var a;return(null===(a=e.ico)||void 0===a?void 0:a.trim())===n.ico.trim()}):[];if(o.length>0){const a=Array.isArray(null===ze||void 0===ze?void 0:ze.usek_zkr)?ze.usek_zkr:[null===ze||void 0===ze?void 0:ze.usek_zkr],t=o.find(e=>{if(e.usek_zkr&&""!==e.usek_zkr.trim()&&"[]"!==e.usek_zkr&&"null"!==e.usek_zkr)try{const n=JSON.parse(e.usek_zkr);return a.some(e=>e&&n.includes(e))}catch(n){return!1}return!1}),r=o.find(e=>{const n=e.usek_zkr&&""!==e.usek_zkr.trim()&&"[]"!==e.usek_zkr&&"null"!==e.usek_zkr;return e.user_id>0&&e.user_id===Ae&&!n}),i=o.find(e=>{const n=e.usek_zkr&&""!==e.usek_zkr.trim()&&"[]"!==e.usek_zkr&&"null"!==e.usek_zkr;return 0===e.user_id&&!n});e[n.ico]={existsInPersonal:!!r,existsInUsek:!!t,existsInGlobal:!!i}}else e[n.ico]={existsInPersonal:!1,existsInUsek:!1,existsInGlobal:!1}}catch(t){e[n.ico]={existsInPersonal:!1,existsInUsek:!1,existsInGlobal:!1}}Ko(e)}i.length}}catch(t){Lo([]),Ko({}),je&&je("Chyba p\u0159i p\u0159ipojen\xed k ARES",{type:"error"})}finally{Fo(!1)}},_p=e=>{var n;n=n=>n.includes(e)?n.filter(n=>n!==e):[...n,e],hn(e=>(0,t.A)((0,t.A)({},e),{},{selectedUseky:n}))},mp=e=>{Wn(n=>(0,t.A)((0,t.A)({},n),{},{dodavatel_nazev:e.nazev||"",dodavatel_adresa:e.adresa||e.sidlo||"",dodavatel_ico:e.ico||"",dodavatel_dic:e.dic||""})),To(!1),Po(""),Lo([]),je&&je("Dodavatel na\u010dten z ARES",{type:"success"})},kp=async(e,n)=>{if(Se&&we&&Ae){Uo(e.ico);try{Bs("info","ARES-SAVE","permissions-check","U\u017eivatel: ".concat(we,", USER_MANAGE: ").concat(Qi,", \xdasek: ").concat(null===ze||void 0===ze?void 0:ze.usek_zkr,", Ukl\xe1d\xe1m do: ").concat(JSON.stringify(n)));let o=0,t="";if("personal"===n)o=Ae,t="",Bs("info","ARES-SAVE","target-personal","C\xedl: Osobn\xed kontakt pro user_id=".concat(o));else if("usek"===(null===n||void 0===n?void 0:n.scope)||"department"===n){o=0;const e=(null===n||void 0===n?void 0:n.useky)||[(null===ze||void 0===ze?void 0:ze.usek_zkr)||""];t=JSON.stringify(e),Bs("info","ARES-SAVE","target-usek","C\xedl: Kontakty \xfaseku pro \xfaseky=".concat(e.join(", "),", usek_zkr=").concat(t))}else"global"===n&&(o=0,t="",Bs("info","ARES-SAVE","target-global","C\xedl: Glob\xe1ln\xed kontakt (user_id=0, usek_zkr='')"));try{await(0,me.aj)({token:Se,username:we,ico:e.ico,nazev:e.nazev,adresa:e.adresa||e.sidlo||"",dic:e.dic||"",zastoupeny:"",kontakt_jmeno:"",kontakt_email:"",kontakt_telefon:"",user_id:o,usek_zkr:t}),je&&je("Dodavatel byl aktualizov\xe1n v lok\xe1ln\xed datab\xe1zi",{type:"success"})}catch(a){await(0,me.jx)({token:Se,username:we,nazev:e.nazev,adresa:e.adresa||e.sidlo||"",ico:e.ico,dic:e.dic||"",zastoupeny:"",kontakt_jmeno:"",kontakt_email:"",kontakt_telefon:"",user_id:o,usek_zkr:t}),je&&je("Dodavatel byl p\u0159id\xe1n do lok\xe1ln\xed datab\xe1ze",{type:"success"})}No([])}catch(o){je&&je("Chyba p\u0159i ukl\xe1d\xe1n\xed: ".concat(o.message),{type:"error"})}finally{Uo(null)}}else je&&je("Chyb\xed p\u0159ihla\u0161ovac\xed \xfadaje",{type:"error"})},fp=async e=>{const n=null===e||void 0===e?void 0:e.trim();if(n&&!(n.length<8)){tt(!0),et("checking"),at(null),Xo(!0);try{const e=await(0,me.d0)({token:Se,username:we,ico:n});if(null!==e&&void 0!==e&&e.data&&Array.isArray(e.data)&&e.data.length>0){const n=e.data[0];et("found-local"),at((0,t.A)((0,t.A)({},n),{},{source:"local"}))}else{const e="https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/".concat(n),o=await fetch(e,{method:"GET",headers:{Accept:"application/json"}});if(o.ok){var a;const e=await o.json();et("found-ares"),at({ico:e.ico,dic:e.dic||"",nazev:e.obchodniJmeno||"",adresa:(null===(a=e.sidlo)||void 0===a?void 0:a.textovaAdresa)||"",source:"ares"})}else et("not-found"),at(null)}}catch(o){et("not-found"),at(null)}finally{tt(!1)}}},hp=()=>{nt&&(Wn(e=>(0,t.A)((0,t.A)({},e),{},{dodavatel_nazev:nt.nazev||nt.name||"",dodavatel_adresa:nt.adresa||nt.address||"",dodavatel_ico:nt.ico||"",dodavatel_dic:nt.dic||"",dodavatel_zastoupeny:nt.zastoupeny||"",dodavatel_kontakt_jmeno:nt.kontakt_jmeno||"",dodavatel_kontakt_email:nt.kontakt_email||"",dodavatel_kontakt_telefon:nt.kontakt_telefon||""})),Xo(!1),et(null),at(null))},yp=()=>{Xo(!1),et(null),at(null)},bp=e=>{try{var n,a,o;const r={};var t;if(null!==e&&void 0!==e&&null!==(n=e.poApproval)&&void 0!==n&&n.predmet&&(r.predmet=e.poApproval.predmet),null!==e&&void 0!==e&&null!==(a=e.poApproval)&&void 0!==a&&a.max_cena_s_dph&&(r.maxCena=e.poApproval.max_cena_s_dph),null!==e&&void 0!==e&&null!==(o=e.orderDetails)&&void 0!==o&&o.dodavatel_nazev&&(r.dodavatel=e.orderDetails.dodavatel_nazev),Array.isArray(null===e||void 0===e?void 0:e.polozky)&&e.polozky.length)r.polozky=e.polozky.length,null!==(t=e.polozky[0])&&void 0!==t&&t.popis&&(r.prvniPolozka=e.polozky[0].popis);return r}catch(r){return{}}},gp=(e,n)=>{try{const o={ts:Date.now(),action:e,details:n||{},user:we||"unknown"};a=e=>[o,...e.slice(0,49)],vo(e=>(0,t.A)((0,t.A)({},e),{},{actionsLog:a}))}catch(o){}var a},xp=(0,i.useCallback)((e,n)=>{const a=!va&&!Hi;_a(!0),ma||ka(!0),a?Pa(!0):Pa();if(["garant_uzivatel_id","prikazce_id","strediska_kod","predmet","max_cena_s_dph","lp_kod","zpusob_financovani","druh_objednavky_kod"].includes(e)){Vp(e,n)}Wn(a=>{let o=n;const r=(0,t.A)((0,t.A)({},a),{},{[e]:o});"zpusob_financovani"===e&&(r.lp_kod=[],r.cislo_smlouvy="",r.smlouva_poznamka="",r.individualni_schvaleni="",r.individualni_poznamka="",r.pojistna_udalost_cislo="",r.pojistna_udalost_poznamka="");const i=()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),t=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0"),i=String(e.getSeconds()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(o," ").concat(t,":").concat(r,":").concat(i)},s=()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(o)};if("stav_schvaleni"===e&&("schvaleno"===n&&Ae?(a.schvalovatel_id?(r.schvalovatel_id=a.schvalovatel_id,r.dt_schvaleni=a.dt_schvaleni):(r.schvalovatel_id=Ae,r.dt_schvaleni=i()),r.schvaleni_komentar=""):"neschvaleno"===n||"ceka_se"===n?a.schvalovatel_id?(r.schvalovatel_id=a.schvalovatel_id,r.dt_schvaleni=a.dt_schvaleni):(r.schvalovatel_id=Ae,r.dt_schvaleni=i()):""===n&&(r.schvalovatel_id="",r.dt_schvaleni="")),"stav_odeslano"===e)if(!0!==n||a.datum_odeslani){if(!1===n){r.datum_odeslani="",Bs("info","WORKFLOW","odeslano-unchecked","Checkbox Odesl\xe1no od\u0161krtnut - workflow se zm\u011bn\xed a\u017e p\u0159i ulo\u017een\xed");const e=a.stav_workflow_kod||"NOVA",n=oa(e,"ODESLANA"),o=oa(e,"ZRUSENA");n||o||a.stav_stornovano?Bs("warning","PHASE2-UNLOCK","clear-blocked-final","BLOKACE clearPhase2UnlockState - objedn\xe1vka je ODESLAN\xc1/ZRU\u0160EN\xc1 (workflow=".concat(e,")")):(Bs("info","PHASE2-UNLOCK","clear-allowed","\u010ci\u0161t\u011bn\xed Phase 2 unlock povoleno - objedn\xe1vka nen\xed v zam\u010den\xe9m stavu"),Sc())}}else r.datum_odeslani=s(),Bs("info","WORKFLOW","odeslano-checked","Checkbox Odesl\xe1no za\u0161krtnut - workflow se zm\u011bn\xed a\u017e p\u0159i ulo\u017een\xed");if("stav_stornovano"===e)if(!0!==n||a.datum_storna){if(!1===n){r.datum_storna="",r.storno_uzivatel_id="",r.storno_provedl="",r.odeslani_storno_duvod="";const e=a.stav_workflow_kod||"NOVA",n=oa(e,"ODESLANA"),o=oa(e,"ZRUSENA");n||o?Bs("warning","PHASE2-UNLOCK","clear-blocked-storno-final","BLOKACE clearPhase2UnlockState p\u0159i storno zm\u011bn\u011b - objedn\xe1vka je ODESLAN\xc1/ZRU\u0160EN\xc1 (workflow=".concat(e,")")):(Bs("info","PHASE2-UNLOCK","clear-allowed-storno","\u010ci\u0161t\u011bn\xed Phase 2 unlock po storno zm\u011bn\u011b povoleno - objedn\xe1vka nen\xed v zam\u010den\xe9m stavu"),Sc())}}else if(r.datum_storna=s(),Ae&&!a.storno_uzivatel_id&&(r.storno_uzivatel_id=Ae),ze&&!a.storno_provedl){const e="".concat(ze.titul_pred?ze.titul_pred+" ":"").concat(ze.jmeno||""," ").concat(ze.prijmeni||"").concat(ze.titul_za?", "+ze.titul_za:"").replace(/\s+/g," ").trim();r.storno_provedl=e}if("potvrzeni_vecne_spravnosti"===e)if(1===n||!0===n)if(Ae&&!a.potvrdil_vecnou_spravnost_id){const e=new Date,a=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0"),d=String(e.getSeconds()).padStart(2,"0"),l="".concat(a,"-").concat(o,"-").concat(t," ").concat(i,":").concat(s,":").concat(d);r.potvrdil_vecnou_spravnost_id=Ae,r.dt_potvrzeni_vecne_spravnosti=l,Bs("info","VECNA-SPRAVNOST","checkbox-set","Automaticky nastaveno: potvrdil_vecnou_spravnost_id=".concat(Ae,", dt=").concat(r.dt_potvrzeni_vecne_spravnosti,", checkbox_value=").concat(n))}else Ae?Bs("info","VECNA-SPRAVNOST","checkbox-already-set","ID u\u017e je nastaveno: ".concat(a.potvrdil_vecnou_spravnost_id)):Bs("error","VECNA-SPRAVNOST","no-user-id","user_id nen\xed definov\xe1no - nem\u016f\u017eu nastavit potvrdil_vecnou_spravnost_id");else 0!==n&&!1!==n||Bs("info","VECNA-SPRAVNOST","checkbox-unset","Checkbox od\u0161krtnut - ID a datum z\u016fst\xe1vaj\xed zachov\xe1ny");if("potvrzeni_dokonceni_objednavky"===e)if(1===n||!0===n)if(Ae){const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),t=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0"),d="".concat(n,"-").concat(a,"-").concat(o," ").concat(t,":").concat(i,":").concat(s);r.dokoncil_id=Ae,r.dt_dokonceni=d}else Bs("error","DOKONCENI","no-user-id","user_id nen\xed definov\xe1no");else 0!==n&&!1!==n||(r.dokoncil_id=null,r.dt_dokonceni=null);return r});["garant_uzivatel_id","prikazce_id","strediska_kod","zpusob_financovani","lp_kod","druh_objednavky_kod","stav_schvaleni","stav_odeslano","stav_stornovano"].includes(e)&&(xa.current||!Da.default.isAutosaveEnabled()||Zt||rt||!ma||Pa(!0))},[_o,Kn,Ae,xa,Da.default,Zt,rt,ma,Pa,ka]),jp=(0,i.useCallback)(e=>{Kn.stav_schvaleni===e?(xp("stav_schvaleni",""),xp("schvaleni_komentar",""),xp("schvalovatel_id","")):(xp("stav_schvaleni",e),!Ae||"schvaleno"!==e&&"neschvaleno"!==e&&"ceka_se"!==e||xp("schvalovatel_id",Ae)),xa.current||!Da.default.isAutosaveEnabled()||Zt||rt||!ma||Pa(!0)},[Kn.stav_schvaleni,Ae,xa,Da.default,Zt,rt,ma]),zp=(0,i.useCallback)(()=>{zr(!0),Or("new"),Dr(null),wr(""),Er("po")},[]),Ap=(0,i.useCallback)(()=>{Nn?(Ge(e=>{const n=(0,t.A)({},e);return Object.keys(n).forEach(e=>{n[e]=!1}),n}),Dn(!1)):(Ge(e=>{const n=(0,t.A)({},e),a=[];return Object.keys(n).forEach(e=>{if("registr_smluv"===e)return;const o=ps[e];o&&!o.enabled&&(n[e]=!0,a.push(e))}),a.length,n}),Dn(!0))},[Nn,ps,Jn]),wp=(0,i.useCallback)(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"smooth";const a=Nc.current;if(!a)return!1;const o=a.querySelector('[data-section="'.concat(e,'"]'));if(!o)return!1;try{const e=o.querySelector('[class*="SectionHeader"]')||o.querySelector("div:first-child"),t=(e||o).offsetTop,r=t-parseInt(getComputedStyle(document.documentElement).getPropertyValue("--fixed-header-height")||"200");return"smooth"===n?a.scrollTo({top:r,behavior:"smooth"}):a.scrollTop=r,!0}catch(t){return!1}},[ps,ns,Jn,je]),Sp=(0,i.useCallback)(e=>{wp("vecna_spravnost"===e?"fakturace":e,"smooth")},[wp]),Ep=(0,i.useCallback)(e=>{e&&e.length>0&&(Fc(e),je&&je("\ud83d\udcce Nahr\xe1v\xe1m ".concat(e.length," soubor(\u016f)..."),{type:"info"}))},[Fc,je]),Cp=((0,i.useCallback)(async()=>{if(Kn.id)if(null!==ze&&void 0!==ze&&ze.id)try{Bs("info","STATUS-RELOAD","start","Na\u010d\xedt\xe1m aktu\xe1ln\xed stav objedn\xe1vky ID: ".concat(Kn.id,", u\u017eivatel: ").concat(ze.id));const e=await(0,Ia.Hj)(parseInt(Kn.id),Se,we,!1);if(!e||!e.id)throw new Error("Nepoda\u0159ilo se na\u010d\xedst stav objedn\xe1vky z datab\xe1ze");Bs("success","STATUS-RELOAD","loaded",'Na\u010dten aktu\xe1ln\xed stav: stav_objednavky="'.concat(e.stav_objednavky,'", stav_workflow_kod="').concat(e.stav_workflow_kod,'"')),Wn(n=>(0,t.A)((0,t.A)({},n),{},{stav_workflow_kod:e.stav_workflow_kod,stav_objednavky:e.stav_objednavky}));const n=(0,t.A)((0,t.A)({},Kn),{},{stav_workflow_kod:e.stav_workflow_kod,stav_objednavky:e.stav_objednavky});zc(n,{isOrderSavedToDB:!0,savedOrderId:Kn.id,isChanged:va}),Bs("success","STATUS-RELOAD","complete","Stav aktualizov\xe1n a ulo\u017een do konceptu")}catch(e){Bs("error","STATUS-RELOAD","failed",e.message),je&&je("Chyba p\u0159i na\u010d\xedt\xe1n\xed stavu z datab\xe1ze: ".concat(e.message),{type:"error"})}else je&&je("Nelze na\u010d\xedst stav z datab\xe1ze - nen\xed p\u0159ihl\xe1\u0161en u\u017eivatel",{type:"error"});else je&&je("Nelze na\u010d\xedst stav z datab\xe1ze - objedn\xe1vka nen\xed ulo\u017eena",{type:"error"})},[Kn,ze,Se,we,je,va]),(0,i.useCallback)(()=>{if(!Kn.id)return!1;if(Gn<3)return!1;const e=oa(Kn.stav_workflow_kod,"ROZPRACOVANA"),n=oa(Kn.stav_workflow_kod,"ODESLANA"),a=oa(Kn.stav_workflow_kod,"POTVRZENA");return!!oa(Kn.stav_workflow_kod,"SCHVALENA")&&!!(e||n||a)},[Kn.id,Kn.stav_workflow_kod,Gn,oa,Xn])),Op=(0,i.useCallback)(()=>{if(Cp())try{Bs("info","DOCX-GENERATOR","open-dialog","Otev\xedr\xe1m DOCX gener\xe1tor pro objedn\xe1vku ID: ".concat(Kn.id));const e=(0,t.A)({objednavka_id:Kn.id,cislo_objednavky:Kn.cislo_objednavky,nazev_objednavky:Kn.nazev_objednavky||Kn.nazev},Kn);Pt(e),Tt(!0)}catch(e){Bs("error","DOCX-GENERATOR","error",e.message),je&&je("Chyba p\u0159i otev\xedr\xe1n\xed DOCX gener\xe1toru: ".concat(e.message),{type:"error"})}else Kn.id?Gn<3?je&&je('DOCX lze generovat a\u017e od f\xe1ze "Odes\xedl\xe1n\xed objedn\xe1vky"',{type:"warning"}):je&&je("DOCX lze generovat a\u017e kdy\u017e je objedn\xe1vka v procesu zpracov\xe1n\xed",{type:"warning"}):je&&je("DOCX lze generovat pouze u ulo\u017een\xfdch objedn\xe1vek",{type:"warning"})},[Kn,Gn,je]),Np=(0,i.useCallback)(()=>{Tt(!1),Pt(null)},[]),Dp=(0,i.useCallback)(async()=>{if(ra){try{if(za.current=!0,Da.default.setAutosaveEnabled(!1,"Closing completed/rejected/cancelled order"),xa.current=!0,Ht(!0),La&&La(),ja.current&&(clearTimeout(ja.current),ja.current=null),Ae){Da.default.setCurrentUser(Ae),await Da.default.deleteAllDraftKeys();try{localStorage.removeItem("order_form_isEditMode_".concat(Ae)),localStorage.removeItem("openOrderInConcept-".concat(Ae)),localStorage.removeItem("order_form_savedOrderId_".concat(Ae)),localStorage.removeItem("savedOrderId-".concat(Ae))}catch(o){}}const e=He||Kn.id;if(e&&Se&&we)try{await(0,Ia.$_)({token:Se,username:we,orderId:e})}catch(t){}try{Mn(!1),(0,Ya.aO)(Ae),ya({isEditMode:!1,isNewOrder:!1,orderId:null,orderNumber:""}),await new Promise(e=>setTimeout(e,50))}catch(o){}xe("/orders25-list",{state:{forceReload:!0}})}catch(t){je&&je("Chyba p\u0159i zav\xedr\xe1n\xed: ".concat(t.message),{type:"error"})}return}const e=pn.filter(e=>!e.serverId&&"uploaded"!==e.status&&!e.fromServer&&e.file),n=pn.filter(e=>!e.klasifikace||""===e.klasifikace.trim());let a="Koncept bude zru\u0161en a neulo\u017een\xe9 zm\u011bny nebudou ulo\u017eeny.";(e.length>0||n.length>0)&&(a+="\n\n\u2139\ufe0f Informace o p\u0159\xedloh\xe1ch:\n\u2022 ".concat(e.length," neulo\u017een\xfdch p\u0159\xedloh\n\u2022 ").concat(n.length," neklasifikovan\xfdch p\u0159\xedloh")),eo(a),Ja(!0)},[pn,ra,Ae,Kn.id,Se,we,je,xe]),Tp=(0,i.useCallback)(async()=>{Bs("info","CANCEL","draftmanager-close","Zav\xedr\xe1m formul\xe1\u0159 p\u0159es DraftManager");try{if(za.current=!0,Da.default.setAutosaveEnabled(!1,"Form closing - prevent save during cleanup"),xa.current=!0,Ht(!0),La&&La(),ja.current&&(clearTimeout(ja.current),ja.current=null),Kt(!1),it(!1),ct(""),dt(0),Ki(!1),window._activeProgressControl&&(window._activeProgressControl.cancel(),window._activeProgressControl=null),Ae){Da.default.setCurrentUser(Ae);await Da.default.deleteAllDraftKeys()&&Bs("success","CANCEL","draftmanager-cleanup","V\u0161echny draft kl\xed\u010de smaz\xe1ny p\u0159es DraftManager");await Da.default.hasDraft()&&await Da.default.deleteAllDraftKeys();try{localStorage.removeItem("order_form_isEditMode_".concat(Ae)),localStorage.removeItem("openOrderInConcept-".concat(Ae)),localStorage.removeItem("order_form_savedOrderId_".concat(Ae)),localStorage.removeItem("savedOrderId-".concat(Ae))}catch(e){}}const a=He||Kn.id;if(a&&Se&&we)try{await(0,Ia.$_)({token:Se,username:we,orderId:a}),Bs("success","CANCEL","unlock","Objedn\xe1vka ".concat(a," byla odemknuta"))}catch(n){Bs("warning","CANCEL","unlock-error","Chyba p\u0159i odemyk\xe1n\xed: ".concat(n.message," - ignorov\xe1no"))}try{Mn(!1),(0,Ya.aO)(Ae),await new Promise(e=>setTimeout(e,50)),ya({isEditMode:!1,isNewOrder:!1,orderId:null,orderNumber:""}),Bs("success","CANCEL","broadcast","Broadcast stavu odesl\xe1n (formul\xe1\u0159 zav\u0159en)")}catch(e){Bs("warning","CANCEL","broadcast-error","Chyba p\u0159i broadcastu: ".concat(e.message))}Ja(!1),eo(""),Bs("info","CANCEL","redirect","P\u0159esm\u011brov\xe1v\xe1m na seznam objedn\xe1vek"),setTimeout(()=>{xe("/orders25-list",{state:{forceReload:!0}})},200)}catch(n){Bs("error","CANCEL","error","Chyba p\u0159i zav\xedr\xe1n\xed: ".concat(n.message)),je&&je("Chyba p\u0159i zav\xedr\xe1n\xed: ".concat(n.message),{type:"error"}),Kt(!1),it(!1),Ja(!1),eo(""),setTimeout(()=>{xe("/orders25-list",{state:{forceReload:!0}})},100)}},[Ae,Da.default,Kn.id,Se,we,je,xe]),Ip=(0,i.useCallback)(()=>{Ja(!1),eo("")},[]),[Pp,Rp]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(Pp&&Sn&&!Zt){(async()=>{try{Kt(!0);const e={};Kn.predmet&&(e.predmet=Kn.predmet),Kn.garant_uzivatel_id&&(e.garant_uzivatel_id=Kn.garant_uzivatel_id);const n=aa(Kn.stav_workflow_kod).filter(e=>"ODESLANA"!==e&&"ZRUSENA"!==e);e.stav_workflow_kod=JSON.stringify(n),e.stav_odeslano=!1,e.stav_stornovano=!1,await(0,Ia.qA)(Kn.id,e,Se,we)}catch(e){je&&je("Chyba p\u0159i ukl\xe1d\xe1n\xed: ".concat(e.message),{type:"error"})}finally{Rp(!1),Kt(!1)}})()}},[Pp,Sn,Zt]);const Lp=e=>{Bs("info","UNLOCK",e,"Odem\u010den\xed ni\u017e\u0161\xed sekce \u2192 automaticky ru\u0161\xedm checkboxy vy\u0161\u0161\xedch f\xe1z\xed"),xp("potvrzeni_vecne_spravnosti",0),xp("potvrzeni_dokonceni_objednavky",0),da(),setTimeout(()=>Pa(!0),100)},Vp=(e,n)=>{const a=(0,t.A)((0,t.A)({},Kn),{},{[e]:n}),o=Ga(a,1===Gn?"NOVA":Xn);mo(n=>{const a=(0,t.A)({},n);return o[e]?a[e]=o[e]:delete a[e],a})},Fp=()=>{if(pa)return mo({}),!0;(0,s.flushSync)(()=>{fo(!0)});let e={};if(Kn.stav_stornovano){var n;null!==(n=Kn.odeslani_storno_duvod)&&void 0!==n&&n.trim()||(e.odeslani_storno_duvod="D\u016fvod stornov\xe1n\xed je povinn\xfd")}else{var a,o,r;const n=1===Gn?"NOVA":Xn,s={phase1:{visible:Gn>=1,locked:gs},phase2:{visible:Gn>=2,locked:xs},financovani:{visible:zs.visible,locked:!zs.enabled},phase3:{visible:Gn>=3,locked:ws},phase4to6:{visible:Gn>=4,locked:Ss},registr_smluv_vyplneni:{visible:fs.visible,locked:hs}},c=Ga(Kn,n,s);e=(0,t.A)((0,t.A)({},e),c);const p=s.financovani.visible&&!s.financovani.locked;if(Gn>=1&&Kn.zpusob_financovani&&p){const n=Ci.find(e=>e.kod===Kn.zpusob_financovani||e.kod_stavu===Kn.zpusob_financovani||e.value===Kn.zpusob_financovani);if(n){const a=n.nazev_stavu||n.nazev||"";var i,d;if((a.includes("Limitovan")||a.includes("p\u0159\xedslib"))&&((!Kn.lp_kod||Array.isArray(Kn.lp_kod)&&0===Kn.lp_kod.length)&&(e.lp_kod="LP k\xf3d je povinn\xfd p\u0159i financov\xe1n\xed z Limitovan\xe9ho p\u0159\xedslibu"),Gn>=3&&Kn.polozky_objednavky&&Kn.polozky_objednavky.length>0&&Kn.polozky_objednavky.forEach((n,a)=>{n.polozka_lp_id||n.lp_id||(e["polozka_".concat(a,"_lp")]="Polo\u017eka ".concat(a+1,": LP je povinn\xe9 p\u0159i financov\xe1n\xed z Limitovan\xe9ho p\u0159\xedslibu"))})),a.includes("Smlouva"))if(null!==(i=Kn.cislo_smlouvy)&&void 0!==i&&i.trim()){ar.some(e=>0!==e.aktivni&&!1!==e.aktivni&&(e.cislo_smlouvy===Kn.cislo_smlouvy||e.evidencni_cislo===Kn.cislo_smlouvy))||(e.cislo_smlouvy="Zadan\xe9 \u010d\xedslo smlouvy neexistuje v seznamu aktivn\xedch smluv. Vyberte pros\xedm platnou smlouvu.")}else e.cislo_smlouvy="\u010c\xedslo smlouvy je povinn\xe9 p\u0159i financov\xe1n\xed ze Smlouvy";if(a.includes("Individu\xe1ln\xed")){("string"===typeof Kn.individualni_schvaleni?Kn.individualni_schvaleni:"").trim()||(e.individualni_schvaleni="Zadejte identifik\xe1tor - referen\u010dn\xed \u010d\xedslo nebo ozna\u010den\xed schv\xe1len\xed je povinn\xe9")}if(a.includes("Pojistn"))null!==(d=Kn.pojistna_udalost_cislo)&&void 0!==d&&d.trim()||(e.pojistna_udalost_cislo="Zadejte \u010d\xedslo pojistn\xe9 ud\xe1losti - referen\u010dn\xed \u010d\xedslo \u0161kodn\xed ud\xe1losti je povinn\xe9")}}if(4===Gn&&"ANO"===(null===(a=Kn.dodavatel_zpusob_potvrzeni)||void 0===a?void 0:a.potvrzeni)){var l;const n=Kn.dodavatel_zpusob_potvrzeni;(null===n||void 0===n?void 0:n.zpusoby)&&n.zpusoby.length>0||(e.dodavatel_zpusob_potvrzeni='Vyberte zp\u016fsob potvrzen\xed (e-mail, telefon nebo p\xedsemn\u011b) - p\u0159i odpov\u011bdi "ANO" je povinn\xfd alespo\u0148 jeden'),null!==n&&void 0!==n&&n.platba&&""!==n.platba.trim()||(e.zpusob_platby="Vyberte zp\u016fsob platby (faktura/pokladna) - pole je povinn\xe9 p\u0159i potvrzen\xed dodavatele"),null!==(l=Kn.dt_akceptace)&&void 0!==l&&l.trim()||(e.dt_akceptace="Zadejte datum akceptace - kdy dodavatel potvrdil objedn\xe1vku")}Gn>=3&&Pi&&Kn.polozky_objednavky&&Kn.polozky_objednavky.length>0&&Kn.polozky_objednavky.forEach((n,a)=>{n.usek_kod&&n.usek_kod.trim()||(e["polozka_".concat(a,"_usek_kod")]="Polo\u017eka ".concat(a+1,": Vyberte \xfasek - ur\u010den\xed lokace je povinn\xe9 u majetkov\xfdch polo\u017eek")),n.budova_kod&&n.budova_kod.trim()||(e["polozka_".concat(a,"_budova_kod")]="Polo\u017eka ".concat(a+1,": Vyberte budovu - ur\u010den\xed lokace je povinn\xe9 u majetkov\xfdch polo\u017eek")),n.mistnost_kod&&n.mistnost_kod.trim()||(e["polozka_".concat(a,"_mistnost_kod")]="Polo\u017eka ".concat(a+1,": Vyberte m\xedstnost - ur\u010den\xed lokace je povinn\xe9 u majetkov\xfdch polo\u017eek"))});const u="pokladna"===(null===(o=Kn.financovani)||void 0===o?void 0:o.platba),v="pokladna"===(null===(r=Kn.dodavatel_zpusob_potvrzeni)||void 0===r?void 0:r.platba),_=u||v;if(Gn>=6&&!_&&Kn.faktury&&Kn.faktury.length>0&&Kn.faktury.forEach((n,a)=>{const o="faktura_".concat(a+1);(!n.fa_cislo_vema||"string"===typeof n.fa_cislo_vema&&""===n.fa_cislo_vema.trim())&&(e["".concat(o,"_cislo")]="Faktura ".concat(a+1,": Zadejte variabiln\xed symbol faktury")),(!n.fa_castka||parseFloat(n.fa_castka)<=0)&&(e["".concat(o,"_castka")]="Faktura ".concat(a+1,": Zadejte \u010d\xe1stku faktury (mus\xed b\xfdt v\u011bt\u0161\xed ne\u017e 0 K\u010d)")),(!n.fa_datum_doruceni||"string"===typeof n.fa_datum_doruceni&&""===n.fa_datum_doruceni.trim())&&(e["".concat(o,"_dorucena")]="Faktura ".concat(a+1,": Zadejte datum, kdy byla faktura doru\u010dena")),(!n.fa_splatnost||"string"===typeof n.fa_splatnost&&""===n.fa_splatnost.trim())&&(e["".concat(o,"_splatnost")]="Faktura ".concat(a+1,": Zadejte datum splatnosti faktury"))}),Gn>=7&&!_&&Kn.faktury&&Kn.faktury.length>0){const n=parseFloat(Kn.max_cena_s_dph)||0;Kn.faktury.forEach((a,o)=>{1!==a.vecna_spravnost_potvrzeno&&!0!==a.vecna_spravnost_potvrzeno&&(e["faktura_".concat(o+1,"_vecna_spravnost")]="Faktura ".concat(o+1,': Za\u0161krtn\u011bte pol\xed\u010dko "Potvrzuji v\u011bcnou spr\xe1vnost" po kontrole faktury'));(parseFloat(a.fa_castka)||0)>n&&(!a.vecna_spravnost_poznamka||""===a.vecna_spravnost_poznamka.trim())&&(e["faktura_".concat(o+1,"_poznamka_vs")]="Faktura ".concat(o+1,": Vysv\u011btlete v pozn\xe1mce, pro\u010d faktura p\u0159ekra\u010duje max. cenu objedn\xe1vky (").concat(n.toFixed(2)," K\u010d)"))})}}const c=Object.keys(e).length>0;(0,s.flushSync)(()=>{mo(e)});const p=Object.keys(e).filter(e=>e.includes("_usek_kod")||e.includes("_budova_kod")||e.includes("_mistnost_kod"));if(p.length>0){var u;const e=new Set;p.forEach(n=>{const a=n.match(/polozka_(\d+)_/);a&&e.add(parseInt(a[1]))});const n=(0,t.A)({},ho);null===(u=Kn.polozky_objednavky)||void 0===u||u.forEach((a,o)=>{e.has(o)&&(n[a.id]=!0)}),(0,s.flushSync)(()=>{yo(n)})}if(c){Object.keys(e).length;if(Kn.stav_stornovano)je&&je("Nelze stornovat - zkontrolujte vyzna\u010den\xe1 pole",{type:"error"});else{const n=Ri(e);je&&je(n,{type:"error",timeout:1e4})}setTimeout(()=>{Mp(e)},100)}return!c},Mp=e=>{if(!e||0===Object.keys(e).length)return;const n=["jmeno","email","garant_uzivatel_id","predmet","prikazce_id","max_cena_s_dph","strediska_kod","schvaleni_komentar","dodavatel_nazev","dodavatel_adresa","dodavatel_ico","druh_objednavky_kod","polozky_objednavky","zpusob_financovani","lp_kod","datum_odeslani","dodavatel_zpusob_potvrzeni","zpusob_platby","dt_akceptace","dt_zverejneni","registr_iddt"];for(const a of n)if(e[a]){let n=null,o=null;switch(a){case"jmeno":n=document.querySelector('input[name="jmeno"]');break;case"email":n=document.querySelector('input[type="email"][name="email"]');break;case"garant_uzivatel_id":n=document.querySelector('[data-field="garant"]');break;case"predmet":n=document.querySelector('input[name="predmet"]');break;case"prikazce_id":n=document.querySelector('[data-field="prikazce"]');break;case"max_cena_s_dph":n=document.querySelector('input[name="max_cena_s_dph"]');break;case"strediska_kod":n=document.querySelector('[data-field="strediska"]');break;case"schvaleni_komentar":n=document.querySelector('textarea[name="schvaleni_komentar"]');break;case"dodavatel_nazev":n=document.querySelector('input[name="dodavatel_nazev"]');break;case"dodavatel_adresa":n=document.querySelector('input[name="dodavatel_adresa"]');break;case"dodavatel_ico":n=document.querySelector('input[name="dodavatel_ico"]');break;case"druh_objednavky_kod":n=document.querySelector('[data-field="druh_objednavky_kod"]');break;case"polozky_objednavky":const o=Object.keys(e).filter(e=>e.startsWith("polozka_"));if(o.length>0){const e=o[0],a=parseInt(e.split("_")[1]);n=document.querySelector('[data-polozka-index="'.concat(a,'"]')),n||(n=document.querySelector('[data-section="detaily"]'))}break;case"zpusob_financovani":n=document.querySelector('[data-field="zpusob_financovani"]');break;case"lp_kod":n=document.querySelector('[data-field="lp_kod"]');break;case"datum_odeslani":n=document.querySelector('input[name="datum_odeslani"]');break;case"dodavatel_zpusob_potvrzeni":n=document.querySelector('[name="dodavatel_zpusob_potvrzeni"]');break;case"zpusob_platby":n=document.querySelector('[name="zpusob_platby"]');break;case"dt_akceptace":n=document.querySelector('input[name="dt_akceptace"]');break;case"dt_zverejneni":n=document.querySelector('[data-field="dt_zverejneni"]')||document.querySelector('button[data-datepicker="dt_zverejneni"]');break;case"registr_iddt":n=document.querySelector('input[name="registr_iddt"]');break;default:n=document.querySelector('[name="'.concat(a,'"], [data-field="').concat(a,'"]'))}if(n){if(o=n.closest("[data-section]"),o){const e=o.getAttribute("data-section");if(e&&Je[e]){Ge(n=>(0,t.A)((0,t.A)({},n),{},{[e]:!1})),setTimeout(()=>{n.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{try{const e=n.querySelector("input");e?e.focus():n.focus()}catch(e){}},300)},300);break}}n.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{try{const e=n.querySelector("input");e?e.focus():n.focus()}catch(e){}},300);break}}},Up=()=>{Ir(!1),Rr(null)},Zp=async()=>{if(Se&&Ae){xr(!0);try{let n=await(0,me.$o)({username:(null===Ee||void 0===Ee?void 0:Ee.username)||we,token:Se,user_id:Ae||0,kategorie:"OBJEDNAVKA25",debug:!0}),a=[];if(Array.isArray(null===n||void 0===n?void 0:n.items)?a=n.items:(Array.isArray(null===n||void 0===n?void 0:n.data)||null!==n&&void 0!==n&&n.success&&Array.isArray(null===n||void 0===n?void 0:n.data))&&(a=n.data),a.length>0){const o=a.filter(e=>0===e.user_id||"0"===String(e.user_id)),r=a.filter(e=>0!==e.user_id&&"0"!==String(e.user_id)),i=o.map(e=>{const n=e.nazev_sablony||e.nazev||e.name||"sablona-".concat(e.id),a=e.dt_aktualizace||e.dt_vytvoreni||Date.now(),o=Kp(e),r=e.typ||e.type||"",i=("string"===typeof r?r:String(r||"")).trim().toLowerCase();let s=null;i&&("po"===i||"p_o"===i||"p.o"===i||"p"===i?s="PO":"detail"===i||"det"===i||"details"===i?s="DETAIL":"obejd"===i||"po+detail"===i||"po_detail"===i||"both"===i||i.includes("po")&&i.includes("detail")?s="OBEJD":i.includes("po")?s="PO":i.includes("det")&&(s="DETAIL"));const d=s||(o.poApproval&&o.orderDetails?"OBEJD":o.poApproval?"PO":o.orderDetails?"DETAIL":"PO");return(0,t.A)((0,t.A)({},e),{},{name:n,dbName:e.nazev_sablony||null,ts:new Date(a).getTime?new Date(a).getTime():Date.now(),type:d,__fromServer:!0,data:o})});yr(i);const s=r.map(e=>{const n=e.nazev_sablony||e.nazev||e.name||"sablona-".concat(e.id),a=e.dt_aktualizace||e.dt_vytvoreni||Date.now(),o=Kp(e),r=e.typ||e.type||"",i=("string"===typeof r?r:String(r||"")).trim().toLowerCase();let s=null;i&&("po"===i||"p_o"===i||"p.o"===i||"p"===i?s="PO":"detail"===i||"det"===i||"details"===i?s="DETAIL":"obejd"===i||"po+detail"===i||"po_detail"===i||"both"===i||i.includes("po")&&i.includes("detail")?s="OBEJD":i.includes("po")?s="PO":i.includes("det")&&(s="DETAIL"));const d=s||(o.poApproval&&o.orderDetails?"OBEJD":o.poApproval?"PO":o.orderDetails?"DETAIL":"PO");return(0,t.A)((0,t.A)({},e),{},{name:n,dbName:e.nazev_sablony||null,ts:new Date(a).getTime?new Date(a).getTime():Date.now(),type:d,__fromServer:!0,data:o})});fr(s);try{const e=Ae?"order_templates_".concat(Ae):"order_templates";localStorage.setItem(e,JSON.stringify(s))}catch(e){}br({status:(null===n||void 0===n?void 0:n.status)||"success",error:(null===n||void 0===n?void 0:n.error)||null,raw:(null===n||void 0===n?void 0:n.raw)||null}),gp("fetch",{count:a.length,serverCount:i.length,userCount:s.length})}else br({status:(null===n||void 0===n?void 0:n.status)||"empty",error:(null===n||void 0===n?void 0:n.error)||"\u017d\xe1dn\xe9 \u0161ablony nenalezeny",raw:(null===n||void 0===n?void 0:n.raw)||null})}catch(e){br({status:"error",error:e.message})}finally{xr(!1)}}},Kp=e=>{try{const n=e=>{if(null===e||void 0===e)return null;if("string"!==typeof e)return e;const n=e.trim();if(!n)return null;try{return JSON.parse(n)}catch(o){}let a=n.replace(/\r?\n/g," ").trim();try{a=a.replace(/([\{,\s])(\w[\w\-]*)\s*:/g,'$1"$2":')}catch(o){}a=a.replace(/'/g,'"');try{return JSON.parse(a)}catch(o){}try{return new Function("return ("+n+");")()}catch(o){return null}},a=e.polozky_po?n(e.polozky_po):null,o=e.polozky_detail?n(e.polozky_detail):null,r=e=>{if(!e||"object"!==typeof e||Array.isArray(e))return e;const n={};return Object.keys(e).forEach(a=>{const o=e[a];if(a.includes(".")){const e=a.split(".");let t=n;e.forEach((n,a)=>{a===e.length-1?t[n]=o:(t[n]&&"object"===typeof t[n]||(t[n]={}),t=t[n])})}else"object"!==typeof o||null===o||Array.isArray(o)||"object"!==typeof n[a]?n[a]=o:n[a]=(0,t.A)((0,t.A)({},n[a]),o)}),n},i=a?r(a):null,s=o?r(o):null,d={};return i&&(d.poApproval=i),s&&(d.orderDetails=s),d}catch(n){return{}}},Bp=async(e,n,a)=>{if(Se&&Ae)try{const r="po"!==a&&"mixed"!==a||!n.poApproval?"":JSON.stringify(n.poApproval),i="details"!==a&&"mixed"!==a||!n.orderDetails?"":JSON.stringify(n.orderDetails),s="po"===a?"PO":"details"===a?"DETAIL":"OBEJD",d=await(0,me.Xu)({username:(null===Ee||void 0===Ee?void 0:Ee.username)||we,token:Se,user_id:Ae||0,nazev_sablony:e,polozky_po:r,polozky_detail:i,typ:s,kategorie:"OBJEDNAVKA25"});if(!(null!==d&&void 0!==d&&d.success||"ok"===(null===d||void 0===d?void 0:d.status))){var o;const e=(null===d||void 0===d?void 0:d.message)||(null===d||void 0===d||null===(o=d.data)||void 0===o?void 0:o.message)||"Chyba p\u0159i ukl\xe1d\xe1n\xed";throw new Error(e)}{var t;const o={name:e,data:n,ts:Date.now(),type:a,id:d.insertId||d.id||(null===(t=d.data)||void 0===t?void 0:t.id),user_id:Ae,__fromServer:!0};fr(e=>{const n=[o,...e];try{const e=Ae?"order_templates_".concat(Ae):"order_templates";localStorage.setItem(e,JSON.stringify(n))}catch(a){}return n}),gp("save",{name:e,type:a,mode:"server"}),je&&je('\u0160ablona "'.concat(e,'" byla ulo\u017eena'),{type:"success"})}}catch(r){je&&je("Chyba p\u0159i ukl\xe1d\xe1n\xed \u0161ablony: ".concat(r.message),{type:"error"})}},Wp=(0,i.useCallback)((e,n)=>{if(!e)return"";switch(n){case"garant":return"".concat(e.titul_pred?e.titul_pred+" ":"").concat(e.jmeno||""," ").concat(e.prijmeni||"").concat(e.titul_za?", "+e.titul_za:"").replace(/\s+/g," ").trim();case"prikazce":if(!e||0===e||0===e.id||0===e.user_id||null===e.id||null===e.user_id)return"Nezn\xe1m\xfd";return("".concat(e.titul_pred?e.titul_pred+" ":"").concat(e.jmeno||""," ").concat(e.prijmeni||"").concat(e.titul_za?", "+e.titul_za:"").replace(/\s+/g," ").trim()||"Nezn\xe1m\xfd")+(e.usek_zkr?" (".concat(e.usek_zkr,")"):"");case"strediska":case"strediska_kod":return e.label?e.label:e.name||e.nazev_stavu||e.toString();case"financovani":case"zpusob_financovani":return e.nazev_stavu||e.nazev||e.label||("string"===typeof e?e:"Nezn\xe1m\xfd");case"lp_kod":return e.cislo_lp?"".concat(e.cislo_lp," - ").concat(e.nazev_uctu||"Bez n\xe1zvu"):"".concat(e.id||e," - ").concat(e.nazev_uctu||e.nazev||e.label||"Bez n\xe1zvu");case"druh_objednavky_kod":const a=e.nazev_stavu||e.nazev||e.label||("string"===typeof e?e:"Nezn\xe1m\xfd");return 1===e.atribut_objektu||"1"===e.atribut_objektu?"".concat(a,"   (majetek)"):a;case"statusFilter":return e.nazev_stavu||e.nazev||e.popis||e.kod_stavu||e.kod||String(e);case"selectedObjednatel":case"selectedGarant":return e.displayName||"".concat(e.jmeno||""," ").concat(e.prijmeni||"").trim()||"Bez jm\xe9na";case"selectedSchvalovatel":return e&&0!==e&&0!==e.id&&0!==e.user_id&&null!==e.id&&null!==e.user_id&&(e.displayName||e.jmeno_prijmeni||"".concat(e.jmeno||""," ").concat(e.prijmeni||"").trim())||"Nezn\xe1m\xfd";case"pageSize":return e.label||String(e.value||e);default:return n&&"string"===typeof n&&n.startsWith("polozka_")&&n.endsWith("_lp")?e.label||(e.kod&&e.nazev?"".concat(e.kod," - ").concat(e.nazev):String(e)):e.label||("string"===typeof e?e:String(e))}},[]);(0,i.useEffect)(()=>{const e=e=>{e.target.closest("[data-custom-select]")||Ye({garant:!1,prikazce:!1,strediska:!1,financovani:!1,lp_kod:!1})};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const Hp=(0,i.useCallback)(e=>{var n;if("Tab"!==e.key)return;const a=document.activeElement;if((null===a||void 0===a?void 0:a.closest('[class*="Dropdown"]'))||(null===a||void 0===a?void 0:a.closest('[class*="SelectDropdown"]'))||(null===a||void 0===a?void 0:a.closest('[class*="TemplateDropdown"]')))return;const o=document.querySelector('[class*="ScrollableContent"]');if(!o)return;if(!o.contains(a))return;const t=['input:not([disabled]):not([tabindex="-1"])','textarea:not([disabled]):not([tabindex="-1"])','select:not([disabled]):not([tabindex="-1"])','button:not([disabled]):not([tabindex="-1"])','[tabindex]:not([tabindex="-1"]):not([disabled])','[data-field]:not([disabled]):not([tabindex="-1"])'].join(","),r=Array.from(o.querySelectorAll(t)).filter(e=>{if(!e.offsetParent&&"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName)return!1;const n=window.getComputedStyle(e);return"none"!==n.display&&"hidden"!==n.visibility&&(!e.disabled&&"true"!==e.getAttribute("aria-disabled"))});if(0===r.length)return;const i=r.indexOf(a);var s;if(-1===i)return e.preventDefault(),void(null===(s=r[0])||void 0===s||s.focus());let d;e.shiftKey?(d=i-1,d<0&&(d=r.length-1)):(d=i+1,d>=r.length&&(d=0)),e.preventDefault(),null===(n=r[d])||void 0===n||n.focus()},[]);i.useMemo(()=>!!Rt||!!Lt,[Rt,Lt]);if(!Se||!we)return(0,ke.jsxs)(hl,{$visible:!0,children:[(0,ke.jsx)(yl,{$visible:!0}),(0,ke.jsx)(bl,{$visible:!0,children:"Ov\u011b\u0159uji p\u0159ihl\xe1\u0161en\xed..."}),(0,ke.jsx)(gl,{$visible:!0,children:"\u010cek\xe1m na autentizaci..."})]});if(!xi.isReady)return(0,ke.jsxs)(hl,{$visible:!0,children:[(0,ke.jsx)(yl,{$visible:!0}),(0,ke.jsxs)(bl,{$visible:!0,children:["MOUNTING"===xi.phase&&"Inicializuji formul\xe1\u0159...","LOADING_DICTIONARIES"===xi.phase&&"Na\u010d\xedt\xe1m \u010d\xedseln\xedky...","READY_FOR_DATA"===xi.phase&&"P\u0159ipravuji data...","LOADING_DATA"===xi.phase&&"Na\u010d\xedt\xe1m data objedn\xe1vky...","DATA_LOADED"===xi.phase&&"Dokon\u010duji na\u010d\xedt\xe1n\xed...","READY"===xi.phase&&"P\u0159ipravuji formul\xe1\u0159...",!xi.phase&&"Na\u010d\xedt\xe1m formul\xe1\u0159 objedn\xe1vky"]}),(0,ke.jsxs)(gl,{$visible:!0,children:[!ji.isReady&&"Na\u010d\xedt\xe1m ".concat(ji.loadedCount||0,"/").concat(ji.totalToLoad||8," \u010d\xedseln\xedk\u016f..."),ji.isReady&&xi.isLoadingFormData&&"Na\u010d\xedt\xe1m data objedn\xe1vky...",ji.isReady&&!xi.isLoadingFormData&&!xi.isReady&&"Zpracov\xe1v\xe1m data..."]})]});if(Ut&&!Se)return(0,ke.jsx)(ad,{isFullscreen:tn,children:(0,ke.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:(0,ke.jsxs)(jl,{children:["Chyba inicializace: ",Ut]})})});const $p=(0,ke.jsxs)(ad,{isFullscreen:tn,children:[(0,ke.jsx)(wa,{onSectionClick:Sp,onFilesDrop:Ep,onToggleSections:Ap,areSectionsCollapsed:Nn,currentPhase:Qn(),validationErrors:_o,formData:us,isFullscreen:tn,isSectionActive:qi,allSectionStates:vs,isWorkflowCompleted:ra,canPublishRegistry:as,canUnlockAnything:ds,onSaveAsTemplate:zp,onGenerateDocx:Op,onToggleFullscreen:()=>rn(!tn),canGenerateDocx:Cp()&&!Ds,canSaveTemplate:!rt&&!Zt&&!!Se&&!!Ae&&!Ds,serverTemplates:hr,savedTemplates:kr,templatesLoading:gr,searchQuery:vi,showSearch:ui,token:Se,hasPermission:Oe,onTemplateSearch:e=>vo(n=>(0,t.A)((0,t.A)({},n),{},{searchPredefs:e})),onToggleTemplateSearch:()=>{return e=e=>!e,vo(n=>(0,t.A)((0,t.A)({},n),{},{showSearchPredefs:e}));var e},onRefreshTemplates:Zp,onFillPoApproval:e=>{if(Gn>=2)return;const n=null===e||void 0===e?void 0:e.data;if(null!==n&&void 0!==n&&n.poApproval){const a=(0,t.A)({},Kn),o=(0,t.A)((0,t.A)((0,t.A)({},a),n.poApproval),{},{id:a.id,ev_cislo:a.ev_cislo});Wn(o),gp("apply-po",{name:e.name,source:"saved",ts:e.ts,preview:bp(n)}),Da.default.setAutosaveEnabled(!0),zc(!0,!1,o).catch(e=>{})}},onFillDetails:e=>{if(Gn<2)return;const n=null===e||void 0===e?void 0:e.data;if(null===n||void 0===n||!n.orderDetails)return;const a=qa(Xn,Gn,$n),o={financovani:["zpusob_financovani","financovani","lp_kod","cislo_smlouvy","smlouva_poznamka","individualni_schvaleni","individualni_poznamka","pojistna_udalost_cislo","pojistna_udalost_poznamka"],dodavatel:["dodavatel_id","dodavatel_nazev","dodavatel_adresa","dodavatel_ico","dodavatel_dic","dodavatel_zastoupeny"],kontakt:["dodavatel_kontakt_jmeno","dodavatel_kontakt_email","dodavatel_kontakt_telefon"],detaily:["druh_objednavky","druh_objednavky_kod","poznamka_objednavky"],dodaci_podminky:["dt_predpokladany_termin_dodani","misto_dodani","zaruka"],polozky:["polozky_objednavky"]},r=(0,t.A)({},Kn),i=(0,t.A)({},r);Object.entries(o).forEach(e=>{let[o,t]=e;("polozky"===o?a.detaily:a[o])&&t.forEach(e=>{void 0!==n.orderDetails[e]&&(i[e]=n.orderDetails[e])})}),a.detaily&&Array.isArray(n.polozky)&&n.polozky.length>0&&(i.polozky_objednavky=n.polozky),i.predmet=r.predmet,i.prikazce_id=r.prikazce_id,i.max_cena_s_dph=r.max_cena_s_dph,i.strediska_kod=r.strediska_kod,i.garant_uzivatel_id=r.garant_uzivatel_id,i.id=r.id,i.ev_cislo=r.ev_cislo,i.zpusob_financovani=r.zpusob_financovani,i.lp_kod=r.lp_kod,i.cislo_smlouvy=r.cislo_smlouvy,i.smlouva_poznamka=r.smlouva_poznamka,i.individualni_schvaleni=r.individualni_schvaleni,i.individualni_poznamka=r.individualni_poznamka,i.pojistna_udalost_cislo=r.pojistna_udalost_cislo,i.pojistna_udalost_poznamka=r.pojistna_udalost_poznamka,Wn(i),gp("apply-details",{name:e.name,source:"saved",ts:e.ts,preview:bp(n),appliedSections:Object.keys(o).filter(e=>"polozky"===e?a.detaily:a[e])}),Da.default.setAutosaveEnabled(!0),zc(!0,!1,i).catch(e=>{})},canFillTemplate:!Ds,onCopyTemplateToUser:async e=>{if(Se&&Ae&&e)try{var n;const a=e.data||{},o=e.name||e.dbName||"Kopie \u0161ablony",t="".concat(o," (kopie)"),r=a.poApproval?JSON.stringify(a.poApproval):"",i=a.orderDetails?JSON.stringify(a.orderDetails):"",s=(null===(n=e.type)||void 0===n?void 0:n.toString().toUpperCase())||"OBEJD",d=await(0,me.Xu)({username:(null===Ee||void 0===Ee?void 0:Ee.username)||we,token:Se,user_id:Ae||0,nazev_sablony:t,polozky_po:r,polozky_detail:i,typ:s,kategorie:"OBJEDNAVKA25"});if(d&&(d.success||"ok"===d.status)){const e=d.data||d||{},n={name:t,data:a,ts:Date.now(),type:"PO"===s?"po":"DETAIL"===s?"details":"mixed",id:e.id||e.insertId,user_id:Ae,__fromServer:!0};return fr(e=>{const a=(Array.isArray(e)?e:[]).filter(e=>(e.name||"").trim().toLowerCase()!==t.trim().toLowerCase()),o=[n,...a].slice(0,200);try{const e=Ae?"order_templates_".concat(Ae):"order_templates";localStorage.setItem(e,JSON.stringify(o))}catch(r){}return o}),gp("copy",{originalName:o,copyName:t,type:s.toLowerCase(),mode:"server"}),je&&je('\u0160ablona "'.concat(o,'" byla zkop\xedrov\xe1na jako "').concat(t,'"'),{type:"success"}),n}}catch(a){je&&je("Chyba p\u0159i kop\xedrov\xe1n\xed \u0161ablony: ".concat((null===a||void 0===a?void 0:a.message)||"Nezn\xe1m\xe1 chyba"),{type:"error"})}},onCopyTemplateToGlobal:async e=>{if(e&&Se&&Ae)try{const a=e.name||e.dbName||"Kopie u\u017eivatelsk\xe9 \u0161ablony",o="".concat(a," (GLO)"),t=e.data||{},r=t.poApproval&&Object.keys(t.poApproval).length>0,i=t.orderDetails&&Object.keys(t.orderDetails).length>0;let s="PO";r&&i?s="PO+detail":i&&(s="detail");const d=await(0,me.Xu)({username:(null===Ee||void 0===Ee?void 0:Ee.username)||we,token:Se,user_id:0,nazev_sablony:o,polozky_po:r?JSON.stringify(t.poApproval):"",polozky_detail:i?JSON.stringify(t.orderDetails):"",typ:s.toLowerCase(),kategorie:"OBJEDNAVKA25"});if("ok"!==(null===d||void 0===d?void 0:d.status)){var n;const e=(null===d||void 0===d?void 0:d.message)||(null===d||void 0===d||null===(n=d.data)||void 0===n?void 0:n.message)||"Nepoda\u0159ilo se zkop\xedrovat \u0161ablonu do glob\xe1ln\xedch";throw new Error(e)}await Zp(),gp("copyToGlobal",{originalName:a,globalName:o,type:s.toLowerCase(),mode:"global"}),je&&je('\u0160ablona "'.concat(a,'" byla zkop\xedrov\xe1na do glob\xe1ln\xedch jako "').concat(o,'"'),{type:"success"})}catch(a){je&&je("Chyba p\u0159i kop\xedrov\xe1n\xed do glob\xe1ln\xedch \u0161ablon: ".concat((null===a||void 0===a?void 0:a.message)||"Nezn\xe1m\xe1 chyba"),{type:"error"})}},onShowTemplatePreview:(e,n)=>{const a=((e,n)=>{try{const a={templateInfo:{name:e.name||"Bez n\xe1zvu",type:e.type||"mixed",created:e.ts?(0,Ma.iS)(new Date(e.ts)):"Nezn\xe1mo",isGlobal:0===e.user_id},poApproval:null,orderDetails:null,items:[]};if(null!==n&&void 0!==n&&n.poApproval){const e=n.poApproval;a.poApproval={predmet:e.predmet||"",maxCena:e.max_cena_s_dph||"",popisPozadavku:e.popis_pozadavku||"",strediska:Array.isArray(e.strediska_kod)?e.strediska_kod:[],objednatel:e.objednatel_id||"",garant:e.garant_uzivatel_id||"",prikazce:e.prikazce_id||""}}if(null!==n&&void 0!==n&&n.orderDetails){const e=n.orderDetails;a.orderDetails={dodavatelNazev:e.dodavatel_nazev||"",dodavatelAdresa:e.dodavatel_adresa||"",dodavatelIco:e.dodavatel_ico||"",dodavatelDic:e.dodavatel_dic||"",zpusobFinancovani:e.zpusob_financovani||"",lpKod:e.lp_kod||"",druhObjednavky:e.druh_objednavky_kod||"",poznamka:e.poznamka||"",datumDodani:e.datum_dodani||"",fakturovatNa:e.fakturovat_na||"",dodaciAdresa:e.dodaci_adresa||""}}return Array.isArray(null===n||void 0===n?void 0:n.polozky)&&(a.items=n.polozky.map((e,n)=>({index:n+1,popis:e.popis||"",pocet:e.pocet||1,jednotka:e.jednotka||"",cenaJednotka:e.cena_jednotka||0,cenaTotal:(e.pocet||1)*(e.cena_jednotka||0)}))),a}catch(a){return null}})(e,n);a&&si({template:e,data:n,preview:a})},onDeleteTemplate:e=>{Rr(e),Ir(!0)},onEditTemplateName:e=>{li(e.id||e.ts),pi(e.name||"")},editingTemplateId:di,editingTemplateName:ci,matchesTemplateQuery:(e,n)=>{var a,o,t,r,i;if(!n||!n.trim())return!0;const s=ed(n),d=ed(e.name||e.dbName||""),l=ed((null===(a=e.data)||void 0===a||null===(o=a.poApproval)||void 0===o?void 0:o.predmet)||""),c=ed((null===(t=e.data)||void 0===t||null===(r=t.polozky)||void 0===r||null===(i=r[0])||void 0===i?void 0:i.popis)||"");return d.includes(s)||l.includes(s)||c.includes(s)},isArchived:$n}),Ut&&(0,ke.jsxs)(jl,{style:{margin:"1rem"},children:["\u010c\xe1ste\u010dn\xe1 chyba p\u0159i na\u010d\xedt\xe1n\xed dat: ",Ut]}),(0,ke.jsxs)(od,{children:[(0,ke.jsx)(td,{ref:Dc,children:(0,ke.jsxs)(rd,{children:[(0,ke.jsxs)(dd,{children:[(0,ke.jsxs)(ld,{children:[(0,ke.jsx)(cd,{children:(0,ke.jsxs)(pd,{title:Fn&&Kn.ev_cislo?"Editace objedn\xe1vky ev.\u010d. ".concat(Kn.ev_cislo):"",children:["Objedn\xe1vka",Kn.id&&(0,ke.jsxs)("span",{className:"order-id-badge",children:[" #",Kn.id]})]})}),Us>0&&(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"4px 10px",marginLeft:"0.5rem",background:Zs?"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)":"linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)",border:"2px solid ".concat(Zs?"#fca5a5":"#bbf7d0"),borderRadius:"6px",fontSize:"0.75rem",fontWeight:600,color:Zs?"#991b1b":"#166534",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",whiteSpace:"nowrap"},children:[(0,ke.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1px",alignItems:"flex-start"},children:[(0,ke.jsx)("div",{style:{fontSize:"0.6rem",opacity:.8,fontWeight:500},children:"MAX CENA"}),(0,ke.jsxs)("div",{style:{fontSize:"0.85rem",fontWeight:700},children:[Us.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"]})]}),(0,ke.jsx)("div",{style:{fontSize:"14px",fontWeight:"bold",opacity:.5},children:"\u2192"}),(0,ke.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1px",alignItems:"flex-end"},children:[(0,ke.jsx)("div",{style:{fontSize:"0.6rem",opacity:.8,fontWeight:500},children:"SOU\u010cET POLO\u017dEK"}),(0,ke.jsxs)("div",{style:{fontSize:"0.85rem",fontWeight:700},children:[Ms.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"]})]})]})]}),(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[(0,ke.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"2px"},children:Hi?"EV. \u010c\xcdSLO":"P\u0158EDPOKL\xc1DAN\xc9 EV. \u010c\xcdSLO"}),($t||Gt||Yt)&&(0,ke.jsx)("div",{style:{fontSize:"10px",color:"#666",padding:"2px 6px",borderRadius:"4px",textAlign:"right",backgroundColor:Gt?"#fef2f2":"database"===Yt?"#eff6ff":"concept"===Yt?"#fefbf2":"#f0fdf4",border:"1px solid ".concat(Gt?"#fca5a5":"database"===Yt?"#bfdbfe":"concept"===Yt?"#fed7aa":"#bbf7d0"),transition:"all 0.2s ease"},children:Gt?(0,ke.jsx)("span",{style:{color:"#dc2626"},children:"\u23f3 Ukl\xe1d\xe1n\xed konceptu..."}):"database"===Yt?(0,ke.jsx)("span",{style:{color:"#2563eb"},children:"\ud83d\udcbe Na\u010dteno z DB"}):"concept"===Yt?(0,ke.jsx)("span",{style:{color:"#d97706"},children:"\ud83d\udcdd Formul\xe1\u0159 na\u010dten z Konceptu"}):$t?(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsxs)("span",{style:{color:"#16a34a"},children:["\u2713 ",Hi?"Ulo\u017eeno":"Koncept"]})," ",new Date($t).toLocaleTimeString("cs-CZ",{hour:"2-digit",minute:"2-digit",second:"2-digit"})]}):null})]}),(0,ke.jsx)(zd,{children:(0,ke.jsx)(Ad,{$isEmergency:Kn.mimoradna_udalost||!1,children:an?(0,ke.jsxs)("span",{style:{color:"#666",fontStyle:"italic",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsx)(xd,{}),"Na\u010d\xedt\xe1m..."]}):Hs(Kn.ev_cislo)?"object"===typeof Kn.ev_cislo?(null===(J=Kn.ev_cislo)||void 0===J?void 0:J.next_order_string)||(null===(G=Kn.ev_cislo)||void 0===G?void 0:G.order_number_string)||(null===(q=Kn.ev_cislo)||void 0===q?void 0:q.next_number)||"Na\u010d\xedt\xe1m...":Kn.ev_cislo||"Na\u010d\xedt\xe1m...":(0,ke.jsxs)("span",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#d97706"},children:[(0,ke.jsx)(p.g,{icon:u.zpE,style:{color:"#f59e0b"}}),(0,ke.jsx)("span",{style:{fontSize:"13px"},children:"Na\u010d\xedt\xe1n\xed selhalo"}),(0,ke.jsx)(jd,{onClick:e=>{e.preventDefault(),e.stopPropagation(),Xs()},title:"Zkusit na\u010d\xedst ev. \u010d\xedslo znovu",children:"\u21bb Zkusit znovu"})]})})})]})]}),(()=>{const e=Ci.find(e=>e.kod_stavu===Kn.zpusob_financovani||e.kod===Kn.zpusob_financovani),n=(null===e||void 0===e?void 0:e.nazev_stavu)||(null===e||void 0===e?void 0:e.nazev)||"";return(n.includes("Limitovan")||n.includes("p\u0159\xedslib"))&&Array.isArray(Kn.lp_kod)&&Kn.lp_kod.length>0?(0,ke.jsx)("div",{style:{marginTop:"0.75rem",marginBottom:"3px",padding:"0.5rem 0.75rem",background:"linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)",border:"1px solid #93c5fd",borderRadius:"6px",fontSize:"0.7rem",display:"flex",flexWrap:"wrap",gap:"0.5rem",alignItems:"center"},children:Kn.lp_kod.map(e=>{const n=Qt[e];if(!n)return null;let a,o,t;if(Gn<=2){const e=parseFloat(Kn.max_cena_s_dph)||0,r=Kn.lp_kod.length,i=r>0?e/r:0;a=parseFloat(n.zbyva_rezervace||0)-i,t=i,o="Rezervace"}else Gn>=3&&Gn<=6?(a=parseFloat(n.zbyva_predpoklad||0),o="P\u0159edpoklad"):(a=parseFloat(n.zbyva_skutecne||0),o="Skute\u010dn\xe9");const r=a<0,i=Ni.find(n=>(n.id||n.kod)===e),s=(null===i||void 0===i?void 0:i.cislo_lp)||e,d=(null===i||void 0===i?void 0:i.nazev_uctu)||(null===i||void 0===i?void 0:i.nazev)||"",l=null===n||void 0===n?void 0:n.spravce,c=l?"".concat(l.jmeno||""," ").concat(l.prijmeni||"").trim():"",p=[d?"".concat(s," - ").concat(d):s,c?"PO: ".concat(c):""].filter(Boolean).join("\n");return(0,ke.jsxs)("div",{style:{padding:"0.3rem 0.6rem",background:r?"#fee2e2":"white",border:"1px solid ".concat(r?"#fca5a5":"#bfdbfe"),borderRadius:"4px",display:"flex",alignItems:"center",gap:"0.4rem",fontSize:"0.7rem"},children:[(0,ke.jsx)("div",{style:{fontWeight:700,color:"#1e40af",fontSize:"0.7rem",cursor:"help"},title:p,children:s}),(0,ke.jsxs)("div",{style:{fontWeight:700,color:r?"#dc2626":"#059669",fontSize:"0.7rem"},children:[a<0&&"\u2212",Math.abs(a).toLocaleString("cs-CZ",{minimumFractionDigits:0,maximumFractionDigits:0})," K\u010d"]}),Gn<=2&&t>0&&(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsxs)("div",{style:{fontSize:"0.65rem",opacity:.7,color:"#64748b"},children:["\u2212",t.toLocaleString("cs-CZ",{minimumFractionDigits:0,maximumFractionDigits:0})," K\u010d"]}),(0,ke.jsx)("div",{style:{fontSize:"0.65rem",opacity:.7,color:"#64748b",cursor:"help"},title:"Rezervace - MAX CENA rozd\u011blen\xe1 pom\u011brn\u011b mezi vybran\xe1 LP",children:"(R)"})]}),Gn>=3&&(0,ke.jsxs)("div",{style:{fontSize:"0.65rem",opacity:.7,color:"#64748b",cursor:"help"},title:Gn>=3&&Gn<=6?"P\u0159edpokl\xe1dan\xe9 \u010derp\xe1n\xed podle p\u0159i\u0159azen\xfdch polo\u017eek":"Skute\u010dn\xe9 \u010derp\xe1n\xed podle faktur",children:["(",Gn>=3&&Gn<=6?"P":"S",")"]})]},e)})}):null})(),ia?(0,ke.jsxs)("div",{style:{padding:"1rem 1.5rem",marginTop:"1rem",backgroundColor:"#fee2e2",border:"2px solid #dc2626",borderRadius:"8px",display:"flex",alignItems:"flex-start",gap:"1rem",fontWeight:"600",color:"#991b1b"},children:[(0,ke.jsx)(b.A,{size:20,style:{marginTop:"0.25rem",flexShrink:0}}),(0,ke.jsxs)("div",{style:{flex:1},children:[(0,ke.jsx)("div",{style:{marginBottom:"0.5rem",fontSize:"1.1rem"},children:"\u274c Objedn\xe1vka zam\xedtnuta"}),Kn.schvaleni_komentar&&(0,ke.jsxs)("div",{style:{fontWeight:"normal",fontSize:"0.875rem",marginBottom:"0.5rem"},children:[(0,ke.jsx)("strong",{children:"D\u016fvod zam\xedtnut\xed:"})," ",Kn.schvaleni_komentar]}),Kn.schvalovatel_id&&(0,ke.jsxs)("div",{style:{fontWeight:"normal",fontSize:"0.875rem"},children:[(0,ke.jsx)("strong",{children:"Zam\xedtl:"})," ",Ws(Kn.schvalovatel_id),Kn.dt_schvaleni&&" \u2022 ".concat(new Date(Kn.dt_schvaleni).toLocaleDateString("cs-CZ")," ").concat(new Date(Kn.dt_schvaleni).toLocaleTimeString("cs-CZ",{hour:"2-digit",minute:"2-digit"}))]})]}),(0,ke.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",flexShrink:0},children:[(0,ke.jsxs)(bd,{className:"cancel-btn",onClick:Dp,title:"Zav\u0159\xedt formul\xe1\u0159 a vr\xe1tit se na seznam objedn\xe1vek",style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#dc2626",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",whiteSpace:"nowrap",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#b91c1c",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#dc2626",children:[(0,ke.jsx)(p.g,{icon:u.GRI}),"Zav\u0159\xedt"]}),ds&&(0,ke.jsxs)(bd,{onClick:e=>{e.stopPropagation(),Mr(!0)},title:"Odemknout zam\xedtnutou objedn\xe1vku (vr\xe1tit na F\xc1ZI 2 - ODESLANA_KE_SCHVALENI)",style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",whiteSpace:"nowrap",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#d97706",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#f59e0b",children:[(0,ke.jsx)(x,{size:16}),"Odemknout"]})]})]}):sa?(0,ke.jsxs)("div",{style:{padding:"1rem 1.5rem",marginTop:"1rem",backgroundColor:"#fff7ed",border:"2px solid #f97316",borderRadius:"8px",display:"flex",alignItems:"flex-start",gap:"1rem",fontWeight:"600",color:"#9a3412"},children:[(0,ke.jsx)(b.A,{size:20,style:{marginTop:"0.25rem",flexShrink:0}}),(0,ke.jsxs)("div",{style:{flex:1},children:[(0,ke.jsx)("div",{style:{marginBottom:"0.5rem",fontSize:"1.1rem"},children:"\ud83d\udeab Objedn\xe1vka stornov\xe1na"}),Kn.odeslani_storno_duvod&&(0,ke.jsxs)("div",{style:{fontWeight:"normal",fontSize:"0.875rem",marginBottom:"0.5rem"},children:[(0,ke.jsx)("strong",{children:"D\u016fvod stornov\xe1n\xed:"})," ",Kn.odeslani_storno_duvod]}),Kn.odesilatel_id&&(0,ke.jsxs)("div",{style:{fontWeight:"normal",fontSize:"0.875rem"},children:[(0,ke.jsx)("strong",{children:"Stornoval:"})," ",Ws(Kn.odesilatel_id),Kn.dt_odeslani&&" \u2022 ".concat(new Date(Kn.dt_odeslani).toLocaleDateString("cs-CZ")," ").concat(new Date(Kn.dt_odeslani).toLocaleTimeString("cs-CZ",{hour:"2-digit",minute:"2-digit"}))]})]}),(0,ke.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",flexShrink:0},children:[(0,ke.jsxs)(bd,{className:"cancel-btn",onClick:Dp,title:"Zav\u0159\xedt formul\xe1\u0159 a vr\xe1tit se na seznam objedn\xe1vek",style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",whiteSpace:"nowrap",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#ea580c",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#f97316",children:[(0,ke.jsx)(p.g,{icon:u.GRI}),"Zav\u0159\xedt"]}),ds&&(0,ke.jsxs)(bd,{className:"unlock-btn",onClick:()=>ei(!0),title:"Odemknout stornovanou objedn\xe1vku",style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",whiteSpace:"nowrap",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#ea580c",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#f97316",children:[(0,ke.jsx)(x,{size:16}),"Odemknout"]})]})]}):ra?(0,ke.jsxs)("div",{style:{padding:"1rem 1.5rem",marginTop:"1rem",backgroundColor:"#dcfce7",border:"2px solid #16a34a",borderRadius:"8px",display:"flex",alignItems:"flex-start",gap:"1rem",fontWeight:"600",color:"#166534"},children:[(0,ke.jsx)(b.A,{size:20,style:{marginTop:"0.25rem",flexShrink:0}}),(0,ke.jsxs)("div",{style:{flex:1},children:[(0,ke.jsx)("div",{style:{marginBottom:"0.5rem"},children:"\u2705 Objedn\xe1vka byla \xfasp\u011b\u0161n\u011b dokon\u010dena. V\u0161echny kroky byly spln\u011bny."}),Kn.dokoncil_id&&(0,ke.jsxs)("div",{style:{fontWeight:"normal",fontSize:"0.875rem"},children:[(0,ke.jsx)("strong",{children:"Dokon\u010dil:"})," ",Ws(Kn.dokoncil_id),Kn.dt_dokonceni&&" \u2022 ".concat(new Date(Kn.dt_dokonceni).toLocaleDateString("cs-CZ")," ").concat(new Date(Kn.dt_dokonceni).toLocaleTimeString("cs-CZ",{hour:"2-digit",minute:"2-digit"}))]})]}),(0,ke.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",flexShrink:0},children:[(0,ke.jsxs)(bd,{className:"cancel-btn",onClick:Dp,title:"Zav\u0159\xedt formul\xe1\u0159 a vr\xe1tit se na seznam objedn\xe1vek",style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",whiteSpace:"nowrap",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#15803d",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#16a34a",children:[(0,ke.jsx)(p.g,{icon:u.GRI}),"Zav\u0159\xedt"]}),ds&&(0,ke.jsxs)(bd,{onClick:e=>{e.stopPropagation(),Xr(!0)},title:"Odemknout dokon\u010denou objedn\xe1vku (vr\xe1tit na F\xc1ZI 8 - ZKONTROLOVANA)",style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",whiteSpace:"nowrap",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#d97706",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#f59e0b",children:[(0,ke.jsx)(x,{size:16}),"Odemknout"]})]})]}):(0,ke.jsxs)(ud,{children:[(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"2rem",flex:1},children:[(0,ke.jsxs)(vd,{children:[(0,ke.jsx)(_d,{children:(()=>{if(Kn.stav_stornovano||oa(Kn.stav_workflow_kod,"ZRUSENA"))return"Stornovan\xe1 objedn\xe1vka";return{1:va?"F\xe1ze 1/8: Koncept":"F\xe1ze 1/8: Nov\xe1 objedn\xe1vka",2:"F\xe1ze 2/8: Ke schv\xe1len\xed",3:"F\xe1ze 3/8: Schv\xe1len\xe1 objedn\xe1vka",4:"F\xe1ze 4/8: Dodavatel + Registr",5:"F\xe1ze 5/8: Vypln\u011bn\xed registru",6:"F\xe1ze 6/8: Fakturace",7:"F\xe1ze 7/8: V\u011bcn\xe1 spr\xe1vnost",8:"F\xe1ze 8/8: Zkontrolov\xe1no"}[Gn]||(va?"F\xe1ze 1/8: Koncept":"F\xe1ze 1/8: Nov\xe1 objedn\xe1vka")})()}),(0,ke.jsx)(md,{children:ua.phases.map((e,n)=>(0,ke.jsx)(kd,{children:(0,ke.jsx)(fd,{className:e.fillClass,style:{opacity:e.isVisible?1:.15,transform:e.isVisible?"scaleX(1)":"scaleX(0.1)",transformOrigin:"left"}})},e.id))})]}),(()=>{const e=Ci.find(e=>e.kod===Kn.zpusob_financovani);return((null===e||void 0===e?void 0:e.nazev)||"").includes("Smlouva")})()&&Kn.cislo_smlouvy&&ir&&!ir.notFound&&!dr&&(()=>{const e=parseFloat(ir.hodnota_s_dph||ir.celkova_castka||0),n=parseFloat(ir.cerpano_celkem||ir.cerpano||0);let a=0;const o=Kn.id&&Kn.id>0,t=Gn>=7;if(!o||!t){const e=Gn>=3&&Gn<=6;Gn<=2?a=parseFloat(Kn.max_cena_s_dph||0):e?(Kn.polozky_objednavky&&Array.isArray(Kn.polozky_objednavky)&&Kn.polozky_objednavky.length>0&&(a=Kn.polozky_objednavky.reduce((e,n)=>e+(parseFloat((n.cena_s_dph||n.celkova_cena||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0)*parseFloat(n.mnozstvi||1),0)),0===a&&(a=parseFloat(Kn.max_cena_s_dph||0))):t&&Kn.faktury&&Array.isArray(Kn.faktury)&&(a=Kn.faktury.reduce((e,n)=>e+parseFloat(n.celkova_castka||n.castka||0),0))}const r=e-n-a,i=r<0;return(0,ke.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"4px 10px",background:i?"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)":"linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)",border:"2px solid ".concat(i?"#fca5a5":"#86efac"),borderRadius:"6px",fontSize:"0.75rem",fontWeight:600,color:i?"#991b1b":"#15803d",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",whiteSpace:"nowrap"},children:(0,ke.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1px",alignItems:"flex-end"},children:[(0,ke.jsxs)("div",{style:{fontSize:"0.6rem",opacity:.8,fontWeight:500},children:["SMLOUVA ",Kn.cislo_smlouvy]}),(0,ke.jsxs)("div",{style:{fontSize:"0.85rem",fontWeight:700},children:[Math.abs(r).toLocaleString("cs-CZ",{minimumFractionDigits:0,maximumFractionDigits:0})," K\u010d"]})]})})})()]}),(0,ke.jsx)(hd,{}),(0,ke.jsxs)(yd,{children:[(0,ke.jsxs)(bd,{className:"save-btn",onClick:async()=>{Bs("info","SAVE","order-save-start","Za\u010d\xedn\xe1m ukl\xe1d\xe1n\xed objedn\xe1vky..."),await(async()=>{if(!Se||!we)return void(je&&je(hi("Pro ulo\u017een\xed objedn\xe1vky mus\xedte b\xfdt p\u0159ihl\xe1\u0161eni","error"),{type:"error"}));if(!Hs(Kn.ev_cislo))return void(je&&je("Eviden\u010dn\xed \u010d\xedslo se st\xe1le na\u010d\xedt\xe1. Po\u010dkejte pros\xedm na dokon\u010den\xed.",{type:"warning"}));if(window.__workflowStateUpdated=!1,Kt(!0),pa){try{const e={};Ae&&(e.uzivatel_id="string"===typeof Ae?parseInt(Ae,10):Ae),Kn.objednatel_id&&(e.objednatel_id="string"===typeof Kn.objednatel_id?parseInt(Kn.objednatel_id,10):Kn.objednatel_id),Kn.predmet&&(e.predmet=Kn.predmet),Kn.garant_uzivatel_id&&(e.garant_uzivatel_id=Kn.garant_uzivatel_id),Kn.prikazce_id&&(e.prikazce_id=Kn.prikazce_id),Kn.max_cena_s_dph&&(e.max_cena_s_dph=Kn.max_cena_s_dph),Kn.druh_objednavky_kod&&(e.druh_objednavky_kod=Kn.druh_objednavky_kod),Kn.poznamka&&(e.poznamka=Kn.poznamka),Kn.strediska_kod&&Kn.strediska_kod.length>0&&(e.strediska_kod=Ra(Kn.strediska_kod)),Kn.zpusob_financovani&&(e.financovani=Va(Kn,Ci)),Kn.stav_objednavky&&(e.stav_objednavky=Kn.stav_objednavky),Kn.stav_workflow_kod&&(e.stav_workflow_kod=Kn.stav_workflow_kod),Kn.faze_objednavky&&(e.faze_objednavky=Kn.faze_objednavky),Kn.schvalil_uzivatel_id&&(e.schvalil_uzivatel_id=Kn.schvalil_uzivatel_id),Kn.dt_schvaleni&&(e.dt_schvaleni=Kn.dt_schvaleni),Kn.poznamka_schvaleni&&(e.poznamka_schvaleni=Kn.poznamka_schvaleni),Kn.potvrdil_vecnou_spravnost_id&&(e.potvrdil_vecnou_spravnost_id=Kn.potvrdil_vecnou_spravnost_id),Kn.dt_potvrzeni_vecne_spravnosti&&(e.dt_potvrzeni_vecne_spravnosti=Kn.dt_potvrzeni_vecne_spravnosti),Kn.poznamka_vecna_spravnost&&(e.poznamka_vecna_spravnost=Kn.poznamka_vecna_spravnost),Kn.polozky_objednavky&&Kn.polozky_objednavky.length>0&&(e.polozky=Kn.polozky_objednavky.map(e=>({popis:e.popis||"",cena_bez_dph:parseFloat((e.cena_bez_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0,sazba_dph:parseInt(e.sazba_dph)||21,cena_s_dph:parseFloat((e.cena_s_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0,usek_kod:e.usek_kod||null,budova_kod:e.budova_kod||null,mistnost_kod:e.mistnost_kod||null,poznamka:e.poznamka||null,lp_id:e.lp_id?parseInt(e.lp_id):null})));const n=(()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),t=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0"),i=String(e.getSeconds()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(o," ").concat(t,":").concat(r,":").concat(i)})();if(e.dt_objednavky=n,await(0,Ia.qA)(Kn.id,e,Se,we),je&&je("\u2705 Archivovan\xe1 objedn\xe1vka aktualizov\xe1na",{type:"success"}),Kn.id||Kn.id){const e=await(0,Ia.Hj)(parseInt(Kn.id||Kn.id),Se,we,!0);null!==e&&void 0!==e&&e.id&&(Wn(n=>{const a=(0,t.A)((0,t.A)({},n),e);return Hn.current=JSON.parse(JSON.stringify(a)),a}),zc(e,{isOrderSavedToDB:!0,savedOrderId:e.id,isChanged:!1}))}}catch(A){je&&je("Chyba: ".concat(A.message),{type:"error"})}finally{Kt(!1),Bt(!1)}return}if(!Fp())return void Kt(!1);const e=(Kn.polozky_objednavky||[]).reduce((e,n)=>e+(parseFloat(n.cena_s_dph)||0),0)-(parseFloat(Kn.max_cena_s_dph)||0);if(e>0)return je&&je("Nelze ulo\u017eit objedn\xe1vku - p\u0159ekro\u010den limit o ".concat(e.toLocaleString("cs-CZ")," K\u010d! Upravte polo\u017eky nebo zvy\u0161te maxim\xe1ln\xed cenu."),{type:"error"}),Je.detaily&&Ge(e=>(0,t.A)((0,t.A)({},e),{},{detaily:!1})),void Kt(!1);try{var n,a,o,r,i;Bt(!0);const e=()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),t=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0"),i=String(e.getSeconds()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(o," ").concat(t,":").concat(r,":").concat(i)},N=()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(o)},D=null===ze||void 0===ze||null===(n=ze.roles)||void 0===n?void 0:n.some(e=>"SUPERADMIN"===e.kod_role),T=null===ze||void 0===ze||null===(a=ze.roles)||void 0===a?void 0:a.some(e=>"ADMINISTRATOR"===e.kod_role),I=D||T;let P=(0,t.A)({},Kn);if(Bs("info","VECNA-SPRAVNOST","check-conditions","Kontrola: checkbox=".concat(Kn.potvrzeni_vecne_spravnosti,", existing_id=").concat(Kn.potvrdil_vecnou_spravnost_id,", user_id=").concat(Ae)),1!==Kn.potvrzeni_vecne_spravnosti&&!0!==Kn.potvrzeni_vecne_spravnosti||Kn.potvrdil_vecnou_spravnost_id||!Ae)Bs("warning","VECNA-SPRAVNOST","auto-set-skip","\u274c P\u0159esko\u010deno nastaven\xed ID - podm\xednka nespln\u011bna");else{const n=e();P.potvrdil_vecnou_spravnost_id=Ae,P.dt_potvrzeni_vecne_spravnosti=n,Bs("info","VECNA-SPRAVNOST","auto-set-id","\u2705 Automaticky nastaveno p\u0159ed ulo\u017een\xedm: user_id=".concat(Ae,", timestamp=").concat(n))}const R={};if(Ae){const e="string"===typeof Ae?parseInt(Ae,10):Ae;R.uzivatel_id=e,Bs("info","SAVE","uzivatel-id","Nastaveno uzivatel_id: ".concat(e," (p\u016fvodn\xed typ: ").concat(typeof Ae,")"))}else Bs("error","SAVE","uzivatel-id-missing","user_id chyb\xed v AuthContext");if(Kn.predmet&&(R.predmet=Kn.predmet),Kn.garant_uzivatel_id&&(R.garant_uzivatel_id=Kn.garant_uzivatel_id),Kn.prikazce_id&&(R.prikazce_id=Kn.prikazce_id),!Hi&&Ae){const e="string"===typeof Ae?parseInt(Ae,10):Ae;R.objednatel_id=e,Bs("info","SAVE","objednatel-id","Nastaveno objednatel_id: ".concat(e," (nov\xe1 objedn\xe1vka)"))}else if(Hi&&Kn.objednatel_id){const e="string"===typeof Kn.objednatel_id?parseInt(Kn.objednatel_id,10):Kn.objednatel_id;R.objednatel_id=e,Bs("info","SAVE","objednatel-id-preserved","Zachov\xe1n objednatel_id: ".concat(e," (UPDATE objedn\xe1vky)"))}if(Kn.strediska_kod&&Kn.strediska_kod.length>0&&(R.strediska_kod=Ra(Kn.strediska_kod),Bs("info","SAVE","strediska-normalized","St\u0159ediska: ".concat(JSON.stringify(Kn.strediska_kod)," -> ").concat(JSON.stringify(R.strediska_kod)))),Kn.max_cena_s_dph&&(R.max_cena_s_dph=Kn.max_cena_s_dph),R.mimoradna_udalost=Boolean(Kn.mimoradna_udalost),Bs("info","SAVE","mimoradna-udalost","Mimo\u0159\xe1dn\xe1 ud\xe1lost: ".concat(Kn.mimoradna_udalost," -> ").concat(R.mimoradna_udalost)),Kn.zpusob_financovani?(R.financovani=Va(Kn,Ci),Bs("info","SAVE","financovani-normalized","Financov\xe1n\xed: ".concat(JSON.stringify(R.financovani)))):(R.financovani=null,Bs("warning","SAVE","financovani-empty","Financov\xe1n\xed nen\xed vypln\u011bno - pos\xedl\xe1m null")),Kn.druh_objednavky_kod){const e=Oi.find(e=>e.kod_stavu&&e.kod_stavu===Kn.druh_objednavky_kod||e.kod&&e.kod===Kn.druh_objednavky_kod||e.value&&e.value===Kn.druh_objednavky_kod),n={kod_stavu:(null===e||void 0===e?void 0:e.kod_stavu)||(null===e||void 0===e?void 0:e.kod)||(null===e||void 0===e?void 0:e.value)||Kn.druh_objednavky_kod,nazev_stavu:(null===e||void 0===e?void 0:e.nazev_stavu)||(null===e||void 0===e?void 0:e.nazev)||(null===e||void 0===e?void 0:e.label)||Kn.druh_objednavky_kod};R.druh_objednavky_kod=JSON.stringify(n),Bs("info","SAVE","druh-transform","Transformace druhu objedn\xe1vky: ".concat(Kn.druh_objednavky_kod," -> ").concat(R.druh_objednavky_kod))}else R.druh_objednavky_kod=null,Bs("info","SAVE","druh-empty","Druh objedn\xe1vky nen\xed vypln\u011bn (f\xe1ze 1-2) - pos\xedl\xe1m NULL");Hi&&Kn.id?Kn.polozky_objednavky&&Kn.polozky_objednavky.length>0?(R.polozky=Kn.polozky_objednavky.map(e=>({popis:e.popis||"",cena_bez_dph:parseFloat((e.cena_bez_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0,sazba_dph:parseInt(e.sazba_dph)||21,cena_s_dph:parseFloat((e.cena_s_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0,usek_kod:e.usek_kod||null,budova_kod:e.budova_kod||null,mistnost_kod:e.mistnost_kod||null,poznamka:e.poznamka||null,lp_id:e.lp_id?parseInt(e.lp_id):null})),Bs("info","SAVE","polozky-transform","Transformace polo\u017eek objedn\xe1vky (UPDATE f\xe1ze ".concat(Gn,"): ").concat(Kn.polozky_objednavky.length," polo\u017eek -> p\u0159\xedmo do root jako 'polozky' pole"))):(R.polozky=[],Bs("warning","SAVE","polozky-empty","Polo\u017eky jsou pr\xe1zdn\xe9 (UPDATE f\xe1ze ".concat(Gn,") - pos\xedl\xe1m pr\xe1zdn\xe9 pole"))):Gn>=3&&Kn.polozky_objednavky&&Kn.polozky_objednavky.length>0?(R.polozky=Kn.polozky_objednavky.map(e=>({popis:e.popis||"",cena_bez_dph:parseFloat((e.cena_bez_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0,sazba_dph:parseInt(e.sazba_dph)||21,cena_s_dph:parseFloat((e.cena_s_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0,usek_kod:e.usek_kod||null,budova_kod:e.budova_kod||null,mistnost_kod:e.mistnost_kod||null,poznamka:e.poznamka||null,lp_id:e.lp_id?parseInt(e.lp_id):null})),Bs("info","SAVE","polozky-transform-insert","Transformace polo\u017eek objedn\xe1vky (INSERT f\xe1ze ".concat(Gn,"): ").concat(Kn.polozky_objednavky.length," polo\u017eek"))):Bs("info","SAVE","polozky-skip","Polo\u017eky se nepos\xedlaj\xed - INSERT v F\xc1ZI ".concat(Gn)),Kn.poznamka_objednavky&&(R.poznamka=Kn.poznamka_objednavky,Bs("info","SAVE","poznamka-add","P\u0159id\xe1na pozn\xe1mka objedn\xe1vky: ".concat(Kn.poznamka_objednavky.length," znak\u016f"))),R.vecna_spravnost_umisteni_majetku=Kn.vecna_spravnost_umisteni_majetku||"",R.vecna_spravnost_poznamka=Kn.vecna_spravnost_poznamka||"";const L=P.potvrzeni_vecne_spravnosti;R.potvrzeni_vecne_spravnosti=1===L||!0===L?1:0,R.potvrdil_vecnou_spravnost_id=P.potvrdil_vecnou_spravnost_id||null,R.dt_potvrzeni_vecne_spravnosti=P.dt_potvrzeni_vecne_spravnosti||null,Bs("info","VECNA-SPRAVNOST","save-data","Ukl\xe1d\xe1m v\u011bcnou spr\xe1vnost: checkbox=".concat(R.potvrzeni_vecne_spravnosti,', umisteni="').concat(R.vecna_spravnost_umisteni_majetku,'", poznamka="').concat(R.vecna_spravnost_poznamka,'", user_id=').concat(R.potvrdil_vecnou_spravnost_id,", dt=").concat(R.dt_potvrzeni_vecne_spravnosti)),Kn.dt_predpokladany_termin_dodani&&(R.dt_predpokladany_termin_dodani=Kn.dt_predpokladany_termin_dodani),Kn.misto_dodani&&(R.misto_dodani=Kn.misto_dodani),Kn.zaruka&&(R.zaruka=Kn.zaruka),Kn.dodavatel_id&&(R.dodavatel_id=Kn.dodavatel_id),Kn.dodavatel_nazev&&(R.dodavatel_nazev=Kn.dodavatel_nazev),Kn.dodavatel_adresa&&(R.dodavatel_adresa=Kn.dodavatel_adresa),Kn.dodavatel_ico&&(R.dodavatel_ico=Kn.dodavatel_ico),Kn.dodavatel_dic&&(R.dodavatel_dic=Kn.dodavatel_dic),Kn.dodavatel_zastoupeny&&(R.dodavatel_zastoupeny=Kn.dodavatel_zastoupeny),Kn.dodavatel_kontakt_jmeno&&(R.dodavatel_kontakt_jmeno=Kn.dodavatel_kontakt_jmeno),Kn.dodavatel_kontakt_email&&(R.dodavatel_kontakt_email=Kn.dodavatel_kontakt_email),Kn.dodavatel_kontakt_telefon&&(R.dodavatel_kontakt_telefon=Kn.dodavatel_kontakt_telefon),Kn.objednatel_jmeno&&(R.objednatel_jmeno=Kn.objednatel_jmeno),Kn.objednatel_email&&(R.objednatel_email=Kn.objednatel_email),Kn.objednatel_telefon&&(R.objednatel_telefon=Kn.objednatel_telefon),Kn.popis_pozadavku&&(R.popis_pozadavku=Kn.popis_pozadavku),Kn.poznamky&&(R.poznamky=Kn.poznamky),Kn.prilohy&&Kn.prilohy.length>0&&(R.prilohy=Kn.prilohy),Kn.dt_schvaleni&&(R.dt_schvaleni=Kn.dt_schvaleni),"schvaleno"===Kn.stav_schvaleni?R.schvaleni_komentar="":Kn.schvaleni_komentar&&(R.schvaleni_komentar=Kn.schvaleni_komentar);let V=aa(Kn.stav_workflow_kod),F=[...V];const M=Kn.id||Kn.id;M?(F.includes("NOVA")||0===F.length||1===F.length&&"NOVA"===F[0])&&(F=F.filter(e=>"NOVA"!==e),F.includes("ODESLANA_KE_SCHVALENI")||(F.push("ODESLANA_KE_SCHVALENI"),Bs("info","SAVE","workflow-migration","UPDATE: Migrov\xe1n star\xfd stav NOVA \u2192 ODESLANA_KE_SCHVALENI"))):(F=[],"schvaleno"===Kn.stav_schvaleni?(F=["SCHVALENA"],Bs("info","SAVE","workflow-new","INSERT: Okam\u017eit\xe9 schv\xe1len\xed - SCHVALENA")):(F=["ODESLANA_KE_SCHVALENI"],Bs("info","SAVE","workflow-new","INSERT: Odesl\xe1n\xed ke schv\xe1len\xed - ODESLANA_KE_SCHVALENI")));const U=Kn.stav_schvaleni;"schvaleno"===U?(F=F.filter(e=>!["ODESLANA_KE_SCHVALENI","CEKA_SE","ZAMITNUTA"].includes(e)),F.includes("SCHVALENA")||(F.push("SCHVALENA"),Bs("info","SAVE","workflow-update","P\u0159id\xe1n stav SCHVALENA"))):"neschvaleno"===U?(F=F.filter(e=>!["ODESLANA_KE_SCHVALENI","CEKA_SE","SCHVALENA"].includes(e)),F.includes("ZAMITNUTA")||(F.push("ZAMITNUTA"),Bs("info","SAVE","workflow-update","P\u0159id\xe1n stav ZAMITNUTA"))):"ceka_se"===U&&(F=F.filter(e=>!["ODESLANA_KE_SCHVALENI","ZAMITNUTA","SCHVALENA"].includes(e)),F.includes("CEKA_SE")||(F.push("CEKA_SE"),Bs("info","SAVE","workflow-update","P\u0159id\xe1n stav CEKA_SE")));const Z=(null===V||void 0===V?void 0:V.includes("SCHVALENA"))||!1,K="schvaleno"===U&&!Z;!F.includes("SCHVALENA")||Kn.stav_odeslano||Kn.stav_stornovano||F.includes("ROZPRACOVANA")||K||(F.push("ROZPRACOVANA"),Bs("info","SAVE","workflow-update","\u2705 P\u0159id\xe1n stav ROZPRACOVANA - objedn\xe1vka ve F\xc1ZI 3, je\u0161t\u011b neodeslan\xe1")),Kn.stav_odeslano&&!Kn.stav_stornovano?(F=["SCHVALENA","ODESLANA"],Bs("info","SAVE","workflow-clean",'\u2705 Workflow nastaven na \u010distou F\xc1ZI 4: ["SCHVALENA", "ODESLANA"]')):!Kn.stav_odeslano&&F.includes("ODESLANA")&&(F=["SCHVALENA"],Bs("info","SAVE","workflow-clean",'\u2705 Workflow vr\xe1cen na F\xc1ZI 3: ["SCHVALENA"]')),Kn.stav_stornovano?(F.includes("ZRUSENA")||(F.push("ZRUSENA"),Bs("info","SAVE","workflow-update","P\u0159id\xe1n stav ZRUSENA")),F=F.filter(e=>!["ROZPRACOVANA","ODESLANA","POTVRZENA"].includes(e))):F=F.filter(e=>"ZRUSENA"!==e);const B="ANO"===(null===(o=Kn.dodavatel_zpusob_potvrzeni)||void 0===o?void 0:o.potvrzeni)||"potvrzeno"===Kn.stav_u_dodavatele;B&&!Kn.stav_stornovano?F.includes("POTVRZENA")||(F.push("POTVRZENA"),Bs("info","SAVE","workflow-update","\u2705 P\u0159id\xe1n stav POTVRZENA - dodavatel potvrdil ANO")):B||(F=F.filter(e=>!["POTVRZENA","UVEREJNIT","NEUVEREJNIT","UVEREJNENA","FAKTURACE","VECNA_SPRAVNOST","ZKONTROLOVANA","DOKONCENA"].includes(e)),Bs("info","SAVE","workflow-clean","\u2705 Dodavatel potvrdil NE - workflow vr\xe1cen na F\xc1ZI 4, vymaz\xe1ny vy\u0161\u0161\xed f\xe1ze")),F.includes("POTVRZENA")&&!Kn.stav_stornovano&&(!0===Kn.ma_byt_zverejnena||1===Kn.ma_byt_zverejnena?(F.includes("UVEREJNIT")||(F=F.filter(e=>"NEUVEREJNIT"!==e&&"UVEREJNENA"!==e),F.push("UVEREJNIT"),Bs("info","SAVE","workflow-update","P\u0159id\xe1n stav UVEREJNIT (ma_byt_zverejnena = true)")),F.includes("UVEREJNIT")&&Kn.dt_zverejneni&&Kn.registr_iddt&&(F=F.filter(e=>"UVEREJNIT"!==e),F.includes("UVEREJNENA")||(F.push("UVEREJNENA"),Bs("info","SAVE","workflow-update","Vypln\u011bn registr smluv (datum + IDDT) \u2192 odstran\u011bn UVEREJNIT \u2192 p\u0159id\xe1n UVEREJNENA \u2192 F\xc1ZE 6")))):(F=F.filter(e=>"UVEREJNIT"!==e&&"UVEREJNENA"!==e),F.includes("NEUVEREJNIT")||(F.push("NEUVEREJNIT"),Bs("info","SAVE","workflow-update","P\u0159id\xe1n stav NEUVEREJNIT (ma_byt_zverejnena = ".concat(Kn.ma_byt_zverejnena,") \u2192 p\u0159ej\xedt na FAKTURACE"))))),F.includes("POTVRZENA")&&!Kn.stav_stornovano||(F=F.filter(e=>!["UVEREJNIT","NEUVEREJNIT","UVEREJNENA"].includes(e)),Bs("info","SAVE","workflow-update","Odebr\xe1ny zve\u0159ej\u0148ovac\xed stavy (nen\xed POTVRZENA nebo je stornov\xe1no)"));const W="pokladna"===(null===(r=Kn.financovani)||void 0===r?void 0:r.platba),H="pokladna"===(null===(i=Kn.dodavatel_zpusob_potvrzeni)||void 0===i?void 0:i.platba),$=W||H;if($&&(F.includes("ODESLANA")||F.includes("POTVRZENA")||F.includes("UVEREJNENA")||F.includes("NEUVEREJNIT"))&&!Kn.stav_stornovano&&(F.includes("VECNA_SPRAVNOST")||(F.push("VECNA_SPRAVNOST"),Bs("info","SAVE","workflow-update","\ud83c\udfea Re\u017eim POKLADNA \u2192 p\u0159id\xe1n stav VECNA_SPRAVNOST (p\u0159esko\u010deny f\xe1ze 4-6) \u2192 F\xc1ZE 7/8"))),!$&&Kn.faktury&&Kn.faktury.length>0&&!Kn.stav_stornovano)F.includes("FAKTURACE")||(F.push("FAKTURACE"),Bs("info","SAVE","workflow-update","P\u0159id\xe1n stav FAKTURACE \u2192 F\xc1ZE 6/8")),F.includes("FAKTURACE")&&!F.includes("VECNA_SPRAVNOST")&&(F.push("VECNA_SPRAVNOST"),Bs("info","SAVE","workflow-update","P\u0159id\xe1n stav VECNA_SPRAVNOST - faktury ulo\u017eeny \u2192 F\xc1ZE 7/8 (V\u011bcn\xe1 kontrola)"));else if(!Kn.faktury||0===Kn.faktury.length||$){const e=F.includes("FAKTURACE");F=F.filter(e=>"FAKTURACE"!==e&&"VECNA_SPRAVNOST"!==e),e&&$&&Bs("info","SAVE","workflow-update","Odebr\xe1n stav FAKTURACE a VECNA_SPRAVNOST (re\u017eim POKLADNA)")}if((Kn.faktury||[]).length>0&&(Kn.faktury||[]).every(e=>1===e.vecna_spravnost_potvrzeno||!0===e.vecna_spravnost_potvrzeno)&&!Kn.stav_stornovano)F.includes("ZKONTROLOVANA")||(F.push("ZKONTROLOVANA"),Bs("info","SAVE","workflow-update","\u2705 V\u0160ECHNY faktury (".concat(Kn.faktury.length,"x) maj\xed potvrzenou v\u011bcnou spr\xe1vnost \u2192 p\u0159id\xe1n stav ZKONTROLOVANA \u2192 F\xc1ZE 8/8")));else{const e=F.includes("ZKONTROLOVANA");if(F=F.filter(e=>"ZKONTROLOVANA"!==e),e){const e=(Kn.faktury||[]).filter(e=>!(1===e.vecna_spravnost_potvrzeno||!0===e.vecna_spravnost_potvrzeno)).length;Bs("info","SAVE","workflow-update","\ud83d\udd13 NEJSOU potvrzeny v\u0161echny faktury (".concat(e,"x chyb\xed) \u2192 odebr\xe1n stav ZKONTROLOVANA \u2192 n\xe1vrat na F\xc1ZI 7/8"))}}const J=1===Kn.potvrzeni_dokonceni_objednavky||!0===Kn.potvrzeni_dokonceni_objednavky,G=F.includes("ZKONTROLOVANA");J&&G&&!Kn.stav_stornovano?(F.includes("DOKONCENA")||(F.push("DOKONCENA"),Bs("info","SAVE","workflow-update","P\u0159id\xe1n stav DOKONCENA - objedn\xe1vka fin\xe1ln\u011b dokon\u010dena")),Kn.dokoncil_id||(R.dokoncil_id=Ae,R.dt_dokonceni=e(),Bs("info","SAVE","dokonceni","Nastaveno dokon\u010den\xed objedn\xe1vky u\u017eivatelem ".concat(Ae)))):F=F.filter(e=>"DOKONCENA"!==e),F=[...new Set(F)],F=F.filter(e=>"K_DOKONCENI"!==e),0===F.length&&(F=["NOVA"],Bs("warning","SAVE","workflow-fallback","Pr\xe1zdn\xe9 workflow - fallback na [NOVA]"));const q=["NOVA","ODESLANA_KE_SCHVALENI","CEKA_SE","ZAMITNUTA","SCHVALENA","ROZPRACOVANA","ODESLANA","ZRUSENA","POTVRZENA","UVEREJNIT","NEUVEREJNIT","UVEREJNENA","FAKTURACE","VECNA_SPRAVNOST","ZKONTROLOVANA","DOKONCENA"];if(F.sort((e,n)=>{const a=q.indexOf(e),o=q.indexOf(n);return(-1===a?999:a)-(-1===o?999:o)}),R.stav_workflow_kod=JSON.stringify(F),F.length>0){const e=F[F.length-1],n=Ii[e];if(n)R.stav_objednavky=n.nazev,Bs("info","SAVE","stav-objednavky",'\u2705 Nastaveno stav_objednavky: "'.concat(R.stav_objednavky,'" (z DB \u010d\xedseln\xedku pro workflow: ').concat(e,")"));else{const n=Ha[e];R.stav_objednavky=n?n.name:e,Bs("warning","SAVE","stav-objednavky-fallback",'\u26a0\ufe0f \u010c\xedseln\xedk neobsahuje "'.concat(e,'" - pou\u017eit fallback: "').concat(R.stav_objednavky,'"'))}}else R.stav_objednavky="Nov\xe1",Bs("warning","SAVE","stav-objednavky-fallback",'Pr\xe1zdn\xe9 workflow stavy - stav_objednavky: "Nov\xe1"');void 0!==Kn.dodavatel_potvrdil_id&&(R.dodavatel_potvrdil_id=Kn.dodavatel_potvrdil_id),Kn.dt_zverejneni&&Kn.registr_iddt?Kn.zverejnil_id?R.zverejnil_id=Kn.zverejnil_id:(R.zverejnil_id=Ae,Bs("info","SAVE","registr-tracking","Automaticky nastaven zverejnil_id: ".concat(Ae))):void 0!==Kn.zverejnil_id&&(R.zverejnil_id=Kn.zverejnil_id),Kn.dt_zverejneni_potvrzeni&&(R.dt_zverejneni_potvrzeni=Kn.dt_zverejneni_potvrzeni),R.potvrdil_vecnou_spravnost_id=void 0!==Kn.potvrdil_vecnou_spravnost_id?Kn.potvrdil_vecnou_spravnost_id:null,R.dt_potvrzeni_vecne_spravnosti=Kn.dt_potvrzeni_vecne_spravnosti||null,Kn.faktury&&Kn.faktury.length>0&&F.includes("FAKTURACE")?(R.fakturant_id=Ae,R.dt_faktura_pridana=e(),Bs("info","SAVE","fakturace-tracking","Aktualizov\xe1n fakturant_id: ".concat(Ae,", dt_faktura_pridana: ").concat(R.dt_faktura_pridana))):(void 0!==Kn.fakturant_id&&(R.fakturant_id=Kn.fakturant_id),Kn.dt_faktura_pridana&&(R.dt_faktura_pridana=Kn.dt_faktura_pridana)),R.dokoncil_id=void 0!==Kn.dokoncil_id?Kn.dokoncil_id:null,R.dt_dokonceni=Kn.dt_dokonceni||null,R.dokonceni_poznamka=void 0!==Kn.dokonceni_poznamka?Kn.dokonceni_poznamka:"";const Y=Kn.potvrzeni_dokonceni_objednavky;if(R.potvrzeni_dokonceni_objednavky=1===Y||!0===Y?1:0,Bs("info","SAVE","tracking-fields","Workflow tracking pole: dodavatel_potvrdil=".concat(R.dodavatel_potvrdil_id,", zverejnil=").concat(R.zverejnil_id,", vecna_spravnost=").concat(R.potvrdil_vecnou_spravnost_id,", fakturant=").concat(R.fakturant_id,", dokoncil=").concat(R.dokoncil_id)),Kn.stav_stornovano&&(Kn.storno_uzivatel_id&&(R.storno_uzivatel_id=Kn.storno_uzivatel_id),Kn.storno_provedl&&(R.storno_provedl=Kn.storno_provedl)),Kn.stav_odeslano||Kn.stav_stornovano){if(ws)Kn.odesilatel_id&&(R.odesilatel_id=Kn.odesilatel_id),Kn.dt_odeslani&&(R.dt_odeslani=Kn.dt_odeslani),Kn.odeslani_storno_duvod&&(R.odeslani_storno_duvod=Kn.odeslani_storno_duvod),Bs("info","SAVE","odeslani-locked","F\xc1ZE 3 ZAM\u010cEN\xc1 - workflow data zachov\xe1na beze zm\u011bny");else if(!Kn.odesilatel_id&&Ae?(R.odesilatel_id=Ae,Bs("info","SAVE","odesilatel-tracking-new","Ulo\u017een NOV\xdd odesilatel_id: ".concat(Ae," (prvn\xed odesl\xe1n\xed/storno)"))):Kn.odesilatel_id&&(R.odesilatel_id=Kn.odesilatel_id,Bs("info","SAVE","odesilatel-tracking-preserve","ZACHOV\xc1N p\u016fvodn\xed odesilatel_id: ".concat(Kn.odesilatel_id))),Kn.stav_odeslano&&!Kn.stav_stornovano){if(Kn.dt_odeslani)R.dt_odeslani=Kn.dt_odeslani,Bs("info","SAVE","odeslani-datum-preserve","ZACHOV\xc1NO p\u016fvodn\xed dt_odeslani: ".concat(Kn.dt_odeslani));else{const e=Kn.datum_odeslani||N();R.dt_odeslani=e,Bs("info","SAVE","odeslani-datum-new","Nastaveno NOV\xc9 dt_odeslani: ".concat(e))}R.odeslani_storno_duvod=""}else if(Kn.stav_stornovano){if(Kn.dt_odeslani)R.dt_odeslani=Kn.dt_odeslani,Bs("info","SAVE","storno-datum-preserve","ZACHOV\xc1NO p\u016fvodn\xed dt_odeslani pro STORNO: ".concat(Kn.dt_odeslani));else{const e=Kn.datum_storna||N();R.dt_odeslani=e,Bs("info","SAVE","storno-datum-new","Nastaveno NOV\xc9 dt_odeslani pro STORNO: ".concat(e))}Kn.odeslani_storno_duvod&&(R.odeslani_storno_duvod=Kn.odeslani_storno_duvod),Bs("info","SAVE","storno-datum","Ulo\u017eeno STORNO s d\u016fvodem: ".concat(Kn.odeslani_storno_duvod))}}else R.odesilatel_id=null,Bs("info","SAVE","odesilatel-reset","Vymaz\xe1n odesilatel_id - objedn\xe1vka nen\xed odesl\xe1na ani stornov\xe1na");if(V.includes("POTVRZENA")||F.includes("POTVRZENA"))if(Ss)Kn.dodavatel_zpusob_potvrzeni_original?R.dodavatel_zpusob_potvrzeni=Kn.dodavatel_zpusob_potvrzeni_original:Kn.dodavatel_zpusob_potvrzeni&&(R.dodavatel_zpusob_potvrzeni=JSON.stringify(Kn.dodavatel_zpusob_potvrzeni)),Bs("info","SAVE","dodavatel-potvrzeni-locked","Sekce zam\u010den\xe1 - Hodnota zachov\xe1na");else{const e=Kn.dodavatel_zpusob_potvrzeni||{},n={potvrzeni:e.potvrzeni||"NE",zpusoby:Array.isArray(e.zpusoby)?e.zpusoby:[],platba:e.platba||""};R.dodavatel_zpusob_potvrzeni=JSON.stringify(n),Bs("info","SAVE","dodavatel-potvrzeni-unlocked","Sekce odem\u010den\xe1 - Ulo\u017eeno: ".concat(R.dodavatel_zpusob_potvrzeni))}else Bs("info","SAVE","dodavatel-potvrzeni-skip","F\xc1ZE 3- - P\u0159esko\u010deno");if(Kn.dt_akceptace){const e=String(Kn.dt_akceptace);e.includes("T")?R.dt_akceptace=e.split(".")[0].replace("T"," ").replace("Z",""):R.dt_akceptace=e}if(Kn.dt_zverejneni){const e=String(Kn.dt_zverejneni);e.includes("T")?R.dt_zverejneni=e.split(".")[0].replace("T"," ").replace("Z",""):R.dt_zverejneni=e}Kn.registr_iddt&&(R.registr_iddt=Kn.registr_iddt);const X=e();let Q,ee,ne,ae;if(R.dt_objednavky=X,Hi?Bs("info","SAVE","datum-zmeny","UPDATE objedn\xe1vky - dt_objednavky aktualizov\xe1no na: ".concat(X)):Bs("info","SAVE","datum-vytvoreni","Nov\xe1 objedn\xe1vka - dt_objednavky: ".concat(X)),F.includes("NOVA")||Kn.schvalovatel_id&&Kn.schvalovatel_id>0&&(R.schvalovatel_id=Kn.schvalovatel_id),Kn.faktury&&Kn.faktury.length>0?(R.faktury=Kn.faktury.map((e,n)=>{var a;let o=[];return e.fa_strediska_kod&&Array.isArray(e.fa_strediska_kod)&&e.fa_strediska_kod.length>0&&(o=e.fa_strediska_kod.map(e=>"object"===typeof e&&e.kod_stavu?e.kod_stavu:e)),{id:e.id&&!String(e.id).startsWith("temp-")?Number(e.id):null,fa_castka:String(parseFloat(e.fa_castka)||0),fa_cislo_vema:e.fa_cislo_vema||"",fa_dorucena:1,fa_datum_vystaveni:e.fa_datum_vystaveni||(new Date).toISOString().split("T")[0],fa_datum_splatnosti:e.fa_splatnost||e.fa_datum_splatnosti||"",fa_datum_doruceni:"string"===typeof e.fa_datum_doruceni&&e.fa_datum_doruceni.match(/^\d{4}-\d{2}-\d{2}$/)?e.fa_datum_doruceni:(new Date).toISOString().split("T")[0],fa_strediska_kod:o,fa_poznamka:e.fa_poznamka||"",vecna_spravnost_umisteni_majetku:e.vecna_spravnost_umisteni_majetku||"",vecna_spravnost_poznamka:e.vecna_spravnost_poznamka||"",vecna_spravnost_potvrzeno:1===e.vecna_spravnost_potvrzeno||!0===e.vecna_spravnost_potvrzeno?1:0,potvrdil_vecnou_spravnost_id:e.potvrdil_vecnou_spravnost_id||null,dt_potvrzeni_vecne_spravnosti:e.dt_potvrzeni_vecne_spravnosti||null,rozsirujici_data:e._isPokladna?{typ_platby:"pokladna",pokladni_doklad:{datum_vytvoreni:e.dt_vytvoreni||(new Date).toISOString(),poznamka:e.fa_poznamka||"",prilohy_count:(null===(a=e.attachments)||void 0===a?void 0:a.length)||0,vytvoril_uzivatel_id:e.vytvoril_uzivatel_id,vytvoril_jmeno:e.vytvoril_jmeno}}:e._fromISDOC&&e._isdoc_polozky?{typ_platby:"faktura",isdoc:{cislo_faktury:e.fa_cislo_vema,datum_vystaveni:e.fa_datum_vystaveni,datum_splatnosti:e.fa_datum_splatnosti,castka_s_dph:e.fa_castka,castka_bez_dph:e.fa_castka_bez_dph,dph_celkem:e.fa_dph,polozky:e._isdoc_polozky,dodavatel:e._isdoc_dodavatel}}:{typ_platby:"faktura"}}}),Bs("info","SAVE","faktury-transform","P\u0159id\xe1no ".concat(Kn.faktury.length," faktur do payload")),Bs("info","SAVE","faktury-detail","Detaily faktur: ".concat(JSON.stringify(Kn.faktury,null,2)))):(R.faktury=[],Bs("info","SAVE","faktury-empty","\u017d\xe1dn\xe9 faktury k ulo\u017een\xed")),M){var s,d,l;const e=Kn.stav_workflow_kod;Bs("info","SAVE-V2","update-start","Volam updateOrderV2(".concat(Kn.id,")")),R.faktury&&R.faktury.length,Q=await(0,Ia.qA)(Kn.id,R,Se,we),Bs("info","SAVE-V2","update-success","Order ".concat(Kn.id," updated")),Bs("info","DB-RESPONSE","UPDATE-complete",{orderId:Q.id,orderNumber:Q.cislo_objednavky||Q.ev_cislo,workflow:Q.stav_workflow_kod,fieldsCount:Object.keys(Q).length,polozky:(null===(s=Q.polozky)||void 0===s?void 0:s.length)||0,faktury:(null===(d=Q.faktury)||void 0===d?void 0:d.length)||0});try{const n=Kn.ev_cislo||Kn.cislo_objednavky||Kn.id;await Qd(Kn.id,0,Q.stav_workflow_kod,e,Kn);const a=oa(Q.stav_workflow_kod,"ODESLANA_KE_SCHVALENI"),o=!!e&&oa(e,"ODESLANA_KE_SCHVALENI");if(a&&!o)try{const e=(Kn.strediska_kod||[]).map(e=>{const n=Ei.find(n=>n.value===e);return n?n.label:e});await Wa.sendOrderApprovalNotifications({token:Se,username:we,orderData:{id:Kn.id,ev_cislo:n,predmet:Kn.predmet||"",prikazce_id:Kn.prikazce_id,garant_id:Kn.garant_uzivatel_id,vytvoril:Kn.objednatel_id,objednatel_id:Kn.objednatel_id,dodavatel_nazev:Kn.dodavatel_nazev||"Neuvedeno",financovani_json:JSON.stringify(R.financovani||{}),strediska_nazvy:e,max_price_with_dph:Kn.max_cena_s_dph||0,is_urgent:Kn.mimoradna_udalost||!1}}),Bs("success","NOTIFICATION","dual-email-sent","Dual-template EMAILY odesl\xe1ny pro objedn\xe1vku ".concat(n))}catch(w){Bs("warning","NOTIFICATION","dual-email-error","Chyba p\u0159i dual-template emailech: ".concat(w.message))}}catch(S){}const n=Q,a=Q.stav_workflow_kod,o=(oa(a,"ODESLANA"),oa(a,"ZRUSENA"),$c(Q));o.strediska_kod&&Array.isArray(o.strediska_kod)&&(o.strediska_kod=Hc(o.strediska_kod,Ei));const r=(0,t.A)({},o);Bs("success","UPDATE","data-transformed","Data transformov\xe1na: strediska=".concat((null===(l=r.strediska_kod)||void 0===l?void 0:l.join(", "))||"none",", financovani=").concat(r.zpusob_financovani||"none"));const i=(()=>{try{const e=Array.isArray(a)?a:JSON.parse(a||'["NOVA"]'),n=e[e.length-1],o=Ha[n];return(null===o||void 0===o?void 0:o.name)||n||"Nov\xe1"}catch(e){return"Nov\xe1"}})();if(r.stav_objednavky=i,r.dodavatel_zpusob_potvrzeni&&"object"===typeof r.dodavatel_zpusob_potvrzeni){const e=r.dodavatel_zpusob_potvrzeni;if(r.dodavatel_zpusob_potvrzeni_original=JSON.stringify(e),void 0!==e.potvrzeni)r.dodavatel_zpusob_potvrzeni={potvrzeni:e.potvrzeni||"NE",zpusoby:Array.isArray(e.zpusoby)?e.zpusoby:[],platba:e.platba||""},Bs("info","UPDATE","normalize-potvrzeni-ok","Normalizov\xe1n dodavatel_zpusob_potvrzeni (u\u017e spr\xe1vn\xfd form\xe1t): ".concat(JSON.stringify(r.dodavatel_zpusob_potvrzeni)));else if(void 0!==e.potvrzeno)r.dodavatel_zpusob_potvrzeni={potvrzeni:e.potvrzeno?"ANO":"NE",zpusoby:e.zpusob||e.zpusob_potvrzeni||[],platba:e.platba||e.zpusob_platby||""},Bs("info","UPDATE","transform-potvrzeni-old","Transformov\xe1n dodavatel_zpusob_potvrzeni (star\xfd BE form\xe1t): ".concat(JSON.stringify(r.dodavatel_zpusob_potvrzeni)));else if(void 0!==e.zpusob||void 0!==e.zpusoby){const n=!(!r.dt_akceptace||!r.dodavatel_potvrdil_id);r.dodavatel_zpusob_potvrzeni={potvrzeni:n?"ANO":"NE",zpusoby:e.zpusoby||e.zpusob||e.zpusob_potvrzeni||[],platba:e.platba||e.zpusob_platby||""},Bs("info","UPDATE","transform-potvrzeni-fallback","Transformov\xe1n dodavatel_zpusob_potvrzeni (fallback z dt_akceptace): ".concat(JSON.stringify(r.dodavatel_zpusob_potvrzeni)))}}const u=r.faktury?await Promise.all(r.faktury.map(async e=>{var n;const a=null===(n=e.rozsirujici_data)||void 0===n?void 0:n.isdoc;let o=[];try{Array.isArray(e.fa_strediska_kod)?o=e.fa_strediska_kod:"string"===typeof e.fa_strediska_kod&&(o=JSON.parse(e.fa_strediska_kod||"[]")),o=o.map(e=>"string"===typeof e?e:e.kod_stavu||e.value||e.id||e)}catch(s){o=[]}let r=[];if(e.id&&!String(e.id).startsWith("temp-"))try{var i;const n=await(0,Ia.CX)(e.id,we,Se,Kn.id);r=(null===(i=n.data)||void 0===i?void 0:i.attachments)||n.data||[]}catch(d){}return(0,t.A)((0,t.A)({},e),{},{fa_dorucena:e.fa_datum_doruceni?1:0,fa_splatnost:e.fa_splatnost||(e.fa_datum_splatnosti?e.fa_datum_splatnosti.split(" ")[0]:""),fa_strediska_kod:o,attachments:r,fa_datum_doruceni:e.fa_datum_doruceni,fa_datum_splatnosti:e.fa_datum_splatnosti,fa_datum_vystaveni:e.fa_datum_vystaveni},a?{_isdoc_polozky:a.polozky,_isdoc_dodavatel:a.dodavatel,_fromISDOC:!0}:{})})):[];Wn(e=>(0,t.A)((0,t.A)((0,t.A)({},e),r),{},{stav_workflow_kod:a,objednatel_id:e.objednatel_id||r.objednatel_id,jmeno:e.jmeno||r.jmeno,email:e.email||r.email,telefon:e.telefon||r.telefon,faktury:u.length>0?u:e.faktury})),Bs("success","UPDATE","formdata-updated","FormData aktualizov\xe1n: workflow=".concat(a,", strediska=").concat(r.strediska_kod.join(", ")));try{var c;const e=await(0,Ia.Hj)(Kn.id,Se,we,!0);if(null!==e&&void 0!==e&&null!==(c=e.financovani)&&void 0!==c&&c.lp_nazvy&&Array.isArray(e.financovani.lp_nazvy)){const n=e.financovani.lp_nazvy.map(e=>({id:e.id,kod:e.cislo_lp||e.kod||"LP".concat(e.id),nazev:e.nazev||"Bez n\xe1zvu",kategorie:e.kategorie,limit:e.limit||e.celkovy_limit,cerpano:e.cerpano||e.skutecne_cerpano,zbyva:e.zbyva||e.zbyva_skutecne,rok:e.rok,label:"".concat(e.cislo_lp||e.kod||"LP".concat(e.id)," - ").concat(e.nazev||"Bez n\xe1zvu")})).sort((e,n)=>e.nazev.localeCompare(n.nazev,"cs"));mi(n),Bs("success","UPDATE","lp-options-reloaded","LP options na\u010dteny z GET po UPDATE: ".concat(n.length))}else Bs("warning","UPDATE","lp-options-missing","Enriched data neobsahuj\xed financovani.lp_nazvy")}catch(E){Bs("error","UPDATE","lp-options-reload-failed","Chyba p\u0159i reload LP options: ".concat(E.message))}if(Kn.cislo_smlouvy&&Gn>=7)try{await(0,Ua.SJ)({token:Se,username:we,cislo_smlouvy:Kn.cislo_smlouvy}),Bs("success","SMLOUVA","prepocet-ok","P\u0159epo\u010det \u010derp\xe1n\xed smlouvy ".concat(Kn.cislo_smlouvy," \xfasp\u011b\u0161n\xfd"))}catch(A){Bs("warning","SMLOUVA","prepocet-error","Chyba p\u0159i p\u0159epo\u010dtu smlouvy: ".concat(A.message))}window.__workflowStateUpdated=!0,da(),Jn.resetAllUnlocks();const v=(z=a,r.id||Kn.id?oa(z,"DOKONCENA")||oa(z,"ZKONTROLOVANA")?10:oa(z,"VECNA_SPRAVNOST")?9:oa(z,"FAKTURACE")?8:oa(z,"UVEREJNENA")?7:oa(z,"NEUVEREJNIT")?8:oa(z,"UVEREJNIT")?6:oa(z,"POTVRZENA")?5:oa(z,"ODESLANA")?4:oa(z,"SCHVALENA")||oa(z,"ROZPRACOVANA")?3:oa(z,"ODESLANA_KE_SCHVALENI")||oa(z,"CEKA_SE")?2:1:1);Bs("info","UPDATE","phase-refreshed","\u2728 F\xe1ze EXPLICITN\u011a p\u0159epo\u010d\xedt\xe1na: ".concat(v,"/10, workflow: ").concat(a));try{var p;Da.default.setCurrentUser(Ae);const e=(0,t.A)((0,t.A)((0,t.A)({},n),r),{},{polozky_objednavky:n.polozky_objednavky||[],faktury:u.length>0?u:n.faktury||[],objednatel_id:n.objednatel_id||r.objednatel_id,jmeno:n.jmeno||r.jmeno,email:n.email||r.email,telefon:n.telefon||r.telefon,zpusob_financovani:r.zpusob_financovani||Kn.zpusob_financovani||n.zpusob_financovani,lp_kod:r.lp_kod||Kn.lp_kod||n.lp_kod,cislo_smlouvy:r.cislo_smlouvy||Kn.cislo_smlouvy||n.cislo_smlouvy,smlouva_poznamka:r.smlouva_poznamka||Kn.smlouva_poznamka||n.smlouva_poznamka,individualni_schvaleni:r.individualni_schvaleni||Kn.individualni_schvaleni||n.individualni_schvaleni,individualni_poznamka:r.individualni_poznamka||Kn.individualni_poznamka||n.individualni_poznamka,pojistna_udalost_cislo:r.pojistna_udalost_cislo||Kn.pojistna_udalost_cislo||n.pojistna_udalost_cislo,pojistna_udalost_poznamka:r.pojistna_udalost_poznamka||Kn.pojistna_udalost_poznamka||n.pojistna_udalost_poznamka});await Da.default.saveDraft(e,{step:Qn(),attachments:pn,metadata:{version:"1.4",isConceptSaved:!0,isOrderSavedToDB:!0,savedOrderId:Kn.id,isChanged:!1,dictionaries:{approvers:Mi||[],users:wi||[],strediska:Ei||[],financovani:Ci||[],druhyObjednavky:Oi||[],lpKody:Ni||[]}}}),Bs("success","UPDATE","draft-updated","Draft aktualizov\xe1n s PARSOVAN\xddMI DB daty (workflow: ".concat(a,", strediska: ").concat(r.strediska_kod.join(", "),", polo\u017eky: ").concat((null===(p=e.polozky_objednavky)||void 0===p?void 0:p.length)||0,", financov\xe1n\xed: ").concat(e.zpusob_financovani||"none",")")),Hn.current=JSON.parse(JSON.stringify(e)),ya({isEditMode:!0,orderId:Kn.id,orderNumber:Kn.ev_cislo||Kn.cislo_objednavky}),Bs("success","UPDATE","broadcast","Broadcast stavu odesl\xe1n (isEditMode: true, orderId: ".concat(Kn.id,")"))}catch(A){Bs("error","UPDATE","draft-update-error","Chyba p\u0159i aktualizaci draftu: ".concat(A.message))}if(Bs("success","UPDATE","workflow-update","Workflow stav aktualizov\xe1n: ".concat(a)),Bs("success","UPDATE","workflow-state","DB stav: ".concat(a," - f\xe1ze se p\u0159epo\u010d\xedt\xe1 automaticky")),I){const e=Kn.ev_cislo||Kn.cislo_objednavky||Kn.id;je&&je("Objedn\xe1vka ".concat(e," byla \xfasp\u011b\u0161n\u011b aktualizov\xe1na"),{type:"success"})}else if(Q.message)je&&je(Q.message,{type:"success"});else{const e=Kn.ev_cislo||Kn.cislo_objednavky||Kn.id;je&&je("Objedn\xe1vka ".concat(e," byla \xfasp\u011b\u0161n\u011b aktualizov\xe1na"),{type:"success"})}const _=oa(a,"SCHVALENA");if(Bs("info","UPDATE","phase-check","M\xe1 SCHVALENA: ".concat(_,", nov\xe1 f\xe1ze by m\u011bla b\xfdt: ").concat(_?"2":"1")),oa(a,"SCHVALENA")?(Wi(!1),Bs("info","UPDATE","lock-sections","F\xc1ZE 1 sekce zam\u010deny - objedn\xe1vka je schv\xe1len\xe1")):Bs("info","UPDATE","keep-unlocked-phase1","F\xc1ZE 1 sekce z\u016fst\xe1vaj\xed odem\u010den\xe9 - stav: ".concat(a)),oa(a,"ODESLANA"),oa(a,"ZRUSENA"),Bs("success","UPDATE","direct-lock-check","P\u0159\xedm\xe9 zamyk\xe1n\xed F\xc1ZE 2. Nov\xfd stav: ".concat(a)),oa(a,"ODESLANA")||oa(a,"ZRUSENA")){let e=!1;try{const n=Da.default.getUIState();if(n){const a=Kn.id;a&&n.phase2OrderId===a&&!0===n.phase2Unlocked&&(e=!0)}}catch(C){Bs("warning","UPDATE","unlock-check-error","Chyba p\u0159i kontrole Phase 2 unlock stavu: ".concat(C.message))}e?Bs("info","UPDATE","phase2-keep-unlocked","F\xc1ZE 2 z\u016fst\xe1v\xe1 ODEM\u010cENA - byla ru\u010dn\u011b odem\u010dena"):En(!1)}fo(!1);const m=Q.id||Kn.id||Kn.id;Bs("info","AUTOSAVE","skip-duplicate","Autosave p\u0159esko\u010den - ji\u017e proveden p\u0159es DraftManager.syncWithDatabase()"),_a(!1);const k=!I,f=Kn.ev_cislo||Kn.cislo_objednavky||Kn.id;if(k){Ht(!0),xa.current=!0,Mn(!1),Ki(!1),Ae&&(Da.default.setCurrentUser(Ae),await Da.default.deleteAllDraftKeys()&&Bs("success","UPDATE","draftmanager-delete","V\u0161echny kl\xed\u010de smaz\xe1ny p\u0159es DraftManager"));try{Na.A.invalidate(Ae),Bs("success","UPDATE","cache-invalidation","Cache invalidov\xe1na p\u0159ed navigac\xed")}catch(C){Bs("error","UPDATE","cache-invalidation-error","Chyba p\u0159i invalidaci cache: ".concat(C.message))}gd(f,m)}else Ht(!1),xa.current=!1,Da.default.setAutosaveEnabled(!0,"SUPERADMIN/ADMIN stays on form after UPDATE"),Bs("info","UPDATE","stay-on-form","SUPERADMIN/ADMIN z\u016fst\xe1v\xe1 na formul\xe1\u0159i - koncept NEN\xcd smaz\xe1n"),Bs("info","UPDATE","stay-in-place","Z\u016fsta\u0148 na stejn\xe9 pozici po ulo\u017een\xed")}else{var u,v,_,m,k,f,h,y,b;if(Bs("info","SAVE-V2","create-start","Vol\xe1m createOrderV2()"),1===Gn){const e=["uzivatel_id","objednatel_id","predmet","garant_uzivatel_id","prikazce_id","strediska_kod","max_cena_s_dph","financovani","druh_objednavky_kod","stav_workflow_kod","stav_objednavky","dt_objednavky","mimoradna_udalost"];Object.keys(R).forEach(n=>{e.includes(n)||delete R[n]})}if(Q=await(0,Ia.VR)(R,Se,we),Bs("info","SAVE-V2","create-success","Order created: ID ".concat(Q.id)),null!==(u=Q.lock_info)&&void 0!==u&&u.locked&&(null===(v=Q.lock_info)||void 0===v||!v.locked_by_user_id))try{await(0,Ia.$_)({token:Se,username:we,orderId:Q.id}),Bs("info","SAVE-V2","auto-unlock","Automaticky odem\u010dena objedn\xe1vka ".concat(Q.id," (byla zam\u010den\xe1 bez vlastn\xedka)"))}catch(O){Bs("warning","SAVE-V2","auto-unlock-error","Chyba p\u0159i odemyk\xe1n\xed: ".concat(O.message))}ae=Q,ee=Q.id,ne=Q.ev_cislo||Q.cislo_objednavky||Kn.ev_cislo,ne||Bs("error","SAVE-V2","missing-ev-cislo","Backend nevr\xe1til evide\u010dn\xed \u010d\xedslo objedn\xe1vky");const e=Q.faktury||[];let n=[];if(e&&Array.isArray(e)&&e.length>0){const a=Kn.faktury||[];n=await Promise.all(e.map(async e=>{var n;let o=[];const i=a.find(n=>String(n.id)===String(e.id)||n.fa_cislo_vema===e.fa_cislo_vema);if(i&&i.attachments&&i.attachments.length>0)o=i.attachments;else if(e.id&&!String(e.id).startsWith("temp-"))try{var s;const n=await(0,Ia.CX)(e.id,we,Se,r.id);o=(null===(s=n.data)||void 0===s?void 0:s.attachments)||n.data||[]}catch(c){}const d=null===(n=e.rozsirujici_data)||void 0===n?void 0:n.isdoc;let l=[];try{Array.isArray(e.fa_strediska_kod)?l=e.fa_strediska_kod:"string"===typeof e.fa_strediska_kod&&(l=JSON.parse(e.fa_strediska_kod||"[]")),l=l.map(e=>{if("object"===typeof e&&e.kod_stavu){if(Ei.find(n=>n.kod_stavu===e.kod_stavu||n.kod===e.kod_stavu||n.value===e.kod_stavu))return e;const n=Ei.find(e=>"100"===e.kod_stavu||"100"===e.kod||"100"===e.value);return n?{kod_stavu:n.kod_stavu||n.kod||n.value,nazev_stavu:n.nazev_stavu||n.nazev||n.label}:{kod_stavu:"100",nazev_stavu:"100 Spr\xe1va Kladno"}}const n=Ei.find(n=>n.kod_stavu===e||n.kod===e||n.value===e);if(n)return{kod_stavu:n.kod_stavu||n.kod||n.value,nazev_stavu:n.nazev_stavu||n.nazev||n.label};const a=Ei.find(e=>"100"===e.kod_stavu||"100"===e.kod||"100"===e.value);return a?{kod_stavu:a.kod_stavu||a.kod||a.value,nazev_stavu:a.nazev_stavu||a.nazev||a.label}:{kod_stavu:"100",nazev_stavu:"100 Spr\xe1va Kladno"}})}catch(C){l=[]}return(0,t.A)((0,t.A)({},e),{},{fa_dorucena:e.fa_datum_doruceni?1:0,fa_splatnost:e.fa_splatnost||(e.fa_datum_splatnosti?e.fa_datum_splatnosti.split(" ")[0]:""),fa_strediska_kod:l,attachments:o,fa_datum_doruceni:e.fa_datum_doruceni,fa_datum_splatnosti:e.fa_datum_splatnosti,fa_datum_vystaveni:e.fa_datum_vystaveni},d?{_isdoc_polozky:d.polozky,_isdoc_dodavatel:d.dodavatel,_fromISDOC:!0}:{})})),Wn(e=>(0,t.A)((0,t.A)({},e),{},{faktury:n})),Bs("success","SAVE","faktury-updated","Faktury aktualizov\xe1ny s re\xe1ln\xfdmi ID z DB (".concat(e.length,") v\u010detn\u011b p\u0159\xedloh"))}try{var g;let e=(null===(g=Q)||void 0===g?void 0:g.stav_workflow_kod)||R.stav_workflow_kod;if("string"===typeof e&&e.startsWith("["))try{e=JSON.parse(e)}catch(C){}if(await Qd(ee,0,e,null,Kn),oa(e,"ODESLANA_KE_SCHVALENI"))try{const e=(Kn.strediska_kod||[]).map(e=>{const n=Ei.find(n=>n.value===e);return n?n.label:e});await Wa.sendOrderApprovalNotifications({token:Se,username:we,orderData:{id:ee,ev_cislo:ne,predmet:Kn.predmet||"",prikazce_id:Kn.prikazce_id,garant_id:Kn.garant_uzivatel_id,vytvoril:Kn.objednatel_id,objednatel_id:Kn.objednatel_id,dodavatel_nazev:Kn.dodavatel_nazev||"Neuvedeno",financovani_json:JSON.stringify(R.financovani||{}),strediska_nazvy:e,max_price_with_dph:Kn.max_cena_s_dph||0,is_urgent:Kn.mimoradna_udalost||!1}}),Bs("success","NOTIFICATION","dual-email-sent-new","Dual-template EMAILY odesl\xe1ny pro novou objedn\xe1vku ".concat(ne))}catch(w){Bs("warning","NOTIFICATION","dual-email-error-new","Chyba p\u0159i dual-template emailech: ".concat(w.message))}}catch(S){Bs("warning","SAVE","notification-error","Chyba p\u0159i odes\xedl\xe1n\xed notifikace: ".concat(S.message))}const a=!I;ae=Q,ee=Q.id,ne=Q.ev_cislo||Q.cislo_objednavky;const o=$c(Q);o.strediska_kod&&Array.isArray(o.strediska_kod)&&(o.strediska_kod=Hc(o.strediska_kod,Ei));const r=(0,t.A)((0,t.A)({},o),{},{id:ee,ev_cislo:ne});if(Bs("success","INSERT","data-transformed","Data transformov\xe1na: strediska=".concat((null===(_=r.strediska_kod)||void 0===_?void 0:_.join(", "))||"none",", financovani=").concat(r.zpusob_financovani||"none")),Wn(e=>(0,t.A)((0,t.A)((0,t.A)({},e),r),{},{faktury:n&&n.length>0?n:r.faktury||e.faktury})),Bs("success","INSERT","formdata-updated","FormData aktualizov\xe1n: id=".concat(ee,", strediska=").concat((null===(m=r.strediska_kod)||void 0===m?void 0:m.join(", "))||"none",", faktury s p\u0159\xedlohami: ").concat((null===(k=n)||void 0===k?void 0:k.length)||0)),null!==(f=Q.financovani)&&void 0!==f&&f.lp_nazvy&&Array.isArray(Q.financovani.lp_nazvy)){const e=Q.financovani.lp_nazvy.map(e=>({id:e.id,kod:e.cislo_lp||e.kod||"LP".concat(e.id),nazev:e.nazev||"Bez n\xe1zvu",kategorie:e.kategorie,limit:e.limit||e.celkovy_limit,cerpano:e.cerpano||e.skutecne_cerpano,zbyva:e.zbyva||e.zbyva_skutecne,rok:e.rok,label:"".concat(e.cislo_lp||e.kod||"LP".concat(e.id)," - ").concat(e.nazev||"Bez n\xe1zvu")})).sort((e,n)=>e.nazev.localeCompare(n.nazev,"cs"));mi(e),Bs("success","INSERT","lp-options-loaded","LP options na\u010dteny z financovani.lp_nazvy: ".concat(e.length))}if(da(),Jn.resetAllUnlocks(),a){Ht(!0),xa.current=!0,Mn(!1),Ki(!1),Ae&&(Da.default.setCurrentUser(Ae),await Da.default.deleteAllDraftKeys()&&Bs("success","INSERT","draftmanager-delete","V\u0161echny kl\xed\u010de smaz\xe1ny p\u0159es DraftManager"));try{Na.A.invalidate(Ae),Bs("success","INSERT","cache-invalidation","Cache invalidov\xe1na p\u0159ed navigac\xed")}catch(C){Bs("error","INSERT","cache-invalidation-error","Chyba p\u0159i invalidaci cache: ".concat(C.message))}gd(ne,ee)}else{Ht(!1),xa.current=!1,Da.default.setAutosaveEnabled(!0,"SUPERADMIN/ADMIN stays on form after INSERT");try{Da.default.setCurrentUser(Ae),await Da.default.saveDraft(ae,{step:Qn(),attachments:pn,metadata:{version:"1.4",isConceptSaved:!0,isOrderSavedToDB:!0,savedOrderId:ee,isChanged:!1,dictionaries:{approvers:Mi||[],users:wi||[],strediska:Ei||[],financovani:Ci||[],druhyObjednavky:Oi||[],lpKody:Ni||[]}}}),Bs("success","INSERT","admin-draft-saved","Draft ulo\u017een pro ADMIN po INSERT")}catch(A){Bs("error","INSERT","admin-draft-error","Chyba p\u0159i ukl\xe1d\xe1n\xed draftu pro ADMIN: ".concat(A.message))}if(Bs("info","SAVE","stay-on-form","SUPERADMIN/ADMIN z\u016fst\xe1v\xe1 na formul\xe1\u0159i - koncept NEN\xcd smaz\xe1n, formul\xe1\u0159 v edit re\u017eimu"),je){const e="Objedn\xe1vka ".concat(ne,Hi?" byla \xfasp\u011b\u0161n\u011b aktualizov\xe1na":" byla \xfasp\u011b\u0161n\u011b vytvo\u0159ena");je(e,{type:"success"})}Bs("info","INSERT","stay-in-place","Z\u016fsta\u0148 na stejn\xe9 pozici po ulo\u017een\xed")}if(_a(!1),Kn.cislo_smlouvy&&Gn>=7)try{await(0,Ua.SJ)({token:Se,username:we,cislo_smlouvy:Kn.cislo_smlouvy}),Bs("success","SMLOUVA","prepocet-ok","P\u0159epo\u010det \u010derp\xe1n\xed smlouvy ".concat(Kn.cislo_smlouvy," \xfasp\u011b\u0161n\xfd"))}catch(A){Bs("warning","SMLOUVA","prepocet-error","Chyba p\u0159i p\u0159epo\u010dtu smlouvy: ".concat(A.message))}Bs("info","DB-RESPONSE","INSERT-complete",{orderId:ee,orderNumber:ne,workflow:Q.stav_workflow_kod,fieldsCount:Object.keys(Q).length,polozky:(null===(h=Q.polozky)||void 0===h?void 0:h.length)||0,faktury:(null===(y=Q.faktury)||void 0===y?void 0:y.length)||0});const i=Q.stav_workflow_kod;oa(i,"ODESLANA"),oa(i,"ZRUSENA");try{var x;Da.default.setCurrentUser(Ae);const e=(0,t.A)((0,t.A)((0,t.A)({},ae),r),{},{polozky_objednavky:ae.polozky_objednavky||[],faktury:ae.faktury||[],objednatel_id:r.objednatel_id||ae.objednatel_id,jmeno:r.jmeno||ae.jmeno,email:r.email||ae.email,telefon:r.telefon||ae.telefon});await Da.default.saveDraft(e,{step:Qn(),attachments:pn,metadata:{version:"1.4",isConceptSaved:!0,isOrderSavedToDB:!0,savedOrderId:ee,isChanged:!1,dictionaries:{approvers:Mi||[],users:wi||[],strediska:Ei||[],financovani:Ci||[],druhyObjednavky:Oi||[],lpKody:Ni||[]}}}),Bs("success","INSERT","draft-updated","Draft aktualizov\xe1n s PARSOVAN\xddMI DB daty (workflow: ".concat(i,", strediska: ").concat(r.strediska_kod.join(", "),", polo\u017eky: ").concat((null===(x=e.polozky_objednavky)||void 0===x?void 0:x.length)||0,", financov\xe1n\xed: ").concat(e.zpusob_financovani||"none",")")),Hn.current=JSON.parse(JSON.stringify(e)),ya({isEditMode:!0,orderId:ee,orderNumber:ne}),Bs("success","INSERT","broadcast","Broadcast stavu odesl\xe1n (isEditMode: true, orderId: ".concat(ee,")"))}catch(A){Bs("error","INSERT","draft-update-error","Chyba p\u0159i aktualizaci draftu: ".concat(A.message))}const s=Q.stav_workflow_kod;if(Bs("success","SAVE","order-status","Objedn\xe1vka ozna\u010dena jako ulo\u017een\xe1. ID: ".concat(ee,", EV: ").concat(ne,", DB stav: ").concat(s)),Bs("success","SAVE","workflow-state","DB stav: ".concat(s," - f\xe1ze se p\u0159epo\u010d\xedt\xe1 automaticky")),oa(s,"SCHVALENA")?(Wi(!1),Bs("info","SAVE","lock-sections","F\xc1ZE 1 sekce zam\u010deny - objedn\xe1vka je schv\xe1len\xe1")):Bs("info","SAVE","keep-unlocked-phase1","F\xc1ZE 1 sekce z\u016fst\xe1vaj\xed odem\u010den\xe9 - stav: ".concat(s)),oa(s,"ODESLANA"),oa(s,"ZRUSENA"),Bs("success","SAVE","no-ui-refresh","Bez UI refresh - p\u0159\xedmo zamyk\xe1n\xed. Nov\xfd stav: ".concat(s)),oa(s,"ODESLANA")||oa(s,"ZRUSENA")){let e=!1;try{const n=Da.default.getUIState();if(n){const a=Kn.id;a&&n.phase2OrderId===a&&!0===n.phase2Unlocked&&(e=!0)}}catch(C){Bs("warning","SAVE","unlock-check-error","Chyba p\u0159i kontrole Phase 2 unlock stavu: ".concat(C.message))}e?Bs("info","SAVE","phase2-keep-unlocked","F\xc1ZE 2 z\u016fst\xe1v\xe1 ODEM\u010cENA - byla ru\u010dn\u011b odem\u010dena"):En(!1)}fo(!1),(0,t.A)((0,t.A)({},Kn),{},{id:ee,ev_cislo:ne,stav_workflow_kod:s},(null===(b=Q)||void 0===b?void 0:b.dt_schvaleni)&&{dt_schvaleni:Q.dt_schvaleni});const d=oa(s,"SCHVALENA");var j;Bs("info","INSERT","phase-check","M\xe1 SCHVALENA: ".concat(d,", nov\xe1 f\xe1ze by m\u011bla b\xfdt: ").concat(d?"2":"1")),Wn(e=>{var n;const a=(()=>{try{const e=Array.isArray(s)?s:JSON.parse(s||'["NOVA"]'),n=e[e.length-1],a=Ha[n];return(null===a||void 0===a?void 0:a.name)||n||"Nov\xe1"}catch(C){return"Nov\xe1"}})();return(0,t.A)((0,t.A)((0,t.A)({},e),{},{id:ee,ev_cislo:ne,stav_workflow_kod:s,stav_objednavky:a},(null===(n=Q)||void 0===n?void 0:n.dt_schvaleni)&&{dt_schvaleni:Q.dt_schvaleni}),{},{strediska_kod:r.strediska_kod})}),I||(Q.message?je&&je(Q.message,{type:"success"}):null!==(j=Q.lock_info)&&void 0!==j&&j.locked_by_user_fullname?je&&je("Objedn\xe1vka byla \xfasp\u011b\u0161n\u011b vytvo\u0159ena (edituje: ".concat(Q.lock_info.locked_by_user_fullname,")"),{type:"success"}):je&&je("Objedn\xe1vka byla \xfasp\u011b\u0161n\u011b vytvo\u0159ena",{type:"success"})),Bs("info","AUTOSAVE","skip-duplicate-insert","Autosave p\u0159esko\u010den - ji\u017e proveden p\u0159es DraftManager.syncWithDatabase()"),!I&&Ae?(Da.default.setCurrentUser(Ae),await Da.default.deleteDraft(),Bs("info","DRAFT","delete-after-create","Draft smaz\xe1n po \xfasp\u011b\u0161n\xe9m CREATE p\u0159es DraftManager (b\u011b\u017en\xfd u\u017eivatel)")):I&&Bs("info","DRAFT","keep-after-create","Draft ZACHOV\xc1N po CREATE - SUPERADMIN/ADMIN z\u016fst\xe1v\xe1 na formul\xe1\u0159i")}}catch(A){const e=Hi&&Kn.id?"orders25/partial-update":"orders25/partial-insert";if(Bs("error","API",e,A.message),A.lock_info){const e=A.lock_info;if(!0===e.locked){const n=e.locked_by_user_fullname||"u\u017eivatel #".concat(e.locked_by_user_id),a=e.lock_age_minutes?" (zam\u010deno p\u0159ed ".concat(e.lock_age_minutes," minutami)"):"";je&&je("Nelze ulo\u017eit zm\u011bny. Objedn\xe1vka je zam\u010dena u\u017eivatelem ".concat(n).concat(a),{type:"error"}),Bs("error","LOCK","order-locked-by-other","Objedn\xe1vka zam\u010dena u\u017eivatelem ".concat(n))}else{const e=(0,Xa.g)(A.message);je&&je("Nepoda\u0159ilo se ulo\u017eit objedn\xe1vku: ".concat(e),{type:"error"}),Bs("info","LOCK","order-owned-by-me","Lock info p\u0159\xedtomen, ale locked=false (moje objedn\xe1vka)")}}else{const e=(0,Xa.g)(A.message);je&&je("Nepoda\u0159ilo se ulo\u017eit objedn\xe1vku: ".concat(e),{type:"error"})}Ht(!1),xa.current=!1,Da.default.setAutosaveEnabled(!0,"Error during save - re-enable autosave"),Kt(!1)}finally{Ne(),Bt(!1),window.__workflowStateUpdated?(Bs("info","SAVE","waiting-for-workflow","\u010cek\xe1m na propagaci workflow state do React..."),setTimeout(()=>{Bs("info","SAVE","workflow-propagated","Workflow state propagov\xe1n, resetuji isSaving"),window.__workflowStateUpdated=!1,Kt(!1),Bs("info","SAVE","finally-cleanup","isSaving resetov\xe1no po workflow update")},200)):(Bs("info","SAVE","no-workflow-update","Workflow nebyl aktualizov\xe1n, resetuji isSaving hned"),setTimeout(()=>{Kt(!1),Bs("info","SAVE","finally-cleanup","isSaving resetov\xe1no bez workflow update")},100));try{Bs("info","SAVE","cache-invalidation","Invaliduji orders cache..."),Na.A.invalidate(Ae)}catch(C){}try{Bs("info","SAVE","background-refresh","Spou\u0161t\xedm postOrderAction background task..."),Oa.A.runTaskNow("postOrderAction")}catch(C){}try{Kn.ev_cislo||Kn.cislo_objednavky,Kn.id||Kn.id}catch(C){}}var z})()},disabled:Zt||rt||!ts||ra&&!ds||an||!Hs(Kn.ev_cislo),title:an?"Na\u010d\xedt\xe1 se eviden\u010dn\xed \u010d\xedslo...":Hs(Kn.ev_cislo)?ra&&!ds?"Objedn\xe1vka je dokon\u010dena/zam\xedtnuta/stornov\xe1na a uzam\u010dena":ts?"Ulo\u017eit objedn\xe1vku":"Nem\xe1te opr\xe1vn\u011bn\xed k ukl\xe1d\xe1n\xed objedn\xe1vek":"Eviden\u010dn\xed \u010d\xedslo se nepoda\u0159ilo na\u010d\xedst",children:[(0,ke.jsx)(p.g,{icon:u.hSh}),an?"Na\u010d\xedt\xe1m \u010d\xedslo...":Zt?"Ukl\xe1d\xe1m...":"ULO\u017dIT"]}),(0,ke.jsxs)(bd,{className:"cancel-btn",onClick:Dp,title:"Zav\u0159\xedt formul\xe1\u0159",disabled:rt||Zt,children:[(0,ke.jsx)(p.g,{icon:u.GRI}),"ZAV\u0158\xcdT"]})]})]}),rt&&(0,ke.jsxs)("div",{style:{padding:"1rem",backgroundColor:"#f0f9ff",borderTop:"1px solid #0ea5e9",borderBottom:"1px solid #0ea5e9"},children:[(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"0.75rem"},children:[(0,ke.jsx)("div",{style:{fontSize:"1.5rem"},children:"\u2705"}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("div",{style:{fontWeight:"600",color:"#0c4a6e",fontSize:"1rem",marginBottom:"0.25rem"},children:"Objedn\xe1vka byla \xfasp\u011b\u0161n\u011b ulo\u017eena!"}),(0,ke.jsx)("div",{style:{color:"#075985",fontSize:"0.875rem"},children:lt})]})]}),(0,ke.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"#e0f2fe",borderRadius:"4px",overflow:"hidden"},children:(0,ke.jsx)("div",{style:{width:"".concat(st,"%"),height:"100%",backgroundColor:"#0ea5e9",transition:"width 2s linear",borderRadius:"4px"}})}),(0,ke.jsx)("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"#0369a1",textAlign:"center"},children:"P\u0159esm\u011brov\xe1v\xe1m na seznam objedn\xe1vek..."})]})]})}),(0,ke.jsx)(id,{ref:Nc,onKeyDown:Hp,children:(0,ke.jsxs)(sd,{children:[(0,ke.jsxs)(wd,{"data-section":"objednatel",children:[(0,ke.jsxs)(Sd,{sectionTheme:Ji("objednatel"),isActive:qi("objednatel"),children:[(0,ke.jsxs)(Ed,{sectionTheme:Ji("objednatel"),children:[(0,ke.jsx)(Cd,{sectionTheme:Ji("objednatel"),children:(0,ke.jsx)(p.g,{icon:u.X46})}),"Informace o objednateli",gs&&!Ts&&(0,ke.jsx)(Dd,{title:"F\xc1ZE 1 a F\xc1ZE 2 sekce jsou zam\u010deny pokud je aktivn\xed F\xc1ZE 3. Odem\u010den\xed resetuje workflow na ODESL\xc1NA KE SCHV\xc1LEN\xcd a vyma\u017ee data F\xc1ZE 3+.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,ke.jsxs)(Nd,{children:[gs&&!Ts&&ns&&(0,ke.jsx)(fl,{onClick:e=>{e.stopPropagation(),Vr(!0)},title:"Odemknout F\xc1ZI 2 (Info o objednateli) - resetuje workflow na ODESL\xc1NA KE SCHV\xc1LEN\xcd",children:(0,ke.jsx)(x,{})}),(0,ke.jsx)(Od,{collapsed:Je.objednatel,sectionTheme:Ji("objednatel"),onClick:()=>Lc("objednatel"),style:{cursor:"pointer"},children:(0,ke.jsx)(p.g,{icon:u.w2A})})]})]}),(0,ke.jsxs)(Td,{collapsed:Je.objednatel,children:[(0,ke.jsxs)(Ld,{children:[(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"JM\xc9NO"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(j.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"jmeno",placeholder:"Jm\xe9no objednatele",value:Kn.jmeno||"",disabled:!0,title:Fn?"Na\u010dteno z DB podle objednatele objedn\xe1vky":Kn.jmeno?"Na\u010dteno z profilu p\u0159ihl\xe1\u0161en\xe9ho u\u017eivatele":"Vypln\xed se automaticky p\u0159i prvn\xed interakci",hasError:!!_o.jmeno,hasIcon:!0})]}),_o.jmeno&&(0,ke.jsx)(Fd,{children:_o.jmeno})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"E-MAIL"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(z.A,{}),(0,ke.jsx)(Wd,{type:"email",name:"email",value:Kn.email||"",disabled:!0,title:Fn?"Na\u010dteno z DB podle objednatele objedn\xe1vky":Kn.email?"Na\u010dteno z profilu p\u0159ihl\xe1\u0161en\xe9ho u\u017eivatele":"Vypln\xed se automaticky p\u0159i prvn\xed interakci",hasError:!!_o.email,hasIcon:!0})]}),_o.email&&(0,ke.jsx)(Fd,{children:_o.email})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{children:"TELEFON"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(A.A,{}),(0,ke.jsx)(Wd,{type:"tel",value:Kn.telefon||"",disabled:!0,placeholder:Kn.telefon?"":Fn?"Telefon nen\xed v DB uveden":"Vypln\xed se automaticky p\u0159i prvn\xed interakci",title:Fn?"Na\u010dteno z DB podle objednatele objedn\xe1vky":Kn.telefon?"Na\u010dteno z profilu p\u0159ihl\xe1\u0161en\xe9ho u\u017eivatele":"Vypln\xed se automaticky p\u0159i prvn\xed interakci",hasIcon:!0})]})]})]}),(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{"data-custom-select":!0,children:[(0,ke.jsxs)(Ud,{children:[(0,ke.jsx)(Zd,{required:!0,children:"GARANT"}),(0,ke.jsx)(Kd,{type:"button",$visible:!!Kn.garant_uzivatel_id,onClick:()=>xp("garant_uzivatel_id",""),title:"Vymazat v\xfdb\u011br",children:(0,ke.jsx)(w.A,{size:12})})]}),(0,ke.jsx)(rp,{value:Kn.garant_uzivatel_id||"",onChange:e=>xp("garant_uzivatel_id",e),onBlur:(e,n)=>Rc("garant_uzivatel_id",n),options:Vi,placeholder:"Vyberte garanta",disabled:gs,hasError:!!_o.garant_uzivatel_id,required:!0,field:"garant",loading:!1,loadingText:"",icon:(0,ke.jsx)(j.A,{}),getOptionLabel:Wp,getOptionValue:(e,n)=>e.id||e.user_id||e,hasTriedToSubmit:ko}),(_o.garant_uzivatel_id||ko&&!Kn.garant_uzivatel_id)&&(0,ke.jsx)(Fd,{children:_o.garant_uzivatel_id||"Garant je povinn\xfd"})]})})]})]}),(0,ke.jsxs)(wd,{"data-section":"schvaleni",children:[(0,ke.jsxs)(Sd,{sectionTheme:Ji("schvaleni"),isActive:qi("schvaleni"),children:[(0,ke.jsxs)(Ed,{sectionTheme:Ji("schvaleni"),children:[(0,ke.jsx)(Cd,{sectionTheme:Ji("schvaleni"),children:(0,ke.jsx)(p.g,{icon:u.Iae})}),"Schv\xe1len\xed n\xe1kupu PO",gs&&!Ts&&(0,ke.jsx)(Dd,{title:"F\xc1ZE 1 a F\xc1ZE 2 sekce jsou zam\u010deny pokud je aktivn\xed F\xc1ZE 3. Odem\u010den\xed umo\u017en\xed editaci F\xc1ZE 1 a 2.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,ke.jsxs)(Nd,{children:[gs&&!Ts&&ns&&(0,ke.jsx)(fl,{onClick:e=>{e.stopPropagation(),Mr(!0)},title:"Odemknout F\xc1ZI 2 (PO sekce) - resetuje workflow na ODESL\xc1NA KE SCHV\xc1LEN\xcd",children:(0,ke.jsx)(x,{})}),(0,ke.jsx)(Od,{collapsed:Je.schvaleni,sectionTheme:Ji("schvaleni"),onClick:()=>Lc("schvaleni"),style:{cursor:"pointer"},children:(0,ke.jsx)(p.g,{icon:u.w2A})})]})]}),(0,ke.jsxs)(Td,{collapsed:Je.schvaleni,children:[(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsx)(Md,{required:!0,children:"P\u0158EDM\u011aT"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(S.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"predmet",placeholder:"Zadejte p\u0159edm\u011bt objedn\xe1vky",value:Kn.predmet||"",onChange:e=>xp("predmet",e.target.value),onBlur:()=>Rc("predmet",Kn.predmet),disabled:gs,hasError:!!_o.predmet,hasIcon:!0})]}),_o.predmet&&(0,ke.jsx)(Fd,{children:_o.predmet})]})}),(0,ke.jsxs)(Ld,{children:[(0,ke.jsxs)(Vd,{"data-custom-select":!0,children:[(0,ke.jsxs)(Ud,{children:[(0,ke.jsx)(Zd,{required:!0,children:"P\u0158\xcdKAZCE"}),(0,ke.jsx)(Kd,{type:"button",$visible:!!Kn.prikazce_id,onClick:()=>xp("prikazce_id",""),title:"Vymazat v\xfdb\u011br",children:(0,ke.jsx)(w.A,{size:12})})]}),(0,ke.jsx)(rp,{value:Kn.prikazce_id||"",onChange:e=>xp("prikazce_id",e),onBlur:(e,n)=>Rc("prikazce_id",n),options:Mi,placeholder:"Vyberte p\u0159\xedkazce operace",disabled:gs,hasError:!!_o.prikazce_id,required:!0,field:"prikazce",loading:!1,loadingText:"",icon:(0,ke.jsx)(E.A,{}),getOptionLabel:Wp,getOptionValue:(e,n)=>e.id||e.user_id||e,hasTriedToSubmit:ko}),(_o.prikazce_id||ko&&!Kn.prikazce_id)&&(0,ke.jsx)(Fd,{children:_o.prikazce_id||"P\u0159\xedkazce je povinn\xfd"})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"MAXIM\xc1LN\xcd CENA S DPH"}),(0,ke.jsx)(Ac,{fieldName:"max_cena_s_dph",value:Kn.max_cena_s_dph||"",onChange:(e,n)=>{const a=(e=>{if(!e)return"";let n=e.replace(/\s/g,"").replace(/K\u010d/g,"");n.includes(",")&&(n=n.replace(",","."));const a=parseFloat(n);return isNaN(a)?"":a.toString()})(n);Wn(n=>(0,t.A)((0,t.A)({},n),{},{[e]:a})),_a(!0)},onBlur:Rc,disabled:gs,hasError:!!_o.max_cena_s_dph,placeholder:"380 000 K\u010d"}),_o.max_cena_s_dph&&(0,ke.jsx)(Fd,{children:_o.max_cena_s_dph})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{children:"MIMO\u0158\xc1DN\xc1 UD\xc1LOST"}),(0,ke.jsxs)(Id,{disabled:gs,style:{height:"50px"},children:[(0,ke.jsxs)(Pd,{checked:Kn.mimoradna_udalost||!1,disabled:gs,children:[(0,ke.jsx)("input",{type:"checkbox",checked:Kn.mimoradna_udalost||!1,onChange:e=>xp("mimoradna_udalost",e.target.checked),disabled:gs}),(0,ke.jsx)("span",{})]}),(0,ke.jsx)(Rd,{checked:Kn.mimoradna_udalost||!1,children:Kn.mimoradna_udalost?"Krize / Hav\xe1rie":"B\u011b\u017en\xe1 objedn\xe1vka"})]})]})]}),(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{"data-custom-select":!0,style:{gridColumn:"1 / -1"},children:[(0,ke.jsxs)(Ud,{children:[(0,ke.jsx)(Zd,{required:!0,children:"ST\u0158EDISKO"}),(0,ke.jsx)(Kd,{type:"button",$visible:Array.isArray(Kn.strediska_kod)&&Kn.strediska_kod.length>0,onClick:()=>xp("strediska_kod",[]),title:"Vymazat v\xfdb\u011br",children:(0,ke.jsx)(w.A,{size:12})})]}),(0,ke.jsx)(rp,{value:Kn.strediska_kod||[],onChange:e=>xp("strediska_kod",e),onBlur:(e,n)=>Rc("strediska_kod",n),options:Ei,placeholder:"Vyberte st\u0159ediska pro objedn\xe1vku",field:"strediska",disabled:gs,hasError:!!_o.strediska_kod,required:!0,multiple:!0,icon:(0,ke.jsx)(C.A,{}),getOptionLabel:Wp,getOptionValue:(e,n)=>e.value||e.id||e,hasTriedToSubmit:ko}),_o.strediska_kod&&(0,ke.jsx)(Fd,{style:{marginTop:"0.5rem",display:"block"},children:_o.strediska_kod})]})}),(0,ke.jsx)(Ld,{style:{marginTop:"1.5rem"},children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsx)("div",{style:{borderTop:"1px solid #d1d5db",marginBottom:"1.5rem"}}),(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsxs)(Ud,{children:[(0,ke.jsx)(Zd,{required:!0,children:"ZP\u016eSOB FINANCOV\xc1N\xcd"}),(0,ke.jsx)(Kd,{type:"button",$visible:!!Kn.zpusob_financovani,onClick:()=>xp("zpusob_financovani",""),title:"Vymazat v\xfdb\u011br",children:(0,ke.jsx)(w.A,{size:12})})]}),(0,ke.jsx)(rp,{value:Kn.zpusob_financovani||"",onChange:e=>xp("zpusob_financovani",e),onBlur:(e,n)=>Rc("zpusob_financovani",n),options:Ci,placeholder:"Vyberte zdroj financov\xe1n\xed...",field:"zpusob_financovani",loading:!1,loadingText:"",icon:(0,ke.jsx)(O.A,{}),disabled:As,hasError:!!_o.zpusob_financovani,required:!0,getOptionLabel:Wp,getOptionValue:(e,n)=>e.kod_stavu||e.kod||e.id||e}),_o.zpusob_financovani&&(0,ke.jsx)(Fd,{children:_o.zpusob_financovani})]})}),(()=>{const e=Ci.find(e=>e.kod_stavu===Kn.zpusob_financovani||e.kod===Kn.zpusob_financovani),n=(null===e||void 0===e?void 0:e.nazev_stavu)||(null===e||void 0===e?void 0:e.nazev)||"";return n.includes("Limitovan")||n.includes("p\u0159\xedslib")})()&&(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsxs)(Ud,{children:[(0,ke.jsx)(Zd,{required:!0,children:"LP K\xd3D"}),(0,ke.jsx)(Kd,{type:"button",$visible:Array.isArray(Kn.lp_kod)&&Kn.lp_kod.length>0,onClick:()=>xp("lp_kod",[]),title:"Vymazat v\xfdb\u011br",children:(0,ke.jsx)(w.A,{size:12})})]}),(0,ke.jsx)(rp,{value:Kn.lp_kod||[],onChange:e=>xp("lp_kod",e),onBlur:(e,n)=>Rc("lp_kod",n),options:ls,placeholder:(()=>{if(!Kn.prikazce_id)return"Nejprve vyberte p\u0159\xedkazce";if(0===ls.length)return"\u017d\xe1dn\xe9 dostupn\xe9 LP k\xf3dy";const e=ls.slice(0,5).map(e=>e.cislo_lp||e.kod).join(", ");return ls.length>5?"nap\u0159. ".concat(e,", ..."):"nap\u0159. ".concat(e)})(),field:"lp_kod",loading:!1,loadingText:"",icon:(0,ke.jsx)(N.A,{}),disabled:As||!Kn.prikazce_id,hasError:!!_o.lp_kod,required:!0,multiple:!0,getOptionLabel:Wp}),_o.lp_kod&&(0,ke.jsx)(Fd,{children:_o.lp_kod})]})}),(()=>{const e=Ci.find(e=>e.kod===Kn.zpusob_financovani);return((null===e||void 0===e?void 0:e.nazev)||"").includes("Smlouva")})()&&(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsxs)(Ld,{style:{gridTemplateColumns:"1fr 2fr"},children:[(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"\u010c\xcdSLO SMLOUVY"}),(0,ke.jsxs)($d,{children:[(0,ke.jsxs)(Bd,{hasIcon:!0,style:!Kn.cislo_smlouvy||!ir||ir.notFound||"VYPRSELA"!==ir.stav&&"UKONCENA"!==ir.stav?{}:{border:"2px solid #f97316",borderRadius:"6px"},children:[(0,ke.jsx)(y.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"cislo_smlouvy",placeholder:"Za\u010dn\u011bte ps\xe1t \u010d\xedslo smlouvy...",value:cr,onChange:e=>{const n=e.target.value;pr(n),vr(n.length>0),mr(-1),n||xp("cislo_smlouvy","")},onKeyDown:e=>{if(!ur)return;const n=ed(cr),a=ar.filter(e=>{if(0==e.aktivni||!1===e.aktivni)return!1;const a=ed(e.cislo_smlouvy||e.evidencni_cislo||""),o=ed(e.nazev_smlouvy||e.predmet||""),t=ed(e.nazev_firmy||""),r=ed(e.ico||""),i=ed(e.usek_zkr||"");return a.includes(n)||o.includes(n)||t.includes(n)||r.includes(n)||i.includes(n)}).slice(0,10);if("ArrowDown"===e.key)e.preventDefault(),mr(e=>e<a.length-1?e+1:e);else if("ArrowUp"===e.key)e.preventDefault(),mr(e=>e>0?e-1:-1);else if("Enter"===e.key&&_r>=0){e.preventDefault();const n=a[_r];if(n){const e=n.cislo_smlouvy||n.evidencni_cislo;xp("cislo_smlouvy",e),pr(e),vr(!1),mr(-1)}}else"Escape"===e.key&&(vr(!1),mr(-1))},onFocus:()=>{cr&&cr.length>0&&vr(!0)},onBlur:e=>{setTimeout(()=>{vr(!1),mr(-1);const e=cr.trim();if(e){ar.some(n=>0!==n.aktivni&&!1!==n.aktivni&&(n.cislo_smlouvy===e||n.evidencni_cislo===e))?Kn.cislo_smlouvy!==e&&xp("cislo_smlouvy",e):(xp("cislo_smlouvy",""),pr(""),je("Vyberte pros\xedm smlouvu ze seznamu","warning"))}},200)},disabled:As,hasError:!!_o.cislo_smlouvy,hasIcon:!0})]}),ur&&cr&&cr.length>0&&(0,ke.jsx)(Jd,{children:(()=>{const e=ed(cr),n=ar.filter(n=>{if(0==n.aktivni||!1===n.aktivni)return!1;const a=ed(n.cislo_smlouvy||n.evidencni_cislo||""),o=ed(n.nazev_smlouvy||n.predmet||""),t=ed(n.nazev_firmy||""),r=ed(n.ico||""),i=ed(n.usek_zkr||"");return a.includes(e)||o.includes(e)||t.includes(e)||r.includes(e)||i.includes(e)}).slice(0,10);return tr?(0,ke.jsx)(Xd,{children:"\u23f3 Na\u010d\xedt\xe1m smlouvy..."}):0===n.length?(0,ke.jsx)(Xd,{children:"\u274c \u017d\xe1dn\xe1 smlouva nenalezena"}):n.map((e,n)=>{const a="VYPRSELA"===e.stav||"UKONCENA"===e.stav,o=n===_r;return(0,ke.jsxs)(Gd,{onMouseDown:n=>{n.preventDefault();const a=e.cislo_smlouvy||e.evidencni_cislo;xp("cislo_smlouvy",a),pr(a),vr(!1),mr(-1)},style:(0,t.A)((0,t.A)({},a?{borderLeft:"3px solid #f97316",opacity:.8}:{}),o?{backgroundColor:"#eff6ff",borderLeft:"3px solid #3b82f6"}:{}),children:[(0,ke.jsxs)(qd,{children:[e.cislo_smlouvy||e.evidencni_cislo,a&&(0,ke.jsx)("span",{style:{color:"#f97316",marginLeft:"8px",fontSize:"0.85em"},children:"\u26a0\ufe0f VYPR\u0160ELA"})]}),(0,ke.jsxs)(Yd,{children:[e.nazev_smlouvy&&(0,ke.jsx)("span",{children:e.nazev_smlouvy}),e.celkova_castka&&(0,ke.jsx)("span",{children:new Intl.NumberFormat("cs-CZ",{style:"currency",currency:"CZK",minimumFractionDigits:0,maximumFractionDigits:0}).format(e.celkova_castka)})]}),e.nazev_firmy&&(0,ke.jsx)(Yd,{style:{fontSize:"0.8em",color:"#6b7280",marginTop:"2px"},children:(0,ke.jsxs)("span",{children:["\ud83c\udfe2 ",e.nazev_firmy,e.ico?" (".concat(e.ico,")"):"",e.usek_zkr?" | ".concat(e.usek_zkr):""]})})]},e.id)})})()})]}),_o.cislo_smlouvy&&(0,ke.jsx)(Fd,{children:_o.cislo_smlouvy})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{children:"POZN\xc1MKA KE SMLOUV\u011a"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(S.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"smlouva_poznamka",placeholder:"Dodate\u010dn\xe9 informace o smlouv\u011b",value:Kn.smlouva_poznamka||"",onChange:e=>xp("smlouva_poznamka",e.target.value),onBlur:()=>Rc("smlouva_poznamka",Kn.smlouva_poznamka),disabled:As,hasError:!!_o.smlouva_poznamka,hasIcon:!0})]}),_o.smlouva_poznamka&&(0,ke.jsx)(Fd,{children:_o.smlouva_poznamka})]})]}),Kn.cislo_smlouvy&&ir&&!ir.notFound&&("VYPRSELA"===ir.stav||"UKONCENA"===ir.stav)&&(0,ke.jsxs)("div",{style:{marginTop:"-8px",marginBottom:"16px",padding:"8px 12px",background:"#fff7ed",border:"2px solid #f97316",borderRadius:"6px",color:"#c2410c",fontSize:"0.9rem",fontWeight:600,display:"flex",alignItems:"center",gap:"8px"},children:["\u26a0\ufe0f Smlouva ji\u017e vypr\u0161ela!!!",ir.platnost_do&&(0,ke.jsxs)("span",{style:{fontSize:"0.85rem",fontWeight:500},children:["Platnost byla do ",new Date(ir.platnost_do).toLocaleDateString("cs-CZ")]})]})]}),(()=>{const e=Ci.find(e=>e.kod===Kn.zpusob_financovani),n=(null===e||void 0===e?void 0:e.nazev)||"";return n.includes("Individu\xe1ln\xed")&&!n.includes("Pojistn\xe1")})()&&(0,ke.jsxs)(Ld,{style:{gridTemplateColumns:"1fr 2fr"},children:[(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"IDENTIFIK\xc1TOR SCHV\xc1LEN\xcd"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(N.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"individualni_schvaleni",placeholder:"Automaticky generov\xe1no z ev. \u010d\xedsla",value:Kn.individualni_schvaleni||"",onChange:e=>xp("individualni_schvaleni",e.target.value),disabled:!0,readOnly:!0,hasError:!!_o.individualni_schvaleni,hasIcon:!0,style:{backgroundColor:"#f3f4f6",cursor:"not-allowed"}})]}),_o.individualni_schvaleni&&(0,ke.jsx)(Fd,{children:_o.individualni_schvaleni})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{children:"POZN\xc1MKA"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(S.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"individualni_poznamka",placeholder:"D\u016fvod nebo podm\xednky schv\xe1len\xed",value:Kn.individualni_poznamka||"",onChange:e=>xp("individualni_poznamka",e.target.value),disabled:As,hasError:!!_o.individualni_poznamka,hasIcon:!0})]}),_o.individualni_poznamka&&(0,ke.jsx)(Fd,{children:_o.individualni_poznamka})]})]}),(()=>{const e=Ci.find(e=>e.kod===Kn.zpusob_financovani),n=(null===e||void 0===e?void 0:e.nazev)||"";return n.includes("Pojistn\xe1")&&n.includes("ud\xe1lost")})()&&(0,ke.jsxs)(Ld,{style:{gridTemplateColumns:"1fr 2fr"},children:[(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"\u010c\xcdSLO POJISTN\xc9 UD\xc1LOSTI"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(N.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"pojistna_udalost_cislo",placeholder:"Eviden\u010dn\xed \u010d\xedslo \u0161kody/ud\xe1losti",value:Kn.pojistna_udalost_cislo||"",onChange:e=>xp("pojistna_udalost_cislo",e.target.value),disabled:As,hasError:!!_o.pojistna_udalost_cislo,hasIcon:!0})]}),_o.pojistna_udalost_cislo&&(0,ke.jsx)(Fd,{children:_o.pojistna_udalost_cislo})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{children:"POZN\xc1MKA K POJISTN\xc9 UD\xc1LOSTI"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(S.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"pojistna_udalost_poznamka",placeholder:"Popis \u0161kody nebo okolnost\xed ud\xe1losti",value:Kn.pojistna_udalost_poznamka||"",onChange:e=>xp("pojistna_udalost_poznamka",e.target.value),disabled:As,hasError:!!_o.pojistna_udalost_poznamka,hasIcon:!0})]}),_o.pojistna_udalost_poznamka&&(0,ke.jsx)(Fd,{children:_o.pojistna_udalost_poznamka})]})]})]})}),(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[!!Kn.id&&!oa(Kn.stav_workflow_kod,"NOVA")&&(Yi||Xi)&&(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsx)("div",{style:{borderTop:"1px solid #d1d5db",marginBottom:"1.5rem",marginTop:"1rem"}}),(0,ke.jsxs)("div",{style:{gridColumn:"1 / -1"},children:[!!Kn.id&&(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,ke.jsx)(Md,{style:{fontSize:"1rem",fontWeight:"600",margin:0},children:"STAV SCHV\xc1LEN\xcd OBJEDN\xc1VKY"}),(()=>{const e=Ga(Kn,"NOVA");return 0===Object.keys(e).length})()&&Kn.stav_schvaleni&&(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsx)("span",{style:{fontWeight:"bold",color:"#374151",fontSize:"0.875rem"},children:"Schvaluje:"}),(0,ke.jsx)("span",{style:{fontWeight:"600",color:"#059669",backgroundColor:"#d1fae5",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.875rem"},children:Ws(Ae)})]})]}),(0,ke.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:"ceka_se"===Kn.stav_schvaleni?"#fef3c7":"#f9fafb",cursor:js?"not-allowed":"pointer",opacity:js?.6:1,marginBottom:"1rem",fontSize:"1rem",fontWeight:"500",color:"ceka_se"===Kn.stav_schvaleni?"#f59e0b":"#374151",pointerEvents:js?"none":"auto"},onClick:e=>{e.preventDefault(),jp("ceka_se")},children:[(0,ke.jsx)("input",{type:"radio",name:"stav_schvaleni",value:"ceka_se",checked:"ceka_se"===Kn.stav_schvaleni,onChange:()=>{},disabled:js,style:{width:"20px",height:"20px",accentColor:"#f59e0b",margin:0,flexShrink:0}}),(0,ke.jsx)(p.g,{icon:u.a$,size:"lg"}),"\u010cek\xe1 se","ceka_se"===Kn.stav_schvaleni&&(0,ke.jsx)("span",{style:{marginLeft:"0.5rem",fontSize:"0.875rem",color:"#f59e0b",fontWeight:"600"},children:"\u23f3"})]}),(0,ke.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:"neschvaleno"===Kn.stav_schvaleni?"#fef2f2":"#f9fafb",cursor:js?"not-allowed":"pointer",opacity:js?.6:1,marginBottom:"1rem",fontSize:"1rem",fontWeight:"500",color:"neschvaleno"===Kn.stav_schvaleni?"#dc2626":"#374151",pointerEvents:js?"none":"auto"},onClick:e=>{e.preventDefault(),jp("neschvaleno")},children:[(0,ke.jsx)("input",{type:"radio",name:"stav_schvaleni",value:"neschvaleno",checked:"neschvaleno"===Kn.stav_schvaleni,onChange:()=>{},disabled:js,style:{width:"20px",height:"20px",accentColor:"#dc2626",margin:0,flexShrink:0}}),(0,ke.jsx)(p.g,{icon:u.GRI,size:"lg"}),"Neschv\xe1leno","neschvaleno"===Kn.stav_schvaleni&&(0,ke.jsx)("span",{style:{marginLeft:"0.5rem",fontSize:"0.875rem",color:"#dc2626",fontWeight:"600"},children:"\u2717"})]}),(0,ke.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:"schvaleno"===Kn.stav_schvaleni?"#f0fdf4":"#f9fafb",cursor:js?"not-allowed":"pointer",opacity:js?.6:1,fontSize:"1rem",fontWeight:"500",color:"schvaleno"===Kn.stav_schvaleni?"#15803d":"#374151",pointerEvents:js?"none":"auto"},onClick:e=>{e.preventDefault(),jp("schvaleno")},children:[(0,ke.jsx)("input",{type:"radio",name:"stav_schvaleni",value:"schvaleno",checked:"schvaleno"===Kn.stav_schvaleni,onChange:()=>{},disabled:js,style:{width:"20px",height:"20px",accentColor:"#16a34a",margin:0,flexShrink:0}}),(0,ke.jsx)(p.g,{icon:u.e68,size:"lg"}),"Schv\xe1leno","schvaleno"===Kn.stav_schvaleni&&(0,ke.jsx)("span",{style:{marginLeft:"0.5rem",fontSize:"0.875rem",color:"#15803d",fontWeight:"600"},children:"\u2713"})]}),("neschvaleno"===Kn.stav_schvaleni||"ceka_se"===Kn.stav_schvaleni)&&(0,ke.jsxs)("div",{style:{flex:"1",minWidth:"300px"},children:[(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsxs)("label",{style:{fontWeight:"500",color:"#374151",fontSize:"0.875rem",whiteSpace:"nowrap"},children:["D\u016fvod:",(0,ke.jsx)("span",{style:{color:"#dc2626",marginLeft:"2px"},children:"*"})]}),(0,ke.jsxs)(Bd,{hasIcon:!0,style:{flex:1},children:[(0,ke.jsx)(S.A,{}),(0,ke.jsx)(Wd,{type:"text",value:Kn.schvaleni_komentar||"",onChange:e=>xp("schvaleni_komentar",e.target.value),onBlur:()=>Rc("schvaleni_komentar",Kn.schvaleni_komentar),placeholder:"neschvaleno"===Kn.stav_schvaleni?"Uve\u010fte d\u016fvod neschv\xe1len\xed...":"Uve\u010fte d\u016fvod \u010dek\xe1n\xed na schv\xe1len\xed...",hasIcon:!0,hasError:!!_o.schvaleni_komentar})]})]}),_o.schvaleni_komentar&&(0,ke.jsx)(Fd,{style:{marginTop:"0.25rem"},children:_o.schvaleni_komentar})]})]}),oa(Kn.stav_workflow_kod,"SCHVALENA")&&Kn.stav_schvaleni&&!!Kn.schvalovatel_id&&Kn.dt_schvaleni&&(0,ke.jsxs)("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"schvaleno"===Kn.stav_schvaleni?"#dcfce7":"neschvaleno"===Kn.stav_schvaleni?"#fef2f2":"#fef3c7",border:"schvaleno"===Kn.stav_schvaleni?"1px solid #16a34a":"neschvaleno"===Kn.stav_schvaleni?"1px solid #f87171":"1px solid #f59e0b",borderRadius:"8px",color:"schvaleno"===Kn.stav_schvaleni?"#166534":"neschvaleno"===Kn.stav_schvaleni?"#991b1b":"#92400e"},children:[(0,ke.jsxs)("div",{style:{fontSize:"1rem",fontWeight:"600",marginBottom:"0.75rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsx)("span",{style:{fontSize:"1.25rem"},children:"schvaleno"===Kn.stav_schvaleni?"\u2705":"neschvaleno"===Kn.stav_schvaleni?"\u274c":"\u23f3"}),"schvaleno"===Kn.stav_schvaleni?"Objedn\xe1vka m\xe1 stav: Schv\xe1len\xe1 objedn\xe1vka":"neschvaleno"===Kn.stav_schvaleni?"Objedn\xe1vka m\xe1 stav: Zam\xedtnuta objedn\xe1vka":"Objedn\xe1vka \u010dek\xe1 na dopln\u011bn\xed podklad\u016f"]}),(0,ke.jsxs)("div",{style:{fontSize:"0.875rem",lineHeight:"1.6"},children:[(0,ke.jsxs)("div",{style:{marginBottom:"0.5rem"},children:[(0,ke.jsx)("strong",{children:"Datum schv\xe1len\xed:"})," ",(0,Ma.fn)(Kn.dt_schvaleni)," \u2022 ",(0,ke.jsx)("strong",{children:"schvaleno"===Kn.stav_schvaleni?"Schv\xe1lil:":"neschvaleno"===Kn.stav_schvaleni?"Zam\xedtl:":"Vr\xe1til:"})," ",Ws(Kn.schvalovatel_id)]}),Kn.schvaleni_komentar&&"schvaleno"!==Kn.stav_schvaleni&&(0,ke.jsxs)("div",{children:[(0,ke.jsx)("strong",{children:"neschvaleno"===Kn.stav_schvaleni?"D\u016fvod zam\xedtnut\xed:":"ceka_se"===Kn.stav_schvaleni?"D\u016fvod vr\xe1cen\xed:":"Koment\xe1\u0159:"})," ",Kn.schvaleni_komentar]})]})]})]})]}),!!Kn.id&&!oa(Kn.stav_workflow_kod,"NOVA")&&!(Yi||Xi)&&Kn.stav_schvaleni&&!!Kn.schvalovatel_id&&Kn.dt_schvaleni&&(0,ke.jsxs)("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"schvaleno"===Kn.stav_schvaleni?"#dcfce7":"neschvaleno"===Kn.stav_schvaleni?"#fef2f2":"#fef3c7",border:"schvaleno"===Kn.stav_schvaleni?"1px solid #16a34a":"neschvaleno"===Kn.stav_schvaleni?"1px solid #f87171":"1px solid #f59e0b",borderRadius:"8px",color:"schvaleno"===Kn.stav_schvaleni?"#166534":"neschvaleno"===Kn.stav_schvaleni?"#991b1b":"#92400e"},children:[(0,ke.jsxs)("div",{style:{fontSize:"1rem",fontWeight:"600",marginBottom:"0.75rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsx)("span",{style:{fontSize:"1.25rem"},children:"schvaleno"===Kn.stav_schvaleni?"\u2705":"neschvaleno"===Kn.stav_schvaleni?"\u274c":"\u23f3"}),"schvaleno"===Kn.stav_schvaleni?"Objedn\xe1vka m\xe1 stav: Schv\xe1len\xe1 objedn\xe1vka":"neschvaleno"===Kn.stav_schvaleni?"Objedn\xe1vka m\xe1 stav: Zam\xedtnuta objedn\xe1vka":"Objedn\xe1vka \u010dek\xe1 na dopln\u011bn\xed podklad\u016f"]}),(0,ke.jsxs)("div",{style:{fontSize:"0.875rem",lineHeight:"1.6"},children:[(0,ke.jsxs)("div",{style:{marginBottom:"0.5rem"},children:[(0,ke.jsx)("strong",{children:"Datum schv\xe1len\xed:"})," ",(0,Ma.fn)(Kn.dt_schvaleni)," \u2022 ",(0,ke.jsx)("strong",{children:"schvaleno"===Kn.stav_schvaleni?"Schv\xe1lil:":"neschvaleno"===Kn.stav_schvaleni?"Zam\xedtl:":"Vr\xe1til:"})," ",Ws(Kn.schvalovatel_id)]}),Kn.schvaleni_komentar&&"schvaleno"!==Kn.stav_schvaleni&&(0,ke.jsxs)("div",{children:[(0,ke.jsx)("strong",{children:"neschvaleno"===Kn.stav_schvaleni?"D\u016fvod zam\xedtnut\xed:":"ceka_se"===Kn.stav_schvaleni?"D\u016fvod vr\xe1cen\xed:":"Koment\xe1\u0159:"})," ",Kn.schvaleni_komentar]})]})]})]})})]})]}),($n||1===Gn)&&!Kn.stav_schvaleni&&(0,ke.jsxs)("div",{style:{margin:"2rem 0",padding:"1rem 1.25rem",backgroundColor:"#f0f9ff",border:"1px solid #0ea5e9",borderRadius:"8px",color:"#0c4a6e"},children:[(0,ke.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"\u2139\ufe0f Objedn\xe1vka zat\xedm nebyla schv\xe1lena"}),(0,ke.jsx)("div",{style:{fontSize:"0.875rem"},children:"Abyste mohli pokra\u010dovat ve vypl\u0148ov\xe1n\xed detail\u016f objedn\xe1vky, p\u0159id\xe1v\xe1n\xed p\u0159\xedloh a zad\xe1v\xe1n\xed informac\xed o dodavateli, je nutn\xe9 nejprve objedn\xe1vku nechat schv\xe1lit."})]}),$i.financovani&&(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsxs)(wd,{"data-section":"dodavatel",children:[(()=>{const e=Ci.find(e=>e.kod===Kn.zpusob_financovani||e.value===Kn.zpusob_financovani),n=((null===e||void 0===e?void 0:e.nazev)||"").toLowerCase().includes("pokladna");return(0,ke.jsx)(ke.Fragment,{children:(0,ke.jsxs)(Sd,{sectionTheme:Ji("dodavatel"),isActive:qi("dodavatel"),children:[(0,ke.jsxs)(Ed,{sectionTheme:Ji("dodavatel"),children:[(0,ke.jsx)(Cd,{sectionTheme:Ji("dodavatel"),children:(0,ke.jsx)(C.A,{})}),"Dodavatel",n&&(0,ke.jsx)(Dd,{title:"Sekce Dodavatel nen\xed pot\u0159ebn\xe1 pro objedn\xe1vky financovan\xe9 z pokladny",style:{marginLeft:"8px",color:"#ff9800"},children:"\ud83d\udcb0 Pokladna - dodavatel nen\xed vy\u017eadov\xe1n"})]}),(0,ke.jsxs)(Nd,{children:[dp()&&!ws&&!n&&Oe&&(Oe("CONTACT_MANAGE")||Oe("CONTACT_EDIT"))&&(0,ke.jsx)(wl,{isActive:!0,onClick:lp,title:"P\u0159idat dodavatele do adres\xe1\u0159e",style:{position:"relative",right:"auto",top:"auto",transform:"none",marginRight:"8px"},children:(0,ke.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,ke.jsx)("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,ke.jsx)("circle",{cx:"8.5",cy:"7",r:"4"}),(0,ke.jsx)("line",{x1:"20",y1:"8",x2:"20",y2:"14"}),(0,ke.jsx)("line",{x1:"23",y1:"11",x2:"17",y2:"11"})]})}),n?(0,ke.jsx)(Od,{collapsed:!0,sectionTheme:Ji("dodavatel"),style:{cursor:"not-allowed",opacity:.5},title:"Sekce je zablokovan\xe1 pro platbu z pokladny",children:(0,ke.jsx)(p.g,{icon:u.GRI})}):(0,ke.jsx)(Od,{collapsed:Je.dodavatel,sectionTheme:Ji("dodavatel"),onClick:()=>Lc("dodavatel"),style:{cursor:"pointer"},children:(0,ke.jsx)(p.g,{icon:u.w2A})})]})]})})})(),(0,ke.jsxs)(Td,{collapsed:Je.dodavatel,children:[(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsxs)(Md,{required:!0,children:["N\xc1ZEV DODAVATELE",Ot&&(0,ke.jsxs)("span",{style:{fontWeight:"normal",fontSize:"0.85em",color:"#666",marginLeft:"8px"},children:["(vypln\u011bno z ","local"===Ot?"lok\xe1ln\xedho adres\xe1\u0159e":"ares"===Ot?"ARES":"smlouva"===Ot||"smlouva-fallback"===Ot?"smlouvy":"automatick\xe9ho zdroje",")"]})]}),(0,ke.jsxs)(Bd,{hasIcon:!0,style:{position:"relative"},children:[(0,ke.jsx)(C.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"dodavatel_nazev",placeholder:"N\xe1zev spole\u010dnosti",value:Kn.dodavatel_nazev||"",onChange:e=>{xp("dodavatel_nazev",e.target.value),Ot&&Nt(null)},onBlur:()=>Rc("dodavatel_nazev",Kn.dodavatel_nazev),hasError:!!_o.dodavatel_nazev,hasIcon:!0,disabled:ws,style:{paddingRight:"80px"}}),(0,ke.jsxs)("div",{style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",display:"flex",gap:"4px",zIndex:10},children:[(0,ke.jsx)(zl,{onClick:ws?void 0:async()=>{const e=Kn.dodavatel_nazev||"",n=Kn.dodavatel_ico||"",a=e||n;Ao(a),So([]),jo(!0),await cp(a)},title:ws?"Zam\u010deno - sekce F\xc1ZE 3":"Vyhledat v lok\xe1ln\xed datab\xe1zi dodavatel\u016f",style:{opacity:ws?.5:1,cursor:ws?"not-allowed":"pointer"},children:(0,ke.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,ke.jsx)("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,ke.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,ke.jsx)("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),(0,ke.jsx)("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}),(0,ke.jsx)(Al,{onClick:ws?void 0:up,title:ws?"Zam\u010deno - sekce F\xc1ZE 3":"Vyhledat v ARES registru",style:{opacity:ws?.5:1,cursor:ws?"not-allowed":"pointer"},children:(0,ke.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,ke.jsx)("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),(0,ke.jsx)("path",{d:"M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5"}),(0,ke.jsx)("path",{d:"M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3"})]})})]})]}),_o.dodavatel_nazev&&(0,ke.jsx)(Fd,{children:_o.dodavatel_nazev})]})}),(0,ke.jsxs)(Ld,{style:{gridTemplateColumns:"2fr 1fr 1fr"},children:[(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"ADRESA"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(D.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"dodavatel_adresa",placeholder:"Adresa s\xeddla",value:Kn.dodavatel_adresa||"",onChange:e=>xp("dodavatel_adresa",e.target.value),onBlur:()=>Rc("dodavatel_adresa",Kn.dodavatel_adresa),hasError:!!_o.dodavatel_adresa,hasIcon:!0,disabled:ws})]}),_o.dodavatel_adresa&&(0,ke.jsx)(Fd,{children:_o.dodavatel_adresa})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"I\u010cO"}),(0,ke.jsxs)(Bd,{hasIcon:!0,style:{position:"relative"},children:[(0,ke.jsx)(N.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"dodavatel_ico",placeholder:"12345678",value:Kn.dodavatel_ico||"",onChange:e=>xp("dodavatel_ico",e.target.value),onBlur:e=>(e=>{const n=null===e||void 0===e?void 0:e.trim();Rc("dodavatel_ico",n),n&&n.length>=8&&/^\d+$/.test(n)&&fp(n)})(e.target.value),hasError:!!_o.dodavatel_ico,hasIcon:!0,disabled:ws,style:{paddingRight:"36px"}}),(0,ke.jsx)(Al,{onClick:ws?void 0:up,title:ws?"Zam\u010deno - sekce F\xc1ZE 3":"Vyhledat I\u010cO v ARES registru",style:{opacity:ws?.5:1,cursor:ws?"not-allowed":"pointer"},children:(0,ke.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,ke.jsx)("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),(0,ke.jsx)("path",{d:"M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5"}),(0,ke.jsx)("path",{d:"M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3"})]})}),Yo&&(0,ke.jsxs)(ac,{"data-status":Qo,children:["checking"===Qo&&(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsx)(oc,{status:"checking",children:"Kontroluji I\u010cO..."}),(0,ke.jsx)(tc,{status:"checking",children:"Vyhled\xe1v\xe1m dodavatele podle I\u010cO v datab\xe1zi a ARES."})]}),("found-local"===Qo||"found-ares"===Qo)&&nt&&(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsx)(oc,{status:"found",children:"found-local"===Qo?"Dodavatel v datab\xe1zi!":"Dodavatel nalezen v ARES!"}),(0,ke.jsxs)(tc,{status:"found",children:[(0,ke.jsx)("strong",{children:nt.nazev||nt.name||"N\xe1zev nen\xed k dispozici"}),(0,ke.jsx)("br",{}),"I\u010cO: ",nt.ico,(0,ke.jsx)("br",{}),nt.dic&&(0,ke.jsxs)(ke.Fragment,{children:["DI\u010c: ",nt.dic,(0,ke.jsx)("br",{})]}),(nt.adresa||nt.address)&&(0,ke.jsxs)(ke.Fragment,{children:[nt.adresa||nt.address,(0,ke.jsx)("br",{})]}),nt.zastoupeny&&(0,ke.jsxs)(ke.Fragment,{children:["Zastoupen\xfd: ",nt.zastoupeny,(0,ke.jsx)("br",{})]}),nt.kontakt_jmeno&&(0,ke.jsxs)(ke.Fragment,{children:["Kontakt: ",nt.kontakt_jmeno,nt.kontakt_email&&(0,ke.jsxs)(ke.Fragment,{children:[", ",nt.kontakt_email]}),nt.kontakt_telefon&&(0,ke.jsxs)(ke.Fragment,{children:[", ",nt.kontakt_telefon]}),(0,ke.jsx)("br",{})]}),(0,ke.jsxs)("div",{style:{fontSize:"11px",color:"#666",marginTop:"8px"},children:["Zdroj: ","local"===nt.source?"Lok\xe1ln\xed datab\xe1ze":"ARES registr"]})]}),(0,ke.jsxs)(rc,{children:[(0,ke.jsx)(ic,{className:"fill-form",onClick:hp,children:"Vyplnit formul\xe1\u0159"}),"found-ares"===Qo&&(0,ke.jsx)(ic,{className:"primary",onClick:async()=>{if(nt){if("ares"===nt.source)try{const e=await(0,me.jx)({token:Se,username:we,nazev:nt.nazev,ico:nt.ico,dic:nt.dic||"",adresa:nt.adresa||"",zastoupeny:"",kontakt_jmeno:"",kontakt_email:"",kontakt_telefon:"",user_id:Ae,usek_zkr:""});if(!(null!==e&&void 0!==e&&e.ok||"ok"===(null===e||void 0===e?void 0:e.status)))throw new Error((null===e||void 0===e?void 0:e.message)||"Nezn\xe1m\xe1 chyba");je&&je("Dodavatel byl p\u0159id\xe1n do va\u0161ich osobn\xedch kontakt\u016f",{type:"success"})}catch(e){return void(je&&je("Chyba p\u0159i p\u0159id\xe1v\xe1n\xed do kontakt\u016f: ".concat(e.message),{type:"error"}))}hp()}},children:"P\u0159idat do osobn\xedch kontakt\u016f"}),(0,ke.jsx)(ic,{className:"secondary",onClick:yp,children:"Zru\u0161it"})]})]}),"not-found"===Qo&&(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsx)(oc,{status:"not-found",children:"Dodavatel nebyl nalezen"}),(0,ke.jsx)(tc,{status:"not-found",children:"Dodavatel s t\xedmto I\u010cO nen\xed v lok\xe1ln\xed datab\xe1zi ani v ARES. M\u016f\u017eete pokra\u010dovat s ru\u010dn\xedm zad\xe1n\xedm."}),(0,ke.jsx)(rc,{children:(0,ke.jsx)(ic,{className:"secondary",onClick:yp,children:"Pokra\u010dovat ru\u010dn\u011b"})})]})]})]}),_o.dodavatel_ico&&(0,ke.jsx)(Fd,{children:_o.dodavatel_ico})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{children:"DI\u010c"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(N.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"dodavatel_dic",placeholder:"CZ12345678",value:Kn.dodavatel_dic||"",onChange:e=>xp("dodavatel_dic",e.target.value),onBlur:()=>Rc("dodavatel_dic",Kn.dodavatel_dic),hasIcon:!0,disabled:ws})]})]})]}),(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsx)(Md,{children:"ZASTOUPEN\xdd"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(j.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"dodavatel_zastoupeny",placeholder:"Zastoupen Ji\u0159\xedm Nov\xe1kem",value:Kn.dodavatel_zastoupeny||"",onChange:e=>xp("dodavatel_zastoupeny",e.target.value),onBlur:()=>Rc("dodavatel_zastoupeny",Kn.dodavatel_zastoupeny),hasIcon:!0,disabled:ws})]})]})}),(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsx)("div",{style:{width:"100%",height:"1px",background:"linear-gradient(to right, #e5e7eb, transparent)",margin:"1.5rem 0 1rem 0"}}),(0,ke.jsxs)(Md,{style:{fontSize:"1rem",fontWeight:"600",color:"#374151",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.5rem"},children:[(0,ke.jsx)(j.A,{size:18}),"Kontaktn\xed osoba dodavatele"]})]})}),(0,ke.jsxs)(Ld,{children:[(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{children:"JM\xc9NO A P\u0158\xcdJMEN\xcd"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(j.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"dodavatel_kontakt_jmeno",placeholder:"Jan Nov\xe1k",value:Kn.dodavatel_kontakt_jmeno||"",onChange:e=>xp("dodavatel_kontakt_jmeno",e.target.value),onBlur:()=>Rc("dodavatel_kontakt_jmeno",Kn.dodavatel_kontakt_jmeno),hasIcon:!0,disabled:ws})]})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{children:"E-MAIL"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(z.A,{}),(0,ke.jsx)(Wd,{type:"email",name:"dodavatel_kontakt_email",placeholder:"jan.novak@dodavatel.cz",value:Kn.dodavatel_kontakt_email||"",onChange:e=>xp("dodavatel_kontakt_email",e.target.value),onBlur:()=>Rc("dodavatel_kontakt_email",Kn.dodavatel_kontakt_email),hasIcon:!0,disabled:ws})]})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{children:"TELEFON"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(A.A,{}),(0,ke.jsx)(Wd,{type:"tel",name:"dodavatel_kontakt_telefon",placeholder:"+420 123 456 789",value:Kn.dodavatel_kontakt_telefon||"",onChange:e=>xp("dodavatel_kontakt_telefon",e.target.value),onBlur:()=>Rc("dodavatel_kontakt_telefon",Kn.dodavatel_kontakt_telefon),hasIcon:!0,disabled:ws})]})]})]})]})]}),($n||Gn>=3)&&(Gn>=3&&(!Kn.polozky_objednavky||0===Kn.polozky_objednavky.length)&&setTimeout(()=>{Kn.polozky_objednavky&&0!==Kn.polozky_objednavky.length||Wn(e=>(0,t.A)((0,t.A)({},e),{},{polozky_objednavky:[{id:"failsafe_item_".concat(Date.now()),popis:"",mnozstvi:"1",jednotka:"ks",cena_bez_dph:"",sazba_dph:"21",cena_s_dph:""}]}))},100),!0)&&(0,ke.jsxs)(wd,{"data-section":"detaily",children:[(0,ke.jsxs)(Sd,{sectionTheme:Ji("detaily"),isActive:qi("detaily"),children:[(0,ke.jsxs)(Ed,{sectionTheme:Ji("detaily"),children:[(0,ke.jsx)(Cd,{sectionTheme:Ji("detaily"),children:(0,ke.jsx)(T.A,{})}),"Detaily objedn\xe1vky",ws&&!Ts&&(0,ke.jsx)(Dd,{title:"F\xc1ZE 3 sekce je zam\u010dena ve F\xc1ZI 4+. Odem\u010den\xed umo\u017en\xed editaci F\xc1ZE 3.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,ke.jsxs)(Nd,{children:[(0,ke.jsxs)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#92400e",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsxs)("span",{children:["Celkem s DPH: ",Ms.toLocaleString("cs-CZ")," K\u010d"]}),Us>0&&(0,ke.jsx)("span",{style:{color:Ms>Us?"#dc2626":"#059669",fontSize:"0.75rem",padding:"2px 6px",borderRadius:"4px",backgroundColor:Ms>Us?"#fef2f2":"#f0fdf4",border:"1px solid ".concat(Ms>Us?"#fecaca":"#bbf7d0")},children:Ms>Us?"+".concat((Ms-Us).toLocaleString("cs-CZ")," K\u010d nad limit"):"".concat((Us-Ms).toLocaleString("cs-CZ")," K\u010d do limitu")})]}),(0,ke.jsx)(Od,{collapsed:Je.detaily,sectionTheme:Ji("detaily"),onClick:()=>Lc("detaily"),style:{cursor:"pointer"},children:(0,ke.jsx)(p.g,{icon:u.w2A})})]})]}),(0,ke.jsxs)(Td,{collapsed:Je.detaily,children:[(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsxs)(Ud,{children:[(0,ke.jsx)(Zd,{required:!0,children:"DRUH OBJ."}),(0,ke.jsx)(Kd,{type:"button",$visible:!!Kn.druh_objednavky_kod,onClick:()=>xp("druh_objednavky_kod",""),title:"Vymazat v\xfdb\u011br",children:(0,ke.jsx)(w.A,{size:12})})]}),(0,ke.jsx)(rp,{value:Kn.druh_objednavky_kod,onChange:e=>xp("druh_objednavky_kod",e),onBlur:(e,n)=>Rc("druh_objednavky_kod",n),options:Oi,placeholder:"Vyberte druh objedn\xe1vky...",field:"druh_objednavky_kod",icon:(0,ke.jsx)(T.A,{}),disabled:ws,hasError:!!_o.druh_objednavky_kod,required:!0,loading:!1,getOptionLabel:Wp,getOptionValue:(e,n)=>e.kod_stavu||e.value||e.kod||e.id||e}),_o.druh_objednavky_kod&&(0,ke.jsx)(Fd,{children:_o.druh_objednavky_kod})]})}),(0,ke.jsxs)("div",{style:{marginTop:"1.5rem"},children:[(0,ke.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:(0,ke.jsxs)("h4",{style:{margin:0,fontSize:"1rem",fontWeight:"600",color:"#374151"},children:["Polo\u017eky objedn\xe1vky ",(0,ke.jsx)("span",{style:{color:"#ef4444"},children:"*"})]})}),_o.polozky_objednavky&&(0,ke.jsx)(Fd,{style:{marginBottom:"1rem"},children:_o.polozky_objednavky}),(Kn.polozky_objednavky||[]).map((e,n)=>(0,ke.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"8px",padding:"1rem",marginBottom:"1rem",background:"#fafafa"},children:[(0,ke.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flex:1},children:[(0,ke.jsxs)("span",{style:{fontWeight:"600",color:"#374151",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsx)(I,{size:18,style:{color:"#10b981"}}),"POLO\u017dKA ",n+1," ",0===n&&(0,ke.jsx)("span",{style:{color:"#ef4444"},children:"*"})]}),Gn>=3&&(()=>{const a=Ci.find(e=>e.kod_stavu===Kn.zpusob_financovani||e.kod===Kn.zpusob_financovani),o=(null===a||void 0===a?void 0:a.nazev_stavu)||(null===a||void 0===a?void 0:a.nazev)||"";return(o.includes("Limitovan")||o.includes("p\u0159\xedslib"))&&Array.isArray(Kn.lp_kod)&&Kn.lp_kod.length>0?(0,ke.jsxs)("div",{style:{flex:1,marginRight:"0.5rem",display:"flex",flexDirection:"column",gap:"0.25rem"},"data-custom-select":!0,children:[(0,ke.jsx)(rp,{value:e.lp_id||"",onChange:n=>sp(e.id,"lp_id",n),options:_i,placeholder:Kn.id?0===_i.length?"\u017d\xe1dn\xe9 LP dostupn\xe9":"-- Vybrat LP --":"Ulo\u017ete objedn\xe1vku...",field:"polozka_".concat(e.id,"_lp"),disabled:ws||!Kn.id,hasError:!!_o["polozka_".concat(n,"_lp")],required:!0,hasTriedToSubmit:ko,icon:(0,ke.jsx)(N.A,{}),getOptionLabel:Wp,getOptionValue:e=>e.id}),_o["polozka_".concat(n,"_lp")]&&(0,ke.jsx)(Fd,{style:{fontSize:"0.7rem",marginTop:"0.1rem"},children:_o["polozka_".concat(n,"_lp")]})]}):null})()]}),(Kn.polozky_objednavky||[]).length>1&&(0,ke.jsx)(Sl,{type:"button",onClick:ws?void 0:()=>{return n=e.id,void((Kn.polozky_objednavky||[]).length<=1||(Wn(e=>(0,t.A)((0,t.A)({},e),{},{polozky_objednavky:(e.polozky_objednavky||[]).filter(e=>e.id!==n)})),setTimeout(()=>zc(!0),100)));var n},disabled:ws,title:ws?"Zam\u010deno - sekce F\xc1ZE 3":"Smazat polo\u017eku",style:{opacity:ws?.5:1,cursor:ws?"not-allowed":"pointer"},children:(0,ke.jsx)(P,{size:16})})]}),(0,ke.jsx)(Ld,{style:{marginBottom:"1rem"},children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsx)(Md,{required:!0,children:"N\xe1zev / popis"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(S.A,{}),(0,ke.jsx)(Wd,{type:"text",placeholder:"N\xe1zev / popis polo\u017eky",value:e.popis,onChange:n=>sp(e.id,"popis",n.target.value),onBlur:()=>Rc("polozka_".concat(n,"_popis"),e.popis),hasError:!!_o["polozka_".concat(n,"_popis")],hasIcon:!0,disabled:ws})]}),_o["polozka_".concat(n,"_popis")]&&(0,ke.jsx)(Fd,{children:_o["polozka_".concat(n,"_popis")]})]})}),(0,ke.jsxs)(Ld,{style:{gridTemplateColumns:"1fr auto 1fr",gap:"1rem",alignItems:"end"},children:[(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"CENA BEZ DPH"}),(0,ke.jsx)(Ac,{fieldName:"polozka_".concat(n,"_cena_bez_dph"),value:e.cena_bez_dph||"",onChange:(n,a)=>sp(e.id,"cena_bez_dph",a),onBlur:(e,a)=>Rc("polozka_".concat(n,"_cena_bez_dph"),a),disabled:ws,placeholder:"0.00",hasError:!!_o["polozka_".concat(n,"_cena_bez_dph")]}),_o["polozka_".concat(n,"_cena_bez_dph")]&&(0,ke.jsx)(Fd,{children:_o["polozka_".concat(n,"_cena_bez_dph")]})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{children:"DPH"}),(0,ke.jsxs)("select",{value:e.sazba_dph,onChange:n=>sp(e.id,"sazba_dph",n.target.value),onBlur:()=>Rc("polozka_".concat(n,"_sazba_dph"),e.sazba_dph),disabled:ws,style:{padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"0.875rem",backgroundColor:"white",width:"80px"},children:[(0,ke.jsx)("option",{value:"12",children:"12%"}),(0,ke.jsx)("option",{value:"21",children:"21%"})]})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"CENA S DPH"}),(0,ke.jsx)(Ac,{fieldName:"polozka_".concat(n,"_cena_s_dph"),value:e.cena_s_dph||"",onChange:(n,a)=>sp(e.id,"cena_s_dph",a),onBlur:(e,a)=>Rc("polozka_".concat(n,"_cena_s_dph"),a),disabled:ws,placeholder:"0.00",hasError:!!_o["polozka_".concat(n,"_cena_s_dph")]}),_o["polozka_".concat(n,"_cena_s_dph")]&&(0,ke.jsx)(Fd,{children:_o["polozka_".concat(n,"_cena_s_dph")]})]})]}),(0,ke.jsxs)("div",{style:{marginTop:"1rem"},children:[(()=>{const n=Pi;return(0,ke.jsxs)("button",{type:"button",onClick:()=>{n||yo(n=>(0,t.A)((0,t.A)({},n),{},{[e.id]:!n[e.id]}))},disabled:ws||n,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",background:"transparent",border:"none",color:n?"#ef4444":"#6b7280",fontSize:"0.875rem",fontWeight:n?"600":"500",cursor:ws||n?"not-allowed":"pointer",opacity:ws?.5:1,transition:"color 0.2s"},onMouseOver:e=>!ws&&!n&&(e.currentTarget.style.color="#374151"),onMouseOut:e=>!ws&&!n&&(e.currentTarget.style.color="#6b7280"),children:[!n&&(0,ke.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{transform:ho[e.id]?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:(0,ke.jsx)("polyline",{points:"6 9 12 15 18 9"})}),"Up\u0159esn\u011bn\xed m\xedsta dod\xe1n\xed ",n?(0,ke.jsx)("span",{style:{color:"#ef4444"},children:"*"}):"(voliteln\xe9)"]})})(),ho[e.id]&&(()=>{const a=Pi;return(0,ke.jsxs)("div",{style:{marginTop:"0.75rem",padding:"1rem",background:a?"#fef2f2":"#f9fafb",borderRadius:"6px",border:a?"1px solid #fca5a5":"1px dashed #d1d5db"},children:[(0,ke.jsxs)(Ld,{style:{gridTemplateColumns:"1fr 1fr 1fr"},children:[(0,ke.jsxs)(Vd,{children:[(0,ke.jsxs)(Md,{children:["\xdaSEK ",a&&(0,ke.jsx)("span",{style:{color:"#ef4444"},children:"*"})]}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(D.A,{size:16}),(0,ke.jsx)(Wd,{type:"text",name:"polozka_".concat(n,"_usek_kod"),placeholder:"\xdasek...",value:e.usek_kod||"",onChange:n=>sp(e.id,"usek_kod",n.target.value),onBlur:()=>Rc("polozka_".concat(n,"_usek_kod"),e.usek_kod),disabled:ws,hasError:!!_o["polozka_".concat(n,"_usek_kod")],style:{paddingLeft:"2.5rem"}})]}),_o["polozka_".concat(n,"_usek_kod")]&&(0,ke.jsx)(Fd,{children:_o["polozka_".concat(n,"_usek_kod")]})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsxs)(Md,{children:["BUDOVA ",a&&(0,ke.jsx)("span",{style:{color:"#ef4444"},children:"*"})]}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(D.A,{size:16}),(0,ke.jsx)(Wd,{type:"text",name:"polozka_".concat(n,"_budova_kod"),placeholder:"Budova...",value:e.budova_kod||"",onChange:n=>sp(e.id,"budova_kod",n.target.value),onBlur:()=>Rc("polozka_".concat(n,"_budova_kod"),e.budova_kod),disabled:ws,hasError:!!_o["polozka_".concat(n,"_budova_kod")],style:{paddingLeft:"2.5rem"}})]}),_o["polozka_".concat(n,"_budova_kod")]&&(0,ke.jsx)(Fd,{children:_o["polozka_".concat(n,"_budova_kod")]})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsxs)(Md,{children:["M\xcdSTNOST ",a&&(0,ke.jsx)("span",{style:{color:"#ef4444"},children:"*"})]}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(D.A,{size:16}),(0,ke.jsx)(Wd,{type:"text",name:"polozka_".concat(n,"_mistnost_kod"),placeholder:"M\xedstnost...",value:e.mistnost_kod||"",onChange:n=>sp(e.id,"mistnost_kod",n.target.value),onBlur:()=>Rc("polozka_".concat(n,"_mistnost_kod"),e.mistnost_kod),disabled:ws,hasError:!!_o["polozka_".concat(n,"_mistnost_kod")],style:{paddingLeft:"2.5rem"}})]}),_o["polozka_".concat(n,"_mistnost_kod")]&&(0,ke.jsx)(Fd,{children:_o["polozka_".concat(n,"_mistnost_kod")]})]})]}),(0,ke.jsx)(Ld,{style:{gridTemplateColumns:"1fr"},children:(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{children:"POZN\xc1MKA K M\xcdSTU"}),(0,ke.jsx)(Hd,{name:"polozka_".concat(n,"_poznamka_lokalizace"),placeholder:"Dopl\u0148uj\xedc\xed informace k m\xedstu dod\xe1n\xed...",value:e.poznamka||"",onChange:n=>sp(e.id,"poznamka",n.target.value),onBlur:()=>Rc("polozka_".concat(n,"_poznamka_lokalizace"),e.poznamka),disabled:ws,rows:2})]})})]})})()]})]},e.id)),!ws&&(0,ke.jsxs)("button",{type:"button",onClick:()=>{Wn(e=>(0,t.A)((0,t.A)({},e),{},{polozky_objednavky:[...e.polozky_objednavky||[],{id:Date.now(),popis:"",cena_bez_dph:"",sazba_dph:"21",cena_s_dph:"",usek_kod:"",budova_kod:"",mistnost_kod:"",poznamka:"",lp_id:null}]})),setTimeout(()=>zc(!0),100)},style:{width:"100%",marginTop:"1rem",padding:"1rem",background:"transparent",border:"2px dashed #10b981",borderRadius:"8px",color:"#10b981",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",transition:"all 0.2s ease"},onMouseOver:e=>{e.currentTarget.style.background="#f0fdf4",e.currentTarget.style.borderColor="#059669"},onMouseOut:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.borderColor="#10b981"},children:[(0,ke.jsx)(R.A,{size:16}),(0,ke.jsx)("span",{children:"P\u0159idat dal\u0161\xed polo\u017eku"})]})]}),(0,ke.jsx)(Ld,{style:{marginTop:"1.5rem"},children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsx)(Md,{children:"POZN\xc1MKA:"}),(0,ke.jsx)(Hd,{name:"poznamka_objednavky",placeholder:"Dodate\u010dn\xe9 pozn\xe1mky a po\u017eadavky...",value:Kn.poznamka_objednavky||"",onChange:e=>xp("poznamka_objednavky",e.target.value),onBlur:e=>Rc("poznamka_objednavky",e.target.value),disabled:ws,rows:3})]})})]})]}),(0,ke.jsxs)(wd,{"data-section":"dodaci_podminky",children:[(0,ke.jsxs)(Sd,{sectionTheme:Ji("dodaci_podminky"),isActive:qi("dodaci_podminky"),children:[(0,ke.jsxs)(Ed,{sectionTheme:Ji("dodaci_podminky"),children:[(0,ke.jsx)(Cd,{sectionTheme:Ji("dodaci_podminky"),children:(0,ke.jsx)(_.A,{})}),"Dodac\xed a z\xe1ru\u010dn\xed podm\xednky",ws&&!Ts&&(0,ke.jsx)(Dd,{title:"F\xc1ZE 3 sekce je zam\u010dena ve F\xc1ZI 4+. Odem\u010den\xed umo\u017en\xed editaci F\xc1ZE 3.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,ke.jsx)(Nd,{children:(0,ke.jsx)(Od,{collapsed:Je.dodaci_podminky,sectionTheme:Ji("dodaci_podminky"),onClick:()=>Lc("dodaci_podminky"),style:{cursor:"pointer"},children:(0,ke.jsx)(p.g,{icon:u.w2A})})})]}),(0,ke.jsxs)(Td,{collapsed:Je.dodaci_podminky,children:[(0,ke.jsxs)(Ld,{style:{gridTemplateColumns:"2fr 3fr"},children:[(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{children:"P\u0158EDPOKL\xc1DAN\xdd TERM\xcdN DOD\xc1N\xcd"}),(0,ke.jsx)(wc,{fieldName:"dt_predpokladany_termin_dodani",value:Kn.dt_predpokladany_termin_dodani,onChange:e=>xp("dt_predpokladany_termin_dodani",e),onBlur:e=>Rc("dt_predpokladany_termin_dodani",e),disabled:ws,hasError:!!_o.dt_predpokladany_termin_dodani,placeholder:"Vyberte datum"})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{children:"M\xcdSTO DOD\xc1N\xcd"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(D.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"misto_dodani",placeholder:"Adresa m\xedsta dod\xe1n\xed",value:Kn.misto_dodani||"",onChange:e=>xp("misto_dodani",e.target.value),onBlur:e=>Rc("misto_dodani",e.target.value),disabled:ws,hasIcon:!0})]})]})]}),(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsx)(Md,{children:"Z\xc1RUKA"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(S.A,{}),(0,ke.jsx)(Wd,{type:"text",name:"zaruka",placeholder:"Z\xe1ru\u010dn\xed podm\xednky a lh\u016fty",value:Kn.zaruka||"",onChange:e=>xp("zaruka",e.target.value),onBlur:e=>Rc("zaruka",e.target.value),disabled:ws,hasIcon:!0})]})]})})]})]}),(0,ke.jsxs)(wd,{"data-section":"stav_odeslani",children:[(0,ke.jsxs)(Sd,{sectionTheme:Ji("stav_odeslani"),isActive:qi("stav_odeslani"),children:[(0,ke.jsxs)(Ed,{sectionTheme:Ji("stav_odeslani"),children:[(0,ke.jsx)(Cd,{sectionTheme:Ji("stav_odeslani"),children:(0,ke.jsx)(T.A,{})}),"Stav odesl\xe1n\xed objedn\xe1vky",ws&&!Ts&&(0,ke.jsx)(Dd,{title:"F\xc1ZE 3 sekce je zam\u010dena ve F\xc1ZI 4+. Odem\u010den\xed umo\u017en\xed editaci F\xc1ZE 3.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,ke.jsxs)(Nd,{children:[ws&&!Ts&&es&&(0,ke.jsx)(fl,{onClick:e=>{e.stopPropagation(),Zr(!0)},title:"Odemknout F\xc1ZE 3 sekce",children:(0,ke.jsx)(x,{})}),(0,ke.jsx)(Od,{collapsed:Je.stav_odeslani,sectionTheme:Ji("stav_odeslani"),onClick:()=>Lc("stav_odeslani"),style:{cursor:"pointer"},children:(0,ke.jsx)(p.g,{icon:u.w2A})})]})]}),(0,ke.jsx)(Td,{collapsed:Je.stav_odeslani,children:(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsx)(Md,{style:{marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"KONE\u010cN\xdd STAV OBJEDN\xc1VKY"}),(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:Kn.stav_odeslano?"#f0fdf4":"#f9fafb",marginBottom:"1rem",opacity:ws||rt||Zt?.6:1},children:[(0,ke.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",fontSize:"1rem",fontWeight:"500",cursor:ws||rt||Zt?"not-allowed":"pointer",color:Kn.stav_odeslano?"#15803d":"#374151"},children:[(0,ke.jsx)("input",{type:"checkbox",name:"stav_odeslano",checked:Kn.stav_odeslano||!1,disabled:ws||rt||Zt,onChange:e=>{const n=e.target.checked;n&&(xp("stav_stornovano",!1),xp("datum_storna",""),xp("odeslani_storno_duvod",""),xp("storno_uzivatel_id",""),xp("storno_provedl","")),xp("stav_odeslano",n)},style:{width:"20px",height:"20px",accentColor:"#16a34a"}}),(0,ke.jsx)(T.A,{size:20}),"Odesl\xe1no",Kn.stav_odeslano&&(0,ke.jsx)("span",{style:{marginLeft:"0.5rem",fontSize:"0.875rem",color:"#15803d",fontWeight:"600"},children:"\u2713"})]}),(Kn.stav_odeslano||Kn.dt_odeslani)&&(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginLeft:"auto"},children:[(0,ke.jsx)(Md,{style:{margin:0,fontSize:"0.875rem"},children:"DATUM:"}),(0,ke.jsx)("div",{style:{width:"280px"},children:(0,ke.jsx)(wc,{fieldName:"datum_odeslani",value:Kn.datum_odeslani,onChange:e=>xp("datum_odeslani",e),onBlur:e=>Rc("datum_odeslani",e),disabled:ws,hasError:!!_o.datum_odeslani,placeholder:"Datum"})})]})]}),(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:Kn.stav_stornovano?"#fef2f2":"#f9fafb",opacity:ws||rt||Zt?.6:1},children:[(0,ke.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",fontSize:"1rem",fontWeight:"500",cursor:ws||rt||Zt?"not-allowed":"pointer",color:Kn.stav_stornovano?"#dc2626":"#374151"},children:[(0,ke.jsx)("input",{type:"checkbox",name:"stav_stornovano",checked:Kn.stav_stornovano||!1,disabled:ws||rt||Zt,onChange:e=>{const n=e.target.checked;n&&(xp("stav_odeslano",!1),xp("datum_odeslani","")),xp("stav_stornovano",n)},style:{width:"20px",height:"20px",accentColor:"#dc2626"}}),(0,ke.jsx)(p.g,{icon:u.GRI,size:"lg"}),"Stornov\xe1no",Kn.stav_stornovano&&(0,ke.jsx)("span",{style:{marginLeft:"0.5rem",fontSize:"0.875rem",color:"#dc2626",fontWeight:"600"},children:"\u2717"})]}),(Kn.stav_stornovano||Kn.datum_storna)&&(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginLeft:"auto"},children:[(0,ke.jsx)(Md,{style:{margin:0,fontSize:"0.875rem"},children:"DATUM:"}),(0,ke.jsx)("div",{style:{width:"280px"},children:(0,ke.jsx)(wc,{fieldName:"datum_storna",value:Kn.datum_storna,onChange:e=>xp("datum_storna",e),onBlur:e=>Rc("datum_storna",e),disabled:ws,hasError:!!_o.datum_storna,placeholder:"Vyberte datum..."})})]})]}),Kn.stav_stornovano&&(0,ke.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,ke.jsxs)(Md,{style:{marginBottom:"0.5rem"},children:["D\u016eVOD STORNOV\xc1N\xcd",(0,ke.jsx)("span",{style:{color:"#dc2626",marginLeft:"0.25rem"},children:"*"})]}),(0,ke.jsx)(Hd,{name:"odeslani_storno_duvod",placeholder:"Uve\u010fte d\u016fvod stornov\xe1n\xed objedn\xe1vky...",value:Kn.odeslani_storno_duvod||"",onChange:e=>xp("odeslani_storno_duvod",e.target.value),onBlur:e=>Rc("odeslani_storno_duvod",e.target.value),rows:3,style:{border:"1px solid #fca5a5",backgroundColor:"#fef2f2"}}),_o.odeslani_storno_duvod&&(0,ke.jsx)(Fd,{style:{marginTop:"0.5rem"},children:_o.odeslani_storno_duvod})]}),_o.datum_odeslani&&(0,ke.jsx)(Fd,{style:{marginTop:"0.5rem"},children:_o.datum_odeslani}),_o.datum_storna&&(0,ke.jsx)(Fd,{style:{marginTop:"0.5rem"},children:_o.datum_storna}),Kn.stav_odeslano?(0,ke.jsx)("div",{style:{marginTop:"1rem",padding:"0.75rem 1rem",backgroundColor:"#dcfce7",border:"1px solid #16a34a",borderRadius:"6px",color:"#166534",fontSize:"0.875rem"},children:(0,ke.jsx)("div",{style:{fontWeight:"600"},children:Kn.dt_odeslani&&Kn.odesilatel_id&&oa(Kn.stav_workflow_kod,"ODESLANA")?(0,ke.jsxs)(ke.Fragment,{children:["\u2705 Objedn\xe1vka byla odesl\xe1na",(0,ke.jsxs)("div",{style:{marginTop:"0.25rem",fontSize:"0.875rem",fontWeight:"normal"},children:[(0,ke.jsx)("strong",{children:"Datum odesl\xe1n\xed:"})," ",(()=>{const e=Kn.dt_odeslani.split(" ")[0],[n,a,o]=e.split("-");return"".concat(o,". ").concat(a,". ").concat(n)})()," \u2022 ",(0,ke.jsx)("strong",{children:"Odeslal:"})," ",Ws(Kn.odesilatel_id)]})]}):Kn.datum_odeslani?"\u2705 Objedn\xe1vka bude ozna\u010dena jako odeslan\xe1 dne ".concat((0,Ma.iS)(new Date(Kn.datum_odeslani))):"\u2705 Objedn\xe1vka bude ozna\u010dena jako odeslan\xe1 po ulo\u017een\xed"})}):Kn.stav_stornovano?(0,ke.jsx)("div",{style:{marginTop:"1rem",padding:"0.75rem 1rem",backgroundColor:"#fef2f2",border:"1px solid #f87171",borderRadius:"6px",color:"#991b1b",fontSize:"0.875rem"},children:(0,ke.jsx)("div",{style:{fontWeight:"600"},children:Kn.dt_odeslani&&Kn.odesilatel_id&&oa(Kn.stav_workflow_kod,"STORNOVANA")?(0,ke.jsxs)(ke.Fragment,{children:["\u274c Objedn\xe1vka byla stornov\xe1na",(0,ke.jsxs)("div",{style:{marginTop:"0.5rem",fontSize:"0.875rem",fontWeight:"normal"},children:[(0,ke.jsx)("strong",{children:"Datum stornov\xe1n\xed:"})," ",Kn.dt_odeslani," \u2022 ",(0,ke.jsx)("strong",{children:"Stornoval:"})," ",Ws(Kn.odesilatel_id)]}),Kn.odeslani_storno_duvod&&(0,ke.jsxs)("div",{style:{marginTop:"0.5rem",fontSize:"0.875rem",fontWeight:"normal"},children:[(0,ke.jsx)("strong",{children:"D\u016fvod stornov\xe1n\xed:"})," ",Kn.odeslani_storno_duvod]})]}):(0,ke.jsxs)(ke.Fragment,{children:["\u274c Objedn\xe1vka byla stornov\xe1na ",Kn.datum_storna?"dne ".concat((0,Ma.iS)(new Date(Kn.datum_storna))):"po ulo\u017een\xed",Kn.odeslani_storno_duvod&&(0,ke.jsxs)("div",{style:{marginTop:"0.5rem",fontSize:"0.875rem",fontWeight:"normal"},children:[(0,ke.jsx)("strong",{children:"D\u016fvod stornov\xe1n\xed:"})," ",Kn.odeslani_storno_duvod]})]})})}):null]})})})]}),($n||Gn>=2)&&oa(Kn.stav_workflow_kod,"SCHVALENA")&&!Kn.stav_odeslano&&!Kn.stav_stornovano&&(0,ke.jsxs)("div",{style:{margin:"2rem 0",padding:"1rem 1.25rem",backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"8px",color:"#92400e"},children:[(0,ke.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"\ud83d\udccb Objedn\xe1vka zat\xedm nebyla dokon\u010dena"}),(0,ke.jsx)("div",{style:{fontSize:"0.875rem"},children:'Za\u0161krtn\u011bte "Odesl\xe1no" kdy\u017e bude objedn\xe1vka skute\u010dn\u011b odesl\xe1na dodavateli, nebo "Stornov\xe1no" pokud se objedn\xe1vka nebude realizovat.'})]}),($n||Gn>=3)&&!Kn.stav_stornovano&&(0,ke.jsxs)(ke.Fragment,{children:[(()=>{const e=Gn>=4,n=oa(Kn.stav_workflow_kod,"ODESLANA")||oa(Kn.stav_workflow_kod,"POTVRZENA");return e&&n})()&&(0,ke.jsxs)(wd,{"data-section":"potvrzeni_objednavky",children:[(0,ke.jsxs)(Sd,{sectionTheme:Ji("potvrzeni_objednavky"),isActive:qi("potvrzeni_objednavky"),children:[(0,ke.jsxs)(Ed,{sectionTheme:Ji("potvrzeni_objednavky"),children:[(0,ke.jsx)(Cd,{sectionTheme:Ji("potvrzeni_objednavky"),children:(0,ke.jsx)(p.g,{icon:u.SGM})}),"Potvrzen\xed objedn\xe1vky dodavatelem",bs&&!Ts&&(0,ke.jsx)(Dd,{title:"Sekce z minul\xe9 f\xe1ze je uzam\u010dena (read-only historie). Odemknout m\u016f\u017ee administr\xe1tor nebo u\u017eivatel s pr\xe1vem ORDER_MANAGE.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,ke.jsxs)(Nd,{children:[bs&&!Ts&&ds&&(0,ke.jsx)(fl,{onClick:e=>{e.stopPropagation(),Hr(!0)},title:"Odemknout sekci Potvrzen\xed od dodavatele",children:(0,ke.jsx)(x,{})}),(0,ke.jsx)(Od,{collapsed:Je.potvrzeni_objednavky,sectionTheme:Ji("potvrzeni_objednavky"),onClick:()=>Lc("potvrzeni_objednavky"),style:{cursor:"pointer"},children:(0,ke.jsx)(p.g,{icon:u.w2A})})]})]}),(0,ke.jsxs)(Td,{collapsed:Je.potvrzeni_objednavky,"data-section":"potvrzeni_objednavky",children:[(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:"ANO"===(null===(Y=Kn.dodavatel_zpusob_potvrzeni)||void 0===Y?void 0:Y.potvrzeni)?"#f0fdf4":"#f9fafb",marginBottom:"1rem"},children:[(0,ke.jsx)("span",{style:{fontSize:"1rem",fontWeight:"500",color:"#374151"},children:"Dodavatel objedn\xe1vku potvrdil:"}),(0,ke.jsx)("div",{style:{display:"flex",gap:"1rem"},children:["ANO","NE"].map(e=>{var n,a;return(0,ke.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",border:"1px solid #e5e7eb",borderRadius:"6px",cursor:Ss?"not-allowed":"pointer",backgroundColor:(null===(n=Kn.dodavatel_zpusob_potvrzeni)||void 0===n?void 0:n.potvrzeni)===e?"#f0f9ff":"#fff",opacity:Ss?.6:1,fontWeight:"500"},children:[(0,ke.jsx)("input",{type:"radio",name:"potvrzeni_dodavatele",value:e,checked:(null===(a=Kn.dodavatel_zpusob_potvrzeni)||void 0===a?void 0:a.potvrzeni)===e,disabled:Ss,onChange:()=>{},onClick:e=>{var n,a;let o;o=(null===(n=Kn.dodavatel_zpusob_potvrzeni)||void 0===n?void 0:n.potvrzeni)===e.target.value?"":e.target.value;const r=(0,t.A)((0,t.A)({},Kn.dodavatel_zpusob_potvrzeni),{},{potvrzeni:o,zpusoby:"ANO"===o&&(null===(a=Kn.dodavatel_zpusob_potvrzeni)||void 0===a?void 0:a.zpusoby)||[],platba:"ANO"===o?"faktura":""});xp("dodavatel_zpusob_potvrzeni",r),"ANO"===o&&Ae?(xp("dodavatel_potvrdil_id",Ae),Bs("info","AKCEPTACE","dodavatel-potvrdil","Automaticky nastaven dodavatel_potvrdil_id: ".concat(Ae))):"ANO"!==o&&(xp("dodavatel_potvrdil_id",null),Bs("info","AKCEPTACE","dodavatel-reset","Vymaz\xe1n dodavatel_potvrdil_id (potvrzen\xed nen\xed ANO)"))},style:{cursor:"pointer"}}),e]},e)})})]}),"ANO"===(null===(X=Kn.dodavatel_zpusob_potvrzeni)||void 0===X?void 0:X.potvrzeni)&&(0,ke.jsx)(ke.Fragment,{children:(0,ke.jsxs)(Ld,{children:[(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"Zp\u016fsob potvrzen\xed"}),(0,ke.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginTop:"0.5rem"},children:[{value:"email",label:"E-mail"},{value:"telefon",label:"Telefon\xe1t"},{value:"podepsana_objednavka",label:"Podepsan\xe1 objedn\xe1vka"},{value:"eshop",label:"e-Shop"}].map(e=>{var n,a;const o=!!Array.isArray(null===(n=Kn.dodavatel_zpusob_potvrzeni)||void 0===n?void 0:n.zpusoby)&&Kn.dodavatel_zpusob_potvrzeni.zpusoby.includes(e.value),r="ANO"!==(null===(a=Kn.dodavatel_zpusob_potvrzeni)||void 0===a?void 0:a.potvrzeni)||Ss||rt||Zt,i=!!_o.dodavatel_zpusob_potvrzeni;return(0,ke.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",border:i?"2px solid #dc2626":"1px solid #e5e7eb",borderRadius:"6px",cursor:r?"not-allowed":"pointer",backgroundColor:o?"#f0f9ff":"#fff",opacity:r?.5:1},children:[(0,ke.jsx)("input",{type:"checkbox",checked:o,disabled:r,onChange:n=>{var a;const o=Array.isArray(null===(a=Kn.dodavatel_zpusob_potvrzeni)||void 0===a?void 0:a.zpusoby)?Kn.dodavatel_zpusob_potvrzeni.zpusoby:[];let r;r=n.target.checked?[...o,e.value]:o.filter(n=>n!==e.value);const i=(0,t.A)((0,t.A)({},Kn.dodavatel_zpusob_potvrzeni),{},{zpusoby:r}),s=(new Date).toISOString();Wn(e=>(0,t.A)((0,t.A)({},e),{},{dodavatel_zpusob_potvrzeni:i,dt_akceptace:r.length>0?s:""})),_a(!0)},style:{cursor:"pointer"}}),e.label]},e.value)})}),_o.dodavatel_zpusob_potvrzeni&&(0,ke.jsx)("div",{style:{color:"#dc2626",fontSize:"0.875rem",marginTop:"0.5rem",fontWeight:"500"},children:_o.dodavatel_zpusob_potvrzeni})]}),(0,ke.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:["ANO"===(null===(Q=Kn.dodavatel_zpusob_potvrzeni)||void 0===Q?void 0:Q.potvrzeni)&&(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"Datum akceptace"}),(0,ke.jsx)(wc,{fieldName:"dt_akceptace",value:Kn.dt_akceptace,onChange:e=>xp("dt_akceptace",e),onBlur:e=>Rc("dt_akceptace",e),disabled:Ss||rt||Zt,hasError:!!_o.dt_akceptace,placeholder:"Vyberte datum..."}),_o.dt_akceptace&&(0,ke.jsx)("div",{style:{color:"#dc2626",fontSize:"0.875rem",marginTop:"0.5rem",fontWeight:"500"},children:_o.dt_akceptace})]}),(0,ke.jsxs)(Vd,{style:{marginTop:"calc(2.5rem + 2px)"},children:[(0,ke.jsx)(Md,{required:!0,children:"Zp\u016fsob platby"}),(0,ke.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginTop:"0.5rem"},children:(0,ke.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",border:"1px solid #e5e7eb",borderRadius:"6px",cursor:"default",backgroundColor:"#f0f9ff",marginTop:"2px"},children:[(0,ke.jsx)("input",{type:"radio",name:"platba_dodavatel",value:"faktura",checked:!0,disabled:Ss||rt||Zt,readOnly:!0,style:{cursor:"default"}}),"Faktura"]})}),_o.zpusob_platby&&(0,ke.jsx)("div",{style:{color:"#dc2626",fontSize:"0.875rem",marginTop:"0.5rem",fontWeight:"500"},children:_o.zpusob_platby})]})]})]})}),"ANO"===(null===(ee=Kn.dodavatel_zpusob_potvrzeni)||void 0===ee?void 0:ee.potvrzeni)&&(null===(ne=Kn.dodavatel_zpusob_potvrzeni)||void 0===ne||null===(ae=ne.zpusoby)||void 0===ae?void 0:ae.length)>0&&(null===(oe=Kn.dodavatel_zpusob_potvrzeni)||void 0===oe?void 0:oe.platba)&&!Kn.stav_odeslano&&Gn<4&&(0,ke.jsxs)("div",{style:{backgroundColor:"#f0f9ff",border:"1px solid #bfdbfe",borderRadius:"8px",padding:"1rem",marginTop:"1rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsx)(p.g,{icon:u.iW_,style:{color:"#3b82f6",fontSize:"1rem"}}),(0,ke.jsx)("span",{style:{fontSize:"0.875rem",color:"#1e40af"},children:"Po vypln\u011bn\xed \xfadaj\u016f o dodavateli budou dostupn\xe9 dal\u0161\xed sekce."})]}),Kn.dt_akceptace&&(0,ke.jsxs)("div",{style:{fontSize:"0.875rem",color:"#1e40af",marginTop:"0.25rem"},children:[(0,ke.jsx)("strong",{children:"Datum potvrzen\xed:"})," ",(0,Ma.iS)(Kn.dt_akceptace),Kn.dodavatel_potvrdil_id&&(0,ke.jsxs)("div",{style:{marginTop:"0.25rem"},children:[(0,ke.jsx)("strong",{children:"Potvrdil:"})," ",Ws(Kn.dodavatel_potvrdil_id)]})]})]})]})}),oa(Kn.stav_workflow_kod,"POTVRZENA")&&Kn.dodavatel_potvrdil_id&&Kn.dt_akceptace?(0,ke.jsxs)("div",{style:{backgroundColor:"#dcfce7",border:"1px solid #16a34a",borderRadius:"6px",padding:"1rem",marginTop:"1rem",color:"#166534",fontSize:"0.875rem"},children:[(0,ke.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.25rem"},children:"\u2705 Dodavatel potvrdil objedn\xe1vku"}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("strong",{children:"Datum potvrzen\xed:"})," ",(0,Ma.iS)(Kn.dt_akceptace)," \u2022 ",(0,ke.jsx)("strong",{children:"Potvrdil:"})," ",Ws(Kn.dodavatel_potvrdil_id)]}),((null===(te=Kn.dodavatel_zpusob_potvrzeni)||void 0===te||null===(re=te.zpusoby)||void 0===re?void 0:re.length)>0||(null===(ie=Kn.dodavatel_zpusob_potvrzeni)||void 0===ie?void 0:ie.platba))&&(0,ke.jsxs)("div",{children:[(null===(se=Kn.dodavatel_zpusob_potvrzeni)||void 0===se||null===(de=se.zpusoby)||void 0===de?void 0:de.length)>0&&(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsx)("strong",{children:"Zp\u016fsob potvrzen\xed:"})," ",Kn.dodavatel_zpusob_potvrzeni.zpusoby.map(e=>({email:"E-mail",telefon:"Telefon\xe1t",podepsana_objednavka:"Podepsan\xe1 objedn\xe1vka",eshop:"e-Shop"}[e]||e)).join(", ")]}),(null===(le=Kn.dodavatel_zpusob_potvrzeni)||void 0===le||null===(fe=le.zpusoby)||void 0===fe?void 0:fe.length)>0&&(null===(he=Kn.dodavatel_zpusob_potvrzeni)||void 0===he?void 0:he.platba)&&" \u2022 ",(null===(ye=Kn.dodavatel_zpusob_potvrzeni)||void 0===ye?void 0:ye.platba)&&(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsx)("strong",{children:"Platba:"})," ","faktura"===Kn.dodavatel_zpusob_potvrzeni.platba?"Fakturou":"hotove"===Kn.dodavatel_zpusob_potvrzeni.platba?"Hotov\u011b (pokladna)":Kn.dodavatel_zpusob_potvrzeni.platba]})]})]}):(0,ke.jsxs)("div",{style:{backgroundColor:"#dbeafe",border:"2px solid #3b82f6",borderRadius:"8px",padding:"1rem",marginTop:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsx)(p.g,{icon:u.iW_,style:{color:"#3b82f6",fontSize:"1.25rem"}}),(0,ke.jsxs)("div",{style:{flex:1},children:[(0,ke.jsx)("div",{style:{fontWeight:"600",color:"#1e40af",marginBottom:"0.25rem"},children:"\u2139\ufe0f \u010cek\xe1 se na potvrzen\xed dodavatelem"}),(0,ke.jsx)("div",{style:{fontSize:"0.875rem",color:"#1e40af"},children:"Po potvrzen\xed objedn\xe1vky dodavatelem se zde zobraz\xed \xfadaje o potvrzen\xed."})]})]})]})]}),ms.visible&&(0,ke.jsxs)(wd,{"data-section":"registr_smluv",children:[(0,ke.jsxs)(Sd,{sectionTheme:Ji("registr_smluv"),isActive:qi("registr_smluv"),children:[(0,ke.jsxs)(Ed,{sectionTheme:Ji("registr_smluv"),children:[(0,ke.jsx)(Cd,{sectionTheme:Ji("registr_smluv"),children:(0,ke.jsx)(p.g,{icon:u.IJd})}),(0,ke.jsx)("span",{children:"Rozhodnut\xed o zve\u0159ejn\u011bn\xed v registru smluv"}),ks&&!Ts&&(0,ke.jsx)(Dd,{title:Kn.dt_zverejneni&&Kn.registr_iddt&&Kn.ma_byt_zverejnena?"Registr je zve\u0159ejn\u011bn a zam\u010den. Odemknout m\u016f\u017ee pouze u\u017eivatel s opr\xe1vn\u011bn\xedm ORDER_PUBLISH_REGISTRY.":!1===Kn.ma_byt_zverejnena&&Gn>=6?"Registr nen\xed k zve\u0159ejn\u011bn\xed a je zam\u010den. Odemknout m\u016f\u017ee pouze u\u017eivatel s opr\xe1vn\u011bn\xedm ORDER_PUBLISH_REGISTRY.":"Registr je zam\u010den. Odemknout m\u016f\u017ee pouze u\u017eivatel s opr\xe1vn\u011bn\xedm ORDER_PUBLISH_REGISTRY.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,ke.jsxs)(Nd,{children:[ks&&!Ts&&as&&(0,ke.jsx)(fl,{onClick:e=>{e.stopPropagation(),Br(!0)},title:"Odemknout sekci Registr smluv",children:(0,ke.jsx)(x,{})}),(0,ke.jsx)(Od,{collapsed:Je.registr_smluv,sectionTheme:Ji("registr_smluv"),onClick:()=>Lc("registr_smluv"),style:{cursor:"pointer"},children:(0,ke.jsx)(p.g,{icon:u.w2A})})]})]}),(0,ke.jsxs)(Td,{collapsed:Je.registr_smluv,children:[(0,ke.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,ke.jsx)(Md,{style:{marginBottom:"0.5rem"},children:"Zve\u0159ejn\u011bn\xed"}),(0,ke.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.625rem 1rem",backgroundColor:Kn.ma_byt_zverejnena?"#dcfce7":"#fff",border:Kn.ma_byt_zverejnena?"2px solid #16a34a":"2px solid #e5e7eb",borderRadius:"8px",cursor:ks?"not-allowed":"pointer",fontSize:"0.95rem",fontWeight:"500",color:Kn.ma_byt_zverejnena?"#166534":"#374151",opacity:ks?.6:1,minHeight:"44px",boxSizing:"border-box"},children:[(0,ke.jsx)("input",{type:"checkbox",checked:Kn.ma_byt_zverejnena||!1,onChange:e=>{ks||(!e.target.checked&&Kn.ma_byt_zverejnena&&Ks>=5e4?Jr(!0):xp("ma_byt_zverejnena",e.target.checked))},disabled:ks,style:{width:"18px",height:"18px",cursor:ks?"not-allowed":"pointer",flexShrink:0}}),(0,ke.jsx)("span",{style:{flex:1},children:Gn>=5?"Objedn\xe1vka m\xe1 b\xfdt zve\u0159ejn\u011bna v registru smluv":"M\xe1 b\xfdt zve\u0159ejn\u011bna"})]}),(0,ke.jsx)("div",{style:{marginTop:"0.75rem",padding:"0.75rem 1rem",backgroundColor:Ks>=5e4?"#dbeafe":"#f3f4f6",border:"1px solid ".concat(Ks>=5e4?"#3b82f6":"#d1d5db"),borderRadius:"6px",fontSize:"0.875rem",color:Ks>=5e4?"#1e40af":"#6b7280"},children:(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.5rem"},children:[(0,ke.jsx)(p.g,{icon:u.iW_,style:{fontSize:"1rem",marginTop:"0.125rem",flexShrink:0}}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.25rem"},children:Ks>=5e4?"Povinn\xe9 zve\u0159ejn\u011bn\xed":"Voliteln\xe9 zve\u0159ejn\u011bn\xed"}),(0,ke.jsx)("div",{children:Ks>=5e4?(0,ke.jsxs)(ke.Fragment,{children:["Celkov\xe1 cena ",(0,ke.jsxs)("strong",{children:[Ks.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d bez DPH"]})," je nad limitem 50 000 K\u010d. Objedn\xe1vka ",(0,ke.jsx)("strong",{children:"mus\xed b\xfdt zve\u0159ejn\u011bna"})," v registru smluv podle z\xe1kona."]}):(0,ke.jsxs)(ke.Fragment,{children:["Celkov\xe1 cena ",(0,ke.jsxs)("strong",{children:[Ks.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d bez DPH"]})," je pod limitem 50 000 K\u010d. Zve\u0159ejn\u011bn\xed v registru smluv je voliteln\xe9."]})})]})]})})]}),($n||4===Gn)&&(0,ke.jsx)(ke.Fragment,{children:!Kn.ma_byt_zverejnena&&Ks<5e4&&(0,ke.jsx)("div",{style:{padding:"1rem",backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"6px",fontSize:"0.875rem",color:"#92400e"},children:"\u2139\ufe0f Po ulo\u017een\xed s od\u0161krtnut\xfdm checkboxem se p\u0159esko\u010d\xed vypl\u0148ov\xe1n\xed registru smluv a pokra\u010duje se p\u0159\xedmo k fakturaci."})})]})]}),(()=>{const e=Kn.dt_zverejneni&&Kn.registr_iddt;return fs.visible&&!as&&!e&&(0,ke.jsxs)("div",{style:{margin:"2rem 0",padding:"1rem 1.25rem",backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"8px",color:"#92400e"},children:[(0,ke.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"\ud83d\udd12 Zve\u0159ejn\u011bn\xed v registru smluv"}),(0,ke.jsx)("div",{style:{fontSize:"0.875rem"},children:"Objedn\xe1vka \u010dek\xe1 na zve\u0159ejn\u011bn\xed v registru smluv. Tuto akci m\u016f\u017ee prov\xe9st pouze u\u017eivatel s opr\xe1vn\u011bn\xedm pro spr\xe1vu registru."})]})})(),(()=>{const e=Kn.dt_zverejneni&&Kn.registr_iddt;return fs.visible&&(as||e)&&(0,ke.jsxs)(wd,{"data-section":"registr_smluv_vyplneni",children:[(0,ke.jsxs)(Sd,{sectionTheme:Ji("registr_smluv_vyplneni"),isActive:qi("registr_smluv_vyplneni"),children:[(0,ke.jsxs)(Ed,{sectionTheme:Ji("registr_smluv_vyplneni"),children:[(0,ke.jsx)(Cd,{sectionTheme:Ji("registr_smluv_vyplneni"),children:(0,ke.jsx)(p.g,{icon:u.IJd})}),(0,ke.jsx)("span",{children:"Potvrzen\xed zve\u0159ejn\u011bn\xed objedn\xe1vky v registru smluv"}),hs&&!Ts&&(0,ke.jsx)(Dd,{title:"Registr je zam\u010den. Odemknout m\u016f\u017ee pouze u\u017eivatel s opr\xe1vn\u011bn\xedm ORDER_PUBLISH_REGISTRY.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,ke.jsxs)(Nd,{children:[hs&&!Ts&&as&&(0,ke.jsx)(fl,{onClick:e=>{e.stopPropagation(),Br(!0)},title:"Odemknout sekci Registr smluv",children:(0,ke.jsx)(x,{})}),(0,ke.jsx)(Od,{collapsed:Je.registr_smluv_vyplneni,sectionTheme:Ji("registr_smluv_vyplneni"),onClick:()=>Lc("registr_smluv_vyplneni"),style:{cursor:"pointer"},children:(0,ke.jsx)(p.g,{icon:u.w2A})})]})]}),(0,ke.jsxs)(Td,{collapsed:Je.registr_smluv_vyplneni,children:[(0,ke.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"300px 1fr 1fr",gap:"1.5rem",alignItems:"start"},children:[(0,ke.jsxs)("div",{children:[(0,ke.jsx)(Md,{style:{marginBottom:"0.5rem"},children:"Zve\u0159ejn\u011bn\xed"}),(0,ke.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.625rem 1rem",backgroundColor:Kn.ma_byt_zverejnena?"#dcfce7":"#fff",border:Kn.ma_byt_zverejnena?"2px solid #16a34a":"2px solid #e5e7eb",borderRadius:"8px",cursor:hs?"not-allowed":"pointer",fontSize:"0.95rem",fontWeight:"500",color:Kn.ma_byt_zverejnena?"#166534":"#374151",opacity:hs?.6:1,minHeight:"44px",boxSizing:"border-box"},children:[(0,ke.jsx)("input",{type:"checkbox",checked:Kn.ma_byt_zverejnena||!1,onChange:e=>{hs||(!e.target.checked&&Kn.ma_byt_zverejnena&&Ks>=5e4?Jr(!0):xp("ma_byt_zverejnena",e.target.checked))},disabled:hs,style:{width:"18px",height:"18px",cursor:hs?"not-allowed":"pointer",flexShrink:0}}),(0,ke.jsx)("span",{style:{flex:1,whiteSpace:"nowrap"},children:"M\xe1 b\xfdt zve\u0159ejn\u011bna"})]})]}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)(Md,{required:Kn.ma_byt_zverejnena,children:"Datum zve\u0159ejn\u011bn\xed (VZ)"}),(0,ke.jsx)(wc,{fieldName:"dt_zverejneni",value:Kn.dt_zverejneni,onChange:e=>{if(xp("dt_zverejneni",e),e&&!Kn.zverejnil_id){const e=localStorage.getItem("user_id");e&&xp("zverejnil_id",parseInt(e,10))}},onBlur:e=>Rc("dt_zverejneni",e),disabled:!Kn.ma_byt_zverejnena||hs,hasError:!!_o.dt_zverejneni,placeholder:"Vyberte datum..."}),_o.dt_zverejneni&&(0,ke.jsx)(Fd,{style:{marginTop:"0.5rem"},children:_o.dt_zverejneni})]}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)(Md,{required:Kn.ma_byt_zverejnena,children:"Identifik\xe1tor"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(p.g,{icon:u.CYF}),(0,ke.jsx)(Wd,{type:"text",name:"registr_iddt",value:Kn.registr_iddt||"",onChange:e=>{if(xp("registr_iddt",e.target.value),e.target.value&&!Kn.zverejnil_id){const e=localStorage.getItem("user_id");e&&xp("zverejnil_id",parseInt(e,10))}},disabled:!Kn.ma_byt_zverejnena||hs,hasError:!!_o.registr_iddt,hasIcon:!0,placeholder:"Zadejte identifik\xe1tor..."})]}),_o.registr_iddt&&(0,ke.jsx)(Fd,{style:{marginTop:"0.5rem"},children:_o.registr_iddt})]})]}),!Kn.ma_byt_zverejnena&&(0,ke.jsxs)("div",{style:{padding:"0.875rem 1rem",backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"6px",fontSize:"0.875rem",color:"#92400e",marginTop:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsx)(p.g,{icon:u.iW_,style:{fontSize:"1rem"}}),(0,ke.jsx)("div",{children:(0,ke.jsx)("strong",{children:"Objedn\xe1vka nebude zve\u0159ejn\u011bna v registru smluv."})})]}),oa(Kn.stav_workflow_kod,"UVEREJNENA")&&(0,ke.jsxs)("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#dcfce7",border:"1px solid #16a34a",borderRadius:"6px",fontSize:"0.875rem",color:"#166534"},children:[(0,ke.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.25rem"},children:"\u2705 Objedn\xe1vka byla zve\u0159ejn\u011bna v registru smluv"}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("strong",{children:"Datum zve\u0159ejn\u011bn\xed:"})," ",(0,Ma.iS)(Kn.dt_zverejneni)," \u2022 ",(0,ke.jsx)("strong",{children:"Zve\u0159ejnil:"})," ",Ws(Kn.zverejnil_id),Kn.registr_iddt&&(0,ke.jsxs)(ke.Fragment,{children:[" \u2022 ",(0,ke.jsx)("strong",{children:"ID registru:"})," ",Kn.registr_iddt]})]})]})]})]})})(),((e,n,a)=>{const o="pokladna"===(null===(e=Kn.financovani)||void 0===e?void 0:e.platba),r="pokladna"===(null===(n=Kn.dodavatel_zpusob_potvrzeni)||void 0===n?void 0:n.platba),i=o||r,s=Kn.faktury&&Kn.faktury.length>0,d=!i&&(os?Gn>=6:Gn>=7||s),l="(po\u010det: ".concat((null===(a=Kn.faktury)||void 0===a?void 0:a.length)||0,")");return d?(0,ke.jsxs)(wd,{"data-section":"fakturace",children:[(0,ke.jsxs)(Sd,{sectionTheme:"section-invoice",isActive:!0,style:{background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",borderColor:"#2563eb"},children:[(0,ke.jsxs)(Ed,{sectionTheme:"section-invoice",style:{color:"#fff"},children:[(0,ke.jsx)(Cd,{sectionTheme:"section-invoice",style:{color:"#fff"},children:(0,ke.jsx)(p.g,{icon:u.$O8})}),"Fakturace k objedn\xe1vce",(0,ke.jsx)("span",{style:{fontSize:"0.75rem",marginLeft:"0.5rem",fontWeight:"400",opacity:.9},children:l}),Cs&&!Ts&&(0,ke.jsx)(Dd,{title:"Sekce je zam\u010dena. Odemknout m\u016f\u017ee administr\xe1tor nebo u\u017eivatel s pr\xe1vem ORDER_MANAGE.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,ke.jsxs)(Nd,{children:[Cs&&!Ts&&os&&(0,ke.jsx)(fl,{onClick:e=>{e.stopPropagation(),qr(!0)},title:"Odemknout sekci Fakturace",children:(0,ke.jsx)(x,{})}),(0,ke.jsx)(Od,{collapsed:Je.fakturace,onClick:()=>Lc("fakturace"),style:{color:"#fff",cursor:"pointer"},children:(0,ke.jsx)(p.g,{icon:u.w2A})})]})]}),(0,ke.jsx)(Td,{collapsed:Je.fakturace,children:(0,ke.jsx)("div",{children:i?(0,ke.jsxs)("div",{style:{padding:"1.5rem"},children:[(()=>{if((!Kn.faktury||0===Kn.faktury.length)&&!ni){const e=Qs(new Date),n={id:"temp-pokladna-".concat(Date.now()),objednavka_id:Kn.id,fa_datum_doruceni:e,fa_dorucena:1,fa_castka:null,fa_cislo_vema:"",fa_strediska_kod:Kn.strediska_kod||[],fa_splatnost:null,fa_poznamka:"",vytvoril_uzivatel_id:Ae,vytvoril_jmeno:Ws(Ae),dt_vytvoreni:(new Date).toISOString(),dt_aktualizace:null,aktivni:1,_isNew:!0,_isPokladna:!0,attachments:[]};setTimeout(()=>{Fs([n])},0)}return null})(),(0,ke.jsxs)("div",{style:{background:"#f8fafc",border:"2px solid #e2e8f0",borderRadius:"8px",padding:"2rem"},children:[(0,ke.jsx)("div",{style:{fontSize:"2.5rem",marginBottom:"1rem",textAlign:"center",color:"#64748b"},children:"\ud83d\udcc4"}),(0,ke.jsx)("div",{style:{fontSize:"1.125rem",fontWeight:"500",color:"#334155",marginBottom:"0.5rem",textAlign:"center"},children:"P\u0159\xedlohy doklad\u016f z pokladny"}),(0,ke.jsx)("div",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"1.5rem",textAlign:"center"},children:"Nahrajte paragony, pokladn\xed doklady a dal\u0161\xed dokumenty k platb\u011b"}),Kn.faktury&&Kn.faktury.length>0&&Kn.faktury[0]&&(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsx)(ue.r6,{fakturaId:Kn.faktury[0].id,objednavkaId:Kn.id,fakturaTypyPrilohOptions:Ui,readOnly:Os,onISDOCParsed:$s,formData:Kn,faktura:Kn.faktury[0],validateInvoiceForAttachments:Js,isPokladna:!0,attachments:Kn.faktury[0].attachments||[],onAttachmentsChange:e=>{Gs(Kn.faktury[0].id,e)},onAttachmentUploaded:e=>{Ys(Kn.faktury[0].id,e)},onCreateInvoiceInDB:qs},"pokladna-attachments-".concat(Kn.faktury[0].id,"-").concat(Kn.id)),(0,ke.jsx)(Ld,{style:{marginTop:"1.5rem"},children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsxs)(Md,{children:["Pozn\xe1mka k platb\u011b",(0,ke.jsx)("span",{style:{fontSize:"0.75rem",color:"#64748b",fontWeight:"normal",marginLeft:"0.5rem"},children:"(Voliteln\xe9)"})]}),(0,ke.jsx)(Hd,{value:Kn.faktury[0].fa_poznamka||"",onChange:e=>{const n=Kn.faktury.map((n,a)=>0===a?(0,t.A)((0,t.A)({},n),{},{fa_poznamka:e.target.value}):n);Fs(n)},disabled:Os,placeholder:"Nap\u0159.: Platba za materi\xe1l, paragony ze dne 1.11.2025, apod.",rows:3})]})})]}),(0,ke.jsxs)("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"6px",fontSize:"0.875rem",color:"#92400e",textAlign:"left"},children:[(0,ke.jsx)("strong",{children:"\u2139\ufe0f Pozn\xe1mka:"})," P\u0159i platb\u011b pokladnou nen\xed nutn\xe9 vypl\u0148ovat \u010d\xedsla faktur ani \u010d\xe1stky. Sta\u010d\xed nahr\xe1t paragony nebo pokladn\xed doklady jako p\u0159\xedlohy a p\u0159\xedpadn\u011b doplnit pozn\xe1mku."]})]})]}):(0,ke.jsxs)(ke.Fragment,{children:[(()=>{if((!Kn.faktury||0===Kn.faktury.length)&&!ni){const e=Qs(new Date),n={id:"temp-".concat(Date.now()),objednavka_id:Kn.id,fa_datum_doruceni:e,fa_dorucena:1,fa_castka:"",fa_cislo_vema:"",fa_strediska_kod:Kn.strediska_kod||[],fa_splatnost:"",fa_poznamka:"",vytvoril_uzivatel_id:Ae,vytvoril_jmeno:Ws(Ae),dt_vytvoreni:(new Date).toISOString(),dt_aktualizace:null,aktivni:1,_isNew:!0,attachments:[]};setTimeout(()=>{Fs([n])},0)}return null})(),ni?(0,ke.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#64748b"},children:"Na\u010d\xedt\xe1n\xed faktur..."}):(0,ke.jsxs)("div",{style:{marginTop:"1.5rem"},children:[Kn.faktury&&0!==Kn.faktury.length?Kn.faktury.map((e,n)=>{var a,o;const r=(null===ai||void 0===ai?void 0:ai.id)===e.id,i=r?ti:e,s=1===e.vecna_spravnost_potvrzeno;return(0,ke.jsxs)("div",{style:{border:"2px solid #3b82f6",borderRadius:"12px",padding:"0",marginBottom:"1.5rem",background:r?"#f0f9ff":s?"#f0fdf4":"#ffffff",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08)",overflow:"visible"},children:[(0,ke.jsxs)("div",{style:{background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",color:"white",padding:"1rem 1.25rem",fontWeight:"700",fontSize:"1.1rem",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"1rem",borderBottom:"3px solid #1e40af",letterSpacing:"0.5px",textTransform:"uppercase"},children:[(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,ke.jsx)(p.g,{icon:u.$O8,style:{fontSize:"1.2rem"}}),"Faktura #",n+1,0===n&&(0,ke.jsx)("span",{style:{color:"#fef3c7",fontSize:"1.3rem"},children:"*"}),e.fa_cislo_vema&&(0,ke.jsx)("span",{style:{fontWeight:"600",fontSize:"0.9rem",background:"rgba(255, 255, 255, 0.2)",padding:"0.25rem 0.75rem",borderRadius:"6px",letterSpacing:"normal",textTransform:"none"},children:e.fa_cislo_vema}),(0,ke.jsxs)(Mc,{children:[(0,ke.jsx)(Uc,{className:"help-icon",children:(0,ke.jsx)(h.A,{})}),(0,ke.jsxs)(Zc,{className:"tooltip-bubble",children:[e._isdoc_dodavatel&&(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsxs)(Kc,{children:[(0,ke.jsx)(Bc,{children:"Vystavil:"}),(0,ke.jsxs)(Wc,{style:{display:"flex",alignItems:"center",gap:"6px",fontWeight:"600"},children:[e._isdoc_dodavatel.nazev||"---",e._isdoc_dodavatel.nazev&&(0,ke.jsx)(L,{size:14,style:{cursor:"pointer",color:"#6b7280"},onClick:()=>{navigator.clipboard.writeText(e._isdoc_dodavatel.nazev),je&&je("N\xe1zev zkop\xedrov\xe1n",{type:"success"})},title:"Zkop\xedrovat n\xe1zev"})]})]}),(0,ke.jsxs)(Kc,{children:[(0,ke.jsx)(Bc,{children:"I\u010cO:"}),(0,ke.jsxs)(Wc,{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e._isdoc_dodavatel.ico||"---",e._isdoc_dodavatel.ico&&(0,ke.jsx)(L,{size:14,style:{cursor:"pointer",color:"#6b7280"},onClick:()=>{navigator.clipboard.writeText(e._isdoc_dodavatel.ico),je&&je("I\u010cO zkop\xedrov\xe1no",{type:"success"})},title:"Zkop\xedrovat I\u010cO"})]})]}),(0,ke.jsx)("div",{style:{borderTop:"1px solid #e5e7eb",margin:"8px 0"}})]}),e._isdoc_email&&(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsxs)(Kc,{children:[(0,ke.jsx)(Bc,{children:"Sm\u011brov\xe1no na:"}),(0,ke.jsxs)(Wc,{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e._isdoc_email,(0,ke.jsx)(L,{size:14,style:{cursor:"pointer",color:"#6b7280"},onClick:()=>{navigator.clipboard.writeText(e._isdoc_email),je&&je("Email zkop\xedrov\xe1n",{type:"success"})},title:"Zkop\xedrovat email"})]})]}),(0,ke.jsx)("div",{style:{borderTop:"1px solid #e5e7eb",margin:"8px 0"}})]}),(0,ke.jsxs)(Kc,{children:[(0,ke.jsx)(Bc,{children:"\u010c\xedslo faktury:"}),(0,ke.jsx)(Wc,{children:e.fa_cislo_vema||"---"})]}),(0,ke.jsxs)(Kc,{children:[(0,ke.jsx)(Bc,{children:"\u010c\xe1stka:"}),(0,ke.jsx)(Wc,{children:e.fa_castka?"".concat(parseFloat(e.fa_castka).toLocaleString("cs-CZ")," K\u010d"):"---"})]}),(0,ke.jsxs)(Kc,{children:[(0,ke.jsx)(Bc,{children:"Datum vystaven\xed:"}),(0,ke.jsx)(Wc,{children:e.fa_datum_vystaveni?(0,Ma.iS)(e.fa_datum_vystaveni):"---"})]}),(0,ke.jsxs)(Kc,{children:[(0,ke.jsx)(Bc,{children:"Datum splatnosti:"}),(0,ke.jsx)(Wc,{children:e.fa_datum_splatnosti||e.fa_splatnost?(0,Ma.iS)(e.fa_datum_splatnosti||e.fa_splatnost):"---"})]}),(0,ke.jsxs)(Kc,{children:[(0,ke.jsx)(Bc,{children:"Datum doru\u010den\xed:"}),(0,ke.jsx)(Wc,{children:e.fa_datum_doruceni?(0,Ma.iS)(e.fa_datum_doruceni):"---"})]}),(0,ke.jsxs)(Kc,{children:[(0,ke.jsx)(Bc,{children:"V\u011bcn\xe1 spr\xe1vnost:"}),(0,ke.jsxs)(Wc,{children:["ANO"===e.vecna_spravnost_potvrzeno&&(0,ke.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:"#d1fae5",color:"#065f46",padding:"2px 8px",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600"},children:[(0,ke.jsx)(p.g,{icon:u.SGM}),"ANO"]}),"NE"===e.vecna_spravnost_potvrzeno&&(0,ke.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:"#fee2e2",color:"#991b1b",padding:"2px 8px",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600"},children:[(0,ke.jsx)(p.g,{icon:u.s0Q}),"NE"]}),!e.vecna_spravnost_potvrzeno&&(0,ke.jsx)("span",{style:{color:"#9ca3af",fontSize:"0.875rem"},children:"Neov\u011b\u0159eno"})]})]}),e.vecna_spravnost_umisteni_majetku&&(0,ke.jsxs)(Kc,{children:[(0,ke.jsx)(Bc,{children:"Um\xedst\u011bn\xed majetku:"}),(0,ke.jsx)(Wc,{children:e.vecna_spravnost_umisteni_majetku})]}),e.vecna_spravnost_poznamka&&(0,ke.jsxs)(Kc,{children:[(0,ke.jsx)(Bc,{children:"Pozn\xe1mka VS:"}),(0,ke.jsx)(Wc,{children:e.vecna_spravnost_poznamka})]}),(0,ke.jsxs)(Kc,{children:[(0,ke.jsx)(Bc,{children:"St\u0159ediska:"}),(0,ke.jsx)(Wc,{title:(()=>{const n=e.fa_strediska_kod;return n?Array.isArray(n)?n.map(e=>"object"===typeof e&&(e.label||e.nazev||e.value||e.kod)||e).filter(Boolean).join(", ")||"---":"string"===typeof n&&n||"---":"---"})(),children:(()=>{const n=e.fa_strediska_kod;return n?Array.isArray(n)?n.map(e=>"object"===typeof e&&(e.label||e.nazev||e.value||e.kod)||e).filter(Boolean).join(", ")||"---":"string"===typeof n&&n||"---":"---"})()})]})]})]})]}),(0,ke.jsx)("div",{style:{display:"flex",gap:"0.5rem"},children:(0,ke.jsx)("button",{type:"button",disabled:Os,onClick:()=>{if(e._isNew){const n=Array.isArray(Kn.faktury)?Kn.faktury:[];if(Fs(n.filter(n=>n.id!==e.id)),r){oi(null);const e=Ms.toString(),n=Qs(new Date);ri({fa_datum_doruceni:n,fa_dorucena:1,fa_castka:e,fa_cislo_vema:"",fa_strediska_kod:Kn.strediska_kod||[],fa_poznamka:"",fa_splatnost:""})}}else(async e=>{var n;const a=null===(n=Kn.faktury)||void 0===n?void 0:n.find(n=>n.id===e);if(!a)return;let o=0;if(e&&!String(e).startsWith("temp-"))try{var t;const n=await(0,Ia.CX)(e,we,Se,Kn.id);o=((null===(t=n.data)||void 0===t?void 0:t.attachments)||n.data||[]).length}catch(r){}lo({isOpen:!0,fakturaId:e,fakturaNazev:a.fa_cislo_vema||"Faktura ".concat(a.id),pocetPriloh:o})})(e.id)},title:"Smazat fakturu",style:{background:Os?"rgba(255,255,255,0.3)":"rgba(220, 38, 38, 0.9)",color:"white",border:"1px solid rgba(255,255,255,0.5)",borderRadius:"6px",padding:"0.4rem",cursor:Os?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",opacity:Os?.6:1,transition:"all 0.2s ease"},children:(0,ke.jsx)(P,{size:16})})})]}),(0,ke.jsxs)("div",{style:{padding:"1.25rem"},children:[(0,ke.jsxs)(Ld,{style:{gridTemplateColumns:"280px 1fr 1fr"},children:[(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"Datum doru\u010den\xed"}),(0,ke.jsx)(wc,{fieldName:"fa_".concat(n+1,"_datum_doruceni"),value:null!==(a=e.fa_datum_doruceni)&&void 0!==a?a:e._isNew?Qs(new Date):"",hasError:!!_o["faktura_".concat(n+1,"_datum_doruceni")],disabled:Os,onChange:n=>{const a=Kn.faktury.map(a=>a.id===e.id?(0,t.A)((0,t.A)({},a),{},{fa_datum_doruceni:n,fa_dorucena:n?1:0,_isNew:!1}):a);Fs(a)},placeholder:"Vyberte datum doru\u010den\xed"})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"Variabiln\xed symbol"}),(0,ke.jsxs)(Bd,{hasIcon:!0,children:[(0,ke.jsx)(p.g,{icon:u.CYF}),(0,ke.jsx)(Wd,{type:"text",value:e.fa_cislo_vema||"",hasError:!!_o["faktura_".concat(n+1,"_cislo")],disabled:Os,onChange:n=>{const a=Kn.faktury.map(a=>a.id===e.id?(0,t.A)((0,t.A)({},a),{},{fa_cislo_vema:n.target.value,_isNew:!1}):a);Fs(a)},required:!0,placeholder:"12345678",hasIcon:!0})]})]}),(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"\u010c\xe1stka v\u010d. DPH"}),(0,ke.jsx)(Ac,{fieldName:"fa_castka",value:null!==(o=e.fa_castka)&&void 0!==o?o:"",hasError:!!_o["faktura_".concat(n+1,"_castka")],disabled:Os,onChange:(n,a)=>{const o=Kn.faktury.map(n=>n.id===e.id?(0,t.A)((0,t.A)({},n),{},{fa_castka:a,_isNew:!1}):n);Fs(o)},placeholder:"25000.50"})]})]}),(0,ke.jsxs)(Ld,{style:{gridTemplateColumns:"280px 1fr"},children:[(0,ke.jsxs)(Vd,{children:[(0,ke.jsx)(Md,{required:!0,children:"Datum splatnosti"}),(0,ke.jsx)(wc,{fieldName:"fa_".concat(n+1,"_splatnost"),value:(n=>{var a;return!1===e._isNew?null!==(a=e.fa_splatnost)&&void 0!==a?a:"":null!==(n=e.fa_splatnost)&&void 0!==n?n:e.fa_datum_splatnosti?e.fa_datum_splatnosti.split(" ")[0]:""})(),hasError:!!_o["faktura_".concat(n+1,"_splatnost")],disabled:Os,onChange:n=>{const a=Kn.faktury.map(a=>a.id===e.id?(0,t.A)((0,t.A)({},a),{},{fa_splatnost:n,_isNew:!1}):a);Fs(a)},placeholder:"Vyberte datum splatnosti"})]}),(0,ke.jsxs)(Vd,{"data-custom-select":!0,style:{gridColumn:"2 / -1"},children:[(0,ke.jsxs)(Ud,{children:[(0,ke.jsx)(Zd,{children:"St\u0159ediska"}),(0,ke.jsx)(Kd,{type:"button",$visible:(()=>{const n=e.fa_strediska_kod||[];return Array.isArray(n)&&n.length>0})(),onClick:()=>{const n=Kn.faktury.map(n=>n.id===e.id?(0,t.A)((0,t.A)({},n),{},{fa_strediska_kod:[],_isNew:!1}):n);Fs(n)},title:"Vymazat v\xfdb\u011br",children:(0,ke.jsx)(w.A,{size:12})})]}),(0,ke.jsx)(rp,{value:(()=>{const n=e.fa_strediska_kod||Kn.strediska_kod||[];return"string"===typeof n&&n.trim()?n.split(",").map(e=>e.trim()).filter(Boolean):Array.isArray(n)?n:[]})(),disabled:Os,onChange:n=>{const a=Array.isArray(n)?n.map(e=>"string"===typeof e?e:e.value||e.kod_stavu||e.id||e):[],o=Kn.faktury.map(n=>n.id===e.id?(0,t.A)((0,t.A)({},n),{},{fa_strediska_kod:a,_isNew:!1}):n);Fs(o)},options:Ei,placeholder:"Vyberte st\u0159ediska (auto-vypln\u011bno z objedn\xe1vky)",field:"strediska",required:!1,multiple:!0,icon:(0,ke.jsx)(C.A,{}),getOptionLabel:Wp,getOptionValue:(e,n)=>e.value||e.id||e})]})]}),(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsx)(Md,{children:"Pozn\xe1mka"}),(0,ke.jsx)(Hd,{value:e.fa_poznamka||"",disabled:Os,onChange:n=>{const a=Kn.faktury.map(a=>a.id===e.id?(0,t.A)((0,t.A)({},a),{},{fa_poznamka:n.target.value,_isNew:!1}):a);Fs(a)},placeholder:"Voliteln\xe1 pozn\xe1mka...",rows:2})]})}),Gn>=7&&(0,ke.jsxs)("div",{style:{marginTop:"1.5rem",padding:"1rem",background:s?"linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)":"linear-gradient(135deg, #fefefe 0%, #f3f4f6 100%)",border:s?"2px solid #22c55e":"2px solid #d1d5db",borderRadius:"8px"},children:[(0,ke.jsxs)("div",{style:{fontWeight:"700",fontSize:"0.95rem",color:"#166534",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsx)(p.g,{icon:u.SGM}),"V\u011bcn\xe1 spr\xe1vnost faktury #",n+1]}),(()=>{const n=parseFloat(Kn.max_cena_s_dph)||0,a=parseFloat(e.fa_castka)||0,o=a-n,t=o>0;return(0,ke.jsxs)("div",{style:{background:t?"#fef2f2":"#f0fdf4",border:"1px solid ".concat(t?"#ef4444":"#22c55e"),borderRadius:"6px",padding:"0.75rem",marginBottom:"1rem",fontSize:"0.85rem"},children:[(0,ke.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[(0,ke.jsx)("span",{style:{color:"#6b7280"},children:"Max. cena objedn\xe1vky s DPH:"}),(0,ke.jsxs)("span",{style:{fontWeight:"600",color:"#374151"},children:[n.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"]})]}),(0,ke.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[(0,ke.jsx)("span",{style:{color:"#6b7280"},children:"\u010c\xe1stka faktury s DPH:"}),(0,ke.jsxs)("span",{style:{fontWeight:"600",color:"#374151"},children:[a.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"]})]}),(0,ke.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"0.5rem",borderTop:"1px solid #e5e7eb",fontWeight:"700"},children:[(0,ke.jsx)("span",{style:{color:t?"#dc2626":"#16a34a"},children:t?"\u26a0\ufe0f P\u0159ekro\u010den\xed:":"\u2705 Rozd\xedl:"}),(0,ke.jsxs)("span",{style:{color:t?"#dc2626":"#16a34a"},children:[t?"+":"",o.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"]})]})]})})(),(0,ke.jsxs)(Ld,{children:[(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsx)(Md,{children:"Um\xedst\u011bn\xed majetku"}),(0,ke.jsx)(Wd,{value:e.vecna_spravnost_umisteni_majetku||"",disabled:Ps,onChange:n=>{const a=Kn.faktury.map(a=>a.id===e.id?(0,t.A)((0,t.A)({},a),{},{vecna_spravnost_umisteni_majetku:n.target.value,_isNew:!1}):a);Fs(a)},placeholder:"Nap\u0159. Kladno, budova K2, m\xedstnost 203"})]}),(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(()=>{const n=parseFloat(Kn.max_cena_s_dph)||0,a=(parseFloat(e.fa_castka)||0)>n;return(0,ke.jsxs)(Md,{required:a,style:a?{color:"#dc2626",fontWeight:"700"}:{},children:["Pozn\xe1mka k v\u011bcn\xe9 spr\xe1vnosti",a?" (POVINN\xc1 - faktura p\u0159ekra\u010duje MAX cenu)":""]})})(),(0,ke.jsx)(Hd,{value:e.vecna_spravnost_poznamka||"",disabled:Ps,hasError:!!_o["faktura_".concat(n+1,"_poznamka_vs")],onChange:n=>{const a=Kn.faktury.map(a=>a.id===e.id?(0,t.A)((0,t.A)({},a),{},{vecna_spravnost_poznamka:n.target.value,_isNew:!1}):a);Fs(a)},placeholder:"Voliteln\xe1 pozn\xe1mka k v\u011bcn\xe9 spr\xe1vnosti...",rows:2}),_o["faktura_".concat(n+1,"_poznamka_vs")]&&(0,ke.jsx)(Fd,{children:_o["faktura_".concat(n+1,"_poznamka_vs")]})]})]}),(()=>{const a=!!_o["faktura_".concat(n+1,"_vecna_spravnost")];return(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsxs)("div",{style:{marginTop:"1rem",padding:"0.75rem",background:a?"#fef2f2":"#ffffff",border:a?"2px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px"},children:[(0,ke.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:Ps?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:Ps?"400":"600",color:a?"#dc2626":Ps?"#9ca3af":"#374151"},children:[(0,ke.jsx)("input",{type:"checkbox",checked:1===e.vecna_spravnost_potvrzeno,disabled:Ps,onChange:n=>{const a=n.target.checked?1:0;let o={vecna_spravnost_potvrzeno:a,_isNew:!1};if(1===a&&Ae&&!e.potvrdil_vecnou_spravnost_id){const n=new Date,a=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),i=String(n.getHours()).padStart(2,"0"),s=String(n.getMinutes()).padStart(2,"0"),d=String(n.getSeconds()).padStart(2,"0"),l="".concat(a,"-").concat(t,"-").concat(r," ").concat(i,":").concat(s,":").concat(d);o.potvrdil_vecnou_spravnost_id=Ae,o.dt_potvrzeni_vecne_spravnosti=l,Bs("info","VECNA-FAKTURA","metadata-set","Faktura #".concat(e.id,": Nastaveno ID=").concat(Ae,", dt=").concat(l))}const r=Kn.faktury.map(n=>n.id===e.id?(0,t.A)((0,t.A)({},n),o):n);Fs(r)},style:{width:"18px",height:"18px",cursor:Ps?"not-allowed":"pointer",accentColor:Ps?"#9ca3af":"#16a34a"}}),(0,ke.jsxs)("span",{style:{flex:1},children:["Potvrzuji v\u011bcnou spr\xe1vnost faktury #",n+1]}),1===e.vecna_spravnost_potvrzeno&&(0,ke.jsx)("span",{style:{fontSize:"0.75rem",color:"#16a34a",background:"#dcfce7",padding:"0.25rem 0.5rem",borderRadius:"4px",fontWeight:"600"},children:"\u2713 ZKONTROLOV\xc1NO"})]}),(()=>{const n=r?1===i.vecna_spravnost_potvrzeno:1===e.vecna_spravnost_potvrzeno,a=e.id&&!String(e.id).startsWith("temp-"),o=e.dt_potvrzeni_vecne_spravnosti;if(!n||!a||!o||!(Gn>=8))return null;const t=e.potvrdil_vecnou_spravnost_jmeno?"".concat(e.potvrdil_vecnou_spravnost_jmeno," ").concat(e.potvrdil_vecnou_spravnost_prijmeni||"").trim():e.potvrdil_vecnou_spravnost_id?Ws(e.potvrdil_vecnou_spravnost_id):null;return(0,ke.jsxs)("div",{style:{marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"#f0fdf4",border:"1px solid #86efac",borderRadius:"4px",fontSize:"0.8rem",color:"#15803d"},children:[(0,ke.jsx)("strong",{children:"Potvrdil:"})," ",t||"Syst\xe9m"," ",(0,ke.jsx)("strong",{children:"\u2022"})," ",(0,ke.jsx)("strong",{children:"Datum:"})," ",(0,Ma.fn)(e.dt_potvrzeni_vecne_spravnosti)]})})()]}),a&&(0,ke.jsx)(Fd,{style:{marginTop:"0.5rem"},children:_o["faktura_".concat(n+1,"_vecna_spravnost")]})]})})()]}),(0,ke.jsx)(ue.r6,{fakturaId:e.id,objednavkaId:Kn.id,fakturaTypyPrilohOptions:Ui,readOnly:Os,onISDOCParsed:$s,formData:Kn,faktura:e,validateInvoiceForAttachments:Js,attachments:e.attachments||[],onAttachmentsChange:n=>{Gs(e.id,n)},onAttachmentUploaded:n=>{Ys(e.id,n)},onCreateInvoiceInDB:qs},"invoice-attachments-".concat(n,"-").concat(Kn.id)),!e._isNew&&(0,ke.jsxs)("div",{style:{borderTop:"1px solid #e5e7eb",paddingTop:"0.5rem",marginTop:"0.75rem",fontSize:"0.75rem",color:"#9ca3af",display:"flex",justifyContent:"space-between"},children:[(0,ke.jsxs)("div",{children:[(0,ke.jsx)("strong",{children:"Vytvo\u0159il:"})," ",e.vytvoril_jmeno||Ws(e.vytvoril_uzivatel_id)]}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("strong",{children:"Vytvo\u0159eno:"})," ",(0,Ma.fn)(e.dt_vytvoreni)]})]})]})]},e.id)}):(0,ke.jsxs)("div",{style:{border:"2px dashed #cbd5e1",borderRadius:"8px",padding:"2rem",textAlign:"center",color:"#64748b",background:"#f8fafc"},children:[(0,ke.jsx)("div",{style:{fontSize:"1.25rem",marginBottom:"0.5rem"},children:"\ud83d\udcc4"}),(0,ke.jsx)("div",{style:{fontWeight:"500",marginBottom:"0.5rem"},children:"Na\u010d\xedt\xe1m prvn\xed fakturu..."}),(0,ke.jsx)("div",{style:{fontSize:"0.875rem"},children:"Pros\xedm chv\xedli strpen\xed"})]}),!Os&&(0,ke.jsxs)("button",{type:"button",onClick:()=>{const e=Qs(new Date),n={id:"temp-".concat(Date.now()),objednavka_id:Kn.id,fa_datum_doruceni:e,fa_dorucena:1,fa_castka:"",fa_cislo_vema:"",fa_strediska_kod:Array.isArray(Kn.strediska_kod)?Kn.strediska_kod:[],fa_poznamka:"",fa_splatnost:"",vytvoril_uzivatel_id:Ae,vytvoril_jmeno:Ws(Ae),dt_vytvoreni:(new Date).toISOString(),dt_aktualizace:null,aktivni:1,_isNew:!0,vecna_spravnost_umisteni_majetku:"",vecna_spravnost_poznamka:"",vecna_spravnost_potvrzeno:0},a=Array.isArray(Kn.faktury)?Kn.faktury:[];Fs([...a,n]),oi(n),ri({fa_datum_doruceni:e,fa_dorucena:1,fa_castka:"",fa_cislo_vema:"",fa_strediska_kod:Kn.strediska_kod||[],fa_poznamka:"",fa_splatnost:"",vecna_spravnost_umisteni_majetku:"",vecna_spravnost_poznamka:"",vecna_spravnost_potvrzeno:0})},style:{width:"100%",marginTop:"1rem",padding:"1rem",background:"transparent",color:"#3b82f6",border:"2px dashed #3b82f6",borderRadius:"8px",fontSize:"0.9rem",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(59, 130, 246, 0.05)",e.currentTarget.style.borderColor="#2563eb"},onMouseLeave:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.borderColor="#3b82f6"},children:[(0,ke.jsx)(R.A,{size:18}),"P\u0159idat dal\u0161\xed fakturu"]})]}),Kn.faktury&&Kn.faktury.length>0&&Kn.fakturant_id&&Kn.dt_faktura_pridana&&(0,ke.jsxs)("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#dcfce7",border:"1px solid #16a34a",borderRadius:"6px",color:"#166534",fontSize:"0.875rem"},children:[(0,ke.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.25rem"},children:"\u2705 Fakturace byla zpracov\xe1na"}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("strong",{children:"Datum zpracov\xe1n\xed:"})," ",(0,Ma.fn)(Kn.dt_faktura_pridana)," \u2022 ",(0,ke.jsx)("strong",{children:"Zpracoval:"})," ",Ws(Kn.fakturant_id)]})]})]})})})]}):null})(),(()=>{const e=(()=>{const e=Ci.find(e=>e.kod===Kn.zpusob_financovani||e.value===Kn.zpusob_financovani);return((null===e||void 0===e?void 0:e.nazev)||"").toLowerCase().includes("pokladna")})(),n=Kn.faktury&&Kn.faktury.length>0;return!e&&6===Gn&&!os&&!n&&(0,ke.jsxs)("div",{style:{margin:"2rem 0",padding:"1rem 1.25rem",backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"8px",color:"#92400e"},children:[(0,ke.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"\u23f3 \u010cek\xe1 se na dopln\u011bn\xed fakturace"}),(0,ke.jsxs)("div",{style:{fontSize:"0.875rem"},children:["Objedn\xe1vka \u010dek\xe1 na p\u0159id\xe1n\xed faktur ekonomick\xfdm odd\u011blen\xedm. Po dopln\u011bn\xed faktur budete moci pokra\u010dovat k ",(0,ke.jsx)("strong",{children:"v\u011bcn\xe9 kontrole"}),". Tuto akci m\u016f\u017ee prov\xe9st pouze u\u017eivatel s opr\xe1vn\u011bn\xedm pro spr\xe1vu faktur."]})]})})(),($n||6===Gn)&&Kn.faktury&&Kn.faktury.length>0&&(0,ke.jsxs)("div",{style:{margin:"2rem 0",padding:"1rem 1.25rem",backgroundColor:"#fefce8",border:"1px solid #eab308",borderRadius:"8px",color:"#854d0e"},children:[(0,ke.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"\u2139\ufe0f P\u0159id\xe1n\xed faktur k objedn\xe1vce"}),(0,ke.jsxs)("div",{style:{fontSize:"0.875rem"},children:[Kn.fakturant_id&&Kn.dt_faktura_pridana&&(0,ke.jsxs)("div",{style:{marginBottom:"0.5rem"},children:[(0,ke.jsx)("strong",{children:"P\u0159idal fakturu:"})," ",Ws(Kn.fakturant_id)," \u2022 ",(0,ke.jsx)("strong",{children:"Datum:"})," ",(0,Ma.fn)(Kn.dt_faktura_pridana)]}),"V t\xe9to sekci p\u0159idejte faktury k objedn\xe1vce. Po p\u0159id\xe1n\xed a ulo\u017een\xed m\u016f\u017eete pokra\u010dovat k ",(0,ke.jsx)("strong",{children:"v\u011bcn\xe9 kontrole"}),"."]})]}),(ds||oa(Kn.stav_workflow_kod,"DOKONCENA"))&&(oa(Kn.stav_workflow_kod,"ZKONTROLOVANA")||oa(Kn.stav_workflow_kod,"DOKONCENA"))&&(()=>{!Kn.id||1!==Kn.potvrzeni_dokonceni_objednavky||oa(Kn.stav_workflow_kod,"DOKONCENA");const e=!Ns.enabled;return(0,ke.jsxs)(wd,{"data-section":"dokonceni",children:[(0,ke.jsxs)(Sd,{sectionTheme:"section-dokonceni",isActive:!0,style:{background:"linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",borderColor:"#16a34a"},children:[(0,ke.jsxs)(Ed,{sectionTheme:"section-dokonceni",style:{color:"#fff",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsx)(Cd,{sectionTheme:"section-dokonceni",style:{color:"#fff"},children:(0,ke.jsx)(p.g,{icon:u.SGM})}),"Dokon\u010den\xed objedn\xe1vky"]}),(0,ke.jsx)(Nd,{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:(0,ke.jsx)(Od,{collapsed:Je.dokonceni,onClick:()=>Lc("dokonceni"),style:{color:"#fff",cursor:"pointer"},children:(0,ke.jsx)(p.g,{icon:u.w2A})})})]}),(0,ke.jsx)(Td,{collapsed:Je.dokonceni,children:(0,ke.jsxs)("div",{style:{padding:"1rem 0"},children:[(0,ke.jsxs)("div",{style:{background:"#f0fdf4",border:"1px solid #22c55e",borderRadius:"8px",padding:"1rem",marginBottom:"1.5rem"},children:[(0,ke.jsx)("div",{style:{fontWeight:"600",color:"#166534",marginBottom:"0.75rem"},children:"\ud83c\udf89 Fin\xe1ln\xed krok - Dokon\u010den\xed objedn\xe1vky"}),(0,ke.jsxs)("div",{style:{fontSize:"0.875rem",color:"#166534",lineHeight:"1.6"},children:["Objedn\xe1vka pro\u0161la v\u0161emi f\xe1zemi:",(0,ke.jsxs)("ul",{style:{marginTop:"0.5rem",marginLeft:"1.5rem",listStyle:"none",paddingLeft:0},children:[(0,ke.jsxs)("li",{style:{display:"flex",alignItems:"center",marginBottom:"0.4rem"},children:["\u2705 Schv\xe1len\xed (",Kn.dt_schvaleni?(0,Ma.fn)(Kn.dt_schvaleni):""," \u2022 ",Kn.schvalovatel_id?Ws(Kn.schvalovatel_id):"",")"]}),(0,ke.jsxs)("li",{style:{display:"flex",alignItems:"center",marginBottom:"0.4rem"},children:["\u2705 Odesl\xe1n\xed dodavateli (",Kn.dt_odeslani?(0,Ma.fn)(Kn.dt_odeslani):""," \u2022 ",Kn.odesilatel_id?Ws(Kn.odesilatel_id):"",")"]}),(0,ke.jsxs)("li",{style:{display:"flex",alignItems:"center",marginBottom:"0.4rem"},children:["\u2705 Potvrzen\xed od dodavatele (",Kn.dt_akceptace?(0,Ma.iS)(Kn.dt_akceptace):""," \u2022 ",Kn.dodavatel_potvrdil_id?Ws(Kn.dodavatel_potvrdil_id):"",")"]}),(0,ke.jsxs)("li",{style:{display:"flex",alignItems:"center",marginBottom:"0.4rem"},children:["\u2705 Registr smluv ",Kn.dt_zverejneni&&"0000-00-00"!==Kn.dt_zverejneni?"(".concat((0,Ma.iS)(Kn.dt_zverejneni)," \u2022 ").concat(Kn.zverejnil_id?Ws(Kn.zverejnil_id):"",")"):"(nepodl\xe9h\xe1 zve\u0159ejn\u011bn\xed v registru)"]}),(0,ke.jsxs)("li",{style:{display:"flex",alignItems:"center",marginBottom:"0.4rem"},children:["\u2705 Fakturace (",Kn.dt_faktura_pridana?(0,Ma.fn)(Kn.dt_faktura_pridana):""," \u2022 ",Kn.fakturant_id?Ws(Kn.fakturant_id):"",")"]}),Kn.faktury&&Kn.faktury.length>0&&Kn.faktury.map((e,n)=>{const a=1===e.vecna_spravnost_potvrzeno,o=e.potvrdil_vecnou_spravnost_jmeno?"".concat(e.potvrdil_vecnou_spravnost_jmeno," ").concat(e.potvrdil_vecnou_spravnost_prijmeni||"").trim():e.potvrdil_vecnou_spravnost_id?Ws(e.potvrdil_vecnou_spravnost_id):"",t=e.dt_potvrzeni_vecne_spravnosti?(0,Ma.fn)(e.dt_potvrzeni_vecne_spravnosti):"";return(0,ke.jsxs)("li",{style:{display:"flex",alignItems:"center",marginBottom:"0.4rem"},children:[a?"\u2705":"\u26a0\ufe0f"," V\u011bcn\xe1 spr\xe1vnost faktury #",n+1," ",t?"(".concat(t," \u2022 ").concat(o,")"):""]},e.id||n)})]}),(0,ke.jsx)("div",{style:{marginTop:"0.75rem",fontWeight:"500"},children:"Nyn\xed potvr\u010fte fin\xe1ln\xed dokon\u010den\xed objedn\xe1vky."})]})]}),(()=>{const e=parseFloat(Kn.max_cena_s_dph)||0,n=Kn.faktury?Kn.faktury.reduce((e,n)=>e+(parseFloat(n.fa_castka)||0),0):0,a=n-e;return a>0&&0!==e&&0!==n?(0,ke.jsxs)("div",{style:{background:"linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%)",border:"2px solid #ef4444",borderRadius:"12px",padding:"1rem",marginBottom:"1.5rem",boxShadow:"0 4px 12px rgba(239, 68, 68, 0.15)",display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[(0,ke.jsx)("div",{style:{fontSize:"1.5rem",marginTop:"0.1rem"},children:"\u26a0\ufe0f"}),(0,ke.jsxs)("div",{style:{flex:1},children:[(0,ke.jsx)("div",{style:{fontWeight:"700",fontSize:"1rem",color:"#b91c1c",marginBottom:"0.5rem"},children:"POZOR: Fakturace p\u0159ekro\u010dila MAX cenu s DPH objedn\xe1vky schv\xe1lenou PO"}),(0,ke.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"auto auto",gap:"0.5rem 1rem",fontSize:"0.875rem",color:"#7f1d1d",marginBottom:"0.75rem"},children:[(0,ke.jsx)("span",{style:{fontWeight:"600"},children:"MAX cena s DPH (schv\xe1len\xe1):"}),(0,ke.jsxs)("span",{style:{fontFamily:"monospace",fontWeight:"700",textAlign:"right"},children:[e.toLocaleString("cs-CZ")," K\u010d"]}),(0,ke.jsx)("span",{style:{fontWeight:"600"},children:"Fakturovan\xe1 \u010d\xe1stka s DPH celkem:"}),(0,ke.jsxs)("span",{style:{fontFamily:"monospace",fontWeight:"700",textAlign:"right"},children:[n.toLocaleString("cs-CZ")," K\u010d"]}),(0,ke.jsx)("span",{style:{fontWeight:"600"},children:"P\u0159ekro\u010den\xed o:"}),(0,ke.jsxs)("span",{style:{fontFamily:"monospace",fontWeight:"700",color:"#dc2626",textAlign:"right"},children:["+",a.toLocaleString("cs-CZ")," K\u010d"]})]}),Kn.vecna_spravnost_poznamka&&(0,ke.jsx)("div",{style:{borderTop:"1px solid #fca5a5",paddingTop:"0.75rem",fontSize:"0.875rem",color:"#7f1d1d"},children:(0,ke.jsxs)("div",{style:{lineHeight:"1.5"},children:[(0,ke.jsx)("span",{style:{fontWeight:"600"},children:"Vysv\u011btlen\xed:"})," ",(0,ke.jsxs)("span",{style:{fontStyle:"italic"},children:['"',Kn.vecna_spravnost_poznamka,'"']})]})})]})]}):null})(),(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[(0,ke.jsx)(Md,{children:"POZN\xc1MKA K DOKON\u010cEN\xcd (nepovinn\xe9)"}),(0,ke.jsx)(Hd,{value:Kn.dokonceni_poznamka||"",onChange:e=>xp("dokonceni_poznamka",e.target.value),placeholder:"Voliteln\xe1 pozn\xe1mka k dokon\u010den\xed objedn\xe1vky...",rows:3,disabled:e,style:{background:e?"#f3f4f6":void 0,cursor:e?"not-allowed":void 0,opacity:e?.6:1}})]})}),(0,ke.jsx)(Ld,{style:{marginTop:"1.5rem"},children:(0,ke.jsx)(Vd,{style:{gridColumn:"1 / -1"},children:(0,ke.jsxs)("div",{style:{background:e?"#dcfce7":"#fef3c7",border:"2px solid ".concat(e?"#16a34a":"#eab308"),borderRadius:"8px",padding:"1.25rem",opacity:e?.7:1},children:[(0,ke.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"1rem",cursor:e?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",color:Kn.dokoncil_id?"#166534":"#713f12",opacity:Kn.dokoncil_id?.7:1},children:[(0,ke.jsx)("input",{type:"checkbox",checked:1===Kn.potvrzeni_dokonceni_objednavky||!0===Kn.potvrzeni_dokonceni_objednavky||oa(Kn.stav_workflow_kod,"DOKONCENA"),onChange:e=>{xp("potvrzeni_dokonceni_objednavky",e.target.checked?1:0)},required:!0,disabled:oa(Kn.stav_workflow_kod,"DOKONCENA"),style:{width:"24px",height:"24px",cursor:e?"not-allowed":"pointer",accentColor:"#16a34a"}}),(0,ke.jsxs)("span",{children:["\u2705 Potvrzuji fin\xe1ln\xed dokon\u010den\xed objedn\xe1vky",(0,ke.jsx)("span",{style:{color:"#dc2626",marginLeft:"0.25rem"},children:"*"})]})]}),(0,ke.jsx)("div",{style:{fontSize:"0.875rem",color:e?"#166534":"#92400e",marginTop:"0.75rem",marginLeft:"2.5rem"},children:e?(0,ke.jsxs)("div",{children:[(0,ke.jsxs)("div",{style:{fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[(0,ke.jsx)("span",{style:{fontSize:"1.1rem"},children:"\ud83d\udd12"}),(0,ke.jsx)("strong",{children:"Objedn\xe1vka je dokon\u010dena a uzam\u010dena"})]}),(0,ke.jsx)("div",{style:{fontSize:"0.8rem",color:"#166534",lineHeight:"1.5"},children:"Workflow je kompletn\u011b uzam\u010deno. Zm\u011bny m\u016f\u017ee prov\xe1d\u011bt pouze opr\xe1vn\u011bn\xfd u\u017eivatel."})]}):"Za\u0161krtnut\xedm potvrd\xedte dokon\u010den\xed objedn\xe1vky. Cel\xfd workflow bude uzam\u010den."})]})})})]})})]})})(),!1,oa(Kn.stav_workflow_kod,"ZKONTROLOVANA")&&!Kn.potvrdil_vecnou_spravnost_id&&(0,ke.jsxs)("div",{style:{margin:"2rem 0",padding:"1rem 1.25rem",backgroundColor:"#f0fdfa",border:"1px solid #14b8a6",borderRadius:"8px",color:"#0f766e"},children:[(0,ke.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"\u2705 F\xc1ZE 7/8: V\u011bcn\xe1 spr\xe1vnost - Zkontrolujte a potvr\u010fte spr\xe1vnost objedn\xe1vky"}),(0,ke.jsxs)("div",{style:{fontSize:"0.875rem"},children:["Zkontrolujte v\u011bcnou spr\xe1vnost objedn\xe1vky v\u010detn\u011b v\u0161ech faktur a \xfadaj\u016f. Po kontrole potvr\u010fte v\u011bcnou spr\xe1vnost v p\u0159\xedslu\u0161n\xe9 sekci n\xed\u017ee.",Kn.faktury&&Kn.faktury.length>0&&(0,ke.jsxs)("div",{style:{marginTop:"0.5rem"},children:[(0,ke.jsx)("strong",{children:"Faktury ke kontrole:"})," ",Kn.faktury.length]})]})]}),!ds&&(oa(Kn.stav_workflow_kod,"ZKONTROLOVANA")||oa(Kn.stav_workflow_kod,"DOKONCENA"))&&Kn.potvrdil_vecnou_spravnost_id&&!oa(Kn.stav_workflow_kod,"DOKONCENA")&&(0,ke.jsxs)("div",{style:{margin:"2rem 0",padding:"1.5rem",backgroundColor:"#eff6ff",border:"2px solid #3b82f6",borderRadius:"8px",textAlign:"center"},children:[(0,ke.jsx)("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"\u23f3"}),(0,ke.jsx)("div",{style:{fontWeight:"700",color:"#1e40af",marginBottom:"0.75rem",fontSize:"1.1rem"},children:"Objedn\xe1vka \u010dek\xe1 na dokon\u010den\xed"}),(0,ke.jsx)("div",{style:{fontSize:"0.875rem",color:"#1e40af",lineHeight:"1.6"},children:"Objedn\xe1vka pro\u0161la v\u0161emi f\xe1zemi workflow a \u010dek\xe1 na fin\xe1ln\xed potvrzen\xed dokon\u010den\xed."}),(0,ke.jsx)("div",{style:{fontSize:"0.875rem",color:"#1e40af",marginTop:"0.75rem",fontStyle:"italic"},children:"\ud83d\udca1 Dokon\u010den\xed objedn\xe1vky provede opr\xe1vn\u011bn\xfd u\u017eivatel."})]}),($n||Gn>=4)&&!Kn.stav_stornovano&&"ANO"!==(null===(be=Kn.dodavatel_zpusob_potvrzeni)||void 0===be?void 0:be.potvrzeni)&&(0,ke.jsxs)("div",{style:{margin:"2rem 0",padding:"1rem 1.25rem",backgroundColor:"#f0fdf4",border:"1px solid #10b981",borderRadius:"8px",color:"#065f46"},children:[(0,ke.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"\ud83d\udccb \u010cek\xe1n\xed na potvrzen\xed od dodavatele"}),(0,ke.jsxs)("div",{style:{fontSize:"0.875rem"},children:['Objedn\xe1vka byla odesl\xe1na dodavateli. Po obdr\u017een\xed potvrzen\xed od dodavatele za\u0161krtn\u011bte "Dodavatel objedn\xe1vku potvrdil" a vypl\u0148te zp\u016fsob potvrzen\xed.',Kn.datum_odeslani&&(0,ke.jsxs)("div",{style:{marginTop:"0.5rem"},children:[(0,ke.jsx)("strong",{children:"Datum odesl\xe1n\xed:"})," ",(()=>{const e=Kn.datum_odeslani.split(" ")[0],[n,a,o]=e.split("-");return"".concat(o,". ").concat(a,". ").concat(n)})(),Kn.odesilatel_id&&(0,ke.jsxs)(ke.Fragment,{children:[" \u2022 ",(0,ke.jsx)("strong",{children:"Odeslal:"})," ",Ws(Kn.odesilatel_id)]})]})]})]}),!1]})]}),Kn.id&&(0,ke.jsxs)(wd,{"data-section":"prilohy",children:[(0,ke.jsxs)(Sd,{sectionTheme:Ji("prilohy"),isActive:qi("prilohy"),children:[(0,ke.jsxs)(Ed,{sectionTheme:Ji("prilohy"),children:[(0,ke.jsx)(Cd,{sectionTheme:Ji("prilohy"),children:(0,ke.jsx)(p.g,{icon:u.KTq})}),"P\u0159\xedlohy k objedn\xe1vce",cs&&(0,ke.jsx)(Dd,{title:"Sekce P\u0159\xedlohy k objedn\xe1vce je zam\u010dena - objedn\xe1vka je dokon\u010dena/zam\xedtnuta/zru\u0161ena.",children:"\ud83d\udd12"})]}),(0,ke.jsx)(Od,{collapsed:Je.prilohy,sectionTheme:Ji("prilohy"),onClick:()=>Lc("prilohy"),style:{cursor:"pointer"},children:(0,ke.jsx)(p.g,{icon:u.w2A})})]}),(0,ke.jsx)(Td,{collapsed:Je.prilohy,children:(0,ke.jsx)(Ld,{children:(0,ke.jsxs)(Vd,{style:{gridColumn:"1 / -1"},children:[cs&&(0,ke.jsxs)("div",{style:{background:"#fef3c7",border:"2px solid #f59e0b",borderRadius:"8px",padding:"1rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,ke.jsx)("span",{style:{fontSize:"1.5rem"},children:"\ud83d\udd12"}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("div",{style:{fontWeight:"600",color:"#92400e",marginBottom:"0.25rem"},children:"P\u0159id\xe1v\xe1n\xed p\u0159\xedloh je zam\u010deno"}),(0,ke.jsx)("div",{style:{fontSize:"0.875rem",color:"#92400e"},children:"Objedn\xe1vka je dokon\u010dena - nelze p\u0159id\xe1vat ani upravovat p\u0159\xedlohy."})]})]}),(0,ke.jsxs)("div",{style:{border:"2px dashed ".concat(cs?"#d1d5db":kt?"#dc2626":"#fca5a5"),borderRadius:"8px",padding:"2rem",textAlign:"center",backgroundColor:cs?"#f3f4f6":kt?"rgba(254, 202, 202, 0.5)":"rgba(254, 226, 226, 0.3)",marginBottom:"1rem",transition:"all 0.2s ease",cursor:cs?"not-allowed":"pointer",opacity:cs?.5:1,pointerEvents:cs?"none":"auto"},onDrop:e=>{cs||(e.preventDefault(),e.stopPropagation(),ft(!1),(e=>{e.preventDefault(),e.stopPropagation(),ft(!1);const n=e.dataTransfer.files;n&&n.length>0&&Fc(n)})(e))},onDragOver:e=>{cs||(e.preventDefault(),e.stopPropagation(),ft(!0))},onDragEnter:e=>{cs||(e.preventDefault(),e.stopPropagation(),ft(!0))},onDragLeave:e=>{cs||(e.preventDefault(),e.stopPropagation(),e.currentTarget.contains(e.relatedTarget)||ft(!1))},onClick:()=>!cs&&document.getElementById("fileInput").click(),children:[_t?(0,ke.jsx)("div",{style:{width:"32px",height:"32px",border:"3px solid #f3f4f6",borderTop:"3px solid #3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 1rem auto"}}):(0,ke.jsx)("div",{style:{fontSize:"3rem",marginBottom:"1rem",color:kt?"#dc2626":"#991b1b",transition:"color 0.2s ease"},children:"\ud83d\udcc4"}),(0,ke.jsx)("div",{style:{fontSize:"1rem",fontWeight:"500",marginBottom:"0.5rem",color:kt?"#dc2626":_t?"#f59e0b":"#991b1b"},children:_t?"Nahr\xe1v\xe1m soubory...":kt?"Pus\u0165 soubory zde!":"P\u0159et\xe1hni nebo vyber soubory"}),(0,ke.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"1rem"},children:"Ka\u017ed\xe1 p\u0159\xedloha mus\xed b\xfdt klasifikov\xe1na: Objedn\xe1vka / Faktura / Ko\u0161ilka / Jin\xe9."}),(0,ke.jsx)("div",{style:{fontSize:"0.75rem",color:"#991b1b",fontWeight:"500"},children:"\ud83d\udce4 Orders25 API: P\u0159\xedlohy se automaticky nahraj\xed na server po klasifikaci pomoc\xed Orders25 attachment API."}),(0,ke.jsx)("button",{type:"button",disabled:cs,style:{marginTop:"1rem",background:cs?"#9ca3af":"#3b82f6",color:"white",border:"none",borderRadius:"6px",padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:"500",cursor:cs?"not-allowed":"pointer",opacity:cs?.6:1},onClick:e=>{cs||(e.stopPropagation(),document.getElementById("fileInput").click())},children:"Vybrat"})]}),(0,ke.jsx)("input",{id:"fileInput",type:"file",multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif,.txt",onChange:Jc,disabled:cs,style:{display:"none"}}),pn&&pn.filter(e=>"obj-"===op(e)).length>0&&(0,ke.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,ke.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,ke.jsxs)(Md,{children:["Po\u010det p\u0159\xedloh: ",(0,ke.jsx)("strong",{children:pn.filter(e=>"obj-"===op(e)).length})," | Nahr\xe1no: ",(0,ke.jsx)("span",{style:{color:"#16a34a"},children:(0,ke.jsx)("strong",{children:pn.filter(e=>"obj-"===op(e)&&"uploaded"===e.status).length})})]}),(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsx)("button",{type:"button",onClick:()=>qc(!1),disabled:ht,style:{background:"#10b981",color:"white",border:"none",borderRadius:"6px",padding:"0.375rem",fontSize:"0.875rem",cursor:ht?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:ht?.6:1},title:"Kontrola synchronizace p\u0159\xedloh s datab\xe1z\xed a diskem - zkontroluje, jestli jsou p\u0159\xedlohy v DB i fyzicky na disku",children:(0,ke.jsx)(p.g,{icon:u.VNe})}),(0,ke.jsx)("button",{type:"button",onClick:Xc,style:{background:"#3b82f6",color:"white",border:"none",borderRadius:"6px",padding:"0.375rem",fontSize:"0.875rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Chytr\xe9 na\u010dten\xed p\u0159\xedloh - slou\u010d\xed DB p\u0159\xedlohy s lok\xe1ln\xedmi neulo\u017een\xfdmi p\u0159\xedlohami, ide\xe1ln\xed p\u0159i obnoven\xed formul\xe1\u0159e",children:(0,ke.jsx)(p.g,{icon:u.GQu})}),(0,ke.jsx)("button",{type:"button",onClick:()=>Yc(!1),style:{background:"#7c3aed",color:"white",border:"none",borderRadius:"6px",padding:"0.375rem",fontSize:"0.875rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Na\u010dten\xed z datab\xe1ze - na\u010dte pouze p\u0159\xedlohy ulo\u017een\xe9 v datab\xe1zi, p\u0159ep\xed\u0161e lok\xe1ln\xed stav",children:(0,ke.jsx)(p.g,{icon:u.hem})}),!cs&&(0,ke.jsx)("button",{type:"button",onClick:ep,style:{background:"#dc2626",color:"white",border:"none",borderRadius:"6px",padding:"0.25rem 0.75rem",fontSize:"0.75rem",cursor:"pointer"},children:"Vymazat v\u0161echny"})]})]}),pn.filter(e=>"obj-"===op(e)).map((e,n)=>{var a,o;return(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem",border:"1px solid ".concat(tp(e)),borderRadius:"6px",backgroundColor:ip(e),marginBottom:"0.5rem",opacity:"uploading"===e.status?.6:1},children:[(0,ke.jsxs)("div",{style:{width:"32px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,position:"relative"},children:[(0,ke.jsx)(p.g,{icon:!1===e.file_exists?u.buE:u.h8M,style:{color:!1===e.file_exists?"#dc2626":"uploaded"===e.status?"#10b981":"#dc2626",fontSize:"24px"}}),"uploading"===e.status&&(0,ke.jsx)("div",{style:{position:"absolute",top:"-2px",right:"-2px",width:"12px",height:"12px",backgroundColor:"#f59e0b",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"uploaded"===e.status&&(0,ke.jsx)("div",{style:{position:"absolute",top:"-2px",right:"-2px",width:"12px",height:"12px",backgroundColor:"#10b981",borderRadius:"50%"}})]}),(0,ke.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,ke.jsx)("div",{style:{fontWeight:"500",fontSize:"0.875rem",color:"#374151",marginBottom:"2px"},children:(0,ke.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsxs)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0,position:"relative"},children:[e.name,!e.klasifikace&&(0,ke.jsx)("span",{style:{color:"#dc2626",fontSize:"0.7rem",fontWeight:"bold",position:"absolute",top:"-2px",marginLeft:"2px"},children:"*"})]}),!1===e.file_exists&&(0,ke.jsx)("span",{style:{color:"#dc2626",fontSize:"0.7rem",fontWeight:"bold",backgroundColor:"#fee2e2",padding:"1px 4px",borderRadius:"3px",flexShrink:0},children:"\u26a0 SOUBOR NENALEZEN"}),e.isDuplicate&&(0,ke.jsx)("span",{style:{color:"#f59e0b",fontSize:"0.7rem",fontWeight:"bold",backgroundColor:"#fef3c7",padding:"1px 4px",borderRadius:"3px",flexShrink:0},children:"DUPLIK\xc1T"}),(0,ke.jsxs)("span",{style:{color:"#6b7280",fontWeight:"normal",fontSize:"0.75rem",flexShrink:0},children:["(",Math.round((e.velikost||e.size||0)/1024)," kB)"]}),"uploaded"===e.status&&e.serverId&&(0,ke.jsx)("button",{type:"button",onClick:()=>(async e=>{if(e.serverId&&Se&&we){if("IMPORT"===e.typ_prilohy&&e.originalni_nazev_souboru){const n="".concat("https://erdms.zachranka.cz/prilohy/").concat(e.originalni_nazev_souboru);Bs("info","ATTACHMENTS","download-import","Stahov\xe1n\xed importovan\xe9 p\u0159\xedlohy ".concat(e.name," ze star\xe9ho syst\xe9mu: ").concat(n));const a=document.createElement("a");return a.href=n,a.download=e.originalni_nazev_souboru,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),void je('\ud83d\udce5 P\u0159\xedloha "'.concat(e.originalni_nazev_souboru,'" se stahuje ze star\xe9ho syst\xe9mu'),"info")}try{Bs("info","ATTACHMENTS","download-start","Stahov\xe1n\xed p\u0159\xedlohy ".concat(e.name," ze serveru..."));const n=await(0,Ia.downloadOrderAttachment)(Kn.id,e.serverId,we,Se),a=window.URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download=e.name||"priloha",document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(a),Bs("success","ATTACHMENTS","download-success","P\u0159\xedloha ".concat(e.name," sta\u017eena \xfasp\u011b\u0161n\u011b"))}catch(n){const a=n.message||"Nepoda\u0159ilo se st\xe1hnout p\u0159\xedlohu";je(a,"error"),Bs("error","ATTACHMENTS","download-error","Chyba p\u0159i stahov\xe1n\xed ".concat(e.name,": ").concat(a))}}else je("Nelze st\xe1hnout p\u0159\xedlohu - chyb\xed server ID","error")})(e),style:{background:"none",border:"none",color:"#2563eb",cursor:"pointer",padding:"2px",display:"flex",alignItems:"center",fontSize:"12px",flexShrink:0},title:"St\xe1hnout soubor",children:(0,ke.jsx)(S.A,{size:14})}),!cs&&(0,ke.jsx)("button",{type:"button",onClick:()=>e.serverId?(async e=>{const n=pn.find(n=>n.id===e);n&&(jt({fileId:e,attachment:n,isFromServer:!0}),gt(!0))})(e.id):(e=>{const n=pn.find(n=>n.id===e);n&&(jt({fileId:e,attachment:n,isFromServer:!1}),gt(!0))})(e.id),disabled:"uploading"===e.status,style:{background:"none",border:"none",color:"uploading"===e.status?"#9ca3af":"#dc2626",cursor:"uploading"===e.status?"not-allowed":"pointer",padding:"2px",display:"flex",alignItems:"center",opacity:"uploading"===e.status?.6:1,fontSize:"12px",flexShrink:0},title:e.serverId?"Smazat ze serveru":"Smazat soubor",children:(0,ke.jsx)(p.g,{icon:u.yLS})})]})}),(0,ke.jsxs)("div",{style:{fontSize:"0.75rem",color:"#6b7280",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,ke.jsxs)("span",{children:[(0,Ma.iS)(new Date(e.uploadDate))," ",new Date(e.uploadDate).toLocaleTimeString("cs-CZ",{hour:"2-digit",minute:"2-digit"})]}),(0,ke.jsx)("span",{children:"\u2022"}),(0,ke.jsx)("span",{style:{textTransform:"uppercase",backgroundColor:"#fef3c7",color:"#92400e",padding:"2px 6px",borderRadius:"4px",fontSize:"0.6875rem",fontWeight:"500"},children:e.type.includes("pdf")?"PDF":e.name.split(".").pop()}),(0,ke.jsx)("span",{children:"\u2022"}),(0,ke.jsxs)("span",{style:{backgroundColor:"#e0e7ff",color:"#3730a3",padding:"2px 6px",borderRadius:"4px",fontSize:"0.6875rem",fontWeight:"500"},children:["Nahr\xe1no: ",(null===(a=e.nahrano_uzivatel)||void 0===a?void 0:a.prijmeni)||"ADMIN"," ",(null===(o=e.nahrano_uzivatel)||void 0===o?void 0:o.jmeno)||"Super"]})]})]}),(0,ke.jsxs)("div",{style:{minWidth:"180px",flexShrink:0},children:[null,(0,ke.jsxs)("select",{value:e.klasifikace||"",onChange:n=>(async(e,n)=>{const a=pn.find(n=>n.id===e);if(a)if(Wn(a=>(0,t.A)((0,t.A)({},a),{},{prilohy_dokumenty:(a.prilohy_dokumenty||[]).map(a=>a.id===e?(0,t.A)((0,t.A)({},a),{},{klasifikace:n}):a)})),un(a=>a.map(a=>a.id===e?(0,t.A)((0,t.A)({},a),{},{klasifikace:n}):a)),xa.current||!Da.default.isAutosaveEnabled()||Zt||rt||!ma||Pa(!0),a.serverId&&"uploaded"===a.status){if(!n||""===n.trim())return void je("\u26a0\ufe0f Nelze ulo\u017eit pr\xe1zdnou klasifikaci pro nahran\xe9 soubory","warning");try{const o=await(0,Ia.Td)({token:Se,username:we,objednavka_id:Kn.id,attachment_id:a.serverId,typ_prilohy:n});if("ok"===o.status||"success"===o.status){if(o.data){const a={typ_prilohy:o.data.type||n,dt_aktualizace:o.data.updated_at,klasifikace:o.data.type||n};Wn(n=>(0,t.A)((0,t.A)({},n),{},{prilohy_dokumenty:(n.prilohy_dokumenty||[]).map(n=>n.id===e?(0,t.A)((0,t.A)({},n),a):n)})),un(n=>n.map(n=>n.id===e?(0,t.A)((0,t.A)({},n),a):n))}await qc(!0),je("\u2705 Klasifikace aktualizov\xe1na v datab\xe1zi + kontrola existence OK","success"),Bs("success","ATTACHMENTS","update-classification-db","Klasifikace zm\u011bn\u011bna v DB: ".concat(a.name," \u2192 ").concat(n))}}catch(o){const n=(0,Xa.g)(o.message);je("\u274c Chyba p\u0159i aktualizaci klasifikace: ".concat(n),"error"),Bs("error","ATTACHMENTS","update-classification-db-failed","Chyba aktualizace klasifikace v DB: ".concat(n)),Wn(n=>(0,t.A)((0,t.A)({},n),{},{prilohy_dokumenty:(n.prilohy_dokumenty||[]).map(n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{klasifikace:a.klasifikace}):n)})),un(n=>n.map(n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{klasifikace:a.klasifikace}):n))}}else if(n&&""!==n.trim()&&Kn.id&&Se&&we){const o=a.file_prefix||"obj-";await Gc(e,n,o)}})(e.id,n.target.value),disabled:"uploading"===e.status||"IMPORT"===e.typ_prilohy||cs,style:{width:"100%",padding:"0.5rem 0.75rem",border:"1px solid ".concat(e.klasifikace?"IMPORT"===e.typ_prilohy?"#f59e0b":"#d1d5db":"#fca5a5"),borderRadius:"6px",fontSize:"0.875rem",backgroundColor:"uploading"===e.status?"#f3f4f6":"IMPORT"===e.typ_prilohy?"#fef3c7":cs?"#f3f4f6":"white",color:e.klasifikace?"#374151":"#6b7280",cursor:"uploading"===e.status||"IMPORT"===e.typ_prilohy||cs?"not-allowed":"pointer",opacity:"uploading"===e.status||cs?.6:1,fontWeight:"IMPORT"===e.typ_prilohy?"600":"normal"},title:cs?"Klasifikace je zam\u010dena - objedn\xe1vka dokon\u010dena":"IMPORT"===e.typ_prilohy?"Importovan\xe1 p\u0159\xedloha - nelze m\u011bnit typ":"",children:[(0,ke.jsx)("option",{value:"",style:{color:"#6b7280"},children:"Vyberte..."}),Di.map(e=>(0,ke.jsx)("option",{value:e.kod||e.id,children:e.nazev||e.name},e.kod||e.id))]})]})]},e.id)})]}),(0,ke.jsxs)("div",{style:{backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"8px",padding:"1rem",marginTop:"1rem",display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[(0,ke.jsx)("div",{style:{fontSize:"1.25rem",flexShrink:0,lineHeight:1},children:"\u26a0\ufe0f"}),(0,ke.jsxs)("div",{style:{fontSize:"0.875rem",color:"#92400e",lineHeight:"1.5"},children:[(0,ke.jsx)("strong",{children:"D\u016fle\u017eit\xe9 upozorn\u011bn\xed:"}),' V\u0161echny zm\u011bny v p\u0159\xedloh\xe1ch (nahr\xe1n\xed, klasifikace, maz\xe1n\xed) jsou prov\xe1d\u011bny okam\u017eit\u011b a automaticky se ukl\xe1daj\xed do datab\xe1ze. Tyto akce nelze vz\xedt zp\u011bt pomoc\xed tla\u010d\xedtka "Zru\u0161it".']})]})]})})})]})]})})]}),xo&&s.createPortal((0,ke.jsx)(El,{children:(0,ke.jsxs)(Cl,{onClick:e=>e.stopPropagation(),children:[(0,ke.jsxs)(Ol,{children:[(0,ke.jsxs)(Nl,{children:[(0,ke.jsx)(E.A,{size:24}),"Adres\xe1\u0159 dodavatel\u016f"]}),(0,ke.jsx)(Dl,{onClick:()=>{jo(!1),Ao(""),So([])},children:"\xd7"})]}),(0,ke.jsxs)(Il,{children:[(0,ke.jsx)("div",{style:{marginBottom:"20px"},children:(0,ke.jsx)(Tl,{type:"text",value:zo,onChange:e=>{const n=e.target.value;Ao(n),pp(n)},placeholder:"Vyhledat podle n\xe1zvu nebo I\u010cO...",autoFocus:!0})}),(0,ke.jsx)("div",{style:{minHeight:"200px"},children:Eo?(0,ke.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"40px 20px",textAlign:"center"},children:[(0,ke.jsx)("div",{style:{width:"32px",height:"32px",border:"3px solid #f3f4f6",borderTop:"3px solid #3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"16px"}}),(0,ke.jsx)("p",{style:{color:"#6b7280",margin:0},children:"Vyhled\xe1v\xe1m dodavatele..."})]}):wo.length>0?(0,ke.jsx)(Pl,{children:wo.map((e,n)=>(0,ke.jsxs)(Rl,{onClick:()=>(e=>{Wn(n=>(0,t.A)((0,t.A)({},n),{},{dodavatel_nazev:e.nazev||e.name||"",dodavatel_adresa:e.adresa||e.address||"",dodavatel_ico:e.ico||"",dodavatel_dic:e.dic||"",dodavatel_zastoupeny:e.zastoupeny||e.represented||"",dodavatel_kontakt_jmeno:e.kontakt_jmeno||e.contactPerson&&e.contactPerson.name||"",dodavatel_kontakt_email:e.kontakt_email||e.contactPerson&&e.contactPerson.email||e.email||"",dodavatel_kontakt_telefon:e.kontakt_telefon||e.contactPerson&&e.contactPerson.phone||e.telefon||""})),jo(!1),Ao(""),So([]),je&&je("Dodavatel byl vybr\xe1n",{type:"success"})})(e),children:[(0,ke.jsx)("div",{style:{fontWeight:"600",color:"#111827",marginBottom:"8px"},children:e.nazev||e.name}),(0,ke.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"4px"},children:e.adresa||e.address||e.sidlo}),(0,ke.jsxs)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"4px"},children:[e.ico&&"I\u010cO: ".concat(e.ico)," ",e.dic&&"\u2022 DI\u010c: ".concat(e.dic)]}),(e.kontakt_jmeno||e.kontakt_email)&&(0,ke.jsxs)("div",{style:{fontSize:"0.75rem",color:"#9ca3af"},children:["Kontakt: ",e.kontakt_jmeno," ",e.kontakt_email&&"\u2022 ".concat(e.kontakt_email)]})]},e.id||n))}):0===Oo.length?(0,ke.jsx)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6b7280"},children:(0,ke.jsx)("p",{children:"\u017d\xe1dn\xed dodavatel\xe9 nejsou k dispozici."})}):zo.length>=2?(0,ke.jsx)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6b7280"},children:(0,ke.jsxs)("p",{children:['\u017d\xe1dn\xed dodavatel\xe9 nevyhovuj\xed vyhled\xe1v\xe1n\xed "',zo,'".']})}):(0,ke.jsx)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6b7280"},children:(0,ke.jsx)("p",{children:"Za\u010dn\u011bte ps\xe1t pro filtrov\xe1n\xed dodavatel\u016f..."})})})]})]})}),document.body),Do&&s.createPortal((0,ke.jsx)(Ll,{children:(0,ke.jsxs)(Vl,{onClick:e=>e.stopPropagation(),children:[(0,ke.jsxs)(Fl,{children:[(0,ke.jsxs)(Ml,{children:[(0,ke.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,ke.jsx)("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),(0,ke.jsx)("path",{d:"M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5"}),(0,ke.jsx)("path",{d:"M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3"})]}),"ARES - Administrativn\xed registr ekonomick\xfdch subjekt\u016f"]}),(0,ke.jsx)(Ul,{onClick:()=>{To(!1),Po("")},children:(0,ke.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,ke.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,ke.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,ke.jsxs)(Zl,{children:[(0,ke.jsx)(Kl,{type:"text",placeholder:"Vyhledat podle n\xe1zvu firmy nebo I\u010cO...",value:Io,onChange:e=>{const n=e.target.value;Po(n),n.length>=2?(clearTimeout(window.aresSearchTimeout),window.aresSearchTimeout=setTimeout(()=>{vp(n)},500)):Lo([])},autoFocus:!0}),(0,ke.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,ke.jsx)("div",{style:{fontSize:"14px",fontWeight:"600",color:"#262626",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Rozsah ulo\u017een\xed"}),(0,ke.jsxs)(Xl,{children:[(0,ke.jsxs)(Ql,{type:"button",selected:"personal"===Bo,onClick:()=>Wo("personal"),children:[(0,ke.jsx)(p.g,{icon:u.X46}),(0,ke.jsx)("span",{children:"Osobn\xed"})]}),(0,ke.jsxs)(Ql,{type:"button",selected:"usek"===Bo,onClick:()=>Oe&&Oe("CONTACT_EDIT")&&Wo("usek"),disabled:!Oe||!Oe("CONTACT_EDIT"),title:Oe&&Oe("CONTACT_EDIT")?"":"Nem\xe1te opr\xe1vn\u011bn\xed pro \xfasekov\xfd kontakt",children:[(0,ke.jsx)(p.g,{icon:u.URI}),(0,ke.jsx)("span",{children:"\xdasek"})]}),(0,ke.jsxs)(Ql,{type:"button",selected:"global"===Bo,onClick:()=>Oe&&Oe("CONTACT_MANAGE")&&Wo("global"),disabled:!Oe||!Oe("CONTACT_MANAGE"),title:Oe&&Oe("CONTACT_MANAGE")?"":"Nem\xe1te opr\xe1vn\u011bn\xed pro glob\xe1ln\xed kontakt",children:[(0,ke.jsx)(p.g,{icon:u.Bwz}),(0,ke.jsx)("span",{children:"Glob\xe1ln\xed"})]})]})]}),"usek"===Bo&&(0,ke.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,ke.jsx)("div",{style:{fontSize:"14px",fontWeight:"600",color:"#262626",marginBottom:"12px",textTransform:"uppercase",letterSpacing:"0.5px"},children:Qi?"V\xfdb\u011br \xfasek\u016f":"V\xe1\u0161 \xfasek: ".concat((null===ze||void 0===ze?void 0:ze.usek_zkr)||"N/A")}),Go?(0,ke.jsx)("div",{style:{padding:"1rem",textAlign:"center",color:"#6b7280"},children:"Na\u010d\xedt\xe1m \xfaseky..."}):0===$o.length?(0,ke.jsx)("div",{style:{padding:"1rem",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",color:"#dc2626"},children:"\u274c \u017d\xe1dn\xe9 \xfaseky nebyly na\u010dteny"}):(0,ke.jsx)(ec,{children:(Qi?$o:$o.filter(e=>e.usek_zkr===(null===ze||void 0===ze?void 0:ze.usek_zkr))).map((e,n)=>(0,ke.jsxs)(nc,{selected:Ho.includes(e.usek_zkr),onClick:()=>_p(e.usek_zkr),children:[(0,ke.jsx)("input",{type:"checkbox",checked:Ho.includes(e.usek_zkr),onChange:()=>_p(e.usek_zkr)}),e.usek_zkr]},e.usek_zkr||n))}),0===Ho.length&&!Go&&$o.length>0&&(0,ke.jsx)("div",{style:{marginTop:"8px",padding:"8px",background:"#e0f2fe",border:"1px solid #0ea5e9",borderRadius:"6px",fontSize:"12px",color:"#0c4a6e"},children:"\u2139\ufe0f Pokud nevyberete \u017e\xe1dn\xfd \xfasek, kontakt se ulo\u017e\xed jako osobn\xed"})]}),(0,ke.jsx)(Bl,{children:Vo?(0,ke.jsxs)(Yl,{children:[(0,ke.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:(0,ke.jsx)("path",{d:"M21 12a9 9 0 11-6.219-8.56"})}),(0,ke.jsx)("span",{style:{marginLeft:"12px"},children:"Vyhled\xe1v\xe1m v ARES..."})]}):Ro.length>0?Ro.map((e,n)=>{const a=Mo===e.ico;return(0,ke.jsxs)(Wl,{children:[(0,ke.jsxs)(Hl,{hasButtons:!0,onClick:()=>mp(e),children:[(0,ke.jsx)("div",{style:{fontWeight:"600",color:"#111827",marginBottom:"8px"},children:e.nazev}),(0,ke.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"4px"},children:e.sidlo||e.adresa}),(0,ke.jsxs)("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:["I\u010cO: ",e.ico," ",e.dic&&"\u2022 DI\u010c: ".concat(e.dic)]}),Zo[e.ico]&&(Zo[e.ico].existsInGlobal||Zo[e.ico].existsInUsek||Zo[e.ico].existsInPersonal)&&(0,ke.jsxs)($l,{children:[Zo[e.ico].existsInGlobal&&(0,ke.jsxs)(Jl,{scope:"global",children:[(0,ke.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:(0,ke.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),"Glob\xe1ln\xed"]}),Zo[e.ico].existsInUsek&&(0,ke.jsxs)(Jl,{scope:"usek",children:[(0,ke.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:(0,ke.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),"\xdasek"]}),Zo[e.ico].existsInPersonal&&(0,ke.jsxs)(Jl,{scope:"personal",children:[(0,ke.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:(0,ke.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),"Osobn\xed"]})]})]}),(0,ke.jsxs)(Gl,{children:[(0,ke.jsxs)(ql,{className:"primary",onClick:()=>mp(e),children:[(0,ke.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,ke.jsx)("path",{d:"M9 11l3 3L22 4"}),(0,ke.jsx)("path",{d:"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"})]}),"Pou\u017e\xedt"]}),(0,ke.jsx)(ql,{className:"success",onClick:()=>{kp(e,"usek"===Bo?{scope:"usek",useky:Ho}:Bo),mp(e)},disabled:a||"usek"===Bo&&0===Ho.length,title:"usek"===Bo&&0===Ho.length?"Vyberte alespo\u0148 jeden \xfasek":"",children:a?(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:(0,ke.jsx)("path",{d:"M21 12a9 9 0 11-6.219-8.56"})}),"Ukl\xe1d\xe1m..."]}):(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,ke.jsx)("path",{d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"}),(0,ke.jsx)("polyline",{points:"17,21 17,13 7,13 7,21"}),(0,ke.jsx)("polyline",{points:"7,3 7,8 15,8"})]}),"Pou\u017e\xedt + Ulo\u017eit"]})})]})]},n)}):Io.length>=2?(0,ke.jsx)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6b7280"},children:(0,ke.jsx)("p",{children:"V ARES nebyli nalezeni \u017e\xe1dn\xed dodavatel\xe9."})}):(0,ke.jsx)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6b7280"},children:(0,ke.jsx)("p",{children:"Zadejte alespo\u0148 2 znaky pro vyhled\xe1v\xe1n\xed v ARES."})})})]})]})}),document.body),jr&&s.createPortal((0,ke.jsx)(el,{children:(0,ke.jsxs)(sl,{onClick:e=>e.stopPropagation(),children:[(0,ke.jsx)(cl,{type:"button",onClick:()=>{zr(!1),wr(""),Er("po"),Or("new"),Dr(null)},children:(0,ke.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,ke.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,ke.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),(0,ke.jsx)(dl,{children:(0,ke.jsx)(ll,{children:"Ulo\u017eit \u0161ablonu"})}),(0,ke.jsxs)(pl,{children:[(0,ke.jsxs)(ul,{children:[(0,ke.jsx)(vl,{children:"RE\u017dIM"}),(0,ke.jsx)("div",{style:{display:"flex",gap:"8px"},children:[{value:"new",label:"\u2728 Nov\xe1",disabled:!1},{value:"update",label:"\ud83d\udd04 Aktualizovat",disabled:0===[...kr,...hr].length},{value:"merge",label:"\ud83d\udd17 Slou\u010dit",disabled:0===[...kr,...hr].length}].map(e=>(0,ke.jsxs)("label",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",padding:"10px 16px",borderRadius:"6px",border:"2px solid ".concat(Cr===e.value?"#10b981":"#e5e7eb"),backgroundColor:Cr===e.value?"#d1fae5":"white",cursor:e.disabled?"not-allowed":"pointer",opacity:e.disabled?.5:1,fontSize:"0.875rem",fontWeight:"600",transition:"all 0.2s"},children:[(0,ke.jsx)("input",{type:"radio",name:"saveMode",value:e.value,checked:Cr===e.value,onChange:e=>Or(e.target.value),disabled:e.disabled,style:{display:"none"}}),e.label]},e.value))})]}),("update"===Cr||"merge"===Cr)&&(0,ke.jsxs)(ul,{children:[(0,ke.jsx)(vl,{children:"VYBERTE \u0160ABLONU"}),(0,ke.jsx)(rp,{field:"templateSelect",value:(null===Nr||void 0===Nr?void 0:Nr.id)||(null===Nr||void 0===Nr?void 0:Nr.ts)||"",onChange:e=>{const n=[...kr,...hr].find(n=>(n.id||n.ts).toString()===String(e));Dr(n),"update"===Cr&&n&&wr(n.name||"")},options:[...kr,...hr],placeholder:"Vyberte \u0161ablonu...",getOptionLabel:e=>{const n=e.__fromServer?"server":"lok\xe1ln\xed";return"".concat(e.name," (").concat(n,")")},getOptionValue:e=>e.id||e.ts})]}),("new"===Cr||"merge"===Cr)&&(0,ke.jsxs)(ul,{children:[(0,ke.jsx)(vl,{children:"N\xc1ZEV"}),(0,ke.jsx)(_l,{type:"text",value:Ar,onChange:e=>wr(e.target.value),placeholder:"merge"===Cr?"N\xe1zev slou\u010den\xe9 \u0161ablony":"N\xe1zev \u0161ablony",autoFocus:"new"===Cr})]}),(0,ke.jsxs)(ul,{children:[(0,ke.jsx)(vl,{children:"TYP"}),(0,ke.jsx)("div",{style:{display:"flex",gap:"8px"},children:[{value:"po",label:"PO",disabled:!1},{value:"details",label:"Detaily",disabled:!$n&&Gn<2},{value:"mixed",label:"V\u0161e",disabled:!$n&&Gn<2}].map(e=>(0,ke.jsxs)("label",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"10px 16px",borderRadius:"6px",border:"2px solid ".concat(Sr===e.value?"#3b82f6":"#e5e7eb"),backgroundColor:Sr===e.value?"#dbeafe":"white",cursor:e.disabled?"not-allowed":"pointer",opacity:e.disabled?.4:1,fontSize:"0.875rem",fontWeight:"600",transition:"all 0.2s"},children:[(0,ke.jsx)("input",{type:"radio",name:"templateType",value:e.value,checked:Sr===e.value,onChange:e=>Er(e.target.value),disabled:e.disabled,style:{display:"none"}}),e.label]},e.value))}),!$n&&Gn<2&&(0,ke.jsxs)("div",{style:{marginTop:"8px",padding:"8px 12px",backgroundColor:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"6px",fontSize:"0.75rem",color:"#92400e"},children:["\u26a0\ufe0f Ve F\xc1ZI 1 lze ukl\xe1dat pouze ",(0,ke.jsx)("strong",{children:"PO"})," (P\u0159edb\u011b\u017en\xe1 objedn\xe1vka). Detaily budou dostupn\xe9 po schv\xe1len\xed."]})]})]}),(0,ke.jsxs)(ml,{children:[(0,ke.jsx)(kl,{type:"button",variant:"cancel",onClick:()=>{zr(!1),wr(""),Er("po")},children:"Zru\u0161it"}),(0,ke.jsx)(kl,{type:"button",variant:"primary",onClick:async()=>{if(!Ar.trim())return;const e={},n=qa(Xn,Gn,$n),a={financovani:["zpusob_financovani","financovani","lp_kod","cislo_smlouvy","smlouva_poznamka","individualni_schvaleni","individualni_poznamka","pojistna_udalost_cislo","pojistna_udalost_poznamka"],dodavatel:["dodavatel_id","dodavatel_nazev","dodavatel_adresa","dodavatel_ico","dodavatel_dic","dodavatel_zastoupeny"],kontakt:["dodavatel_kontakt_jmeno","dodavatel_kontakt_email","dodavatel_kontakt_telefon"],detaily:["druh_objednavky","druh_objednavky_kod","poznamka_objednavky"],dodaci_podminky:["dt_predpokladany_termin_dodani","misto_dodani","zaruka"],polozky:["polozky_objednavky"]};if("po"!==Sr&&"mixed"!==Sr||(e.poApproval={predmet:Kn.predmet||"",prikazce_id:Kn.prikazce_id||"",max_cena_s_dph:Kn.max_cena_s_dph||"",strediska_kod:Kn.strediska_kod||"",garant_uzivatel_id:Kn.garant_uzivatel_id||"",zpusob_financovani:Kn.zpusob_financovani||"",lp_kod:Kn.lp_kod||[],cislo_smlouvy:Kn.cislo_smlouvy||"",smlouva_poznamka:Kn.smlouva_poznamka||"",individualni_schvaleni:Kn.individualni_schvaleni||"",individualni_poznamka:Kn.individualni_poznamka||"",pojistna_udalost_cislo:Kn.pojistna_udalost_cislo||"",pojistna_udalost_poznamka:Kn.pojistna_udalost_poznamka||""}),"details"===Sr||"mixed"===Sr){if(Gn<2)return void(null===je||void 0===je||je('Nelze ulo\u017eit Detaily ve F\xc1ZI 1. Pou\u017eijte typ "PO".',"warning"));e.orderDetails={},Object.entries(a).forEach(a=>{let[o,t]=a;("polozky"===o?n.detaily:n[o])&&t.forEach(n=>{"polozky_objednavky"!==n&&void 0!==Kn[n]&&(e.orderDetails[n]=Kn[n]||"")})}),n.detaily&&Array.isArray(Kn.polozky_objednavky)&&Kn.polozky_objednavky.length>0&&(e.polozky=Kn.polozky_objednavky.map(e=>({popis:e.popis||"",cena_bez_dph:e.cena_bez_dph||"",sazba_dph:e.sazba_dph||21,cena_s_dph:e.cena_s_dph||""})))}if("new"===Cr)await Bp(Ar.trim(),e,Sr);else if("update"===Cr)if(Nr.__fromServer)try{const n="po"!==Sr&&"mixed"!==Sr||!e.poApproval?"":JSON.stringify(e.poApproval),a="details"!==Sr&&"mixed"!==Sr||!e.orderDetails?"":JSON.stringify(e.orderDetails),o=await(0,me.ub)({username:(null===Ee||void 0===Ee?void 0:Ee.username)||we,token:Se,user_id:Nr.user_id||0,id:Nr.id,nazev_sablony:Nr.name,polozky_po:n,polozky_detail:a,typ:Sr,kategorie:"OBJEDNAVKA25"});"ok"===(null===o||void 0===o?void 0:o.status)&&(await Zp(),je&&je('\u0160ablona "'.concat(Nr.name,'" byla aktualizov\xe1na'),{type:"success"}))}catch(r){je&&je("Chyba p\u0159i aktualizaci \u0161ablony na serveru",{type:"error"})}else fr(n=>n.map(n=>n.ts===Nr.ts?(0,t.A)((0,t.A)({},n),{},{data:e,type:Sr}):n)),je&&je('\u0160ablona "'.concat(Nr.name,'" byla aktualizov\xe1na'),{type:"success"});else if("merge"===Cr){const n=(0,t.A)({},Nr.data);var o;if(e.poApproval&&(n.poApproval=(0,t.A)((0,t.A)({},n.poApproval),e.poApproval)),e.orderDetails)n.orderDetails=(0,t.A)((0,t.A)({},n.orderDetails),e.orderDetails),(null===(o=e.orderDetails.polozky)||void 0===o?void 0:o.length)>0&&(n.orderDetails.polozky=[...n.orderDetails.polozky||[],...e.orderDetails.polozky]);await Bp(Ar.trim(),n,"mixed"),je&&je('\u0160ablona "'.concat(Ar,'" byla vytvo\u0159ena slou\u010den\xedm'),{type:"success"})}zr(!1),wr(""),Er("po"),Or("new"),Dr(null)},disabled:"new"===Cr&&!Ar.trim()||("update"===Cr||"merge"===Cr)&&!Nr||"merge"===Cr&&!Ar.trim(),children:"new"===Cr?"\ud83d\udcbe Ulo\u017eit":"update"===Cr?"\ud83d\udd04 Aktualizovat":"\ud83d\udd17 Slou\u010dit"})]})]})}),document.body),Tr&&s.createPortal((0,ke.jsx)(nl,{onClick:e=>{e.target===e.currentTarget&&Up()},children:(0,ke.jsxs)(al,{onClick:e=>e.stopPropagation(),children:[(0,ke.jsx)(ol,{children:"Potvrdit smaz\xe1n\xed \u0161ablony"}),(0,ke.jsxs)(tl,{children:["Opravdu chcete smazat \u0161ablonu ",(0,ke.jsxs)("strong",{children:['"',null===Pr||void 0===Pr?void 0:Pr.name,'"']}),"?",(0,ke.jsx)("br",{}),(0,ke.jsx)("br",{}),"Tato akce je nevratn\xe1."]}),(0,ke.jsxs)(rl,{children:[(0,ke.jsx)(il,{onClick:Up,children:"Zru\u0161it"}),(0,ke.jsx)(il,{variant:"danger",onClick:()=>{if(Pr)try{const e=Pr;e&&(e.__fromServer||e.id)&&Se&&we?(async()=>{try{const n=e&&void 0!==e.user_id&&null!==e.user_id?e.user_id:Ae||0;if(0===Number(n)&&(!Oe||!Oe("TEMPLATE_MANAGE")))return void(je&&je("Nem\xe1te opr\xe1vn\u011bn\xed smazat p\u0159eddefinovanou \u0161ablonu.",{type:"error"}));const a=await(0,me.I7)({username:(null===Ee||void 0===Ee?void 0:Ee.username)||we,token:Se,user_id:n||0,id:e.id}),o=a&&a.data&&(a.data.status||a.data.result||(a.data.ok?"ok":null)),t=a&&a.data&&(a.data.data||a.data);if(!(o&&"ok"===String(o).toLowerCase()&&t&&(!0===t.deleted||"true"===t.deleted)||null!==a&&void 0!==a&&a.success||"ok"===(null===a||void 0===a?void 0:a.status)))throw new Error("Smaz\xe1n\xed na serveru se nezda\u0159ilo");yr(n=>Array.isArray(n)?n.filter(n=>String(n.id)!==String(e.id)):n),fr(n=>{const a=n.filter(n=>!(n.id&&e.id&&String(n.id)===String(e.id)));try{const e=Ae?"order_templates_".concat(Ae):"order_templates";localStorage.setItem(e,JSON.stringify(a))}catch(o){}return a}),gp("delete",{name:null===e||void 0===e?void 0:e.name,id:null===e||void 0===e?void 0:e.id,mode:"server"}),je&&je("\u0160ablona byla smaz\xe1na.",{type:"success"})}catch(n){fr(n=>{const a=n.filter(n=>!(n.ts===e.ts&&n.name===e.name));try{const e=Ae?"order_templates_".concat(Ae):"order_templates";localStorage.setItem(e,JSON.stringify(a))}catch(o){}return a}),je&&je("Smaz\xe1n\xed \u0161ablony selhalo: ".concat((null===n||void 0===n?void 0:n.message)||"Chyba serveru"),{type:"error"})}})():(fr(e=>{const n=e.filter(e=>!(e.ts===Pr.ts&&e.name===Pr.name));try{const e=Ae?"order_templates_".concat(Ae):"order_templates";localStorage.setItem(e,JSON.stringify(n))}catch(a){}return n}),gp("delete",{name:null===Pr||void 0===Pr?void 0:Pr.name,ts:null===Pr||void 0===Pr?void 0:Pr.ts,mode:"local"}))}finally{Ir(!1),Rr(null)}},children:"Smazat"})]})]})}),document.body),ii&&s.createPortal((0,ke.jsx)(sc,{onClick:()=>si(null),children:(0,ke.jsxs)(dc,{onClick:e=>e.stopPropagation(),children:[(0,ke.jsxs)(lc,{children:[(0,ke.jsxs)(cc,{children:[(0,ke.jsx)(ce.A,{size:20}),"N\xe1hled \u0161ablony"]}),(0,ke.jsx)(pc,{onClick:()=>si(null),children:(0,ke.jsx)(w.A,{size:18})})]}),(0,ke.jsxs)(uc,{children:[(0,ke.jsxs)(vc,{children:[(0,ke.jsx)(S.A,{size:16}),"Informace o \u0161ablon\u011b"]}),(0,ke.jsxs)(_c,{children:[(0,ke.jsx)(mc,{children:"N\xe1zev:"}),(0,ke.jsx)(kc,{children:ii.preview.templateInfo.name})]}),(0,ke.jsxs)(_c,{children:[(0,ke.jsx)(mc,{children:"Typ:"}),(0,ke.jsx)(kc,{children:(0,ke.jsx)(gc,{type:ii.preview.templateInfo.type,children:"po"===ii.preview.templateInfo.type?"Schv\xe1len\xed":"details"===ii.preview.templateInfo.type?"Detaily":"Kombinovan\xe9"})})]}),(0,ke.jsxs)(_c,{children:[(0,ke.jsx)(mc,{children:"Vytvo\u0159ena:"}),(0,ke.jsx)(kc,{children:ii.preview.templateInfo.created})]}),(0,ke.jsxs)(_c,{children:[(0,ke.jsx)(mc,{children:"Dostupnost:"}),(0,ke.jsx)(kc,{children:ii.preview.templateInfo.isGlobal?"Glob\xe1ln\xed kontakt":"Osobn\xed kontakt"})]})]}),ii.preview.poApproval&&(0,ke.jsxs)(uc,{children:[(0,ke.jsxs)(vc,{children:[(0,ke.jsx)(pe.A,{size:16}),"Schv\xe1len\xed n\xe1kupu"]}),ii.preview.poApproval.predmet&&(0,ke.jsxs)(_c,{children:[(0,ke.jsx)(mc,{children:"P\u0159edm\u011bt:"}),(0,ke.jsx)(kc,{children:ii.preview.poApproval.predmet})]}),ii.preview.poApproval.maxCena&&(0,ke.jsxs)(_c,{children:[(0,ke.jsx)(mc,{children:"Max. cena s DPH:"}),(0,ke.jsxs)(kc,{children:[ii.preview.poApproval.maxCena," K\u010d"]})]}),ii.preview.poApproval.popisPozadavku&&(0,ke.jsxs)(_c,{children:[(0,ke.jsx)(mc,{children:"Popis po\u017eadavku:"}),(0,ke.jsx)(kc,{children:ii.preview.poApproval.popisPozadavku})]}),ii.preview.poApproval.strediska.length>0&&(0,ke.jsxs)(_c,{children:[(0,ke.jsx)(mc,{children:"St\u0159ediska:"}),(0,ke.jsxs)(kc,{children:[ii.preview.poApproval.strediska.length," vybr\xe1no"]})]})]}),ii.preview.orderDetails&&(0,ke.jsxs)(uc,{children:[(0,ke.jsxs)(vc,{children:[(0,ke.jsx)(T.A,{size:16}),"Detaily objedn\xe1vky"]}),ii.preview.orderDetails.dodavatelNazev&&(0,ke.jsxs)(_c,{children:[(0,ke.jsx)(mc,{children:"Dodavatel:"}),(0,ke.jsx)(kc,{children:ii.preview.orderDetails.dodavatelNazev})]}),ii.preview.orderDetails.dodavatelIco&&(0,ke.jsxs)(_c,{children:[(0,ke.jsx)(mc,{children:"I\u010cO:"}),(0,ke.jsx)(kc,{children:ii.preview.orderDetails.dodavatelIco})]}),ii.preview.orderDetails.zpusobFinancovani&&(0,ke.jsxs)(_c,{children:[(0,ke.jsx)(mc,{children:"Financov\xe1n\xed:"}),(0,ke.jsx)(kc,{children:ii.preview.orderDetails.zpusobFinancovani})]}),ii.preview.orderDetails.datumDodani&&(0,ke.jsxs)(_c,{children:[(0,ke.jsx)(mc,{children:"Datum dod\xe1n\xed:"}),(0,ke.jsx)(kc,{children:ii.preview.orderDetails.datumDodani})]}),ii.preview.orderDetails.poznamka&&(0,ke.jsxs)(_c,{children:[(0,ke.jsx)(mc,{children:"Pozn\xe1mka:"}),(0,ke.jsx)(kc,{children:ii.preview.orderDetails.poznamka})]})]}),ii.preview.items.length>0&&(0,ke.jsxs)(uc,{children:[(0,ke.jsxs)(vc,{children:[(0,ke.jsx)(I,{size:16}),"Polo\u017eky (",ii.preview.items.length,")"]}),(0,ke.jsxs)(fc,{children:[ii.preview.items.slice(0,5).map((e,n)=>(0,ke.jsxs)(hc,{children:[(0,ke.jsxs)(yc,{children:[e.index,". ",e.popis||"Bez popisu"]}),(0,ke.jsxs)(bc,{children:[(0,ke.jsxs)("span",{children:[e.pocet,"\xd7 ",e.cenaJednotka," K\u010d/",e.jednotka||"ks"]}),(0,ke.jsxs)("strong",{children:[e.cenaTotal.toLocaleString("cs-CZ")," K\u010d"]})]})]},n)),ii.preview.items.length>5&&(0,ke.jsxs)(xc,{children:["... a dal\u0161\xedch ",ii.preview.items.length-5," polo\u017eek"]}),ii.preview.items.length>0&&(0,ke.jsxs)(_c,{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"2px solid #f3f4f6"},children:[(0,ke.jsx)(mc,{children:"Celkov\xe1 cena:"}),(0,ke.jsxs)(kc,{style:{fontWeight:"bold",color:"#059669"},children:[ii.preview.items.reduce((e,n)=>e+n.cenaTotal,0).toLocaleString("cs-CZ")," K\u010d"]})]})]})]}),!ii.preview.poApproval&&!ii.preview.orderDetails&&0===ii.preview.items.length&&(0,ke.jsx)(xc,{children:"Tato \u0161ablona neobsahuje \u017e\xe1dn\xe1 data"})]})}),document.body),(0,ke.jsx)(ve.A,{isOpen:Ba,onClose:Ip,onConfirm:Tp,title:"Zav\u0159\xedt formul\xe1\u0159",icon:u.zpE,variant:"warning",confirmText:"Ano, zav\u0159\xedt",cancelText:"Ne, z\u016fstat",children:Qa||"Koncept bude zru\u0161en a neulo\u017een\xe9 zm\u011bny nebudou ulo\u017eeny."}),(0,ke.jsxs)(ve.A,{isOpen:bt,onClose:()=>{gt(!1),jt(null)},onConfirm:async()=>{if(!xt)return;const{fileId:e,attachment:n,isFromServer:a}=xt;a?await(async(e,n)=>{if(n.serverId&&Se&&we)try{Bs("info","ATTACHMENTS","delete-start","Maz\xe1n\xed p\u0159\xedlohy ".concat(n.name," ze serveru...")),await(0,Ia.Lu)(Kn.id,n.serverId,we,Se),Bs("success","ATTACHMENTS","delete-success","P\u0159\xedloha ".concat(n.name," smaz\xe1na ze serveru")),je('\ud83d\uddd1\ufe0f P\u0159\xedloha "'.concat(n.name,'" byla \xfasp\u011b\u0161n\u011b smaz\xe1na'),"success")}catch(t){var a,o;Bs("error","ATTACHMENTS","delete-error","Chyba p\u0159i maz\xe1n\xed ".concat(n.name,": ").concat(t.message));const e=(null===(a=t.response)||void 0===a||null===(o=a.data)||void 0===o?void 0:o.message)||t.message||"Nezn\xe1m\xe1 chyba";return void je('\u274c Chyba p\u0159i maz\xe1n\xed p\u0159\xedlohy "'.concat(n.name,'": ').concat(e),"error")}Qc(e)})(e,n,n.name):(Qc(e),je("Soubor byl odstran\u011bn","info")),gt(!1),jt(null)},title:"Smazat p\u0159\xedlohu",icon:u.yLS,variant:"danger",confirmText:"Ano, smazat",cancelText:"Zru\u0161it",children:[(0,ke.jsxs)("p",{children:["Opravdu chcete smazat ",(0,ke.jsxs)("strong",{children:['"',(null===xt||void 0===xt||null===(ge=xt.attachment)||void 0===ge?void 0:ge.name)||"tento soubor",'"']}),"?"]}),(null===xt||void 0===xt?void 0:xt.isFromServer)&&(0,ke.jsxs)("p",{style:{background:"linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%)",padding:"0.75rem",borderRadius:"6px",border:"1px solid rgba(239, 68, 68, 0.2)",color:"#991b1b",fontSize:"0.9rem",margin:"0.75rem 0"},children:[(0,ke.jsx)("strong",{children:"\u26a0\ufe0f Pozor:"})," Po smaz\xe1n\xed ji\u017e nebude mo\u017en\xe9 soubor obnovit."]})]}),(0,ke.jsxs)(ve.A,{isOpen:zt,onClose:()=>{At(!1)},onConfirm:()=>{Wn(e=>(0,t.A)((0,t.A)({},e),{},{prilohy_dokumenty:[]})),un([]),je("V\u0161echny p\u0159\xedlohy (".concat(pn.length," soubor\u016f) byly odstran\u011bny"),"warning"),At(!1)},title:"Smazat v\u0161echny p\u0159\xedlohy",icon:u.yLS,variant:"danger",confirmText:"Ano, smazat v\u0161e",cancelText:"Zru\u0161it",children:[(0,ke.jsxs)("p",{children:["Opravdu chcete smazat ",(0,ke.jsxs)("strong",{children:["v\u0161echny p\u0159\xedlohy (",pn.length," soubor\u016f)"]}),"?"]}),(0,ke.jsxs)("p",{style:{background:"linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%)",padding:"0.75rem",borderRadius:"6px",border:"1px solid rgba(239, 68, 68, 0.2)",color:"#991b1b",fontSize:"0.9rem",margin:"0.75rem 0"},children:[(0,ke.jsx)("strong",{children:"\u26a0\ufe0f Pozor:"})," Tato akce odstran\xed v\u0161echny nahran\xe9 soubory. Operaci nelze vr\xe1tit zp\u011bt."]})]}),(0,ke.jsxs)(ve.A,{isOpen:so.isOpen,onClose:()=>lo({isOpen:!1,fakturaId:null,fakturaNazev:"",pocetPriloh:0}),onConfirm:async()=>{const{fakturaId:e,pocetPriloh:n}=so;if(lo({isOpen:!1,fakturaId:null,fakturaNazev:"",pocetPriloh:0}),e)try{const t=e&&!String(e).startsWith("temp-");if(t&&n>0)try{var a;const n=await(0,Ia.CX)(e,we,Se,Kn.id),t=(null===(a=n.data)||void 0===a?void 0:a.attachments)||n.data||[];for(const a of t)try{await(0,Ia.ao)(e,a.id,we,Se)}catch(o){je&&je("Nepoda\u0159ilo se smazat p\u0159\xedlohu faktury",{type:"error"})}}catch(o){je&&je("Nepoda\u0159ilo se smazat p\u0159\xedlohy faktury",{type:"error"})}if(t)try{await(0,Za.FC)(e,Se,we,!0),je&&je("\u2705 Faktura i p\u0159\xedlohy byly trvale smaz\xe1ny",{type:"success"})}catch(o){je&&je("Nepoda\u0159ilo se smazat fakturu",{type:"error"})}const r=(Array.isArray(Kn.faktury)?Kn.faktury:[]).filter(n=>n.id!==e);Fs(r),Pa(!0)}catch(o){je&&je("Nepoda\u0159ilo se smazat fakturu",{type:"error"})}},title:"Smazat fakturu",icon:u.yLS,variant:"danger",confirmText:"Smazat",cancelText:"Zru\u0161it",children:[(0,ke.jsxs)("p",{children:["Opravdu chcete smazat fakturu ",(0,ke.jsxs)("strong",{children:['"',so.fakturaNazev,'"']}),"?"]}),so.pocetPriloh>0&&(0,ke.jsxs)("p",{style:{background:"#fee2e2",padding:"0.75rem",borderRadius:"6px",border:"1px solid #ef4444",margin:"0.75rem 0"},children:[(0,ke.jsx)("strong",{children:"\u26a0\ufe0f POZOR:"})," Faktura m\xe1 ",(0,ke.jsxs)("strong",{children:[so.pocetPriloh," p\u0159\xedlohu/p\u0159\xedloh"]}),", kter\xe9 budou tak\xe9 smaz\xe1ny!"]})]}),(0,ke.jsxs)(ve.A,{isOpen:Lr,onClose:()=>Vr(!1),onConfirm:()=>{Vr(!1),(async()=>{const{updatedFormData:e,unlockState:n,newPhase:a}=Jn.unlockPhase2();Wn(e),setTimeout(()=>{Pa(!0),Bs("success","UNLOCK",n,"F\xc1ZE ".concat(a," odem\u010dena, workflow: ").concat(e.stav_workflow_kod))},100)})()},title:"\u26a0\ufe0f Odemknout F\xc1ZI 2 (Info o objednateli)",icon:u.zpE,variant:"danger",confirmText:"ANO, ODEMKNOUT A SMAZAT",cancelText:"Zru\u0161it",children:[(0,ke.jsxs)("p",{style:{background:"#fee2e2",padding:"0.75rem",borderRadius:"6px",border:"1px solid #ef4444",margin:"0.75rem 0"},children:[(0,ke.jsx)("strong",{children:"\u26a0\ufe0f VAROV\xc1N\xcd:"})," Odem\u010den\xed F\xc1ZE 2 vyma\u017ee ",(0,ke.jsx)("strong",{children:"v\u0161echna data vy\u0161\u0161\xedch f\xe1z\xed (F\xc1ZE 3-10)"}),"!"]}),(0,ke.jsxs)("p",{children:["Workflow se resetuje na stav ",(0,ke.jsx)("strong",{children:"ODESL\xc1NA KE SCHV\xc1LEN\xcd"}),"."]}),(0,ke.jsx)("p",{children:(0,ke.jsx)("strong",{children:"Opravdu chcete pokra\u010dovat?"})})]}),(0,ke.jsxs)(ve.A,{isOpen:Fr,onClose:()=>Mr(!1),onConfirm:()=>{Mr(!1),(async()=>{const{updatedFormData:e,unlockState:n,newPhase:a}=Jn.unlockPhase2();Wn(e),setTimeout(()=>{Pa(!0),Bs("success","UNLOCK",n,"F\xc1ZE ".concat(a," odem\u010dena, workflow: ").concat(e.stav_workflow_kod))},100)})()},title:"Odemknout zam\xedtnutou objedn\xe1vku",icon:u.zpE,variant:"danger",confirmText:"Ano, odemknout",cancelText:"Zru\u0161it",children:[(0,ke.jsx)("p",{children:"Opravdu chcete odemknout zam\xedtnutou objedn\xe1vku?"}),(0,ke.jsxs)("p",{style:{marginTop:"0.5rem",color:"#dc2626"},children:[(0,ke.jsx)("strong",{children:"\u26a0\ufe0f UPOZORN\u011aN\xcd:"})," Objedn\xe1vka bude odem\u010dena a zp\u0159\xedstupn\u011bna pro dal\u0161\xed pr\u016fb\u011bh workflow."]}),(0,ke.jsx)("p",{style:{marginTop:"0.5rem"},children:"Budete moci prov\xe9st pot\u0159ebn\xe9 \xfapravy a objedn\xe1vku znovu odeslat ke schv\xe1len\xed."})]}),(0,ke.jsxs)(ve.A,{isOpen:Ur,onClose:()=>Zr(!1),onConfirm:()=>{Zr(!1),(async()=>{const{updatedFormData:e,unlockState:n,newPhase:a}=Jn.unlockPhase3();En(!0),setTimeout(()=>{Wn(e),Lp("phase3"),setTimeout(()=>{Pa(!0),Bs("success","UNLOCK",n,"F\xc1ZE ".concat(a," odem\u010dena, workflow: ").concat(e.stav_workflow_kod))},100)},10)})()},title:"\u26a0\ufe0f Odemknout F\xc1ZE 3",icon:u.zpE,variant:"danger",confirmText:"ANO, ODEMKNOUT A SMAZAT",cancelText:"Zru\u0161it",children:[(0,ke.jsxs)("div",{style:{display:"flex",gap:"12px",padding:"12px",backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"6px",marginBottom:"1rem"},children:[(0,ke.jsx)(p.g,{icon:u.zpE,style:{color:"#ef4444",fontSize:"20px",marginTop:"2px"}}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("strong",{children:"Varov\xe1n\xed:"})," Odem\u010den\xed F\xc1ZE 3 vyma\u017ee v\u0161echna data vy\u0161\u0161\xedch f\xe1z\xed (F\xc1ZE 4-10)!"]})]}),(0,ke.jsxs)("p",{children:["Workflow se resetuje na stav ",(0,ke.jsx)("strong",{children:"ODESL\xc1NA"}),"."]}),(0,ke.jsx)("p",{style:{marginTop:"0.5rem"},children:"Opravdu chcete pokra\u010dovat?"})]}),(0,ke.jsxs)(ve.A,{isOpen:Kr,onClose:()=>Br(!1),onConfirm:()=>{Br(!1),Jn.unlockSection("registr_vyplneni");const e=(Array.isArray(Kn.stav_workflow_kod)?Kn.stav_workflow_kod:Kn.stav_workflow_kod?[Kn.stav_workflow_kod]:[]).filter(e=>"UVEREJNENA"!==e);e.includes("UVEREJNIT")||e.push("UVEREJNIT"),e.includes("ODESLANA")||e.push("ODESLANA"),e.includes("POTVRZENA")||e.push("POTVRZENA"),Wn(n=>(0,t.A)((0,t.A)({},n),{},{stav_workflow_kod:e})),Bs("info","UNLOCK","registr-vyplneni","Odem\u010dena sekce Registr smluv - nastaveno UVEREJNIT (F\xc1ZE 5)"),setTimeout(()=>{Pa(!0)},100)},title:"Odemknout sekci Registr smluv",icon:u.zpE,variant:"danger",confirmText:"Odemknout",cancelText:"Zru\u0161it",children:[(0,ke.jsxs)("p",{children:["Opravdu chcete odemknout sekci ",(0,ke.jsx)("strong",{children:"Registr smluv"})," pro editaci?"]}),(0,ke.jsxs)("p",{style:{marginTop:"0.5rem"},children:["Workflow se nastav\xed na F\xc1ZI 5 se stavem ",(0,ke.jsx)("strong",{children:"UVEREJNIT"}),"."]})]}),(0,ke.jsxs)(ve.A,{isOpen:Wr,title:"Odemknout sekci Potvrzen\xed od dodavatele",confirmText:"Ano, odemknout",cancelText:"Zru\u0161it",variant:"warning",icon:u.zpE,onConfirm:()=>{Hr(!1),Jn.unlockSection("potvrzeni"),Jn.unlockSection("registr");const{updatedFormData:e}=Jn.unlockPhase4();Wn(e),Lp("potvrzeni"),setTimeout(()=>{Pa(!0)},100)},onClose:()=>Hr(!1),children:[(0,ke.jsxs)("p",{children:["Opravdu chcete odemknout sekci ",(0,ke.jsx)("strong",{children:"Potvrzen\xed od dodavatele"})," pro editaci?"]}),(0,ke.jsxs)("p",{style:{marginTop:"0.5rem"},children:["Z\xe1rove\u0148 bude odem\u010dena i sekce ",(0,ke.jsx)("strong",{children:"Registr smluv"})," a workflow se vr\xe1t\xed na stav ",(0,ke.jsx)("strong",{children:"ODESL\xc1NA (F\xc1ZE 4)"}),"."]})]}),(0,ke.jsx)(ve.A,{isOpen:$r,title:"Zru\u0161it zve\u0159ejn\u011bn\xed v registru smluv",confirmText:"Ano, od\u0161krtnout",cancelText:"Ne, ponechat za\u0161krtnut\xe9",variant:"danger",icon:u.zpE,onConfirm:()=>{Jr(!1),xp("ma_byt_zverejnena",!1),xp("dt_zverejneni",""),xp("registr_iddt",""),xp("zverejnil_id",null),Bs("info","REGISTR","zrusit-zverejneni","Zru\u0161ena povinnost zve\u0159ejn\u011bn\xed")},onClose:()=>Jr(!1),children:(0,ke.jsxs)("div",{children:[(0,ke.jsxs)("p",{style:{marginBottom:"1rem"},children:["Celkov\xe1 cena objedn\xe1vky je ",(0,ke.jsxs)("strong",{children:[Ks.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d bez DPH"]}),", co\u017e je nad limitem 50 000 K\u010d."]}),(0,ke.jsx)("p",{style:{fontSize:"0.95rem",color:"#dc2626",fontWeight:"600",marginBottom:"0.75rem",padding:"0.75rem",backgroundColor:"#fee2e2",borderRadius:"6px",border:"1px solid #fca5a5"},children:"\u26a0\ufe0f Podle z\xe1kona mus\xed b\xfdt objedn\xe1vka zve\u0159ejn\u011bna v registru smluv."}),(0,ke.jsx)("p",{style:{fontSize:"0.9rem",color:"#6b7280",marginBottom:"0.5rem"},children:"Opravdu chcete od\u0161krtnout checkbox? Tato akce vyma\u017ee vypln\u011bn\xe9 \xfadaje:"}),(0,ke.jsxs)("ul",{style:{fontSize:"0.9rem",color:"#374151",paddingLeft:"1.5rem",margin:0},children:[(0,ke.jsx)("li",{children:"Datum zve\u0159ejn\u011bn\xed"}),(0,ke.jsx)("li",{children:"Identifik\xe1tor"}),(0,ke.jsx)("li",{children:"Zve\u0159ejnil (u\u017eivatel)"})]})]})}),(0,ke.jsxs)(ve.A,{isOpen:Gr,title:"Odemknout sekci Fakturace",confirmText:"Odemknout",variant:"warning",onConfirm:()=>{qr(!1),Jn.unlockSection("fakturace");const e=(Array.isArray(Kn.stav_workflow_kod)?Kn.stav_workflow_kod:Kn.stav_workflow_kod?[Kn.stav_workflow_kod]:[]).filter(e=>!["FAKTURACE","VECNA_SPRAVNOST","ZKONTROLOVANA","DOKONCENA"].includes(e));Wn(n=>(0,t.A)((0,t.A)({},n),{},{stav_workflow_kod:e})),Bs("info","UNLOCK","fakturace","Odem\u010dena sekce Fakturace - odebr\xe1ny stavy FAKTURACE, KONTROLA, ZKONTROLOVANA, DOKONCENA \u2192 F\xc1ZE 6/8"),Lp("fakturace"),setTimeout(()=>{Pa(!0)},100)},onClose:()=>qr(!1),children:[(0,ke.jsxs)("p",{children:["Opravdu chcete odemknout sekci ",(0,ke.jsx)("strong",{children:"Fakturace"})," pro editaci?"]}),(0,ke.jsxs)("p",{style:{marginTop:"0.5rem",color:"#dc2626"},children:["Budou odebr\xe1ny stavy ",(0,ke.jsx)("strong",{children:"FAKTURACE, VECNA_SPRAVNOST, ZKONTROLOVANA, DOKONCENA"})," a workflow se vr\xe1t\xed na ",(0,ke.jsx)("strong",{children:"F\xc1ZI 6/8"}),"."]})]}),(0,ke.jsxs)(ve.A,{isOpen:Yr,title:"Odemknout dokon\u010denou objedn\xe1vku",confirmText:"Ano, odemknout",cancelText:"Zru\u0161it",variant:"warning",icon:u.zpE,onConfirm:()=>{Xr(!1),Bs("info","UNLOCK","dokonceni","\ud83d\udd13 Dokon\u010den\xe1 objedn\xe1vka odem\u010dena");const e=Kn.stav_workflow_kod||"";let n;n=Array.isArray(e)?[...e]:String(e).split(",").map(e=>e.trim()).filter(e=>e),n=n.filter(e=>"DOKONCENA"!==e),n.includes("ZKONTROLOVANA")||n.push("ZKONTROLOVANA"),Wn(e=>(0,t.A)((0,t.A)({},e),{},{potvrzeni_dokonceni_objednavky:0,vecna_spravnost_potvrzeno:1,stav_workflow_kod:n})),Jn.unlockSection("dokonceni"),da(),Bs("info","UNLOCK","completed","\u2705 Objedn\xe1vka odem\u010dena (workflow manager refresh)")},onClose:()=>Xr(!1),children:[(0,ke.jsx)("p",{children:"Opravdu chcete odemknout dokon\u010denou objedn\xe1vku?"}),(0,ke.jsxs)("p",{style:{marginTop:"0.5rem",color:"#16a34a"},children:[(0,ke.jsx)("strong",{children:"\u26a0\ufe0f UPOZORN\u011aN\xcd:"})," Objedn\xe1vka bude zp\u0159\xedstupn\u011bna k \xfaprav\xe1m a oprav\xe1m."]})]}),(0,ke.jsxs)(ve.A,{isOpen:Qr,title:"Odemknout stornovanou objedn\xe1vku",confirmText:"Ano, odemknout",cancelText:"Zru\u0161it",variant:"danger",icon:u.zpE,onConfirm:async()=>{ei(!1),Bs("info","UNLOCK","cancelled","\ud83d\udd13 Odemyk\xe1m stornovanou objedn\xe1vku ID: ".concat(Kn.id));const e=(Kn.stav_workflow_kod||"").split(",").filter(e=>"ZRUSENA"!==e.trim()).join(","),n=(0,t.A)((0,t.A)({},Kn),{},{stav_workflow_kod:e,storno_duvod:null,storno_user_id:null,dt_storno:null,stav_stornovano:0});await Jn.unlockSection("storno"),Wn(n),da(),Bs("info","UNLOCK","cancelled","\u2705 Stornovan\xe1 objedn\xe1vka odem\u010dena, workflow refresh dokon\u010den")},onClose:()=>ei(!1),children:[(0,ke.jsx)("p",{children:"Opravdu chcete odemknout stornovanou objedn\xe1vku?"}),(0,ke.jsxs)("p",{style:{marginTop:"0.5rem",color:"#16a34a"},children:[(0,ke.jsx)("strong",{children:"\u26a0\ufe0f UPOZORN\u011aN\xcd:"})," Objedn\xe1vka bude odem\u010dena a zp\u0159\xedstupn\u011bna pro dal\u0161\xed pr\u016fb\u011bh workflow."]}),(0,ke.jsx)("p",{style:{marginTop:"0.5rem"},children:"Budete moci prov\xe9st pot\u0159ebn\xe9 \xfapravy nebo opravy."})]}),co.isOpen&&(0,ke.jsx)(ve.A,{isOpen:co.isOpen,title:co.title,message:co.message,confirmText:"Ano, odemknout",cancelText:"Zru\u0161it",variant:"danger",icon:u.zpE,onConfirm:()=>{co.onConfirm&&co.onConfirm(),po({isOpen:!1,title:"",message:"",onConfirm:null})},onClose:()=>po({isOpen:!1,title:"",message:"",onConfirm:null})}),(0,ke.jsx)(Ue,{isOpen:wt,onClose:()=>{St(!1),Ct(null)},onSave:async function(e,n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{let o,t;"personal"===n?(o=Ae,t=""):"usek"===n?(o=0,t=a||[]):(o=0,t="");const r={nazev:e.nazev||e.dodavatel_nazev||"",adresa:e.adresa||e.dodavatel_adresa||"",ico:e.ico||e.dodavatel_ico||"",dic:e.dic||e.dodavatel_dic||"",zastoupeny:e.zastoupeny||e.dodavatel_zastoupeny||"",kontakt_jmeno:e.kontakt_jmeno||e.dodavatel_kontakt_jmeno||"",kontakt_email:e.kontakt_email||e.dodavatel_kontakt_email||"",kontakt_telefon:e.kontakt_telefon||e.dodavatel_kontakt_telefon||"",user_id:o,usek_zkr:t};let i;null!==Et&&void 0!==Et&&Et.exists&&n===Et.scope?(i=await(0,me.aj)({token:Se,username:we,user_id:o,usek_zkr:t,ico:r.ico,nazev:r.nazev,adresa:r.adresa,dic:r.dic,zastoupeny:r.zastoupeny,kontakt_jmeno:r.kontakt_jmeno,kontakt_email:r.kontakt_email,kontakt_telefon:r.kontakt_telefon}),null===je||void 0===je||je("Dodavatel byl \xfasp\u011b\u0161n\u011b aktualizov\xe1n v adres\xe1\u0159i","success")):(i=await(0,me.jx)({token:Se,username:we,user_id:o,usek_zkr:t,nazev:r.nazev,adresa:r.adresa,ico:r.ico,dic:r.dic,zastoupeny:r.zastoupeny,kontakt_jmeno:r.kontakt_jmeno,kontakt_email:r.kontakt_email,kontakt_telefon:r.kontakt_telefon}),null===je||void 0===je||je("Dodavatel byl \xfasp\u011b\u0161n\u011b p\u0159id\xe1n do adres\xe1\u0159e","success")),No([]),St(!1),Ct(null)}catch(o){throw new Error(o.message||"Chyba p\u0159i ukl\xe1d\xe1n\xed dodavatele do datab\xe1ze")}},supplierData:{dodavatel_nazev:Kn.dodavatel_nazev,dodavatel_adresa:Kn.dodavatel_adresa,dodavatel_ico:Kn.dodavatel_ico,dodavatel_dic:Kn.dodavatel_dic,dodavatel_zastoupeny:Kn.dodavatel_zastoupeny,dodavatel_kontakt_jmeno:Kn.dodavatel_kontakt_jmeno,dodavatel_kontakt_email:Kn.dodavatel_kontakt_email,dodavatel_kontakt_telefon:Kn.dodavatel_kontakt_telefon},existsInPersonal:(null===Et||void 0===Et?void 0:Et.existsInPersonal)||null,existsInUsek:(null===Et||void 0===Et?void 0:Et.existsInUsek)||null,existsInGlobal:(null===Et||void 0===Et?void 0:Et.existsInGlobal)||null,userPermissions:{canAddPersonal:Oe&&(Oe("CONTACT_MANAGE")||Oe("CONTACT_EDIT")),canAddUsek:Oe&&(Oe("CONTACT_MANAGE")||Oe("CONTACT_EDIT")),canAddGlobal:Oe&&Oe("CONTACT_MANAGE")}}),Oe("HELPER_VIEW")&&(0,ke.jsx)(Ze.A,{pageContext:"orderDetail"}),Dt&&(0,ke.jsx)(ut.DocxGeneratorModal,{order:It,isOpen:Dt,onClose:Np}),(rt||Zt)&&(0,ke.jsx)(xl,{$visible:!0})]});return tn?s.createPortal($p,document.body):$p}const Gc=i.memo(Jc),qc=l.A.div(Ws||(Ws=(0,r.A)(["\n  position: relative;\n  width: 100%;\n"]))),Yc=l.A.button(Hs||(Hs=(0,r.A)(["\n  width: 100%;\n  min-height: 2.5rem;\n  padding: 0.75rem 3rem 0.75rem ",";\n  background: white;\n  border: 2px solid ",";\n  border-radius: 8px;\n  font-size: 0.875rem;\n  text-align: left;\n  cursor: ",";\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  font-family: inherit;\n  font-weight: ",";\n  color: ",";\n\n  &:hover:not(:disabled) {\n    border-color: ",";\n  }\n\n  &:focus {\n    outline: none;\n    border-color: ",";\n    box-shadow: 0 0 0 3px ",";\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    cursor: not-allowed;\n  }\n\n  /* Chevron ikona */\n  &::after {\n    content: '';\n    position: absolute;\n    right: 12px;\n    top: 50%;\n    transform: translateY(-50%) rotate(",");\n    width: 0;\n    height: 0;\n    border-left: 4px solid transparent;\n    border-right: 4px solid transparent;\n    border-top: 4px solid #6b7280;\n    transition: transform 0.2s ease;\n  }\n"])),e=>e.hasIcon?"3rem":"1rem",e=>e.hasError?"#dc2626":e.isOpen?"#3b82f6":"#e5e7eb",e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?"400":e.hasValue?"600":"400",e=>e.disabled?"#9ca3af":e.hasValue?"#1f2937":"#6b7280",e=>e.hasError?"#dc2626":"#3b82f6",e=>e.hasError?"#dc2626":"#3b82f6",e=>e.hasError?"rgba(220, 38, 38, 0.1)":"rgba(59, 130, 246, 0.1)",e=>e.isOpen?"180deg":"0deg"),Xc=l.A.div($s||($s=(0,r.A)(["\n  position: fixed;\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n  max-height: 300px;\n  overflow-y: auto;\n  z-index: 4000;\n  min-width: 200px;\n\n  /* Optimalizace pro plynul\xe9 scrollov\xe1n\xed */\n  scroll-behavior: smooth;\n  overscroll-behavior: contain;\n\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #f8f9fa;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background: #9ca3af;\n  }\n"]))),Qc=l.A.div(Js||(Js=(0,r.A)(["\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  padding: 0.5rem;\n  border-bottom: 1px solid #f3f4f6;\n  background: #f8f9fa;\n"]))),ep=l.A.input(Gs||(Gs=(0,r.A)(["\n  width: 100%;\n  padding: 0.5rem 0.75rem 0.5rem 2.5rem;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  font-size: 0.875rem;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n  }\n"]))),np=l.A.div(qs||(qs=(0,r.A)(["\n  position: absolute;\n  left: 1rem;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #9ca3af;\n  pointer-events: none;\n"]))),ap=l.A.div(Ys||(Ys=(0,r.A)(["\n  padding: ",";\n  cursor: ",";\n  font-size: 0.875rem;\n  color: ",";\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  background: ",";\n  border-left: ",";\n  border-bottom: ",";\n  font-weight: "," !important; /* Bold jen pro vybranou mo\u017enost */\n  /* Focusable pro tab navigaci */\n  outline: none;\n\n  &:hover {\n    background: ",";\n    font-weight: ",' !important; /* Z\u016fst\xe1v\xe1 stejn\xe9 i p\u0159i hover */\n  }\n\n  &:focus {\n    background: #dbeafe;\n    box-shadow: inset 0 0 0 2px #3b82f6;\n  }\n\n  &:last-child {\n    border-bottom-left-radius: 8px;\n    border-bottom-right-radius: 8px;\n  }\n\n  input[type="checkbox"] {\n    margin: 0;\n    cursor: pointer;\n  }\n\n  span {\n    padding-left: ',"px;\n    font-weight: "," !important; /* Bold jen pro vybranou mo\u017enost */\n  }\n"])),e=>0===e.level?"0.75rem 1rem":"0.5rem 1rem 0.5rem 2rem",e=>e.isHeader?"default":"pointer",e=>0===e.level?"#111827":"#4b5563",e=>e.isHeader?"#f9fafb":e.selected?"#eff6ff":"white",e=>e.selected?"3px solid #3b82f6":"3px solid transparent",e=>0===e.level?"1px solid #e5e7eb":"none",e=>e.selected?"600":"400",e=>e.isHeader?"#f3f4f6":e.selected?"#dbeafe":"#f8fafc",e=>e.selected?"600":"400",e=>20*(e.level||0),e=>e.selected?"600":"400"),op=l.A.span(Xs||(Xs=(0,r.A)(["\n  flex: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n"]))),tp=e=>e?e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"",rp=i.memo(e=>{let{value:n,onChange:a,onBlur:o,options:t=[],placeholder:r="Vyberte...",disabled:s=!1,hasError:d=!1,required:l=!1,field:c,loading:p=!1,loadingText:u="Na\u010d\xedt\xe1n\xed...",icon:v=null,multiple:_=!1,isClearable:m=!1,getOptionLabel:k,getOptionValue:f,hasTriedToSubmit:h=!1}=e;const[b,g]=(0,i.useState)(!1),[x,j]=(0,i.useState)(""),[z,A]=(0,i.useState)(0),S=(0,i.useRef)(null),E=(0,i.useRef)(null),C=(0,i.useRef)(null),O=(0,i.useRef)(null),N=(0,i.useRef)(!1),D=_?Array.isArray(n)?n:[]:n,T=(0,i.useMemo)(()=>{if(!x||p)return t;const e=tp(x);return t.filter(n=>{let a;a=k?k(n,c):"strediska"===c||"strediska_kod"===c?n.label||n.name||n.nazev_stavu||String(n):"lp_kod"===c?n.cislo_lp?"".concat(n.cislo_lp," - ").concat(n.nazev_uctu||""):n.label||String(n):n.label||n.nazev||n.name||String(n);return tp(a).includes(e)})},[t,x,p,k,c]),I=(0,i.useMemo)(()=>{if(_){if(0===D.length)return r;return D.map(e=>{const n=t.find(n=>(f?f(n,c):n.id||n.value||n.kod_stavu||n.kod||n)==e);return n?k?k(n,c):"strediska"===c||"strediska_kod"===c?n.label||n.name||n.nazev_stavu||String(n):"lp_kod"===c?n.label||(n.cislo_lp?"".concat(n.cislo_lp," - ").concat(n.nazev_uctu||""):String(n)):n.label||n.nazev||n.name||String(n):String(e)}).join(", ")}{if(!D)return r;const e=t.find(e=>(f?f(e,c):e.id||e.value||e.kod_stavu||e.kod||e)==D);return e?k?k(e,c):e.label||e.nazev||e.name||String(e):"prikazce"!==c&&"schvalovatel"!==c||0!==D&&null!==D&&"0"!==D?String(D):"Nezn\xe1m\xfd"}},[D,t,r,_,k,f,c]);(0,i.useEffect)(()=>{const e=e=>{S.current&&!S.current.contains(e.target)&&(g(!1),j(""))};if(b)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[b]),(0,i.useEffect)(()=>{b&&O.current&&T.length>0&&setTimeout(()=>{var e;return null===(e=O.current)||void 0===e?void 0:e.focus()},100)},[b,T.length]),(0,i.useEffect)(()=>{if(!S.current)return;const e=()=>{var e;(null===(e=S.current)||void 0===e?void 0:e.hasAttribute("data-voice-input"))&&!N.current&&(N.current=!0)};e(),x&&e()},[x,c]),(0,i.useEffect)(()=>{if(b&&x&&1===T.length&&!_&&N.current){const e=setTimeout(()=>{const e=T[0],n=f?f(e,c):e.id||e.value||e;D!==n&&(a(n),o&&o(c,n),g(!1),j(""),N.current=!1,S.current&&S.current.removeAttribute("data-voice-input"))},500);return()=>clearTimeout(e)}},[b,x,T,_,f,c,D,a,o]),(0,i.useEffect)(()=>{if(b&&E.current&&C.current){const e=()=>{if(!E.current||!C.current)return;const e=E.current.getBoundingClientRect(),n=C.current,a=window.innerHeight-e.bottom-54-20,o=e.top-20,t=a<200||a<300&&o>a+50;n.style.left=e.left+"px",n.style.width=e.width+"px",n.style.maxHeight="300px",t?(n.style.bottom=window.innerHeight-e.top+2+"px",n.style.top="auto"):(n.style.top=e.bottom+2+"px",n.style.bottom="auto")};e();const n=n=>{C.current&&!C.current.contains(n.target)&&e()};return window.addEventListener("scroll",n,{passive:!0,capture:!0}),window.addEventListener("resize",e,{passive:!0}),()=>{window.removeEventListener("scroll",n,{capture:!0}),window.removeEventListener("resize",e)}}},[b]),(0,i.useEffect)(()=>{C.current&&z>0&&(C.current.scrollTop=z)},[T,z]);const P=e=>{C.current&&A(C.current.scrollTop);const n=f?f(e,c):e.id||e.value||e;if(_){const e=Array.isArray(D)?D:[],t=e.includes(n)?e.filter(e=>e!==n):[...e,n];a(t),o&&o(c,t)}else a(n),o&&o(c,n),g(!1),j(""),N.current=!1,S.current&&S.current.removeAttribute("data-voice-input")},R=_?Array.isArray(D)&&D.length>0:!!D,L=d||l&&!R&&!p&&!s&&h;return(0,ke.jsxs)(qc,{ref:S,"data-stable-select":!0,"data-field":c,children:[(0,ke.jsxs)(Yc,{ref:E,type:"button",onClick:()=>{if(s)return;g(!b),b&&j("")},disabled:s,hasError:L,isOpen:b,hasValue:R,hasIcon:!!v,"data-field":c,children:[v&&(0,ke.jsx)("span",{style:{position:"absolute",left:"12px",color:"#9ca3af",width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:i.cloneElement(v,{size:16})}),(0,ke.jsx)(op,{title:I,children:(()=>{if("druh_objednavky_kod"===c&&D){const e=t.find(e=>(f?f(e,c):e.id||e.value||e.kod_stavu||e.kod||e)==D);if(e&&(1===e.atribut_objektu||"1"===e.atribut_objektu)){const e=I.replace("   (majetek)","");return(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsx)("span",{children:e}),(0,ke.jsx)("span",{style:{marginLeft:"8px",fontSize:"0.75rem",color:"#dc2626",fontWeight:"500",padding:"2px 6px",backgroundColor:"#fee2e2",borderRadius:"4px",border:"1px solid #fca5a5"},children:"(majetek)"})]})}}return I})()}),m&&!s&&R&&(0,ke.jsx)("span",{role:"button",tabIndex:0,onClick:e=>{e.stopPropagation();a(_?[]:"")},onKeyDown:e=>{if("Enter"===e.key||" "===e.key){e.preventDefault(),e.stopPropagation();a(_?[]:"")}},title:"Smazat hodnotu",style:{position:"absolute",right:"32px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",padding:"4px",cursor:"pointer",color:"#6b7280",display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px",borderRadius:"4px",transition:"all 0.2s ease",zIndex:2},onMouseEnter:e=>{e.currentTarget.style.background="#f3f4f6",e.currentTarget.style.color="#374151"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="#6b7280"},children:(0,ke.jsx)(w.A,{size:14})})]}),b&&!s&&(0,ke.jsxs)(Xc,{ref:C,children:[(0,ke.jsxs)(Qc,{children:[(0,ke.jsx)(np,{children:(0,ke.jsx)(y.A,{size:16})}),(0,ke.jsx)(ep,{ref:O,type:"text",placeholder:"Vyhledat...",value:x,onChange:e=>{e.nativeEvent.inputType&&e.nativeEvent.inputType.startsWith("insert")&&(N.current=!1),j(e.target.value)},onClick:e=>e.stopPropagation(),onKeyDown:e=>{if("ArrowDown"===e.key){if(e.preventDefault(),T.length>0){var n;const e=null===(n=C.current)||void 0===n?void 0:n.querySelector('[role="option"]:not([tabindex="-1"])');e&&e.focus()}}else if("ArrowUp"===e.key){if(e.preventDefault(),T.length>0){var a;const e=Array.from((null===(a=C.current)||void 0===a?void 0:a.querySelectorAll('[role="option"]:not([tabindex="-1"])'))||[]),n=e[e.length-1];n&&n.focus()}}else if("Tab"===e.key)if(T.length>0){var o;e.preventDefault();const n=null===(o=C.current)||void 0===o?void 0:o.querySelector('[role="option"], [class*="SelectOption"]');n&&n.focus()}else g(!1);else"Escape"===e.key?(e.preventDefault(),g(!1),E.current&&E.current.focus()):"Enter"===e.key&&(e.preventDefault(),e.stopPropagation())}})]}),p?(0,ke.jsx)(ap,{children:u}):T.length>0?T.map((e,n)=>{const a=f?f(e,c):e.id||e.value||e;let o;o=k?k(e,c):"strediska"===c||"strediska_kod"===c?e.label||e.name||e.nazev_stavu||String(e):"lp_kod"===c?e.cislo_lp?"".concat(e.cislo_lp," - ").concat(e.nazev_uctu||""):e.label||String(e):e.label||e.nazev||e.name||String(e);const t=(e=>{const n=f?f(e,c):e.id||e.value||e;return _?D.includes(n):D===n})(e),r=e.level||0,i=e.isHeader||0===r&&!e.value&&!e.id,s="druh_objednavky_kod"===c&&(1===e.atribut_objektu||"1"===e.atribut_objektu);return(0,ke.jsxs)(ap,{selected:t,level:r,isHeader:i,tabIndex:i?-1:0,role:"option","aria-selected":t,onClick:n=>{n.preventDefault(),n.stopPropagation(),i||P(e)},onKeyDown:n=>{if("Enter"===n.key||" "===n.key)n.preventDefault(),i||P(e);else if("ArrowDown"===n.key){var a;n.preventDefault();const e=Array.from((null===(a=C.current)||void 0===a?void 0:a.querySelectorAll('[role="option"]:not([tabindex="-1"])'))||[]),t=e.indexOf(n.target)+1;var o;if(t<e.length)e[t].focus();else null===(o=e[0])||void 0===o||o.focus()}else if("ArrowUp"===n.key){var t;n.preventDefault();const e=Array.from((null===(t=C.current)||void 0===t?void 0:t.querySelectorAll('[role="option"]:not([tabindex="-1"])'))||[]),a=e.indexOf(n.target)-1;var r;if(a>=0)e[a].focus();else if(O.current)O.current.focus();else null===(r=e[e.length-1])||void 0===r||r.focus()}else if("Escape"===n.key)n.preventDefault(),g(!1),E.current&&E.current.focus();else if("Tab"===n.key){var s;const e=Array.from((null===(s=C.current)||void 0===s?void 0:s.querySelectorAll('[role="option"]:not([tabindex="-1"])'))||[]),a=e.indexOf(n.target);n.shiftKey?0===a&&(n.preventDefault(),O.current&&O.current.focus()):a===e.length-1&&(n.preventDefault(),g(!1))}},children:[_&&!i&&(0,ke.jsx)("input",{type:"checkbox",checked:t,readOnly:!0,onChange:()=>{}}),s?(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsx)("span",{children:o.replace("   (majetek)","")}),(0,ke.jsx)("span",{style:{marginLeft:"8px",fontSize:"0.75rem",color:"#dc2626",fontWeight:"500",padding:"2px 6px",backgroundColor:"#fee2e2",borderRadius:"4px",border:"1px solid #fca5a5"},children:"(majetek)"})]}):(0,ke.jsx)("span",{children:o})]},a||n)}):(0,ke.jsx)(ap,{children:"\u017d\xe1dn\xe9 v\xfdsledky"})]})]})},(e,n)=>e.value===n.value&&(e.placeholder===n.placeholder&&(e.disabled===n.disabled&&(e.hasError===n.hasError&&(e.required===n.required&&(e.field===n.field&&(e.loading===n.loading&&(e.loadingText===n.loadingText&&(e.multiple===n.multiple&&(e.hasTriedToSubmit===n.hasTriedToSubmit&&(e.options.length===n.options.length&&(e.options===n.options&&(e.icon===n.icon&&(e.onChange===n.onChange&&(e.onBlur===n.onBlur&&(e.getOptionLabel===n.getOptionLabel&&e.getOptionValue===n.getOptionValue))))))))))))))))},7118:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},14459:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},28006:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},35087:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},35327:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},39292:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},50516:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},54153:(e,n,a)=>{function o(e){if(!e||"string"!==typeof e)return e||"Nezn\xe1m\xe1 chyba";if(e.includes("timeout")&&e.includes("exceeded")){const n=e.match(/timeout of (\d+)ms exceeded/);if(n){const e=n[1],a=Math.round(e/1e3);return"P\u0159ekro\u010den \u010dasov\xfd limit ".concat(a,"s - server neodpov\u011bd\u011bl v\u010das")}return"P\u0159ekro\u010den \u010dasov\xfd limit - server neodpov\u011bd\u011bl v\u010das"}return e.includes("Network Error")?"Chyba s\xedt\u011b - zkontrolujte internetov\xe9 p\u0159ipojen\xed":e.includes("Request failed with status code 500")?"Chyba serveru (k\xf3d 500) - zkuste to znovu pozd\u011bji":e.includes("Request failed with status code 404")?"Po\u017eadovan\xfd zdroj nebyl nalezen (k\xf3d 404)":e.includes("Request failed with status code 403")?"Nem\xe1te opr\xe1vn\u011bn\xed k t\xe9to operaci (k\xf3d 403)":e.includes("Request failed with status code 401")?"Neautorizovan\xfd p\u0159\xedstup - zkuste se znovu p\u0159ihl\xe1sit (k\xf3d 401)":e.includes("ECONNREFUSED")||e.includes("connection refused")?"Nelze se p\u0159ipojit k serveru - server je pravd\u011bpodobn\u011b nedostupn\xfd":e.includes("ENOTFOUND")||e.includes("getaddrinfo ENOTFOUND")?"Server nenalezen - zkontrolujte adresu serveru":e}function t(e){if(!e||"string"!==typeof e)return e||"Nezn\xe1m\xe1 chyba";if(e.includes("timeout")&&e.includes("exceeded")){const n=e.match(/timeout of (\d+)ms exceeded/);if(n){const e=n[1],a=Math.round(e/1e3);return"P\u0159ekro\u010den \u010dasov\xfd limit ".concat(a,"s")}return"P\u0159ekro\u010den \u010dasov\xfd limit"}return o(e)}a.d(n,{E:()=>o,g:()=>t})},56804:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]])},65727:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},71360:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},77220:(e,n,a)=>{a.d(n,{Bn:()=>h,Fl:()=>p,SJ:()=>v,aF:()=>m,gy:()=>l,hu:()=>d,iE:()=>s,oO:()=>f,pi:()=>u,pq:()=>c,sw:()=>y,vh:()=>_});var o=a(89379);const t=a(56263).A.create({baseURL:"".concat("https://erdms.zachranka.cz/api.eeo/"),headers:{"Content-Type":"application/json"}}),r=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Chyba serveru";if(!e.response)throw e.request?new Error("Server neodpov\xedd\xe1. Zkontrolujte p\u0159ipojen\xed."):new Error(e.message||n);{const{status:a,data:o}=e.response,t=(null===o||void 0===o?void 0:o.err)||(null===o||void 0===o?void 0:o.error)||(null===o||void 0===o?void 0:o.message)||n;switch(a){case 401:throw new Error("Neplatn\xfd token. P\u0159ihlaste se znovu.");case 403:throw new Error("Nem\xe1te opr\xe1vn\u011bn\xed k t\xe9to akci.");case 404:throw new Error("Z\xe1znam nebyl nalezen.");default:throw new Error(t)}}},i=function(e){var n,a,o;let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"operace";if(null!==(n=e.data)&&void 0!==n&&n.err)throw new Error(e.data.err);if("error"===(null===(a=e.data)||void 0===a?void 0:a.status))throw new Error(e.data.message||"".concat(t," se nezda\u0159ila"));if("ok"!==(null===(o=e.data)||void 0===o?void 0:o.status))throw new Error("".concat(t," se nezda\u0159ila - neplatn\xfd status"));return e.data};async function s(e){let{token:n,username:a,show_inactive:o=!1,usek_id:s=null,druh_smlouvy:d=null,stav:l=null,search:c=null,platnost_od:p=null,platnost_do:u=null,limit:v=1e3,offset:_=0}=e;try{const e={username:a,token:n,show_inactive:o,usek_id:s,druh_smlouvy:d,stav:l,search:c,platnost_od:p,platnost_do:u,limit:v,offset:_},r=await t.post("ciselniky/smlouvy/list",e);return i(r,"Na\u010d\xedt\xe1n\xed smluv")}catch(m){throw r(m,"Chyba p\u0159i na\u010d\xedt\xe1n\xed smluv"),m}}async function d(e){let{token:n,username:a,id:o}=e;try{const e=await t.post("ciselniky/smlouvy/detail",{username:a,token:n,id:o});return i(e,"Na\u010d\xedt\xe1n\xed detailu smlouvy").data||null}catch(s){throw r(s,"Chyba p\u0159i na\u010d\xedt\xe1n\xed detailu smlouvy"),s}}async function l(e){let{token:n,username:a,smlouvaData:s}=e;try{const e=await t.post("ciselniky/smlouvy/insert",(0,o.A)({username:a,token:n},s));return i(e,"Vytv\xe1\u0159en\xed smlouvy").data}catch(d){throw r(d,"Chyba p\u0159i vytv\xe1\u0159en\xed smlouvy"),d}}async function c(e){let{token:n,username:a,id:s,smlouvaData:d}=e;try{const e=await t.post("ciselniky/smlouvy/update",(0,o.A)({username:a,token:n,id:s},d));return i(e,"Aktualizace smlouvy").data}catch(l){throw r(l,"Chyba p\u0159i aktualizaci smlouvy"),l}}async function p(e){let{token:n,username:a,id:o}=e;try{const e=await t.post("ciselniky/smlouvy/delete",{username:a,token:n,id:o});return i(e,"Maz\xe1n\xed smlouvy").data}catch(s){throw r(s,"Chyba p\u0159i maz\xe1n\xed smlouvy"),s}}async function u(e){let{token:n,username:a,data:o,overwrite_existing:s=!1,nazev_souboru:d=null,typ_souboru:l=null,velikost_souboru:c=null}=e;try{const e=await t.post("ciselniky/smlouvy/bulk-import",{username:a,token:n,data:o,overwrite_existing:s,nazev_souboru:d,typ_souboru:l,velikost_souboru:c});return i(e,"Import smluv").data}catch(p){throw r(p,"Chyba p\u0159i importu smluv"),p}}async function v(e){let{token:n,username:a,cislo_smlouvy:o=null,usek_id:s=null}=e;try{const e=await t.post("ciselniky/smlouvy/prepocet-cerpani",{username:a,token:n,cislo_smlouvy:o,usek_id:s});return i(e,"P\u0159epo\u010det \u010derp\xe1n\xed").data}catch(d){throw r(d,"Chyba p\u0159i p\u0159epo\u010dtu \u010derp\xe1n\xed"),d}}const _=[{value:"SLU\u017dBY",label:"Smlouva o poskytov\xe1n\xed slu\u017eeb"},{value:"KUPN\xcd",label:"Kupn\xed smlouva"},{value:"R\xc1MCOV\xc1",label:"R\xe1mcov\xe1 smlouva"}],m=[{value:"AKTIVNI",label:"Platn\xe1",color:"#10b981",icon:"\u2705",popis:"Smlouva je v platnosti a lze ji pou\u017e\xedvat"},{value:"UKONCENA",label:"Vypr\u0161ela",color:"#dc2626",icon:"\u26d4",popis:"Smlouva p\u0159ekro\u010dila datum konce platnosti"},{value:"PRERUSENA",label:"P\u0159eru\u0161ena",color:"#f59e0b",icon:"\u23f8\ufe0f",popis:"Smlouva je do\u010dasn\u011b pozastavena"},{value:"PRIPRAVOVANA",label:"P\u0159ipraven\xe1",color:"#f97316",icon:"\u23f3",popis:"Smlouva \u010dek\xe1 na za\u010d\xe1tek platnosti"},{value:"NEAKTIVNI",label:"Neaktivn\xed",color:"#6b7280",icon:"\ud83d\udeab",popis:"Smlouva je deaktivov\xe1na (soft delete)"}],k=e=>m.find(n=>n.value===e)||{value:e,label:e,color:"#6b7280",icon:"\u2753"},f=e=>k(e).label,h=e=>k(e).color,y=[{value:0,label:"0% (osvobozeno)"},{value:12,label:"12% (sn\xed\u017een\xe1)"},{value:21,label:"21% (z\xe1kladn\xed)"}]},87260:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]])},91286:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]])},92382:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},99432:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]])}}]);
//# sourceMappingURL=6418.cb5a7547.chunk.js.map