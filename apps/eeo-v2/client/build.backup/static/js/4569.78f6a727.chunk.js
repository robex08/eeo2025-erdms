"use strict";(self.webpackChunkr_app_zzs_eeo=self.webpackChunkr_app_zzs_eeo||[]).push([[4569],{4569:(n,e,t)=>{t.d(e,{r6:()=>yt});var a,o,i,r,s,l,d,c,p,f,u=t(57528),m=t(65043),g=t(97950),x=t(45903),h=t(30264),y=t(70579);x.A.div(a||(a=(0,u.A)(["\n  position: relative;\n  width: 100%;\n"]))),x.A.div(o||(o=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 24px;\n  border: 2px dashed ",";\n  border-radius: 8px;\n  background: ",";\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &:hover {\n    border-color: ",";\n    background: ",";\n  }\n\n  ","\n"])),n=>n.error?"#fca5a5":n.isDragging?"#3b82f6":"#cbd5e1",n=>n.error?"#fef2f2":n.isDragging?"#eff6ff":"#f8fafc",n=>n.error?"#f87171":"#3b82f6",n=>n.error?"#fee2e2":"#eff6ff",n=>n.uploading&&"\n    opacity: 0.7;\n    pointer-events: none;\n  "),x.A.div(i||(i=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  background: ",";\n  color: ",";\n\n  svg {\n    width: 24px;\n    height: 24px;\n  }\n"])),n=>n.error?"#fee2e2":n.isDragging?"#dbeafe":"#e0e7ff",n=>n.error?"#dc2626":n.isDragging?"#3b82f6":"#4f46e5"),x.A.div(r||(r=(0,u.A)(["\n  text-align: center;\n"]))),x.A.div(s||(s=(0,u.A)(["\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: ",";\n  margin-bottom: 4px;\n"])),n=>n.error?"#dc2626":"#1f2937"),x.A.div(l||(l=(0,u.A)(["\n  font-size: 0.75rem;\n  color: #6b7280;\n"]))),x.A.input(d||(d=(0,u.A)(["\n  display: none;\n"]))),x.A.div(c||(c=(0,u.A)(["\n  width: 100%;\n  height: 4px;\n  background: #e5e7eb;\n  border-radius: 2px;\n  overflow: hidden;\n  margin-top: 12px;\n"]))),x.A.div(p||(p=(0,u.A)(["\n  height: 100%;\n  background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);\n  border-radius: 2px;\n  transition: width 0.3s ease;\n  width: ","%;\n"])),n=>n.progress),x.A.div(f||(f=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  margin-top: 12px;\n  background: ",";\n  border: 1px solid ",";\n  color: ",";\n\n  svg {\n    width: 18px;\n    height: 18px;\n    flex-shrink: 0;\n  }\n"])),n=>"error"===n.type?"#fef2f2":"#f0fdf4",n=>"error"===n.type?"#fecaca":"#bbf7d0",n=>"error"===n.type?"#dc2626":"#16a34a");var v,b,k;x.A.div(v||(v=(0,u.A)(["\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 4px 10px;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  background: ",";\n  color: ",";\n  border: 1px solid ",";\n  transition: all 0.2s ease;\n  cursor: ",";\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n\n  &:hover {\n    ","\n  }\n"])),n=>n.detected?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"#e5e7eb",n=>n.detected?"#ffffff":"#6b7280",n=>n.detected?"#059669":"#d1d5db",n=>n.onClick?"pointer":"default",n=>n.onClick&&"\n      transform: translateY(-1px);\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    "),x.A.div(b||(b=(0,u.A)(["\n  position: relative;\n  display: inline-block;\n"]))),x.A.div(k||(k=(0,u.A)(["\n  position: absolute;\n  bottom: calc(100% + 8px);\n  left: 50%;\n  transform: translateX(-50%);\n  background: #1f2937;\n  color: #ffffff;\n  padding: 8px 12px;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  white-space: nowrap;\n  z-index: 1000;\n  opacity: ",";\n  visibility: ",";\n  transition: opacity 0.2s ease, visibility 0.2s ease;\n  pointer-events: none;\n\n  &::after {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    border: 6px solid transparent;\n    border-top-color: #1f2937;\n  }\n"])),n=>n.show?1:0,n=>n.show?"visible":"hidden");var _,A,j,w,z,C,S,D,P,I;x.A.div(_||(_=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  background: ",";\n  border: 1px solid ",";\n  border-radius: 8px;\n  transition: all 0.2s ease;\n  gap: 12px;\n\n  &:hover {\n    ","\n  }\n\n  ","\n"])),n=>n.deleting?"#fef2f2":"#ffffff",n=>n.deleting?"#fecaca":"#e5e7eb",n=>!n.deleting&&"\n      border-color: #cbd5e1;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n    ",n=>n.deleting&&"\n    opacity: 0.6;\n    pointer-events: none;\n  "),x.A.div(A||(A=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  flex: 1;\n  min-width: 0;\n"]))),x.A.div(j||(j=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  border-radius: 8px;\n  color: #ffffff;\n  flex-shrink: 0;\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n"]))),x.A.div(w||(w=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  min-width: 0;\n  flex: 1;\n"]))),x.A.div(z||(z=(0,u.A)(["\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #1f2937;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n"]))),x.A.div(C||(C=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 0.75rem;\n  color: #6b7280;\n  flex-wrap: wrap;\n"]))),x.A.span(S||(S=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 4px;\n\n  &::before {\n    content: '\u2022';\n    margin-right: 4px;\n\n    &:first-of-type {\n      display: none;\n    }\n  }\n\n  &:first-of-type::before {\n    display: none;\n  }\n"]))),x.A.div(D||(D=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  flex-shrink: 0;\n"]))),x.A.button(P||(P=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 36px;\n  height: 36px;\n  border: none;\n  border-radius: 6px;\n  background: ",";\n  color: ",";\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n\n  &:hover {\n    background: ",";\n    transform: translateY(-1px);\n  }\n\n  &:active {\n    transform: translateY(0);\n  }\n\n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    transform: none;\n  }\n"])),n=>"danger"===n.variant?"#fef2f2":"#f3f4f6",n=>"danger"===n.variant?"#dc2626":"#6b7280",n=>"danger"===n.variant?"#fee2e2":"#e5e7eb"),x.A.div(I||(I=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 12px;\n  background: #fef2f2;\n  border: 1px solid #fecaca;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  color: #dc2626;\n  margin-top: 8px;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    flex-shrink: 0;\n  }\n"])));var F,O,R,N,T,E,L,B,W,V,M,U,K,H,Z,q,Y,X,G,J,Q,$,nn,en,tn,an,on,rn,sn,ln,dn,cn,pn,fn,un,mn,gn,xn=t(41680),hn=t(40614),yn=t(57856),vn=t(28646),bn=t(56790),kn=t(95264),_n=t(81990),An=t(77819),jn=t(82054);const wn=n=>{if(!n)return"---";try{const e=new Date(n);if(isNaN(e))return n;const t=String(e.getDate()).padStart(2,"0"),a=String(e.getMonth()+1).padStart(2,"0"),o=e.getFullYear();return"".concat(t,".").concat(a,".").concat(o)}catch(e){return n}},zn=x.A.div(F||(F=(0,u.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n  animation: fadeIn 0.2s ease;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n"]))),Cn=x.A.div(O||(O=(0,u.A)(["\n  background: #ffffff;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  max-width: 1100px;\n  width: 95%;\n  max-height: 85vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp 0.3s ease;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n"]))),Sn=x.A.div(R||(R=(0,u.A)(["\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  color: #ffffff;\n  padding: 24px;\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  position: relative;\n"]))),Dn=x.A.button(N||(N=(0,u.A)(["\n  position: absolute;\n  top: 16px;\n  right: 16px;\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  border-radius: 6px;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: background 0.2s;\n  color: #ffffff;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n"]))),Pn=x.A.div(T||(T=(0,u.A)(["\n  width: 48px;\n  height: 48px;\n  border-radius: 10px;\n  background: rgba(255, 255, 255, 0.2);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  svg {\n    width: 28px;\n    height: 28px;\n  }\n"]))),In=x.A.div(E||(E=(0,u.A)(["\n  flex: 1;\n"]))),Fn=x.A.h2(L||(L=(0,u.A)(["\n  margin: 0;\n  font-size: 1.375rem;\n  font-weight: 700;\n"]))),On=x.A.p(B||(B=(0,u.A)(["\n  margin: 4px 0 0 0;\n  font-size: 0.875rem;\n  opacity: 0.95;\n"]))),Rn=x.A.div(W||(W=(0,u.A)(["\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n"]))),Nn=x.A.div(V||(V=(0,u.A)(["\n  background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);\n  border: 1px solid #93c5fd;\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 24px;\n  display: flex;\n  gap: 12px;\n\n  svg {\n    width: 20px;\n    height: 20px;\n    color: #2563eb;\n    flex-shrink: 0;\n    margin-top: 2px;\n  }\n"]))),Tn=x.A.p(M||(M=(0,u.A)(["\n  margin: 0;\n  font-size: 0.875rem;\n  color: #1e40af;\n  line-height: 1.5;\n"]))),En=(x.A.div(U||(U=(0,u.A)(["\n  margin-bottom: 24px;\n"]))),x.A.h3(K||(K=(0,u.A)(["\n  font-size: 0.9375rem;\n  font-weight: 600;\n  color: #374151;\n  margin: 0 0 12px 0;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  svg {\n    width: 18px;\n    height: 18px;\n    color: #6b7280;\n  }\n"]))),x.A.div(H||(H=(0,u.A)(["\n  display: grid;\n  grid-template-columns: 400px 1fr;\n  gap: 20px;\n  margin-bottom: 16px;\n\n  @media (max-width: 900px) {\n    grid-template-columns: 1fr;\n  }\n"])))),Ln=x.A.div(Z||(Z=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n"]))),Bn=x.A.div(q||(q=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n"]))),Wn=x.A.div(Y||(Y=(0,u.A)(["\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 12px;\n"]))),Vn=x.A.div(X||(X=(0,u.A)(["\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 12px;\n"]))),Mn=x.A.div(G||(G=(0,u.A)(["\n  font-size: 0.75rem;\n  color: #6b7280;\n  font-weight: 500;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n  margin-bottom: 6px;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    flex-shrink: 0;\n    opacity: 0.7;\n  }\n"]))),Un=x.A.div(J||(J=(0,u.A)(["\n  font-size: 0.9375rem;\n  color: #111827;\n  font-weight: 600;\n\n  &.highlight {\n    color: #10b981;\n    font-size: 1.125rem;\n  }\n"]))),Kn=((0,x.A)(Vn)(Q||(Q=(0,u.A)(["\n  grid-column: 1 / -1;\n"]))),x.A.div($||($=(0,u.A)(["\n  background: #f9fafb;\n  border-top: 1px solid #e5e7eb;\n  padding: 16px 24px;\n  display: flex;\n  gap: 12px;\n  justify-content: flex-end;\n"])))),Hn=x.A.button(nn||(nn=(0,u.A)(["\n  padding: 10px 20px;\n  border-radius: 6px;\n  font-size: 0.9375rem;\n  font-weight: 600;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  &.primary {\n    background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n    color: #ffffff;\n\n    &:hover {\n      background: linear-gradient(135deg, #059669 0%, #047857 100%);\n      transform: translateY(-1px);\n      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);\n    }\n  }\n\n  &.secondary {\n    background: #ffffff;\n    color: #374151;\n    border: 1px solid #d1d5db;\n\n    &:hover {\n      background: #f9fafb;\n      border-color: #9ca3af;\n    }\n  }\n\n  &:active {\n    transform: translateY(0);\n  }\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n"]))),Zn=x.A.div(en||(en=(0,u.A)(["\n  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n  border: 1px solid #fbbf24;\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 24px;\n  display: flex;\n  gap: 12px;\n\n  svg {\n    width: 20px;\n    height: 20px;\n    color: #f59e0b;\n    flex-shrink: 0;\n    margin-top: 2px;\n  }\n"]))),qn=x.A.p(tn||(tn=(0,u.A)(["\n  margin: 0;\n  font-size: 0.875rem;\n  color: #92400e;\n  line-height: 1.5;\n"]))),Yn=x.A.div(an||(an=(0,u.A)(["\n  background: #e0f2fe;\n  border: 1px solid #0ea5e9;\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 16px;\n  display: flex;\n  align-items: flex-start;\n  gap: 12px;\n"]))),Xn=x.A.label(on||(on=(0,u.A)(['\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  cursor: pointer;\n  font-size: 0.9375rem;\n  color: #0c4a6e;\n  font-weight: 500;\n  user-select: none;\n  flex: 1;\n\n  input[type="checkbox"] {\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n    accent-color: #0ea5e9;\n  }\n\n  &:hover {\n    color: #075985;\n  }\n']))),Gn=x.A.div(rn||(rn=(0,u.A)(["\n  font-size: 0.8125rem;\n  color: #0c4a6e;\n  margin-top: 8px;\n  margin-left: 30px;\n  line-height: 1.4;\n  font-style: italic;\n  font-weight: 500;\n"]))),Jn=x.A.div(sn||(sn=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 12px;\n"]))),Qn=x.A.h3(ln||(ln=(0,u.A)(["\n  font-size: 0.8125rem;\n  font-weight: 600;\n  color: #374151;\n  margin: 0 0 8px 0;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    color: #10b981;\n  }\n"]))),$n=x.A.div(dn||(dn=(0,u.A)(["\n  max-height: 300px;\n  overflow-y: auto;\n  margin-top: 8px;\n\n  &::-webkit-scrollbar {\n    width: 6px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #e5e7eb;\n    border-radius: 3px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #10b981;\n    border-radius: 3px;\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background: #059669;\n  }\n"]))),ne=x.A.div(cn||(cn=(0,u.A)(["\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 10px;\n  margin-bottom: 6px;\n\n  &:last-child {\n    margin-bottom: 0;\n  }\n\n  &:hover {\n    border-color: #10b981;\n    box-shadow: 0 1px 3px rgba(16, 185, 129, 0.15);\n    transform: translateX(2px);\n    transition: all 0.2s ease;\n  }\n"]))),ee=x.A.div(pn||(pn=(0,u.A)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 8px;\n"]))),te=x.A.div(fn||(fn=(0,u.A)(["\n  font-size: 0.9375rem;\n  font-weight: 600;\n  color: #111827;\n  flex: 1;\n"]))),ae=x.A.div(un||(un=(0,u.A)(["\n  font-size: 0.9375rem;\n  font-weight: 700;\n  color: #10b981;\n  white-space: nowrap;\n  margin-left: 16px;\n"]))),oe=x.A.div(mn||(mn=(0,u.A)(["\n  display: flex;\n  gap: 16px;\n  flex-wrap: wrap;\n  font-size: 0.8125rem;\n  color: #6b7280;\n"]))),ie=x.A.span(gn||(gn=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 4px;\n\n  strong {\n    color: #374151;\n  }\n"]))),re=n=>{let{isdocSummary:e,isdocData:t,onConfirm:a,onCancel:o,onUploadWithoutParsing:i}=n;const[r,s]=m.useState(!0),l=(null===t||void 0===t?void 0:t.polozky)||(null===e||void 0===e?void 0:e.polozky)||[];return(0,y.jsx)(zn,{onClick:n=>n.stopPropagation(),children:(0,y.jsxs)(Cn,{onClick:n=>n.stopPropagation(),children:[(0,y.jsxs)(Sn,{children:[(0,y.jsx)(Pn,{children:(0,y.jsx)(xn.A,{})}),(0,y.jsxs)(In,{children:[(0,y.jsx)(Fn,{children:"Detekov\xe1n ISDOC form\xe1t!"}),(0,y.jsx)(On,{children:"Elektronick\xe1 faktura byla \xfasp\u011b\u0161n\u011b na\u010dtena"})]}),(0,y.jsx)(Dn,{onClick:o,"aria-label":"Zav\u0159\xedt",children:(0,y.jsx)(hn.A,{})})]}),(0,y.jsxs)(Rn,{children:[(0,y.jsxs)(Nn,{children:[(0,y.jsx)(yn.A,{}),(0,y.jsx)(Tn,{children:"ISDOC je standardn\xed form\xe1t pro elektronickou v\xfdm\u011bnu faktur. Syst\xe9m m\u016f\u017ee automaticky vyplnit \xfadaje faktury z tohoto souboru."})]}),(0,y.jsxs)(En,{children:[(0,y.jsxs)(Ln,{children:[(0,y.jsxs)(Wn,{children:[(0,y.jsxs)(Vn,{children:[(0,y.jsxs)(Mn,{children:[(0,y.jsx)(vn.A,{}),"Datum vystaven\xed"]}),(0,y.jsx)(Un,{children:wn(e.datum_vystaveni)})]}),(0,y.jsxs)(Vn,{children:[(0,y.jsxs)(Mn,{children:[(0,y.jsx)(bn.A,{}),"Celkov\xe1 \u010d\xe1stka"]}),(0,y.jsx)(Un,{className:"highlight",children:(0,y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[(0,y.jsx)("span",{children:e.castka_s_dph}),e.ma_slevu&&e.sleva_celkem>0&&(0,y.jsxs)("span",{style:{fontSize:"0.75rem",color:"#059669",fontWeight:500,display:"inline-flex",alignItems:"center",gap:"4px"},children:["\ud83c\udf89 Sleva: -",e.sleva_celkem.toLocaleString("cs-CZ",{minimumFractionDigits:2})," K\u010d",e.sleva_procenta>0&&(0,y.jsxs)("span",{style:{fontSize:"0.7rem",opacity:.8},children:["(",e.sleva_procenta.toFixed(1),"%)"]})]})]})})]})]}),(0,y.jsxs)(Wn,{children:[(0,y.jsxs)(Vn,{children:[(0,y.jsxs)(Mn,{children:[(0,y.jsx)(xn.A,{}),"\u010c\xedslo faktury"]}),(0,y.jsx)(Un,{children:e.cislo_faktury})]}),(0,y.jsxs)(Vn,{children:[(0,y.jsxs)(Mn,{children:[(0,y.jsx)(xn.A,{}),"Variabiln\xed symbol"]}),(0,y.jsx)(Un,{children:e.variabilni_symbol})]})]})]}),(0,y.jsxs)(Bn,{children:[(0,y.jsxs)(Wn,{children:[(0,y.jsxs)(Vn,{children:[(0,y.jsxs)(Mn,{children:[(0,y.jsx)(kn.A,{}),"Dodavatel"]}),(0,y.jsx)(Un,{children:e.dodavatel})]}),(0,y.jsxs)(Vn,{children:[(0,y.jsxs)(Mn,{children:[(0,y.jsx)(_n.A,{}),"Po\u010det polo\u017eek"]}),(0,y.jsx)(Un,{children:e.pocet_polozek})]})]}),l&&l.length>0&&(0,y.jsxs)(Jn,{children:[(0,y.jsxs)(Qn,{children:[(0,y.jsx)(_n.A,{}),"Polo\u017eky faktury"]}),(0,y.jsx)($n,{children:l.map((n,e)=>{var t,a,o;return(0,y.jsxs)(ne,{children:[(0,y.jsxs)(ee,{children:[(0,y.jsxs)(te,{children:[e+1,". ",n.popis||"Polo\u017eka bez popisu"]}),(0,y.jsxs)(ae,{children:[null===(t=n.cena_celkem_s_dph)||void 0===t?void 0:t.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"]})]}),(0,y.jsxs)(oe,{children:[(0,y.jsxs)(ie,{children:[(0,y.jsx)("strong",{children:"Mno\u017estv\xed:"})," ",n.mnozstvi," ",n.jednotka]}),(0,y.jsxs)(ie,{children:[(0,y.jsx)("strong",{children:"Cena/jedn.:"})," ",null===(a=n.cena_za_jednotku)||void 0===a?void 0:a.toLocaleString("cs-CZ",{minimumFractionDigits:2})," K\u010d"]}),(0,y.jsxs)(ie,{children:[(0,y.jsx)("strong",{children:"Bez DPH:"})," ",null===(o=n.cena_celkem_bez_dph)||void 0===o?void 0:o.toLocaleString("cs-CZ",{minimumFractionDigits:2})," K\u010d"]}),(0,y.jsxs)(ie,{children:[(0,y.jsx)("strong",{children:"DPH:"})," ",n.sazba_dph,"%"]})]})]},e)})})]})]})]}),(0,y.jsx)(Yn,{children:(0,y.jsxs)("div",{style:{flex:1},children:[(0,y.jsxs)(Xn,{children:[(0,y.jsx)("input",{type:"checkbox",checked:r,onChange:n=>s(n.target.checked)}),(0,y.jsxs)("span",{children:["Do pole ",(0,y.jsx)("strong",{children:"\u010c\xedslo FA/VPD"})," pou\u017e\xedt ",(0,y.jsx)("strong",{children:"variabiln\xed symbol"})," m\xedsto \u010d\xedsla faktury"]})]}),(0,y.jsx)(Gn,{children:r?"\u2713 Bude pou\u017eit variabiln\xed symbol: ".concat(e.variabilni_symbol):"\u2713 Bude pou\u017eito \u010d\xedslo faktury: ".concat(e.cislo_faktury)})]})}),(0,y.jsxs)(Zn,{children:[(0,y.jsx)(An.A,{}),(0,y.jsxs)(qn,{children:[(0,y.jsx)("strong",{children:"Datum doru\u010den\xed"})," bude automaticky nastaven na dne\u0161n\xed datum. Po vypln\u011bn\xed \xfadaj\u016f zkontrolujte v\u0161echna pole p\u0159ed ulo\u017een\xedm!"]})]})]}),(0,y.jsxs)(Kn,{children:[(0,y.jsx)(Hn,{className:"secondary",onClick:i,children:"Nahr\xe1t bez extrakce"}),(0,y.jsx)(Hn,{className:"secondary",onClick:o,children:"Zru\u0161it"}),(0,y.jsxs)(Hn,{className:"primary",onClick:()=>a(r),children:[(0,y.jsx)(jn.A,{}),"Vyplnit \xfadaje faktury"]})]})]})})};var se,le,de,ce,pe,fe,ue,me,ge,xe,he,ye,ve,be,ke=t(27837),_e=t(88720);x.A.div(se||(se=(0,u.A)(["\n  margin-top: 16px;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  background: #ffffff;\n  overflow: hidden;\n"]))),x.A.div(le||(le=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n  border-bottom: 1px solid #e5e7eb;\n  cursor: pointer;\n  user-select: none;\n  transition: background 0.2s ease;\n\n  &:hover {\n    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);\n  }\n"]))),x.A.div(de||(de=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 10px;\n"]))),x.A.div(ce||(ce=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  color: #ffffff;\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n"]))),x.A.div(pe||(pe=(0,u.A)(["\n  font-size: 0.9375rem;\n  font-weight: 600;\n  color: #1f2937;\n"]))),x.A.span(fe||(fe=(0,u.A)(["\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 20px;\n  height: 20px;\n  padding: 0 6px;\n  border-radius: 10px;\n  background: #3b82f6;\n  color: #ffffff;\n  font-size: 0.75rem;\n  font-weight: 600;\n  margin-left: 8px;\n"]))),x.A.div(ue||(ue=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  color: #6b7280;\n  transition: transform 0.2s ease;\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n"]))),x.A.div(me||(me=(0,u.A)(["\n  padding: 16px;\n  display: ",";\n"])),n=>n.collapsed?"none":"block"),x.A.div(ge||(ge=(0,u.A)(["\n  margin-bottom: ",";\n"])),n=>n.hasAttachments?"20px":"0"),x.A.div(xe||(xe=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n"]))),x.A.div(he||(he=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 32px 16px;\n  text-align: center;\n  color: #6b7280;\n  gap: 8px;\n\n  svg {\n    width: 48px;\n    height: 48px;\n    opacity: 0.3;\n  }\n"]))),x.A.div(ye||(ye=(0,u.A)(["\n  font-size: 0.875rem;\n  font-weight: 500;\n"]))),x.A.div(ve||(ve=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 32px 16px;\n  gap: 12px;\n  color: #6b7280;\n  font-size: 0.875rem;\n\n  svg {\n    width: 20px;\n    height: 20px;\n    animation: spin 1s linear infinite;\n  }\n\n  @keyframes spin {\n    from { transform: rotate(0deg); }\n    to { transform: rotate(360deg); }\n  }\n"]))),x.A.div(be||(be=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  background: #fef2f2;\n  border: 1px solid #fecaca;\n  border-radius: 6px;\n  color: #dc2626;\n  font-size: 0.875rem;\n\n  svg {\n    width: 18px;\n    height: 18px;\n    flex-shrink: 0;\n  }\n"])));var Ae,je,we,ze,Ce,Se,De,Pe,Ie,Fe,Oe,Re,Ne,Te,Ee,Le,Be,We,Ve,Me,Ue,Ke,He,Ze,qe=t(89379),Ye=t(76833),Xe=t(56099),Ge=t(37719),Je=t(72494),Qe=t(42043),$e=t(37587),nt=t(7104),et=t(9855),tt=t(29071),at=t(51833),ot=t(29521);const it=x.A.div(Ae||(Ae=(0,u.A)(["\n  margin-top: 16px;\n  padding-top: 16px;\n  border-top: 1px solid #e5e7eb;\n"]))),rt=x.A.div(je||(je=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 12px;\n"]))),st=x.A.div(we||(we=(0,u.A)(["\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #374151;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  svg {\n    width: 16px;\n    height: 16px;\n    color: #3b82f6;\n  }\n"]))),lt=x.A.span(ze||(ze=(0,u.A)(["\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 18px;\n  height: 18px;\n  padding: 0 6px;\n  border-radius: 9px;\n  background: #3b82f6;\n  color: #ffffff;\n  font-size: 0.6875rem;\n  font-weight: 600;\n  margin-left: 6px;\n"]))),dt=x.A.div(Ce||(Ce=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 16px;\n  margin-bottom: 12px;\n  border: 2px dashed ",";\n  border-radius: 8px;\n  background: ",";\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &:hover {\n    border-color: #3b82f6;\n    background: #f0f9ff;\n  }\n\n  ","\n"])),n=>n.isDragging?"#3b82f6":"#d1d5db",n=>n.isDragging?"#eff6ff":"#ffffff",n=>n.disabled&&"\n    opacity: 0.5;\n    cursor: not-allowed;\n    &:hover {\n      border-color: #d1d5db;\n      background: #ffffff;\n    }\n  "),ct=x.A.div(Se||(Se=(0,u.A)(["\n  font-size: 1.5rem;\n  color: ",";\n"])),n=>n.isDragging?"#3b82f6":"#9ca3af"),pt=x.A.div(De||(De=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n"]))),ft=x.A.div(Pe||(Pe=(0,u.A)(["\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: #374151;\n"]))),ut=x.A.div(Ie||(Ie=(0,u.A)(["\n  font-size: 0.75rem;\n  color: #9ca3af;\n"]))),mt=x.A.input(Fe||(Fe=(0,u.A)(["\n  display: none;\n"]))),gt=x.A.div(Oe||(Oe=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n"]))),xt=(x.A.div(Re||(Re=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 10px 12px;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  gap: 12px;\n  transition: all 0.2s ease;\n\n  &:hover {\n    border-color: #cbd5e1;\n    background: #f3f4f6;\n  }\n"]))),x.A.div(Ne||(Ne=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  flex: 1;\n  min-width: 0;\n"]))),x.A.div(Te||(Te=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  border-radius: 6px;\n  color: #ffffff;\n  flex-shrink: 0;\n\n  svg {\n    width: 16px;\n    height: 16px;\n  }\n"]))),x.A.div(Ee||(Ee=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n  min-width: 0;\n  flex: 1;\n"]))),x.A.div(Le||(Le=(0,u.A)(["\n  font-size: 0.8125rem;\n  font-weight: 500;\n  color: #1f2937;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n"]))),x.A.div(Be||(Be=(0,u.A)(["\n  font-size: 0.6875rem;\n  color: #6b7280;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n"]))),x.A.span(We||(We=(0,u.A)(["\n  display: inline-flex;\n  align-items: center;\n  padding: 2px 6px;\n  border-radius: 4px;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  color: #ffffff;\n  font-size: 0.625rem;\n  font-weight: 600;\n"]))),x.A.div(Ve||(Ve=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  flex-shrink: 0;\n"]))),x.A.button(Me||(Me=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 28px;\n  height: 28px;\n  border: none;\n  border-radius: 4px;\n  background: ",";\n  color: ",";\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n\n  &:hover {\n    background: ",";\n    transform: translateY(-1px);\n  }\n\n  &:active {\n    transform: translateY(0);\n  }\n\n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    transform: none;\n  }\n"])),n=>"danger"===n.variant?"#fef2f2":"#ffffff",n=>"danger"===n.variant?"#dc2626":"#6b7280",n=>"danger"===n.variant?"#fee2e2":"#f3f4f6"),x.A.div(Ue||(Ue=(0,u.A)(["\n  padding: 16px;\n  text-align: center;\n  color: #9ca3af;\n  font-size: 0.8125rem;\n  background: #f9fafb;\n  border: 1px dashed #d1d5db;\n  border-radius: 6px;\n"]))),x.A.div(Ke||(Ke=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 16px;\n  gap: 8px;\n  color: #6b7280;\n  font-size: 0.8125rem;\n\n  svg {\n    width: 16px;\n    height: 16px;\n    animation: spin 1s linear infinite;\n  }\n\n  @keyframes spin {\n    from { transform: rotate(0deg); }\n    to { transform: rotate(360deg); }\n  }\n"])))),ht=x.A.div(He||(He=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 10px;\n  background: #fef2f2;\n  border: 1px solid #fecaca;\n  border-radius: 6px;\n  color: #dc2626;\n  font-size: 0.75rem;\n  margin-top: 8px;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    flex-shrink: 0;\n  }\n"]))),yt=(x.A.div(Ze||(Ze=(0,u.A)(["\n  font-size: 0.75rem;\n  color: #6b7280;\n  padding: 12px;\n  background: #f9fafb;\n  border-radius: 6px;\n  border: 1px solid #e5e7eb;\n"]))),n=>{var e;let{fakturaId:a,objednavkaId:o,fakturaTypyPrilohOptions:i=[],readOnly:r=!1,onISDOCParsed:s,formData:l,faktura:d,validateInvoiceForAttachments:c,isPokladna:p=!1,onAttachmentUploaded:f,attachments:u=[],onAttachmentsChange:x,onCreateInvoiceInDB:v,onOCRDataExtracted:b}=n;const{username:k,token:_}=(0,m.useContext)(ke.cy),{showToast:A}=(0,m.useContext)(_e.$o),[j,w]=(0,m.useState)(!1),[z,C]=(0,m.useState)(!1),[S,D]=(0,m.useState)(null),[P,I]=(0,m.useState)(!1),F=m.useRef(null),[O,R]=(0,m.useState)(!1),[N,T]=(0,m.useState)(null),[E,L]=(0,m.useState)(null),[B,W]=(0,m.useState)({isOpen:!1,title:"",message:"",onConfirm:null}),V=u,M=(0,m.useCallback)(n=>{if(!x)return;const e="function"===typeof n?n(V):n;x(e)},[V,x]);(0,m.useEffect)(()=>{a&&!String(a).startsWith("temp-")&&K()},[a]);const U=m.useRef(a);(0,m.useEffect)(()=>{(async()=>{const n=U.current,e=a,t=String(n).startsWith("temp-"),i=e&&!String(e).startsWith("temp-");if(!t||!i)return void(U.current=e);const r=V.filter(n=>("pending"===n.status||"pending_upload"===n.status)&&n.file);if(0!==r.length){for(const n of r)try{var s,l,d,c;M(e=>e.map(e=>e.id===n.id?(0,qe.A)((0,qe.A)({},e),{},{status:"uploading"}):e));const t=await(0,h.dN)({token:_,username:k,faktura_id:e,objednavka_id:o,typ_prilohy:n.klasifikace||"FAKTURA",file:n.file}),a=(null===(s=t.priloha)||void 0===s?void 0:s.id)||t.priloha_id||(null===(l=t.data)||void 0===l||null===(d=l.priloha)||void 0===d?void 0:d.id)||(null===(c=t.data)||void 0===c?void 0:c.id)||t.id;M(e=>e.map(e=>e.id===n.id?(0,qe.A)((0,qe.A)({},e),{},{status:"uploaded",serverId:a,file:void 0}):e)),A&&A('\u2705 P\u0159\xedloha "'.concat(n.name,'" byla \xfasp\u011b\u0161n\u011b nahr\xe1na'),{type:"success"})}catch(p){M(e=>e.map(e=>e.id===n.id?(0,qe.A)((0,qe.A)({},e),{},{status:"error",error:p.message}):e)),A&&A('Nepoda\u0159ilo se nahr\xe1t p\u0159\xedlohu "'.concat(n.name,'"'),{type:"error"})}f&&f(),U.current=e}else U.current=e})()},[a,V]);const K=async()=>{if(a&&!String(a).startsWith("temp-")){w(!0),D(null);try{var n;const t=await(0,h.xh)({token:_,username:k,faktura_id:a,objednavka_id:o}),i=((null===(n=t.data)||void 0===n?void 0:n.attachments)||t.prilohy||[]).map(n=>{const e=!1!==n.file_exists,t=n.error||n.file_error;return{id:n.id,serverId:n.id,name:n.original_name||n.originalni_nazev_souboru,size:n.file_size||n.velikost_souboru_b,type:(n.original_name||n.originalni_nazev_souboru||"").endsWith(".pdf")?"application/pdf":"application/octet-stream",klasifikace:n.type||n.typ_prilohy||"FILE",faktura_typ_nazev:n.faktura_typ_nazev,uploadDate:n.upload_date||n.dt_vytvoreni||(new Date).toISOString(),status:e?"uploaded":"error",je_isdoc:n.je_isdoc,error:t||(e?null:"Fyzick\xfd soubor chyb\xed na disku")}});M(i);const r=a?Number(a):null;if(r&&!isNaN(r)&&!String(a).startsWith("temp-"))try{const n=await(0,h.Q_)({token:_,username:k,invoice_id:r,objednavka_id:o});if(n&&n.attachments){const e=i.map(e=>{const t=n.attachments.find(n=>n.attachment_id===e.serverId);return t&&!t.file_exists?(0,qe.A)((0,qe.A)({},e),{},{status:"error",error:"Fyzick\xfd soubor chyb\xed na serveru (".concat(t.status,")")}):e});e.some((n,e)=>n.status!==i[e].status)&&M(e);const t=n.summary||{};t.missing_files>0&&A&&A("\u26a0\ufe0f ".concat(t.missing_files," p\u0159\xedloha(y) faktury nemaj\xed fyzick\xfd soubor na serveru"),{type:"warning"})}}catch(e){console.error("\u274c Chyba p\u0159i verify attachments:",e)}}catch(t){console.error("\u274c Chyba p\u0159i na\u010d\xedt\xe1n\xed p\u0159\xedloh faktury:",t),D(t.message||"Chyba p\u0159i na\u010d\xedt\xe1n\xed p\u0159\xedloh")}finally{w(!1)}}},H=n=>{if(!(0,h.yU)(n.name))throw new Error("Nepodporovan\xfd form\xe1t souboru");if(!(0,h.vF)(n.size))throw new Error("Soubor je p\u0159\xedli\u0161 velk\xfd (max 10 MB)")},Z=async n=>{const e=Array.from(n),t=e.filter(n=>(0,h.Lo)(n.name)),o=e.filter(n=>!(0,h.Lo)(n.name));if(o.length>0&&!p){const n=c?c(d):{isValid:!0};if(!n.isValid){const e=(0,y.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,y.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"12px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,y.jsx)(An.A,{size:20,color:"#ff4d4f",style:{flexShrink:0}}),(0,y.jsx)("span",{children:"Pro ulo\u017een\xed je nutn\xe9 vyplnit n\xe1sleduj\xedc\xed polo\u017eky:"})]}),Object.values(n.categories).map((n,e)=>n.errors.length>0&&(0,y.jsxs)("div",{style:{marginBottom:"10px",padding:"10px",backgroundColor:"#fff1f0",borderRadius:"4px"},children:[(0,y.jsx)("div",{style:{fontWeight:"600",fontSize:"13px",color:"#d32f2f",marginBottom:"6px"},children:n.label}),n.errors.map((n,e)=>(0,y.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginLeft:"8px",marginTop:"4px",display:"flex",alignItems:"flex-start"},children:[(0,y.jsx)("span",{style:{marginRight:"6px",color:"#ff4d4f",fontWeight:"bold"},children:"\u2022"}),(0,y.jsx)("span",{children:n})]},e))]},e))]});return void(A&&A(e,{type:"error"}))}}if(1===t.length&&s){const n=t[0];try{H(n);const e=await(0,tt.qU)(n),t=(0,tt.pd)(e);return T({file:n,isdocData:e,otherFiles:o}),L(t),void R(!0)}catch(r){A&&A("Nepoda\u0159ilo se naparsovat ISDOC soubor. Nahr\xe1no jako b\u011b\u017en\xe1 p\u0159\xedloha.",{type:"error"})}}const i=e.map((n,e)=>{try{H(n);const t=(0,h.Lo)(n.name),a=t?"ISDOC":"FAKTURA";return{id:"pending-".concat(Date.now(),"-").concat(e),file:n,name:n.name,size:n.size,type:n.type,klasifikace:a,uploadDate:(new Date).toISOString(),status:"pending_upload",je_isdoc:t?1:0}}catch(t){return A&&A("".concat(n.name,": ").concat(t.message),{type:"error"}),null}}).filter(Boolean);if(i.length>0){M(n=>[...n,...i]);if(String(a).startsWith("temp-"))for(const n of i)await X(n.id,n.klasifikace,n);else for(const n of i)await X(n.id,n.klasifikace,n)}},q=n=>n?"error"===n.status?"#fca5a5":n.klasifikace?"uploading"===n.status?"#f59e0b":"uploaded"===n.status?"#10b981":"pending_upload"===n.status?"#3b82f6":"#e5e7eb":"#fca5a5":"#e5e7eb",Y=n=>n?"error"===n.status?"#fef2f2":n.klasifikace?"uploading"===n.status?"#fffbeb":"uploaded"===n.status?"#f0fdf4":"pending_upload"===n.status?"#eff6ff":"white":"#fef2f2":"white",X=async function(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=t||V.find(e=>e.id===n);if(!r||!r.file)return;const s=e||r.klasifikace;if(!s||""===s.trim())return void(A&&A("Vyberte typ p\u0159\xedlohy",{type:"error"}));if(String(a).startsWith("temp-")){if(!p){var l;const n=null===c||void 0===c?void 0:c(d,r.file);var u;if((null===n||void 0===n||!n.isValid)&&(null===n||void 0===n||!n.isISDOC))return void(A&&A("Pro nahr\xe1n\xed t\xe9to p\u0159\xedlohy vypl\u0148te nejprve: ".concat((null===n||void 0===n||null===(u=n.missingFields)||void 0===u?void 0:u.join(", "))||"povinn\xe1 pole"),{type:"error"}));null!==n&&void 0!==n&&n.isISDOC&&(null===n||void 0===n||null===(l=n.missingFields)||void 0===l?void 0:l.length)>0&&A&&A("\ud83d\udcc4 ISDOC soubor - data faktury budou extrahov\xe1na po nahr\xe1n\xed",{type:"info"})}M(e=>e.map(e=>e.id===n?(0,qe.A)((0,qe.A)({},e),{},{status:"uploading",klasifikace:s}):e));try{var m,g,x,b;if(!v)throw new Error("Chyb\xed callback pro vytvo\u0159en\xed faktury v DB");A&&A("\u23f3 Vytv\xe1\u0159\xedm fakturu v datab\xe1zi...",{type:"info"});const e=await v(a);if(!e||String(e).startsWith("temp-"))throw new Error("Nepoda\u0159ilo se z\xedskat re\xe1ln\xe9 ID faktury");A&&A("\u2705 Faktura vytvo\u0159ena, nahr\xe1v\xe1m p\u0159\xedlohu...",{type:"info"});const t=i.find(n=>n.kod===s);r.file.name,r.file.size,r.file.type;console.group("\ud83d\udd0d DEBUG: Upload p\u0159\xedlohy faktury");const l=await(0,h.dN)({token:_,username:k,faktura_id:e,objednavka_id:o,typ_prilohy:s,file:r.file});console.groupEnd();const d=(null===(m=l.priloha)||void 0===m?void 0:m.id)||l.priloha_id||(null===(g=l.data)||void 0===g||null===(x=g.priloha)||void 0===x?void 0:x.id)||(null===(b=l.data)||void 0===b?void 0:b.id)||l.id;M(e=>e.map(e=>e.id===n?(0,qe.A)((0,qe.A)({},e),{},{status:"uploaded",serverId:d,klasifikace:s,faktura_typ_nazev:(null===t||void 0===t?void 0:t.nazev)||s,file:void 0}):e));const c=(0,y.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,y.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"8px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,y.jsx)(Ye.A,{size:20,color:"#10b981",style:{flexShrink:0}}),(0,y.jsx)("span",{children:"P\u0159\xedloha \xfasp\u011b\u0161n\u011b nahr\xe1na"})]}),(0,y.jsx)("div",{style:{padding:"8px",backgroundColor:"#f0fdf4",borderRadius:"4px",fontSize:"13px",color:"#166534"},children:r.file.name})]});if(A&&A(c,{type:"success"}),await K(),f){const n={id:d,faktura_id:e,typ_prilohy:s,typ_prilohy_nazev:(null===t||void 0===t?void 0:t.nazev)||s,nazev_souboru:r.file.name,velikost:r.file.size,status:"uploaded",datum_vytvoreni:(new Date).toISOString()};f(e,n)}return}catch(S){console.group("\u274c CHYBA p\u0159i uploadu s temp ID"),console.error("Error object:",S),console.error("Error message:",S.message),console.error("Error stack:",S.stack),S.response&&(console.error("Response data:",S.response.data),console.error("Response status:",S.response.status)),console.groupEnd(),M(e=>e.map(e=>e.id===n?(0,qe.A)((0,qe.A)({},e),{},{status:"error",error:S.message||"Chyba p\u0159i nahr\xe1v\xe1n\xed"}):e));const e=(null===t||void 0===t?void 0:t.name)||"soubor";let a=S.message||"Nepoda\u0159ilo se nahr\xe1t p\u0159\xedlohu";return void(a.includes("Nepodporovan\xfd typ souboru")||a.includes("Povolen\xe9 typy")?A&&A('\u274c Soubor "'.concat(e,'" nelze nahr\xe1t\n\n').concat(a),{type:"error"}):A&&A('\u274c Chyba p\u0159i nahr\xe1v\xe1n\xed "'.concat(e,'": ').concat(a),{type:"error"}))}}M(e=>e.map(e=>e.id===n?(0,qe.A)((0,qe.A)({},e),{},{status:"uploading"}):e));try{var j,w,z,C;const e=await(0,h.dN)({token:_,username:k,faktura_id:a,objednavka_id:o,typ_prilohy:s,file:r.file}),t=i.find(n=>n.kod===s),l=(null===(j=e.priloha)||void 0===j?void 0:j.id)||e.priloha_id||(null===(w=e.data)||void 0===w||null===(z=w.priloha)||void 0===z?void 0:z.id)||(null===(C=e.data)||void 0===C?void 0:C.id)||e.id;M(e=>e.map(e=>e.id===n?(0,qe.A)((0,qe.A)({},e),{},{status:"uploaded",serverId:l,klasifikace:s,faktura_typ_nazev:(null===t||void 0===t?void 0:t.nazev)||s,file:void 0}):e));const d=(0,y.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,y.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"8px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,y.jsx)(Ye.A,{size:20,color:"#10b981",style:{flexShrink:0}}),(0,y.jsx)("span",{children:"P\u0159\xedloha \xfasp\u011b\u0161n\u011b nahr\xe1na"})]}),(0,y.jsx)("div",{style:{padding:"8px",backgroundColor:"#f0fdf4",borderRadius:"4px",fontSize:"13px",color:"#166534"},children:r.file.name})]});if(A&&A(d,{type:"success"}),await K(),f){const n={id:l,faktura_id:a,typ_prilohy:s,typ_prilohy_nazev:(null===t||void 0===t?void 0:t.nazev)||s,nazev_souboru:r.file.name,velikost:r.file.size,status:"uploaded",datum_vytvoreni:(new Date).toISOString()};f(a,n)}}catch(S){M(e=>e.map(e=>e.id===n?(0,qe.A)((0,qe.A)({},e),{},{status:"pending_classification"}):e)),A&&A("Nepoda\u0159ilo se nahr\xe1t p\u0159\xedlohu",{type:"error"})}},G=(0,m.useMemo)(()=>p?{isValid:!0,missingFields:[]}:d?c?c(d):{isValid:!0,missingFields:[]}:{isValid:!1,missingFields:["Faktura"]},[d,c,p]),J=z||j||r;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(it,{children:[(0,y.jsx)(rt,{children:(0,y.jsxs)(st,{children:[(0,y.jsx)(Je.A,{}),"P\u0159\xedlohy faktury",V.length>0&&(0,y.jsx)(lt,{children:V.length})]})}),(0,y.jsx)(mt,{ref:F,type:"file",accept:".pdf,.isdoc,.jpg,.jpeg,.png,.xml",multiple:!0,onChange:async n=>{const e=n.target.files;e&&0!==e.length&&(await Z(e),F.current&&(F.current.value=""))},disabled:J}),!G.isValid&&!r&&(0,y.jsxs)("div",{style:{background:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"6px",padding:"1rem",marginBottom:"1rem",display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[(0,y.jsx)(yn.A,{size:20,style:{color:"#f59e0b",flexShrink:0,marginTop:"2px"}}),(0,y.jsxs)("div",{style:{flex:1},children:[(0,y.jsx)("div",{style:{fontWeight:"500",color:"#92400e",marginBottom:"0.25rem"},children:"Vypl\u0148te povinn\xe9 polo\u017eky faktury"}),(0,y.jsxs)("div",{style:{fontSize:"0.875rem",color:"#78350f"},children:["Pro p\u0159id\xe1n\xed p\u0159\xedloh je nutn\xe9 vyplnit: ",(null===(e=G.missingFields)||void 0===e?void 0:e.join(", "))||"povinn\xe1 pole"]})]})]}),!r&&(0,y.jsxs)(dt,{onClick:()=>{var n;J||(null===(n=F.current)||void 0===n||n.click())},onDragOver:n=>{n.preventDefault(),n.stopPropagation(),J||I(!0)},onDragLeave:n=>{n.preventDefault(),n.stopPropagation(),n.currentTarget!==n.target&&n.currentTarget.contains(n.relatedTarget)||I(!1)},onDrop:async n=>{if(n.preventDefault(),n.stopPropagation(),I(!1),J)return;const e=n.dataTransfer.getData("text/spisovka-attachments");if(e){try{const n=JSON.parse(e);if(!Array.isArray(n)||0===n.length)return void(A&&A("\u274c \u017d\xe1dn\xe9 p\u0159\xedlohy k nahr\xe1n\xed",{type:"error"}));if(!n.some(n=>(0,h.Lo)(n.filename))&&!p){const n=c?c(d):{isValid:!0};if(!n.isValid){const e=(0,y.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,y.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"12px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,y.jsx)(An.A,{size:20,color:"#ff4d4f",style:{flexShrink:0}}),(0,y.jsx)("span",{children:"Pro ulo\u017een\xed je nutn\xe9 vyplnit n\xe1sleduj\xedc\xed polo\u017eky:"})]}),Object.values(n.categories).map((n,e)=>n.errors.length>0&&(0,y.jsxs)("div",{style:{marginBottom:"10px",padding:"10px",backgroundColor:"#fff1f0",borderRadius:"4px"},children:[(0,y.jsx)("div",{style:{fontWeight:"600",fontSize:"13px",color:"#d32f2f",marginBottom:"6px"},children:n.label}),n.errors.map((n,e)=>(0,y.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginLeft:"8px",marginTop:"4px",display:"flex",alignItems:"flex-start"},children:[(0,y.jsx)("span",{style:{marginRight:"6px",color:"#ff4d4f",fontWeight:"bold"},children:"\u2022"}),(0,y.jsx)("span",{children:n})]},e))]},e))]});return void(A&&A(e,{type:"error"}))}}const t=n.map(async n=>{const e="".concat("https://erdms.zachranka.cz/api.eeo/","spisovka.php/proxy-file?url=").concat(encodeURIComponent(n.url)),t=await fetch(e);if(!t.ok)throw new Error("Chyba p\u0159i stahov\xe1n\xed ".concat(n.filename));const a=t.headers.get("X-Original-Filename")||n.filename,o=await t.blob();return new File([o],a,{type:n.mime_type||o.type})}),a=await Promise.all(t);await Z(a);const o=(0,y.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,y.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"8px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,y.jsx)(Ye.A,{size:20,color:"#10b981",style:{flexShrink:0}}),(0,y.jsx)("span",{children:"P\u0159\xedlohy \xfasp\u011b\u0161n\u011b nahr\xe1ny"})]}),(0,y.jsxs)("div",{style:{padding:"8px",backgroundColor:"#f0fdf4",borderRadius:"4px",fontSize:"13px",color:"#166534"},children:["Nahr\xe1no ",a.length," ",1===a.length?"p\u0159\xedloha":a.length<5?"p\u0159\xedlohy":"p\u0159\xedloh"," ze spisovky"]})]});A&&A(o,{type:"success"})}catch(S){console.error("\u274c Chyba p\u0159i stahov\xe1n\xed p\u0159\xedloh ze spisovky:",S);let e=S.message;e.includes("Chyba p\u0159i stahov\xe1n\xed")?A&&A("\u274c ".concat(e),{type:"error"}):A&&A("\u274c Chyba p\u0159i zpracov\xe1n\xed p\u0159\xedloh: ".concat(e),{type:"error"})}return}const t=n.dataTransfer.getData("text/spisovka-file-url"),a=n.dataTransfer.getData("text/spisovka-file-name"),o=n.dataTransfer.getData("text/spisovka-file-mime");if(t&&a){if(!(0,h.Lo)(a)&&!p){const n=c?c(d):{isValid:!0};if(!n.isValid){const e=(0,y.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,y.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"12px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,y.jsx)(An.A,{size:20,color:"#ff4d4f",style:{flexShrink:0}}),(0,y.jsx)("span",{children:"Pro ulo\u017een\xed je nutn\xe9 vyplnit n\xe1sleduj\xedc\xed polo\u017eky:"})]}),Object.values(n.categories).map((n,e)=>n.errors.length>0&&(0,y.jsxs)("div",{style:{marginBottom:"10px",padding:"10px",backgroundColor:"#fff1f0",borderRadius:"4px"},children:[(0,y.jsx)("div",{style:{fontWeight:"600",fontSize:"13px",color:"#d32f2f",marginBottom:"6px"},children:n.label}),n.errors.map((n,e)=>(0,y.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginLeft:"8px",marginTop:"4px",display:"flex",alignItems:"flex-start"},children:[(0,y.jsx)("span",{style:{marginRight:"6px",color:"#ff4d4f",fontWeight:"bold"},children:"\u2022"}),(0,y.jsx)("span",{children:n})]},e))]},e))]});return void(A&&A(e,{type:"error"}))}}try{const n="".concat("https://erdms.zachranka.cz/api.eeo/","spisovka.php/proxy-file?url=").concat(encodeURIComponent(t)),e=await fetch(n);if(!e.ok)throw new Error("Chyba p\u0159i stahov\xe1n\xed souboru");const i=e.headers.get("X-Original-Filename")||a,r=await e.blob(),s=new File([r],i,{type:o||r.type});await Z([s]);const l=(0,y.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,y.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"8px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,y.jsx)(Ye.A,{size:20,color:"#10b981",style:{flexShrink:0}}),(0,y.jsx)("span",{children:"P\u0159\xedloha \xfasp\u011b\u0161n\u011b nahr\xe1na"})]}),(0,y.jsx)("div",{style:{padding:"8px",backgroundColor:"#f0fdf4",borderRadius:"4px",fontSize:"13px",color:"#166534"},children:i})]});A&&A(l,{type:"success"})}catch(S){console.error("\u274c Chyba p\u0159i stahov\xe1n\xed souboru ze spisovky:",S),A&&A("\u274c Chyba p\u0159i stahov\xe1n\xed souboru ze spisovky",{type:"error"})}return}const i=n.dataTransfer.files;i&&0!==i.length&&await Z(i)},isDragging:P,disabled:J,children:[(0,y.jsx)(ct,{isDragging:P,children:P?"\u2b07\ufe0f":"\ud83d\udcce"}),(0,y.jsxs)(pt,{children:[(0,y.jsx)(ft,{children:z?"Nahr\xe1v\xe1m...":P?"Pus\u0165te soubor":"P\u0159et\xe1hn\u011bte PDF, ISDOC, JPG, PNG, DOC, DOCX, XLS, XLSX nebo XML (max 10 MB)"}),(0,y.jsx)(ut,{children:"Kliknut\xedm otev\u0159ete dialog \u2022 Po p\u0159id\xe1n\xed vyberte typ p\u0159\xedlohy"})]})]}),S&&(0,y.jsxs)(ht,{children:[(0,y.jsx)(An.A,{}),S]}),j&&(0,y.jsxs)(xt,{children:[(0,y.jsx)(Qe.A,{}),"Na\u010d\xedt\xe1m p\u0159\xedlohy..."]}),!j&&V.length>0&&(0,y.jsx)(gt,{children:V.filter(n=>n&&n.id).map(n=>{var e;return(0,y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem",border:"1px solid ".concat(q(n)),borderRadius:"6px",backgroundColor:Y(n),marginBottom:"0.5rem",opacity:"uploading"===n.status?.6:1},children:[(0,y.jsxs)("div",{style:{width:"32px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,position:"relative"},children:[!1===n.file_exists?(0,y.jsx)($e.A,{size:24,style:{color:"#dc2626"}}):(0,y.jsx)(xn.A,{size:24,style:{color:"uploaded"===n.status?"#10b981":"#dc2626"}}),"uploaded"===n.status&&(0,y.jsx)("div",{style:{position:"absolute",top:"-2px",right:"-2px",width:"12px",height:"12px",backgroundColor:"#10b981",borderRadius:"50%"}}),"uploading"===n.status&&(0,y.jsx)("div",{style:{position:"absolute",top:"-2px",right:"-2px",width:"12px",height:"12px",backgroundColor:"#f59e0b",borderRadius:"50%",animation:"spin 1s linear infinite"}})]}),(0,y.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,y.jsx)("div",{style:{fontWeight:"500",fontSize:"0.875rem",color:"#374151",marginBottom:"2px"},children:(0,y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,y.jsxs)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0,position:"relative"},children:[n.name,!n.klasifikace&&(0,y.jsx)("span",{style:{color:"#dc2626",fontSize:"0.7rem",fontWeight:"bold",position:"absolute",top:"-2px",marginLeft:"2px"},children:"*"})]}),!1===n.file_exists&&(0,y.jsx)("span",{style:{color:"#dc2626",fontSize:"0.7rem",fontWeight:"bold",backgroundColor:"#fee2e2",padding:"1px 4px",borderRadius:"3px",flexShrink:0},children:"\u26a0 SOUBOR NENALEZEN"}),(0,y.jsxs)("span",{style:{color:"#6b7280",fontWeight:"normal",fontSize:"0.75rem",flexShrink:0},children:["(",Math.round((n.size||0)/1024)," kB)"]}),"uploaded"===n.status&&n.serverId&&(0,y.jsx)("button",{type:"button",onClick:()=>(async n=>{const e=V.find(e=>e.id===n);if(e&&e.serverId)try{const n=await(0,h.ML)({token:_,username:k,faktura_id:a,priloha_id:e.serverId,objednavka_id:o}),i=e.name||"priloha.pdf",{isPreviewableInBrowser:r,openInBrowser25:s}=await Promise.resolve().then(t.bind(t,33637));if(r(i)&&s(n,i))return void(A&&A("P\u0159\xedloha otev\u0159ena v nov\xe9m okn\u011b",{type:"success"}));const l=window.URL.createObjectURL(n),d=document.createElement("a");d.href=l,d.download=i,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(l),A&&A("Soubor st\xe1\u017een",{type:"success"})}catch(i){A&&A("Chyba: ".concat(i.message),{type:"error"})}})(n.id),style:{background:"none",border:"none",color:"#2563eb",cursor:"pointer",padding:"2px",display:"flex",alignItems:"center",fontSize:"12px",flexShrink:0},title:"St\xe1hnout soubor",children:(0,y.jsx)(nt.A,{size:14})}),((null===(e=n.name)||void 0===e?void 0:e.toLowerCase().endsWith(".pdf"))||"application/pdf"===n.type)&&(0,y.jsx)("button",{type:"button",onClick:()=>(async n=>{var e;const t=V.find(e=>e.id===n);if(!t)return;if(!(null===(e=t.name)||void 0===e?void 0:e.toLowerCase().endsWith(".pdf"))&&"application/pdf"!==t.type)return void(A&&A("OCR funguje pouze pro PDF soubory",{type:"error"}));let i=t.file;if(!i&&t.serverId)try{i=await(0,h.ML)({token:_,username:k,faktura_id:a,priloha_id:t.serverId,objednavka_id:o})}catch(d){return void(A&&A("Nepoda\u0159ilo se st\xe1hnout PDF pro OCR: "+d.message,{type:"error"}))}if(!i)return void(A&&A("Soubor nen\xed k dispozici pro OCR",{type:"error"}));const r=i instanceof File?i:new File([i],t.name,{type:"application/pdf"});let s=null;const l=(n,e)=>{const t=(0,y.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,y.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"8px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,y.jsx)(Xe.A,{size:20,color:"#8b5cf6",style:{flexShrink:0}}),(0,y.jsx)("span",{children:"OCR extrakce z PDF"})]}),(0,y.jsxs)("div",{style:{padding:"8px",backgroundColor:"#f5f3ff",borderRadius:"4px",fontSize:"13px",color:"#6d28d9"},children:[(0,y.jsx)("div",{style:{marginBottom:"4px"},children:e}),(0,y.jsx)("div",{style:{height:"4px",backgroundColor:"#e9d5ff",borderRadius:"2px",overflow:"hidden"},children:(0,y.jsx)("div",{style:{height:"100%",width:"".concat(n,"%"),backgroundColor:"#8b5cf6",transition:"width 0.3s ease"}})})]})]});s?A&&A(t,{type:"info",duration:999999}):s=A&&A(t,{type:"info",duration:999999})};try{const n=await(0,ot.p)(r,l),e=(0,ot.N)(n);if(console.log("\ud83d\udcc4 OCR Extracted Data:",e),e.warning){const n=(0,y.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,y.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"8px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,y.jsx)(Ge.A,{size:20,color:"#f59e0b",style:{flexShrink:0}}),(0,y.jsx)("span",{children:"Varov\xe1n\xed - Nen\xed faktura"})]}),(0,y.jsx)("div",{style:{padding:"8px",backgroundColor:"#fffbeb",borderRadius:"4px",fontSize:"13px",color:"#92400e"},children:e.warning})]});A&&A(n,{type:"warning",duration:8e3})}const t=[];if(e.variabilniSymbol&&t.push("Variabiln\xed symbol"),e.datumVystaveni&&t.push("Datum vystaven\xed"),e.datumSplatnosti&&t.push("Datum splatnosti"),e.castka&&t.push("\u010c\xe1stka"),0===t.length)return void(A&&A("\u274c Nepoda\u0159ilo se vyt\u011b\u017eit \u017e\xe1dn\xe1 data z PDF",{type:"error"}));const a=(0,y.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,y.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"8px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,y.jsx)(Ye.A,{size:20,color:"#10b981",style:{flexShrink:0}}),(0,y.jsx)("span",{children:"OCR extrakce \xfasp\u011b\u0161n\xe1"})]}),(0,y.jsxs)("div",{style:{padding:"8px",backgroundColor:"#f0fdf4",borderRadius:"4px",fontSize:"13px",color:"#166534"},children:[(0,y.jsx)("div",{style:{marginBottom:"4px",fontWeight:"500"},children:"Nalezen\xe9 \xfadaje:"}),e.variabilniSymbol&&(0,y.jsxs)("div",{children:["\u2022 Variabiln\xed symbol: ",e.variabilniSymbol]}),e.datumVystaveni&&(0,y.jsxs)("div",{children:["\u2022 Datum vystaven\xed: ",e.datumVystaveni]}),e.datumSplatnosti&&(0,y.jsxs)("div",{children:["\u2022 Datum splatnosti: ",e.datumSplatnosti]}),e.castka&&(0,y.jsxs)("div",{children:["\u2022 \u010c\xe1stka v\u010d. DPH: ",e.castka.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"]})]})]});A&&A(a,{type:"success",duration:1e4}),b&&b(e)}catch(d){console.error("\u274c OCR Error:",d);const n=(0,y.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,y.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"8px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,y.jsx)(An.A,{size:20,color:"#dc2626",style:{flexShrink:0}}),(0,y.jsx)("span",{children:"Chyba p\u0159i OCR extrakci"})]}),(0,y.jsxs)("div",{style:{padding:"8px",backgroundColor:"#fef2f2",borderRadius:"4px",fontSize:"13px",color:"#991b1b"},children:[d.message,(0,y.jsx)("div",{style:{marginTop:"8px",fontSize:"12px",color:"#6b7280"},children:"\ud83d\udca1 M\u016f\u017eete vyplnit \xfadaje manu\xe1ln\u011b z n\xe1hledu PDF"})]})]});A&&A(n,{type:"error",duration:8e3})}})(n.id),disabled:"uploading"===n.status,style:{background:"none",border:"none",color:"uploading"===n.status?"#9ca3af":"#8b5cf6",cursor:"uploading"===n.status?"not-allowed":"pointer",padding:"2px",display:"flex",alignItems:"center",opacity:"uploading"===n.status?.6:1,fontSize:"12px",flexShrink:0},title:"Vyt\u011b\u017eit \xfadaje pomoc\xed OCR",children:(0,y.jsx)(Xe.A,{size:14})}),!r&&(0,y.jsx)("button",{type:"button",onClick:()=>n.serverId?(async n=>{const e=V.find(e=>e.id===n);e&&e.serverId&&W({isOpen:!0,title:"Smazat p\u0159\xedlohu",message:'Opravdu chcete smazat p\u0159\xedlohu "'.concat(e.name,'"?'),onConfirm:async()=>{try{const n=await(0,h.vd)({token:_,username:k,faktura_id:a,priloha_id:e.serverId,objednavka_id:o,hard_delete:1});if(!n||"ok"!==n.status&&"success"!==n.status&&!0!==n.success)throw new Error((null===n||void 0===n?void 0:n.message)||"Neo\u010dek\xe1van\xe1 odpov\u011b\u010f serveru");n.data&&n.warning?(A&&A("\u26a0\ufe0f P\u0159\xedloha smaz\xe1na (s varov\xe1n\xedm)",{type:"warning"}),console.warn("\u26a0\ufe0f Warning:",n.warning)):A&&A("\ud83d\uddd1\ufe0f P\u0159\xedloha byla \xfasp\u011b\u0161n\u011b smaz\xe1na",{type:"success"}),W({isOpen:!1,title:"",message:"",onConfirm:null}),await K(),f&&f()}catch(t){var n;console.error("\u274c DELETE Error:",t),console.error("Error message:",t.message),console.error("Error response:",null===(n=t.response)||void 0===n?void 0:n.data),A&&A("Nepoda\u0159ilo se smazat p\u0159\xedlohu: ".concat(t.message),{type:"error"}),W({isOpen:!1,title:"",message:"",onConfirm:null})}}})})(n.id):(n=>{const e=V.find(e=>e.id===n);e&&W({isOpen:!0,title:"Odstranit p\u0159\xedlohu",message:'Opravdu chcete odstranit p\u0159\xedlohu "'.concat(e.name,'"?'),onConfirm:()=>{M(e=>e.filter(e=>e.id!==n)),A&&A("\u2705 P\u0159\xedloha odstran\u011bna",{type:"success"}),W({isOpen:!1,title:"",message:"",onConfirm:null})}})})(n.id),disabled:"uploading"===n.status,style:{background:"none",border:"none",color:"uploading"===n.status?"#9ca3af":"#dc2626",cursor:"uploading"===n.status?"not-allowed":"pointer",padding:"2px",display:"flex",alignItems:"center",opacity:"uploading"===n.status?.6:1,fontSize:"12px",flexShrink:0},title:n.serverId?"Smazat ze serveru":"Smazat soubor",children:(0,y.jsx)(et.A,{size:14})})]})}),(0,y.jsxs)("div",{style:{fontSize:"0.75rem",color:"#6b7280",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,y.jsx)("span",{children:n.uploadDate&&!isNaN(new Date(n.uploadDate).getTime())?"".concat(new Date(n.uploadDate).toLocaleDateString("cs-CZ")," ").concat(new Date(n.uploadDate).toLocaleTimeString("cs-CZ",{hour:"2-digit",minute:"2-digit"})):"\u2014"}),(0,y.jsx)("span",{children:"\u2022"}),(0,y.jsx)("span",{style:{textTransform:"uppercase",backgroundColor:"#fef3c7",color:"#92400e",padding:"2px 6px",borderRadius:"4px",fontSize:"0.6875rem",fontWeight:"500"},children:n.name?n.name.endsWith(".pdf")?"PDF":n.name.split(".").pop().toUpperCase():"FILE"}),(0,y.jsx)("span",{children:"\u2022"}),(0,y.jsxs)("span",{style:{backgroundColor:"#e0e7ff",color:"#3730a3",padding:"2px 6px",borderRadius:"4px",fontSize:"0.6875rem",fontWeight:"500"},children:["Nahr\xe1no: ",k||"Super ADMIN"]}),n.faktura_typ_nazev&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("span",{children:"\u2022"}),(0,y.jsx)("span",{style:{backgroundColor:"#dbeafe",color:"#1e40af",padding:"2px 6px",borderRadius:"4px",fontSize:"0.6875rem",fontWeight:"500"},children:n.faktura_typ_nazev})]})]})]}),(0,y.jsx)("div",{style:{minWidth:"180px",flexShrink:0},children:(0,y.jsxs)("select",{value:n.klasifikace||"",onChange:e=>(async(n,e)=>{const t=V.find(e=>e.id===n);if(t)if(M(t=>t.map(t=>t.id===n?(0,qe.A)((0,qe.A)({},t),{},{klasifikace:e}):t)),!e||""===e.trim()||"pending_classification"!==t.status&&"pending_upload"!==t.status){if(e&&""!==e.trim()&&"uploaded"===t.status&&t.serverId)try{if(t.klasifikace===e)return;await(0,h.v4)({token:_,username:k,faktura_id:a,priloha_id:t.serverId,objednavka_id:o,typ_prilohy:e,type:e});const r=i.find(n=>n.kod===e);M(t=>t.map(t=>t.id===n?(0,qe.A)((0,qe.A)({},t),{},{klasifikace:e,faktura_typ_nazev:(null===r||void 0===r?void 0:r.nazev)||e}):t)),A&&A("Klasifikace byla aktualizov\xe1na",{type:"success"})}catch(r){A&&A("Chyba p\u0159i aktualizaci: ".concat(r.message),{type:"error"}),M(e=>e.map(e=>e.id===n?(0,qe.A)((0,qe.A)({},e),{},{klasifikace:t.klasifikace}):e))}}else await X(n,e)})(n.id,e.target.value),disabled:"uploading"===n.status||r,style:{width:"100%",padding:"0.5rem 0.75rem",border:"1px solid ".concat(n.klasifikace?"#d1d5db":"#fca5a5"),borderRadius:"6px",fontSize:"0.875rem",backgroundColor:"uploading"===n.status||r?"#f3f4f6":"white",color:n.klasifikace?"#374151":"#6b7280",cursor:"uploading"===n.status||r?"not-allowed":"pointer",opacity:"uploading"===n.status||r?.6:1},children:[(0,y.jsx)("option",{value:"",style:{color:"#6b7280"},children:"Vyberte..."}),i.map(n=>(0,y.jsx)("option",{value:n.kod,children:n.nazev},n.kod))]})})]},n.id)})})]}),O&&E&&g.createPortal((0,y.jsx)(re,{isdocSummary:E,isdocData:null===N||void 0===N?void 0:N.isdocData,onConfirm:async function(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(N)try{var e,t;const{file:r,isdocData:d,otherFiles:c}=N;if(!l)throw new Error("Chyb\xed data formul\xe1\u0159e objedn\xe1vky");const p=(0,tt.GC)(d,l,n),u=a&&!String(a).startsWith("temp-");let m;if(u){const n=await(0,h.dN)({token:_,username:k,faktura_id:a,objednavka_id:o,typ_prilohy:"FAKTURA",file:r});m={faktura_id:a,priloha_id:n.priloha_id,priloha:n.priloha}}else m=await(0,h.Md)({token:_,username:k,objednavka_id:o,fa_castka:p.fa_castka,fa_cislo_vema:p.fa_cislo_vema,fa_datum_vystaveni:p.fa_datum_vystaveni,fa_datum_splatnosti:p.fa_datum_splatnosti,fa_datum_doruceni:p.fa_datum_doruceni,fa_strediska_kod:p.fa_strediska_kod,fa_poznamka:p.fa_poznamka,fa_dorucena:1,file:r,typ_prilohy:"FAKTURA"});if(s){const n=(0,qe.A)((0,qe.A)({},p),{},{id:m.faktura_id,_realId:m.faktura_id,_updateExisting:u});s(n,m.faktura_id)}const g=i.find(n=>"FAKTURA"===n.kod),x={id:m.priloha_id,serverId:m.priloha_id,faktura_id:m.faktura_id,objednavka_id:o,name:r.name,size:r.size,type:r.type,klasifikace:"FAKTURA",faktura_typ_nazev:(null===g||void 0===g?void 0:g.nazev)||"FAKTURA",uploadDate:(null===(e=m.priloha)||void 0===e?void 0:e.dt_vytvoreni)||(new Date).toISOString(),status:"uploaded",je_isdoc:1,guid:null===(t=m.priloha)||void 0===t?void 0:t.guid};M(n=>[...n,x]),c&&c.length>0&&await Z(c),R(!1),T(null),L(null),A&&A("Faktura v\u010detn\u011b ISDOC p\u0159\xedlohy byla \xfasp\u011b\u0161n\u011b vytvo\u0159ena",{type:"success"}),f&&f()}catch(r){A&&A(r.message||"Chyba p\u0159i vytv\xe1\u0159en\xed faktury s p\u0159\xedlohou",{type:"error"})}},onCancel:()=>{R(!1),T(null),L(null),A&&A("Nahr\xe1n\xed ISDOC zru\u0161eno",{type:"info"})},onUploadWithoutParsing:async()=>{if(N)try{const{file:n,otherFiles:e}=N,t={id:"pending-".concat(Date.now()),file:n,name:n.name,size:n.size,type:n.type,klasifikace:"ISDOC",uploadDate:(new Date).toISOString(),status:"pending_upload",je_isdoc:1};M(n=>[...n,t]),await X(t.id,"ISDOC"),e&&e.length>0&&await Z(e),R(!1),T(null),L(null),A&&A("ISDOC soubor byl nahr\xe1n bez extrakce dat",{type:"success"})}catch(n){A&&A(n.message||"Chyba p\u0159i nahr\xe1v\xe1n\xed ISDOC",{type:"error"})}}}),document.body),(0,y.jsx)(at.A,{isOpen:B.isOpen,title:B.title,confirmText:"Smazat",variant:"danger",onConfirm:B.onConfirm,onClose:()=>W({isOpen:!1,title:"",message:"",onConfirm:null}),children:B.message})]})})},29071:(n,e,t)=>{async function a(n){try{const e=await n.text(),t=(new DOMParser).parseFromString(e,"text/xml"),a=t.querySelector("parsererror");if(a)throw new Error("Chyba p\u0159i parsov\xe1n\xed ISDOC XML: "+a.textContent);const r=t.querySelector("Invoice")||t.documentElement,s=o(r,"ID"),l=o(r,"IssueDate"),d=o(r,"TaxPointDate"),c=o(r,["PaymentMeans Payment Details PaymentDueDate","PaymentMeans Payment Details DueDate","PaymentMeans Payment PaymentDueDate","PaymentMeans PaymentDueDate","DueDate","PaymentDueDate"].join(", ")),p=o(r,"Note"),f=r.querySelector("AccountingSupplierParty Party"),u=o(f,"PartyName Name"),m=o(f,"PartyIdentification RegisterIdentificationID, PartyIdentification ID"),g=o(f,"PartyTaxScheme CompanyID, TaxRegistration"),x=f?i(f.querySelector("PostalAddress")):null,h=r.querySelector("AccountingCustomerParty Party"),y=o(h,"PartyName Name"),v=o(h,"PartyIdentification RegisterIdentificationID, PartyIdentification ID"),b=o(h,"PartyTaxScheme CompanyID"),k=h?i(h.querySelector("PostalAddress")):null,_=o(h,"Contact ElectronicMail")||o(r,"AccountingCustomerParty Party Contact ElectronicMail")||o(r,"Contact ElectronicMail"),A=[];r.querySelectorAll("InvoiceLine").forEach(n=>{var e;const t=n.querySelector("Item");let a="";if(t){const n=t.querySelector(":scope > Description"),e=t.querySelector(":scope > Name");a=((null===n||void 0===n?void 0:n.textContent)||(null===e||void 0===e?void 0:e.textContent)||"").trim()}const i={id:o(n,"ID"),popis:a,mnozstvi:parseFloat(o(n,"InvoicedQuantity"))||1,jednotka:(null===(e=o(n,"InvoicedQuantity").match(/unitCode="([^"]+)"/))||void 0===e?void 0:e[1])||"ks",cena_za_jednotku:parseFloat(o(n,"Item ClassifiedTaxCategory UnitPricePrimaryAmount, UnitPrice"))||0,cena_celkem_bez_dph:parseFloat(o(n,"LineExtensionAmount"))||0,sazba_dph:parseFloat(o(n,"Item ClassifiedTaxCategory Percent"))||21,cena_celkem_s_dph:0};i.cena_celkem_s_dph=i.cena_celkem_bez_dph*(1+i.sazba_dph/100),A.push(i)});const j=parseFloat(o(r,"TaxTotal TaxAmount"))||0,w=parseFloat(o(r,"LegalMonetaryTotal TaxExclusiveAmount"))||0,z=parseFloat(o(r,"LegalMonetaryTotal TaxInclusiveAmount"))||0,C=parseFloat(o(r,"LegalMonetaryTotal PayableAmount"))||z,S=parseFloat(o(r,"LegalMonetaryTotal AllowanceTotalAmount"))||0,D=parseFloat(o(r,"LegalMonetaryTotal ChargeTotalAmount"))||0,P=[];r.querySelectorAll("AllowanceCharge").forEach(n=>{const e="true"===o(n,"ChargeIndicator"),t=parseFloat(o(n,"Amount"))||0,a=o(n,"AllowanceChargeReason");t>0&&P.push({typ:e?"PRIPLATEK":"SLEVA",castka:t,duvod:a})});const I=A.reduce((n,e)=>n+e.cena_celkem_s_dph,0),F=I-C,O=F>0?F:S,R=I>0?O/I*100:0,N=r.querySelector("PaymentMeans"),T=o(N,"PayeeFinancialAccount ID, PayeeFinancialAccount AccountNumber"),E=o(N,"PayeeFinancialAccount FinancialInstitutionBranch ID, PayeeFinancialAccount BankCode"),L=o(N,"PayeeFinancialAccount IBAN"),B=o(N,"PayeeFinancialAccount FinancialInstitutionBranch FinancialInstitution ID, PayeeFinancialAccount SWIFT"),W=o(N,["Payment Details VariableSymbol","Payment VariableSymbol","Details VariableSymbol","VariableSymbol"].join(", ")),V=o(N,["Payment Details ConstantSymbol","Payment ConstantSymbol","Details ConstantSymbol","ConstantSymbol"].join(", ")),M=o(N,["Payment Details SpecificSymbol","Payment SpecificSymbol","Details SpecificSymbol","SpecificSymbol"].join(", "));return{cislo_faktury:s,datum_vystaveni:l,datum_zdanitelneho_plneni:d||l,datum_splatnosti:c,poznamka:p,dodavatel:{nazev:u,ico:m,dic:g,adresa:x},odberatel:{nazev:y,ico:v,dic:b,adresa:k,email:_},polozky:A,pocet_polozek:A.length,castka_bez_dph:w,dph_celkem:j,castka_s_dph:C,sleva_celkem:O,sleva_procenta:R,sleva_deklarovana:S,priplatek_celkem:D,slevy_a_priplatky:P,ma_slevu:O>0||S>0,soucet_polozek_s_dph:I,platba:{bankovni_ucet:T,kod_banky:E,iban:L,swift:B,variabilni_symbol:W,konstantni_symbol:V,specificky_symbol:M},_parsed:!0,_parsedAt:(new Date).toISOString(),_fileName:n.name}}catch(e){throw new Error("Nepoda\u0159ilo se naparsovat ISDOC soubor: ".concat(e.message))}}function o(n,e){if(!n)return"";const t=e.split(",").map(n=>n.trim());for(const a of t){const e=n.querySelector(a);if(e&&e.textContent.trim())return e.textContent.trim()}return""}function i(n){if(!n)return null;const e=o(n,"StreetName"),t=o(n,"BuildingNumber"),a=o(n,"CityName"),i=o(n,"PostalZone"),r=o(n,"Country IdentificationCode, Country Name");return[e&&t?"".concat(e," ").concat(t):e||t,i&&a?"".concat(i," ").concat(a):i||a,r].filter(Boolean).join(", ")||null}function r(n){var e,t,a;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=(new Date).toISOString().split("T")[0],s=function(n){if(!n||0===n.length)return"";const e=["=== FAKTUROVAN\xc9 POLO\u017dKY ===",""];return n.forEach((n,t)=>{e.push("".concat(t+1,". ").concat(n.popis||"Polo\u017eka")),e.push("   Mno\u017estv\xed: ".concat(n.mnozstvi," ").concat(n.jednotka)),e.push("   Cena/jedn.: ".concat(n.cena_za_jednotku.toLocaleString("cs-CZ",{minimumFractionDigits:2})," K\u010d")),e.push("   Celkem bez DPH: ".concat(n.cena_celkem_bez_dph.toLocaleString("cs-CZ",{minimumFractionDigits:2})," K\u010d")),e.push("   DPH ".concat(n.sazba_dph,"%: ").concat((n.cena_celkem_s_dph-n.cena_celkem_bez_dph).toLocaleString("cs-CZ",{minimumFractionDigits:2})," K\u010d")),e.push("   Celkem s DPH: ".concat(n.cena_celkem_s_dph.toLocaleString("cs-CZ",{minimumFractionDigits:2})," K\u010d")),e.push("")}),e.join("\n")}(n.polozky);return{fa_cislo_vema:i?(null===(e=n.platba)||void 0===e?void 0:e.variabilni_symbol)||n.cislo_faktury||"":n.cislo_faktury||"",fa_datum_vystaveni:n.datum_vystaveni||"",fa_datum_zdanitelneho_plneni:n.datum_zdanitelneho_plneni||n.datum_vystaveni||"",fa_datum_splatnosti:n.datum_splatnosti||"",fa_datum_doruceni:r,fa_castka:n.castka_s_dph||0,fa_castka_bez_dph:n.castka_bez_dph||0,fa_dph:n.dph_celkem||0,fa_poznamka:s,fa_strediska_kod:o.strediska_kod||[],isdoc_data_json:JSON.stringify(n),_isdoc_platba:n.platba,_isdoc_polozky:n.polozky,_isdoc_pocet_polozek:n.pocet_polozek,_isdoc_dodavatel:n.dodavatel,_isdoc_email:null===(t=n.odberatel)||void 0===t?void 0:t.email,_isdoc_cislo_faktury:n.cislo_faktury,_isdoc_variabilni_symbol:null===(a=n.platba)||void 0===a?void 0:a.variabilni_symbol,_isdoc_parsed:!0,_isdoc_parsed_at:n._parsedAt,_isdoc_file_name:n._fileName}}function s(n){var e,t,a;return{cislo_faktury:n.cislo_faktury||"---",variabilni_symbol:(null===(e=n.platba)||void 0===e?void 0:e.variabilni_symbol)||"---",datum_vystaveni:n.datum_vystaveni||"---",dodavatel:(null===(t=n.dodavatel)||void 0===t?void 0:t.nazev)||"---",castka_s_dph:n.castka_s_dph?"".concat(parseFloat(n.castka_s_dph).toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"):"---",pocet_polozek:n.pocet_polozek||0,celkova_castka_polozek:(null===(a=n.polozky)||void 0===a?void 0:a.reduce((n,e)=>n+(e.cena_celkem_s_dph||0),0))||0,polozky:n.polozky||[],ma_slevu:n.ma_slevu||!1,sleva_celkem:n.sleva_celkem||0,sleva_procenta:n.sleva_procenta||0,slevy_a_priplatky:n.slevy_a_priplatky||[]}}t.d(e,{GC:()=>r,pd:()=>s,qU:()=>a})},29521:(n,e,t)=>{t.d(e,{N:()=>r,p:()=>i});var a=t(61257);async function o(n){const e=await t.e(8801).then(t.bind(t,68801));console.log("\ud83d\udcc4 Loading PDF from ArrayBuffer (".concat(n.byteLength," bytes)..."));const a=e.getDocument({data:n,verbosity:0}),o=await a.promise;console.log("\ud83d\udcc4 PDF loaded: ".concat(o.numPages," pages"));const i=await o.getPage(1);console.log("\ud83d\udcc4 Page 1 loaded");const r=i.getViewport({scale:2});console.log("\ud83d\udcc4 Viewport: ".concat(r.width,"x").concat(r.height,"px"));const s=document.createElement("canvas"),l=s.getContext("2d");s.width=r.width,s.height=r.height;const d=i.render({canvasContext:l,viewport:r});return await d.promise,console.log("\u2705 PDF rendered to canvas"),s}async function i(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;try{if(!n||!(n instanceof ArrayBuffer))throw new Error("Neplatn\xfd ArrayBuffer");if(console.log("\ud83d\udcc4 Starting OCR extraction (".concat(n.byteLength," bytes, attempt ").concat(t+1,"/").concat(3,")")),e(0,"Na\u010d\xedt\xe1m PDF..."),0===n.byteLength)throw new Error("PDF soubor je pr\xe1zdn\xfd");if(n.byteLength<100)throw new Error("PDF soubor je p\u0159\xedli\u0161 mal\xfd (mo\u017en\xe1 nen\xed kompletn\xed)");let f,u;e(10,"P\u0159ev\xe1d\xedm PDF na obr\xe1zek...");try{f=await Promise.race([o(n),new Promise((n,e)=>setTimeout(()=>e(new Error("Timeout p\u0159i konverzi PDF (30s)")),3e4))]),console.log("\u2705 PDF converted to canvas: ".concat(f.width,"x").concat(f.height,"px"))}catch(l){if(console.error("\u274c PDF conversion error:",l),t<2)return console.log("\ud83d\udd04 Retrying PDF conversion (attempt ".concat(t+2,"/").concat(3,")...")),e(5,"Opakuji pokus ".concat(t+2,"/").concat(3,"...")),await new Promise(n=>setTimeout(n,1e3)),i(n,e,t+1);throw new Error("Nepoda\u0159ilo se p\u0159ev\xe9st PDF na obr\xe1zek: ".concat(l.message))}e(30,"P\u0159ipravuji optimalizovan\xfd OCR engine...");try{u=await Promise.race([(0,a.createWorker)("ces",1,{logger:n=>{if("recognizing text"===n.status){const t=30+60*n.progress;e(t,"Rozpozn\xe1v\xe1m text: ".concat(Math.round(100*n.progress),"%"))}}}),new Promise((n,e)=>setTimeout(()=>e(new Error("Timeout p\u0159i inicializaci OCR (30s)")),3e4))]),await u.setParameters({tessedit_pageseg_mode:"3",preserve_interword_spaces:"1",tessedit_char_whitelist:"0123456789.,/:- ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\xc1\xe1\u010c\u010d\u010e\u010f\xc9\xe9\u011a\u011b\xcd\xed\u0147\u0148\xd3\xf3\u0158\u0159\u0160\u0161\u0164\u0165\xda\xfa\u016e\u016f\xdd\xfd\u017d\u017e"}),console.log("\ud83d\udcd0 Canvas size: ".concat(f.width,"x").concat(f.height,"px (scale: 2.0x)"))}catch(d){if(console.error("\u274c Worker creation error:",d),t<2)return console.log("\ud83d\udd04 Retrying OCR init (attempt ".concat(t+2,"/").concat(3,")...")),e(5,"Opakuji pokus ".concat(t+2,"/").concat(3,"...")),await new Promise(n=>setTimeout(n,1e3)),i(n,e,t+1);throw new Error("Nepoda\u0159ilo se spustit OCR engine. Zkuste obnovit str\xe1nku.")}let m="";try{var r,s;e(90,"Dokon\u010duji rozpozn\xe1v\xe1n\xed...");const n=await Promise.race([u.recognize(f),new Promise((n,e)=>setTimeout(()=>e(new Error("Timeout p\u0159i OCR (".concat(90,"s)"))),9e4))]);m=(null===n||void 0===n||null===(r=n.data)||void 0===r?void 0:r.text)||"";const t=(null===n||void 0===n||null===(s=n.data)||void 0===s?void 0:s.confidence)||0;if(console.log("\u2705 OCR completed: ".concat(m.length," characters, confidence: ").concat(t.toFixed(1),"%")),!m||0===m.trim().length)throw new Error("PDF neobsahuje rozpoznateln\xfd text. Dokument m\u016f\u017ee b\xfdt pr\xe1zdn\xfd nebo ve \u0161patn\xe9 kvalit\u011b.")}catch(c){if(console.error("\u274c Recognition error:",c),t<2&&!c.message.includes("Timeout"))return console.log("\ud83d\udd04 Retrying recognition (attempt ".concat(t+2,"/").concat(3,")...")),await u.terminate(),i(n,e,t+1);throw new Error("OCR selhalo: "+(c.message||"Nezn\xe1m\xe1 chyba"))}finally{try{await u.terminate()}catch(p){console.warn("\u26a0\ufe0f Worker termination error:",p)}}return e(100,"Hotovo!"),m}catch(f){throw console.error("\ud83d\udca5 OCR extraction error:",f,f.stack),f}}function r(n){const e={datumVystaveni:null,datumSplatnosti:null,variabilniSymbol:null,castka:null,isFaktura:!1,warning:null},t=n.toLowerCase(),a=(n.split("\n").map(n=>n.trim()).filter(n=>n.length>0),["faktura","invoice","da\u0148ov\xfd doklad","tax invoice"].some(n=>t.includes(n)));e.isFaktura=a,a||(t.includes("objedn\xe1vka")||t.includes("order")?e.warning="Dokument se zd\xe1 b\xfdt objedn\xe1vkou, ne fakturou. OCR extrakce nemus\xed b\xfdt relevantn\xed.":t.includes("dodac\xed list")||t.includes("delivery note")?e.warning="Dokument se zd\xe1 b\xfdt dodac\xedm listem, ne fakturou. OCR extrakce nemus\xed b\xfdt relevantn\xed.":t.includes("nab\xeddka")||t.includes("quotation")?e.warning="Dokument se zd\xe1 b\xfdt cenovou nab\xeddkou, ne fakturou. OCR extrakce nemus\xed b\xfdt relevantn\xed.":e.warning='Dokument neobsahuje slovo "FAKTURA". M\u016f\u017ee se jednat o jin\xfd typ dokumentu (objedn\xe1vku, dodac\xed list, nab\xeddku).');const o=[/(?:variabiln[i\xed]\s*symbol|var\.?\s*symbol|vs)[:\s]*(\d{4,})/i,/(?:\u010d\xedslo\s*faktury|faktura\s*\u010d\xedslo|faktura\s*\u010d\.?)[:\s]*(\d{4,})/i,/\b(\d{8,})\b/];for(const s of o){const t=n.match(s);if(t&&t[1]){e.variabilniSymbol=t[1].trim();break}}const i=[],r=/(\d{1,2}[\s./-]*\d{1,2}[\s./-]*\d{4})/g;let d;for(;null!==(d=r.exec(n));){const e=d[1],t=d.index,a=t+e.length,o=n.substring(Math.max(0,t-100),t),r=n.substring(a,Math.min(n.length,a+50)),l=(o+" "+r).toLowerCase().replace(/\s+/g," ").replace(/[^\w\s:.-]/g,""),c=e.replace(/\s+/g,""),p=s(c);p&&i.push({date:c,originalDate:e,parsed:p,contextBefore:o.toLowerCase(),contextAfter:r.toLowerCase(),fullContext:l,position:t})}console.log("\ud83d\udcc5 Found ".concat(i.length," dates in document:")),i.forEach((n,e)=>{console.log("  ".concat(e+1,". ").concat(n.date," (").concat(n.parsed,") - context: ...").concat(n.contextBefore.slice(-30),"[DATE]").concat(n.contextAfter.slice(0,30),"..."))});const c=[{word:"datum vystaveni",score:20,aliases:["datumvystaveni","dat vystaveni","dat.vystaveni"]},{word:"datum vystaven\xed",score:20,aliases:["datumvystaven\xed"]},{word:"vystaveni dokladu",score:18,aliases:["vystav\xe9n\xeddokladu","vystaveni dokl"]},{word:"datum dokladu",score:16,aliases:["datdokladu","dat.dokladu"]},{word:"vystaveno",score:14,aliases:["vystav\u011bno"]},{word:"date of issue",score:15,aliases:[]},{word:"datum vytvoreni",score:12,aliases:["datumvytvoreni"]},{word:"datum vytvo\u0159en\xed",score:12,aliases:["datumvytvo\u0159en\xed"]},{word:"issued",score:10,aliases:[]},{word:"daturn vystaveni",score:18,aliases:[]},{word:"oatum vystaveni",score:18,aliases:[]},{word:"vystavem",score:12,aliases:[]}];let p=null,f=0,u="";for(const s of i){let n=0,e=[];for(const i of c){const t=i.word,a=i.score,o=i.aliases||[];if(s.fullContext.includes(t)){n+=a,e.push(t);s.contextBefore.slice(-30).includes(t)&&(n+=Math.floor(.5*a))}for(const i of o)s.fullContext.includes(i)&&(n+=Math.floor(.8*a),e.push("".concat(i,"(alias)")))}const t=["splatnost","splatnosti","splatno","splatne","due date","payment due","zaplatit","uhradit","uhrazen","zaplaceno"];for(const i of t)s.fullContext.includes(i)&&(n-=30,e.push("-".concat(i,"(penalty)")));(s.fullContext.includes("zdanitelneho")||s.fullContext.includes("zdaniteln\xe9ho")||s.fullContext.includes("zdanitelne")||s.fullContext.includes("plneni"))&&(n-=20,e.push("-zdanitelneho/plneni(penalty)"));const a=s.contextBefore.includes(" dne ")||s.contextBefore.includes(" dne:"),o=e.some(n=>n.includes("datum")||n.includes("vystaveni")||n.includes("dokladu"));a&&!o&&(n-=10,e.push("-weak_dne(penalty)")),e.length>0&&console.log("  \ud83d\udcc5 Date ".concat(s.date,": Keywords: ").concat(e.join(", ")," \u2192 score: ").concat(n)),n>f&&(f=n,p=s.parsed,u="".concat(s.date," [").concat(e.join(", "),"]"))}e.datumVystaveni=p,console.log("\u2705 Best datum vystaven\xed: ".concat(p," (score: ").concat(f,") - ").concat(u));const m=[{word:"datum splatnosti",score:20,aliases:["datumsplatnosti","dat splatnosti","dat.splatnosti"]},{word:"termin splatnosti",score:18,aliases:["terminsplatnosti"]},{word:"splatnost:",score:16,aliases:["splatnost :"]},{word:"splatnost",score:14,aliases:[]},{word:"due date",score:17,aliases:["duedate"]},{word:"payment due",score:17,aliases:["paymentdue"]},{word:"splatne",score:13,aliases:["splatn\xe9"]},{word:"splatno",score:13,aliases:[]},{word:"splatna dne",score:15,aliases:["splatnadne"]},{word:"zaplatit do",score:12,aliases:["zaplatitdo"]},{word:"uhradit do",score:12,aliases:["uhraditdo"]},{word:"oatum splatnosti",score:18,aliases:[]},{word:"splamost",score:13,aliases:[]}];let g=null,x=0,h="";for(const s of i){let n=0,t=[];for(const e of m){const a=e.word,o=e.score,i=e.aliases||[];if(s.fullContext.includes(a)){n+=o,t.push(a);s.contextBefore.slice(-30).includes(a)&&(n+=Math.floor(.5*o))}for(const e of i)s.fullContext.includes(e)&&(n+=Math.floor(.8*o),t.push("".concat(e,"(alias)")))}const a=["vystaveni","vystaven\xed","vystaveno","datum dokladu","issued","date of issue","vytvoreni","vytvo\u0159en\xed","datum vytvoreni"];for(const e of a)s.fullContext.includes(e)&&(n-=30,t.push("-".concat(e,"(penalty)")));(s.fullContext.includes("zdanitelneho")||s.fullContext.includes("zdaniteln\xe9ho")||s.fullContext.includes("zdanitelne")||s.fullContext.includes("plneni"))&&(n-=20,t.push("-zdanitelneho/plneni(penalty)")),e.datumVystaveni&&s.parsed>e.datumVystaveni?(n+=10,t.push("+later_than_issue(+10)")):e.datumVystaveni&&s.parsed===e.datumVystaveni&&(n-=15,t.push("-same_as_issue(penalty)")),t.length>0&&console.log("  \ud83d\udcc5 Date ".concat(s.date,": Keywords: ").concat(t.join(", ")," \u2192 score: ").concat(n)),n>x&&(x=n,g=s.parsed,h="".concat(s.date," [").concat(t.join(", "),"]"))}e.datumSplatnosti=g,console.log("\u2705 Best datum splatnosti: ".concat(g," (score: ").concat(x,") - ").concat(h));const y=[/(?:celkem|v\u010detn\u011b\s*dph|s\s*dph|k\s*\xfahrad\u011b|k\s*zaplacen\xed)[:\s]*(\d+(?:[,\s]\d{3})*[,.]?\d{0,2})\s*(?:k\u010d|czk)?/i,/(?:cena\s*celkem|celkov\xe1\s*cena|total\s*price)[:\s]*(\d+(?:[,\s]\d{3})*[,.]?\d{0,2})\s*(?:k\u010d|czk)?/i,/(?:\u010d\xe1stka|cena|amount|price)[:\s]*(\d+(?:[,\s]\d{3})*[,.]?\d{0,2})\s*(?:k\u010d|czk)?/i,/(\d+(?:[,\s]\d{3})*[,.]?\d{2})\s*(?:k\u010d|czk)?\s*celkem/i,/(?:celkem|cena)[:\s]*(\d{1,3}(?:\s\d{3})*[,.]?\d{0,2})\s*(?:k\u010d|czk)?/i];for(const s of y){const t=n.match(s);if(t&&t[1]){e.castka=l(t[1]);break}}if(!e.castka){const t=n.match(/(\d+(?:[,\s]\d{3})*[,.]?\d{2})\s*(?:k\u010d|czk)/gi);if(t&&t.length>0){const n=t.map(n=>l(n));e.castka=Math.max(...n)}}return e}function s(n){const e=n.split(/[./-]/);if(3===e.length){const n=e[0].padStart(2,"0"),t=e[1].padStart(2,"0"),a=e[2];return"".concat(a,"-").concat(t,"-").concat(n)}return null}function l(n){if(!n)return null;let e=n.replace(/[^\d,.]/g,"");e=e.replace(/\s/g,"");const t=(e.match(/,/g)||[]).length,a=(e.match(/\./g)||[]).length;let o=e;if(1===t&&0===a)o=e.replace(",",".");else if(0===t&&1===a)o=e;else if(t>0&&a>0){o=e.lastIndexOf(",")>e.lastIndexOf(".")?e.replace(/\./g,"").replace(",","."):e.replace(/,/g,"")}else t>1?o=e.replace(/,/g,""):a>1&&(o=e.replace(/\./g,""));const i=parseFloat(o);return console.log('\ud83d\udcb0 parseAmount: "'.concat(n,'" \u2192 "').concat(e,'" \u2192 "').concat(o,'" \u2192 ').concat(i)),isNaN(i)?null:i}}}]);
//# sourceMappingURL=4569.78f6a727.chunk.js.map