"use strict";(self.webpackChunkr_app_zzs_eeo=self.webpackChunkr_app_zzs_eeo||[]).push([[692],{29071:(n,e,t)=>{async function o(n){try{const e=await n.text(),t=(new DOMParser).parseFromString(e,"text/xml"),o=t.querySelector("parsererror");if(o)throw new Error("Chyba p\u0159i parsov\xe1n\xed ISDOC XML: "+o.textContent);const r=t.querySelector("Invoice")||t.documentElement,s=a(r,"ID"),l=a(r,"IssueDate"),d=a(r,"TaxPointDate"),c=a(r,["PaymentMeans Payment Details PaymentDueDate","PaymentMeans Payment Details DueDate","PaymentMeans Payment PaymentDueDate","PaymentMeans PaymentDueDate","DueDate","PaymentDueDate"].join(", ")),p=a(r,"Note"),f=r.querySelector("AccountingSupplierParty Party"),u=a(f,"PartyName Name"),g=a(f,"PartyIdentification RegisterIdentificationID, PartyIdentification ID"),h=a(f,"PartyTaxScheme CompanyID, TaxRegistration"),x=f?i(f.querySelector("PostalAddress")):null,m=r.querySelector("AccountingCustomerParty Party"),v=a(m,"PartyName Name"),y=a(m,"PartyIdentification RegisterIdentificationID, PartyIdentification ID"),b=a(m,"PartyTaxScheme CompanyID"),k=m?i(m.querySelector("PostalAddress")):null,_=a(m,"Contact ElectronicMail")||a(r,"AccountingCustomerParty Party Contact ElectronicMail")||a(r,"Contact ElectronicMail"),A=[];r.querySelectorAll("InvoiceLine").forEach(n=>{var e;const t=n.querySelector("Item");let o="";if(t){const n=t.querySelector(":scope > Description"),e=t.querySelector(":scope > Name");o=((null===n||void 0===n?void 0:n.textContent)||(null===e||void 0===e?void 0:e.textContent)||"").trim()}const i={id:a(n,"ID"),popis:o,mnozstvi:parseFloat(a(n,"InvoicedQuantity"))||1,jednotka:(null===(e=a(n,"InvoicedQuantity").match(/unitCode="([^"]+)"/))||void 0===e?void 0:e[1])||"ks",cena_za_jednotku:parseFloat(a(n,"Item ClassifiedTaxCategory UnitPricePrimaryAmount, UnitPrice"))||0,cena_celkem_bez_dph:parseFloat(a(n,"LineExtensionAmount"))||0,sazba_dph:parseFloat(a(n,"Item ClassifiedTaxCategory Percent"))||21,cena_celkem_s_dph:0};i.cena_celkem_s_dph=i.cena_celkem_bez_dph*(1+i.sazba_dph/100),A.push(i)});const w=parseFloat(a(r,"TaxTotal TaxAmount"))||0,j=parseFloat(a(r,"LegalMonetaryTotal TaxExclusiveAmount"))||0,z=parseFloat(a(r,"LegalMonetaryTotal TaxInclusiveAmount"))||0,C=parseFloat(a(r,"LegalMonetaryTotal PayableAmount"))||z,S=parseFloat(a(r,"LegalMonetaryTotal AllowanceTotalAmount"))||0,D=parseFloat(a(r,"LegalMonetaryTotal ChargeTotalAmount"))||0,P=[];r.querySelectorAll("AllowanceCharge").forEach(n=>{const e="true"===a(n,"ChargeIndicator"),t=parseFloat(a(n,"Amount"))||0,o=a(n,"AllowanceChargeReason");t>0&&P.push({typ:e?"PRIPLATEK":"SLEVA",castka:t,duvod:o})});const I=A.reduce((n,e)=>n+e.cena_celkem_s_dph,0),F=I-C,E=F>0?F:S,T=I>0?E/I*100:0,O=r.querySelector("PaymentMeans"),L=a(O,"PayeeFinancialAccount ID, PayeeFinancialAccount AccountNumber"),N=a(O,"PayeeFinancialAccount FinancialInstitutionBranch ID, PayeeFinancialAccount BankCode"),R=a(O,"PayeeFinancialAccount IBAN"),M=a(O,"PayeeFinancialAccount FinancialInstitutionBranch FinancialInstitution ID, PayeeFinancialAccount SWIFT"),B=a(O,["Payment Details VariableSymbol","Payment VariableSymbol","Details VariableSymbol","VariableSymbol"].join(", ")),V=a(O,["Payment Details ConstantSymbol","Payment ConstantSymbol","Details ConstantSymbol","ConstantSymbol"].join(", ")),W=a(O,["Payment Details SpecificSymbol","Payment SpecificSymbol","Details SpecificSymbol","SpecificSymbol"].join(", "));return{cislo_faktury:s,datum_vystaveni:l,datum_zdanitelneho_plneni:d||l,datum_splatnosti:c,poznamka:p,dodavatel:{nazev:u,ico:g,dic:h,adresa:x},odberatel:{nazev:v,ico:y,dic:b,adresa:k,email:_},polozky:A,pocet_polozek:A.length,castka_bez_dph:j,dph_celkem:w,castka_s_dph:C,sleva_celkem:E,sleva_procenta:T,sleva_deklarovana:S,priplatek_celkem:D,slevy_a_priplatky:P,ma_slevu:E>0||S>0,soucet_polozek_s_dph:I,platba:{bankovni_ucet:L,kod_banky:N,iban:R,swift:M,variabilni_symbol:B,konstantni_symbol:V,specificky_symbol:W},_parsed:!0,_parsedAt:(new Date).toISOString(),_fileName:n.name}}catch(e){throw new Error("Nepoda\u0159ilo se naparsovat ISDOC soubor: ".concat(e.message))}}function a(n,e){if(!n)return"";const t=e.split(",").map(n=>n.trim());for(const o of t){const e=n.querySelector(o);if(e&&e.textContent.trim())return e.textContent.trim()}return""}function i(n){if(!n)return null;const e=a(n,"StreetName"),t=a(n,"BuildingNumber"),o=a(n,"CityName"),i=a(n,"PostalZone"),r=a(n,"Country IdentificationCode, Country Name");return[e&&t?"".concat(e," ").concat(t):e||t,i&&o?"".concat(i," ").concat(o):i||o,r].filter(Boolean).join(", ")||null}function r(n){var e,t,o;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=(new Date).toISOString().split("T")[0],s=function(n){if(!n||0===n.length)return"";const e=["=== FAKTUROVAN\xc9 POLO\u017dKY ===",""];return n.forEach((n,t)=>{e.push("".concat(t+1,". ").concat(n.popis||"Polo\u017eka")),e.push("   Mno\u017estv\xed: ".concat(n.mnozstvi," ").concat(n.jednotka)),e.push("   Cena/jedn.: ".concat(n.cena_za_jednotku.toLocaleString("cs-CZ",{minimumFractionDigits:2})," K\u010d")),e.push("   Celkem bez DPH: ".concat(n.cena_celkem_bez_dph.toLocaleString("cs-CZ",{minimumFractionDigits:2})," K\u010d")),e.push("   DPH ".concat(n.sazba_dph,"%: ").concat((n.cena_celkem_s_dph-n.cena_celkem_bez_dph).toLocaleString("cs-CZ",{minimumFractionDigits:2})," K\u010d")),e.push("   Celkem s DPH: ".concat(n.cena_celkem_s_dph.toLocaleString("cs-CZ",{minimumFractionDigits:2})," K\u010d")),e.push("")}),e.join("\n")}(n.polozky);return{fa_cislo_vema:i?(null===(e=n.platba)||void 0===e?void 0:e.variabilni_symbol)||n.cislo_faktury||"":n.cislo_faktury||"",fa_datum_vystaveni:n.datum_vystaveni||"",fa_datum_zdanitelneho_plneni:n.datum_zdanitelneho_plneni||n.datum_vystaveni||"",fa_datum_splatnosti:n.datum_splatnosti||"",fa_datum_doruceni:r,fa_castka:n.castka_s_dph||0,fa_castka_bez_dph:n.castka_bez_dph||0,fa_dph:n.dph_celkem||0,fa_poznamka:s,fa_strediska_kod:a.strediska_kod||[],isdoc_data_json:JSON.stringify(n),_isdoc_platba:n.platba,_isdoc_polozky:n.polozky,_isdoc_pocet_polozek:n.pocet_polozek,_isdoc_dodavatel:n.dodavatel,_isdoc_email:null===(t=n.odberatel)||void 0===t?void 0:t.email,_isdoc_cislo_faktury:n.cislo_faktury,_isdoc_variabilni_symbol:null===(o=n.platba)||void 0===o?void 0:o.variabilni_symbol,_isdoc_parsed:!0,_isdoc_parsed_at:n._parsedAt,_isdoc_file_name:n._fileName}}function s(n){var e,t,o;return{cislo_faktury:n.cislo_faktury||"---",variabilni_symbol:(null===(e=n.platba)||void 0===e?void 0:e.variabilni_symbol)||"---",datum_vystaveni:n.datum_vystaveni||"---",dodavatel:(null===(t=n.dodavatel)||void 0===t?void 0:t.nazev)||"---",castka_s_dph:n.castka_s_dph?"".concat(parseFloat(n.castka_s_dph).toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"):"---",pocet_polozek:n.pocet_polozek||0,celkova_castka_polozek:(null===(o=n.polozky)||void 0===o?void 0:o.reduce((n,e)=>n+(e.cena_celkem_s_dph||0),0))||0,polozky:n.polozky||[],ma_slevu:n.ma_slevu||!1,sleva_celkem:n.sleva_celkem||0,sleva_procenta:n.sleva_procenta||0,slevy_a_priplatky:n.slevy_a_priplatky||[]}}t.d(e,{GC:()=>r,pd:()=>s,qU:()=>o})},29521:(n,e,t)=>{t.d(e,{N:()=>r,p:()=>i});var o=t(61257);async function a(n){const e=await t.e(8801).then(t.bind(t,68801));console.log("\ud83d\udcc4 Loading PDF from ArrayBuffer (".concat(n.byteLength," bytes)..."));const o=e.getDocument({data:n,verbosity:0}),a=await o.promise;console.log("\ud83d\udcc4 PDF loaded: ".concat(a.numPages," pages"));const i=await a.getPage(1);console.log("\ud83d\udcc4 Page 1 loaded");const r=i.getViewport({scale:2});console.log("\ud83d\udcc4 Viewport: ".concat(r.width,"x").concat(r.height,"px"));const s=document.createElement("canvas"),l=s.getContext("2d");s.width=r.width,s.height=r.height;const d=i.render({canvasContext:l,viewport:r});return await d.promise,console.log("\u2705 PDF rendered to canvas"),s}async function i(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;try{if(!n||!(n instanceof ArrayBuffer))throw new Error("Neplatn\xfd ArrayBuffer");if(console.log("\ud83d\udcc4 Starting OCR extraction (".concat(n.byteLength," bytes, attempt ").concat(t+1,"/").concat(3,")")),e(0,"Na\u010d\xedt\xe1m PDF..."),0===n.byteLength)throw new Error("PDF soubor je pr\xe1zdn\xfd");if(n.byteLength<100)throw new Error("PDF soubor je p\u0159\xedli\u0161 mal\xfd (mo\u017en\xe1 nen\xed kompletn\xed)");let f,u;e(10,"P\u0159ev\xe1d\xedm PDF na obr\xe1zek...");try{f=await Promise.race([a(n),new Promise((n,e)=>setTimeout(()=>e(new Error("Timeout p\u0159i konverzi PDF (30s)")),3e4))]),console.log("\u2705 PDF converted to canvas: ".concat(f.width,"x").concat(f.height,"px"))}catch(l){if(console.error("\u274c PDF conversion error:",l),t<2)return console.log("\ud83d\udd04 Retrying PDF conversion (attempt ".concat(t+2,"/").concat(3,")...")),e(5,"Opakuji pokus ".concat(t+2,"/").concat(3,"...")),await new Promise(n=>setTimeout(n,1e3)),i(n,e,t+1);throw new Error("Nepoda\u0159ilo se p\u0159ev\xe9st PDF na obr\xe1zek: ".concat(l.message))}e(30,"P\u0159ipravuji optimalizovan\xfd OCR engine...");try{u=await Promise.race([(0,o.createWorker)("ces",1,{logger:n=>{if("recognizing text"===n.status){const t=30+60*n.progress;e(t,"Rozpozn\xe1v\xe1m text: ".concat(Math.round(100*n.progress),"%"))}}}),new Promise((n,e)=>setTimeout(()=>e(new Error("Timeout p\u0159i inicializaci OCR (30s)")),3e4))]),await u.setParameters({tessedit_pageseg_mode:"3",preserve_interword_spaces:"1",tessedit_char_whitelist:"0123456789.,/:- ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\xc1\xe1\u010c\u010d\u010e\u010f\xc9\xe9\u011a\u011b\xcd\xed\u0147\u0148\xd3\xf3\u0158\u0159\u0160\u0161\u0164\u0165\xda\xfa\u016e\u016f\xdd\xfd\u017d\u017e"}),console.log("\ud83d\udcd0 Canvas size: ".concat(f.width,"x").concat(f.height,"px (scale: 2.0x)"))}catch(d){if(console.error("\u274c Worker creation error:",d),t<2)return console.log("\ud83d\udd04 Retrying OCR init (attempt ".concat(t+2,"/").concat(3,")...")),e(5,"Opakuji pokus ".concat(t+2,"/").concat(3,"...")),await new Promise(n=>setTimeout(n,1e3)),i(n,e,t+1);throw new Error("Nepoda\u0159ilo se spustit OCR engine. Zkuste obnovit str\xe1nku.")}let g="";try{var r,s;e(90,"Dokon\u010duji rozpozn\xe1v\xe1n\xed...");const n=await Promise.race([u.recognize(f),new Promise((n,e)=>setTimeout(()=>e(new Error("Timeout p\u0159i OCR (".concat(90,"s)"))),9e4))]);g=(null===n||void 0===n||null===(r=n.data)||void 0===r?void 0:r.text)||"";const t=(null===n||void 0===n||null===(s=n.data)||void 0===s?void 0:s.confidence)||0;if(console.log("\u2705 OCR completed: ".concat(g.length," characters, confidence: ").concat(t.toFixed(1),"%")),!g||0===g.trim().length)throw new Error("PDF neobsahuje rozpoznateln\xfd text. Dokument m\u016f\u017ee b\xfdt pr\xe1zdn\xfd nebo ve \u0161patn\xe9 kvalit\u011b.")}catch(c){if(console.error("\u274c Recognition error:",c),t<2&&!c.message.includes("Timeout"))return console.log("\ud83d\udd04 Retrying recognition (attempt ".concat(t+2,"/").concat(3,")...")),await u.terminate(),i(n,e,t+1);throw new Error("OCR selhalo: "+(c.message||"Nezn\xe1m\xe1 chyba"))}finally{try{await u.terminate()}catch(p){console.warn("\u26a0\ufe0f Worker termination error:",p)}}return e(100,"Hotovo!"),g}catch(f){throw console.error("\ud83d\udca5 OCR extraction error:",f,f.stack),f}}function r(n){const e={datumVystaveni:null,datumSplatnosti:null,variabilniSymbol:null,castka:null,isFaktura:!1,warning:null},t=n.toLowerCase(),o=(n.split("\n").map(n=>n.trim()).filter(n=>n.length>0),["faktura","invoice","da\u0148ov\xfd doklad","tax invoice"].some(n=>t.includes(n)));e.isFaktura=o,o||(t.includes("objedn\xe1vka")||t.includes("order")?e.warning="Dokument se zd\xe1 b\xfdt objedn\xe1vkou, ne fakturou. OCR extrakce nemus\xed b\xfdt relevantn\xed.":t.includes("dodac\xed list")||t.includes("delivery note")?e.warning="Dokument se zd\xe1 b\xfdt dodac\xedm listem, ne fakturou. OCR extrakce nemus\xed b\xfdt relevantn\xed.":t.includes("nab\xeddka")||t.includes("quotation")?e.warning="Dokument se zd\xe1 b\xfdt cenovou nab\xeddkou, ne fakturou. OCR extrakce nemus\xed b\xfdt relevantn\xed.":e.warning='Dokument neobsahuje slovo "FAKTURA". M\u016f\u017ee se jednat o jin\xfd typ dokumentu (objedn\xe1vku, dodac\xed list, nab\xeddku).');const a=[/(?:variabiln[i\xed]\s*symbol|var\.?\s*symbol|vs)[:\s]*(\d{4,})/i,/(?:\u010d\xedslo\s*faktury|faktura\s*\u010d\xedslo|faktura\s*\u010d\.?)[:\s]*(\d{4,})/i,/\b(\d{8,})\b/];for(const s of a){const t=n.match(s);if(t&&t[1]){e.variabilniSymbol=t[1].trim();break}}const i=[],r=/(\d{1,2}[\s./-]*\d{1,2}[\s./-]*\d{4})/g;let d;for(;null!==(d=r.exec(n));){const e=d[1],t=d.index,o=t+e.length,a=n.substring(Math.max(0,t-100),t),r=n.substring(o,Math.min(n.length,o+50)),l=(a+" "+r).toLowerCase().replace(/\s+/g," ").replace(/[^\w\s:.-]/g,""),c=e.replace(/\s+/g,""),p=s(c);p&&i.push({date:c,originalDate:e,parsed:p,contextBefore:a.toLowerCase(),contextAfter:r.toLowerCase(),fullContext:l,position:t})}console.log("\ud83d\udcc5 Found ".concat(i.length," dates in document:")),i.forEach((n,e)=>{console.log("  ".concat(e+1,". ").concat(n.date," (").concat(n.parsed,") - context: ...").concat(n.contextBefore.slice(-30),"[DATE]").concat(n.contextAfter.slice(0,30),"..."))});const c=[{word:"datum vystaveni",score:20,aliases:["datumvystaveni","dat vystaveni","dat.vystaveni"]},{word:"datum vystaven\xed",score:20,aliases:["datumvystaven\xed"]},{word:"vystaveni dokladu",score:18,aliases:["vystav\xe9n\xeddokladu","vystaveni dokl"]},{word:"datum dokladu",score:16,aliases:["datdokladu","dat.dokladu"]},{word:"vystaveno",score:14,aliases:["vystav\u011bno"]},{word:"date of issue",score:15,aliases:[]},{word:"datum vytvoreni",score:12,aliases:["datumvytvoreni"]},{word:"datum vytvo\u0159en\xed",score:12,aliases:["datumvytvo\u0159en\xed"]},{word:"issued",score:10,aliases:[]},{word:"daturn vystaveni",score:18,aliases:[]},{word:"oatum vystaveni",score:18,aliases:[]},{word:"vystavem",score:12,aliases:[]}];let p=null,f=0,u="";for(const s of i){let n=0,e=[];for(const i of c){const t=i.word,o=i.score,a=i.aliases||[];if(s.fullContext.includes(t)){n+=o,e.push(t);s.contextBefore.slice(-30).includes(t)&&(n+=Math.floor(.5*o))}for(const i of a)s.fullContext.includes(i)&&(n+=Math.floor(.8*o),e.push("".concat(i,"(alias)")))}const t=["splatnost","splatnosti","splatno","splatne","due date","payment due","zaplatit","uhradit","uhrazen","zaplaceno"];for(const i of t)s.fullContext.includes(i)&&(n-=30,e.push("-".concat(i,"(penalty)")));(s.fullContext.includes("zdanitelneho")||s.fullContext.includes("zdaniteln\xe9ho")||s.fullContext.includes("zdanitelne")||s.fullContext.includes("plneni"))&&(n-=20,e.push("-zdanitelneho/plneni(penalty)"));const o=s.contextBefore.includes(" dne ")||s.contextBefore.includes(" dne:"),a=e.some(n=>n.includes("datum")||n.includes("vystaveni")||n.includes("dokladu"));o&&!a&&(n-=10,e.push("-weak_dne(penalty)")),e.length>0&&console.log("  \ud83d\udcc5 Date ".concat(s.date,": Keywords: ").concat(e.join(", ")," \u2192 score: ").concat(n)),n>f&&(f=n,p=s.parsed,u="".concat(s.date," [").concat(e.join(", "),"]"))}e.datumVystaveni=p,console.log("\u2705 Best datum vystaven\xed: ".concat(p," (score: ").concat(f,") - ").concat(u));const g=[{word:"datum splatnosti",score:20,aliases:["datumsplatnosti","dat splatnosti","dat.splatnosti"]},{word:"termin splatnosti",score:18,aliases:["terminsplatnosti"]},{word:"splatnost:",score:16,aliases:["splatnost :"]},{word:"splatnost",score:14,aliases:[]},{word:"due date",score:17,aliases:["duedate"]},{word:"payment due",score:17,aliases:["paymentdue"]},{word:"splatne",score:13,aliases:["splatn\xe9"]},{word:"splatno",score:13,aliases:[]},{word:"splatna dne",score:15,aliases:["splatnadne"]},{word:"zaplatit do",score:12,aliases:["zaplatitdo"]},{word:"uhradit do",score:12,aliases:["uhraditdo"]},{word:"oatum splatnosti",score:18,aliases:[]},{word:"splamost",score:13,aliases:[]}];let h=null,x=0,m="";for(const s of i){let n=0,t=[];for(const e of g){const o=e.word,a=e.score,i=e.aliases||[];if(s.fullContext.includes(o)){n+=a,t.push(o);s.contextBefore.slice(-30).includes(o)&&(n+=Math.floor(.5*a))}for(const e of i)s.fullContext.includes(e)&&(n+=Math.floor(.8*a),t.push("".concat(e,"(alias)")))}const o=["vystaveni","vystaven\xed","vystaveno","datum dokladu","issued","date of issue","vytvoreni","vytvo\u0159en\xed","datum vytvoreni"];for(const e of o)s.fullContext.includes(e)&&(n-=30,t.push("-".concat(e,"(penalty)")));(s.fullContext.includes("zdanitelneho")||s.fullContext.includes("zdaniteln\xe9ho")||s.fullContext.includes("zdanitelne")||s.fullContext.includes("plneni"))&&(n-=20,t.push("-zdanitelneho/plneni(penalty)")),e.datumVystaveni&&s.parsed>e.datumVystaveni?(n+=10,t.push("+later_than_issue(+10)")):e.datumVystaveni&&s.parsed===e.datumVystaveni&&(n-=15,t.push("-same_as_issue(penalty)")),t.length>0&&console.log("  \ud83d\udcc5 Date ".concat(s.date,": Keywords: ").concat(t.join(", ")," \u2192 score: ").concat(n)),n>x&&(x=n,h=s.parsed,m="".concat(s.date," [").concat(t.join(", "),"]"))}e.datumSplatnosti=h,console.log("\u2705 Best datum splatnosti: ".concat(h," (score: ").concat(x,") - ").concat(m));const v=[/(?:celkem|v\u010detn\u011b\s*dph|s\s*dph|k\s*\xfahrad\u011b|k\s*zaplacen\xed)[:\s]*(\d+(?:[,\s]\d{3})*[,.]?\d{0,2})\s*(?:k\u010d|czk)?/i,/(?:cena\s*celkem|celkov\xe1\s*cena|total\s*price)[:\s]*(\d+(?:[,\s]\d{3})*[,.]?\d{0,2})\s*(?:k\u010d|czk)?/i,/(?:\u010d\xe1stka|cena|amount|price)[:\s]*(\d+(?:[,\s]\d{3})*[,.]?\d{0,2})\s*(?:k\u010d|czk)?/i,/(\d+(?:[,\s]\d{3})*[,.]?\d{2})\s*(?:k\u010d|czk)?\s*celkem/i,/(?:celkem|cena)[:\s]*(\d{1,3}(?:\s\d{3})*[,.]?\d{0,2})\s*(?:k\u010d|czk)?/i];for(const s of v){const t=n.match(s);if(t&&t[1]){e.castka=l(t[1]);break}}if(!e.castka){const t=n.match(/(\d+(?:[,\s]\d{3})*[,.]?\d{2})\s*(?:k\u010d|czk)/gi);if(t&&t.length>0){const n=t.map(n=>l(n));e.castka=Math.max(...n)}}return e}function s(n){const e=n.split(/[./-]/);if(3===e.length){const n=e[0].padStart(2,"0"),t=e[1].padStart(2,"0"),o=e[2];return"".concat(o,"-").concat(t,"-").concat(n)}return null}function l(n){if(!n)return null;let e=n.replace(/[^\d,.]/g,"");e=e.replace(/\s/g,"");const t=(e.match(/,/g)||[]).length,o=(e.match(/\./g)||[]).length;let a=e;if(1===t&&0===o)a=e.replace(",",".");else if(0===t&&1===o)a=e;else if(t>0&&o>0){a=e.lastIndexOf(",")>e.lastIndexOf(".")?e.replace(/\./g,"").replace(",","."):e.replace(/,/g,"")}else t>1?a=e.replace(/,/g,""):o>1&&(a=e.replace(/\./g,""));const i=parseFloat(a);return console.log('\ud83d\udcb0 parseAmount: "'.concat(n,'" \u2192 "').concat(e,'" \u2192 "').concat(a,'" \u2192 ').concat(i)),isNaN(i)?null:i}},70692:(n,e,t)=>{t.d(e,{r6:()=>Et,cy:()=>ko});var o,a,i,r,s,l,d,c,p,f,u=t(57528),g=t(65043),h=t(97950),x=t(45903),m=t(30264),v=t(70579);x.A.div(o||(o=(0,u.A)(["\n  position: relative;\n  width: 100%;\n"]))),x.A.div(a||(a=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 24px;\n  border: 2px dashed ",";\n  border-radius: 8px;\n  background: ",";\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &:hover {\n    border-color: ",";\n    background: ",";\n  }\n\n  ","\n"])),n=>n.error?"#fca5a5":n.isDragging?"#3b82f6":"#cbd5e1",n=>n.error?"#fef2f2":n.isDragging?"#eff6ff":"#f8fafc",n=>n.error?"#f87171":"#3b82f6",n=>n.error?"#fee2e2":"#eff6ff",n=>n.uploading&&"\n    opacity: 0.7;\n    pointer-events: none;\n  "),x.A.div(i||(i=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  background: ",";\n  color: ",";\n\n  svg {\n    width: 24px;\n    height: 24px;\n  }\n"])),n=>n.error?"#fee2e2":n.isDragging?"#dbeafe":"#e0e7ff",n=>n.error?"#dc2626":n.isDragging?"#3b82f6":"#4f46e5"),x.A.div(r||(r=(0,u.A)(["\n  text-align: center;\n"]))),x.A.div(s||(s=(0,u.A)(["\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: ",";\n  margin-bottom: 4px;\n"])),n=>n.error?"#dc2626":"#1f2937"),x.A.div(l||(l=(0,u.A)(["\n  font-size: 0.75rem;\n  color: #6b7280;\n"]))),x.A.input(d||(d=(0,u.A)(["\n  display: none;\n"]))),x.A.div(c||(c=(0,u.A)(["\n  width: 100%;\n  height: 4px;\n  background: #e5e7eb;\n  border-radius: 2px;\n  overflow: hidden;\n  margin-top: 12px;\n"]))),x.A.div(p||(p=(0,u.A)(["\n  height: 100%;\n  background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);\n  border-radius: 2px;\n  transition: width 0.3s ease;\n  width: ","%;\n"])),n=>n.progress),x.A.div(f||(f=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  margin-top: 12px;\n  background: ",";\n  border: 1px solid ",";\n  color: ",";\n\n  svg {\n    width: 18px;\n    height: 18px;\n    flex-shrink: 0;\n  }\n"])),n=>"error"===n.type?"#fef2f2":"#f0fdf4",n=>"error"===n.type?"#fecaca":"#bbf7d0",n=>"error"===n.type?"#dc2626":"#16a34a");var y,b,k;x.A.div(y||(y=(0,u.A)(["\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 4px 10px;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  background: ",";\n  color: ",";\n  border: 1px solid ",";\n  transition: all 0.2s ease;\n  cursor: ",";\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n\n  &:hover {\n    ","\n  }\n"])),n=>n.detected?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"#e5e7eb",n=>n.detected?"#ffffff":"#6b7280",n=>n.detected?"#059669":"#d1d5db",n=>n.onClick?"pointer":"default",n=>n.onClick&&"\n      transform: translateY(-1px);\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    "),x.A.div(b||(b=(0,u.A)(["\n  position: relative;\n  display: inline-block;\n"]))),x.A.div(k||(k=(0,u.A)(["\n  position: absolute;\n  bottom: calc(100% + 8px);\n  left: 50%;\n  transform: translateX(-50%);\n  background: #1f2937;\n  color: #ffffff;\n  padding: 8px 12px;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  white-space: nowrap;\n  z-index: 1000;\n  opacity: ",";\n  visibility: ",";\n  transition: opacity 0.2s ease, visibility 0.2s ease;\n  pointer-events: none;\n\n  &::after {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    border: 6px solid transparent;\n    border-top-color: #1f2937;\n  }\n"])),n=>n.show?1:0,n=>n.show?"visible":"hidden");var _,A,w,j,z,C,S,D,P,I;x.A.div(_||(_=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  background: ",";\n  border: 1px solid ",";\n  border-radius: 8px;\n  transition: all 0.2s ease;\n  gap: 12px;\n\n  &:hover {\n    ","\n  }\n\n  ","\n"])),n=>n.deleting?"#fef2f2":"#ffffff",n=>n.deleting?"#fecaca":"#e5e7eb",n=>!n.deleting&&"\n      border-color: #cbd5e1;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n    ",n=>n.deleting&&"\n    opacity: 0.6;\n    pointer-events: none;\n  "),x.A.div(A||(A=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  flex: 1;\n  min-width: 0;\n"]))),x.A.div(w||(w=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  border-radius: 8px;\n  color: #ffffff;\n  flex-shrink: 0;\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n"]))),x.A.div(j||(j=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  min-width: 0;\n  flex: 1;\n"]))),x.A.div(z||(z=(0,u.A)(["\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #1f2937;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n"]))),x.A.div(C||(C=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 0.75rem;\n  color: #6b7280;\n  flex-wrap: wrap;\n"]))),x.A.span(S||(S=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 4px;\n\n  &::before {\n    content: '\u2022';\n    margin-right: 4px;\n\n    &:first-of-type {\n      display: none;\n    }\n  }\n\n  &:first-of-type::before {\n    display: none;\n  }\n"]))),x.A.div(D||(D=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  flex-shrink: 0;\n"]))),x.A.button(P||(P=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 36px;\n  height: 36px;\n  border: none;\n  border-radius: 6px;\n  background: ",";\n  color: ",";\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n\n  &:hover {\n    background: ",";\n    transform: translateY(-1px);\n  }\n\n  &:active {\n    transform: translateY(0);\n  }\n\n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    transform: none;\n  }\n"])),n=>"danger"===n.variant?"#fef2f2":"#f3f4f6",n=>"danger"===n.variant?"#dc2626":"#6b7280",n=>"danger"===n.variant?"#fee2e2":"#e5e7eb"),x.A.div(I||(I=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 12px;\n  background: #fef2f2;\n  border: 1px solid #fecaca;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  color: #dc2626;\n  margin-top: 8px;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    flex-shrink: 0;\n  }\n"])));var F,E,T,O,L,N,R,M,B,V,W,U,K,q,H,Y,Z,X,G,J,Q,$,nn,en,tn,on,an,rn,sn,ln,dn,cn,pn,fn,un,gn,hn,xn=t(41680),mn=t(40614),vn=t(57856),yn=t(28646),bn=t(56790),kn=t(95264),_n=t(81990),An=t(77819),wn=t(82054);const jn=n=>{if(!n)return"---";try{const e=new Date(n);if(isNaN(e))return n;const t=String(e.getDate()).padStart(2,"0"),o=String(e.getMonth()+1).padStart(2,"0"),a=e.getFullYear();return"".concat(t,".").concat(o,".").concat(a)}catch(e){return n}},zn=x.A.div(F||(F=(0,u.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n  animation: fadeIn 0.2s ease;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n"]))),Cn=x.A.div(E||(E=(0,u.A)(["\n  background: #ffffff;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  max-width: 1100px;\n  width: 95%;\n  max-height: 85vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp 0.3s ease;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n"]))),Sn=x.A.div(T||(T=(0,u.A)(["\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  color: #ffffff;\n  padding: 24px;\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  position: relative;\n"]))),Dn=x.A.button(O||(O=(0,u.A)(["\n  position: absolute;\n  top: 16px;\n  right: 16px;\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  border-radius: 6px;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: background 0.2s;\n  color: #ffffff;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n"]))),Pn=x.A.div(L||(L=(0,u.A)(["\n  width: 48px;\n  height: 48px;\n  border-radius: 10px;\n  background: rgba(255, 255, 255, 0.2);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  svg {\n    width: 28px;\n    height: 28px;\n  }\n"]))),In=x.A.div(N||(N=(0,u.A)(["\n  flex: 1;\n"]))),Fn=x.A.h2(R||(R=(0,u.A)(["\n  margin: 0;\n  font-size: 1.375rem;\n  font-weight: 700;\n"]))),En=x.A.p(M||(M=(0,u.A)(["\n  margin: 4px 0 0 0;\n  font-size: 0.875rem;\n  opacity: 0.95;\n"]))),Tn=x.A.div(B||(B=(0,u.A)(["\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n"]))),On=x.A.div(V||(V=(0,u.A)(["\n  background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);\n  border: 1px solid #93c5fd;\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 24px;\n  display: flex;\n  gap: 12px;\n\n  svg {\n    width: 20px;\n    height: 20px;\n    color: #2563eb;\n    flex-shrink: 0;\n    margin-top: 2px;\n  }\n"]))),Ln=x.A.p(W||(W=(0,u.A)(["\n  margin: 0;\n  font-size: 0.875rem;\n  color: #1e40af;\n  line-height: 1.5;\n"]))),Nn=(x.A.div(U||(U=(0,u.A)(["\n  margin-bottom: 24px;\n"]))),x.A.h3(K||(K=(0,u.A)(["\n  font-size: 0.9375rem;\n  font-weight: 600;\n  color: #374151;\n  margin: 0 0 12px 0;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  svg {\n    width: 18px;\n    height: 18px;\n    color: #6b7280;\n  }\n"]))),x.A.div(q||(q=(0,u.A)(["\n  display: grid;\n  grid-template-columns: 400px 1fr;\n  gap: 20px;\n  margin-bottom: 16px;\n\n  @media (max-width: 900px) {\n    grid-template-columns: 1fr;\n  }\n"])))),Rn=x.A.div(H||(H=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n"]))),Mn=x.A.div(Y||(Y=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n"]))),Bn=x.A.div(Z||(Z=(0,u.A)(["\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 12px;\n"]))),Vn=x.A.div(X||(X=(0,u.A)(["\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 12px;\n"]))),Wn=x.A.div(G||(G=(0,u.A)(["\n  font-size: 0.75rem;\n  color: #6b7280;\n  font-weight: 500;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n  margin-bottom: 6px;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    flex-shrink: 0;\n    opacity: 0.7;\n  }\n"]))),Un=x.A.div(J||(J=(0,u.A)(["\n  font-size: 0.9375rem;\n  color: #111827;\n  font-weight: 600;\n\n  &.highlight {\n    color: #10b981;\n    font-size: 1.125rem;\n  }\n"]))),Kn=((0,x.A)(Vn)(Q||(Q=(0,u.A)(["\n  grid-column: 1 / -1;\n"]))),x.A.div($||($=(0,u.A)(["\n  background: #f9fafb;\n  border-top: 1px solid #e5e7eb;\n  padding: 16px 24px;\n  display: flex;\n  gap: 12px;\n  justify-content: flex-end;\n"])))),qn=x.A.button(nn||(nn=(0,u.A)(["\n  padding: 10px 20px;\n  border-radius: 6px;\n  font-size: 0.9375rem;\n  font-weight: 600;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  &.primary {\n    background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n    color: #ffffff;\n\n    &:hover {\n      background: linear-gradient(135deg, #059669 0%, #047857 100%);\n      transform: translateY(-1px);\n      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);\n    }\n  }\n\n  &.secondary {\n    background: #ffffff;\n    color: #374151;\n    border: 1px solid #d1d5db;\n\n    &:hover {\n      background: #f9fafb;\n      border-color: #9ca3af;\n    }\n  }\n\n  &:active {\n    transform: translateY(0);\n  }\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n"]))),Hn=x.A.div(en||(en=(0,u.A)(["\n  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n  border: 1px solid #fbbf24;\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 24px;\n  display: flex;\n  gap: 12px;\n\n  svg {\n    width: 20px;\n    height: 20px;\n    color: #f59e0b;\n    flex-shrink: 0;\n    margin-top: 2px;\n  }\n"]))),Yn=x.A.p(tn||(tn=(0,u.A)(["\n  margin: 0;\n  font-size: 0.875rem;\n  color: #92400e;\n  line-height: 1.5;\n"]))),Zn=x.A.div(on||(on=(0,u.A)(["\n  background: #e0f2fe;\n  border: 1px solid #0ea5e9;\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 16px;\n  display: flex;\n  align-items: flex-start;\n  gap: 12px;\n"]))),Xn=x.A.label(an||(an=(0,u.A)(['\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  cursor: pointer;\n  font-size: 0.9375rem;\n  color: #0c4a6e;\n  font-weight: 500;\n  user-select: none;\n  flex: 1;\n\n  input[type="checkbox"] {\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n    accent-color: #0ea5e9;\n  }\n\n  &:hover {\n    color: #075985;\n  }\n']))),Gn=x.A.div(rn||(rn=(0,u.A)(["\n  font-size: 0.8125rem;\n  color: #0c4a6e;\n  margin-top: 8px;\n  margin-left: 30px;\n  line-height: 1.4;\n  font-style: italic;\n  font-weight: 500;\n"]))),Jn=x.A.div(sn||(sn=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 12px;\n"]))),Qn=x.A.h3(ln||(ln=(0,u.A)(["\n  font-size: 0.8125rem;\n  font-weight: 600;\n  color: #374151;\n  margin: 0 0 8px 0;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    color: #10b981;\n  }\n"]))),$n=x.A.div(dn||(dn=(0,u.A)(["\n  max-height: 300px;\n  overflow-y: auto;\n  margin-top: 8px;\n\n  &::-webkit-scrollbar {\n    width: 6px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #e5e7eb;\n    border-radius: 3px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #10b981;\n    border-radius: 3px;\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background: #059669;\n  }\n"]))),ne=x.A.div(cn||(cn=(0,u.A)(["\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 10px;\n  margin-bottom: 6px;\n\n  &:last-child {\n    margin-bottom: 0;\n  }\n\n  &:hover {\n    border-color: #10b981;\n    box-shadow: 0 1px 3px rgba(16, 185, 129, 0.15);\n    transform: translateX(2px);\n    transition: all 0.2s ease;\n  }\n"]))),ee=x.A.div(pn||(pn=(0,u.A)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 8px;\n"]))),te=x.A.div(fn||(fn=(0,u.A)(["\n  font-size: 0.9375rem;\n  font-weight: 600;\n  color: #111827;\n  flex: 1;\n"]))),oe=x.A.div(un||(un=(0,u.A)(["\n  font-size: 0.9375rem;\n  font-weight: 700;\n  color: #10b981;\n  white-space: nowrap;\n  margin-left: 16px;\n"]))),ae=x.A.div(gn||(gn=(0,u.A)(["\n  display: flex;\n  gap: 16px;\n  flex-wrap: wrap;\n  font-size: 0.8125rem;\n  color: #6b7280;\n"]))),ie=x.A.span(hn||(hn=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 4px;\n\n  strong {\n    color: #374151;\n  }\n"]))),re=n=>{let{isdocSummary:e,isdocData:t,onConfirm:o,onCancel:a,onUploadWithoutParsing:i}=n;const[r,s]=g.useState(!0),l=(null===t||void 0===t?void 0:t.polozky)||(null===e||void 0===e?void 0:e.polozky)||[];return(0,v.jsx)(zn,{onClick:n=>n.stopPropagation(),children:(0,v.jsxs)(Cn,{onClick:n=>n.stopPropagation(),children:[(0,v.jsxs)(Sn,{children:[(0,v.jsx)(Pn,{children:(0,v.jsx)(xn.A,{})}),(0,v.jsxs)(In,{children:[(0,v.jsx)(Fn,{children:"Detekov\xe1n ISDOC form\xe1t!"}),(0,v.jsx)(En,{children:"Elektronick\xe1 faktura byla \xfasp\u011b\u0161n\u011b na\u010dtena"})]}),(0,v.jsx)(Dn,{onClick:a,"aria-label":"Zav\u0159\xedt",children:(0,v.jsx)(mn.A,{})})]}),(0,v.jsxs)(Tn,{children:[(0,v.jsxs)(On,{children:[(0,v.jsx)(vn.A,{}),(0,v.jsx)(Ln,{children:"ISDOC je standardn\xed form\xe1t pro elektronickou v\xfdm\u011bnu faktur. Syst\xe9m m\u016f\u017ee automaticky vyplnit \xfadaje faktury z tohoto souboru."})]}),(0,v.jsxs)(Nn,{children:[(0,v.jsxs)(Rn,{children:[(0,v.jsxs)(Bn,{children:[(0,v.jsxs)(Vn,{children:[(0,v.jsxs)(Wn,{children:[(0,v.jsx)(yn.A,{}),"Datum vystaven\xed"]}),(0,v.jsx)(Un,{children:jn(e.datum_vystaveni)})]}),(0,v.jsxs)(Vn,{children:[(0,v.jsxs)(Wn,{children:[(0,v.jsx)(bn.A,{}),"Celkov\xe1 \u010d\xe1stka"]}),(0,v.jsx)(Un,{className:"highlight",children:(0,v.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[(0,v.jsx)("span",{children:e.castka_s_dph}),e.ma_slevu&&e.sleva_celkem>0&&(0,v.jsxs)("span",{style:{fontSize:"0.75rem",color:"#059669",fontWeight:500,display:"inline-flex",alignItems:"center",gap:"4px"},children:["\ud83c\udf89 Sleva: -",e.sleva_celkem.toLocaleString("cs-CZ",{minimumFractionDigits:2})," K\u010d",e.sleva_procenta>0&&(0,v.jsxs)("span",{style:{fontSize:"0.7rem",opacity:.8},children:["(",e.sleva_procenta.toFixed(1),"%)"]})]})]})})]})]}),(0,v.jsxs)(Bn,{children:[(0,v.jsxs)(Vn,{children:[(0,v.jsxs)(Wn,{children:[(0,v.jsx)(xn.A,{}),"\u010c\xedslo faktury"]}),(0,v.jsx)(Un,{children:e.cislo_faktury})]}),(0,v.jsxs)(Vn,{children:[(0,v.jsxs)(Wn,{children:[(0,v.jsx)(xn.A,{}),"Variabiln\xed symbol"]}),(0,v.jsx)(Un,{children:e.variabilni_symbol})]})]})]}),(0,v.jsxs)(Mn,{children:[(0,v.jsxs)(Bn,{children:[(0,v.jsxs)(Vn,{children:[(0,v.jsxs)(Wn,{children:[(0,v.jsx)(kn.A,{}),"Dodavatel"]}),(0,v.jsx)(Un,{children:e.dodavatel})]}),(0,v.jsxs)(Vn,{children:[(0,v.jsxs)(Wn,{children:[(0,v.jsx)(_n.A,{}),"Po\u010det polo\u017eek"]}),(0,v.jsx)(Un,{children:e.pocet_polozek})]})]}),l&&l.length>0&&(0,v.jsxs)(Jn,{children:[(0,v.jsxs)(Qn,{children:[(0,v.jsx)(_n.A,{}),"Polo\u017eky faktury"]}),(0,v.jsx)($n,{children:l.map((n,e)=>{var t,o,a;return(0,v.jsxs)(ne,{children:[(0,v.jsxs)(ee,{children:[(0,v.jsxs)(te,{children:[e+1,". ",n.popis||"Polo\u017eka bez popisu"]}),(0,v.jsxs)(oe,{children:[null===(t=n.cena_celkem_s_dph)||void 0===t?void 0:t.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"]})]}),(0,v.jsxs)(ae,{children:[(0,v.jsxs)(ie,{children:[(0,v.jsx)("strong",{children:"Mno\u017estv\xed:"})," ",n.mnozstvi," ",n.jednotka]}),(0,v.jsxs)(ie,{children:[(0,v.jsx)("strong",{children:"Cena/jedn.:"})," ",null===(o=n.cena_za_jednotku)||void 0===o?void 0:o.toLocaleString("cs-CZ",{minimumFractionDigits:2})," K\u010d"]}),(0,v.jsxs)(ie,{children:[(0,v.jsx)("strong",{children:"Bez DPH:"})," ",null===(a=n.cena_celkem_bez_dph)||void 0===a?void 0:a.toLocaleString("cs-CZ",{minimumFractionDigits:2})," K\u010d"]}),(0,v.jsxs)(ie,{children:[(0,v.jsx)("strong",{children:"DPH:"})," ",n.sazba_dph,"%"]})]})]},e)})})]})]})]}),(0,v.jsx)(Zn,{children:(0,v.jsxs)("div",{style:{flex:1},children:[(0,v.jsxs)(Xn,{children:[(0,v.jsx)("input",{type:"checkbox",checked:r,onChange:n=>s(n.target.checked)}),(0,v.jsxs)("span",{children:["Do pole ",(0,v.jsx)("strong",{children:"\u010c\xedslo FA/VPD"})," pou\u017e\xedt ",(0,v.jsx)("strong",{children:"variabiln\xed symbol"})," m\xedsto \u010d\xedsla faktury"]})]}),(0,v.jsx)(Gn,{children:r?"\u2713 Bude pou\u017eit variabiln\xed symbol: ".concat(e.variabilni_symbol):"\u2713 Bude pou\u017eito \u010d\xedslo faktury: ".concat(e.cislo_faktury)})]})}),(0,v.jsxs)(Hn,{children:[(0,v.jsx)(An.A,{}),(0,v.jsxs)(Yn,{children:[(0,v.jsx)("strong",{children:"Datum doru\u010den\xed"})," bude automaticky nastaven na dne\u0161n\xed datum. Po vypln\u011bn\xed \xfadaj\u016f zkontrolujte v\u0161echna pole p\u0159ed ulo\u017een\xedm!"]})]})]}),(0,v.jsxs)(Kn,{children:[(0,v.jsx)(qn,{className:"secondary",onClick:i,children:"Nahr\xe1t bez extrakce"}),(0,v.jsx)(qn,{className:"secondary",onClick:a,children:"Zru\u0161it"}),(0,v.jsxs)(qn,{className:"primary",onClick:()=>o(r),children:[(0,v.jsx)(wn.A,{}),"Vyplnit \xfadaje faktury"]})]})]})})};var se,le,de,ce,pe,fe,ue,ge,he,xe,me,ve,ye,be,ke=t(27837),_e=t(88720);x.A.div(se||(se=(0,u.A)(["\n  margin-top: 16px;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  background: #ffffff;\n  overflow: hidden;\n"]))),x.A.div(le||(le=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n  border-bottom: 1px solid #e5e7eb;\n  cursor: pointer;\n  user-select: none;\n  transition: background 0.2s ease;\n\n  &:hover {\n    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);\n  }\n"]))),x.A.div(de||(de=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 10px;\n"]))),x.A.div(ce||(ce=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  color: #ffffff;\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n"]))),x.A.div(pe||(pe=(0,u.A)(["\n  font-size: 0.9375rem;\n  font-weight: 600;\n  color: #1f2937;\n"]))),x.A.span(fe||(fe=(0,u.A)(["\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 20px;\n  height: 20px;\n  padding: 0 6px;\n  border-radius: 10px;\n  background: #3b82f6;\n  color: #ffffff;\n  font-size: 0.75rem;\n  font-weight: 600;\n  margin-left: 8px;\n"]))),x.A.div(ue||(ue=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  color: #6b7280;\n  transition: transform 0.2s ease;\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n"]))),x.A.div(ge||(ge=(0,u.A)(["\n  padding: 16px;\n  display: ",";\n"])),n=>n.collapsed?"none":"block"),x.A.div(he||(he=(0,u.A)(["\n  margin-bottom: ",";\n"])),n=>n.hasAttachments?"20px":"0"),x.A.div(xe||(xe=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n"]))),x.A.div(me||(me=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 32px 16px;\n  text-align: center;\n  color: #6b7280;\n  gap: 8px;\n\n  svg {\n    width: 48px;\n    height: 48px;\n    opacity: 0.3;\n  }\n"]))),x.A.div(ve||(ve=(0,u.A)(["\n  font-size: 0.875rem;\n  font-weight: 500;\n"]))),x.A.div(ye||(ye=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 32px 16px;\n  gap: 12px;\n  color: #6b7280;\n  font-size: 0.875rem;\n\n  svg {\n    width: 20px;\n    height: 20px;\n    animation: spin 1s linear infinite;\n  }\n\n  @keyframes spin {\n    from { transform: rotate(0deg); }\n    to { transform: rotate(360deg); }\n  }\n"]))),x.A.div(be||(be=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  background: #fef2f2;\n  border: 1px solid #fecaca;\n  border-radius: 6px;\n  color: #dc2626;\n  font-size: 0.875rem;\n\n  svg {\n    width: 18px;\n    height: 18px;\n    flex-shrink: 0;\n  }\n"])));var Ae,we,je,ze,Ce,Se,De,Pe,Ie,Fe,Ee,Te,Oe,Le,Ne,Re,Me,Be,Ve,We,Ue,Ke,qe,He,Ye,Ze,Xe,Ge,Je,Qe,$e,nt,et=t(89379),tt=t(76833),ot=(t(56099),t(37719),t(72494)),at=t(42043),it=t(37587),rt=t(70764),st=t(9855),lt=t(7104),dt=t(29071),ct=t(51833);t(29521);const pt=x.A.div(Ae||(Ae=(0,u.A)(["\n  margin-top: 16px;\n  padding-top: 16px;\n  border-top: 1px solid #e5e7eb;\n"]))),ft=x.A.div(we||(we=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 12px;\n"]))),ut=x.A.div(je||(je=(0,u.A)(["\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #374151;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  svg {\n    width: 16px;\n    height: 16px;\n    color: #3b82f6;\n  }\n"]))),gt=x.A.span(ze||(ze=(0,u.A)(["\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 18px;\n  height: 18px;\n  padding: 0 6px;\n  border-radius: 9px;\n  background: #3b82f6;\n  color: #ffffff;\n  font-size: 0.6875rem;\n  font-weight: 600;\n  margin-left: 6px;\n"]))),ht=x.A.div(Ce||(Ce=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 16px;\n  margin-bottom: 12px;\n  border: 2px dashed ",";\n  border-radius: 8px;\n  background: ",";\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &:hover {\n    border-color: #3b82f6;\n    background: #f0f9ff;\n  }\n\n  ","\n"])),n=>n.isDragging?"#3b82f6":"#d1d5db",n=>n.isDragging?"#eff6ff":"#ffffff",n=>n.disabled&&"\n    opacity: 0.5;\n    cursor: not-allowed;\n    &:hover {\n      border-color: #d1d5db;\n      background: #ffffff;\n    }\n  "),xt=x.A.div(Se||(Se=(0,u.A)(["\n  font-size: 1.5rem;\n  color: ",";\n"])),n=>n.isDragging?"#3b82f6":"#9ca3af"),mt=x.A.div(De||(De=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n"]))),vt=x.A.div(Pe||(Pe=(0,u.A)(["\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: #374151;\n"]))),yt=x.A.div(Ie||(Ie=(0,u.A)(["\n  font-size: 0.75rem;\n  color: #9ca3af;\n"]))),bt=x.A.input(Fe||(Fe=(0,u.A)(["\n  display: none;\n"]))),kt=x.A.div(Ee||(Ee=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n"]))),_t=(x.A.div(Te||(Te=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 10px 12px;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  gap: 12px;\n  transition: all 0.2s ease;\n\n  &:hover {\n    border-color: #cbd5e1;\n    background: #f3f4f6;\n  }\n"]))),x.A.div(Oe||(Oe=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  flex: 1;\n  min-width: 0;\n"]))),x.A.div(Le||(Le=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  border-radius: 6px;\n  color: #ffffff;\n  flex-shrink: 0;\n\n  svg {\n    width: 16px;\n    height: 16px;\n  }\n"]))),x.A.div(Ne||(Ne=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n  min-width: 0;\n  flex: 1;\n"]))),x.A.div(Re||(Re=(0,u.A)(["\n  font-size: 0.8125rem;\n  font-weight: 500;\n  color: #1f2937;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n"]))),x.A.div(Me||(Me=(0,u.A)(["\n  font-size: 0.6875rem;\n  color: #6b7280;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n"]))),x.A.span(Be||(Be=(0,u.A)(["\n  display: inline-flex;\n  align-items: center;\n  padding: 2px 6px;\n  border-radius: 4px;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  color: #ffffff;\n  font-size: 0.625rem;\n  font-weight: 600;\n"]))),x.A.div(Ve||(Ve=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  flex-shrink: 0;\n"]))),x.A.button(We||(We=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 28px;\n  height: 28px;\n  border: none;\n  border-radius: 4px;\n  background: ",";\n  color: ",";\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n\n  &:hover {\n    background: ",";\n    transform: translateY(-1px);\n  }\n\n  &:active {\n    transform: translateY(0);\n  }\n\n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    transform: none;\n  }\n"])),n=>"danger"===n.variant?"#fef2f2":"#ffffff",n=>"danger"===n.variant?"#dc2626":"#6b7280",n=>"danger"===n.variant?"#fee2e2":"#f3f4f6"),x.A.div(Ue||(Ue=(0,u.A)(["\n  padding: 16px;\n  text-align: center;\n  color: #9ca3af;\n  font-size: 0.8125rem;\n  background: #f9fafb;\n  border: 1px dashed #d1d5db;\n  border-radius: 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  \n  svg {\n    width: 16px;\n    height: 16px;\n  }\n"])))),At=x.A.div(Ke||(Ke=(0,u.A)(["\n  position: fixed;\n  left: ","px;\n  top: ","px;\n  width: ","px;\n  height: ","px;\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(0, 0, 0, 0.1);\n  z-index: 999998;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n"])),n=>n.x,n=>n.y,n=>n.w,n=>n.h),wt=x.A.div(qe||(qe=(0,u.A)(["\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n"]))),jt=x.A.div(He||(He=(0,u.A)(["\n  padding: 12px 16px;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  color: white;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n"]))),zt=x.A.div(Ye||(Ye=(0,u.A)(["\n  font-size: 1rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n"]))),Ct=x.A.button(Ze||(Ze=(0,u.A)(["\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n"]))),St=x.A.object(Xe||(Xe=(0,u.A)(["\n  flex: 1;\n  border: none;\n  width: 100%;\n  height: 100%;\n"]))),Dt=x.A.div(Ge||(Ge=(0,u.A)(["\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 1rem;\n  padding: 2rem;\n  background: #f8fafc;\n  color: #334155;\n"]))),Pt=x.A.a(Je||(Je=(0,u.A)(["\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  background: #10b981;\n  color: white;\n  border-radius: 8px;\n  text-decoration: none;\n  font-weight: 600;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n\n  &:hover {\n    background: #059669;\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px rgba(16, 185, 129, 0.3);\n  }\n"]))),It=x.A.div(Qe||(Qe=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 16px;\n  gap: 8px;\n  color: #6b7280;\n  font-size: 0.8125rem;\n\n  svg {\n    width: 16px;\n    height: 16px;\n    animation: spin 1s linear infinite;\n  }\n\n  @keyframes spin {\n    from { transform: rotate(0deg); }\n    to { transform: rotate(360deg); }\n  }\n"]))),Ft=x.A.div($e||($e=(0,u.A)(["\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 10px;\n  background: #fef2f2;\n  border: 1px solid #fecaca;\n  border-radius: 6px;\n  color: #dc2626;\n  font-size: 0.75rem;\n  margin-top: 8px;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    flex-shrink: 0;\n  }\n"]))),Et=(x.A.div(nt||(nt=(0,u.A)(["\n  font-size: 0.75rem;\n  color: #6b7280;\n  padding: 12px;\n  background: #f9fafb;\n  border-radius: 6px;\n  border: 1px solid #e5e7eb;\n"]))),n=>{var e;let{fakturaId:t,objednavkaId:o,fakturaTypyPrilohOptions:a=[],readOnly:i=!1,onISDOCParsed:r,formData:s,faktura:l,validateInvoiceForAttachments:d,isPokladna:c=!1,onAttachmentUploaded:p,onAttachmentRemoved:f,attachments:u=[],onAttachmentsChange:x,onCreateInvoiceInDB:y,onOCRDataExtracted:b,allUsers:k=[]}=n;const{username:_,token:A}=(0,g.useContext)(ke.cy),{showToast:w}=(0,g.useContext)(_e.$o),[j,z]=(0,g.useState)(!1),[C,S]=(0,g.useState)(!1),[D,P]=(0,g.useState)(null),[I,F]=(0,g.useState)(!1),E=g.useRef(null),[T,O]=(0,g.useState)(!1),[L,N]=(0,g.useState)(null),[R,M]=(0,g.useState)(null),[B,V]=(0,g.useState)({visible:!1,url:"",filename:"",type:""}),[W,U]=(0,g.useState)(()=>{const n=window.innerWidth,e=window.innerHeight,t=Math.max(400,Math.min(Math.floor(.5*n),900)),o=Math.floor(.85*e);return{x:Math.max(20,n-t-20),y:Math.max(20,Math.floor((e-o)/2)),w:t,h:o}}),[K,q]=(0,g.useState)(!1),[H,Y]=(0,g.useState)({x:0,y:0}),[Z,X]=(0,g.useState)({isOpen:!1,title:"",message:"",onConfirm:null}),G=g.useRef(!1),J=(0,g.useMemo)(()=>{if(!Array.isArray(u))return[];return u.map(n=>{if(void 0!==n.size)return n;return(0,et.A)((0,et.A)({},n),{},{size:n.file_size||n.velikost_souboru_b||0})})},[u,t]),Q=(0,g.useCallback)(n=>{if(x)if("function"===typeof n){const e=n(u||[]);x(e)}else x(n)},[x,u]),$=(0,g.useCallback)(n=>{if(!n)return _||"Nezn\xe1m\xfd u\u017eivatel";const e=k.find(e=>e.id===n||e.user_id===n);if(!e)return"U\u017eivatel #".concat(n);const t=[];return e.titul_pred&&t.push(e.titul_pred),e.jmeno&&t.push(e.jmeno),e.prijmeni&&t.push(e.prijmeni),e.titul_za&&t.push(e.titul_za),t.length>0?t.join(" "):e.username||"U\u017eivatel #".concat(n)},[k,_]),nn=(0,g.useCallback)(n=>{K&&(n.preventDefault(),U(e=>{const t=n.clientX-H.x,o=n.clientY-H.y,a=window.innerWidth,i=window.innerHeight,r=Math.max(0,Math.min(t,a-e.w)),s=Math.max(0,Math.min(o,i-e.h));return(0,et.A)((0,et.A)({},e),{},{x:r,y:s})}))},[K,H]),en=(0,g.useCallback)(()=>{q(!1)},[]);(0,g.useEffect)(()=>{if(K){const n=n=>nn(n),e=()=>en();return document.addEventListener("mousemove",n),document.addEventListener("mouseup",e),()=>{document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",e)}}},[K,nn,en]),(0,g.useEffect)(()=>{G.current=!1},[t]),(0,g.useEffect)(()=>{if(t&&!String(t).startsWith("temp-")){if(void 0!==u&&null!==u)return;if(G.current)return;G.current=!0,on()}},[t,u]);const tn=g.useRef(t);(0,g.useEffect)(()=>{(async()=>{const n=tn.current,e=t,a=String(n).startsWith("temp-"),i=e&&!String(e).startsWith("temp-");if(!a||!i)return void(tn.current=e);const r=J.filter(n=>("pending"===n.status||"pending_upload"===n.status)&&n.file);if(0!==r.length){for(const n of r)try{var s,l,d,c;Q(e=>e.map(e=>e.id===n.id?(0,et.A)((0,et.A)({},e),{},{status:"uploading"}):e));const t=await(0,m.dN)({token:A,username:_,faktura_id:e,objednavka_id:o,typ_prilohy:n.klasifikace||"FAKTURA",file:n.file}),a=(null===(s=t.priloha)||void 0===s?void 0:s.id)||t.priloha_id||(null===(l=t.data)||void 0===l||null===(d=l.priloha)||void 0===d?void 0:d.id)||(null===(c=t.data)||void 0===c?void 0:c.id)||t.id;Q(e=>e.map(e=>e.id===n.id?(0,et.A)((0,et.A)({},e),{},{status:"uploaded",serverId:a,file:void 0}):e)),w&&w('\u2705 P\u0159\xedloha "'.concat(n.name,'" byla \xfasp\u011b\u0161n\u011b nahr\xe1na'),{type:"success"})}catch(f){Q(e=>e.map(e=>e.id===n.id?(0,et.A)((0,et.A)({},e),{},{status:"error",error:f.message}):e)),w&&w('Nepoda\u0159ilo se nahr\xe1t p\u0159\xedlohu "'.concat(n.name,'"'),{type:"error"})}p&&p(),tn.current=e}else tn.current=e})()},[t,J]);const on=async()=>{if(t&&!String(t).startsWith("temp-")){z(!0),P(null);try{var n;const i=await(0,m.xh)({token:A,username:_,faktura_id:t,objednavka_id:o}),r=((null===(n=i.data)||void 0===n?void 0:n.attachments)||i.prilohy||[]).map(n=>{const e=!1!==n.file_exists,t=n.error||n.file_error,o=a.find(e=>e.kod===(n.type||n.typ_prilohy));return{id:n.id,serverId:n.id,name:n.original_name||n.originalni_nazev_souboru,size:n.file_size||n.velikost_souboru_b,type:(n.original_name||n.originalni_nazev_souboru||"").endsWith(".pdf")?"application/pdf":"application/octet-stream",klasifikace:n.type||n.typ_prilohy||"FILE",faktura_typ_nazev:(null===o||void 0===o?void 0:o.nazev)||n.faktura_typ_nazev,uploadDate:n.upload_date||n.dt_vytvoreni||(new Date).toISOString(),uploadedByUserId:n.uploaded_by_user_id||n.nahrano_uzivatel_id,status:e?"uploaded":"error",je_isdoc:n.je_isdoc,error:t||(e?null:"Fyzick\xfd soubor chyb\xed na disku")}});if(J.some(n=>"pending_upload"===n.status||"uploading"===n.status)&&0===r.length)return void console.log("\u26a0\ufe0f P\u0159eskakuji pr\xe1zdnou odpov\u011b\u010f ze serveru - m\xe1me pending uploads");const s=(n,e)=>n.length===e.length&&n.every((n,t)=>{var o,a;return n.id===(null===(o=e[t])||void 0===o?void 0:o.id)&&n.status===(null===(a=e[t])||void 0===a?void 0:a.status)});let l=r;const d=t?Number(t):null;if(d&&!isNaN(d)&&!String(t).startsWith("temp-"))try{const n=await(0,m.Q_)({token:A,username:_,invoice_id:d,objednavka_id:o});if(n&&n.attachments){l=r.map(e=>{const t=n.attachments.find(n=>n.attachment_id===e.serverId);return t&&!t.file_exists?(0,et.A)((0,et.A)({},e),{},{status:"error",error:"Fyzick\xfd soubor chyb\xed na serveru (".concat(t.status,")")}):e});const e=n.summary||{};e.missing_files>0&&w&&w("\u26a0\ufe0f ".concat(e.missing_files," p\u0159\xedloha(y) faktury nemaj\xed fyzick\xfd soubor na serveru"),{type:"warning"})}}catch(e){console.error("\u274c Chyba p\u0159i verify attachments:",e)}s(l,u||[])||Q(l)}catch(i){console.error("\u274c Chyba p\u0159i na\u010d\xedt\xe1n\xed p\u0159\xedloh faktury:",i),P(i.message||"Chyba p\u0159i na\u010d\xedt\xe1n\xed p\u0159\xedloh")}finally{z(!1)}}},an=n=>{if(!(0,m.yU)(n.name))throw new Error("Nepodporovan\xfd form\xe1t souboru");if(!(0,m.vF)(n.size))throw new Error("Soubor je p\u0159\xedli\u0161 velk\xfd (max 10 MB)")},rn=async n=>{const e=Array.from(n),t=e.filter(n=>(0,m.Lo)(n.name)),o=e.filter(n=>!(0,m.Lo)(n.name));if(o.length>0&&!c){const n=d?d(l):{isValid:!0};if(!n.isValid){const e=(0,v.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,v.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"12px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,v.jsx)(An.A,{size:20,color:"#ff4d4f",style:{flexShrink:0}}),(0,v.jsx)("span",{children:"Pro ulo\u017een\xed je nutn\xe9 vyplnit n\xe1sleduj\xedc\xed polo\u017eky:"})]}),Object.values(n.categories).map((n,e)=>n.errors.length>0&&(0,v.jsxs)("div",{style:{marginBottom:"10px",padding:"10px",backgroundColor:"#fff1f0",borderRadius:"4px"},children:[(0,v.jsx)("div",{style:{fontWeight:"600",fontSize:"13px",color:"#d32f2f",marginBottom:"6px"},children:n.label}),n.errors.map((n,e)=>(0,v.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginLeft:"8px",marginTop:"4px",display:"flex",alignItems:"flex-start"},children:[(0,v.jsx)("span",{style:{marginRight:"6px",color:"#ff4d4f",fontWeight:"bold"},children:"\u2022"}),(0,v.jsx)("span",{children:n})]},e))]},e))]});return void(w&&w(e,{type:"error"}))}}if(1===t.length&&r){const n=t[0];try{an(n);const e=await(0,dt.qU)(n),t=(0,dt.pd)(e);return N({file:n,isdocData:e,otherFiles:o}),M(t),void O(!0)}catch(i){w&&w("Nepoda\u0159ilo se naparsovat ISDOC soubor. Nahr\xe1no jako b\u011b\u017en\xe1 p\u0159\xedloha.",{type:"error"})}}const a=e.map((n,e)=>{try{an(n);const t=(0,m.Lo)(n.name),o=t?"ISDOC":"FAKTURA";return(0,et.A)((0,et.A)({id:"pending-".concat(Date.now(),"-").concat(e),file:n,name:n.name,size:n.size,type:n.type,klasifikace:o,uploadDate:(new Date).toISOString(),status:"pending_upload",je_isdoc:t?1:0},n.spisovka_dokument_id&&{spisovka_dokument_id:n.spisovka_dokument_id}),n.spisovka_file_id&&{spisovka_file_id:n.spisovka_file_id})}catch(t){return w&&w("".concat(n.name,": ").concat(t.message),{type:"error"}),null}}).filter(Boolean);if(a.length>0){console.log("\ud83d\udce4 P\u0158ID\xc1V\xc1M",a.length,"nov\xfdch soubor\u016f do UI s optimistic update"),console.log("\ud83d\udccb Soubory:",a.map(n=>({name:n.name,klasifikace:n.klasifikace,status:n.status})));const n=a[0];null!==n&&void 0!==n&&n.spisovka_dokument_id&&(localStorage.setItem("spisovka_active_dokument",n.spisovka_dokument_id),console.log("\ud83c\udfaf Aktivn\xed Spisovka dokument ulo\u017een do LS:",n.spisovka_dokument_id)),Q(n=>{const e=[...n,...a];return console.log("\ud83d\udcca Celkov\xfd po\u010det p\u0159\xedloh po p\u0159id\xe1n\xed:",e.length),e}),requestAnimationFrame(()=>{requestAnimationFrame(async()=>{for(const e of a)try{await dn(e.id,e.klasifikace,e)}catch(n){console.error("\u274c Chyba p\u0159i uploadu souboru ".concat(e.name,":"),n)}})})}},sn=n=>n?"error"===n.status?"#fca5a5":n.klasifikace?"uploading"===n.status?"#f59e0b":"uploaded"===n.status?"#10b981":"pending_upload"===n.status?"#3b82f6":"#e5e7eb":"#fca5a5":"#e5e7eb",ln=n=>n?"error"===n.status?"#fef2f2":n.klasifikace?"uploading"===n.status?"#fffbeb":"uploaded"===n.status?"#f0fdf4":"pending_upload"===n.status?"#eff6ff":"white":"#fef2f2":"white",dn=async function(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=i;if(!r||!r.file)return void console.error("\u274c uploadFileToServer: Chyb\xed file nebo file.file",{fileId:n,fileObj:i});const s=e||r.klasifikace;if(!s||""===s.trim())return void(w&&w("Vyberte typ p\u0159\xedlohy",{type:"error"}));if(String(t).startsWith("temp-")){if(!c){var f;const n=null===d||void 0===d?void 0:d(l,r.file);var u;if((null===n||void 0===n||!n.isValid)&&(null===n||void 0===n||!n.isISDOC))return void(w&&w("Pro nahr\xe1n\xed t\xe9to p\u0159\xedlohy vypl\u0148te nejprve: ".concat((null===n||void 0===n||null===(u=n.missingFields)||void 0===u?void 0:u.join(", "))||"povinn\xe1 pole"),{type:"error"}));null!==n&&void 0!==n&&n.isISDOC&&(null===n||void 0===n||null===(f=n.missingFields)||void 0===f?void 0:f.length)>0&&w&&w("\ud83d\udcc4 ISDOC soubor - data faktury budou extrahov\xe1na po nahr\xe1n\xed",{type:"info"})}Q(e=>e.map(e=>e.id===n?(0,et.A)((0,et.A)({},e),{},{status:"uploading",klasifikace:s}):e));try{var g,h,x,b;if(!y)throw new Error("Chyb\xed callback pro vytvo\u0159en\xed faktury v DB");const e=await y(t);if(!e||String(e).startsWith("temp-"))throw new Error("Nepoda\u0159ilo se z\xedskat re\xe1ln\xe9 ID faktury");const i=a.find(n=>n.kod===s);r.file.name,r.file.size,r.file.type;console.group("\ud83d\udd0d DEBUG: Upload p\u0159\xedlohy faktury");const l=await(0,m.dN)({token:A,username:_,faktura_id:e,objednavka_id:o,typ_prilohy:s,file:r.file});console.groupEnd();const d=(null===(g=l.priloha)||void 0===g?void 0:g.id)||l.priloha_id||(null===(h=l.data)||void 0===h||null===(x=h.priloha)||void 0===x?void 0:x.id)||(null===(b=l.data)||void 0===b?void 0:b.id)||l.id;Q(e=>{console.log("\ud83d\udd04 UPDATE ATTACHMENTS (temp faktura) - P\u0158ED:",e.length,"p\u0159\xedloh");const t=e.map(e=>e.id===n?(0,et.A)((0,et.A)((0,et.A)({},e),{},{status:"uploaded",serverId:d,klasifikace:s,faktura_typ_nazev:(null===i||void 0===i?void 0:i.nazev)||s,file:void 0},e.spisovka_dokument_id&&{spisovka_dokument_id:e.spisovka_dokument_id}),e.spisovka_file_id&&{spisovka_file_id:e.spisovka_file_id}):e);return console.log("\ud83d\udd04 UPDATE ATTACHMENTS (temp faktura) - PO:",t.length,"p\u0159\xedloh"),console.log("\ud83d\udcce Nalezena p\u0159\xedloha s ID:",d,"pro soubor:",r.file.name),t});const c=(0,v.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,v.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"8px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,v.jsx)(tt.A,{size:20,color:"#10b981",style:{flexShrink:0}}),(0,v.jsx)("span",{children:"P\u0159\xedloha \xfasp\u011b\u0161n\u011b nahr\xe1na"})]}),(0,v.jsx)("div",{style:{padding:"8px",backgroundColor:"#f0fdf4",borderRadius:"4px",fontSize:"13px",color:"#166534"},children:r.file.name})]});if(w&&w(c,{type:"success"}),p){const n={id:d,faktura_id:e,typ_prilohy:s,typ_prilohy_nazev:(null===i||void 0===i?void 0:i.nazev)||s,nazev_souboru:r.file.name,velikost:r.file.size,status:"uploaded",datum_vytvoreni:(new Date).toISOString()};p(e,n)}return}catch(D){console.group("\u274c CHYBA p\u0159i uploadu s temp ID"),console.error("Error object:",D),console.error("Error message:",D.message),console.error("Error stack:",D.stack),D.response&&(console.error("Response data:",D.response.data),console.error("Response status:",D.response.status)),console.groupEnd(),Q(e=>e.map(e=>e.id===n?(0,et.A)((0,et.A)({},e),{},{status:"error",error:D.message||"Chyba p\u0159i nahr\xe1v\xe1n\xed"}):e));const e=(null===i||void 0===i?void 0:i.name)||"soubor";let t=D.message||"Nepoda\u0159ilo se nahr\xe1t p\u0159\xedlohu";return void(t.includes("Nepodporovan\xfd typ souboru")||t.includes("Povolen\xe9 typy")?w&&w('\u274c Soubor "'.concat(e,'" nelze nahr\xe1t\n\n').concat(t),{type:"error"}):w&&w('\u274c Chyba p\u0159i nahr\xe1v\xe1n\xed "'.concat(e,'": ').concat(t),{type:"error"}))}}Q(e=>e.map(e=>e.id===n?(0,et.A)((0,et.A)({},e),{},{status:"uploading",progress:0}):e));const k=setInterval(()=>{Q(e=>e.map(e=>{if(e.id===n&&"uploading"===e.status){const n=e.progress||0,t=Math.min(n+20*Math.random(),95);return(0,et.A)((0,et.A)({},e),{},{progress:t})}return e}))},150);try{var j,z,C,S;const e=await(0,m.dN)({token:A,username:_,faktura_id:t,objednavka_id:o,typ_prilohy:s,file:r.file}),i=a.find(n=>n.kod===s),l=(null===(j=e.priloha)||void 0===j?void 0:j.id)||e.priloha_id||(null===(z=e.data)||void 0===z||null===(C=z.priloha)||void 0===C?void 0:C.id)||(null===(S=e.data)||void 0===S?void 0:S.id)||e.id;clearInterval(k),Q(e=>{console.log("\ud83d\udd04 UPDATE ATTACHMENTS (re\xe1ln\xe1 faktura) - P\u0158ED:",e.length,"p\u0159\xedloh");const t=e.map(e=>e.id===n?(0,et.A)((0,et.A)({},e),{},{status:"uploaded",progress:100,serverId:l,klasifikace:s,faktura_typ_nazev:(null===i||void 0===i?void 0:i.nazev)||s,file:void 0}):e);return console.log("\ud83d\udd04 UPDATE ATTACHMENTS (re\xe1ln\xe1 faktura) - PO:",t.length,"p\u0159\xedloh"),console.log("\ud83d\udcce Nalezena p\u0159\xedloha s ID:",l,"pro soubor:",r.file.name),t});const d=(0,v.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,v.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"8px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,v.jsx)(tt.A,{size:20,color:"#10b981",style:{flexShrink:0}}),(0,v.jsx)("span",{children:"P\u0159\xedloha \xfasp\u011b\u0161n\u011b nahr\xe1na"})]}),(0,v.jsx)("div",{style:{padding:"8px",backgroundColor:"#f0fdf4",borderRadius:"4px",fontSize:"13px",color:"#166534"},children:r.file.name})]});if(w&&w(d,{type:"success"}),p){const n={id:l,faktura_id:t,typ_prilohy:s,typ_prilohy_nazev:(null===i||void 0===i?void 0:i.nazev)||s,nazev_souboru:r.file.name,velikost:r.file.size,status:"uploaded",datum_vytvoreni:(new Date).toISOString()};p(t,n)}}catch(D){clearInterval(k),Q(e=>e.map(e=>e.id===n?(0,et.A)((0,et.A)({},e),{},{status:"pending_classification",progress:0}):e)),w&&w("Nepoda\u0159ilo se nahr\xe1t p\u0159\xedlohu",{type:"error"})}},cn=(0,g.useMemo)(()=>c?{isValid:!0,missingFields:[]}:l?d?d(l):{isValid:!0,missingFields:[]}:{isValid:!1,missingFields:["Faktura"]},[l,d,c]),pn=C||j||i;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(pt,{children:[(0,v.jsx)(ft,{children:(0,v.jsxs)(ut,{children:[(0,v.jsx)(ot.A,{}),"P\u0159\xedlohy faktury",J.length>0&&(0,v.jsx)(gt,{children:J.length})]})}),(0,v.jsx)(bt,{ref:E,type:"file",accept:".pdf,.isdoc,.jpg,.jpeg,.png,.xml",multiple:!0,onChange:async n=>{const e=n.target.files;e&&0!==e.length&&(await rn(e),E.current&&(E.current.value=""))},disabled:pn}),!cn.isValid&&!i&&(0,v.jsxs)("div",{style:{background:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"6px",padding:"1rem",marginBottom:"1rem",display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[(0,v.jsx)(vn.A,{size:20,style:{color:"#f59e0b",flexShrink:0,marginTop:"2px"}}),(0,v.jsxs)("div",{style:{flex:1},children:[(0,v.jsx)("div",{style:{fontWeight:"500",color:"#92400e",marginBottom:"0.25rem"},children:"Vypl\u0148te povinn\xe9 polo\u017eky faktury"}),(0,v.jsxs)("div",{style:{fontSize:"0.875rem",color:"#78350f"},children:["Pro p\u0159id\xe1n\xed p\u0159\xedloh je nutn\xe9 vyplnit: ",(null===(e=cn.missingFields)||void 0===e?void 0:e.join(", "))||"povinn\xe1 pole"]})]})]}),!i&&(0,v.jsxs)(ht,{onClick:()=>{var n;pn||(null===(n=E.current)||void 0===n||n.click())},onDragOver:n=>{n.preventDefault(),n.stopPropagation(),pn||F(!0)},onDragLeave:n=>{n.preventDefault(),n.stopPropagation(),n.currentTarget!==n.target&&n.currentTarget.contains(n.relatedTarget)||F(!1)},onDrop:async n=>{if(n.preventDefault(),n.stopPropagation(),F(!1),pn)return;const e=n.dataTransfer.getData("text/spisovka-attachments");if(e){try{const n=JSON.parse(e);if(!Array.isArray(n)||0===n.length)return void(w&&w("\u274c \u017d\xe1dn\xe9 p\u0159\xedlohy k nahr\xe1n\xed",{type:"error"}));if(!n.some(n=>(0,m.Lo)(n.filename))&&!c){const n=d?d(l):{isValid:!0};if(!n.isValid){const e=(0,v.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,v.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"12px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,v.jsx)(An.A,{size:20,color:"#ff4d4f",style:{flexShrink:0}}),(0,v.jsx)("span",{children:"Pro ulo\u017een\xed je nutn\xe9 vyplnit n\xe1sleduj\xedc\xed polo\u017eky:"})]}),Object.values(n.categories).map((n,e)=>n.errors.length>0&&(0,v.jsxs)("div",{style:{marginBottom:"10px",padding:"10px",backgroundColor:"#fff1f0",borderRadius:"4px"},children:[(0,v.jsx)("div",{style:{fontWeight:"600",fontSize:"13px",color:"#d32f2f",marginBottom:"6px"},children:n.label}),n.errors.map((n,e)=>(0,v.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginLeft:"8px",marginTop:"4px",display:"flex",alignItems:"flex-start"},children:[(0,v.jsx)("span",{style:{marginRight:"6px",color:"#ff4d4f",fontWeight:"bold"},children:"\u2022"}),(0,v.jsx)("span",{children:n})]},e))]},e))]});return void(w&&w(e,{type:"error"}))}}const t=n.map(async n=>{const e="".concat("https://erdms.zachranka.cz/api.eeo/","spisovka.php/proxy-file?url=").concat(encodeURIComponent(n.url)),t=await fetch(e);if(!t.ok)throw new Error("Chyba p\u0159i stahov\xe1n\xed ".concat(n.filename));const o=t.headers.get("X-Original-Filename")||n.filename,a=await t.blob();return new File([a],o,{type:n.mime_type||a.type})}),o=await Promise.all(t);await rn(o);const a=(0,v.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,v.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"8px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,v.jsx)(tt.A,{size:20,color:"#10b981",style:{flexShrink:0}}),(0,v.jsx)("span",{children:"P\u0159\xedlohy \xfasp\u011b\u0161n\u011b nahr\xe1ny"})]}),(0,v.jsxs)("div",{style:{padding:"8px",backgroundColor:"#f0fdf4",borderRadius:"4px",fontSize:"13px",color:"#166534"},children:["Nahr\xe1no ",o.length," ",1===o.length?"p\u0159\xedloha":o.length<5?"p\u0159\xedlohy":"p\u0159\xedloh"," ze spisovky"]})]});w&&w(a,{type:"success"})}catch(D){console.error("\u274c Chyba p\u0159i stahov\xe1n\xed p\u0159\xedloh ze spisovky:",D);let e=D.message;e.includes("Chyba p\u0159i stahov\xe1n\xed")?w&&w("\u274c ".concat(e),{type:"error"}):w&&w("\u274c Chyba p\u0159i zpracov\xe1n\xed p\u0159\xedloh: ".concat(e),{type:"error"})}return}const t=n.dataTransfer.getData("text/spisovka-file-url"),o=n.dataTransfer.getData("text/spisovka-file-name"),a=n.dataTransfer.getData("text/spisovka-file-mime"),i=n.dataTransfer.getData("text/spisovka-file-id"),r=n.dataTransfer.getData("text/spisovka-dokument-id");if(t&&o){if(!(0,m.Lo)(o)&&!c){const n=d?d(l):{isValid:!0};if(!n.isValid){const e=(0,v.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,v.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"12px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,v.jsx)(An.A,{size:20,color:"#ff4d4f",style:{flexShrink:0}}),(0,v.jsx)("span",{children:"Pro ulo\u017een\xed je nutn\xe9 vyplnit n\xe1sleduj\xedc\xed polo\u017eky:"})]}),Object.values(n.categories).map((n,e)=>n.errors.length>0&&(0,v.jsxs)("div",{style:{marginBottom:"10px",padding:"10px",backgroundColor:"#fff1f0",borderRadius:"4px"},children:[(0,v.jsx)("div",{style:{fontWeight:"600",fontSize:"13px",color:"#d32f2f",marginBottom:"6px"},children:n.label}),n.errors.map((n,e)=>(0,v.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginLeft:"8px",marginTop:"4px",display:"flex",alignItems:"flex-start"},children:[(0,v.jsx)("span",{style:{marginRight:"6px",color:"#ff4d4f",fontWeight:"bold"},children:"\u2022"}),(0,v.jsx)("span",{children:n})]},e))]},e))]});return void(w&&w(e,{type:"error"}))}}try{const n="".concat("https://erdms.zachranka.cz/api.eeo/","spisovka.php/proxy-file?url=").concat(encodeURIComponent(t)),e=await fetch(n);if(!e.ok)throw new Error("Chyba p\u0159i stahov\xe1n\xed souboru");const s=e.headers.get("X-Original-Filename")||o,l=await e.blob(),d=new File([l],s,{type:a||l.type});i&&(d.spisovka_file_id=parseInt(i)),r&&(d.spisovka_dokument_id=parseInt(r)),await rn([d])}catch(D){console.error("\u274c Chyba p\u0159i stahov\xe1n\xed souboru ze spisovky:",D),w&&w("\u274c Chyba p\u0159i stahov\xe1n\xed souboru ze spisovky",{type:"error"})}return}const s=n.dataTransfer.files;s&&0!==s.length&&await rn(s)},isDragging:I,disabled:pn,children:[(0,v.jsx)(xt,{isDragging:I,children:I?"\u2b07\ufe0f":"\ud83d\udcce"}),(0,v.jsxs)(mt,{children:[(0,v.jsx)(vt,{children:C?"Nahr\xe1v\xe1m...":I?"Pus\u0165te soubor":"P\u0159et\xe1hn\u011bte PDF, ISDOC, JPG, PNG, DOC, DOCX, XLS, XLSX nebo XML (max 10 MB)"}),(0,v.jsx)(yt,{children:"Kliknut\xedm otev\u0159ete dialog \u2022 Po p\u0159id\xe1n\xed vyberte typ p\u0159\xedlohy"})]})]}),D&&(0,v.jsxs)(Ft,{children:[(0,v.jsx)(An.A,{}),D]}),j&&(0,v.jsxs)(It,{children:[(0,v.jsx)(at.A,{}),"Na\u010d\xedt\xe1m p\u0159\xedlohy..."]}),!j&&0===J.length&&(0,v.jsxs)(_t,{children:[(0,v.jsx)(ot.A,{}),"\u017d\xe1dn\xe9 p\u0159\xedlohy nejsou"]}),!j&&J.length>0&&(0,v.jsx)(kt,{children:J.filter(n=>n&&n.id).map(n=>(0,v.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem",border:"1px solid ".concat(sn(n)),borderRadius:"6px",backgroundColor:ln(n),marginBottom:"0.5rem",opacity:"uploading"===n.status?.6:1,position:"relative",overflow:"hidden"},children:[(0,v.jsxs)("div",{style:{width:"32px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,position:"relative"},children:[!1===n.file_exists?(0,v.jsx)(it.A,{size:24,style:{color:"#dc2626"}}):(0,v.jsx)(xn.A,{size:24,style:{color:"uploaded"===n.status?"#10b981":"#dc2626"}}),"uploaded"===n.status&&(0,v.jsx)("div",{style:{position:"absolute",top:"-2px",right:"-2px",width:"12px",height:"12px",backgroundColor:"#10b981",borderRadius:"50%"}}),"uploading"===n.status&&(0,v.jsx)("div",{style:{position:"absolute",top:"-2px",right:"-2px",width:"12px",height:"12px",backgroundColor:"#f59e0b",borderRadius:"50%",animation:"spin 1s linear infinite"}})]}),"uploading"===n.status&&void 0!==n.progress&&(0,v.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"4px",backgroundColor:"#fef3c7",borderRadius:"0 0 6px 6px",overflow:"hidden",zIndex:10},children:(0,v.jsx)("div",{style:{height:"100%",width:"".concat(n.progress,"%"),backgroundColor:"linear-gradient(90deg, #f59e0b 0%, #fb923c 100%)",background:"linear-gradient(90deg, #f59e0b 0%, #fb923c 100%)",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(245, 158, 11, 0.6)"}})}),(0,v.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,v.jsx)("div",{style:{fontWeight:"500",fontSize:"0.875rem",color:"#374151",marginBottom:"2px"},children:(0,v.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,v.jsxs)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0,position:"relative"},children:[n.name,!n.klasifikace&&(0,v.jsx)("span",{style:{color:"#dc2626",fontSize:"0.7rem",fontWeight:"bold",position:"absolute",top:"-2px",marginLeft:"2px"},children:"*"})]}),!1===n.file_exists&&(0,v.jsx)("span",{style:{color:"#dc2626",fontSize:"0.7rem",fontWeight:"bold",backgroundColor:"#fee2e2",padding:"1px 4px",borderRadius:"3px",flexShrink:0},children:"\u26a0 SOUBOR NENALEZEN"}),(0,v.jsxs)("span",{style:{color:"#6b7280",fontWeight:"normal",fontSize:"0.75rem",flexShrink:0},children:["(",Math.round((n.size||0)/1024)," kB)"]}),"uploaded"===n.status&&n.serverId&&(0,v.jsx)("button",{type:"button",onClick:()=>(async n=>{const e=J.find(e=>e.id===n);if(e&&e.serverId)try{const n=await(0,m.ML)({token:A,username:_,faktura_id:t,priloha_id:e.serverId,objednavka_id:o}),a=e.name||"priloha.pdf",i=a.toLowerCase().split(".").pop();let r="application/octet-stream";"pdf"===i?r="application/pdf":["jpg","jpeg"].includes(i)?r="image/jpeg":"png"===i?r="image/png":"gif"===i?r="image/gif":"bmp"===i?r="image/bmp":"webp"===i?r="image/webp":"svg"===i&&(r="image/svg+xml");const s=new Blob([n],{type:r});if("pdf"===i||["jpg","jpeg","png","gif","bmp","webp","svg"].includes(i)){const n=window.URL.createObjectURL(s);return void V({visible:!0,url:n,filename:a,type:"pdf"===i?"pdf":"image"})}const l=window.URL.createObjectURL(s),d=document.createElement("a");d.href=l,d.download=a,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(l),w&&w("Soubor st\xe1\u017een",{type:"success"})}catch(a){w&&w("Chyba: ".concat(a.message),{type:"error"})}})(n.id),style:{background:"none",border:"none",color:"#2563eb",cursor:"pointer",padding:"2px",display:"flex",alignItems:"center",fontSize:"12px",flexShrink:0},title:"Otev\u0159\xedt v nov\xe9m okn\u011b",children:(0,v.jsx)(rt.A,{size:14})}),!i&&(0,v.jsx)("button",{type:"button",onClick:()=>n.serverId?(async n=>{const e=J.find(e=>e.id===n);e&&e.serverId&&X({isOpen:!0,title:"Smazat p\u0159\xedlohu",message:'Opravdu chcete smazat p\u0159\xedlohu "'.concat(e.name,'"?'),onConfirm:async()=>{try{const n=await(0,m.vd)({token:A,username:_,faktura_id:t,priloha_id:e.serverId,objednavka_id:o,hard_delete:1});if(!n||"ok"!==n.status&&"success"!==n.status&&!0!==n.success)throw new Error((null===n||void 0===n?void 0:n.message)||"Neo\u010dek\xe1van\xe1 odpov\u011b\u010f serveru");n.data&&n.warning?(w&&w("\u26a0\ufe0f P\u0159\xedloha smaz\xe1na (s varov\xe1n\xedm)",{type:"warning"}),console.warn("\u26a0\ufe0f Warning:",n.warning)):w&&w("\ud83d\uddd1\ufe0f P\u0159\xedloha byla \xfasp\u011b\u0161n\u011b smaz\xe1na",{type:"success"}),X({isOpen:!1,title:"",message:"",onConfirm:null}),f&&f(e),await on()}catch(a){var n;console.error("\u274c DELETE Error:",a),console.error("Error message:",a.message),console.error("Error response:",null===(n=a.response)||void 0===n?void 0:n.data),w&&w("Nepoda\u0159ilo se smazat p\u0159\xedlohu: ".concat(a.message),{type:"error"}),X({isOpen:!1,title:"",message:"",onConfirm:null})}}})})(n.id):(n=>{const e=J.find(e=>e.id===n);e&&X({isOpen:!0,title:"Odstranit p\u0159\xedlohu",message:'Opravdu chcete odstranit p\u0159\xedlohu "'.concat(e.name,'"?'),onConfirm:()=>{Q(e=>e.filter(e=>e.id!==n)),w&&w("\u2705 P\u0159\xedloha odstran\u011bna",{type:"success"}),X({isOpen:!1,title:"",message:"",onConfirm:null}),f&&f(e)}})})(n.id),disabled:"uploading"===n.status,style:{background:"none",border:"none",color:"uploading"===n.status?"#9ca3af":"#dc2626",cursor:"uploading"===n.status?"not-allowed":"pointer",padding:"2px",display:"flex",alignItems:"center",opacity:"uploading"===n.status?.6:1,fontSize:"12px",flexShrink:0},title:n.serverId?"Smazat ze serveru":"Smazat soubor",children:(0,v.jsx)(st.A,{size:14})})]})}),(0,v.jsxs)("div",{style:{fontSize:"0.75rem",color:"#6b7280",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,v.jsx)("span",{children:n.uploadDate&&!isNaN(new Date(n.uploadDate).getTime())?"".concat(new Date(n.uploadDate).toLocaleDateString("cs-CZ")," ").concat(new Date(n.uploadDate).toLocaleTimeString("cs-CZ",{hour:"2-digit",minute:"2-digit"})):"\u2014"}),(0,v.jsx)("span",{children:"\u2022"}),(0,v.jsx)("span",{style:{textTransform:"uppercase",backgroundColor:"#fef3c7",color:"#92400e",padding:"2px 6px",borderRadius:"4px",fontSize:"0.6875rem",fontWeight:"500"},children:n.name?n.name.endsWith(".pdf")?"PDF":n.name.split(".").pop().toUpperCase():"FILE"}),(0,v.jsx)("span",{children:"\u2022"}),(0,v.jsxs)("span",{style:{backgroundColor:"#e0e7ff",color:"#3730a3",padding:"2px 6px",borderRadius:"4px",fontSize:"0.6875rem",fontWeight:"500"},children:["Nahr\xe1no: ",$(n.uploadedByUserId)]}),n.faktura_typ_nazev&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:"\u2022"}),(0,v.jsx)("span",{style:{backgroundColor:"#dbeafe",color:"#1e40af",padding:"2px 6px",borderRadius:"4px",fontSize:"0.6875rem",fontWeight:"500"},children:n.faktura_typ_nazev})]})]})]}),(0,v.jsx)("div",{style:{minWidth:"180px",flexShrink:0},children:(0,v.jsxs)("select",{value:n.klasifikace||"",onChange:e=>(async(n,e)=>{const i=J.find(e=>e.id===n);if(i)if(Q(t=>t.map(t=>t.id===n?(0,et.A)((0,et.A)({},t),{},{klasifikace:e}):t)),!e||""===e.trim()||"pending_classification"!==i.status&&"pending_upload"!==i.status){if(e&&""!==e.trim()&&"uploaded"===i.status&&i.serverId)try{if(i.klasifikace===e)return;await(0,m.v4)({token:A,username:_,faktura_id:t,priloha_id:i.serverId,objednavka_id:o,typ_prilohy:e,type:e});const r=a.find(n=>n.kod===e);Q(t=>t.map(t=>t.id===n?(0,et.A)((0,et.A)({},t),{},{klasifikace:e,faktura_typ_nazev:(null===r||void 0===r?void 0:r.nazev)||e}):t)),w&&w("Klasifikace byla aktualizov\xe1na",{type:"success"})}catch(r){w&&w("Chyba p\u0159i aktualizaci: ".concat(r.message),{type:"error"}),Q(e=>e.map(e=>e.id===n?(0,et.A)((0,et.A)({},e),{},{klasifikace:i.klasifikace}):e))}}else await dn(n,e,i)})(n.id,e.target.value),disabled:"uploading"===n.status||i,style:{width:"100%",padding:"0.5rem 0.75rem",border:"1px solid ".concat(n.klasifikace?"#d1d5db":"#fca5a5"),borderRadius:"6px",fontSize:"0.875rem",backgroundColor:"uploading"===n.status||i?"#f3f4f6":"white",color:n.klasifikace?"#374151":"#6b7280",cursor:"uploading"===n.status||i?"not-allowed":"pointer",opacity:"uploading"===n.status||i?.6:1},children:[(0,v.jsx)("option",{value:"",style:{color:"#6b7280"},children:"Vyberte..."}),a.map(n=>(0,v.jsx)("option",{value:n.kod,children:n.nazev},n.kod))]})})]},n.id))})]}),T&&R&&h.createPortal((0,v.jsx)(re,{isdocSummary:R,isdocData:null===L||void 0===L?void 0:L.isdocData,onConfirm:async function(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(L)try{var e,i;const{file:l,isdocData:d,otherFiles:c}=L;if(!s)throw new Error("Chyb\xed data formul\xe1\u0159e objedn\xe1vky");const f=(0,dt.GC)(d,s,n),u=t&&!String(t).startsWith("temp-");let g;if(u){const n=await(0,m.dN)({token:A,username:_,faktura_id:t,objednavka_id:o,typ_prilohy:"FAKTURA",file:l});g={faktura_id:t,priloha_id:n.priloha_id,priloha:n.priloha}}else g=await(0,m.Md)({token:A,username:_,objednavka_id:o,fa_castka:f.fa_castka,fa_cislo_vema:f.fa_cislo_vema,fa_datum_vystaveni:f.fa_datum_vystaveni,fa_datum_splatnosti:f.fa_datum_splatnosti,fa_datum_doruceni:f.fa_datum_doruceni,fa_strediska_kod:f.fa_strediska_kod,fa_poznamka:f.fa_poznamka,fa_dorucena:1,file:l,typ_prilohy:"FAKTURA"});if(r){const n=(0,et.A)((0,et.A)({},f),{},{id:g.faktura_id,_realId:g.faktura_id,_updateExisting:u});r(n,g.faktura_id)}const h=a.find(n=>"FAKTURA"===n.kod),x={id:g.priloha_id,serverId:g.priloha_id,faktura_id:g.faktura_id,objednavka_id:o,name:l.name,size:l.size,type:l.type,klasifikace:"FAKTURA",faktura_typ_nazev:(null===h||void 0===h?void 0:h.nazev)||"FAKTURA",uploadDate:(null===(e=g.priloha)||void 0===e?void 0:e.dt_vytvoreni)||(new Date).toISOString(),status:"uploaded",je_isdoc:1,guid:null===(i=g.priloha)||void 0===i?void 0:i.guid};Q(n=>[...n,x]),c&&c.length>0&&await rn(c),O(!1),N(null),M(null),w&&w("Faktura v\u010detn\u011b ISDOC p\u0159\xedlohy byla \xfasp\u011b\u0161n\u011b vytvo\u0159ena",{type:"success"}),p&&p()}catch(l){w&&w(l.message||"Chyba p\u0159i vytv\xe1\u0159en\xed faktury s p\u0159\xedlohou",{type:"error"})}},onCancel:()=>{O(!1),N(null),M(null),w&&w("Nahr\xe1n\xed ISDOC zru\u0161eno",{type:"info"})},onUploadWithoutParsing:async()=>{if(L)try{const{file:n,otherFiles:e}=L,t={id:"pending-".concat(Date.now()),file:n,name:n.name,size:n.size,type:n.type,klasifikace:"ISDOC",uploadDate:(new Date).toISOString(),status:"pending_upload",je_isdoc:1};Q(n=>[...n,t]),await dn(t.id,"ISDOC"),e&&e.length>0&&await rn(e),O(!1),N(null),M(null),w&&w("ISDOC soubor byl nahr\xe1n bez extrakce dat",{type:"success"})}catch(n){w&&w(n.message||"Chyba p\u0159i nahr\xe1v\xe1n\xed ISDOC",{type:"error"})}}}),document.body),(0,v.jsx)(ct.A,{isOpen:Z.isOpen,title:Z.title,confirmText:"Smazat",variant:"danger",onConfirm:Z.onConfirm,onClose:()=>X({isOpen:!1,title:"",message:"",onConfirm:null}),children:Z.message}),B.visible&&h.createPortal((0,v.jsx)(At,{x:W.x,y:W.y,w:W.w,h:W.h,children:(0,v.jsxs)(wt,{children:[(0,v.jsxs)(jt,{onMouseDown:n=>{const e=n.currentTarget.parentElement.parentElement.getBoundingClientRect();Y({x:n.clientX-e.left,y:n.clientY-e.top}),q(!0),n.preventDefault(),n.stopPropagation()},style:{cursor:K?"grabbing":"grab"},children:[(0,v.jsxs)(zt,{children:[(0,v.jsx)(xn.A,{size:20}),B.filename]}),(0,v.jsx)(Ct,{onClick:()=>{B.url&&window.URL.revokeObjectURL(B.url),V({visible:!1,url:"",filename:"",type:""})},children:(0,v.jsx)(mn.A,{size:18})})]}),(0,v.jsx)(St,{data:B.url,type:"pdf"===B.type?"application/pdf":void 0,title:B.filename,children:(0,v.jsxs)(Dt,{children:[(0,v.jsx)(An.A,{size:48,color:"#64748b"}),(0,v.jsx)("div",{style:{fontSize:"1.1rem",fontWeight:600},children:"Soubor nelze zobrazit v prohl\xed\u017ee\u010di"}),(0,v.jsx)("div",{style:{fontSize:"0.9rem",color:"#64748b",textAlign:"center",maxWidth:"400px"},children:"V\xe1\u0161 prohl\xed\u017ee\u010d nepodporuje zobrazen\xed tohoto typu soubor\u016f. M\u016f\u017eete soubor st\xe1hnout a otev\u0159\xedt extern\u011b."}),(0,v.jsxs)(Pt,{href:B.url,download:B.filename,children:[(0,v.jsx)(lt.A,{size:18}),"St\xe1hnout soubor"]})]})})]})}),document.body)]})});var Tt,Ot,Lt,Nt,Rt,Mt,Bt,Vt,Wt,Ut,Kt,qt,Ht,Yt,Zt,Xt,Gt=t(83910),Jt=t(97929),Qt=t(56804),$t=t(84808),no=t(63974);const eo=x.A.div(Tt||(Tt=(0,u.A)(["\n  background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);\n  border: 1px solid ",";\n  border-radius: 12px;\n  padding: 24px;\n  margin-bottom: 24px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n  transition: all 0.2s ease;\n  \n  &:hover {\n    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n  }\n"])),n=>n.hasError?"#dc3545":"#e9ecef"),to=x.A.div(Ot||(Ot=(0,u.A)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 16px;\n  padding-bottom: 12px;\n  border-bottom: 2px solid #dee2e6;\n"]))),oo=x.A.h4(Lt||(Lt=(0,u.A)(["\n  margin: 0;\n  font-size: 16px;\n  font-weight: 600;\n  color: #333;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  svg {\n    color: #007bff;\n  }\n"]))),ao=x.A.div(Nt||(Nt=(0,u.A)(["\n  display: flex;\n  gap: 24px;\n  font-size: 14px;\n"]))),io=x.A.div(Rt||(Rt=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  \n  label {\n    font-size: 11px;\n    text-transform: uppercase;\n    color: #6c757d;\n    margin-bottom: 4px;\n  }\n  \n  span {\n    font-size: 16px;\n    font-weight: 600;\n    color: ",";\n  }\n"])),n=>n.highlight?"#007bff":"#333"),ro=x.A.div(Mt||(Mt=(0,u.A)(["\n  display: grid;\n  grid-template-columns: 1fr 220px 52px; /* Lep\u0161\xed proporce pro v\u011bt\u0161\xed elementy */\n  gap: 24px; /* V\u011bt\u0161\xed mezery */\n  margin-bottom: 24px;\n  align-items: end;\n  padding: 24px; /* V\u011bt\u0161\xed padding */\n  background: white;\n  border: 1px solid #e9ecef;\n  border-radius: 12px; /* V\u011bt\u0161\xed border-radius */\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); /* Jemn\u011bj\u0161\xed shadow */\n  \n  @media (max-width: 1200px) {\n    grid-template-columns: 2fr 180px 52px;\n    gap: 16px;\n  }\n  \n  @media (max-width: 768px) {\n    grid-template-columns: 1fr;\n    gap: 16px;\n    align-items: stretch;\n    padding: 16px;\n  }\n"]))),so=x.A.div(Bt||(Bt=(0,u.A)(['\n  display: flex;\n  flex-direction: column;\n  min-height: 80px; /* V\u011bt\u0161\xed v\xfd\u0161ka pro lep\u0161\xed proporce */\n  \n  label {\n    font-size: 14px; /* V\u011bt\u0161\xed font pro lep\u0161\xed \u010ditelnost */\n    font-weight: 600;\n    color: #495057;\n    margin-bottom: 8px;\n    height: 22px;\n    line-height: 22px;\n    display: flex;\n    align-items: center;\n  }\n\n  /* Sjednocen\xed v\xfd\u0161ky v\u0161ech input element\u016f */\n  [data-component="CustomSelect"] {\n    height: 48px !important; /* V\u011bt\u0161\xed v\xfd\u0161ka pro lep\u0161\xed UX */\n    \n    & > div:first-of-type {\n      height: 48px !important;\n      display: flex;\n      align-items: center;\n      padding: 0 16px; /* V\u011bt\u0161\xed padding pro lep\u0161\xed design */\n      font-size: 15px; /* V\u011bt\u0161\xed font v selectu */\n      font-weight: ',"; /* Tu\u010dn\xfd kdy\u017e je vypln\u011bn\xe9 */\n      \n      /* Ellipsis pro dlouh\xe9 texty */\n      overflow: hidden;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n      max-width: 100%;\n    }\n    \n    /* Centrace placeholderu */\n    .select__placeholder {\n      line-height: 1;\n      font-size: 15px;\n      font-weight: 400; /* Placeholder v\u017edy norm\xe1ln\xed */\n      overflow: hidden;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n    }\n    \n    /* Styling pro dropdown options */\n    .select__option {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      max-width: 100%;\n      padding: 8px 12px;\n      \n      &:hover {\n        background: #f8f9fa;\n      }\n    }\n  }\n"])),n=>n.isFilled?"600":"400"),lo=(x.A.select(Vt||(Vt=(0,u.A)(["\n  padding: 8px 12px;\n  border: 1px solid #ced4da;\n  border-radius: 4px;\n  font-size: 14px;\n  background: white;\n  \n  &:focus {\n    outline: none;\n    border-color: #007bff;\n    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);\n  }\n  \n  &:disabled {\n    background: #e9ecef;\n    cursor: not-allowed;\n  }\n"]))),x.A.input(Wt||(Wt=(0,u.A)(["\n  width: 100%;\n  height: 48px; /* Stejn\xe1 v\xfd\u0161ka jako CustomSelect */\n  padding: 12px 50px 12px 16px; /* V\u011bt\u0161\xed padding pro lep\u0161\xed UX */\n  border: 1px solid ",";\n  border-radius: 6px;\n  font-size: 15px; /* V\u011bt\u0161\xed font pro lep\u0161\xed \u010ditelnost */\n  font-weight: ","; /* Tu\u010dn\xfd kdy\u017e je vypln\u011bn\xe9 */\n  text-align: right;\n  font-family: inherit; /* Sjednocen\xfd font s celou str\xe1nkou */\n  box-sizing: border-box;\n  transition: border-color 0.15s ease;\n  \n  &:focus {\n    outline: none;\n    border-color: ",";\n    box-shadow: 0 0 0 3px ",";\n  }\n  \n  &:disabled {\n    background: #f8f9fa;\n    cursor: not-allowed;\n    color: #6c757d;\n  }\n  \n  &::placeholder {\n    color: #adb5bd;\n    font-style: normal;\n  }\n"])),n=>n.hasError?"#dc3545":"#ced4da",n=>n.value&&"0"!==n.value&&""!==n.value?"600":"400",n=>n.hasError?"#dc3545":"#007bff",n=>n.hasError?"rgba(220, 53, 69, 0.15)":"rgba(0, 123, 255, 0.15)")),co=x.A.div(Ut||(Ut=(0,u.A)(["\n  position: relative;\n  flex: 1;\n  display: flex;\n  align-items: center;\n"]))),po=x.A.span(Kt||(Kt=(0,u.A)(["\n  position: absolute;\n  right: 16px; /* V\u011bt\u0161\xed offset kv\u016fli v\u011bt\u0161\xedmu paddingu */\n  color: ",";\n  font-weight: 600;\n  font-size: 15px; /* V\u011bt\u0161\xed font pro slad\u011bn\xed s inputem */\n  font-family: inherit;\n  pointer-events: none;\n  user-select: none;\n"])),n=>n.disabled?"#9ca3af":"#374151"),fo=x.A.div(qt||(qt=(0,u.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  align-items: center;\n  justify-content: flex-end;\n  min-height: 80px; /* Odpov\xedd\xe1 FormGroup min-height */\n  padding-bottom: 4px;\n"]))),uo=x.A.button(Ht||(Ht=(0,u.A)(["\n  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);\n  color: white;\n  border: none;\n  border-radius: 8px;\n  padding: 0;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 48px; /* Stejn\xe1 velikost jako v\xfd\u0161ka input\u016f */\n  height: 48px;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 8px rgba(239, 68, 68, 0.25);\n\n  &:hover:not(:disabled) {\n    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.35);\n  }\n\n  &:active:not(:disabled) {\n    transform: translateY(0);\n    box-shadow: 0 2px 4px rgba(239, 68, 68, 0.25);\n  }\n\n  &:disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n    transform: none;\n    box-shadow: none;\n  }\n\n  svg {\n    color: white;\n    width: 18px; /* V\u011bt\u0161\xed ikona pro lep\u0161\xed proporce */\n    height: 18px;\n  }\n"]))),go=x.A.button(Yt||(Yt=(0,u.A)(["\n  padding: 12px 20px; /* V\u011bt\u0161\xed padding */\n  border: 2px dashed #007bff;\n  border-radius: 8px; /* V\u011bt\u0161\xed border-radius */\n  background: white;\n  color: #007bff;\n  font-size: 15px; /* V\u011bt\u0161\xed font */\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n  margin-top: 12px;\n  width: 100%;\n  \n  &:hover:not(:disabled) {\n    background: #007bff;\n    color: white;\n    border-style: solid;\n  }\n  \n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    border-color: #ced4da;\n    color: #6c757d;\n  }\n"]))),ho=x.A.div(Zt||(Zt=(0,u.A)(["\n  margin-top: 12px;\n  padding: 12px 16px;\n  border-radius: 6px;\n  font-size: 14px;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  \n  background: ",";\n  \n  color: ",";\n  \n  border: 1px solid ",";\n  \n  svg {\n    flex-shrink: 0;\n  }\n"])),n=>"error"===n.type?"#f8d7da":"warning"===n.type?"#fff3cd":"success"===n.type?"#d1e7dd":"#d1ecf1",n=>"error"===n.type?"#842029":"warning"===n.type?"#664d03":"success"===n.type?"#0f5132":"#055160",n=>"error"===n.type?"#f5c2c7":"warning"===n.type?"#ffecb5":"success"===n.type?"#badbcc":"#b6effb"),xo=x.A.div(Xt||(Xt=(0,u.A)(["\n  background: #e7f3ff;\n  border-left: 4px solid #007bff;\n  padding: 12px 16px;\n  margin-bottom: 16px;\n  font-size: 13px;\n  color: #004085;\n  border-radius: 4px;\n"]))),mo=n=>{if(!n&&0!==n)return"";const e=parseFloat(n);return isNaN(e)?"":e.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g," ").replace(".",",")},vo=n=>{if(!n)return 0;const e=n.toString().replace(/\s/g,"").replace(",","."),t=parseFloat(e);return isNaN(t)?0:t},yo=g.memo(function(n){let{value:e,onChange:t,hasError:o,disabled:a}=n;const[i,r]=(0,g.useState)(""),[s,l]=(0,g.useState)(!1),d=(0,g.useRef)(null),c=(0,g.useCallback)(n=>{if(!n&&0!==n)return"";const e=parseFloat(n.toString().replace(/[^0-9.-]/g,""));return isNaN(e)?"":e.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g," ").replace(".",",")},[]),p=(0,g.useMemo)(()=>s?i:c(e||""),[e,s,i,c]);(0,g.useEffect)(()=>{s||r(c(e||""))},[e,s,c]);const f=(0,g.useCallback)(n=>{const e=n.target.value;r(e);const o=e.replace(/[^\d,.-]/g,"").replace(",","."),a=parseFloat(o),i=isNaN(a)?"":a.toFixed(2);t(i)},[t]),u=(0,g.useCallback)(()=>{l(!0)},[]),h=(0,g.useCallback)(()=>{l(!1);const n=c(i);r(n)},[i,c]);return(0,v.jsxs)(co,{children:[(0,v.jsx)(lo,{ref:d,type:"text",value:p,onChange:f,onFocus:u,onBlur:h,disabled:a,hasError:o,placeholder:"0,00"}),(0,v.jsx)(po,{disabled:a,children:"K\u010d"})]})});function bo(n){let{faktura:e,orderData:t,lpCerpani:o=[],availableLPCodes:a=[],onChange:i,onValidationChange:r,disabled:s=!1}=n;const[l,d]=(0,g.useState)([]),[c,p]=(0,g.useState)([]),[f,u]=(0,g.useState)({}),[h,x]=(0,g.useState)({}),[m,y]=(0,g.useState)({}),b=(0,g.useRef)(!1),k=(0,g.useRef)(null),_=(0,g.useRef)(0),A=(0,g.useRef)(r);(0,g.useEffect)(()=>{A.current=r},[r]);const w=(0,g.useMemo)(()=>{var n;if(!a||0===a.length)return[];let e=null;if(null!==t&&void 0!==t&&t.lp_kod&&Array.isArray(t.lp_kod)&&t.lp_kod.length>0?e=t.lp_kod:null!==t&&void 0!==t&&null!==(n=t.financovani)&&void 0!==n&&n.lp_kody&&Array.isArray(t.financovani.lp_kody)&&t.financovani.lp_kody.length>0&&(e=t.financovani.lp_kody),!e||0===e.length)return a;const o=a.filter(n=>e.some(e=>n.id===e||n.id===Number(e)||n.kod===e||n.cislo_lp===e));return o.length>0?o:a},[null===t||void 0===t?void 0:t.lp_kod,null===t||void 0===t?void 0:t.financovani,a]),j=(0,g.useMemo)(()=>w.map(n=>(0,et.A)((0,et.A)({},n),{},{label:(()=>{const e=n.cislo_lp||n.kod||n.id,t=n.nazev_uctu||n.nazev||"Bez n\xe1zvu",o="".concat(e," - ").concat(t);return o.length>35?"".concat(e," - ").concat(t.substring(0,35-e.length-6),"..."):o})()})),[w]),z=w.length>0;(0,g.useEffect)(()=>{(null===e||void 0===e?void 0:e.id)!==k.current&&(b.current=!1,k.current=null===e||void 0===e?void 0:e.id,_.current=0)},[null===e||void 0===e?void 0:e.id]),(0,g.useEffect)(()=>{if(!b.current){if(((null===o||void 0===o?void 0:o.length)||0)>0)d(o.map((n,e)=>{const t=null===a||void 0===a?void 0:a.find(e=>e.id===n.lp_id||e.cislo_lp===n.lp_cislo||e.kod===n.lp_cislo);return{id:"row_".concat(e,"_").concat(Date.now()),lp_cislo:n.lp_cislo||"",lp_id:n.lp_id||(t?t.id:null),castka:n.castka||0,poznamka:n.poznamka||"",lp_data:t||null}})),b.current=!0;else if(z&&1===w.length&&null!==e&&void 0!==e&&e.fa_castka){const n={id:"row_auto_".concat(Date.now()),lp_cislo:w[0].cislo_lp||w[0].kod,lp_id:w[0].id,castka:parseFloat(e.fa_castka),poznamka:"",lp_data:w[0]};d([n]),b.current=!0}else d([])}},[null===e||void 0===e?void 0:e.id,z,w]);const C=(0,g.useMemo)(()=>l.reduce((n,e)=>n+(parseFloat(e.castka)||0),0),[l]);(0,g.useEffect)(()=>{const n=[],t=parseFloat(null===e||void 0===e?void 0:e.fa_castka)||0,o=l.filter(n=>n.lp_id&&n.lp_cislo&&n.castka>0);z&&0===o.length&&n.push({type:"error",text:"\u26a0\ufe0f Objedn\xe1vka je financov\xe1na z LP. Mus\xedte p\u0159i\u0159adit alespo\u0148 jeden LP k\xf3d s \u010d\xe1stkou!",code:"MISSING_LP"});if(l.filter(n=>n.lp_id&&(!n.castka||n.castka<=0)||!n.lp_id&&n.castka>0).length>0&&n.push({type:"error",text:"\u274c V\u0161echny \u0159\xe1dky mus\xed m\xedt vypln\u011bn\xfd LP k\xf3d i \u010d\xe1stku",code:"INCOMPLETE_ROWS"}),C>t&&n.push({type:"error",text:"\u274c Sou\u010det LP \u010derp\xe1n\xed (".concat(mo(C)," K\u010d) p\u0159ekra\u010duje \u010d\xe1stku faktury (").concat(mo(t)," K\u010d)"),code:"EXCEEDS_LIMIT"}),C>0&&C<t&&n.push({type:"info",text:"\u2139\ufe0f P\u0159i\u0159adili jste ".concat(mo(C)," K\u010d z ").concat(mo(t)," K\u010d faktury. Rozd\u011blen\xed \u010d\xe1stky je na va\u0161\xed odpov\u011bdnosti."),code:"PARTIAL_ASSIGNMENT"}),C===t&&l.length>0&&n.push({type:"success",text:"\u2705 Cel\xe1 \u010d\xe1stka faktury byla p\u0159i\u0159azena na LP k\xf3dy.",code:"COMPLETE"}),p(n),A.current){const e=n.some(n=>"error"===n.type);A.current(e)}},[l,C,e,z]);const S=(0,g.useCallback)((n,e)=>{d(t=>t.map(t=>{if(t.id===n){const n=w.find(n=>n.id===e);return(0,et.A)((0,et.A)({},t),{},{lp_cislo:n?n.cislo_lp||n.kod:"",lp_id:e||null,lp_data:n||null})}return t}))},[w]),D=(0,g.useCallback)((n,e)=>{d(t=>t.map(t=>t.id===n?(0,et.A)((0,et.A)({},t),{},{castka:vo(e)}):t))},[]),P=(0,g.useCallback)(n=>{d(e=>{const t=e.filter(e=>e.id!==n);if(i){const n=t.filter(n=>n.lp_id&&n.lp_cislo&&n.castka>0);setTimeout(()=>i(n),0)}return t})},[i]),I=(0,g.useCallback)(()=>{const n={id:"row_".concat(Date.now()),lp_cislo:"",lp_id:null,castka:0,poznamka:""};d(e=>{const t=[...e,n];if(i){const n=t.filter(n=>n.lp_id&&n.lp_cislo&&n.castka>0);setTimeout(()=>i(n),0)}return t})},[i]),F=(0,g.useCallback)(()=>{if(i){const n=l.filter(n=>n.lp_id&&n.lp_cislo&&n.castka>0);i(n)}},[i,l]),E=(0,g.useCallback)(n=>{u(e=>(0,et.A)((0,et.A)({},e),{},{[n]:!e[n]}))},[]),T=(0,g.useCallback)((n,e,t)=>{if(!e)return n;const o=e.toLowerCase();return n.filter(n=>{const e=n.cislo_lp||n.kod||n.id||"",t=n.nazev_uctu||n.nazev||"";return e.toLowerCase().includes(o)||t.toLowerCase().includes(o)})},[]);return(0,v.jsxs)(eo,{children:[(0,v.jsxs)(to,{children:[(0,v.jsxs)(oo,{children:[(0,v.jsx)(Gt.g,{icon:Jt.iW_}),"LP \u010cerp\xe1n\xed na Faktu\u0159e"]}),(0,v.jsxs)(ao,{children:[(0,v.jsxs)(io,{children:[(0,v.jsx)("label",{children:"Faktura \u010d\xe1stka"}),(0,v.jsxs)("span",{children:[mo((null===e||void 0===e?void 0:e.fa_castka)||0)," K\u010d"]})]}),(0,v.jsxs)(io,{highlight:!0,children:[(0,v.jsx)("label",{children:"P\u0159i\u0159azeno celkem"}),(0,v.jsxs)("span",{children:[mo(C)," K\u010d"]})]}),(0,v.jsxs)(io,{children:[(0,v.jsx)("label",{children:"Zb\xfdv\xe1 p\u0159i\u0159adit"}),(0,v.jsxs)("span",{children:[mo(((null===e||void 0===e?void 0:e.fa_castka)||0)-C)," K\u010d"]})]})]})]}),1===w.length&&l.length>0&&(0,v.jsx)(xo,{children:"\u2139\ufe0f Objedn\xe1vka pou\u017e\xedv\xe1 pouze jeden LP k\xf3d, \u010d\xe1stka byla automaticky p\u0159edvypln\u011bna. M\u016f\u017eete ji upravit podle pot\u0159eby."}),l.map((n,e)=>(0,v.jsxs)(ro,{children:[(0,v.jsxs)(so,{children:[(0,v.jsxs)("label",{children:["LP k\xf3d\xa0",(0,v.jsx)("span",{style:{color:"#dc2626"},children:"*"})]}),(0,v.jsx)(no.A,{"data-component":"CustomSelect",value:n.lp_id||"",onChange:e=>{var t;const o=(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value)||e;S(n.id,o)},onBlur:F,options:j,placeholder:"-- Vyberte LP k\xf3d --",field:"lp_kod_".concat(n.id),icon:(0,v.jsx)(Qt.A,{}),disabled:s,hasError:!n.lp_id,required:!0,multiple:!1,selectStates:f,setSelectStates:u,searchStates:h,setSearchStates:x,touchedSelectFields:m,setTouchedSelectFields:y,hasTriedToSubmit:!1,toggleSelect:E,filterOptions:T,getOptionLabel:n=>(null===n||void 0===n?void 0:n.label)||"".concat((null===n||void 0===n?void 0:n.cislo_lp)||(null===n||void 0===n?void 0:n.kod)||(null===n||void 0===n?void 0:n.id)," - ").concat((null===n||void 0===n?void 0:n.nazev_uctu)||(null===n||void 0===n?void 0:n.nazev)||"Bez n\xe1zvu")})]}),(0,v.jsxs)(so,{children:[(0,v.jsxs)("label",{children:["\u010c\xe1stka (K\u010d)\xa0",(0,v.jsx)("span",{style:{color:"#dc2626"},children:"*"})]}),(0,v.jsx)(yo,{value:n.castka||"",onChange:e=>D(n.id,e),onBlur:F,hasError:!n.castka||n.castka<=0,disabled:s,required:!0})]}),(0,v.jsx)(fo,{children:(0,v.jsx)(uo,{type:"button",variant:"danger",onClick:()=>P(n.id),disabled:s||1===l.length,title:"Odebrat \u0159\xe1dek",children:(0,v.jsx)($t.A,{size:16})})})]},n.id)),w.length>l.length&&(0,v.jsxs)(go,{type:"button",onClick:I,disabled:s,children:[(0,v.jsx)(Gt.g,{icon:Jt.QLR})," P\u0159idat dal\u0161\xed LP k\xf3d"]}),c.map((n,e)=>(0,v.jsxs)(ho,{type:n.type,children:[(0,v.jsx)(Gt.g,{icon:"error"===n.type?Jt.zpE:"success"===n.type?Jt.SGM:Jt.iW_}),(0,v.jsx)("span",{children:n.text})]},e))]})}const ko=g.memo(bo)}}]);
//# sourceMappingURL=692.292f07b4.chunk.js.map