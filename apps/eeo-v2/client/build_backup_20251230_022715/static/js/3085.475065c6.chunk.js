/*! For license information please see 3085.475065c6.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkr_app_zzs_eeo=self.webpackChunkr_app_zzs_eeo||[]).push([[3085],{7118:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},14459:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},28006:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},32986:(e,n,a)=>{a.r(n),a.d(n,{default:()=>Oc});var o=a(53986),t=a(89379),i=a(57528),r=a(65043),s=a(97950),d=a(91357),l=a(45903),c=a(83290),p=a(83910),u=a(97929),v=a(87260),_=a(28646),m=a(77819),f=a(76833),h=a(37719),k=a(57856),g=a(39292),b=a(65727),y=a(77784);const x=(0,y.A)("lock-open",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);var j=a(14459),z=a(35327),A=a(91286),w=a(40614),S=a(41680),E=a(7118),C=a(95264),N=a(99432),O=a(56804),D=a(28006),T=a(81990);const I=(0,y.A)("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);var P=a(84808),L=a(71360);const R=(0,y.A)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var V,F,M,U,Z,B,K,H,W,$,J,G,q,Y,X,Q,ee,ne,ae,oe,te,ie,re,se,de,le,ce=a(35087),pe=a(82054),ue=(a(63974),a(70692)),ve=a(51833),_e=a(27837),me=a(75949),fe=a(70579);const he=l.A.div(V||(V=(0,i.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n"]))),ke=l.A.div(F||(F=(0,i.A)(["\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 700px;\n  max-height: 90vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp 0.3s ease-out;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n"]))),ge=l.A.div(M||(M=(0,i.A)(["\n  padding: 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n"]))),be=l.A.h2(U||(U=(0,i.A)(["\n  margin: 0;\n  font-size: 20px;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n\n  svg {\n    font-size: 24px;\n  }\n"]))),ye=l.A.button(Z||(Z=(0,i.A)(["\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n"]))),xe=l.A.div(B||(B=(0,i.A)(["\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n"]))),je=l.A.div(K||(K=(0,i.A)(["\n  background: ",";\n  border: 1px solid ",";\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 20px;\n  display: flex;\n  align-items: flex-start;\n  gap: 12px;\n\n  svg {\n    font-size: 20px;\n    margin-top: 2px;\n    color: ",";\n  }\n"])),e=>"update"===e.type?"#fff4e6":"exists-own"===e.type?"#e6f7ff":"exists-global"===e.type?"#fff0f6":"#f0f9ff",e=>"update"===e.type?"#ffd591":"exists-own"===e.type?"#91d5ff":"exists-global"===e.type?"#ffadd2":"#bae7ff",e=>"update"===e.type?"#fa8c16":"exists-own"===e.type?"#1890ff":"exists-global"===e.type?"#eb2f96":"#1890ff"),ze=l.A.div(H||(H=(0,i.A)(["\n  flex: 1;\n\n  strong {\n    display: block;\n    margin-bottom: 4px;\n    font-size: 14px;\n    color: #262626;\n  }\n\n  p {\n    margin: 0;\n    font-size: 13px;\n    color: #595959;\n    line-height: 1.5;\n  }\n"]))),Ae=l.A.div(W||(W=(0,i.A)(["\n  margin-bottom: 20px;\n"]))),we=l.A.h3($||($=(0,i.A)(["\n  font-size: 14px;\n  font-weight: 600;\n  color: #262626;\n  margin: 0 0 12px 0;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n"]))),Se=l.A.div(J||(J=(0,i.A)(["\n  display: grid;\n  grid-template-columns: ",";\n  gap: 16px;\n  margin-bottom: 16px;\n"])),e=>e.columns||"1fr"),Ee=l.A.div(G||(G=(0,i.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n"]))),Ce=l.A.label(q||(q=(0,i.A)(["\n  font-size: 13px;\n  font-weight: 500;\n  color: #595959;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n\n  ","\n"])),e=>e.required&&"\n    &:after {\n      content: '*';\n      color: #ff4d4f;\n      margin-left: 2px;\n    }\n  "),Ne=l.A.div(Y||(Y=(0,i.A)(["\n  position: relative;\n  display: flex;\n  align-items: center;\n\n  svg {\n    position: absolute;\n    left: 12px;\n    width: 16px;\n    height: 16px;\n    color: #8c8c8c;\n    pointer-events: none;\n  }\n"]))),Oe=l.A.input(X||(X=(0,i.A)(["\n  width: 100%;\n  padding: 10px 12px 10px ",";\n  border: 1px solid ",";\n  border-radius: 6px;\n  font-size: 14px;\n  transition: all 0.2s;\n  background: ",";\n  color: ",";\n\n  &:focus {\n    outline: none;\n    border-color: ",";\n    box-shadow: 0 0 0 2px ",";\n  }\n\n  &:disabled {\n    cursor: not-allowed;\n  }\n"])),e=>e.hasIcon?"38px":"12px",e=>e.hasError?"#ff4d4f":"#d9d9d9",e=>e.disabled?"#f5f5f5":"white",e=>e.disabled?"#8c8c8c":"#262626",e=>e.hasError?"#ff4d4f":"#40a9ff",e=>e.hasError?"rgba(255,77,79,0.1)":"rgba(24,144,255,0.1)"),De=l.A.div(Q||(Q=(0,i.A)(["\n  display: grid;\n  grid-template-columns: repeat(",", 1fr);\n  gap: 8px;\n  margin-top: 8px;\n"])),e=>e.optionsCount),Te=l.A.button(ee||(ee=(0,i.A)(["\n  padding: 12px;\n  border: 2px solid ",";\n  border-radius: 8px;\n  background: ",";\n  color: ",";\n  cursor: ",";\n  opacity: ",";\n  transition: all 0.2s;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 6px;\n  font-size: 13px;\n  font-weight: 500;\n  position: relative;\n\n  &:hover:not(:disabled) {\n    border-color: #667eea;\n    background: ",";\n  }\n\n  svg {\n    font-size: 18px;\n  }\n"])),e=>e.selected?"#667eea":"#e5e7eb",e=>e.selected?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"white",e=>e.selected?"white":"#595959",e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?.5:1,e=>e.selected?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"#f9fafb"),Ie=l.A.div(ne||(ne=(0,i.A)(["\n  position: absolute;\n  top: 6px;\n  right: 6px;\n  background: ",";\n  color: white;\n  width: 20px;\n  height: 20px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 11px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\n  svg {\n    font-size: 11px;\n  }\n"])),e=>"global"===e.scope?"#10b981":"usek"===e.scope?"#3b82f6":"#06b6d4"),Pe=l.A.div(ae||(ae=(0,i.A)(["\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));\n  gap: 8px;\n  margin-top: 12px;\n"]))),Le=l.A.label(oe||(oe=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  padding: 8px 10px;\n  border: 2px solid ",";\n  border-radius: 6px;\n  background: ",";\n  cursor: ",";\n  opacity: ",";\n  transition: all 0.2s;\n  font-size: 13px;\n  font-weight: 600;\n  color: ",';\n\n  &:hover:not([disabled]) {\n    border-color: #667eea;\n    background: rgba(102, 126, 234, 0.05);\n  }\n\n  input[type="checkbox"] {\n    width: 16px;\n    height: 16px;\n    cursor: ',";\n  }\n"])),e=>e.selected?"#667eea":"#e5e7eb",e=>e.selected?"rgba(102, 126, 234, 0.05)":"white",e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?.5:1,e=>e.selected?"#667eea":"#374151",e=>e.disabled?"not-allowed":"pointer"),Re=(l.A.div(te||(te=(0,i.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n  flex: 1;\n"]))),l.A.span(ie||(ie=(0,i.A)(["\n  font-weight: 600;\n  color: #667eea;\n"])))),Ve=(l.A.span(re||(re=(0,i.A)(["\n  font-size: 11px;\n  color: #6b7280;\n"]))),l.A.span(se||(se=(0,i.A)(["\n  color: #ff4d4f;\n  font-size: 12px;\n  margin-top: 4px;\n"])))),Fe=l.A.div(de||(de=(0,i.A)(["\n  padding: 16px 24px;\n  border-top: 1px solid #e5e7eb;\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  background: #fafafa;\n"]))),Me=l.A.button(le||(le=(0,i.A)(["\n  padding: 10px 20px;\n  border: none;\n  border-radius: 6px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  ","\n\n  ","\n"])),e=>"primary"===e.variant&&"\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n\n    &:hover:not(:disabled) {\n      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n      transform: translateY(-1px);\n    }\n\n    &:disabled {\n      opacity: 0.6;\n      cursor: not-allowed;\n    }\n  ",e=>"secondary"===e.variant&&"\n    background: white;\n    color: #595959;\n    border: 1px solid #d9d9d9;\n\n    &:hover:not(:disabled) {\n      border-color: #40a9ff;\n      color: #40a9ff;\n    }\n  "),Ue=e=>{let{isOpen:n,onClose:a,onSave:o,supplierData:i,existsInPersonal:s=null,existsInUsek:d=null,existsInGlobal:l=null,userPermissions:c={canAddPersonal:!0,canAddUsek:!1,canAddGlobal:!1}}=e;const{token:v,username:_,userDetail:m}=(0,r.useContext)(_e.cy),[f,h]=(0,r.useState)({}),[k,g]=(0,r.useState)("personal"),[b,y]=(0,r.useState)([]),[x,w]=(0,r.useState)([]),[S,E]=(0,r.useState)(!1),[N,T]=(0,r.useState)(!1),[I,P]=(0,r.useState)({});(0,r.useEffect)(()=>{n&&i&&(h({nazev:i.dodavatel_nazev||"",adresa:i.dodavatel_adresa||"",ico:i.dodavatel_ico||"",dic:i.dodavatel_dic||"",zastoupeny:i.dodavatel_zastoupeny||"",kontakt_jmeno:i.dodavatel_kontakt_jmeno||"",kontakt_email:i.dodavatel_kontakt_email||"",kontakt_telefon:i.dodavatel_kontakt_telefon||""}),s?g("personal"):d?g("usek"):l&&c.canAddGlobal?g("global"):g("personal"),P({}))},[n,i,s,d,l,c.canAddGlobal]),(0,r.useEffect)(()=>{(async()=>{if(n&&c.canAddUsek)try{E(!0);const e=await(0,me.nw)({token:v,username:_});w(e||[])}catch(e){}finally{E(!1)}})()},[n,c.canAddUsek,v,_]),(0,r.useEffect)(()=>{if(n)if(d&&d.usek_zkr)try{const e="string"===typeof d.usek_zkr?JSON.parse(d.usek_zkr):d.usek_zkr;Array.isArray(e)&&y(e)}catch(e){}else y([])},[n,d]);const L=(e,n)=>{h(a=>(0,t.A)((0,t.A)({},a),{},{[e]:n})),I[e]&&P(n=>{const a=(0,t.A)({},n);return delete a[e],a})},R=e=>{y(n=>n.includes(e)?n.filter(n=>n!==e):[...n,e])};if(!n)return null;const V=s||d||l?"exists":"add",F="personal"===k&&s||"usek"===k&&d||"global"===k&&l;return(0,fe.jsx)(he,{children:(0,fe.jsxs)(ke,{onClick:e=>e.stopPropagation(),children:[(0,fe.jsxs)(ge,{children:[(0,fe.jsxs)(be,{children:[(0,fe.jsx)(p.g,{icon:u.URI}),F?"Aktualizovat dodavatele":"P\u0159idat dodavatele do adres\xe1\u0159e"]}),(0,fe.jsx)(ye,{onClick:a,children:(0,fe.jsx)(p.g,{icon:u.GRI})})]}),(0,fe.jsxs)(xe,{children:["add"===V&&(0,fe.jsxs)(je,{type:"add",children:[(0,fe.jsx)(p.g,{icon:u.URI}),(0,fe.jsxs)(ze,{children:[(0,fe.jsx)("strong",{children:"Nov\xfd dodavatel"}),(0,fe.jsx)("p",{children:"Dodavatel s t\xedmto I\u010cO nebyl nalezen v datab\xe1zi. M\u016f\u017eete ho p\u0159idat."})]})]}),"exists"===V&&(0,fe.jsxs)(je,{type:"exists-own",children:[(0,fe.jsx)(p.g,{icon:u.SGM}),(0,fe.jsxs)(ze,{children:[(0,fe.jsx)("strong",{children:"Dodavatel ji\u017e existuje v adres\xe1\u0159i"}),(0,fe.jsxs)("p",{children:["Fajfky u scope ozna\u010duj\xed, kde je dodavatel ji\u017e ulo\u017een.",s&&" M\xe1te ho ve sv\xe9m osobn\xedm adres\xe1\u0159i.",d&&" Existuje v \xfasekov\xe9m adres\xe1\u0159i.",l&&" Existuje v glob\xe1ln\xedm adres\xe1\u0159i."]})]})]}),(0,fe.jsxs)(Ae,{children:[(0,fe.jsx)(we,{children:"Rozsah ulo\u017een\xed"}),(0,fe.jsxs)(De,{optionsCount:3,children:[(0,fe.jsxs)(Te,{selected:"personal"===k,onClick:()=>c.canAddPersonal&&g("personal"),disabled:!c.canAddPersonal,children:[s&&(0,fe.jsx)(Ie,{scope:"personal",title:"Kontakt ji\u017e existuje v osobn\xedm adres\xe1\u0159i",children:(0,fe.jsx)(p.g,{icon:u.SGM})}),(0,fe.jsx)(p.g,{icon:u.X46}),(0,fe.jsx)("span",{children:"Osobn\xed"})]}),(0,fe.jsxs)(Te,{selected:"usek"===k,onClick:()=>c.canAddUsek&&g("usek"),disabled:!c.canAddUsek,children:[d&&(0,fe.jsx)(Ie,{scope:"usek",title:"Kontakt ji\u017e existuje v adres\xe1\u0159i \xfaseku",children:(0,fe.jsx)(p.g,{icon:u.SGM})}),(0,fe.jsx)(p.g,{icon:u.URI}),(0,fe.jsx)("span",{children:"\xdasek"})]}),(0,fe.jsxs)(Te,{selected:"global"===k,onClick:()=>c.canAddGlobal&&g("global"),disabled:!c.canAddGlobal,children:[l&&(0,fe.jsx)(Ie,{scope:"global",title:"Kontakt ji\u017e existuje v glob\xe1ln\xedm adres\xe1\u0159i",children:(0,fe.jsx)(p.g,{icon:u.SGM})}),(0,fe.jsx)(p.g,{icon:u.Bwz}),(0,fe.jsx)("span",{children:"Glob\xe1ln\xed"})]})]})]}),"usek"===k&&(0,fe.jsxs)(Ae,{children:[(0,fe.jsx)(we,{children:"V\xfdb\u011br \xfasek\u016f"}),S?(0,fe.jsx)("div",{style:{padding:"1rem",textAlign:"center",color:"#6b7280"},children:"Na\u010d\xedt\xe1m \xfaseky..."}):0===x.length?(0,fe.jsx)("div",{style:{padding:"1rem",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",color:"#dc2626"},children:"\u274c \u017d\xe1dn\xe9 \xfaseky nebyly na\u010dteny"}):(0,fe.jsx)(Pe,{children:(c.canAddGlobal?x:x.filter(e=>(Array.isArray(null===m||void 0===m?void 0:m.usek_zkr)?m.usek_zkr:[null===m||void 0===m?void 0:m.usek_zkr]).includes(e.usek_zkr))).map(e=>(0,fe.jsxs)(Le,{selected:b.includes(e.usek_zkr),disabled:!c.canAddGlobal&&!(Array.isArray(null===m||void 0===m?void 0:m.usek_zkr)?m.usek_zkr:[null===m||void 0===m?void 0:m.usek_zkr]).includes(e.usek_zkr),onClick:()=>{const n=Array.isArray(null===m||void 0===m?void 0:m.usek_zkr)?m.usek_zkr:[null===m||void 0===m?void 0:m.usek_zkr];(c.canAddGlobal||n.includes(e.usek_zkr))&&R(e.usek_zkr)},children:[(0,fe.jsx)("input",{type:"checkbox",checked:b.includes(e.usek_zkr),onChange:()=>R(e.usek_zkr),disabled:!c.canAddGlobal&&!(Array.isArray(null===m||void 0===m?void 0:m.usek_zkr)?m.usek_zkr:[null===m||void 0===m?void 0:m.usek_zkr]).includes(e.usek_zkr)}),(0,fe.jsx)(Re,{children:e.usek_zkr})]},e.usek_zkr))}),0===b.length&&!S&&(0,fe.jsx)("div",{style:{marginTop:"8px",padding:"8px",background:"#e0f2fe",border:"1px solid #0ea5e9",borderRadius:"6px",fontSize:"12px",color:"#0c4a6e"},children:"\u2139\ufe0f Pokud nevyberete \u017e\xe1dn\xfd \xfasek, kontakt se ulo\u017e\xed jako osobn\xed"})]}),(0,fe.jsxs)(Ae,{children:[(0,fe.jsx)(we,{children:"Z\xe1kladn\xed \xfadaje"}),(0,fe.jsx)(Se,{columns:"1fr",children:(0,fe.jsxs)(Ee,{children:[(0,fe.jsx)(Ce,{required:!0,children:"N\xe1zev spole\u010dnosti"}),(0,fe.jsxs)(Ne,{children:[(0,fe.jsx)(C.A,{}),(0,fe.jsx)(Oe,{type:"text",value:f.nazev||"",onChange:e=>L("nazev",e.target.value),hasError:!!I.nazev,hasIcon:!0,placeholder:"N\xe1zev dodavatele"})]}),I.nazev&&(0,fe.jsx)(Ve,{children:I.nazev})]})}),(0,fe.jsxs)(Se,{columns:"2fr 1fr 1fr",children:[(0,fe.jsxs)(Ee,{children:[(0,fe.jsx)(Ce,{required:!0,children:"Adresa"}),(0,fe.jsxs)(Ne,{children:[(0,fe.jsx)(D.A,{}),(0,fe.jsx)(Oe,{type:"text",value:f.adresa||"",onChange:e=>L("adresa",e.target.value),hasError:!!I.adresa,hasIcon:!0,placeholder:"Adresa s\xeddla"})]}),I.adresa&&(0,fe.jsx)(Ve,{children:I.adresa})]}),(0,fe.jsxs)(Ee,{children:[(0,fe.jsx)(Ce,{required:!0,children:"I\u010cO"}),(0,fe.jsxs)(Ne,{children:[(0,fe.jsx)(O.A,{}),(0,fe.jsx)(Oe,{type:"text",value:f.ico||"",onChange:e=>L("ico",e.target.value),hasError:!!I.ico,hasIcon:!0,placeholder:"12345678",maxLength:8})]}),I.ico&&(0,fe.jsx)(Ve,{children:I.ico})]}),(0,fe.jsxs)(Ee,{children:[(0,fe.jsx)(Ce,{children:"DI\u010c"}),(0,fe.jsxs)(Ne,{children:[(0,fe.jsx)(O.A,{}),(0,fe.jsx)(Oe,{type:"text",value:f.dic||"",onChange:e=>L("dic",e.target.value),hasIcon:!0,placeholder:"CZ12345678"})]})]})]}),(0,fe.jsx)(Se,{columns:"1fr",children:(0,fe.jsxs)(Ee,{children:[(0,fe.jsx)(Ce,{children:"Zastoupen(a)"}),(0,fe.jsxs)(Ne,{children:[(0,fe.jsx)(j.A,{}),(0,fe.jsx)(Oe,{type:"text",value:f.zastoupeny||"",onChange:e=>L("zastoupeny",e.target.value),hasIcon:!0,placeholder:"Jm\xe9no jednaj\xedc\xedho"})]})]})})]}),(0,fe.jsxs)(Ae,{children:[(0,fe.jsx)(we,{children:"Kontaktn\xed osoba"}),(0,fe.jsx)(Se,{columns:"1fr",children:(0,fe.jsxs)(Ee,{children:[(0,fe.jsx)(Ce,{children:"Jm\xe9no kontaktn\xed osoby"}),(0,fe.jsxs)(Ne,{children:[(0,fe.jsx)(j.A,{}),(0,fe.jsx)(Oe,{type:"text",value:f.kontakt_jmeno||"",onChange:e=>L("kontakt_jmeno",e.target.value),hasIcon:!0,placeholder:"Jm\xe9no a p\u0159\xedjmen\xed"})]})]})}),(0,fe.jsxs)(Se,{columns:"1fr 1fr",children:[(0,fe.jsxs)(Ee,{children:[(0,fe.jsx)(Ce,{children:"Email"}),(0,fe.jsxs)(Ne,{children:[(0,fe.jsx)(z.A,{}),(0,fe.jsx)(Oe,{type:"email",value:f.kontakt_email||"",onChange:e=>L("kontakt_email",e.target.value),hasError:!!I.kontakt_email,hasIcon:!0,placeholder:"email@example.com"})]}),I.kontakt_email&&(0,fe.jsx)(Ve,{children:I.kontakt_email})]}),(0,fe.jsxs)(Ee,{children:[(0,fe.jsx)(Ce,{children:"Telefon"}),(0,fe.jsxs)(Ne,{children:[(0,fe.jsx)(A.A,{}),(0,fe.jsx)(Oe,{type:"tel",value:f.kontakt_telefon||"",onChange:e=>L("kontakt_telefon",e.target.value),hasIcon:!0,placeholder:"+420 123 456 789"})]})]})]})]}),I.general&&(0,fe.jsx)(Ve,{style:{display:"block",marginTop:"16px",fontSize:"14px"},children:I.general})]}),(0,fe.jsxs)(Fe,{children:[(0,fe.jsxs)(Me,{variant:"secondary",onClick:a,disabled:N,children:[(0,fe.jsx)(p.g,{icon:u.GRI}),"Zru\u0161it"]}),(0,fe.jsxs)(Me,{variant:"primary",onClick:async()=>{if(!(()=>{var e,n;const a={};return null!==(e=f.nazev)&&void 0!==e&&e.trim()||(a.nazev="N\xe1zev je povinn\xfd"),null!==(n=f.ico)&&void 0!==n&&n.trim()?/^\d{8}$/.test(f.ico.trim())||(a.ico="I\u010cO mus\xed m\xedt 8 \u010d\xedslic"):a.ico="I\u010cO je povinn\xe9",f.kontakt_email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f.kontakt_email)&&(a.kontakt_email="Neplatn\xfd email"),P(a),0===Object.keys(a).length})())return;let e=k,n=null;"usek"===k?0===b.length?(e="personal",n=null):n=b:"global"===k&&(n=null),T(!0);try{await o(f,e,n),a()}catch(t){P({general:t.message||"Chyba p\u0159i ukl\xe1d\xe1n\xed dodavatele"})}finally{T(!1)}},disabled:N,children:[(0,fe.jsx)(p.g,{icon:u.e68}),(()=>{if(N)return"Ukl\xe1d\xe1m...";return"personal"===k&&s||"usek"===k&&d||"global"===k&&l?"Aktualizovat":"P\u0159idat dodavatele"})()]})]})]})})};var Ze=a(200);const Be=(0,y.A)("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]),Ke=(0,y.A)("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),He=(0,y.A)("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]),We=(0,y.A)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),$e=(0,y.A)("file-down",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);var Je=a(92382);const Ge=(0,y.A)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),qe=(0,y.A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Ye=(0,y.A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var Xe,Qe,en,nn,an,on,tn,rn,sn,dn,ln,cn,pn,un,vn,_n,mn,fn,hn,kn=a(50516);const gn=l.A.div(Xe||(Xe=(0,i.A)(["\n  position: absolute;\n  top: calc(100% + 3px);\n  left: ",";\n  right: ",";\n  z-index: 999999;\n  width: 450px;\n  background-color: white;\n  border: 2px solid #10b981;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  max-height: 500px;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n"])),e=>e.$left||"0",e=>e.$right||"auto"),bn=l.A.div(Qe||(Qe=(0,i.A)(["\n  padding: 0.5rem 0.75rem;\n  font-weight: 700;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n  border-bottom: 1px solid #e5e7eb;\n"]))),yn=l.A.span(en||(en=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n"]))),xn=l.A.span(nn||(nn=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n"]))),jn=l.A.button(an||(an=(0,i.A)(["\n  background: none;\n  border: none;\n  padding: 0;\n  cursor: ",";\n  color: ",";\n  \n  &:hover:not(:disabled) {\n    opacity: 0.7;\n  }\n"])),e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?"#9ca3af":e.$color||"#374151"),zn=l.A.div(on||(on=(0,i.A)(["\n  position: relative;\n  padding: 0 0.75rem 0.5rem;\n"]))),An=l.A.div(tn||(tn=(0,i.A)(["\n  position: absolute;\n  left: 1.5rem;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #9ca3af;\n  pointer-events: none;\n"]))),wn=l.A.input(rn||(rn=(0,i.A)(["\n  width: 100%;\n  padding: 0.5rem 2.5rem 0.5rem 2.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  outline: none;\n  \n  &:focus {\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n"]))),Sn=l.A.button(sn||(sn=(0,i.A)(["\n  position: absolute;\n  right: 1.5rem;\n  top: 50%;\n  transform: translateY(-50%);\n  background: none;\n  border: none;\n  padding: 0;\n  cursor: pointer;\n  color: #6b7280;\n  \n  &:hover {\n    color: #374151;\n  }\n"]))),En=l.A.div(dn||(dn=(0,i.A)(["\n  max-height: 14rem;\n  overflow-y: auto;\n  \n  &::-webkit-scrollbar {\n    width: 6px;\n  }\n  \n  &::-webkit-scrollbar-track {\n    background: #f3f4f6;\n  }\n  \n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 3px;\n    \n    &:hover {\n      background: #9ca3af;\n    }\n  }\n"]))),Cn=l.A.div(ln||(ln=(0,i.A)(["\n  padding: 0.5rem 0.75rem;\n  display: flex;\n  justify-content: space-between;\n  gap: 0.5rem;\n  align-items: flex-start;\n  transition: background-color 0.15s ease, border-left 0.15s ease;\n  cursor: pointer;\n  border-left: 3px solid transparent;\n  \n  &:hover {\n    background-color: ",";\n    border-left-color: ",";\n  }\n  \n  &:not(:last-child) {\n    border-bottom: 0.5px solid #f3f4f6;\n  }\n"])),e=>"user"===e.$type?"#f0fdf4":"#f8fafc",e=>"user"===e.$type?"#22c55e":"#3b82f6"),Nn=l.A.div(cn||(cn=(0,i.A)(["\n  flex: 1;\n  min-width: 0;\n"]))),On=l.A.div(pn||(pn=(0,i.A)(["\n  font-weight: 600;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n"]))),Dn=l.A.div(un||(un=(0,i.A)(["\n  margin-top: 3px;\n  color: #1e40af;\n  font-size: 0.7rem;\n  background: #dbeafe;\n  padding: 0.1rem 0.4rem;\n  border-radius: 0.25rem;\n  display: inline-block;\n"]))),Tn=l.A.div(vn||(vn=(0,i.A)(["\n  display: flex;\n  gap: 0.25rem;\n  align-items: center;\n"]))),In=l.A.button(_n||(_n=(0,i.A)(["\n  background: none;\n  border: none;\n  color: ",";\n  padding: 0.125rem;\n  cursor: pointer;\n  \n  &:hover {\n    opacity: 0.7;\n  }\n"])),e=>e.$color||"#6b7280"),Pn=l.A.button(mn||(mn=(0,i.A)(["\n  font-size: 0.75rem;\n  padding: 0.25rem 0.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 0.25rem;\n  background: ",";\n  color: ",";\n  cursor: ",";\n  pointer-events: ",";\n  opacity: ",";\n  \n  &:hover:not(:disabled) {\n    background: #dbeafe;\n  }\n"])),e=>e.disabled?"#f3f4f6":"#eff6ff",e=>e.disabled?"#9ca3af":"#1e3a8a",e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?"none":"auto",e=>e.disabled?.6:1),Ln=l.A.div(fn||(fn=(0,i.A)(["\n  padding: 0.5rem 0.75rem;\n  color: ",";\n  ","\n"])),e=>e.$muted?"#9ca3af":"#6b7280",e=>e.$italic&&"font-style: italic;"),Rn=l.A.hr(hn||(hn=(0,i.A)(["\n  margin: 0.5rem 0;\n  border-color: #d1d5db;\n  border-width: 2px;\n  border-style: double;\n"]))),Vn=e=>{let{show:n,serverTemplates:a=[],savedTemplates:o=[],templatesLoading:t=!1,searchQuery:i="",showSearch:s=!1,currentPhase:d=1,isArchived:l=!1,token:c=null,hasPermission:v,onSearch:_,onToggleSearch:m,onRefresh:f,onFillPo:h,onFillDetails:k,canFillTemplate:b=!0,onCopyToUser:y,onCopyToGlobal:x,onShowPreview:j,onDelete:z,onEditName:A,editingTemplateId:S=null,editingTemplateName:E="",matchesQuery:C}=e;const N=(0,r.useRef)(null),O=(0,r.useRef)(null),[D,T]=(0,r.useState)({left:"0",right:"auto"});if((0,r.useEffect)(()=>{if(n&&O.current){const e=O.current.getBoundingClientRect(),n=window.innerWidth;e.right>n?T({left:"auto",right:"0"}):(e.left<0||e.left>=0&&e.right<=n)&&T({left:"0",right:"auto"})}},[n]),(0,r.useEffect)(()=>{s&&N.current&&setTimeout(()=>{var e;return null===(e=N.current)||void 0===e?void 0:e.focus()},50)},[s]),!n)return null;const I=Array.isArray(a)?a:[],R=Array.isArray(o)?o:[],V=I.filter(e=>e&&(0===e.user_id||"0"===String(e.user_id))).filter(e=>C(e,i)),F=R.filter(e=>C(e,i));return(0,fe.jsxs)(gn,{ref:O,$left:D.left,$right:D.right,children:[(0,fe.jsxs)(bn,{children:[(0,fe.jsxs)(yn,{children:[(0,fe.jsx)(p.g,{icon:u.hem,style:{color:"#3b82f6",fontSize:"14px"}}),(0,fe.jsx)("span",{children:"P\u0159eddefinovan\xe9 \u0161ablony"})]}),(0,fe.jsxs)(xn,{children:[(0,fe.jsx)(jn,{onClick:e=>{e.stopPropagation(),f()},title:"Aktualizovat \u0161ablony z DB",disabled:!c||t,$color:"#10b981",children:(0,fe.jsx)(kn.A,{size:16})}),(0,fe.jsx)(jn,{onClick:m,title:s?"Skr\xfdt hled\xe1n\xed":"Hledat",children:(0,fe.jsx)(g.A,{size:16})})]})]}),s&&(0,fe.jsxs)(zn,{children:[(0,fe.jsx)(An,{children:(0,fe.jsx)(g.A,{size:16})}),(0,fe.jsx)(wn,{ref:N,type:"text",value:i,onChange:e=>_(e.target.value),placeholder:"Hledat v \u0161ablon\xe1ch..."}),i&&(0,fe.jsx)(Sn,{onClick:()=>_(""),title:"Vymazat vyhled\xe1v\xe1n\xed",children:(0,fe.jsx)(w.A,{size:14})})]}),(0,fe.jsxs)(En,{children:[V.map((e,n)=>{var a;const o=e.data||{},t=(e.type||"").toString().toUpperCase(),i=t.includes("PO")||"OBEJD"===t||"MIXED"===t,r=t.includes("DET")||"OBEJD"===t||"MIXED"===t,s=e.name||e.dbName||(null===(a=o.poApproval)||void 0===a?void 0:a.predmet)||"\u0160ablona ".concat(e.id||"?"),c="OBEJD"===t||i&&r?"PO+Detaily":r?"Detaily":"PO";return(0,fe.jsxs)(Cn,{$type:"server",children:[(0,fe.jsxs)(Nn,{children:[(0,fe.jsxs)(On,{children:[s,(null===v||void 0===v?void 0:v("TEMPLATE_MANAGE"))&&(0,fe.jsx)(In,{onClick:n=>{n.stopPropagation(),A(e)},title:"P\u0159ejmenovat \u0161ablonu",children:(0,fe.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,fe.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,fe.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})]}),(0,fe.jsx)(Dn,{children:c})]}),(0,fe.jsxs)(Tn,{children:[(0,fe.jsx)(In,{onClick:()=>y(e),title:"Kop\xedrovat do m\xfdch \u0161ablon",$color:"#065f46",children:(0,fe.jsx)(L.A,{size:16})}),(0,fe.jsx)(In,{onClick:()=>j(e,e.data),title:"Detailn\xed n\xe1hled \u0161ablony",children:(0,fe.jsx)(ce.A,{size:16})}),(null===v||void 0===v?void 0:v("TEMPLATE_MANAGE"))&&(0,fe.jsx)(In,{onClick:()=>z(e),title:"Smazat",$color:"#dc2626",children:(0,fe.jsx)(P.A,{size:16})})]}),(0,fe.jsxs)("div",{style:{display:"flex",gap:"0.25rem"},children:[(0,fe.jsx)(Pn,{onClick:()=>h(e),disabled:!b||!l&&d>=2||!i,title:b?!l&&d>=2?"Nelze vlo\u017eit PO po schv\xe1len\xed":i?"Na\u010d\xedst PO":"Tato \u0161ablona neobsahuje PO":"Vypl\u0148ov\xe1n\xed nelze - objedn\xe1vka je dokon\u010dena nebo m\xe1 neulo\u017een\xe9 zm\u011bny",children:"PO"}),(0,fe.jsx)(Pn,{onClick:()=>k(e),disabled:!b||!l&&d<3||!r,title:b?!l&&d<3?"Detaily se na\u010d\xedtaj\xed a\u017e ve f\xe1zi 3 (po schv\xe1len\xed)":r?"Na\u010d\xedst detaily":"Tato \u0161ablona neobsahuje Detaily":"Vypl\u0148ov\xe1n\xed nelze - objedn\xe1vka je dokon\u010dena nebo m\xe1 neulo\u017een\xe9 zm\u011bny",children:"Detaily"})]})]},"predef-".concat(e.id,"-").concat(e.ts,"-").concat(n))}),i.trim()&&0===V.length&&(0,fe.jsx)(Ln,{$muted:!0,children:"Nenalezeno"})]}),(0,fe.jsx)(Rn,{}),(0,fe.jsx)(bn,{children:(0,fe.jsxs)(yn,{children:[(0,fe.jsx)(p.g,{icon:u.X46,style:{color:"#22c55e",fontSize:"14px"}}),(0,fe.jsx)("span",{children:"Moje \u0161ablony"})]})}),0===R.length&&(0,fe.jsx)(Ln,{children:"\u017d\xe1dn\xe9 \u0161ablony"}),(0,fe.jsxs)(En,{children:[F.map((e,n)=>{var a,o;const t=(e.type||"").toString().toUpperCase(),i="PO"===t||"OBEJD"===t||"MIXED"===t||!(null===e||void 0===e||null===(a=e.data)||void 0===a||!a.poApproval),r="DETAIL"===t||"OBEJD"===t||"MIXED"===t||!(null===e||void 0===e||null===(o=e.data)||void 0===o||!o.orderDetails),s="OBEJD"===t||i&&r?"PO+Detaily":r?"Detaily":"PO";return(0,fe.jsxs)(Cn,{$type:"user",children:[(0,fe.jsxs)(Nn,{children:[(0,fe.jsxs)(On,{children:[e.name,(0,fe.jsx)(In,{onClick:n=>{n.stopPropagation(),A(e)},title:"P\u0159ejmenovat \u0161ablonu",children:(0,fe.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,fe.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,fe.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})]}),(0,fe.jsx)(Dn,{children:s})]}),(0,fe.jsxs)(Tn,{children:[(0,fe.jsx)(In,{onClick:()=>j(e,e.data),title:"Detailn\xed n\xe1hled \u0161ablony",children:(0,fe.jsx)(ce.A,{size:16})}),(null===v||void 0===v?void 0:v("TEMPLATE_MANAGE"))&&(0,fe.jsx)(In,{onClick:()=>x(e),title:"Kop\xedrovat do glob\xe1ln\xedch \u0161ablon",$color:"#059669",children:(0,fe.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,fe.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,fe.jsx)("path",{d:"m9 12 2 2 4-4"})]})}),(0,fe.jsx)(In,{onClick:()=>z(e),title:"Smazat",$color:"#dc2626",children:(0,fe.jsx)(P.A,{size:16})})]}),(0,fe.jsxs)("div",{style:{display:"flex",gap:"0.25rem"},children:[(0,fe.jsx)(Pn,{onClick:()=>h(e),disabled:!b||!l&&d>=2||!i,title:b?!l&&d>=2?"Nelze vlo\u017eit PO po schv\xe1len\xed":i?"Na\u010d\xedst PO":"Tato \u0161ablona neobsahuje PO":"Vypl\u0148ov\xe1n\xed nelze - objedn\xe1vka je dokon\u010dena nebo m\xe1 neulo\u017een\xe9 zm\u011bny",children:"PO"}),(0,fe.jsx)(Pn,{onClick:()=>k(e),disabled:!b||!l&&d<3||!r,title:b?!l&&d<3?"Detaily se na\u010d\xedtaj\xed a\u017e ve f\xe1zi 3 (po schv\xe1len\xed)":r?"Na\u010d\xedst detaily":"Tato \u0161ablona neobsahuje Detaily":"Vypl\u0148ov\xe1n\xed nelze - objedn\xe1vka je dokon\u010dena nebo m\xe1 neulo\u017een\xe9 zm\u011bny",children:"Detaily"})]})]},"user-".concat(e.id,"-").concat(e.ts,"-").concat(n))}),i.trim()&&0===F.length&&(0,fe.jsx)(Ln,{$muted:!0,children:"Nenalezeno"})]})]})};var Fn,Mn,Un,Zn,Bn,Kn,Hn,Wn,$n,Jn,Gn,qn,Yn,Xn,Qn,ea,na,aa,oa,ta,ia;const ra=l.A.div(Fn||(Fn=(0,i.A)(["\n  position: fixed;\n  top: ","px;\n  left: ","px;\n  width: ",";\n  background: ",";\n  backdrop-filter: blur(12px);\n  border-radius: ",";\n  box-shadow: ",";\n  z-index: ",";\n  cursor: ",";\n  transition: ",";\n  display: flex;\n  flex-direction: column;\n  max-height: ",";\n  user-select: none;\n  will-change: width, left, border-radius, box-shadow;\n\n  ","\n"])),e=>e.$position.y,e=>e.$position.x,e=>e.$isMinimized?"".concat(40,"px"):(e.$isCompact,"".concat(305,"px")),e=>(e.$isMinimized,"linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.98) 100%)"),e=>e.$isMinimized?"0 8px 8px 0":"12px",e=>e.$isMinimized?"0 4px 16px rgba(0, 0, 0, 0.1), 0 1px 4px rgba(0, 0, 0, 0.06)":"0 8px 32px rgba(0, 0, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(0, 0, 0, 0.08)",e=>e.$isFullscreen?"999999":"99999",e=>e.$isDragging?"grabbing":"default",e=>e.$isDragging?"none":"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",e=>e.$isMinimized?"400px":"80vh",e=>e.$isMinimized&&"\n    left: 0;\n    border-radius: 0 8px 8px 0;\n  "),sa=l.A.div(Mn||(Mn=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: ",";\n  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n  border-bottom: 2px solid #e2e8f0;\n  cursor: ",";\n  border-radius: ",";\n  transition: padding 0.4s cubic-bezier(0.4, 0, 0.2, 1), border-radius 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n\n  &:active {\n    cursor: ",";\n  }\n"])),e=>e.$isMinimized?"12px 8px":"16px 20px",e=>e.$isMinimized?"default":"grab",e=>e.$isMinimized?"0 8px 0 0":"12px 12px 0 0",e=>e.$isMinimized?"default":"grabbing"),da=l.A.div(Un||(Un=(0,i.A)(["\n  writing-mode: vertical-rl;\n  text-orientation: mixed;\n  font-size: 14px;\n  font-weight: 600;\n  color: #334155;\n  letter-spacing: 2px;\n  text-transform: uppercase;\n  line-height: 1.2;\n  animation: fadeInScaleDelayed 0.3s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;\n\n  @keyframes fadeInScaleDelayed {\n    from {\n      opacity: 0;\n      transform: scale(0.9) translateY(10px);\n    }\n    to {\n      opacity: 1;\n      transform: scale(1) translateY(0);\n    }\n  }\n"]))),la=l.A.div(Zn||(Zn=(0,i.A)(["\n  font-size: 15px;\n  font-weight: 600;\n  color: #1e293b;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  animation: fadeInSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n\n  @keyframes fadeInSlide {\n    from {\n      opacity: 0;\n      transform: translateX(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateX(0);\n    }\n  }\n\n  svg {\n    width: 18px;\n    height: 18px;\n    color: #3b82f6;\n  }\n"]))),ca=l.A.div(Bn||(Bn=(0,i.A)(["\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  animation: fadeInSlideLeft 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n\n  @keyframes fadeInSlideLeft {\n    from {\n      opacity: 0;\n      transform: translateX(10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateX(0);\n    }\n  }\n"]))),pa=l.A.div(Kn||(Kn=(0,i.A)(["\n  padding: 12px 16px;\n  border-bottom: 2px solid #e2e8f0;\n  background: linear-gradient(135deg, #fefefe 0%, #f8fafc 100%);\n  animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n      transform: translateY(-5px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n"]))),ua=l.A.div(Hn||(Hn=(0,i.A)(["\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n"]))),va=l.A.button(Wn||(Wn=(0,i.A)(["\n  background: #ffffff;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: ",";\n  transition: all 0.2s ease;\n  color: #475569;\n  opacity: ",";\n  position: relative;\n\n  &:hover:not(:disabled) {\n    background: #f8fafc;\n    border-color: #cbd5e1;\n    color: #1e293b;\n    transform: scale(1.05);\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n  }\n\n  &:active:not(:disabled) {\n    transform: scale(0.95);\n  }\n\n  ","\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n"])),e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?.4:1,e=>e.$withPlus&&"\n    &::after {\n      content: '+';\n      position: absolute;\n      top: -2px;\n      right: -2px;\n      width: 14px;\n      height: 14px;\n      background: #f59e0b;\n      color: white;\n      border-radius: 50%;\n      font-size: 10px;\n      font-weight: bold;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border: 2px solid white;\n    }\n  "),_a=l.A.button($n||($n=(0,i.A)(["\n  background: #ffffff;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  color: #475569;\n\n  &:hover {\n    background: #f8fafc;\n    border-color: #cbd5e1;\n    color: #1e293b;\n    transform: scale(1.05);\n  }\n\n  &:active {\n    transform: scale(0.95);\n  }\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n"]))),ma=(0,l.A)(_a)(Jn||(Jn=(0,i.A)(["\n  margin: 8px auto;\n  display: flex;\n  animation: fadeInBounce 0.3s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;\n\n  @keyframes fadeInBounce {\n    0% {\n      opacity: 0;\n      transform: scale(0.8) translateY(-10px);\n    }\n    60% {\n      transform: scale(1.05) translateY(0);\n    }\n    100% {\n      opacity: 1;\n      transform: scale(1) translateY(0);\n    }\n  }\n"]))),fa=l.A.div(Gn||(Gn=(0,i.A)(["\n  flex: 1;\n  overflow: hidden;\n  padding: ",";\n  transition: padding 0.4s cubic-bezier(0.4, 0, 0.2, 1),\n              opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1),\n              transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n  opacity: ",";\n  transform: ",";\n  transform-origin: left center;\n\n  ","\n\n  &::-webkit-scrollbar {\n    width: 6px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: rgba(226, 232, 240, 0.3);\n    border-radius: 3px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: rgba(148, 163, 184, 0.5);\n    border-radius: 3px;\n\n    &:hover {\n      background: rgba(100, 116, 139, 0.7);\n    }\n  }\n"])),e=>e.$isMinimized?"8px 4px":"12px 8px",e=>e.$isMinimized?"0":"1",e=>e.$isMinimized?"scale(0.95) translateX(-10px)":"scale(1) translateX(0)",e=>!e.$isMinimized&&"\n    overflow-y: auto;\n  "),ha=l.A.div(qn||(qn=(0,i.A)(["\n  padding: ",";\n  margin-bottom: 6px;\n  border-radius: 8px;\n  cursor: pointer; /* \u2705 V\u017edy pointer - umo\u017e\u0148uje scrollov\xe1n\xed i k zam\u010den\xfdm sekc\xedm */\n  transition: all 0.2s ease;\n  opacity: ",";\n  background: ",";\n  border: 2px solid ",";\n  box-shadow: ",";\n\n  &:hover {\n    opacity: ","; /* \u2705 M\xedrn\xe9 zesv\u011btlen\xed i pro disabled */\n    transform: translateX(2px); /* \u2705 Hover efekt i pro disabled - ukazuje \u017ee je to klikateln\xe9 */\n    box-shadow: ",";\n  }\n"])),e=>e.$isMinimized?"8px 4px":"10px 14px",e=>e.$isDisabled?.45:1,e=>e.$isDisabled?"linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)":e.$bgColor||"rgba(255, 255, 255, 0.8)",e=>e.$isDisabled?"#cbd5e1":e.$borderColor||"#94a3b8",e=>e.$isActive?"0 2px 8px rgba(0, 0, 0, 0.12), inset 0 0 0 1px rgba(59, 130, 246, 0.3)":"0 1px 3px rgba(0, 0, 0, 0.05)",e=>e.$isDisabled?.55:1,e=>e.$isDisabled?"0 2px 6px rgba(0, 0, 0, 0.08)":"0 4px 12px rgba(0, 0, 0, 0.12)"),ka=l.A.div(Yn||(Yn=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: ",";\n  justify-content: ",";\n"])),e=>e.$isMinimized?"0":"12px",e=>e.$isMinimized?"center":"flex-start"),ga=l.A.div(Xn||(Xn=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  color: ",";\n  flex-shrink: 0;\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n"])),e=>e.$isDisabled?"#64748b":e.$color||"#94a3b8"),ba=l.A.div(Qn||(Qn=(0,i.A)(["\n  flex: 1;\n  min-width: 0;\n  color: ",";\n"])),e=>e.$textColor||"#1e293b"),ya=l.A.div(ea||(ea=(0,i.A)(["\n  font-size: 13px;\n  font-weight: 600;\n  line-height: 1.4;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n"]))),xa=l.A.span(na||(na=(0,i.A)(["\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background: ",";\n  color: white;\n  font-size: 11px;\n  font-weight: 600;\n  padding: ",";\n  border-radius: 50%;\n  width: ",";\n  height: ",";\n  min-width: ",";\n  min-height: ",";\n  margin-left: auto;\n  flex-shrink: 0;\n  line-height: 1;\n"])),e=>e.$hasErrors?"#ef4444":e.$hasMissingFields?"#f59e0b":"#10b981",e=>e.$hasMissingFields&&!e.$hasErrors?"5px":"2px 6px",e=>e.$hasMissingFields&&!e.$hasErrors?"8px":"20px",e=>e.$hasMissingFields&&!e.$hasErrors?"8px":"20px",e=>e.$hasMissingFields&&!e.$hasErrors?"8px":"20px",e=>e.$hasMissingFields&&!e.$hasErrors?"8px":"20px"),ja=l.A.span(aa||(aa=(0,i.A)(["\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background: ","; // \u010cerven\xe1 nebo zelen\xe1\n  color: white;\n  font-size: 11px;\n  font-weight: 600;\n  padding: 2px 6px;\n  border-radius: 50%;\n  width: 20px;\n  height: 20px;\n  min-width: 20px;\n  min-height: 20px;\n  margin-left: auto;\n  flex-shrink: 0;\n  line-height: 1;\n  border: 1px solid ",";\n"])),e=>e.$hasErrors?"#dc2626":"#10b981",e=>e.$hasErrors?"#dc2626":"#10b981"),za=l.A.div(oa||(oa=(0,i.A)(["\n  margin: 12px 8px 12px 8px;\n  padding: ",";\n  border: 2px dashed ",";\n  border-radius: 8px;\n  background: ",";\n  transition: all 0.2s ease;\n  cursor: ",";\n  opacity: ",";\n  pointer-events: ",";\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: ",";\n  height: ",";\n\n  &:hover {\n    border-color: ",";\n    background: ",";\n  }\n"])),e=>e.$isMinimized?"12px 8px":"20px",e=>e.$isDisabled?"#d1d5db":e.$isDragOver?"#dc2626":"#fca5a5",e=>e.$isDisabled?"#f3f4f6":e.$isDragOver?"linear-gradient(135deg, rgba(254, 202, 202, 0.5) 0%, rgba(252, 165, 165, 0.5) 100%)":"linear-gradient(135deg, rgba(254, 226, 226, 0.3) 0%, rgba(254, 202, 202, 0.3) 100%)",e=>e.$isDisabled?"not-allowed":"pointer",e=>e.$isDisabled?.5:1,e=>e.$isDisabled?"none":"auto",e=>e.$isMinimized?"4px":"8px",e=>e.$isMinimized?"60px":"".concat(120,"px"),e=>e.$isDisabled?"#d1d5db":"#dc2626",e=>e.$isDisabled?"#f3f4f6":"linear-gradient(135deg, rgba(254, 202, 202, 0.5) 0%, rgba(252, 165, 165, 0.5) 100%)"),Aa=l.A.div(ta||(ta=(0,i.A)(["\n  color: ",";\n  transition: all 0.2s ease;\n\n  svg {\n    width: ",";\n    height: ",";\n  }\n"])),e=>e.$isDisabled?"#9ca3af":e.$isDragOver?"#dc2626":"#991b1b",e=>e.$isMinimized?"20px":"32px",e=>e.$isMinimized?"20px":"32px"),wa=l.A.div(ia||(ia=(0,i.A)(["\n  font-size: ",";\n  font-weight: 600;\n  color: ",";\n  text-align: center;\n  line-height: 1.4;\n"])),e=>e.$isMinimized?"10px":"13px",e=>e.$isDisabled?"#9ca3af":e.$isDragOver?"#dc2626":"#991b1b"),Sa=[{id:"objednatel",name:"Informace o objednateli",icon:u.X46,color:"#4b5563",bgColor:"linear-gradient(135deg, rgba(249, 250, 251, 0.95) 0%, rgba(243, 244, 246, 0.95) 100%)",borderColor:"#9ca3af",phase:1,required:["jmeno","prijmeni"]},{id:"schvaleni",name:"Schv\xe1len\xed n\xe1kupu PO",icon:u.Iae,color:"#4b5563",bgColor:"linear-gradient(135deg, rgba(249, 250, 251, 0.95) 0%, rgba(243, 244, 246, 0.95) 100%)",borderColor:"#9ca3af",phase:1,required:["schvalovatel_id"]},{id:"dodavatel",name:"Dodavatel",icon:C.A,iconType:"lucide",color:"#92400e",bgColor:"linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)",borderColor:"#f59e0b",phase:2,required:["dodavatel_ico","dodavatel_nazev"]},{id:"detaily",name:"Detaily objedn\xe1vky",icon:T.A,iconType:"lucide",color:"#92400e",bgColor:"linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)",borderColor:"#f59e0b",phase:2,required:["predmet","celkova_cena"]},{id:"dodaci_podminky",name:"Dodac\xed a z\xe1ru\u010dn\xed podm\xednky",icon:_.A,iconType:"lucide",color:"#92400e",bgColor:"linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)",borderColor:"#f59e0b",phase:2,required:[]},{id:"prilohy",name:"P\u0159\xedlohy k objedn\xe1vce",icon:S.A,iconType:"lucide",color:"#991b1b",bgColor:"linear-gradient(135deg, rgba(254, 226, 226, 0.95) 0%, rgba(254, 202, 202, 0.95) 100%)",borderColor:"#dc2626",phase:2,required:[]},{id:"stav_odeslani",name:"Stav odesl\xe1n\xed objedn\xe1vky",icon:T.A,iconType:"lucide",color:"#92400e",bgColor:"linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)",borderColor:"#f59e0b",phase:3,required:[]},{id:"potvrzeni_objednavky",name:"Potvrzen\xed objedn\xe1vky",icon:u.SGM,color:"#1e40af",bgColor:"linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)",borderColor:"#3b82f6",phase:3,required:[]},{id:"registr_smluv",name:"Registr smluv",icon:u.IJd,color:"#1e40af",bgColor:"linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)",borderColor:"#3b82f6",phase:4,required:[]},{id:"registr_smluv_vyplneni",name:"Potvrzen\xed zve\u0159ejn\u011bn\xed",icon:u.IJd,color:"#7e22ce",bgColor:"linear-gradient(135deg, rgba(243, 232, 255, 0.95) 0%, rgba(233, 213, 255, 0.95) 100%)",borderColor:"#a855f7",phase:5,required:[]},{id:"fakturace",name:"Fakturace",icon:v.A,iconType:"lucide",color:"#1e40af",bgColor:"linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)",borderColor:"#3b82f6",phase:6,required:[]},{id:"vecna_spravnost",name:"V\u011bcn\xe1 spr\xe1vnost",icon:f.A,iconType:"lucide",color:"#1e40af",bgColor:"linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)",borderColor:"#3b82f6",phase:7,required:[]},{id:"dokonceni",name:"Dokon\u010den\xed",icon:u.SGM,color:"#059669",bgColor:"linear-gradient(135deg, rgba(209, 250, 229, 0.95) 0%, rgba(167, 243, 208, 0.95) 100%)",borderColor:"#10b981",phase:8,required:[]}],Ea=e=>{let{onSectionClick:n,onFilesDrop:a,onToggleSections:o,areSectionsCollapsed:i=!1,currentPhase:d=1,validationErrors:l={},formData:c={},isFullscreen:v=!1,isSectionActive:_,allSectionStates:m={},isWorkflowCompleted:f=!1,canPublishRegistry:h=!1,canUnlockAnything:k=!1,onTemplateClick:g,onSaveAsTemplate:b,onGenerateDocx:y,onToggleFullscreen:x,canGenerateDocx:j=!1,canSaveTemplate:z=!1,showTemplateDropdown:A=!1,serverTemplates:w=[],savedTemplates:S=[],templatesLoading:E=!1,searchQuery:C="",showSearch:N=!1,token:O=null,hasPermission:D,onTemplateSearch:T,onToggleTemplateSearch:I,onRefreshTemplates:P,onFillPoApproval:L,onFillDetails:R,canFillTemplate:V=!0,onCopyTemplateToUser:F,onCopyTemplateToGlobal:M,onShowTemplatePreview:U,onDeleteTemplate:Z,onEditTemplateName:B,editingTemplateId:K=null,editingTemplateName:H="",matchesTemplateQuery:W,isArchived:$=!1}=e;const[J,G]=(0,r.useState)(!1),[q,Y]=(0,r.useState)(!1),[X,Q]=(0,r.useState)(!1),[ee,ne]=(0,r.useState)(!1),[ae,oe]=(0,r.useState)({x:20,y:150}),[te,ie]=(0,r.useState)({x:0,y:0}),[re,se]=(0,r.useState)(!1),de=(0,r.useRef)(null),le=(0,r.useRef)(null),ce=(0,r.useRef)(null),pe=(0,r.useCallback)(e=>{localStorage.setItem("floatingNavigatorPosition",JSON.stringify(e))},[]),ue=(0,r.useCallback)(e=>{var n;const a=J?40:305,o=(null===(n=de.current)||void 0===n?void 0:n.offsetHeight)||400,t=Math.max(0,window.innerWidth-a-20),i=Math.max(0,window.innerHeight-o-20);return{x:Math.max(0,Math.min(e.x,t)),y:Math.max(0,Math.min(e.y,i))}},[J,q]);(0,r.useEffect)(()=>{const e=localStorage.getItem("floatingNavigatorPosition");if(e)try{const n=JSON.parse(e),a=ue(n);oe(a),a.x===n.x&&a.y===n.y||pe(a)}catch(a){console.warn("Failed to parse saved navigator position")}"true"===localStorage.getItem("floatingNavigatorMinimized")&&G(!0);"true"===localStorage.getItem("floatingNavigatorCompact")&&Y(!0);const n=localStorage.getItem("floatingNavigatorScroll");if(n&&ce.current)try{const e=parseInt(n,10);ce.current.scrollTop=e}catch(a){console.warn("Failed to restore scroll position")}},[ue,pe]);const ve=(0,r.useCallback)(()=>{oe(e=>{const n=ue(e);return n.x!==e.x||n.y!==e.y?(pe(n),n):e})},[ue,pe]);(0,r.useEffect)(()=>{const e=()=>{clearTimeout(e.timeoutId),e.timeoutId=setTimeout(ve,150)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),clearTimeout(e.timeoutId)}},[ve]);const _e=(0,r.useCallback)(e=>{localStorage.setItem("floatingNavigatorMinimized",e.toString())},[]),me=(0,r.useCallback)(e=>{localStorage.setItem("floatingNavigatorCompact",e.toString())},[]),he=(0,r.useRef)(null),ke=(0,r.useCallback)(()=>{he.current&&clearTimeout(he.current),he.current=setTimeout(()=>{ce.current&&localStorage.setItem("floatingNavigatorScroll",ce.current.scrollTop.toString())},300)},[]),ge=(0,r.useCallback)(e=>{if(J)return;const n=de.current.getBoundingClientRect();ie({x:e.clientX-n.left,y:e.clientY-n.top}),Q(!0)},[J]),be=(0,r.useCallback)(e=>{if(!X)return;const n=e.clientX-te.x,a=e.clientY-te.y,o=ue({x:n,y:a});oe(o)},[X,te,ue]),ye=(0,r.useCallback)(()=>{X&&(Q(!1),pe(ae))},[X,ae,pe]);(0,r.useEffect)(()=>{if(X)return document.addEventListener("mousemove",be),document.addEventListener("mouseup",ye),()=>{document.removeEventListener("mousemove",be),document.removeEventListener("mouseup",ye)}},[X,be,ye]);const xe=(0,r.useCallback)(()=>{const e=!J;if(G(e),_e(e),e){const e=(0,t.A)((0,t.A)({},ae),{},{x:0});oe(e),pe(e)}else oe(e=>{const n=ue(e);return n.x===e.x&&n.y===e.y||pe(n),n})},[J,ae,_e,pe,ue]),je=(0,r.useCallback)(()=>{const e=!q;Y(e),me(e),setTimeout(()=>{oe(e=>{const n=ue(e);return n.x===e.x&&n.y===e.y||pe(n),n})},50)},[q,me,ue,pe]),ze=(0,r.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),ne(!0)},[]),Ae=(0,r.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.contains(e.relatedTarget)||ne(!1)},[]),we=(0,r.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),ne(!0)},[]),Se=(0,r.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),ne(!1);const n=Array.from(e.dataTransfer.files);n.length>0&&a&&a(n)},[a]),Ee=(0,r.useCallback)(()=>{var e;null===(e=le.current)||void 0===e||e.click()},[]),Ce=(0,r.useCallback)(e=>{const n=Array.from(e.target.files);n.length>0&&a&&a(n),e.target.value=""},[a]),Ne=(0,r.useCallback)(()=>{se(e=>!e),!re&&P&&P()},[re,P]);(0,r.useEffect)(()=>{if(!re)return;const e=e=>{const n=e.target.closest("[data-template-dropdown]"),a=e.target.closest("[data-template-button]");n||a||se(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[re]);const Oe=(0,r.useCallback)(e=>{n&&n(e.id)},[n]),De=(0,r.useCallback)(e=>{var n;const a=Object.keys(l).filter(n=>{const a=(e=>e.includes("jmeno")||e.includes("email")||e.includes("ev_cislo")||e.includes("garant")?"objednatel":e.includes("prikazce")||e.includes("max_cena")||e.includes("strediska")||e.includes("predmet")||e.includes("financovani")||e.includes("lp_kod")||e.includes("cislo_smlouvy")||e.includes("individualni_schvaleni")||e.includes("pojistna_udalost")?"schvaleni":e.startsWith("polozka_")||e.includes("druh_objednavky")?"detaily":e.includes("zpusob_potvrzeni")||e.includes("dt_akceptace")||e.includes("zpusob_platby")?"potvrzeni_objednavky":e.includes("dodavatel")||e.includes("ico")||e.includes("adresa")||e.includes("kontakt")?"dodavatel":e.includes("datum_odeslani")||e.includes("stav_odeslani")?"stav_odeslani":e.startsWith("faktura_")&&e.includes("vecna_spravnost")?"vecna_spravnost":e.startsWith("faktura_")?"fakturace":e.includes("dt_zverejneni")||e.includes("registr")||e.includes("ma_byt_zverejnena")?"registr_smluv_vyplneni":null)(n);return a===e.id}).length;let o=0;return 0===a&&"vecna_spravnost"===e.id&&c.faktury&&c.faktury.length>0?c.faktury.forEach(e=>{1!==e.potvrzeni_vecne_spravnosti&&!0!==e.potvrzeni_vecne_spravnosti&&o++;const n=parseFloat(c.max_cena_s_dph)||0;(parseFloat(e.fa_castka)||0)>n&&(!e.vecna_spravnost_poznamka||""===e.vecna_spravnost_poznamka.trim())&&o++}):0===a&&e.required&&e.required.length>0&&e.required.forEach(e=>{const n=c[e];(!n||"string"===typeof n&&""===n.trim()||Array.isArray(n)&&0===n.length)&&o++}),{missingCount:o,errorCount:a,totalRequired:(null===(n=e.required)||void 0===n?void 0:n.length)||0}},[l,c]),Te=(0,r.useCallback)(e=>{const n=m[e];return n?{visible:!1!==n.visible,enabled:!1!==n.enabled}:{visible:!0,enabled:!0}},[m]),Ie=e=>{if("lucide"===e.iconType){const n=e.icon;return(0,fe.jsx)(n,{})}return(0,fe.jsx)(p.g,{icon:e.icon})},Pe=(0,fe.jsxs)(ra,{ref:de,$position:ae,$isMinimized:J,$isCompact:q,$isDragging:X,$isFullscreen:v,children:[(0,fe.jsx)(sa,{$isMinimized:J,onMouseDown:ge,children:J?(0,fe.jsx)(da,{children:"NAVIGATOR"}):(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsxs)(la,{children:[(0,fe.jsx)(Be,{}),"Navigace"]}),(0,fe.jsxs)(ca,{children:[(0,fe.jsx)(_a,{onClick:je,title:q?"Zobrazit v\u0161echny sekce":"Zobrazit jen P\u0159\xedlohy + Dropzone",children:q?(0,fe.jsx)(Ke,{}):(0,fe.jsx)(He,{})}),(0,fe.jsx)(_a,{onClick:xe,title:"Minimalizovat (schovat na levou stranu)",children:(0,fe.jsx)(We,{})})]})]})}),!J&&(0,fe.jsxs)(pa,{children:[(0,fe.jsxs)(ua,{children:[(0,fe.jsx)(va,{"data-template-button":!0,onClick:Ne,title:V?"Na\u010d\xedst \u0161ablonu objedn\xe1vky":"Na\u010d\xedt\xe1n\xed \u0161ablon nen\xed k dispozici - objedn\xe1vka je dokon\u010dena nebo m\xe1 neulo\u017een\xe9 zm\u011bny",disabled:!V,children:(0,fe.jsx)(p.g,{icon:u.G06})}),b&&(0,fe.jsx)(va,{$withPlus:!0,onClick:b,title:"Ulo\u017eit aktu\xe1ln\xed formul\xe1\u0159 jako \u0161ablonu",disabled:!z,children:(0,fe.jsx)(p.g,{icon:u.G06})}),y&&(0,fe.jsx)(va,{onClick:y,title:"Generovat DOCX ze \u0161ablony",disabled:!j,children:(0,fe.jsx)($e,{size:16})}),o&&(0,fe.jsx)(va,{onClick:o,title:i?"Rozbalit v\u0161echny sekce":"Sbalit zam\u010den\xe9 sekce",children:i?(0,fe.jsx)(Je.A,{size:16}):(0,fe.jsx)(Ge,{size:16})}),x&&(0,fe.jsx)(va,{onClick:x,title:v?"Ukon\u010dit fullscreen re\u017eim":"P\u0159epnout do fullscreen re\u017eimu",children:(0,fe.jsx)(p.g,{icon:v?u.gr3:u.oZK})})]}),(0,fe.jsx)("div",{"data-template-dropdown":!0,style:{position:"relative"},children:(0,fe.jsx)(Vn,{show:re,serverTemplates:w,savedTemplates:S,templatesLoading:E,searchQuery:C,showSearch:N,currentPhase:d,isArchived:$,token:O,hasPermission:D,onSearch:T,onToggleSearch:I,onRefresh:P,onFillPo:L,onFillDetails:R,canFillTemplate:V,onCopyToUser:F,onCopyToGlobal:M,onShowPreview:U,onDelete:Z,onEditName:B,editingTemplateId:K,editingTemplateName:H,matchesQuery:W})})]}),J&&(0,fe.jsx)(ma,{onClick:xe,title:"Rozbalit navig\xe1tor",children:(0,fe.jsx)(qe,{})}),!J&&(0,fe.jsx)(fa,{ref:ce,$isMinimized:J,onScroll:ke,children:Sa.map(e=>{if("prilohy"===e.id)return null;if(q)return null;const{visible:n,enabled:a}=Te(e.id);if(!n)return null;const o=!a,t=!!_&&_(e.id),i=De(e),r=i.errorCount>0,s=!r&&i.missingCount>0,d=r||s;return(0,fe.jsx)(ha,{$isDisabled:o,$isActive:t,$color:e.color,$bgColor:e.bgColor,$borderColor:e.borderColor,$isMinimized:J,onClick:()=>Oe(e),title:o?"".concat(e.name," (zam\u010deno - kliknut\xedm zobraz\xedte vypln\u011bn\xe1 data)"):e.name,children:(0,fe.jsxs)(ka,{$isMinimized:J,children:[(0,fe.jsx)(ga,{$color:e.color,$isDisabled:o,children:Ie(e)}),!J&&(0,fe.jsx)(ba,{$textColor:o?"#64748b":e.color,children:(0,fe.jsxs)(ya,{$isDisabled:o,children:[e.name,d&&(0,fe.jsx)(xa,{$hasErrors:r,$hasMissingFields:s,children:r?i.errorCount:""})]})})]})},e.id)})}),!J&&c.id&&(()=>{const e=null===m||void 0===m?void 0:m.prilohy,n=e?!e.enabled:f;return(0,fe.jsxs)(za,{$isDragOver:ee,$isMinimized:J,$isDisabled:n,onDragEnter:ze,onDragLeave:Ae,onDragOver:we,onDrop:Se,onClick:Ee,children:[(0,fe.jsx)("input",{ref:le,type:"file",multiple:!0,style:{display:"none"},onChange:Ce}),(0,fe.jsx)(Aa,{$isDragOver:ee,$isMinimized:J,$isDisabled:n,children:(0,fe.jsx)(Ye,{})}),(0,fe.jsx)(wa,{$isDragOver:ee,$isMinimized:J,$isDisabled:n,children:ee?"Pus\u0165te soubory zde":"P\u0159et\xe1hn\u011bte soubory"})]})})(),!J&&c.id&&(()=>{const e=null===m||void 0===m?void 0:m.prilohy;return(e?!e.enabled:f)&&(0,fe.jsxs)("div",{style:{margin:"12px 8px",padding:"16px",background:"linear-gradient(135deg, rgba(229, 229, 229, 0.95) 0%, rgba(209, 213, 219, 0.95) 100%)",border:"2px solid #9ca3af",borderRadius:"8px",textAlign:"center",color:"#4b5563",fontSize:"13px",fontWeight:"600",lineHeight:"1.4"},children:[(0,fe.jsx)("div",{style:{marginBottom:"4px"},children:"\ud83d\udd12 Objedn\xe1vka zam\u010dena"}),(0,fe.jsx)("div",{style:{fontSize:"11px",fontWeight:"400"},children:"P\u0159\xedlohy jsou uzam\u010den\xe9"})]})})(),!J&&c.id&&(()=>{const e={id:"prilohy",name:"P\u0159\xedlohy k objedn\xe1vce",icon:u.KTq,color:"#991b1b",bgColor:"linear-gradient(135deg, rgba(254, 226, 226, 0.95) 0%, rgba(254, 202, 202, 0.95) 100%)",borderColor:"#dc2626"},n=null===m||void 0===m?void 0:m.prilohy,a=n?!n.enabled:f,o=!!_&&_(e.id),t=(null===n||void 0===n?void 0:n.attachmentsCount)||0,i=(null===n||void 0===n?void 0:n.hasAttachmentErrors)||!1,r=t>0,s=t.toString();return(0,fe.jsx)(fa,{$isMinimized:J,children:(0,fe.jsx)(ha,{$isDisabled:a,$isActive:o,$color:e.color,$bgColor:e.bgColor,$borderColor:e.borderColor,$isMinimized:J,onClick:()=>Oe(e),title:a?"".concat(e.name," (zam\u010deno - kliknut\xedm zobraz\xedte vypln\u011bn\xe1 data)"):e.name,children:(0,fe.jsxs)(ka,{$isMinimized:J,children:[(0,fe.jsx)(ga,{$color:e.color,$isDisabled:a,children:(0,fe.jsx)(p.g,{icon:e.icon})}),!J&&(0,fe.jsx)(ba,{$textColor:a?"#64748b":e.color,children:(0,fe.jsxs)(ya,{$isDisabled:a,children:[e.name,r&&(0,fe.jsx)(ja,{$hasErrors:i,children:s})]})})]})})})})()]});return"undefined"!==typeof document?s.createPortal(Pe,document.body):Pe};var Ca=a(88720),Na=a(1356),Oa=a(32730),Da=a(21397),Ta=a(65757),Ia=a(90087),Pa=a(33637),La=a(44649);function Ra(e){if(!e)return[];if(Array.isArray(e)&&e.every(e=>"string"===typeof e))return e.map(e=>String(e).toUpperCase().trim()).filter(Boolean);if("string"===typeof e)try{const n=JSON.parse(e);if(Array.isArray(n))return n.map(e=>"string"===typeof e?e.toUpperCase().trim():null!==e&&void 0!==e&&e.kod_stavu?String(e.kod_stavu).toUpperCase().trim():null!==e&&void 0!==e&&e.kod?String(e.kod).toUpperCase().trim():String(e).toUpperCase().trim()).filter(Boolean)}catch(n){return console.error("\u274c [normalizeStrediskaFromBackend] Chyba parsov\xe1n\xed JSON:",n,"Data:",e),[]}return Array.isArray(e)&&e.some(e=>"object"===typeof e&&null!==e)?e.map(e=>null!==e&&void 0!==e&&e.kod_stavu?String(e.kod_stavu).toUpperCase().trim():null!==e&&void 0!==e&&e.kod?String(e.kod).toUpperCase().trim():"string"===typeof e?e.toUpperCase().trim():String(e).toUpperCase().trim()).filter(Boolean):(console.warn("\u26a0\ufe0f [normalizeStrediskaFromBackend] Nezn\xe1m\xfd form\xe1t dat:",typeof e,e),[])}function Va(e){return Array.isArray(e)?e.map(e=>String(e).toUpperCase().trim()).filter(Boolean):[]}function Fa(e){if(!e)return{};let n=e;if("string"===typeof e)try{n=JSON.parse(e)}catch(o){return console.error("\u274c [normalizeFinancovaniFromBackend] Chyba parsov\xe1n\xed JSON:",o,"Data:",e),{}}const a={zpusob_financovani:n.typ||n.kod_stavu||n.zdroj||""};if(n.lp_kody?a.lp_kod=n.lp_kody:n.lp_kod&&(a.lp_kod=n.lp_kod),n.cislo_smlouvy&&(a.cislo_smlouvy=n.cislo_smlouvy),n.smlouva_poznamka&&(a.smlouva_poznamka=n.smlouva_poznamka),n.individualni_schvaleni&&(a.individualni_schvaleni=n.individualni_schvaleni),n.individualni_poznamka&&(a.individualni_poznamka=n.individualni_poznamka),n.pojistna_udalost_cislo&&(a.pojistna_udalost_cislo=n.pojistna_udalost_cislo),n.pojistna_udalost_poznamka&&(a.pojistna_udalost_poznamka=n.pojistna_udalost_poznamka),n.doplnujici_data){const e=n.doplnujici_data;e.lp_kod&&!a.lp_kod&&(a.lp_kod=e.lp_kod),e.lp_kody&&!a.lp_kod&&(a.lp_kod=e.lp_kody),e.cislo_smlouvy&&!a.cislo_smlouvy&&(a.cislo_smlouvy=e.cislo_smlouvy),e.smlouva_poznamka&&!a.smlouva_poznamka&&(a.smlouva_poznamka=e.smlouva_poznamka),e.individualni_schvaleni&&!a.individualni_schvaleni&&(a.individualni_schvaleni=e.individualni_schvaleni),e.individualni_poznamka&&!a.individualni_poznamka&&(a.individualni_poznamka=e.individualni_poznamka),e.pojistna_udalost_cislo&&!a.pojistna_udalost_cislo&&(a.pojistna_udalost_cislo=e.pojistna_udalost_cislo),e.pojistna_udalost_poznamka&&!a.pojistna_udalost_poznamka&&(a.pojistna_udalost_poznamka=e.pojistna_udalost_poznamka)}return a}function Ma(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e||!e.zpusob_financovani)return null;const a=n.find(n=>n.kod===e.zpusob_financovani||n.kod_stavu===e.zpusob_financovani||n.value===e.zpusob_financovani),o={typ:e.zpusob_financovani,nazev:(null===a||void 0===a?void 0:a.nazev)||(null===a||void 0===a?void 0:a.nazev_stavu)||(null===a||void 0===a?void 0:a.label)||e.zpusob_financovani,nazev_stavu:(null===a||void 0===a?void 0:a.nazev_stavu)||(null===a||void 0===a?void 0:a.nazev)||(null===a||void 0===a?void 0:a.label)||e.zpusob_financovani},t=e.zpusob_financovani;return"LP"===t?e.lp_kod&&Array.isArray(e.lp_kod)&&e.lp_kod.length>0&&(o.lp_kody=e.lp_kod.map(e=>parseInt(e,10))):"SMLOUVA"===t?(e.cislo_smlouvy&&(o.cislo_smlouvy=e.cislo_smlouvy),e.smlouva_poznamka&&(o.smlouva_poznamka=e.smlouva_poznamka)):"INDIVIDUALNI_SCHVALENI"===t||"INDIVIDU\xc1LN\xcd"===t||"INDIVIDUALNI"===t?(e.individualni_schvaleni&&(o.individualni_schvaleni=e.individualni_schvaleni),e.individualni_poznamka&&(o.individualni_poznamka=e.individualni_poznamka)):"POJISTNA_UDALOST"!==t&&"POJISTN\xc1 UD\xc1LOST"!==t&&"POJISTNA UDALOST"!==t||(e.pojistna_udalost_cislo&&(o.pojistna_udalost_cislo=e.pojistna_udalost_cislo),e.pojistna_udalost_poznamka&&(o.pojistna_udalost_poznamka=e.pojistna_udalost_poznamka)),o}new class{constructor(){this.isInitialized=!1,this.isInitializing=!1,this.initPromise=null,this.cache={users:[],approvers:[],strediska:[],financovani:[],druhyObjednavky:[],lpKody:[]},this.metadata={lastInitTime:null,initDuration:null,errors:[]},this.stateCallbacks={}}registerStateCallbacks(e){this.stateCallbacks={setAllUsers:e.setAllUsers||(()=>{}),setApprovers:e.setApprovers||(()=>{}),setStrediskaOptions:e.setStrediskaOptions||(()=>{}),setFinancovaniOptions:e.setFinancovaniOptions||(()=>{}),setDruhyObjednavkyOptions:e.setDruhyObjednavkyOptions||(()=>{}),setLpKodyOptions:e.setLpKodyOptions||(()=>{}),setLoadingUsers:e.setLoadingUsers||(()=>{}),setLoadingApprovers:e.setLoadingApprovers||(()=>{}),setLoadingStrediska:e.setLoadingStrediska||(()=>{}),setLoadingFinancovani:e.setLoadingFinancovani||(()=>{}),setLoadingDruhyObjednavky:e.setLoadingDruhyObjednavky||(()=>{}),setLoadingLpKody:e.setLoadingLpKody||(()=>{})}}async initialize(e){let{token:n,username:a,formDataId:o=null}=e;if(this.isInitializing)return await this.initPromise,this._updateReactState(),this.cache;if(this.isInitialized)return this._updateReactState(),this.cache;this.isInitializing=!0;const t=Date.now();this.initPromise=this._performInitialization({token:n,username:a,formDataId:o});try{await this.initPromise;const e=Date.now()-t;return this.metadata.lastInitTime=new Date,this.metadata.initDuration=e,this.isInitialized=!0,this.cache}catch(i){throw this.metadata.errors.push({timestamp:new Date,error:i.message}),i}finally{this.isInitializing=!1}}async _performInitialization(e){let{token:n,username:a,formDataId:o}=e;const t=!!o,[i,r,s,d,l,c]=await Promise.allSettled([this._loadUsers(n,a,t),this._loadApprovers(n,a),this._loadStrediska(n,a),this._loadFinancovani(n,a),this._loadDruhyObjednavky(n,a),this._loadLpKody(n,a)]),p={users:this._handleResult(i,"U\u017eivatel\xe9"),approvers:this._handleResult(r,"Schvalovatel\xe9"),strediska:this._handleResult(s,"St\u0159ediska"),financovani:this._handleResult(d,"Financov\xe1n\xed"),druhyObjednavky:this._handleResult(l,"Druhy objedn\xe1vky"),lpKody:this._handleResult(c,"LP k\xf3dy")};this.cache={users:p.users.data,approvers:p.approvers.data,strediska:p.strediska.data,financovani:p.financovani.data,druhyObjednavky:p.druhyObjednavky.data,lpKody:p.lpKody.data},this._updateReactState();return Object.entries(p).filter(e=>{let[n,a]=e;return!a.success}).map(e=>{let[n]=e;return n}).length,this.cache}async _loadUsers(e,n,a){var o,t;null===(o=(t=this.stateCallbacks).setLoadingUsers)||void 0===o||o.call(t,!0);try{const o=await(0,me.Ym)({token:e,username:n});return a?o||[]:(o||[]).filter(e=>1===e.aktivni||"1"===e.aktivni)}catch(s){return[]}finally{var i,r;null===(i=(r=this.stateCallbacks).setLoadingUsers)||void 0===i||i.call(r,!1)}}async _loadApprovers(e,n){var a,o;null===(a=(o=this.stateCallbacks).setLoadingApprovers)||void 0===a||a.call(o,!0);try{const a=(await(0,me.lF)({token:e,username:n})||[]).filter(e=>void 0===e.aktivni||null===e.aktivni||(1===e.aktivni||"1"===e.aktivni));return a.map(e=>{const n=e.titul_pred?e.titul_pred+" ":"",a=e.jmeno||"",o=e.prijmeni||"",i=e.titul_za?", "+e.titul_za:"",r="".concat(n).concat(a," ").concat(o).concat(i).replace(/\s+/g," ").trim()||e.username||"User ".concat(e.id||e.user_id);return(0,t.A)((0,t.A)({},e),{},{displayName:r,label:r,value:e.id||e.user_id})})}catch(s){return[]}finally{var i,r;null===(i=(r=this.stateCallbacks).setLoadingApprovers)||void 0===i||i.call(r,!1)}}async _loadStrediska(e,n){var a,o;null===(a=(o=this.stateCallbacks).setLoadingStrediska)||void 0===a||a.call(o,!0);try{return await(0,Pa.CR)({token:e,username:n})||[]}catch(r){return[]}finally{var t,i;null===(t=(i=this.stateCallbacks).setLoadingStrediska)||void 0===t||t.call(i,!1)}}async _loadFinancovani(e,n){var a,o;null===(a=(o=this.stateCallbacks).setLoadingFinancovani)||void 0===a||a.call(o,!0);try{const a=await(0,Pa.hP)({token:e,username:n});return Array.isArray(a)?(a.length,a):[]}catch(r){return[]}finally{var t,i;null===(t=(i=this.stateCallbacks).setLoadingFinancovani)||void 0===t||t.call(i,!1)}}async _loadDruhyObjednavky(e,n){var a,o;null===(a=(o=this.stateCallbacks).setLoadingDruhyObjednavky)||void 0===a||a.call(o,!0);try{const a=await(0,Pa.je)({token:e,username:n}),o=Array.isArray(a)?a:[];return o.length,o}catch(r){return[]}finally{var t,i;null===(t=(i=this.stateCallbacks).setLoadingDruhyObjednavky)||void 0===t||t.call(i,!1)}}async _loadLpKody(e,n){var a,o;null===(a=(o=this.stateCallbacks).setLoadingLpKody)||void 0===a||a.call(o,!0);try{return await(0,me.Hy)({token:e,username:n})||[]}catch(r){return[]}finally{var t,i;null===(t=(i=this.stateCallbacks).setLoadingLpKody)||void 0===t||t.call(i,!1)}}_handleResult(e,n){return"fulfilled"===e.status&&void 0!==e.value&&null!==e.value?{success:!0,data:e.value}:{success:!1,data:[]}}_updateReactState(){var e,n,a,o,t,i,r,s,d,l,c,p;this._hasDataChanged("users",this.cache.users)&&(null===(e=(n=this.stateCallbacks).setAllUsers)||void 0===e||e.call(n,this.cache.users));this._hasDataChanged("approvers",this.cache.approvers)&&(null===(a=(o=this.stateCallbacks).setApprovers)||void 0===a||a.call(o,this.cache.approvers));this._hasDataChanged("strediska",this.cache.strediska)&&(null===(t=(i=this.stateCallbacks).setStrediskaOptions)||void 0===t||t.call(i,this.cache.strediska));this._hasDataChanged("financovani",this.cache.financovani)&&(null===(r=(s=this.stateCallbacks).setFinancovaniOptions)||void 0===r||r.call(s,this.cache.financovani));this._hasDataChanged("druhyObjednavky",this.cache.druhyObjednavky)&&(null===(d=(l=this.stateCallbacks).setDruhyObjednavkyOptions)||void 0===d||d.call(l,this.cache.druhyObjednavky));this._hasDataChanged("lpKody",this.cache.lpKody)&&(null===(c=(p=this.stateCallbacks).setLpKodyOptions)||void 0===c||c.call(p,this.cache.lpKody))}_hasDataChanged(e,n){const a="_prev_".concat(e),o=this[a];return o?o.length!==n.length&&(this[a]=n,!0):(this[a]=n,!0)}async loadOrder(e){let{token:n,username:a,orderId:o,archivovano:t=0}=e;try{const e=await(0,La.getOrderV2)(o,n,a,!0);if(!e)throw new Error("Objedn\xe1vka ID ".concat(o," nebyla nalezena"));if(e.financovani){const n=Fa(e.financovani);Object.assign(e,n)}return e.strediska_kod&&(e.strediska_kod=Ra(e.strediska_kod)),e}catch(i){throw i}}reset(){this.isInitialized=!1,this.isInitializing=!1,this.initPromise=null,this.cache={users:[],approvers:[],strediska:[],financovani:[],druhyObjednavky:[],lpKody:[]},this.metadata={lastInitTime:null,initDuration:null,errors:[]}}getState(){return{isInitialized:this.isInitialized,isInitializing:this.isInitializing,cache:(0,t.A)({},this.cache),metadata:(0,t.A)({},this.metadata)}}};const Ua=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{delay:a=3e3,enabled:o=!0,dependencies:t=[]}=n,i=(0,r.useRef)(null),s=(0,r.useRef)(!1),d=(0,r.useRef)(0),l=(0,r.useCallback)(()=>{i.current&&(clearTimeout(i.current),i.current=null,s.current=!1)},[]),c=(0,r.useCallback)(function(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!o)return;l();const t=Date.now(),r=t-d.current;if(n&&r>=1e3)return d.current=t,void e(!0);s.current=!0,i.current=setTimeout(()=>{const n=Date.now();n-d.current>=1e3&&(d.current=n,e(!0)),s.current=!1,i.current=null},n?0:a)},[o,a,e,l,...t]);return(0,r.useEffect)(()=>()=>{i.current&&clearTimeout(i.current)},[]),{triggerAutosave:c,cancelAutosave:l,isScheduled:()=>s.current}};var Za=a(19439),Ba=a(77220);const Ka=a(56263).A.create({baseURL:"https://erdms.zachranka.cz/api.eeo/",headers:{"Content-Type":"application/json"}});function Ha(e){var n,a,o,t,i,r,s;return null!==(n=e.response)&&void 0!==n&&null!==(a=n.data)&&void 0!==a&&a.message?e.response.data.message:null!==(o=e.response)&&void 0!==o&&null!==(t=o.data)&&void 0!==t&&t.error?e.response.data.error:null!==(i=e.response)&&void 0!==i&&null!==(r=i.data)&&void 0!==r&&r.err?e.response.data.err:null!==(s=e.response)&&void 0!==s&&s.data&&"string"===typeof e.response.data?e.response.data:e.message?e.message:"Neo\u010dek\xe1van\xe1 chyba p\u0159i komunikaci se serverem"}async function Wa(e){let{token:n,username:a,order_id:o,smlouva_id:t=null,fa_cislo_vema:i,fa_typ:r="BEZNA",fa_datum_vystaveni:s,fa_castka:d,fa_datum_splatnosti:l=null,fa_datum_doruceni:c=null,fa_dorucena:p=0,fa_strediska_kod:u=null,fa_poznamka:v=null,rozsirujici_data:_=null,potvrzeni_vecne_spravnosti:m=null,vecna_spravnost_umisteni_majetku:f=null,vecna_spravnost_poznamka:h=null,fa_predana_zam_id:k=null,fa_datum_predani_zam:g=null,fa_datum_vraceni_zam:b=null}=e;if(!n||!a)throw new Error("Chyb\xed p\u0159\xedstupov\xfd token nebo u\u017eivatelsk\xe9 jm\xe9no. P\u0159ihlaste se pros\xedm znovu.");if(!i)throw new Error("Chyb\xed \u010d\xedslo faktury (fa_cislo_vema).");if(!s)throw new Error("Chyb\xed datum vystaven\xed (fa_datum_vystaveni).");if(!d)throw new Error("Chyb\xed \u010d\xe1stka faktury (fa_castka).");try{const e={username:a,token:n,fa_cislo_vema:String(i),fa_typ:String(r),fa_datum_vystaveni:s,fa_castka:String(d),fa_dorucena:Number(p)};l&&(e.fa_datum_splatnosti=l),c&&(e.fa_datum_doruceni=c),u&&(e.fa_strediska_kod=String(u)),v&&(e.fa_poznamka=String(v)),_&&(e.rozsirujici_data=_),m&&(e.potvrzeni_vecne_spravnosti=m),f&&(e.vecna_spravnost_umisteni_majetku=String(f)),h&&(e.vecna_spravnost_poznamka=String(h)),k&&(e.fa_predana_zam_id=Number(k)),g&&(e.fa_datum_predani_zam=g),b&&(e.fa_datum_vraceni_zam=b),t&&(e.smlouva_id=Number(t));const y=o?"order-v2/".concat(o,"/invoices/create"):"order-v2/invoices/create";o&&(e.objednavka_id=Number(o));const x=await Ka.post(y,e,{timeout:1e4});if(200!==x.status&&201!==x.status){const e="Neo\u010dek\xe1van\xfd k\xf3d odpov\u011bdi: ".concat(x.status);throw new Error(e)}const j=x.data;if("error"===j.status)throw new Error(j.message||"Chyba p\u0159i vytv\xe1\u0159en\xed faktury");if("ok"===j.status)return j;throw new Error("Neo\u010dek\xe1van\xe1 struktura odpov\u011bdi ze serveru")}catch(y){throw new Error(Ha(y))}}async function $a(e,n,a){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!n||!a)throw new Error("Chyb\xed p\u0159\xedstupov\xfd token nebo u\u017eivatelsk\xe9 jm\xe9no. P\u0159ihlaste se pros\xedm znovu.");if(!e)throw new Error("Chyb\xed ID faktury.");try{const t={token:n,username:a,hard_delete:o?1:0},i=await Ka.delete("order-v2/invoices/".concat(e),{data:t,timeout:1e4});if(200!==i.status&&201!==i.status)throw new Error("Neo\u010dek\xe1van\xfd k\xf3d odpov\u011bdi p\u0159i maz\xe1n\xed faktury");const r=i.data;if("error"===r.status||r.err||r.error){const e=r.message||r.err||r.error||"Chyba p\u0159i maz\xe1n\xed faktury";throw new Error(e)}if("ok"===r.status||!0===r.success||200===i.status)return r;throw new Error("Neo\u010dek\xe1van\xe1 struktura odpov\u011bdi ze serveru")}catch(t){throw new Error(Ha(t))}}Ka.interceptors.response.use(e=>e,e=>{var n,a,o,t,i,r,s;if((null===(n=e.config)||void 0===n||null===(a=n.url)||void 0===a?void 0:a.includes("/invoices/"))&&(null===(o=e.config)||void 0===o||null===(t=o.url)||void 0===t?void 0:t.includes("/delete")))return Promise.reject(e);if((401===(null===(i=e.response)||void 0===i?void 0:i.status)||403===(null===(r=e.response)||void 0===r?void 0:r.status))&&"undefined"!==typeof window){const e=new CustomEvent("authError",{detail:{message:"Va\u0161e p\u0159ihl\xe1\u0161en\xed vypr\u0161elo. P\u0159ihlaste se pros\xedm znovu."}});window.dispatchEvent(e)}const d=(null===(s=e.response)||void 0===s?void 0:s.data)||"";if("string"===typeof d&&d.includes("<!doctype")&&"undefined"!==typeof window){const e=new CustomEvent("authError",{detail:{message:"Va\u0161e p\u0159ihl\xe1\u0161en\xed vypr\u0161elo. Obnovte str\xe1nku a p\u0159ihlaste se znovu."}});window.dispatchEvent(e)}return Promise.reject(e)});var Ja=a(80293),Ga=(a(43548),a(21757));const qa={NOVA:{code:"NOVA",name:"Nov\xe1",description:"Objedn\xe1vka je v p\u0159\xedprav\u011b, viditeln\xe1 pouze pro autora",color:"#94a3b8",icon:"\ud83d\udcdd",phase:"draft"},ODESLANA_KE_SCHVALENI:{code:"ODESLANA_KE_SCHVALENI",name:"Ke schv\xe1len\xed",description:"Objedn\xe1vka byla odesl\xe1na a \u010dek\xe1 na akci schvalovatele",color:"#f59e0b",icon:"\u23f3",phase:"approval"},SCHVALENA:{code:"SCHVALENA",name:"Schv\xe1len\xe1",description:"Objedn\xe1vka byla schv\xe1lena p\u0159\xedslu\u0161n\xfdm mana\u017eerem",color:"#10b981",icon:"\u2705",phase:"approved"},ZAMITNUTA:{code:"ZAMITNUTA",name:"Zam\xedtnuta",description:"Objedn\xe1vka byla schvalovatelem zam\xedtnuta",color:"#ef4444",icon:"\u274c",phase:"rejected"},CEKA_POTVRZENI:{code:"CEKA_POTVRZENI",name:"\u010cek\xe1 na potvrzen\xed",description:"Objedn\xe1vka byla odesl\xe1na, \u010dek\xe1 na potvrzen\xed dodavatele",color:"#3b82f6",icon:"\ud83d\udce4",phase:"supplier_pending"},POTVRZENA:{code:"POTVRZENA",name:"Potvrzen\xe1 dodavatelem",description:"Dodavatel potvrdil p\u0159ijet\xed a akceptaci objedn\xe1vky",color:"#059669",icon:"\u2705",phase:"supplier_confirmed"},DOKONCENA:{code:"DOKONCENA",name:"Dokon\u010den\xe1",description:"Zbo\u017e\xed/slu\u017eba bylo dod\xe1no, proces je uzav\u0159en",color:"#6b7280",icon:"\ud83c\udfc1",phase:"completed"},ZRUSENA:{code:"ZRUSENA",name:"Zru\u0161ena",description:"Objedn\xe1vka byla stornov\xe1na p\u0159ed dokon\u010den\xedm",color:"#9ca3af",icon:"\ud83d\uddd1\ufe0f",phase:"cancelled"},ROZPRACOVANA:{code:"ROZPRACOVANA",name:"Rozpracovan\xe1",description:"Schv\xe1len\xe1 objedn\xe1vka je v procesu zpracov\xe1n\xed",color:"#8b5cf6",icon:"\ud83d\udd27",phase:"in_progress"}},Ya=e=>{const n=qa[e];return n?n.phase:"draft"},Xa=(Object.values(qa),{predmet:"P\u0159edm\u011bt objedn\xe1vky",garant_uzivatel_id:"Garant",prikazce_id:"P\u0159\xedkazce",max_cena_s_dph:"Maxim\xe1ln\xed cena s DPH",strediska_kod:"St\u0159edisko",jmeno:"Jm\xe9no objednatele",email:"E-mail objednatele",dodavatel_nazev:"N\xe1zev dodavatele",dodavatel_adresa:"Adresa dodavatele",dodavatel_ico:"I\u010cO dodavatele",dodavatel_kontakt:"Kontakt na dodavatele",druh_objednavky_kod:"Druh objedn\xe1vky",polozky_objednavky:"Polo\u017eky objedn\xe1vky",zpusob_financovani:"Zp\u016fsob financov\xe1n\xed",lp_kod:"LP k\xf3d",cislo_smlouvy:"\u010c\xedslo smlouvy",smlouva_poznamka:"Pozn\xe1mka ke smlouv\u011b",individualni_schvaleni:"Identifik\xe1tor schv\xe1len\xed",individualni_poznamka:"Pozn\xe1mka k schv\xe1len\xed",pojistna_udalost_cislo:"\u010c\xedslo pojistn\xe9 ud\xe1losti",pojistna_udalost_poznamka:"Pozn\xe1mka k pojistn\xe9 ud\xe1losti",datum_odeslani:"Datum odesl\xe1n\xed",schvaleni_komentar:"Koment\xe1\u0159",odeslani_storno_duvod:"D\u016fvod stornov\xe1n\xed",dodavatel_zpusob_potvrzeni:"Zp\u016fsob potvrzen\xed",zpusob_platby:"Zp\u016fsob platby",dt_akceptace:"Datum akceptace",dt_zverejneni:"Datum zve\u0159ejn\u011bn\xed (VZ)",registr_iddt:"Identifik\xe1tor IDDT",ma_byt_zverejnena:"Zve\u0159ejn\u011bn\xed"}),Qa=function(e){var n,a;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"NOVA",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i={},r=(e=>{const n=["predmet","max_cena_s_dph","strediska_kod","zpusob_financovani","prikazce_id","garant_uzivatel_id"];switch(e){case"NOVA":default:return n;case"ODESLANA_KE_SCHVALENI":return[...n,"garant_uzivatel_id","prikazce_id","jmeno","email"];case"SCHVALENA":return[...n,"garant_uzivatel_id","prikazce_id","jmeno","email","schvalovatel_id","dt_schvaleni","dodavatel_nazev","dodavatel_adresa","dodavatel_ico","druh_objednavky_kod","polozky_objednavky"];case"CEKA_POTVRZENI":return[...n,"garant_uzivatel_id","prikazce_id","jmeno","email","dodavatel_nazev","dodavatel_kontakt"]}})(o),s={predmet:"phase1",garant_uzivatel_id:"phase1",prikazce_id:"phase1",max_cena_s_dph:"phase1",strediska_kod:"phase1",jmeno:"phase1",email:"phase1",zpusob_financovani:"financovani",lp_kod:"financovani",cislo_smlouvy:"financovani",smlouva_poznamka:"financovani",individualni_schvaleni:"financovani",individualni_poznamka:"financovani",pojistna_udalost_cislo:"financovani",pojistna_udalost_poznamka:"financovani",dodavatel_nazev:"phase3",dodavatel_adresa:"phase3",dodavatel_ico:"phase3",dodavatel_kontakt:"phase3",druh_objednavky_kod:"phase3",polozky_objednavky:"phase3",datum_odeslani:"phase4to6",dodavatel_zpusob_potvrzeni:"phase4to6",zpusob_platby:"phase4to6",dt_akceptace:"phase4to6",schvaleni_komentar:"phase2",odeslani_storno_duvod:"phase2"},d=(()=>{const n=e.zpusob_financovani;if(!n)return!1;if("string"===typeof n)return n.toLowerCase().includes("pokladna");if("object"===typeof n&&null!==n){return(n.nazev_stavu||n.nazev||"").toLowerCase().includes("pokladna")}return!1})();var l,c,p,u;(r.forEach(n=>{var a,o,r,l,c,p,u,v,_,m,f,h;if(((e,n)=>{if(!t||!e)return!0;const a=t[e];if(!a)return!0;if(["dodavatel_nazev","dodavatel_adresa","dodavatel_ico","dodavatel_kontakt","prikazce_id","max_cena_s_dph","garant_uzivatel_id","predmet","strediska_kod"].includes(n))return a.visible;return a.visible&&!a.locked})(s[n],n)&&(!d||!["dodavatel_nazev","dodavatel_adresa","dodavatel_ico","dodavatel_kontakt"].includes(n)))switch(n){case"predmet":null!==(a=e.predmet)&&void 0!==a&&a.trim()||(i.predmet="".concat(Xa.predmet," je povinn\xfd - zadejte stru\u010dn\xfd popis toho, co objedn\xe1v\xe1te"));break;case"max_cena_s_dph":(!e.max_cena_s_dph||e.max_cena_s_dph<=0)&&(i.max_cena_s_dph="".concat(Xa.max_cena_s_dph," je povinn\xe1 - zadejte p\u0159edpokl\xe1danou celkovou cenu v\u010detn\u011b DPH"));break;case"strediska_kod":(!e.strediska_kod||Array.isArray(e.strediska_kod)&&0===e.strediska_kod.length)&&(i.strediska_kod="".concat(Xa.strediska_kod," - vyberte alespo\u0148 jedno st\u0159edisko, ke kter\xe9mu se objedn\xe1vka vztahuje"));break;case"garant_uzivatel_id":e.garant_uzivatel_id&&""!==e.garant_uzivatel_id||(i.garant_uzivatel_id="".concat(Xa.garant_uzivatel_id," je povinn\xfd - vyberte osobu zodpov\u011bdnou za objedn\xe1vku"));break;case"prikazce_id":e.prikazce_id&&""!==e.prikazce_id||(i.prikazce_id="".concat(Xa.prikazce_id," je povinn\xfd - vyberte osobu, kter\xe1 schvaluje objedn\xe1vku"));break;case"jmeno":null!==(o=e.jmeno)&&void 0!==o&&o.trim()&&"Neuvedeno"!==e.jmeno||(i.jmeno="".concat(Xa.jmeno," je povinn\xe9 - zkontrolujte sv\xe9 u\u017eivatelsk\xe9 \xfadaje"));break;case"email":null!==(r=e.email)&&void 0!==r&&r.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(i.email="E-mail m\xe1 neplatn\xfd form\xe1t - zkontrolujte, zda obsahuje @ a dom\xe9nu"):i.email="".concat(Xa.email," je povinn\xfd - zadejte platnou e-mailovou adresu");break;case"dodavatel_nazev":null!==(l=e.dodavatel_nazev)&&void 0!==l&&l.trim()||(i.dodavatel_nazev="".concat(Xa.dodavatel_nazev," je povinn\xfd - zadejte n\xe1zev firmy dodavatele"));break;case"dodavatel_adresa":null!==(c=e.dodavatel_adresa)&&void 0!==c&&c.trim()||(i.dodavatel_adresa="".concat(Xa.dodavatel_adresa," je povinn\xe1 - zadejte \xfaplnou adresu dodavatele"));break;case"dodavatel_ico":null!==(p=e.dodavatel_ico)&&void 0!==p&&p.trim()||(i.dodavatel_ico="".concat(Xa.dodavatel_ico," je povinn\xe9 - zadejte I\u010cO dodavatele (8 \u010d\xedslic)"));break;case"druh_objednavky_kod":null!==(u=e.druh_objednavky_kod)&&void 0!==u&&u.trim()||(i.druh_objednavky_kod="".concat(Xa.druh_objednavky_kod," je povinn\xfd - vyberte typ objedn\xe1vky"));break;case"polozky_objednavky":if(e.polozky_objednavky&&0!==e.polozky_objednavky.length){let n=!1;e.polozky_objednavky.forEach((e,a)=>{var o;null!==(o=e.popis)&&void 0!==o&&o.trim()||(i["polozka_".concat(a,"_popis")]="Polo\u017eka ".concat(a+1,": Vypl\u0148te n\xe1zev nebo popis polo\u017eky"),n=!0),(!e.cena_bez_dph||parseFloat(e.cena_bez_dph)<=0)&&(i["polozka_".concat(a,"_cena_bez_dph")]="Polo\u017eka ".concat(a+1,": Zadejte cenu bez DPH (mus\xed b\xfdt v\u011bt\u0161\xed ne\u017e 0)"),n=!0),(!e.cena_s_dph||parseFloat(e.cena_s_dph)<=0)&&(i["polozka_".concat(a,"_cena_s_dph")]="Polo\u017eka ".concat(a+1,": Zadejte cenu s DPH (mus\xed b\xfdt v\u011bt\u0161\xed ne\u017e 0)"),n=!0)}),n&&(i.polozky_objednavky="N\u011bkter\xe9 polo\u017eky obsahuj\xed chyby - zkontrolujte n\xe1zev a ceny v\u0161ech polo\u017eek")}else i.polozky_objednavky="".concat(Xa.polozky_objednavky," - p\u0159idejte alespo\u0148 jednu polo\u017eku s n\xe1zvem a cenou");break;case"dodavatel_kontakt":null!==(v=e.dodavatel_kontakt)&&void 0!==v&&v.trim()||(i.dodavatel_kontakt="".concat(Xa.dodavatel_kontakt," je povinn\xfd - zadejte e-mail nebo telefon na dodavatele"));break;case"druh_objednavky":null!==(_=e.druh_objednavky_kod)&&void 0!==_&&_.trim()||(i.druh_objednavky_kod="".concat(Xa.druh_objednavky_kod," je povinn\xfd - vyberte typ objedn\xe1vky"));break;case"financovani":case"zpusob_financovani":e.zpusob_financovani&&("string"!==typeof e.zpusob_financovani||e.zpusob_financovani.trim())||(i.zpusob_financovani="".concat(Xa.zpusob_financovani," je povinn\xfd - vyberte zdroj financov\xe1n\xed"));break;case"lp_kod":e.lp_kod&&(Array.isArray(e.lp_kod)?0!==e.lp_kod.length:"string"===typeof e.lp_kod?e.lp_kod.trim():e.lp_kod)||(i.lp_kod="".concat(Xa.lp_kod," je povinn\xfd - vyberte limitovan\xfd p\u0159\xedslib pro financov\xe1n\xed"));break;case"cislo_smlouvy":null!==(m=e.cislo_smlouvy)&&void 0!==m&&m.trim()||(i.cislo_smlouvy="".concat(Xa.cislo_smlouvy," je povinn\xe9 - zadejte eviden\u010dn\xed \u010d\xedslo smlouvy"));break;case"individualni_schvaleni":null!==(f=e.individualni_schvaleni)&&void 0!==f&&f.trim()||(i.individualni_schvaleni="".concat(Xa.individualni_schvaleni," je povinn\xfd - zadejte identifik\xe1tor schv\xe1len\xed"));break;case"pojistna_udalost_cislo":null!==(h=e.pojistna_udalost_cislo)&&void 0!==h&&h.trim()||(i.pojistna_udalost_cislo="".concat(Xa.pojistna_udalost_cislo," je povinn\xe9 - zadejte \u010d\xedslo pojistn\xe9 ud\xe1losti"))}}),"ZAMITNUTA"!==o||null!==(n=e.schvaleni_komentar)&&void 0!==n&&n.trim()||(i.schvaleni_komentar="".concat(Xa.schvaleni_komentar," - uve\u010fte d\u016fvod zam\xedtnut\xed objedn\xe1vky")),"neschvaleno"!==e.stav_schvaleni&&"ceka_se"!==e.stav_schvaleni||null!==(a=e.schvaleni_komentar)&&void 0!==a&&a.trim()||(i.schvaleni_komentar="neschvaleno"===e.stav_schvaleni?"".concat(Xa.schvaleni_komentar," - vysv\u011btlete, pro\u010d objedn\xe1vku neschvalujete"):"".concat(Xa.schvaleni_komentar," - uve\u010fte d\u016fvod odlo\u017een\xed schv\xe1len\xed")),e.stav_odeslani&&""!==e.stav_odeslani.trim())&&(null!==(l=e.datum_odeslani)&&void 0!==l&&l.trim()||(i.datum_odeslani="".concat(Xa.datum_odeslani," je povinn\xe9 p\u0159i vybran\xe9m stavu odesl\xe1n\xed")));e.stav_stornovano&&(null!==(c=e.odeslani_storno_duvod)&&void 0!==c&&c.trim()||(i.odeslani_storno_duvod="".concat(Xa.odeslani_storno_duvod," je povinn\xfd - uve\u010fte, pro\u010d objedn\xe1vku stornujete")));if(!0===e.ma_byt_zverejnena||1===e.ma_byt_zverejnena){const n=null===t||void 0===t?void 0:t.registr_smluv_vyplneni;(!n||n.visible&&!n.locked)&&(e.dt_zverejneni&&String(e.dt_zverejneni).trim()||(i.dt_zverejneni="Datum zve\u0159ejn\u011bn\xed je povinn\xe9 kdy\u017e m\xe1 b\xfdt objedn\xe1vka zve\u0159ejn\u011bna"),e.registr_iddt&&String(e.registr_iddt).trim()||(i.registr_iddt="Identifik\xe1tor IDDT je povinn\xfd kdy\u017e m\xe1 b\xfdt objedn\xe1vka zve\u0159ejn\u011bna"))}e.stav_fakturace&&""!==e.stav_fakturace.trim()&&(null!==(p=e.datum_fakturace)&&void 0!==p&&p.trim()||(i.datum_fakturace="".concat(Xa.datum_fakturace," je povinn\xe9 p\u0159i vybran\xe9m stavu fakturace")),null!==(u=e.cislo_faktury)&&void 0!==u&&u.trim()||(i.cislo_faktury="".concat(Xa.cislo_faktury," je povinn\xe9 - zadejte \u010d\xedslo p\u0159ijat\xe9 faktury")),(!e.fakturovana_cena_bez_dph||parseFloat(e.fakturovana_cena_bez_dph)<=0)&&(i.fakturovana_cena_bez_dph="".concat(Xa.fakturovana_cena_bez_dph," je povinn\xe1 a mus\xed b\xfdt v\u011bt\u0161\xed ne\u017e 0 - zadejte \u010d\xe1stku z faktury bez DPH")),(!e.fakturovana_cena_s_dph||parseFloat(e.fakturovana_cena_s_dph)<=0)&&(i.fakturovana_cena_s_dph="".concat(Xa.fakturovana_cena_s_dph," je povinn\xe1 a mus\xed b\xfdt v\u011bt\u0161\xed ne\u017e 0 - zadejte celkovou \u010d\xe1stku z faktury v\u010detn\u011b DPH")));return i},eo=function(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return{objednatel:!0,schvaleni:!0,financovani:!0,dodavatel:!0,kontakt:!0,detaily:!0,dodaci_podminky:!0,stav_odeslani:!0};const n=(e=>{const n=["objednatel","schvaleni"];switch(e){case"NOVA":case"ODESLANA_KE_SCHVALENI":case"ZAMITNUTA":default:return n;case"SCHVALENA":case"CEKA_POTVRZENI":case"POTVRZENA":case"DOKONCENA":return[...n,"financovani","dodavatel","kontakt","detaily","dodaci_podminky","stav_odeslani"];case"ZRUSENA":return[...n,"stav_odeslani"]}})(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"NOVA"),a={objednatel:n.includes("objednatel"),schvaleni:n.includes("schvaleni")},o={financovani:n.includes("financovani"),dodavatel:e>=2&&n.includes("dodavatel"),kontakt:e>=2&&n.includes("kontakt"),detaily:e>=2&&n.includes("detaily"),dodaci_podminky:e>=2&&n.includes("dodaci_podminky"),stav_odeslani:e>=2&&n.includes("stav_odeslani")};return(0,t.A)((0,t.A)({},a),o)};var no=a(1574),ao=a(54153),oo=a(98201);var to=a(90388);"undefined"!==typeof window&&(window.__orderFormCurrentInstanceId||(window.__orderFormCurrentInstanceId=null),window.__orderFormInitInProgress||(window.__orderFormInitInProgress=!1));const io=e=>{let{token:n,username:a,userId:o,editOrderId:i,archivovanoParam:s,onDataLoaded:d,onError:l,onReady:c}=e;const p=(()=>{const[e,n]=(0,r.useReducer)(oo.JK,oo.MY),a=(0,r.useCallback)(()=>{n({type:oo.jm.START_DICTIONARIES_LOAD})},[]),o=(0,r.useCallback)(()=>{n({type:oo.jm.DICTIONARIES_LOADED})},[]),t=(0,r.useCallback)(()=>{n({type:oo.jm.START_DATA_LOAD})},[]),i=(0,r.useCallback)(()=>{n({type:oo.jm.DATA_LOADED})},[]),s=(0,r.useCallback)(()=>{n({type:oo.jm.READY})},[]),d=(0,r.useCallback)(e=>{n({type:oo.jm.ERROR,payload:e})},[]),l=(0,r.useCallback)(()=>{n({type:oo.jm.RESET})},[]);return{phase:e.phase,isInitializing:e.isInitializing,isLoadingDictionaries:e.isLoadingDictionaries,isLoadingFormData:e.isLoadingFormData,isReady:e.isReady,error:e.error,phaseHistory:e.phaseHistory,startDictionariesLoad:a,dictionariesLoaded:o,startDataLoad:t,dataLoaded:i,setReady:s,setError:d,reset:l,isInPhase:n=>e.phase===n,canLoadData:()=>e.phase===oo.M9.READY_FOR_DATA}})(),u=(0,to.W)({token:n,username:a,enabled:!0}),v=(e=>{let{token:n,username:a,dictionaries:o}=e;const[i,s]=(0,r.useState)(!1),[d,l]=(0,r.useState)(null),c=(0,r.useRef)(!1),p=(0,r.useCallback)(e=>{if(!e)return null;const n=e.titul_pred||"",a=e.jmeno||"",o=e.prijmeni||"",t=e.titul_za||"";return{displayName:"".concat(n?n+" ":"").concat(a," ").concat(o).concat(t?", "+t:"").trim(),email:e.email||"",telefon:e.telefon||""}},[]),u=(0,r.useCallback)((e,n)=>{var a,o,i,r;if(!e)return null;let s={};if(e.objednatel_id){var d,l;if(null!==(d=e._enriched)&&void 0!==d&&d.objednatel){const n=p(e._enriched.objednatel);n&&(s={jmeno:n.displayName,email:n.email,telefon:n.telefon})}if(!s.jmeno&&null!==n&&void 0!==n&&null!==(l=n.data)&&void 0!==l&&l.allUsers){const a=n.data.allUsers.find(n=>n.id&&n.id===e.objednatel_id||n.user_id&&n.user_id===e.objednatel_id);if(a){const e=a.titul_pred?a.titul_pred+" ":"",n=a.jmeno||"",o=a.prijmeni||"",t=a.titul_za?", "+a.titul_za:"";s={jmeno:"".concat(e).concat(n," ").concat(o).concat(t).replace(/\s+/g," ").trim()||a.username||"",email:a.email||"",telefon:a.telefon||""}}}}const c=Array.isArray(e.strediska_kod)?e.strediska_kod.map(e=>String(e).toUpperCase()):null!==(v=e._enriched)&&void 0!==v&&v.strediska&&Array.isArray(e._enriched.strediska)?e._enriched.strediska.map(e=>e.kod.toUpperCase()):[],u=(()=>{if(e.financovani&&"object"===typeof e.financovani)return e.financovani.typ||"";if(e.financovani&&"string"===typeof e.financovani)try{const n=JSON.parse(e.financovani);return n.typ||n.kod_stavu||""}catch(n){return e.zpusob_financovani||""}return e.zpusob_financovani||""})();var v;let _={};e.financovani&&"object"===typeof e.financovani&&(_={lp_kod:e.financovani.lp_kody||[],lp_nazev:e.financovani.nazev||"",paragraf:e.financovani.paragraf||"",polozka:e.financovani.polozka||"",investice:e.financovani.investice||"",cislo_smlouvy:e.cislo_smlouvy||e.financovani.cislo_smlouvy||"",smlouva_poznamka:e.smlouva_poznamka||e.financovani.smlouva_poznamka||""});const m=e.individualni_schvaleni?String(e.individualni_schvaleni):null!==(a=e.financovani)&&void 0!==a&&a.individualni_schvaleni?String(e.financovani.individualni_schvaleni):"",f=e.individualni_poznamka||(null===(o=e.financovani)||void 0===o?void 0:o.individualni_poznamka)||"",h=e.pojistna_udalost_cislo||(null===(i=e.financovani)||void 0===i?void 0:i.pojistna_udalost_cislo)||"",k=e.pojistna_udalost_poznamka||(null===(r=e.financovani)||void 0===r?void 0:r.pojistna_udalost_poznamka)||"",g="string"===typeof e.druh_objednavky_kod?e.druh_objednavky_kod:e.druh_objednavky_kod&&"object"===typeof e.druh_objednavky_kod&&(e.druh_objednavky_kod.kod_stavu||e.druh_objednavky_kod.kod)||"",b=(()=>{try{const n=Array.isArray(e.stav_workflow_kod)?e.stav_workflow_kod:JSON.parse(e.stav_workflow_kod||'["NOVA"]');if(!Array.isArray(n)||0===n.length)return"Nov\xe1";const a=n[n.length-1],o=qa[a];return o?o.name:a||"Nov\xe1"}catch(n){return"Nov\xe1"}})(),y=(0,t.A)((0,t.A)((0,t.A)((0,t.A)({},e),s),{},{id:e.id,ev_cislo:e.cislo_objednavky||e.ev_cislo,stav_workflow_kod:e.stav_workflow_kod||"NOVA",stav_objednavky:b,mimoradna_udalost:e.mimoradna_udalost||!1,stav_odeslano:(()=>{try{const n=Array.isArray(e.stav_workflow_kod)?e.stav_workflow_kod:JSON.parse(e.stav_workflow_kod||"[]"),a=Array.isArray(n)&&n.includes("ODESLANA"),o=!!e.dt_odeslani,t=!!e.odesilatel_id;return a&&o&&t}catch(n){return!1}})(),stav_stornovano:(()=>{try{const n=Array.isArray(e.stav_workflow_kod)?e.stav_workflow_kod:JSON.parse(e.stav_workflow_kod||"[]");return Array.isArray(n)&&n.includes("STORNOVANA")}catch(n){return!1}})(),stav_schvaleni:(()=>{try{const n=Array.isArray(e.stav_workflow_kod)?e.stav_workflow_kod:JSON.parse(e.stav_workflow_kod||"[]");return Array.isArray(n)?n.includes("SCHVALENA")?"schvaleno":n.includes("ZAMITNUTA")?"neschvaleno":n.includes("CEKA_SE")?"ceka_se":"":""}catch(n){return""}})(),datum_odeslani:e.dt_odeslani||e.dt_odeslano?(e.dt_odeslani||e.dt_odeslano).split(" ")[0]:"",datum_storna:e.dt_odeslani||e.dt_odeslano?(e.dt_odeslani||e.dt_odeslano).split(" ")[0]:"",dt_akceptace:e.dt_akceptace?e.dt_akceptace.split(" ")[0]:"",datum_vytvoreni:e.dt_vytvoreni?e.dt_vytvoreni.split(" ")[0]:"",datum_splatnosti:e.dt_splatnost?e.dt_splatnost.split(" ")[0]:"",temp_datum_objednavky:e.datum_objednavky?e.datum_objednavky.split(" ")[0]:e.dt_objednavky?e.dt_objednavky.split(" ")[0]:"",odesilatel_id:e.odesilatel_id||null,dodavatel_potvrdil_id:e.dodavatel_potvrdil_id||null,zverejnil_id:e.zverejnil_id||null,dt_zverejneni_potvrzeni:e.dt_zverejneni_potvrzeni?e.dt_zverejneni_potvrzeni.split(" ")[0]:"",potvrdil_vecnou_spravnost_id:e.potvrdil_vecnou_spravnost_id||null,dt_potvrzeni_vecne_spravnosti:e.dt_potvrzeni_vecne_spravnosti||"",potvrzeni_vecne_spravnosti:(()=>{const n=e.potvrzeni_vecne_spravnosti;return"boolean"===typeof n?n?1:0:"number"===typeof n?n:"string"===typeof n&&parseInt(n,10)||0})(),vecna_spravnost_umisteni_majetku:e.vecna_spravnost_umisteni_majetku||"",vecna_spravnost_poznamka:e.vecna_spravnost_poznamka||"",fakturant_id:e.fakturant_id||null,dt_faktura_pridana:e.dt_faktura_pridana||"",dokoncil_id:e.dokoncil_id||null,dt_dokonceni:e.dt_dokonceni||"",dokonceni_poznamka:e.dokonceni_poznamka||"",potvrzeni_dokonceni_objednavky:(()=>{const n=e.potvrzeni_dokonceni_objednavky;return"boolean"===typeof n?n?1:0:"number"===typeof n?n:"string"===typeof n&&parseInt(n,10)||0})(),strediska_kod:c,zpusob_financovani:u},_),{},{individualni_schvaleni:m,individualni_poznamka:f,pojistna_udalost_cislo:h,pojistna_udalost_poznamka:k,druh_objednavky_kod:g,polozky_objednavky:Array.isArray(e.polozky)?e.polozky:[],faktury:Array.isArray(e.faktury)?e.faktury.map(e=>(0,t.A)((0,t.A)({},e),{},{fa_dorucena:e.fa_datum_doruceni?1:0,fa_splatnost:e.fa_datum_splatnosti?e.fa_datum_splatnosti.split(" ")[0]:"",fa_datum_doruceni:e.fa_datum_doruceni,fa_datum_splatnosti:e.fa_datum_splatnosti,fa_datum_vystaveni:e.fa_datum_vystaveni,attachments:e.attachments||[]})):[],dodavatel_zpusob_potvrzeni:(()=>{try{const n=!(!e.dt_akceptace||!e.dodavatel_potvrdil_id);if(!e.dodavatel_zpusob_potvrzeni||""===e.dodavatel_zpusob_potvrzeni||"string"===typeof e.dodavatel_zpusob_potvrzeni&&""===e.dodavatel_zpusob_potvrzeni.trim())return n?{potvrzeni:"ANO",zpusoby:[],platba:"faktura"}:{potvrzeni:"NE",zpusoby:[],platba:"faktura"};if("object"===typeof e.dodavatel_zpusob_potvrzeni){const a=e.dodavatel_zpusob_potvrzeni;return{potvrzeni:(void 0!==a.potvrzeno?a.potvrzeno:n)?"ANO":"NE",zpusoby:a.zpusoby||a.zpusob||a.zpusob_potvrzeni||[],platba:"faktura"}}if("string"===typeof e.dodavatel_zpusob_potvrzeni){const a=e.dodavatel_zpusob_potvrzeni.trim();if(0===a.length)return{potvrzeni:"NE",zpusoby:[],platba:""};const o=JSON.parse(a);return{potvrzeni:(void 0!==o.potvrzeno?o.potvrzeno:n)?"ANO":"NE",zpusoby:o.zpusoby||o.zpusob||o.zpusob_potvrzeni||[],platba:"faktura"}}return{potvrzeni:"NE",zpusoby:[],platba:"faktura"}}catch(n){return{potvrzeni:"NE",zpusoby:[],platba:""}}})()}),x=Array.isArray(y.stav_workflow_kod)?y.stav_workflow_kod:y.stav_workflow_kod?[y.stav_workflow_kod]:[];return"ARCHIVOVANO"===e.stav_objednavky||"Archivov\xe1no"===e.stav_objednavky||x.includes("ARCHIVOVANO")?(y.stav_workflow_kod=["ARCHIVOVANO"],y.stav_objednavky="Archivov\xe1no",y.stav_odeslano=!0,y.stav_schvaleni="schvaleno",(y.ma_byt_zverejnena||1===y.ma_byt_zverejnena)&&(y.dt_zverejneni=y.dt_zverejneni||(new Date).toISOString().split("T")[0]),y.potvrzeni_vecne_spravnosti=1,0===y.prikazce_id||null===y.prikazce_id||""===y.prikazce_id?y.prikazce_id="0":y.prikazce_id&&(y.prikazce_id=String(y.prikazce_id)),0===y.schvalovatel_id||null===y.schvalovatel_id||""===y.schvalovatel_id?y.schvalovatel_id="0":y.schvalovatel_id&&(y.schvalovatel_id=String(y.schvalovatel_id))):(null!==y.prikazce_id&&void 0!==y.prikazce_id&&""!==y.prikazce_id&&(y.prikazce_id=String(y.prikazce_id)),null!==y.schvalovatel_id&&void 0!==y.schvalovatel_id&&""!==y.schvalovatel_id&&(y.schvalovatel_id=String(y.schvalovatel_id))),y},[p]);return{loading:i,error:d,loadOrderForEdit:(0,r.useCallback)(async e=>{let{orderId:i,archivovano:r=0}=e;if(!n||!a)throw console.error("\u274c [useOrderDataLoader] Missing token or username!"),new Error("Missing token or username");if(c.current)return null;c.current=!0,s(!0),l(null);try{const e=await(0,La.getOrderV2)(i,n,a,!0);if(!e)throw console.error("\u274c [useOrderDataLoader] dbOrder is null!"),new Error("Order ".concat(i," not found"));if(e.faktury&&Array.isArray(e.faktury)&&e.faktury.length>0){const o=await Promise.all(e.faktury.map(async e=>{let o=[];if(e.id&&!String(e.id).startsWith("temp-"))try{var r;const t=await(0,La.CX)(e.id,a,n,i);o=(null===(r=t.data)||void 0===r?void 0:r.attachments)||t.data||[]}catch(s){console.error("\u274c [useOrderDataLoader] Chyba p\u0159i na\u010d\xedt\xe1n\xed p\u0159\xedloh faktury ID=".concat(e.id,":"),s),o=[]}return(0,t.A)((0,t.A)({},e),{},{attachments:o})}));e.faktury=o}else e.faktury&&Array.isArray(e.faktury)&&(e.faktury=e.faktury.map(e=>(0,t.A)((0,t.A)({},e),{},{attachments:[]})));return u(e,o)}catch(d){throw console.error("\u274c [useOrderDataLoader] Error in loadOrderForEdit:",d),l(d.message),d}finally{s(!1),c.current=!1}},[n,a,o,u]),loadOrderForCopy:(0,r.useCallback)(async e=>{let{orderId:i,archivovano:r=0,userId:d}=e;if(!n||!a)throw new Error("Missing token or username");if(c.current)return null;c.current=!0,s(!0),l(null);try{const e=await(0,La.getOrderV2)(i,n,a,!0);if(!e)throw new Error("Order ".concat(i," not found"));const r=await(0,La.XY)(n,a),s=(null===r||void 0===r?void 0:r.order_number_string)||(null===r||void 0===r?void 0:r.next_order_string)||(null===r||void 0===r?void 0:r.next_number);if(!s)throw new Error("Failed to get new order number");const l=u(e,o);return{data:(0,t.A)((0,t.A)({},l),{},{id:null,objednavka_id:null,ev_cislo:s,temp_datum_objednavky:(new Date).toISOString().split("T")[0],stav_workflow_kod:"NOVA",schvalovatel_id:"",dt_schvaleni:"",schvaleni_komentar:"",datum_vytvoreni:"",datum_posledni_zmeny:"",vytvoril_uzivatel_id:d,uzivatel_id:d,stav_odeslano:!1,datum_odeslani:"",stav_stornovano:!1,datum_storna:"",prilohy_dokumenty:[],faktury:[]}),sourceOrderId:i}}catch(p){throw l(p.message),p}finally{s(!1),c.current=!1}},[n,a,o,u])}})({token:n,username:a,dictionaries:u}),_=(()=>{const[e,n]=(0,r.useReducer)(oo.DN,oo.ar),a=(0,r.useCallback)(e=>{n({type:oo.Hg.OPEN_MODAL,payload:e})},[]),o=(0,r.useCallback)(e=>{n({type:oo.Hg.CLOSE_MODAL,payload:e})},[]),t=(0,r.useCallback)(()=>{n({type:oo.Hg.CLOSE_ALL_MODALS})},[]),i=(0,r.useCallback)(e=>{n({type:oo.Hg.TOGGLE_DROPDOWN,payload:e})},[]),s=(0,r.useCallback)(()=>{n({type:oo.Hg.CLOSE_ALL_DROPDOWNS})},[]),d=(0,r.useCallback)(e=>{n({type:oo.Hg.COLLAPSE_SECTION,payload:e})},[]),l=(0,r.useCallback)(e=>{n({type:oo.Hg.EXPAND_SECTION,payload:e})},[]),c=(0,r.useCallback)(e=>{n({type:oo.Hg.TOGGLE_SECTION,payload:e})},[]),p=(0,r.useCallback)(()=>{n({type:oo.Hg.COLLAPSE_ALL_SECTIONS})},[]),u=(0,r.useCallback)(()=>{n({type:oo.Hg.EXPAND_ALL_SECTIONS})},[]),v=(0,r.useCallback)(e=>{n({type:oo.Hg.LOCK_SECTION,payload:e})},[]),_=(0,r.useCallback)(e=>{n({type:oo.Hg.UNLOCK_SECTION,payload:e})},[]),m=(0,r.useCallback)((e,a)=>{n({type:oo.Hg.SET_SELECT_STATE,payload:{key:e,value:a}})},[]),f=(0,r.useCallback)((e,a)=>{n({type:oo.Hg.SET_SEARCH_STATE,payload:{key:e,value:a}})},[]),h=(0,r.useCallback)(()=>{n({type:oo.Hg.TOGGLE_FULLSCREEN})},[]),k=(0,r.useCallback)(e=>{n({type:oo.Hg.SET_FULLSCREEN,payload:e})},[]),g=(0,r.useCallback)(()=>{n({type:oo.Hg.TOGGLE_DEBUG})},[]),b=(0,r.useCallback)(e=>{n({type:oo.Hg.PIN_DEBUG,payload:e})},[]),y=(0,r.useCallback)((e,a)=>{n({type:oo.Hg.SET_SAVE_PROGRESS,payload:{value:e,text:a}})},[]),x=(0,r.useCallback)(()=>{n({type:oo.Hg.SHOW_SAVE_PROGRESS})},[]),j=(0,r.useCallback)(()=>{n({type:oo.Hg.HIDE_SAVE_PROGRESS})},[]),z=(0,r.useCallback)(e=>{n({type:oo.Hg.SET_ICO_CHECK_STATUS,payload:e})},[]),A=(0,r.useCallback)(e=>{n({type:oo.Hg.SET_ICO_CHECK_DATA,payload:e})},[]),w=(0,r.useCallback)(e=>{n({type:oo.Hg.SET_DRAG_OVER,payload:e})},[]),S=(0,r.useCallback)(()=>{n({type:oo.Hg.RESET})},[]);return{modals:e.modals,dropdowns:e.dropdowns,sections:e.sections,selectStates:e.selectStates,searchStates:e.searchStates,fullscreen:e.fullscreen,areSectionsCollapsed:e.areSectionsCollapsed,debug:e.debug,saveProgress:e.saveProgress,icoCheckStatus:e.icoCheckStatus,icoCheckData:e.icoCheckData,dragOver:e.dragOver,openModal:a,closeModal:o,closeAllModals:t,toggleDropdown:i,closeAllDropdowns:s,collapseSection:d,expandSection:l,toggleSection:c,collapseAllSections:p,expandAllSections:u,lockSection:v,unlockSection:_,setSelectState:m,setSearchState:f,toggleFullscreen:h,setFullscreen:k,toggleDebug:g,pinDebug:b,setSaveProgress:y,showSaveProgress:x,hideSaveProgress:j,setIcoCheckStatus:z,setIcoCheckData:A,setDragOver:w,reset:S}})(),m=(0,r.useRef)("form_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))),f=(0,r.useRef)(!1),h=(0,r.useRef)(!1),k=(0,r.useRef)(!1),g=(0,r.useRef)(!0),b=(0,r.useRef)(!1),y=(0,r.useRef)(),x=(0,r.useRef)(),j=(0,r.useRef)(),z=(0,r.useRef)(),A=(0,r.useRef)(),w=(0,r.useRef)();return y.current=p,x.current=u,j.current=v,z.current=d,A.current=l,w.current=c,(0,r.useEffect)(()=>{const e=m.current;return()=>{const n=window.__orderFormInitInProgress&&window.__orderFormCurrentInstanceId===e,a=Date.now()-parseInt(e.split("_")[1]);a<100&&n?b.current=!0:a<500?setTimeout(()=>{window.__orderFormCurrentInstanceId===e&&(window.__orderFormInitInProgress=!1,window.__orderFormCurrentInstanceId=null),h.current=!0},1e3):setTimeout(()=>{window.__orderFormCurrentInstanceId===e&&(window.__orderFormInitInProgress=!1,window.__orderFormCurrentInstanceId=null),h.current=!0},200)}},[]),(0,r.useEffect)(()=>{m.current;if(g.current=!0,k.current=!1,f.current=!1,h.current=!1,b.current=!1,window.__orderFormCurrentInstanceId===m.current&&(window.__orderFormInitInProgress=!1,window.__orderFormCurrentInstanceId=null),p.reset(),(!h.current||b.current)&&(b.current&&(b.current=!1),n&&a)){k.current=!0;const e=async()=>{const e=m.current;if(f.current)return{success:!1,reason:"already_running"};if(window.__orderFormInitInProgress&&window.__orderFormCurrentInstanceId!==e)return{success:!1,reason:"other_instance_running"};f.current=!0,window.__orderFormInitInProgress=!0,window.__orderFormCurrentInstanceId=e;try{const e=y.current,n=x.current,a=j.current,o=z.current,t=(A.current,w.current);if(n.isReady)e.dictionariesLoaded();else{e.startDictionariesLoad();if(!await n.loadAll())throw new Error("Failed to load dictionaries");0,e.dictionariesLoaded()}let r=null,d=null;return i?(e.startDataLoad(),r=await a.loadOrderForEdit({orderId:i,archivovano:"1"===s?1:0}),e.dataLoaded()):(e.dataLoaded(),r={}),e.setReady(),o&&o(r,d),t&&t(),f.current=!1,window.__orderFormInitInProgress=!1,{success:!0,data:r,sourceOrderId:d}}catch(n){const a=y.current,o=A.current;return a.setError(n.message),f.current=!1,window.__orderFormInitInProgress=!1,window.__orderFormCurrentInstanceId===e&&(window.__orderFormCurrentInstanceId=null),o&&o(n),{success:!1,error:n.message}}};e()}},[n,a,i]),{lifecycle:{phase:p.phase,isInitializing:p.isInitializing,isLoadingDictionaries:p.isLoadingDictionaries,isLoadingFormData:p.isLoadingFormData,isReady:p.isReady,error:p.error,isInPhase:p.isInPhase,canLoadData:p.canLoadData},dictionaries:{data:u.data,loading:u.loading,errors:u.errors,isReady:u.isReady,loadedCount:u.loadedCount,totalToLoad:u.totalToLoad},orderDataLoader:{loading:v.loading,error:v.error,loadOrderForEdit:v.loadOrderForEdit},ui:_,reset:()=>{const e=m.current;p.reset(),_.reset(),f.current=!1,h.current=!1,k.current=!1,window.__orderFormCurrentInstanceId===e&&(window.__orderFormInitInProgress=!1,window.__orderFormCurrentInstanceId=null)}}},ro=new Set;const so=e=>{if(!e)return["ODESLANA_KE_SCHVALENI"];if("string"===typeof e)try{const n=JSON.parse(e);return Array.isArray(n)?n.length>0?n:["ODESLANA_KE_SCHVALENI"]:[e]}catch(a){return[e]}const n=Array.isArray(e)?e:[e];return n.length>0?n:["ODESLANA_KE_SCHVALENI"]},lo=(e,n)=>{const a=so(e),o=a.includes(n);return("string"!==typeof n||"string"===typeof n&&n.includes(",")||Array.isArray(n))&&function(e,n,a){try{const n=e+"|"+(a&&"object"===typeof a?JSON.stringify(a):String(a));if(ro.has(n))return;ro.add(n)}catch(o){if(ro.has(e))return;ro.add(e)}"undefined"!==typeof console&&(console.error?console.error(n,a):console.warn&&console.warn(n,a))}("hasWorkflowState","\u26a0\ufe0f [hasWorkflowState] CHYBA: state by m\u011bl b\xfdt string, ne pole!",{state:n,typeofState:typeof n,isArray:Array.isArray(n),workflowCode:e,parsedStates:a}),o},co={objednatel:{name:"Objednatel",phase:1,visibilityLogic:e=>e.currentPhase>=1,lockLogic:e=>{var n,a;return!(1===e.currentPhase&&!e.formData.id)&&((null===(n=e.unlockStates)||void 0===n||!n.phase1)&&((null===(a=e.unlockStates)||void 0===a||!a.phase2)&&e.currentPhase>2))}},schvaleni:{name:"Schv\xe1len\xed",phase:1,visibilityLogic:e=>e.currentPhase>=1,lockLogic:e=>{var n,a;return!(1===e.currentPhase&&!e.formData.id)&&((null===(n=e.unlockStates)||void 0===n||!n.phase1)&&((null===(a=e.unlockStates)||void 0===a||!a.phase2)&&e.currentPhase>2))}},financovani:{name:"Financov\xe1n\xed",phase:1,visibilityLogic:e=>e.currentPhase>=1,lockLogic:e=>!(e.currentPhase>=1&&e.currentPhase<=2)&&e.currentPhase>=3},dodavatel:{name:"Dodavatel",phase:3,visibilityLogic:e=>e.currentPhase>=3,lockLogic:e=>{var n;return(null===(n=e.unlockStates)||void 0===n||!n.phase3_sections)&&e.currentPhase>3}},kontakt:{name:"Kontakt",phase:3,visibilityLogic:e=>e.currentPhase>=3,lockLogic:e=>{var n;return(null===(n=e.unlockStates)||void 0===n||!n.phase3_sections)&&e.currentPhase>3}},detaily:{name:"Detaily",phase:3,visibilityLogic:e=>e.currentPhase>=3,lockLogic:e=>{var n;return(null===(n=e.unlockStates)||void 0===n||!n.phase3_sections)&&e.currentPhase>3}},dodaci_podminky:{name:"Dodac\xed podm\xednky",phase:3,visibilityLogic:e=>e.currentPhase>=3,lockLogic:e=>{var n;return(null===(n=e.unlockStates)||void 0===n||!n.phase3_sections)&&e.currentPhase>3}},stav_odeslani:{name:"Stav odesl\xe1n\xed",phase:3,visibilityLogic:e=>e.currentPhase>=3,lockLogic:e=>{var n;return(null===(n=e.unlockStates)||void 0===n||!n.phase3_sections)&&e.currentPhase>3}},potvrzeni_objednavky:{name:"Potvrzen\xed objedn\xe1vky",phase:3,visibilityLogic:e=>!e.isPokladna&&e.currentPhase>=4,lockLogic:e=>{var n;return e.currentPhase>=5&&!(null!==(n=e.unlockStates)&&void 0!==n&&n.potvrzeni)}},registr_smluv:{name:"Registr smluv",phase:4,visibilityLogic:e=>{var n;if(e.isPokladna)return!1;return"ANO"===(null===(n=e.formData.dodavatel_zpusob_potvrzeni)||void 0===n?void 0:n.potvrzeni)&&e.currentPhase>=4},lockLogic:e=>{var n;return e.currentPhase>=5&&!(null!==(n=e.unlockStates)&&void 0!==n&&n.registr)}},registr_smluv_vyplneni:{name:"Vypln\u011bn\xed registru smluv",phase:5,visibilityLogic:e=>{if(e.isPokladna)return!1;const n=lo(e.formData.stav_workflow_kod,"UVEREJNIT"),a=lo(e.formData.stav_workflow_kod,"UVEREJNENA");return n||a},lockLogic:e=>{var n;return e.currentPhase>=6&&!(null!==(n=e.unlockStates)&&void 0!==n&&n.registr_vyplneni)}},prubeh_objednavky:{name:"Pr\u016fb\u011bh objedn\xe1vky",phase:null,visibilityLogic:()=>!0,lockLogic:()=>!1},dodaci_informace:{name:"Dodac\xed informace",phase:null,visibilityLogic:()=>!0,lockLogic:()=>!1},fakturace:{name:"Fakturace",phase:6,visibilityLogic:e=>!e.isPokladna&&e.currentPhase>=6,lockLogic:e=>{var n;return e.currentPhase>=7&&!(null!==(n=e.unlockStates)&&void 0!==n&&n.fakturace)}},vecna_spravnost:{name:"V\u011bcn\xe1 spr\xe1vnost",phase:7,visibilityLogic:e=>e.currentPhase>=7,lockLogic:e=>{var n;return e.currentPhase>=8&&!(null!==(n=e.unlockStates)&&void 0!==n&&n.vecna_spravnost)}},dokonceni:{name:"Dokon\u010den\xed",phase:8,visibilityLogic:e=>lo(e.formData.stav_workflow_kod,"DOKONCENA"),lockLogic:e=>{var n;return lo(e.formData.stav_workflow_kod,"DOKONCENA")&&!(null!==(n=e.unlockStates)&&void 0!==n&&n.dokonceni)}}},po=function(e,n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const t=co[e];if(!t)return{visible:!1,enabled:!1};const i=o.isArchived||!1,r={formData:n,currentPhase:o.currentPhase||vo(n),isArchived:i,unlockStates:{phase1:a.phase1||!1,phase2:a.phase2||!1,phase3:a.phase3||!1,registr:a.registr||!1,fakturace:a.fakturace||!1,vecna_spravnost:a.vecna_spravnost||!1,dokonceni:a.dokonceni||!1,potvrzeni:a.potvrzeni||!1},canEditApprovedSections:o.canEditApprovedSections||!1,showSaveProgress:o.showSaveProgress||!1,isSaving:o.isSaving||!1,isWorkflowLocked:o.isWorkflowLocked||!1,shouldLockPhase1Sections:o.shouldLockPhase1Sections||!1,shouldLockPhase2Sections:o.shouldLockPhase2Sections||!1,shouldLockPhase3Sections:o.shouldLockPhase3Sections||!1,isRegistrLocked:o.isRegistrLocked||!1,isFakturaceDisplayLocked:o.isFakturaceDisplayLocked||!1,isVecnaSpravnostLocked:o.isVecnaSpravnostLocked||!1,isDokonceniLocked:o.isDokonceniLocked||!1},s=i||t.visibilityLogic(r);if(r.isWorkflowLocked)return{visible:s,enabled:!1};return{visible:s,enabled:!(!!s&&(!i&&t.lockLogic(r)))}},uo=[{id:1,name:"Vytvo\u0159en\xed",class:"phase-1",description:"Vytvo\u0159en\xed konceptu"},{id:2,name:"Ke schv\xe1len\xed",class:"phase-2",description:"\u010cek\xe1 na schv\xe1len\xed"},{id:3,name:"Schv\xe1len\xe1",class:"phase-3",description:"Schv\xe1len\xe1, rozpracovan\xe1"},{id:4,name:"Odesl\xe1no",class:"phase-4",description:"Odesl\xe1no dodavateli"},{id:5,name:"Potvrzen\xe1",class:"phase-5",description:"Potvrzena dodavatelem"},{id:6,name:"Rozhodnut\xed",class:"phase-6",description:"Rozhodnut\xed o zve\u0159ejn\u011bn\xed"},{id:7,name:"Uve\u0159ejn\u011bn\xed",class:"phase-7",description:"Vypln\u011bn\xed \xfadaj\u016f o zve\u0159ejn\u011bn\xed"},{id:8,name:"Fakturace",class:"phase-8",description:"Faktury p\u0159id\xe1ny"},{id:9,name:"V\u011bcn\xe1 spr\xe1vnost",class:"phase-9",description:"V\u011bcn\xe1 spr\xe1vnost"},{id:10,name:"Dokon\u010den\xe1",class:"phase-10",description:"Hotovo"}],vo=e=>{if(!e.id||lo(e.stav_workflow_kod,"NOVA"))return 1;const n=so(e.stav_workflow_kod);return{DOKONCENA:8,ZKONTROLOVANA:8,VECNA_SPRAVNOST:7,FAKTURACE:6,NEUVEREJNIT:6,UVEREJNENA:6,UVEREJNIT:5,POTVRZENA:4,ODESLANA:4,ROZPRACOVANA:3,SCHVALENA:3,ZRUSENA:3,ZAMITNUTA:3,CEKA_SE:2,ODESLANA_KE_SCHVALENI:2,NOVA:1}[n[n.length-1]]||1},_o=function(e){var n,a;let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[i,s]=(0,r.useState)(0),d=(0,r.useMemo)(()=>{var n,a;const o="pokladna"===(null===(n=e.financovani)||void 0===n?void 0:n.platba),t="pokladna"===(null===(a=e.dodavatel_zpusob_potvrzeni)||void 0===a?void 0:a.platba);return o||t},[null===(n=e.financovani)||void 0===n?void 0:n.platba,null===(a=e.dodavatel_zpusob_potvrzeni)||void 0===a?void 0:a.platba]),[l,c]=(0,r.useState)({phase1:!1,phase2:!1,phase3_sections:!1,potvrzeni:!1,registr:!1,registr_vyplneni:!1,fakturace:!1,vecna_spravnost:!1,dokonceni:!1}),p=(0,r.useCallback)(e=>{c(n=>(0,t.A)((0,t.A)({},n),{},{[e]:!0}))},[]),u=(0,r.useCallback)(e=>{c(n=>(0,t.A)((0,t.A)({},n),{},{[e]:!1}))},[]),v=(0,r.useCallback)(e=>l[e]||!1,[l]),_=(0,r.useCallback)(()=>{c({phase1:!1,phase2:!1,phase3_sections:!1,potvrzeni:!1,registr:!1,registr_vyplneni:!1,fakturace:!1,vecna_spravnost:!1,dokonceni:!1})},[]),m=(0,r.useCallback)(()=>{s(e=>e+1)},[]),f=(0,r.useMemo)(()=>{if(o)return 8;return vo(e)},[e.id,e.stav_workflow_kod,i,o]),h=(0,r.useMemo)(()=>{return n=e.stav_workflow_kod,e.stav_stornovano||lo(n,"ZRUSENA")?"phase-error":lo(n,"POTVRZENA")||lo(n,"DOKONCENA")?"phase-4":lo(n,"SCHVALENA")&&lo(n,"ODESLANA")?"phase-3":lo(n,"SCHVALENA")?"phase-2":"phase-1";var n},[e.stav_workflow_kod,e.stav_stornovano]),k=(0,r.useMemo)(()=>{const n=e.stav_stornovano,a=e.stav_workflow_kod;return{currentPhase:f,phases:uo.map((e,o)=>{const i=o+1;let r=e.class,s=!1;return(n||lo(a,"ZRUSENA"))&&i>=2?(r="phase-error",s=i<=Math.max(f,2)):s=i<=f,(0,t.A)((0,t.A)({},e),{},{isVisible:s,isCurrent:i===f,fillClass:r})})}},[f,e.stav_stornovano,e.stav_workflow_kod]),g=(0,r.useCallback)(()=>f,[f]),b=(0,r.useCallback)(()=>k,[k]),y=(0,r.useCallback)(()=>h,[h]),x=(0,r.useCallback)(n=>so(n||e.stav_workflow_kod),[e.stav_workflow_kod]),j=(0,r.useCallback)((n,a)=>void 0===a?lo(e.stav_workflow_kod,n):lo(n,a),[e.stav_workflow_kod]),z=(0,r.useMemo)(()=>{const n=so(e.stav_workflow_kod),a=["DOKONCENA","POTVRZENA","CEKA_POTVRZENI","SCHVALENA","ODESLANA_KE_SCHVALENI","ZAMITNUTA","ZRUSENA","NOVA"];for(const e of a)if(n.includes(e)){return{CEKA_SE:"ODESLANA_KE_SCHVALENI",ODESLANA:"CEKA_POTVRZENI"}[e]||e}const o=n.length>0?n[n.length-1]:"NOVA";return"ROZPRACOVANA"===o&&n.includes("SCHVALENA")?"SCHVALENA":o||"NOVA"},[e.stav_workflow_kod]),A=(0,r.useCallback)(function(n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return po(n,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},(0,t.A)({currentPhase:f,isPokladna:d,isArchived:o},a))},[e,f,d,o]),w=(0,r.useCallback)(function(n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(e,n){return!po(e,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).enabled}(n,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},(0,t.A)({currentPhase:f,isPokladna:d},a))},[e,f,d]),S=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a={};return Object.keys(co).forEach(o=>{a[o]=w(o,e,n)}),a},[w]),E=(0,r.useMemo)(()=>!(!e.id||!(j(e.stav_workflow_kod,"DOKONCENA")||j(e.stav_workflow_kod,"ZAMITNUTA")||j(e.stav_workflow_kod,"ZRUSENA"))),[e.id,e.stav_workflow_kod,j,i]),C=(0,r.useMemo)(()=>!(!e.id||!j(e.stav_workflow_kod,"ZAMITNUTA")),[e.id,e.stav_workflow_kod,j,i]),N=(0,r.useMemo)(()=>!(!e.id||!j(e.stav_workflow_kod,"ZRUSENA")),[e.id,e.stav_workflow_kod,j,i]),O=(0,r.useMemo)(()=>E||C||N,[E,C,N]),D=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n={},a=(0,t.A)((0,t.A)({},e),{},{isWorkflowLocked:O});return Object.keys(co).forEach(e=>{n[e]=A(e,l,a)}),n},[A,f,e.id,l,O]),T=(0,r.useCallback)(()=>(e=>{const n=JSON.stringify(["ODESLANA_KE_SCHVALENI"]);return{updatedFormData:(0,t.A)((0,t.A)({},e),{},{stav_odeslano:!1,datum_odeslani:"",stav_stornovano:!1,datum_storna:"",odeslani_storno_duvod:"",stav_workflow_kod:n,dodavatel_zpusob_potvrzeni:{potvrzeni:"",datum:"",zpusob:"",poznamka:""},dt_akceptace:"",stav_u_dodavatele:"",datum_zmeny_stavu:"",poznamka_stav:"",cislo_zasilky:"",prepravce:"",ocekavane_doruceni:"",skutecne_doruceni:"",cislo_faktury:"",datum_faktury:"",castka_bez_dph:"",castka_s_dph:"",datum_platby:"",dt_zverejneni:"",registr_iddt:"",ma_byt_zverejnena:!1,faktury:[]}),unlockState:"phase2",newPhase:2}})(e),[e]),I=(0,r.useCallback)(()=>(e=>{const n=JSON.stringify(["SCHVALENA"]);return{updatedFormData:(0,t.A)((0,t.A)({},e),{},{stav_workflow_kod:n,stav_odeslano:!1,datum_odeslani:"",dodavatel_zpusob_potvrzeni:{potvrzeni:"",datum:"",zpusob:"",poznamka:""},dt_akceptace:"",stav_u_dodavatele:"",datum_zmeny_stavu:"",poznamka_stav:"",cislo_zasilky:"",prepravce:"",ocekavane_doruceni:"",skutecne_doruceni:"",cislo_faktury:"",datum_faktury:"",castka_bez_dph:"",castka_s_dph:"",datum_platby:"",faktury:[],dt_zverejneni:"",registr_iddt:"",ma_byt_zverejnena:!1,potvrdil_vecnou_spravnost_id:"",dt_potvrzeni_vecne_spravnosti:"",vecna_spravnost_poznamka:""}),unlockState:"phase3_sections",newPhase:3}})(e),[e]),P=(0,r.useCallback)(()=>(e=>{const n=JSON.stringify(["SCHVALENA","ODESLANA"]);return{updatedFormData:(0,t.A)((0,t.A)({},e),{},{stav_workflow_kod:n,dodavatel_zpusob_potvrzeni:{potvrzeni:"",datum:"",zpusob:"",poznamka:""},dt_akceptace:"",dt_zverejneni:"",registr_iddt:"",faktury:[],potvrdil_vecnou_spravnost_id:null,dt_potvrzeni_vecne_spravnosti:"",potvrzeni_vecne_spravnosti:0,dokoncil_id:null,dt_dokonceni:"",potvrzeni_dokonceni_objednavky:0}),unlockState:"potvrzeni",newPhase:4}})(e),[e]);return{currentPhase:f,phaseTheme:h,phaseProgress:k,mainWorkflowState:z,isPokladna:d,isArchived:o,isWorkflowCompleted:E,isWorkflowRejected:C,isWorkflowCancelled:N,forceRefresh:m,unlockSection:p,lockSection:u,isSectionUnlocked:v,resetAllUnlocks:_,unlockPhase2:T,unlockPhase3:I,unlockPhase4:P,getCurrentPhase:g,getPhaseProgress:b,getPhaseTheme:y,parseWorkflowStates:x,hasWorkflowState:j,getSectionState:A,getAllSectionStates:D,getSectionLockState:w,getAllSectionLockStates:S,sectionDefinitions:co,phaseDefinitions:uo}};var mo,fo,ho,ko,go,bo,yo,xo,jo,zo,Ao,wo,So,Eo,Co=a(56366),No=a(9227),Oo=a(68951),Do=a(36629),To=a(1267);const Io=l.A.div(mo||(mo=(0,i.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.85);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n  padding: 0;\n"]))),Po=l.A.div(fo||(fo=(0,i.A)(["\n  background: white;\n  border-radius: 0;\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n"]))),Lo=l.A.div(ho||(ho=(0,i.A)(["\n  padding: 20px 24px;\n  border-bottom: 2px solid #e5e7eb;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  background: linear-gradient(135deg, #059669 0%, #047857 100%);\n  color: white;\n"]))),Ro=l.A.h2(ko||(ko=(0,i.A)(["\n  margin: 0;\n  font-size: 1.5rem;\n  font-weight: 700;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n"]))),Vo=l.A.button(go||(go=(0,i.A)(["\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  font-size: 1.5rem;\n  cursor: pointer;\n  padding: 8px 12px;\n  border-radius: 6px;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n"]))),Fo=l.A.div(bo||(bo=(0,i.A)(["\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background: #f9fafb;\n"]))),Mo=l.A.div(yo||(yo=(0,i.A)(["\n  flex: 1;\n  padding: 0;\n  overflow: hidden;\n  display: flex;\n\n  iframe {\n    width: 100%;\n    height: 100%;\n    border: none;\n    background: white;\n  }\n"]))),Uo=l.A.div(xo||(xo=(0,i.A)(["\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: #6b7280;\n  gap: 20px;\n  min-height: 400px;\n  background: #f9fafb;\n\n  svg {\n    font-size: 4rem;\n    color: #059669;\n    animation: spin 1s linear infinite;\n  }\n\n  .main-text {\n    font-size: 1.2rem;\n    font-weight: 600;\n    color: #374151;\n    text-align: center;\n  }\n\n  .sub-text {\n    font-size: 1rem;\n    color: #6b7280;\n    text-align: center;\n    margin-top: 8px;\n  }\n\n  @keyframes spin {\n    from {\n      transform: rotate(0deg);\n    }\n    to {\n      transform: rotate(360deg);\n    }\n  }\n"]))),Zo=l.A.div(jo||(jo=(0,i.A)(["\n  padding: 20px 24px;\n  border-top: 2px solid #e5e7eb;\n  background: white;\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n"]))),Bo=l.A.div(zo||(zo=(0,i.A)(["\n  background: #eff6ff;\n  border-left: 4px solid #3b82f6;\n  padding: 12px 16px;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  line-height: 1.5;\n  color: #1e40af;\n"]))),Ko=l.A.div(Ao||(Ao=(0,i.A)(["\n  display: flex;\n  gap: 12px;\n  justify-content: flex-end;\n"]))),Ho=l.A.button(wo||(wo=(0,i.A)(["\n  padding: 12px 24px;\n  border-radius: 8px;\n  font-size: 1rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n  border: none;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n"]))),Wo=(0,l.A)(Ho)(So||(So=(0,i.A)(["\n  background: #f3f4f6;\n  color: #374151;\n\n  &:hover:not(:disabled) {\n    background: #e5e7eb;\n  }\n"]))),$o=(0,l.A)(Ho)(Eo||(Eo=(0,i.A)(["\n  background: linear-gradient(135deg, #059669 0%, #047857 100%);\n  color: white;\n\n  &:hover:not(:disabled) {\n    transform: translateY(-1px);\n    box-shadow: 0 4px 6px -1px rgba(5, 150, 105, 0.3);\n  }\n"]))),Jo=e=>{let{order:n,onConfirm:a,onCancel:o,generatedBy:i,token:d,username:l}=e;const[c,v]=(0,r.useState)(null),[_,m]=(0,r.useState)(!0),[f,h]=(0,r.useState)(!1),[k,g]=(0,r.useState)(null),[b,y]=(0,r.useState)({});(0,r.useEffect)(()=>{(async()=>{try{m(!0);let r=null;try{r=await(0,Do.ZF)({token:d,username:l,id:1})}catch(e){console.warn("Nepoda\u0159ilo se na\u010d\xedst vizitku organizace:",e)}let s={};try{const e=await(0,Pa.CR)({token:d,username:l,aktivni:1});Array.isArray(e)&&(s=e.reduce((e,n)=>(n.kod_strediska&&(e[n.kod_strediska]=n.nazev_strediska||n.kod_strediska),e),{}))}catch(a){console.warn("Nepoda\u0159ilo se na\u010d\xedst st\u0159ediska:",a)}g(r),y(s);const c=[];if(n.faktury&&Array.isArray(n.faktury))for(const e of n.faktury){const n=(0,t.A)({},e);if(e.potvrdil_vecnou_spravnost_id)try{const a=await(0,To.vF)(e.potvrdil_vecnou_spravnost_id);n.potvrdil_vecnou_spravnost=a}catch(o){console.warn("Nepoda\u0159ilo se na\u010d\xedst u\u017eivatele:",o)}c.push(n)}const p=(0,t.A)((0,t.A)({},n),{},{polozky:n.polozky_objednavky||n.polozky||[],faktury:c}),u=await(0,No.x8)((0,fe.jsx)(Oo.A,{order:p,generatedBy:i,organizace:r,strediskaMap:s})).toBlob(),_=URL.createObjectURL(u);v(_),await new Promise(e=>setTimeout(e,500)),m(!1)}catch(r){console.error("Chyba p\u0159i generov\xe1n\xed n\xe1hledu finan\u010dn\xed kontroly:",r),alert("Chyba p\u0159i generov\xe1n\xed n\xe1hledu finan\u010dn\xed kontroly"),m(!1)}})()},[n,i,d,l]),(0,r.useEffect)(()=>()=>{c&&(console.log("\ud83e\uddf9 Cleaning up PDF URL..."),URL.revokeObjectURL(c))},[c]);const x=()=>{o()};return(0,r.useEffect)(()=>{const e=e=>{"Escape"!==e.key||f||x()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[f]),(0,s.createPortal)((0,fe.jsx)(Io,{onClick:e=>{e.target!==e.currentTarget||f||_||x()},children:(0,fe.jsxs)(Po,{onClick:e=>e.stopPropagation(),children:[(0,fe.jsxs)(Lo,{children:[(0,fe.jsx)(Ro,{children:"\ud83d\udccb Finan\u010dn\xed kontrola - Potvrzen\xed dokon\u010den\xed objedn\xe1vky"}),(0,fe.jsx)(Vo,{onClick:x,disabled:f||_,title:"Zav\u0159\xedt (ESC)",children:(0,fe.jsx)(p.g,{icon:u.GRI})})]}),(0,fe.jsx)(Fo,{children:_?(0,fe.jsxs)(Uo,{children:[(0,fe.jsx)(p.g,{icon:u.z1G,spin:!0}),(0,fe.jsx)("div",{className:"main-text",children:"Generuji finan\u010dn\xed kontrolu..."}),(0,fe.jsxs)("div",{className:"sub-text",children:["Pros\xedm po\u010dkejte, dokument se p\u0159ipravuje",(0,fe.jsx)("br",{}),"Na\u010d\xedt\xe1m data a vytv\xe1\u0159\xedm PDF n\xe1hled"]})]}):(0,fe.jsx)(Mo,{children:(0,fe.jsx)("iframe",{src:c,title:"N\xe1hled finan\u010dn\xed kontroly",id:"pdf-preview-iframe"})})}),(0,fe.jsxs)(Zo,{children:[(0,fe.jsxs)(Bo,{children:["\u2139\ufe0f ",(0,fe.jsx)("strong",{children:"P\u0159ed dokon\u010den\xedm objedn\xe1vky zkontrolujte finan\u010dn\xed kontrolu."}),(0,fe.jsx)("br",{}),'Po potvrzen\xed bude dokument automaticky ulo\u017een jako p\u0159\xedloha objedn\xe1vky s klasifikac\xed "Kontrolka" a objedn\xe1vka bude ozna\u010dena jako DOKON\u010cEN\xc1 (nelze ji\u017e editovat).']}),(0,fe.jsxs)(Ko,{children:[(0,fe.jsxs)(Wo,{onClick:x,disabled:f,children:[(0,fe.jsx)(p.g,{icon:u.s0Q}),"Zru\u0161it dokon\u010den\xed"]}),(0,fe.jsx)($o,{onClick:async()=>{try{h(!0);const o=[];if(n.faktury&&Array.isArray(n.faktury))for(const a of n.faktury){const n=(0,t.A)({},a);if(a.potvrdil_vecnou_spravnost_id)try{const e=await(0,To.vF)(a.potvrdil_vecnou_spravnost_id);n.potvrdil_vecnou_spravnost=e}catch(e){console.warn("Nepoda\u0159ilo se na\u010d\xedst u\u017eivatele:",e)}o.push(n)}const r=(0,t.A)((0,t.A)({},n),{},{polozky:n.polozky_objednavky||n.polozky||[],faktury:o}),s=await(0,No.x8)((0,fe.jsx)(Oo.A,{order:r,generatedBy:i,organizace:k,strediskaMap:b})).toBlob(),d=(new Date).toISOString().split("T")[0],l=(n.cislo_objednavky||"neznama").replace(/[^a-zA-Z0-9]/g,"_"),c="Financni_kontrola_".concat(d,"_").concat(l,".pdf"),p=new File([s],c,{type:"application/pdf"});console.log("\u2705 PDF vygenerov\xe1no, p\u0159ed\xe1v\xe1m parent komponent\u011b..."),a(p)}catch(o){console.error("\u274c Chyba p\u0159i generov\xe1n\xed PDF:",o),alert("Chyba p\u0159i generov\xe1n\xed PDF: ".concat(o.message||o)),h(!1)}},disabled:_||f,children:f?(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(p.g,{icon:u.z1G,spin:!0}),"Ukl\xe1d\xe1m..."]}):(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(p.g,{icon:u.SGM}),"Potvrdit a dokon\u010dit objedn\xe1vku"]})})]})]})]})}),document.body)},Go=["file"];var qo,Yo,Xo,Qo,et,nt,at,ot,tt,it,rt,st,dt,lt,ct,pt,ut,vt,_t,mt,ft,ht,kt,gt,bt,yt,xt,jt,zt,At,wt,St,Et,Ct,Nt,Ot,Dt,Tt,It,Pt,Lt,Rt,Vt,Ft,Mt,Ut,Zt,Bt,Kt,Ht,Wt,$t,Jt,Gt,qt,Yt,Xt,Qt,ei,ni,ai,oi,ti,ii,ri,si,di,li,ci,pi,ui,vi,_i,mi,fi,hi,ki,gi,bi,yi,xi,ji,zi,Ai,wi,Si,Ei,Ci,Ni,Oi,Di,Ti,Ii,Pi,Li,Ri,Vi,Fi,Mi,Ui,Zi,Bi,Ki,Hi,Wi,$i,Ji,Gi,qi,Yi,Xi,Qi,er,nr,ar,or,tr,ir,rr,sr,dr,lr,cr,pr,ur,vr,_r,mr,fr,hr,kr,gr,br,yr,xr,jr,zr,Ar,wr,Sr,Er,Cr,Nr,Or,Dr,Tr,Ir,Pr,Lr,Rr,Vr,Fr,Mr,Ur,Zr,Br,Kr,Hr,Wr,$r,Jr,Gr,qr,Yr,Xr,Qr,es,ns,as,os,ts,is,rs,ss,ds,ls,cs,ps,us,vs,_s,ms,fs,hs,ks,gs,bs,ys,xs,js,zs,As,ws,Ss,Es,Cs,Ns,Os,Ds,Ts,Is;const Ps=e=>{if(!e)return"";const n=new Date(e);if(isNaN(n.getTime()))return"";const a=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),t=String(n.getDate()).padStart(2,"0");return"".concat(a,"-").concat(o,"-").concat(t)},Ls=e=>e?e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g,"").trim():"",Rs=()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(o)},Vs=l.A.div(qo||(qo=(0,i.A)(["\n  background: #f8fafc;\n  padding: 0;\n  position: fixed;\n  top: ",";\n  left: 0;\n  right: 0;\n  bottom: ",";\n  width: 100%;\n  height: ",";\n  overflow: hidden;\n  z-index: ",";\n  transition: all 0.3s ease-in-out;\n\n  /* Animace pro loading spinner */\n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n"])),e=>e.isFullscreen?"0":"var(--app-fixed-offset-actual, calc(var(--app-header-height, 96px) + var(--app-menu-height, 48px)))",e=>e.isFullscreen?"0":"var(--app-footer-height, 54px)",e=>e.isFullscreen?"100vh":"calc(100vh - var(--app-fixed-offset-actual, calc(var(--app-header-height, 96px) + var(--app-menu-height, 48px))) - var(--app-footer-height, 54px))",e=>e.isFullscreen?"99999":"auto"),Fs=l.A.div(Yo||(Yo=(0,i.A)(["\n  width: 100%;\n  max-width: 990px;\n  margin: 0 auto;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  ","\n  background: transparent;\n  transition: margin-left 0.3s ease-in-out, margin-right 0.3s ease-in-out;\n\n  @media (max-width: 1400px) {\n    ","\n  }\n\n  @media (max-width: 1200px) {\n    margin-left: auto;\n    margin-right: auto;\n    max-width: 990px;\n  }\n\n  @media (max-width: 768px) {\n    max-width: 100%;\n    padding: 0 0.5rem;\n    margin-left: auto;\n    margin-right: auto;\n  }\n"])),e=>e.debugPinned?"\n    margin-left: 420px;\n    margin-right: auto;\n  ":"",e=>e.debugPinned?"\n      margin-left: 380px;\n      margin-right: auto;\n    ":""),Ms=l.A.div(Xo||(Xo=(0,i.A)(["\n  position: absolute;\n  top: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 100%;\n  max-width: 990px;\n  z-index: 100;\n  background: ",";\n  border-bottom: 1px solid #e5e7eb;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  padding: 1rem 0 1rem 0;\n"])),e=>{let{theme:n}=e;return n.colors.gray100||"#f8fafc"}),Us=l.A.div(Qo||(Qo=(0,i.A)(["\n  width: 100%;\n  max-width: 990px;\n  margin: 0 auto;\n  ","\n  padding: 0 1rem;\n  transition: margin-left 0.3s ease-in-out, margin-right 0.3s ease-in-out;\n\n  @media (max-width: 1400px) {\n    ","\n  }\n\n  @media (max-width: 1200px) {\n    margin-left: auto;\n    margin-right: auto;\n    max-width: 990px;\n  }\n\n  @media (max-width: 768px) {\n    max-width: 100%;\n    padding: 0 1rem;\n  }\n"])),e=>e.debugPinned?"\n    margin-left: 420px;\n    margin-right: auto;\n  ":"",e=>e.debugPinned?"\n      margin-left: 380px;\n      margin-right: auto;\n    ":""),Zs=l.A.div(et||(et=(0,i.A)(["\n  /* Scrollovateln\xfd obsah - scrollbar na prav\xe9m okraji okna prohl\xed\u017ee\u010de */\n  position: absolute;\n  top: 0px;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 0;\n\n  /* Decentn\xed scrollbar - 80% pr\u016fhledn\xfd ve v\xfdchoz\xedm stavu */\n  scrollbar-width: thin;\n  scrollbar-color: rgba(148, 163, 184, 0.2) transparent;\n\n  /* P\u0159i hover v\xedce viditeln\xfd */\n  &:hover {\n    scrollbar-color: rgba(148, 163, 184, 0.8) transparent;\n  }\n\n  /* Webkit browsers (Chrome, Safari, Edge) */\n  &::-webkit-scrollbar {\n    width: 10px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: transparent;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background-color: rgba(148, 163, 184, 0.2);\n    border-radius: 5px;\n    border: 2px solid transparent;\n    background-clip: content-box;\n    transition: background-color 0.3s ease;\n  }\n\n  &:hover::-webkit-scrollbar-thumb {\n    background-color: rgba(148, 163, 184, 0.8);\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background-color: rgba(100, 116, 139, 0.95);\n  }\n\n  @media (max-width: 768px) {\n    padding: 0;\n  }\n"]))),Bs=l.A.div(nt||(nt=(0,i.A)(["\n  /* Vnit\u0159n\xed wrapper pro centrov\xe1n\xed obsahu */\n  max-width: 990px;\n  margin: 0 auto;\n  /* \ud83d\udccf Dynamick\xfd padding-top: v\xfd\u0161ka headeru + 20px gap (u\u017e zapo\u010d\xedt\xe1no v CSS variable) */\n  padding: var(--fixed-header-height, 200px) 1rem 2rem 1rem;\n\n  @media (max-width: 768px) {\n    padding: var(--fixed-header-height, 200px) 0.5rem 2rem 0.5rem;\n  }\n"]))),Ks=l.A.div(at||(at=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 0.75rem;\n\n  @media (max-width: 768px) {\n    flex-direction: column;\n    gap: 0.75rem;\n    align-items: stretch;\n  }\n"]))),Hs=l.A.div(ot||(ot=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  flex-wrap: wrap;\n  flex: 1;\n\n  @media (max-width: 768px) {\n    justify-content: space-between;\n  }\n"]))),Ws=(l.A.div(tt||(tt=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 8px 16px;\n  background: ",";\n  border: 2px solid ",";\n  border-radius: 8px;\n  font-size: 14px;\n  font-weight: 600;\n  color: ",";\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n\n  @media (max-width: 768px) {\n    font-size: 12px;\n    padding: 6px 12px;\n    gap: 8px;\n  }\n"])),e=>e.isOverBudget?"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)":"linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)",e=>e.isOverBudget?"#fca5a5":"#bbf7d0",e=>e.isOverBudget?"#991b1b":"#166534"),l.A.div(it||(it=(0,i.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n\n  .label {\n    font-size: 10px;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    opacity: 0.8;\n    font-weight: 500;\n  }\n\n  .value {\n    font-size: 16px;\n    font-weight: 700;\n\n    @media (max-width: 768px) {\n      font-size: 14px;\n    }\n  }\n"]))),l.A.div(rt||(rt=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  position: relative;\n"])))),$s=l.A.h1(st||(st=(0,i.A)(["\n  font-size: 1.8125rem;\n  font-weight: 700;\n  color: #b45309;\n  margin: 0;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-variant: small-caps;\n  position: relative;\n\n  /* V\u011bt\u0161\xed prvn\xed p\xedsmeno s gradientn\xedm zv\xfdrazn\u011bn\xedm */\n  &::first-letter {\n    font-size: 1.3em;\n    font-variant: normal;\n    font-weight: 800;\n    background: linear-gradient(135deg, #d97706 0%, #b45309 50%, #92400e 100%);\n    background-clip: text;\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    text-shadow: 0 2px 4px rgba(180, 83, 9, 0.3);\n  }\n\n  /* Horn\xed index pro ID objedn\xe1vky */\n  .order-id-badge {\n    font-size: 0.4em;\n    font-weight: 500;\n    color: #6b7280;\n    margin-left: 0.1em;\n    vertical-align: top;\n    line-height: 1;\n    position: relative;\n    top: -0.5em;\n    left: -6px;\n  }\n\n  @media (max-width: 768px) {\n    font-size: 1.75rem;\n\n    .order-id-badge {\n      font-size: 0.55em;\n    }\n  }\n"]))),Js=(l.A.div(dt||(dt=(0,i.A)(["\n  font-size: 0.875rem;\n  color: #6b7280;\n  font-weight: 500;\n"]))),l.A.div(lt||(lt=(0,i.A)(["\n  display: flex;\n  gap: 0.75rem;\n  align-items: center;\n"]))),l.A.button(ct||(ct=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border-radius: 8px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &.template-btn {\n    background: #10b981;\n    color: white;\n    cursor: pointer;\n    opacity: 1;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:hover {\n      background: #059669;\n      transform: scale(1.05);\n    }\n  }\n\n  &.reload-btn {\n    background: #0ea5e9;\n    color: white;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:disabled {\n      cursor: not-allowed;\n      opacity: 0.6;\n\n      &:hover {\n        background: #0ea5e9;\n      }\n    }\n\n    &:not(:disabled) {\n      cursor: pointer;\n      opacity: 1;\n\n      &:hover {\n        background: #0284c7;\n        transform: translateY(-1px);\n      }\n    }\n  }\n\n  &.cancel-btn {\n    background: #dc2626;\n    color: white;\n\n    &:hover {\n      background: #b91c1c;\n    }\n  }\n\n  &.draft-btn {\n    background: #059669;\n    color: white;\n\n    &:hover {\n      background: #047857;\n    }\n\n    &:disabled {\n      background: #9ca3af;\n      cursor: not-allowed;\n    }\n  }\n\n  &.fullscreen-btn {\n    background: #10b981;\n    color: white;\n    cursor: pointer;\n    opacity: 1;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:hover {\n      background: #059669;\n      transform: scale(1.05);\n    }\n  }\n\n  &.toggle-sections-btn {\n    background: #8b5cf6;\n    color: white;\n    cursor: pointer;\n    opacity: 1;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:hover {\n      background: #7c3aed;\n      transform: scale(1.05);\n    }\n  }\n\n  &.generate-docx-btn {\n    background: #f97316;\n    color: white;\n    cursor: pointer;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:disabled {\n      background: #9ca3af;\n      cursor: not-allowed;\n      opacity: 0.6;\n\n      &:hover {\n        background: #9ca3af;\n        transform: none;\n      }\n    }\n\n    &:not(:disabled):hover {\n      background: #ea580c;\n      transform: scale(1.05);\n    }\n  }\n"]))),l.A.div(pt||(pt=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: #f3f4f6;\n  border: 1px solid #d1d5db;\n  border-radius: 8px;\n  padding: 0.5rem 1rem;\n  margin-bottom: 0;\n  gap: 1rem;\n\n  @media (max-width: 768px) {\n    flex-direction: column;\n    gap: 0.75rem;\n    align-items: stretch;\n  }\n"])))),Gs=(l.A.div(ut||(ut=(0,i.A)(["\n  font-size: 0.875rem;\n  font-weight: 700;\n  text-align: center;\n  position: relative;\n  flex: 1;\n\n  @media (max-width: 768px) {\n    text-align: left;\n  }\n"]))),l.A.div(vt||(vt=(0,i.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  flex: 1;\n"])))),qs=(l.A.div(_t||(_t=(0,i.A)(["\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  gap: 0.25rem;\n  padding-right: 1rem;\n"]))),l.A.div(mt||(mt=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.875rem;\n  font-weight: 600;\n"]))),l.A.span(ft||(ft=(0,i.A)(["\n  color: #dc2626;\n  font-size: 0.8rem;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  font-weight: 700;\n"]))),l.A.span(ht||(ht=(0,i.A)(["\n  color: #dc2626;\n  font-size: 1.1rem;\n  font-weight: 800;\n  font-family: 'Courier New', monospace;\n"]))),l.A.span(kt||(kt=(0,i.A)(["\n  font-size: 0.75rem;\n  padding: 3px 8px;\n  border-radius: 4px;\n  font-weight: 600;\n  background: ",";\n  color: ",";\n  border: 1px solid ",";\n"])),e=>e.isOver?"#fef2f2":"#f0fdf4",e=>e.isOver?"#dc2626":"#059669",e=>e.isOver?"#fecaca":"#bbf7d0"),l.A.div(gt||(gt=(0,i.A)(["\n  font-size: 0.875rem;\n  color: #374151;\n  font-weight: 700;\n  text-align: left;\n"])))),Ys=l.A.div(bt||(bt=(0,i.A)(["\n  display: flex;\n  height: 6px;\n  background: #e5e7eb;\n  border-radius: 3px;\n  overflow: hidden;\n  position: relative;\n  border: 1px solid #d1d5db;\n"]))),Xs=l.A.div(yt||(yt=(0,i.A)(["\n  flex: 1;\n  position: relative;\n\n  &:not(:last-child)::after {\n    content: '';\n    position: absolute;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    width: 1px;\n    background: #d1d5db;\n    z-index: 2;\n  }\n"]))),Qs=l.A.div(xt||(xt=(0,i.A)(["\n  height: 100%;\n  transition: all 0.3s ease;\n\n  /* Barevn\xe9 p\u0159echody pro jednotliv\xe9 f\xe1ze */\n  &.phase-1 {\n    background: linear-gradient(90deg, #9ca3af 0%, #6b7280 100%); /* \u0160ed\xe1 - za\u010d\xe1tek */\n  }\n\n  &.phase-2 {\n    background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%); /* Oran\u017eov\xe1 - v procesu */\n  }\n\n  &.phase-3 {\n    background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%); /* Modr\xe1 - odesl\xe1no */\n  }\n\n  &.phase-4 {\n    background: linear-gradient(90deg, #10b981 0%, #059669 100%); /* Zelen\xe1 - potvrzeno */\n  }\n\n  &.phase-5 {\n    background: linear-gradient(90deg, #8b5cf6 0%, #7c3aed 100%); /* Fialov\xe1 - registr */\n  }\n\n  &.phase-6 {\n    background: linear-gradient(90deg, #06b6d4 0%, #0891b2 100%); /* Tyrkysov\xe1 - fakturace */\n  }\n\n  &.phase-7 {\n    background: linear-gradient(90deg, #14b8a6 0%, #0d9488 100%); /* Teal - v\u011bcn\xe1 spr\xe1vnost */\n  }\n\n  &.phase-8 {\n    background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%); /* Sv\u011btle zelen\xe1 - dokon\u010deno */\n  }\n\n  &.phase-error {\n    background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%); /* \u010cerven\xe1 - chyba/storno */\n  }\n"]))),ed=l.A.div(jt||(jt=(0,i.A)(["\n  width: 2px;\n  height: 40px;\n  background: linear-gradient(to bottom, transparent, #d1d5db 20%, #d1d5db 80%, transparent);\n  border-radius: 1px;\n\n  @media (max-width: 768px) {\n    width: 100%;\n    height: 2px;\n    background: linear-gradient(to right, transparent, #d1d5db 20%, #d1d5db 80%, transparent);\n  }\n"]))),nd=l.A.div(zt||(zt=(0,i.A)(["\n  display: flex;\n  gap: 0.75rem;\n  align-items: center;\n"]))),ad=l.A.button(At||(At=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &.save-btn {\n    background: #10b981;\n    color: white;\n\n    &:hover:not(:disabled) {\n      background: #059669;\n    }\n\n    &:disabled {\n      background: #6b7280;\n      cursor: not-allowed;\n    }\n  }\n\n  &.cancel-btn {\n    background: #dc2626;\n    color: white;\n\n    &:hover {\n      background: #b91c1c;\n    }\n  }\n\n  &.icon-only {\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n"]))),od=(0,c.i7)(wt||(wt=(0,i.A)(["\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n"]))),td=l.A.span(St||(St=(0,i.A)(["\n  display: inline-block;\n  width: 14px;\n  height: 14px;\n  border: 2px solid #ddd;\n  border-top: 2px solid #666;\n  border-radius: 50%;\n  animation: "," 0.8s linear infinite;\n"])),od),id=l.A.button(Et||(Et=(0,i.A)(["\n  padding: 2px 8px;\n  fontSize: 11px;\n  backgroundColor: #fef3c7;\n  border: 1px solid #fbbf24;\n  borderRadius: 4px;\n  color: #92400e;\n  cursor: pointer;\n  fontWeight: 500;\n  transition: all 0.2s ease;\n\n  &:hover {\n    background-color: #fde68a;\n    border-color: #f59e0b;\n  }\n\n  &:active {\n    transform: scale(0.95);\n  }\n"]))),rd=l.A.div(Ct||(Ct=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n\n  @media (max-width: 768px) {\n    flex-direction: column;\n    gap: 0.25rem;\n    align-items: flex-start;\n  }\n"]))),sd=(l.A.div(Nt||(Nt=(0,i.A)(["\n  font-size: 0.75rem;\n  color: #6b7280;\n  font-weight: 500;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  white-space: nowrap;\n"]))),l.A.div(Ot||(Ot=(0,i.A)(["\n  font-size: 1rem;\n  font-weight: 700;\n  color: ",";\n  font-family: 'Courier New', monospace;\n  background: ",";\n  padding: 0.4rem 0.6rem;\n  border-radius: 6px;\n  border: 1px solid ",";\n  white-space: nowrap;\n"])),e=>e.$isEmergency?"#fde047":"#1e40af",e=>e.$isEmergency?"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)":"linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)",e=>e.$isEmergency?"#991b1b":"#93c5fd")),dd=l.A.div(Dt||(Dt=(0,i.A)(["\n  background: #ffffff;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n  margin-bottom: 1.5rem;\n  overflow: visible;\n  border: 1px solid #e2e8f0;\n"]))),ld=l.A.div(Tt||(Tt=(0,i.A)(["\n  padding: 1rem 1.25rem;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  transition: all 0.3s ease;\n\n  /* Barevn\xe9 sch\xe9ma podle typu sekce */\n  ","\n"])),e=>{const n=(e=>{switch(e){case"section-grey":return{bg:["#f9fafb","#f3f4f6"],border:"#9ca3af",hover:["#f3f4f6","#e5e7eb"]};case"section-orange":default:return{bg:["#fef3c7","#fde68a"],border:"#f59e0b",hover:["#fde68a","#facc15"]};case"section-blue":return{bg:["#dbeafe","#bfdbfe"],border:"#3b82f6",hover:["#bfdbfe","#93c5fd"]};case"section-purple":return{bg:["#f3e8ff","#e9d5ff"],border:"#a855f7",hover:["#e9d5ff","#d8b4fe"]};case"section-red":return{bg:["#fee2e2","#fecaca"],border:"#dc2626",hover:["#fecaca","#fca5a5"]}}})(e.sectionTheme),a=e.isActive?"1":"0.6";return"\n      background: linear-gradient(135deg, ".concat(n.bg[0]," 0%, ").concat(n.bg[1]," 100%);\n      border-bottom: 1px solid ").concat(n.border,";\n      opacity: ").concat(a,";\n\n      &:hover {\n        background: linear-gradient(135deg, ").concat(n.hover[0]," 0%, ").concat(n.hover[1]," 100%);\n        opacity: 1;\n      }\n    ")}),cd=l.A.div(It||(It=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  font-weight: 600;\n  font-size: 1.1rem;\n\n  ","\n"])),e=>{switch(e.sectionTheme){case"section-grey":return"color: #4b5563;";case"section-orange":default:return"color: #92400e;";case"section-blue":return"color: #1e40af;";case"section-purple":return"color: #7e22ce;";case"section-red":return"color: #991b1b;"}}),pd=l.A.div(Pt||(Pt=(0,i.A)(["\n  font-size: 1.2rem;\n\n  ","\n"])),e=>{switch(e.sectionTheme){case"section-grey":return"color: #6b7280;";case"section-orange":default:return"color: #f59e0b;";case"section-blue":return"color: #3b82f6;";case"section-purple":return"color: #a855f7;";case"section-red":return"color: #dc2626;"}}),ud=l.A.div(Lt||(Lt=(0,i.A)(["\n  transition: transform 0.2s ease;\n  transform: ",";\n\n  ","\n"])),e=>e.collapsed?"rotate(0deg)":"rotate(180deg)",e=>{switch(e.sectionTheme){case"section-grey":return"color: #4b5563;";case"section-orange":default:return"color: #92400e;";case"section-blue":return"color: #1e40af;";case"section-purple":return"color: #7e22ce;";case"section-red":return"color: #991b1b;"}}),vd=l.A.div(Rt||(Rt=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n"]))),_d=l.A.span(Vt||(Vt=(0,i.A)(["\n  margin-left: 0.75rem;\n  color: #dc2626;\n  font-size: 0.7rem;\n  font-weight: 500;\n  background: rgba(255, 255, 255, 0.2);\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n  cursor: help;\n"]))),md=l.A.div(Ft||(Ft=(0,i.A)(["\n  padding: 1.5rem 1.25rem;\n  display: ",";\n"])),e=>e.collapsed?"none":"block"),fd=l.A.div(Mt||(Mt=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  opacity: ",";\n  pointer-events: ",";\n"])),e=>e.disabled?.6:1,e=>e.disabled?"none":"auto"),hd=l.A.label(Ut||(Ut=(0,i.A)(["\n  position: relative;\n  display: inline-block;\n  width: 56px;\n  height: 28px;\n  cursor: ",";\n  flex-shrink: 0;\n\n  input {\n    opacity: 0;\n    width: 0;\n    height: 0;\n  }\n\n  span {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: ",";\n    border-radius: 28px;\n    transition: all 0.3s ease;\n\n    &::before {\n      content: '';\n      position: absolute;\n      height: 20px;\n      width: 20px;\n      left: 4px;\n      bottom: 4px;\n      background-color: white;\n      border-radius: 50%;\n      transition: all 0.3s ease;\n      transform: ",";\n    }\n  }\n\n  input:focus + span {\n    box-shadow: 0 0 0 3px ",";\n  }\n"])),e=>e.disabled?"not-allowed":"pointer",e=>e.checked?"#ef4444":"#cbd5e1",e=>e.checked?"translateX(28px)":"translateX(0)",e=>e.checked?"rgba(239, 68, 68, 0.1)":"rgba(59, 130, 246, 0.1)"),kd=l.A.span(Zt||(Zt=(0,i.A)(["\n  font-size: 0.9rem;\n  font-weight: ",";\n  color: ",";\n"])),e=>e.checked?"700":"400",e=>e.checked?"#dc2626":"#374151"),gd=l.A.div(Bt||(Bt=(0,i.A)(["\n  display: grid;\n  grid-template-columns: 1fr 1fr 1fr;\n  gap: 1rem;\n  margin-bottom: 1rem;\n\n  @media (max-width: 1024px) {\n    grid-template-columns: 1fr 1fr;\n  }\n\n  @media (max-width: 768px) {\n    grid-template-columns: 1fr;\n  }\n"]))),bd=l.A.div(Kt||(Kt=(0,i.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n"]))),yd=l.A.div(Ht||(Ht=(0,i.A)(["\n  color: #dc2626;\n  font-size: 0.75rem;\n  font-weight: 500;\n  margin-top: 0.25rem;\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n"]))),xd=l.A.label(Wt||(Wt=(0,i.A)(["\n  font-weight: 600;\n  font-size: 0.875rem;\n  color: #374151;\n\n  &::after {\n    content: ",";\n    color: #dc2626;\n    margin-left: 2px;\n  }\n"])),e=>e.required?'" *"':'""'),jd=l.A.div($t||($t=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n  width: 100%;\n  min-height: 1.25rem; /* Minim\xe1ln\xed v\xfd\u0161ka pro konzistenci s Label */\n"]))),zd=l.A.label(Jt||(Jt=(0,i.A)(["\n  font-weight: 600;\n  font-size: 0.875rem;\n  color: #374151;\n\n  &::after {\n    content: ",";\n    color: #dc2626;\n    margin-left: 2px;\n  }\n"])),e=>e.required?'" *"':'""'),Ad=l.A.button(Gt||(Gt=(0,i.A)(["\n  background: none;\n  border: none;\n  padding: 0.25rem 0.5rem;\n  cursor: pointer;\n  color: #9ca3af;\n  font-size: 0.75rem;\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  transition: all 0.2s ease;\n  border-radius: 4px;\n  opacity: ",";\n  pointer-events: ",";\n\n  &:hover {\n    color: #ef4444;\n    background: rgba(239, 68, 68, 0.1);\n  }\n\n  svg {\n    width: 12px;\n    height: 12px;\n  }\n"])),e=>e.$visible?1:0,e=>e.$visible?"auto":"none"),wd=l.A.div(qt||(qt=(0,i.A)(["\n  position: relative;\n  width: 100%;\n\n  > svg {\n    position: absolute;\n    left: 0.75rem;\n    top: 50%;\n    transform: translateY(-50%);\n    color: #9ca3af;\n    z-index: 1;\n    pointer-events: none;\n    width: 16px !important;\n    height: 16px !important;\n  }\n"]))),Sd=l.A.input(Yt||(Yt=(0,i.A)(["\n  width: 100%;\n  box-sizing: border-box;\n  padding: ",";\n  border: 2px solid ",";\n  border-radius: 8px;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n  background: #ffffff;\n\n  /* Zv\xfdrazn\u011bn\xe9 vypln\u011bn\xe9 hodnoty vs. placeholder - slad\u011bno s CustomSelect */\n  color: ",";\n  font-weight: ",";\n\n  &:focus {\n    outline: none;\n    border-color: ",";\n    box-shadow: 0 0 0 3px ",";\n  }\n\n  &:focus + svg {\n    color: ",';\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    color: #6b7280;\n    cursor: not-allowed;\n  }\n\n  /* Sjednocen\xed placeholder barvy se selecty */\n  &::placeholder {\n    color: #9ca3af;\n    opacity: 1;\n    font-weight: 400;\n  }\n\n  &::-webkit-input-placeholder {\n    color: #9ca3af;\n    font-weight: 400;\n  }\n\n  &::-moz-placeholder {\n    color: #9ca3af;\n    opacity: 1;\n    font-weight: 400;\n  }\n\n  /* Odstran\u011bn\xed spinner arrows u number input\u016f */\n  &[type="number"] {\n    -moz-appearance: textfield; /* Firefox */\n    appearance: textfield;\n\n    &::-webkit-outer-spin-button,\n    &::-webkit-inner-spin-button {\n      -webkit-appearance: none;\n      margin: 0;\n    }\n  }\n'])),e=>e.hasIcon?"0.75rem 0.75rem 0.75rem 2.5rem":"0.75rem",e=>e.hasError?"#dc2626":"#e5e7eb",e=>e.value&&""!==e.value?"#1f2937":"#6b7280",e=>e.disabled?"400":e.value&&""!==e.value?"600":"400",e=>e.hasError?"#dc2626":"#3b82f6",e=>e.hasError?"rgba(220, 38, 38, 0.1)":"rgba(59, 130, 246, 0.1)",e=>e.hasError?"#dc2626":"#3b82f6"),Ed=l.A.textarea(Xt||(Xt=(0,i.A)(["\n  width: 100%;\n  box-sizing: border-box;\n  padding: 0.75rem;\n  border: 2px solid ",";\n  border-radius: 8px;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n  background: #ffffff;\n  font-family: inherit;\n  resize: vertical;\n  min-height: 80px;\n\n  /* Zv\xfdrazn\u011bn\xe9 vypln\u011bn\xe9 hodnoty vs. placeholder - slad\u011bno s CustomSelect */\n  color: ",";\n  font-weight: ",";\n\n  &:focus {\n    outline: none;\n    border-color: ",";\n    box-shadow: 0 0 0 3px ",";\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    color: #6b7280;\n    cursor: not-allowed;\n  }\n\n  &::placeholder {\n    color: #9ca3af;\n    opacity: 1;\n    font-weight: 400;\n  }\n"])),e=>e.hasError?"#dc2626":"#e5e7eb",e=>e.value&&""!==e.value?"#1f2937":"#6b7280",e=>e.disabled?"400":e.value&&""!==e.value?"600":"400",e=>e.hasError?"#dc2626":"#3b82f6",e=>e.hasError?"rgba(220, 38, 38, 0.1)":"rgba(59, 130, 246, 0.1)"),Cd=(l.A.div(Qt||(Qt=(0,i.A)(["\n  margin-top: 0.75rem;\n  padding: 0.75rem;\n  border-radius: 8px;\n  background: ",";\n  border: 2px solid ",";\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  animation: slideDown 0.3s ease;\n\n  @keyframes slideDown {\n    from {\n      opacity: 0;\n      transform: translateY(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n"])),e=>e.$loading?"#f3f4f6":e.$notFound||e.$isNegative?"#fef2f2":"#f0fdf4",e=>e.$loading?"#e5e7eb":e.$notFound?"#fecaca":e.$isNegative?"#fca5a5":"#86efac"),l.A.div(ei||(ei=(0,i.A)(["\n  font-size: 1.5rem;\n  flex-shrink: 0;\n"]))),l.A.div(ni||(ni=(0,i.A)(["\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n"]))),l.A.div(ai||(ai=(0,i.A)(["\n  font-size: 0.75rem;\n  font-weight: 500;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n  color: ",";\n"])),e=>e.$loading?"#6b7280":e.$notFound?"#991b1b":e.$isNegative?"#b91c1c":"#15803d"),l.A.div(oi||(oi=(0,i.A)(["\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: ",";\n  font-variant-numeric: tabular-nums;\n"])),e=>e.$loading?"#6b7280":e.$notFound?"#991b1b":e.$isNegative?"#dc2626":"#16a34a"),l.A.div(ti||(ti=(0,i.A)(["\n  font-size: 0.75rem;\n  color: #6b7280;\n  margin-top: 0.125rem;\n"]))),l.A.div(ii||(ii=(0,i.A)(["\n  position: relative;\n  width: 100%;\n"])))),Nd=l.A.div(ri||(ri=(0,i.A)(["\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  margin-top: 0.25rem;\n  background: white;\n  border: 2px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  max-height: 300px;\n  overflow-y: auto;\n  z-index: 1000;\n  animation: slideDown 0.2s ease;\n\n  @keyframes slideDown {\n    from {\n      opacity: 0;\n      transform: translateY(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n"]))),Od=l.A.div(si||(si=(0,i.A)(["\n  padding: 0.75rem;\n  cursor: pointer;\n  border-bottom: 1px solid #f3f4f6;\n  transition: all 0.15s ease;\n\n  &:hover {\n    background: #f3f4f6;\n  }\n\n  &:last-child {\n    border-bottom: none;\n  }\n"]))),Dd=l.A.div(di||(di=(0,i.A)(["\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #1f2937;\n  margin-bottom: 0.25rem;\n"]))),Td=l.A.div(li||(li=(0,i.A)(["\n  font-size: 0.75rem;\n  color: #6b7280;\n  display: flex;\n  gap: 1rem;\n"]))),Id=l.A.div(ci||(ci=(0,i.A)(["\n  padding: 1rem;\n  text-align: center;\n  color: #6b7280;\n  font-size: 0.875rem;\n"]))),Pd=(l.A.select(pi||(pi=(0,i.A)(["\n  width: 100%;\n  box-sizing: border-box;\n  padding: 0.75rem;\n  border: 2px solid ",";\n  border-radius: 8px;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n  background: #ffffff;\n  cursor: pointer;\n\n  /* Zv\xfdrazn\u011bn\xe9 vybran\xe9 hodnoty vs. placeholder - slad\u011bno s CustomSelect */\n  color: ",";\n  font-weight: ",";\n\n  &:focus {\n    outline: none;\n    border-color: ",";\n    box-shadow: 0 0 0 3px ",";\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    color: #6b7280;\n    cursor: not-allowed;\n  }\n\n  /* Placeholder styl pro prvn\xed option */\n  option:first-of-type {\n    color: #9ca3af;\n    font-weight: 400;\n  }\n"])),e=>e.hasError?"#dc2626":"#e5e7eb",e=>e.value&&""!==e.value&&"placeholder"!==e.value?"#1f2937":"#6b7280",e=>e.disabled?"400":e.value&&""!==e.value&&"placeholder"!==e.value?"600":"400",e=>e.hasError?"#dc2626":"#3b82f6",e=>e.hasError?"rgba(220, 38, 38, 0.1)":"rgba(59, 130, 246, 0.1)"),l.A.div(ui||(ui=(0,i.A)(["\n  position: relative;\n  width: 100%;\n  z-index: ",";\n"])),e=>e.isOpen?1e4:1),l.A.div(vi||(vi=(0,i.A)(["\n  width: 100%;\n  box-sizing: border-box;\n  padding: 0.75rem 1.75rem 0.75rem 0.75rem;\n  border: 2px solid ",";\n  border-radius: 8px;\n  font-size: 0.875rem;\n  background: ",";\n  cursor: ",";\n  color: ",";\n\n  font-weight: ",";\n  min-height: 2.5rem;\n\n  display: flex;\n  align-items: center;\n  position: relative;\n  transition: all 0.2s ease;\n\n  /* Custom arrow */\n  appearance: none;\n  -moz-appearance: none;\n  -webkit-appearance: none;\n  background-image: ",";\n  background-repeat: no-repeat;\n  background-position: right 0.5rem center;\n  background-size: 16px 16px;\n\n  &:hover {\n    border-color: ",";\n  }\n\n  &:focus {\n    outline: none;\n    border-color: ",";\n    box-shadow: 0 0 0 3px ",";\n  }\n"])),e=>e.hasError?"#dc2626":"#e5e7eb",e=>e.disabled?"#f9fafb":"#ffffff",e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?"#6b7280":e.placeholder||!e.value||""===e.value?"#9ca3af":"#1f2937",e=>e.disabled?"400":e.value&&""!==e.value&&"true"!==e.placeholder?"600":"400",e=>e.disabled?e.isOpen?"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='18 15 12 9 6 15'%3E%3C/polyline%3E%3C/svg%3E\")":"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")":e.hasError?e.isOpen?"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23b91c1c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='18 15 12 9 6 15'%3E%3C/polyline%3E%3C/svg%3E\")":"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23b91c1c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")":e.isOpen?"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23374151' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='18 15 12 9 6 15'%3E%3C/polyline%3E%3C/svg%3E\")":"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23374151' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")",e=>e.disabled?"#e5e7eb":e.hasError?"#dc2626":"#3b82f6",e=>e.hasError?"#dc2626":"#3b82f6",e=>e.hasError?"rgba(220, 38, 38, 0.1)":"rgba(59, 130, 246, 0.1)"),l.A.span(_i||(_i=(0,i.A)(["\n  flex: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  color: ",";\n  font-weight: ",";\n"])),e=>e.isEmpty?"#9ca3af":"#1f2937",e=>e.isEmpty?"400":"600"),l.A.div(mi||(mi=(0,i.A)(["\n  position: fixed;\n  z-index: 40;\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.1);\n  max-height: 300px;\n  overflow-y: auto;\n  min-width: 200px;\n\n  /* Prevent text selection while scrolling */\n  user-select: none;\n\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #f9fafb;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 4px;\n  }\n"]))),l.A.div(fi||(fi=(0,i.A)(["\n  padding: 0.75rem;\n  cursor: pointer;\n  font-size: 0.875rem;\n  border-bottom: 1px solid #f3f4f6;\n  color: #1f2937;\n  font-weight: 400 !important; /* Normal font pro v\u0161echny mo\u017enosti - s !important */\n\n  &:hover {\n    background: #f8fafc;\n    font-weight: 400 !important; /* Z\u016fst\xe1v\xe1 normal i p\u0159i hover */\n  }\n\n  &:last-child {\n    border-bottom: none;\n  }\n\n  ","\n"])),e=>e.selected&&"\n    background: #eff6ff;\n    border-left: 3px solid #3b82f6;\n    font-weight: 600 !important; /* Bold jen pro vybranou mo\u017enost */\n  "),l.A.div(hi||(hi=(0,i.A)(["\n  position: fixed;\n  z-index: 40;\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.1);\n  max-height: 300px;\n  overflow-y: auto;\n  min-width: 200px;\n\n  /* Prevent text selection while scrolling */\n  user-select: none;\n\n  /* Optimalizace pro plynulej\u0161\xed scrollov\xe1n\xed */\n  scroll-behavior: auto;\n  contain: layout style paint;\n  will-change: scroll-position;\n  transform: translateZ(0); /* Force hardware acceleration */\n\n  /* Lep\u0161\xed scrollbar styling */\n  scrollbar-width: thin;\n  scrollbar-color: #d1d5db #f9fafb;\n\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #f9fafb;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background: #9ca3af;\n  }\n"]))),l.A.div(ki||(ki=(0,i.A)(["\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n  padding: 0.75rem;\n  border-bottom: 1px solid #e5e7eb;\n"]))),l.A.input(gi||(gi=(0,i.A)(["\n  width: 100%;\n  padding: 0.75rem 0.75rem 0.75rem 2.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  font-size: 0.875rem;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n  }\n"])))),Ld=(l.A.div(bi||(bi=(0,i.A)(["\n  position: absolute;\n  left: 1rem;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #6b7280;\n  pointer-events: none;\n"]))),l.A.div(yi||(yi=(0,i.A)(["\n  position: relative;\n  width: 100%;\n"]))),l.A.button(xi||(xi=(0,i.A)(["\n  position: absolute;\n  right: 0.75rem;\n  top: 50%;\n  transform: translateY(-50%);\n  background: none;\n  border: none;\n  color: #9ca3af;\n  cursor: pointer;\n  padding: 0.25rem;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n\n  &:hover {\n    color: #6b7280;\n    background: #f3f4f6;\n  }\n\n  &:active {\n    transform: translateY(-50%) scale(0.95);\n  }\n"]))),(0,l.A)(Pd)(ji||(ji=(0,i.A)(["\n  padding-right: 2.5rem;\n"]))),l.A.div(zi||(zi=(0,i.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.4);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 999999;\n  padding: 1rem;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n"])))),Rd=l.A.div(Ai||(Ai=(0,i.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n"]))),Vd=l.A.div(wi||(wi=(0,i.A)(["\n  background: white;\n  padding: 2rem;\n  border-radius: 8px;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n  max-width: 400px;\n  width: 90%;\n  z-index: 100001;\n"]))),Fd=l.A.div(Si||(Si=(0,i.A)(["\n  font-size: 1.125rem;\n  font-weight: 600;\n  margin-bottom: 1rem;\n  color: #dc2626;\n"]))),Md=l.A.div(Ei||(Ei=(0,i.A)(["\n  margin-bottom: 1.5rem;\n  color: #374151;\n  line-height: 1.5;\n"]))),Ud=l.A.div(Ci||(Ci=(0,i.A)(["\n  display: flex;\n  gap: 0.75rem;\n  justify-content: flex-end;\n"]))),Zd=l.A.button(Ni||(Ni=(0,i.A)(["\n  padding: 0.75rem 1.5rem;\n  background-color: ",";\n  color: ",";\n  border: none;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.15s ease;\n\n  &:hover {\n    background-color: ",";\n  }\n"])),e=>"danger"===e.variant?"#dc2626":"#f3f4f6",e=>"danger"===e.variant?"white":"#374151",e=>"danger"===e.variant?"#b91c1c":"#e5e7eb"),Bd=l.A.div(Oi||(Oi=(0,i.A)(["\n  background: white;\n  border-radius: 8px;\n  width: 100%;\n  max-width: 600px;\n  padding: 2rem;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n"]))),Kd=l.A.div(Di||(Di=(0,i.A)(["\n  margin-bottom: 1.5rem;\n  border-bottom: 1px solid #e5e7eb;\n  padding-bottom: 1rem;\n"]))),Hd=l.A.h2(Ti||(Ti=(0,i.A)(["\n  margin: 0;\n  color: #1e293b;\n  font-size: 1.25rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n"]))),Wd=l.A.button(Ii||(Ii=(0,i.A)(["\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  background: transparent;\n  border: none;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: #64748b;\n  transition: all 0.2s;\n  border-radius: 4px;\n\n  &:hover {\n    background: #f1f5f9;\n    color: #1e293b;\n  }\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n"]))),$d=l.A.div(Pi||(Pi=(0,i.A)(["\n  /* \u017d\xe1dn\xfd padding - u\u017e je v hlavn\xedm modalu */\n"]))),Jd=l.A.div(Li||(Li=(0,i.A)(["\n  margin-bottom: 1.25rem;\n"]))),Gd=l.A.label(Ri||(Ri=(0,i.A)(["\n  display: block;\n  font-size: 0.75rem;\n  font-weight: 700;\n  color: #64748b;\n  margin-bottom: 0.5rem;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n"]))),qd=l.A.input(Vi||(Vi=(0,i.A)(["\n  width: 100%;\n  padding: 10px 12px;\n  border: 2px solid #e5e7eb;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n  background: white;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n\n  &::placeholder {\n    color: #9ca3af;\n  }\n"]))),Yd=(l.A.select(Fi||(Fi=(0,i.A)(["\n  width: 100%;\n  padding: 10px 12px;\n  border: 2px solid #e5e7eb;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n  background: white;\n  cursor: pointer;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n\n  option {\n    padding: 8px;\n  }\n"]))),l.A.div(Mi||(Mi=(0,i.A)(["\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n  gap: 1rem;\n  margin-top: 0.75rem;\n"]))),l.A.label(Ui||(Ui=(0,i.A)(["\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  padding: 1rem;\n  border: 2px solid ",";\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  background: ",";\n\n  &:hover {\n    border-color: #10b981;\n    background: ",";\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);\n  }\n"])),e=>e.checked?"#10b981":"#e5e7eb",e=>e.checked?"linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)":"white",e=>e.checked?"linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)":"#f8fafc"),l.A.input(Zi||(Zi=(0,i.A)(["\n  appearance: none;\n  width: 20px;\n  height: 20px;\n  border: 2px solid #d1d5db;\n  border-radius: 50%;\n  position: relative;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  margin-top: 2px;\n\n  &:checked {\n    border-color: #10b981;\n    background: #10b981;\n  }\n\n  &:checked::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 8px;\n    height: 8px;\n    background: white;\n    border-radius: 50%;\n  }\n"]))),l.A.div(Bi||(Bi=(0,i.A)(["\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: ",";\n  line-height: 1.4;\n"])),e=>e.checked?"#065f46":"#374151"),l.A.div(Ki||(Ki=(0,i.A)(["\n  display: flex;\n  gap: 0.75rem;\n  justify-content: flex-end;\n  margin-top: 1.5rem;\n  padding-top: 1.5rem;\n  border-top: 1px solid #e5e7eb;\n"])))),Xd=l.A.button(Hi||(Hi=(0,i.A)(["\n  padding: 0.625rem 1.25rem;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  cursor: ",";\n  transition: all 0.2s;\n\n  ","\n"])),e=>e.disabled?"not-allowed":"pointer",e=>"cancel"===e.variant?"\n    background: white;\n    color: #64748b;\n    border: 1px solid #e2e8f0;\n\n    &:hover {\n      background: #f8fafc;\n      border-color: #cbd5e1;\n    }\n  ":"\n    background: ".concat(e.disabled?"#cbd5e1":"#3b82f6",";\n    color: white;\n    border: 1px solid ").concat(e.disabled?"#cbd5e1":"#3b82f6",";\n\n    &:hover:not(:disabled) {\n      background: #2563eb;\n      border-color: #2563eb;\n    }\n\n    &:disabled {\n      cursor: not-allowed;\n    }\n  ")),Qd=(l.A.div(Wi||(Wi=(0,i.A)(["\n  padding: ",";\n  cursor: pointer;\n  font-size: 0.875rem;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  background: ",";\n  border-bottom: ",";\n  font-weight: ",";\n  color: ",";\n  position: relative;\n  /* Optimalizace pro plynulej\u0161\xed scrollov\xe1n\xed */\n  will-change: transform;\n  backface-visibility: hidden;\n  /* Focusable pro tab navigaci */\n  outline: none;\n\n  &:hover {\n    background: ",';\n  }\n\n  &:focus {\n    background: #dbeafe;\n    box-shadow: inset 0 0 0 2px #3b82f6;\n  }\n\n  &:last-child {\n    border-bottom: none;\n  }\n\n  input[type="checkbox"] {\n    margin: 0;\n    /* Zabr\xe1nit p\u0159efokusov\xe1n\xed p\u0159i kliknut\xed na checkbox */\n    pointer-events: none;\n  }\n\n  span {\n    padding-left: ',"px;\n    font-weight: ",";\n  }\n"])),e=>0===e.level?"0.75rem":"0.5rem 0.75rem 0.5rem 2rem",e=>0===e.level?"#f9fafb":"#ffffff",e=>0===e.level?"2px solid #e5e7eb":"1px solid #f3f4f6",e=>0===e.level?"600":"400",e=>0===e.level?"#111827":"#4b5563",e=>0===e.level?"#f3f4f6":"#f8fafc",e=>20*(e.level||0),e=>0===(e.level||0)?"600":"400"),l.A.div($i||($i=(0,i.A)(["\n  display: flex;\n  gap: 1rem;\n  align-items: center;\n  margin-top: 0.5rem;\n"]))),l.A.label(Ji||(Ji=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-size: 0.875rem;\n  color: #374151;\n"]))),l.A.input(Gi||(Gi=(0,i.A)(["\n  width: 16px;\n  height: 16px;\n  cursor: pointer;\n"]))),l.A.button(qi||(qi=(0,i.A)(["\n  background: transparent;\n  color: #f59e0b;\n  border: none;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n  padding: 0;\n  margin-right: 8px;\n\n  &:hover {\n    color: #d97706;\n    transform: scale(1.1);\n  }\n\n  &:active {\n    transform: scale(0.95);\n  }\n\n  svg {\n    width: 16px;\n    height: 16px;\n  }\n"])))),el=l.A.div(Yi||(Yi=(0,i.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(248, 250, 252, 0.95);\n  backdrop-filter: blur(",");\n  -webkit-backdrop-filter: blur(",");\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  z-index: 999999;\n  opacity: ",";\n  transition: opacity 0.5s ease-in-out, backdrop-filter 0.6s ease-in-out;\n  pointer-events: ",";\n\n  @media (max-width: 768px) {\n    padding: 1rem;\n  }\n"])),e=>e.$visible?"8px":"0px",e=>e.$visible?"8px":"0px",e=>e.$visible?1:0,e=>e.$visible?"auto":"none"),nl=l.A.div(Xi||(Xi=(0,i.A)(["\n  width: 64px;\n  height: 64px;\n  border: 4px solid #e2e8f0;\n  border-top: 4px solid #f59e0b;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n  margin-bottom: 1.5rem;\n  transform: scale(",");\n  transition: transform 0.5s ease-in-out;\n\n  @keyframes spin {\n    0% { transform: rotate(0deg) scale(1); }\n    100% { transform: rotate(360deg) scale(1); }\n  }\n"])),e=>e.$visible?1:.8),al=l.A.div(Qi||(Qi=(0,i.A)(["\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #374151;\n  text-align: center;\n  margin-bottom: 0.5rem;\n  transform: translateY(",");\n  opacity: ",";\n  transition: transform 0.5s ease-in-out 0.1s, opacity 0.5s ease-in-out 0.1s;\n"])),e=>e.$visible?"0":"10px",e=>e.$visible?1:0),ol=l.A.div(er||(er=(0,i.A)(["\n  font-size: 0.875rem;\n  color: #6b7280;\n  text-align: center;\n  transform: translateY(",");\n  opacity: ",";\n  transition: transform 0.5s ease-in-out 0.15s, opacity 0.5s ease-in-out 0.15s;\n"])),e=>e.$visible?"0":"10px",e=>e.$visible?1:0),tl=l.A.div(nr||(nr=(0,i.A)(["\n  position: fixed;\n  top: var(--fixed-header-height, 0px);\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.2);\n  backdrop-filter: blur(",");\n  -webkit-backdrop-filter: blur(",");\n  z-index: 99;\n  opacity: ",";\n  transition: opacity 0.3s ease-in-out, backdrop-filter 0.3s ease-in-out;\n  pointer-events: ",";\n  visibility: ",";\n"])),e=>e.$visible?"5px":"0px",e=>e.$visible?"5px":"0px",e=>e.$visible?1:0,e=>e.$visible?"auto":"none",e=>e.$visible?"visible":"hidden"),il=(l.A.div(ar||(ar=(0,i.A)(["\n  filter: blur(",");\n  transition: filter 0.6s ease-in-out;\n  pointer-events: ",";\n"])),e=>e.$blurred?"3px":"0px",e=>e.$blurred?"none":"auto"),l.A.div(or||(or=(0,i.A)(["\n  width: 300px;\n  height: 6px;\n  background: #e2e8f0;\n  border-radius: 3px;\n  overflow: hidden;\n  margin-top: 1.5rem;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) inset;\n"]))),l.A.div(tr||(tr=(0,i.A)(["\n  height: 100%;\n  background: linear-gradient(90deg, #2e7d32, #4caf50 40%, #66bb6a);\n  border-radius: 3px;\n  transition: width 250ms ease;\n  box-shadow: 0 0 6px rgba(76, 175, 80, 0.55);\n"]))),l.A.div(ir||(ir=(0,i.A)(["\n  background: #fee2e2;\n  border: 1px solid #fecaca;\n  border-radius: 8px;\n  padding: 1rem;\n  color: #dc2626;\n  font-size: 0.875rem;\n  margin: 1rem 0;\n  text-align: center;\n"])))),rl=l.A.div(rr||(rr=(0,i.A)(["\n  position: absolute;\n  right: 35px;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #059669;\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n\n  &:hover {\n    background-color: #f0fdf4;\n    color: #047857;\n  }\n\n  &:active {\n    background-color: #dcfce7;\n  }\n"]))),sl=l.A.div(sr||(sr=(0,i.A)(["\n  position: absolute;\n  right: 8px;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #059669;\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n\n  &:hover {\n    background-color: #f0fdf4;\n    color: #047857;\n  }\n\n  &:active {\n    background-color: #dcfce7;\n  }\n"]))),dl=l.A.div(dr||(dr=(0,i.A)(["\n  color: ",";\n  cursor: ",";\n  padding: 6px;\n  border-radius: 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  transition: all 0.2s;\n  opacity: ",";\n  background: ",";\n\n  ","\n"])),e=>e.isActive?"#667eea":"#d1d5db",e=>e.isActive?"pointer":"not-allowed",e=>e.isActive?1:.5,e=>e.isActive?"rgba(102, 126, 234, 0.1)":"transparent",e=>e.isActive&&"\n    &:hover {\n      background-color: rgba(102, 126, 234, 0.2);\n      color: #764ba2;\n      transform: scale(1.1);\n    }\n\n    &:active {\n      background-color: rgba(118, 75, 162, 0.2);\n      transform: scale(1.05);\n    }\n  "),ll=l.A.button(lr||(lr=(0,i.A)(["\n  background: #ef4444;\n  color: white;\n  border: 2px solid white;\n  border-radius: 6px;\n  padding: 0.375rem;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  transition: all 0.2s;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\n  &:hover {\n    background-color: #dc2626;\n    transform: scale(1.1);\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);\n  }\n\n  &:active {\n    background-color: #b91c1c;\n    transform: scale(0.95);\n  }\n"]))),cl=l.A.div(cr||(cr=(0,i.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n"]))),pl=l.A.div(pr||(pr=(0,i.A)(["\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 800px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  animation: slideUp 0.3s ease-out;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n"]))),ul=l.A.div(ur||(ur=(0,i.A)(["\n  padding: 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n"]))),vl=l.A.h2(vr||(vr=(0,i.A)(["\n  margin: 0;\n  font-size: 20px;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  color: white;\n\n  svg {\n    font-size: 24px;\n  }\n"]))),_l=l.A.button(_r||(_r=(0,i.A)(["\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 24px;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n"]))),ml=l.A.input(mr||(mr=(0,i.A)(["\n  width: 100%;\n  padding: 10px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 6px;\n  font-size: 14px;\n  transition: all 0.2s;\n\n  &:focus {\n    outline: none;\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 2px rgba(24,144,255,0.1);\n  }\n\n  &::placeholder {\n    color: #8c8c8c;\n  }\n"]))),fl=l.A.div(fr||(fr=(0,i.A)(["\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n"]))),hl=l.A.div(hr||(hr=(0,i.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  max-height: 400px;\n  overflow-y: auto;\n"]))),kl=l.A.div(kr||(kr=(0,i.A)(["\n  padding: 16px;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s;\n  background: white;\n\n  &:hover {\n    border-color: #667eea;\n    background-color: #f9fafb;\n    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);\n  }\n"]))),gl=l.A.div(gr||(gr=(0,i.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n"]))),bl=l.A.div(br||(br=(0,i.A)(["\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 900px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  animation: slideUp 0.3s ease-out;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n"]))),yl=l.A.div(yr||(yr=(0,i.A)(["\n  padding: 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n"]))),xl=l.A.h2(xr||(xr=(0,i.A)(["\n  margin: 0;\n  font-size: 18px;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  color: white;\n\n  svg {\n    width: 24px;\n    height: 24px;\n  }\n"]))),jl=l.A.button(jr||(jr=(0,i.A)(["\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n"]))),zl=l.A.div(zr||(zr=(0,i.A)(["\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n"]))),Al=l.A.input(Ar||(Ar=(0,i.A)(["\n  width: 100%;\n  padding: 10px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 6px;\n  font-size: 14px;\n  margin-bottom: 20px;\n  transition: all 0.2s;\n\n  &:focus {\n    outline: none;\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 2px rgba(24,144,255,0.1);\n  }\n\n  &::placeholder {\n    color: #8c8c8c;\n  }\n"]))),wl=l.A.div(wr||(wr=(0,i.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  max-height: 400px;\n  overflow-y: auto;\n"]))),Sl=l.A.div(Sr||(Sr=(0,i.A)(["\n  padding: 16px;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  background: white;\n  position: relative;\n\n  &:hover {\n    border-color: #667eea;\n    background-color: #f9fafb;\n    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);\n  }\n"]))),El=l.A.div(Er||(Er=(0,i.A)(["\n  cursor: pointer;\n  margin-bottom: ",";\n"])),e=>e.hasButtons?"12px":"0"),Cl=l.A.div(Cr||(Cr=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  margin-top: 8px;\n  flex-wrap: wrap;\n"]))),Nl=l.A.div(Nr||(Nr=(0,i.A)(["\n  display: inline-flex;\n  align-items: center;\n  gap: 4px;\n  padding: 4px 10px;\n  border-radius: 12px;\n  font-size: 11px;\n  font-weight: 600;\n  background: ",";\n  color: white;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\n  svg {\n    width: 12px;\n    height: 12px;\n  }\n"])),e=>"global"===e.scope?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"usek"===e.scope?"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)":"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)"),Ol=l.A.div(Or||(Or=(0,i.A)(["\n  display: flex;\n  gap: 8px;\n  margin-top: 12px;\n  padding-top: 12px;\n  border-top: 1px solid #e5e7eb;\n"]))),Dl=l.A.button(Dr||(Dr=(0,i.A)(["\n  padding: 10px 16px;\n  border: none;\n  border-radius: 6px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  white-space: nowrap;\n\n  &:disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n  }\n\n  &.primary {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);\n\n    &:hover:not(:disabled) {\n      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);\n      transform: translateY(-1px);\n    }\n\n    &:active:not(:disabled) {\n      transform: translateY(0);\n    }\n  }\n\n  &.success {\n    background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n    color: white;\n    box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);\n\n    &:hover:not(:disabled) {\n      box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);\n      transform: translateY(-1px);\n    }\n\n    &:active:not(:disabled) {\n      transform: translateY(0);\n    }\n  }\n"]))),Tl=(l.A.select(Tr||(Tr=(0,i.A)(["\n  width: 100%;\n  padding: 10px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 6px;\n  background: white;\n  font-size: 14px;\n  color: #262626;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n\n  &:focus {\n    outline: none;\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 2px rgba(24,144,255,0.1);\n  }\n\n  &:hover {\n    border-color: #40a9ff;\n  }\n"]))),l.A.div(Ir||(Ir=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 40px 20px;\n  color: #6b7280;\n\n  @keyframes spin {\n    to { transform: rotate(360deg); }\n  }\n"])))),Il=l.A.div(Pr||(Pr=(0,i.A)(["\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 8px;\n  margin-top: 8px;\n  margin-bottom: 16px;\n"]))),Pl=l.A.button(Lr||(Lr=(0,i.A)(["\n  padding: 12px;\n  border: 2px solid ",";\n  border-radius: 8px;\n  background: ",";\n  color: ",";\n  cursor: ",";\n  opacity: ",";\n  transition: all 0.2s;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 6px;\n  font-size: 13px;\n  font-weight: 500;\n  position: relative;\n\n  &:hover:not(:disabled) {\n    border-color: #667eea;\n    background: ",";\n  }\n\n  svg {\n    font-size: 18px;\n  }\n"])),e=>e.selected?"#667eea":"#e5e7eb",e=>e.selected?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"white",e=>e.selected?"white":"#595959",e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?.5:1,e=>e.selected?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"#f9fafb"),Ll=l.A.div(Rr||(Rr=(0,i.A)(["\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));\n  gap: 8px;\n  margin-top: 12px;\n"]))),Rl=l.A.label(Vr||(Vr=(0,i.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  padding: 8px 10px;\n  border: 2px solid ",";\n  border-radius: 6px;\n  background: ",";\n  cursor: ",";\n  opacity: ",";\n  transition: all 0.2s;\n  font-size: 13px;\n  font-weight: 600;\n  color: ",';\n\n  &:hover:not([disabled]) {\n    border-color: #667eea;\n    background: rgba(102, 126, 234, 0.05);\n  }\n\n  input[type="checkbox"] {\n    width: 16px;\n    height: 16px;\n    cursor: ',";\n  }\n"])),e=>e.selected?"#667eea":"#e5e7eb",e=>e.selected?"rgba(102, 126, 234, 0.05)":"white",e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?.5:1,e=>e.selected?"#667eea":"#374151",e=>e.disabled?"not-allowed":"pointer"),Vl=l.A.div(Fr||(Fr=(0,i.A)(['\n  position: absolute;\n  top: calc(100% + 8px);\n  left: 0;\n  right: 0;\n  background: white;\n  border: 2px solid #e5e7eb;\n  border-radius: 8px;\n  padding: 16px;\n  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);\n  z-index: 100;\n\n  &[data-status="checking"] {\n    border-color: #3b82f6;\n  }\n\n  &[data-status="found-local"], &[data-status="found-ares"] {\n    border-color: #10b981;\n  }\n\n  &[data-status="not-found"] {\n    border-color: #ef4444;\n  }\n']))),Fl=l.A.h4(Mr||(Mr=(0,i.A)(["\n  margin: 0 0 8px 0;\n  font-size: 14px;\n  font-weight: 600;\n  color: ",";\n"])),e=>"checking"===e.status?"#3b82f6":"found"===e.status?"#10b981":"not-found"===e.status?"#ef4444":"#111827"),Ml=l.A.div(Ur||(Ur=(0,i.A)(["\n  font-size: 13px;\n  color: #6b7280;\n  margin-bottom: 12px;\n  line-height: 1.4;\n"]))),Ul=l.A.div(Zr||(Zr=(0,i.A)(["\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n"]))),Zl=l.A.button(Br||(Br=(0,i.A)(["\n  padding: 6px 12px;\n  border-radius: 6px;\n  font-size: 12px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n\n  &.primary {\n    background: #10b981;\n    color: white;\n    border: 1px solid #10b981;\n\n    &:hover {\n      background: #059669;\n    }\n  }\n\n  &.fill-form {\n    background: #3b82f6;\n    color: white;\n    border: 1px solid #3b82f6;\n\n    &:hover {\n      background: #2563eb;\n    }\n  }\n\n  &.secondary {\n    background: white;\n    color: #6b7280;\n    border: 1px solid #d1d5db;\n\n    &:hover {\n      background: #f9fafb;\n      color: #374151;\n    }\n  }\n"]))),Bl=l.A.div(Kr||(Kr=(0,i.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 999999;\n  padding: 1rem;\n"]))),Kl=l.A.div(Hr||(Hr=(0,i.A)(["\n  background: white;\n  border-radius: 8px;\n  padding: 2rem;\n  max-width: 700px;\n  width: 100%;\n  max-height: 85vh;\n  overflow-y: auto;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n  position: relative;\n"]))),Hl=l.A.div(Wr||(Wr=(0,i.A)(["\n  margin-bottom: 1.5rem;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid #e5e7eb;\n"]))),Wl=l.A.h3($r||($r=(0,i.A)(["\n  margin: 0;\n  color: #1e293b;\n  font-size: 1.25rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n"]))),$l=l.A.button(Jr||(Jr=(0,i.A)(["\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  background: transparent;\n  border: none;\n  border-radius: 4px;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: #64748b;\n  transition: all 0.2s;\n\n  &:hover {\n    background: #f1f5f9;\n    color: #1e293b;\n  }\n"]))),Jl=l.A.div(Gr||(Gr=(0,i.A)(["\n  margin-bottom: 1.5rem;\n  padding: 1.25rem;\n  background: #f8fafc;\n  border-radius: 8px;\n  border: 1px solid #e5e7eb;\n"]))),Gl=l.A.h4(qr||(qr=(0,i.A)(["\n  margin: 0 0 1rem 0;\n  color: #1e293b;\n  font-size: 0.875rem;\n  font-weight: 700;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n"]))),ql=l.A.div(Yr||(Yr=(0,i.A)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  padding: 0.625rem 0;\n  border-bottom: 1px solid #e5e7eb;\n\n  &:last-child {\n    border-bottom: none;\n    padding-bottom: 0;\n  }\n"]))),Yl=l.A.span(Xr||(Xr=(0,i.A)(["\n  color: #64748b;\n  font-size: 0.875rem;\n  font-weight: 500;\n  min-width: 120px;\n  flex-shrink: 0;\n"]))),Xl=l.A.span(Qr||(Qr=(0,i.A)(["\n  color: #1e293b;\n  font-size: 0.875rem;\n  font-weight: 600;\n  text-align: right;\n  flex: 1;\n  margin-left: 1rem;\n  word-break: break-word;\n"]))),Ql=l.A.div(es||(es=(0,i.A)(["\n  margin-top: 0.75rem;\n"]))),ec=l.A.div(ns||(ns=(0,i.A)(["\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 0.75rem;\n  margin-bottom: 0.5rem;\n\n  &:last-child {\n    margin-bottom: 0;\n  }\n"]))),nc=l.A.div(as||(as=(0,i.A)(["\n  font-weight: 600;\n  color: #1e293b;\n  font-size: 0.875rem;\n  margin-bottom: 0.375rem;\n"]))),ac=l.A.div(os||(os=(0,i.A)(["\n  font-size: 0.75rem;\n  color: #64748b;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n"]))),oc=l.A.span(ts||(ts=(0,i.A)(["\n  background: ",";\n  color: white;\n  padding: 0.25rem 0.625rem;\n  border-radius: 4px;\n  font-size: 0.6875rem;\n  font-weight: 700;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n"])),e=>"po"===e.type?"#3b82f6":"details"===e.type?"#10b981":"#8b5cf6"),tc=l.A.div(is||(is=(0,i.A)(["\n  text-align: center;\n  padding: 2rem;\n  color: #9ca3af;\n  font-style: italic;\n"]))),ic=l.A.div(rs||(rs=(0,i.A)(["\n  position: relative;\n  display: flex;\n  align-items: center;\n"]))),rc=l.A.span(ss||(ss=(0,i.A)(["\n  position: absolute;\n  right: 12px;\n  color: ",";\n  font-weight: 600;\n  font-size: 0.875rem;\n  font-family: inherit;\n  pointer-events: none;\n  user-select: none;\n  display: flex;\n  align-items: center;\n  height: 100%;\n"])),e=>e.disabled?"#9ca3af":"#374151");function sc(e){let{fieldName:n,value:a,onChange:o,onBlur:t,disabled:i,hasError:s,placeholder:d}=e;const l=(0,r.useRef)(null),[c,p]=(0,r.useState)(""),[u,_]=(0,r.useState)(!1),m=e=>{if(!e&&0!==e)return"";const n=parseFloat(e.toString().replace(/[^0-9.-]/g,""));return isNaN(n)?"":n.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g," ").replace(".",",")};(0,r.useEffect)(()=>{if(!u){const e=m(a||"");c!==e&&p(e)}},[a,u]);return(0,fe.jsxs)(ic,{children:[(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(v.A,{}),(0,fe.jsx)(Sd,{ref:l,type:"text",name:n,placeholder:d,value:c,onChange:e=>{const a=e.target.value;p(a);const t=a.replace(/[^\d,.-]/g,"").replace(",","."),i=parseFloat(t),r=isNaN(i)?"":i.toFixed(2);o(n,r)},onFocus:()=>{_(!0)},onBlur:()=>{_(!1);const e=m(c);p(e);const a=c.replace(/[^\d,.-]/g,"").replace(",","."),o=parseFloat(a),i=isNaN(o)?"":o.toFixed(2);t&&t(n,i)},disabled:i,style:{textAlign:"right",paddingRight:"40px"},hasError:s,hasIcon:!0})]}),(0,fe.jsx)(rc,{disabled:i,children:"K\u010d"})]})}function dc(e){let{fieldName:n,value:a,onChange:o,onBlur:t,disabled:i,hasError:s,placeholder:d="Vyberte datum"}=e;const[l,c]=(0,r.useState)(!1),[p,u]=(0,r.useState)(new Date),[v,m]=(0,r.useState)(!1),f=(0,r.useRef)(null),h=(0,r.useRef)(null),k=a?new Date(a):null;(0,r.useEffect)(()=>{if(a){const e=new Date(a);isNaN(e.getTime())||u(e)}},[a]),(0,r.useEffect)(()=>{const e=e=>{f.current&&!f.current.contains(e.target)&&c(!1)};return l&&document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[l]),(0,r.useEffect)(()=>{if(l&&f.current){const e=()=>{if(!f.current)return;const e=f.current.getBoundingClientRect(),n=window.innerHeight-e.bottom-54-20,a=e.top-20;m(n<300||n<380&&a>n+50)};e();const n=document.querySelector('[class*="ScrollableContent"]');if(n)return n.addEventListener("scroll",e),()=>n.removeEventListener("scroll",e)}},[l]);const g=e=>{const n=(e=>{const n=new Date(e),a=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),t=String(n.getDate()).padStart(2,"0");return"".concat(a,"-").concat(o,"-").concat(t)})(e);o(n),t&&t(n),c(!1)},b=new Date,y=(()=>{const e=p.getFullYear(),n=p.getMonth(),a=new Date(e,n,1),o=new Date(e,n+1,0),t=[];for(let r=(0===a.getDay()?6:a.getDay()-1)-1;r>=0;r--){const a=new Date(e,n,-r);t.push({date:a,isOtherMonth:!0})}for(let r=1;r<=o.getDate();r++){const a=new Date(e,n,r);t.push({date:a,isOtherMonth:!1})}const i=42-t.length;for(let r=1;r<=i;r++){const a=new Date(e,n+1,r);t.push({date:a,isOtherMonth:!0})}return t})(),x=a?(e=>{if(!e)return"";try{const n=new Date(e);return isNaN(n.getTime())?"":n.toLocaleDateString("cs-CZ",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(n){return""}})(a):d;return(0,fe.jsxs)(lc,{ref:f,"data-field":n,children:[(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(_.A,{}),(0,fe.jsx)(cc,{type:"button",onClick:()=>!i&&c(!l),disabled:i,hasError:s,hasValue:!!a,"data-datepicker":n,children:x}),a&&!i&&(0,fe.jsx)(pc,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),(e=>{e&&(e.preventDefault(),e.stopPropagation()),o(""),t&&t(""),c(!1)})(e)},title:"Smazat datum",children:"\u2715"}),!i&&(0,fe.jsx)(uc,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),(e=>{e&&(e.preventDefault(),e.stopPropagation()),g(new Date)})(e)},title:"Nastavit dne\u0161n\xed datum",children:"\ud83d\udcc5"})]}),l&&!i&&(0,fe.jsxs)(vc,{ref:h,openUpwards:v,children:[(0,fe.jsxs)(_c,{children:[(0,fe.jsx)(mc,{onClick:e=>{e.preventDefault(),e.stopPropagation(),(e=>{e&&(e.preventDefault(),e.stopPropagation()),u(new Date(p.getFullYear(),p.getMonth()-1))})(e)},children:"\u25c0"}),(0,fe.jsxs)(fc,{children:[(0,fe.jsx)("span",{children:p.toLocaleDateString("cs-CZ",{month:"long"})}),(0,fe.jsx)("span",{children:p.getFullYear()})]}),(0,fe.jsx)(mc,{onClick:e=>{e.preventDefault(),e.stopPropagation(),(e=>{e&&(e.preventDefault(),e.stopPropagation()),u(new Date(p.getFullYear(),p.getMonth()+1))})(e)},children:"\u25b6"})]}),(0,fe.jsxs)(hc,{children:[(0,fe.jsx)(kc,{children:"Po"}),(0,fe.jsx)(kc,{children:"\xdat"}),(0,fe.jsx)(kc,{children:"St"}),(0,fe.jsx)(kc,{children:"\u010ct"}),(0,fe.jsx)(kc,{children:"P\xe1"}),(0,fe.jsx)(kc,{children:"So"}),(0,fe.jsx)(kc,{children:"Ne"}),y.map((e,n)=>{const a=e.date.toDateString()===b.toDateString(),o=k&&e.date.toDateString()===k.toDateString();return(0,fe.jsx)(gc,{onClick:n=>{n.stopPropagation(),g(e.date)},isToday:a,isSelected:o,isOtherMonth:e.isOtherMonth,children:e.date.getDate()},n)})]}),(0,fe.jsxs)(bc,{children:[(0,fe.jsx)(yc,{className:"today",onClick:e=>{e.preventDefault(),e.stopPropagation(),g(new Date)},children:"Dnes"}),(0,fe.jsx)(yc,{className:"clear",onClick:e=>{e.preventDefault(),e.stopPropagation(),o(""),t&&t(""),c(!1)},children:"Smazat"})]})]})]})}const lc=l.A.div(ds||(ds=(0,i.A)(["\n  position: relative;\n  width: 100%;\n"]))),cc=l.A.button(ls||(ls=(0,i.A)(["\n  width: 100%;\n  display: block;\n  padding: 0.75rem;\n  padding-left: 2.75rem;\n  padding-right: ",";\n  border: 2px solid ",";\n  border-radius: 8px;\n  background: ",";\n  color: ",";\n  font-size: 0.875rem;\n  font-weight: ",";\n  line-height: 1.5;\n  cursor: ",";\n  transition: all 0.2s ease;\n  text-align: left;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  min-height: 42px;\n  box-sizing: border-box;\n\n  &:hover:not(:disabled) {\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n"])),e=>e.disabled?"0.75rem":e.hasValue?"4.5rem":"3rem",e=>e.hasError?"#ef4444":"#e5e7eb",e=>e.disabled?"#f9fafb":"white",e=>e.disabled?"#6b7280":e.hasValue?"#1f2937":"#9ca3af",e=>e.hasValue&&!e.disabled?"600":"400",e=>e.disabled?"not-allowed":"pointer"),pc=l.A.button(cs||(cs=(0,i.A)(["\n  position: absolute;\n  right: 36px;\n  top: 50%;\n  transform: translateY(-50%);\n  background: #ef4444;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: bold;\n  transition: all 0.2s ease;\n  z-index: 1;\n\n  &:hover {\n    background: #dc2626;\n    transform: translateY(-50%) scale(1.1);\n  }\n"]))),uc=l.A.button(ps||(ps=(0,i.A)(["\n  position: absolute;\n  right: 8px;\n  top: 50%;\n  transform: translateY(-50%);\n  background: transparent;\n  color: #3b82f6;\n  border: none;\n  border-radius: 4px;\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  font-size: 13px;\n  font-weight: bold;\n  transition: all 0.2s ease;\n  z-index: 1;\n\n  &:hover {\n    background: transparent;\n    color: #2563eb;\n    transform: translateY(-50%) scale(1.15);\n  }\n"]))),vc=l.A.div(us||(us=(0,i.A)(["\n  position: absolute;\n  ","\n  left: 0;\n  right: 0;\n  z-index: 10001;\n  background: white;\n  border: 2px solid #3b82f6;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n  padding: 0.5rem;\n"])),e=>e.openUpwards?"\n    bottom: calc(100% + 4px);\n    top: auto;\n  ":"\n    top: calc(100% + 4px);\n    bottom: auto;\n  "),_c=l.A.div(vs||(vs=(0,i.A)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n  padding-bottom: 0.35rem;\n  border-bottom: 1px solid #e5e7eb;\n"]))),mc=l.A.button(_s||(_s=(0,i.A)(["\n  background: #f3f4f6;\n  border: none;\n  border-radius: 4px;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: #374151;\n  font-weight: 600;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n\n  &:hover {\n    background: #3b82f6;\n    color: white;\n    transform: scale(1.1);\n  }\n"]))),fc=l.A.div(ms||(ms=(0,i.A)(["\n  font-weight: 600;\n  font-size: 0.85rem;\n  color: #111827;\n  display: flex;\n  gap: 0.35rem;\n"]))),hc=l.A.div(fs||(fs=(0,i.A)(["\n  display: grid;\n  grid-template-columns: repeat(7, 1fr);\n  gap: 1px;\n"]))),kc=l.A.div(hs||(hs=(0,i.A)(["\n  aspect-ratio: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 0.65rem;\n  font-weight: 600;\n  color: #6b7280;\n  padding: 0.15rem;\n"]))),gc=l.A.button(ks||(ks=(0,i.A)(["\n  aspect-ratio: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 0.75rem;\n  border: none;\n  border-radius: 4px;\n  background: ",";\n  color: ",";\n  font-weight: ",";\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &:hover {\n    background: ",";\n    transform: scale(1.1);\n    color: ",";\n  }\n"])),e=>e.isToday?"#dbeafe":e.isSelected?"#3b82f6":"transparent",e=>e.isSelected?"white":e.isOtherMonth?"#9ca3af":"#374151",e=>e.isToday||e.isSelected?"600":"400",e=>e.isSelected?"#2563eb":"#f3f4f6",e=>e.isSelected?"white":"#111827"),bc=l.A.div(gs||(gs=(0,i.A)(["\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 0.5rem;\n  padding-top: 0.5rem;\n  border-top: 2px solid #e5e7eb;\n"]))),yc=l.A.button(bs||(bs=(0,i.A)(["\n  flex: 1;\n  padding: 0.5rem;\n  border: none;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &.today {\n    background: #dbeafe;\n    color: #1e40af;\n\n    &:hover {\n      background: #bfdbfe;\n    }\n  }\n\n  &.clear {\n    background: #fee2e2;\n    color: #991b1b;\n\n    &:hover {\n      background: #fecaca;\n    }\n  }\n"]))),xc=l.A.div(ys||(ys=(0,i.A)(["\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 6px;\n  cursor: help;\n\n  &:hover .tooltip-bubble {\n    opacity: 1;\n    visibility: visible;\n    transform: translateY(0);\n  }\n\n  &:hover .help-icon {\n    color: #3b82f6;\n  }\n"]))),jc=l.A.span(xs||(xs=(0,i.A)(["\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  width: 16px;\n  height: 16px;\n  color: #6b7280;\n  transition: color 0.2s ease;\n\n  svg {\n    width: 16px;\n    height: 16px;\n  }\n"]))),zc=l.A.div(js||(js=(0,i.A)(["\n  position: absolute;\n  bottom: calc(100% + 8px);\n  left: 50%;\n  transform: translateX(-50%) translateY(-4px);\n  width: 320px;\n  padding: 12px;\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);\n  opacity: 0;\n  visibility: hidden;\n  transition: all 0.2s ease;\n  z-index: 1000;\n  pointer-events: none;\n\n  /* \u0160ipka dol\u016f */\n  &::after {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    width: 0;\n    height: 0;\n    border-left: 6px solid transparent;\n    border-right: 6px solid transparent;\n    border-top: 6px solid #ffffff;\n  }\n\n  &::before {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    width: 0;\n    height: 0;\n    border-left: 7px solid transparent;\n    border-right: 7px solid transparent;\n    border-top: 7px solid #e5e7eb;\n    margin-top: 1px;\n    z-index: -1;\n  }\n"]))),Ac=l.A.div(zs||(zs=(0,i.A)(["\n  display: flex;\n  justify-content: space-between;\n  padding: 6px 0;\n  font-size: 0.75rem;\n  border-bottom: 1px solid #f3f4f6;\n\n  &:last-child {\n    border-bottom: none;\n  }\n"]))),wc=l.A.span(As||(As=(0,i.A)(["\n  color: #6b7280;\n  font-weight: 500;\n"]))),Sc=l.A.span(ws||(ws=(0,i.A)(["\n  color: #1f2937;\n  font-weight: 600;\n  text-align: right;\n  max-width: 180px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n"]))),Ec=(e,n)=>{if(!Array.isArray(e)||0===e.length)return e;return e.map(e=>n.find(n=>n.value&&n.value===e||n.kod&&n.kod===e||n.kod_stavu&&n.kod_stavu===e)?e:"100")},Cc=e=>{if(!e)return{};const n=(0,t.A)({},e);if(e.polozky&&!e.polozky_objednavky&&(n.polozky_objednavky=Array.isArray(e.polozky)?e.polozky.map(e=>(0,t.A)((0,t.A)({},e),{},{cena_bez_dph:"number"===typeof e.cena_bez_dph?e.cena_bez_dph.toFixed(2):(parseFloat((e.cena_bez_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0).toFixed(2),cena_s_dph:"number"===typeof e.cena_s_dph?e.cena_s_dph.toFixed(2):(parseFloat((e.cena_s_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0).toFixed(2),sazba_dph:parseInt(e.sazba_dph)||21})):[],delete n.polozky),e.strediska_kod&&(n.strediska_kod=Ra(e.strediska_kod)),e.financovani){const a=Fa(e.financovani);Object.assign(n,a)}if(e.cislo_objednavky&&!e.ev_cislo&&(n.ev_cislo=e.cislo_objednavky),e.stav_workflow_kod&&"string"===typeof e.stav_workflow_kod&&e.stav_workflow_kod.trim().startsWith("["))try{const a=JSON.parse(e.stav_workflow_kod);Array.isArray(a)&&(n.stav_workflow_kod=a)}catch(a){}void 0!==e.potvrzeni_dokonceni_objednavky&&(n.potvrzeni_dokonceni_objednavky=parseInt(e.potvrzeni_dokonceni_objednavky,10)||0),void 0!==e.stav_odeslano&&(n.stav_odeslano=Boolean(e.stav_odeslano)),void 0!==e.stav_stornovano&&(n.stav_stornovano=Boolean(e.stav_stornovano));if(["datum_storna","odeslani_storno_duvod","identifikator","dt_odeslani","storno_uzivatel_id","storno_provedl"].forEach(a=>{void 0!==e[a]&&(n[a]=e[a])}),e.poznamka){let o=e.poznamka,t=5;for(;"string"===typeof o&&o.trim().startsWith("{")&&t>0;){try{const e=JSON.parse(o);if(void 0===e.text)break;o=e.text}catch(a){break}t--}n.poznamka_objednavky=o,delete n.poznamka}if(e.dodavatel_zpusob_potvrzeni&&"string"===typeof e.dodavatel_zpusob_potvrzeni)try{const a=JSON.parse(e.dodavatel_zpusob_potvrzeni);n.dodavatel_zpusob_potvrzeni=a}catch(a){}return n};function Nc(){var e,n,i,l,c,v,y,V,F,M,U,Z,B,K,H,W,$,J,G,q,Y,X,Q,ee,ne,ae,oe,te,ie,re,se,de,le,he,ke,ge,be,ye,xe;const je=(0,d.Zp)(),{showToast:ze}=(0,r.useContext)(Ca.$o)||{},{userDetail:Ae,user_id:we,username:Se,token:Ee,user:Ce,userPermissions:Ne,hasPermission:Oe}=(0,r.useContext)(_e.cy)||{},{triggerActivity:De}=(0,Na.v5)(),{progress:Te,start:Ie,setProgress:Pe,done:Le,fail:Re,reset:Ve}=(0,r.useContext)(Oa.z)||{},Fe=(0,r.useRef)(!1),Me=(0,d.zy)(),Be=(0,r.useMemo)(()=>new URLSearchParams(Me.search),[Me.search]),Ke=Be.get("edit"),He=Ia.default.getMetadata(),We=null===He||void 0===He?void 0:He.editOrderId,$e=Ke||We;(0,r.useEffect)(()=>{(async()=>{let e="NOVA",n=null,a="";try{if(we){Ia.default.setCurrentUser(we);Ia.default.getMetadata();if(await Ia.default.hasDraft()){const o=await Ia.default.loadDraft();o&&o.formData&&(o.savedOrderId&&o.formData.id?(e="EDITACE",n=o.savedOrderId,a=o.formData.cislo_objednavky||o.formData.ev_cislo||""):(e="KONCEPT",n=null,a=""))}else $e&&(e="EDITACE",n=parseInt($e),a="",Ia.default.saveMetadata({editOrderId:$e}))}else $e&&(e="EDITACE",n=parseInt($e),a="")}catch(t){$e&&(e="EDITACE",n=parseInt($e),a="")}const o={isEditMode:"EDITACE"===e,isNewOrder:"NOVA"===e,orderId:n,orderNumber:a,currentPhase:1,mainWorkflowState:"NOVA",hasDraft:"NOVA"!==e,timestamp:Date.now()};window.__orderFormState=o,window.dispatchEvent(new CustomEvent("orderFormStateChange",{detail:o}))})()},[$e,we]);const Je=Be.get("archivovano"),[Ge,qe]=(0,r.useState)({objednatel:!1,schvaleni:!1,prilohy:!1,financovani:!1,dodavatel:!1,kontakt:!1,detaily:!1,dodaci_podminky:!1,stav_odeslani:!1,potvrzeni_objednavky:!1,registr_smluv:!1,registr_smluv_vyplneni:!1,prubeh_objednavky:!1,dodaci_informace:!1,fakturace:!1,dokonceni:!1,storno_detail:!1}),[Ye,Xe]=(0,r.useState)({garant:!1,prikazce:!1,strediska:!1,financovani:!1,lp_kod:!1}),[Qe,en]=(0,r.useState)({garant:"",prikazce:"",strediska:"",financovani:"",lp_kod:""}),[nn,an]=(0,r.useState)(new Set),[on,tn]=(0,r.useState)(!1),[rn,sn]=(0,r.useState)(!1),[dn,ln]=(0,r.useState)({details:{},loading:{}}),[cn,pn]=(0,r.useState)({list:[],loadingList:!1,detail:null,loadingDetail:!1,searchTerm:"",showSuggestions:!1,selectedSuggestionIndex:-1});(0,r.useEffect)(()=>{if(!rn)return;const e=e=>{"Escape"===e.key&&sn(!1)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[rn]);const[un,vn]=(0,r.useState)([]),[_n,mn]=(0,r.useState)({uploading:!1,dragOver:!1,checkingSync:!1,showDeleteDialog:!1,deleteTarget:null,showDeleteAllDialog:!1}),[fn,hn]=(0,r.useState)({showDialog:!1,searchTerm:"",results:[],loading:!1,allContacts:[]}),[kn,gn]=(0,r.useState)({popupOpen:!1,search:"",results:[],loading:!1,savingToLocal:null,scopeInfo:{},selectedScope:"personal",selectedUseky:[]}),[bn,yn]=(0,r.useState)({available:[],loading:!1}),[xn,jn]=(0,r.useState)({show:!1,status:null,data:null,isOperation:!1}),[zn,An]=(0,r.useState)({show:!1,progress:0,text:""}),[wn,Sn]=(0,r.useState)(!1),[En,Cn]=(0,r.useState)(!1),[Nn,On]=(0,r.useState)(!1),[Dn,Tn]=(0,r.useState)(!1),[In,Pn]=(0,r.useState)(!1),[Ln,Rn]=(0,r.useState)(null),[Vn,Fn]=(0,r.useState)(!1),[Mn,Un]=(0,r.useState)({showAddDialog:!1,existingCheck:null,autoFillSource:null}),[Zn,Bn]=(0,r.useState)({open:!1,orderData:null}),[Kn,Hn]=(0,r.useState)({ciselniky:!0,formData:!1,initializing:!0,initialized:!1,error:null}),[Wn,$n]=(0,r.useState)(()=>{try{const e=Ia.default.getMetadata();if(e&&!0===e.isEditMode){if(e.editOrderId||e.formData.id){e.editOrderId||e.formData.id}return!0}return!1}catch(e){return!1}});(0,r.useEffect)(()=>{(async()=>{if(Ee&&Se){pt(!0);try{const e=await(0,me.nw)({token:Ee,username:Se});lt(e||[])}catch(e){lt([])}finally{pt(!1)}}})()},[Ee,Se]),(0,r.useEffect)(()=>{if(we)try{const e=Ia.default.getMetadata();e&&e.isEditMode}catch(e){}},[we]),(0,r.useEffect)(()=>{if(we)try{Ia.default.saveMetadata({isEditMode:Wn})}catch(e){}},[Wn,we]),(0,r.useEffect)(()=>{if(!we)return;let e;const n=n=>{clearTimeout(e)},a=np.current;return a?a.addEventListener("scroll",n):window.addEventListener("scroll",n),()=>{clearTimeout(e),a?a.removeEventListener("scroll",n):window.removeEventListener("scroll",n)}},[we]);const[Jn,Gn]=(0,r.useState)({}),[qn,Yn]=(0,r.useState)({objednatel_id:"",uzivatel_id:"",garant_uzivatel_id:"",prikazce_id:"",jmeno:"",email:"",telefon:"",predmet:"",strediska_kod:[],max_cena_s_dph:"",popis_pozadavku:"",mimoradna_udalost:!1,stav_workflow_kod:JSON.stringify(["NOVA"]),schvalovatel_id:"",dt_schvaleni:"",schvaleni_komentar:"",zpusob_financovani:"",financovani:"",lp_kod:[],cislo_smlouvy:"",smlouva_poznamka:"",individualni_schvaleni:"",individualni_poznamka:"",pojistna_udalost_cislo:"",pojistna_udalost_poznamka:"",dodavatel_id:"",dodavatel_nazev:"",dodavatel_adresa:"",dodavatel_ico:"",dodavatel_dic:"",dodavatel_zastoupeny:"",dodavatel_kontakt_jmeno:"",dodavatel_kontakt_email:"",dodavatel_kontakt_telefon:"",druh_objednavky:"",druh_objednavky_kod:"",polozky_objednavky:[],faktury:[],poznamka_objednavky:"",dt_predpokladany_termin_dodani:"",misto_dodani:"",zaruka:"",stav_odeslano:!1,datum_odeslani:"",stav_stornovano:!1,datum_storna:"",storno_uzivatel_id:"",odeslani_storno_duvod:"",storno_provedl:"",storno_poznamky:"",dodavatel_zpusob_potvrzeni:{potvrzeni:"NE",zpusoby:[],platba:"faktura"},dt_akceptace:"",dt_zverejneni:"",registr_iddt:"",ma_byt_zverejnena:!1,stav_u_dodavatele:"",datum_zmeny_stavu:"",poznamka_stav:"",cislo_zasilky:"",prepravce:"",ocekavane_doruceni:"",skutecne_doruceni:"",cislo_faktury:"",datum_faktury:"",castka_bez_dph:"",castka_s_dph:"",datum_splatnosti:"",datum_zaplaceni:"",faktury_objednavky:[],potvrzeni_dokonceni_objednavky:0,prilohy_dokumenty:[],ev_cislo:"",temp_datum_objednavky:(new Date).toISOString().split("T")[0],datum_vytvoreni:""}),Xn=(0,r.useCallback)(e=>{var n;null===(n=(new Error).stack.split("\n")[2])||void 0===n||n.trim();Yn("function"===typeof e?n=>e(n):e)},[]);(0,r.useEffect)(()=>(qn.id&&(window.__activeOrderFormId=qn.id,window.__activeOrderFormEvCislo=qn.cislo_objednavky||qn.ev_cislo||"#".concat(qn.id)),()=>{delete window.__activeOrderFormId,delete window.__activeOrderFormEvCislo}),[qn.id,qn.cislo_objednavky,qn.ev_cislo]),(0,r.useEffect)(()=>{we&&qn&&(()=>{try{const e="unsaved_attachments_".concat(qn.id||"draft"),n=localStorage.getItem(e);if(n){const a=JSON.parse(n);a.length>0&&(Ic("info","ATTACHMENTS","restore-from-ls","Nalezeno ".concat(a.length," neulo\u017een\xfdch p\u0159\xedloh v LocalStorage")),ze&&ze("\ud83d\udcce Nalezeny neulo\u017een\xe9 p\u0159\xedlohy z p\u0159edchoz\xed session!\n\n"+"\ud83d\udd04 Obnoveno ".concat(a.length," p\u0159\xedloh.\n")+"\u26a0\ufe0f Soubory bude nutn\xe9 znovu vybrat a nahr\xe1t.",{type:"info",timeout:8e3,action:{confirmText:"Obnovit p\u0159\xedlohy",cancelText:"Smazat",onConfirm:()=>{const e=a.map(e=>(0,t.A)((0,t.A)({},e),{},{status:"needs_reselection",file:null,uploadError:"Soubor je nutn\xe9 znovu vybrat"}));vn(n=>[...n,...e]),Ic("success","ATTACHMENTS","restored-from-ls","Obnoveno ".concat(e.length," p\u0159\xedloh z LocalStorage"))},onCancel:()=>{localStorage.removeItem(e),Ic("info","ATTACHMENTS","cleared-ls","LocalStorage p\u0159\xedlohy smaz\xe1ny na \u017e\xe1dost u\u017eivatele")}}}))}}catch(e){Ic("error","ATTACHMENTS","restore-from-ls-error",e.message)}})()},[we,qn.id]);const Qn=(0,r.useRef)(null),ea=((0,r.useMemo)(()=>{if(!Qn.current||!qn.id)return!1;const e=Qn.current,n=["predmet","max_cena_s_dph","popis_pozadavku","zpusob_financovani","dodavatel_nazev","dodavatel_ico","druh_objednavky_kod","poznamka_objednavky","dt_predpokladany_termin_dodani","misto_dodani","zaruka"];for(const t of n)if(e[t]!==qn[t])return!0;const a=e.polozky_objednavky||[],o=qn.polozky_objednavky||[];if(a.length!==o.length)return!0;for(let t=0;t<a.length;t++){const e=a[t],n=o[t];if(e.popis!==n.popis||e.mnozstvi!==n.mnozstvi||e.cena_jednotkova!==n.cena_jednotkova)return!0}return!1},[qn]),(0,r.useMemo)(()=>"ARCHIVOVANO"===qn.stav_objednavky||"Archivov\xe1no"===qn.stav_objednavky,[qn.stav_objednavky])),na=_o(qn,ea),{currentPhase:aa,phaseTheme:oa,phaseProgress:ta,mainWorkflowState:ia,getCurrentPhase:ra,getPhaseProgress:sa,getPhaseTheme:da,parseWorkflowStates:la,hasWorkflowState:ca,isPokladna:pa,isWorkflowCompleted:ua,isWorkflowRejected:va,isWorkflowCancelled:_a,forceRefresh:ma,getSectionState:fa}=na,ha=(0,r.useMemo)(()=>!qn.id,[qn.id]),ka=ea,ga=(0,r.useMemo)(()=>ka?(0,t.A)((0,t.A)({},ta),{},{phases:ta.phases.map(e=>(0,t.A)((0,t.A)({},e),{},{isVisible:!0,fillClass:"completed"}))}):ta,[ka,ta]),[ba,ya]=(0,r.useState)(!1),[xa,ja]=(0,r.useState)(!1),za=(0,r.useCallback)(e=>{var n,a,o,t,i,r,s;const d={isEditMode:null!==(n=e.isEditMode)&&void 0!==n?n:Wn,isNewOrder:null!==(a=e.isNewOrder)&&void 0!==a?a:!Wn,orderId:null!==(o=e.orderId)&&void 0!==o?o:qn.id,orderNumber:null!==(t=e.orderNumber)&&void 0!==t?t:qn.cislo_objednavky||qn.ev_cislo,currentPhase:null!==(i=e.currentPhase)&&void 0!==i?i:aa,mainWorkflowState:null!==(r=e.mainWorkflowState)&&void 0!==r?r:ia,hasDraft:null!==(s=e.hasDraft)&&void 0!==s?s:ba||xa,timestamp:Date.now()};return window.__orderFormState=d,window.dispatchEvent(new CustomEvent("orderFormStateChange",{detail:d})),d},[Wn,qn.id,qn.cislo_objednavky,qn.ev_cislo,aa,ia,ba,xa]),Aa=(0,r.useRef)(za);(0,r.useEffect)(()=>{Aa.current=za},[za]);const wa=e=>Aa.current(e);(0,r.useEffect)(()=>{if(!xa)return;const e=!!qn.id;let n="NOVA";e?n="EDITACE":(ba||!!$e)&&(n="KONCEPT");const a={isEditMode:"EDITACE"===n,isNewOrder:"NOVA"===n,orderId:e?qn.id:null,orderNumber:qn.cislo_objednavky||qn.ev_cislo||"",currentPhase:aa,mainWorkflowState:ia,hasDraft:"KONCEPT"===n||"EDITACE"===n,timestamp:Date.now()};return window.__orderFormState=a,window.dispatchEvent(new CustomEvent("orderFormStateChange",{detail:a})),()=>{window.__orderFormState={isEditMode:!1,isNewOrder:!1,orderId:null,orderNumber:"",currentPhase:1,mainWorkflowState:"NOVA",hasDraft:!1,timestamp:Date.now()},window.dispatchEvent(new CustomEvent("orderFormStateChange",{detail:window.__orderFormState}))}},[xa,qn.id,qn.cislo_objednavky,qn.ev_cislo,aa,ia,ba,$e]);const[Sa,Pa]=(0,r.useState)({saving:!1,savingDraft:!1,disableAutosave:!1,lastAutoSave:null,autoSaving:!1,dataSource:null}),Ra=(0,r.useRef)(!1),Fa=(0,r.useRef)(null),Ka=(0,r.useRef)(!1),Ha=(0,r.useRef)(null),Xa=(0,r.useCallback)(e=>{Ha.current&&Ha.current(e)},[]),{triggerAutosave:oo,cancelAutosave:to}=Ua(Xa,{delay:3e3,enabled:!Sa.disableAutosave&&xa,dependencies:[Sa.disableAutosave,xa,qn.faktury]}),[ro,so]=(0,r.useState)(!1),[lo,co]=(0,r.useState)(""),[po,uo]=(0,r.useState)({saved:[],server:[],fetchStatus:{status:null,error:null},loading:!1,showSaveModal:!1,name:"",type:"po",saveChecked:!1,saveMode:"new",selectedTarget:null,selectedTargetTs:null,showDeleteConfirm:!1,pendingDelete:null}),[vo,mo]=(0,r.useState)({phase1:!1,phase2:!1,phase3:!1,registr:!1,potvrzeni:!1,cancelPublish:!1,fakturace:!1,dokonceni:!1,storno:!1}),[fo,ho]=(0,r.useState)({loading:!1,showAddForm:!1,editing:null,formData:{fa_datum_doruceni:Ps(new Date),fa_dorucena:1,fa_castka:"",fa_cislo_vema:"",fa_strediska_kod:[],fa_poznamka:"",fa_splatnost:""}}),[ko,go]=(0,r.useState)({}),[bo,yo]=(0,r.useState)({isOpen:!1,fakturaId:null,fakturaNazev:"",pocetPriloh:0}),[xo,jo]=(0,r.useState)({isOpen:!1,title:"",message:"",onConfirm:null}),[zo,Ao]=(0,r.useState)({actionsLog:[],hoveredPreviewKey:null,previewModalData:null,editingId:null,editingName:"",showSearchPredefs:!1,searchPredefs:""}),[wo,So]=((0,r.useRef)(null),(0,r.useState)({})),[Eo,No]=(0,r.useState)(!1),[Oo,Do]=(0,r.useState)({}),[To,Io]=(0,r.useState)({options:[],loading:!1,financovani:{}}),Po=fn.showDialog,Lo=e=>hn(n=>(0,t.A)((0,t.A)({},n),{},{showDialog:e})),Ro=fn.searchTerm,Vo=e=>hn(n=>(0,t.A)((0,t.A)({},n),{},{searchTerm:e})),Fo=fn.results,Mo=e=>hn(n=>(0,t.A)((0,t.A)({},n),{},{results:e})),Uo=fn.loading,Zo=e=>hn(n=>(0,t.A)((0,t.A)({},n),{},{loading:e})),Bo=fn.allContacts,Ko=e=>hn(n=>(0,t.A)((0,t.A)({},n),{},{allContacts:e})),Ho=kn.popupOpen,Wo=e=>gn(n=>(0,t.A)((0,t.A)({},n),{},{popupOpen:e})),$o=kn.search,qo=e=>gn(n=>(0,t.A)((0,t.A)({},n),{},{search:e})),Yo=kn.results,Xo=e=>gn(n=>(0,t.A)((0,t.A)({},n),{},{results:e})),Qo=kn.loading,et=e=>gn(n=>(0,t.A)((0,t.A)({},n),{},{loading:e})),nt=kn.savingToLocal,at=e=>gn(n=>(0,t.A)((0,t.A)({},n),{},{savingToLocal:e})),ot=kn.scopeInfo,tt=e=>gn(n=>(0,t.A)((0,t.A)({},n),{},{scopeInfo:e})),it=kn.selectedScope,rt=e=>gn(n=>(0,t.A)((0,t.A)({},n),{},{selectedScope:e})),st=kn.selectedUseky,dt=bn.available,lt=e=>yn(n=>(0,t.A)((0,t.A)({},n),{},{available:e})),ct=bn.loading,pt=e=>yn(n=>(0,t.A)((0,t.A)({},n),{},{loading:e})),ut=xn.show,vt=e=>jn(n=>(0,t.A)((0,t.A)({},n),{},{show:e})),_t=xn.status,mt=e=>jn(n=>(0,t.A)((0,t.A)({},n),{},{status:e})),ft=xn.data,ht=e=>jn(n=>(0,t.A)((0,t.A)({},n),{},{data:e})),kt=(xn.isOperation,e=>jn(n=>(0,t.A)((0,t.A)({},n),{},{isOperation:e}))),gt=zn.show,bt=e=>An(n=>(0,t.A)((0,t.A)({},n),{},{show:e})),yt=zn.progress,xt=e=>An(n=>(0,t.A)((0,t.A)({},n),{},{progress:e})),jt=zn.text,zt=e=>An(n=>(0,t.A)((0,t.A)({},n),{},{text:e})),At=_n.uploading,wt=e=>mn(n=>(0,t.A)((0,t.A)({},n),{},{uploading:e})),St=_n.dragOver,Et=e=>mn(n=>(0,t.A)((0,t.A)({},n),{},{dragOver:e})),Ct=_n.checkingSync,Nt=e=>mn(n=>(0,t.A)((0,t.A)({},n),{},{checkingSync:e})),Ot=_n.showDeleteDialog,Dt=e=>mn(n=>(0,t.A)((0,t.A)({},n),{},{showDeleteDialog:e})),Tt=_n.deleteTarget,It=e=>mn(n=>(0,t.A)((0,t.A)({},n),{},{deleteTarget:e})),Pt=_n.showDeleteAllDialog,Lt=e=>mn(n=>(0,t.A)((0,t.A)({},n),{},{showDeleteAllDialog:e})),Rt=Mn.showAddDialog,Vt=e=>Un(n=>(0,t.A)((0,t.A)({},n),{},{showAddDialog:e})),Ft=Mn.existingCheck,Mt=e=>Un(n=>(0,t.A)((0,t.A)({},n),{},{existingCheck:e})),Ut=Mn.autoFillSource,Zt=e=>Un(n=>(0,t.A)((0,t.A)({},n),{},{autoFillSource:e})),Bt=Zn.open,Kt=e=>Bn(n=>(0,t.A)((0,t.A)({},n),{},{open:e})),Ht=Zn.orderData,Wt=e=>Bn(n=>(0,t.A)((0,t.A)({},n),{},{orderData:e})),$t=Kn.ciselniky,Jt=Kn.formData,Gt=(Kn.initializing,e=>Hn(n=>(0,t.A)((0,t.A)({},n),{},{initializing:e}))),qt=Kn.initialized,Yt=e=>Hn(n=>(0,t.A)((0,t.A)({},n),{},{initialized:e})),Xt=Kn.error,Qt=Sa.saving,ei=e=>Pa(n=>(0,t.A)((0,t.A)({},n),{},{saving:e})),ni=(Sa.savingDraft,e=>Pa(n=>(0,t.A)((0,t.A)({},n),{},{savingDraft:e}))),ai=Sa.disableAutosave,oi=e=>{Pa(n=>(0,t.A)((0,t.A)({},n),{},{disableAutosave:e})),Ra.current=e},ti=Sa.lastAutoSave,ii=e=>Pa(n=>(0,t.A)((0,t.A)({},n),{},{lastAutoSave:e})),ri=Sa.autoSaving,si=e=>Pa(n=>(0,t.A)((0,t.A)({},n),{},{autoSaving:e})),di=Sa.dataSource,li=e=>Pa(n=>(0,t.A)((0,t.A)({},n),{},{dataSource:e})),ci=dn.details,pi=dn.loading,ui=e=>ln(n=>(0,t.A)((0,t.A)({},n),{},{loading:e})),vi=cn.list,_i=e=>pn(n=>(0,t.A)((0,t.A)({},n),{},{list:e})),mi=cn.loadingList,fi=e=>pn(n=>(0,t.A)((0,t.A)({},n),{},{loadingList:e})),hi=cn.detail,ki=e=>pn(n=>(0,t.A)((0,t.A)({},n),{},{detail:e})),gi=cn.loadingDetail,bi=e=>pn(n=>(0,t.A)((0,t.A)({},n),{},{loadingDetail:e})),yi=cn.searchTerm,xi=e=>pn(n=>(0,t.A)((0,t.A)({},n),{},{searchTerm:e})),ji=cn.showSuggestions,zi=e=>pn(n=>(0,t.A)((0,t.A)({},n),{},{showSuggestions:e})),Ai=cn.selectedSuggestionIndex,wi=e=>pn(n=>(0,t.A)((0,t.A)({},n),{},{selectedSuggestionIndex:e})),Si=po.saved,Ei=e=>uo(n=>(0,t.A)((0,t.A)({},n),{},{saved:e})),Ci=po.server,Ni=e=>uo(n=>(0,t.A)((0,t.A)({},n),{},{server:e})),Oi=(po.fetchStatus,e=>uo(n=>(0,t.A)((0,t.A)({},n),{},{fetchStatus:e}))),Di=po.loading,Ti=e=>uo(n=>(0,t.A)((0,t.A)({},n),{},{loading:e})),Ii=po.showSaveModal,Pi=e=>uo(n=>(0,t.A)((0,t.A)({},n),{},{showSaveModal:e})),Li=po.name,Ri=e=>uo(n=>(0,t.A)((0,t.A)({},n),{},{name:e})),Vi=po.type,Fi=e=>uo(n=>(0,t.A)((0,t.A)({},n),{},{type:e})),Mi=(po.saveChecked,po.saveMode),Ui=e=>uo(n=>(0,t.A)((0,t.A)({},n),{},{saveMode:e})),Zi=po.selectedTarget,Bi=e=>uo(n=>(0,t.A)((0,t.A)({},n),{},{selectedTarget:e})),Ki=(po.selectedTargetTs,po.showDeleteConfirm),Hi=e=>uo(n=>(0,t.A)((0,t.A)({},n),{},{showDeleteConfirm:e})),Wi=po.pendingDelete,$i=e=>uo(n=>(0,t.A)((0,t.A)({},n),{},{pendingDelete:e})),Ji=vo.phase1,Gi=e=>mo(n=>(0,t.A)((0,t.A)({},n),{},{phase1:e})),qi=vo.phase2,Yi=e=>mo(n=>(0,t.A)((0,t.A)({},n),{},{phase2:e})),Xi=vo.phase3,Qi=e=>mo(n=>(0,t.A)((0,t.A)({},n),{},{phase3:e})),er=vo.registr,nr=e=>mo(n=>(0,t.A)((0,t.A)({},n),{},{registr:e})),ar=vo.potvrzeni,or=e=>mo(n=>(0,t.A)((0,t.A)({},n),{},{potvrzeni:e})),tr=vo.cancelPublish,ir=e=>mo(n=>(0,t.A)((0,t.A)({},n),{},{cancelPublish:e})),rr=vo.fakturace,sr=e=>mo(n=>(0,t.A)((0,t.A)({},n),{},{fakturace:e})),dr=vo.dokonceni,lr=e=>mo(n=>(0,t.A)((0,t.A)({},n),{},{dokonceni:e})),cr=vo.storno,pr=e=>mo(n=>(0,t.A)((0,t.A)({},n),{},{storno:e})),ur=fo.loading,vr=(fo.showAddForm,fo.editing),_r=e=>ho(n=>(0,t.A)((0,t.A)({},n),{},{editing:e})),mr=fo.formData,fr=e=>ho(n=>(0,t.A)((0,t.A)({},n),{},{formData:e})),hr=(zo.actionsLog,zo.hoveredPreviewKey,zo.previewModalData),kr=e=>Ao(n=>(0,t.A)((0,t.A)({},n),{},{previewModalData:e})),gr=zo.editingId,br=e=>Ao(n=>(0,t.A)((0,t.A)({},n),{},{editingId:e})),yr=zo.editingName,xr=e=>Ao(n=>(0,t.A)((0,t.A)({},n),{},{editingName:e})),jr=zo.showSearchPredefs,zr=zo.searchPredefs,Ar=To.options,wr=e=>Io(n=>(0,t.A)((0,t.A)({},n),{},{options:e}));To.loading,To.financovani;(0,r.useEffect)(()=>{if(!Ar||0===Ar.length||!Ee||!Se)return;(async()=>{const e={};for(const o of Ar)try{const n=await(0,me.WZ)({token:Ee,username:Se,cislo_lp:o.kod});n&&(e[o.id]={limit:parseFloat(n.celkovy_limit)||0,cerpano:parseFloat(n.skutecne_cerpano)||0,zbyva:parseFloat(n.zbyva_skutecne)||0})}catch(a){console.warn("Nelze na\u010d\xedst stav LP ".concat(o.kod,":"),a.message)}var n;n=e,Io(e=>(0,t.A)((0,t.A)({},e),{},{financovani:n}))})()},[Ar,Ee,Se]);const Sr=(0,r.useCallback)(async(e,n)=>{try{var a,o,t,i,r;const n=e.stav_workflow_kod?"string"===typeof e.stav_workflow_kod?JSON.parse(e.stav_workflow_kod):e.stav_workflow_kod:[],p=Array.isArray(n)&&n.includes("SCHVALENA");if(Array.isArray(n)&&n.includes("ODESLANA"))return null;const u=null===(a=e.zpusob_financovani)||void 0===a?void 0:a.toLowerCase().includes("smlouva");if(!p&&!u)return null;if(!u)return null;if((null===(o=e.dodavatel_nazev)||void 0===o?void 0:o.trim())||(null===(t=e.dodavatel_ico)||void 0===t?void 0:t.trim()))return null;const v=null===(i=e.cislo_smlouvy)||void 0===i?void 0:i.trim();if(!v)return null;let _=[];try{const e=await(0,Ba.iE)({token:Ee,username:Se,show_inactive:!1,limit:500});null!==e&&void 0!==e&&e.data&&Array.isArray(e.data)&&(_=e.data)}catch(d){return null}const m=_.find(e=>e.cislo_smlouvy===v||e.evidencni_cislo===v);if(!m)return null;const f=null===(r=m.ico)||void 0===r?void 0:r.trim();if(!f||f.length<8)return{dodavatel_nazev:m.nazev_firmy||"",dodavatel_ico:"",source:"smlouva-fallback"};try{const e=await(0,me.d0)({token:Ee,username:Se,ico:f});if(null!==e&&void 0!==e&&e.data&&Array.isArray(e.data)&&e.data.length>0){const n=e.data[0];return{dodavatel_nazev:n.nazev||n.name||m.nazev_firmy||"",dodavatel_adresa:n.adresa||n.address||"",dodavatel_ico:n.ico||f,dodavatel_dic:n.dic||"",dodavatel_zastoupeny:n.zastoupeny||n.represented||"",dodavatel_kontakt_jmeno:n.kontakt_jmeno||"",dodavatel_kontakt_email:n.kontakt_email||n.email||"",dodavatel_kontakt_telefon:n.kontakt_telefon||n.telefon||"",source:"local"}}}catch(l){}try{const e="https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/".concat(f),n=await fetch(e,{method:"GET",headers:{Accept:"application/json"}});if(n.ok){var s;const e=await n.json();return{dodavatel_nazev:e.obchodniJmeno||m.nazev_firmy||"",dodavatel_adresa:(null===(s=e.sidlo)||void 0===s?void 0:s.textovaAdresa)||"",dodavatel_ico:e.ico||f,dodavatel_dic:e.dic||"",dodavatel_zastoupeny:"",dodavatel_kontakt_jmeno:"",dodavatel_kontakt_email:"",dodavatel_kontakt_telefon:"",source:"ares"}}}catch(c){}return{dodavatel_nazev:m.nazev_firmy||"",dodavatel_ico:f,source:"smlouva"}}catch(p){return null}},[Ee,Se]),Er=(0,r.useCallback)(async(e,n)=>{const o=$e||(null===e||void 0===e?void 0:e.id)||"NEW";if(Fe.current===o)return void 0;Fe.current=o,setTimeout(()=>{Fe.current===o&&(Fe.current=null)},5e3);const i=!$e;i&&(ja(!0),Yt(!0)),null!==e&&void 0!==e&&e.id&&($n(!0),Ia.default.saveMetadata({editOrderId:String(e.id)})),$e&&($n(!0),Ia.default.saveMetadata({editOrderId:String($e)}));let r=e||{};const s=e&&Object.keys(e).length>0;if(we)try{Ia.default.setCurrentUser(we);if(await Ia.default.hasDraft()){const n=await Ia.default.loadDraft();if(null!==n&&void 0!==n&&n.formData){var d;const a=n.formData.id||(null===(d=n.formData)||void 0===d?void 0:d.id),o=$e||(null===e||void 0===e?void 0:e.id);a&&($n(!0),Ia.default.saveMetadata({editOrderId:String(a)})),o&&a&&String(a)!==String(o)?console.warn("\u26a0\ufe0f Draft pat\u0159\xed k jin\xe9 objedn\xe1vce, ignoruji:",{draftOrderId:a,currentOrderId:o}):r=s?(0,t.A)((0,t.A)((0,t.A)({},e),n.formData),{},{id:e.id,ev_cislo:e.ev_cislo||e.cislo_objednavky,cislo_objednavky:e.cislo_objednavky,datum_vytvoreni:e.datum_vytvoreni,datum_posledni_zmeny:e.datum_posledni_zmeny,faktury:n.formData.faktury&&n.formData.faktury.length>0?n.formData.faktury:e.faktury||[]}):n.formData}}}catch(p){console.error("\u274c Chyba p\u0159i na\u010d\xedt\xe1n\xed draftu:",p)}if(i&&!r.ev_cislo&&Ee&&Se)try{console.log("\ud83d\udd22 [OrderForm25/handleDataLoaded] Na\u010d\xedt\xe1m eviden\u010dn\xed \u010d\xedslo synchronn\u011b...");const e=await(0,La.XY)(Ee,Se),n=e.next_order_string||e.order_number_string||e.next_number;n?(r.ev_cislo=n,console.log("\u2705 [OrderForm25/handleDataLoaded] Eviden\u010dn\xed \u010d\xedslo na\u010dteno:",n),window.__orderForm_hasLoadedNextNumberRef&&(window.__orderForm_hasLoadedNextNumberRef.current=!0)):console.warn("\u26a0\ufe0f [OrderForm25/handleDataLoaded] API nevr\xe1tilo ev_cislo")}catch(p){console.error("\u274c [OrderForm25/handleDataLoaded] Chyba p\u0159i na\u010d\xedt\xe1n\xed ev_cislo:",p)}if(i&&we&&!r.garant_uzivatel_id&&!r.prikazce_id)try{const{loadSettingsFromLocalStorage:e}=a(76759),n=e(parseInt(we,10));if(console.log("\ud83d\udd0d [OrderForm25/handleDataLoaded] Na\u010d\xedt\xe1m user settings pro user_id:",we,n),n){if(n.vychozi_garant_id&&""!==n.vychozi_garant_id&&null!==n.vychozi_garant_id){const e="object"===typeof n.vychozi_garant_id?n.vychozi_garant_id.value:n.vychozi_garant_id;e&&""!==e&&(r.garant_uzivatel_id=String(e),console.log("\u2705 [OrderForm25/handleDataLoaded] Nastavuji v\xfdchoz\xedho garanta:",e))}if(n.vychozi_prikazce_id&&""!==n.vychozi_prikazce_id&&null!==n.vychozi_prikazce_id){const e="object"===typeof n.vychozi_prikazce_id?n.vychozi_prikazce_id.value:n.vychozi_prikazce_id;e&&""!==e&&(r.prikazce_id=String(e),console.log("\u2705 [OrderForm25/handleDataLoaded] Nastavuji v\xfdchoz\xedho p\u0159\xedkazce:",e))}}else console.log("\u26a0\ufe0f [OrderForm25/handleDataLoaded] User settings nejsou v localStorage")}catch(p){console.error("\u274c [OrderForm25/handleDataLoaded] Chyba p\u0159i na\u010d\xedt\xe1n\xed v\xfdchoz\xedch hodnot garanta/p\u0159\xedkazce:",p)}let l=!1;if(Object.keys(r).length>0){const e=Ya(r.stav_workflow_kod);try{const n=await Sr(r,e);n&&(r=(0,t.A)((0,t.A)({},r),n),Zt(n.source),l=!0)}catch(p){}}if(Object.keys(r).length>0){var c;if(Xn(r),null!==e&&void 0!==e&&null!==(c=e.financovani)&&void 0!==c&&c.lp_nazvy&&Array.isArray(e.financovani.lp_nazvy)){const n=e.financovani.lp_nazvy.map(e=>({id:e.id,kod:e.cislo_lp||e.kod||"LP".concat(e.id),nazev:e.nazev||"Bez n\xe1zvu",kategorie:e.kategorie,limit:e.limit||e.celkovy_limit,cerpano:e.cerpano||e.skutecne_cerpano,zbyva:e.zbyva||e.zbyva_skutecne,rok:e.rok,label:"".concat(e.cislo_lp||e.kod||"LP".concat(e.id)," - ").concat(e.nazev||"Bez n\xe1zvu")})).sort((e,n)=>e.nazev.localeCompare(n.nazev,"cs"));wr(n)}else if(r.lp_kod&&Array.isArray(r.lp_kod)&&r.lp_kod.length>0)try{let e=Zr||[];if(!Zr||0===Zr.length)try{e=await(0,me.Hy)({token:Ee,username:Se})}catch(u){console.error("\u274c Chyba na\u010d\xedt\xe1n\xed LP mapov\xe1n\xed:",u),e=[]}const n=(await Promise.all(r.lp_kod.map(async n=>{let a=n;const o=n;try{if(e&&e.length>0){const o=e.find(e=>e.id===n||e.id===Number(n)||e.kod===n||e.cislo_lp===n);o?a=o.cislo_lp||o.kod||n:console.warn("\u26a0\ufe0f LP ".concat(n," nebylo nalezeno v LP mapov\xe1n\xed (").concat(e.length," z\xe1znam\u016f)"))}else console.warn("\u26a0\ufe0f LP mapov\xe1n\xed nen\xed dostupn\xe9, zkus\xedm hodnotu p\u0159\xedmo:",n);const t=await(0,me.WZ)({token:Ee,username:Se,cislo_lp:a});return t&&t.id?{id:t.id,kod:t.cislo_lp||t.kod||"LP".concat(t.id),nazev:t.nazev_uctu||t.nazev||"Bez n\xe1zvu",kategorie:t.kategorie,limit:t.celkovy_limit||0,cerpano:t.skutecne_cerpano||0,zbyva:t.zbyva_skutecne||0,rok:t.rok,label:"".concat(t.cislo_lp||t.kod||"LP".concat(t.id)," - ").concat(t.nazev_uctu||t.nazev||"Bez n\xe1zvu")}:(console.warn("\u26a0\ufe0f LP ".concat(a," (ID: ").concat(o,") nebylo nalezeno nebo nem\xe1 platn\xe1 data")),null)}catch(u){return console.error("\u274c Chyba na\u010d\xedt\xe1n\xed LP ".concat(a," (ID: ").concat(o,"):"),u),null}}))).filter(e=>null!==e).sort((e,n)=>e.nazev.localeCompare(n.nazev,"cs"));wr(n)}catch(u){console.error("\u274c Chyba p\u0159i na\u010d\xedt\xe1n\xed LP z API:",u),wr([])}else wr([]);if(r.id&&(Qn.current=JSON.parse(JSON.stringify(r))),l&&$e&&Ia.default)try{Ia.default.setCurrentUser(we),await Ia.default.saveDraft(r,{orderId:parseInt($e)})}catch(v){}r.ev_cislo&&"Na\u010d\xedt\xe1m..."!==r.ev_cislo&&window.__orderForm_hasLoadedNextNumberRef&&(window.__orderForm_hasLoadedNextNumberRef.current=!0),Yt(!0)}i||(ja(!0),Ia.default.setAutosaveEnabled(!0,"EDIT order initialization"),wa({isEditMode:!0,isNewOrder:!1,orderId:r.id||$e,orderNumber:r.cislo_objednavky||r.ev_cislo||""}))},[$e,we,Ia.default,Xn,$n,ja,Yt,Sr,Zt,wa]),Cr=(0,r.useCallback)(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const a={error:{bg:"#fff1f0",color:"#d32f2f",icon:(0,fe.jsx)(m.A,{size:18,color:"#ff4d4f"})},success:{bg:"#f0f9ff",color:"#0d7d3e",icon:(0,fe.jsx)(f.A,{size:18,color:"#10b981"})},warning:{bg:"#fff7e6",color:"#d46b08",icon:(0,fe.jsx)(h.A,{size:18,color:"#f59e0b"})},info:{bg:"#f5f5f5",color:"#4b5563",icon:(0,fe.jsx)(k.A,{size:18,color:"#6b7280"})}},o=a[n]||a.info;return(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"10px",padding:"4px",fontFamily:"system-ui, -apple-system, sans-serif"},children:[(0,fe.jsx)("div",{style:{flexShrink:0,marginTop:"2px"},children:o.icon}),(0,fe.jsx)("div",{style:{flex:1,fontSize:"14px",lineHeight:"1.5",color:o.color},children:e})]})},[]),Nr=(0,r.useCallback)(e=>{null===ze||void 0===ze||ze(Cr("Nepoda\u0159ilo se na\u010d\xedst formul\xe1\u0159: ".concat(e.message),"error"),{type:"error"})},[Cr]),Or=(0,r.useCallback)(()=>{},[]),Dr=io({token:Ee,username:Se,userId:we,editOrderId:$e,archivovanoParam:Je,onDataLoaded:Er,onError:Nr,onReady:Or}),{lifecycle:Tr,dictionaries:Ir,orderDataLoader:Pr,ui:Lr}=Dr,Rr=(null===(e=Ir.data)||void 0===e?void 0:e.allUsers)||[],Vr=(null===(n=Ir.data)||void 0===n?void 0:n.approvers)||[],Fr=(null===(i=Ir.data)||void 0===i?void 0:i.strediskaOptions)||[],Mr=(null===(l=Ir.data)||void 0===l?void 0:l.financovaniOptions)||[],Ur=(null===(c=Ir.data)||void 0===c?void 0:c.druhyObjednavkyOptions)||[],Zr=(null===(v=Ir.data)||void 0===v||v.druhyObjednavkyRawData,(null===(y=Ir.data)||void 0===y?void 0:y.lpKodyOptions)||[]),Br=(null===(V=Ir.data)||void 0===V?void 0:V.prilohyTypyOptions)||[],Kr=(null===(F=Ir.data)||void 0===F?void 0:F.typyFakturOptions)||[],Hr=(null===(M=Ir.data)||void 0===M?void 0:M.stavyWorkflowMap)||{},Wr=r.useMemo(()=>{if(!qn.druh_objednavky_kod)return!1;const e=Ur.find(e=>e.kod_stavu&&e.kod_stavu===qn.druh_objednavky_kod||e.kod&&e.kod===qn.druh_objednavky_kod||e.value&&e.value===qn.druh_objednavky_kod);return 1===(null===e||void 0===e?void 0:e.atribut_objektu)},[qn.druh_objednavky_kod,Ur]),$r=r.useCallback(e=>{if(!e||0===Object.keys(e).length)return null;const n={objednatel:{label:"Informace o objednateli",errors:[]},schvaleni:{label:"Schv\xe1len\xed n\xe1kupu PO",errors:[]},dodavatel:{label:"Dodavatel",errors:[]},detaily:{label:"Detaily objedn\xe1vky",errors:[]},stav_odeslani:{label:"Odesl\xe1n\xed objedn\xe1vky",errors:[]},potvrzeni_objednavky:{label:"Potvrzen\xed objedn\xe1vky dodavatelem",errors:[]},fakturace:{label:"Fakturace",errors:[]},vecna_spravnost:{label:"V\u011bcn\xe1 spr\xe1vnost",errors:[]},registr_smluv_vyplneni:{label:"Registr smluv",errors:[]},ostatni:{label:"Ostatn\xed",errors:[]}};return Object.entries(e).forEach(e=>{let[a,o]=e,t=o;a.includes("jmeno")||a.includes("email")||a.includes("ev_cislo")||a.includes("garant")?n.objednatel.errors.push(t):a.includes("prikazce")||a.includes("max_cena")||a.includes("strediska")||a.includes("predmet")||a.includes("financovani")||a.includes("lp_kod")||a.includes("cislo_smlouvy")||a.includes("individualni_schvaleni")||a.includes("pojistna_udalost")?n.schvaleni.errors.push(t):a.startsWith("polozka_")||a.includes("druh_objednavky")||o.includes("Polo\u017eka")?n.detaily.errors.push(t):a.includes("zpusob_potvrzeni")||a.includes("dt_akceptace")||a.includes("zpusob_platby")?n.potvrzeni_objednavky.errors.push(t):a.includes("dodavatel")||a.includes("ico")||a.includes("adresa")||a.includes("kontakt")?n.dodavatel.errors.push(t):a.includes("datum_odeslani")||a.includes("stav_odeslani")?n.stav_odeslani.errors.push(t):a.startsWith("faktura_")&&a.includes("vecna_spravnost")?n.vecna_spravnost.errors.push(t):a.startsWith("faktura_")?n.fakturace.errors.push(t):a.includes("dt_zverejneni")||a.includes("registr")||a.includes("ma_byt_zverejnena")?n.registr_smluv_vyplneni.errors.push(t):n.ostatni.errors.push(t)}),(0,fe.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,fe.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"12px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,fe.jsx)(m.A,{size:20,color:"#ff4d4f",style:{flexShrink:0}}),(0,fe.jsx)("span",{children:"Pro ulo\u017een\xed je nutn\xe9 vyplnit n\xe1sleduj\xedc\xed polo\u017eky:"})]}),Object.values(n).map((e,n)=>e.errors.length>0&&(0,fe.jsxs)("div",{style:{marginBottom:"10px",padding:"10px",backgroundColor:"#fff1f0",borderRadius:"4px"},children:[(0,fe.jsx)("div",{style:{fontWeight:"600",fontSize:"13px",color:"#d32f2f",marginBottom:"6px"},children:e.label}),e.errors.map((e,n)=>(0,fe.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginLeft:"8px",marginTop:"4px",display:"flex",alignItems:"flex-start"},children:[(0,fe.jsx)("span",{style:{marginRight:"6px",color:"#ff4d4f",fontWeight:"bold"},children:"\u2022"}),(0,fe.jsx)("span",{children:e})]},n))]},n))]})},[]),Jr=(r.useMemo(()=>{const e=[...Br,...Kr],n=new Map;return e.forEach(e=>{n.has(e.value)||n.set(e.value,e)}),Array.from(n.values())},[Br,Kr]),Ir.isReady),[Gr,qr]=(0,r.useState)(()=>Rr.filter(e=>1===e.aktivni||"1"===e.aktivni||1===e.active||"1"===e.active)),Yr=(0,r.useMemo)(()=>"0"===qn.prikazce_id||"0"===qn.schvalovatel_id?[{id:"0",jmeno:"SYSTEM",prijmeni:"",displayName:"SYSTEM",aktivni:1,deaktivovan:0},...Vr]:Vr,[Vr,qn.prikazce_id,qn.schvalovatel_id]),Xr=Kr;(0,r.useEffect)(()=>{const e=!$e;ja(!1),e&&we&&(ja(!0),Ia.default.setAutosaveEnabled(!0,"NEW order initialization"))},[$e,we]),(0,r.useEffect)(()=>{if(qn.polozky_objednavky&&Array.isArray(qn.polozky_objednavky)){const e={},n=Wr;qn.polozky_objednavky.forEach(a=>{const o=a.usek_kod&&""!==a.usek_kod.trim()||a.budova_kod&&""!==a.budova_kod.trim()||a.mistnost_kod&&""!==a.mistnost_kod.trim()||a.poznamka&&""!==a.poznamka.trim();e[a.id]=!(!n&&!o)}),Do(e)}},[null===(U=qn.polozky_objednavky)||void 0===U?void 0:U.length,qn.druh_objednavky_kod,Wr,JSON.stringify(null===(Z=qn.polozky_objednavky)||void 0===Z?void 0:Z.map(e=>({id:e.id,usek:e.usek_kod,budova:e.budova_kod,mistnost:e.mistnost_kod,poznamka:e.poznamka})))]),(0,r.useEffect)(()=>{qn.cislo_smlouvy&&qn.cislo_smlouvy!==yi&&xi(qn.cislo_smlouvy)},[qn.cislo_smlouvy,yi]);const[Qr,es]=(0,r.useState)(!1),[ns,as]=(0,r.useState)(!1);(0,r.useEffect)(()=>()=>{if(xa&&we&&qn){if(!(Object.keys(qn).length>=40))return;try{Ia.default.setCurrentUser(we),Ia.default.saveDraft(qn,{orderId:qn.id||null})}catch(e){}}},[]),(0,r.useEffect)(()=>{if(!we||!xa||$e)return;let e=!0;return(async()=>{try{var n;Ia.default.setCurrentUser(we);if(!await Ia.default.hasDraft())return;const a=await Ia.default.loadDraft();if(null===a||void 0===a||!a.formData||!e)return;if(a.formData.id){const n=await Ia.default.checkDBSync(async e=>{try{return await(0,La.jq)(e,Ee,Se)}catch(n){return null}},async e=>{try{const n=await(0,La.getOrderV2)(e,Ee,Se);return(null===n||void 0===n?void 0:n.data)||null}catch(a){var n;return 403!==(null===a||void 0===a?void 0:a.status)&&403!==(null===a||void 0===a||null===(n=a.response)||void 0===n?void 0:n.status)||console.warn("\u26d4 HIERARCHY: P\u0159\xedstup k objedn\xe1vce zam\xedtnut hierarchi\xed"),null}});if(!e)return;if(n.needsSync&&n.dbData){const e=(0,t.A)({},n.dbData);return e.polozky_objednavky&&0!==e.polozky_objednavky.length||qn.polozky_objednavky&&qn.polozky_objednavky.length>0&&(e.polozky_objednavky=qn.polozky_objednavky),Xn(e),ya(!1),$n(!0),wa({isEditMode:!0,isNewOrder:!1,orderId:n.dbData.id,orderNumber:n.dbData.cislo_objednavky||n.dbData.ev_cislo}),void await Ia.default.syncWithDatabase(n.dbData,n.dbData.id)}}const o=(0,t.A)({},a.formData);o.faktury&&Array.isArray(o.faktury)&&(o.faktury=o.faktury.map(e=>(e.fa_strediska_kod&&Array.isArray(e.fa_strediska_kod)&&(e.fa_strediska_kod=e.fa_strediska_kod.map(e=>"string"===typeof e?e:e.value||e.kod_stavu||e.id||e)),e))),Xn(e=>{var n,i;return(0,t.A)((0,t.A)((0,t.A)({},e),o),{},{id:(null===e||void 0===e?void 0:e.id)||a.formData.id,datum_posledni_zmeny:(null===e||void 0===e?void 0:e.datum_posledni_zmeny)||a.formData.datum_posledni_zmeny,stav_schvaleni:o.stav_schvaleni||(null===e||void 0===e?void 0:e.stav_schvaleni)||"",strediska_kod:o.strediska_kod&&Array.isArray(o.strediska_kod)&&o.strediska_kod.length>0?o.strediska_kod:(null===e||void 0===e?void 0:e.strediska_kod)||[],dodavatel_zpusob_potvrzeni:(null===(n=o.dodavatel_zpusob_potvrzeni)||void 0===n||null===(i=n.zpusoby)||void 0===i?void 0:i.length)>0?o.dodavatel_zpusob_potvrzeni:(null===e||void 0===e?void 0:e.dodavatel_zpusob_potvrzeni)||o.dodavatel_zpusob_potvrzeni})}),ya(!0===a.isChanged),(a.formData.id||null!==(n=a.formData)&&void 0!==n&&n.id)&&($n(!0),wa({isEditMode:!0,isNewOrder:!1,orderId:a.formData.id,orderNumber:a.formData.cislo_objednavky||a.formData.ev_cislo}))}catch(a){}})(),()=>{e=!1}},[we,xa,$e]);const os=(0,r.useMemo)(()=>!!qn.id,[qn.id]),ts=((0,r.useMemo)(()=>(Array.isArray(qn.stav_workflow_kod)?qn.stav_workflow_kod:la(qn.stav_workflow_kod)).includes("SCHVALENA"),[qn.stav_workflow_kod]),eo(ia,aa,ea)),is=e=>({objednatel:"section-grey",schvaleni:"section-grey",financovani:"section-orange",dodavatel:"section-orange",detaily:"section-orange",dodaci_podminky:"section-orange",stav_odeslani:"section-orange",prilohy:"section-red",potvrzeni_objednavky:"section-blue",registr_smluv:"section-blue",prubeh_objednavky:"section-blue",dodaci_informace:"section-blue",fakturace:"section-blue",storno_detail:"section-blue",registr_smluv_vyplneni:"section-purple"}[e]||"section-orange"),rs=Oe&&(Oe("ORDER_MANAGE")||Oe("ORDER_APPROVE")||Oe("ORDER_EDIT_OWN")||Oe("ORDER_EDIT_ALL")),ss=(0,r.useCallback)(e=>{const n=aa;if(1===n){const n=["financovani","detaily"];return!!["objednatel","schvaleni"].includes(e)||!(!rs||!n.includes(e))}return 2===n?["financovani","dodavatel","detaily","dodaci_podminky","prilohy","stav_odeslani"].includes(e):n>=3&&["potvrzeni_objednavky","registr_smluv","prubeh_objednavky","dodaci_informace","fakturace","storno_detail"].includes(e)},[aa,rs]),ds=Oe&&Oe("ORDER_APPROVE"),ls=Oe&&Oe("ORDER_MANAGE"),cs=Oe&&Oe("USER_MANAGE"),ps=Oe&&(Oe("ORDER_MANAGE")||Oe("ORDER_EDIT_OWN")||Oe("ORDER_EDIT_ALL")),us=ds||ls,vs=Oe&&Oe("ORDER_PUBLISH_REGISTRY"),_s=Oe&&Oe("INVOICE_MANAGE"),ms=Oe&&(Oe("ORDER_MANAGE")||Oe("ORDER_EDIT_OWN")||Oe("ORDER_EDIT_ALL")),fs=null===Ae||void 0===Ae||null===(B=Ae.roles)||void 0===B?void 0:B.some(e=>"SUPERADMIN"===e.kod_role),hs=null===Ae||void 0===Ae||null===(K=Ae.roles)||void 0===K?void 0:K.some(e=>"ADMINISTRATOR"===e.kod_role),ks=Oe&&Oe("ORDER_MANAGE"),gs=fs||hs||ks,bs=r.useMemo(()=>{var e;if(!qn.prikazce_id)return Zr;const n=Yr.find(e=>(e.id||e.user_id)===parseInt(qn.prikazce_id));if(!n)return console.warn("\u26a0\ufe0f P\u0159\xedkazce nenalezen v approvers!"),Zr;const a=Rr.find(e=>(e.id||e.user_id)===parseInt(qn.prikazce_id));if(null===a||void 0===a||null===(e=a.roles)||void 0===e?void 0:e.some(e=>"SUPERADMIN"===e.kod_role)){const e=new Date;return e.setHours(0,0,0,0),Zr.filter(n=>{const a=n.platne_od?new Date(n.platne_od):null,o=n.platne_do?new Date(n.platne_do):null;return a&&a.setHours(0,0,0,0),o&&o.setHours(0,0,0,0),(!a||a<=e)&&(!o||o>=e)})}const o=n.usek_id;if(!o)return console.warn("\u26a0\ufe0f P\u0159\xedkazce nem\xe1 usek_id:",n),Zr;const t=new Date;t.setHours(0,0,0,0);return Zr.filter(e=>{const n=e.usek_id||e.usek;if(!n||String(n)!==String(o))return!1;const a=e.platne_od?new Date(e.platne_od):null,i=e.platne_do?new Date(e.platne_do):null;a&&a.setHours(0,0,0,0),i&&i.setHours(0,0,0,0);return(!a||a<=t)&&(!i||i>=t)})},[qn.prikazce_id,Zr,Yr,Rr]),ys=(0,r.useMemo)(()=>ua,[ua]),xs=(0,r.useMemo)(()=>na.getAllSectionStates(),[aa,qn.id,ea,qn.stav_workflow_kod,qn.potvrzeni_dokonceni_objednavky,na]),js=(0,r.useMemo)(()=>({id:qn.id,faktury:qn.faktury,max_cena_s_dph:qn.max_cena_s_dph}),[qn.id,qn.faktury,qn.max_cena_s_dph]),zs=(0,r.useMemo)(()=>{if(!un||0===un.length)return{count:0,hasErrors:!1};return{count:un.length,hasErrors:un.some(e=>!1===e.file_exists||"error"===e.status||"failed"===e.status||!e.klasifikace||""===e.klasifikace.trim())}},[un]),As=(0,r.useMemo)(()=>{var e,n;const a=(0,t.A)({},xs);qn.id&&(a.prilohy={visible:!0,enabled:!ys,attachmentsCount:zs.count,hasAttachmentErrors:zs.hasErrors});const o="pokladna"===(null===(e=qn.financovani)||void 0===e?void 0:e.platba),i="pokladna"===(null===(n=qn.dodavatel_zpusob_potvrzeni)||void 0===n?void 0:n.platba),r=o||i,s=qn.faktury&&qn.faktury.length>0;a.fakturace&&(a.fakturace=(0,t.A)((0,t.A)({},a.fakturace),{},{visible:!r&&(_s?aa>=6:aa>=7||s)}));const d=qn.dt_zverejneni&&qn.registr_iddt;return a.registr_smluv_vyplneni&&(a.registr_smluv_vyplneni=(0,t.A)((0,t.A)({},a.registr_smluv_vyplneni),{},{visible:a.registr_smluv_vyplneni.visible&&(vs||d)})),a.dokonceni&&gs&&aa>=8&&(a.dokonceni=(0,t.A)((0,t.A)({},a.dokonceni),{},{visible:!0})),a},[xs,aa,_s,vs,null===(H=qn.financovani)||void 0===H?void 0:H.platba,null===(W=qn.dodavatel_zpusob_potvrzeni)||void 0===W?void 0:W.platba,qn.faktury,qn.dt_zverejneni,qn.registr_iddt,qn.id,ys,gs,zs]),ws=(0,r.useCallback)(e=>!e.enabled||gt||Qt,[gt,Qt]),Ss=xs.registr_smluv,Es=!Ss.enabled,Cs=xs.registr_smluv_vyplneni,Ns=!Cs.enabled,Os=xs.potvrzeni_objednavky,Ds=!Os.enabled,Ts=ws(xs.objednatel),Is=ws(xs.schvaleni),od=!ea&&aa>=3&&!na.isSectionUnlocked("phase2"),Pd=xs.financovani,ic=ws(Pd),rc=ws(xs.dodavatel),lc=ws(Os),cc=xs.fakturace,pc=!cc.enabled&&(aa>=8||ca(qn.stav_workflow_kod,"FAKTURACE")),uc=!cc.enabled,vc=xs.dokonceni,_c=(vc.enabled,ca(qn.stav_workflow_kod,"DOKONCENA")),mc=_c&&!na.isSectionUnlocked("dokonceni"),fc=ca(qn.stav_workflow_kod,"ZKONTROLOVANA"),hc=aa<7||aa>=8||fc||mc||ea;ca(qn.stav_workflow_kod,"ODESLANA"),ca(qn.stav_workflow_kod,"ZRUSENA");(0,r.useEffect)(()=>{$e&&(ja(!1),Yt(!1),Fe.current=null)},[$e,Ee,Se]),(0,r.useEffect)(()=>{},[$e,Ee,Se,xa,Jr]);const kc=(0,r.useRef)({isSuperAdmin:!1,isAdmin:!1});(0,r.useEffect)(()=>{var e,n;const a=null===Ae||void 0===Ae||null===(e=Ae.roles)||void 0===e?void 0:e.some(e=>"SUPERADMIN"===e.kod_role),o=null===Ae||void 0===Ae||null===(n=Ae.roles)||void 0===n?void 0:n.some(e=>"ADMINISTRATOR"===e.kod_role);kc.current={isSuperAdmin:a,isAdmin:o}},[Ae]),(0,r.useEffect)(()=>{if(ha&&xa&&!qn.jmeno&&Ae&&we){const e="".concat(Ae.titul_pred?Ae.titul_pred+" ":"").concat(Ae.jmeno||""," ").concat(Ae.prijmeni||"").concat(Ae.titul_za?", "+Ae.titul_za:"").replace(/\s+/g," ").trim();Xn(n=>(0,t.A)((0,t.A)({},n),{},{jmeno:e,email:Ae.email||"",telefon:Ae.telefon||"",uzivatel_id:we,objednatel_id:we}))}},[ha,xa,qn.jmeno,Ae,we]),(0,r.useEffect)(()=>()=>{},[]),(0,r.useEffect)(()=>{qn.id&&(Eo||(So({}),an(new Set)),we&&qn.ev_cislo&&Ia.default.saveMetadata({openConceptNumber:qn.ev_cislo}))},[qn.id]);const gc=(0,r.useRef)(!1),bc=(0,r.useRef)(aa);(0,r.useEffect)(()=>{var e;const n=(null===(e=qn.polozky_objednavky)||void 0===e?void 0:e.length)||0;xa&&(bc.current!==aa&&(gc.current=!1,bc.current=aa),aa>=3&&0===n&&!gc.current&&(gc.current=!0,Xn(e=>(0,t.A)((0,t.A)({},e),{},{polozky_objednavky:[{id:"new_item_".concat(Date.now()),popis:"",mnozstvi:"1",jednotka:"ks",cena_bez_dph:"",sazba_dph:"21",cena_s_dph:""}]}))))},[aa,xa,qn.druh_objednavky_kod,null===($=qn.polozky_objednavky)||void 0===$?void 0:$.length]),(0,r.useEffect)(()=>{if(!qn.polozky_objednavky||0===qn.polozky_objednavky.length)return;if(4!==aa)return;const e=qn.dodavatel_zpusob_potvrzeni;if(!("ANO"===(null===e||void 0===e?void 0:e.potvrzeni)||!0===(null===e||void 0===e?void 0:e.potvrzeno)))return;if(ca(qn.stav_workflow_kod,"UVEREJNIT"))return;if(ca(qn.stav_workflow_kod,"NEUVEREJNIT"))return;if(void 0!==qn.ma_byt_zverejnena&&null!==qn.ma_byt_zverejnena)return;const n=qn.polozky_objednavky.reduce((e,n)=>e+(parseFloat((n.cena_bez_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0)*(parseFloat(n.mnozstvi)||1),0),a=n>5e4;Xn(e=>(0,t.A)((0,t.A)({},e),{},{ma_byt_zverejnena:a})),Ic("info","REGISTR","auto-detect","Cena ".concat(n.toFixed(2)," K\u010d ").concat(a?">":"\u2264",' 50 000 K\u010d \u2192 v\xfdchoz\xed hodnota "M\xe1 b\xfdt zve\u0159ejn\u011bna" = ').concat(a))},[aa,qn.polozky_objednavky,qn.dodavatel_zpusob_potvrzeni,qn.stav_workflow_kod,qn.ma_byt_zverejnena]);const yc=(0,r.useCallback)(e=>{Xn(n=>(0,t.A)((0,t.A)({},n),{},{faktury:e})),ya(!0)},[]);(0,r.useEffect)(()=>{if(!qn.zpusob_financovani||!Mr.length)return;const e=Mr.find(e=>e.kod===qn.zpusob_financovani||e.value===qn.zpusob_financovani);((null===e||void 0===e?void 0:e.nazev)||"").toLowerCase().includes("pokladna")?(qe(e=>(0,t.A)((0,t.A)({},e),{},{dodavatel:!0})),Xn(e=>(0,t.A)((0,t.A)({},e),{},{dodavatel_id:null,dodavatel_nazev:"",dodavatel_adresa:"",dodavatel_ico:"",dodavatel_dic:"",dodavatel_zastoupeny:"",dodavatel_kontakt_jmeno:"",dodavatel_kontakt_email:"",dodavatel_kontakt_telefon:""}))):qe(e=>(0,t.A)((0,t.A)({},e),{},{dodavatel:!1}))},[qn.zpusob_financovani,Mr,Eo]),(0,r.useEffect)(()=>{const e=e=>{e.preventDefault(),e.stopPropagation()},n=n=>{e(n)};return["dragenter","dragover","dragleave","drop"].forEach(n=>{document.addEventListener(n,e,!1)}),document.addEventListener("drop",n,!1),()=>{["dragenter","dragover","dragleave","drop"].forEach(n=>{document.removeEventListener(n,e,!1)}),document.removeEventListener("drop",n,!1)}},[]);const Nc=(0,r.useMemo)(()=>qn.polozky_objednavky&&0!==qn.polozky_objednavky.length?qn.polozky_objednavky.reduce((e,n)=>e+(parseFloat((n.cena_s_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0),0):0,[qn.polozky_objednavky]),Oc=(0,r.useMemo)(()=>{var e;return parseFloat(null===(e=qn.max_cena_s_dph)||void 0===e?void 0:e.toString().replace(/[^0-9.-]/g,""))||0},[qn.max_cena_s_dph]),Dc=Nc>Oc&&Oc>0,Tc=(0,r.useMemo)(()=>qn.polozky_objednavky&&0!==qn.polozky_objednavky.length?qn.polozky_objednavky.reduce((e,n)=>e+(parseFloat((n.cena_bez_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0)*(parseFloat(n.mnozstvi)||1),0):0,[qn.polozky_objednavky]);(0,r.useMemo)(()=>Nc/1.21,[Nc]);(0,r.useEffect)(()=>{ra()>=3&&Tc>5e4&&!qn.ma_byt_zverejnena&&qn.id&&Rp("ma_byt_zverejnena",!0)},[ra(),Tc,qn.id,qn.id]),(0,r.useEffect)(()=>{aa<2&&"po"!==Vi&&Fi("po")},[aa,Vi]),(0,r.useEffect)(()=>{qn.id&&Ee&&Se&&!ha&&!Ge.prilohy&&_p()},[qn.id,qn.id,Ee,Se,ha,Ge.prilohy]);const Ic=(e,n,a,o)=>{},Pc=e=>{if(!e)return"";let n=Rr.find(n=>(n.id||n.user_id)===parseInt(e));if(n||(n=Yr.find(n=>(n.id||n.user_id)===parseInt(e))),!n&&parseInt(e)===parseInt(we)&&Ae&&(n=Ae),!n&&Jn[e])return Jn[e];if(n){const e=n.titul_pred?n.titul_pred+" ":"",a=n.jmeno||"",o=n.prijmeni||"",t=n.titul_za?", "+n.titul_za:"";return"".concat(e).concat(a," ").concat(o).concat(t).replace(/\s+/g," ").trim()}return Jn[e]||(0,me.getUserDetailApi2)(Se,Ee,e).then(n=>{if(n){const a=n.titul_pred?n.titul_pred+" ":"",o=n.jmeno||"",i=n.prijmeni||"",r=n.titul_za?", "+n.titul_za:"",s="".concat(a).concat(o," ").concat(i).concat(r).replace(/\s+/g," ").trim();Gn(n=>(0,t.A)((0,t.A)({},n),{},{[e]:s}))}else Gn(n=>(0,t.A)((0,t.A)({},n),{},{[e]:"U\u017eivatel ID ".concat(e)}))}).catch(n=>{Gn(n=>(0,t.A)((0,t.A)({},n),{},{[e]:"U\u017eivatel ID ".concat(e)}))}),"Na\u010d\xedt\xe1m..."},Lc=e=>!!e&&("Na\u010d\xedt\xe1m..."!==e&&("string"!==typeof e||""!==e.trim()));(0,r.useEffect)(()=>{(async()=>{if(!Jr||0===Rr.length)return;const e=Rr.filter(e=>1===e.aktivni||"1"===e.aktivni||1===e.active||"1"===e.active),n=qn.id||qn.id;if(!qn.garant_uzivatel_id||!n)return void qr(e);if(e.find(e=>e.id===qn.garant_uzivatel_id||e.user_id===qn.garant_uzivatel_id))return void qr(e);const a=Rr.find(e=>e.id===qn.garant_uzivatel_id||e.user_id===qn.garant_uzivatel_id);if(a)qr([a,...e]);else if(Se&&Ee)try{const n=await(0,me.getUserDetailApi2)(Se,Ee,qn.garant_uzivatel_id);if(n){const a={id:n.id||n.uzivatel_id,user_id:n.id||n.uzivatel_id,username:n.username||n.login,jmeno:n.jmeno||"",prijmeni:n.prijmeni||"",titul_pred:n.titul_pred||"",titul_za:n.titul_za||"",email:n.email||"",aktivni:0};qr([a,...e])}else qr(e)}catch(o){qr(e)}else qr(e)})()},[qn.garant_uzivatel_id,qn.id,Rr,qn.id,Se,Ee,Jr]);r.useCallback(()=>{if(!(!qn.id||aa<7||ur)&&(!qn.faktury||0===qn.faktury.length)){const e=Ps(new Date),n={id:"temp-".concat(Date.now()),objednavka_id:qn.id,fa_datum_doruceni:e,fa_dorucena:1,fa_castka:"",fa_cislo_vema:"",fa_strediska_kod:qn.strediska_kod||[],fa_splatnost:"",fa_poznamka:"",vytvoril_uzivatel_id:we,vytvoril_jmeno:Pc(we),dt_vytvoreni:(new Date).toISOString(),dt_aktualizace:null,aktivni:1,_isNew:!0};yc([n])}},[qn.id,aa,ur,qn.faktury,qn.strediska_kod,we]);const Rc=(0,r.useCallback)(async e=>{var n;if(e&&!String(e).startsWith("temp-")&&(null===(n=ko[e])||void 0===n||!n.loaded))try{const n=await(0,Ja.v)(e,Ee,Se);n&&"ok"===n.status&&n.data&&go(a=>(0,t.A)((0,t.A)({},a),{},{[e]:{lpCerpani:n.data.lp_cerpani||[],loaded:!0}}))}catch(a){console.error("\u274c [LP] Chyba p\u0159i na\u010d\xedt\xe1n\xed LP \u010derp\xe1n\xed:",a),go(n=>(0,t.A)((0,t.A)({},n),{},{[e]:{lpCerpani:[],loaded:!0}}))}},[Ee,Se,ko]),Vc=(0,r.useCallback)(async(e,n)=>{if(!e||String(e).startsWith("temp-"))return console.warn("\u26a0\ufe0f [LP] Nelze ulo\u017eit LP \u010derp\xe1n\xed pro temp fakturu"),!1;try{return await(0,Ja.M)(e,n,Ee,Se),go(a=>(0,t.A)((0,t.A)({},a),{},{[e]:{lpCerpani:n,loaded:!0}})),!0}catch(a){throw console.error("\u274c [LP] Chyba p\u0159i ukl\xe1d\xe1n\xed LP \u010derp\xe1n\xed:",a),a}},[Ee,Se]),Fc=(e,n)=>{const a=Array.isArray(qn.faktury)?qn.faktury:[];if(e._updateExisting){const o=a.map(a=>{if(Number(a.id)===Number(n)){return(0,t.A)((0,t.A)({},a),{},{fa_cislo_vema:e.fa_cislo_vema||a.fa_cislo_vema,fa_datum_vystaveni:e.fa_datum_vystaveni||a.fa_datum_vystaveni,fa_datum_zdanitelneho_plneni:e.fa_datum_zdanitelneho_plneni||a.fa_datum_zdanitelneho_plneni,fa_datum_splatnosti:e.fa_datum_splatnosti||a.fa_datum_splatnosti,fa_splatnost:e.fa_datum_splatnosti||a.fa_splatnost,fa_datum_doruceni:e.fa_datum_doruceni||a.fa_datum_doruceni,fa_castka:e.fa_castka||a.fa_castka,fa_castka_bez_dph:e.fa_castka_bez_dph||a.fa_castka_bez_dph,fa_dph:e.fa_dph||a.fa_dph,fa_poznamka:e.fa_poznamka||a.fa_poznamka,fa_strediska_kod:e.fa_strediska_kod||a.fa_strediska_kod,fa_dorucena:1,dt_aktualizace:(new Date).toISOString(),_isdoc_parsed:!0,_isdoc_polozky:e._isdoc_polozky,_isdoc_dodavatel:e._isdoc_dodavatel,_isdoc_email:e._isdoc_email,_fromISDOC:!0})}return a});return yc(o),Xn(n=>(0,t.A)((0,t.A)({},n),{},{cislo_faktury:e.fa_cislo_vema||n.cislo_faktury,datum_faktury:e.fa_datum_vystaveni||n.datum_faktury,datum_splatnosti:e.fa_datum_splatnosti||n.datum_splatnosti,castka_bez_dph:e.fa_castka_bez_dph||n.castka_bez_dph,castka_s_dph:e.fa_castka||n.castka_s_dph,_isdocRefresh:Date.now()})),void setTimeout(()=>oo(!0),300)}const o={id:n,objednavka_id:qn.id,fa_cislo_vema:e.fa_cislo_vema||"",fa_datum_vystaveni:e.fa_datum_vystaveni||"",fa_datum_zdanitelneho_plneni:e.fa_datum_zdanitelneho_plneni||"",fa_datum_splatnosti:e.fa_datum_splatnosti||"",fa_splatnost:e.fa_datum_splatnosti||"",fa_datum_doruceni:e.fa_datum_doruceni||Rs(),fa_castka:e.fa_castka||"",fa_castka_bez_dph:e.fa_castka_bez_dph||"",fa_dph:e.fa_dph||"",fa_poznamka:e.fa_poznamka||"",fa_strediska_kod:e.fa_strediska_kod||(Array.isArray(qn.strediska_kod)?qn.strediska_kod:[]),fa_dorucena:1,vytvoril_uzivatel_id:we,vytvoril_jmeno:Pc(we),dt_vytvoreni:(new Date).toISOString(),dt_aktualizace:null,aktivni:1,_isdoc_parsed:!0,_isdoc_polozky:e._isdoc_polozky,_isdoc_dodavatel:e._isdoc_dodavatel,_fromISDOC:!0,vecna_spravnost_umisteni_majetku:"",vecna_spravnost_poznamka:"",vecna_spravnost_potvrzeno:0},i=[...a.filter(e=>!String(e.id).startsWith("temp-")),o];yc(i),_r(o),fr(o),Xn(e=>(0,t.A)((0,t.A)({},e),{},{cislo_faktury:o.fa_cislo_vema||"",datum_faktury:o.fa_datum_vystaveni||"",datum_splatnosti:o.fa_datum_splatnosti||"",castka_bez_dph:o.fa_castka_bez_dph||"",castka_s_dph:o.fa_castka||"",_isdocRefresh:Date.now()})),setTimeout(()=>oo(!0),300)},Mc=(0,r.useCallback)(function(e){var n,a;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const t=[];(!e.fa_cislo_vema||"string"===typeof e.fa_cislo_vema&&""===e.fa_cislo_vema.trim())&&t.push("\u010c\xedslo faktury VEMA"),(!e.fa_castka||parseFloat(e.fa_castka)<=0)&&t.push("\u010c\xe1stka"),(!e.fa_datum_doruceni||"string"===typeof e.fa_datum_doruceni&&""===e.fa_datum_doruceni.trim())&&t.push("Datum doru\u010den\xed"),(!e.fa_splatnost||"string"===typeof e.fa_splatnost&&""===e.fa_splatnost.trim())&&t.push("Datum splatnosti");return o&&((null===(n=o.name)||void 0===n?void 0:n.toLowerCase().endsWith(".isdoc"))||(null===(a=o.name)||void 0===a?void 0:a.toLowerCase().endsWith(".isdocx"))||"text/isdoc"===o.type)?{isValid:!0,valid:!0,isISDOC:!0,missingFields:t,message:t.length>0?"ISDOC soubor - data lze automaticky vyt\u011b\u017eit po nahr\xe1n\xed":"ISDOC soubor p\u0159ipraven k nahr\xe1n\xed"}:t.length>0?{isValid:!1,valid:!1,isISDOC:!1,missingFields:t,message:"Pro nahr\xe1n\xed p\u0159\xedlohy vypl\u0148te nejprve: ".concat(t.join(", "))}:{isValid:!0,valid:!0,isISDOC:!1,missingFields:[],message:"P\u0159ipraven k nahr\xe1n\xed"}},[]),Zc=(0,r.useCallback)((e,n)=>{let a=e;n&&Array.isArray(n)&&n.length>0&&n[0]&&n[0].faktura_id&&(a=n[0].faktura_id);const o=Array.isArray(n)&&n.some(e=>{if(!e)return!1;const n=e.klasifikace||e.typ_prilohy||"";return n.toLowerCase().includes("pokladn")||n.toLowerCase().includes("paragon")});Xn(i=>{const r=(i.faktury||[]).map(i=>i.id===e||i.id===a||String(i.id)===String(a)?(0,t.A)((0,t.A)({},i),{},{attachments:n,_isPokladna:o}):i);return(0,t.A)((0,t.A)({},i),{},{faktury:r})}),oo(!0)},[]),Bc=(0,r.useCallback)(async e=>{try{var n,a;const o=null===(n=qn.faktury)||void 0===n?void 0:n.find(n=>n.id===e);if(!o)throw new Error("Faktura s ID ".concat(e," nebyla nalezena"));if(!o.fa_cislo_vema)throw new Error("Vypl\u0148te \u010d\xedslo faktury");if(!o.fa_datum_doruceni)throw new Error("Vypl\u0148te datum doru\u010den\xed");if(!o.fa_castka)throw new Error("Vypl\u0148te \u010d\xe1stku faktury");if(!o.fa_strediska_kod||0===o.fa_strediska_kod.length)throw new Error("Vyberte alespo\u0148 jedno st\u0159edisko");const i=qn.id||qn.id;if(!i)throw new Error("Nejd\u0159\xedv ulo\u017ete objedn\xe1vku");let r=[];o.fa_strediska_kod&&Array.isArray(o.fa_strediska_kod)&&(r=o.fa_strediska_kod.map(e=>"object"===typeof e&&e.kod_stavu?e.kod_stavu:e));const s={token:Ee,username:Se,order_id:i,fa_cislo_vema:o.fa_cislo_vema,fa_datum_vystaveni:o.fa_datum_doruceni,fa_castka:o.fa_castka,fa_datum_splatnosti:o.fa_splatnost||null,fa_datum_doruceni:o.fa_datum_doruceni,fa_dorucena:o.fa_dorucena||1,fa_strediska_kod:JSON.stringify(r),fa_poznamka:o.fa_poznamka||null,rozsirujici_data:o.rozsirujici_data||null},d=await Wa(s),l=(null===(a=d.data)||void 0===a?void 0:a.invoice_id)||d.invoice_id;if(!l)throw new Error("Backend nevr\xe1til ID faktury");return Xn(n=>{const a=(n.faktury||[]).map(n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{id:l,_isNew:!1}):n);return(0,t.A)((0,t.A)({},n),{},{faktury:a})}),l}catch(o){throw console.group("\u274c CHYBA p\u0159i vytv\xe1\u0159en\xed faktury v DB"),o.response,console.groupEnd(),o}},[qn,qn.id,Ee,Se]),Kc=(0,r.useCallback)(async(e,n)=>{String(e).startsWith("temp-"),oo(!0)},[]);(0,r.useEffect)(()=>{const e=qn.faktury||[];if(qn.id&&0===e.length&&!uc&&aa>=7){const e=Ps(new Date),n=parseInt(localStorage.getItem("user_id"),10),a={id:"temp-".concat(Date.now()),objednavka_id:qn.id,fa_datum_doruceni:e,fa_dorucena:1,fa_castka:"",fa_cislo_vema:"",fa_strediska_kod:Array.isArray(qn.strediska_kod)?qn.strediska_kod:[],fa_poznamka:"",fa_splatnost:"",vytvoril_uzivatel_id:n,vytvoril_jmeno:Pc(n),dt_vytvoreni:(new Date).toISOString(),dt_aktualizace:null,aktivni:1,_isNew:!0,vecna_spravnost_umisteni_majetku:"",vecna_spravnost_poznamka:"",vecna_spravnost_potvrzeno:0};yc([a]),_r(a),fr({fa_datum_doruceni:e,fa_dorucena:1,fa_castka:"",fa_cislo_vema:"",fa_strediska_kod:qn.strediska_kod||[],fa_poznamka:"",fa_splatnost:"",vecna_spravnost_umisteni_majetku:"",vecna_spravnost_poznamka:"",vecna_spravnost_potvrzeno:0})}},[qn.id,null===(J=qn.faktury)||void 0===J?void 0:J.length,uc,aa]);const Hc=async()=>{if(qn.id)return!1;const e=Ia.default.getMetadata();if(Wn||!0===(null===e||void 0===e?void 0:e.isEditMode))return!1;if(qn.ev_cislo&&"Na\u010d\xedt\xe1m..."!==qn.ev_cislo)return!1;const n=new URLSearchParams(window.location.search).get("edit");if(n)return!1;tn(!0);try{const a=await(0,La.XY)(Ee,Se),o=a.next_order_string||a.order_number_string||a.next_number;if(!o)throw new Error("API nevr\xe1tilo next_order_string");return!(qn.id||Wn||!0===(null===e||void 0===e?void 0:e.isEditMode)||n)&&(Xn(e=>(0,t.A)((0,t.A)({},e),{},{ev_cislo:o})),!0)}catch(a){return Xn(e=>(0,t.A)((0,t.A)({},e),{},{ev_cislo:null})),null===ze||void 0===ze||ze(Cr("Nepoda\u0159ilo se na\u010d\xedst eviden\u010dn\xed \u010d\xedslo. Zkuste str\xe1nku obnovit.","error"),{type:"error"}),!1}finally{tn(!1)}},Wc=async function(e,n){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];ze&&ze("\u2705 Objedn\xe1vka \xfasp\u011b\u0161n\u011b ulo\u017eena\n\ud83d\udccb ".concat(e,"\n\ud83d\udcbe Datab\xe1ze aktualizov\xe1na"),"success"),bt(!0),xt(0),zt("Ukl\xe1d\xe1m objedn\xe1vku...");const o=n;if(o&&Ee&&Se&&!a)try{await(0,La.$_)({token:Ee,username:Se,orderId:o})}catch(i){console.warn("\u26a0\ufe0f Unlock FAILED po ulo\u017een\xed:",i.message)}ya(!1);const t=Ia.default.startProgress({duration:1e3,onProgress:e=>{xt(e)},onComplete:()=>{e&&we&&Ia.default.saveUIState({highlightOrderId:e}),wa({isEditMode:!1,orderId:null,orderNumber:""}),$n(!1),setTimeout(()=>{je("/orders25-list",{replace:!0}),bt(!1),ei(!1)},50)}});window._activeProgressControl=t},$c=async(e,n,a,o,t)=>{try{if(o&&a===o)return void console.log("\u26a0\ufe0f [sendOrderNotifications] Stav se nezm\u011bnil, notifikace se neode\u0161lou");let n=null;const i=ca(a,"ODESLANA_KE_SCHVALENI"),r=!!o&&ca(o,"ODESLANA_KE_SCHVALENI");i&&!r&&(n="order_status_ke_schvaleni",t.garant_uzivatel_id,t.prikazce_id,t.schvalovatel_id);const s=ca(a,"SCHVALENA"),d=!!o&&ca(o,"SCHVALENA"),l=ca(a,"ZAMITNUTA"),c=!!o&&ca(o,"ZAMITNUTA");(s&&!d||l&&!c)&&(n=s?"order_status_schvalena":"order_status_zamitnuta",t.objednatel_id,t.garant_uzivatel_id,t.prikazce_id&&t.schvalovatel_id&&parseInt(t.prikazce_id)!==parseInt(t.schvalovatel_id)||t.prikazce_id);const p=ca(a,"CEKA_SE"),u=!!o&&ca(o,"CEKA_SE");p&&!u&&(n="order_status_ceka_se",t.objednatel_id,t.garant_uzivatel_id);const v=ca(a,"ODESLANA"),_=!!o&&ca(o,"ODESLANA");v&&!_&&(n="order_status_odeslana");const m=ca(a,"POTVRZENA"),f=!!o&&ca(o,"POTVRZENA");m&&!f&&(n="order_status_potvrzena");const h=ca(a,"UVEREJNENA"),k=!!o&&ca(o,"UVEREJNENA");h&&!k&&(n="order_status_registr_zverejnena");const g=ca(a,"NEUVEREJNENA"),b=!!o&&ca(o,"NEUVEREJNENA");g&&!b&&(n="order_status_registr_ceka");const y=ca(a,"FAKTURACE"),x=!!o&&ca(o,"FAKTURACE");y&&!x&&(n="order_status_faktura_ceka");const j=ca(a,"VECNA_SPRAVNOST"),z=!!o&&ca(o,"VECNA_SPRAVNOST");j&&!z&&(n="order_status_kontrola_ceka");const A=ca(a,"ZKONTROLOVANA"),w=!!o&&ca(o,"ZKONTROLOVANA");A&&!w&&(n="order_status_kontrola_potvrzena");const S=ca(a,"DOKONCENA"),E=!!o&&ca(o,"DOKONCENA");S&&!E&&(n="order_status_dokoncena");const C=ca(a,"ZRUSENA"),N=!!o&&ca(o,"ZRUSENA");if(C&&!N&&(n="order_status_zrusena"),console.log("\ud83d\udcca [sendOrderNotifications] Detekovan\xfd typ notifikace:",n),!n)return void console.log("\u26a0\ufe0f [sendOrderNotifications] \u017d\xe1dn\xfd typ notifikace nebyl detekov\xe1n, kon\u010d\xedm");console.log("\ud83d\ude80 [sendOrderNotifications] Odes\xedl\xe1m notifikace p\u0159es NOV\xdd org-hierarchy syst\xe9m..."),console.log("   \u2192 Event Type:",n),console.log("   \u2192 Order ID:",e),console.log("   \u2192 Trigger User ID:",we),console.log("   \u2192 Backend najde p\u0159\xedjemce v org hierarchii automaticky!")}catch(i){console.error("\u274c [sendOrderNotifications] Chyba p\u0159i odes\xedl\xe1n\xed notifikac\xed:",i)}},Jc=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!Ee||!Se)return void(ze&&ze(Cr("Pro ulo\u017een\xed objedn\xe1vky mus\xedte b\xfdt p\u0159ihl\xe1\u0161eni","error"),{type:"error"}));if(!Lc(qn.ev_cislo))return void(ze&&ze("Eviden\u010dn\xed \u010d\xedslo se st\xe1le na\u010d\xedt\xe1. Po\u010dkejte pros\xedm na dokon\u010den\xed.",{type:"warning"}));const n=1===qn.potvrzeni_dokonceni_objednavky||!0===qn.potvrzeni_dokonceni_objednavky,a=(null===na||void 0===na?void 0:na.hasWorkflowState(qn.stav_workflow_kod,"DOKONCENA"))||!1;if(n&&!a&&!In&&!e)return console.log("\ud83d\udccb [DOKONCENI] Otev\xedr\xe1m modal pro potvrzen\xed finan\u010dn\xed kontroly..."),void Tn(!0);if(window.__workflowStateUpdated=!1,ei(!0),ka){try{const e={};we&&(e.uzivatel_id="string"===typeof we?parseInt(we,10):we),qn.objednatel_id&&(e.objednatel_id="string"===typeof qn.objednatel_id?parseInt(qn.objednatel_id,10):qn.objednatel_id),qn.predmet&&(e.predmet=qn.predmet),qn.garant_uzivatel_id&&(e.garant_uzivatel_id=qn.garant_uzivatel_id),qn.prikazce_id&&(e.prikazce_id=qn.prikazce_id),qn.max_cena_s_dph&&(e.max_cena_s_dph=qn.max_cena_s_dph),qn.druh_objednavky_kod&&(e.druh_objednavky_kod=qn.druh_objednavky_kod),qn.poznamka&&(e.poznamka=qn.poznamka),qn.strediska_kod&&qn.strediska_kod.length>0&&(e.strediska_kod=Va(qn.strediska_kod)),qn.zpusob_financovani&&(e.financovani=Ma(qn,Mr)),qn.stav_objednavky&&(e.stav_objednavky=qn.stav_objednavky),qn.stav_workflow_kod&&(e.stav_workflow_kod=qn.stav_workflow_kod),qn.faze_objednavky&&(e.faze_objednavky=qn.faze_objednavky),qn.schvalil_uzivatel_id&&(e.schvalil_uzivatel_id=qn.schvalil_uzivatel_id),qn.dt_schvaleni&&(e.dt_schvaleni=qn.dt_schvaleni),qn.poznamka_schvaleni&&(e.poznamka_schvaleni=qn.poznamka_schvaleni),qn.potvrdil_vecnou_spravnost_id&&(e.potvrdil_vecnou_spravnost_id=qn.potvrdil_vecnou_spravnost_id),qn.dt_potvrzeni_vecne_spravnosti&&(e.dt_potvrzeni_vecne_spravnosti=qn.dt_potvrzeni_vecne_spravnosti),qn.poznamka_vecna_spravnost&&(e.poznamka_vecna_spravnost=qn.poznamka_vecna_spravnost),qn.polozky_objednavky&&qn.polozky_objednavky.length>0&&(e.polozky=qn.polozky_objednavky.map(e=>({popis:e.popis||"",cena_bez_dph:parseFloat((e.cena_bez_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0,sazba_dph:parseInt(e.sazba_dph)||21,cena_s_dph:parseFloat((e.cena_s_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0,usek_kod:e.usek_kod||null,budova_kod:e.budova_kod||null,mistnost_kod:e.mistnost_kod||null,poznamka:e.poznamka||null,lp_id:e.lp_id?parseInt(e.lp_id):null})));const n=(()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),t=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),r=String(e.getSeconds()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(o," ").concat(t,":").concat(i,":").concat(r)})();e.dt_objednavky=n;await(0,La.qA)(qn.id,e,Ee,Se);if(ze&&ze("\u2705 Objedn\xe1vka \xfasp\u011b\u0161n\u011b aktualizov\xe1na\n\ud83d\udccb ".concat(qn.cislo_objednavky||"Archivovan\xe1","\n\ud83d\udcbe Zm\u011bny ulo\u017eeny"),"success"),qn.id||qn.id){const e=await(0,La.getOrderV2)(parseInt(qn.id||qn.id),Ee,Se,!0);null!==e&&void 0!==e&&e.id&&(Xn(n=>{const a=(0,t.A)((0,t.A)({},n),e);return Qn.current=JSON.parse(JSON.stringify(a)),a}),qc(e,{isOrderSavedToDB:!0,savedOrderId:e.id,isChanged:!1}))}}catch(z){ze&&ze("Chyba: ".concat(z.message),{type:"error"})}finally{ei(!1),ni(!1)}return}if(!eu())return void ei(!1);const o=(qn.polozky_objednavky||[]).reduce((e,n)=>e+(parseFloat(n.cena_s_dph)||0),0)-(parseFloat(qn.max_cena_s_dph)||0);if(o>0)return ze&&ze("Nelze ulo\u017eit objedn\xe1vku - p\u0159ekro\u010den limit o ".concat(o.toLocaleString("cs-CZ")," K\u010d! Upravte polo\u017eky nebo zvy\u0161te maxim\xe1ln\xed cenu."),{type:"error"}),Ge.detaily&&qe(e=>(0,t.A)((0,t.A)({},e),{},{detaily:!1})),void ei(!1);try{var i,r,s,d,l;ni(!0);const e=()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),t=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),r=String(e.getSeconds()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(o," ").concat(t,":").concat(i,":").concat(r)},n=()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(o)},a=null===Ae||void 0===Ae||null===(i=Ae.roles)||void 0===i?void 0:i.some(e=>"SUPERADMIN"===e.kod_role),o=null===Ae||void 0===Ae||null===(r=Ae.roles)||void 0===r?void 0:r.some(e=>"ADMINISTRATOR"===e.kod_role),C=a||o;let N=(0,t.A)({},qn);if(Ic("info","VECNA-SPRAVNOST","check-conditions","Kontrola: checkbox=".concat(qn.potvrzeni_vecne_spravnosti,", existing_id=").concat(qn.potvrdil_vecnou_spravnost_id,", user_id=").concat(we)),1!==qn.potvrzeni_vecne_spravnosti&&!0!==qn.potvrzeni_vecne_spravnosti||qn.potvrdil_vecnou_spravnost_id||!we)Ic("warning","VECNA-SPRAVNOST","auto-set-skip","\u274c P\u0159esko\u010deno nastaven\xed ID - podm\xednka nespln\u011bna");else{const n=e();N.potvrdil_vecnou_spravnost_id=we,N.dt_potvrzeni_vecne_spravnosti=n,Ic("info","VECNA-SPRAVNOST","auto-set-id","\u2705 Automaticky nastaveno p\u0159ed ulo\u017een\xedm: user_id=".concat(we,", timestamp=").concat(n))}const O={};if(we){const e="string"===typeof we?parseInt(we,10):we;O.uzivatel_id=e,Ic("info","SAVE","uzivatel-id","Nastaveno uzivatel_id: ".concat(e," (p\u016fvodn\xed typ: ").concat(typeof we,")"))}else Ic("error","SAVE","uzivatel-id-missing","user_id chyb\xed v AuthContext");if(qn.predmet&&(O.predmet=qn.predmet),qn.garant_uzivatel_id&&(O.garant_uzivatel_id=qn.garant_uzivatel_id),qn.prikazce_id&&(O.prikazce_id=qn.prikazce_id),!os&&we){const e="string"===typeof we?parseInt(we,10):we;O.objednatel_id=e,Ic("info","SAVE","objednatel-id","Nastaveno objednatel_id: ".concat(e," (nov\xe1 objedn\xe1vka)"))}else if(os&&qn.objednatel_id){const e="string"===typeof qn.objednatel_id?parseInt(qn.objednatel_id,10):qn.objednatel_id;O.objednatel_id=e,Ic("info","SAVE","objednatel-id-preserved","Zachov\xe1n objednatel_id: ".concat(e," (UPDATE objedn\xe1vky)"))}if(qn.strediska_kod&&qn.strediska_kod.length>0&&(O.strediska_kod=Va(qn.strediska_kod),Ic("info","SAVE","strediska-normalized","St\u0159ediska: ".concat(JSON.stringify(qn.strediska_kod)," -> ").concat(JSON.stringify(O.strediska_kod)))),qn.max_cena_s_dph&&(O.max_cena_s_dph=qn.max_cena_s_dph),O.mimoradna_udalost=Boolean(qn.mimoradna_udalost),Ic("info","SAVE","mimoradna-udalost","Mimo\u0159\xe1dn\xe1 ud\xe1lost: ".concat(qn.mimoradna_udalost," -> ").concat(O.mimoradna_udalost)),qn.zpusob_financovani?(O.financovani=Ma(qn,Mr),Ic("info","SAVE","financovani-normalized","Financov\xe1n\xed: ".concat(JSON.stringify(O.financovani)))):(O.financovani=null,Ic("warning","SAVE","financovani-empty","Financov\xe1n\xed nen\xed vypln\u011bno - pos\xedl\xe1m null")),qn.druh_objednavky_kod){const e=Ur.find(e=>e.kod_stavu&&e.kod_stavu===qn.druh_objednavky_kod||e.kod&&e.kod===qn.druh_objednavky_kod||e.value&&e.value===qn.druh_objednavky_kod),n={kod_stavu:(null===e||void 0===e?void 0:e.kod_stavu)||(null===e||void 0===e?void 0:e.kod)||(null===e||void 0===e?void 0:e.value)||qn.druh_objednavky_kod,nazev_stavu:(null===e||void 0===e?void 0:e.nazev_stavu)||(null===e||void 0===e?void 0:e.nazev)||(null===e||void 0===e?void 0:e.label)||qn.druh_objednavky_kod};O.druh_objednavky_kod=JSON.stringify(n),Ic("info","SAVE","druh-transform","Transformace druhu objedn\xe1vky: ".concat(qn.druh_objednavky_kod," -> ").concat(O.druh_objednavky_kod))}else O.druh_objednavky_kod=null,Ic("info","SAVE","druh-empty","Druh objedn\xe1vky nen\xed vypln\u011bn (f\xe1ze 1-2) - pos\xedl\xe1m NULL");os&&qn.id?qn.polozky_objednavky&&qn.polozky_objednavky.length>0?(O.polozky=qn.polozky_objednavky.map(e=>({popis:e.popis||"",cena_bez_dph:parseFloat((e.cena_bez_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0,sazba_dph:parseInt(e.sazba_dph)||21,cena_s_dph:parseFloat((e.cena_s_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0,usek_kod:e.usek_kod||null,budova_kod:e.budova_kod||null,mistnost_kod:e.mistnost_kod||null,poznamka:e.poznamka||null,lp_id:e.lp_id?parseInt(e.lp_id):null})),Ic("info","SAVE","polozky-transform","Transformace polo\u017eek objedn\xe1vky (UPDATE f\xe1ze ".concat(aa,"): ").concat(qn.polozky_objednavky.length," polo\u017eek -> p\u0159\xedmo do root jako 'polozky' pole"))):(O.polozky=[],Ic("warning","SAVE","polozky-empty","Polo\u017eky jsou pr\xe1zdn\xe9 (UPDATE f\xe1ze ".concat(aa,") - pos\xedl\xe1m pr\xe1zdn\xe9 pole"))):aa>=3&&qn.polozky_objednavky&&qn.polozky_objednavky.length>0?(O.polozky=qn.polozky_objednavky.map(e=>({popis:e.popis||"",cena_bez_dph:parseFloat((e.cena_bez_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0,sazba_dph:parseInt(e.sazba_dph)||21,cena_s_dph:parseFloat((e.cena_s_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0,usek_kod:e.usek_kod||null,budova_kod:e.budova_kod||null,mistnost_kod:e.mistnost_kod||null,poznamka:e.poznamka||null,lp_id:e.lp_id?parseInt(e.lp_id):null})),Ic("info","SAVE","polozky-transform-insert","Transformace polo\u017eek objedn\xe1vky (INSERT f\xe1ze ".concat(aa,"): ").concat(qn.polozky_objednavky.length," polo\u017eek"))):Ic("info","SAVE","polozky-skip","Polo\u017eky se nepos\xedlaj\xed - INSERT v F\xc1ZI ".concat(aa)),qn.poznamka_objednavky&&(O.poznamka=qn.poznamka_objednavky,Ic("info","SAVE","poznamka-add","P\u0159id\xe1na pozn\xe1mka objedn\xe1vky: ".concat(qn.poznamka_objednavky.length," znak\u016f"))),O.vecna_spravnost_umisteni_majetku=qn.vecna_spravnost_umisteni_majetku||"",O.vecna_spravnost_poznamka=qn.vecna_spravnost_poznamka||"";const D=N.potvrzeni_vecne_spravnosti;O.potvrzeni_vecne_spravnosti=1===D||!0===D?1:0,O.potvrdil_vecnou_spravnost_id=N.potvrdil_vecnou_spravnost_id||null,O.dt_potvrzeni_vecne_spravnosti=N.dt_potvrzeni_vecne_spravnosti||null,Ic("info","VECNA-SPRAVNOST","save-data","Ukl\xe1d\xe1m v\u011bcnou spr\xe1vnost: checkbox=".concat(O.potvrzeni_vecne_spravnosti,', umisteni="').concat(O.vecna_spravnost_umisteni_majetku,'", poznamka="').concat(O.vecna_spravnost_poznamka,'", user_id=').concat(O.potvrdil_vecnou_spravnost_id,", dt=").concat(O.dt_potvrzeni_vecne_spravnosti)),qn.dt_predpokladany_termin_dodani&&(O.dt_predpokladany_termin_dodani=qn.dt_predpokladany_termin_dodani),qn.misto_dodani&&(O.misto_dodani=qn.misto_dodani),qn.zaruka&&(O.zaruka=qn.zaruka),qn.dodavatel_id&&(O.dodavatel_id=qn.dodavatel_id),qn.dodavatel_nazev&&(O.dodavatel_nazev=qn.dodavatel_nazev),qn.dodavatel_adresa&&(O.dodavatel_adresa=qn.dodavatel_adresa),qn.dodavatel_ico&&(O.dodavatel_ico=qn.dodavatel_ico),qn.dodavatel_dic&&(O.dodavatel_dic=qn.dodavatel_dic),qn.dodavatel_zastoupeny&&(O.dodavatel_zastoupeny=qn.dodavatel_zastoupeny),qn.dodavatel_kontakt_jmeno&&(O.dodavatel_kontakt_jmeno=qn.dodavatel_kontakt_jmeno),qn.dodavatel_kontakt_email&&(O.dodavatel_kontakt_email=qn.dodavatel_kontakt_email),qn.dodavatel_kontakt_telefon&&(O.dodavatel_kontakt_telefon=qn.dodavatel_kontakt_telefon),qn.objednatel_jmeno&&(O.objednatel_jmeno=qn.objednatel_jmeno),qn.objednatel_email&&(O.objednatel_email=qn.objednatel_email),qn.objednatel_telefon&&(O.objednatel_telefon=qn.objednatel_telefon),qn.popis_pozadavku&&(O.popis_pozadavku=qn.popis_pozadavku),qn.poznamky&&(O.poznamky=qn.poznamky),qn.prilohy&&qn.prilohy.length>0&&(O.prilohy=qn.prilohy),qn.dt_schvaleni&&(O.dt_schvaleni=qn.dt_schvaleni),"schvaleno"===qn.stav_schvaleni?O.schvaleni_komentar="":qn.schvaleni_komentar&&(O.schvaleni_komentar=qn.schvaleni_komentar);let T=la(qn.stav_workflow_kod),I=[...T];const P=qn.id||qn.id;if(P)(I.includes("NOVA")||0===I.length||1===I.length&&"NOVA"===I[0])&&(I=I.filter(e=>"NOVA"!==e),I.includes("ODESLANA_KE_SCHVALENI")||(I.push("ODESLANA_KE_SCHVALENI"),Ic("info","SAVE","workflow-migration","UPDATE: Migrov\xe1n star\xfd stav NOVA \u2192 ODESLANA_KE_SCHVALENI")));else{I=[];"schvaleno"===qn.stav_schvaleni?(I=["SCHVALENA"],Ic("info","SAVE","workflow-new","INSERT: Okam\u017eit\xe9 schv\xe1len\xed - SCHVALENA")):(I=["ODESLANA_KE_SCHVALENI"],Ic("info","SAVE","workflow-new","INSERT: Odesl\xe1n\xed ke schv\xe1len\xed - ODESLANA_KE_SCHVALENI"))}const L=qn.stav_schvaleni;"schvaleno"===L?(I=I.filter(e=>!["ODESLANA_KE_SCHVALENI","CEKA_SE","ZAMITNUTA"].includes(e)),I.includes("SCHVALENA")||(I.push("SCHVALENA"),Ic("info","SAVE","workflow-update","P\u0159id\xe1n stav SCHVALENA"))):"neschvaleno"===L?(I=I.filter(e=>!["ODESLANA_KE_SCHVALENI","CEKA_SE","SCHVALENA"].includes(e)),I.includes("ZAMITNUTA")||(I.push("ZAMITNUTA"),Ic("info","SAVE","workflow-update","P\u0159id\xe1n stav ZAMITNUTA"))):"ceka_se"===L&&(I=I.filter(e=>!["ODESLANA_KE_SCHVALENI","ZAMITNUTA","SCHVALENA"].includes(e)),I.includes("CEKA_SE")||(I.push("CEKA_SE"),Ic("info","SAVE","workflow-update","P\u0159id\xe1n stav CEKA_SE")));const R=(null===T||void 0===T?void 0:T.includes("SCHVALENA"))||!1,V="schvaleno"===L&&!R;!I.includes("SCHVALENA")||qn.stav_odeslano||qn.stav_stornovano||I.includes("ROZPRACOVANA")||V||(I.push("ROZPRACOVANA"),Ic("info","SAVE","workflow-update","\u2705 P\u0159id\xe1n stav ROZPRACOVANA - objedn\xe1vka ve F\xc1ZI 3, je\u0161t\u011b neodeslan\xe1")),qn.stav_odeslano&&!qn.stav_stornovano?(I=["SCHVALENA","ODESLANA"],Ic("info","SAVE","workflow-clean",'\u2705 Workflow nastaven na \u010distou F\xc1ZI 4: ["SCHVALENA", "ODESLANA"]')):!qn.stav_odeslano&&I.includes("ODESLANA")&&(I=["SCHVALENA"],Ic("info","SAVE","workflow-clean",'\u2705 Workflow vr\xe1cen na F\xc1ZI 3: ["SCHVALENA"]')),qn.stav_stornovano?(I.includes("ZRUSENA")||(I.push("ZRUSENA"),Ic("info","SAVE","workflow-update","P\u0159id\xe1n stav ZRUSENA")),I=I.filter(e=>!["ROZPRACOVANA","ODESLANA","POTVRZENA"].includes(e))):I=I.filter(e=>"ZRUSENA"!==e);const F="ANO"===(null===(s=qn.dodavatel_zpusob_potvrzeni)||void 0===s?void 0:s.potvrzeni)||"potvrzeno"===qn.stav_u_dodavatele;if(F&&!qn.stav_stornovano?I.includes("POTVRZENA")||(I.push("POTVRZENA"),Ic("info","SAVE","workflow-update","\u2705 P\u0159id\xe1n stav POTVRZENA - dodavatel potvrdil ANO")):F||(I=I.filter(e=>!["POTVRZENA","UVEREJNIT","NEUVEREJNIT","UVEREJNENA","FAKTURACE","VECNA_SPRAVNOST","ZKONTROLOVANA","DOKONCENA"].includes(e)),Ic("info","SAVE","workflow-clean","\u2705 Dodavatel potvrdil NE - workflow vr\xe1cen na F\xc1ZI 4, vymaz\xe1ny vy\u0161\u0161\xed f\xe1ze")),I.includes("POTVRZENA")&&!qn.stav_stornovano){!0===qn.ma_byt_zverejnena||1===qn.ma_byt_zverejnena?(I.includes("UVEREJNIT")||(I=I.filter(e=>"NEUVEREJNIT"!==e&&"UVEREJNENA"!==e),I.push("UVEREJNIT"),Ic("info","SAVE","workflow-update","P\u0159id\xe1n stav UVEREJNIT (ma_byt_zverejnena = true)")),I.includes("UVEREJNIT")&&qn.dt_zverejneni&&qn.registr_iddt&&(I=I.filter(e=>"UVEREJNIT"!==e),I.includes("UVEREJNENA")||(I.push("UVEREJNENA"),Ic("info","SAVE","workflow-update","Vypln\u011bn registr smluv (datum + IDDT) \u2192 odstran\u011bn UVEREJNIT \u2192 p\u0159id\xe1n UVEREJNENA \u2192 F\xc1ZE 6")))):(I=I.filter(e=>"UVEREJNIT"!==e&&"UVEREJNENA"!==e),I.includes("NEUVEREJNIT")||(I.push("NEUVEREJNIT"),Ic("info","SAVE","workflow-update","P\u0159id\xe1n stav NEUVEREJNIT (ma_byt_zverejnena = ".concat(qn.ma_byt_zverejnena,")"))),I.includes("FAKTURACE")||(I.push("FAKTURACE"),Ic("info","SAVE","workflow-update","P\u0159id\xe1n stav FAKTURACE (automaticky po NEUVEREJNIT) \u2192 \u010dek\xe1 na p\u0159id\xe1n\xed faktury")))}I.includes("POTVRZENA")&&!qn.stav_stornovano||(I=I.filter(e=>!["UVEREJNIT","NEUVEREJNIT","UVEREJNENA"].includes(e)),Ic("info","SAVE","workflow-update","Odebr\xe1ny zve\u0159ej\u0148ovac\xed stavy (nen\xed POTVRZENA nebo je stornov\xe1no)"));const M="pokladna"===(null===(d=qn.financovani)||void 0===d?void 0:d.platba),U="pokladna"===(null===(l=qn.dodavatel_zpusob_potvrzeni)||void 0===l?void 0:l.platba),Z=M||U;Z&&(I.includes("ODESLANA")||I.includes("POTVRZENA")||I.includes("UVEREJNENA")||I.includes("NEUVEREJNIT"))&&!qn.stav_stornovano&&(I.includes("VECNA_SPRAVNOST")||(I.push("VECNA_SPRAVNOST"),Ic("info","SAVE","workflow-update","\ud83c\udfea Re\u017eim POKLADNA \u2192 p\u0159id\xe1n stav VECNA_SPRAVNOST (p\u0159esko\u010deny f\xe1ze 4-6) \u2192 F\xc1ZE 7/8"))),!Z&&qn.faktury&&qn.faktury.length>0&&!qn.stav_stornovano&&(I.includes("FAKTURACE")||(I.push("FAKTURACE"),Ic("info","SAVE","workflow-update","P\u0159id\xe1n stav FAKTURACE (m\xe1 faktury) \u2192 F\xc1ZE 6/8")),I.includes("FAKTURACE")&&!I.includes("VECNA_SPRAVNOST")&&(I.push("VECNA_SPRAVNOST"),Ic("info","SAVE","workflow-update","P\u0159id\xe1n stav VECNA_SPRAVNOST (m\xe1 faktury) \u2192 F\xc1ZE 7/8")));if((qn.faktury||[]).length>0&&(qn.faktury||[]).every(e=>1===e.vecna_spravnost_potvrzeno||!0===e.vecna_spravnost_potvrzeno)&&!qn.stav_stornovano)I.includes("ZKONTROLOVANA")||(I.push("ZKONTROLOVANA"),Ic("info","SAVE","workflow-update","\u2705 V\u0160ECHNY faktury (".concat(qn.faktury.length,"x) maj\xed potvrzenou v\u011bcnou spr\xe1vnost \u2192 p\u0159id\xe1n stav ZKONTROLOVANA \u2192 F\xc1ZE 8/8")));else{const e=I.includes("ZKONTROLOVANA");if(I=I.filter(e=>"ZKONTROLOVANA"!==e),e){const e=(qn.faktury||[]).filter(e=>!(1===e.vecna_spravnost_potvrzeno||!0===e.vecna_spravnost_potvrzeno)).length;Ic("info","SAVE","workflow-update","\ud83d\udd13 NEJSOU potvrzeny v\u0161echny faktury (".concat(e,"x chyb\xed) \u2192 odebr\xe1n stav ZKONTROLOVANA \u2192 n\xe1vrat na F\xc1ZI 7/8"))}}const B=1===qn.potvrzeni_dokonceni_objednavky||!0===qn.potvrzeni_dokonceni_objednavky,K=I.includes("ZKONTROLOVANA");B&&K&&!qn.stav_stornovano?(I.includes("DOKONCENA")||(I.push("DOKONCENA"),Ic("info","SAVE","workflow-update","P\u0159id\xe1n stav DOKONCENA - objedn\xe1vka fin\xe1ln\u011b dokon\u010dena")),qn.dokoncil_id||(O.dokoncil_id=we,O.dt_dokonceni=e(),Ic("info","SAVE","dokonceni","Nastaveno dokon\u010den\xed objedn\xe1vky u\u017eivatelem ".concat(we)))):I=I.filter(e=>"DOKONCENA"!==e),I=[...new Set(I)],I=I.filter(e=>"K_DOKONCENI"!==e),0===I.length&&(I=["NOVA"],Ic("warning","SAVE","workflow-fallback","Pr\xe1zdn\xe9 workflow - fallback na [NOVA]"));const H=["NOVA","ODESLANA_KE_SCHVALENI","CEKA_SE","ZAMITNUTA","SCHVALENA","ROZPRACOVANA","ODESLANA","ZRUSENA","POTVRZENA","UVEREJNIT","NEUVEREJNIT","UVEREJNENA","FAKTURACE","VECNA_SPRAVNOST","ZKONTROLOVANA","DOKONCENA"];if(I.sort((e,n)=>{const a=H.indexOf(e),o=H.indexOf(n);return(-1===a?999:a)-(-1===o?999:o)}),O.stav_workflow_kod=JSON.stringify(I),I.length>0){const e=I[I.length-1],n=Hr[e];if(n)O.stav_objednavky=n.nazev,Ic("info","SAVE","stav-objednavky",'\u2705 Nastaveno stav_objednavky: "'.concat(O.stav_objednavky,'" (z DB \u010d\xedseln\xedku pro workflow: ').concat(e,")"));else{const n=qa[e];O.stav_objednavky=n?n.name:e,Ic("warning","SAVE","stav-objednavky-fallback",'\u26a0\ufe0f \u010c\xedseln\xedk neobsahuje "'.concat(e,'" - pou\u017eit fallback: "').concat(O.stav_objednavky,'"'))}}else O.stav_objednavky="Nov\xe1",Ic("warning","SAVE","stav-objednavky-fallback",'Pr\xe1zdn\xe9 workflow stavy - stav_objednavky: "Nov\xe1"');void 0!==qn.dodavatel_potvrdil_id&&(O.dodavatel_potvrdil_id=qn.dodavatel_potvrdil_id),qn.dt_zverejneni&&qn.registr_iddt?qn.zverejnil_id?O.zverejnil_id=qn.zverejnil_id:(O.zverejnil_id=we,Ic("info","SAVE","registr-tracking","Automaticky nastaven zverejnil_id: ".concat(we))):void 0!==qn.zverejnil_id&&(O.zverejnil_id=qn.zverejnil_id),qn.dt_zverejneni_potvrzeni&&(O.dt_zverejneni_potvrzeni=qn.dt_zverejneni_potvrzeni),O.potvrdil_vecnou_spravnost_id=void 0!==qn.potvrdil_vecnou_spravnost_id?qn.potvrdil_vecnou_spravnost_id:null,O.dt_potvrzeni_vecne_spravnosti=qn.dt_potvrzeni_vecne_spravnosti||null,qn.faktury&&qn.faktury.length>0&&I.includes("FAKTURACE")?(O.fakturant_id=we,O.dt_faktura_pridana=e(),Ic("info","SAVE","fakturace-tracking","Aktualizov\xe1n fakturant_id: ".concat(we,", dt_faktura_pridana: ").concat(O.dt_faktura_pridana))):(void 0!==qn.fakturant_id&&(O.fakturant_id=qn.fakturant_id),qn.dt_faktura_pridana&&(O.dt_faktura_pridana=qn.dt_faktura_pridana)),O.dokoncil_id=void 0!==qn.dokoncil_id?qn.dokoncil_id:null,O.dt_dokonceni=qn.dt_dokonceni||null,O.dokonceni_poznamka=void 0!==qn.dokonceni_poznamka?qn.dokonceni_poznamka:"";const W=qn.potvrzeni_dokonceni_objednavky;if(O.potvrzeni_dokonceni_objednavky=1===W||!0===W?1:0,Ic("info","SAVE","tracking-fields","Workflow tracking pole: dodavatel_potvrdil=".concat(O.dodavatel_potvrdil_id,", zverejnil=").concat(O.zverejnil_id,", vecna_spravnost=").concat(O.potvrdil_vecnou_spravnost_id,", fakturant=").concat(O.fakturant_id,", dokoncil=").concat(O.dokoncil_id)),qn.stav_stornovano&&(qn.storno_uzivatel_id&&(O.storno_uzivatel_id=qn.storno_uzivatel_id),qn.storno_provedl&&(O.storno_provedl=qn.storno_provedl)),qn.stav_odeslano||qn.stav_stornovano){if(!rc){if(!qn.odesilatel_id&&we?(O.odesilatel_id=we,Ic("info","SAVE","odesilatel-tracking-new","Ulo\u017een NOV\xdd odesilatel_id: ".concat(we," (prvn\xed odesl\xe1n\xed/storno)"))):qn.odesilatel_id&&(O.odesilatel_id=qn.odesilatel_id,Ic("info","SAVE","odesilatel-tracking-preserve","ZACHOV\xc1N p\u016fvodn\xed odesilatel_id: ".concat(qn.odesilatel_id))),qn.stav_odeslano&&!qn.stav_stornovano){if(qn.dt_odeslani)O.dt_odeslani=qn.dt_odeslani,Ic("info","SAVE","odeslani-datum-preserve","ZACHOV\xc1NO p\u016fvodn\xed dt_odeslani: ".concat(qn.dt_odeslani));else{const e=qn.datum_odeslani||n();O.dt_odeslani=e,Ic("info","SAVE","odeslani-datum-new","Nastaveno NOV\xc9 dt_odeslani: ".concat(e))}O.odeslani_storno_duvod=""}else if(qn.stav_stornovano){if(qn.dt_odeslani)O.dt_odeslani=qn.dt_odeslani,Ic("info","SAVE","storno-datum-preserve","ZACHOV\xc1NO p\u016fvodn\xed dt_odeslani pro STORNO: ".concat(qn.dt_odeslani));else{const e=qn.datum_storna||n();O.dt_odeslani=e,Ic("info","SAVE","storno-datum-new","Nastaveno NOV\xc9 dt_odeslani pro STORNO: ".concat(e))}qn.odeslani_storno_duvod&&(O.odeslani_storno_duvod=qn.odeslani_storno_duvod),Ic("info","SAVE","storno-datum","Ulo\u017eeno STORNO s d\u016fvodem: ".concat(qn.odeslani_storno_duvod))}}else qn.odesilatel_id&&(O.odesilatel_id=qn.odesilatel_id),qn.dt_odeslani&&(O.dt_odeslani=qn.dt_odeslani),qn.odeslani_storno_duvod&&(O.odeslani_storno_duvod=qn.odeslani_storno_duvod),Ic("info","SAVE","odeslani-locked","F\xc1ZE 3 ZAM\u010cEN\xc1 - workflow data zachov\xe1na beze zm\u011bny")}else O.odesilatel_id=null,Ic("info","SAVE","odesilatel-reset","Vymaz\xe1n odesilatel_id - objedn\xe1vka nen\xed odesl\xe1na ani stornov\xe1na");if(T.includes("POTVRZENA")||I.includes("POTVRZENA")){if(!lc){const e=qn.dodavatel_zpusob_potvrzeni||{},n={potvrzeni:e.potvrzeni||"NE",zpusoby:Array.isArray(e.zpusoby)?e.zpusoby:[],platba:e.platba||""};O.dodavatel_zpusob_potvrzeni=JSON.stringify(n),Ic("info","SAVE","dodavatel-potvrzeni-unlocked","Sekce odem\u010den\xe1 - Ulo\u017eeno: ".concat(O.dodavatel_zpusob_potvrzeni))}else qn.dodavatel_zpusob_potvrzeni_original?O.dodavatel_zpusob_potvrzeni=qn.dodavatel_zpusob_potvrzeni_original:qn.dodavatel_zpusob_potvrzeni&&(O.dodavatel_zpusob_potvrzeni=JSON.stringify(qn.dodavatel_zpusob_potvrzeni)),Ic("info","SAVE","dodavatel-potvrzeni-locked","Sekce zam\u010den\xe1 - Hodnota zachov\xe1na")}else Ic("info","SAVE","dodavatel-potvrzeni-skip","F\xc1ZE 3- - P\u0159esko\u010deno");if(qn.dt_akceptace){const e=String(qn.dt_akceptace);e.includes("T")?O.dt_akceptace=e.split(".")[0].replace("T"," ").replace("Z",""):O.dt_akceptace=e}if(qn.dt_zverejneni){const e=String(qn.dt_zverejneni);e.includes("T")?O.dt_zverejneni=e.split(".")[0].replace("T"," ").replace("Z",""):O.dt_zverejneni=e}qn.registr_iddt&&(O.registr_iddt=qn.registr_iddt);const $=e();let J,G,q,Y;if(O.dt_objednavky=$,os?Ic("info","SAVE","datum-zmeny","UPDATE objedn\xe1vky - dt_objednavky aktualizov\xe1no na: ".concat($)):Ic("info","SAVE","datum-vytvoreni","Nov\xe1 objedn\xe1vka - dt_objednavky: ".concat($)),I.includes("NOVA")||qn.schvalovatel_id&&qn.schvalovatel_id>0&&(O.schvalovatel_id=qn.schvalovatel_id),qn.faktury&&qn.faktury.length>0?(O.faktury=qn.faktury.map((e,n)=>{var a;let o=[];e.fa_strediska_kod&&Array.isArray(e.fa_strediska_kod)&&e.fa_strediska_kod.length>0&&(o=e.fa_strediska_kod.map(e=>"object"===typeof e&&e.kod_stavu?e.kod_stavu:e));return{id:e.id&&!String(e.id).startsWith("temp-")?Number(e.id):null,fa_castka:String(parseFloat(e.fa_castka)||0),fa_cislo_vema:e.fa_cislo_vema||"",fa_dorucena:1,fa_datum_vystaveni:e.fa_datum_vystaveni||(new Date).toISOString().split("T")[0],fa_datum_splatnosti:e.fa_splatnost||e.fa_datum_splatnosti||"",fa_datum_doruceni:"string"===typeof e.fa_datum_doruceni&&e.fa_datum_doruceni.match(/^\d{4}-\d{2}-\d{2}$/)?e.fa_datum_doruceni:(new Date).toISOString().split("T")[0],fa_strediska_kod:o,fa_poznamka:e.fa_poznamka||"",vecna_spravnost_umisteni_majetku:e.vecna_spravnost_umisteni_majetku||"",vecna_spravnost_poznamka:e.vecna_spravnost_poznamka||"",vecna_spravnost_potvrzeno:1===e.vecna_spravnost_potvrzeno||!0===e.vecna_spravnost_potvrzeno?1:0,potvrdil_vecnou_spravnost_id:e.potvrdil_vecnou_spravnost_id||null,dt_potvrzeni_vecne_spravnosti:e.dt_potvrzeni_vecne_spravnosti||null,rozsirujici_data:e._isPokladna?{typ_platby:"pokladna",pokladni_doklad:{datum_vytvoreni:e.dt_vytvoreni||(new Date).toISOString(),poznamka:e.fa_poznamka||"",prilohy_count:(null===(a=e.attachments)||void 0===a?void 0:a.length)||0,vytvoril_uzivatel_id:e.vytvoril_uzivatel_id,vytvoril_jmeno:e.vytvoril_jmeno}}:e._fromISDOC&&e._isdoc_polozky?{typ_platby:"faktura",isdoc:{cislo_faktury:e.fa_cislo_vema,datum_vystaveni:e.fa_datum_vystaveni,datum_splatnosti:e.fa_datum_splatnosti,castka_s_dph:e.fa_castka,castka_bez_dph:e.fa_castka_bez_dph,dph_celkem:e.fa_dph,polozky:e._isdoc_polozky,dodavatel:e._isdoc_dodavatel}}:{typ_platby:"faktura"}}}),Ic("info","SAVE","faktury-transform","P\u0159id\xe1no ".concat(qn.faktury.length," faktur do payload")),Ic("info","SAVE","faktury-detail","Detaily faktur: ".concat(JSON.stringify(qn.faktury,null,2)))):(O.faktury=[],Ic("info","SAVE","faktury-empty","\u017d\xe1dn\xe9 faktury k ulo\u017een\xed")),P){var c,p,u;const e=qn.stav_workflow_kod;Ic("info","SAVE-V2","update-start","Volam updateOrderV2(".concat(qn.id,")")),O.faktury&&O.faktury.length,J=await(0,La.qA)(qn.id,O,Ee,Se),Ic("info","SAVE-V2","update-success","Order ".concat(qn.id," updated")),Ic("info","DB-RESPONSE","UPDATE-complete",{orderId:J.id,orderNumber:J.cislo_objednavky||J.ev_cislo,workflow:J.stav_workflow_kod,fieldsCount:Object.keys(J).length,polozky:(null===(c=J.polozky)||void 0===c?void 0:c.length)||0,faktury:(null===(p=J.faktury)||void 0===p?void 0:p.length)||0});try{const n=qn.ev_cislo||qn.cislo_objednavky||qn.id;await $c(qn.id,0,J.stav_workflow_kod,e,qn);const a=ca(J.stav_workflow_kod,"ODESLANA_KE_SCHVALENI"),o=!!e&&ca(e,"ODESLANA_KE_SCHVALENI");if(a&&!o)try{const e=(qn.strediska_kod||[]).map(e=>{const n=Fr.find(n=>n.value===e);return n?n.label:e});await(0,Ga.triggerNotification)("order_status_ke_schvaleni",qn.id,we||qn.objednatel_id,{order_number:n,order_subject:qn.predmet||"",commander_id:qn.prikazce_id,garant_id:qn.garant_uzivatel_id,creator_id:qn.objednatel_id,supplier_name:qn.dodavatel_nazev||"Neuvedeno",financovani_json:JSON.stringify(O.financovani||{}),strediska_names:e,max_price_with_dph:qn.max_cena_s_dph||0,is_urgent:qn.mimoradna_udalost||!1}),Ic("success","NOTIFICATION","trigger-sent","Org-hierarchy notifikace triggernuta pro objedn\xe1vku ".concat(n))}catch(A){Ic("warning","NOTIFICATION","trigger-error","Chyba p\u0159i trigger notifikaci: ".concat(A.message))}}catch(w){}const n=J,a=J.stav_workflow_kod,o=(ca(a,"ODESLANA"),ca(a,"ZRUSENA"),Cc(J));o.strediska_kod&&Array.isArray(o.strediska_kod)&&(o.strediska_kod=Ec(o.strediska_kod,Fr));const i=(0,t.A)({},o);Ic("success","UPDATE","data-transformed","Data transformov\xe1na: strediska=".concat((null===(u=i.strediska_kod)||void 0===u?void 0:u.join(", "))||"none",", financovani=").concat(i.zpusob_financovani||"none"));const r=(()=>{try{const e=Array.isArray(a)?a:JSON.parse(a||'["NOVA"]'),n=e[e.length-1],o=qa[n];return(null===o||void 0===o?void 0:o.name)||n||"Nov\xe1"}catch(e){return"Nov\xe1"}})();if(i.stav_objednavky=r,i.dodavatel_zpusob_potvrzeni&&"object"===typeof i.dodavatel_zpusob_potvrzeni){const e=i.dodavatel_zpusob_potvrzeni;if(i.dodavatel_zpusob_potvrzeni_original=JSON.stringify(e),void 0!==e.potvrzeni)i.dodavatel_zpusob_potvrzeni={potvrzeni:e.potvrzeni||"NE",zpusoby:Array.isArray(e.zpusoby)?e.zpusoby:[],platba:e.platba||""},Ic("info","UPDATE","normalize-potvrzeni-ok","Normalizov\xe1n dodavatel_zpusob_potvrzeni (u\u017e spr\xe1vn\xfd form\xe1t): ".concat(JSON.stringify(i.dodavatel_zpusob_potvrzeni)));else if(void 0!==e.potvrzeno)i.dodavatel_zpusob_potvrzeni={potvrzeni:e.potvrzeno?"ANO":"NE",zpusoby:e.zpusob||e.zpusob_potvrzeni||[],platba:e.platba||e.zpusob_platby||""},Ic("info","UPDATE","transform-potvrzeni-old","Transformov\xe1n dodavatel_zpusob_potvrzeni (star\xfd BE form\xe1t): ".concat(JSON.stringify(i.dodavatel_zpusob_potvrzeni)));else if(void 0!==e.zpusob||void 0!==e.zpusoby){const n=!(!i.dt_akceptace||!i.dodavatel_potvrdil_id);i.dodavatel_zpusob_potvrzeni={potvrzeni:n?"ANO":"NE",zpusoby:e.zpusoby||e.zpusob||e.zpusob_potvrzeni||[],platba:e.platba||e.zpusob_platby||""},Ic("info","UPDATE","transform-potvrzeni-fallback","Transformov\xe1n dodavatel_zpusob_potvrzeni (fallback z dt_akceptace): ".concat(JSON.stringify(i.dodavatel_zpusob_potvrzeni)))}}const s=i.faktury?await Promise.all(i.faktury.map(async e=>{var n;const a=null===(n=e.rozsirujici_data)||void 0===n?void 0:n.isdoc;let o=[];try{Array.isArray(e.fa_strediska_kod)?o=e.fa_strediska_kod:"string"===typeof e.fa_strediska_kod&&(o=JSON.parse(e.fa_strediska_kod||"[]")),o=o.map(e=>"string"===typeof e?e:e.kod_stavu||e.value||e.id||e)}catch(s){o=[]}let i=[];if(e.id&&!String(e.id).startsWith("temp-"))try{var r;const n=await(0,La.CX)(e.id,Se,Ee,qn.id);i=(null===(r=n.data)||void 0===r?void 0:r.attachments)||n.data||[],console.log("\ud83d\udd0d [OrderForm25] Na\u010dteny p\u0159\xedlohy faktury ID=".concat(e.id,":"),i)}catch(d){console.error("\u274c [OrderForm25] Chyba p\u0159i na\u010d\xedt\xe1n\xed p\u0159\xedloh faktury ID=".concat(e.id,":"),d)}return(0,t.A)((0,t.A)({},e),{},{fa_dorucena:e.fa_datum_doruceni?1:0,fa_splatnost:e.fa_splatnost||(e.fa_datum_splatnosti?e.fa_datum_splatnosti.split(" ")[0]:""),fa_strediska_kod:o,attachments:i,fa_datum_doruceni:e.fa_datum_doruceni,fa_datum_splatnosti:e.fa_datum_splatnosti,fa_datum_vystaveni:e.fa_datum_vystaveni},a?{_isdoc_polozky:a.polozky,_isdoc_dodavatel:a.dodavatel,_fromISDOC:!0}:{})})):[];Xn(e=>(0,t.A)((0,t.A)((0,t.A)({},e),i),{},{stav_workflow_kod:a,objednatel_id:e.objednatel_id||i.objednatel_id,jmeno:e.jmeno||i.jmeno,email:e.email||i.email,telefon:e.telefon||i.telefon,faktury:s.length>0?s:e.faktury})),Ic("success","UPDATE","formdata-updated","FormData aktualizov\xe1n: workflow=".concat(a,", strediska=").concat(i.strediska_kod.join(", ")));try{var v;const e=await(0,La.getOrderV2)(qn.id,Ee,Se,!0);if(null!==e&&void 0!==e&&null!==(v=e.financovani)&&void 0!==v&&v.lp_nazvy&&Array.isArray(e.financovani.lp_nazvy)){const n=e.financovani.lp_nazvy.map(e=>({id:e.id,kod:e.cislo_lp||e.kod||"LP".concat(e.id),nazev:e.nazev||"Bez n\xe1zvu",kategorie:e.kategorie,limit:e.limit||e.celkovy_limit,cerpano:e.cerpano||e.skutecne_cerpano,zbyva:e.zbyva||e.zbyva_skutecne,rok:e.rok,label:"".concat(e.cislo_lp||e.kod||"LP".concat(e.id)," - ").concat(e.nazev||"Bez n\xe1zvu")})).sort((e,n)=>e.nazev.localeCompare(n.nazev,"cs"));wr(n),Ic("success","UPDATE","lp-options-reloaded","LP options na\u010dteny z GET po UPDATE: ".concat(n.length))}else Ic("warning","UPDATE","lp-options-missing","Enriched data neobsahuj\xed financovani.lp_nazvy")}catch(S){Ic("error","UPDATE","lp-options-reload-failed","Chyba p\u0159i reload LP options: ".concat(S.message))}if(qn.cislo_smlouvy&&aa>=7)try{await(0,Ba.SJ)({token:Ee,username:Se,cislo_smlouvy:qn.cislo_smlouvy}),Ic("success","SMLOUVA","prepocet-ok","P\u0159epo\u010det \u010derp\xe1n\xed smlouvy ".concat(qn.cislo_smlouvy," \xfasp\u011b\u0161n\xfd"))}catch(z){Ic("warning","SMLOUVA","prepocet-error","Chyba p\u0159i p\u0159epo\u010dtu smlouvy: ".concat(z.message))}window.__workflowStateUpdated=!0,ma(),na.resetAllUnlocks();const d=function(e,n){return n?ca(e,"DOKONCENA")||ca(e,"ZKONTROLOVANA")?10:ca(e,"VECNA_SPRAVNOST")?9:ca(e,"FAKTURACE")?8:ca(e,"UVEREJNENA")?7:ca(e,"NEUVEREJNIT")?8:ca(e,"UVEREJNIT")?6:ca(e,"POTVRZENA")?5:ca(e,"ODESLANA")?4:ca(e,"SCHVALENA")||ca(e,"ROZPRACOVANA")?3:ca(e,"ODESLANA_KE_SCHVALENI")||ca(e,"CEKA_SE")?2:1:1}(a,i.id||qn.id,i);Ic("info","UPDATE","phase-refreshed","\u2728 F\xe1ze EXPLICITN\u011a p\u0159epo\u010d\xedt\xe1na: ".concat(d,"/10, workflow: ").concat(a));try{var _;Ia.default.setCurrentUser(we);const e=(0,t.A)((0,t.A)((0,t.A)({},n),i),{},{polozky_objednavky:n.polozky_objednavky||[],faktury:s.length>0?s:n.faktury||[],objednatel_id:n.objednatel_id||i.objednatel_id,jmeno:n.jmeno||i.jmeno,email:n.email||i.email,telefon:n.telefon||i.telefon,zpusob_financovani:i.zpusob_financovani||qn.zpusob_financovani||n.zpusob_financovani,lp_kod:i.lp_kod||qn.lp_kod||n.lp_kod,cislo_smlouvy:i.cislo_smlouvy||qn.cislo_smlouvy||n.cislo_smlouvy,smlouva_poznamka:i.smlouva_poznamka||qn.smlouva_poznamka||n.smlouva_poznamka,individualni_schvaleni:i.individualni_schvaleni||qn.individualni_schvaleni||n.individualni_schvaleni,individualni_poznamka:i.individualni_poznamka||qn.individualni_poznamka||n.individualni_poznamka,pojistna_udalost_cislo:i.pojistna_udalost_cislo||qn.pojistna_udalost_cislo||n.pojistna_udalost_cislo,pojistna_udalost_poznamka:i.pojistna_udalost_poznamka||qn.pojistna_udalost_poznamka||n.pojistna_udalost_poznamka});await Ia.default.saveDraft(e,{step:ra(),attachments:un,metadata:{version:"1.4",isConceptSaved:!0,isOrderSavedToDB:!0,savedOrderId:qn.id,isChanged:!1,dictionaries:{approvers:Yr||[],users:Rr||[],strediska:Fr||[],financovani:Mr||[],druhyObjednavky:Ur||[],lpKody:Zr||[]}}}),Ic("success","UPDATE","draft-updated","Draft aktualizov\xe1n s PARSOVAN\xddMI DB daty (workflow: ".concat(a,", strediska: ").concat(i.strediska_kod.join(", "),", polo\u017eky: ").concat((null===(_=e.polozky_objednavky)||void 0===_?void 0:_.length)||0,", financov\xe1n\xed: ").concat(e.zpusob_financovani||"none",")")),Qn.current=JSON.parse(JSON.stringify(e)),wa({isEditMode:!0,orderId:qn.id,orderNumber:qn.ev_cislo||qn.cislo_objednavky}),Ic("success","UPDATE","broadcast","Broadcast stavu odesl\xe1n (isEditMode: true, orderId: ".concat(qn.id,")"))}catch(z){Ic("error","UPDATE","draft-update-error","Chyba p\u0159i aktualizaci draftu: ".concat(z.message))}Ic("success","UPDATE","workflow-update","Workflow stav aktualizov\xe1n: ".concat(a)),Ic("success","UPDATE","workflow-state","DB stav: ".concat(a," - f\xe1ze se p\u0159epo\u010d\xedt\xe1 automaticky"));const l=ca(a,"SCHVALENA");Ic("info","UPDATE","phase-check","M\xe1 SCHVALENA: ".concat(l,", nov\xe1 f\xe1ze by m\u011bla b\xfdt: ").concat(l?"2":"1")),ca(a,"SCHVALENA")?(as(!1),Ic("info","UPDATE","lock-sections","F\xc1ZE 1 sekce zam\u010deny - objedn\xe1vka je schv\xe1len\xe1")):Ic("info","UPDATE","keep-unlocked-phase1","F\xc1ZE 1 sekce z\u016fst\xe1vaj\xed odem\u010den\xe9 - stav: ".concat(a));ca(a,"ODESLANA"),ca(a,"ZRUSENA");Ic("success","UPDATE","direct-lock-check","P\u0159\xedm\xe9 zamyk\xe1n\xed F\xc1ZE 2. Nov\xfd stav: ".concat(a));if(ca(a,"ODESLANA")||ca(a,"ZRUSENA")){let e=!1;try{const n=Ia.default.getUIState();if(n){const a=qn.id;a&&n.phase2OrderId===a&&!0===n.phase2Unlocked&&(e=!0)}}catch(E){Ic("warning","UPDATE","unlock-check-error","Chyba p\u0159i kontrole Phase 2 unlock stavu: ".concat(E.message))}e?Ic("info","UPDATE","phase2-keep-unlocked","F\xc1ZE 2 z\u016fst\xe1v\xe1 ODEM\u010cENA - byla ru\u010dn\u011b odem\u010dena"):Cn(!1)}No(!1);const m=J.id||qn.id||qn.id;Ic("info","AUTOSAVE","skip-duplicate","Autosave p\u0159esko\u010den - ji\u017e proveden p\u0159es DraftManager.syncWithDatabase()"),ya(!1);const f=!C,h=qn.ev_cislo||qn.cislo_objednavky||qn.id;if(f){if(oi(!0),Ra.current=!0,$n(!1),es(!1),we){Ia.default.setCurrentUser(we);await Ia.default.deleteAllDraftKeys()&&Ic("success","UPDATE","draftmanager-delete","V\u0161echny kl\xed\u010de smaz\xe1ny p\u0159es DraftManager")}try{Ta.A.invalidate(we),Ic("success","UPDATE","cache-invalidation","Cache invalidov\xe1na p\u0159ed navigac\xed")}catch(E){Ic("error","UPDATE","cache-invalidation-error","Chyba p\u0159i invalidaci cache: ".concat(E.message))}await Wc(h,m)}else oi(!1),Ra.current=!1,Ia.default.setAutosaveEnabled(!0,"SUPERADMIN/ADMIN stays on form after UPDATE"),Ic("info","UPDATE","stay-on-form","SUPERADMIN/ADMIN z\u016fst\xe1v\xe1 na formul\xe1\u0159i - koncept NEN\xcd smaz\xe1n"),ze&&ze("\u2705 Objedn\xe1vka \xfasp\u011b\u0161n\u011b aktualizov\xe1na\n\ud83d\udccb "+h+"\n\ud83d\udcbe Zm\u011bny ulo\u017eeny","success"),Ic("info","UPDATE","stay-in-place","Z\u016fsta\u0148 na stejn\xe9 pozici po ulo\u017een\xed")}else{var m,f,h,k,g,b,y;if(Ic("info","SAVE-V2","create-start","Vol\xe1m createOrderV2()"),1===aa){const e=["uzivatel_id","objednatel_id","predmet","garant_uzivatel_id","prikazce_id","strediska_kod","max_cena_s_dph","financovani","druh_objednavky_kod","stav_workflow_kod","stav_objednavky","dt_objednavky","mimoradna_udalost"];Object.keys(O).forEach(n=>{e.includes(n)||delete O[n]})}J=await(0,La.VR)(O,Ee,Se),Ic("info","SAVE-V2","create-success","Order created: ID ".concat(J.id)),Y=J,G=J.id,q=J.ev_cislo||J.cislo_objednavky||qn.ev_cislo,q||Ic("error","SAVE-V2","missing-ev-cislo","Backend nevr\xe1til evide\u010dn\xed \u010d\xedslo objedn\xe1vky");const e=J.faktury||[];let n=[];if(e&&Array.isArray(e)&&e.length>0){const a=qn.faktury||[];n=await Promise.all(e.map(async e=>{var n;let o=[];const r=a.find(n=>String(n.id)===String(e.id)||n.fa_cislo_vema===e.fa_cislo_vema);if(r&&r.attachments&&r.attachments.length>0)o=r.attachments;else if(e.id&&!String(e.id).startsWith("temp-"))try{var s;const n=await(0,La.CX)(e.id,Se,Ee,i.id);o=(null===(s=n.data)||void 0===s?void 0:s.attachments)||n.data||[]}catch(c){}const d=null===(n=e.rozsirujici_data)||void 0===n?void 0:n.isdoc;let l=[];try{Array.isArray(e.fa_strediska_kod)?l=e.fa_strediska_kod:"string"===typeof e.fa_strediska_kod&&(l=JSON.parse(e.fa_strediska_kod||"[]")),l=l.map(e=>{if("object"===typeof e&&e.kod_stavu){if(Fr.find(n=>n.kod_stavu===e.kod_stavu||n.kod===e.kod_stavu||n.value===e.kod_stavu))return e;const n=Fr.find(e=>"100"===e.kod_stavu||"100"===e.kod||"100"===e.value);return n?{kod_stavu:n.kod_stavu||n.kod||n.value,nazev_stavu:n.nazev_stavu||n.nazev||n.label}:{kod_stavu:"100",nazev_stavu:"100 Spr\xe1va Kladno"}}const n=Fr.find(n=>n.kod_stavu===e||n.kod===e||n.value===e);if(n)return{kod_stavu:n.kod_stavu||n.kod||n.value,nazev_stavu:n.nazev_stavu||n.nazev||n.label};const a=Fr.find(e=>"100"===e.kod_stavu||"100"===e.kod||"100"===e.value);return a?{kod_stavu:a.kod_stavu||a.kod||a.value,nazev_stavu:a.nazev_stavu||a.nazev||a.label}:{kod_stavu:"100",nazev_stavu:"100 Spr\xe1va Kladno"}})}catch(E){l=[]}return(0,t.A)((0,t.A)({},e),{},{fa_dorucena:e.fa_datum_doruceni?1:0,fa_splatnost:e.fa_splatnost||(e.fa_datum_splatnosti?e.fa_datum_splatnosti.split(" ")[0]:""),fa_strediska_kod:l,attachments:o,fa_datum_doruceni:e.fa_datum_doruceni,fa_datum_splatnosti:e.fa_datum_splatnosti,fa_datum_vystaveni:e.fa_datum_vystaveni},d?{_isdoc_polozky:d.polozky,_isdoc_dodavatel:d.dodavatel,_fromISDOC:!0}:{})})),Xn(e=>(0,t.A)((0,t.A)({},e),{},{faktury:n})),Ic("success","SAVE","faktury-updated","Faktury aktualizov\xe1ny s re\xe1ln\xfdmi ID z DB (".concat(e.length,") v\u010detn\u011b p\u0159\xedloh"))}try{var x;let e=(null===(x=J)||void 0===x?void 0:x.stav_workflow_kod)||O.stav_workflow_kod;if("string"===typeof e&&e.startsWith("["))try{e=JSON.parse(e)}catch(E){}if(await $c(G,0,e,null,qn),ca(e,"ODESLANA_KE_SCHVALENI"))try{const e=(qn.strediska_kod||[]).map(e=>{const n=Fr.find(n=>n.value===e);return n?n.label:e});await(0,Ga.triggerNotification)("order_status_ke_schvaleni",G,we||qn.objednatel_id,{order_number:q,order_subject:qn.predmet||"",commander_id:qn.prikazce_id,garant_id:qn.garant_uzivatel_id,creator_id:qn.objednatel_id,supplier_name:qn.dodavatel_nazev||"Neuvedeno",financovani_json:JSON.stringify(O.financovani||{}),strediska_names:e,max_price_with_dph:qn.max_cena_s_dph||0,is_urgent:qn.mimoradna_udalost||!1}),Ic("success","NOTIFICATION","trigger-sent-new","Org-hierarchy notifikace triggernuta pro novou objedn\xe1vku ".concat(q))}catch(A){Ic("warning","NOTIFICATION","trigger-error-new","Chyba p\u0159i trigger notifikaci: ".concat(A.message))}}catch(w){Ic("warning","SAVE","notification-error","Chyba p\u0159i odes\xedl\xe1n\xed notifikace: ".concat(w.message))}const a=!C;Y=J,G=J.id,q=J.ev_cislo||J.cislo_objednavky;const o=Cc(J);o.strediska_kod&&Array.isArray(o.strediska_kod)&&(o.strediska_kod=Ec(o.strediska_kod,Fr));const i=(0,t.A)((0,t.A)({},o),{},{id:G,ev_cislo:q});if(Ic("success","INSERT","data-transformed","Data transformov\xe1na: strediska=".concat((null===(m=i.strediska_kod)||void 0===m?void 0:m.join(", "))||"none",", financovani=").concat(i.zpusob_financovani||"none")),Xn(e=>(0,t.A)((0,t.A)((0,t.A)({},e),i),{},{faktury:n&&n.length>0?n:i.faktury||e.faktury})),Ic("success","INSERT","formdata-updated","FormData aktualizov\xe1n: id=".concat(G,", strediska=").concat((null===(f=i.strediska_kod)||void 0===f?void 0:f.join(", "))||"none",", faktury s p\u0159\xedlohami: ").concat((null===(h=n)||void 0===h?void 0:h.length)||0)),null!==(k=J.financovani)&&void 0!==k&&k.lp_nazvy&&Array.isArray(J.financovani.lp_nazvy)){const e=J.financovani.lp_nazvy.map(e=>({id:e.id,kod:e.cislo_lp||e.kod||"LP".concat(e.id),nazev:e.nazev||"Bez n\xe1zvu",kategorie:e.kategorie,limit:e.limit||e.celkovy_limit,cerpano:e.cerpano||e.skutecne_cerpano,zbyva:e.zbyva||e.zbyva_skutecne,rok:e.rok,label:"".concat(e.cislo_lp||e.kod||"LP".concat(e.id)," - ").concat(e.nazev||"Bez n\xe1zvu")})).sort((e,n)=>e.nazev.localeCompare(n.nazev,"cs"));wr(e),Ic("success","INSERT","lp-options-loaded","LP options na\u010dteny z financovani.lp_nazvy: ".concat(e.length))}if(ma(),na.resetAllUnlocks(),a){if(oi(!0),Ra.current=!0,$n(!1),es(!1),we){Ia.default.setCurrentUser(we);await Ia.default.deleteAllDraftKeys()&&Ic("success","INSERT","draftmanager-delete","V\u0161echny kl\xed\u010de smaz\xe1ny p\u0159es DraftManager")}try{Ta.A.invalidate(we),Ic("success","INSERT","cache-invalidation","Cache invalidov\xe1na p\u0159ed navigac\xed")}catch(E){Ic("error","INSERT","cache-invalidation-error","Chyba p\u0159i invalidaci cache: ".concat(E.message))}await Wc(q,G)}else{oi(!1),Ra.current=!1,Ia.default.setAutosaveEnabled(!0,"SUPERADMIN/ADMIN stays on form after INSERT");try{Ia.default.setCurrentUser(we),await Ia.default.saveDraft(Y,{step:ra(),attachments:un,metadata:{version:"1.4",isConceptSaved:!0,isOrderSavedToDB:!0,savedOrderId:G,isChanged:!1,dictionaries:{approvers:Yr||[],users:Rr||[],strediska:Fr||[],financovani:Mr||[],druhyObjednavky:Ur||[],lpKody:Zr||[]}}}),Ic("success","INSERT","admin-draft-saved","Draft ulo\u017een pro ADMIN po INSERT")}catch(z){Ic("error","INSERT","admin-draft-error","Chyba p\u0159i ukl\xe1d\xe1n\xed draftu pro ADMIN: ".concat(z.message))}if(Ic("info","SAVE","stay-on-form","SUPERADMIN/ADMIN z\u016fst\xe1v\xe1 na formul\xe1\u0159i - koncept NEN\xcd smaz\xe1n, formul\xe1\u0159 v edit re\u017eimu"),ze){ze(!os?"\u2705 Objednavka uspesne vytvorena\n\ud83d\udccb "+q+"\n\ud83d\udcbe Databaze aktualizovana":"\u2705 Objednavka uspesne aktualizovana\n\ud83d\udccb "+q+"\n\ud83d\udcbe Zmeny ulozeny","success")}Ic("info","INSERT","stay-in-place","Zustan na stejne pozici po ulozeni")}if(ya(!1),qn.cislo_smlouvy&&aa>=7)try{await(0,Ba.SJ)({token:Ee,username:Se,cislo_smlouvy:qn.cislo_smlouvy}),Ic("success","SMLOUVA","prepocet-ok","P\u0159epo\u010det \u010derp\xe1n\xed smlouvy ".concat(qn.cislo_smlouvy," \xfasp\u011b\u0161n\xfd"))}catch(z){Ic("warning","SMLOUVA","prepocet-error","Chyba p\u0159i p\u0159epo\u010dtu smlouvy: ".concat(z.message))}Ic("info","DB-RESPONSE","INSERT-complete",{orderId:G,orderNumber:q,workflow:J.stav_workflow_kod,fieldsCount:Object.keys(J).length,polozky:(null===(g=J.polozky)||void 0===g?void 0:g.length)||0,faktury:(null===(b=J.faktury)||void 0===b?void 0:b.length)||0});const r=J.stav_workflow_kod;ca(r,"ODESLANA"),ca(r,"ZRUSENA");try{var j;Ia.default.setCurrentUser(we);const e=(0,t.A)((0,t.A)((0,t.A)({},Y),i),{},{polozky_objednavky:Y.polozky_objednavky||[],faktury:Y.faktury||[],objednatel_id:i.objednatel_id||Y.objednatel_id,jmeno:i.jmeno||Y.jmeno,email:i.email||Y.email,telefon:i.telefon||Y.telefon});await Ia.default.saveDraft(e,{step:ra(),attachments:un,metadata:{version:"1.4",isConceptSaved:!0,isOrderSavedToDB:!0,savedOrderId:G,isChanged:!1,dictionaries:{approvers:Yr||[],users:Rr||[],strediska:Fr||[],financovani:Mr||[],druhyObjednavky:Ur||[],lpKody:Zr||[]}}}),Ic("success","INSERT","draft-updated","Draft aktualizov\xe1n s PARSOVAN\xddMI DB daty (workflow: ".concat(r,", strediska: ").concat(i.strediska_kod.join(", "),", polo\u017eky: ").concat((null===(j=e.polozky_objednavky)||void 0===j?void 0:j.length)||0,", financov\xe1n\xed: ").concat(e.zpusob_financovani||"none",")")),Qn.current=JSON.parse(JSON.stringify(e)),wa({isEditMode:!0,orderId:G,orderNumber:q}),Ic("success","INSERT","broadcast","Broadcast stavu odesl\xe1n (isEditMode: true, orderId: ".concat(G,")"))}catch(z){Ic("error","INSERT","draft-update-error","Chyba p\u0159i aktualizaci draftu: ".concat(z.message))}const s=J.stav_workflow_kod;Ic("success","SAVE","order-status","Objedn\xe1vka ozna\u010dena jako ulo\u017een\xe1. ID: ".concat(G,", EV: ").concat(q,", DB stav: ").concat(s)),Ic("success","SAVE","workflow-state","DB stav: ".concat(s," - f\xe1ze se p\u0159epo\u010d\xedt\xe1 automaticky")),ca(s,"SCHVALENA")?(as(!1),Ic("info","SAVE","lock-sections","F\xc1ZE 1 sekce zam\u010deny - objedn\xe1vka je schv\xe1len\xe1")):Ic("info","SAVE","keep-unlocked-phase1","F\xc1ZE 1 sekce z\u016fst\xe1vaj\xed odem\u010den\xe9 - stav: ".concat(s));ca(s,"ODESLANA"),ca(s,"ZRUSENA");Ic("success","SAVE","no-ui-refresh","Bez UI refresh - p\u0159\xedmo zamyk\xe1n\xed. Nov\xfd stav: ".concat(s));if(ca(s,"ODESLANA")||ca(s,"ZRUSENA")){let e=!1;try{const n=Ia.default.getUIState();if(n){const a=qn.id;a&&n.phase2OrderId===a&&!0===n.phase2Unlocked&&(e=!0)}}catch(E){Ic("warning","SAVE","unlock-check-error","Chyba p\u0159i kontrole Phase 2 unlock stavu: ".concat(E.message))}e?Ic("info","SAVE","phase2-keep-unlocked","F\xc1ZE 2 z\u016fst\xe1v\xe1 ODEM\u010cENA - byla ru\u010dn\u011b odem\u010dena"):Cn(!1)}No(!1);(0,t.A)((0,t.A)({},qn),{},{id:G,ev_cislo:q,stav_workflow_kod:s},(null===(y=J)||void 0===y?void 0:y.dt_schvaleni)&&{dt_schvaleni:J.dt_schvaleni});const d=ca(s,"SCHVALENA");Ic("info","INSERT","phase-check","M\xe1 SCHVALENA: ".concat(d,", nov\xe1 f\xe1ze by m\u011bla b\xfdt: ").concat(d?"2":"1")),Xn(e=>{var n;const a=(()=>{try{const e=Array.isArray(s)?s:JSON.parse(s||'["NOVA"]'),n=e[e.length-1],a=qa[n];return(null===a||void 0===a?void 0:a.name)||n||"Nov\xe1"}catch(E){return"Nov\xe1"}})();return(0,t.A)((0,t.A)((0,t.A)({},e),{},{id:G,ev_cislo:q,stav_workflow_kod:s,stav_objednavky:a},(null===(n=J)||void 0===n?void 0:n.dt_schvaleni)&&{dt_schvaleni:J.dt_schvaleni}),{},{strediska_kod:i.strediska_kod})}),Ic("info","AUTOSAVE","skip-duplicate-insert","Autosave p\u0159esko\u010den - ji\u017e proveden p\u0159es DraftManager.syncWithDatabase()"),!C&&we?(Ia.default.setCurrentUser(we),await Ia.default.deleteDraft(),Ic("info","DRAFT","delete-after-create","Draft smaz\xe1n po \xfasp\u011b\u0161n\xe9m CREATE p\u0159es DraftManager (b\u011b\u017en\xfd u\u017eivatel)")):C&&Ic("info","DRAFT","keep-after-create","Draft ZACHOV\xc1N po CREATE - SUPERADMIN/ADMIN z\u016fst\xe1v\xe1 na formul\xe1\u0159i")}}catch(z){const e=os&&qn.id?"order-v2/update":"order-v2/create";if(Ic("error","API",e,z.message),z.lock_info){const e=z.lock_info;if(!0===e.locked){const n=e.locked_by_user_fullname||"u\u017eivatel #".concat(e.locked_by_user_id),a=e.lock_age_minutes?" (zam\u010deno p\u0159ed ".concat(e.lock_age_minutes," minutami)"):"";ze&&ze("Nelze ulo\u017eit zm\u011bny. Objedn\xe1vka je zam\u010dena u\u017eivatelem ".concat(n).concat(a),{type:"error"}),Ic("error","LOCK","order-locked-by-other","Objedn\xe1vka zam\u010dena u\u017eivatelem ".concat(n))}else{const e=(0,ao.g)(z.message);ze&&ze("Nepoda\u0159ilo se ulo\u017eit objedn\xe1vku: ".concat(e),{type:"error"}),Ic("info","LOCK","order-owned-by-me","Lock info p\u0159\xedtomen, ale locked=false (moje objedn\xe1vka)")}}else{const e=(0,ao.g)(z.message);ze&&ze("Nepoda\u0159ilo se ulo\u017eit objedn\xe1vku: ".concat(e),{type:"error"})}oi(!1),Ra.current=!1,Ia.default.setAutosaveEnabled(!0,"Error during save - re-enable autosave"),ei(!1)}finally{De(),ni(!1),window.__workflowStateUpdated?(Ic("info","SAVE","waiting-for-workflow","\u010cek\xe1m na propagaci workflow state do React..."),setTimeout(()=>{Ic("info","SAVE","workflow-propagated","Workflow state propagov\xe1n, resetuji isSaving"),window.__workflowStateUpdated=!1,ei(!1),Ic("info","SAVE","finally-cleanup","isSaving resetov\xe1no po workflow update")},200)):(Ic("info","SAVE","no-workflow-update","Workflow nebyl aktualizov\xe1n, resetuji isSaving hned"),setTimeout(()=>{ei(!1),Ic("info","SAVE","finally-cleanup","isSaving resetov\xe1no bez workflow update")},100));try{Ic("info","SAVE","cache-invalidation","Invaliduji orders cache..."),Ta.A.invalidate(we)}catch(E){}try{Ic("info","SAVE","background-refresh","Spou\u0161t\xedm postOrderAction background task..."),Da.A.runTaskNow("postOrderAction")}catch(E){}try{qn.ev_cislo||qn.cislo_objednavky,qn.id||qn.id}catch(E){}}},Gc=async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{isAutoSave:a=!1,explicitSavedOrderId:i,attachmentsToSave:r=un,isAfterDbSave:s=!1}=n;if(!we)return a||ze&&ze("Nelze ulo\u017eit koncept - nejste p\u0159ihl\xe1\u0161en",{type:"error"}),!1;if(a&&!Ia.default.isAutosaveEnabled())return!1;if("Na\u010d\xedt\xe1m..."===e.ev_cislo)return!1;try{a?si(!0):ni(!0),Ia.default.setCurrentUser(we);const n=await Ia.default.hasDraft();let l=null;if(!n&&a)l=(new Date).toISOString(),wa({isEditMode:!1,isNewOrder:!1,orderId:null,orderNumber:"",hasDraft:!0,currentPhase:aa,mainWorkflowState:ia});else if(n)try{const e=await Ia.default.loadDraft();l=(null===e||void 0===e?void 0:e.firstAutoSaveDate)||(new Date).toISOString()}catch(d){l=(new Date).toISOString()}const c=(0,t.A)({},e);if("object"===typeof c.financovani&&null!==c.financovani){Ic("warning","DRAFT","deprecated-financovani-block","\u26a0\ufe0f DEPRECATED blok se spustil - m\u011bl by b\xfdt mrtv\xfd k\xf3d!");const n={typ_financovani:e.typ_financovani||"",uhrada_faktury:e.uhrada_faktury||"",doplnujici_data:{}};e.kod_strediska_financovani&&(n.doplnujici_data.kod_strediska_financovani=e.kod_strediska_financovani),e.organizacni_jednotka&&(n.doplnujici_data.organizacni_jednotka=e.organizacni_jednotka),e.ios&&(n.doplnujici_data.ios=e.ios),e.zakazka&&(n.doplnujici_data.zakazka=e.zakazka),"pojistne_udalosti"===e.typ_financovani&&(e.pojistna_udalost_cislo&&(n.doplnujici_data.pojistna_udalost_cislo=e.pojistna_udalost_cislo),e.pojistna_udalost_poznamka&&(n.doplnujici_data.pojistna_udalost_poznamka=e.pojistna_udalost_poznamka)),c.financovani=JSON.stringify(n)}const p=r.map(e=>{if(e.file){const{file:n}=e,a=(0,o.A)(e,Go);return(0,t.A)((0,t.A)({},a),{},{_hadFile:!0})}return e}),u=void 0!==i?i:qn.id||(e.id?e.id:null),v=Boolean(c.vecna_spravnost_umisteni_majetku||c.vecna_spravnost_poznamka||c.dokonceni_poznamka);return await Ia.default.saveDraft(c,{orderId:u,attachments:p,metadata:{firstAutoSaveDate:l,version:"1.4",isConceptSaved:!0,isOrderSavedToDB:os,savedOrderId:u,isChanged:!s||v,dictionaries:{approvers:Yr||[],users:Rr||[],strediska:Fr||[],financovani:Mr||[],druhyObjednavky:Ur||[],lpKody:Zr||[]}}}),ii((new Date).toISOString()),es(!0),setTimeout(()=>{si(!1),li(null)},a?300:0),a||ze&&ze("\u2705 Koncept \xfasp\u011b\u0161n\u011b ulo\u017een\n\ud83d\udcbe M\xedstn\xed \xfalo\u017ei\u0161t\u011b\n\ud83d\udcdd ".concat(qn.cislo_objednavky||"Nov\xe1 objedn\xe1vka"),"success"),!0}catch(l){return a||ze&&ze("Nepoda\u0159ilo se ulo\u017eit koncept",{type:"error"}),si(!1),ni(!1),!1}},qc=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(Ka.current)return{success:!1,reason:"form_closing"};return Gc(a||qn,{isAutoSave:e,isAfterDbSave:n})};(0,r.useEffect)(()=>{Ha.current=qc},[qc]);const Yc=()=>{if(we)try{Ia.default.saveUIState({phase2Unlocked:!1}),Cn(!1)}catch(e){}};(0,r.useEffect)(()=>{if(qn.id&&we&&qn.stav_workflow_kod&&!Nn)try{const e=Ia.default.getUIState();if(e&&e.phase2Unlocked&&e.phase2OrderId===qn.id&&!0===e.phase2Unlocked){ca(qn.stav_workflow_kod,"ODESLANA"),ca(qn.stav_workflow_kod,"ZRUSENA");const e=qn.stav_workflow_kod||"NOVA",n=ca(e,"ODESLANA"),a=ca(e,"ZRUSENA");n||a?(Ia.default.saveUIState({phase2Unlocked:!1}),Cn(!1)):Cn(!0)}}catch(e){}},[qn.id,we,qn.stav_workflow_kod,Nn]);const[Xc,Qc]=(0,r.useState)(!1);(0,r.useEffect)(()=>{Nn&&!Xc&&(Qc(!0),Ic("info","PHASE2-UNLOCK","prevention-set","Nastavena prevence localStorage kontroly - zam\u010den\xed zpracov\xe1no z DB"))},[Nn,Xc]),(0,r.useEffect)(()=>{if(qn.id&&qn.stav_workflow_kod&&we){const n=ca(qn.stav_workflow_kod,"ODESLANA"),a=ca(qn.stav_workflow_kod,"ZRUSENA");if((n||a)&&En){let n=!1;try{const e=Ia.default.getUIState();e&&qn.id&&e.phase2OrderId===qn.id&&!0===e.phase2Unlocked&&(n=!0)}catch(e){}if(!n){Cn(!1);try{Ia.default.saveUIState({phase2Unlocked:!1})}catch(e){}}}}},[qn.stav_workflow_kod,qn.id,we,En]),(0,r.useEffect)(()=>{if(ha&&Ae&&we){ja(!1),li(null),On(!1);const e="".concat(Ae.titul_pred?Ae.titul_pred+" ":"").concat(Ae.jmeno||""," ").concat(Ae.prijmeni||"").concat(Ae.titul_za?", "+Ae.titul_za:"").replace(/\s+/g," ").trim();Xn(n=>(0,t.A)((0,t.A)({},n),{},{uzivatel_id:we,objednatel_id:we,jmeno:e,email:Ae.email||"",telefon:Ae.telefon||"",id:null,ev_cislo:"",cislo_objednavky:null,predmet:"",popis_pozadavku:"",max_cena_s_dph:"",polozky_objednavky:[{id:Date.now(),popis:"",cena_bez_dph:"",sazba_dph:"21",cena_s_dph:""}]})),No(!1),So({}),an(new Set)}},[ha,Ae,we]),(0,r.useEffect)(()=>{if(we){const e=(()=>{if(!we)return null;try{const e=Ia.default.getUIState();return(null===e||void 0===e?void 0:e.sectionState)||null}catch(e){return null}})();e&&(qe(n=>(0,t.A)((0,t.A)({},n),e)),Ic("success","UI","section-states","Na\u010dten ulo\u017een\xfd stav sekc\xed: ".concat(JSON.stringify(e))))}},[we]),(0,r.useEffect)(()=>()=>{Yt(!1)},[]),(0,r.useEffect)(()=>{Yt(!1),ja(!1),Gt(!0),ep.current&&(ep.current=!1),$e&&Xn({objednatel_id:we||"",uzivatel_id:we||"",garant_uzivatel_id:we||"",jmeno:"",email:"",telefon:"",ev_cislo:"Na\u010d\xedt\xe1m...",druh_objednavky_kod:"",strediska_kod:[],zpusob_financovani:"",poznamka:"",mimoradna_udalost:!1,polozky_objednavky:[{nazev:"",specifikace:"",mnozstvi:1,merna_jednotka:"",jednotkova_cena:"",celkova_cena:0}],dodavatel:{},faktury:[],stav_workflow_kod:["NOVA"],stav_schvaleni:"\u010dek\xe1 na schv\xe1len\xed"})},[$e,we]),(0,r.useEffect)(()=>{Jr&&qt&&xa&&Gt(!1)},[$e,Jr,qt,xa]);const ep=(0,r.useRef)(!1),np=(0,r.useRef)(null),ap=(0,r.useRef)(null);(0,r.useEffect)(()=>{window.__orderForm_hasLoadedNextNumberRef=ep,we&&(Ia.default.setCurrentUser(we),Ia.default.hasDraft().then(e=>{e||$e||(ep.current=!1)}))},[we,$e]),(0,r.useLayoutEffect)(()=>{const e=()=>{if(ap.current){const e=ap.current.offsetHeight;document.documentElement.style.setProperty("--fixed-header-height","".concat(e+20,"px"))}};e();const n=[setTimeout(e,50),setTimeout(e,100),setTimeout(e,200),setTimeout(e,500)];window.addEventListener("resize",e);const a=new ResizeObserver(()=>{e()});return ap.current&&a.observe(ap.current),()=>{n.forEach(e=>clearTimeout(e)),window.removeEventListener("resize",e),a.disconnect()}},[]),(0,r.useEffect)(()=>{if(ap.current){const e=ap.current.offsetHeight;document.documentElement.style.setProperty("--fixed-header-height","".concat(e+20,"px"))}},[_c,mc,qn.stav_workflow_kod,qn.ev_cislo,qn.dokoncil_id]),(0,r.useEffect)(()=>{ep.current||qn.id||Wn||(qn.ev_cislo&&"Na\u010d\xedt\xe1m..."!==qn.ev_cislo?ep.current=!0:Ee&&Se&&Hc().then(e=>{e&&(ep.current=!0)}))},[qn.id,Wn,Ee,Se]);const op=(0,r.useCallback)(async e=>{if(!e||!Ee||!Se)return;const n=Zr.find(n=>n.id===e||n.kod===e);if(!n)return;const a=n.cislo_lp||n.label||n.kod;if(a){ui(n=>n[e]?n:(0,t.A)((0,t.A)({},n),{},{[e]:!0}));try{const n=await(0,me.WZ)({token:Ee,username:Se,cislo_lp:a});n&&(o=a=>(0,t.A)((0,t.A)({},a),{},{[e]:n}),ln(e=>(0,t.A)((0,t.A)({},e),{},{details:o})))}catch(i){i.message.includes("404")||i.message.includes("400")||ze("Nepoda\u0159ilo se na\u010d\xedst detail LP: ".concat(i.message),"error")}finally{ui(n=>(0,t.A)((0,t.A)({},n),{},{[e]:!1}))}var o}},[Ee,Se,ze,Zr]),tp=(0,r.useCallback)(async()=>{if(Ee&&Se&&!mi){fi(!0);try{const e=await(0,Ba.iE)({token:Ee,username:Se,show_inactive:!1,limit:500});null!==e&&void 0!==e&&e.data&&Array.isArray(e.data)?_i(e.data):_i([])}catch(e){_i([])}finally{fi(!1)}}},[Ee,Se,mi]),ip=(0,r.useCallback)(async e=>{if(e&&Ee&&Se){bi(!0);try{const n=vi.find(n=>n.cislo_smlouvy===e||n.evidencni_cislo===e);ki(n||{notFound:!0})}catch(n){ki({notFound:!0})}finally{bi(!1)}}else ki(null)},[Ee,Se,vi,qn.cislo_smlouvy]);(0,r.useEffect)(()=>{},[qn.potvrzeni_vecne_spravnosti,qn.potvrzeni_dokonceni_objednavky,qn.id]),(0,r.useEffect)(()=>{const e=Ae&&we&&!Wn&&!xa&&!qn.objednatel_id&&!qn.jmeno&&!qn.email,n=qn.predmet&&String(qn.predmet).trim()||qn.garant_uzivatel_id||qn.prikazce_id||qn.strediska_kod&&Array.isArray(qn.strediska_kod)&&qn.strediska_kod.length>0||qn.max_cena_s_dph&&parseFloat(qn.max_cena_s_dph)>0||qn.popis_pozadavku&&String(qn.popis_pozadavku).trim();if(e&&n){const e="".concat(Ae.titul_pred?Ae.titul_pred+" ":"").concat(Ae.jmeno||""," ").concat(Ae.prijmeni||"").concat(Ae.titul_za?", "+Ae.titul_za:"").replace(/\s+/g," ").trim();Xn(n=>(0,t.A)((0,t.A)({},n),{},{objednatel_id:we,jmeno:e||"Neuvedeno",email:Ae.email||"",telefon:Ae.telefon||""}))}},[Ae,we,Wn,xa,qn.objednatel_id,qn.jmeno,qn.email,qn.predmet,qn.garant_uzivatel_id,qn.prikazce_id,qn.strediska_kod,qn.max_cena_s_dph,qn.popis_pozadavku]),(0,r.useEffect)(()=>{if(!qn.polozky_objednavky||0===qn.polozky_objednavky.length)return;qn.polozky_objednavky.reduce((e,n)=>e+(parseFloat((n.cena_bez_dph||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0)*parseFloat(n.mnozstvi||0),0)>5e4&&!qn.ma_byt_zverejnena&&Xn(e=>(0,t.A)((0,t.A)({},e),{},{ma_byt_zverejnena:!0}))},[qn.polozky_objednavky,qn.ma_byt_zverejnena]),(0,r.useEffect)(()=>{if(Zr.length>0&&Array.isArray(qn.lp_kod)&&qn.lp_kod.length>0){qn.lp_kod.every(e=>Zr.some(n=>(n.id||n.kod)===e))}},[Zr,qn.lp_kod]),(0,r.useEffect)(()=>{Array.isArray(qn.lp_kod)&&0!==qn.lp_kod.length&&qn.lp_kod.forEach(e=>{ci[e]||pi[e]||op(e)})},[qn.lp_kod]),(0,r.useEffect)(()=>{Ee&&Se&&0===vi.length&&!mi&&tp()},[Ee,Se,vi.length,mi,tp]),(0,r.useEffect)(()=>{const e=Mr.find(e=>e.kod===qn.zpusob_financovani),n=(null===e||void 0===e?void 0:e.nazev)||"";if(!(n.includes("Individu\xe1ln\xed")&&!n.includes("Pojistn\xe1")))return;let a="";if("string"===typeof qn.ev_cislo?a=qn.ev_cislo:"object"===typeof qn.ev_cislo&&qn.ev_cislo&&(a=qn.ev_cislo.order_number_string||qn.ev_cislo.next_order_string||qn.ev_cislo.next_number||""),!a||!a.startsWith("O-"))return;const o=a.replace(/^O-/,"I-");qn.individualni_schvaleni!==o&&Xn(e=>(0,t.A)((0,t.A)({},e),{},{individualni_schvaleni:o}))},[qn.ev_cislo,qn.zpusob_financovani,Mr,qn.individualni_schvaleni]),(0,r.useEffect)(()=>{if(!qn.lp_kod||!Array.isArray(qn.lp_kod)||0===qn.lp_kod.length)return;const e=qn.lp_kod,n=bs.map(e=>e.id||e.kod);e.some(e=>!n.includes(e))&&(Xn(e=>(0,t.A)((0,t.A)({},e),{},{lp_kod:[]})),ze("LP k\xf3dy byly vymaz\xe1ny - p\u0159\xedkazce m\xe1 jin\xfd \xfasek","info"))},[qn.prikazce_id,bs]),(0,r.useEffect)(()=>{qn.cislo_smlouvy&&qn.cislo_smlouvy.trim()?ip(qn.cislo_smlouvy.trim()):ki(null)},[qn.cislo_smlouvy,ip]),(0,r.useEffect)(()=>{(async()=>{var e,n,a,o;const i=ca(qn.stav_workflow_kod,"SCHVALENA"),r="SMLOUVA"===(null===(e=qn.zpusob_financovani)||void 0===e?void 0:e.toUpperCase()),s=!(null===(n=qn.cislo_smlouvy)||void 0===n||!n.trim()),d=!(null!==(a=qn.dodavatel_nazev)&&void 0!==a&&a.trim())&&!(null!==(o=qn.dodavatel_ico)&&void 0!==o&&o.trim());if(i&&r&&s&&d&&hi&&!hi.notFound)try{const e=await Sr(qn,aa);e&&(Xn(n=>(0,t.A)((0,t.A)({},n),e)),Zt(e.source),ya(!0))}catch(l){}})()},[qn.stav_workflow_kod,qn.zpusob_financovani,qn.cislo_smlouvy,qn.dodavatel_nazev,qn.dodavatel_ico,hi,Sr,aa,ca]),(0,r.useEffect)(()=>{const e=qn.predmet||qn.garant_uzivatel_id||qn.popis_pozadavku||qn.max_cena_s_dph||qn.poznamky||qn.dodavatel_nazev||qn.strediska_kod&&qn.strediska_kod.length>0||qn.polozky_objednavky&&qn.polozky_objednavky.some(e=>e.popis),n=!document.hidden;if(!we||!e||Qt||gt||ai||Ra.current||!Ia.default.isAutosaveEnabled()||!n||!xa)return;const a=setTimeout(()=>{qc(!0)},3e3);return()=>clearTimeout(a)},[qn,we,Qt,gt,ai,xa]),(0,r.useEffect)(()=>{const e=()=>{document.hidden};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[qn,we]),(0,r.useEffect)(()=>{const e=e=>{try{const e=np.current,n=e?e.scrollTop:window.pageYOffset||document.documentElement.scrollTop;Ia.default.saveMetadata({scrollPosition:n})}catch(o){}const n=un.filter(e=>!e.serverId&&"uploaded"!==e.status&&!e.fromServer&&e.file),a=un.filter(e=>(!e.klasifikace||""===e.klasifikace.trim())&&!e.fromServer);if(n.length>0||a.length>0){try{const e=[...n,...a].map(e=>({id:e.id,name:e.name,size:e.size,type:e.type,klasifikace:e.klasifikace||"",uploadDate:e.uploadDate,lastModified:e.lastModified||Date.now(),needsReselection:!0})),o="unsaved_attachments_".concat(qn.id||"draft");localStorage.setItem(o,JSON.stringify(e)),Ic("info","ATTACHMENTS","save-to-ls","Ulo\u017eeno ".concat(e.length," neulo\u017een\xfdch p\u0159\xedloh do LocalStorage"))}catch(o){Ic("error","ATTACHMENTS","save-to-ls-error",o.message)}Ic("warning","ATTACHMENTS","unsaved-on-exit","Opou\u0161t\xedte str\xe1nku s ".concat(n.length," neulo\u017een\xfdmi a ").concat(a.length," neklasifikovan\xfdmi p\u0159\xedlohami"))}},n=()=>{const e=un.filter(e=>!e.serverId&&"uploaded"!==e.status&&!e.fromServer&&e.file),n=un.filter(e=>(!e.klasifikace||""===e.klasifikace.trim())&&!e.fromServer);if(e.length>0||n.length>0)try{const a=[...e,...n].map(e=>({id:e.id,name:e.name,size:e.size,type:e.type,klasifikace:e.klasifikace||"",uploadDate:e.uploadDate,lastModified:e.lastModified||Date.now(),needsReselection:!0})),o="unsaved_attachments_".concat(qn.id||"draft");localStorage.setItem(o,JSON.stringify(a)),Ic("info","ATTACHMENTS","save-on-navigation","Ulo\u017eeno ".concat(a.length," neulo\u017een\xfdch p\u0159\xedloh p\u0159i navigaci"))}catch(a){Ic("error","ATTACHMENTS","save-on-navigation-error",a.message)}};return window.addEventListener("beforeunload",e),window.addEventListener("popstate",n),()=>{window.removeEventListener("beforeunload",e),window.removeEventListener("popstate",n)}},[un,qn,we,os,qn.id]);const rp=(0,r.useCallback)((e,n)=>{!Ra.current&&Ia.default.isAutosaveEnabled()&&!Qt&&!gt&&xa&&oo(!1)},[wo,Qt,gt,xa,oo]);(0,r.useEffect)(()=>{try{const e=we?"order_templates_".concat(we):"order_templates",n=localStorage.getItem(e);if(n){const e=JSON.parse(n);Array.isArray(e)&&Ei(e)}}catch(e){}Ee&&Se&&we&&ou()},[we,Ee,Se]);const sp=e=>{qe(n=>{const a=(0,t.A)((0,t.A)({},n),{},{[e]:!n[e]});return(e=>{if(we)try{Ia.default.saveUIState({sectionState:e})}catch(n){}})(a),"prilohy"===e&&n[e]&&!a[e]&&qn.id&&Ee&&Se&&!ha&&aa>=3&&setTimeout(()=>{_p()},100),a})},dp=e=>{const n=un.filter(n=>n.name.toLowerCase()===e.toLowerCase());return n.length>0?n[0]:null},lp=e=>{if(ua&&!gs)return void(ze&&ze("Nelze nahr\xe1t p\u0159\xedlohy - objedn\xe1vka je dokon\u010dena/zam\xedtnuta/zru\u0161ena",{type:"warning"}));if(!e||0===e.length)return;const n=un.filter(e=>"obj-"===gp(e)&&("uploaded"===e.status||"uploading"===e.status)).reduce((e,n)=>e+(n.size||0),0),a=Array.from(e).reduce((e,n)=>e+n.size,0),o=n+a;if(o>104857600){const e=(n/1024/1024).toFixed(2),t=(a/1024/1024).toFixed(2),i=(o/1024/1024).toFixed(2);return void(ze&&ze("\u274c P\u0159ekro\u010den limit celkov\xe9 velikosti p\u0159\xedloh!\n\n"+"\ud83d\udcca Sou\u010dasn\xe1 velikost: ".concat(e," MB\n")+"\u2795 Nov\xe9 soubory: ".concat(t," MB\n")+"\ud83d\udcc8 Celkem by bylo: ".concat(i," MB\n")+"\ud83d\udeab Maximum povoleno: 100 MB\n\n\ud83d\udca1 Tip: Sma\u017ete n\u011bkter\xe9 existuj\xedc\xed p\u0159\xedlohy nebo nahrajte men\u0161\xed soubory",{type:"error",timeout:1e4}))}wt(!0);const i=Array.from(e).map((e,n)=>{if(!(0,La.VW)(e.name)){var a;const n=(null===(a=e.name.split(".").pop())||void 0===a?void 0:a.toLowerCase())||"bez p\u0159\xedpony";return ze&&ze('\u274c Nepodporovan\xfd typ souboru "'.concat(e.name,'"\n\n')+"\ud83d\udcc4 Detekovan\xe1 p\u0159\xedpona: .".concat(n,"\n")+"\u2705 Podporovan\xe9 typy:\n  \u2022 Dokumenty: PDF, DOC, DOCX, ODT, RTF, TXT\n  \u2022 Tabulky: XLS, XLSX, ODS, CSV\n  \u2022 Prezentace: PPT, PPTX, ODP\n  \u2022 Obr\xe1zky: JPG, PNG, GIF, BMP, WEBP, SVG\n  \u2022 Archivy: ZIP, RAR, 7Z\n  \u2022 Emaily: EML, MSG\n\n\ud83d\udca1 Tip: P\u0159eve\u010fte soubor do podporovan\xe9ho form\xe1tu",{type:"error",timeout:1e4}),null}const o=(e.size/1024/1024).toFixed(2);if(!(0,La.io)(e.size,20))return ze&&ze('\u274c Soubor "'.concat(e.name,'" je p\u0159\xedli\u0161 velk\xfd\n\n')+"\ud83d\udccf Velikost souboru: ".concat(o," MB\n")+"\ud83d\udeab Maxim\xe1ln\xed povolen\xe1 velikost: ".concat(20," MB\n\n")+"\ud83d\udca1 Tip: Zkomprimujte soubor nebo nahrajte men\u0161\xed verzi",{type:"error",timeout:8e3}),null;const t=dp(e.name),i=(0,La.h0)(e);return{id:i.id,guid:i.guid,name:e.name,originalName:i.originalName,generatedName:i.generatedName,systemovy_nazev:i.systemovy_nazev,size:e.size,type:e.type,klasifikace:"",uploadDate:i.uploaded_at||(new Date).toISOString(),status:"pending_classification",file:e,uploadError:null,serverId:null,serverGuid:null,isDuplicate:!!t,duplicateOf:(null===t||void 0===t?void 0:t.id)||null}}).filter(Boolean);Xn(e=>(0,t.A)((0,t.A)({},e),{},{prilohy_dokumenty:[...e.prilohy_dokumenty||[],...i]})),vn(e=>[...e,...i]),wt(!1)},cp=e=>{const n=e.target.files;n.length>0&&lp(n),e.target.value=""},pp=async function(e,n){var a;let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"obj-";const i=null===(a=qn.prilohy_dokumenty)||void 0===a?void 0:a.find(n=>n.id===e);if(i){if(!i.file)return Ic("error","ATTACHMENTS","upload-no-file-object","Soubor ".concat(i.name," nem\xe1 File objekt - mo\u017en\xe1 ji\u017e byl nahr\xe1n nebo ztracen")),void(ze&&ze('\u26a0\ufe0f Nelze nahr\xe1t "'.concat(i.name,'"\n\n')+"Soubor nem\xe1 p\u0159i\u0159azen\xfd File objekt.\nZkuste soubor znovu vybrat.",{type:"warning",timeout:5e3}));if("uploaded"!==i.status)try{var r,s;if(Xn(n=>(0,t.A)((0,t.A)({},n),{},{prilohy_dokumenty:n.prilohy_dokumenty.map(n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{status:"uploading",uploadError:null,file_prefix:o}):n)})),vn(n=>n.map(n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{status:"uploading",uploadError:null,file_prefix:o}):n)),Ic("info","ATTACHMENTS","upload-start","Nahr\xe1v\xe1m soubor ".concat(i.name," s klasifikac\xed ").concat(n," a prefixem ").concat(o," na server V2 API...")),!qn.id)throw ze("\u274c Nelze nahr\xe1t p\u0159\xedlohu - objedn\xe1vka nem\xe1 ID! Nejprve ulo\u017e objedn\xe1vku.","error"),new Error("Missing formData.id - order must be saved first");const a=await(0,La.Fg)(qn.id,i.file,Se,Ee,n,o);Ic("success","ATTACHMENTS","upload-success","Soubor ".concat(i.name," nahr\xe1n \xfasp\u011b\u0161n\u011b"),a);const d=(null===(r=a.data)||void 0===r?void 0:r.attachment_id)||(null===(s=a.data)||void 0===s?void 0:s.id);Xn(n=>(0,t.A)((0,t.A)({},n),{},{prilohy_dokumenty:n.prilohy_dokumenty.map(n=>{var o,r,s;return n.id===e?(0,t.A)((0,t.A)({},n),{},{status:"uploaded",serverId:d,serverGuid:(null===(o=a.data)||void 0===o?void 0:o.guid)||i.systemovy_nazev,uploadError:null,file:null,nahrano_uzivatel_id:null===(r=a.data)||void 0===r?void 0:r.uploaded_by_user_id,nahrano_uzivatel:null===(s=a.data)||void 0===s?void 0:s.nahrano_uzivatel}):n})})),vn(n=>n.map(n=>{var o,r,s;return n.id===e?(0,t.A)((0,t.A)({},n),{},{status:"uploaded",serverId:d,serverGuid:(null===(o=a.data)||void 0===o?void 0:o.guid)||i.systemovy_nazev,uploadError:null,file:null,nahrano_uzivatel_id:null===(r=a.data)||void 0===r?void 0:r.uploaded_by_user_id,nahrano_uzivatel:null===(s=a.data)||void 0===s?void 0:s.nahrano_uzivatel}):n}));const l=(0,fe.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif",lineHeight:"1.5"},children:[(0,fe.jsxs)("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"8px",color:"#1a1a1a",display:"flex",alignItems:"center",gap:"8px"},children:[(0,fe.jsx)(f.A,{size:20,color:"#10b981",style:{flexShrink:0}}),(0,fe.jsx)("span",{children:"P\u0159\xedloha \xfasp\u011b\u0161n\u011b nahr\xe1na"})]}),(0,fe.jsx)("div",{style:{padding:"8px",backgroundColor:"#f0fdf4",borderRadius:"4px",fontSize:"13px",color:"#166534"},children:i.name})]});ze&&ze(l,{type:"success"});try{const n="unsaved_attachments_".concat(qn.id||"draft"),a=localStorage.getItem(n);if(a){const o=JSON.parse(a).filter(n=>n.id!==e);0===o.length?(localStorage.removeItem(n),Ic("info","ATTACHMENTS","ls-cleared","LocalStorage vy\u010di\u0161t\u011bn - v\u0161echny p\u0159\xedlohy nahr\xe1ny")):(localStorage.setItem(n,JSON.stringify(o)),Ic("info","ATTACHMENTS","ls-updated","LocalStorage aktualizov\xe1n - zb\xfdv\xe1 ".concat(o.length," p\u0159\xedloh")))}}catch(c){Ic("error","ATTACHMENTS","ls-clear-error",c.message)}}catch(c){var d,l;Ic("error","ATTACHMENTS","upload-error","Chyba p\u0159i uploadu ".concat(i.name,": ").concat(c.message)),Xn(n=>(0,t.A)((0,t.A)({},n),{},{prilohy_dokumenty:n.prilohy_dokumenty.map(n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{status:"error",uploadError:c.message}):n)})),vn(n=>n.map(n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{status:"error",uploadError:c.message}):n));const n=(null===(d=c.response)||void 0===d||null===(l=d.data)||void 0===l?void 0:l.message)||c.message||"Nezn\xe1m\xe1 chyba";ze('\u274c Chyba p\u0159i nahr\xe1v\xe1n\xed p\u0159\xedlohy "'.concat(i.name,'": ').concat(n),"error")}else Ic("info","ATTACHMENTS","already-uploaded","Soubor ".concat(i.name," je ji\u017e nahr\xe1n na serveru"))}else Ic("error","ATTACHMENTS","upload-no-file","Soubor s ID ".concat(e," nebyl nalezen v prilohy_dokumenty"))},up=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(qn.id)try{var n,a,o;Nt(!0);const i=await(0,La.ne)(qn.id,Se,Ee),r=(null===i||void 0===i||null===(n=i.data)||void 0===n?void 0:n.attachments)||(null===i||void 0===i?void 0:i.data)||[];let s=null;if(r.length>0)try{s=await(0,La.sK)(qn.id,Se,Ee)}catch(t){}const d={hasIssues:!1,conceptUnclassified:[],conceptOrphaned:[],dbMissingFiles:[],dbOrphaned:[],uploadErrors:[],inconsistentState:[]};un.forEach((e,n)=>{try{if(e.klasifikace&&""!==e.klasifikace||(d.conceptUnclassified.push(e),d.hasIssues=!0),"error"===e.status&&(d.uploadErrors.push(e),d.hasIssues=!0),e.serverId){const n=String(e.serverId);r.find(e=>e.id.toString()===n||e.id.toString()===n.replace("server_",""))||(d.conceptOrphaned.push(e),d.hasIssues=!0)}else"uploaded"!==e.status&&"uploading"!==e.status&&(d.conceptOrphaned.push(e),d.hasIssues=!0)}catch(a){}}),r.forEach((e,n)=>{try{un.find(n=>{if(!n.serverId)return n.name===e.originalni_nazev_souboru&&"uploaded"===n.status;const a=String(n.serverId),o=e.id.toString();return a===o||a==="server_".concat(o)||a.replace("server_","")===o||n.name===e.originalni_nazev_souboru&&"uploaded"===n.status})||(d.dbOrphaned.push(e),d.hasIssues=!0)}catch(a){}});const l=(null===(a=s)||void 0===a||null===(o=a.data)||void 0===o?void 0:o.attachments)||[];if(l.length>0&&l.forEach(e=>{!1===e.file_exists?(d.dbMissingFiles.push({name:e.original_name||"nezn\xe1m\xfd",serverId:e.attachment_id||e.id,path:e.system_path||e.guid,systemName:e.guid,status:e.status}),d.hasIssues=!0):!1===e.size_match&&(d.inconsistentState.push({name:e.original_name||"nezn\xe1m\xfd",serverId:e.attachment_id||e.id,issue:"SIZE MISMATCH: DB=".concat(e.db_size,"B, Disk=").concat(e.actual_size,"B"),status:e.status}),d.hasIssues=!0)}),d.hasIssues){if(aa>=3&&!e){let e="\ud83d\udea8 SYNC KONTROLA - Nalezen\xe9 probl\xe9my:\n";d.conceptUnclassified.length>0&&(e+="\n\ud83d\udcdd KONCEPT - NEKLASIFIKOVAN\xc9 (".concat(d.conceptUnclassified.length,"):\n"),d.conceptUnclassified.forEach(n=>{e+="  \u2022 ".concat(n.name," - pot\u0159ebuje klasifikaci\n")})),d.conceptOrphaned.length>0&&(e+="\n\ud83d\udcc4 KONCEPT - NENAHRAN\xc9/OSI\u0158EL\xc9 (".concat(d.conceptOrphaned.length,"):\n"),d.conceptOrphaned.forEach(n=>{e+="  \u2022 ".concat(n.name," - ").concat(n.serverId?"osi\u0159el\xe1":"nenahr\xe1na","\n")})),d.dbOrphaned.length>0&&(e+="\n\ud83d\udccb DB - CHYB\xcd V KONCEPTU (".concat(d.dbOrphaned.length,"):\n"),d.dbOrphaned.forEach(n=>{e+="  \u2022 ".concat(n.originalni_nazev_souboru," (ID: ").concat(n.id,") - mo\u017en\xe1 ztraceno po F5\n")})),d.dbMissingFiles.length>0&&(e+="\n\ud83d\udcbe SERVER - CHYB\xcd SOUBORY (".concat(d.dbMissingFiles.length,"):\n"),d.dbMissingFiles.forEach(n=>{e+="  \u2022 ".concat(n.name," (").concat(n.path||n.systemName,")\n")})),d.inconsistentState.length>0&&(e+="\n\u26a0\ufe0f PO\u0160KOZEN\xc9 SOUBORY (".concat(d.inconsistentState.length,"):\n"),d.inconsistentState.forEach(n=>{e+="  \u2022 ".concat(n.name," - ").concat(n.issue,"\n")})),d.uploadErrors.length>0&&(e+="\n\u274c CHYBY NAHR\xc1V\xc1N\xcd (".concat(d.uploadErrors.length,"):\n"),d.uploadErrors.forEach(n=>{e+="  \u2022 ".concat(n.name,"\n")})),ze(e,"error"),d.dbOrphaned.length>0&&ze&&ze("Nalezeno ".concat(d.dbOrphaned.length," p\u0159\xedlohy v datab\xe1zi, kter\xe9 chyb\xed v konceptu (mo\u017en\xe1 ztracen\xe9 po obnoven\xed str\xe1nky F5).\n\n")+"Chcete je automaticky obnovit do konceptu?",{type:"info",timeout:0,action:{confirmText:"ANO, OBNOVIT",cancelText:"Ne",onConfirm:async()=>{await vp(d.dbOrphaned)}}})}}else;return d}catch(i){ze("Chyba kontroly synchronizace p\u0159\xedloh:\n".concat(i.message,"\n\n")+"Zkuste:\n\u2022 Obnovit str\xe1nku (F5)\n\u2022 Zkontrolovat p\u0159ipojen\xed k serveru\n\u2022 Zkontrolovat konzoli prohl\xed\u017ee\u010de (F12)","error")}finally{Nt(!1)}else ze("Nen\xed ID objedn\xe1vky pro kontrolu synchronizace","warning")},vp=async e=>{try{if(!e||!Array.isArray(e)){if(!qn.id)return void ze("Nen\xed ID objedn\xe1vky pro na\u010dten\xed p\u0159\xedloh z DB","warning");try{var n;const a=await(0,La.ne)(qn.id,Se,Ee),o=(null===a||void 0===a||null===(n=a.data)||void 0===n?void 0:n.attachments)||(null===a||void 0===a?void 0:a.data)||[];if(!Array.isArray(o))return void ze("Chyba API: neplatn\xe1 struktura odpov\u011bdi pro p\u0159\xedlohy","error");e=o}catch(a){return void ze("Chyba p\u0159i na\u010d\xedt\xe1n\xed p\u0159\xedloh z datab\xe1ze","error")}}const o=e.map(e=>(0,t.A)((0,t.A)({},kp(e)),{},{isRestored:!0}));vn(e=>{const n=new Set(e.map(e=>e.serverId||e.id)),a=o.filter(e=>!n.has(e.serverId)&&!n.has(e.id));return[...e,...a]}),ze("\u2705 Obnoveno ".concat(o.length," p\u0159\xedloh z datab\xe1ze do konceptu"),"success")}catch(a){ze("Chyba obnovov\xe1n\xed: ".concat(a.message),"error")}},_p=async()=>{if(qn.id&&Ee&&Se&&!Ge.prilohy)try{const e=un.filter(e=>!e.serverId&&"uploaded"!==e.status&&!e.fromServer),n=await hp(),a=[...n.map(kp),...e];vn(a),a.length>0&&setTimeout(()=>{up(!0)},1e3)}catch(e){ze("Chyba smart load: ".concat(e.message),"error")}},mp=e=>{Xn(n=>(0,t.A)((0,t.A)({},n),{},{prilohy_dokumenty:(n.prilohy_dokumenty||[]).filter(n=>n.id!==e)})),vn(n=>n.filter(n=>n.id!==e))},fp=()=>{0!==un.length?Lt(!0):ze("\u017d\xe1dn\xe9 p\u0159\xedlohy k odstran\u011bn\xed","info")},hp=async()=>{var e;if(!qn.id||!Ee||!Se)throw new Error("Chyb\xed pot\u0159ebn\xe9 \xfadaje pro na\u010dten\xed p\u0159\xedloh");if(Ge.prilohy)throw new Error("Sekce p\u0159\xedloh je sbalen\xe1 - na\u010d\xedt\xe1n\xed p\u0159esko\u010deno");const n=await(0,La.ne)(qn.id,Se,Ee),a=(null===n||void 0===n||null===(e=n.data)||void 0===e?void 0:e.attachments)||(null===n||void 0===n?void 0:n.data)||[];if(!Array.isArray(a))throw new Error("API nevr\xe1tilo pole p\u0159\xedloh");return a},kp=e=>{const n=e.system_path||e.systemovy_nazev||e.final_filename||"",a=n.split("/").pop()||n;let o="obj-";a.startsWith("dd-")?o="dd-":a.startsWith("obj-")&&(o="obj-");return{id:"server_".concat(e.id),serverId:e.id,objednavka_id:e.order_id||e.objednavka_id,guid:e.guid,typ_prilohy:e.type||e.typ_prilohy,originalni_nazev_souboru:e.original_name||e.originalni_nazev_souboru,systemovy_nazev:e.system_path,systemova_cesta:e.system_path,velikost:e.file_size||e.velikost||e.velikost_souboru_b,dt_vytvoreni:e.upload_date||e.created_at||e.dt_vytvoreni,dt_aktualizace:e.updated_at||e.dt_aktualizace,nahrano_uzivatel_id:e.uploaded_by_user_id||e.nahrano_uzivatel_id,nahrano_uzivatel:e.nahrano_uzivatel,file_exists:e.file_exists,file_prefix:o,name:e.original_name||e.originalni_nazev_souboru,size:e.file_size||e.velikost||e.velikost_souboru_b,type:"application/octet-stream",lastModified:new Date(e.upload_date||e.created_at||e.dt_vytvoreni||Date.now()).getTime(),klasifikace:e.type||e.typ_prilohy,cesta_k_souboru:e.system_path,status:"uploaded",uploadDate:e.upload_date||e.created_at||e.dt_vytvoreni||e.dt_aktualizace||null,serverGuid:e.guid,fromServer:!0}},gp=e=>{if(e.file_prefix)return e.file_prefix;const n=e.systemova_cesta||e.systemovy_nazev||e.cesta_k_souboru||"",a=n.split("/").pop()||n;return a.startsWith("dd-")?"dd-":(a.startsWith("obj-"),"obj-")},bp=e=>"error"===e.status?"#fca5a5":e.klasifikace?e.isDuplicate||"uploading"===e.status?"#f59e0b":"uploaded"===e.status?"#10b981":"#e5e7eb":"#fca5a5",yp=e=>"error"===e.status?"#fef2f2":e.klasifikace?e.isDuplicate||"uploading"===e.status?"#fffbeb":"uploaded"===e.status?"#f0fdf4":"white":"#fef2f2",xp=(e,n,a)=>{Xn(o=>(0,t.A)((0,t.A)({},o),{},{polozky_objednavky:(o.polozky_objednavky||[]).map(o=>{if(o.id===e){const e=(0,t.A)((0,t.A)({},o),{},{[n]:a});if("cena_bez_dph"===n||"sazba_dph"===n){const n=(parseFloat((e.cena_bez_dph||"0").replace(/[^\d,.-]/g,"").replace(",","."))||0)*(1+(parseFloat(e.sazba_dph)||0)/100);e.cena_s_dph=n.toFixed(2)}if("cena_s_dph"===n){const n=(parseFloat((e.cena_s_dph||"0").replace(/[^\d,.-]/g,"").replace(",","."))||0)/(1+(parseFloat(e.sazba_dph)||0)/100);e.cena_bez_dph=n.toFixed(2)}return e}return o})})),"sazba_dph"===n&&(Ra.current||!Ia.default.isAutosaveEnabled()||Qt||gt||!xa||oo(!0))},jp=()=>{var e,n,a,o;return!!(null!==(e=qn.dodavatel_nazev)&&void 0!==e&&e.trim()&&null!==(n=qn.dodavatel_adresa)&&void 0!==n&&n.trim()&&null!==(a=qn.dodavatel_ico)&&void 0!==a&&a.trim()&&/^\d{8}$/.test(null===(o=qn.dodavatel_ico)||void 0===o?void 0:o.trim()))},zp=async()=>{if(jp())try{Mt({loading:!0});const e=qn.dodavatel_ico.trim(),n=await(0,me.e5)({token:Ee,username:Se,user_id:we,usek_zkr:null===Ae||void 0===Ae?void 0:Ae.usek_zkr,ico:e,load_all:Oe&&Oe("CONTACT_MANAGE")}),a=(Oe&&Oe("CONTACT_MANAGE"),Array.isArray(n)?n.filter(n=>{var a;return(null===(a=n.ico)||void 0===a?void 0:a.trim())===e}):[]);if(a.length>0){const e=a.find(e=>{if(e.usek_zkr&&""!==e.usek_zkr.trim()&&"[]"!==e.usek_zkr&&"null"!==e.usek_zkr)try{const n=JSON.parse(e.usek_zkr),a=null===Ae||void 0===Ae?void 0:Ae.usek_zkr,o=Array.isArray(a)?a:[a];return Array.isArray(n)&&o.some(e=>e&&n.includes(e))}catch(n){return!1}return!1}),n=a.find(e=>{const n=e.usek_zkr&&""!==e.usek_zkr.trim()&&"[]"!==e.usek_zkr&&"null"!==e.usek_zkr;return e.user_id&&0!==e.user_id&&"0"!==e.user_id&&!n}),o=a.find(e=>{const n=e.usek_zkr&&""!==e.usek_zkr.trim()&&"[]"!==e.usek_zkr&&"null"!==e.usek_zkr;return(0===e.user_id||"0"===e.user_id)&&!n});Mt({exists:!0,existsInPersonal:n||null,existsInUsek:e||null,existsInGlobal:o||null,supplier:n||e||o})}else Mt({exists:!1,existsInPersonal:null,existsInUsek:null,existsInGlobal:null,supplier:null});Vt(!0)}catch(e){null===ze||void 0===ze||ze("Chyba p\u0159i kontrole dodavatele v datab\xe1zi","error"),Mt(null)}else null===ze||void 0===ze||ze("Vypl\u0148te v\u0161echny povinn\xe9 \xfadaje dodavatele (n\xe1zev, adresa, I\u010cO)","warning")},Ap=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(Bo.length>0)e&&e.length>=2?wp(e):Mo(Bo);else{Zo(!0);try{const n=await(0,me.e5)({token:Ee,username:Se,user_id:we,usek_zkr:(null===Ae||void 0===Ae?void 0:Ae.usek_zkr)||void 0,load_all:Oe&&Oe("CONTACT_MANAGE")});if(Array.isArray(n))if(Ko(n),e&&e.length>=2){const a=Ls(e),o=n.filter(n=>{const o=Ls(n.nazev||n.name||""),t=(n.ico||"").toLowerCase(),i=(n.kontakt_email||n.email||"").toLowerCase(),r=Ls(n.kontakt_jmeno||"");return o.includes(a)||t.includes(e.toLowerCase())||i.includes(e.toLowerCase())||r.includes(a)});Mo(o)}else Mo(n);else Ko([]),Mo([])}catch(n){ze&&ze("Chyba p\u0159i na\u010d\xedt\xe1n\xed kontakt\u016f: "+n.message,{type:"error"}),Ko([]),Mo([])}finally{Zo(!1)}}},wp=e=>{if(!e||e.length<2)return void Mo(Bo);const n=Ls(e),a=Bo.filter(a=>{const o=Ls(a.nazev||a.name||""),t=(a.ico||"").toLowerCase(),i=(a.kontakt_email||a.email||"").toLowerCase(),r=Ls(a.kontakt_jmeno||"");return o.includes(n)||t.includes(e.toLowerCase())||i.includes(e.toLowerCase())||r.includes(n)});Mo(a)},Sp=()=>{const e=qn.dodavatel_nazev||"",n=qn.dodavatel_ico||"",a=e||n;qo(a),Wo(!0),a&&a.length>=2&&Ep(a)},Ep=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const n=null===e||void 0===e?void 0:e.trim();if(!n||n.length<3)Xo([]);else try{et(!0);let e,i;if(/^\d+$/.test(n)){e="https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/".concat(n);const t=await fetch(e,{method:"GET",headers:{Accept:"application/json"}});if(t.ok){var a,o;const e=await t.json(),n={ico:e.ico,dic:e.dic||"",nazev:e.obchodniJmeno||"",adresa:(null===(a=e.sidlo)||void 0===a?void 0:a.textovaAdresa)||"",sidlo:(null===(o=e.sidlo)||void 0===o?void 0:o.textovaAdresa)||""};Xo([n])}else Xo([]),n.length>=8&&ze&&ze("Dodavatel nebyl v ARES nalezen",{type:"warning"})}else{e="https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/vyhledat";const a=[n,Ls(n)].filter((e,n,a)=>a.indexOf(e)===n);let o=[];for(const n of a){if(!n)continue;i={obchodniJmeno:n,pocet:25};const a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(a.ok){const e=((await a.json()).ekonomickeSubjekty||[]).map(e=>{var n,a;return{ico:e.ico,dic:e.dic||"",nazev:e.obchodniJmeno||"",adresa:(null===(n=e.sidlo)||void 0===n?void 0:n.textovaAdresa)||"",sidlo:(null===(a=e.sidlo)||void 0===a?void 0:a.textovaAdresa)||""}});o.push(...e)}}const r=o.filter((e,n,a)=>a.findIndex(n=>n.ico===e.ico)===n),s=Ls(n);if(r.sort((e,n)=>{const a=Ls(e.nazev),o=Ls(n.nazev),t=a.includes(s),i=o.includes(s);return t&&!i?-1:!t&&i?1:0}),Xo(r),r.length>0){const e={};for(const n of r)if(n.ico)try{const a=await(0,me.e5)({token:Ee,username:Se,user_id:we,usek_zkr:null===Ae||void 0===Ae?void 0:Ae.usek_zkr,ico:n.ico,load_all:Oe&&Oe("CONTACT_MANAGE")}),o=Array.isArray(a)?a.filter(e=>{var a;return(null===(a=e.ico)||void 0===a?void 0:a.trim())===n.ico.trim()}):[];if(o.length>0){const a=Array.isArray(null===Ae||void 0===Ae?void 0:Ae.usek_zkr)?Ae.usek_zkr:[null===Ae||void 0===Ae?void 0:Ae.usek_zkr],t=o.find(e=>{if(e.usek_zkr&&""!==e.usek_zkr.trim()&&"[]"!==e.usek_zkr&&"null"!==e.usek_zkr)try{const n=JSON.parse(e.usek_zkr);return a.some(e=>e&&n.includes(e))}catch(n){return!1}return!1}),i=o.find(e=>{const n=e.usek_zkr&&""!==e.usek_zkr.trim()&&"[]"!==e.usek_zkr&&"null"!==e.usek_zkr;return e.user_id>0&&e.user_id===we&&!n}),r=o.find(e=>{const n=e.usek_zkr&&""!==e.usek_zkr.trim()&&"[]"!==e.usek_zkr&&"null"!==e.usek_zkr;return 0===e.user_id&&!n});e[n.ico]={existsInPersonal:!!i,existsInUsek:!!t,existsInGlobal:!!r}}else e[n.ico]={existsInPersonal:!1,existsInUsek:!1,existsInGlobal:!1}}catch(t){e[n.ico]={existsInPersonal:!1,existsInUsek:!1,existsInGlobal:!1}}tt(e)}r.length}}catch(t){Xo([]),tt({}),ze&&ze("Chyba p\u0159i p\u0159ipojen\xed k ARES",{type:"error"})}finally{et(!1)}},Cp=e=>{var n;n=n=>n.includes(e)?n.filter(n=>n!==e):[...n,e],gn(e=>(0,t.A)((0,t.A)({},e),{},{selectedUseky:n}))},Np=e=>{Xn(n=>(0,t.A)((0,t.A)({},n),{},{dodavatel_nazev:e.nazev||"",dodavatel_adresa:e.adresa||e.sidlo||"",dodavatel_ico:e.ico||"",dodavatel_dic:e.dic||""})),Wo(!1),qo(""),Xo([]),ze&&ze("Dodavatel na\u010dten z ARES",{type:"success"})},Op=async(e,n)=>{if(Ee&&Se&&we){at(e.ico);try{Ic("info","ARES-SAVE","permissions-check","U\u017eivatel: ".concat(Se,", USER_MANAGE: ").concat(cs,", \xdasek: ").concat(null===Ae||void 0===Ae?void 0:Ae.usek_zkr,", Ukl\xe1d\xe1m do: ").concat(JSON.stringify(n)));let o=0,t="";if("personal"===n)o=we,t="",Ic("info","ARES-SAVE","target-personal","C\xedl: Osobn\xed kontakt pro user_id=".concat(o));else if("usek"===(null===n||void 0===n?void 0:n.scope)||"department"===n){o=0;const e=(null===n||void 0===n?void 0:n.useky)||[(null===Ae||void 0===Ae?void 0:Ae.usek_zkr)||""];t=JSON.stringify(e),Ic("info","ARES-SAVE","target-usek","C\xedl: Kontakty \xfaseku pro \xfaseky=".concat(e.join(", "),", usek_zkr=").concat(t))}else"global"===n&&(o=0,t="",Ic("info","ARES-SAVE","target-global","C\xedl: Glob\xe1ln\xed kontakt (user_id=0, usek_zkr='')"));try{await(0,me.aj)({token:Ee,username:Se,ico:e.ico,nazev:e.nazev,adresa:e.adresa||e.sidlo||"",dic:e.dic||"",zastoupeny:"",kontakt_jmeno:"",kontakt_email:"",kontakt_telefon:"",user_id:o,usek_zkr:t}),ze&&ze("Dodavatel byl aktualizov\xe1n v lok\xe1ln\xed datab\xe1zi",{type:"success"})}catch(a){await(0,me.jx)({token:Ee,username:Se,nazev:e.nazev,adresa:e.adresa||e.sidlo||"",ico:e.ico,dic:e.dic||"",zastoupeny:"",kontakt_jmeno:"",kontakt_email:"",kontakt_telefon:"",user_id:o,usek_zkr:t}),ze&&ze("Dodavatel byl p\u0159id\xe1n do lok\xe1ln\xed datab\xe1ze",{type:"success"})}Ko([])}catch(o){ze&&ze("Chyba p\u0159i ukl\xe1d\xe1n\xed: ".concat(o.message),{type:"error"})}finally{at(null)}}else ze&&ze("Chyb\xed p\u0159ihla\u0161ovac\xed \xfadaje",{type:"error"})},Dp=async e=>{const n=null===e||void 0===e?void 0:e.trim();if(n&&!(n.length<8)){kt(!0),mt("checking"),ht(null),vt(!0);try{const e=await(0,me.d0)({token:Ee,username:Se,ico:n});if(null!==e&&void 0!==e&&e.data&&Array.isArray(e.data)&&e.data.length>0){const n=e.data[0];mt("found-local"),ht((0,t.A)((0,t.A)({},n),{},{source:"local"}))}else{const e="https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/".concat(n),o=await fetch(e,{method:"GET",headers:{Accept:"application/json"}});if(o.ok){var a;const e=await o.json();mt("found-ares"),ht({ico:e.ico,dic:e.dic||"",nazev:e.obchodniJmeno||"",adresa:(null===(a=e.sidlo)||void 0===a?void 0:a.textovaAdresa)||"",source:"ares"})}else mt("not-found"),ht(null)}}catch(o){mt("not-found"),ht(null)}finally{kt(!1)}}},Tp=()=>{ft&&(Xn(e=>(0,t.A)((0,t.A)({},e),{},{dodavatel_nazev:ft.nazev||ft.name||"",dodavatel_adresa:ft.adresa||ft.address||"",dodavatel_ico:ft.ico||"",dodavatel_dic:ft.dic||"",dodavatel_zastoupeny:ft.zastoupeny||"",dodavatel_kontakt_jmeno:ft.kontakt_jmeno||"",dodavatel_kontakt_email:ft.kontakt_email||"",dodavatel_kontakt_telefon:ft.kontakt_telefon||""})),vt(!1),mt(null),ht(null))},Ip=()=>{vt(!1),mt(null),ht(null)},Pp=e=>{try{var n,a,o;const i={};var t;if(null!==e&&void 0!==e&&null!==(n=e.poApproval)&&void 0!==n&&n.predmet&&(i.predmet=e.poApproval.predmet),null!==e&&void 0!==e&&null!==(a=e.poApproval)&&void 0!==a&&a.max_cena_s_dph&&(i.maxCena=e.poApproval.max_cena_s_dph),null!==e&&void 0!==e&&null!==(o=e.orderDetails)&&void 0!==o&&o.dodavatel_nazev&&(i.dodavatel=e.orderDetails.dodavatel_nazev),Array.isArray(null===e||void 0===e?void 0:e.polozky)&&e.polozky.length)i.polozky=e.polozky.length,null!==(t=e.polozky[0])&&void 0!==t&&t.popis&&(i.prvniPolozka=e.polozky[0].popis);return i}catch(i){return{}}},Lp=(e,n)=>{try{const o={ts:Date.now(),action:e,details:n||{},user:Se||"unknown"};a=e=>[o,...e.slice(0,49)],Ao(e=>(0,t.A)((0,t.A)({},e),{},{actionsLog:a}))}catch(o){}var a},Rp=(0,r.useCallback)((e,n)=>{const a=!ba&&!os;ya(!0),xa||ja(!0),a?oo(!0):oo();if(["garant_uzivatel_id","prikazce_id","strediska_kod","predmet","max_cena_s_dph","lp_kod","zpusob_financovani","druh_objednavky_kod"].includes(e)){Qp(e,n)}Xn(a=>{let o=n;const i=(0,t.A)((0,t.A)({},a),{},{[e]:o});"zpusob_financovani"===e&&(i.lp_kod=[],i.cislo_smlouvy="",i.smlouva_poznamka="",i.individualni_schvaleni="",i.individualni_poznamka="",i.pojistna_udalost_cislo="",i.pojistna_udalost_poznamka="");const r=()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),t=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),r=String(e.getSeconds()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(o," ").concat(t,":").concat(i,":").concat(r)},s=()=>{const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(o)};if("stav_schvaleni"===e&&("schvaleno"===n&&we?(a.schvalovatel_id?(i.schvalovatel_id=a.schvalovatel_id,i.dt_schvaleni=a.dt_schvaleni):(i.schvalovatel_id=we,i.dt_schvaleni=r()),i.schvaleni_komentar=""):"neschvaleno"===n||"ceka_se"===n?a.schvalovatel_id?(i.schvalovatel_id=a.schvalovatel_id,i.dt_schvaleni=a.dt_schvaleni):(i.schvalovatel_id=we,i.dt_schvaleni=r()):""===n&&(i.schvalovatel_id="",i.dt_schvaleni="")),"stav_odeslano"===e)if(!0!==n||a.datum_odeslani){if(!1===n){i.datum_odeslani="",Ic("info","WORKFLOW","odeslano-unchecked","Checkbox Odesl\xe1no od\u0161krtnut - workflow se zm\u011bn\xed a\u017e p\u0159i ulo\u017een\xed");const e=a.stav_workflow_kod||"NOVA",n=ca(e,"ODESLANA"),o=ca(e,"ZRUSENA");n||o||a.stav_stornovano?Ic("warning","PHASE2-UNLOCK","clear-blocked-final","BLOKACE clearPhase2UnlockState - objedn\xe1vka je ODESLAN\xc1/ZRU\u0160EN\xc1 (workflow=".concat(e,")")):(Ic("info","PHASE2-UNLOCK","clear-allowed","\u010ci\u0161t\u011bn\xed Phase 2 unlock povoleno - objedn\xe1vka nen\xed v zam\u010den\xe9m stavu"),Yc())}}else i.datum_odeslani=s(),Ic("info","WORKFLOW","odeslano-checked","Checkbox Odesl\xe1no za\u0161krtnut - workflow se zm\u011bn\xed a\u017e p\u0159i ulo\u017een\xed");if("stav_stornovano"===e)if(!0!==n||a.datum_storna){if(!1===n){i.datum_storna="",i.storno_uzivatel_id="",i.storno_provedl="",i.odeslani_storno_duvod="";const e=a.stav_workflow_kod||"NOVA",n=ca(e,"ODESLANA"),o=ca(e,"ZRUSENA");n||o?Ic("warning","PHASE2-UNLOCK","clear-blocked-storno-final","BLOKACE clearPhase2UnlockState p\u0159i storno zm\u011bn\u011b - objedn\xe1vka je ODESLAN\xc1/ZRU\u0160EN\xc1 (workflow=".concat(e,")")):(Ic("info","PHASE2-UNLOCK","clear-allowed-storno","\u010ci\u0161t\u011bn\xed Phase 2 unlock po storno zm\u011bn\u011b povoleno - objedn\xe1vka nen\xed v zam\u010den\xe9m stavu"),Yc())}}else if(i.datum_storna=s(),we&&!a.storno_uzivatel_id&&(i.storno_uzivatel_id=we),Ae&&!a.storno_provedl){const e="".concat(Ae.titul_pred?Ae.titul_pred+" ":"").concat(Ae.jmeno||""," ").concat(Ae.prijmeni||"").concat(Ae.titul_za?", "+Ae.titul_za:"").replace(/\s+/g," ").trim();i.storno_provedl=e}if("potvrzeni_vecne_spravnosti"===e)if(1===n||!0===n)if(we&&!a.potvrdil_vecnou_spravnost_id){const e=new Date,a=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0"),r=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0"),d=String(e.getSeconds()).padStart(2,"0"),l="".concat(a,"-").concat(o,"-").concat(t," ").concat(r,":").concat(s,":").concat(d);i.potvrdil_vecnou_spravnost_id=we,i.dt_potvrzeni_vecne_spravnosti=l,Ic("info","VECNA-SPRAVNOST","checkbox-set","Automaticky nastaveno: potvrdil_vecnou_spravnost_id=".concat(we,", dt=").concat(i.dt_potvrzeni_vecne_spravnosti,", checkbox_value=").concat(n))}else we?Ic("info","VECNA-SPRAVNOST","checkbox-already-set","ID u\u017e je nastaveno: ".concat(a.potvrdil_vecnou_spravnost_id)):Ic("error","VECNA-SPRAVNOST","no-user-id","user_id nen\xed definov\xe1no - nem\u016f\u017eu nastavit potvrdil_vecnou_spravnost_id");else 0!==n&&!1!==n||Ic("info","VECNA-SPRAVNOST","checkbox-unset","Checkbox od\u0161krtnut - ID a datum z\u016fst\xe1vaj\xed zachov\xe1ny");if("potvrzeni_dokonceni_objednavky"===e)if(1===n||!0===n)if(we){const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),t=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0"),d="".concat(n,"-").concat(a,"-").concat(o," ").concat(t,":").concat(r,":").concat(s);i.dokoncil_id=we,i.dt_dokonceni=d}else Ic("error","DOKONCENI","no-user-id","user_id nen\xed definov\xe1no");else 0!==n&&!1!==n||(i.dokoncil_id=null,i.dt_dokonceni=null);return i});["garant_uzivatel_id","prikazce_id","strediska_kod","zpusob_financovani","lp_kod","druh_objednavky_kod","stav_schvaleni","stav_odeslano","stav_stornovano"].includes(e)&&(Ra.current||!Ia.default.isAutosaveEnabled()||Qt||gt||!xa||oo(!0))},[wo,qn,we,Ra,Ia.default,Qt,gt,xa,oo,ja]),Vp=(0,r.useCallback)(e=>{qn.stav_schvaleni===e?(Rp("stav_schvaleni",""),Rp("schvaleni_komentar",""),Rp("schvalovatel_id","")):(Rp("stav_schvaleni",e),!we||"schvaleno"!==e&&"neschvaleno"!==e&&"ceka_se"!==e||Rp("schvalovatel_id",we)),Ra.current||!Ia.default.isAutosaveEnabled()||Qt||gt||!xa||oo(!0)},[qn.stav_schvaleni,we,Ra,Ia.default,Qt,gt,xa]),Fp=(0,r.useCallback)(()=>{Pi(!0),Ui("new"),Bi(null),Ri(""),Fi("po")},[]),Mp=(0,r.useCallback)(()=>{Vn?(qe(e=>{const n=(0,t.A)({},e);return Object.keys(n).forEach(e=>{n[e]=!1}),n}),Fn(!1)):(qe(e=>{const n=(0,t.A)({},e),a=[];return Object.keys(n).forEach(e=>{if("registr_smluv"===e)return;const o=xs[e];o&&!o.enabled&&(n[e]=!0,a.push(e))}),a.length,n}),Fn(!0))},[Vn,xs,na]),Up=(0,r.useCallback)(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"smooth";const a=np.current;if(!a)return!1;const o=a.querySelector('[data-section="'.concat(e,'"]'));if(!o)return!1;try{const e=o.querySelector('[class*="SectionHeader"]')||o.querySelector("div:first-child"),t=(e||o).offsetTop,i=t-parseInt(getComputedStyle(document.documentElement).getPropertyValue("--fixed-header-height")||"200");return"smooth"===n?a.scrollTo({top:i,behavior:"smooth"}):a.scrollTop=i,!0}catch(t){return!1}},[xs,us,na,ze]),Zp=(0,r.useCallback)(e=>{Up("vecna_spravnost"===e?"fakturace":e,"smooth")},[Up]),Bp=(0,r.useCallback)(e=>{e&&e.length>0&&(lp(e),ze&&ze("\ud83d\udcce Nahr\xe1v\xe1m ".concat(e.length," soubor(\u016f)..."),{type:"info"}))},[lp,ze]),Kp=((0,r.useCallback)(async()=>{if(qn.id)if(null!==Ae&&void 0!==Ae&&Ae.id)try{Ic("info","STATUS-RELOAD","start","Na\u010d\xedt\xe1m aktu\xe1ln\xed stav objedn\xe1vky ID: ".concat(qn.id,", u\u017eivatel: ").concat(Ae.id));const e=await(0,La.getOrderV2)(parseInt(qn.id),Ee,Se,!1);if(!e||!e.id)throw new Error("Nepoda\u0159ilo se na\u010d\xedst stav objedn\xe1vky z datab\xe1ze");Ic("success","STATUS-RELOAD","loaded",'Na\u010dten aktu\xe1ln\xed stav: stav_objednavky="'.concat(e.stav_objednavky,'", stav_workflow_kod="').concat(e.stav_workflow_kod,'"')),Xn(n=>(0,t.A)((0,t.A)({},n),{},{stav_workflow_kod:e.stav_workflow_kod,stav_objednavky:e.stav_objednavky}));const n=(0,t.A)((0,t.A)({},qn),{},{stav_workflow_kod:e.stav_workflow_kod,stav_objednavky:e.stav_objednavky});qc(n,{isOrderSavedToDB:!0,savedOrderId:qn.id,isChanged:ba}),Ic("success","STATUS-RELOAD","complete","Stav aktualizov\xe1n a ulo\u017een do konceptu")}catch(e){Ic("error","STATUS-RELOAD","failed",e.message),ze&&ze("Chyba p\u0159i na\u010d\xedt\xe1n\xed stavu z datab\xe1ze: ".concat(e.message),{type:"error"})}else ze&&ze("Nelze na\u010d\xedst stav z datab\xe1ze - nen\xed p\u0159ihl\xe1\u0161en u\u017eivatel",{type:"error"});else ze&&ze("Nelze na\u010d\xedst stav z datab\xe1ze - objedn\xe1vka nen\xed ulo\u017eena",{type:"error"})},[qn,Ae,Ee,Se,ze,ba]),(0,r.useCallback)(()=>{if(!qn.id)return!1;if(aa<3)return!1;const e=ca(qn.stav_workflow_kod,"ROZPRACOVANA"),n=ca(qn.stav_workflow_kod,"ODESLANA"),a=ca(qn.stav_workflow_kod,"POTVRZENA");return!!ca(qn.stav_workflow_kod,"SCHVALENA")&&!!(e||n||a)},[qn.id,qn.stav_workflow_kod,aa,ca,ia])),Hp=(0,r.useCallback)(()=>{if(Kp())try{Ic("info","DOCX-GENERATOR","open-dialog","Otev\xedr\xe1m DOCX gener\xe1tor pro objedn\xe1vku ID: ".concat(qn.id));const e=(0,t.A)({objednavka_id:qn.id,cislo_objednavky:qn.cislo_objednavky,nazev_objednavky:qn.nazev_objednavky||qn.nazev},qn);Wt(e),Kt(!0)}catch(e){Ic("error","DOCX-GENERATOR","error",e.message),ze&&ze("Chyba p\u0159i otev\xedr\xe1n\xed DOCX gener\xe1toru: ".concat(e.message),{type:"error"})}else qn.id?aa<3?ze&&ze('DOCX lze generovat a\u017e od f\xe1ze "Odes\xedl\xe1n\xed objedn\xe1vky"',{type:"warning"}):ze&&ze("DOCX lze generovat a\u017e kdy\u017e je objedn\xe1vka v procesu zpracov\xe1n\xed",{type:"warning"}):ze&&ze("DOCX lze generovat pouze u ulo\u017een\xfdch objedn\xe1vek",{type:"warning"})},[qn,aa,ze]),Wp=(0,r.useCallback)(()=>{Kt(!1),Wt(null)},[]),$p=(0,r.useCallback)(async()=>{if(ua){try{if(Ka.current=!0,Ia.default.setAutosaveEnabled(!1,"Closing completed/rejected/cancelled order"),Ra.current=!0,oi(!0),to&&to(),Fa.current&&(clearTimeout(Fa.current),Fa.current=null),we){Ia.default.setCurrentUser(we),await Ia.default.deleteAllDraftKeys();try{localStorage.removeItem("order_form_isEditMode_".concat(we)),localStorage.removeItem("openOrderInConcept-".concat(we)),localStorage.removeItem("order_form_savedOrderId_".concat(we)),localStorage.removeItem("savedOrderId-".concat(we))}catch(o){}}const e=$e||qn.id;if(e&&Ee&&Se)try{await(0,La.$_)({token:Ee,username:Se,orderId:e})}catch(t){console.warn("\u26a0\ufe0f UNLOCK OrderForm25: FAILED - obj #"+e,t.message)}try{$n(!1),(0,no.aO)(we),wa({isEditMode:!1,isNewOrder:!1,orderId:null,orderNumber:""}),await new Promise(e=>setTimeout(e,50))}catch(o){}je("/orders25-list",{state:{forceReload:!0}})}catch(t){ze&&ze("Chyba p\u0159i zav\xedr\xe1n\xed: ".concat(t.message),{type:"error"})}return}const e=un.filter(e=>!e.serverId&&"uploaded"!==e.status&&!e.fromServer&&e.file),n=un.filter(e=>!e.klasifikace||""===e.klasifikace.trim());let a="Koncept bude zru\u0161en a neulo\u017een\xe9 zm\u011bny nebudou ulo\u017eeny.";(e.length>0||n.length>0)&&(a+="\n\n\u2139\ufe0f Informace o p\u0159\xedloh\xe1ch:\n\u2022 ".concat(e.length," neulo\u017een\xfdch p\u0159\xedloh\n\u2022 ").concat(n.length," neklasifikovan\xfdch p\u0159\xedloh")),co(a),so(!0)},[un,ua,we,qn.id,Ee,Se,ze,je]),Jp=(0,r.useCallback)(async()=>{Ic("info","CANCEL","draftmanager-close","Zav\xedr\xe1m formul\xe1\u0159 p\u0159es DraftManager");try{if(Ka.current=!0,Ia.default.setAutosaveEnabled(!1,"Form closing - prevent save during cleanup"),Ra.current=!0,oi(!0),to&&to(),Fa.current&&(clearTimeout(Fa.current),Fa.current=null),ei(!1),bt(!1),zt(""),xt(0),es(!1),window._activeProgressControl&&(window._activeProgressControl.cancel(),window._activeProgressControl=null),we){Ia.default.setCurrentUser(we);await Ia.default.deleteAllDraftKeys()&&Ic("success","CANCEL","draftmanager-cleanup","V\u0161echny draft kl\xed\u010de smaz\xe1ny p\u0159es DraftManager");await Ia.default.hasDraft()&&await Ia.default.deleteAllDraftKeys();try{localStorage.removeItem("order_form_isEditMode_".concat(we)),localStorage.removeItem("openOrderInConcept-".concat(we)),localStorage.removeItem("order_form_savedOrderId_".concat(we)),localStorage.removeItem("savedOrderId-".concat(we))}catch(e){}}const a=$e||qn.id;if(a&&Ee&&Se)try{console.log("\ud83d\udd13 UNLOCK OrderForm25: Odemyk\xe1m obj #"+a+" (zav\u0159en\xed formul\xe1\u0159e)"),await(0,La.$_)({token:Ee,username:Se,orderId:a}),console.log("\u2705 UNLOCK OrderForm25: OK - obj #"+a),Ic("success","CANCEL","unlock","Objedn\xe1vka ".concat(a," byla odemknuta"))}catch(n){console.warn("\u26a0\ufe0f UNLOCK OrderForm25: FAILED - obj #"+a,n.message),Ic("warning","CANCEL","unlock-error","Chyba p\u0159i odemyk\xe1n\xed: ".concat(n.message," - ignorov\xe1no"))}try{$n(!1),(0,no.aO)(we),await new Promise(e=>setTimeout(e,50)),wa({isEditMode:!1,isNewOrder:!1,orderId:null,orderNumber:""}),Ic("success","CANCEL","broadcast","Broadcast stavu odesl\xe1n (formul\xe1\u0159 zav\u0159en)")}catch(e){Ic("warning","CANCEL","broadcast-error","Chyba p\u0159i broadcastu: ".concat(e.message))}so(!1),co(""),Ic("info","CANCEL","redirect","P\u0159esm\u011brov\xe1v\xe1m na seznam objedn\xe1vek"),setTimeout(()=>{je("/orders25-list",{state:{forceReload:!0}})},200)}catch(n){Ic("error","CANCEL","error","Chyba p\u0159i zav\xedr\xe1n\xed: ".concat(n.message)),ze&&ze("Chyba p\u0159i zav\xedr\xe1n\xed: ".concat(n.message),{type:"error"}),ei(!1),bt(!1),so(!1),co(""),setTimeout(()=>{je("/orders25-list",{state:{forceReload:!0}})},100)}},[we,Ia.default,qn.id,Ee,Se,ze,je]),Gp=(0,r.useCallback)(()=>{so(!1),co("")},[]),[qp,Yp]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(qp&&En&&!Qt){(async()=>{try{ei(!0);const e={};qn.predmet&&(e.predmet=qn.predmet),qn.garant_uzivatel_id&&(e.garant_uzivatel_id=qn.garant_uzivatel_id);const n=la(qn.stav_workflow_kod).filter(e=>"ODESLANA"!==e&&"ZRUSENA"!==e);e.stav_workflow_kod=JSON.stringify(n),e.stav_odeslano=!1,e.stav_stornovano=!1,await(0,La.qA)(qn.id,e,Ee,Se)}catch(e){ze&&ze("Chyba p\u0159i ukl\xe1d\xe1n\xed: ".concat(e.message),{type:"error"})}finally{Yp(!1),ei(!1)}})()}},[qp,En,Qt]);const Xp=e=>{Ic("info","UNLOCK",e,"Odem\u010den\xed ni\u017e\u0161\xed sekce \u2192 automaticky ru\u0161\xedm checkboxy vy\u0161\u0161\xedch f\xe1z\xed"),Rp("potvrzeni_vecne_spravnosti",0),Rp("potvrzeni_dokonceni_objednavky",0),ma(),setTimeout(()=>oo(!0),100)},Qp=(e,n)=>{const a=(0,t.A)((0,t.A)({},qn),{},{[e]:n}),o=Qa(a,1===aa?"NOVA":ia);So(n=>{const a=(0,t.A)({},n);return o[e]?a[e]=o[e]:delete a[e],a})},eu=()=>{if(ka)return So({}),!0;(0,s.flushSync)(()=>{No(!0)});let e={};if(qn.stav_stornovano){var n;null!==(n=qn.odeslani_storno_duvod)&&void 0!==n&&n.trim()||(e.odeslani_storno_duvod="D\u016fvod stornov\xe1n\xed je povinn\xfd")}else{var a,o,i;const n=1===aa?"NOVA":ia,s={phase1:{visible:aa>=1,locked:Ts},phase2:{visible:aa>=2,locked:Is},financovani:{visible:Pd.visible,locked:!Pd.enabled},phase3:{visible:aa>=3,locked:rc},phase4to6:{visible:aa>=4,locked:lc},registr_smluv_vyplneni:{visible:Cs.visible,locked:Ns}},c=Qa(qn,n,s);e=(0,t.A)((0,t.A)({},e),c);const p=s.financovani.visible&&!s.financovani.locked;if(aa>=1&&qn.zpusob_financovani&&p){const n=Mr.find(e=>e.kod===qn.zpusob_financovani||e.kod_stavu===qn.zpusob_financovani||e.value===qn.zpusob_financovani);if(n){const a=n.nazev_stavu||n.nazev||"";var r,d;if((a.includes("Limitovan")||a.includes("p\u0159\xedslib"))&&((!qn.lp_kod||Array.isArray(qn.lp_kod)&&0===qn.lp_kod.length)&&(e.lp_kod="LP k\xf3d je povinn\xfd p\u0159i financov\xe1n\xed z Limitovan\xe9ho p\u0159\xedslibu"),aa>=3&&qn.polozky_objednavky&&qn.polozky_objednavky.length>0&&qn.polozky_objednavky.forEach((n,a)=>{n.polozka_lp_id||n.lp_id||(e["polozka_".concat(a,"_lp")]="Polo\u017eka ".concat(a+1,": LP je povinn\xe9 p\u0159i financov\xe1n\xed z Limitovan\xe9ho p\u0159\xedslibu"))})),a.includes("Smlouva"))if(null!==(r=qn.cislo_smlouvy)&&void 0!==r&&r.trim()){vi.some(e=>0!==e.aktivni&&!1!==e.aktivni&&(e.cislo_smlouvy===qn.cislo_smlouvy||e.evidencni_cislo===qn.cislo_smlouvy))||(e.cislo_smlouvy="Zadan\xe9 \u010d\xedslo smlouvy neexistuje v seznamu aktivn\xedch smluv. Vyberte pros\xedm platnou smlouvu.")}else e.cislo_smlouvy="\u010c\xedslo smlouvy je povinn\xe9 p\u0159i financov\xe1n\xed ze Smlouvy";if(a.includes("Individu\xe1ln\xed")){("string"===typeof qn.individualni_schvaleni?qn.individualni_schvaleni:"").trim()||(e.individualni_schvaleni="Zadejte identifik\xe1tor - referen\u010dn\xed \u010d\xedslo nebo ozna\u010den\xed schv\xe1len\xed je povinn\xe9")}if(a.includes("Pojistn"))null!==(d=qn.pojistna_udalost_cislo)&&void 0!==d&&d.trim()||(e.pojistna_udalost_cislo="Zadejte \u010d\xedslo pojistn\xe9 ud\xe1losti - referen\u010dn\xed \u010d\xedslo \u0161kodn\xed ud\xe1losti je povinn\xe9")}}if(4===aa&&"ANO"===(null===(a=qn.dodavatel_zpusob_potvrzeni)||void 0===a?void 0:a.potvrzeni)){var l;const n=qn.dodavatel_zpusob_potvrzeni;(null===n||void 0===n?void 0:n.zpusoby)&&n.zpusoby.length>0||(e.dodavatel_zpusob_potvrzeni='Vyberte zp\u016fsob potvrzen\xed (e-mail, telefon nebo p\xedsemn\u011b) - p\u0159i odpov\u011bdi "ANO" je povinn\xfd alespo\u0148 jeden'),null!==n&&void 0!==n&&n.platba&&""!==n.platba.trim()||(e.zpusob_platby="Vyberte zp\u016fsob platby (faktura/pokladna) - pole je povinn\xe9 p\u0159i potvrzen\xed dodavatele"),null!==(l=qn.dt_akceptace)&&void 0!==l&&l.trim()||(e.dt_akceptace="Zadejte datum akceptace - kdy dodavatel potvrdil objedn\xe1vku")}aa>=3&&Wr&&qn.polozky_objednavky&&qn.polozky_objednavky.length>0&&qn.polozky_objednavky.forEach((n,a)=>{n.usek_kod&&n.usek_kod.trim()||(e["polozka_".concat(a,"_usek_kod")]="Polo\u017eka ".concat(a+1,": Vyberte \xfasek - ur\u010den\xed lokace je povinn\xe9 u majetkov\xfdch polo\u017eek")),n.budova_kod&&n.budova_kod.trim()||(e["polozka_".concat(a,"_budova_kod")]="Polo\u017eka ".concat(a+1,": Vyberte budovu - ur\u010den\xed lokace je povinn\xe9 u majetkov\xfdch polo\u017eek")),n.mistnost_kod&&n.mistnost_kod.trim()||(e["polozka_".concat(a,"_mistnost_kod")]="Polo\u017eka ".concat(a+1,": Vyberte m\xedstnost - ur\u010den\xed lokace je povinn\xe9 u majetkov\xfdch polo\u017eek"))});const u="pokladna"===(null===(o=qn.financovani)||void 0===o?void 0:o.platba),v="pokladna"===(null===(i=qn.dodavatel_zpusob_potvrzeni)||void 0===i?void 0:i.platba),_=u||v;if(aa>=6&&!_&&qn.faktury&&qn.faktury.length>0&&qn.faktury.forEach((n,a)=>{const o="faktura_".concat(a+1);(!n.fa_cislo_vema||"string"===typeof n.fa_cislo_vema&&""===n.fa_cislo_vema.trim())&&(e["".concat(o,"_cislo")]="Faktura ".concat(a+1,": Zadejte variabiln\xed symbol faktury")),(!n.fa_castka||parseFloat(n.fa_castka)<=0)&&(e["".concat(o,"_castka")]="Faktura ".concat(a+1,": Zadejte \u010d\xe1stku faktury (mus\xed b\xfdt v\u011bt\u0161\xed ne\u017e 0 K\u010d)")),(!n.fa_datum_doruceni||"string"===typeof n.fa_datum_doruceni&&""===n.fa_datum_doruceni.trim())&&(e["".concat(o,"_dorucena")]="Faktura ".concat(a+1,": Zadejte datum, kdy byla faktura doru\u010dena")),(!n.fa_splatnost||"string"===typeof n.fa_splatnost&&""===n.fa_splatnost.trim())&&(e["".concat(o,"_splatnost")]="Faktura ".concat(a+1,": Zadejte datum splatnosti faktury"))}),aa>=7&&!_&&qn.faktury&&qn.faktury.length>0){const n=parseFloat(qn.max_cena_s_dph)||0;qn.faktury.forEach((a,o)=>{1!==a.vecna_spravnost_potvrzeno&&!0!==a.vecna_spravnost_potvrzeno&&(e["faktura_".concat(o+1,"_vecna_spravnost")]="Faktura ".concat(o+1,': Za\u0161krtn\u011bte pol\xed\u010dko "Potvrzuji v\u011bcnou spr\xe1vnost" po kontrole faktury'));(parseFloat(a.fa_castka)||0)>n&&(!a.vecna_spravnost_poznamka||""===a.vecna_spravnost_poznamka.trim())&&(e["faktura_".concat(o+1,"_poznamka_vs")]="Faktura ".concat(o+1,": Vysv\u011btlete v pozn\xe1mce, pro\u010d faktura p\u0159ekra\u010duje max. cenu objedn\xe1vky (").concat(n.toFixed(2)," K\u010d)"))})}}const c=Object.keys(e).length>0;(0,s.flushSync)(()=>{So(e)});const p=Object.keys(e).filter(e=>e.includes("_usek_kod")||e.includes("_budova_kod")||e.includes("_mistnost_kod"));if(p.length>0){var u;const e=new Set;p.forEach(n=>{const a=n.match(/polozka_(\d+)_/);a&&e.add(parseInt(a[1]))});const n=(0,t.A)({},Oo);null===(u=qn.polozky_objednavky)||void 0===u||u.forEach((a,o)=>{e.has(o)&&(n[a.id]=!0)}),(0,s.flushSync)(()=>{Do(n)})}if(c){Object.keys(e).length;if(qn.stav_stornovano)ze&&ze("Nelze stornovat - zkontrolujte vyzna\u010den\xe1 pole",{type:"error"});else{const n=$r(e);ze&&ze(n,{type:"error",timeout:1e4})}setTimeout(()=>{nu(e)},100)}return!c},nu=e=>{if(!e||0===Object.keys(e).length)return;const n=["jmeno","email","garant_uzivatel_id","predmet","prikazce_id","max_cena_s_dph","strediska_kod","schvaleni_komentar","dodavatel_nazev","dodavatel_adresa","dodavatel_ico","druh_objednavky_kod","polozky_objednavky","zpusob_financovani","lp_kod","datum_odeslani","dodavatel_zpusob_potvrzeni","zpusob_platby","dt_akceptace","dt_zverejneni","registr_iddt"];for(const a of n)if(e[a]){let n=null,o=null;switch(a){case"jmeno":n=document.querySelector('input[name="jmeno"]');break;case"email":n=document.querySelector('input[type="email"][name="email"]');break;case"garant_uzivatel_id":n=document.querySelector('[data-field="garant"]');break;case"predmet":n=document.querySelector('input[name="predmet"]');break;case"prikazce_id":n=document.querySelector('[data-field="prikazce"]');break;case"max_cena_s_dph":n=document.querySelector('input[name="max_cena_s_dph"]');break;case"strediska_kod":n=document.querySelector('[data-field="strediska"]');break;case"schvaleni_komentar":n=document.querySelector('textarea[name="schvaleni_komentar"]');break;case"dodavatel_nazev":n=document.querySelector('input[name="dodavatel_nazev"]');break;case"dodavatel_adresa":n=document.querySelector('input[name="dodavatel_adresa"]');break;case"dodavatel_ico":n=document.querySelector('input[name="dodavatel_ico"]');break;case"druh_objednavky_kod":n=document.querySelector('[data-field="druh_objednavky_kod"]');break;case"polozky_objednavky":const o=Object.keys(e).filter(e=>e.startsWith("polozka_"));if(o.length>0){const e=o[0],a=parseInt(e.split("_")[1]);n=document.querySelector('[data-polozka-index="'.concat(a,'"]')),n||(n=document.querySelector('[data-section="detaily"]'))}break;case"zpusob_financovani":n=document.querySelector('[data-field="zpusob_financovani"]');break;case"lp_kod":n=document.querySelector('[data-field="lp_kod"]');break;case"datum_odeslani":n=document.querySelector('input[name="datum_odeslani"]');break;case"dodavatel_zpusob_potvrzeni":n=document.querySelector('[name="dodavatel_zpusob_potvrzeni"]');break;case"zpusob_platby":n=document.querySelector('[name="zpusob_platby"]');break;case"dt_akceptace":n=document.querySelector('input[name="dt_akceptace"]');break;case"dt_zverejneni":n=document.querySelector('[data-field="dt_zverejneni"]')||document.querySelector('button[data-datepicker="dt_zverejneni"]');break;case"registr_iddt":n=document.querySelector('input[name="registr_iddt"]');break;default:n=document.querySelector('[name="'.concat(a,'"], [data-field="').concat(a,'"]'))}if(n){if(o=n.closest("[data-section]"),o){const e=o.getAttribute("data-section");if(e&&Ge[e]){qe(n=>(0,t.A)((0,t.A)({},n),{},{[e]:!1})),setTimeout(()=>{n.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{try{const e=n.querySelector("input");e?e.focus():n.focus()}catch(e){}},300)},300);break}}n.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{try{const e=n.querySelector("input");e?e.focus():n.focus()}catch(e){}},300);break}}},au=()=>{Hi(!1),$i(null)},ou=async()=>{if(Ee&&we){Ti(!0);try{let n=await(0,me.$o)({username:(null===Ce||void 0===Ce?void 0:Ce.username)||Se,token:Ee,user_id:we||0,kategorie:"OBJEDNAVKA25",debug:!0}),a=[];if(Array.isArray(null===n||void 0===n?void 0:n.items)?a=n.items:(Array.isArray(null===n||void 0===n?void 0:n.data)||null!==n&&void 0!==n&&n.success&&Array.isArray(null===n||void 0===n?void 0:n.data))&&(a=n.data),a.length>0){const o=a.filter(e=>0===e.user_id||"0"===String(e.user_id)),i=a.filter(e=>0!==e.user_id&&"0"!==String(e.user_id)),r=o.map(e=>{const n=e.nazev_sablony||e.nazev||e.name||"sablona-".concat(e.id),a=e.dt_aktualizace||e.dt_vytvoreni||Date.now(),o=tu(e),i=e.typ||e.type||"",r=("string"===typeof i?i:String(i||"")).trim().toLowerCase();let s=null;r&&("po"===r||"p_o"===r||"p.o"===r||"p"===r?s="PO":"detail"===r||"det"===r||"details"===r?s="DETAIL":"obejd"===r||"po+detail"===r||"po_detail"===r||"both"===r||r.includes("po")&&r.includes("detail")?s="OBEJD":r.includes("po")?s="PO":r.includes("det")&&(s="DETAIL"));const d=s||(o.poApproval&&o.orderDetails?"OBEJD":o.poApproval?"PO":o.orderDetails?"DETAIL":"PO");return(0,t.A)((0,t.A)({},e),{},{name:n,dbName:e.nazev_sablony||null,ts:new Date(a).getTime?new Date(a).getTime():Date.now(),type:d,__fromServer:!0,data:o})});Ni(r);const s=i.map(e=>{const n=e.nazev_sablony||e.nazev||e.name||"sablona-".concat(e.id),a=e.dt_aktualizace||e.dt_vytvoreni||Date.now(),o=tu(e),i=e.typ||e.type||"",r=("string"===typeof i?i:String(i||"")).trim().toLowerCase();let s=null;r&&("po"===r||"p_o"===r||"p.o"===r||"p"===r?s="PO":"detail"===r||"det"===r||"details"===r?s="DETAIL":"obejd"===r||"po+detail"===r||"po_detail"===r||"both"===r||r.includes("po")&&r.includes("detail")?s="OBEJD":r.includes("po")?s="PO":r.includes("det")&&(s="DETAIL"));const d=s||(o.poApproval&&o.orderDetails?"OBEJD":o.poApproval?"PO":o.orderDetails?"DETAIL":"PO");return(0,t.A)((0,t.A)({},e),{},{name:n,dbName:e.nazev_sablony||null,ts:new Date(a).getTime?new Date(a).getTime():Date.now(),type:d,__fromServer:!0,data:o})});Ei(s);try{const e=we?"order_templates_".concat(we):"order_templates";localStorage.setItem(e,JSON.stringify(s))}catch(e){}Oi({status:(null===n||void 0===n?void 0:n.status)||"success",error:(null===n||void 0===n?void 0:n.error)||null,raw:(null===n||void 0===n?void 0:n.raw)||null}),Lp("fetch",{count:a.length,serverCount:r.length,userCount:s.length})}else Oi({status:(null===n||void 0===n?void 0:n.status)||"empty",error:(null===n||void 0===n?void 0:n.error)||"\u017d\xe1dn\xe9 \u0161ablony nenalezeny",raw:(null===n||void 0===n?void 0:n.raw)||null})}catch(e){Oi({status:"error",error:e.message})}finally{Ti(!1)}}},tu=e=>{try{const n=e=>{if(null===e||void 0===e)return null;if("string"!==typeof e)return e;const n=e.trim();if(!n)return null;try{return JSON.parse(n)}catch(o){}let a=n.replace(/\r?\n/g," ").trim();try{a=a.replace(/([\{,\s])(\w[\w\-]*)\s*:/g,'$1"$2":')}catch(o){}a=a.replace(/'/g,'"');try{return JSON.parse(a)}catch(o){}try{return new Function("return ("+n+");")()}catch(o){return null}},a=e.polozky_po?n(e.polozky_po):null,o=e.polozky_detail?n(e.polozky_detail):null,i=e=>{if(!e||"object"!==typeof e||Array.isArray(e))return e;const n={};return Object.keys(e).forEach(a=>{const o=e[a];if(a.includes(".")){const e=a.split(".");let t=n;e.forEach((n,a)=>{a===e.length-1?t[n]=o:(t[n]&&"object"===typeof t[n]||(t[n]={}),t=t[n])})}else"object"!==typeof o||null===o||Array.isArray(o)||"object"!==typeof n[a]?n[a]=o:n[a]=(0,t.A)((0,t.A)({},n[a]),o)}),n},r=a?i(a):null,s=o?i(o):null,d={};return r&&(d.poApproval=r),s&&(d.orderDetails=s),d}catch(n){return{}}},iu=async(e,n,a)=>{if(Ee&&we)try{const i="po"!==a&&"mixed"!==a||!n.poApproval?"":JSON.stringify(n.poApproval),r="details"!==a&&"mixed"!==a||!n.orderDetails?"":JSON.stringify(n.orderDetails),s="po"===a?"PO":"details"===a?"DETAIL":"OBEJD",d=await(0,me.Xu)({username:(null===Ce||void 0===Ce?void 0:Ce.username)||Se,token:Ee,user_id:we||0,nazev_sablony:e,polozky_po:i,polozky_detail:r,typ:s,kategorie:"OBJEDNAVKA25"});if(!(null!==d&&void 0!==d&&d.success||"ok"===(null===d||void 0===d?void 0:d.status))){var o;const e=(null===d||void 0===d?void 0:d.message)||(null===d||void 0===d||null===(o=d.data)||void 0===o?void 0:o.message)||"Chyba p\u0159i ukl\xe1d\xe1n\xed";throw new Error(e)}{var t;const o={name:e,data:n,ts:Date.now(),type:a,id:d.insertId||d.id||(null===(t=d.data)||void 0===t?void 0:t.id),user_id:we,__fromServer:!0};Ei(e=>{const n=[o,...e];try{const e=we?"order_templates_".concat(we):"order_templates";localStorage.setItem(e,JSON.stringify(n))}catch(a){}return n}),Lp("save",{name:e,type:a,mode:"server"}),ze&&ze('\u0160ablona "'.concat(e,'" byla ulo\u017eena'),{type:"success"})}}catch(i){ze&&ze("Chyba p\u0159i ukl\xe1d\xe1n\xed \u0161ablony: ".concat(i.message),{type:"error"})}},ru=(0,r.useCallback)((e,n)=>{if(!e)return"";switch(n){case"garant":return"".concat(e.titul_pred?e.titul_pred+" ":"").concat(e.jmeno||""," ").concat(e.prijmeni||"").concat(e.titul_za?", "+e.titul_za:"").replace(/\s+/g," ").trim();case"prikazce":if(!e||0===e||0===e.id||0===e.user_id||null===e.id||null===e.user_id)return"Nezn\xe1m\xfd";return("".concat(e.titul_pred?e.titul_pred+" ":"").concat(e.jmeno||""," ").concat(e.prijmeni||"").concat(e.titul_za?", "+e.titul_za:"").replace(/\s+/g," ").trim()||"Nezn\xe1m\xfd")+(e.usek_zkr?" (".concat(e.usek_zkr,")"):"");case"strediska":case"strediska_kod":return e.label?e.label:e.name||e.nazev_stavu||e.toString();case"financovani":case"zpusob_financovani":return e.nazev_stavu||e.nazev||e.label||("string"===typeof e?e:"Nezn\xe1m\xfd");case"lp_kod":return e.cislo_lp?"".concat(e.cislo_lp," - ").concat(e.nazev_uctu||"Bez n\xe1zvu"):"".concat(e.id||e," - ").concat(e.nazev_uctu||e.nazev||e.label||"Bez n\xe1zvu");case"druh_objednavky_kod":const a=e.nazev_stavu||e.nazev||e.label||("string"===typeof e?e:"Nezn\xe1m\xfd");return 1===e.atribut_objektu||"1"===e.atribut_objektu?"".concat(a,"   (majetek)"):a;case"statusFilter":return e.nazev_stavu||e.nazev||e.popis||e.kod_stavu||e.kod||String(e);case"selectedObjednatel":case"selectedGarant":return e.displayName||"".concat(e.jmeno||""," ").concat(e.prijmeni||"").trim()||"Bez jm\xe9na";case"selectedSchvalovatel":return e&&0!==e&&0!==e.id&&0!==e.user_id&&null!==e.id&&null!==e.user_id&&(e.displayName||e.jmeno_prijmeni||"".concat(e.jmeno||""," ").concat(e.prijmeni||"").trim())||"Nezn\xe1m\xfd";case"pageSize":return e.label||String(e.value||e);default:return n&&"string"===typeof n&&n.startsWith("polozka_")&&n.endsWith("_lp")?e.label||(e.kod&&e.nazev?"".concat(e.kod," - ").concat(e.nazev):String(e)):e.label||("string"===typeof e?e:String(e))}},[]);(0,r.useEffect)(()=>{const e=e=>{e.target.closest("[data-custom-select]")||Xe({garant:!1,prikazce:!1,strediska:!1,financovani:!1,lp_kod:!1})};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const su=(0,r.useCallback)(e=>{var n;if("Tab"!==e.key)return;const a=document.activeElement;if((null===a||void 0===a?void 0:a.closest('[class*="Dropdown"]'))||(null===a||void 0===a?void 0:a.closest('[class*="SelectDropdown"]'))||(null===a||void 0===a?void 0:a.closest('[class*="TemplateDropdown"]')))return;const o=document.querySelector('[class*="ScrollableContent"]');if(!o)return;if(!o.contains(a))return;const t=['input:not([disabled]):not([tabindex="-1"])','textarea:not([disabled]):not([tabindex="-1"])','select:not([disabled]):not([tabindex="-1"])','button:not([disabled]):not([tabindex="-1"])','[tabindex]:not([tabindex="-1"]):not([disabled])','[data-field]:not([disabled]):not([tabindex="-1"])'].join(","),i=Array.from(o.querySelectorAll(t)).filter(e=>{if(!e.offsetParent&&"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName)return!1;const n=window.getComputedStyle(e);return"none"!==n.display&&"hidden"!==n.visibility&&(!e.disabled&&"true"!==e.getAttribute("aria-disabled"))});if(0===i.length)return;const r=i.indexOf(a);var s;if(-1===r)return e.preventDefault(),void(null===(s=i[0])||void 0===s||s.focus());let d;e.shiftKey?(d=r-1,d<0&&(d=i.length-1)):(d=r+1,d>=i.length&&(d=0)),e.preventDefault(),null===(n=i[d])||void 0===n||n.focus()},[]);r.useMemo(()=>!!$t||!!Jt,[$t,Jt]);if(!Ee||!Se)return(0,fe.jsxs)(el,{$visible:!0,children:[(0,fe.jsx)(nl,{$visible:!0}),(0,fe.jsx)(al,{$visible:!0,children:"Ov\u011b\u0159uji p\u0159ihl\xe1\u0161en\xed..."}),(0,fe.jsx)(ol,{$visible:!0,children:"\u010cek\xe1m na autentizaci..."})]});if(!Tr.isReady)return(0,fe.jsxs)(el,{$visible:!0,children:[(0,fe.jsx)(nl,{$visible:!0}),(0,fe.jsxs)(al,{$visible:!0,children:["MOUNTING"===Tr.phase&&"Inicializuji formul\xe1\u0159...","LOADING_DICTIONARIES"===Tr.phase&&"Na\u010d\xedt\xe1m \u010d\xedseln\xedky...","READY_FOR_DATA"===Tr.phase&&"P\u0159ipravuji data...","LOADING_DATA"===Tr.phase&&"Na\u010d\xedt\xe1m data objedn\xe1vky...","DATA_LOADED"===Tr.phase&&"Dokon\u010duji na\u010d\xedt\xe1n\xed...","READY"===Tr.phase&&"P\u0159ipravuji formul\xe1\u0159...",!Tr.phase&&"Na\u010d\xedt\xe1m formul\xe1\u0159 objedn\xe1vky"]}),(0,fe.jsxs)(ol,{$visible:!0,children:[!Ir.isReady&&"Na\u010d\xedt\xe1m ".concat(Ir.loadedCount||0,"/").concat(Ir.totalToLoad||8," \u010d\xedseln\xedk\u016f..."),Ir.isReady&&Tr.isLoadingFormData&&"Na\u010d\xedt\xe1m data objedn\xe1vky...",Ir.isReady&&!Tr.isLoadingFormData&&!Tr.isReady&&"Zpracov\xe1v\xe1m data..."]})]});if(Xt&&!Ee)return(0,fe.jsx)(Vs,{isFullscreen:rn,children:(0,fe.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:(0,fe.jsxs)(il,{children:["Chyba inicializace: ",Xt]})})});const du=(0,fe.jsxs)(Vs,{isFullscreen:rn,children:[(0,fe.jsx)(Ea,{onSectionClick:Zp,onFilesDrop:Bp,onToggleSections:Mp,areSectionsCollapsed:Vn,currentPhase:ra(),validationErrors:wo,formData:js,isFullscreen:rn,isSectionActive:ss,allSectionStates:As,isWorkflowCompleted:ua,canPublishRegistry:vs,canUnlockAnything:gs,onSaveAsTemplate:Fp,onGenerateDocx:Hp,onToggleFullscreen:()=>sn(!rn),canGenerateDocx:Kp()&&!_c,canSaveTemplate:!gt&&!Qt&&!!Ee&&!!we&&!_c,serverTemplates:Ci,savedTemplates:Si,templatesLoading:Di,searchQuery:zr,showSearch:jr,token:Ee,hasPermission:Oe,onTemplateSearch:e=>Ao(n=>(0,t.A)((0,t.A)({},n),{},{searchPredefs:e})),onToggleTemplateSearch:()=>{return e=e=>!e,Ao(n=>(0,t.A)((0,t.A)({},n),{},{showSearchPredefs:e}));var e},onRefreshTemplates:ou,onFillPoApproval:e=>{if(aa>=2)return;const n=null===e||void 0===e?void 0:e.data;if(null!==n&&void 0!==n&&n.poApproval){const a=(0,t.A)({},qn),o=(0,t.A)((0,t.A)((0,t.A)({},a),n.poApproval),{},{id:a.id,ev_cislo:a.ev_cislo});Xn(o),Lp("apply-po",{name:e.name,source:"saved",ts:e.ts,preview:Pp(n)}),Ia.default.setAutosaveEnabled(!0),qc(!0,!1,o).catch(e=>{})}},onFillDetails:e=>{if(aa<2)return;const n=null===e||void 0===e?void 0:e.data;if(null===n||void 0===n||!n.orderDetails)return;const a=eo(ia,aa,ea),o={financovani:["zpusob_financovani","financovani","lp_kod","cislo_smlouvy","smlouva_poznamka","individualni_schvaleni","individualni_poznamka","pojistna_udalost_cislo","pojistna_udalost_poznamka"],dodavatel:["dodavatel_id","dodavatel_nazev","dodavatel_adresa","dodavatel_ico","dodavatel_dic","dodavatel_zastoupeny"],kontakt:["dodavatel_kontakt_jmeno","dodavatel_kontakt_email","dodavatel_kontakt_telefon"],detaily:["druh_objednavky","druh_objednavky_kod","poznamka_objednavky"],dodaci_podminky:["dt_predpokladany_termin_dodani","misto_dodani","zaruka"],polozky:["polozky_objednavky"]},i=(0,t.A)({},qn),r=(0,t.A)({},i);Object.entries(o).forEach(e=>{let[o,t]=e;("polozky"===o?a.detaily:a[o])&&t.forEach(e=>{void 0!==n.orderDetails[e]&&(r[e]=n.orderDetails[e])})}),a.detaily&&Array.isArray(n.polozky)&&n.polozky.length>0&&(r.polozky_objednavky=n.polozky),r.predmet=i.predmet,r.prikazce_id=i.prikazce_id,r.max_cena_s_dph=i.max_cena_s_dph,r.strediska_kod=i.strediska_kod,r.garant_uzivatel_id=i.garant_uzivatel_id,r.id=i.id,r.ev_cislo=i.ev_cislo,r.zpusob_financovani=i.zpusob_financovani,r.lp_kod=i.lp_kod,r.cislo_smlouvy=i.cislo_smlouvy,r.smlouva_poznamka=i.smlouva_poznamka,r.individualni_schvaleni=i.individualni_schvaleni,r.individualni_poznamka=i.individualni_poznamka,r.pojistna_udalost_cislo=i.pojistna_udalost_cislo,r.pojistna_udalost_poznamka=i.pojistna_udalost_poznamka,Xn(r),Lp("apply-details",{name:e.name,source:"saved",ts:e.ts,preview:Pp(n),appliedSections:Object.keys(o).filter(e=>"polozky"===e?a.detaily:a[e])}),Ia.default.setAutosaveEnabled(!0),qc(!0,!1,r).catch(e=>{})},canFillTemplate:!_c,onCopyTemplateToUser:async e=>{if(Ee&&we&&e)try{var n;const a=e.data||{},o=e.name||e.dbName||"Kopie \u0161ablony",t="".concat(o," (kopie)"),i=a.poApproval?JSON.stringify(a.poApproval):"",r=a.orderDetails?JSON.stringify(a.orderDetails):"",s=(null===(n=e.type)||void 0===n?void 0:n.toString().toUpperCase())||"OBEJD",d=await(0,me.Xu)({username:(null===Ce||void 0===Ce?void 0:Ce.username)||Se,token:Ee,user_id:we||0,nazev_sablony:t,polozky_po:i,polozky_detail:r,typ:s,kategorie:"OBJEDNAVKA25"});if(d&&(d.success||"ok"===d.status)){const e=d.data||d||{},n={name:t,data:a,ts:Date.now(),type:"PO"===s?"po":"DETAIL"===s?"details":"mixed",id:e.id||e.insertId,user_id:we,__fromServer:!0};return Ei(e=>{const a=(Array.isArray(e)?e:[]).filter(e=>(e.name||"").trim().toLowerCase()!==t.trim().toLowerCase()),o=[n,...a].slice(0,200);try{const e=we?"order_templates_".concat(we):"order_templates";localStorage.setItem(e,JSON.stringify(o))}catch(i){}return o}),Lp("copy",{originalName:o,copyName:t,type:s.toLowerCase(),mode:"server"}),ze&&ze('\u0160ablona "'.concat(o,'" byla zkop\xedrov\xe1na jako "').concat(t,'"'),{type:"success"}),n}}catch(a){ze&&ze("Chyba p\u0159i kop\xedrov\xe1n\xed \u0161ablony: ".concat((null===a||void 0===a?void 0:a.message)||"Nezn\xe1m\xe1 chyba"),{type:"error"})}},onCopyTemplateToGlobal:async e=>{if(e&&Ee&&we)try{const a=e.name||e.dbName||"Kopie u\u017eivatelsk\xe9 \u0161ablony",o="".concat(a," (GLO)"),t=e.data||{},i=t.poApproval&&Object.keys(t.poApproval).length>0,r=t.orderDetails&&Object.keys(t.orderDetails).length>0;let s="PO";i&&r?s="PO+detail":r&&(s="detail");const d=await(0,me.Xu)({username:(null===Ce||void 0===Ce?void 0:Ce.username)||Se,token:Ee,user_id:0,nazev_sablony:o,polozky_po:i?JSON.stringify(t.poApproval):"",polozky_detail:r?JSON.stringify(t.orderDetails):"",typ:s.toLowerCase(),kategorie:"OBJEDNAVKA25"});if("ok"!==(null===d||void 0===d?void 0:d.status)){var n;const e=(null===d||void 0===d?void 0:d.message)||(null===d||void 0===d||null===(n=d.data)||void 0===n?void 0:n.message)||"Nepoda\u0159ilo se zkop\xedrovat \u0161ablonu do glob\xe1ln\xedch";throw new Error(e)}await ou(),Lp("copyToGlobal",{originalName:a,globalName:o,type:s.toLowerCase(),mode:"global"}),ze&&ze('\u0160ablona "'.concat(a,'" byla zkop\xedrov\xe1na do glob\xe1ln\xedch jako "').concat(o,'"'),{type:"success"})}catch(a){ze&&ze("Chyba p\u0159i kop\xedrov\xe1n\xed do glob\xe1ln\xedch \u0161ablon: ".concat((null===a||void 0===a?void 0:a.message)||"Nezn\xe1m\xe1 chyba"),{type:"error"})}},onShowTemplatePreview:(e,n)=>{const a=((e,n)=>{try{const a={templateInfo:{name:e.name||"Bez n\xe1zvu",type:e.type||"mixed",created:e.ts?(0,Za.iS)(new Date(e.ts)):"Nezn\xe1mo",isGlobal:0===e.user_id},poApproval:null,orderDetails:null,items:[]};if(null!==n&&void 0!==n&&n.poApproval){const e=n.poApproval;a.poApproval={predmet:e.predmet||"",maxCena:e.max_cena_s_dph||"",popisPozadavku:e.popis_pozadavku||"",strediska:Array.isArray(e.strediska_kod)?e.strediska_kod:[],objednatel:e.objednatel_id||"",garant:e.garant_uzivatel_id||"",prikazce:e.prikazce_id||""}}if(null!==n&&void 0!==n&&n.orderDetails){const e=n.orderDetails;a.orderDetails={dodavatelNazev:e.dodavatel_nazev||"",dodavatelAdresa:e.dodavatel_adresa||"",dodavatelIco:e.dodavatel_ico||"",dodavatelDic:e.dodavatel_dic||"",zpusobFinancovani:e.zpusob_financovani||"",lpKod:e.lp_kod||"",druhObjednavky:e.druh_objednavky_kod||"",poznamka:e.poznamka||"",datumDodani:e.datum_dodani||"",fakturovatNa:e.fakturovat_na||"",dodaciAdresa:e.dodaci_adresa||""}}return Array.isArray(null===n||void 0===n?void 0:n.polozky)&&(a.items=n.polozky.map((e,n)=>({index:n+1,popis:e.popis||"",pocet:e.pocet||1,jednotka:e.jednotka||"",cenaJednotka:e.cena_jednotka||0,cenaTotal:(e.pocet||1)*(e.cena_jednotka||0)}))),a}catch(a){return null}})(e,n);a&&kr({template:e,data:n,preview:a})},onDeleteTemplate:e=>{$i(e),Hi(!0)},onEditTemplateName:e=>{br(e.id||e.ts),xr(e.name||"")},editingTemplateId:gr,editingTemplateName:yr,matchesTemplateQuery:(e,n)=>{var a,o,t,i,r;if(!n||!n.trim())return!0;const s=Ls(n),d=Ls(e.name||e.dbName||""),l=Ls((null===(a=e.data)||void 0===a||null===(o=a.poApproval)||void 0===o?void 0:o.predmet)||""),c=Ls((null===(t=e.data)||void 0===t||null===(i=t.polozky)||void 0===i||null===(r=i[0])||void 0===r?void 0:r.popis)||"");return d.includes(s)||l.includes(s)||c.includes(s)},isArchived:ea}),Xt&&(0,fe.jsxs)(il,{style:{margin:"1rem"},children:["\u010c\xe1ste\u010dn\xe1 chyba p\u0159i na\u010d\xedt\xe1n\xed dat: ",Xt]}),(0,fe.jsxs)(Fs,{children:[(0,fe.jsx)(Ms,{ref:ap,children:(0,fe.jsxs)(Us,{children:[(0,fe.jsxs)(Ks,{children:[(0,fe.jsxs)(Hs,{children:[(0,fe.jsx)(Ws,{children:(0,fe.jsxs)($s,{title:Wn&&qn.ev_cislo?"Editace objedn\xe1vky ev.\u010d. ".concat(qn.ev_cislo):"",children:["Objedn\xe1vka",qn.id&&(0,fe.jsxs)("span",{className:"order-id-badge",children:[" #",qn.id]})]})}),Oc>0&&(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"4px 10px",marginLeft:"0.5rem",background:Dc?"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)":"linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)",border:"2px solid ".concat(Dc?"#fca5a5":"#bbf7d0"),borderRadius:"6px",fontSize:"0.75rem",fontWeight:600,color:Dc?"#991b1b":"#166534",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",whiteSpace:"nowrap"},children:[(0,fe.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1px",alignItems:"flex-start"},children:[(0,fe.jsx)("div",{style:{fontSize:"0.6rem",opacity:.8,fontWeight:500},children:"MAX CENA"}),(0,fe.jsxs)("div",{style:{fontSize:"0.85rem",fontWeight:700},children:[Oc.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"]})]}),(0,fe.jsx)("div",{style:{fontSize:"14px",fontWeight:"bold",opacity:.5},children:"\u2192"}),(0,fe.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1px",alignItems:"flex-end"},children:[(0,fe.jsx)("div",{style:{fontSize:"0.6rem",opacity:.8,fontWeight:500},children:"SOU\u010cET POLO\u017dEK"}),(0,fe.jsxs)("div",{style:{fontSize:"0.85rem",fontWeight:700},children:[Nc.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"]})]})]})]}),(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[(0,fe.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"2px"},children:os?"EV. \u010c\xcdSLO":"P\u0158EDPOKL\xc1DAN\xc9 EV. \u010c\xcdSLO"}),(ti||ri||di)&&(0,fe.jsx)("div",{style:{fontSize:"10px",color:"#666",padding:"2px 6px",borderRadius:"4px",textAlign:"right",backgroundColor:ri?"#fef2f2":"database"===di?"#eff6ff":"concept"===di?"#fefbf2":"#f0fdf4",border:"1px solid ".concat(ri?"#fca5a5":"database"===di?"#bfdbfe":"concept"===di?"#fed7aa":"#bbf7d0"),transition:"all 0.2s ease"},children:ri?(0,fe.jsx)("span",{style:{color:"#dc2626"},children:"\u23f3 Ukl\xe1d\xe1n\xed konceptu..."}):"database"===di?(0,fe.jsx)("span",{style:{color:"#2563eb"},children:"\ud83d\udcbe Na\u010dteno z DB"}):"concept"===di?(0,fe.jsx)("span",{style:{color:"#d97706"},children:"\ud83d\udcdd Formul\xe1\u0159 na\u010dten z Konceptu"}):ti?(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsxs)("span",{style:{color:"#16a34a"},children:["\u2713 ",os?"Ulo\u017eeno":"Koncept"]})," ",new Date(ti).toLocaleTimeString("cs-CZ",{hour:"2-digit",minute:"2-digit",second:"2-digit"})]}):null})]}),(0,fe.jsx)(rd,{children:(0,fe.jsx)(sd,{$isEmergency:qn.mimoradna_udalost||!1,children:on?(0,fe.jsxs)("span",{style:{color:"#666",fontStyle:"italic",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsx)(td,{}),"Na\u010d\xedt\xe1m..."]}):Lc(qn.ev_cislo)?"object"===typeof qn.ev_cislo?(null===(G=qn.ev_cislo)||void 0===G?void 0:G.next_order_string)||(null===(q=qn.ev_cislo)||void 0===q?void 0:q.order_number_string)||(null===(Y=qn.ev_cislo)||void 0===Y?void 0:Y.next_number)||"Na\u010d\xedt\xe1m...":qn.ev_cislo||"Na\u010d\xedt\xe1m...":(0,fe.jsxs)("span",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#d97706"},children:[(0,fe.jsx)(p.g,{icon:u.zpE,style:{color:"#f59e0b"}}),(0,fe.jsx)("span",{style:{fontSize:"13px"},children:"Na\u010d\xedt\xe1n\xed selhalo"}),(0,fe.jsx)(id,{onClick:e=>{e.preventDefault(),e.stopPropagation(),Hc()},title:"Zkusit na\u010d\xedst ev. \u010d\xedslo znovu",children:"\u21bb Zkusit znovu"})]})})})]})]}),(()=>{const e=Mr.find(e=>e.kod_stavu===qn.zpusob_financovani||e.kod===qn.zpusob_financovani),n=(null===e||void 0===e?void 0:e.nazev_stavu)||(null===e||void 0===e?void 0:e.nazev)||"";return(n.includes("Limitovan")||n.includes("p\u0159\xedslib"))&&Array.isArray(qn.lp_kod)&&qn.lp_kod.length>0?(0,fe.jsx)("div",{style:{marginTop:"0.75rem",marginBottom:"3px",padding:"0.5rem 0.75rem",background:"linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)",border:"1px solid #93c5fd",borderRadius:"6px",fontSize:"0.7rem",display:"flex",flexWrap:"wrap",gap:"0.5rem",alignItems:"center"},children:qn.lp_kod.map(e=>{const n=ci[e];if(!n)return null;let a,o,t;if(aa<=2){const e=parseFloat(qn.max_cena_s_dph)||0,i=qn.lp_kod.length,r=i>0?e/i:0;a=parseFloat(n.zbyva_rezervace||0)-r,t=r,o="Rezervace"}else aa>=3&&aa<=6?(a=parseFloat(n.zbyva_predpoklad||0),o="P\u0159edpoklad"):(a=parseFloat(n.zbyva_skutecne||0),o="Skute\u010dn\xe9");const i=a<0,r=Zr.find(n=>(n.id||n.kod)===e),s=(null===r||void 0===r?void 0:r.cislo_lp)||e,d=(null===r||void 0===r?void 0:r.nazev_uctu)||(null===r||void 0===r?void 0:r.nazev)||"",l=null===n||void 0===n?void 0:n.spravce,c=l?"".concat(l.jmeno||""," ").concat(l.prijmeni||"").trim():"",p=[d?"".concat(s," - ").concat(d):s,c?"PO: ".concat(c):""].filter(Boolean).join("\n");return(0,fe.jsxs)("div",{style:{padding:"0.3rem 0.6rem",background:i?"#fee2e2":"white",border:"1px solid ".concat(i?"#fca5a5":"#bfdbfe"),borderRadius:"4px",display:"flex",alignItems:"center",gap:"0.4rem",fontSize:"0.7rem"},children:[(0,fe.jsx)("div",{style:{fontWeight:700,color:"#1e40af",fontSize:"0.7rem",cursor:"help"},title:p,children:s}),(0,fe.jsxs)("div",{style:{fontWeight:700,color:i?"#dc2626":"#059669",fontSize:"0.7rem"},children:[a<0&&"\u2212",Math.abs(a).toLocaleString("cs-CZ",{minimumFractionDigits:0,maximumFractionDigits:0})," K\u010d"]}),aa<=2&&t>0&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsxs)("div",{style:{fontSize:"0.65rem",opacity:.7,color:"#64748b"},children:["\u2212",t.toLocaleString("cs-CZ",{minimumFractionDigits:0,maximumFractionDigits:0})," K\u010d"]}),(0,fe.jsx)("div",{style:{fontSize:"0.65rem",opacity:.7,color:"#64748b",cursor:"help"},title:"Rezervace - MAX CENA rozd\u011blen\xe1 pom\u011brn\u011b mezi vybran\xe1 LP",children:"(R)"})]}),aa>=3&&(0,fe.jsxs)("div",{style:{fontSize:"0.65rem",opacity:.7,color:"#64748b",cursor:"help"},title:aa>=3&&aa<=6?"P\u0159edpokl\xe1dan\xe9 \u010derp\xe1n\xed podle p\u0159i\u0159azen\xfdch polo\u017eek":"Skute\u010dn\xe9 \u010derp\xe1n\xed podle faktur",children:["(",aa>=3&&aa<=6?"P":"S",")"]})]},e)})}):null})(),va?(0,fe.jsxs)("div",{style:{padding:"1rem 1.5rem",marginTop:"1rem",backgroundColor:"#fee2e2",border:"2px solid #dc2626",borderRadius:"8px",display:"flex",alignItems:"flex-start",gap:"1rem",fontWeight:"600",color:"#991b1b"},children:[(0,fe.jsx)(b.A,{size:20,style:{marginTop:"0.25rem",flexShrink:0}}),(0,fe.jsxs)("div",{style:{flex:1},children:[(0,fe.jsx)("div",{style:{marginBottom:"0.5rem",fontSize:"1.1rem"},children:"\u274c Objedn\xe1vka zam\xedtnuta"}),qn.schvaleni_komentar&&(0,fe.jsxs)("div",{style:{fontWeight:"normal",fontSize:"0.875rem",marginBottom:"0.5rem"},children:[(0,fe.jsx)("strong",{children:"D\u016fvod zam\xedtnut\xed:"})," ",qn.schvaleni_komentar]}),qn.schvalovatel_id&&(0,fe.jsxs)("div",{style:{fontWeight:"normal",fontSize:"0.875rem"},children:[(0,fe.jsx)("strong",{children:"Zam\xedtl:"})," ",Pc(qn.schvalovatel_id),qn.dt_schvaleni&&" \u2022 ".concat(new Date(qn.dt_schvaleni).toLocaleDateString("cs-CZ")," ").concat(new Date(qn.dt_schvaleni).toLocaleTimeString("cs-CZ",{hour:"2-digit",minute:"2-digit"}))]})]}),(0,fe.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",flexShrink:0},children:[(0,fe.jsxs)(ad,{className:"cancel-btn",onClick:$p,title:"Zav\u0159\xedt formul\xe1\u0159 a vr\xe1tit se na seznam objedn\xe1vek",style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#dc2626",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",whiteSpace:"nowrap",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#b91c1c",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#dc2626",children:[(0,fe.jsx)(p.g,{icon:u.GRI}),"Zav\u0159\xedt"]}),gs&&(0,fe.jsxs)(ad,{onClick:e=>{e.stopPropagation(),Yi(!0)},title:"Odemknout zam\xedtnutou objedn\xe1vku (vr\xe1tit na F\xc1ZI 2 - ODESLANA_KE_SCHVALENI)",style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",whiteSpace:"nowrap",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#d97706",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#f59e0b",children:[(0,fe.jsx)(x,{size:16}),"Odemknout"]})]})]}):_a?(0,fe.jsxs)("div",{style:{padding:"1rem 1.5rem",marginTop:"1rem",backgroundColor:"#fff7ed",border:"2px solid #f97316",borderRadius:"8px",display:"flex",alignItems:"flex-start",gap:"1rem",fontWeight:"600",color:"#9a3412"},children:[(0,fe.jsx)(b.A,{size:20,style:{marginTop:"0.25rem",flexShrink:0}}),(0,fe.jsxs)("div",{style:{flex:1},children:[(0,fe.jsx)("div",{style:{marginBottom:"0.5rem",fontSize:"1.1rem"},children:"\ud83d\udeab Objedn\xe1vka stornov\xe1na"}),qn.odeslani_storno_duvod&&(0,fe.jsxs)("div",{style:{fontWeight:"normal",fontSize:"0.875rem",marginBottom:"0.5rem"},children:[(0,fe.jsx)("strong",{children:"D\u016fvod stornov\xe1n\xed:"})," ",qn.odeslani_storno_duvod]}),qn.odesilatel_id&&(0,fe.jsxs)("div",{style:{fontWeight:"normal",fontSize:"0.875rem"},children:[(0,fe.jsx)("strong",{children:"Stornoval:"})," ",Pc(qn.odesilatel_id),qn.dt_odeslani&&" \u2022 ".concat(new Date(qn.dt_odeslani).toLocaleDateString("cs-CZ")," ").concat(new Date(qn.dt_odeslani).toLocaleTimeString("cs-CZ",{hour:"2-digit",minute:"2-digit"}))]})]}),(0,fe.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",flexShrink:0},children:[(0,fe.jsxs)(ad,{className:"cancel-btn",onClick:$p,title:"Zav\u0159\xedt formul\xe1\u0159 a vr\xe1tit se na seznam objedn\xe1vek",style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",whiteSpace:"nowrap",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#ea580c",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#f97316",children:[(0,fe.jsx)(p.g,{icon:u.GRI}),"Zav\u0159\xedt"]}),gs&&(0,fe.jsxs)(ad,{className:"unlock-btn",onClick:()=>pr(!0),title:"Odemknout stornovanou objedn\xe1vku",style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",whiteSpace:"nowrap",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#ea580c",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#f97316",children:[(0,fe.jsx)(x,{size:16}),"Odemknout"]})]})]}):ua?(0,fe.jsxs)("div",{style:{padding:"1rem 1.5rem",marginTop:"1rem",backgroundColor:"#dcfce7",border:"2px solid #16a34a",borderRadius:"8px",display:"flex",alignItems:"flex-start",gap:"1rem",fontWeight:"600",color:"#166534"},children:[(0,fe.jsx)(b.A,{size:20,style:{marginTop:"0.25rem",flexShrink:0}}),(0,fe.jsxs)("div",{style:{flex:1},children:[(0,fe.jsx)("div",{style:{marginBottom:"0.5rem"},children:"\u2705 Objedn\xe1vka byla \xfasp\u011b\u0161n\u011b dokon\u010dena. V\u0161echny kroky byly spln\u011bny."}),qn.dokoncil_id&&(0,fe.jsxs)("div",{style:{fontWeight:"normal",fontSize:"0.875rem"},children:[(0,fe.jsx)("strong",{children:"Dokon\u010dil:"})," ",Pc(qn.dokoncil_id),qn.dt_dokonceni&&" \u2022 ".concat(new Date(qn.dt_dokonceni).toLocaleDateString("cs-CZ")," ").concat(new Date(qn.dt_dokonceni).toLocaleTimeString("cs-CZ",{hour:"2-digit",minute:"2-digit"}))]})]}),(0,fe.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",flexShrink:0},children:[(0,fe.jsxs)(ad,{className:"cancel-btn",onClick:$p,title:"Zav\u0159\xedt formul\xe1\u0159 a vr\xe1tit se na seznam objedn\xe1vek",style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",whiteSpace:"nowrap",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#15803d",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#16a34a",children:[(0,fe.jsx)(p.g,{icon:u.GRI}),"Zav\u0159\xedt"]}),gs&&(0,fe.jsxs)(ad,{onClick:e=>{e.stopPropagation(),lr(!0)},title:"Odemknout dokon\u010denou objedn\xe1vku (vr\xe1tit na F\xc1ZI 8 - ZKONTROLOVANA)",style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",whiteSpace:"nowrap",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#d97706",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#f59e0b",children:[(0,fe.jsx)(x,{size:16}),"Odemknout"]})]})]}):(0,fe.jsxs)(Js,{children:[(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"2rem",flex:1},children:[(0,fe.jsxs)(Gs,{children:[(0,fe.jsx)(qs,{children:(()=>{if(qn.stav_stornovano||ca(qn.stav_workflow_kod,"ZRUSENA"))return"Stornovan\xe1 objedn\xe1vka";return{1:ba?"F\xe1ze 1/8: Koncept":"F\xe1ze 1/8: Nov\xe1 objedn\xe1vka",2:"F\xe1ze 2/8: Ke schv\xe1len\xed",3:"F\xe1ze 3/8: Schv\xe1len\xe1 objedn\xe1vka",4:"F\xe1ze 4/8: Dodavatel + Registr",5:"F\xe1ze 5/8: Vypln\u011bn\xed registru",6:"F\xe1ze 6/8: Fakturace",7:"F\xe1ze 7/8: V\u011bcn\xe1 spr\xe1vnost",8:"F\xe1ze 8/8: Zkontrolov\xe1no"}[aa]||(ba?"F\xe1ze 1/8: Koncept":"F\xe1ze 1/8: Nov\xe1 objedn\xe1vka")})()}),(0,fe.jsx)(Ys,{children:ga.phases.map((e,n)=>(0,fe.jsx)(Xs,{children:(0,fe.jsx)(Qs,{className:e.fillClass,style:{opacity:e.isVisible?1:.15,transform:e.isVisible?"scaleX(1)":"scaleX(0.1)",transformOrigin:"left"}})},e.id))})]}),(()=>{const e=Mr.find(e=>e.kod===qn.zpusob_financovani);return((null===e||void 0===e?void 0:e.nazev)||"").includes("Smlouva")})()&&qn.cislo_smlouvy&&hi&&!hi.notFound&&!gi&&(()=>{const e=parseFloat(hi.hodnota_s_dph||hi.celkova_castka||0),n=parseFloat(hi.cerpano_celkem||hi.cerpano||0);let a=0;const o=qn.id&&qn.id>0,t=aa>=7;if(!o||!t){const e=aa>=3&&aa<=6;aa<=2?a=parseFloat(qn.max_cena_s_dph||0):e?(qn.polozky_objednavky&&Array.isArray(qn.polozky_objednavky)&&qn.polozky_objednavky.length>0&&(a=qn.polozky_objednavky.reduce((e,n)=>e+(parseFloat((n.cena_s_dph||n.celkova_cena||"0").toString().replace(/[^\d,.-]/g,"").replace(",","."))||0)*parseFloat(n.mnozstvi||1),0)),0===a&&(a=parseFloat(qn.max_cena_s_dph||0))):t&&qn.faktury&&Array.isArray(qn.faktury)&&(a=qn.faktury.reduce((e,n)=>e+parseFloat(n.celkova_castka||n.castka||0),0))}const i=e-n-a,r=i<0;return(0,fe.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"4px 10px",background:r?"linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)":"linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)",border:"2px solid ".concat(r?"#fca5a5":"#86efac"),borderRadius:"6px",fontSize:"0.75rem",fontWeight:600,color:r?"#991b1b":"#15803d",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",whiteSpace:"nowrap"},children:(0,fe.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1px",alignItems:"flex-end"},children:[(0,fe.jsxs)("div",{style:{fontSize:"0.6rem",opacity:.8,fontWeight:500},children:["SMLOUVA ",qn.cislo_smlouvy]}),(0,fe.jsxs)("div",{style:{fontSize:"0.85rem",fontWeight:700},children:[Math.abs(i).toLocaleString("cs-CZ",{minimumFractionDigits:0,maximumFractionDigits:0})," K\u010d"]})]})})})()]}),(0,fe.jsx)(ed,{}),(0,fe.jsxs)(nd,{children:[(0,fe.jsxs)(ad,{className:"save-btn",onClick:async()=>{Ic("info","SAVE","order-save-start","Za\u010d\xedn\xe1m ukl\xe1d\xe1n\xed objedn\xe1vky..."),await Jc()},disabled:Qt||gt||!ms||ua&&!gs||on||!Lc(qn.ev_cislo),title:on?"Na\u010d\xedt\xe1 se eviden\u010dn\xed \u010d\xedslo...":Lc(qn.ev_cislo)?ua&&!gs?"Objedn\xe1vka je dokon\u010dena/zam\xedtnuta/stornov\xe1na a uzam\u010dena":ms?"Ulo\u017eit objedn\xe1vku":"Nem\xe1te opr\xe1vn\u011bn\xed k ukl\xe1d\xe1n\xed objedn\xe1vek":"Eviden\u010dn\xed \u010d\xedslo se nepoda\u0159ilo na\u010d\xedst",children:[(0,fe.jsx)(p.g,{icon:u.hSh}),on?"Na\u010d\xedt\xe1m \u010d\xedslo...":Qt?"Ukl\xe1d\xe1m...":"ULO\u017dIT"]}),(0,fe.jsxs)(ad,{className:"cancel-btn",onClick:$p,title:"Zav\u0159\xedt formul\xe1\u0159",disabled:gt||Qt,children:[(0,fe.jsx)(p.g,{icon:u.GRI}),"ZAV\u0158\xcdT"]})]})]}),gt&&(0,fe.jsxs)("div",{style:{padding:"1rem",backgroundColor:"#f0f9ff",borderTop:"1px solid #0ea5e9",borderBottom:"1px solid #0ea5e9"},children:[(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"0.75rem"},children:[(0,fe.jsx)("div",{style:{fontSize:"1.5rem"},children:"\u2705"}),(0,fe.jsxs)("div",{children:[(0,fe.jsx)("div",{style:{fontWeight:"600",color:"#0c4a6e",fontSize:"1rem",marginBottom:"0.25rem"},children:"Objedn\xe1vka byla \xfasp\u011b\u0161n\u011b ulo\u017eena!"}),(0,fe.jsx)("div",{style:{color:"#075985",fontSize:"0.875rem"},children:jt})]})]}),(0,fe.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"#e0f2fe",borderRadius:"4px",overflow:"hidden"},children:(0,fe.jsx)("div",{style:{width:"".concat(yt,"%"),height:"100%",backgroundColor:"#0ea5e9",transition:"width 2s linear",borderRadius:"4px"}})}),(0,fe.jsx)("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"#0369a1",textAlign:"center"},children:"P\u0159esm\u011brov\xe1v\xe1m na seznam objedn\xe1vek..."})]})]})}),(0,fe.jsx)(Zs,{ref:np,onKeyDown:su,children:(0,fe.jsxs)(Bs,{children:[(0,fe.jsxs)(dd,{"data-section":"objednatel",children:[(0,fe.jsxs)(ld,{sectionTheme:is("objednatel"),isActive:ss("objednatel"),children:[(0,fe.jsxs)(cd,{sectionTheme:is("objednatel"),children:[(0,fe.jsx)(pd,{sectionTheme:is("objednatel"),children:(0,fe.jsx)(p.g,{icon:u.X46})}),"Informace o objednateli",Ts&&!mc&&(0,fe.jsx)(_d,{title:"F\xc1ZE 1 a F\xc1ZE 2 sekce jsou zam\u010deny pokud je aktivn\xed F\xc1ZE 3. Odem\u010den\xed resetuje workflow na ODESL\xc1NA KE SCHV\xc1LEN\xcd a vyma\u017ee data F\xc1ZE 3+.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,fe.jsxs)(vd,{children:[Ts&&!mc&&us&&(0,fe.jsx)(Qd,{onClick:e=>{e.stopPropagation(),Gi(!0)},title:"Odemknout F\xc1ZI 2 (Info o objednateli) - resetuje workflow na ODESL\xc1NA KE SCHV\xc1LEN\xcd",children:(0,fe.jsx)(x,{})}),(0,fe.jsx)(ud,{collapsed:Ge.objednatel,sectionTheme:is("objednatel"),onClick:()=>sp("objednatel"),style:{cursor:"pointer"},children:(0,fe.jsx)(p.g,{icon:u.w2A})})]})]}),(0,fe.jsxs)(md,{collapsed:Ge.objednatel,children:[(0,fe.jsxs)(gd,{children:[(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"JM\xc9NO"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(j.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"jmeno",placeholder:"Jm\xe9no objednatele",value:qn.jmeno||"",disabled:!0,title:Wn?"Na\u010dteno z DB podle objednatele objedn\xe1vky":qn.jmeno?"Na\u010dteno z profilu p\u0159ihl\xe1\u0161en\xe9ho u\u017eivatele":"Vypln\xed se automaticky p\u0159i prvn\xed interakci",hasError:!!wo.jmeno,hasIcon:!0})]}),wo.jmeno&&(0,fe.jsx)(yd,{children:wo.jmeno})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"E-MAIL"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(z.A,{}),(0,fe.jsx)(Sd,{type:"email",name:"email",value:qn.email||"",disabled:!0,title:Wn?"Na\u010dteno z DB podle objednatele objedn\xe1vky":qn.email?"Na\u010dteno z profilu p\u0159ihl\xe1\u0161en\xe9ho u\u017eivatele":"Vypln\xed se automaticky p\u0159i prvn\xed interakci",hasError:!!wo.email,hasIcon:!0})]}),wo.email&&(0,fe.jsx)(yd,{children:wo.email})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{children:"TELEFON"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(A.A,{}),(0,fe.jsx)(Sd,{type:"tel",value:qn.telefon||"",disabled:!0,placeholder:qn.telefon?"":Wn?"Telefon nen\xed v DB uveden":"Vypln\xed se automaticky p\u0159i prvn\xed interakci",title:Wn?"Na\u010dteno z DB podle objednatele objedn\xe1vky":qn.telefon?"Na\u010dteno z profilu p\u0159ihl\xe1\u0161en\xe9ho u\u017eivatele":"Vypln\xed se automaticky p\u0159i prvn\xed interakci",hasIcon:!0})]})]})]}),(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{"data-custom-select":!0,children:[(0,fe.jsxs)(jd,{children:[(0,fe.jsx)(zd,{required:!0,children:"GARANT"}),(0,fe.jsx)(Ad,{type:"button",$visible:!!qn.garant_uzivatel_id,onClick:()=>Rp("garant_uzivatel_id",""),title:"Vymazat v\xfdb\u011br",children:(0,fe.jsx)(w.A,{size:12})})]}),(0,fe.jsx)(Uc,{value:qn.garant_uzivatel_id||"",onChange:e=>Rp("garant_uzivatel_id",e),onBlur:(e,n)=>rp("garant_uzivatel_id",n),options:Gr,placeholder:"Vyberte garanta",disabled:Ts,hasError:!!wo.garant_uzivatel_id,required:!0,field:"garant",loading:!1,loadingText:"",icon:(0,fe.jsx)(j.A,{}),getOptionLabel:ru,getOptionValue:(e,n)=>e.id||e.user_id||e,hasTriedToSubmit:Eo}),(wo.garant_uzivatel_id||Eo&&!qn.garant_uzivatel_id)&&(0,fe.jsx)(yd,{children:wo.garant_uzivatel_id||"Garant je povinn\xfd"})]})})]})]}),(0,fe.jsxs)(dd,{"data-section":"schvaleni",children:[(0,fe.jsxs)(ld,{sectionTheme:is("schvaleni"),isActive:ss("schvaleni"),children:[(0,fe.jsxs)(cd,{sectionTheme:is("schvaleni"),children:[(0,fe.jsx)(pd,{sectionTheme:is("schvaleni"),children:(0,fe.jsx)(p.g,{icon:u.Iae})}),"Schv\xe1len\xed n\xe1kupu PO",Ts&&!mc&&(0,fe.jsx)(_d,{title:"F\xc1ZE 1 a F\xc1ZE 2 sekce jsou zam\u010deny pokud je aktivn\xed F\xc1ZE 3. Odem\u010den\xed umo\u017en\xed editaci F\xc1ZE 1 a 2.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,fe.jsxs)(vd,{children:[Ts&&!mc&&us&&(0,fe.jsx)(Qd,{onClick:e=>{e.stopPropagation(),Yi(!0)},title:"Odemknout F\xc1ZI 2 (PO sekce) - resetuje workflow na ODESL\xc1NA KE SCHV\xc1LEN\xcd",children:(0,fe.jsx)(x,{})}),(0,fe.jsx)(ud,{collapsed:Ge.schvaleni,sectionTheme:is("schvaleni"),onClick:()=>sp("schvaleni"),style:{cursor:"pointer"},children:(0,fe.jsx)(p.g,{icon:u.w2A})})]})]}),(0,fe.jsxs)(md,{collapsed:Ge.schvaleni,children:[(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsx)(xd,{required:!0,children:"P\u0158EDM\u011aT"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(S.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"predmet",placeholder:"Zadejte p\u0159edm\u011bt objedn\xe1vky",value:qn.predmet||"",onChange:e=>Rp("predmet",e.target.value),onBlur:()=>rp("predmet",qn.predmet),disabled:Ts,hasError:!!wo.predmet,hasIcon:!0})]}),wo.predmet&&(0,fe.jsx)(yd,{children:wo.predmet})]})}),(0,fe.jsxs)(gd,{children:[(0,fe.jsxs)(bd,{"data-custom-select":!0,children:[(0,fe.jsxs)(jd,{children:[(0,fe.jsx)(zd,{required:!0,children:"SCHVALOVATEL/P\u0158\xcdKAZCE"}),(0,fe.jsx)(Ad,{type:"button",$visible:!!qn.prikazce_id,onClick:()=>Rp("prikazce_id",""),title:"Vymazat v\xfdb\u011br",children:(0,fe.jsx)(w.A,{size:12})})]}),(0,fe.jsx)(Uc,{value:qn.prikazce_id||"",onChange:e=>Rp("prikazce_id",e),onBlur:(e,n)=>rp("prikazce_id",n),options:Yr,placeholder:"Vyberte p\u0159\xedkazce operace",disabled:Ts,hasError:!!wo.prikazce_id,required:!0,field:"prikazce",loading:!1,loadingText:"",icon:(0,fe.jsx)(E.A,{}),getOptionLabel:ru,getOptionValue:(e,n)=>e.id||e.user_id||e,hasTriedToSubmit:Eo}),(wo.prikazce_id||Eo&&!qn.prikazce_id)&&(0,fe.jsx)(yd,{children:wo.prikazce_id||"P\u0159\xedkazce je povinn\xfd"})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"MAXIM\xc1LN\xcd CENA S DPH"}),(0,fe.jsx)(sc,{fieldName:"max_cena_s_dph",value:qn.max_cena_s_dph||"",onChange:(e,n)=>{const a=(e=>{if(!e)return"";let n=e.replace(/\s/g,"").replace(/K\u010d/g,"");n.includes(",")&&(n=n.replace(",","."));const a=parseFloat(n);return isNaN(a)?"":a.toString()})(n);Xn(n=>(0,t.A)((0,t.A)({},n),{},{[e]:a})),ya(!0)},onBlur:rp,disabled:Ts,hasError:!!wo.max_cena_s_dph,placeholder:"380 000 K\u010d"}),wo.max_cena_s_dph&&(0,fe.jsx)(yd,{children:wo.max_cena_s_dph})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{children:"MIMO\u0158\xc1DN\xc1 UD\xc1LOST"}),(0,fe.jsxs)(fd,{disabled:Ts,style:{height:"50px"},children:[(0,fe.jsxs)(hd,{checked:qn.mimoradna_udalost||!1,disabled:Ts,children:[(0,fe.jsx)("input",{type:"checkbox",checked:qn.mimoradna_udalost||!1,onChange:e=>Rp("mimoradna_udalost",e.target.checked),disabled:Ts}),(0,fe.jsx)("span",{})]}),(0,fe.jsx)(kd,{checked:qn.mimoradna_udalost||!1,children:qn.mimoradna_udalost?"Krize / Hav\xe1rie":"B\u011b\u017en\xe1 objedn\xe1vka"})]})]})]}),(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{"data-custom-select":!0,style:{gridColumn:"1 / -1"},children:[(0,fe.jsxs)(jd,{children:[(0,fe.jsx)(zd,{required:!0,children:"ST\u0158EDISKO"}),(0,fe.jsx)(Ad,{type:"button",$visible:Array.isArray(qn.strediska_kod)&&qn.strediska_kod.length>0,onClick:()=>Rp("strediska_kod",[]),title:"Vymazat v\xfdb\u011br",children:(0,fe.jsx)(w.A,{size:12})})]}),(0,fe.jsx)(Uc,{value:qn.strediska_kod||[],onChange:e=>Rp("strediska_kod",e),onBlur:(e,n)=>rp("strediska_kod",n),options:Fr,placeholder:"Vyberte st\u0159ediska pro objedn\xe1vku",field:"strediska",disabled:Ts,hasError:!!wo.strediska_kod,required:!0,multiple:!0,icon:(0,fe.jsx)(C.A,{}),getOptionLabel:ru,getOptionValue:(e,n)=>e.value||e.id||e,hasTriedToSubmit:Eo}),wo.strediska_kod&&(0,fe.jsx)(yd,{style:{marginTop:"0.5rem",display:"block"},children:wo.strediska_kod})]})}),(0,fe.jsx)(gd,{style:{marginTop:"1.5rem"},children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsx)("div",{style:{borderTop:"1px solid #d1d5db",marginBottom:"1.5rem"}}),(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsxs)(jd,{children:[(0,fe.jsx)(zd,{required:!0,children:"ZP\u016eSOB FINANCOV\xc1N\xcd"}),(0,fe.jsx)(Ad,{type:"button",$visible:!!qn.zpusob_financovani,onClick:()=>Rp("zpusob_financovani",""),title:"Vymazat v\xfdb\u011br",children:(0,fe.jsx)(w.A,{size:12})})]}),(0,fe.jsx)(Uc,{value:qn.zpusob_financovani||"",onChange:e=>Rp("zpusob_financovani",e),onBlur:(e,n)=>rp("zpusob_financovani",n),options:Mr,placeholder:"Vyberte zdroj financov\xe1n\xed...",field:"zpusob_financovani",loading:!1,loadingText:"",icon:(0,fe.jsx)(N.A,{}),disabled:ic,hasError:!!wo.zpusob_financovani,required:!0,getOptionLabel:ru,getOptionValue:(e,n)=>e.kod_stavu||e.kod||e.id||e}),wo.zpusob_financovani&&(0,fe.jsx)(yd,{children:wo.zpusob_financovani})]})}),(()=>{const e=Mr.find(e=>e.kod_stavu===qn.zpusob_financovani||e.kod===qn.zpusob_financovani),n=(null===e||void 0===e?void 0:e.nazev_stavu)||(null===e||void 0===e?void 0:e.nazev)||"";return n.includes("Limitovan")||n.includes("p\u0159\xedslib")})()&&(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsxs)(jd,{children:[(0,fe.jsx)(zd,{required:!0,children:"LP K\xd3D"}),(0,fe.jsx)(Ad,{type:"button",$visible:Array.isArray(qn.lp_kod)&&qn.lp_kod.length>0,onClick:()=>Rp("lp_kod",[]),title:"Vymazat v\xfdb\u011br",children:(0,fe.jsx)(w.A,{size:12})})]}),(0,fe.jsx)(Uc,{value:qn.lp_kod||[],onChange:e=>Rp("lp_kod",e),onBlur:(e,n)=>rp("lp_kod",n),options:bs,placeholder:(()=>{if(!qn.prikazce_id)return"Nejprve vyberte p\u0159\xedkazce";if(0===bs.length)return"\u017d\xe1dn\xe9 dostupn\xe9 LP k\xf3dy";const e=bs.slice(0,5).map(e=>e.cislo_lp||e.kod).join(", ");return bs.length>5?"nap\u0159. ".concat(e,", ..."):"nap\u0159. ".concat(e)})(),field:"lp_kod",loading:!1,loadingText:"",icon:(0,fe.jsx)(O.A,{}),disabled:ic||!qn.prikazce_id,hasError:!!wo.lp_kod,required:!0,multiple:!0,getOptionLabel:ru}),wo.lp_kod&&(0,fe.jsx)(yd,{children:wo.lp_kod})]})}),(()=>{const e=Mr.find(e=>e.kod===qn.zpusob_financovani);return((null===e||void 0===e?void 0:e.nazev)||"").includes("Smlouva")})()&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsxs)(gd,{style:{gridTemplateColumns:"1fr 2fr"},children:[(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"\u010c\xcdSLO SMLOUVY"}),(0,fe.jsxs)(Cd,{children:[(0,fe.jsxs)(wd,{hasIcon:!0,style:!qn.cislo_smlouvy||!hi||hi.notFound||"VYPRSELA"!==hi.stav&&"UKONCENA"!==hi.stav?{}:{border:"2px solid #f97316",borderRadius:"6px"},children:[(0,fe.jsx)(g.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"cislo_smlouvy",placeholder:"Za\u010dn\u011bte ps\xe1t \u010d\xedslo smlouvy...",value:yi,onChange:e=>{const n=e.target.value;xi(n),zi(n.length>0),wi(-1),n||Rp("cislo_smlouvy","")},onKeyDown:e=>{if(!ji)return;const n=Ls(yi),a=vi.filter(e=>{if(0==e.aktivni||!1===e.aktivni)return!1;const a=Ls(e.cislo_smlouvy||e.evidencni_cislo||""),o=Ls(e.nazev_smlouvy||e.predmet||""),t=Ls(e.nazev_firmy||""),i=Ls(e.ico||""),r=Ls(e.usek_zkr||"");return a.includes(n)||o.includes(n)||t.includes(n)||i.includes(n)||r.includes(n)}).slice(0,10);if("ArrowDown"===e.key)e.preventDefault(),wi(e=>e<a.length-1?e+1:e);else if("ArrowUp"===e.key)e.preventDefault(),wi(e=>e>0?e-1:-1);else if("Enter"===e.key&&Ai>=0){e.preventDefault();const n=a[Ai];if(n){const e=n.cislo_smlouvy||n.evidencni_cislo;Rp("cislo_smlouvy",e),xi(e),zi(!1),wi(-1)}}else"Escape"===e.key&&(zi(!1),wi(-1))},onFocus:()=>{yi&&yi.length>0&&zi(!0)},onBlur:e=>{setTimeout(()=>{zi(!1),wi(-1);const e=yi.trim();if(e){vi.some(n=>0!==n.aktivni&&!1!==n.aktivni&&(n.cislo_smlouvy===e||n.evidencni_cislo===e))?qn.cislo_smlouvy!==e&&Rp("cislo_smlouvy",e):(Rp("cislo_smlouvy",""),xi(""),ze("Vyberte pros\xedm smlouvu ze seznamu","warning"))}},200)},disabled:ic,hasError:!!wo.cislo_smlouvy,hasIcon:!0})]}),ji&&yi&&yi.length>0&&(0,fe.jsx)(Nd,{children:(()=>{const e=Ls(yi),n=vi.filter(n=>{if(0==n.aktivni||!1===n.aktivni)return!1;const a=Ls(n.cislo_smlouvy||n.evidencni_cislo||""),o=Ls(n.nazev_smlouvy||n.predmet||""),t=Ls(n.nazev_firmy||""),i=Ls(n.ico||""),r=Ls(n.usek_zkr||"");return a.includes(e)||o.includes(e)||t.includes(e)||i.includes(e)||r.includes(e)}).slice(0,10);return mi?(0,fe.jsx)(Id,{children:"\u23f3 Na\u010d\xedt\xe1m smlouvy..."}):0===n.length?(0,fe.jsx)(Id,{children:"\u274c \u017d\xe1dn\xe1 smlouva nenalezena"}):n.map((e,n)=>{const a="VYPRSELA"===e.stav||"UKONCENA"===e.stav,o=n===Ai;return(0,fe.jsxs)(Od,{onMouseDown:n=>{n.preventDefault();const a=e.cislo_smlouvy||e.evidencni_cislo;Rp("cislo_smlouvy",a),xi(a),zi(!1),wi(-1)},style:(0,t.A)((0,t.A)({},a?{borderLeft:"3px solid #f97316",opacity:.8}:{}),o?{backgroundColor:"#eff6ff",borderLeft:"3px solid #3b82f6"}:{}),children:[(0,fe.jsxs)(Dd,{children:[e.cislo_smlouvy||e.evidencni_cislo,a&&(0,fe.jsx)("span",{style:{color:"#f97316",marginLeft:"8px",fontSize:"0.85em"},children:"\u26a0\ufe0f VYPR\u0160ELA"})]}),(0,fe.jsxs)(Td,{children:[e.nazev_smlouvy&&(0,fe.jsx)("span",{children:e.nazev_smlouvy}),e.celkova_castka&&(0,fe.jsx)("span",{children:new Intl.NumberFormat("cs-CZ",{style:"currency",currency:"CZK",minimumFractionDigits:0,maximumFractionDigits:0}).format(e.celkova_castka)})]}),e.nazev_firmy&&(0,fe.jsx)(Td,{style:{fontSize:"0.8em",color:"#6b7280",marginTop:"2px"},children:(0,fe.jsxs)("span",{children:["\ud83c\udfe2 ",e.nazev_firmy,e.ico?" (".concat(e.ico,")"):"",e.usek_zkr?" | ".concat(e.usek_zkr):""]})})]},e.id)})})()})]}),wo.cislo_smlouvy&&(0,fe.jsx)(yd,{children:wo.cislo_smlouvy})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{children:"POZN\xc1MKA KE SMLOUV\u011a"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(S.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"smlouva_poznamka",placeholder:"Dodate\u010dn\xe9 informace o smlouv\u011b",value:qn.smlouva_poznamka||"",onChange:e=>Rp("smlouva_poznamka",e.target.value),onBlur:()=>rp("smlouva_poznamka",qn.smlouva_poznamka),disabled:ic,hasError:!!wo.smlouva_poznamka,hasIcon:!0})]}),wo.smlouva_poznamka&&(0,fe.jsx)(yd,{children:wo.smlouva_poznamka})]})]}),qn.cislo_smlouvy&&hi&&!hi.notFound&&("VYPRSELA"===hi.stav||"UKONCENA"===hi.stav)&&(0,fe.jsxs)("div",{style:{marginTop:"-8px",marginBottom:"16px",padding:"8px 12px",background:"#fff7ed",border:"2px solid #f97316",borderRadius:"6px",color:"#c2410c",fontSize:"0.9rem",fontWeight:600,display:"flex",alignItems:"center",gap:"8px"},children:["\u26a0\ufe0f Smlouva ji\u017e vypr\u0161ela!!!",hi.platnost_do&&(0,fe.jsxs)("span",{style:{fontSize:"0.85rem",fontWeight:500},children:["Platnost byla do ",new Date(hi.platnost_do).toLocaleDateString("cs-CZ")]})]})]}),(()=>{const e=Mr.find(e=>e.kod===qn.zpusob_financovani),n=(null===e||void 0===e?void 0:e.nazev)||"";return n.includes("Individu\xe1ln\xed")&&!n.includes("Pojistn\xe1")})()&&(0,fe.jsxs)(gd,{style:{gridTemplateColumns:"1fr 2fr"},children:[(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"IDENTIFIK\xc1TOR SCHV\xc1LEN\xcd"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(O.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"individualni_schvaleni",placeholder:"Automaticky generov\xe1no z ev. \u010d\xedsla",value:qn.individualni_schvaleni||"",onChange:e=>Rp("individualni_schvaleni",e.target.value),disabled:!0,readOnly:!0,hasError:!!wo.individualni_schvaleni,hasIcon:!0,style:{backgroundColor:"#f3f4f6",cursor:"not-allowed"}})]}),wo.individualni_schvaleni&&(0,fe.jsx)(yd,{children:wo.individualni_schvaleni})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{children:"POZN\xc1MKA"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(S.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"individualni_poznamka",placeholder:"D\u016fvod nebo podm\xednky schv\xe1len\xed",value:qn.individualni_poznamka||"",onChange:e=>Rp("individualni_poznamka",e.target.value),disabled:ic,hasError:!!wo.individualni_poznamka,hasIcon:!0})]}),wo.individualni_poznamka&&(0,fe.jsx)(yd,{children:wo.individualni_poznamka})]})]}),(()=>{const e=Mr.find(e=>e.kod===qn.zpusob_financovani),n=(null===e||void 0===e?void 0:e.nazev)||"";return n.includes("Pojistn\xe1")&&n.includes("ud\xe1lost")})()&&(0,fe.jsxs)(gd,{style:{gridTemplateColumns:"1fr 2fr"},children:[(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"\u010c\xcdSLO POJISTN\xc9 UD\xc1LOSTI"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(O.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"pojistna_udalost_cislo",placeholder:"Eviden\u010dn\xed \u010d\xedslo \u0161kody/ud\xe1losti",value:qn.pojistna_udalost_cislo||"",onChange:e=>Rp("pojistna_udalost_cislo",e.target.value),disabled:ic,hasError:!!wo.pojistna_udalost_cislo,hasIcon:!0})]}),wo.pojistna_udalost_cislo&&(0,fe.jsx)(yd,{children:wo.pojistna_udalost_cislo})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{children:"POZN\xc1MKA K POJISTN\xc9 UD\xc1LOSTI"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(S.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"pojistna_udalost_poznamka",placeholder:"Popis \u0161kody nebo okolnost\xed ud\xe1losti",value:qn.pojistna_udalost_poznamka||"",onChange:e=>Rp("pojistna_udalost_poznamka",e.target.value),disabled:ic,hasError:!!wo.pojistna_udalost_poznamka,hasIcon:!0})]}),wo.pojistna_udalost_poznamka&&(0,fe.jsx)(yd,{children:wo.pojistna_udalost_poznamka})]})]})]})}),(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[!!qn.id&&!ca(qn.stav_workflow_kod,"NOVA")&&(ds||ls)&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)("div",{style:{borderTop:"1px solid #d1d5db",marginBottom:"1.5rem",marginTop:"1rem"}}),(0,fe.jsxs)("div",{style:{gridColumn:"1 / -1"},children:[!!qn.id&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,fe.jsx)(xd,{style:{fontSize:"1rem",fontWeight:"600",margin:0},children:"STAV SCHV\xc1LEN\xcd OBJEDN\xc1VKY"}),(()=>{const e=Qa(qn,"NOVA");return 0===Object.keys(e).length})()&&qn.stav_schvaleni&&(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsx)("span",{style:{fontWeight:"bold",color:"#374151",fontSize:"0.875rem"},children:"Schvaluje:"}),(0,fe.jsx)("span",{style:{fontWeight:"600",color:"#059669",backgroundColor:"#d1fae5",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.875rem"},children:Pc(we)})]})]}),(0,fe.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:"ceka_se"===qn.stav_schvaleni?"#fef3c7":"#f9fafb",cursor:od?"not-allowed":"pointer",opacity:od?.6:1,marginBottom:"1rem",fontSize:"1rem",fontWeight:"500",color:"ceka_se"===qn.stav_schvaleni?"#f59e0b":"#374151",pointerEvents:od?"none":"auto"},onClick:e=>{e.preventDefault(),Vp("ceka_se")},children:[(0,fe.jsx)("input",{type:"radio",name:"stav_schvaleni",value:"ceka_se",checked:"ceka_se"===qn.stav_schvaleni,onChange:()=>{},disabled:od,style:{width:"20px",height:"20px",accentColor:"#f59e0b",margin:0,flexShrink:0}}),(0,fe.jsx)(p.g,{icon:u.a$,size:"lg"}),"\u010cek\xe1 se","ceka_se"===qn.stav_schvaleni&&(0,fe.jsx)("span",{style:{marginLeft:"0.5rem",fontSize:"0.875rem",color:"#f59e0b",fontWeight:"600"},children:"\u23f3"})]}),(0,fe.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:"neschvaleno"===qn.stav_schvaleni?"#fef2f2":"#f9fafb",cursor:od?"not-allowed":"pointer",opacity:od?.6:1,marginBottom:"1rem",fontSize:"1rem",fontWeight:"500",color:"neschvaleno"===qn.stav_schvaleni?"#dc2626":"#374151",pointerEvents:od?"none":"auto"},onClick:e=>{e.preventDefault(),Vp("neschvaleno")},children:[(0,fe.jsx)("input",{type:"radio",name:"stav_schvaleni",value:"neschvaleno",checked:"neschvaleno"===qn.stav_schvaleni,onChange:()=>{},disabled:od,style:{width:"20px",height:"20px",accentColor:"#dc2626",margin:0,flexShrink:0}}),(0,fe.jsx)(p.g,{icon:u.GRI,size:"lg"}),"Neschv\xe1leno","neschvaleno"===qn.stav_schvaleni&&(0,fe.jsx)("span",{style:{marginLeft:"0.5rem",fontSize:"0.875rem",color:"#dc2626",fontWeight:"600"},children:"\u2717"})]}),(0,fe.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:"schvaleno"===qn.stav_schvaleni?"#f0fdf4":"#f9fafb",cursor:od?"not-allowed":"pointer",opacity:od?.6:1,fontSize:"1rem",fontWeight:"500",color:"schvaleno"===qn.stav_schvaleni?"#15803d":"#374151",pointerEvents:od?"none":"auto"},onClick:e=>{e.preventDefault(),Vp("schvaleno")},children:[(0,fe.jsx)("input",{type:"radio",name:"stav_schvaleni",value:"schvaleno",checked:"schvaleno"===qn.stav_schvaleni,onChange:()=>{},disabled:od,style:{width:"20px",height:"20px",accentColor:"#16a34a",margin:0,flexShrink:0}}),(0,fe.jsx)(p.g,{icon:u.e68,size:"lg"}),"Schv\xe1leno","schvaleno"===qn.stav_schvaleni&&(0,fe.jsx)("span",{style:{marginLeft:"0.5rem",fontSize:"0.875rem",color:"#15803d",fontWeight:"600"},children:"\u2713"})]}),("neschvaleno"===qn.stav_schvaleni||"ceka_se"===qn.stav_schvaleni)&&(0,fe.jsxs)("div",{style:{flex:"1",minWidth:"300px"},children:[(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsxs)("label",{style:{fontWeight:"500",color:"#374151",fontSize:"0.875rem",whiteSpace:"nowrap"},children:["D\u016fvod:",(0,fe.jsx)("span",{style:{color:"#dc2626",marginLeft:"2px"},children:"*"})]}),(0,fe.jsxs)(wd,{hasIcon:!0,style:{flex:1},children:[(0,fe.jsx)(S.A,{}),(0,fe.jsx)(Sd,{type:"text",value:qn.schvaleni_komentar||"",onChange:e=>Rp("schvaleni_komentar",e.target.value),onBlur:()=>rp("schvaleni_komentar",qn.schvaleni_komentar),placeholder:"neschvaleno"===qn.stav_schvaleni?"Uve\u010fte d\u016fvod neschv\xe1len\xed...":"Uve\u010fte d\u016fvod \u010dek\xe1n\xed na schv\xe1len\xed...",hasIcon:!0,hasError:!!wo.schvaleni_komentar})]})]}),wo.schvaleni_komentar&&(0,fe.jsx)(yd,{style:{marginTop:"0.25rem"},children:wo.schvaleni_komentar})]})]}),ca(qn.stav_workflow_kod,"SCHVALENA")&&qn.stav_schvaleni&&!!qn.schvalovatel_id&&qn.dt_schvaleni&&(0,fe.jsxs)("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"schvaleno"===qn.stav_schvaleni?"#dcfce7":"neschvaleno"===qn.stav_schvaleni?"#fef2f2":"#fef3c7",border:"schvaleno"===qn.stav_schvaleni?"1px solid #16a34a":"neschvaleno"===qn.stav_schvaleni?"1px solid #f87171":"1px solid #f59e0b",borderRadius:"8px",color:"schvaleno"===qn.stav_schvaleni?"#166534":"neschvaleno"===qn.stav_schvaleni?"#991b1b":"#92400e"},children:[(0,fe.jsxs)("div",{style:{fontSize:"1rem",fontWeight:"600",marginBottom:"0.75rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsx)("span",{style:{fontSize:"1.25rem"},children:"schvaleno"===qn.stav_schvaleni?"\u2705":"neschvaleno"===qn.stav_schvaleni?"\u274c":"\u23f3"}),"schvaleno"===qn.stav_schvaleni?"Objedn\xe1vka m\xe1 stav: Schv\xe1len\xe1 objedn\xe1vka":"neschvaleno"===qn.stav_schvaleni?"Objedn\xe1vka m\xe1 stav: Zam\xedtnuta objedn\xe1vka":"Objedn\xe1vka \u010dek\xe1 na dopln\u011bn\xed podklad\u016f"]}),(0,fe.jsxs)("div",{style:{fontSize:"0.875rem",lineHeight:"1.6"},children:[(0,fe.jsxs)("div",{style:{marginBottom:"0.5rem"},children:[(0,fe.jsx)("strong",{children:"Datum schv\xe1len\xed:"})," ",(0,Za.fn)(qn.dt_schvaleni)," \u2022 ",(0,fe.jsx)("strong",{children:"schvaleno"===qn.stav_schvaleni?"Schv\xe1lil:":"neschvaleno"===qn.stav_schvaleni?"Zam\xedtl:":"Vr\xe1til:"})," ",Pc(qn.schvalovatel_id)]}),qn.schvaleni_komentar&&"schvaleno"!==qn.stav_schvaleni&&(0,fe.jsxs)("div",{children:[(0,fe.jsx)("strong",{children:"neschvaleno"===qn.stav_schvaleni?"D\u016fvod zam\xedtnut\xed:":"ceka_se"===qn.stav_schvaleni?"D\u016fvod vr\xe1cen\xed:":"Koment\xe1\u0159:"})," ",qn.schvaleni_komentar]})]})]})]})]}),!!qn.id&&!ca(qn.stav_workflow_kod,"NOVA")&&!(ds||ls)&&qn.stav_schvaleni&&!!qn.schvalovatel_id&&qn.dt_schvaleni&&(0,fe.jsxs)("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"schvaleno"===qn.stav_schvaleni?"#dcfce7":"neschvaleno"===qn.stav_schvaleni?"#fef2f2":"#fef3c7",border:"schvaleno"===qn.stav_schvaleni?"1px solid #16a34a":"neschvaleno"===qn.stav_schvaleni?"1px solid #f87171":"1px solid #f59e0b",borderRadius:"8px",color:"schvaleno"===qn.stav_schvaleni?"#166534":"neschvaleno"===qn.stav_schvaleni?"#991b1b":"#92400e"},children:[(0,fe.jsxs)("div",{style:{fontSize:"1rem",fontWeight:"600",marginBottom:"0.75rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsx)("span",{style:{fontSize:"1.25rem"},children:"schvaleno"===qn.stav_schvaleni?"\u2705":"neschvaleno"===qn.stav_schvaleni?"\u274c":"\u23f3"}),"schvaleno"===qn.stav_schvaleni?"Objedn\xe1vka m\xe1 stav: Schv\xe1len\xe1 objedn\xe1vka":"neschvaleno"===qn.stav_schvaleni?"Objedn\xe1vka m\xe1 stav: Zam\xedtnuta objedn\xe1vka":"Objedn\xe1vka \u010dek\xe1 na dopln\u011bn\xed podklad\u016f"]}),(0,fe.jsxs)("div",{style:{fontSize:"0.875rem",lineHeight:"1.6"},children:[(0,fe.jsxs)("div",{style:{marginBottom:"0.5rem"},children:[(0,fe.jsx)("strong",{children:"Datum schv\xe1len\xed:"})," ",(0,Za.fn)(qn.dt_schvaleni)," \u2022 ",(0,fe.jsx)("strong",{children:"schvaleno"===qn.stav_schvaleni?"Schv\xe1lil:":"neschvaleno"===qn.stav_schvaleni?"Zam\xedtl:":"Vr\xe1til:"})," ",Pc(qn.schvalovatel_id)]}),qn.schvaleni_komentar&&"schvaleno"!==qn.stav_schvaleni&&(0,fe.jsxs)("div",{children:[(0,fe.jsx)("strong",{children:"neschvaleno"===qn.stav_schvaleni?"D\u016fvod zam\xedtnut\xed:":"ceka_se"===qn.stav_schvaleni?"D\u016fvod vr\xe1cen\xed:":"Koment\xe1\u0159:"})," ",qn.schvaleni_komentar]})]})]})]})})]})]}),(ea||1===aa)&&!qn.stav_schvaleni&&(0,fe.jsxs)("div",{style:{margin:"2rem 0",padding:"1rem 1.25rem",backgroundColor:"#f0f9ff",border:"1px solid #0ea5e9",borderRadius:"8px",color:"#0c4a6e"},children:[(0,fe.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"\u2139\ufe0f Objedn\xe1vka zat\xedm nebyla schv\xe1lena"}),(0,fe.jsx)("div",{style:{fontSize:"0.875rem"},children:"Abyste mohli pokra\u010dovat ve vypl\u0148ov\xe1n\xed detail\u016f objedn\xe1vky, p\u0159id\xe1v\xe1n\xed p\u0159\xedloh a zad\xe1v\xe1n\xed informac\xed o dodavateli, je nutn\xe9 nejprve objedn\xe1vku nechat schv\xe1lit."})]}),ts.financovani&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsxs)(dd,{"data-section":"dodavatel",children:[(()=>{const e=Mr.find(e=>e.kod===qn.zpusob_financovani||e.value===qn.zpusob_financovani),n=((null===e||void 0===e?void 0:e.nazev)||"").toLowerCase().includes("pokladna");return(0,fe.jsx)(fe.Fragment,{children:(0,fe.jsxs)(ld,{sectionTheme:is("dodavatel"),isActive:ss("dodavatel"),children:[(0,fe.jsxs)(cd,{sectionTheme:is("dodavatel"),children:[(0,fe.jsx)(pd,{sectionTheme:is("dodavatel"),children:(0,fe.jsx)(C.A,{})}),"Dodavatel",n&&(0,fe.jsx)(_d,{title:"Sekce Dodavatel nen\xed pot\u0159ebn\xe1 pro objedn\xe1vky financovan\xe9 z pokladny",style:{marginLeft:"8px",color:"#ff9800"},children:"\ud83d\udcb0 Pokladna - dodavatel nen\xed vy\u017eadov\xe1n"})]}),(0,fe.jsxs)(vd,{children:[jp()&&!rc&&!n&&Oe&&(Oe("CONTACT_MANAGE")||Oe("CONTACT_EDIT"))&&(0,fe.jsx)(dl,{isActive:!0,onClick:zp,title:"P\u0159idat dodavatele do adres\xe1\u0159e",style:{position:"relative",right:"auto",top:"auto",transform:"none",marginRight:"8px"},children:(0,fe.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,fe.jsx)("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,fe.jsx)("circle",{cx:"8.5",cy:"7",r:"4"}),(0,fe.jsx)("line",{x1:"20",y1:"8",x2:"20",y2:"14"}),(0,fe.jsx)("line",{x1:"23",y1:"11",x2:"17",y2:"11"})]})}),n?(0,fe.jsx)(ud,{collapsed:!0,sectionTheme:is("dodavatel"),style:{cursor:"not-allowed",opacity:.5},title:"Sekce je zablokovan\xe1 pro platbu z pokladny",children:(0,fe.jsx)(p.g,{icon:u.GRI})}):(0,fe.jsx)(ud,{collapsed:Ge.dodavatel,sectionTheme:is("dodavatel"),onClick:()=>sp("dodavatel"),style:{cursor:"pointer"},children:(0,fe.jsx)(p.g,{icon:u.w2A})})]})]})})})(),(0,fe.jsxs)(md,{collapsed:Ge.dodavatel,children:[(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsxs)(xd,{required:!0,children:["N\xc1ZEV DODAVATELE",Ut&&(0,fe.jsxs)("span",{style:{fontWeight:"normal",fontSize:"0.85em",color:"#666",marginLeft:"8px"},children:["(vypln\u011bno z ","local"===Ut?"lok\xe1ln\xedho adres\xe1\u0159e":"ares"===Ut?"ARES":"smlouva"===Ut||"smlouva-fallback"===Ut?"smlouvy":"automatick\xe9ho zdroje",")"]})]}),(0,fe.jsxs)(wd,{hasIcon:!0,style:{position:"relative"},children:[(0,fe.jsx)(C.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"dodavatel_nazev",placeholder:"N\xe1zev spole\u010dnosti",value:qn.dodavatel_nazev||"",onChange:e=>{Rp("dodavatel_nazev",e.target.value),Ut&&Zt(null)},onBlur:()=>rp("dodavatel_nazev",qn.dodavatel_nazev),hasError:!!wo.dodavatel_nazev,hasIcon:!0,disabled:rc,style:{paddingRight:"80px"}}),(0,fe.jsxs)("div",{style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",display:"flex",gap:"4px",zIndex:10},children:[(0,fe.jsx)(rl,{onClick:rc?void 0:async()=>{const e=qn.dodavatel_nazev||"",n=qn.dodavatel_ico||"",a=e||n;Vo(a),Mo([]),Lo(!0),await Ap(a)},title:rc?"Zam\u010deno - sekce F\xc1ZE 3":"Vyhledat v lok\xe1ln\xed datab\xe1zi dodavatel\u016f",style:{opacity:rc?.5:1,cursor:rc?"not-allowed":"pointer"},children:(0,fe.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,fe.jsx)("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,fe.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,fe.jsx)("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),(0,fe.jsx)("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}),(0,fe.jsx)(sl,{onClick:rc?void 0:Sp,title:rc?"Zam\u010deno - sekce F\xc1ZE 3":"Vyhledat v ARES registru",style:{opacity:rc?.5:1,cursor:rc?"not-allowed":"pointer"},children:(0,fe.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,fe.jsx)("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),(0,fe.jsx)("path",{d:"M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5"}),(0,fe.jsx)("path",{d:"M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3"})]})})]})]}),wo.dodavatel_nazev&&(0,fe.jsx)(yd,{children:wo.dodavatel_nazev})]})}),(0,fe.jsxs)(gd,{style:{gridTemplateColumns:"2fr 1fr 1fr"},children:[(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"ADRESA"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(D.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"dodavatel_adresa",placeholder:"Adresa s\xeddla",value:qn.dodavatel_adresa||"",onChange:e=>Rp("dodavatel_adresa",e.target.value),onBlur:()=>rp("dodavatel_adresa",qn.dodavatel_adresa),hasError:!!wo.dodavatel_adresa,hasIcon:!0,disabled:rc})]}),wo.dodavatel_adresa&&(0,fe.jsx)(yd,{children:wo.dodavatel_adresa})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"I\u010cO"}),(0,fe.jsxs)(wd,{hasIcon:!0,style:{position:"relative"},children:[(0,fe.jsx)(O.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"dodavatel_ico",placeholder:"12345678",value:qn.dodavatel_ico||"",onChange:e=>Rp("dodavatel_ico",e.target.value),onBlur:e=>(e=>{const n=null===e||void 0===e?void 0:e.trim();rp("dodavatel_ico",n),n&&n.length>=8&&/^\d+$/.test(n)&&Dp(n)})(e.target.value),hasError:!!wo.dodavatel_ico,hasIcon:!0,disabled:rc,style:{paddingRight:"36px"}}),(0,fe.jsx)(sl,{onClick:rc?void 0:Sp,title:rc?"Zam\u010deno - sekce F\xc1ZE 3":"Vyhledat I\u010cO v ARES registru",style:{opacity:rc?.5:1,cursor:rc?"not-allowed":"pointer"},children:(0,fe.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,fe.jsx)("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),(0,fe.jsx)("path",{d:"M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5"}),(0,fe.jsx)("path",{d:"M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3"})]})}),ut&&(0,fe.jsxs)(Vl,{"data-status":_t,children:["checking"===_t&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(Fl,{status:"checking",children:"Kontroluji I\u010cO..."}),(0,fe.jsx)(Ml,{status:"checking",children:"Vyhled\xe1v\xe1m dodavatele podle I\u010cO v datab\xe1zi a ARES."})]}),("found-local"===_t||"found-ares"===_t)&&ft&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(Fl,{status:"found",children:"found-local"===_t?"Dodavatel v datab\xe1zi!":"Dodavatel nalezen v ARES!"}),(0,fe.jsxs)(Ml,{status:"found",children:[(0,fe.jsx)("strong",{children:ft.nazev||ft.name||"N\xe1zev nen\xed k dispozici"}),(0,fe.jsx)("br",{}),"I\u010cO: ",ft.ico,(0,fe.jsx)("br",{}),ft.dic&&(0,fe.jsxs)(fe.Fragment,{children:["DI\u010c: ",ft.dic,(0,fe.jsx)("br",{})]}),(ft.adresa||ft.address)&&(0,fe.jsxs)(fe.Fragment,{children:[ft.adresa||ft.address,(0,fe.jsx)("br",{})]}),ft.zastoupeny&&(0,fe.jsxs)(fe.Fragment,{children:["Zastoupen\xfd: ",ft.zastoupeny,(0,fe.jsx)("br",{})]}),ft.kontakt_jmeno&&(0,fe.jsxs)(fe.Fragment,{children:["Kontakt: ",ft.kontakt_jmeno,ft.kontakt_email&&(0,fe.jsxs)(fe.Fragment,{children:[", ",ft.kontakt_email]}),ft.kontakt_telefon&&(0,fe.jsxs)(fe.Fragment,{children:[", ",ft.kontakt_telefon]}),(0,fe.jsx)("br",{})]}),(0,fe.jsxs)("div",{style:{fontSize:"11px",color:"#666",marginTop:"8px"},children:["Zdroj: ","local"===ft.source?"Lok\xe1ln\xed datab\xe1ze":"ARES registr"]})]}),(0,fe.jsxs)(Ul,{children:[(0,fe.jsx)(Zl,{className:"fill-form",onClick:Tp,children:"Vyplnit formul\xe1\u0159"}),"found-ares"===_t&&(0,fe.jsx)(Zl,{className:"primary",onClick:async()=>{if(ft){if("ares"===ft.source)try{const e=await(0,me.jx)({token:Ee,username:Se,nazev:ft.nazev,ico:ft.ico,dic:ft.dic||"",adresa:ft.adresa||"",zastoupeny:"",kontakt_jmeno:"",kontakt_email:"",kontakt_telefon:"",user_id:we,usek_zkr:""});if(!(null!==e&&void 0!==e&&e.ok||"ok"===(null===e||void 0===e?void 0:e.status)))throw new Error((null===e||void 0===e?void 0:e.message)||"Nezn\xe1m\xe1 chyba");ze&&ze("Dodavatel byl p\u0159id\xe1n do va\u0161ich osobn\xedch kontakt\u016f",{type:"success"})}catch(e){return void(ze&&ze("Chyba p\u0159i p\u0159id\xe1v\xe1n\xed do kontakt\u016f: ".concat(e.message),{type:"error"}))}Tp()}},children:"P\u0159idat do osobn\xedch kontakt\u016f"}),(0,fe.jsx)(Zl,{className:"secondary",onClick:Ip,children:"Zru\u0161it"})]})]}),"not-found"===_t&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(Fl,{status:"not-found",children:"Dodavatel nebyl nalezen"}),(0,fe.jsx)(Ml,{status:"not-found",children:"Dodavatel s t\xedmto I\u010cO nen\xed v lok\xe1ln\xed datab\xe1zi ani v ARES. M\u016f\u017eete pokra\u010dovat s ru\u010dn\xedm zad\xe1n\xedm."}),(0,fe.jsx)(Ul,{children:(0,fe.jsx)(Zl,{className:"secondary",onClick:Ip,children:"Pokra\u010dovat ru\u010dn\u011b"})})]})]})]}),wo.dodavatel_ico&&(0,fe.jsx)(yd,{children:wo.dodavatel_ico})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{children:"DI\u010c"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(O.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"dodavatel_dic",placeholder:"CZ12345678",value:qn.dodavatel_dic||"",onChange:e=>Rp("dodavatel_dic",e.target.value),onBlur:()=>rp("dodavatel_dic",qn.dodavatel_dic),hasIcon:!0,disabled:rc})]})]})]}),(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsx)(xd,{children:"ZASTOUPEN\xdd"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(j.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"dodavatel_zastoupeny",placeholder:"Zastoupen Ji\u0159\xedm Nov\xe1kem",value:qn.dodavatel_zastoupeny||"",onChange:e=>Rp("dodavatel_zastoupeny",e.target.value),onBlur:()=>rp("dodavatel_zastoupeny",qn.dodavatel_zastoupeny),hasIcon:!0,disabled:rc})]})]})}),(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsx)("div",{style:{width:"100%",height:"1px",background:"linear-gradient(to right, #e5e7eb, transparent)",margin:"1.5rem 0 1rem 0"}}),(0,fe.jsxs)(xd,{style:{fontSize:"1rem",fontWeight:"600",color:"#374151",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.5rem"},children:[(0,fe.jsx)(j.A,{size:18}),"Kontaktn\xed osoba dodavatele"]})]})}),(0,fe.jsxs)(gd,{children:[(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{children:"JM\xc9NO A P\u0158\xcdJMEN\xcd"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(j.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"dodavatel_kontakt_jmeno",placeholder:"Jan Nov\xe1k",value:qn.dodavatel_kontakt_jmeno||"",onChange:e=>Rp("dodavatel_kontakt_jmeno",e.target.value),onBlur:()=>rp("dodavatel_kontakt_jmeno",qn.dodavatel_kontakt_jmeno),hasIcon:!0,disabled:rc})]})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{children:"E-MAIL"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(z.A,{}),(0,fe.jsx)(Sd,{type:"email",name:"dodavatel_kontakt_email",placeholder:"jan.novak@dodavatel.cz",value:qn.dodavatel_kontakt_email||"",onChange:e=>Rp("dodavatel_kontakt_email",e.target.value),onBlur:()=>rp("dodavatel_kontakt_email",qn.dodavatel_kontakt_email),hasIcon:!0,disabled:rc})]})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{children:"TELEFON"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(A.A,{}),(0,fe.jsx)(Sd,{type:"tel",name:"dodavatel_kontakt_telefon",placeholder:"+420 123 456 789",value:qn.dodavatel_kontakt_telefon||"",onChange:e=>Rp("dodavatel_kontakt_telefon",e.target.value),onBlur:()=>rp("dodavatel_kontakt_telefon",qn.dodavatel_kontakt_telefon),hasIcon:!0,disabled:rc})]})]})]})]})]}),(ea||aa>=3)&&(aa>=3&&(!qn.polozky_objednavky||0===qn.polozky_objednavky.length)&&setTimeout(()=>{qn.polozky_objednavky&&0!==qn.polozky_objednavky.length||Xn(e=>(0,t.A)((0,t.A)({},e),{},{polozky_objednavky:[{id:"failsafe_item_".concat(Date.now()),popis:"",mnozstvi:"1",jednotka:"ks",cena_bez_dph:"",sazba_dph:"21",cena_s_dph:""}]}))},100),!0)&&(0,fe.jsxs)(dd,{"data-section":"detaily",children:[(0,fe.jsxs)(ld,{sectionTheme:is("detaily"),isActive:ss("detaily"),children:[(0,fe.jsxs)(cd,{sectionTheme:is("detaily"),children:[(0,fe.jsx)(pd,{sectionTheme:is("detaily"),children:(0,fe.jsx)(T.A,{})}),"Detaily objedn\xe1vky",rc&&!mc&&(0,fe.jsx)(_d,{title:"F\xc1ZE 3 sekce je zam\u010dena ve F\xc1ZI 4+. Odem\u010den\xed umo\u017en\xed editaci F\xc1ZE 3.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,fe.jsxs)(vd,{children:[(0,fe.jsxs)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#92400e",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsxs)("span",{children:["Celkem s DPH: ",Nc.toLocaleString("cs-CZ")," K\u010d"]}),Oc>0&&(0,fe.jsx)("span",{style:{color:Nc>Oc?"#dc2626":"#059669",fontSize:"0.75rem",padding:"2px 6px",borderRadius:"4px",backgroundColor:Nc>Oc?"#fef2f2":"#f0fdf4",border:"1px solid ".concat(Nc>Oc?"#fecaca":"#bbf7d0")},children:Nc>Oc?"+".concat((Nc-Oc).toLocaleString("cs-CZ")," K\u010d nad limit"):"".concat((Oc-Nc).toLocaleString("cs-CZ")," K\u010d do limitu")})]}),(0,fe.jsx)(ud,{collapsed:Ge.detaily,sectionTheme:is("detaily"),onClick:()=>sp("detaily"),style:{cursor:"pointer"},children:(0,fe.jsx)(p.g,{icon:u.w2A})})]})]}),(0,fe.jsxs)(md,{collapsed:Ge.detaily,children:[(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsxs)(jd,{children:[(0,fe.jsx)(zd,{required:!0,children:"DRUH OBJ."}),(0,fe.jsx)(Ad,{type:"button",$visible:!!qn.druh_objednavky_kod,onClick:()=>Rp("druh_objednavky_kod",""),title:"Vymazat v\xfdb\u011br",children:(0,fe.jsx)(w.A,{size:12})})]}),(0,fe.jsx)(Uc,{value:qn.druh_objednavky_kod,onChange:e=>Rp("druh_objednavky_kod",e),onBlur:(e,n)=>rp("druh_objednavky_kod",n),options:Ur,placeholder:"Vyberte druh objedn\xe1vky...",field:"druh_objednavky_kod",icon:(0,fe.jsx)(T.A,{}),disabled:rc,hasError:!!wo.druh_objednavky_kod,required:!0,loading:!1,getOptionLabel:ru,getOptionValue:(e,n)=>e.kod_stavu||e.value||e.kod||e.id||e}),wo.druh_objednavky_kod&&(0,fe.jsx)(yd,{children:wo.druh_objednavky_kod})]})}),(0,fe.jsxs)("div",{style:{marginTop:"1.5rem"},children:[(0,fe.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:(0,fe.jsxs)("h4",{style:{margin:0,fontSize:"1rem",fontWeight:"600",color:"#374151"},children:["Polo\u017eky objedn\xe1vky ",(0,fe.jsx)("span",{style:{color:"#ef4444"},children:"*"})]})}),wo.polozky_objednavky&&(0,fe.jsx)(yd,{style:{marginBottom:"1rem"},children:wo.polozky_objednavky}),(qn.polozky_objednavky||[]).map((e,n)=>(0,fe.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"8px",padding:"1rem",marginBottom:"1rem",background:"#fafafa"},children:[(0,fe.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flex:1},children:[(0,fe.jsxs)("span",{style:{fontWeight:"600",color:"#374151",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsx)(I,{size:18,style:{color:"#10b981"}}),"POLO\u017dKA ",n+1," ",0===n&&(0,fe.jsx)("span",{style:{color:"#ef4444"},children:"*"})]}),aa>=3&&(()=>{const a=Mr.find(e=>e.kod_stavu===qn.zpusob_financovani||e.kod===qn.zpusob_financovani),o=(null===a||void 0===a?void 0:a.nazev_stavu)||(null===a||void 0===a?void 0:a.nazev)||"";return(o.includes("Limitovan")||o.includes("p\u0159\xedslib"))&&Array.isArray(qn.lp_kod)&&qn.lp_kod.length>0?(0,fe.jsxs)("div",{style:{flex:1,marginRight:"0.5rem",display:"flex",flexDirection:"column",gap:"0.25rem"},"data-custom-select":!0,children:[(0,fe.jsx)(Uc,{value:e.lp_id||"",onChange:n=>xp(e.id,"lp_id",n),options:Ar,placeholder:qn.id?0===Ar.length?"\u017d\xe1dn\xe9 LP dostupn\xe9":"-- Vybrat LP --":"Ulo\u017ete objedn\xe1vku...",field:"polozka_".concat(e.id,"_lp"),disabled:rc||!qn.id,hasError:!!wo["polozka_".concat(n,"_lp")],required:!0,hasTriedToSubmit:Eo,icon:(0,fe.jsx)(O.A,{}),getOptionLabel:ru,getOptionValue:e=>e.id}),wo["polozka_".concat(n,"_lp")]&&(0,fe.jsx)(yd,{style:{fontSize:"0.7rem",marginTop:"0.1rem"},children:wo["polozka_".concat(n,"_lp")]})]}):null})()]}),(qn.polozky_objednavky||[]).length>1&&(0,fe.jsx)(ll,{type:"button",onClick:rc?void 0:()=>{return n=e.id,void((qn.polozky_objednavky||[]).length<=1||(Xn(e=>(0,t.A)((0,t.A)({},e),{},{polozky_objednavky:(e.polozky_objednavky||[]).filter(e=>e.id!==n)})),setTimeout(()=>qc(!0),100)));var n},disabled:rc,title:rc?"Zam\u010deno - sekce F\xc1ZE 3":"Smazat polo\u017eku",style:{opacity:rc?.5:1,cursor:rc?"not-allowed":"pointer"},children:(0,fe.jsx)(P.A,{size:16})})]}),(0,fe.jsx)(gd,{style:{marginBottom:"1rem"},children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsx)(xd,{required:!0,children:"N\xe1zev / popis"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(S.A,{}),(0,fe.jsx)(Sd,{type:"text",placeholder:"N\xe1zev / popis polo\u017eky",value:e.popis,onChange:n=>xp(e.id,"popis",n.target.value),onBlur:()=>rp("polozka_".concat(n,"_popis"),e.popis),hasError:!!wo["polozka_".concat(n,"_popis")],hasIcon:!0,disabled:rc})]}),wo["polozka_".concat(n,"_popis")]&&(0,fe.jsx)(yd,{children:wo["polozka_".concat(n,"_popis")]})]})}),(0,fe.jsxs)(gd,{style:{gridTemplateColumns:"1fr auto 1fr",gap:"1rem",alignItems:"end"},children:[(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"CENA BEZ DPH"}),(0,fe.jsx)(sc,{fieldName:"polozka_".concat(n,"_cena_bez_dph"),value:e.cena_bez_dph||"",onChange:(n,a)=>xp(e.id,"cena_bez_dph",a),onBlur:(e,a)=>rp("polozka_".concat(n,"_cena_bez_dph"),a),disabled:rc,placeholder:"0.00",hasError:!!wo["polozka_".concat(n,"_cena_bez_dph")]}),wo["polozka_".concat(n,"_cena_bez_dph")]&&(0,fe.jsx)(yd,{children:wo["polozka_".concat(n,"_cena_bez_dph")]})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{children:"DPH"}),(0,fe.jsxs)("select",{value:e.sazba_dph,onChange:n=>xp(e.id,"sazba_dph",n.target.value),onBlur:()=>rp("polozka_".concat(n,"_sazba_dph"),e.sazba_dph),disabled:rc,style:{padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"0.875rem",backgroundColor:"white",width:"80px"},children:[(0,fe.jsx)("option",{value:"12",children:"12%"}),(0,fe.jsx)("option",{value:"21",children:"21%"})]})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"CENA S DPH"}),(0,fe.jsx)(sc,{fieldName:"polozka_".concat(n,"_cena_s_dph"),value:e.cena_s_dph||"",onChange:(n,a)=>xp(e.id,"cena_s_dph",a),onBlur:(e,a)=>rp("polozka_".concat(n,"_cena_s_dph"),a),disabled:rc,placeholder:"0.00",hasError:!!wo["polozka_".concat(n,"_cena_s_dph")]}),wo["polozka_".concat(n,"_cena_s_dph")]&&(0,fe.jsx)(yd,{children:wo["polozka_".concat(n,"_cena_s_dph")]})]})]}),(0,fe.jsxs)("div",{style:{marginTop:"1rem"},children:[(()=>{const n=Wr;return(0,fe.jsxs)("button",{type:"button",onClick:()=>{n||Do(n=>(0,t.A)((0,t.A)({},n),{},{[e.id]:!n[e.id]}))},disabled:rc||n,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",background:"transparent",border:"none",color:n?"#ef4444":"#6b7280",fontSize:"0.875rem",fontWeight:n?"600":"500",cursor:rc||n?"not-allowed":"pointer",opacity:rc?.5:1,transition:"color 0.2s"},onMouseOver:e=>!rc&&!n&&(e.currentTarget.style.color="#374151"),onMouseOut:e=>!rc&&!n&&(e.currentTarget.style.color="#6b7280"),children:[!n&&(0,fe.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{transform:Oo[e.id]?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:(0,fe.jsx)("polyline",{points:"6 9 12 15 18 9"})}),"Up\u0159esn\u011bn\xed m\xedsta dod\xe1n\xed ",n?(0,fe.jsx)("span",{style:{color:"#ef4444"},children:"*"}):"(voliteln\xe9)"]})})(),Oo[e.id]&&(()=>{const a=Wr;return(0,fe.jsxs)("div",{style:{marginTop:"0.75rem",padding:"1rem",background:a?"#fef2f2":"#f9fafb",borderRadius:"6px",border:a?"1px solid #fca5a5":"1px dashed #d1d5db"},children:[(0,fe.jsxs)(gd,{style:{gridTemplateColumns:"1fr 1fr 1fr"},children:[(0,fe.jsxs)(bd,{children:[(0,fe.jsxs)(xd,{children:["\xdaSEK ",a&&(0,fe.jsx)("span",{style:{color:"#ef4444"},children:"*"})]}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(D.A,{size:16}),(0,fe.jsx)(Sd,{type:"text",name:"polozka_".concat(n,"_usek_kod"),placeholder:"\xdasek...",value:e.usek_kod||"",onChange:n=>xp(e.id,"usek_kod",n.target.value),onBlur:()=>rp("polozka_".concat(n,"_usek_kod"),e.usek_kod),disabled:rc,hasError:!!wo["polozka_".concat(n,"_usek_kod")],style:{paddingLeft:"2.5rem"}})]}),wo["polozka_".concat(n,"_usek_kod")]&&(0,fe.jsx)(yd,{children:wo["polozka_".concat(n,"_usek_kod")]})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsxs)(xd,{children:["BUDOVA ",a&&(0,fe.jsx)("span",{style:{color:"#ef4444"},children:"*"})]}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(D.A,{size:16}),(0,fe.jsx)(Sd,{type:"text",name:"polozka_".concat(n,"_budova_kod"),placeholder:"Budova...",value:e.budova_kod||"",onChange:n=>xp(e.id,"budova_kod",n.target.value),onBlur:()=>rp("polozka_".concat(n,"_budova_kod"),e.budova_kod),disabled:rc,hasError:!!wo["polozka_".concat(n,"_budova_kod")],style:{paddingLeft:"2.5rem"}})]}),wo["polozka_".concat(n,"_budova_kod")]&&(0,fe.jsx)(yd,{children:wo["polozka_".concat(n,"_budova_kod")]})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsxs)(xd,{children:["M\xcdSTNOST ",a&&(0,fe.jsx)("span",{style:{color:"#ef4444"},children:"*"})]}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(D.A,{size:16}),(0,fe.jsx)(Sd,{type:"text",name:"polozka_".concat(n,"_mistnost_kod"),placeholder:"M\xedstnost...",value:e.mistnost_kod||"",onChange:n=>xp(e.id,"mistnost_kod",n.target.value),onBlur:()=>rp("polozka_".concat(n,"_mistnost_kod"),e.mistnost_kod),disabled:rc,hasError:!!wo["polozka_".concat(n,"_mistnost_kod")],style:{paddingLeft:"2.5rem"}})]}),wo["polozka_".concat(n,"_mistnost_kod")]&&(0,fe.jsx)(yd,{children:wo["polozka_".concat(n,"_mistnost_kod")]})]})]}),(0,fe.jsx)(gd,{style:{gridTemplateColumns:"1fr"},children:(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{children:"POZN\xc1MKA K M\xcdSTU"}),(0,fe.jsx)(Ed,{name:"polozka_".concat(n,"_poznamka_lokalizace"),placeholder:"Dopl\u0148uj\xedc\xed informace k m\xedstu dod\xe1n\xed...",value:e.poznamka||"",onChange:n=>xp(e.id,"poznamka",n.target.value),onBlur:()=>rp("polozka_".concat(n,"_poznamka_lokalizace"),e.poznamka),disabled:rc,rows:2})]})})]})})()]})]},e.id)),!rc&&(0,fe.jsxs)("button",{type:"button",onClick:()=>{Xn(e=>(0,t.A)((0,t.A)({},e),{},{polozky_objednavky:[...e.polozky_objednavky||[],{id:Date.now(),popis:"",cena_bez_dph:"",sazba_dph:"21",cena_s_dph:"",usek_kod:"",budova_kod:"",mistnost_kod:"",poznamka:"",lp_id:null}]})),setTimeout(()=>qc(!0),100)},style:{width:"100%",marginTop:"1rem",padding:"1rem",background:"transparent",border:"2px dashed #10b981",borderRadius:"8px",color:"#10b981",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",transition:"all 0.2s ease"},onMouseOver:e=>{e.currentTarget.style.background="#f0fdf4",e.currentTarget.style.borderColor="#059669"},onMouseOut:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.borderColor="#10b981"},children:[(0,fe.jsx)(L.A,{size:16}),(0,fe.jsx)("span",{children:"P\u0159idat dal\u0161\xed polo\u017eku"})]})]}),(0,fe.jsx)(gd,{style:{marginTop:"1.5rem"},children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsx)(xd,{children:"POZN\xc1MKA:"}),(0,fe.jsx)(Ed,{name:"poznamka_objednavky",placeholder:"Dodate\u010dn\xe9 pozn\xe1mky a po\u017eadavky...",value:qn.poznamka_objednavky||"",onChange:e=>Rp("poznamka_objednavky",e.target.value),onBlur:e=>rp("poznamka_objednavky",e.target.value),disabled:rc,rows:3})]})})]})]}),(0,fe.jsxs)(dd,{"data-section":"dodaci_podminky",children:[(0,fe.jsxs)(ld,{sectionTheme:is("dodaci_podminky"),isActive:ss("dodaci_podminky"),children:[(0,fe.jsxs)(cd,{sectionTheme:is("dodaci_podminky"),children:[(0,fe.jsx)(pd,{sectionTheme:is("dodaci_podminky"),children:(0,fe.jsx)(_.A,{})}),"Dodac\xed a z\xe1ru\u010dn\xed podm\xednky",rc&&!mc&&(0,fe.jsx)(_d,{title:"F\xc1ZE 3 sekce je zam\u010dena ve F\xc1ZI 4+. Odem\u010den\xed umo\u017en\xed editaci F\xc1ZE 3.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,fe.jsx)(vd,{children:(0,fe.jsx)(ud,{collapsed:Ge.dodaci_podminky,sectionTheme:is("dodaci_podminky"),onClick:()=>sp("dodaci_podminky"),style:{cursor:"pointer"},children:(0,fe.jsx)(p.g,{icon:u.w2A})})})]}),(0,fe.jsxs)(md,{collapsed:Ge.dodaci_podminky,children:[(0,fe.jsxs)(gd,{style:{gridTemplateColumns:"2fr 3fr"},children:[(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{children:"P\u0158EDPOKL\xc1DAN\xdd TERM\xcdN DOD\xc1N\xcd"}),(0,fe.jsx)(dc,{fieldName:"dt_predpokladany_termin_dodani",value:qn.dt_predpokladany_termin_dodani,onChange:e=>Rp("dt_predpokladany_termin_dodani",e),onBlur:e=>rp("dt_predpokladany_termin_dodani",e),disabled:rc,hasError:!!wo.dt_predpokladany_termin_dodani,placeholder:"Vyberte datum"})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{children:"M\xcdSTO DOD\xc1N\xcd"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(D.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"misto_dodani",placeholder:"Adresa m\xedsta dod\xe1n\xed",value:qn.misto_dodani||"",onChange:e=>Rp("misto_dodani",e.target.value),onBlur:e=>rp("misto_dodani",e.target.value),disabled:rc,hasIcon:!0})]})]})]}),(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsx)(xd,{children:"Z\xc1RUKA"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(S.A,{}),(0,fe.jsx)(Sd,{type:"text",name:"zaruka",placeholder:"Z\xe1ru\u010dn\xed podm\xednky a lh\u016fty",value:qn.zaruka||"",onChange:e=>Rp("zaruka",e.target.value),onBlur:e=>rp("zaruka",e.target.value),disabled:rc,hasIcon:!0})]})]})})]})]}),(0,fe.jsxs)(dd,{"data-section":"stav_odeslani",children:[(0,fe.jsxs)(ld,{sectionTheme:is("stav_odeslani"),isActive:ss("stav_odeslani"),children:[(0,fe.jsxs)(cd,{sectionTheme:is("stav_odeslani"),children:[(0,fe.jsx)(pd,{sectionTheme:is("stav_odeslani"),children:(0,fe.jsx)(T.A,{})}),"Stav odesl\xe1n\xed objedn\xe1vky",rc&&!mc&&(0,fe.jsx)(_d,{title:"F\xc1ZE 3 sekce je zam\u010dena ve F\xc1ZI 4+. Odem\u010den\xed umo\u017en\xed editaci F\xc1ZE 3.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,fe.jsxs)(vd,{children:[rc&&!mc&&ps&&(0,fe.jsx)(Qd,{onClick:e=>{e.stopPropagation(),Qi(!0)},title:"Odemknout F\xc1ZE 3 sekce",children:(0,fe.jsx)(x,{})}),(0,fe.jsx)(ud,{collapsed:Ge.stav_odeslani,sectionTheme:is("stav_odeslani"),onClick:()=>sp("stav_odeslani"),style:{cursor:"pointer"},children:(0,fe.jsx)(p.g,{icon:u.w2A})})]})]}),(0,fe.jsx)(md,{collapsed:Ge.stav_odeslani,children:(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsx)(xd,{style:{marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"KONE\u010cN\xdd STAV OBJEDN\xc1VKY"}),(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:qn.stav_odeslano?"#f0fdf4":"#f9fafb",marginBottom:"1rem",opacity:rc||gt||Qt?.6:1},children:[(0,fe.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",fontSize:"1rem",fontWeight:"500",cursor:rc||gt||Qt?"not-allowed":"pointer",color:qn.stav_odeslano?"#15803d":"#374151"},children:[(0,fe.jsx)("input",{type:"checkbox",name:"stav_odeslano",checked:qn.stav_odeslano||!1,disabled:rc||gt||Qt,onChange:e=>{const n=e.target.checked;n&&(Rp("stav_stornovano",!1),Rp("datum_storna",""),Rp("odeslani_storno_duvod",""),Rp("storno_uzivatel_id",""),Rp("storno_provedl","")),Rp("stav_odeslano",n)},style:{width:"20px",height:"20px",accentColor:"#16a34a"}}),(0,fe.jsx)(T.A,{size:20}),"Odesl\xe1no",qn.stav_odeslano&&(0,fe.jsx)("span",{style:{marginLeft:"0.5rem",fontSize:"0.875rem",color:"#15803d",fontWeight:"600"},children:"\u2713"})]}),(qn.stav_odeslano||qn.dt_odeslani)&&(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginLeft:"auto"},children:[(0,fe.jsx)(xd,{style:{margin:0,fontSize:"0.875rem"},children:"DATUM:"}),(0,fe.jsx)("div",{style:{width:"280px"},children:(0,fe.jsx)(dc,{fieldName:"datum_odeslani",value:qn.datum_odeslani,onChange:e=>Rp("datum_odeslani",e),onBlur:e=>rp("datum_odeslani",e),disabled:rc,hasError:!!wo.datum_odeslani,placeholder:"Datum"})})]})]}),(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:qn.stav_stornovano?"#fef2f2":"#f9fafb",opacity:rc||gt||Qt?.6:1},children:[(0,fe.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",fontSize:"1rem",fontWeight:"500",cursor:rc||gt||Qt?"not-allowed":"pointer",color:qn.stav_stornovano?"#dc2626":"#374151"},children:[(0,fe.jsx)("input",{type:"checkbox",name:"stav_stornovano",checked:qn.stav_stornovano||!1,disabled:rc||gt||Qt,onChange:e=>{const n=e.target.checked;n&&(Rp("stav_odeslano",!1),Rp("datum_odeslani","")),Rp("stav_stornovano",n)},style:{width:"20px",height:"20px",accentColor:"#dc2626"}}),(0,fe.jsx)(p.g,{icon:u.GRI,size:"lg"}),"Stornov\xe1no",qn.stav_stornovano&&(0,fe.jsx)("span",{style:{marginLeft:"0.5rem",fontSize:"0.875rem",color:"#dc2626",fontWeight:"600"},children:"\u2717"})]}),(qn.stav_stornovano||qn.datum_storna)&&(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginLeft:"auto"},children:[(0,fe.jsx)(xd,{style:{margin:0,fontSize:"0.875rem"},children:"DATUM:"}),(0,fe.jsx)("div",{style:{width:"280px"},children:(0,fe.jsx)(dc,{fieldName:"datum_storna",value:qn.datum_storna,onChange:e=>Rp("datum_storna",e),onBlur:e=>rp("datum_storna",e),disabled:rc,hasError:!!wo.datum_storna,placeholder:"Vyberte datum..."})})]})]}),qn.stav_stornovano&&(0,fe.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,fe.jsxs)(xd,{style:{marginBottom:"0.5rem"},children:["D\u016eVOD STORNOV\xc1N\xcd",(0,fe.jsx)("span",{style:{color:"#dc2626",marginLeft:"0.25rem"},children:"*"})]}),(0,fe.jsx)(Ed,{name:"odeslani_storno_duvod",placeholder:"Uve\u010fte d\u016fvod stornov\xe1n\xed objedn\xe1vky...",value:qn.odeslani_storno_duvod||"",onChange:e=>Rp("odeslani_storno_duvod",e.target.value),onBlur:e=>rp("odeslani_storno_duvod",e.target.value),rows:3,style:{border:"1px solid #fca5a5",backgroundColor:"#fef2f2"}}),wo.odeslani_storno_duvod&&(0,fe.jsx)(yd,{style:{marginTop:"0.5rem"},children:wo.odeslani_storno_duvod})]}),wo.datum_odeslani&&(0,fe.jsx)(yd,{style:{marginTop:"0.5rem"},children:wo.datum_odeslani}),wo.datum_storna&&(0,fe.jsx)(yd,{style:{marginTop:"0.5rem"},children:wo.datum_storna}),qn.stav_odeslano?(0,fe.jsx)("div",{style:{marginTop:"1rem",padding:"0.75rem 1rem",backgroundColor:"#dcfce7",border:"1px solid #16a34a",borderRadius:"6px",color:"#166534",fontSize:"0.875rem"},children:(0,fe.jsx)("div",{style:{fontWeight:"600"},children:qn.dt_odeslani&&qn.odesilatel_id&&ca(qn.stav_workflow_kod,"ODESLANA")?(0,fe.jsxs)(fe.Fragment,{children:["\u2705 Objedn\xe1vka byla odesl\xe1na",(0,fe.jsxs)("div",{style:{marginTop:"0.25rem",fontSize:"0.875rem",fontWeight:"normal"},children:[(0,fe.jsx)("strong",{children:"Datum odesl\xe1n\xed:"})," ",(()=>{const e=qn.dt_odeslani.split(" ")[0],[n,a,o]=e.split("-");return"".concat(o,". ").concat(a,". ").concat(n)})()," \u2022 ",(0,fe.jsx)("strong",{children:"Odeslal:"})," ",Pc(qn.odesilatel_id)]})]}):qn.datum_odeslani?"\u2705 Objedn\xe1vka bude ozna\u010dena jako odeslan\xe1 dne ".concat((0,Za.iS)(new Date(qn.datum_odeslani))):"\u2705 Objedn\xe1vka bude ozna\u010dena jako odeslan\xe1 po ulo\u017een\xed"})}):qn.stav_stornovano?(0,fe.jsx)("div",{style:{marginTop:"1rem",padding:"0.75rem 1rem",backgroundColor:"#fef2f2",border:"1px solid #f87171",borderRadius:"6px",color:"#991b1b",fontSize:"0.875rem"},children:(0,fe.jsx)("div",{style:{fontWeight:"600"},children:qn.dt_odeslani&&qn.odesilatel_id&&ca(qn.stav_workflow_kod,"STORNOVANA")?(0,fe.jsxs)(fe.Fragment,{children:["\u274c Objedn\xe1vka byla stornov\xe1na",(0,fe.jsxs)("div",{style:{marginTop:"0.5rem",fontSize:"0.875rem",fontWeight:"normal"},children:[(0,fe.jsx)("strong",{children:"Datum stornov\xe1n\xed:"})," ",qn.dt_odeslani," \u2022 ",(0,fe.jsx)("strong",{children:"Stornoval:"})," ",Pc(qn.odesilatel_id)]}),qn.odeslani_storno_duvod&&(0,fe.jsxs)("div",{style:{marginTop:"0.5rem",fontSize:"0.875rem",fontWeight:"normal"},children:[(0,fe.jsx)("strong",{children:"D\u016fvod stornov\xe1n\xed:"})," ",qn.odeslani_storno_duvod]})]}):(0,fe.jsxs)(fe.Fragment,{children:["\u274c Objedn\xe1vka byla stornov\xe1na ",qn.datum_storna?"dne ".concat((0,Za.iS)(new Date(qn.datum_storna))):"po ulo\u017een\xed",qn.odeslani_storno_duvod&&(0,fe.jsxs)("div",{style:{marginTop:"0.5rem",fontSize:"0.875rem",fontWeight:"normal"},children:[(0,fe.jsx)("strong",{children:"D\u016fvod stornov\xe1n\xed:"})," ",qn.odeslani_storno_duvod]})]})})}):null]})})})]}),(ea||aa>=2)&&ca(qn.stav_workflow_kod,"SCHVALENA")&&!qn.stav_odeslano&&!qn.stav_stornovano&&(0,fe.jsxs)("div",{style:{margin:"2rem 0",padding:"1rem 1.25rem",backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"8px",color:"#92400e"},children:[(0,fe.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"\ud83d\udccb Objedn\xe1vka zat\xedm nebyla dokon\u010dena"}),(0,fe.jsx)("div",{style:{fontSize:"0.875rem"},children:'Za\u0161krtn\u011bte "Odesl\xe1no" kdy\u017e bude objedn\xe1vka skute\u010dn\u011b odesl\xe1na dodavateli, nebo "Stornov\xe1no" pokud se objedn\xe1vka nebude realizovat.'})]}),(ea||aa>=3)&&!qn.stav_stornovano&&(0,fe.jsxs)(fe.Fragment,{children:[(()=>{const e=aa>=4,n=ca(qn.stav_workflow_kod,"ODESLANA")||ca(qn.stav_workflow_kod,"POTVRZENA");return e&&n})()&&(0,fe.jsxs)(dd,{"data-section":"potvrzeni_objednavky",children:[(0,fe.jsxs)(ld,{sectionTheme:is("potvrzeni_objednavky"),isActive:ss("potvrzeni_objednavky"),children:[(0,fe.jsxs)(cd,{sectionTheme:is("potvrzeni_objednavky"),children:[(0,fe.jsx)(pd,{sectionTheme:is("potvrzeni_objednavky"),children:(0,fe.jsx)(p.g,{icon:u.SGM})}),"Potvrzen\xed objedn\xe1vky dodavatelem",Ds&&!mc&&(0,fe.jsx)(_d,{title:"Sekce z minul\xe9 f\xe1ze je uzam\u010dena (read-only historie). Odemknout m\u016f\u017ee administr\xe1tor nebo u\u017eivatel s pr\xe1vem ORDER_MANAGE.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,fe.jsxs)(vd,{children:[Ds&&!mc&&gs&&(0,fe.jsx)(Qd,{onClick:e=>{e.stopPropagation(),or(!0)},title:"Odemknout sekci Potvrzen\xed od dodavatele",children:(0,fe.jsx)(x,{})}),(0,fe.jsx)(ud,{collapsed:Ge.potvrzeni_objednavky,sectionTheme:is("potvrzeni_objednavky"),onClick:()=>sp("potvrzeni_objednavky"),style:{cursor:"pointer"},children:(0,fe.jsx)(p.g,{icon:u.w2A})})]})]}),(0,fe.jsxs)(md,{collapsed:Ge.potvrzeni_objednavky,"data-section":"potvrzeni_objednavky",children:[(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:"ANO"===(null===(X=qn.dodavatel_zpusob_potvrzeni)||void 0===X?void 0:X.potvrzeni)?"#f0fdf4":"#f9fafb",marginBottom:"1rem"},children:[(0,fe.jsx)("span",{style:{fontSize:"1rem",fontWeight:"500",color:"#374151"},children:"Dodavatel objedn\xe1vku potvrdil:"}),(0,fe.jsx)("div",{style:{display:"flex",gap:"1rem"},children:["ANO","NE"].map(e=>{var n,a;return(0,fe.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",border:"1px solid #e5e7eb",borderRadius:"6px",cursor:lc?"not-allowed":"pointer",backgroundColor:(null===(n=qn.dodavatel_zpusob_potvrzeni)||void 0===n?void 0:n.potvrzeni)===e?"#f0f9ff":"#fff",opacity:lc?.6:1,fontWeight:"500"},children:[(0,fe.jsx)("input",{type:"radio",name:"potvrzeni_dodavatele",value:e,checked:(null===(a=qn.dodavatel_zpusob_potvrzeni)||void 0===a?void 0:a.potvrzeni)===e,disabled:lc,onChange:()=>{},onClick:e=>{var n,a;let o;o=(null===(n=qn.dodavatel_zpusob_potvrzeni)||void 0===n?void 0:n.potvrzeni)===e.target.value?"":e.target.value;const i=(0,t.A)((0,t.A)({},qn.dodavatel_zpusob_potvrzeni),{},{potvrzeni:o,zpusoby:"ANO"===o&&(null===(a=qn.dodavatel_zpusob_potvrzeni)||void 0===a?void 0:a.zpusoby)||[],platba:"ANO"===o?"faktura":""});Rp("dodavatel_zpusob_potvrzeni",i),"ANO"===o&&we?(Rp("dodavatel_potvrdil_id",we),Ic("info","AKCEPTACE","dodavatel-potvrdil","Automaticky nastaven dodavatel_potvrdil_id: ".concat(we))):"ANO"!==o&&(Rp("dodavatel_potvrdil_id",null),Ic("info","AKCEPTACE","dodavatel-reset","Vymaz\xe1n dodavatel_potvrdil_id (potvrzen\xed nen\xed ANO)"))},style:{cursor:"pointer"}}),e]},e)})})]}),"ANO"===(null===(Q=qn.dodavatel_zpusob_potvrzeni)||void 0===Q?void 0:Q.potvrzeni)&&(0,fe.jsx)(fe.Fragment,{children:(0,fe.jsxs)(gd,{children:[(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"Zp\u016fsob potvrzen\xed"}),(0,fe.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginTop:"0.5rem"},children:[{value:"email",label:"E-mail"},{value:"telefon",label:"Telefon\xe1t"},{value:"podepsana_objednavka",label:"Podepsan\xe1 objedn\xe1vka"},{value:"eshop",label:"e-Shop"}].map(e=>{var n,a;const o=!!Array.isArray(null===(n=qn.dodavatel_zpusob_potvrzeni)||void 0===n?void 0:n.zpusoby)&&qn.dodavatel_zpusob_potvrzeni.zpusoby.includes(e.value),i="ANO"!==(null===(a=qn.dodavatel_zpusob_potvrzeni)||void 0===a?void 0:a.potvrzeni)||lc||gt||Qt,r=!!wo.dodavatel_zpusob_potvrzeni;return(0,fe.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",border:r?"2px solid #dc2626":"1px solid #e5e7eb",borderRadius:"6px",cursor:i?"not-allowed":"pointer",backgroundColor:o?"#f0f9ff":"#fff",opacity:i?.5:1},children:[(0,fe.jsx)("input",{type:"checkbox",checked:o,disabled:i,onChange:n=>{var a;const o=Array.isArray(null===(a=qn.dodavatel_zpusob_potvrzeni)||void 0===a?void 0:a.zpusoby)?qn.dodavatel_zpusob_potvrzeni.zpusoby:[];let i;i=n.target.checked?[...o,e.value]:o.filter(n=>n!==e.value);const r=(0,t.A)((0,t.A)({},qn.dodavatel_zpusob_potvrzeni),{},{zpusoby:i}),s=(new Date).toISOString();Xn(e=>(0,t.A)((0,t.A)({},e),{},{dodavatel_zpusob_potvrzeni:r,dt_akceptace:i.length>0?s:""})),ya(!0)},style:{cursor:"pointer"}}),e.label]},e.value)})}),wo.dodavatel_zpusob_potvrzeni&&(0,fe.jsx)("div",{style:{color:"#dc2626",fontSize:"0.875rem",marginTop:"0.5rem",fontWeight:"500"},children:wo.dodavatel_zpusob_potvrzeni})]}),(0,fe.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:["ANO"===(null===(ee=qn.dodavatel_zpusob_potvrzeni)||void 0===ee?void 0:ee.potvrzeni)&&(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"Datum akceptace"}),(0,fe.jsx)(dc,{fieldName:"dt_akceptace",value:qn.dt_akceptace,onChange:e=>Rp("dt_akceptace",e),onBlur:e=>rp("dt_akceptace",e),disabled:lc||gt||Qt,hasError:!!wo.dt_akceptace,placeholder:"Vyberte datum..."}),wo.dt_akceptace&&(0,fe.jsx)("div",{style:{color:"#dc2626",fontSize:"0.875rem",marginTop:"0.5rem",fontWeight:"500"},children:wo.dt_akceptace})]}),(0,fe.jsxs)(bd,{style:{marginTop:"calc(2.5rem + 2px)"},children:[(0,fe.jsx)(xd,{required:!0,children:"Zp\u016fsob platby"}),(0,fe.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginTop:"0.5rem"},children:(0,fe.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",border:"1px solid #e5e7eb",borderRadius:"6px",cursor:"default",backgroundColor:"#f0f9ff",marginTop:"2px"},children:[(0,fe.jsx)("input",{type:"radio",name:"platba_dodavatel",value:"faktura",checked:!0,disabled:lc||gt||Qt,readOnly:!0,style:{cursor:"default"}}),"Faktura"]})}),wo.zpusob_platby&&(0,fe.jsx)("div",{style:{color:"#dc2626",fontSize:"0.875rem",marginTop:"0.5rem",fontWeight:"500"},children:wo.zpusob_platby})]})]})]})}),"ANO"===(null===(ne=qn.dodavatel_zpusob_potvrzeni)||void 0===ne?void 0:ne.potvrzeni)&&(null===(ae=qn.dodavatel_zpusob_potvrzeni)||void 0===ae||null===(oe=ae.zpusoby)||void 0===oe?void 0:oe.length)>0&&(null===(te=qn.dodavatel_zpusob_potvrzeni)||void 0===te?void 0:te.platba)&&!qn.stav_odeslano&&aa<4&&(0,fe.jsxs)("div",{style:{backgroundColor:"#f0f9ff",border:"1px solid #bfdbfe",borderRadius:"8px",padding:"1rem",marginTop:"1rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsx)(p.g,{icon:u.iW_,style:{color:"#3b82f6",fontSize:"1rem"}}),(0,fe.jsx)("span",{style:{fontSize:"0.875rem",color:"#1e40af"},children:"Po vypln\u011bn\xed \xfadaj\u016f o dodavateli budou dostupn\xe9 dal\u0161\xed sekce."})]}),qn.dt_akceptace&&(0,fe.jsxs)("div",{style:{fontSize:"0.875rem",color:"#1e40af",marginTop:"0.25rem"},children:[(0,fe.jsx)("strong",{children:"Datum potvrzen\xed:"})," ",(0,Za.iS)(qn.dt_akceptace),qn.dodavatel_potvrdil_id&&(0,fe.jsxs)("div",{style:{marginTop:"0.25rem"},children:[(0,fe.jsx)("strong",{children:"Potvrdil:"})," ",Pc(qn.dodavatel_potvrdil_id)]})]})]})]})}),ca(qn.stav_workflow_kod,"POTVRZENA")&&qn.dodavatel_potvrdil_id&&qn.dt_akceptace?(0,fe.jsxs)("div",{style:{backgroundColor:"#dcfce7",border:"1px solid #16a34a",borderRadius:"6px",padding:"1rem",marginTop:"1rem",color:"#166534",fontSize:"0.875rem"},children:[(0,fe.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.25rem"},children:"\u2705 Dodavatel potvrdil objedn\xe1vku"}),(0,fe.jsxs)("div",{children:[(0,fe.jsx)("strong",{children:"Datum potvrzen\xed:"})," ",(0,Za.iS)(qn.dt_akceptace)," \u2022 ",(0,fe.jsx)("strong",{children:"Potvrdil:"})," ",Pc(qn.dodavatel_potvrdil_id)]}),((null===(ie=qn.dodavatel_zpusob_potvrzeni)||void 0===ie||null===(re=ie.zpusoby)||void 0===re?void 0:re.length)>0||(null===(se=qn.dodavatel_zpusob_potvrzeni)||void 0===se?void 0:se.platba))&&(0,fe.jsxs)("div",{children:[(null===(de=qn.dodavatel_zpusob_potvrzeni)||void 0===de||null===(le=de.zpusoby)||void 0===le?void 0:le.length)>0&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)("strong",{children:"Zp\u016fsob potvrzen\xed:"})," ",qn.dodavatel_zpusob_potvrzeni.zpusoby.map(e=>({email:"E-mail",telefon:"Telefon\xe1t",podepsana_objednavka:"Podepsan\xe1 objedn\xe1vka",eshop:"e-Shop"}[e]||e)).join(", ")]}),(null===(he=qn.dodavatel_zpusob_potvrzeni)||void 0===he||null===(ke=he.zpusoby)||void 0===ke?void 0:ke.length)>0&&(null===(ge=qn.dodavatel_zpusob_potvrzeni)||void 0===ge?void 0:ge.platba)&&" \u2022 ",(null===(be=qn.dodavatel_zpusob_potvrzeni)||void 0===be?void 0:be.platba)&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)("strong",{children:"Platba:"})," ","faktura"===qn.dodavatel_zpusob_potvrzeni.platba?"Fakturou":"hotove"===qn.dodavatel_zpusob_potvrzeni.platba?"Hotov\u011b (pokladna)":qn.dodavatel_zpusob_potvrzeni.platba]})]})]}):(0,fe.jsxs)("div",{style:{backgroundColor:"#dbeafe",border:"2px solid #3b82f6",borderRadius:"8px",padding:"1rem",marginTop:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsx)(p.g,{icon:u.iW_,style:{color:"#3b82f6",fontSize:"1.25rem"}}),(0,fe.jsxs)("div",{style:{flex:1},children:[(0,fe.jsx)("div",{style:{fontWeight:"600",color:"#1e40af",marginBottom:"0.25rem"},children:"\u2139\ufe0f \u010cek\xe1 se na potvrzen\xed dodavatelem"}),(0,fe.jsx)("div",{style:{fontSize:"0.875rem",color:"#1e40af"},children:"Po potvrzen\xed objedn\xe1vky dodavatelem se zde zobraz\xed \xfadaje o potvrzen\xed."})]})]})]})]}),Ss.visible&&(0,fe.jsxs)(dd,{"data-section":"registr_smluv",children:[(0,fe.jsxs)(ld,{sectionTheme:is("registr_smluv"),isActive:ss("registr_smluv"),children:[(0,fe.jsxs)(cd,{sectionTheme:is("registr_smluv"),children:[(0,fe.jsx)(pd,{sectionTheme:is("registr_smluv"),children:(0,fe.jsx)(p.g,{icon:u.IJd})}),(0,fe.jsx)("span",{children:"Rozhodnut\xed o zve\u0159ejn\u011bn\xed v registru smluv"}),Es&&!mc&&(0,fe.jsx)(_d,{title:qn.dt_zverejneni&&qn.registr_iddt&&qn.ma_byt_zverejnena?"Registr je zve\u0159ejn\u011bn a zam\u010den. Odemknout m\u016f\u017ee pouze u\u017eivatel s opr\xe1vn\u011bn\xedm ORDER_PUBLISH_REGISTRY.":!1===qn.ma_byt_zverejnena&&aa>=6?"Registr nen\xed k zve\u0159ejn\u011bn\xed a je zam\u010den. Odemknout m\u016f\u017ee pouze u\u017eivatel s opr\xe1vn\u011bn\xedm ORDER_PUBLISH_REGISTRY.":"Registr je zam\u010den. Odemknout m\u016f\u017ee pouze u\u017eivatel s opr\xe1vn\u011bn\xedm ORDER_PUBLISH_REGISTRY.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,fe.jsxs)(vd,{children:[Es&&!mc&&vs&&(0,fe.jsx)(Qd,{onClick:e=>{e.stopPropagation(),nr(!0)},title:"Odemknout sekci Registr smluv",children:(0,fe.jsx)(x,{})}),(0,fe.jsx)(ud,{collapsed:Ge.registr_smluv,sectionTheme:is("registr_smluv"),onClick:()=>sp("registr_smluv"),style:{cursor:"pointer"},children:(0,fe.jsx)(p.g,{icon:u.w2A})})]})]}),(0,fe.jsxs)(md,{collapsed:Ge.registr_smluv,children:[(0,fe.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,fe.jsx)(xd,{style:{marginBottom:"0.5rem"},children:"Zve\u0159ejn\u011bn\xed"}),(0,fe.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.625rem 1rem",backgroundColor:qn.ma_byt_zverejnena?"#dcfce7":"#fff",border:qn.ma_byt_zverejnena?"2px solid #16a34a":"2px solid #e5e7eb",borderRadius:"8px",cursor:Es?"not-allowed":"pointer",fontSize:"0.95rem",fontWeight:"500",color:qn.ma_byt_zverejnena?"#166534":"#374151",opacity:Es?.6:1,minHeight:"44px",boxSizing:"border-box"},children:[(0,fe.jsx)("input",{type:"checkbox",checked:qn.ma_byt_zverejnena||!1,onChange:e=>{Es||(!e.target.checked&&qn.ma_byt_zverejnena&&Tc>=5e4?ir(!0):Rp("ma_byt_zverejnena",e.target.checked))},disabled:Es,style:{width:"18px",height:"18px",cursor:Es?"not-allowed":"pointer",flexShrink:0}}),(0,fe.jsx)("span",{style:{flex:1},children:aa>=5?"Objedn\xe1vka m\xe1 b\xfdt zve\u0159ejn\u011bna v registru smluv":"M\xe1 b\xfdt zve\u0159ejn\u011bna"})]}),(0,fe.jsx)("div",{style:{marginTop:"0.75rem",padding:"0.75rem 1rem",backgroundColor:Tc>=5e4?"#dbeafe":"#f3f4f6",border:"1px solid ".concat(Tc>=5e4?"#3b82f6":"#d1d5db"),borderRadius:"6px",fontSize:"0.875rem",color:Tc>=5e4?"#1e40af":"#6b7280"},children:(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.5rem"},children:[(0,fe.jsx)(p.g,{icon:u.iW_,style:{fontSize:"1rem",marginTop:"0.125rem",flexShrink:0}}),(0,fe.jsxs)("div",{children:[(0,fe.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.25rem"},children:Tc>=5e4?"Povinn\xe9 zve\u0159ejn\u011bn\xed":"Voliteln\xe9 zve\u0159ejn\u011bn\xed"}),(0,fe.jsx)("div",{children:Tc>=5e4?(0,fe.jsxs)(fe.Fragment,{children:["Celkov\xe1 cena ",(0,fe.jsxs)("strong",{children:[Tc.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d bez DPH"]})," je nad limitem 50 000 K\u010d. Objedn\xe1vka ",(0,fe.jsx)("strong",{children:"mus\xed b\xfdt zve\u0159ejn\u011bna"})," v registru smluv podle z\xe1kona."]}):(0,fe.jsxs)(fe.Fragment,{children:["Celkov\xe1 cena ",(0,fe.jsxs)("strong",{children:[Tc.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d bez DPH"]})," je pod limitem 50 000 K\u010d. Zve\u0159ejn\u011bn\xed v registru smluv je voliteln\xe9."]})})]})]})})]}),(ea||4===aa)&&(0,fe.jsx)(fe.Fragment,{children:!qn.ma_byt_zverejnena&&Tc<5e4&&(0,fe.jsx)("div",{style:{padding:"1rem",backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"6px",fontSize:"0.875rem",color:"#92400e"},children:"\u2139\ufe0f Po ulo\u017een\xed s od\u0161krtnut\xfdm checkboxem se p\u0159esko\u010d\xed vypl\u0148ov\xe1n\xed registru smluv a pokra\u010duje se p\u0159\xedmo k fakturaci."})})]})]}),(()=>{const e=qn.dt_zverejneni&&qn.registr_iddt;return Cs.visible&&!vs&&!e&&(0,fe.jsxs)("div",{style:{margin:"2rem 0",padding:"1rem 1.25rem",backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"8px",color:"#92400e"},children:[(0,fe.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"\ud83d\udd12 Zve\u0159ejn\u011bn\xed v registru smluv"}),(0,fe.jsx)("div",{style:{fontSize:"0.875rem"},children:"Objedn\xe1vka \u010dek\xe1 na zve\u0159ejn\u011bn\xed v registru smluv. Tuto akci m\u016f\u017ee prov\xe9st pouze u\u017eivatel s opr\xe1vn\u011bn\xedm pro spr\xe1vu registru."})]})})(),(()=>{const e=qn.dt_zverejneni&&qn.registr_iddt;return Cs.visible&&(vs||e)&&(0,fe.jsxs)(dd,{"data-section":"registr_smluv_vyplneni",children:[(0,fe.jsxs)(ld,{sectionTheme:is("registr_smluv_vyplneni"),isActive:ss("registr_smluv_vyplneni"),children:[(0,fe.jsxs)(cd,{sectionTheme:is("registr_smluv_vyplneni"),children:[(0,fe.jsx)(pd,{sectionTheme:is("registr_smluv_vyplneni"),children:(0,fe.jsx)(p.g,{icon:u.IJd})}),(0,fe.jsx)("span",{children:"Potvrzen\xed zve\u0159ejn\u011bn\xed objedn\xe1vky v registru smluv"}),Ns&&!mc&&(0,fe.jsx)(_d,{title:"Registr je zam\u010den. Odemknout m\u016f\u017ee pouze u\u017eivatel s opr\xe1vn\u011bn\xedm ORDER_PUBLISH_REGISTRY.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,fe.jsxs)(vd,{children:[Ns&&!mc&&vs&&(0,fe.jsx)(Qd,{onClick:e=>{e.stopPropagation(),nr(!0)},title:"Odemknout sekci Registr smluv",children:(0,fe.jsx)(x,{})}),(0,fe.jsx)(ud,{collapsed:Ge.registr_smluv_vyplneni,sectionTheme:is("registr_smluv_vyplneni"),onClick:()=>sp("registr_smluv_vyplneni"),style:{cursor:"pointer"},children:(0,fe.jsx)(p.g,{icon:u.w2A})})]})]}),(0,fe.jsxs)(md,{collapsed:Ge.registr_smluv_vyplneni,children:[(0,fe.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"300px 1fr 1fr",gap:"1.5rem",alignItems:"start"},children:[(0,fe.jsxs)("div",{children:[(0,fe.jsx)(xd,{style:{marginBottom:"0.5rem"},children:"Zve\u0159ejn\u011bn\xed"}),(0,fe.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.625rem 1rem",backgroundColor:qn.ma_byt_zverejnena?"#dcfce7":"#fff",border:qn.ma_byt_zverejnena?"2px solid #16a34a":"2px solid #e5e7eb",borderRadius:"8px",cursor:Ns?"not-allowed":"pointer",fontSize:"0.95rem",fontWeight:"500",color:qn.ma_byt_zverejnena?"#166534":"#374151",opacity:Ns?.6:1,minHeight:"44px",boxSizing:"border-box"},children:[(0,fe.jsx)("input",{type:"checkbox",checked:qn.ma_byt_zverejnena||!1,onChange:e=>{Ns||(!e.target.checked&&qn.ma_byt_zverejnena&&Tc>=5e4?ir(!0):Rp("ma_byt_zverejnena",e.target.checked))},disabled:Ns,style:{width:"18px",height:"18px",cursor:Ns?"not-allowed":"pointer",flexShrink:0}}),(0,fe.jsx)("span",{style:{flex:1,whiteSpace:"nowrap"},children:"M\xe1 b\xfdt zve\u0159ejn\u011bna"})]})]}),(0,fe.jsxs)("div",{children:[(0,fe.jsx)(xd,{required:qn.ma_byt_zverejnena,children:"Datum zve\u0159ejn\u011bn\xed (VZ)"}),(0,fe.jsx)(dc,{fieldName:"dt_zverejneni",value:qn.dt_zverejneni,onChange:e=>{if(Rp("dt_zverejneni",e),e&&!qn.zverejnil_id){const e=localStorage.getItem("user_id");e&&Rp("zverejnil_id",parseInt(e,10))}},onBlur:e=>rp("dt_zverejneni",e),disabled:!qn.ma_byt_zverejnena||Ns,hasError:!!wo.dt_zverejneni,placeholder:"Vyberte datum..."}),wo.dt_zverejneni&&(0,fe.jsx)(yd,{style:{marginTop:"0.5rem"},children:wo.dt_zverejneni})]}),(0,fe.jsxs)("div",{children:[(0,fe.jsx)(xd,{required:qn.ma_byt_zverejnena,children:"Identifik\xe1tor"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(p.g,{icon:u.CYF}),(0,fe.jsx)(Sd,{type:"text",name:"registr_iddt",value:qn.registr_iddt||"",onChange:e=>{if(Rp("registr_iddt",e.target.value),e.target.value&&!qn.zverejnil_id){const e=localStorage.getItem("user_id");e&&Rp("zverejnil_id",parseInt(e,10))}},disabled:!qn.ma_byt_zverejnena||Ns,hasError:!!wo.registr_iddt,hasIcon:!0,placeholder:"Zadejte identifik\xe1tor..."})]}),wo.registr_iddt&&(0,fe.jsx)(yd,{style:{marginTop:"0.5rem"},children:wo.registr_iddt})]})]}),!qn.ma_byt_zverejnena&&(0,fe.jsxs)("div",{style:{padding:"0.875rem 1rem",backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"6px",fontSize:"0.875rem",color:"#92400e",marginTop:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsx)(p.g,{icon:u.iW_,style:{fontSize:"1rem"}}),(0,fe.jsx)("div",{children:(0,fe.jsx)("strong",{children:"Objedn\xe1vka nebude zve\u0159ejn\u011bna v registru smluv."})})]}),ca(qn.stav_workflow_kod,"UVEREJNENA")&&(0,fe.jsxs)("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#dcfce7",border:"1px solid #16a34a",borderRadius:"6px",fontSize:"0.875rem",color:"#166534"},children:[(0,fe.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.25rem"},children:"\u2705 Objedn\xe1vka byla zve\u0159ejn\u011bna v registru smluv"}),(0,fe.jsxs)("div",{children:[(0,fe.jsx)("strong",{children:"Datum zve\u0159ejn\u011bn\xed:"})," ",(0,Za.iS)(qn.dt_zverejneni)," \u2022 ",(0,fe.jsx)("strong",{children:"Zve\u0159ejnil:"})," ",Pc(qn.zverejnil_id),qn.registr_iddt&&(0,fe.jsxs)(fe.Fragment,{children:[" \u2022 ",(0,fe.jsx)("strong",{children:"ID registru:"})," ",qn.registr_iddt]})]})]})]})]})})(),((e,n,a)=>{const o="pokladna"===(null===(e=qn.financovani)||void 0===e?void 0:e.platba),i="pokladna"===(null===(n=qn.dodavatel_zpusob_potvrzeni)||void 0===n?void 0:n.platba),r=o||i,s=qn.faktury&&qn.faktury.length>0,d=!r&&(_s?aa>=6:aa>=7||s),l="(po\u010det: ".concat((null===(a=qn.faktury)||void 0===a?void 0:a.length)||0,")");return d?(0,fe.jsxs)(dd,{"data-section":"fakturace",children:[(0,fe.jsxs)(ld,{sectionTheme:"section-invoice",isActive:!0,style:{background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",borderColor:"#2563eb"},children:[(0,fe.jsxs)(cd,{sectionTheme:"section-invoice",style:{color:"#fff"},children:[(0,fe.jsx)(pd,{sectionTheme:"section-invoice",style:{color:"#fff"},children:(0,fe.jsx)(p.g,{icon:u.$O8})}),"Fakturace k objedn\xe1vce",(0,fe.jsx)("span",{style:{fontSize:"0.75rem",marginLeft:"0.5rem",fontWeight:"400",opacity:.9},children:l}),pc&&!mc&&(0,fe.jsx)(_d,{title:"Sekce je zam\u010dena. Odemknout m\u016f\u017ee administr\xe1tor nebo u\u017eivatel s pr\xe1vem ORDER_MANAGE.",children:"\ud83d\udd12 Sekce zam\u010dena"})]}),(0,fe.jsxs)(vd,{children:[pc&&!mc&&_s&&(0,fe.jsx)(Qd,{onClick:e=>{e.stopPropagation(),sr(!0)},title:"Odemknout sekci Fakturace",children:(0,fe.jsx)(x,{})}),(0,fe.jsx)(ud,{collapsed:Ge.fakturace,onClick:()=>sp("fakturace"),style:{color:"#fff",cursor:"pointer"},children:(0,fe.jsx)(p.g,{icon:u.w2A})})]})]}),(0,fe.jsx)(md,{collapsed:Ge.fakturace,children:(0,fe.jsx)("div",{children:r?(0,fe.jsxs)("div",{style:{padding:"1.5rem"},children:[(()=>{if((!qn.faktury||0===qn.faktury.length)&&!ur){const e=Ps(new Date),n={id:"temp-pokladna-".concat(Date.now()),objednavka_id:qn.id,fa_datum_doruceni:e,fa_dorucena:1,fa_castka:null,fa_cislo_vema:"",fa_strediska_kod:qn.strediska_kod||[],fa_splatnost:null,fa_poznamka:"",vytvoril_uzivatel_id:we,vytvoril_jmeno:Pc(we),dt_vytvoreni:(new Date).toISOString(),dt_aktualizace:null,aktivni:1,_isNew:!0,_isPokladna:!0,attachments:[]};setTimeout(()=>{yc([n])},0)}return null})(),(0,fe.jsxs)("div",{style:{background:"#f8fafc",border:"2px solid #e2e8f0",borderRadius:"8px",padding:"2rem"},children:[(0,fe.jsx)("div",{style:{fontSize:"2.5rem",marginBottom:"1rem",textAlign:"center",color:"#64748b"},children:"\ud83d\udcc4"}),(0,fe.jsx)("div",{style:{fontSize:"1.125rem",fontWeight:"500",color:"#334155",marginBottom:"0.5rem",textAlign:"center"},children:"P\u0159\xedlohy doklad\u016f z pokladny"}),(0,fe.jsx)("div",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"1.5rem",textAlign:"center"},children:"Nahrajte paragony, pokladn\xed doklady a dal\u0161\xed dokumenty k platb\u011b"}),qn.faktury&&qn.faktury.length>0&&qn.faktury[0]&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(ue.r6,{fakturaId:qn.faktury[0].id,objednavkaId:qn.id,fakturaTypyPrilohOptions:Xr,readOnly:uc,onISDOCParsed:Fc,formData:qn,faktura:qn.faktury[0],validateInvoiceForAttachments:Mc,isPokladna:!0,allUsers:Rr,attachments:(()=>{const e=qn.faktury[0].attachments||[];return console.log("\ud83d\udd0d [OrderForm25] P\u0159ed\xe1v\xe1m p\u0159\xedlohy do InvoiceAttachmentsCompact (fakturaId=".concat(qn.faktury[0].id,"):"),e),e})(),onAttachmentsChange:e=>{console.log("\ud83d\udd0d [OrderForm25] onAttachmentsChange vol\xe1n s:",e),Zc(qn.faktury[0].id,e)},onAttachmentUploaded:e=>{Kc(qn.faktury[0].id,e)},onCreateInvoiceInDB:Bc},"pokladna-attachments-".concat(qn.faktury[0].id,"-").concat(qn.id)),(0,fe.jsx)(gd,{style:{marginTop:"1.5rem"},children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsxs)(xd,{children:["Pozn\xe1mka k platb\u011b",(0,fe.jsx)("span",{style:{fontSize:"0.75rem",color:"#64748b",fontWeight:"normal",marginLeft:"0.5rem"},children:"(Voliteln\xe9)"})]}),(0,fe.jsx)(Ed,{value:qn.faktury[0].fa_poznamka||"",onChange:e=>{const n=qn.faktury.map((n,a)=>0===a?(0,t.A)((0,t.A)({},n),{},{fa_poznamka:e.target.value}):n);yc(n)},disabled:uc,placeholder:"Nap\u0159.: Platba za materi\xe1l, paragony ze dne 1.11.2025, apod.",rows:3})]})})]}),(0,fe.jsxs)("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"6px",fontSize:"0.875rem",color:"#92400e",textAlign:"left"},children:[(0,fe.jsx)("strong",{children:"\u2139\ufe0f Pozn\xe1mka:"})," P\u0159i platb\u011b pokladnou nen\xed nutn\xe9 vypl\u0148ovat \u010d\xedsla faktur ani \u010d\xe1stky. Sta\u010d\xed nahr\xe1t paragony nebo pokladn\xed doklady jako p\u0159\xedlohy a p\u0159\xedpadn\u011b doplnit pozn\xe1mku."]})]})]}):(0,fe.jsxs)(fe.Fragment,{children:[(()=>{if((!qn.faktury||0===qn.faktury.length)&&!ur){const e=Ps(new Date),n={id:"temp-".concat(Date.now()),objednavka_id:qn.id,fa_datum_doruceni:e,fa_dorucena:1,fa_castka:"",fa_cislo_vema:"",fa_strediska_kod:qn.strediska_kod||[],fa_splatnost:"",fa_poznamka:"",vytvoril_uzivatel_id:we,vytvoril_jmeno:Pc(we),dt_vytvoreni:(new Date).toISOString(),dt_aktualizace:null,aktivni:1,_isNew:!0,attachments:[]};setTimeout(()=>{yc([n])},0)}return null})(),ur?(0,fe.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#64748b"},children:"Na\u010d\xedt\xe1n\xed faktur..."}):(0,fe.jsxs)("div",{style:{marginTop:"1.5rem"},children:[qn.faktury&&0!==qn.faktury.length?qn.faktury.map((e,n)=>{var a,o;const i=(null===vr||void 0===vr?void 0:vr.id)===e.id,r=i?mr:e,s=1===e.vecna_spravnost_potvrzeno;return(0,fe.jsxs)("div",{style:{border:"2px solid #3b82f6",borderRadius:"12px",padding:"0",marginBottom:"1.5rem",background:i?"#f0f9ff":s?"#f0fdf4":"#ffffff",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08)",overflow:"visible"},children:[(0,fe.jsxs)("div",{style:{background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",color:"white",padding:"1rem 1.25rem",fontWeight:"700",fontSize:"1.1rem",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"1rem",borderBottom:"3px solid #1e40af",letterSpacing:"0.5px",textTransform:"uppercase"},children:[(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,fe.jsx)(p.g,{icon:u.$O8,style:{fontSize:"1.2rem"}}),"Faktura #",n+1,0===n&&(0,fe.jsx)("span",{style:{color:"#fef3c7",fontSize:"1.3rem"},children:"*"}),e.fa_cislo_vema&&(0,fe.jsx)("span",{style:{fontWeight:"600",fontSize:"0.9rem",background:"rgba(255, 255, 255, 0.2)",padding:"0.25rem 0.75rem",borderRadius:"6px",letterSpacing:"normal",textTransform:"none"},children:e.fa_cislo_vema}),(0,fe.jsxs)(xc,{children:[(0,fe.jsx)(jc,{className:"help-icon",children:(0,fe.jsx)(k.A,{})}),(0,fe.jsxs)(zc,{className:"tooltip-bubble",children:[e._isdoc_dodavatel&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsxs)(Ac,{children:[(0,fe.jsx)(wc,{children:"Vystavil:"}),(0,fe.jsxs)(Sc,{style:{display:"flex",alignItems:"center",gap:"6px",fontWeight:"600"},children:[e._isdoc_dodavatel.nazev||"---",e._isdoc_dodavatel.nazev&&(0,fe.jsx)(R,{size:14,style:{cursor:"pointer",color:"#6b7280"},onClick:()=>{navigator.clipboard.writeText(e._isdoc_dodavatel.nazev),ze&&ze("N\xe1zev zkop\xedrov\xe1n",{type:"success"})},title:"Zkop\xedrovat n\xe1zev"})]})]}),(0,fe.jsxs)(Ac,{children:[(0,fe.jsx)(wc,{children:"I\u010cO:"}),(0,fe.jsxs)(Sc,{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e._isdoc_dodavatel.ico||"---",e._isdoc_dodavatel.ico&&(0,fe.jsx)(R,{size:14,style:{cursor:"pointer",color:"#6b7280"},onClick:()=>{navigator.clipboard.writeText(e._isdoc_dodavatel.ico),ze&&ze("I\u010cO zkop\xedrov\xe1no",{type:"success"})},title:"Zkop\xedrovat I\u010cO"})]})]}),(0,fe.jsx)("div",{style:{borderTop:"1px solid #e5e7eb",margin:"8px 0"}})]}),e._isdoc_email&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsxs)(Ac,{children:[(0,fe.jsx)(wc,{children:"Sm\u011brov\xe1no na:"}),(0,fe.jsxs)(Sc,{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e._isdoc_email,(0,fe.jsx)(R,{size:14,style:{cursor:"pointer",color:"#6b7280"},onClick:()=>{navigator.clipboard.writeText(e._isdoc_email),ze&&ze("Email zkop\xedrov\xe1n",{type:"success"})},title:"Zkop\xedrovat email"})]})]}),(0,fe.jsx)("div",{style:{borderTop:"1px solid #e5e7eb",margin:"8px 0"}})]}),(0,fe.jsxs)(Ac,{children:[(0,fe.jsx)(wc,{children:"\u010c\xedslo faktury:"}),(0,fe.jsx)(Sc,{children:e.fa_cislo_vema||"---"})]}),(0,fe.jsxs)(Ac,{children:[(0,fe.jsx)(wc,{children:"\u010c\xe1stka:"}),(0,fe.jsx)(Sc,{children:e.fa_castka?"".concat(parseFloat(e.fa_castka).toLocaleString("cs-CZ")," K\u010d"):"---"})]}),(0,fe.jsxs)(Ac,{children:[(0,fe.jsx)(wc,{children:"Datum vystaven\xed:"}),(0,fe.jsx)(Sc,{children:e.fa_datum_vystaveni?(0,Za.iS)(e.fa_datum_vystaveni):"---"})]}),(0,fe.jsxs)(Ac,{children:[(0,fe.jsx)(wc,{children:"Datum splatnosti:"}),(0,fe.jsx)(Sc,{children:e.fa_datum_splatnosti||e.fa_splatnost?(0,Za.iS)(e.fa_datum_splatnosti||e.fa_splatnost):"---"})]}),(0,fe.jsxs)(Ac,{children:[(0,fe.jsx)(wc,{children:"Datum doru\u010den\xed:"}),(0,fe.jsx)(Sc,{children:e.fa_datum_doruceni?(0,Za.iS)(e.fa_datum_doruceni):"---"})]}),(0,fe.jsxs)(Ac,{children:[(0,fe.jsx)(wc,{children:"V\u011bcn\xe1 spr\xe1vnost:"}),(0,fe.jsxs)(Sc,{children:["ANO"===e.vecna_spravnost_potvrzeno&&(0,fe.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:"#d1fae5",color:"#065f46",padding:"2px 8px",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600"},children:[(0,fe.jsx)(p.g,{icon:u.SGM}),"ANO"]}),"NE"===e.vecna_spravnost_potvrzeno&&(0,fe.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:"#fee2e2",color:"#991b1b",padding:"2px 8px",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600"},children:[(0,fe.jsx)(p.g,{icon:u.s0Q}),"NE"]}),!e.vecna_spravnost_potvrzeno&&(0,fe.jsx)("span",{style:{color:"#9ca3af",fontSize:"0.875rem"},children:"Neov\u011b\u0159eno"})]})]}),e.vecna_spravnost_umisteni_majetku&&(0,fe.jsxs)(Ac,{children:[(0,fe.jsx)(wc,{children:"Um\xedst\u011bn\xed majetku:"}),(0,fe.jsx)(Sc,{children:e.vecna_spravnost_umisteni_majetku})]}),e.vecna_spravnost_poznamka&&(0,fe.jsxs)(Ac,{children:[(0,fe.jsx)(wc,{children:"Pozn\xe1mka VS:"}),(0,fe.jsx)(Sc,{children:e.vecna_spravnost_poznamka})]}),(0,fe.jsxs)(Ac,{children:[(0,fe.jsx)(wc,{children:"St\u0159ediska:"}),(0,fe.jsx)(Sc,{title:(()=>{const n=e.fa_strediska_kod;return n?Array.isArray(n)?n.map(e=>"object"===typeof e&&(e.label||e.nazev||e.value||e.kod)||e).filter(Boolean).join(", ")||"---":"string"===typeof n&&n||"---":"---"})(),children:(()=>{const n=e.fa_strediska_kod;return n?Array.isArray(n)?n.map(e=>"object"===typeof e&&(e.label||e.nazev||e.value||e.kod)||e).filter(Boolean).join(", ")||"---":"string"===typeof n&&n||"---":"---"})()})]})]})]})]}),(0,fe.jsx)("div",{style:{display:"flex",gap:"0.5rem"},children:(0,fe.jsx)("button",{type:"button",disabled:uc,onClick:()=>{if(e._isNew){const n=Array.isArray(qn.faktury)?qn.faktury:[];if(yc(n.filter(n=>n.id!==e.id)),i){_r(null);const e=Nc.toString(),n=Ps(new Date);fr({fa_datum_doruceni:n,fa_dorucena:1,fa_castka:e,fa_cislo_vema:"",fa_strediska_kod:qn.strediska_kod||[],fa_poznamka:"",fa_splatnost:""})}}else(async e=>{var n;const a=null===(n=qn.faktury)||void 0===n?void 0:n.find(n=>n.id===e);if(!a)return;let o=0;if(e&&!String(e).startsWith("temp-"))try{var t;const n=await(0,La.CX)(e,Se,Ee,qn.id);o=((null===(t=n.data)||void 0===t?void 0:t.attachments)||n.data||[]).length}catch(i){}yo({isOpen:!0,fakturaId:e,fakturaNazev:a.fa_cislo_vema||"Faktura ".concat(a.id),pocetPriloh:o})})(e.id)},title:"Smazat fakturu",style:{background:uc?"rgba(255,255,255,0.3)":"rgba(220, 38, 38, 0.9)",color:"white",border:"1px solid rgba(255,255,255,0.5)",borderRadius:"6px",padding:"0.4rem",cursor:uc?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",opacity:uc?.6:1,transition:"all 0.2s ease"},children:(0,fe.jsx)(P.A,{size:16})})})]}),(0,fe.jsxs)("div",{style:{padding:"1.25rem"},children:[(0,fe.jsxs)(gd,{style:{gridTemplateColumns:"280px 1fr 1fr"},children:[(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"Datum doru\u010den\xed"}),(0,fe.jsx)(dc,{fieldName:"fa_".concat(n+1,"_datum_doruceni"),value:null!==(a=e.fa_datum_doruceni)&&void 0!==a?a:e._isNew?Ps(new Date):"",hasError:!!wo["faktura_".concat(n+1,"_datum_doruceni")],disabled:uc,onChange:n=>{const a=qn.faktury.map(a=>a.id===e.id?(0,t.A)((0,t.A)({},a),{},{fa_datum_doruceni:n,fa_dorucena:n?1:0,_isNew:!1}):a);yc(a)},placeholder:"Vyberte datum doru\u010den\xed"})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"Variabiln\xed symbol"}),(0,fe.jsxs)(wd,{hasIcon:!0,children:[(0,fe.jsx)(p.g,{icon:u.CYF}),(0,fe.jsx)(Sd,{type:"text",value:e.fa_cislo_vema||"",hasError:!!wo["faktura_".concat(n+1,"_cislo")],disabled:uc,onChange:n=>{const a=qn.faktury.map(a=>a.id===e.id?(0,t.A)((0,t.A)({},a),{},{fa_cislo_vema:n.target.value,_isNew:!1}):a);yc(a)},required:!0,placeholder:"12345678",hasIcon:!0})]})]}),(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"\u010c\xe1stka v\u010d. DPH"}),(0,fe.jsx)(sc,{fieldName:"fa_castka",value:null!==(o=e.fa_castka)&&void 0!==o?o:"",hasError:!!wo["faktura_".concat(n+1,"_castka")],disabled:uc,onChange:(n,a)=>{const o=qn.faktury.map(n=>n.id===e.id?(0,t.A)((0,t.A)({},n),{},{fa_castka:a,_isNew:!1}):n);yc(o)},placeholder:"25000.50"})]})]}),(0,fe.jsxs)(gd,{style:{gridTemplateColumns:"280px 1fr"},children:[(0,fe.jsxs)(bd,{children:[(0,fe.jsx)(xd,{required:!0,children:"Datum splatnosti"}),(0,fe.jsx)(dc,{fieldName:"fa_".concat(n+1,"_splatnost"),value:(n=>{var a;return!1===e._isNew?null!==(a=e.fa_splatnost)&&void 0!==a?a:"":null!==(n=e.fa_splatnost)&&void 0!==n?n:e.fa_datum_splatnosti?e.fa_datum_splatnosti.split(" ")[0]:""})(),hasError:!!wo["faktura_".concat(n+1,"_splatnost")],disabled:uc,onChange:n=>{const a=qn.faktury.map(a=>a.id===e.id?(0,t.A)((0,t.A)({},a),{},{fa_splatnost:n,_isNew:!1}):a);yc(a)},placeholder:"Vyberte datum splatnosti"})]}),(0,fe.jsxs)(bd,{"data-custom-select":!0,style:{gridColumn:"2 / -1"},children:[(0,fe.jsxs)(jd,{children:[(0,fe.jsx)(zd,{children:"St\u0159ediska"}),(0,fe.jsx)(Ad,{type:"button",$visible:(()=>{const n=e.fa_strediska_kod||[];return Array.isArray(n)&&n.length>0})(),onClick:()=>{const n=qn.faktury.map(n=>n.id===e.id?(0,t.A)((0,t.A)({},n),{},{fa_strediska_kod:[],_isNew:!1}):n);yc(n)},title:"Vymazat v\xfdb\u011br",children:(0,fe.jsx)(w.A,{size:12})})]}),(0,fe.jsx)(Uc,{value:(()=>{const n=e.fa_strediska_kod||qn.strediska_kod||[];return"string"===typeof n&&n.trim()?n.split(",").map(e=>e.trim()).filter(Boolean):Array.isArray(n)?n:[]})(),disabled:uc,onChange:n=>{const a=Array.isArray(n)?n.map(e=>"string"===typeof e?e:e.value||e.kod_stavu||e.id||e):[],o=qn.faktury.map(n=>n.id===e.id?(0,t.A)((0,t.A)({},n),{},{fa_strediska_kod:a,_isNew:!1}):n);yc(o)},options:Fr,placeholder:"Vyberte st\u0159ediska (auto-vypln\u011bno z objedn\xe1vky)",field:"strediska",required:!1,multiple:!0,icon:(0,fe.jsx)(C.A,{}),getOptionLabel:ru,getOptionValue:(e,n)=>e.value||e.id||e})]})]}),(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsx)(xd,{children:"Pozn\xe1mka"}),(0,fe.jsx)(Ed,{value:e.fa_poznamka||"",disabled:uc,onChange:n=>{const a=qn.faktury.map(a=>a.id===e.id?(0,t.A)((0,t.A)({},a),{},{fa_poznamka:n.target.value,_isNew:!1}):a);yc(a)},placeholder:"Voliteln\xe1 pozn\xe1mka...",rows:2})]})}),aa>=7&&(0,fe.jsxs)("div",{style:{marginTop:"1.5rem",padding:"1rem",background:s?"linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)":"linear-gradient(135deg, #fefefe 0%, #f3f4f6 100%)",border:s?"2px solid #22c55e":"2px solid #d1d5db",borderRadius:"8px"},children:[(0,fe.jsxs)("div",{style:{fontWeight:"700",fontSize:"0.95rem",color:"#166534",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsx)(p.g,{icon:u.SGM}),"V\u011bcn\xe1 spr\xe1vnost faktury #",n+1]}),(()=>{const n=qn.financovani;if(!n)return null;try{var a;const o="string"===typeof n?JSON.parse(n):n;if(!((null===o||void 0===o?void 0:o.typ_financovani)&&o.typ_financovani.includes("LP")||Array.isArray(qn.lp_kod)&&qn.lp_kod.length>0))return null;const i=e.id,r=i&&!String(i).startsWith("temp-");!r||null!==(a=ko[i])&&void 0!==a&&a.loaded||Promise.resolve().then(()=>{Rc(i)});const s=ko[i]||{lpCerpani:[],loaded:!1};return(0,fe.jsxs)("div",{style:{marginBottom:"1.5rem",padding:"1rem",background:"#fff8e1",border:"2px solid #ffb300",borderRadius:"8px"},children:[(0,fe.jsx)("div",{style:{fontWeight:"600",color:"#e65100",marginBottom:"1rem",fontSize:"0.9rem"},children:"\ud83d\udcb0 Rozd\u011blen\xed faktury mezi LP k\xf3dy"}),(0,fe.jsx)(ue.cy,{faktura:e,orderData:qn,lpCerpani:s.lpCerpani,availableLPCodes:Zr||[],onChange:e=>{go(n=>(0,t.A)((0,t.A)({},n),{},{[i]:{lpCerpani:e,loaded:!0}})),r&&Vc(i,e).catch(e=>{console.error("\u274c Chyba p\u0159i ukl\xe1d\xe1n\xed LP \u010derp\xe1n\xed:",e),ze&&ze("Nepoda\u0159ilo se ulo\u017eit LP \u010derp\xe1n\xed: "+e.message,"warning")})},disabled:!!e.vecna_spravnost_potvrzeno})]})}catch(o){return console.error("\u274c [LP Editor] Chyba p\u0159i zpracov\xe1n\xed LP editoru:",o),(0,fe.jsxs)("div",{style:{padding:"1rem",background:"#fee2e2",border:"1px solid #f87171",borderRadius:"6px",color:"#dc2626",marginBottom:"1rem"},children:["\u274c Chyba p\u0159i na\u010d\xedt\xe1n\xed LP editoru: ",o.message]})}})(),(()=>{const n=parseFloat(qn.max_cena_s_dph)||0,a=parseFloat(e.fa_castka)||0,o=a-n,t=o>0;return(0,fe.jsxs)("div",{style:{background:t?"#fef2f2":"#f0fdf4",border:"1px solid ".concat(t?"#ef4444":"#22c55e"),borderRadius:"6px",padding:"0.75rem",marginBottom:"1rem",fontSize:"0.85rem"},children:[(0,fe.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[(0,fe.jsx)("span",{style:{color:"#6b7280"},children:"Max. cena objedn\xe1vky s DPH:"}),(0,fe.jsxs)("span",{style:{fontWeight:"600",color:"#374151"},children:[n.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"]})]}),(0,fe.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[(0,fe.jsx)("span",{style:{color:"#6b7280"},children:"\u010c\xe1stka faktury s DPH:"}),(0,fe.jsxs)("span",{style:{fontWeight:"600",color:"#374151"},children:[a.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"]})]}),(0,fe.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"0.5rem",borderTop:"1px solid #e5e7eb",fontWeight:"700"},children:[(0,fe.jsx)("span",{style:{color:t?"#dc2626":"#16a34a"},children:t?"\u26a0\ufe0f P\u0159ekro\u010den\xed:":"\u2705 Rozd\xedl:"}),(0,fe.jsxs)("span",{style:{color:t?"#dc2626":"#16a34a"},children:[t?"+":"",o.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d"]})]})]})})(),(0,fe.jsxs)(gd,{children:[(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsx)(xd,{children:"Um\xedst\u011bn\xed majetku"}),(0,fe.jsx)(Sd,{value:e.vecna_spravnost_umisteni_majetku||"",disabled:hc,onChange:n=>{const a=qn.faktury.map(a=>a.id===e.id?(0,t.A)((0,t.A)({},a),{},{vecna_spravnost_umisteni_majetku:n.target.value,_isNew:!1}):a);yc(a)},placeholder:"Nap\u0159. Kladno, budova K2, m\xedstnost 203"})]}),(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(()=>{const n=parseFloat(qn.max_cena_s_dph)||0,a=(parseFloat(e.fa_castka)||0)>n;return(0,fe.jsxs)(xd,{required:a,style:a?{color:"#dc2626",fontWeight:"700"}:{},children:["Pozn\xe1mka k v\u011bcn\xe9 spr\xe1vnosti",a?" (POVINN\xc1 - faktura p\u0159ekra\u010duje MAX cenu)":""]})})(),(0,fe.jsx)(Ed,{value:e.vecna_spravnost_poznamka||"",disabled:hc,hasError:!!wo["faktura_".concat(n+1,"_poznamka_vs")],onChange:n=>{const a=qn.faktury.map(a=>a.id===e.id?(0,t.A)((0,t.A)({},a),{},{vecna_spravnost_poznamka:n.target.value,_isNew:!1}):a);yc(a)},placeholder:"Voliteln\xe1 pozn\xe1mka k v\u011bcn\xe9 spr\xe1vnosti...",rows:2}),wo["faktura_".concat(n+1,"_poznamka_vs")]&&(0,fe.jsx)(yd,{children:wo["faktura_".concat(n+1,"_poznamka_vs")]})]})]}),(()=>{const a=!!wo["faktura_".concat(n+1,"_vecna_spravnost")];return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsxs)("div",{style:{marginTop:"1rem",padding:"0.75rem",background:a?"#fef2f2":"#ffffff",border:a?"2px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px"},children:[(0,fe.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:hc?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:hc?"400":"600",color:a?"#dc2626":hc?"#9ca3af":"#374151"},children:[(0,fe.jsx)("input",{type:"checkbox",checked:1===e.vecna_spravnost_potvrzeno,disabled:hc,onChange:n=>{const a=n.target.checked?1:0;if(1===a){const a=qn.financovani;if(a)try{const n="string"===typeof a?JSON.parse(a):a;if("LP"===(null===n||void 0===n?void 0:n.typ)){const n=e.id,a=ko[n],o=(null===a||void 0===a?void 0:a.lpCerpani)||[];if(console.log("\ud83d\udcb0 [LP Validace] Kontroluji LP \u010derp\xe1n\xed pro fakturu:",n),console.log("\ud83d\udcb0 [LP Validace] LP \u010derp\xe1n\xed:",o),!o||0===o.length||o.every(e=>!e.lp_cislo||e.castka<=0))return void(ze&&ze("Pro LP financov\xe1n\xed je povinn\xe9 rozd\u011blit fakturu mezi LP k\xf3dy","error"));const t=o.reduce((e,n)=>e+(parseFloat(n.castka)||0),0),i=parseFloat(e.fa_castka)||0;if(t>i)return void(ze&&ze("Sou\u010det LP \u010derp\xe1n\xed (".concat(t.toLocaleString("cs-CZ")," K\u010d) p\u0159ekra\u010duje \u010d\xe1stku faktury (").concat(i.toLocaleString("cs-CZ")," K\u010d)"),"error"));console.log("\u2705 [LP Validace] LP \u010derp\xe1n\xed je platn\xe9")}}catch(n){return console.error("\u274c Chyba p\u0159i validaci LP \u010derp\xe1n\xed:",n),void(ze&&ze("Chyba p\u0159i validaci LP \u010derp\xe1n\xed","error"))}}let o={vecna_spravnost_potvrzeno:a,_isNew:!1};if(1===a&&we&&!e.potvrdil_vecnou_spravnost_id){const n=new Date,a=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0"),r=String(n.getHours()).padStart(2,"0"),s=String(n.getMinutes()).padStart(2,"0"),d=String(n.getSeconds()).padStart(2,"0"),l="".concat(a,"-").concat(t,"-").concat(i," ").concat(r,":").concat(s,":").concat(d);o.potvrdil_vecnou_spravnost_id=we,o.dt_potvrzeni_vecne_spravnosti=l,Ic("info","VECNA-FAKTURA","metadata-set","Faktura #".concat(e.id,": Nastaveno ID=").concat(we,", dt=").concat(l))}const i=qn.faktury.map(n=>n.id===e.id?(0,t.A)((0,t.A)({},n),o):n);yc(i)},style:{width:"18px",height:"18px",cursor:hc?"not-allowed":"pointer",accentColor:hc?"#9ca3af":"#16a34a"}}),(0,fe.jsxs)("span",{style:{flex:1},children:["Potvrzuji v\u011bcnou spr\xe1vnost faktury #",n+1]}),1===e.vecna_spravnost_potvrzeno&&(0,fe.jsx)("span",{style:{fontSize:"0.75rem",color:"#16a34a",background:"#dcfce7",padding:"0.25rem 0.5rem",borderRadius:"4px",fontWeight:"600"},children:"\u2713 ZKONTROLOV\xc1NO"})]}),(()=>{const n=i?1===r.vecna_spravnost_potvrzeno:1===e.vecna_spravnost_potvrzeno,a=e.id&&!String(e.id).startsWith("temp-"),o=e.dt_potvrzeni_vecne_spravnosti;if(!n||!a||!o||!(aa>=8))return null;const t=e.potvrdil_vecnou_spravnost_jmeno?"".concat(e.potvrdil_vecnou_spravnost_jmeno," ").concat(e.potvrdil_vecnou_spravnost_prijmeni||"").trim():e.potvrdil_vecnou_spravnost_id?Pc(e.potvrdil_vecnou_spravnost_id):null;return(0,fe.jsxs)("div",{style:{marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"#f0fdf4",border:"1px solid #86efac",borderRadius:"4px",fontSize:"0.8rem",color:"#15803d"},children:[(0,fe.jsx)("strong",{children:"Potvrdil:"})," ",t||"Syst\xe9m"," ",(0,fe.jsx)("strong",{children:"\u2022"})," ",(0,fe.jsx)("strong",{children:"Datum:"})," ",(0,Za.fn)(e.dt_potvrzeni_vecne_spravnosti)]})})()]}),a&&(0,fe.jsx)(yd,{style:{marginTop:"0.5rem"},children:wo["faktura_".concat(n+1,"_vecna_spravnost")]})]})})()]}),(0,fe.jsx)(ue.r6,{fakturaId:e.id,objednavkaId:qn.id,fakturaTypyPrilohOptions:Xr,readOnly:uc,onISDOCParsed:Fc,formData:qn,faktura:e,validateInvoiceForAttachments:Mc,allUsers:Rr,attachments:e.attachments||[],onAttachmentsChange:n=>{Zc(e.id,n)},onAttachmentUploaded:n=>{Kc(e.id,n)},onCreateInvoiceInDB:Bc},"invoice-attachments-".concat(n,"-").concat(qn.id)),!e._isNew&&(0,fe.jsxs)("div",{style:{borderTop:"1px solid #e5e7eb",paddingTop:"0.5rem",marginTop:"0.75rem",fontSize:"0.75rem",color:"#9ca3af",display:"flex",justifyContent:"space-between"},children:[(0,fe.jsxs)("div",{children:[(0,fe.jsx)("strong",{children:"Vytvo\u0159il:"})," ",e.vytvoril_jmeno||Pc(e.vytvoril_uzivatel_id)]}),(0,fe.jsxs)("div",{children:[(0,fe.jsx)("strong",{children:"Vytvo\u0159eno:"})," ",(0,Za.fn)(e.dt_vytvoreni)]})]})]})]},e.id)}):(0,fe.jsxs)("div",{style:{border:"2px dashed #cbd5e1",borderRadius:"8px",padding:"2rem",textAlign:"center",color:"#64748b",background:"#f8fafc"},children:[(0,fe.jsx)("div",{style:{fontSize:"1.25rem",marginBottom:"0.5rem"},children:"\ud83d\udcc4"}),(0,fe.jsx)("div",{style:{fontWeight:"500",marginBottom:"0.5rem"},children:"Na\u010d\xedt\xe1m prvn\xed fakturu..."}),(0,fe.jsx)("div",{style:{fontSize:"0.875rem"},children:"Pros\xedm chv\xedli strpen\xed"})]}),!uc&&(0,fe.jsxs)("button",{type:"button",onClick:()=>{const e=Ps(new Date),n={id:"temp-".concat(Date.now()),objednavka_id:qn.id,fa_datum_doruceni:e,fa_dorucena:1,fa_castka:"",fa_cislo_vema:"",fa_strediska_kod:Array.isArray(qn.strediska_kod)?qn.strediska_kod:[],fa_poznamka:"",fa_splatnost:"",vytvoril_uzivatel_id:we,vytvoril_jmeno:Pc(we),dt_vytvoreni:(new Date).toISOString(),dt_aktualizace:null,aktivni:1,_isNew:!0,vecna_spravnost_umisteni_majetku:"",vecna_spravnost_poznamka:"",vecna_spravnost_potvrzeno:0},a=Array.isArray(qn.faktury)?qn.faktury:[];yc([...a,n]),_r(n),fr({fa_datum_doruceni:e,fa_dorucena:1,fa_castka:"",fa_cislo_vema:"",fa_strediska_kod:qn.strediska_kod||[],fa_poznamka:"",fa_splatnost:"",vecna_spravnost_umisteni_majetku:"",vecna_spravnost_poznamka:"",vecna_spravnost_potvrzeno:0})},style:{width:"100%",marginTop:"1rem",padding:"1rem",background:"transparent",color:"#3b82f6",border:"2px dashed #3b82f6",borderRadius:"8px",fontSize:"0.9rem",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(59, 130, 246, 0.05)",e.currentTarget.style.borderColor="#2563eb"},onMouseLeave:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.borderColor="#3b82f6"},children:[(0,fe.jsx)(L.A,{size:18}),"P\u0159idat dal\u0161\xed fakturu"]})]}),qn.faktury&&qn.faktury.length>0&&qn.fakturant_id&&qn.dt_faktura_pridana&&(0,fe.jsxs)("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#dcfce7",border:"1px solid #16a34a",borderRadius:"6px",color:"#166534",fontSize:"0.875rem"},children:[(0,fe.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.25rem"},children:"\u2705 Fakturace byla zpracov\xe1na"}),(0,fe.jsxs)("div",{children:[(0,fe.jsx)("strong",{children:"Datum zpracov\xe1n\xed:"})," ",(0,Za.fn)(qn.dt_faktura_pridana)," \u2022 ",(0,fe.jsx)("strong",{children:"Zpracoval:"})," ",Pc(qn.fakturant_id)]})]})]})})})]}):null})(),(()=>{const e=(()=>{const e=Mr.find(e=>e.kod===qn.zpusob_financovani||e.value===qn.zpusob_financovani);return((null===e||void 0===e?void 0:e.nazev)||"").toLowerCase().includes("pokladna")})(),n=qn.faktury&&qn.faktury.length>0;return!e&&6===aa&&!_s&&!n&&(0,fe.jsxs)("div",{style:{margin:"2rem 0",padding:"1rem 1.25rem",backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"8px",color:"#92400e"},children:[(0,fe.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"\u23f3 \u010cek\xe1 se na dopln\u011bn\xed fakturace"}),(0,fe.jsxs)("div",{style:{fontSize:"0.875rem"},children:["Objedn\xe1vka \u010dek\xe1 na p\u0159id\xe1n\xed faktur ekonomick\xfdm odd\u011blen\xedm. Po dopln\u011bn\xed faktur budete moci pokra\u010dovat k ",(0,fe.jsx)("strong",{children:"v\u011bcn\xe9 kontrole"}),". Tuto akci m\u016f\u017ee prov\xe9st pouze u\u017eivatel s opr\xe1vn\u011bn\xedm pro spr\xe1vu faktur."]})]})})(),(ea||6===aa)&&qn.faktury&&qn.faktury.length>0&&(0,fe.jsxs)("div",{style:{margin:"2rem 0",padding:"1rem 1.25rem",backgroundColor:"#fefce8",border:"1px solid #eab308",borderRadius:"8px",color:"#854d0e"},children:[(0,fe.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"\u2139\ufe0f P\u0159id\xe1n\xed faktur k objedn\xe1vce"}),(0,fe.jsxs)("div",{style:{fontSize:"0.875rem"},children:[qn.fakturant_id&&qn.dt_faktura_pridana&&(0,fe.jsxs)("div",{style:{marginBottom:"0.5rem"},children:[(0,fe.jsx)("strong",{children:"P\u0159idal fakturu:"})," ",Pc(qn.fakturant_id)," \u2022 ",(0,fe.jsx)("strong",{children:"Datum:"})," ",(0,Za.fn)(qn.dt_faktura_pridana)]}),"V t\xe9to sekci p\u0159idejte faktury k objedn\xe1vce. Po p\u0159id\xe1n\xed a ulo\u017een\xed m\u016f\u017eete pokra\u010dovat k ",(0,fe.jsx)("strong",{children:"v\u011bcn\xe9 kontrole"}),"."]})]}),(gs||ca(qn.stav_workflow_kod,"DOKONCENA"))&&(ca(qn.stav_workflow_kod,"ZKONTROLOVANA")||ca(qn.stav_workflow_kod,"DOKONCENA"))&&(()=>{!qn.id||1!==qn.potvrzeni_dokonceni_objednavky||ca(qn.stav_workflow_kod,"DOKONCENA");const e=!vc.enabled;return(0,fe.jsxs)(dd,{"data-section":"dokonceni",children:[(0,fe.jsxs)(ld,{sectionTheme:"section-dokonceni",isActive:!0,style:{background:"linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",borderColor:"#16a34a"},children:[(0,fe.jsxs)(cd,{sectionTheme:"section-dokonceni",style:{color:"#fff",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsx)(pd,{sectionTheme:"section-dokonceni",style:{color:"#fff"},children:(0,fe.jsx)(p.g,{icon:u.SGM})}),"Dokon\u010den\xed objedn\xe1vky"]}),(0,fe.jsx)(vd,{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:(0,fe.jsx)(ud,{collapsed:Ge.dokonceni,onClick:()=>sp("dokonceni"),style:{color:"#fff",cursor:"pointer"},children:(0,fe.jsx)(p.g,{icon:u.w2A})})})]}),(0,fe.jsx)(md,{collapsed:Ge.dokonceni,children:(0,fe.jsxs)("div",{style:{padding:"1rem 0"},children:[(0,fe.jsxs)("div",{style:{background:"#f0fdf4",border:"1px solid #22c55e",borderRadius:"8px",padding:"1rem",marginBottom:"1.5rem"},children:[(0,fe.jsx)("div",{style:{fontWeight:"600",color:"#166534",marginBottom:"0.75rem"},children:"\ud83c\udf89 Fin\xe1ln\xed krok - Dokon\u010den\xed objedn\xe1vky"}),(0,fe.jsxs)("div",{style:{fontSize:"0.875rem",color:"#166534",lineHeight:"1.6"},children:["Objedn\xe1vka pro\u0161la v\u0161emi f\xe1zemi:",(0,fe.jsxs)("ul",{style:{marginTop:"0.5rem",marginLeft:"1.5rem",listStyle:"none",paddingLeft:0},children:[(0,fe.jsxs)("li",{style:{display:"flex",alignItems:"center",marginBottom:"0.4rem"},children:["\u2705 Schv\xe1len\xed (",qn.dt_schvaleni?(0,Za.fn)(qn.dt_schvaleni):""," \u2022 ",qn.schvalovatel_id?Pc(qn.schvalovatel_id):"",")"]}),(0,fe.jsxs)("li",{style:{display:"flex",alignItems:"center",marginBottom:"0.4rem"},children:["\u2705 Odesl\xe1n\xed dodavateli (",qn.dt_odeslani?(0,Za.fn)(qn.dt_odeslani):""," \u2022 ",qn.odesilatel_id?Pc(qn.odesilatel_id):"",")"]}),(0,fe.jsxs)("li",{style:{display:"flex",alignItems:"center",marginBottom:"0.4rem"},children:["\u2705 Potvrzen\xed od dodavatele (",qn.dt_akceptace?(0,Za.iS)(qn.dt_akceptace):""," \u2022 ",qn.dodavatel_potvrdil_id?Pc(qn.dodavatel_potvrdil_id):"",")"]}),(0,fe.jsxs)("li",{style:{display:"flex",alignItems:"center",marginBottom:"0.4rem"},children:["\u2705 Registr smluv ",qn.dt_zverejneni&&"0000-00-00"!==qn.dt_zverejneni?"(".concat((0,Za.iS)(qn.dt_zverejneni)," \u2022 ").concat(qn.zverejnil_id?Pc(qn.zverejnil_id):"",")"):"(nepodl\xe9h\xe1 zve\u0159ejn\u011bn\xed v registru)"]}),(0,fe.jsxs)("li",{style:{display:"flex",alignItems:"center",marginBottom:"0.4rem"},children:["\u2705 Fakturace (",qn.dt_faktura_pridana?(0,Za.fn)(qn.dt_faktura_pridana):""," \u2022 ",qn.fakturant_id?Pc(qn.fakturant_id):"",")"]}),qn.faktury&&qn.faktury.length>0&&qn.faktury.map((e,n)=>{const a=1===e.vecna_spravnost_potvrzeno,o=e.potvrdil_vecnou_spravnost_jmeno?"".concat(e.potvrdil_vecnou_spravnost_jmeno," ").concat(e.potvrdil_vecnou_spravnost_prijmeni||"").trim():e.potvrdil_vecnou_spravnost_id?Pc(e.potvrdil_vecnou_spravnost_id):"",t=e.dt_potvrzeni_vecne_spravnosti?(0,Za.fn)(e.dt_potvrzeni_vecne_spravnosti):"";return(0,fe.jsxs)("li",{style:{display:"flex",alignItems:"center",marginBottom:"0.4rem"},children:[a?"\u2705":"\u26a0\ufe0f"," V\u011bcn\xe1 spr\xe1vnost faktury #",n+1," ",t?"(".concat(t," \u2022 ").concat(o,")"):""]},e.id||n)})]}),(0,fe.jsx)("div",{style:{marginTop:"0.75rem",fontWeight:"500"},children:"Nyn\xed potvr\u010fte fin\xe1ln\xed dokon\u010den\xed objedn\xe1vky."})]})]}),(()=>{const e=parseFloat(qn.max_cena_s_dph)||0,n=qn.faktury?qn.faktury.reduce((e,n)=>e+(parseFloat(n.fa_castka)||0),0):0,a=n-e;return a>0&&0!==e&&0!==n?(0,fe.jsxs)("div",{style:{background:"linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%)",border:"2px solid #ef4444",borderRadius:"12px",padding:"1rem",marginBottom:"1.5rem",boxShadow:"0 4px 12px rgba(239, 68, 68, 0.15)",display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[(0,fe.jsx)("div",{style:{fontSize:"1.5rem",marginTop:"0.1rem"},children:"\u26a0\ufe0f"}),(0,fe.jsxs)("div",{style:{flex:1},children:[(0,fe.jsx)("div",{style:{fontWeight:"700",fontSize:"1rem",color:"#b91c1c",marginBottom:"0.5rem"},children:"POZOR: Fakturace p\u0159ekro\u010dila MAX cenu s DPH objedn\xe1vky schv\xe1lenou PO"}),(0,fe.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"auto auto",gap:"0.5rem 1rem",fontSize:"0.875rem",color:"#7f1d1d",marginBottom:"0.75rem"},children:[(0,fe.jsx)("span",{style:{fontWeight:"600"},children:"MAX cena s DPH (schv\xe1len\xe1):"}),(0,fe.jsxs)("span",{style:{fontFamily:"monospace",fontWeight:"700",textAlign:"right"},children:[e.toLocaleString("cs-CZ")," K\u010d"]}),(0,fe.jsx)("span",{style:{fontWeight:"600"},children:"Fakturovan\xe1 \u010d\xe1stka s DPH celkem:"}),(0,fe.jsxs)("span",{style:{fontFamily:"monospace",fontWeight:"700",textAlign:"right"},children:[n.toLocaleString("cs-CZ")," K\u010d"]}),(0,fe.jsx)("span",{style:{fontWeight:"600"},children:"P\u0159ekro\u010den\xed o:"}),(0,fe.jsxs)("span",{style:{fontFamily:"monospace",fontWeight:"700",color:"#dc2626",textAlign:"right"},children:["+",a.toLocaleString("cs-CZ")," K\u010d"]})]}),qn.vecna_spravnost_poznamka&&(0,fe.jsx)("div",{style:{borderTop:"1px solid #fca5a5",paddingTop:"0.75rem",fontSize:"0.875rem",color:"#7f1d1d"},children:(0,fe.jsxs)("div",{style:{lineHeight:"1.5"},children:[(0,fe.jsx)("span",{style:{fontWeight:"600"},children:"Vysv\u011btlen\xed:"})," ",(0,fe.jsxs)("span",{style:{fontStyle:"italic"},children:['"',qn.vecna_spravnost_poznamka,'"']})]})})]})]}):null})(),(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[(0,fe.jsx)(xd,{children:"POZN\xc1MKA K DOKON\u010cEN\xcd (nepovinn\xe9)"}),(0,fe.jsx)(Ed,{value:qn.dokonceni_poznamka||"",onChange:e=>Rp("dokonceni_poznamka",e.target.value),placeholder:"Voliteln\xe1 pozn\xe1mka k dokon\u010den\xed objedn\xe1vky...",rows:3,disabled:e,style:{background:e?"#f3f4f6":void 0,cursor:e?"not-allowed":void 0,opacity:e?.6:1}})]})}),(0,fe.jsx)(gd,{style:{marginTop:"1.5rem"},children:(0,fe.jsx)(bd,{style:{gridColumn:"1 / -1"},children:(0,fe.jsxs)("div",{style:{background:e?"#dcfce7":"#fef3c7",border:"2px solid ".concat(e?"#16a34a":"#eab308"),borderRadius:"8px",padding:"1.25rem",opacity:e?.7:1},children:[(0,fe.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"1rem",cursor:e?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",color:qn.dokoncil_id?"#166534":"#713f12",opacity:qn.dokoncil_id?.7:1},children:[(0,fe.jsx)("input",{type:"checkbox",checked:1===qn.potvrzeni_dokonceni_objednavky||!0===qn.potvrzeni_dokonceni_objednavky||ca(qn.stav_workflow_kod,"DOKONCENA"),onChange:e=>{Rp("potvrzeni_dokonceni_objednavky",e.target.checked?1:0)},required:!0,disabled:ca(qn.stav_workflow_kod,"DOKONCENA"),style:{width:"24px",height:"24px",cursor:e?"not-allowed":"pointer",accentColor:"#16a34a"}}),(0,fe.jsxs)("span",{children:["\u2705 Potvrzuji fin\xe1ln\xed dokon\u010den\xed objedn\xe1vky",(0,fe.jsx)("span",{style:{color:"#dc2626",marginLeft:"0.25rem"},children:"*"})]})]}),(0,fe.jsx)("div",{style:{fontSize:"0.875rem",color:e?"#166534":"#92400e",marginTop:"0.75rem",marginLeft:"2.5rem"},children:e?(0,fe.jsxs)("div",{children:[(0,fe.jsxs)("div",{style:{fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[(0,fe.jsx)("span",{style:{fontSize:"1.1rem"},children:"\ud83d\udd12"}),(0,fe.jsx)("strong",{children:"Objedn\xe1vka je dokon\u010dena a uzam\u010dena"})]}),(0,fe.jsx)("div",{style:{fontSize:"0.8rem",color:"#166534",lineHeight:"1.5"},children:"Workflow je kompletn\u011b uzam\u010deno. Zm\u011bny m\u016f\u017ee prov\xe1d\u011bt pouze opr\xe1vn\u011bn\xfd u\u017eivatel."})]}):"Za\u0161krtnut\xedm potvrd\xedte dokon\u010den\xed objedn\xe1vky. Cel\xfd workflow bude uzam\u010den."})]})})})]})})]})})(),!1,ca(qn.stav_workflow_kod,"ZKONTROLOVANA")&&!qn.potvrdil_vecnou_spravnost_id&&(0,fe.jsxs)("div",{style:{margin:"2rem 0",padding:"1rem 1.25rem",backgroundColor:"#f0fdfa",border:"1px solid #14b8a6",borderRadius:"8px",color:"#0f766e"},children:[(0,fe.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"\u2705 F\xc1ZE 7/8: V\u011bcn\xe1 spr\xe1vnost - Zkontrolujte a potvr\u010fte spr\xe1vnost objedn\xe1vky"}),(0,fe.jsxs)("div",{style:{fontSize:"0.875rem"},children:["Zkontrolujte v\u011bcnou spr\xe1vnost objedn\xe1vky v\u010detn\u011b v\u0161ech faktur a \xfadaj\u016f. Po kontrole potvr\u010fte v\u011bcnou spr\xe1vnost v p\u0159\xedslu\u0161n\xe9 sekci n\xed\u017ee.",qn.faktury&&qn.faktury.length>0&&(0,fe.jsxs)("div",{style:{marginTop:"0.5rem"},children:[(0,fe.jsx)("strong",{children:"Faktury ke kontrole:"})," ",qn.faktury.length]})]})]}),!gs&&(ca(qn.stav_workflow_kod,"ZKONTROLOVANA")||ca(qn.stav_workflow_kod,"DOKONCENA"))&&qn.potvrdil_vecnou_spravnost_id&&!ca(qn.stav_workflow_kod,"DOKONCENA")&&(0,fe.jsxs)("div",{style:{margin:"2rem 0",padding:"1.5rem",backgroundColor:"#eff6ff",border:"2px solid #3b82f6",borderRadius:"8px",textAlign:"center"},children:[(0,fe.jsx)("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"\u23f3"}),(0,fe.jsx)("div",{style:{fontWeight:"700",color:"#1e40af",marginBottom:"0.75rem",fontSize:"1.1rem"},children:"Objedn\xe1vka \u010dek\xe1 na dokon\u010den\xed"}),(0,fe.jsx)("div",{style:{fontSize:"0.875rem",color:"#1e40af",lineHeight:"1.6"},children:"Objedn\xe1vka pro\u0161la v\u0161emi f\xe1zemi workflow a \u010dek\xe1 na fin\xe1ln\xed potvrzen\xed dokon\u010den\xed."}),(0,fe.jsx)("div",{style:{fontSize:"0.875rem",color:"#1e40af",marginTop:"0.75rem",fontStyle:"italic"},children:"\ud83d\udca1 Dokon\u010den\xed objedn\xe1vky provede opr\xe1vn\u011bn\xfd u\u017eivatel."})]}),(ea||aa>=4)&&!qn.stav_stornovano&&"ANO"!==(null===(ye=qn.dodavatel_zpusob_potvrzeni)||void 0===ye?void 0:ye.potvrzeni)&&(0,fe.jsxs)("div",{style:{margin:"2rem 0",padding:"1rem 1.25rem",backgroundColor:"#f0fdf4",border:"1px solid #10b981",borderRadius:"8px",color:"#065f46"},children:[(0,fe.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"\ud83d\udccb \u010cek\xe1n\xed na potvrzen\xed od dodavatele"}),(0,fe.jsxs)("div",{style:{fontSize:"0.875rem"},children:['Objedn\xe1vka byla odesl\xe1na dodavateli. Po obdr\u017een\xed potvrzen\xed od dodavatele za\u0161krtn\u011bte "Dodavatel objedn\xe1vku potvrdil" a vypl\u0148te zp\u016fsob potvrzen\xed.',qn.datum_odeslani&&(0,fe.jsxs)("div",{style:{marginTop:"0.5rem"},children:[(0,fe.jsx)("strong",{children:"Datum odesl\xe1n\xed:"})," ",(()=>{const e=qn.datum_odeslani.split(" ")[0],[n,a,o]=e.split("-");return"".concat(o,". ").concat(a,". ").concat(n)})(),qn.odesilatel_id&&(0,fe.jsxs)(fe.Fragment,{children:[" \u2022 ",(0,fe.jsx)("strong",{children:"Odeslal:"})," ",Pc(qn.odesilatel_id)]})]})]})]}),!1]})]}),qn.id&&(0,fe.jsxs)(dd,{"data-section":"prilohy",children:[(0,fe.jsxs)(ld,{sectionTheme:is("prilohy"),isActive:ss("prilohy"),children:[(0,fe.jsxs)(cd,{sectionTheme:is("prilohy"),children:[(0,fe.jsx)(pd,{sectionTheme:is("prilohy"),children:(0,fe.jsx)(p.g,{icon:u.KTq})}),"P\u0159\xedlohy k objedn\xe1vce",ys&&(0,fe.jsx)(_d,{title:"Sekce P\u0159\xedlohy k objedn\xe1vce je zam\u010dena - objedn\xe1vka je dokon\u010dena/zam\xedtnuta/zru\u0161ena.",children:"\ud83d\udd12"})]}),(0,fe.jsx)(ud,{collapsed:Ge.prilohy,sectionTheme:is("prilohy"),onClick:()=>sp("prilohy"),style:{cursor:"pointer"},children:(0,fe.jsx)(p.g,{icon:u.w2A})})]}),(0,fe.jsx)(md,{collapsed:Ge.prilohy,children:(0,fe.jsx)(gd,{children:(0,fe.jsxs)(bd,{style:{gridColumn:"1 / -1"},children:[ys&&(0,fe.jsxs)("div",{style:{background:"#fef3c7",border:"2px solid #f59e0b",borderRadius:"8px",padding:"1rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,fe.jsx)("span",{style:{fontSize:"1.5rem"},children:"\ud83d\udd12"}),(0,fe.jsxs)("div",{children:[(0,fe.jsx)("div",{style:{fontWeight:"600",color:"#92400e",marginBottom:"0.25rem"},children:"P\u0159id\xe1v\xe1n\xed p\u0159\xedloh je zam\u010deno"}),(0,fe.jsx)("div",{style:{fontSize:"0.875rem",color:"#92400e"},children:"Objedn\xe1vka je dokon\u010dena - nelze p\u0159id\xe1vat ani upravovat p\u0159\xedlohy."})]})]}),(0,fe.jsxs)("div",{style:{border:"2px dashed ".concat(ys?"#d1d5db":St?"#dc2626":"#fca5a5"),borderRadius:"8px",padding:"2rem",textAlign:"center",backgroundColor:ys?"#f3f4f6":St?"rgba(254, 202, 202, 0.5)":"rgba(254, 226, 226, 0.3)",marginBottom:"1rem",transition:"all 0.2s ease",cursor:ys?"not-allowed":"pointer",opacity:ys?.5:1,pointerEvents:ys?"none":"auto"},onDrop:e=>{ys||(e.preventDefault(),e.stopPropagation(),Et(!1),(e=>{e.preventDefault(),e.stopPropagation(),Et(!1);const n=e.dataTransfer.files;n&&n.length>0&&lp(n)})(e))},onDragOver:e=>{ys||(e.preventDefault(),e.stopPropagation(),Et(!0))},onDragEnter:e=>{ys||(e.preventDefault(),e.stopPropagation(),Et(!0))},onDragLeave:e=>{ys||(e.preventDefault(),e.stopPropagation(),e.currentTarget.contains(e.relatedTarget)||Et(!1))},onClick:()=>!ys&&document.getElementById("fileInput").click(),children:[At?(0,fe.jsx)("div",{style:{width:"32px",height:"32px",border:"3px solid #f3f4f6",borderTop:"3px solid #3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 1rem auto"}}):(0,fe.jsx)("div",{style:{fontSize:"3rem",marginBottom:"1rem",color:St?"#dc2626":"#991b1b",transition:"color 0.2s ease"},children:"\ud83d\udcc4"}),(0,fe.jsx)("div",{style:{fontSize:"1rem",fontWeight:"500",marginBottom:"0.5rem",color:St?"#dc2626":At?"#f59e0b":"#991b1b"},children:At?"Nahr\xe1v\xe1m soubory...":St?"Pus\u0165 soubory zde!":"P\u0159et\xe1hni nebo vyber soubory"}),(0,fe.jsxs)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"1rem"},children:["Ka\u017ed\xe1 p\u0159\xedloha mus\xed b\xfdt klasifikov\xe1na: Objedn\xe1vka / Faktura / Ko\u0161ilka / Jin\xe9.",(0,fe.jsx)("br",{}),(0,fe.jsxs)("span",{style:{fontSize:"0.8rem",color:"#f59e0b"},children:["\ud83d\udccf Max. velikost souboru: 20 MB | Max. celkov\xe1 velikost: 100 MB",(0,fe.jsx)("br",{}),"\ud83d\udcc4 Podporovan\xe9 form\xe1ty:",(0,fe.jsx)("br",{}),"\xa0\xa0\u2022 Dokumenty: PDF, DOC, DOCX, ODT, RTF, TXT",(0,fe.jsx)("br",{}),"\xa0\xa0\u2022 Tabulky: XLS, XLSX, ODS, CSV",(0,fe.jsx)("br",{}),"\xa0\xa0\u2022 Prezentace: PPT, PPTX, ODP",(0,fe.jsx)("br",{}),"\xa0\xa0\u2022 Obr\xe1zky: JPG, PNG, GIF, BMP, SVG",(0,fe.jsx)("br",{}),"\xa0\xa0\u2022 Archivy: ZIP, RAR, 7Z",(0,fe.jsx)("br",{}),"\xa0\xa0\u2022 Emaily: EML, MSG"]})]}),(0,fe.jsx)("button",{type:"button",disabled:ys,style:{marginTop:"1rem",background:ys?"#9ca3af":"#3b82f6",color:"white",border:"none",borderRadius:"6px",padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:"500",cursor:ys?"not-allowed":"pointer",opacity:ys?.6:1},onClick:e=>{ys||(e.stopPropagation(),document.getElementById("fileInput").click())},children:"Vybrat"})]}),(0,fe.jsx)("input",{id:"fileInput",type:"file",multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif,.txt",onChange:cp,disabled:ys,style:{display:"none"}}),un&&un.filter(e=>"obj-"===gp(e)).length>0&&(0,fe.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,fe.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,fe.jsxs)(xd,{children:["Po\u010det p\u0159\xedloh: ",(0,fe.jsx)("strong",{children:un.filter(e=>"obj-"===gp(e)).length})," | Nahr\xe1no: ",(0,fe.jsx)("span",{style:{color:"#16a34a"},children:(0,fe.jsx)("strong",{children:un.filter(e=>"obj-"===gp(e)&&"uploaded"===e.status).length})})," | Velikost: ",(0,fe.jsx)("strong",{children:(()=>{const e=un.filter(e=>"obj-"===gp(e)&&"uploaded"===e.status).reduce((e,n)=>e+(n.size||0),0);return e>0?"".concat((e/1024/1024).toFixed(2)," MB"):"0 MB"})()})]}),(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsx)("button",{type:"button",onClick:()=>up(!1),disabled:Ct,style:{background:"#10b981",color:"white",border:"none",borderRadius:"6px",padding:"0.375rem",fontSize:"0.875rem",cursor:Ct?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:Ct?.6:1},title:"Kontrola synchronizace p\u0159\xedloh s datab\xe1z\xed a diskem - zkontroluje, jestli jsou p\u0159\xedlohy v DB i fyzicky na disku",children:(0,fe.jsx)(p.g,{icon:u.VNe})}),(0,fe.jsx)("button",{type:"button",onClick:_p,style:{background:"#3b82f6",color:"white",border:"none",borderRadius:"6px",padding:"0.375rem",fontSize:"0.875rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Chytr\xe9 na\u010dten\xed p\u0159\xedloh - slou\u010d\xed DB p\u0159\xedlohy s lok\xe1ln\xedmi neulo\u017een\xfdmi p\u0159\xedlohami, ide\xe1ln\xed p\u0159i obnoven\xed formul\xe1\u0159e",children:(0,fe.jsx)(p.g,{icon:u.GQu})}),(0,fe.jsx)("button",{type:"button",onClick:()=>vp(!1),style:{background:"#7c3aed",color:"white",border:"none",borderRadius:"6px",padding:"0.375rem",fontSize:"0.875rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Na\u010dten\xed z datab\xe1ze - na\u010dte pouze p\u0159\xedlohy ulo\u017een\xe9 v datab\xe1zi, p\u0159ep\xed\u0161e lok\xe1ln\xed stav",children:(0,fe.jsx)(p.g,{icon:u.hem})}),!ys&&(0,fe.jsx)("button",{type:"button",onClick:fp,style:{background:"#dc2626",color:"white",border:"none",borderRadius:"6px",padding:"0.25rem 0.75rem",fontSize:"0.75rem",cursor:"pointer"},children:"Vymazat v\u0161echny"})]})]}),un.filter(e=>"obj-"===gp(e)).map((e,n)=>{var a,o;return(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem",border:"1px solid ".concat(bp(e)),borderRadius:"6px",backgroundColor:yp(e),marginBottom:"0.5rem",opacity:"uploading"===e.status?.6:1},children:[(0,fe.jsxs)("div",{style:{width:"32px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,position:"relative"},children:[(0,fe.jsx)(p.g,{icon:!1===e.file_exists?u.buE:u.h8M,style:{color:!1===e.file_exists?"#dc2626":"uploaded"===e.status?"#10b981":"#dc2626",fontSize:"24px"}}),"uploading"===e.status&&(0,fe.jsx)("div",{style:{position:"absolute",top:"-2px",right:"-2px",width:"12px",height:"12px",backgroundColor:"#f59e0b",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"uploaded"===e.status&&(0,fe.jsx)("div",{style:{position:"absolute",top:"-2px",right:"-2px",width:"12px",height:"12px",backgroundColor:"#10b981",borderRadius:"50%"}})]}),(0,fe.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,fe.jsx)("div",{style:{fontWeight:"500",fontSize:"0.875rem",color:"#374151",marginBottom:"2px"},children:(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsxs)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0,position:"relative"},children:[e.name,!e.klasifikace&&(0,fe.jsx)("span",{style:{color:"#dc2626",fontSize:"0.7rem",fontWeight:"bold",position:"absolute",top:"-2px",marginLeft:"2px"},children:"*"})]}),!1===e.file_exists&&(0,fe.jsx)("span",{style:{color:"#dc2626",fontSize:"0.7rem",fontWeight:"bold",backgroundColor:"#fee2e2",padding:"1px 4px",borderRadius:"3px",flexShrink:0},children:"\u26a0 SOUBOR NENALEZEN"}),e.isDuplicate&&(0,fe.jsx)("span",{style:{color:"#f59e0b",fontSize:"0.7rem",fontWeight:"bold",backgroundColor:"#fef3c7",padding:"1px 4px",borderRadius:"3px",flexShrink:0},children:"DUPLIK\xc1T"}),(0,fe.jsxs)("span",{style:{color:"#6b7280",fontWeight:"normal",fontSize:"0.75rem",flexShrink:0},children:["(",Math.round((e.velikost||e.size||0)/1024)," kB)"]}),"uploaded"===e.status&&e.serverId&&(0,fe.jsx)("button",{type:"button",onClick:()=>(async e=>{if(e.serverId&&Ee&&Se){if("IMPORT"===e.typ_prilohy&&e.originalni_nazev_souboru){const n="".concat("https://erdms.zachranka.cz/prilohy/").concat(e.originalni_nazev_souboru);Ic("info","ATTACHMENTS","download-import","Stahov\xe1n\xed importovan\xe9 p\u0159\xedlohy ".concat(e.name," ze star\xe9ho syst\xe9mu: ").concat(n));const a=document.createElement("a");return a.href=n,a.download=e.originalni_nazev_souboru,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),void ze('\ud83d\udce5 P\u0159\xedloha "'.concat(e.originalni_nazev_souboru,'" se stahuje ze star\xe9ho syst\xe9mu'),"info")}try{Ic("info","ATTACHMENTS","download-start","Stahov\xe1n\xed p\u0159\xedlohy ".concat(e.name," ze serveru..."));const n=await(0,La.downloadOrderAttachment)(qn.id,e.serverId,Se,Ee),a=window.URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download=e.name||"priloha",document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(a),Ic("success","ATTACHMENTS","download-success","P\u0159\xedloha ".concat(e.name," sta\u017eena \xfasp\u011b\u0161n\u011b"))}catch(n){const a=n.message||"Nepoda\u0159ilo se st\xe1hnout p\u0159\xedlohu",o=a.includes("Soubor nebyl nalezen na serveru")||a.includes("chyb\xed fyzick\xfd soubor");ze(a,{type:o?"warning":"error"}),Ic(o?"warning":"error","ATTACHMENTS","download-error","Chyba p\u0159i stahov\xe1n\xed ".concat(e.name,": ").concat(a))}}else ze("Nelze st\xe1hnout p\u0159\xedlohu - chyb\xed server ID","error")})(e),style:{background:"none",border:"none",color:"#2563eb",cursor:"pointer",padding:"2px",display:"flex",alignItems:"center",fontSize:"12px",flexShrink:0},title:"St\xe1hnout soubor",children:(0,fe.jsx)(S.A,{size:14})}),!ys&&(0,fe.jsx)("button",{type:"button",onClick:()=>e.serverId?(async e=>{const n=un.find(n=>n.id===e);n&&(It({fileId:e,attachment:n,isFromServer:!0}),Dt(!0))})(e.id):(e=>{const n=un.find(n=>n.id===e);n&&(It({fileId:e,attachment:n,isFromServer:!1}),Dt(!0))})(e.id),disabled:"uploading"===e.status,style:{background:"none",border:"none",color:"uploading"===e.status?"#9ca3af":"#dc2626",cursor:"uploading"===e.status?"not-allowed":"pointer",padding:"2px",display:"flex",alignItems:"center",opacity:"uploading"===e.status?.6:1,fontSize:"12px",flexShrink:0},title:e.serverId?"Smazat ze serveru":"Smazat soubor",children:(0,fe.jsx)(p.g,{icon:u.yLS})})]})}),(0,fe.jsxs)("div",{style:{fontSize:"0.75rem",color:"#6b7280",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,fe.jsx)("span",{children:e.uploadDate&&!isNaN(new Date(e.uploadDate).getTime())?"".concat((0,Za.iS)(new Date(e.uploadDate))," ").concat(new Date(e.uploadDate).toLocaleTimeString("cs-CZ",{hour:"2-digit",minute:"2-digit"})):"Datum neuvedeno"}),(0,fe.jsx)("span",{children:"\u2022"}),(0,fe.jsx)("span",{style:{textTransform:"uppercase",backgroundColor:"#fef3c7",color:"#92400e",padding:"2px 6px",borderRadius:"4px",fontSize:"0.6875rem",fontWeight:"500"},children:e.type.includes("pdf")?"PDF":e.name.split(".").pop()}),(0,fe.jsx)("span",{children:"\u2022"}),(0,fe.jsxs)("span",{style:{backgroundColor:"#e0e7ff",color:"#3730a3",padding:"2px 6px",borderRadius:"4px",fontSize:"0.6875rem",fontWeight:"500"},children:["Nahr\xe1no: ",(null===(a=e.nahrano_uzivatel)||void 0===a?void 0:a.prijmeni)||(null===Ae||void 0===Ae?void 0:Ae.prijmeni)||"Nezn\xe1m\xfd"," ",(null===(o=e.nahrano_uzivatel)||void 0===o?void 0:o.jmeno)||(null===Ae||void 0===Ae?void 0:Ae.jmeno)||"u\u017eivatel"]})]})]}),(0,fe.jsxs)("div",{style:{minWidth:"180px",flexShrink:0},children:[null,(0,fe.jsxs)("select",{value:e.klasifikace||"",onChange:n=>(async(e,n)=>{const a=un.find(n=>n.id===e);if(a)if(Xn(a=>(0,t.A)((0,t.A)({},a),{},{prilohy_dokumenty:(a.prilohy_dokumenty||[]).map(a=>a.id===e?(0,t.A)((0,t.A)({},a),{},{klasifikace:n}):a)})),vn(a=>a.map(a=>a.id===e?(0,t.A)((0,t.A)({},a),{},{klasifikace:n}):a)),Ra.current||!Ia.default.isAutosaveEnabled()||Qt||gt||!xa||oo(!0),a.serverId&&"uploaded"===a.status){if(!n||""===n.trim())return void ze("\u26a0\ufe0f Nelze ulo\u017eit pr\xe1zdnou klasifikaci pro nahran\xe9 soubory","warning");try{const o=await(0,La.Td)(qn.id,a.serverId,{type:n},Ee,Se);if("ok"===o.status||"success"===o.status){if(o.data){const a={typ_prilohy:o.data.type||n,dt_aktualizace:o.data.updated_at,klasifikace:o.data.type||n};Xn(n=>(0,t.A)((0,t.A)({},n),{},{prilohy_dokumenty:(n.prilohy_dokumenty||[]).map(n=>n.id===e?(0,t.A)((0,t.A)({},n),a):n)})),vn(n=>n.map(n=>n.id===e?(0,t.A)((0,t.A)({},n),a):n))}await up(!0),ze("\u2705 Klasifikace aktualizov\xe1na\n\ud83d\udcc4 "+a.name+"\n\ud83c\udff7\ufe0f "+n,"success"),Ic("success","ATTACHMENTS","update-classification-db","Klasifikace zm\u011bn\u011bna v DB: ".concat(a.name," \u2192 ").concat(n))}}catch(o){const n=(0,ao.g)(o.message);ze("\u274c Chyba p\u0159i aktualizaci klasifikace: ".concat(n),"error"),Ic("error","ATTACHMENTS","update-classification-db-failed","Chyba aktualizace klasifikace v DB: ".concat(n)),Xn(n=>(0,t.A)((0,t.A)({},n),{},{prilohy_dokumenty:(n.prilohy_dokumenty||[]).map(n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{klasifikace:a.klasifikace}):n)})),vn(n=>n.map(n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{klasifikace:a.klasifikace}):n))}}else if(n&&""!==n.trim()){if(!qn.id)return Ic("warning","ATTACHMENTS","upload-blocked","Nelze nahr\xe1t ".concat(a.name," - objedn\xe1vka nen\xed ulo\u017een\xe1")),void(ze&&ze("\u26a0\ufe0f Nelze nahr\xe1t p\u0159\xedlohu\n\n"+"\ud83d\udcc4 Soubor: ".concat(a.name,"\n")+"\ud83c\udff7\ufe0f Klasifikace nastavena: ".concat(n,"\n\n")+"\ud83d\udca1 Nejprve ulo\u017e objedn\xe1vku, pak se p\u0159\xedlohy automaticky nahraj\xed",{type:"warning",timeout:6e3}));if(!Ee||!Se)return Ic("error","ATTACHMENTS","upload-blocked","Nelze nahr\xe1t ".concat(a.name," - chyb\xed token nebo username")),void(ze&&ze("\u274c Chyba autentizace - nelze nahr\xe1t p\u0159\xedlohu",{type:"error"}));const o=a.file_prefix||"obj-";await pp(e,n,o)}})(e.id,n.target.value),disabled:"uploading"===e.status||"IMPORT"===e.typ_prilohy||ys,style:{width:"100%",padding:"0.5rem 0.75rem",border:"1px solid ".concat(e.klasifikace?"IMPORT"===e.typ_prilohy?"#f59e0b":"#d1d5db":"#fca5a5"),borderRadius:"6px",fontSize:"0.875rem",backgroundColor:"uploading"===e.status?"#f3f4f6":"IMPORT"===e.typ_prilohy?"#fef3c7":ys?"#f3f4f6":"white",color:e.klasifikace?"#374151":"#6b7280",cursor:"uploading"===e.status||"IMPORT"===e.typ_prilohy||ys?"not-allowed":"pointer",opacity:"uploading"===e.status||ys?.6:1,fontWeight:"IMPORT"===e.typ_prilohy?"600":"normal"},title:ys?"Klasifikace je zam\u010dena - objedn\xe1vka dokon\u010dena":"IMPORT"===e.typ_prilohy?"Importovan\xe1 p\u0159\xedloha - nelze m\u011bnit typ":"",children:[(0,fe.jsx)("option",{value:"",style:{color:"#6b7280"},children:"Vyberte..."}),Br.map(e=>(0,fe.jsx)("option",{value:e.kod||e.id,children:e.nazev||e.name},e.kod||e.id))]})]})]},e.id)})]}),(0,fe.jsxs)("div",{style:{backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"8px",padding:"1rem",marginTop:"1rem",display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[(0,fe.jsx)("div",{style:{fontSize:"1.25rem",flexShrink:0,lineHeight:1},children:"\u26a0\ufe0f"}),(0,fe.jsxs)("div",{style:{fontSize:"0.875rem",color:"#92400e",lineHeight:"1.5"},children:[(0,fe.jsx)("strong",{children:"D\u016fle\u017eit\xe9 upozorn\u011bn\xed:"}),' V\u0161echny zm\u011bny v p\u0159\xedloh\xe1ch (nahr\xe1n\xed, klasifikace, maz\xe1n\xed) jsou prov\xe1d\u011bny okam\u017eit\u011b a automaticky se ukl\xe1daj\xed do datab\xe1ze. Tyto akce nelze vz\xedt zp\u011bt pomoc\xed tla\u010d\xedtka "Zru\u0161it".']})]})]})})})]})]})})]}),Po&&s.createPortal((0,fe.jsx)(cl,{children:(0,fe.jsxs)(pl,{onClick:e=>e.stopPropagation(),children:[(0,fe.jsxs)(ul,{children:[(0,fe.jsxs)(vl,{children:[(0,fe.jsx)(E.A,{size:24}),"Adres\xe1\u0159 dodavatel\u016f"]}),(0,fe.jsx)(_l,{onClick:()=>{Lo(!1),Vo(""),Mo([])},children:"\xd7"})]}),(0,fe.jsxs)(fl,{children:[(0,fe.jsx)("div",{style:{marginBottom:"20px"},children:(0,fe.jsx)(ml,{type:"text",value:Ro,onChange:e=>{const n=e.target.value;Vo(n),wp(n)},placeholder:"Vyhledat podle n\xe1zvu nebo I\u010cO...",autoFocus:!0})}),(0,fe.jsx)("div",{style:{minHeight:"200px"},children:Uo?(0,fe.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"40px 20px",textAlign:"center"},children:[(0,fe.jsx)("div",{style:{width:"32px",height:"32px",border:"3px solid #f3f4f6",borderTop:"3px solid #3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"16px"}}),(0,fe.jsx)("p",{style:{color:"#6b7280",margin:0},children:"Vyhled\xe1v\xe1m dodavatele..."})]}):Fo.length>0?(0,fe.jsx)(hl,{children:Fo.map((e,n)=>(0,fe.jsxs)(kl,{onClick:()=>(e=>{Xn(n=>(0,t.A)((0,t.A)({},n),{},{dodavatel_nazev:e.nazev||e.name||"",dodavatel_adresa:e.adresa||e.address||"",dodavatel_ico:e.ico||"",dodavatel_dic:e.dic||"",dodavatel_zastoupeny:e.zastoupeny||e.represented||"",dodavatel_kontakt_jmeno:e.kontakt_jmeno||e.contactPerson&&e.contactPerson.name||"",dodavatel_kontakt_email:e.kontakt_email||e.contactPerson&&e.contactPerson.email||e.email||"",dodavatel_kontakt_telefon:e.kontakt_telefon||e.contactPerson&&e.contactPerson.phone||e.telefon||""})),Lo(!1),Vo(""),Mo([]),ze&&ze("Dodavatel byl vybr\xe1n",{type:"success"})})(e),children:[(0,fe.jsx)("div",{style:{fontWeight:"600",color:"#111827",marginBottom:"8px"},children:e.nazev||e.name}),(0,fe.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"4px"},children:e.adresa||e.address||e.sidlo}),(0,fe.jsxs)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"4px"},children:[e.ico&&"I\u010cO: ".concat(e.ico)," ",e.dic&&"\u2022 DI\u010c: ".concat(e.dic)]}),(e.kontakt_jmeno||e.kontakt_email)&&(0,fe.jsxs)("div",{style:{fontSize:"0.75rem",color:"#9ca3af"},children:["Kontakt: ",e.kontakt_jmeno," ",e.kontakt_email&&"\u2022 ".concat(e.kontakt_email)]})]},e.id||n))}):0===Bo.length?(0,fe.jsx)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6b7280"},children:(0,fe.jsx)("p",{children:"\u017d\xe1dn\xed dodavatel\xe9 nejsou k dispozici."})}):Ro.length>=2?(0,fe.jsx)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6b7280"},children:(0,fe.jsxs)("p",{children:['\u017d\xe1dn\xed dodavatel\xe9 nevyhovuj\xed vyhled\xe1v\xe1n\xed "',Ro,'".']})}):(0,fe.jsx)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6b7280"},children:(0,fe.jsx)("p",{children:"Za\u010dn\u011bte ps\xe1t pro filtrov\xe1n\xed dodavatel\u016f..."})})})]})]})}),document.body),Ho&&s.createPortal((0,fe.jsx)(gl,{children:(0,fe.jsxs)(bl,{onClick:e=>e.stopPropagation(),children:[(0,fe.jsxs)(yl,{children:[(0,fe.jsxs)(xl,{children:[(0,fe.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,fe.jsx)("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),(0,fe.jsx)("path",{d:"M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5"}),(0,fe.jsx)("path",{d:"M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3"})]}),"ARES - Administrativn\xed registr ekonomick\xfdch subjekt\u016f"]}),(0,fe.jsx)(jl,{onClick:()=>{Wo(!1),qo("")},children:(0,fe.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,fe.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,fe.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,fe.jsxs)(zl,{children:[(0,fe.jsx)(Al,{type:"text",placeholder:"Vyhledat podle n\xe1zvu firmy nebo I\u010cO...",value:$o,onChange:e=>{const n=e.target.value;qo(n),n.length>=2?(clearTimeout(window.aresSearchTimeout),window.aresSearchTimeout=setTimeout(()=>{Ep(n)},500)):Xo([])},autoFocus:!0}),(0,fe.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,fe.jsx)("div",{style:{fontSize:"14px",fontWeight:"600",color:"#262626",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Rozsah ulo\u017een\xed"}),(0,fe.jsxs)(Il,{children:[(0,fe.jsxs)(Pl,{type:"button",selected:"personal"===it,onClick:()=>rt("personal"),children:[(0,fe.jsx)(p.g,{icon:u.X46}),(0,fe.jsx)("span",{children:"Osobn\xed"})]}),(0,fe.jsxs)(Pl,{type:"button",selected:"usek"===it,onClick:()=>Oe&&Oe("CONTACT_EDIT")&&rt("usek"),disabled:!Oe||!Oe("CONTACT_EDIT"),title:Oe&&Oe("CONTACT_EDIT")?"":"Nem\xe1te opr\xe1vn\u011bn\xed pro \xfasekov\xfd kontakt",children:[(0,fe.jsx)(p.g,{icon:u.URI}),(0,fe.jsx)("span",{children:"\xdasek"})]}),(0,fe.jsxs)(Pl,{type:"button",selected:"global"===it,onClick:()=>Oe&&Oe("CONTACT_MANAGE")&&rt("global"),disabled:!Oe||!Oe("CONTACT_MANAGE"),title:Oe&&Oe("CONTACT_MANAGE")?"":"Nem\xe1te opr\xe1vn\u011bn\xed pro glob\xe1ln\xed kontakt",children:[(0,fe.jsx)(p.g,{icon:u.Bwz}),(0,fe.jsx)("span",{children:"Glob\xe1ln\xed"})]})]})]}),"usek"===it&&(0,fe.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,fe.jsx)("div",{style:{fontSize:"14px",fontWeight:"600",color:"#262626",marginBottom:"12px",textTransform:"uppercase",letterSpacing:"0.5px"},children:cs?"V\xfdb\u011br \xfasek\u016f":"V\xe1\u0161 \xfasek: ".concat((null===Ae||void 0===Ae?void 0:Ae.usek_zkr)||"N/A")}),ct?(0,fe.jsx)("div",{style:{padding:"1rem",textAlign:"center",color:"#6b7280"},children:"Na\u010d\xedt\xe1m \xfaseky..."}):0===dt.length?(0,fe.jsx)("div",{style:{padding:"1rem",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",color:"#dc2626"},children:"\u274c \u017d\xe1dn\xe9 \xfaseky nebyly na\u010dteny"}):(0,fe.jsx)(Ll,{children:(cs?dt:dt.filter(e=>e.usek_zkr===(null===Ae||void 0===Ae?void 0:Ae.usek_zkr))).map((e,n)=>(0,fe.jsxs)(Rl,{selected:st.includes(e.usek_zkr),onClick:()=>Cp(e.usek_zkr),children:[(0,fe.jsx)("input",{type:"checkbox",checked:st.includes(e.usek_zkr),onChange:()=>Cp(e.usek_zkr)}),e.usek_zkr]},e.usek_zkr||n))}),0===st.length&&!ct&&dt.length>0&&(0,fe.jsx)("div",{style:{marginTop:"8px",padding:"8px",background:"#e0f2fe",border:"1px solid #0ea5e9",borderRadius:"6px",fontSize:"12px",color:"#0c4a6e"},children:"\u2139\ufe0f Pokud nevyberete \u017e\xe1dn\xfd \xfasek, kontakt se ulo\u017e\xed jako osobn\xed"})]}),(0,fe.jsx)(wl,{children:Qo?(0,fe.jsxs)(Tl,{children:[(0,fe.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:(0,fe.jsx)("path",{d:"M21 12a9 9 0 11-6.219-8.56"})}),(0,fe.jsx)("span",{style:{marginLeft:"12px"},children:"Vyhled\xe1v\xe1m v ARES..."})]}):Yo.length>0?Yo.map((e,n)=>{const a=nt===e.ico;return(0,fe.jsxs)(Sl,{children:[(0,fe.jsxs)(El,{hasButtons:!0,onClick:()=>Np(e),children:[(0,fe.jsx)("div",{style:{fontWeight:"600",color:"#111827",marginBottom:"8px"},children:e.nazev}),(0,fe.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"4px"},children:e.sidlo||e.adresa}),(0,fe.jsxs)("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:["I\u010cO: ",e.ico," ",e.dic&&"\u2022 DI\u010c: ".concat(e.dic)]}),ot[e.ico]&&(ot[e.ico].existsInGlobal||ot[e.ico].existsInUsek||ot[e.ico].existsInPersonal)&&(0,fe.jsxs)(Cl,{children:[ot[e.ico].existsInGlobal&&(0,fe.jsxs)(Nl,{scope:"global",children:[(0,fe.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:(0,fe.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),"Glob\xe1ln\xed"]}),ot[e.ico].existsInUsek&&(0,fe.jsxs)(Nl,{scope:"usek",children:[(0,fe.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:(0,fe.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),"\xdasek"]}),ot[e.ico].existsInPersonal&&(0,fe.jsxs)(Nl,{scope:"personal",children:[(0,fe.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:(0,fe.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),"Osobn\xed"]})]})]}),(0,fe.jsxs)(Ol,{children:[(0,fe.jsxs)(Dl,{className:"primary",onClick:()=>Np(e),children:[(0,fe.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,fe.jsx)("path",{d:"M9 11l3 3L22 4"}),(0,fe.jsx)("path",{d:"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"})]}),"Pou\u017e\xedt"]}),(0,fe.jsx)(Dl,{className:"success",onClick:()=>{Op(e,"usek"===it?{scope:"usek",useky:st}:it),Np(e)},disabled:a||"usek"===it&&0===st.length,title:"usek"===it&&0===st.length?"Vyberte alespo\u0148 jeden \xfasek":"",children:a?(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:(0,fe.jsx)("path",{d:"M21 12a9 9 0 11-6.219-8.56"})}),"Ukl\xe1d\xe1m..."]}):(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,fe.jsx)("path",{d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"}),(0,fe.jsx)("polyline",{points:"17,21 17,13 7,13 7,21"}),(0,fe.jsx)("polyline",{points:"7,3 7,8 15,8"})]}),"Pou\u017e\xedt + Ulo\u017eit"]})})]})]},n)}):$o.length>=2?(0,fe.jsx)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6b7280"},children:(0,fe.jsx)("p",{children:"V ARES nebyli nalezeni \u017e\xe1dn\xed dodavatel\xe9."})}):(0,fe.jsx)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6b7280"},children:(0,fe.jsx)("p",{children:"Zadejte alespo\u0148 2 znaky pro vyhled\xe1v\xe1n\xed v ARES."})})})]})]})}),document.body),Ii&&s.createPortal((0,fe.jsx)(Ld,{children:(0,fe.jsxs)(Bd,{onClick:e=>e.stopPropagation(),children:[(0,fe.jsx)(Wd,{type:"button",onClick:()=>{Pi(!1),Ri(""),Fi("po"),Ui("new"),Bi(null)},children:(0,fe.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,fe.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,fe.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),(0,fe.jsx)(Kd,{children:(0,fe.jsx)(Hd,{children:"Ulo\u017eit \u0161ablonu"})}),(0,fe.jsxs)($d,{children:[(0,fe.jsxs)(Jd,{children:[(0,fe.jsx)(Gd,{children:"RE\u017dIM"}),(0,fe.jsx)("div",{style:{display:"flex",gap:"8px"},children:[{value:"new",label:"\u2728 Nov\xe1",disabled:!1},{value:"update",label:"\ud83d\udd04 Aktualizovat",disabled:0===[...Si,...Ci].length},{value:"merge",label:"\ud83d\udd17 Slou\u010dit",disabled:0===[...Si,...Ci].length}].map(e=>(0,fe.jsxs)("label",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",padding:"10px 16px",borderRadius:"6px",border:"2px solid ".concat(Mi===e.value?"#10b981":"#e5e7eb"),backgroundColor:Mi===e.value?"#d1fae5":"white",cursor:e.disabled?"not-allowed":"pointer",opacity:e.disabled?.5:1,fontSize:"0.875rem",fontWeight:"600",transition:"all 0.2s"},children:[(0,fe.jsx)("input",{type:"radio",name:"saveMode",value:e.value,checked:Mi===e.value,onChange:e=>Ui(e.target.value),disabled:e.disabled,style:{display:"none"}}),e.label]},e.value))})]}),("update"===Mi||"merge"===Mi)&&(0,fe.jsxs)(Jd,{children:[(0,fe.jsx)(Gd,{children:"VYBERTE \u0160ABLONU"}),(0,fe.jsx)(Uc,{field:"templateSelect",value:(null===Zi||void 0===Zi?void 0:Zi.id)||(null===Zi||void 0===Zi?void 0:Zi.ts)||"",onChange:e=>{const n=[...Si,...Ci].find(n=>(n.id||n.ts).toString()===String(e));Bi(n),"update"===Mi&&n&&Ri(n.name||"")},options:[...Si,...Ci],placeholder:"Vyberte \u0161ablonu...",getOptionLabel:e=>{const n=e.__fromServer?"server":"lok\xe1ln\xed";return"".concat(e.name," (").concat(n,")")},getOptionValue:e=>e.id||e.ts})]}),("new"===Mi||"merge"===Mi)&&(0,fe.jsxs)(Jd,{children:[(0,fe.jsx)(Gd,{children:"N\xc1ZEV"}),(0,fe.jsx)(qd,{type:"text",value:Li,onChange:e=>Ri(e.target.value),placeholder:"merge"===Mi?"N\xe1zev slou\u010den\xe9 \u0161ablony":"N\xe1zev \u0161ablony",autoFocus:"new"===Mi})]}),(0,fe.jsxs)(Jd,{children:[(0,fe.jsx)(Gd,{children:"TYP"}),(0,fe.jsx)("div",{style:{display:"flex",gap:"8px"},children:[{value:"po",label:"PO",disabled:!1},{value:"details",label:"Detaily",disabled:!ea&&aa<2},{value:"mixed",label:"V\u0161e",disabled:!ea&&aa<2}].map(e=>(0,fe.jsxs)("label",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"10px 16px",borderRadius:"6px",border:"2px solid ".concat(Vi===e.value?"#3b82f6":"#e5e7eb"),backgroundColor:Vi===e.value?"#dbeafe":"white",cursor:e.disabled?"not-allowed":"pointer",opacity:e.disabled?.4:1,fontSize:"0.875rem",fontWeight:"600",transition:"all 0.2s"},children:[(0,fe.jsx)("input",{type:"radio",name:"templateType",value:e.value,checked:Vi===e.value,onChange:e=>Fi(e.target.value),disabled:e.disabled,style:{display:"none"}}),e.label]},e.value))}),!ea&&aa<2&&(0,fe.jsxs)("div",{style:{marginTop:"8px",padding:"8px 12px",backgroundColor:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"6px",fontSize:"0.75rem",color:"#92400e"},children:["\u26a0\ufe0f Ve F\xc1ZI 1 lze ukl\xe1dat pouze ",(0,fe.jsx)("strong",{children:"PO"})," (P\u0159edb\u011b\u017en\xe1 objedn\xe1vka). Detaily budou dostupn\xe9 po schv\xe1len\xed."]})]})]}),(0,fe.jsxs)(Yd,{children:[(0,fe.jsx)(Xd,{type:"button",variant:"cancel",onClick:()=>{Pi(!1),Ri(""),Fi("po")},children:"Zru\u0161it"}),(0,fe.jsx)(Xd,{type:"button",variant:"primary",onClick:async()=>{if(!Li.trim())return;const e={},n=eo(ia,aa,ea),a={financovani:["zpusob_financovani","financovani","lp_kod","cislo_smlouvy","smlouva_poznamka","individualni_schvaleni","individualni_poznamka","pojistna_udalost_cislo","pojistna_udalost_poznamka"],dodavatel:["dodavatel_id","dodavatel_nazev","dodavatel_adresa","dodavatel_ico","dodavatel_dic","dodavatel_zastoupeny"],kontakt:["dodavatel_kontakt_jmeno","dodavatel_kontakt_email","dodavatel_kontakt_telefon"],detaily:["druh_objednavky","druh_objednavky_kod","poznamka_objednavky"],dodaci_podminky:["dt_predpokladany_termin_dodani","misto_dodani","zaruka"],polozky:["polozky_objednavky"]};if("po"!==Vi&&"mixed"!==Vi||(e.poApproval={predmet:qn.predmet||"",prikazce_id:qn.prikazce_id||"",max_cena_s_dph:qn.max_cena_s_dph||"",strediska_kod:qn.strediska_kod||"",garant_uzivatel_id:qn.garant_uzivatel_id||"",zpusob_financovani:qn.zpusob_financovani||"",lp_kod:qn.lp_kod||[],cislo_smlouvy:qn.cislo_smlouvy||"",smlouva_poznamka:qn.smlouva_poznamka||"",individualni_schvaleni:qn.individualni_schvaleni||"",individualni_poznamka:qn.individualni_poznamka||"",pojistna_udalost_cislo:qn.pojistna_udalost_cislo||"",pojistna_udalost_poznamka:qn.pojistna_udalost_poznamka||""}),"details"===Vi||"mixed"===Vi){if(aa<2)return void(null===ze||void 0===ze||ze('Nelze ulo\u017eit Detaily ve F\xc1ZI 1. Pou\u017eijte typ "PO".',"warning"));e.orderDetails={},Object.entries(a).forEach(a=>{let[o,t]=a;("polozky"===o?n.detaily:n[o])&&t.forEach(n=>{"polozky_objednavky"!==n&&void 0!==qn[n]&&(e.orderDetails[n]=qn[n]||"")})}),n.detaily&&Array.isArray(qn.polozky_objednavky)&&qn.polozky_objednavky.length>0&&(e.polozky=qn.polozky_objednavky.map(e=>({popis:e.popis||"",cena_bez_dph:e.cena_bez_dph||"",sazba_dph:e.sazba_dph||21,cena_s_dph:e.cena_s_dph||""})))}if("new"===Mi)await iu(Li.trim(),e,Vi);else if("update"===Mi)if(Zi.__fromServer)try{const n="po"!==Vi&&"mixed"!==Vi||!e.poApproval?"":JSON.stringify(e.poApproval),a="details"!==Vi&&"mixed"!==Vi||!e.orderDetails?"":JSON.stringify(e.orderDetails),o=await(0,me.ub)({username:(null===Ce||void 0===Ce?void 0:Ce.username)||Se,token:Ee,user_id:Zi.user_id||0,id:Zi.id,nazev_sablony:Zi.name,polozky_po:n,polozky_detail:a,typ:Vi,kategorie:"OBJEDNAVKA25"});"ok"===(null===o||void 0===o?void 0:o.status)&&(await ou(),ze&&ze('\u0160ablona "'.concat(Zi.name,'" byla aktualizov\xe1na'),{type:"success"}))}catch(i){ze&&ze("Chyba p\u0159i aktualizaci \u0161ablony na serveru",{type:"error"})}else Ei(n=>n.map(n=>n.ts===Zi.ts?(0,t.A)((0,t.A)({},n),{},{data:e,type:Vi}):n)),ze&&ze('\u0160ablona "'.concat(Zi.name,'" byla aktualizov\xe1na'),{type:"success"});else if("merge"===Mi){const n=(0,t.A)({},Zi.data);var o;if(e.poApproval&&(n.poApproval=(0,t.A)((0,t.A)({},n.poApproval),e.poApproval)),e.orderDetails)n.orderDetails=(0,t.A)((0,t.A)({},n.orderDetails),e.orderDetails),(null===(o=e.orderDetails.polozky)||void 0===o?void 0:o.length)>0&&(n.orderDetails.polozky=[...n.orderDetails.polozky||[],...e.orderDetails.polozky]);await iu(Li.trim(),n,"mixed"),ze&&ze('\u0160ablona "'.concat(Li,'" byla vytvo\u0159ena slou\u010den\xedm'),{type:"success"})}Pi(!1),Ri(""),Fi("po"),Ui("new"),Bi(null)},disabled:"new"===Mi&&!Li.trim()||("update"===Mi||"merge"===Mi)&&!Zi||"merge"===Mi&&!Li.trim(),children:"new"===Mi?"\ud83d\udcbe Ulo\u017eit":"update"===Mi?"\ud83d\udd04 Aktualizovat":"\ud83d\udd17 Slou\u010dit"})]})]})}),document.body),Ki&&s.createPortal((0,fe.jsx)(Rd,{onClick:e=>{e.target===e.currentTarget&&au()},children:(0,fe.jsxs)(Vd,{onClick:e=>e.stopPropagation(),children:[(0,fe.jsx)(Fd,{children:"Potvrdit smaz\xe1n\xed \u0161ablony"}),(0,fe.jsxs)(Md,{children:["Opravdu chcete smazat \u0161ablonu ",(0,fe.jsxs)("strong",{children:['"',null===Wi||void 0===Wi?void 0:Wi.name,'"']}),"?",(0,fe.jsx)("br",{}),(0,fe.jsx)("br",{}),"Tato akce je nevratn\xe1."]}),(0,fe.jsxs)(Ud,{children:[(0,fe.jsx)(Zd,{onClick:au,children:"Zru\u0161it"}),(0,fe.jsx)(Zd,{variant:"danger",onClick:()=>{if(Wi)try{const e=Wi;e&&(e.__fromServer||e.id)&&Ee&&Se?(async()=>{try{const n=e&&void 0!==e.user_id&&null!==e.user_id?e.user_id:we||0;if(0===Number(n)&&(!Oe||!Oe("TEMPLATE_MANAGE")))return void(ze&&ze("Nem\xe1te opr\xe1vn\u011bn\xed smazat p\u0159eddefinovanou \u0161ablonu.",{type:"error"}));const a=await(0,me.I7)({username:(null===Ce||void 0===Ce?void 0:Ce.username)||Se,token:Ee,user_id:n||0,id:e.id}),o=a&&a.data&&(a.data.status||a.data.result||(a.data.ok?"ok":null)),t=a&&a.data&&(a.data.data||a.data);if(!(o&&"ok"===String(o).toLowerCase()&&t&&(!0===t.deleted||"true"===t.deleted)||null!==a&&void 0!==a&&a.success||"ok"===(null===a||void 0===a?void 0:a.status)))throw new Error("Smaz\xe1n\xed na serveru se nezda\u0159ilo");Ni(n=>Array.isArray(n)?n.filter(n=>String(n.id)!==String(e.id)):n),Ei(n=>{const a=n.filter(n=>!(n.id&&e.id&&String(n.id)===String(e.id)));try{const e=we?"order_templates_".concat(we):"order_templates";localStorage.setItem(e,JSON.stringify(a))}catch(o){}return a}),Lp("delete",{name:null===e||void 0===e?void 0:e.name,id:null===e||void 0===e?void 0:e.id,mode:"server"}),ze&&ze("\u0160ablona byla smaz\xe1na.",{type:"success"})}catch(n){Ei(n=>{const a=n.filter(n=>!(n.ts===e.ts&&n.name===e.name));try{const e=we?"order_templates_".concat(we):"order_templates";localStorage.setItem(e,JSON.stringify(a))}catch(o){}return a}),ze&&ze("Smaz\xe1n\xed \u0161ablony selhalo: ".concat((null===n||void 0===n?void 0:n.message)||"Chyba serveru"),{type:"error"})}})():(Ei(e=>{const n=e.filter(e=>!(e.ts===Wi.ts&&e.name===Wi.name));try{const e=we?"order_templates_".concat(we):"order_templates";localStorage.setItem(e,JSON.stringify(n))}catch(a){}return n}),Lp("delete",{name:null===Wi||void 0===Wi?void 0:Wi.name,ts:null===Wi||void 0===Wi?void 0:Wi.ts,mode:"local"}))}finally{Hi(!1),$i(null)}},children:"Smazat"})]})]})}),document.body),hr&&s.createPortal((0,fe.jsx)(Bl,{onClick:()=>kr(null),children:(0,fe.jsxs)(Kl,{onClick:e=>e.stopPropagation(),children:[(0,fe.jsxs)(Hl,{children:[(0,fe.jsxs)(Wl,{children:[(0,fe.jsx)(ce.A,{size:20}),"N\xe1hled \u0161ablony"]}),(0,fe.jsx)($l,{onClick:()=>kr(null),children:(0,fe.jsx)(w.A,{size:18})})]}),(0,fe.jsxs)(Jl,{children:[(0,fe.jsxs)(Gl,{children:[(0,fe.jsx)(S.A,{size:16}),"Informace o \u0161ablon\u011b"]}),(0,fe.jsxs)(ql,{children:[(0,fe.jsx)(Yl,{children:"N\xe1zev:"}),(0,fe.jsx)(Xl,{children:hr.preview.templateInfo.name})]}),(0,fe.jsxs)(ql,{children:[(0,fe.jsx)(Yl,{children:"Typ:"}),(0,fe.jsx)(Xl,{children:(0,fe.jsx)(oc,{type:hr.preview.templateInfo.type,children:"po"===hr.preview.templateInfo.type?"Schv\xe1len\xed":"details"===hr.preview.templateInfo.type?"Detaily":"Kombinovan\xe9"})})]}),(0,fe.jsxs)(ql,{children:[(0,fe.jsx)(Yl,{children:"Vytvo\u0159ena:"}),(0,fe.jsx)(Xl,{children:hr.preview.templateInfo.created})]}),(0,fe.jsxs)(ql,{children:[(0,fe.jsx)(Yl,{children:"Dostupnost:"}),(0,fe.jsx)(Xl,{children:hr.preview.templateInfo.isGlobal?"Glob\xe1ln\xed kontakt":"Osobn\xed kontakt"})]})]}),hr.preview.poApproval&&(0,fe.jsxs)(Jl,{children:[(0,fe.jsxs)(Gl,{children:[(0,fe.jsx)(pe.A,{size:16}),"Schv\xe1len\xed n\xe1kupu"]}),hr.preview.poApproval.predmet&&(0,fe.jsxs)(ql,{children:[(0,fe.jsx)(Yl,{children:"P\u0159edm\u011bt:"}),(0,fe.jsx)(Xl,{children:hr.preview.poApproval.predmet})]}),hr.preview.poApproval.maxCena&&(0,fe.jsxs)(ql,{children:[(0,fe.jsx)(Yl,{children:"Max. cena s DPH:"}),(0,fe.jsxs)(Xl,{children:[hr.preview.poApproval.maxCena," K\u010d"]})]}),hr.preview.poApproval.popisPozadavku&&(0,fe.jsxs)(ql,{children:[(0,fe.jsx)(Yl,{children:"Popis po\u017eadavku:"}),(0,fe.jsx)(Xl,{children:hr.preview.poApproval.popisPozadavku})]}),hr.preview.poApproval.strediska.length>0&&(0,fe.jsxs)(ql,{children:[(0,fe.jsx)(Yl,{children:"St\u0159ediska:"}),(0,fe.jsxs)(Xl,{children:[hr.preview.poApproval.strediska.length," vybr\xe1no"]})]})]}),hr.preview.orderDetails&&(0,fe.jsxs)(Jl,{children:[(0,fe.jsxs)(Gl,{children:[(0,fe.jsx)(T.A,{size:16}),"Detaily objedn\xe1vky"]}),hr.preview.orderDetails.dodavatelNazev&&(0,fe.jsxs)(ql,{children:[(0,fe.jsx)(Yl,{children:"Dodavatel:"}),(0,fe.jsx)(Xl,{children:hr.preview.orderDetails.dodavatelNazev})]}),hr.preview.orderDetails.dodavatelIco&&(0,fe.jsxs)(ql,{children:[(0,fe.jsx)(Yl,{children:"I\u010cO:"}),(0,fe.jsx)(Xl,{children:hr.preview.orderDetails.dodavatelIco})]}),hr.preview.orderDetails.zpusobFinancovani&&(0,fe.jsxs)(ql,{children:[(0,fe.jsx)(Yl,{children:"Financov\xe1n\xed:"}),(0,fe.jsx)(Xl,{children:hr.preview.orderDetails.zpusobFinancovani})]}),hr.preview.orderDetails.datumDodani&&(0,fe.jsxs)(ql,{children:[(0,fe.jsx)(Yl,{children:"Datum dod\xe1n\xed:"}),(0,fe.jsx)(Xl,{children:hr.preview.orderDetails.datumDodani})]}),hr.preview.orderDetails.poznamka&&(0,fe.jsxs)(ql,{children:[(0,fe.jsx)(Yl,{children:"Pozn\xe1mka:"}),(0,fe.jsx)(Xl,{children:hr.preview.orderDetails.poznamka})]})]}),hr.preview.items.length>0&&(0,fe.jsxs)(Jl,{children:[(0,fe.jsxs)(Gl,{children:[(0,fe.jsx)(I,{size:16}),"Polo\u017eky (",hr.preview.items.length,")"]}),(0,fe.jsxs)(Ql,{children:[hr.preview.items.slice(0,5).map((e,n)=>(0,fe.jsxs)(ec,{children:[(0,fe.jsxs)(nc,{children:[e.index,". ",e.popis||"Bez popisu"]}),(0,fe.jsxs)(ac,{children:[(0,fe.jsxs)("span",{children:[e.pocet,"\xd7 ",e.cenaJednotka," K\u010d/",e.jednotka||"ks"]}),(0,fe.jsxs)("strong",{children:[e.cenaTotal.toLocaleString("cs-CZ")," K\u010d"]})]})]},n)),hr.preview.items.length>5&&(0,fe.jsxs)(tc,{children:["... a dal\u0161\xedch ",hr.preview.items.length-5," polo\u017eek"]}),hr.preview.items.length>0&&(0,fe.jsxs)(ql,{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"2px solid #f3f4f6"},children:[(0,fe.jsx)(Yl,{children:"Celkov\xe1 cena:"}),(0,fe.jsxs)(Xl,{style:{fontWeight:"bold",color:"#059669"},children:[hr.preview.items.reduce((e,n)=>e+n.cenaTotal,0).toLocaleString("cs-CZ")," K\u010d"]})]})]})]}),!hr.preview.poApproval&&!hr.preview.orderDetails&&0===hr.preview.items.length&&(0,fe.jsx)(tc,{children:"Tato \u0161ablona neobsahuje \u017e\xe1dn\xe1 data"})]})}),document.body),(0,fe.jsx)(ve.A,{isOpen:ro,onClose:Gp,onConfirm:Jp,title:"Zav\u0159\xedt formul\xe1\u0159",icon:u.zpE,variant:"warning",confirmText:"Ano, zav\u0159\xedt",cancelText:"Ne, z\u016fstat",children:lo||"Koncept bude zru\u0161en a neulo\u017een\xe9 zm\u011bny nebudou ulo\u017eeny."}),(0,fe.jsxs)(ve.A,{isOpen:Ot,onClose:()=>{Dt(!1),It(null)},onConfirm:async()=>{if(!Tt)return;const{fileId:e,attachment:n,isFromServer:a}=Tt;a?await(async(e,n)=>{if(n.serverId&&Ee&&Se)try{Ic("info","ATTACHMENTS","delete-start","Maz\xe1n\xed p\u0159\xedlohy ".concat(n.name," ze serveru...")),await(0,La.Lu)(qn.id,n.serverId,Se,Ee),Ic("success","ATTACHMENTS","delete-success","P\u0159\xedloha ".concat(n.name," smaz\xe1na ze serveru")),ze('\ud83d\uddd1\ufe0f P\u0159\xedloha "'.concat(n.name,'" byla \xfasp\u011b\u0161n\u011b smaz\xe1na'),"success")}catch(t){var a,o;Ic("error","ATTACHMENTS","delete-error","Chyba p\u0159i maz\xe1n\xed ".concat(n.name,": ").concat(t.message));const e=(null===(a=t.response)||void 0===a||null===(o=a.data)||void 0===o?void 0:o.message)||t.message||"Nezn\xe1m\xe1 chyba";return void ze('\u274c Chyba p\u0159i maz\xe1n\xed p\u0159\xedlohy "'.concat(n.name,'": ').concat(e),"error")}mp(e)})(e,n,n.name):(mp(e),ze("Soubor byl odstran\u011bn","info")),Dt(!1),It(null)},title:"Smazat p\u0159\xedlohu",icon:u.yLS,variant:"danger",confirmText:"Ano, smazat",cancelText:"Zru\u0161it",children:[(0,fe.jsxs)("p",{children:["Opravdu chcete smazat ",(0,fe.jsxs)("strong",{children:['"',(null===Tt||void 0===Tt||null===(xe=Tt.attachment)||void 0===xe?void 0:xe.name)||"tento soubor",'"']}),"?"]}),(null===Tt||void 0===Tt?void 0:Tt.isFromServer)&&(0,fe.jsxs)("p",{style:{background:"linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%)",padding:"0.75rem",borderRadius:"6px",border:"1px solid rgba(239, 68, 68, 0.2)",color:"#991b1b",fontSize:"0.9rem",margin:"0.75rem 0"},children:[(0,fe.jsx)("strong",{children:"\u26a0\ufe0f Pozor:"})," Po smaz\xe1n\xed ji\u017e nebude mo\u017en\xe9 soubor obnovit."]})]}),(0,fe.jsxs)(ve.A,{isOpen:Pt,onClose:()=>{Lt(!1)},onConfirm:()=>{Xn(e=>(0,t.A)((0,t.A)({},e),{},{prilohy_dokumenty:[]})),vn([]),ze("V\u0161echny p\u0159\xedlohy (".concat(un.length," soubor\u016f) byly odstran\u011bny"),"warning"),Lt(!1)},title:"Smazat v\u0161echny p\u0159\xedlohy",icon:u.yLS,variant:"danger",confirmText:"Ano, smazat v\u0161e",cancelText:"Zru\u0161it",children:[(0,fe.jsxs)("p",{children:["Opravdu chcete smazat ",(0,fe.jsxs)("strong",{children:["v\u0161echny p\u0159\xedlohy (",un.length," soubor\u016f)"]}),"?"]}),(0,fe.jsxs)("p",{style:{background:"linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%)",padding:"0.75rem",borderRadius:"6px",border:"1px solid rgba(239, 68, 68, 0.2)",color:"#991b1b",fontSize:"0.9rem",margin:"0.75rem 0"},children:[(0,fe.jsx)("strong",{children:"\u26a0\ufe0f Pozor:"})," Tato akce odstran\xed v\u0161echny nahran\xe9 soubory. Operaci nelze vr\xe1tit zp\u011bt."]})]}),(0,fe.jsxs)(ve.A,{isOpen:bo.isOpen,onClose:()=>yo({isOpen:!1,fakturaId:null,fakturaNazev:"",pocetPriloh:0}),onConfirm:async()=>{const{fakturaId:e,fakturaNazev:n,pocetPriloh:a}=bo;if(yo({isOpen:!1,fakturaId:null,fakturaNazev:"",pocetPriloh:0}),e)try{const i=e&&!String(e).startsWith("temp-");if(i&&a>0)try{var o;const n=await(0,La.CX)(e,Se,Ee,qn.id),a=(null===(o=n.data)||void 0===o?void 0:o.attachments)||n.data||[];for(const o of a)try{await(0,La.ao)(e,o.id,Se,Ee)}catch(t){ze&&ze("Nepoda\u0159ilo se smazat p\u0159\xedlohu faktury",{type:"error"})}}catch(t){ze&&ze("Nepoda\u0159ilo se smazat p\u0159\xedlohy faktury",{type:"error"})}if(i)try{await $a(e,Ee,Se,!0),ze&&ze("\u2705 Faktura trvale smaz\xe1na\n\ud83d\udcca ".concat(n||"Faktura","\n\ud83d\udcbe V\u010detn\u011b p\u0159\xedloh"),"success")}catch(t){ze&&ze("Nepoda\u0159ilo se smazat fakturu",{type:"error"})}const r=(Array.isArray(qn.faktury)?qn.faktury:[]).filter(n=>n.id!==e);yc(r),oo(!0)}catch(t){ze&&ze("Nepoda\u0159ilo se smazat fakturu",{type:"error"})}},title:"Smazat fakturu",icon:u.yLS,variant:"danger",confirmText:"Smazat",cancelText:"Zru\u0161it",children:[(0,fe.jsxs)("p",{children:["Opravdu chcete smazat fakturu ",(0,fe.jsxs)("strong",{children:['"',bo.fakturaNazev,'"']}),"?"]}),bo.pocetPriloh>0&&(0,fe.jsxs)("p",{style:{background:"#fee2e2",padding:"0.75rem",borderRadius:"6px",border:"1px solid #ef4444",margin:"0.75rem 0"},children:[(0,fe.jsx)("strong",{children:"\u26a0\ufe0f POZOR:"})," Faktura m\xe1 ",(0,fe.jsxs)("strong",{children:[bo.pocetPriloh," p\u0159\xedlohu/p\u0159\xedloh"]}),", kter\xe9 budou tak\xe9 smaz\xe1ny!"]})]}),(0,fe.jsxs)(ve.A,{isOpen:Ji,onClose:()=>Gi(!1),onConfirm:()=>{Gi(!1),(async()=>{const{updatedFormData:e,unlockState:n,newPhase:a}=na.unlockPhase2();Xn(e),setTimeout(()=>{oo(!0),Ic("success","UNLOCK",n,"F\xc1ZE ".concat(a," odem\u010dena, workflow: ").concat(e.stav_workflow_kod))},100)})()},title:"\u26a0\ufe0f Odemknout F\xc1ZI 2 (Info o objednateli)",icon:u.zpE,variant:"danger",confirmText:"ANO, ODEMKNOUT A SMAZAT",cancelText:"Zru\u0161it",children:[(0,fe.jsxs)("p",{style:{background:"#fee2e2",padding:"0.75rem",borderRadius:"6px",border:"1px solid #ef4444",margin:"0.75rem 0"},children:[(0,fe.jsx)("strong",{children:"\u26a0\ufe0f VAROV\xc1N\xcd:"})," Odem\u010den\xed F\xc1ZE 2 vyma\u017ee ",(0,fe.jsx)("strong",{children:"v\u0161echna data vy\u0161\u0161\xedch f\xe1z\xed (F\xc1ZE 3-10)"}),"!"]}),(0,fe.jsxs)("p",{children:["Workflow se resetuje na stav ",(0,fe.jsx)("strong",{children:"ODESL\xc1NA KE SCHV\xc1LEN\xcd"}),"."]}),(0,fe.jsx)("p",{children:(0,fe.jsx)("strong",{children:"Opravdu chcete pokra\u010dovat?"})})]}),(0,fe.jsxs)(ve.A,{isOpen:qi,onClose:()=>Yi(!1),onConfirm:()=>{Yi(!1),(async()=>{const{updatedFormData:e,unlockState:n,newPhase:a}=na.unlockPhase2();Xn(e),setTimeout(()=>{oo(!0),Ic("success","UNLOCK",n,"F\xc1ZE ".concat(a," odem\u010dena, workflow: ").concat(e.stav_workflow_kod))},100)})()},title:"Odemknout zam\xedtnutou objedn\xe1vku",icon:u.zpE,variant:"danger",confirmText:"Ano, odemknout",cancelText:"Zru\u0161it",children:[(0,fe.jsx)("p",{children:"Opravdu chcete odemknout zam\xedtnutou objedn\xe1vku?"}),(0,fe.jsxs)("p",{style:{marginTop:"0.5rem",color:"#dc2626"},children:[(0,fe.jsx)("strong",{children:"\u26a0\ufe0f UPOZORN\u011aN\xcd:"})," Objedn\xe1vka bude odem\u010dena a zp\u0159\xedstupn\u011bna pro dal\u0161\xed pr\u016fb\u011bh workflow."]}),(0,fe.jsx)("p",{style:{marginTop:"0.5rem"},children:"Budete moci prov\xe9st pot\u0159ebn\xe9 \xfapravy a objedn\xe1vku znovu odeslat ke schv\xe1len\xed."})]}),(0,fe.jsxs)(ve.A,{isOpen:Xi,onClose:()=>Qi(!1),onConfirm:()=>{Qi(!1),(async()=>{const{updatedFormData:e,unlockState:n,newPhase:a}=na.unlockPhase3();Cn(!0),setTimeout(()=>{Xn(e),Xp("phase3"),setTimeout(()=>{oo(!0),Ic("success","UNLOCK",n,"F\xc1ZE ".concat(a," odem\u010dena, workflow: ").concat(e.stav_workflow_kod))},100)},10)})()},title:"\u26a0\ufe0f Odemknout F\xc1ZE 3",icon:u.zpE,variant:"danger",confirmText:"ANO, ODEMKNOUT A SMAZAT",cancelText:"Zru\u0161it",children:[(0,fe.jsxs)("div",{style:{display:"flex",gap:"12px",padding:"12px",backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"6px",marginBottom:"1rem"},children:[(0,fe.jsx)(p.g,{icon:u.zpE,style:{color:"#ef4444",fontSize:"20px",marginTop:"2px"}}),(0,fe.jsxs)("div",{children:[(0,fe.jsx)("strong",{children:"Varov\xe1n\xed:"})," Odem\u010den\xed F\xc1ZE 3 vyma\u017ee v\u0161echna data vy\u0161\u0161\xedch f\xe1z\xed (F\xc1ZE 4-10)!"]})]}),(0,fe.jsxs)("p",{children:["Workflow se resetuje na stav ",(0,fe.jsx)("strong",{children:"ODESL\xc1NA"}),"."]}),(0,fe.jsx)("p",{style:{marginTop:"0.5rem"},children:"Opravdu chcete pokra\u010dovat?"})]}),(0,fe.jsxs)(ve.A,{isOpen:er,onClose:()=>nr(!1),onConfirm:()=>{nr(!1),na.unlockSection("registr_vyplneni");const e=(Array.isArray(qn.stav_workflow_kod)?qn.stav_workflow_kod:qn.stav_workflow_kod?[qn.stav_workflow_kod]:[]).filter(e=>"UVEREJNENA"!==e);e.includes("UVEREJNIT")||e.push("UVEREJNIT"),e.includes("ODESLANA")||e.push("ODESLANA"),e.includes("POTVRZENA")||e.push("POTVRZENA"),Xn(n=>(0,t.A)((0,t.A)({},n),{},{stav_workflow_kod:e})),Ic("info","UNLOCK","registr-vyplneni","Odem\u010dena sekce Registr smluv - nastaveno UVEREJNIT (F\xc1ZE 5)"),setTimeout(()=>{oo(!0)},100)},title:"Odemknout sekci Registr smluv",icon:u.zpE,variant:"danger",confirmText:"Odemknout",cancelText:"Zru\u0161it",children:[(0,fe.jsxs)("p",{children:["Opravdu chcete odemknout sekci ",(0,fe.jsx)("strong",{children:"Registr smluv"})," pro editaci?"]}),(0,fe.jsxs)("p",{style:{marginTop:"0.5rem"},children:["Workflow se nastav\xed na F\xc1ZI 5 se stavem ",(0,fe.jsx)("strong",{children:"UVEREJNIT"}),"."]})]}),(0,fe.jsxs)(ve.A,{isOpen:ar,title:"Odemknout sekci Potvrzen\xed od dodavatele",confirmText:"Ano, odemknout",cancelText:"Zru\u0161it",variant:"warning",icon:u.zpE,onConfirm:()=>{or(!1),na.unlockSection("potvrzeni"),na.unlockSection("registr");const{updatedFormData:e}=na.unlockPhase4();Xn(e),Xp("potvrzeni"),setTimeout(()=>{oo(!0)},100)},onClose:()=>or(!1),children:[(0,fe.jsxs)("p",{children:["Opravdu chcete odemknout sekci ",(0,fe.jsx)("strong",{children:"Potvrzen\xed od dodavatele"})," pro editaci?"]}),(0,fe.jsxs)("p",{style:{marginTop:"0.5rem"},children:["Z\xe1rove\u0148 bude odem\u010dena i sekce ",(0,fe.jsx)("strong",{children:"Registr smluv"})," a workflow se vr\xe1t\xed na stav ",(0,fe.jsx)("strong",{children:"ODESL\xc1NA (F\xc1ZE 4)"}),"."]})]}),(0,fe.jsx)(ve.A,{isOpen:tr,title:"Zru\u0161it zve\u0159ejn\u011bn\xed v registru smluv",confirmText:"Ano, od\u0161krtnout",cancelText:"Ne, ponechat za\u0161krtnut\xe9",variant:"danger",icon:u.zpE,onConfirm:()=>{ir(!1),Rp("ma_byt_zverejnena",!1),Rp("dt_zverejneni",""),Rp("registr_iddt",""),Rp("zverejnil_id",null),Ic("info","REGISTR","zrusit-zverejneni","Zru\u0161ena povinnost zve\u0159ejn\u011bn\xed")},onClose:()=>ir(!1),children:(0,fe.jsxs)("div",{children:[(0,fe.jsxs)("p",{style:{marginBottom:"1rem"},children:["Celkov\xe1 cena objedn\xe1vky je ",(0,fe.jsxs)("strong",{children:[Tc.toLocaleString("cs-CZ",{minimumFractionDigits:2,maximumFractionDigits:2})," K\u010d bez DPH"]}),", co\u017e je nad limitem 50 000 K\u010d."]}),(0,fe.jsx)("p",{style:{fontSize:"0.95rem",color:"#dc2626",fontWeight:"600",marginBottom:"0.75rem",padding:"0.75rem",backgroundColor:"#fee2e2",borderRadius:"6px",border:"1px solid #fca5a5"},children:"\u26a0\ufe0f Podle z\xe1kona mus\xed b\xfdt objedn\xe1vka zve\u0159ejn\u011bna v registru smluv."}),(0,fe.jsx)("p",{style:{fontSize:"0.9rem",color:"#6b7280",marginBottom:"0.5rem"},children:"Opravdu chcete od\u0161krtnout checkbox? Tato akce vyma\u017ee vypln\u011bn\xe9 \xfadaje:"}),(0,fe.jsxs)("ul",{style:{fontSize:"0.9rem",color:"#374151",paddingLeft:"1.5rem",margin:0},children:[(0,fe.jsx)("li",{children:"Datum zve\u0159ejn\u011bn\xed"}),(0,fe.jsx)("li",{children:"Identifik\xe1tor"}),(0,fe.jsx)("li",{children:"Zve\u0159ejnil (u\u017eivatel)"})]})]})}),(0,fe.jsxs)(ve.A,{isOpen:rr,title:"Odemknout sekci Fakturace",confirmText:"Odemknout",variant:"warning",onConfirm:()=>{sr(!1),na.unlockSection("fakturace");const e=(Array.isArray(qn.stav_workflow_kod)?qn.stav_workflow_kod:qn.stav_workflow_kod?[qn.stav_workflow_kod]:[]).filter(e=>!["FAKTURACE","VECNA_SPRAVNOST","ZKONTROLOVANA","DOKONCENA"].includes(e));Xn(n=>(0,t.A)((0,t.A)({},n),{},{stav_workflow_kod:e})),Ic("info","UNLOCK","fakturace","Odem\u010dena sekce Fakturace - odebr\xe1ny stavy FAKTURACE, KONTROLA, ZKONTROLOVANA, DOKONCENA \u2192 F\xc1ZE 6/8"),Xp("fakturace"),setTimeout(()=>{oo(!0)},100)},onClose:()=>sr(!1),children:[(0,fe.jsxs)("p",{children:["Opravdu chcete odemknout sekci ",(0,fe.jsx)("strong",{children:"Fakturace"})," pro editaci?"]}),(0,fe.jsxs)("p",{style:{marginTop:"0.5rem",color:"#dc2626"},children:["Budou odebr\xe1ny stavy ",(0,fe.jsx)("strong",{children:"FAKTURACE, VECNA_SPRAVNOST, ZKONTROLOVANA, DOKONCENA"})," a workflow se vr\xe1t\xed na ",(0,fe.jsx)("strong",{children:"F\xc1ZI 6/8"}),"."]})]}),(0,fe.jsxs)(ve.A,{isOpen:dr,title:"Odemknout dokon\u010denou objedn\xe1vku",confirmText:"Ano, odemknout",cancelText:"Zru\u0161it",variant:"warning",icon:u.zpE,onConfirm:()=>{lr(!1),Ic("info","UNLOCK","dokonceni","\ud83d\udd13 Dokon\u010den\xe1 objedn\xe1vka odem\u010dena");const e=qn.stav_workflow_kod||"";let n;n=Array.isArray(e)?[...e]:String(e).split(",").map(e=>e.trim()).filter(e=>e),n=n.filter(e=>"DOKONCENA"!==e),n.includes("ZKONTROLOVANA")||n.push("ZKONTROLOVANA"),Xn(e=>(0,t.A)((0,t.A)({},e),{},{potvrzeni_dokonceni_objednavky:0,vecna_spravnost_potvrzeno:1,stav_workflow_kod:n})),na.unlockSection("dokonceni"),ma(),Ic("info","UNLOCK","completed","\u2705 Objedn\xe1vka odem\u010dena (workflow manager refresh)")},onClose:()=>lr(!1),children:[(0,fe.jsx)("p",{children:"Opravdu chcete odemknout dokon\u010denou objedn\xe1vku?"}),(0,fe.jsxs)("p",{style:{marginTop:"0.5rem",color:"#16a34a"},children:[(0,fe.jsx)("strong",{children:"\u26a0\ufe0f UPOZORN\u011aN\xcd:"})," Objedn\xe1vka bude zp\u0159\xedstupn\u011bna k \xfaprav\xe1m a oprav\xe1m."]})]}),(0,fe.jsxs)(ve.A,{isOpen:cr,title:"Odemknout stornovanou objedn\xe1vku",confirmText:"Ano, odemknout",cancelText:"Zru\u0161it",variant:"danger",icon:u.zpE,onConfirm:async()=>{pr(!1),Ic("info","UNLOCK","cancelled","\ud83d\udd13 Odemyk\xe1m stornovanou objedn\xe1vku ID: ".concat(qn.id));const e=(qn.stav_workflow_kod||"").split(",").filter(e=>"ZRUSENA"!==e.trim()).join(","),n=(0,t.A)((0,t.A)({},qn),{},{stav_workflow_kod:e,storno_duvod:null,storno_user_id:null,dt_storno:null,stav_stornovano:0});await na.unlockSection("storno"),Xn(n),ma(),Ic("info","UNLOCK","cancelled","\u2705 Stornovan\xe1 objedn\xe1vka odem\u010dena, workflow refresh dokon\u010den")},onClose:()=>pr(!1),children:[(0,fe.jsx)("p",{children:"Opravdu chcete odemknout stornovanou objedn\xe1vku?"}),(0,fe.jsxs)("p",{style:{marginTop:"0.5rem",color:"#16a34a"},children:[(0,fe.jsx)("strong",{children:"\u26a0\ufe0f UPOZORN\u011aN\xcd:"})," Objedn\xe1vka bude odem\u010dena a zp\u0159\xedstupn\u011bna pro dal\u0161\xed pr\u016fb\u011bh workflow."]}),(0,fe.jsx)("p",{style:{marginTop:"0.5rem"},children:"Budete moci prov\xe9st pot\u0159ebn\xe9 \xfapravy nebo opravy."})]}),xo.isOpen&&(0,fe.jsx)(ve.A,{isOpen:xo.isOpen,title:xo.title,message:xo.message,confirmText:"Ano, odemknout",cancelText:"Zru\u0161it",variant:"danger",icon:u.zpE,onConfirm:()=>{xo.onConfirm&&xo.onConfirm(),jo({isOpen:!1,title:"",message:"",onConfirm:null})},onClose:()=>jo({isOpen:!1,title:"",message:"",onConfirm:null})}),(0,fe.jsx)(Ue,{isOpen:Rt,onClose:()=>{Vt(!1),Mt(null)},onSave:async function(e,n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{let o,t;"personal"===n?(o=we,t=""):"usek"===n?(o=0,t=a||[]):(o=0,t="");const i={nazev:e.nazev||e.dodavatel_nazev||"",adresa:e.adresa||e.dodavatel_adresa||"",ico:e.ico||e.dodavatel_ico||"",dic:e.dic||e.dodavatel_dic||"",zastoupeny:e.zastoupeny||e.dodavatel_zastoupeny||"",kontakt_jmeno:e.kontakt_jmeno||e.dodavatel_kontakt_jmeno||"",kontakt_email:e.kontakt_email||e.dodavatel_kontakt_email||"",kontakt_telefon:e.kontakt_telefon||e.dodavatel_kontakt_telefon||"",user_id:o,usek_zkr:t};let r;null!==Ft&&void 0!==Ft&&Ft.exists&&n===Ft.scope?(r=await(0,me.aj)({token:Ee,username:Se,user_id:o,usek_zkr:t,ico:i.ico,nazev:i.nazev,adresa:i.adresa,dic:i.dic,zastoupeny:i.zastoupeny,kontakt_jmeno:i.kontakt_jmeno,kontakt_email:i.kontakt_email,kontakt_telefon:i.kontakt_telefon}),null===ze||void 0===ze||ze("Dodavatel byl \xfasp\u011b\u0161n\u011b aktualizov\xe1n v adres\xe1\u0159i","success")):(r=await(0,me.jx)({token:Ee,username:Se,user_id:o,usek_zkr:t,nazev:i.nazev,adresa:i.adresa,ico:i.ico,dic:i.dic,zastoupeny:i.zastoupeny,kontakt_jmeno:i.kontakt_jmeno,kontakt_email:i.kontakt_email,kontakt_telefon:i.kontakt_telefon}),null===ze||void 0===ze||ze("Dodavatel byl \xfasp\u011b\u0161n\u011b p\u0159id\xe1n do adres\xe1\u0159e","success")),Ko([]),Vt(!1),Mt(null)}catch(o){throw new Error(o.message||"Chyba p\u0159i ukl\xe1d\xe1n\xed dodavatele do datab\xe1ze")}},supplierData:{dodavatel_nazev:qn.dodavatel_nazev,dodavatel_adresa:qn.dodavatel_adresa,dodavatel_ico:qn.dodavatel_ico,dodavatel_dic:qn.dodavatel_dic,dodavatel_zastoupeny:qn.dodavatel_zastoupeny,dodavatel_kontakt_jmeno:qn.dodavatel_kontakt_jmeno,dodavatel_kontakt_email:qn.dodavatel_kontakt_email,dodavatel_kontakt_telefon:qn.dodavatel_kontakt_telefon},existsInPersonal:(null===Ft||void 0===Ft?void 0:Ft.existsInPersonal)||null,existsInUsek:(null===Ft||void 0===Ft?void 0:Ft.existsInUsek)||null,existsInGlobal:(null===Ft||void 0===Ft?void 0:Ft.existsInGlobal)||null,userPermissions:{canAddPersonal:Oe&&(Oe("CONTACT_MANAGE")||Oe("CONTACT_EDIT")),canAddUsek:Oe&&(Oe("CONTACT_MANAGE")||Oe("CONTACT_EDIT")),canAddGlobal:Oe&&Oe("CONTACT_MANAGE")}}),Oe("HELPER_VIEW")&&(0,fe.jsx)(Ze.A,{pageContext:"orderDetail"}),Bt&&(0,fe.jsx)(Co.DocxGeneratorModal,{order:Ht,isOpen:Bt,onClose:Wp}),Dn&&(0,fe.jsx)(Jo,{order:qn,onConfirm:async e=>{console.log("\ud83d\udccb [handleConfirmCompletion] Modal se zav\u0159el, pokra\u010dujem..."),Tn(!1),Pn(!0);try{console.log("\ud83d\udccb Nahr\xe1v\xe1m PDF..."),await(0,La.Fg)(qn.id,e,Se,Ee,"KOSILKA","fk-"),console.log("\ud83d\udccb Spou\u0161t\xedm save s p\u0159esko\u010den\xedm finan\u010dn\xed kontroly..."),await Jc(!0),console.log("\ud83d\udccb P\u0159ena\u010d\xedt\xe1m p\u0159\xedlohy..."),await _p(),console.log("\ud83d\udccb Hotovo!"),ze&&ze("\u2705 Objedn\xe1vka dokon\u010dena a finan\u010dn\xed kontrola ulo\u017eena",{type:"success"})}catch(n){console.error("\u274c Chyba:",n),ze&&ze("Chyba: ".concat(n.message||n),{type:"error"})}finally{Pn(!1)}},onCancel:()=>{try{Tn(!1),Pn(!1),Xn(e=>(0,t.A)((0,t.A)({},e),{},{potvrzeni_dokonceni_objednavky:0})),ze&&ze("\u2139\ufe0f Dokon\u010den\xed bylo zru\u0161eno, zm\u011bny nebyly ulo\u017eeny",{type:"info"})}catch(e){console.error("Chyba p\u0159i zru\u0161en\xed dokon\u010den\xed:",e)}},generatedBy:{fullName:Ae?"".concat(Ae.titul_pred||""," ").concat(Ae.jmeno||""," ").concat(Ae.prijmeni||""," ").concat(Ae.titul_za||"").trim():Se,position:(null===Ae||void 0===Ae?void 0:Ae.pozice_nazev)||"U\u017eivatel"},token:Ee,username:Se}),(gt||Qt)&&(0,fe.jsx)(tl,{$visible:!0})]});return rn?s.createPortal(du,document.body):du}const Oc=r.memo(Nc),Dc=l.A.div(Ss||(Ss=(0,i.A)(["\n  position: relative;\n  width: 100%;\n"]))),Tc=l.A.button(Es||(Es=(0,i.A)(["\n  width: 100%;\n  min-height: 2.5rem;\n  padding: 0.75rem 3rem 0.75rem ",";\n  background: white;\n  border: 2px solid ",";\n  border-radius: 8px;\n  font-size: 0.875rem;\n  text-align: left;\n  cursor: ",";\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  font-family: inherit;\n  font-weight: ",";\n  color: ",";\n\n  &:hover:not(:disabled) {\n    border-color: ",";\n  }\n\n  &:focus {\n    outline: none;\n    border-color: ",";\n    box-shadow: 0 0 0 3px ",";\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    cursor: not-allowed;\n  }\n\n  /* Chevron ikona */\n  &::after {\n    content: '';\n    position: absolute;\n    right: 12px;\n    top: 50%;\n    transform: translateY(-50%) rotate(",");\n    width: 0;\n    height: 0;\n    border-left: 4px solid transparent;\n    border-right: 4px solid transparent;\n    border-top: 4px solid #6b7280;\n    transition: transform 0.2s ease;\n  }\n"])),e=>e.hasIcon?"3rem":"1rem",e=>e.hasError?"#dc2626":e.isOpen?"#3b82f6":"#e5e7eb",e=>e.disabled?"not-allowed":"pointer",e=>e.disabled?"400":e.hasValue?"600":"400",e=>e.disabled?"#9ca3af":e.hasValue?"#1f2937":"#6b7280",e=>e.hasError?"#dc2626":"#3b82f6",e=>e.hasError?"#dc2626":"#3b82f6",e=>e.hasError?"rgba(220, 38, 38, 0.1)":"rgba(59, 130, 246, 0.1)",e=>e.isOpen?"180deg":"0deg"),Ic=l.A.div(Cs||(Cs=(0,i.A)(["\n  position: fixed;\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n  max-height: 300px;\n  overflow-y: auto;\n  z-index: 4000;\n  min-width: 200px;\n\n  /* Optimalizace pro plynul\xe9 scrollov\xe1n\xed */\n  scroll-behavior: smooth;\n  overscroll-behavior: contain;\n\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #f8f9fa;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background: #9ca3af;\n  }\n"]))),Pc=l.A.div(Ns||(Ns=(0,i.A)(["\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  padding: 0.5rem;\n  border-bottom: 1px solid #f3f4f6;\n  background: #f8f9fa;\n"]))),Lc=l.A.input(Os||(Os=(0,i.A)(["\n  width: 100%;\n  padding: 0.5rem 0.75rem 0.5rem 2.5rem;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  font-size: 0.875rem;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n  }\n"]))),Rc=l.A.div(Ds||(Ds=(0,i.A)(["\n  position: absolute;\n  left: 1rem;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #9ca3af;\n  pointer-events: none;\n"]))),Vc=l.A.div(Ts||(Ts=(0,i.A)(["\n  padding: ",";\n  cursor: ",";\n  font-size: 0.875rem;\n  color: ",";\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  background: ",";\n  border-left: ",";\n  border-bottom: ",";\n  font-weight: "," !important; /* Bold jen pro vybranou mo\u017enost */\n  /* Focusable pro tab navigaci */\n  outline: none;\n\n  &:hover {\n    background: ",";\n    font-weight: ",' !important; /* Z\u016fst\xe1v\xe1 stejn\xe9 i p\u0159i hover */\n  }\n\n  &:focus {\n    background: #dbeafe;\n    box-shadow: inset 0 0 0 2px #3b82f6;\n  }\n\n  &:last-child {\n    border-bottom-left-radius: 8px;\n    border-bottom-right-radius: 8px;\n  }\n\n  input[type="checkbox"] {\n    margin: 0;\n    cursor: pointer;\n  }\n\n  span {\n    padding-left: ',"px;\n    font-weight: "," !important; /* Bold jen pro vybranou mo\u017enost */\n  }\n"])),e=>0===e.level?"0.75rem 1rem":"0.5rem 1rem 0.5rem 2rem",e=>e.isHeader?"default":"pointer",e=>0===e.level?"#111827":"#4b5563",e=>e.isHeader?"#f9fafb":e.selected?"#eff6ff":"white",e=>e.selected?"3px solid #3b82f6":"3px solid transparent",e=>0===e.level?"1px solid #e5e7eb":"none",e=>e.selected?"600":"400",e=>e.isHeader?"#f3f4f6":e.selected?"#dbeafe":"#f8fafc",e=>e.selected?"600":"400",e=>20*(e.level||0),e=>e.selected?"600":"400"),Fc=l.A.span(Is||(Is=(0,i.A)(["\n  flex: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n"]))),Mc=e=>e?e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"",Uc=r.memo(e=>{let{value:n,onChange:a,onBlur:o,options:t=[],placeholder:i="Vyberte...",disabled:s=!1,hasError:d=!1,required:l=!1,field:c,loading:p=!1,loadingText:u="Na\u010d\xedt\xe1n\xed...",icon:v=null,multiple:_=!1,isClearable:m=!1,getOptionLabel:f,getOptionValue:h,hasTriedToSubmit:k=!1}=e;const[b,y]=(0,r.useState)(!1),[x,j]=(0,r.useState)(""),[z,A]=(0,r.useState)(0),S=(0,r.useRef)(null),E=(0,r.useRef)(null),C=(0,r.useRef)(null),N=(0,r.useRef)(null),O=(0,r.useRef)(!1),D=_?Array.isArray(n)?n:[]:n,T=(0,r.useMemo)(()=>{if(!x||p)return t;const e=Mc(x);return t.filter(n=>{let a;a=f?f(n,c):"strediska"===c||"strediska_kod"===c?n.label||n.name||n.nazev_stavu||String(n):"lp_kod"===c?n.cislo_lp?"".concat(n.cislo_lp," - ").concat(n.nazev_uctu||""):n.label||String(n):n.label||n.nazev||n.name||String(n);return Mc(a).includes(e)})},[t,x,p,f,c]),I=(0,r.useMemo)(()=>{if(_){if(0===D.length)return i;return D.map(e=>{const n=t.find(n=>(h?h(n,c):n.id||n.value||n.kod_stavu||n.kod||n)==e);return n?f?f(n,c):"strediska"===c||"strediska_kod"===c?n.label||n.name||n.nazev_stavu||String(n):"lp_kod"===c?n.label||(n.cislo_lp?"".concat(n.cislo_lp," - ").concat(n.nazev_uctu||""):String(n)):n.label||n.nazev||n.name||String(n):String(e)}).join(", ")}{if(!D)return i;const e=t.find(e=>(h?h(e,c):e.id||e.value||e.kod_stavu||e.kod||e)==D);return e?f?f(e,c):e.label||e.nazev||e.name||String(e):"prikazce"!==c&&"schvalovatel"!==c||0!==D&&null!==D&&"0"!==D?String(D):"Nezn\xe1m\xfd"}},[D,t,i,_,f,h,c]);(0,r.useEffect)(()=>{const e=e=>{S.current&&!S.current.contains(e.target)&&(y(!1),j(""))};if(b)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[b]),(0,r.useEffect)(()=>{b&&N.current&&T.length>0&&setTimeout(()=>{var e;return null===(e=N.current)||void 0===e?void 0:e.focus()},100)},[b,T.length]),(0,r.useEffect)(()=>{if(!S.current)return;const e=()=>{var e;(null===(e=S.current)||void 0===e?void 0:e.hasAttribute("data-voice-input"))&&!O.current&&(O.current=!0)};e(),x&&e()},[x,c]),(0,r.useEffect)(()=>{if(b&&x&&1===T.length&&!_&&O.current){const e=setTimeout(()=>{const e=T[0],n=h?h(e,c):e.id||e.value||e;D!==n&&(a(n),o&&o(c,n),y(!1),j(""),O.current=!1,S.current&&S.current.removeAttribute("data-voice-input"))},500);return()=>clearTimeout(e)}},[b,x,T,_,h,c,D,a,o]),(0,r.useEffect)(()=>{if(b&&E.current&&C.current){const e=()=>{if(!E.current||!C.current)return;const e=E.current.getBoundingClientRect(),n=C.current,a=window.innerHeight-e.bottom-54-20,o=e.top-20,t=a<200||a<300&&o>a+50;n.style.left=e.left+"px",n.style.width=e.width+"px",n.style.maxHeight="300px",t?(n.style.bottom=window.innerHeight-e.top+2+"px",n.style.top="auto"):(n.style.top=e.bottom+2+"px",n.style.bottom="auto")};e();const n=n=>{C.current&&!C.current.contains(n.target)&&e()};return window.addEventListener("scroll",n,{passive:!0,capture:!0}),window.addEventListener("resize",e,{passive:!0}),()=>{window.removeEventListener("scroll",n,{capture:!0}),window.removeEventListener("resize",e)}}},[b]),(0,r.useEffect)(()=>{C.current&&z>0&&(C.current.scrollTop=z)},[T,z]);const P=e=>{C.current&&A(C.current.scrollTop);const n=h?h(e,c):e.id||e.value||e;if(_){const e=Array.isArray(D)?D:[],t=e.includes(n)?e.filter(e=>e!==n):[...e,n];a(t),o&&o(c,t)}else a(n),o&&o(c,n),y(!1),j(""),O.current=!1,S.current&&S.current.removeAttribute("data-voice-input")},L=_?Array.isArray(D)&&D.length>0:!!D,R=d||l&&!L&&!p&&!s&&k;return(0,fe.jsxs)(Dc,{ref:S,"data-stable-select":!0,"data-field":c,children:[(0,fe.jsxs)(Tc,{ref:E,type:"button",onClick:()=>{if(s)return;y(!b),b&&j("")},disabled:s,hasError:R,isOpen:b,hasValue:L,hasIcon:!!v,"data-field":c,children:[v&&(0,fe.jsx)("span",{style:{position:"absolute",left:"12px",color:"#9ca3af",width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:r.cloneElement(v,{size:16})}),(0,fe.jsx)(Fc,{title:I,children:(()=>{if("druh_objednavky_kod"===c&&D){const e=t.find(e=>(h?h(e,c):e.id||e.value||e.kod_stavu||e.kod||e)==D);if(e&&(1===e.atribut_objektu||"1"===e.atribut_objektu)){const e=I.replace("   (majetek)","");return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)("span",{children:e}),(0,fe.jsx)("span",{style:{marginLeft:"8px",fontSize:"0.75rem",color:"#dc2626",fontWeight:"500",padding:"2px 6px",backgroundColor:"#fee2e2",borderRadius:"4px",border:"1px solid #fca5a5"},children:"(majetek)"})]})}}return I})()}),m&&!s&&L&&(0,fe.jsx)("span",{role:"button",tabIndex:0,onClick:e=>{e.stopPropagation();a(_?[]:"")},onKeyDown:e=>{if("Enter"===e.key||" "===e.key){e.preventDefault(),e.stopPropagation();a(_?[]:"")}},title:"Smazat hodnotu",style:{position:"absolute",right:"32px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",padding:"4px",cursor:"pointer",color:"#6b7280",display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px",borderRadius:"4px",transition:"all 0.2s ease",zIndex:2},onMouseEnter:e=>{e.currentTarget.style.background="#f3f4f6",e.currentTarget.style.color="#374151"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="#6b7280"},children:(0,fe.jsx)(w.A,{size:14})})]}),b&&!s&&(0,fe.jsxs)(Ic,{ref:C,children:[(0,fe.jsxs)(Pc,{children:[(0,fe.jsx)(Rc,{children:(0,fe.jsx)(g.A,{size:16})}),(0,fe.jsx)(Lc,{ref:N,type:"text",placeholder:"Vyhledat...",value:x,onChange:e=>{e.nativeEvent.inputType&&e.nativeEvent.inputType.startsWith("insert")&&(O.current=!1),j(e.target.value)},onClick:e=>e.stopPropagation(),onKeyDown:e=>{if("ArrowDown"===e.key){if(e.preventDefault(),T.length>0){var n;const e=null===(n=C.current)||void 0===n?void 0:n.querySelector('[role="option"]:not([tabindex="-1"])');e&&e.focus()}}else if("ArrowUp"===e.key){if(e.preventDefault(),T.length>0){var a;const e=Array.from((null===(a=C.current)||void 0===a?void 0:a.querySelectorAll('[role="option"]:not([tabindex="-1"])'))||[]),n=e[e.length-1];n&&n.focus()}}else if("Tab"===e.key)if(T.length>0){var o;e.preventDefault();const n=null===(o=C.current)||void 0===o?void 0:o.querySelector('[role="option"], [class*="SelectOption"]');n&&n.focus()}else y(!1);else"Escape"===e.key?(e.preventDefault(),y(!1),E.current&&E.current.focus()):"Enter"===e.key&&(e.preventDefault(),e.stopPropagation())}})]}),p?(0,fe.jsx)(Vc,{children:u}):T.length>0?T.map((e,n)=>{const a=h?h(e,c):e.id||e.value||e;let o;o=f?f(e,c):"strediska"===c||"strediska_kod"===c?e.label||e.name||e.nazev_stavu||String(e):"lp_kod"===c?e.cislo_lp?"".concat(e.cislo_lp," - ").concat(e.nazev_uctu||""):e.label||String(e):e.label||e.nazev||e.name||String(e);const t=(e=>{const n=h?h(e,c):e.id||e.value||e;return _?D.includes(n):D===n})(e),i=e.level||0,r=e.isHeader||0===i&&!e.value&&!e.id,s="druh_objednavky_kod"===c&&(1===e.atribut_objektu||"1"===e.atribut_objektu);return(0,fe.jsxs)(Vc,{selected:t,level:i,isHeader:r,tabIndex:r?-1:0,role:"option","aria-selected":t,onClick:n=>{n.preventDefault(),n.stopPropagation(),r||P(e)},onKeyDown:n=>{if("Enter"===n.key||" "===n.key)n.preventDefault(),r||P(e);else if("ArrowDown"===n.key){var a;n.preventDefault();const e=Array.from((null===(a=C.current)||void 0===a?void 0:a.querySelectorAll('[role="option"]:not([tabindex="-1"])'))||[]),t=e.indexOf(n.target)+1;var o;if(t<e.length)e[t].focus();else null===(o=e[0])||void 0===o||o.focus()}else if("ArrowUp"===n.key){var t;n.preventDefault();const e=Array.from((null===(t=C.current)||void 0===t?void 0:t.querySelectorAll('[role="option"]:not([tabindex="-1"])'))||[]),a=e.indexOf(n.target)-1;var i;if(a>=0)e[a].focus();else if(N.current)N.current.focus();else null===(i=e[e.length-1])||void 0===i||i.focus()}else if("Escape"===n.key)n.preventDefault(),y(!1),E.current&&E.current.focus();else if("Tab"===n.key){var s;const e=Array.from((null===(s=C.current)||void 0===s?void 0:s.querySelectorAll('[role="option"]:not([tabindex="-1"])'))||[]),a=e.indexOf(n.target);n.shiftKey?0===a&&(n.preventDefault(),N.current&&N.current.focus()):a===e.length-1&&(n.preventDefault(),y(!1))}},children:[_&&!r&&(0,fe.jsx)("input",{type:"checkbox",checked:t,readOnly:!0,onChange:()=>{}}),s?(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)("span",{children:o.replace("   (majetek)","")}),(0,fe.jsx)("span",{style:{marginLeft:"8px",fontSize:"0.75rem",color:"#dc2626",fontWeight:"500",padding:"2px 6px",backgroundColor:"#fee2e2",borderRadius:"4px",border:"1px solid #fca5a5"},children:"(majetek)"})]}):(0,fe.jsx)("span",{children:o})]},a||n)}):(0,fe.jsx)(Vc,{children:"\u017d\xe1dn\xe9 v\xfdsledky"})]})]})},(e,n)=>e.value===n.value&&(e.placeholder===n.placeholder&&(e.disabled===n.disabled&&(e.hasError===n.hasError&&(e.required===n.required&&(e.field===n.field&&(e.loading===n.loading&&(e.loadingText===n.loadingText&&(e.multiple===n.multiple&&(e.hasTriedToSubmit===n.hasTriedToSubmit&&(e.options.length===n.options.length&&(e.options===n.options&&(e.icon===n.icon&&(e.onChange===n.onChange&&(e.onBlur===n.onBlur&&(e.getOptionLabel===n.getOptionLabel&&e.getOptionValue===n.getOptionValue))))))))))))))))},35087:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},35327:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},50516:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},54153:(e,n,a)=>{function o(e){if(!e||"string"!==typeof e)return e||"Nezn\xe1m\xe1 chyba";if(e.includes("timeout")&&e.includes("exceeded")){const n=e.match(/timeout of (\d+)ms exceeded/);if(n){const e=n[1],a=Math.round(e/1e3);return"P\u0159ekro\u010den \u010dasov\xfd limit ".concat(a,"s - server neodpov\u011bd\u011bl v\u010das")}return"P\u0159ekro\u010den \u010dasov\xfd limit - server neodpov\u011bd\u011bl v\u010das"}return e.includes("Network Error")?"Chyba s\xedt\u011b - zkontrolujte internetov\xe9 p\u0159ipojen\xed":e.includes("Request failed with status code 500")?"Chyba serveru (k\xf3d 500) - zkuste to znovu pozd\u011bji":e.includes("Request failed with status code 404")?"Po\u017eadovan\xfd zdroj nebyl nalezen (k\xf3d 404)":e.includes("Request failed with status code 403")?"Nem\xe1te opr\xe1vn\u011bn\xed k t\xe9to operaci (k\xf3d 403)":e.includes("Request failed with status code 401")?"Neautorizovan\xfd p\u0159\xedstup - zkuste se znovu p\u0159ihl\xe1sit (k\xf3d 401)":e.includes("ECONNREFUSED")||e.includes("connection refused")?"Nelze se p\u0159ipojit k serveru - server je pravd\u011bpodobn\u011b nedostupn\xfd":e.includes("ENOTFOUND")||e.includes("getaddrinfo ENOTFOUND")?"Server nenalezen - zkontrolujte adresu serveru":e}function t(e){if(!e||"string"!==typeof e)return e||"Nezn\xe1m\xe1 chyba";if(e.includes("timeout")&&e.includes("exceeded")){const n=e.match(/timeout of (\d+)ms exceeded/);if(n){const e=n[1],a=Math.round(e/1e3);return"P\u0159ekro\u010den \u010dasov\xfd limit ".concat(a,"s")}return"P\u0159ekro\u010den \u010dasov\xfd limit"}return o(e)}a.d(n,{E:()=>o,g:()=>t})},65727:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},71360:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},87260:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]])},91286:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]])},92382:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},99432:(e,n,a)=>{a.d(n,{A:()=>o});const o=(0,a(77784).A)("coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]])}}]);
//# sourceMappingURL=3085.475065c6.chunk.js.map