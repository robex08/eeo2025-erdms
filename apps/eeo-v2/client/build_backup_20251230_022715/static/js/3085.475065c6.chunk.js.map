{"version":3,"file":"static/js/3085.475065c6.chunk.js","mappings":";+HAGO,MAkBDA,GAAQC,E,SAAAA,GAAiB,QAlBK,CAClC,CAAC,OAAQ,CAAEC,EAAG,4CAA6CC,IAAK,WAChE,CAAC,OAAQ,CAAED,EAAG,8BAA+BC,IAAK,WAClD,CAAC,OAAQ,CAAED,EAAG,6BAA8BC,IAAK,WACjD,CAAC,SAAU,CAAEC,GAAI,IAAKC,GAAI,IAAKC,EAAG,IAAKH,IAAK,W,mCCJvC,MAgBDI,GAAON,E,SAAAA,GAAiB,OAhBM,CAClC,CAAC,OAAQ,CAAEC,EAAG,4CAA6CC,IAAK,WAChE,CAAC,SAAU,CAAEC,GAAI,KAAMC,GAAI,IAAKC,EAAG,IAAKH,IAAK,Y,mCCFxC,MAsBDK,GAASP,E,SAAAA,GAAiB,UAtBI,CAClC,CACE,OACA,CACEC,EAAG,uGACHC,IAAK,WAGT,CAAC,SAAU,CAAEC,GAAI,KAAMC,GAAI,KAAMC,EAAG,IAAKH,IAAK,Y,sQCRzC,MAgBDM,GAAWR,EAAAA,EAAAA,GAAiB,YAhBE,CAClC,CAAC,OAAQ,CAAES,MAAO,KAAMC,OAAQ,KAAMC,EAAG,IAAKC,EAAG,KAAMC,GAAI,IAAKC,GAAI,IAAKZ,IAAK,WAC9E,CAAC,OAAQ,CAAED,EAAG,0BAA2BC,IAAK,a,4HCFzC,MAuBDa,GAAef,EAAAA,EAAAA,GAAiB,gBAvBF,CAClC,CAAC,SAAU,CAAEG,GAAI,IAAKC,GAAI,KAAMC,EAAG,IAAKH,IAAK,WAC7C,CAAC,SAAU,CAAEC,GAAI,KAAMC,GAAI,KAAMC,EAAG,IAAKH,IAAK,WAC9C,CACE,OACA,CACED,EAAG,mFACHC,IAAK,a,0BCPJ,MAgBDc,GAAOhB,EAAAA,EAAAA,GAAiB,OAhBM,CAClC,CAAC,OAAQ,CAAES,MAAO,KAAMC,OAAQ,KAAMC,EAAG,IAAKC,EAAG,IAAKC,GAAI,IAAKC,GAAI,IAAKZ,IAAK,WAC7E,CAAC,OAAQ,CAAED,EAAG,0DAA2DC,IAAK,a,iKCIhF,MAAMe,GAAgBC,EAAAA,EAAOC,IAAGC,IAAAA,GAAAC,EAAAA,EAAAA,GAAA,iUAmB1BC,GAAkBJ,EAAAA,EAAOC,IAAGI,IAAAA,GAAAF,EAAAA,EAAAA,GAAA,qbAwB5BG,GAAeN,EAAAA,EAAOC,IAAGM,IAAAA,GAAAJ,EAAAA,EAAAA,GAAA,iOAUzBK,GAAcR,EAAAA,EAAOS,GAAEC,IAAAA,GAAAP,EAAAA,EAAAA,GAAA,+JAavBQ,GAAcX,EAAAA,EAAOY,OAAMC,IAAAA,GAAAV,EAAAA,EAAAA,GAAA,+TAkB3BW,GAAgBd,EAAAA,EAAOC,IAAGc,IAAAA,GAAAZ,EAAAA,EAAAA,GAAA,6DAM1Ba,GAAUhB,EAAAA,EAAOC,IAAGgB,IAAAA,GAAAd,EAAAA,EAAAA,GAAA,iQACVe,GACO,WAAfA,EAAMC,KAA0B,UACjB,eAAfD,EAAMC,KAA8B,UACrB,kBAAfD,EAAMC,KAAiC,UACpC,UAEWD,GACC,WAAfA,EAAMC,KAA0B,UACjB,eAAfD,EAAMC,KAA8B,UACrB,kBAAfD,EAAMC,KAAiC,UACpC,UAYED,GACY,WAAfA,EAAMC,KAA0B,UACjB,eAAfD,EAAMC,KAA8B,UACrB,kBAAfD,EAAMC,KAAiC,UACpC,WAKPC,GAAWpB,EAAAA,EAAOC,IAAGoB,IAAAA,GAAAlB,EAAAA,EAAAA,GAAA,kOAkBrBmB,GAActB,EAAAA,EAAOC,IAAGsB,IAAAA,GAAApB,EAAAA,EAAAA,GAAA,kCAIxBqB,GAAexB,EAAAA,EAAOyB,GAAEC,IAAAA,GAAAvB,EAAAA,EAAAA,GAAA,qJASxBwB,GAAU3B,EAAAA,EAAOC,IAAG2B,IAAAA,GAAAzB,EAAAA,EAAAA,GAAA,gGAECe,GAASA,EAAMW,SAAW,OAK/CC,GAAY9B,EAAAA,EAAOC,IAAG8B,IAAAA,GAAA5B,EAAAA,EAAAA,GAAA,oEAMtB6B,GAAQhC,EAAAA,EAAOiC,MAAKC,IAAAA,GAAA/B,EAAAA,EAAAA,GAAA,qIAQtBe,GAASA,EAAMiB,UAAQ,mGASrBC,GAAgBpC,EAAAA,EAAOC,IAAGoC,IAAAA,GAAAlC,EAAAA,EAAAA,GAAA,0NAe1BmC,GAAQtC,EAAAA,EAAOuC,MAAKC,IAAAA,GAAArC,EAAAA,EAAAA,GAAA,2UAEEe,GAASA,EAAMuB,QAAU,OAAS,OACxCvB,GAASA,EAAMwB,SAAW,UAAY,UAI5CxB,GAASA,EAAMyB,SAAW,UAAY,QAC3CzB,GAASA,EAAMyB,SAAW,UAAY,UAI7BzB,GAASA,EAAMwB,SAAW,UAAY,UAC9BxB,GAASA,EAAMwB,SAAW,sBAAwB,wBAQxEE,GAAgB5C,EAAAA,EAAOC,IAAG4C,IAAAA,GAAA1C,EAAAA,EAAAA,GAAA,wGAEEe,GAASA,EAAM4B,cAK3CC,GAAc/C,EAAAA,EAAOY,OAAMoC,KAAAA,IAAA7C,EAAAA,EAAAA,GAAA,sbAEXe,GAASA,EAAM+B,SAAW,UAAY,UAE5C/B,GAASA,EAAM+B,SAAW,oDAAsD,QACrF/B,GAASA,EAAM+B,SAAW,QAAU,UACnC/B,GAASA,EAAMyB,SAAW,cAAgB,UACzCzB,GAASA,EAAMyB,SAAW,GAAM,EAY3BzB,GAASA,EAAM+B,SAAW,oDAAsD,WAQ5FC,GAAoBlD,EAAAA,EAAOC,IAAGkD,KAAAA,IAAAhD,EAAAA,EAAAA,GAAA,sUAIpBe,GAAyB,WAAhBA,EAAMkC,MAAqB,UAA6B,SAAhBlC,EAAMkC,MAAmB,UAAY,WAgBhGC,GAAWrD,EAAAA,EAAOC,IAAGqD,KAAAA,IAAAnD,EAAAA,EAAAA,GAAA,8HAOrBoD,GAAWvD,EAAAA,EAAOiC,MAAKuB,KAAAA,IAAArD,EAAAA,EAAAA,GAAA,+eAMPe,GAASA,EAAM+B,SAAW,UAAY,UAE5C/B,GAASA,EAAM+B,SAAW,4BAA8B,QAC5D/B,GAASA,EAAMyB,SAAW,cAAgB,UACzCzB,GAASA,EAAMyB,SAAW,GAAM,EAIlCzB,GAASA,EAAM+B,SAAW,UAAY,UAUnC/B,GAASA,EAAMyB,SAAW,cAAgB,WAWlDc,IAPWzD,EAAAA,EAAOC,IAAGyD,KAAAA,IAAAvD,EAAAA,EAAAA,GAAA,gFAOVH,EAAAA,EAAO2D,KAAIC,KAAAA,IAAAzD,EAAAA,EAAAA,GAAA,mDAUtB0D,IALW7D,EAAAA,EAAO2D,KAAIG,KAAAA,IAAA3D,EAAAA,EAAAA,GAAA,iDAKVH,EAAAA,EAAO2D,KAAII,KAAAA,IAAA5D,EAAAA,EAAAA,GAAA,sEAMvB6D,GAAehE,EAAAA,EAAOC,IAAGgE,KAAAA,IAAA9D,EAAAA,EAAAA,GAAA,yJASzB+D,GAASlE,EAAAA,EAAOY,OAAMuD,KAAAA,IAAAhE,EAAAA,EAAAA,GAAA,uOAYxBe,GAA2B,YAAlBA,EAAMkD,SAAqB,6SAepClD,GAA2B,cAAlBA,EAAMkD,SAAuB,iLAqiB1C,GA5gB0BC,IASnB,IAToB,OACzBC,EAAM,QACNC,EAAO,OACPC,EAAM,aACNC,EAAY,iBACZC,EAAmB,KAAI,aACvBC,EAAe,KAAI,eACnBC,EAAiB,KAAI,gBACrBC,EAAkB,CAAEC,gBAAgB,EAAMC,YAAY,EAAOC,cAAc,IAC5EX,EACC,MAAM,MAAEY,EAAK,SAAEC,EAAQ,WAAEC,IAAeC,EAAAA,EAAAA,YAAWC,GAAAA,KAC5CC,EAAYC,IAAiBC,EAAAA,EAAAA,UAAS,CAAC,IACvCC,EAAeC,IAAoBF,EAAAA,EAAAA,UAAS,aAC5CG,EAAeC,IAAoBJ,EAAAA,EAAAA,UAAS,KAC5CK,EAAgBC,IAAqBN,EAAAA,EAAAA,UAAS,KAC9CO,EAAcC,IAAmBR,EAAAA,EAAAA,WAAS,IAC1CS,EAAUC,IAAeV,EAAAA,EAAAA,WAAS,IAClCW,EAAQC,IAAaZ,EAAAA,EAAAA,UAAS,CAAC,IAGtCa,EAAAA,EAAAA,WAAU,KACJ/B,GAAUG,IACZc,EAAc,CACZe,MAAO7B,EAAa8B,iBAAmB,GACvCC,OAAQ/B,EAAagC,kBAAoB,GACzCC,IAAKjC,EAAakC,eAAiB,GACnCC,IAAKnC,EAAaoC,eAAiB,GACnCC,WAAYrC,EAAasC,sBAAwB,GACjDC,cAAevC,EAAawC,yBAA2B,GACvDC,cAAezC,EAAa0C,yBAA2B,GACvDC,gBAAiB3C,EAAa4C,2BAA6B,KAKzD3C,EACFgB,EAAiB,YACRf,EACTe,EAAiB,QAERd,GAAkBC,EAAgBG,aAC3CU,EAAiB,UAEjBA,EAAiB,YAGnBU,EAAU,CAAC,KAEZ,CAAC9B,EAAQG,EAAcC,EAAkBC,EAAcC,EAAgBC,EAAgBG,gBAG1FqB,EAAAA,EAAAA,WAAU,KACUiB,WAChB,GAAKhD,GAAWO,EAAgBE,WAEhC,IACEiB,GAAgB,GAChB,MAAMuB,QAAeC,EAAAA,GAAAA,IAAc,CAAEvC,QAAOC,aAC5CY,EAAkByB,GAAU,GAC9B,CAAE,MAAOE,GACT,CAAC,QACCzB,GAAgB,EAClB,GAGF0B,IACC,CAACpD,EAAQO,EAAgBE,WAAYE,EAAOC,KAG/CmB,EAAAA,EAAAA,WAAU,KACR,GAAK/B,EAEL,GAAIK,GAAgBA,EAAagD,SAC/B,IACE,MAAMC,EAA6C,kBAA1BjD,EAAagD,SAClCE,KAAKC,MAAMnD,EAAagD,UACxBhD,EAAagD,SACbI,MAAMC,QAAQJ,IAChBhC,EAAiBgC,EAErB,CAAE,MAAOK,GACT,MAGArC,EAAiB,KAElB,CAACtB,EAAQK,IAEZ,MAAMuD,EAAoBA,CAACC,EAAOC,KAChC7C,EAAc8C,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACbD,GAAI,IACP,CAACF,GAAQC,KAIPjC,EAAOgC,IACT/B,EAAUiC,IACR,MAAME,GAASD,EAAAA,EAAAA,GAAA,GAAQD,GAEvB,cADOE,EAAUJ,GACVI,KAMPC,EAAoBC,IACxB7C,EAAiByC,GACXA,EAAKK,SAASD,GACTJ,EAAKM,OAAOC,GAAOA,IAAQH,GAE3B,IAAIJ,EAAMI,KA6DvB,IAAKnE,EAAQ,OAAO,KAGpB,MAQMuE,EANAnE,GAAoBC,GAAgBC,EAC/B,SAEF,MAuBHkE,EACe,aAAlBrD,GAAgCf,GACd,SAAlBe,GAA4Bd,GACV,WAAlBc,GAA8Bb,EAEjC,OACEmE,EAAAA,GAAAA,KAAChJ,GAAa,CAAAiJ,UACZC,EAAAA,GAAAA,MAAC7I,GAAe,CAAC8I,QAAUjB,GAAMA,EAAEkB,kBAAkBH,SAAA,EACnDC,EAAAA,GAAAA,MAAC3I,GAAY,CAAA0I,SAAA,EACXC,EAAAA,GAAAA,MAACzI,GAAW,CAAAwI,SAAA,EACVD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMC,EAAAA,MACtBR,EAAqB,0BAA4B,iDAEpDC,EAAAA,GAAAA,KAACpI,GAAW,CAACuI,QAAS3E,EAAQyE,UAC5BD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAME,EAAAA,YAI3BN,EAAAA,GAAAA,MAACnI,GAAa,CAAAkI,SAAA,CAEI,QAAfH,IACCI,EAAAA,GAAAA,MAACjI,GAAO,CAACG,KAAK,MAAK6H,SAAA,EACjBD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMC,EAAAA,OACvBL,EAAAA,GAAAA,MAAC7H,GAAQ,CAAA4H,SAAA,EACPD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,uBACRD,EAAAA,GAAAA,KAAA,KAAAC,SAAG,sGAKO,WAAfH,IACCI,EAAAA,GAAAA,MAACjI,GAAO,CAACG,KAAK,aAAY6H,SAAA,EACxBD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMG,EAAAA,OACvBP,EAAAA,GAAAA,MAAC7H,GAAQ,CAAA4H,SAAA,EACPD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,oDACRC,EAAAA,GAAAA,MAAA,KAAAD,SAAA,CAAG,0EAEAtE,GAAoB,sDACpBC,GAAgB,+CAChBC,GAAkB,0DAO3BqE,EAAAA,GAAAA,MAAC3H,GAAW,CAAA0H,SAAA,EACVD,EAAAA,GAAAA,KAACvH,GAAY,CAAAwH,SAAC,4BACdC,EAAAA,GAAAA,MAACrG,GAAa,CAACE,aAAc,EAAEkG,SAAA,EAE7BC,EAAAA,GAAAA,MAAClG,GAAW,CACVE,SAA4B,aAAlBwC,EACVyD,QAASA,IAAMrE,EAAgBC,gBAAkBY,EAAiB,YAClE/C,UAAWkC,EAAgBC,eAAekE,SAAA,CAEzCtE,IACCqE,EAAAA,GAAAA,KAAC7F,GAAiB,CAACE,MAAM,WAAWqG,MAAM,0DAAyCT,UACjFD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMG,EAAAA,SAG3BT,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMK,EAAAA,OACvBX,EAAAA,GAAAA,KAAA,QAAAC,SAAM,kBAIRC,EAAAA,GAAAA,MAAClG,GAAW,CACVE,SAA4B,SAAlBwC,EACVyD,QAASA,IAAMrE,EAAgBE,YAAcW,EAAiB,QAC9D/C,UAAWkC,EAAgBE,WAAWiE,SAAA,CAErCrE,IACCoE,EAAAA,GAAAA,KAAC7F,GAAiB,CAACE,MAAM,OAAOqG,MAAM,wDAAuCT,UAC3ED,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMG,EAAAA,SAG3BT,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMC,EAAAA,OACvBP,EAAAA,GAAAA,KAAA,QAAAC,SAAM,gBAIRC,EAAAA,GAAAA,MAAClG,GAAW,CACVE,SAA4B,WAAlBwC,EACVyD,QAASA,IAAMrE,EAAgBG,cAAgBU,EAAiB,UAChE/C,UAAWkC,EAAgBG,aAAagE,SAAA,CAEvCpE,IACCmE,EAAAA,GAAAA,KAAC7F,GAAiB,CAACE,MAAM,SAASqG,MAAM,+DAA2CT,UACjFD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMG,EAAAA,SAG3BT,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMM,EAAAA,OACvBZ,EAAAA,GAAAA,KAAA,QAAAC,SAAM,4BAMO,SAAlBvD,IACCwD,EAAAA,GAAAA,MAAC3H,GAAW,CAAA0H,SAAA,EACVD,EAAAA,GAAAA,KAACvH,GAAY,CAAAwH,SAAC,gCACbjD,GACCgD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEC,QAAS,OAAQC,UAAW,SAAUC,MAAO,WAAYf,SAAC,mCAG5C,IAA1BnD,EAAemE,QACjBjB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEC,QAAS,OAAQI,WAAY,UAAWC,OAAQ,oBAAqBC,aAAc,MAAOJ,MAAO,WAAYf,SAAC,0DAI5HD,EAAAA,GAAAA,KAAC1F,GAAQ,CAAA2F,UACLnE,EAAgBG,aAAea,EAC/BA,EAAe8C,OAAOyB,IAEJrC,MAAMC,QAAkB,OAAV7C,QAAU,IAAVA,OAAU,EAAVA,EAAYwC,UACtCxC,EAAWwC,SACX,CAAW,OAAVxC,QAAU,IAAVA,OAAU,EAAVA,EAAYwC,WACFe,SAAS0B,EAAKzC,YAE/B0C,IAAKD,IACLnB,EAAAA,GAAAA,MAAC1F,GAAQ,CAEPN,SAAU0C,EAAc+C,SAAS0B,EAAKzC,UACtChF,UAAWkC,EAAgBG,gBACT+C,MAAMC,QAAkB,OAAV7C,QAAU,IAAVA,OAAU,EAAVA,EAAYwC,UACtCxC,EAAWwC,SACX,CAAW,OAAVxC,QAAU,IAAVA,OAAU,EAAVA,EAAYwC,WACDe,SAAS0B,EAAKzC,UAEhCuB,QAASA,KACP,MAAMoB,EAAUvC,MAAMC,QAAkB,OAAV7C,QAAU,IAAVA,OAAU,EAAVA,EAAYwC,UACtCxC,EAAWwC,SACX,CAAW,OAAVxC,QAAU,IAAVA,OAAU,EAAVA,EAAYwC,WACb9C,EAAgBG,cAAgBsF,EAAQ5B,SAAS0B,EAAKzC,YACxDa,EAAiB4B,EAAKzC,WAExBqB,SAAA,EAEFD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,WACLoJ,QAAS5E,EAAc+C,SAAS0B,EAAKzC,UACrC6C,SAAUA,IAAMhC,EAAiB4B,EAAKzC,UACtChF,UAAWkC,EAAgBG,gBACT+C,MAAMC,QAAkB,OAAV7C,QAAU,IAAVA,OAAU,EAAVA,EAAYwC,UACtCxC,EAAWwC,SACX,CAAW,OAAVxC,QAAU,IAAVA,OAAU,EAAVA,EAAYwC,WACDe,SAAS0B,EAAKzC,aAGlCoB,EAAAA,GAAAA,KAACtF,GAAQ,CAAAuF,SAAEoB,EAAKzC,aA5BXyC,EAAKzC,aAiCQ,IAAzBhC,EAAcqE,SAAiBjE,IAC9BgD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEa,UAAW,MAAOZ,QAAS,MAAOI,WAAY,UAAWC,OAAQ,oBAAqBC,aAAc,MAAOO,SAAU,OAAQX,MAAO,WAAYf,SAAC,wGAQrKC,EAAAA,GAAAA,MAAC3H,GAAW,CAAA0H,SAAA,EACVD,EAAAA,GAAAA,KAACvH,GAAY,CAAAwH,SAAC,6BACdD,EAAAA,GAAAA,KAACpH,GAAO,CAACE,QAAQ,MAAKmH,UACpBC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,+BAChBC,EAAAA,GAAAA,MAAC7G,GAAa,CAAA4G,SAAA,EACZD,EAAAA,GAAAA,KAAC4B,EAAAA,EAAQ,KACT5B,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACLiH,MAAO9C,EAAWgB,OAAS,GAC3BkE,SAAWvC,GAAMC,EAAkB,QAASD,EAAE2C,OAAOxC,OACrD1F,WAAYyD,EAAOG,MACnB7D,SAAO,EACPoI,YAAY,2BAGf1E,EAAOG,QAASyC,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAE7C,EAAOG,cAIxC2C,EAAAA,GAAAA,MAACtH,GAAO,CAACE,QAAQ,cAAamH,SAAA,EAC5BC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,YAChBC,EAAAA,GAAAA,MAAC7G,GAAa,CAAA4G,SAAA,EACZD,EAAAA,GAAAA,KAAC1J,EAAAA,EAAM,KACP0J,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACLiH,MAAO9C,EAAWkB,QAAU,GAC5BgE,SAAWvC,GAAMC,EAAkB,SAAUD,EAAE2C,OAAOxC,OACtD1F,WAAYyD,EAAOK,OACnB/D,SAAO,EACPoI,YAAY,uBAGf1E,EAAOK,SAAUuC,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAE7C,EAAOK,aAGvCyC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,cAChBC,EAAAA,GAAAA,MAAC7G,GAAa,CAAA4G,SAAA,EACZD,EAAAA,GAAAA,KAAC+B,EAAAA,EAAI,KACL/B,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACLiH,MAAO9C,EAAWoB,KAAO,GACzB8D,SAAWvC,GAAMC,EAAkB,MAAOD,EAAE2C,OAAOxC,OACnD1F,WAAYyD,EAAOO,IACnBjE,SAAO,EACPoI,YAAY,WACZE,UAAW,OAGd5E,EAAOO,MAAOqC,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAE7C,EAAOO,UAGpCuC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,cACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAAA4G,SAAA,EACZD,EAAAA,GAAAA,KAAC+B,EAAAA,EAAI,KACL/B,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACLiH,MAAO9C,EAAWsB,KAAO,GACzB4D,SAAWvC,GAAMC,EAAkB,MAAOD,EAAE2C,OAAOxC,OACnD3F,SAAO,EACPoI,YAAY,yBAMpB9B,EAAAA,GAAAA,KAACpH,GAAO,CAACE,QAAQ,MAAKmH,UACpBC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,kBACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAAA4G,SAAA,EACZD,EAAAA,GAAAA,KAAC3J,EAAAA,EAAI,KACL2J,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACLiH,MAAO9C,EAAWwB,YAAc,GAChC0D,SAAWvC,GAAMC,EAAkB,aAAcD,EAAE2C,OAAOxC,OAC1D3F,SAAO,EACPoI,YAAY,2CAQtB5B,EAAAA,GAAAA,MAAC3H,GAAW,CAAA0H,SAAA,EACVD,EAAAA,GAAAA,KAACvH,GAAY,CAAAwH,SAAC,wBACdD,EAAAA,GAAAA,KAACpH,GAAO,CAACE,QAAQ,MAAKmH,UACpBC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,iCACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAAA4G,SAAA,EACZD,EAAAA,GAAAA,KAAC3J,EAAAA,EAAI,KACL2J,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACLiH,MAAO9C,EAAW0B,eAAiB,GACnCwD,SAAWvC,GAAMC,EAAkB,gBAAiBD,EAAE2C,OAAOxC,OAC7D3F,SAAO,EACPoI,YAAY,4CAMpB5B,EAAAA,GAAAA,MAACtH,GAAO,CAACE,QAAQ,UAASmH,SAAA,EACxBC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,WACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAAA4G,SAAA,EACZD,EAAAA,GAAAA,KAACiC,EAAAA,EAAI,KACLjC,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,QACLiH,MAAO9C,EAAW4B,eAAiB,GACnCsD,SAAWvC,GAAMC,EAAkB,gBAAiBD,EAAE2C,OAAOxC,OAC7D1F,WAAYyD,EAAOe,cACnBzE,SAAO,EACPoI,YAAY,yBAGf1E,EAAOe,gBAAiB6B,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAE7C,EAAOe,oBAG9C+B,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,aACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAAA4G,SAAA,EACZD,EAAAA,GAAAA,KAACkC,EAAAA,EAAK,KACNlC,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,MACLiH,MAAO9C,EAAW8B,iBAAmB,GACrCoD,SAAWvC,GAAMC,EAAkB,kBAAmBD,EAAE2C,OAAOxC,OAC/D3F,SAAO,EACPoI,YAAY,iCAOrB1E,EAAO+E,UACNnC,EAAAA,GAAAA,KAAClF,GAAS,CAAC+F,MAAO,CAAEuB,QAAS,QAASV,UAAW,OAAQC,SAAU,QAAS1B,SACzE7C,EAAO+E,cAKdjC,EAAAA,GAAAA,MAACjF,GAAY,CAAAgF,SAAA,EACXC,EAAAA,GAAAA,MAAC/E,GAAM,CAACE,QAAQ,YAAY8E,QAAS3E,EAAS5B,SAAUsD,EAAS+C,SAAA,EAC/DD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAME,EAAAA,MAAW,kBAGpCN,EAAAA,GAAAA,MAAC/E,GAAM,CAACE,QAAQ,UAAU8E,QA1Xf5B,UACjB,IAtBmB8D,MAAO,IAADC,EAAAC,EACzB,MAAM/C,EAAY,CAAC,EAiBnB,OAfqB,QAAjB8C,EAAC/F,EAAWgB,aAAK,IAAA+E,GAAhBA,EAAkBE,SACrBhD,EAAUjC,MAAQ,0BAGD,QAAfgF,EAAChG,EAAWoB,WAAG,IAAA4E,GAAdA,EAAgBC,OAET,UAAUC,KAAKlG,EAAWoB,IAAI6E,UACxChD,EAAU7B,IAAM,4CAFhB6B,EAAU7B,IAAM,yBAKdpB,EAAW4B,gBAAkB,6BAA6BsE,KAAKlG,EAAW4B,iBAC5EqB,EAAUrB,cAAgB,qBAG5Bd,EAAUmC,GAC+B,IAAlCkD,OAAOC,KAAKnD,GAAWyB,QAIzBoB,GACH,OAKF,IAAIO,EAAalG,EACbmG,EAAa,KAEK,SAAlBnG,EAC2B,IAAzBE,EAAcqE,QAEhB2B,EAAa,WACbC,EAAa,MAEbA,EAAajG,EAEY,WAAlBF,IAETmG,EAAa,MAGf1F,GAAY,GAEZ,UACQ1B,EAAOc,EAAYqG,EAAYC,GACrCrH,GACF,CAAE,MAAOkD,GACPrB,EAAU,CAAE8E,QAASzD,EAAMoE,SAAW,+CACxC,CAAC,QACC3F,GAAY,EACd,GA0VqDvD,SAAUsD,EAAS+C,SAAA,EAChED,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMyC,EAAAA,MA1UXC,MACpB,GAAI9F,EAAU,MAAO,mBAQrB,MAJqB,aAAlBR,GAAgCf,GACd,SAAlBe,GAA4Bd,GACV,WAAlBc,GAA8Bb,EAGxB,eAGF,0BA8TEmH,e,cCl5BN,MAiBDC,IAAOlN,EAAAA,EAAAA,GAAiB,OAjBM,CAClC,CAAC,OAAQ,CAAEC,EAAG,UAAWC,IAAK,WAC9B,CAAC,OAAQ,CAAED,EAAG,WAAYC,IAAK,WAC/B,CAAC,OAAQ,CAAED,EAAG,WAAYC,IAAK,aCe3BiN,IAAYnN,EAAAA,EAAAA,GAAiB,aAlBC,CAClC,CAAC,OAAQ,CAAEC,EAAG,YAAaC,IAAK,WAChC,CAAC,OAAQ,CAAED,EAAG,YAAaC,IAAK,WAChC,CAAC,OAAQ,CAAED,EAAG,YAAaC,IAAK,WAChC,CAAC,OAAQ,CAAED,EAAG,aAAcC,IAAK,aCc7BkN,IAAYpN,EAAAA,EAAAA,GAAiB,aAlBC,CAClC,CAAC,OAAQ,CAAEC,EAAG,aAAcC,IAAK,WACjC,CAAC,OAAQ,CAAED,EAAG,cAAeC,IAAK,WAClC,CAAC,OAAQ,CAAED,EAAG,YAAaC,IAAK,WAChC,CAAC,OAAQ,CAAED,EAAG,YAAaC,IAAK,aCS5BmN,IAAcrN,EAAAA,EAAAA,GAAiB,eAbD,CAAC,CAAC,OAAQ,CAAEC,EAAG,iBAAkBC,IAAK,aCkBpEoN,IAAWtN,EAAAA,EAAAA,GAAiB,YAlBE,CAClC,CAAC,OAAQ,CAAEC,EAAG,6DAA8DC,IAAK,WACjF,CAAC,OAAQ,CAAED,EAAG,0BAA2BC,IAAK,WAC9C,CAAC,OAAQ,CAAED,EAAG,YAAaC,IAAK,WAChC,CAAC,OAAQ,CAAED,EAAG,gBAAiBC,IAAK,a,gBCJ/B,MAaDqN,IAAQvN,EAAAA,EAAAA,GAAiB,QAbK,CAAC,CAAC,OAAQ,CAAEC,EAAG,WAAYC,IAAK,aCa9DsN,IAAexN,EAAAA,EAAAA,GAAiB,gBAbF,CAAC,CAAC,OAAQ,CAAEC,EAAG,gBAAiBC,IAAK,aCiBnEuN,IAASzN,EAAAA,EAAAA,GAAiB,SAjBI,CAClC,CAAC,OAAQ,CAAEC,EAAG,WAAYC,IAAK,WAC/B,CAAC,OAAQ,CAAED,EAAG,gBAAiBC,IAAK,WACpC,CAAC,OAAQ,CAAED,EAAG,4CAA6CC,IAAK,a,yECClE,MAAMwN,GAAoBxM,EAAAA,EAAOC,IAAGC,KAAAA,IAAAC,EAAAA,EAAAA,GAAA,6XAG1Be,GAASA,EAAMuL,OAAS,IACvBvL,GAASA,EAAMwL,QAAU,QAa9BC,GAAgB3M,EAAAA,EAAOC,IAAGI,KAAAA,IAAAF,EAAAA,EAAAA,GAAA,6LAU1ByM,GAAc5M,EAAAA,EAAO2D,KAAIpD,KAAAA,IAAAJ,EAAAA,EAAAA,GAAA,oEAMzB0M,GAAgB7M,EAAAA,EAAO2D,KAAIjD,KAAAA,IAAAP,EAAAA,EAAAA,GAAA,oEAM3B2M,GAAa9M,EAAAA,EAAOY,OAAMC,KAAAA,IAAAV,EAAAA,EAAAA,GAAA,qJAIpBe,GAASA,EAAMyB,SAAW,cAAgB,UAC3CzB,GAASA,EAAMyB,SAAW,UAAazB,EAAM6L,QAAU,WAO5DC,GAAYhN,EAAAA,EAAOC,IAAGc,KAAAA,IAAAZ,EAAAA,EAAAA,GAAA,+DAKtB8M,GAAajN,EAAAA,EAAOC,IAAGgB,KAAAA,IAAAd,EAAAA,EAAAA,GAAA,2IASvB+M,GAAclN,EAAAA,EAAOuC,MAAKlB,KAAAA,IAAAlB,EAAAA,EAAAA,GAAA,wQAc1BgN,GAAoBnN,EAAAA,EAAOY,OAAMW,KAAAA,IAAApB,EAAAA,EAAAA,GAAA,uOAgBjCiN,GAAepN,EAAAA,EAAOC,IAAGyB,KAAAA,IAAAvB,EAAAA,EAAAA,GAAA,gUAsBzBkN,GAAerN,EAAAA,EAAOC,IAAG2B,KAAAA,IAAAzB,EAAAA,EAAAA,GAAA,8ZAWPe,GAAyB,SAAhBA,EAAMoM,MAAmB,UAAY,UAC7CpM,GAAyB,SAAhBA,EAAMoM,MAAmB,UAAY,WAQjEC,GAAevN,EAAAA,EAAOC,IAAG8B,KAAAA,IAAA5B,EAAAA,EAAAA,GAAA,uCAKzBqN,GAAexN,EAAAA,EAAOC,IAAGiC,KAAAA,IAAA/B,EAAAA,EAAAA,GAAA,+JAUzBsN,GAAgBzN,EAAAA,EAAOC,IAAGoC,KAAAA,IAAAlC,EAAAA,EAAAA,GAAA,+KAU1BuN,GAAkB1N,EAAAA,EAAOC,IAAGuC,KAAAA,IAAArC,EAAAA,EAAAA,GAAA,qEAM5BwN,GAAe3N,EAAAA,EAAOY,OAAMiC,KAAAA,IAAA1C,EAAAA,EAAAA,GAAA,iJAGvBe,GAASA,EAAM6L,QAAU,WAS9Ba,GAAa5N,EAAAA,EAAOY,OAAMoC,KAAAA,IAAA7C,EAAAA,EAAAA,GAAA,gRAKhBe,GAASA,EAAMyB,SAAW,UAAY,UAC3CzB,GAASA,EAAMyB,SAAW,UAAY,UACrCzB,GAASA,EAAMyB,SAAW,cAAgB,UAClCzB,GAASA,EAAMyB,SAAW,OAAS,OAC1CzB,GAASA,EAAMyB,SAAW,GAAM,GAOvCkL,GAAe7N,EAAAA,EAAOC,IAAGkD,KAAAA,IAAAhD,EAAAA,EAAAA,GAAA,2DAEpBe,GAASA,EAAM4M,OAAS,UAAY,UAC3C5M,GAASA,EAAM6M,SAAW,uBAGxBC,GAAUhO,EAAAA,EAAOiO,GAAE3K,KAAAA,IAAAnD,EAAAA,EAAAA,GAAA,wGA+RzB,GApRyBkE,IAyBlB,IAzBmB,KACxB6J,EAAI,gBACJC,EAAkB,GAAE,eACpBC,EAAiB,GAAE,iBACnBC,GAAmB,EAAK,YACxBC,EAAc,GAAE,WAChBC,GAAa,EAAK,aAClBC,EAAe,EAAC,WAChBC,GAAa,EAAK,MAClBxJ,EAAQ,KAAI,cACZyJ,EAAa,SACbC,EAAQ,eACRC,EAAc,UACdC,EAAS,SACTC,EAAQ,cACRC,EAAa,gBACbC,GAAkB,EAAI,aACtBC,EAAY,eACZC,EAAc,cACdC,EAAa,SACbC,EAAQ,WACRC,EAAU,kBACVC,EAAoB,KAAI,oBACxBC,EAAsB,GAAE,aACxBC,GACDnL,EACC,MAAMoL,GAAiBC,EAAAA,EAAAA,QAAO,MACxBC,GAAcD,EAAAA,EAAAA,QAAO,OACpBE,EAAUC,IAAerK,EAAAA,EAAAA,UAAS,CAAEsK,KAAM,IAAKC,MAAO,SAgC7D,IA7BA1J,EAAAA,EAAAA,WAAU,KACR,GAAI6H,GAAQyB,EAAYK,QAAS,CAC/B,MAAMC,EAAON,EAAYK,QAAQE,wBAC3BC,EAAgBC,OAAOC,WAIzBJ,EAAKF,MAAQI,EAEfN,EAAY,CAAEC,KAAM,OAAQC,MAAO,OAG5BE,EAAKH,KAAO,GAKZG,EAAKH,MAAQ,GAAKG,EAAKF,OAASI,IAHvCN,EAAY,CAAEC,KAAM,IAAKC,MAAO,QAMpC,GACC,CAAC7B,KAEJ7H,EAAAA,EAAAA,WAAU,KACJkI,GAAckB,EAAeO,SAC/BM,WAAW,SAAAC,EAAA,OAA4B,QAA5BA,EAAMd,EAAeO,eAAO,IAAAO,OAAA,EAAtBA,EAAwBC,SAAS,KAEnD,CAACjC,KAECL,EAAM,OAAO,KAGlB,MAAMuC,EAAsB1I,MAAMC,QAAQmG,GAAmBA,EAAkB,GACzEuC,EAAqB3I,MAAMC,QAAQoG,GAAkBA,EAAiB,GAEtEuC,EAA0BF,EAC7B9H,OAAOiI,GAASA,IAA4B,IAAlBA,EAAMC,SAA2C,MAA1BC,OAAOF,EAAMC,WAC9DlI,OAAOiI,GAASpB,EAAaoB,EAAOtC,IAEjCyC,EAAyBL,EAC5B/H,OAAOiI,GAASpB,EAAaoB,EAAOtC,IAEvC,OACErF,EAAAA,GAAAA,MAACuD,GAAiB,CAACwE,IAAKrB,EAAalD,MAAOmD,EAASE,KAAMpD,OAAQkD,EAASG,MAAM/G,SAAA,EAEhFC,EAAAA,GAAAA,MAAC0D,GAAa,CAAA3D,SAAA,EACZC,EAAAA,GAAAA,MAAC2D,GAAW,CAAA5D,SAAA,EACVD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM4H,EAAAA,IAAYrH,MAAO,CAAEG,MAAO,UAAWW,SAAU,WACxE3B,EAAAA,GAAAA,KAAA,QAAAC,SAAM,4CAERC,EAAAA,GAAAA,MAAC4D,GAAa,CAAA7D,SAAA,EACZD,EAAAA,GAAAA,KAAC+D,GAAU,CACT5D,QAAUjB,IAAQA,EAAEkB,kBAAmB0F,KACvCpF,MAAM,iCACN9G,UAAWsC,GAASoJ,EACpBtB,OAAO,UAAS/D,UAEhBD,EAAAA,GAAAA,KAACmI,GAAAA,EAAS,CAACC,KAAM,QAEnBpI,EAAAA,GAAAA,KAAC+D,GAAU,CACT5D,QAAS0F,EACTnF,MAAO8E,EAAa,yBAAkB,SAASvF,UAE/CD,EAAAA,GAAAA,KAACqI,EAAAA,EAAM,CAACD,KAAM,aAMnB5C,IACCtF,EAAAA,GAAAA,MAAC+D,GAAS,CAAAhE,SAAA,EACRD,EAAAA,GAAAA,KAACkE,GAAU,CAAAjE,UACTD,EAAAA,GAAAA,KAACqI,EAAAA,EAAM,CAACD,KAAM,QAEhBpI,EAAAA,GAAAA,KAACmE,GAAW,CACV8D,IAAKvB,EACLtO,KAAK,OACLiH,MAAOkG,EACP9D,SAAWvC,GAAM0G,EAAS1G,EAAE2C,OAAOxC,OACnCyC,YAAY,kCAEbyD,IACCvF,EAAAA,GAAAA,KAACoE,GAAiB,CAChBjE,QAASA,IAAMyF,EAAS,IACxBlF,MAAM,+BAAqBT,UAE3BD,EAAAA,GAAAA,KAACsI,EAAAA,EAAC,CAACF,KAAM,WAOjBlI,EAAAA,GAAAA,MAACmE,GAAY,CAAApE,SAAA,CACV2H,EAAwBtG,IAAI,CAACuG,EAAOU,KAAS,IAADC,EAC3C,MAAMC,EAAIZ,EAAMa,MAAQ,CAAC,EACnBC,GAAOd,EAAMzP,MAAQ,IAAIwQ,WAAWC,cACpCC,EAAYH,EAAIhJ,SAAS,OAAiB,UAARgJ,GAA2B,UAARA,EACrDI,EAAaJ,EAAIhJ,SAAS,QAAkB,UAARgJ,GAA2B,UAARA,EACvDK,EAAcnB,EAAMoB,MAAQpB,EAAMqB,SAAuB,QAAZV,EAAAC,EAAEU,kBAAU,IAAAX,OAAA,EAAZA,EAAcY,UAAO,gBAAAC,OAAexB,EAAMyB,IAAM,KAC7FC,EAAiB,UAARZ,GAAoBG,GAAaC,EAAe,aAAgBA,EAAa,UAAY,KAExG,OACE7I,EAAAA,GAAAA,MAACoE,GAAY,CAA+CC,MAAM,SAAQtE,SAAA,EACxEC,EAAAA,GAAAA,MAACsE,GAAY,CAAAvE,SAAA,EACXC,EAAAA,GAAAA,MAACuE,GAAY,CAAAxE,SAAA,CACV+I,GACa,OAAbrD,QAAa,IAAbA,OAAa,EAAbA,EAAgB,sBACf3F,EAAAA,GAAAA,KAAC4E,GAAY,CACXzE,QAAUjB,IAAQA,EAAEkB,kBAAmBkG,EAAWuB,IAClDnH,MAAM,gCAAqBT,UAE3BC,EAAAA,GAAAA,MAAA,OAAK1J,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,OAAOC,OAAO,eAAeC,YAAY,IAAG1J,SAAA,EAC/FD,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,gEACRgK,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,qEAKhBgK,EAAAA,GAAAA,KAAC0E,GAAa,CAAAzE,SAAEsJ,QAGlBrJ,EAAAA,GAAAA,MAACyE,GAAe,CAAA1E,SAAA,EACdD,EAAAA,GAAAA,KAAC4E,GAAY,CAACzE,QAASA,IAAM+F,EAAa2B,GAAQnH,MAAM,sCAA2BsD,OAAO,UAAS/D,UACjGD,EAAAA,GAAAA,KAAC4J,EAAAA,EAAI,CAACxB,KAAM,QAEdpI,EAAAA,GAAAA,KAAC4E,GAAY,CAACzE,QAASA,IAAMiG,EAAcyB,EAAOA,EAAMa,MAAOhI,MAAM,qCAAyBT,UAC5FD,EAAAA,GAAAA,KAAC6J,GAAAA,EAAG,CAACzB,KAAM,QAEC,OAAbzC,QAAa,IAAbA,OAAa,EAAbA,EAAgB,sBACf3F,EAAAA,GAAAA,KAAC4E,GAAY,CAACzE,QAASA,IAAMkG,EAASwB,GAAQnH,MAAM,SAASsD,OAAO,UAAS/D,UAC3ED,EAAAA,GAAAA,KAAC8J,EAAAA,EAAK,CAAC1B,KAAM,WAKnBlI,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQ2H,IAAK,WAAY9J,SAAA,EAC9CD,EAAAA,GAAAA,KAAC6E,GAAU,CACT1E,QAASA,IAAM4F,EAAS8B,GACxBjO,UAAWqM,IAAqBP,GAAcD,GAAgB,IAAOqD,EACrEpI,MAAQuF,GAA4FP,GAAcD,GAAgB,EAAK,0CAAmCqD,EAA2C,oBAA/B,kCAA5J,wGAAyM7I,SACpO,QAGDD,EAAAA,GAAAA,KAAC6E,GAAU,CACT1E,QAASA,IAAM6F,EAAc6B,GAC7BjO,UAAWqM,IAAqBP,GAAcD,EAAe,IAAOsD,EACpErI,MAAQuF,GAA4FP,GAAcD,EAAe,EAAK,2EAAsDsD,EAAiD,yBAApC,uCAA/K,wGAAsO9I,SACjQ,iBAGG,UAAAoJ,OAhDqBxB,EAAMyB,GAAE,KAAAD,OAAIxB,EAAMmC,GAAE,KAAAX,OAAId,MAqDxDhD,EAAY/C,QAA6C,IAAnCoF,EAAwB3G,SAC7CjB,EAAAA,GAAAA,KAAC8E,GAAY,CAACC,QAAM,EAAA9E,SAAC,mBAIzBD,EAAAA,GAAAA,KAACiF,GAAO,KAGRjF,EAAAA,GAAAA,KAAC4D,GAAa,CAAA3D,UACZC,EAAAA,GAAAA,MAAC2D,GAAW,CAAA5D,SAAA,EACVD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMK,EAAAA,IAAQE,MAAO,CAAEG,MAAO,UAAWW,SAAU,WACpE3B,EAAAA,GAAAA,KAAA,QAAAC,SAAM,2BAIqB,IAA9B0H,EAAmB1G,SAClBjB,EAAAA,GAAAA,KAAC8E,GAAY,CAAA7E,SAAC,mCAGhBC,EAAAA,GAAAA,MAACmE,GAAY,CAAApE,SAAA,CACV+H,EAAuB1G,IAAI,CAACuG,EAAOU,KAAS,IAAD0B,EAAAC,EAC1C,MAAMvB,GAAOd,EAAMzP,MAAQ,IAAIwQ,WAAWC,cACpCsB,EAAgB,OAARxB,GAAwB,UAARA,GAA2B,UAARA,KAA0B,OAALd,QAAK,IAALA,GAAW,QAANoC,EAALpC,EAAOa,YAAI,IAAAuB,IAAXA,EAAad,YAC7EiB,EAAiB,WAARzB,GAA4B,UAARA,GAA2B,UAARA,KAA0B,OAALd,QAAK,IAALA,GAAW,QAANqC,EAALrC,EAAOa,YAAI,IAAAwB,IAAXA,EAAaG,cAClFd,EAAiB,UAARZ,GAAoBwB,GAASC,EAAW,aAAgBA,EAAS,UAAY,KAE5F,OACElK,EAAAA,GAAAA,MAACoE,GAAY,CAA6CC,MAAM,OAAMtE,SAAA,EACpEC,EAAAA,GAAAA,MAACsE,GAAY,CAAAvE,SAAA,EACXC,EAAAA,GAAAA,MAACuE,GAAY,CAAAxE,SAAA,CACV4H,EAAMoB,MACPjJ,EAAAA,GAAAA,KAAC4E,GAAY,CACXzE,QAAUjB,IAAQA,EAAEkB,kBAAmBkG,EAAWuB,IAClDnH,MAAM,gCAAqBT,UAE3BC,EAAAA,GAAAA,MAAA,OAAK1J,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,OAAOC,OAAO,eAAeC,YAAY,IAAG1J,SAAA,EAC/FD,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,gEACRgK,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,qEAIdgK,EAAAA,GAAAA,KAAC0E,GAAa,CAAAzE,SAAEsJ,QAGlBrJ,EAAAA,GAAAA,MAACyE,GAAe,CAAA1E,SAAA,EACdD,EAAAA,GAAAA,KAAC4E,GAAY,CAACzE,QAASA,IAAMiG,EAAcyB,EAAOA,EAAMa,MAAOhI,MAAM,qCAAyBT,UAC5FD,EAAAA,GAAAA,KAAC6J,GAAAA,EAAG,CAACzB,KAAM,QAEC,OAAbzC,QAAa,IAAbA,OAAa,EAAbA,EAAgB,sBACf3F,EAAAA,GAAAA,KAAC4E,GAAY,CAACzE,QAASA,IAAMgG,EAAe0B,GAAQnH,MAAM,+CAAiCsD,OAAO,UAAS/D,UACzGC,EAAAA,GAAAA,MAAA,OAAK1J,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,OAAOC,OAAO,eAAeC,YAAY,IAAG1J,SAAA,EAC/FD,EAAAA,GAAAA,KAAA,UAAQ9J,GAAG,KAAKC,GAAG,KAAKC,EAAE,QAC1B4J,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,wBAIdgK,EAAAA,GAAAA,KAAC4E,GAAY,CAACzE,QAASA,IAAMkG,EAASwB,GAAQnH,MAAM,SAASsD,OAAO,UAAS/D,UAC3ED,EAAAA,GAAAA,KAAC8J,EAAAA,EAAK,CAAC1B,KAAM,WAIjBlI,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQ2H,IAAK,WAAY9J,SAAA,EAC9CD,EAAAA,GAAAA,KAAC6E,GAAU,CACT1E,QAASA,IAAM4F,EAAS8B,GACxBjO,UAAWqM,IAAqBP,GAAcD,GAAgB,IAAO0E,EACrEzJ,MAAQuF,GAA4FP,GAAcD,GAAgB,EAAK,0CAAmC0E,EAAuC,oBAA/B,kCAAxJ,wGAAqMlK,SAChO,QAGDD,EAAAA,GAAAA,KAAC6E,GAAU,CACT1E,QAASA,IAAM6F,EAAc6B,GAC7BjO,UAAWqM,IAAqBP,GAAcD,EAAe,IAAO2E,EACpE1J,MAAQuF,GAA4FP,GAAcD,EAAe,EAAK,2EAAsD2E,EAA6C,yBAApC,uCAA3K,wGAAkOnK,SAC7P,iBAGG,QAAAoJ,OAjDmBxB,EAAMyB,GAAE,KAAAD,OAAIxB,EAAMmC,GAAE,KAAAX,OAAId,MAsDtDhD,EAAY/C,QAA4C,IAAlCwF,EAAuB/G,SAC5CjB,EAAAA,GAAAA,KAAC8E,GAAY,CAACC,QAAM,EAAA9E,SAAC,sB,mECpc/B,MA8DMqK,GAAqBrT,EAAAA,EAAOC,IAAGC,KAAAA,IAAAC,EAAAA,EAAAA,GAAA,uXAE5Be,GAASA,EAAMoS,UAAU5T,EACxBwB,GAASA,EAAMoS,UAAU7T,EACxByB,GACHA,EAAMqS,aAAoB,GAANnB,OAVM,GAU6B,OACvDlR,EAAMsS,WAAkB,GAANpB,OAVM,IAU2B,OAG3ClR,IAASA,EAAMqS,aACzB,yFAIarS,GAASA,EAAMqS,aAAe,cAAgB,OACjDrS,GAASA,EAAMqS,aACzB,+DACA,+FACOrS,GAASA,EAAMuS,cAAgB,SAAW,QAC3CvS,GAASA,EAAMwS,YAAc,WAAa,UACtCxS,GAASA,EAAMwS,YACzB,OACA,wCAGUxS,GAASA,EAAMqS,aAAe,QAAU,OAIpDrS,GAASA,EAAMqS,cAAY,uDAMzBI,GAAkB3T,EAAAA,EAAOC,IAAGI,KAAAA,IAAAF,EAAAA,EAAAA,GAAA,uYAIrBe,GAASA,EAAMqS,aAAe,WAAa,YAG5CrS,GAASA,EAAMqS,aAAe,UAAY,OACnCrS,GAASA,EAAMqS,aAAe,YAAc,gBAIjDrS,GAASA,EAAMqS,aAAe,UAAY,YAIlDK,GAAgB5T,EAAAA,EAAOC,IAAGM,KAAAA,IAAAJ,EAAAA,EAAAA,GAAA,seAuB1B0T,GAAiB7T,EAAAA,EAAOC,IAAGS,KAAAA,IAAAP,EAAAA,EAAAA,GAAA,ubA2B3B2T,GAAiB9T,EAAAA,EAAOC,IAAGY,KAAAA,IAAAV,EAAAA,EAAAA,GAAA,wTAkB3B4T,GAAiB/T,EAAAA,EAAOC,IAAGc,KAAAA,IAAAZ,EAAAA,EAAAA,GAAA,6WAkB3B6T,GAAiBhU,EAAAA,EAAOC,IAAGgB,KAAAA,IAAAd,EAAAA,EAAAA,GAAA,6DAM3B8T,GAAgBjU,EAAAA,EAAOY,OAAMS,KAAAA,IAAAlB,EAAAA,EAAAA,GAAA,+lBASvBe,GAASA,EAAMyB,SAAW,cAAgB,UAGzCzB,GAASA,EAAMyB,SAAW,GAAM,EAezCzB,GAASA,EAAMgT,WAAS,8YA0BtBpH,GAAa9M,EAAAA,EAAOY,OAAMW,KAAAA,IAAApB,EAAAA,EAAAA,GAAA,seA8B1BgU,IAAwBnU,EAAAA,EAAAA,GAAO8M,GAAP9M,CAAkB0B,KAAAA,IAAAvB,EAAAA,EAAAA,GAAA,gYAoB1CiU,GAAmBpU,EAAAA,EAAOC,IAAG2B,KAAAA,IAAAzB,EAAAA,EAAAA,GAAA,uoBAGtBe,GAASA,EAAMqS,aAAe,UAAY,WAI1CrS,GAASA,EAAMqS,aAAe,IAAM,IAClCrS,GAASA,EAAMqS,aAAe,gCAAkC,yBAG3ErS,IAAUA,EAAMqS,cAAY,+BAuB1Bc,GAAcrU,EAAAA,EAAOC,IAAG8B,KAAAA,IAAA5B,EAAAA,EAAAA,GAAA,yhBACjBe,GAASA,EAAMqS,aAAe,UAAY,YAK1CrS,GAASA,EAAMoT,YAAc,IAAO,EACjCpT,GACRA,EAAMoT,YAAoB,oDACvBpT,EAAMqT,UAAY,2BAEPrT,GACdA,EAAMoT,YAAoB,UACvBpT,EAAMsT,cAAgB,UAEjBtT,GAASA,EAAMuT,UACzB,yEACA,gCAISvT,GAASA,EAAMoT,YAAc,IAAO,EAEjCpT,GAASA,EAAMoT,YACzB,gCACA,kCAKFI,GAAqB1U,EAAAA,EAAOC,IAAGiC,KAAAA,IAAA/B,EAAAA,EAAAA,GAAA,yFAG5Be,GAASA,EAAMqS,aAAe,IAAM,OACxBrS,GAASA,EAAMqS,aAAe,SAAW,cAGxDoB,GAAc3U,EAAAA,EAAOC,IAAGoC,KAAAA,IAAAlC,EAAAA,EAAAA,GAAA,uMAMnBe,GAASA,EAAMoT,YAAc,UAAYpT,EAAM6L,QAAU,WAS9D6H,GAAc5U,EAAAA,EAAOC,IAAGuC,KAAAA,IAAArC,EAAAA,EAAAA,GAAA,qDAGnBe,GAASA,EAAM2T,YAAc,WAGlCC,GAAc9U,EAAAA,EAAOC,IAAG4C,KAAAA,IAAA1C,EAAAA,EAAAA,GAAA,wMAYxB4U,GAAkB/U,EAAAA,EAAO2D,KAAIX,KAAAA,IAAA7C,EAAAA,EAAAA,GAAA,8UAInBe,GACRA,EAAM8T,WAAmB,UACzB9T,EAAM+T,kBAA0B,UAC7B,UAKE/T,GAASA,EAAM+T,oBAAsB/T,EAAM8T,WAAa,MAAQ,UAElE9T,GAASA,EAAM+T,oBAAsB/T,EAAM8T,WAAa,MAAQ,OAC/D9T,GAASA,EAAM+T,oBAAsB/T,EAAM8T,WAAa,MAAQ,OAC7D9T,GAASA,EAAM+T,oBAAsB/T,EAAM8T,WAAa,MAAQ,OAC/D9T,GAASA,EAAM+T,oBAAsB/T,EAAM8T,WAAa,MAAQ,QAM1EE,GAAkBlV,EAAAA,EAAO2D,KAAIR,KAAAA,IAAAhD,EAAAA,EAAAA,GAAA,kZAInBe,GAASA,EAAM8T,WAAa,UAAY,UAalC9T,GAASA,EAAM8T,WAAa,UAAY,WAGxDG,GAAoBnV,EAAAA,EAAOC,IAAGqD,KAAAA,IAAAnD,EAAAA,EAAAA,GAAA,qZAEvBe,GAASA,EAAMqS,aAAe,WAAa,OACjCrS,GAASA,EAAMoT,YAAc,UAAapT,EAAMkU,YAAc,UAAY,UAEjFlU,GAASA,EAAMoT,YACzB,UACCpT,EAAMkU,YACL,sFACA,sFAGIlU,GAASA,EAAMoT,YAAc,cAAgB,UAC5CpT,GAASA,EAAMoT,YAAc,GAAM,EAC5BpT,GAASA,EAAMoT,YAAc,OAAS,OAKjDpT,GAASA,EAAMqS,aAAe,MAAQ,MACnCrS,GAASA,EAAMqS,aAAe,OAAM,GAAAnB,OAhaxB,IAga6C,MAGjDlR,GAASA,EAAMoT,YAAc,UAAY,UAC3CpT,GAASA,EAAMoT,YAAc,UAAY,uFAIrDe,GAAerV,EAAAA,EAAOC,IAAGuD,KAAAA,IAAArD,EAAAA,EAAAA,GAAA,yGACpBe,GAASA,EAAMoT,YAAc,UAAapT,EAAMkU,YAAc,UAAY,UAIxElU,GAASA,EAAMqS,aAAe,OAAS,OACtCrS,GAASA,EAAMqS,aAAe,OAAS,QAI/C+B,GAAetV,EAAAA,EAAOC,IAAGyD,KAAAA,IAAAvD,EAAAA,EAAAA,GAAA,4GAChBe,GAASA,EAAMqS,aAAe,OAAS,OAE3CrS,GAASA,EAAMoT,YAAc,UAAapT,EAAMkU,YAAc,UAAY,WAM/EG,GAAgB,CACpB,CACElD,GAAI,aACJL,KAAM,0BACN3I,KAAMK,EAAAA,IACNK,MAAO,UACPyL,QAAS,wFACTC,YAAa,UACbC,MAAO,EACPvT,SAAU,CAAC,QAAS,aAEtB,CACEkQ,GAAI,YACJL,KAAM,+BACN3I,KAAMsM,EAAAA,IACN5L,MAAO,UACPyL,QAAS,wFACTC,YAAa,UACbC,MAAO,EACPvT,SAAU,CAAC,oBAGb,CACEkQ,GAAI,YACJL,KAAM,YACN3I,KAAMsB,EAAAA,EACNiL,SAAU,SACV7L,MAAO,UACPyL,QAAS,wFACTC,YAAa,UACbC,MAAO,EACPvT,SAAU,CAAC,gBAAiB,oBAE9B,CACEkQ,GAAI,UACJL,KAAM,wBACN3I,KAAMwM,EAAAA,EACND,SAAU,SACV7L,MAAO,UACPyL,QAAS,wFACTC,YAAa,UACbC,MAAO,EACPvT,SAAU,CAAC,UAAW,iBAExB,CACEkQ,GAAI,kBACJL,KAAM,6CACN3I,KAAMyM,EAAAA,EACNF,SAAU,SACV7L,MAAO,UACPyL,QAAS,wFACTC,YAAa,UACbC,MAAO,EACPvT,SAAU,IAEZ,CACEkQ,GAAI,UACJL,KAAM,kCACN3I,KAAM0M,EAAAA,EACNH,SAAU,SACV7L,MAAO,UACPyL,QAAS,wFACTC,YAAa,UACbC,MAAO,EACPvT,SAAU,IAEZ,CACEkQ,GAAI,gBACJL,KAAM,oCACN3I,KAAMwM,EAAAA,EACND,SAAU,SACV7L,MAAO,UACPyL,QAAS,wFACTC,YAAa,UACbC,MAAO,EACPvT,SAAU,IAEZ,CACEkQ,GAAI,uBACJL,KAAM,6BACN3I,KAAMG,EAAAA,IACNO,MAAO,UACPyL,QAAS,wFACTC,YAAa,UACbC,MAAO,EACPvT,SAAU,IAEZ,CACEkQ,GAAI,gBACJL,KAAM,gBACN3I,KAAM2M,EAAAA,IACNjM,MAAO,UACPyL,QAAS,wFACTC,YAAa,UACbC,MAAO,EACPvT,SAAU,IAEZ,CACEkQ,GAAI,yBACJL,KAAM,uCACN3I,KAAM2M,EAAAA,IACNjM,MAAO,UACPyL,QAAS,wFACTC,YAAa,UACbC,MAAO,EACPvT,SAAU,IAEZ,CACEkQ,GAAI,YACJL,KAAM,YACN3I,KAAM4M,EAAAA,EACNL,SAAU,SACV7L,MAAO,UACPyL,QAAS,wFACTC,YAAa,UACbC,MAAO,EACPvT,SAAU,IAEZ,CACEkQ,GAAI,kBACJL,KAAM,6BACN3I,KAAM6M,EAAAA,EACNN,SAAU,SACV7L,MAAO,UACPyL,QAAS,wFACTC,YAAa,UACbC,MAAO,EACPvT,SAAU,IAEZ,CACEkQ,GAAI,YACJL,KAAM,oBACN3I,KAAMG,EAAAA,IACNO,MAAO,UACPyL,QAAS,wFACTC,YAAa,UACbC,MAAO,EACPvT,SAAU,KA60Bd,GA3zB0BkC,IA6CnB,IA7CoB,eACzB8R,EAAc,YACdC,EAAW,iBACXC,EAAgB,qBAChBC,GAAuB,EAAK,aAC5B9H,EAAe,EAAC,iBAChB+H,EAAmB,CAAC,EAAC,SACrBC,EAAW,CAAC,EAAC,aACbC,GAAe,EAAK,gBACpBC,EAAe,iBACfC,EAAmB,CAAC,EAAC,oBACrBC,GAAsB,EAAK,mBAC3BC,GAAqB,EAAK,kBAC1BC,GAAoB,EAAK,gBAEzBC,EAAe,iBACfC,EAAgB,eAChBC,EAAc,mBACdC,EAAkB,gBAClBC,GAAkB,EAAK,gBACvBC,GAAkB,EAAK,qBAEvBC,GAAuB,EAAK,gBAC5BlJ,EAAkB,GAAE,eACpBC,EAAiB,GAAE,iBACnBC,GAAmB,EAAK,YACxBC,EAAc,GAAE,WAChBC,GAAa,EAAK,MAClBtJ,EAAQ,KAAI,cACZyJ,EAAa,iBACb4I,EAAgB,uBAChBC,EAAsB,mBACtBC,EAAkB,iBAClBC,EAAgB,cAChB1I,EAAa,gBACbC,GAAkB,EAAI,qBACtB0I,EAAoB,uBACpBC,EAAsB,sBACtBC,EAAqB,iBACrBC,EAAgB,mBAChBC,EAAkB,kBAClBxI,EAAoB,KAAI,oBACxBC,EAAsB,GAAE,qBACxBwI,EAAoB,WACpBtJ,GAAa,GACdpK,EACC,MAAO2T,EAAaC,IAAkBzS,EAAAA,EAAAA,WAAS,IACxC0S,EAAWC,IAAgB3S,EAAAA,EAAAA,WAAS,IACpC4S,EAAYC,IAAiB7S,EAAAA,EAAAA,WAAS,IACtC8S,GAAYC,KAAiB/S,EAAAA,EAAAA,WAAS,IACtCoK,GAAUC,KAAerK,EAAAA,EAAAA,UAAS,CAAE/F,EAAG,GAAIC,EAAG,OAC9C8Y,GAAYC,KAAiBjT,EAAAA,EAAAA,UAAS,CAAE/F,EAAG,EAAGC,EAAG,KACjDgZ,GAAwBC,KAA6BnT,EAAAA,EAAAA,WAAS,GAC/DoT,IAAelJ,EAAAA,EAAAA,QAAO,MACtBmJ,IAAenJ,EAAAA,EAAAA,QAAO,MACtBoJ,IAAapJ,EAAAA,EAAAA,QAAO,MAGpBqJ,IAAeC,EAAAA,EAAAA,aAAaC,IAChCC,aAAaC,QAAQ,4BAA6BtR,KAAKuR,UAAUH,KAChE,IAGGI,IAAsBL,EAAAA,EAAAA,aAAaM,IAAS,IAADC,EAC/C,MAAMC,EAAiBxB,EAxpBO,GACF,IA8pBtByB,GAAsC,QAApBF,EAAAX,GAAa5I,eAAO,IAAAuJ,OAAA,EAApBA,EAAsBG,eAAgB,IAExDC,EAAOC,KAAKC,IAAI,EAAGzJ,OAAOC,WAAamJ,EAL9B,IAMTM,EAAOF,KAAKC,IAAI,EAAGzJ,OAAO2J,YAAcN,EAN/B,IAWf,MAAO,CAAEha,EAHYma,KAAKC,IAAI,EAAGD,KAAKI,IAAIV,EAAI7Z,EAAGka,IAGvBja,EAFLka,KAAKC,IAAI,EAAGD,KAAKI,IAAIV,EAAI5Z,EAAGoa,MAGhD,CAAC9B,EAAaE,KAGjB7R,EAAAA,EAAAA,WAAU,KACR,MAAM4T,EAAQf,aAAagB,QAAQ,6BACnC,GAAID,EACF,IACE,MAAME,EAAWtS,KAAKC,MAAMmS,GAEtBG,EAAiBf,GAAoBc,GAC3CtK,GAAYuK,GAGRA,EAAe3a,IAAM0a,EAAS1a,GAAK2a,EAAe1a,IAAMya,EAASza,GACnEqZ,GAAaqB,EAEjB,CAAE,MAAOnS,GACPoS,QAAQC,KAAK,2CACf,CAIqB,SADApB,aAAagB,QAAQ,+BAE1CjC,GAAe,GAII,SADAiB,aAAagB,QAAQ,6BAExC/B,GAAa,GAIf,MAAMoC,EAAcrB,aAAagB,QAAQ,2BACzC,GAAIK,GAAezB,GAAW9I,QAC5B,IACE,MAAMwK,EAAYC,SAASF,EAAa,IACxCzB,GAAW9I,QAAQ0K,UAAYF,CACjC,CAAE,MAAOvS,GACPoS,QAAQC,KAAK,oCACf,GAED,CAACjB,GAAqBN,KAGzB,MAAM4B,IAAqB3B,EAAAA,EAAAA,aAAY,KACrCnJ,GAAY+K,IACV,MAAM3B,EAAcI,GAAoBuB,GAGxC,OAAI3B,EAAYxZ,IAAMmb,EAAanb,GAAKwZ,EAAYvZ,IAAMkb,EAAalb,GACrEqZ,GAAaE,GACNA,GAGF2B,KAER,CAACvB,GAAqBN,MAGzB1S,EAAAA,EAAAA,WAAU,KACR,MAAMwU,EAAeA,KAEnBC,aAAaD,EAAaE,WAC1BF,EAAaE,UAAYzK,WAAWqK,GAAoB,MAK1D,OAFAvK,OAAO4K,iBAAiB,SAAUH,GAE3B,KACLzK,OAAO6K,oBAAoB,SAAUJ,GACrCC,aAAaD,EAAaE,aAE3B,CAACJ,KAGJ,MAAMO,IAAqBlC,EAAAA,EAAAA,aAAamC,IACtCjC,aAAaC,QAAQ,6BAA8BgC,EAAUxJ,aAC5D,IAGGyJ,IAAmBpC,EAAAA,EAAAA,aAAaqC,IACpCnC,aAAaC,QAAQ,2BAA4BkC,EAAQ1J,aACxD,IAGG2J,IAAmB5L,EAAAA,EAAAA,QAAO,MAC1B6L,IAAqBvC,EAAAA,EAAAA,aAAY,KACjCsC,GAAiBtL,SACnB8K,aAAaQ,GAAiBtL,SAEhCsL,GAAiBtL,QAAUM,WAAW,KAChCwI,GAAW9I,SACbkJ,aAAaC,QAAQ,0BAA2BL,GAAW9I,QAAQ0K,UAAU/I,aAE9E,MACF,IAGG6J,IAAkBxC,EAAAA,EAAAA,aAAa/Q,IACnC,GAAI+P,EAAa,OAEjB,MAAM/H,EAAO2I,GAAa5I,QAAQE,wBAClCuI,GAAc,CACZhZ,EAAGwI,EAAEwT,QAAUxL,EAAKH,KACpBpQ,EAAGuI,EAAEyT,QAAUzL,EAAK0L,MAEtBtD,GAAc,IACb,CAACL,IAEE4D,IAAkB5C,EAAAA,EAAAA,aAAa/Q,IACnC,IAAKmQ,EAAY,OAEjB,MAAMyD,EAAO5T,EAAEwT,QAAUjD,GAAW/Y,EAC9Bqc,EAAO7T,EAAEyT,QAAUlD,GAAW9Y,EAG9Bqc,EAAsB1C,GAAoB,CAAE5Z,EAAGoc,EAAMnc,EAAGoc,IAE9DjM,GAAYkM,IACX,CAAC3D,EAAYI,GAAYa,KAEtB2C,IAAgBhD,EAAAA,EAAAA,aAAY,KAC5BZ,IACFC,GAAc,GACdU,GAAanJ,MAEd,CAACwI,EAAYxI,GAAUmJ,MAE1B1S,EAAAA,EAAAA,WAAU,KACR,GAAI+R,EAIF,OAHA6D,SAASjB,iBAAiB,YAAaY,IACvCK,SAASjB,iBAAiB,UAAWgB,IAE9B,KACLC,SAAShB,oBAAoB,YAAaW,IAC1CK,SAAShB,oBAAoB,UAAWe,MAG3C,CAAC5D,EAAYwD,GAAiBI,KAGjC,MAAME,IAAkBlD,EAAAA,EAAAA,aAAY,KAClC,MAAMmD,GAAgBnE,EAItB,GAHAC,EAAekE,GACfjB,GAAmBiB,GAEfA,EAAc,CAEhB,MAAMlD,GAAW3Q,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQsH,IAAQ,IAAEnQ,EAAG,IACtCoQ,GAAYoJ,GACZF,GAAaE,EACf,MAEEpJ,GAAYuM,IACV,MAAMhC,EAAiBf,GAAoB+C,GAI3C,OAHIhC,EAAe3a,IAAM2c,EAAQ3c,GAAK2a,EAAe1a,IAAM0c,EAAQ1c,GACjEqZ,GAAaqB,GAERA,KAGV,CAACpC,EAAapI,GAAUsL,GAAoBnC,GAAcM,KAGvDgD,IAAgBrD,EAAAA,EAAAA,aAAY,KAChC,MAAMsD,GAAcpE,EACpBC,EAAamE,GACblB,GAAiBkB,GAGjBhM,WAAW,KACTT,GAAYuM,IACV,MAAMhC,EAAiBf,GAAoB+C,GAI3C,OAHIhC,EAAe3a,IAAM2c,EAAQ3c,GAAK2a,EAAe1a,IAAM0c,EAAQ1c,GACjEqZ,GAAaqB,GAERA,KAER,KACF,CAAClC,EAAWkD,GAAkB/B,GAAqBN,KAGhDwD,IAAkBvD,EAAAA,EAAAA,aAAa/Q,IACnCA,EAAEuU,iBACFvU,EAAEkB,kBACFoP,IAAc,IACb,IAEGkE,IAAkBzD,EAAAA,EAAAA,aAAa/Q,IACnCA,EAAEuU,iBACFvU,EAAEkB,kBAEGlB,EAAEyU,cAAcC,SAAS1U,EAAE2U,gBAC9BrE,IAAc,IAEf,IAEGsE,IAAiB7D,EAAAA,EAAAA,aAAa/Q,IAClCA,EAAEuU,iBACFvU,EAAEkB,kBACFoP,IAAc,IACb,IAEGuE,IAAa9D,EAAAA,EAAAA,aAAa/Q,IAC9BA,EAAEuU,iBACFvU,EAAEkB,kBACFoP,IAAc,GAEd,MAAMwE,EAAQhV,MAAMiV,KAAK/U,EAAEgV,aAAaF,OACpCA,EAAM/S,OAAS,GAAKoM,GACtBA,EAAY2G,IAEb,CAAC3G,IAEE8G,IAAsBlE,EAAAA,EAAAA,aAAY,KAAO,IAADmE,EACxB,QAApBA,EAAAtE,GAAa7I,eAAO,IAAAmN,GAApBA,EAAsBC,SACrB,IAEGC,IAAmBrE,EAAAA,EAAAA,aAAa/Q,IACpC,MAAM8U,EAAQhV,MAAMiV,KAAK/U,EAAE2C,OAAOmS,OAC9BA,EAAM/S,OAAS,GAAKoM,GACtBA,EAAY2G,GAGd9U,EAAE2C,OAAOxC,MAAQ,IAChB,CAACgO,IAGEkH,IAA+BtE,EAAAA,EAAAA,aAAY,KAC/CL,GAA0BtQ,IAASA,IAE9BqQ,IAA0BlB,GAC7BA,KAED,CAACkB,GAAwBlB,KAG5BnR,EAAAA,EAAAA,WAAU,KACR,IAAKqS,GAAwB,OAE7B,MAAM6E,EAAsBC,IAE1B,MAAMC,EAAWD,EAAM5S,OAAO8S,QAAQ,4BAChCC,EAAgBH,EAAM5S,OAAO8S,QAAQ,0BAEtCD,GAAaE,GAChBhF,IAA0B,IAK9B,OADAsD,SAASjB,iBAAiB,YAAauC,GAChC,KACLtB,SAAShB,oBAAoB,YAAasC,KAE3C,CAAC7E,KAGJ,MAAMkF,IAAqB5E,EAAAA,EAAAA,aAAa6E,IAClC1H,GACFA,EAAe0H,EAAQxL,KAExB,CAAC8D,IA+EE2H,IAA2B9E,EAAAA,EAAAA,aAAa6E,IAAa,IAADE,EAExD,MAMMC,EANgBvS,OAAOC,KAAK6K,GAAkB5N,OAAO3J,IACzD,MAAMif,EAxjCgBjf,IAItBA,EAAI0J,SAAS,UAAY1J,EAAI0J,SAAS,UAAY1J,EAAI0J,SAAS,aAAe1J,EAAI0J,SAAS,UACtF,aAIL1J,EAAI0J,SAAS,aAAe1J,EAAI0J,SAAS,aACzC1J,EAAI0J,SAAS,cAAgB1J,EAAI0J,SAAS,YAC1C1J,EAAI0J,SAAS,gBAAkB1J,EAAI0J,SAAS,WAAa1J,EAAI0J,SAAS,kBACtE1J,EAAI0J,SAAS,2BAA6B1J,EAAI0J,SAAS,oBAClD,YAIL1J,EAAIkf,WAAW,aAAelf,EAAI0J,SAAS,mBACtC,UAIL1J,EAAI0J,SAAS,qBAAuB1J,EAAI0J,SAAS,iBAAmB1J,EAAI0J,SAAS,iBAC5E,uBAIL1J,EAAI0J,SAAS,cAAgB1J,EAAI0J,SAAS,QAAU1J,EAAI0J,SAAS,WAAa1J,EAAI0J,SAAS,WACtF,YAIL1J,EAAI0J,SAAS,mBAAqB1J,EAAI0J,SAAS,iBAC1C,gBAIL1J,EAAIkf,WAAW,aAAelf,EAAI0J,SAAS,mBACtC,kBAIL1J,EAAIkf,WAAW,YACV,YAILlf,EAAI0J,SAAS,kBAAoB1J,EAAI0J,SAAS,YAAc1J,EAAI0J,SAAS,qBACpE,yBAIF,KAogCcyV,CAAmBnf,GAEpC,OADgBif,IAAaJ,EAAQxL,KAINrI,OAIjC,IAAIoU,EAAe,EAkCnB,OA/BmB,IAAfJ,GAAmC,oBAAfH,EAAQxL,IAA4BmE,EAAS6H,SAAW7H,EAAS6H,QAAQrU,OAAS,EAExGwM,EAAS6H,QAAQC,QAASC,IACmB,IAAvCA,EAAQC,6BAA2E,IAAvCD,EAAQC,4BACtDJ,IAIF,MAAMK,EAAUC,WAAWlI,EAASmI,iBAAmB,GACjCD,WAAWH,EAAQK,YAAc,GACnCH,KAAaF,EAAQM,0BAAwE,KAA5CN,EAAQM,yBAAyBtT,SACpG6S,MAKkB,IAAfJ,GAAoBH,EAAQ1b,UAAY0b,EAAQ1b,SAAS6H,OAAS,GACzE6T,EAAQ1b,SAASmc,QAAQQ,IACvB,MAAM1W,EAAQoO,EAASsI,KAGN1W,GACG,kBAAVA,GAAuC,KAAjBA,EAAMmD,QACnCxD,MAAMC,QAAQI,IAA2B,IAAjBA,EAAM4B,SAG/BoU,MAKC,CACLA,aAAcA,EACdJ,WAAYA,EACZe,eAA+B,QAAhBhB,EAAAF,EAAQ1b,gBAAQ,IAAA4b,OAAA,EAAhBA,EAAkB/T,SAAU,IAE5C,CAACuM,EAAkBC,IAGhBwI,IAA6BhG,EAAAA,EAAAA,aAAaiG,IAC9C,MAAMC,EAAevI,EAAiBsI,GACtC,OAAKC,EAIE,CACLC,SAAkC,IAAzBD,EAAaC,QACtBC,SAAkC,IAAzBF,EAAaE,SANE,CAAED,SAAS,EAAMC,SAAS,IAQnD,CAACzI,IAGE0I,GAAqBxB,IACzB,GAAyB,WAArBA,EAAQjI,SAAuB,CACjC,MAAM0J,EAAgBzB,EAAQxU,KAC9B,OAAON,EAAAA,GAAAA,KAACuW,EAAa,GACvB,CACA,OAAOvW,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMwU,EAAQxU,QAGlCkW,IACJtW,EAAAA,GAAAA,MAACoK,GAAkB,CACjBrC,IAAK4H,GACLtF,UAAW1D,GACX2D,aAAcyE,EACdxE,WAAY0E,EACZxE,YAAa0E,EACb3E,cAAegD,EAAazN,SAAA,EAE5BD,EAAAA,GAAAA,KAAC4K,GAAe,CACdJ,aAAcyE,EACdwH,YAAahE,GAAgBxS,SAE5BgP,GACCjP,EAAAA,GAAAA,KAAC6K,GAAa,CAAA5K,SAAC,eAEfC,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACEC,EAAAA,GAAAA,MAAC4K,GAAc,CAAA7K,SAAA,EACbD,EAAAA,GAAAA,KAACiD,GAAI,IAAG,eAGV/C,EAAAA,GAAAA,MAAC6K,GAAc,CAAA9K,SAAA,EACbD,EAAAA,GAAAA,KAAC+D,GAAU,CACT5D,QAASmT,GACT5S,MAAOyO,EAAY,8BAA2B,0CAAkClP,SAE/EkP,GAAYnP,EAAAA,GAAAA,KAACkD,GAAS,KAAMlD,EAAAA,GAAAA,KAACmD,GAAS,OAEzCnD,EAAAA,GAAAA,KAAC+D,GAAU,CAAC5D,QAASgT,GAAiBzS,MAAM,0CAAyCT,UACnFD,EAAAA,GAAAA,KAACoD,GAAW,eAQpB6L,IACA/O,EAAAA,GAAAA,MAAC8K,GAAc,CAAA/K,SAAA,EACbC,EAAAA,GAAAA,MAAC+K,GAAc,CAAAhL,SAAA,EACbD,EAAAA,GAAAA,KAACkL,GAAa,CACZ,0BACA/K,QAASoU,GACT7T,MAAOuF,EAAkB,4CAA8B,mIACvDrM,UAAWqM,EAAgBhG,UAE3BD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMqW,EAAAA,QAExB1I,IACCjO,EAAAA,GAAAA,KAACkL,GAAa,CACZC,WAAS,EACThL,QAAS8N,EACTvN,MAAM,gEACN9G,UAAWyU,EAAgBpO,UAE3BD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMqW,EAAAA,QAG1BzI,IACClO,EAAAA,GAAAA,KAACkL,GAAa,CACZ/K,QAAS+N,EACTxN,MAAM,iCACN9G,UAAWwU,EAAgBnO,UAE3BD,EAAAA,GAAAA,KAACqD,GAAQ,CAAC+E,KAAM,OAGnBkF,IACCtN,EAAAA,GAAAA,KAACkL,GAAa,CACZ/K,QAASmN,EACT5M,MAAO6M,EAAuB,8BAA2B,+BAAuBtN,SAE/EsN,GAAuBvN,EAAAA,GAAAA,KAAC4W,GAAAA,EAAW,CAACxO,KAAM,MAASpI,EAAAA,GAAAA,KAACsD,GAAK,CAAC8E,KAAM,OAGpE+F,IACCnO,EAAAA,GAAAA,KAACkL,GAAa,CACZ/K,QAASgO,EACTzN,MAAOgN,EAAe,qCAA6B,0CAAgCzN,UAEnFD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMoN,EAAemJ,EAAAA,IAAaC,EAAAA,YAMzD9W,EAAAA,GAAAA,KAAA,OAAK,4BAAuBa,MAAO,CAAEgG,SAAU,YAAa5G,UAC1DD,EAAAA,GAAAA,KAAC+W,GAAgB,CACf5R,KAAMwK,GACNvK,gBAAiBA,EACjBC,eAAgBA,EAChBC,iBAAkBA,EAClBC,YAAaA,EACbC,WAAYA,EACZC,aAAcA,EACdC,WAAYA,EACZxJ,MAAOA,EACPyJ,cAAeA,EACfC,SAAU2I,EACV1I,eAAgB2I,EAChB1I,UAAW2I,EACX1I,SAAU2I,EACV1I,cAAeA,EACfC,gBAAiBA,EACjBC,aAAcyI,EACdxI,eAAgByI,EAChBxI,cAAeyI,EACfxI,SAAUyI,EACVxI,WAAYyI,EACZxI,kBAAmBA,EACnBC,oBAAqBA,EACrBC,aAAcuI,SAOrBC,IACCjP,EAAAA,GAAAA,KAACoL,GAAqB,CACpBjL,QAASgT,GACTzS,MAAM,wBAAoBT,UAE1BD,EAAAA,GAAAA,KAACuD,GAAY,OAIf0L,IACAjP,EAAAA,GAAAA,KAACqL,GAAgB,CACfpD,IAAK8H,GACLvF,aAAcyE,EACd+H,SAAUxE,GAAmBvS,SAG5BuM,GAAclL,IAAKwT,IAElB,GAAmB,YAAfA,EAAQxL,GAAkB,OAAO,KAGrC,GAAI6F,EAAW,OAAO,KAGtB,MAAM,QAAEiH,EAAO,QAAEC,GAAYJ,GAA2BnB,EAAQxL,IAGhE,IAAK8M,EAAS,OAAO,KAErB,MAAMa,GAAcZ,EACda,IAAWvJ,GAAkBA,EAAgBmH,EAAQxL,IACrD6N,EAAiBpC,GAAyBD,GAM1CsC,EAAYD,EAAelC,WAAa,EACxCoC,GAAoBD,GAAaD,EAAe9B,aAAe,EAC/DiC,EAAYF,GAAaC,EAE/B,OACErX,EAAAA,GAAAA,KAACsL,GAAW,CAEVC,YAAa0L,EACbvL,UAAWwL,EACXlT,OAAQ8Q,EAAQ9T,MAChBwK,SAAUsJ,EAAQrI,QAClBhB,aAAcqJ,EAAQpI,YACtBlC,aAAcyE,EACd9O,QAASA,IAAM0U,GAAmBC,GAClCpU,MAAOuW,EAAU,GAAA5N,OAAMyL,EAAQ7L,KAAI,qEAAmD6L,EAAQ7L,KAAKhJ,UAEnGC,EAAAA,GAAAA,MAACyL,GAAkB,CAACnB,aAAcyE,EAAYhP,SAAA,EAC5CD,EAAAA,GAAAA,KAAC4L,GAAW,CAAC5H,OAAQ8Q,EAAQ9T,MAAOuK,YAAa0L,EAAWhX,SACzDqW,GAAkBxB,MAEnB7F,IACAjP,EAAAA,GAAAA,KAAC6L,GAAW,CAACC,WAAYmL,EAAa,UAAYnC,EAAQ9T,MAAMf,UAC9DC,EAAAA,GAAAA,MAAC6L,GAAW,CAACR,YAAa0L,EAAWhX,SAAA,CAClC6U,EAAQ7L,KACRqO,IACCtX,EAAAA,GAAAA,KAACgM,GAAe,CACdC,WAAYmL,EACZlL,kBAAmBmL,EAAiBpX,SAEnCmX,EAAYD,EAAelC,WAAa,cAvBhDH,EAAQxL,SAqCrB2F,GAAexB,EAASnE,IAAM,MAE9B,MAAM6M,EAA+B,OAAhBvI,QAAgB,IAAhBA,OAAgB,EAAhBA,EAAkB2J,QACjCC,EAAqBrB,GAAgBA,EAAaE,QAAUxI,EAElE,OACA3N,EAAAA,GAAAA,MAACkM,GAAiB,CAChBC,YAAakD,GACb/E,aAAcyE,EACd1D,YAAaiM,EACbC,YAAajE,GACbkE,YAAahE,GACbiE,WAAY7D,GACZ8D,OAAQ7D,GACR5T,QAASgU,GAAoBlU,SAAA,EAE7BD,EAAAA,GAAAA,KAAA,SACEiI,IAAK6H,GACL1X,KAAK,OACLyf,UAAQ,EACRhX,MAAO,CAAEuB,QAAS,QAClBX,SAAU6S,MAEZtU,EAAAA,GAAAA,KAACsM,GAAY,CACXD,YAAakD,GACb/E,aAAcyE,EACd1D,YAAaiM,EAAmBvX,UAEhCD,EAAAA,GAAAA,KAACwD,GAAM,OAETxD,EAAAA,GAAAA,KAACuM,GAAY,CACXF,YAAakD,GACb/E,aAAcyE,EACd1D,YAAaiM,EAAmBvX,SAE/BsP,GAAa,0BAAuB,sCAI1C,EAvC+B,IA0C9BN,GAAexB,EAASnE,IAAM,MAC9B,MAAM6M,EAA+B,OAAhBvI,QAAgB,IAAhBA,OAAgB,EAAhBA,EAAkB2J,QAEvC,OAD2BpB,GAAgBA,EAAaE,QAAUxI,KAElE3N,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACViX,OAAQ,WACRhX,QAAS,OACTI,WAAY,wFACZC,OAAQ,oBACRC,aAAc,MACdL,UAAW,SACXC,MAAO,UACPW,SAAU,OACVoW,WAAY,MACZC,WAAY,OACZ/X,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEoX,aAAc,OAAQhY,SAAC,6CACrCD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,OAAQoW,WAAY,OAAQ9X,SAAC,4CAKxD,EAtB+B,IAyB9BgP,GAAexB,EAASnE,IAAM,MAE9B,MAAMwL,EAAU,CACdxL,GAAI,UACJL,KAAM,kCACN3I,KAAM4X,EAAAA,IACNlX,MAAO,UACPyL,QAAS,wFACTC,YAAa,WAKTyJ,EAA+B,OAAhBvI,QAAgB,IAAhBA,OAAgB,EAAhBA,EAAkB2J,QACjCN,EAAad,GAAgBA,EAAaE,QAAUxI,EACpDqJ,IAAWvJ,GAAkBA,EAAgBmH,EAAQxL,IAGrD6O,GAA+B,OAAZhC,QAAY,IAAZA,OAAY,EAAZA,EAAcgC,mBAAoB,EACrDC,GAAkC,OAAZjC,QAAY,IAAZA,OAAY,EAAZA,EAAciC,uBAAuB,EAG3DC,EAAuBF,EAAmB,EAC1CG,EAAYH,EAAiBvP,WAEnC,OACE5I,EAAAA,GAAAA,KAACqL,GAAgB,CAACb,aAAcyE,EAAYhP,UAC1CD,EAAAA,GAAAA,KAACsL,GAAW,CACVC,YAAa0L,EACbvL,UAAWwL,EACXlT,OAAQ8Q,EAAQ9T,MAChBwK,SAAUsJ,EAAQrI,QAClBhB,aAAcqJ,EAAQpI,YACtBlC,aAAcyE,EACd9O,QAASA,IAAM0U,GAAmBC,GAClCpU,MAAOuW,EAAU,GAAA5N,OAAMyL,EAAQ7L,KAAI,qEAAmD6L,EAAQ7L,KAAKhJ,UAEnGC,EAAAA,GAAAA,MAACyL,GAAkB,CAACnB,aAAcyE,EAAYhP,SAAA,EAC5CD,EAAAA,GAAAA,KAAC4L,GAAW,CAAC5H,OAAQ8Q,EAAQ9T,MAAOuK,YAAa0L,EAAWhX,UAC1DD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMwU,EAAQxU,UAE/B2O,IACAjP,EAAAA,GAAAA,KAAC6L,GAAW,CAACC,WAAYmL,EAAa,UAAYnC,EAAQ9T,MAAMf,UAC9DC,EAAAA,GAAAA,MAAC6L,GAAW,CAACR,YAAa0L,EAAWhX,SAAA,CAClC6U,EAAQ7L,KACRoP,IACCrY,EAAAA,GAAAA,KAACmM,GAAe,CAACF,WAAYmM,EAAoBnY,SAC9CqY,eAUpB,EAzD+B,MA8DpC,MAA2B,qBAAbpF,SACVqF,EAAAA,aAAsB/B,GAAkBtD,SAASsF,MACjDhC,I,mGC78CC,SAASiC,GAA8B/P,GAC5C,IAAKA,EAAM,MAAO,GAGlB,GAAI1J,MAAMC,QAAQyJ,IAASA,EAAKgQ,MAAMC,GAAwB,kBAATA,GACnD,OAAOjQ,EAAKpH,IAAIsX,GAAO7Q,OAAO6Q,GAAK/P,cAAcrG,QAAQ5C,OAAOiZ,SAIlE,GAAoB,kBAATnQ,EACT,IACE,MAAMoQ,EAASha,KAAKC,MAAM2J,GAC1B,GAAI1J,MAAMC,QAAQ6Z,GAChB,OAAOA,EAAOxX,IAAIqX,GACI,kBAATA,EAA0BA,EAAK9P,cAAcrG,OAChD,OAAJmW,QAAI,IAAJA,GAAAA,EAAMI,UAAkBhR,OAAO4Q,EAAKI,WAAWlQ,cAAcrG,OACzD,OAAJmW,QAAI,IAAJA,GAAAA,EAAMC,IAAY7Q,OAAO4Q,EAAKC,KAAK/P,cAAcrG,OAC9CuF,OAAO4Q,GAAM9P,cAAcrG,QACjC5C,OAAOiZ,QAEd,CAAE,MAAO3Z,GAEP,OADAoS,QAAQ5S,MAAM,qEAA2DQ,EAAG,QAASwJ,GAC9E,EACT,CAIF,OAAI1J,MAAMC,QAAQyJ,IAASA,EAAKsQ,KAAKL,GAAwB,kBAATA,GAA8B,OAATA,GAChEjQ,EAAKpH,IAAIqX,GACN,OAAJA,QAAI,IAAJA,GAAAA,EAAMI,UAAkBhR,OAAO4Q,EAAKI,WAAWlQ,cAAcrG,OACzD,OAAJmW,QAAI,IAAJA,GAAAA,EAAMC,IAAY7Q,OAAO4Q,EAAKC,KAAK/P,cAAcrG,OACjC,kBAATmW,EAA0BA,EAAK9P,cAAcrG,OACjDuF,OAAO4Q,GAAM9P,cAAcrG,QACjC5C,OAAOiZ,UAGZvH,QAAQC,KAAK,mFAAiE7I,EAAMA,GAC7E,GACT,CAcO,SAASuQ,GAA6BC,GAC3C,OAAKla,MAAMC,QAAQia,GAEZA,EACJ5X,IAAIsX,GAAO7Q,OAAO6Q,GAAK/P,cAAcrG,QACrC5C,OAAOiZ,SAJwB,EAKpC,CAqCO,SAASM,GAAgCzQ,GAC9C,IAAKA,EACH,MAAO,CAAC,EAGV,IAAI0Q,EAAY1Q,EAGhB,GAAoB,kBAATA,EACT,IACE0Q,EAAYta,KAAKC,MAAM2J,EACzB,CAAE,MAAOxJ,GAEP,OADAoS,QAAQ5S,MAAM,uEAA6DQ,EAAG,QAASwJ,GAChF,CAAC,CACV,CAIF,MAAMlK,EAAS,CACb6a,mBAAoBD,EAAUzQ,KAAOyQ,EAAUL,WAAaK,EAAUE,OAAS,IAoBjF,GAhBIF,EAAUG,QAAS/a,EAAOgb,OAASJ,EAAUG,QACxCH,EAAUI,SAAQhb,EAAOgb,OAASJ,EAAUI,QAGjDJ,EAAUK,gBAAejb,EAAOib,cAAgBL,EAAUK,eAC1DL,EAAUM,mBAAkBlb,EAAOkb,iBAAmBN,EAAUM,kBAGhEN,EAAUO,yBAAwBnb,EAAOmb,uBAAyBP,EAAUO,wBAC5EP,EAAUQ,wBAAuBpb,EAAOob,sBAAwBR,EAAUQ,uBAG1ER,EAAUS,yBAAwBrb,EAAOqb,uBAAyBT,EAAUS,wBAC5ET,EAAUU,4BAA2Btb,EAAOsb,0BAA4BV,EAAUU,2BAGlFV,EAAUW,gBAAiB,CAC7B,MAAMrR,EAAO0Q,EAAUW,gBACnBrR,EAAK8Q,SAAWhb,EAAOgb,SAAQhb,EAAOgb,OAAS9Q,EAAK8Q,QACpD9Q,EAAK6Q,UAAY/a,EAAOgb,SAAQhb,EAAOgb,OAAS9Q,EAAK6Q,SACrD7Q,EAAK+Q,gBAAkBjb,EAAOib,gBAAejb,EAAOib,cAAgB/Q,EAAK+Q,eACzE/Q,EAAKgR,mBAAqBlb,EAAOkb,mBAAkBlb,EAAOkb,iBAAmBhR,EAAKgR,kBAClFhR,EAAKiR,yBAA2Bnb,EAAOmb,yBAAwBnb,EAAOmb,uBAAyBjR,EAAKiR,wBACpGjR,EAAKkR,wBAA0Bpb,EAAOob,wBAAuBpb,EAAOob,sBAAwBlR,EAAKkR,uBACjGlR,EAAKmR,yBAA2Brb,EAAOqb,yBAAwBrb,EAAOqb,uBAAyBnR,EAAKmR,wBACpGnR,EAAKoR,4BAA8Btb,EAAOsb,4BAA2Btb,EAAOsb,0BAA4BpR,EAAKoR,0BACnH,CAEA,OAAOtb,CACT,CA0BO,SAASwb,GAA+BvM,GAAoC,IAA1BwM,EAAkBC,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,GAC5E,IAAKzM,IAAaA,EAAS4L,mBACzB,OAAO,KAIT,MAAMe,EAAiBH,EAAmBI,KAAKC,GAC7CA,EAAI1B,MAAQnL,EAAS4L,oBACrBiB,EAAIvB,YAActL,EAAS4L,oBAC3BiB,EAAIjb,QAAUoO,EAAS4L,oBAGnB7a,EAAS,CACbmK,IAAK8E,EAAS4L,mBACd9b,OAAqB,OAAd6c,QAAc,IAAdA,OAAc,EAAdA,EAAgB7c,SAAuB,OAAd6c,QAAc,IAAdA,OAAc,EAAdA,EAAgBG,eAA6B,OAAdH,QAAc,IAAdA,OAAc,EAAdA,EAAgBlhB,QAASuU,EAAS4L,mBACjGkB,aAA2B,OAAdH,QAAc,IAAdA,OAAc,EAAdA,EAAgBG,eAA6B,OAAdH,QAAc,IAAdA,OAAc,EAAdA,EAAgB7c,SAAuB,OAAd6c,QAAc,IAAdA,OAAc,EAAdA,EAAgBlhB,QAASuU,EAAS4L,oBAInG1Q,EAAM8E,EAAS4L,mBAqCrB,MAlCY,OAAR1Q,EACE8E,EAAS+L,QAAUxa,MAAMC,QAAQwO,EAAS+L,SAAW/L,EAAS+L,OAAOvY,OAAS,IAEhFzC,EAAO+a,QAAU9L,EAAS+L,OAAOlY,IAAIgI,GAAMoI,SAASpI,EAAI,MAI3C,YAARX,GACH8E,EAASgM,gBACXjb,EAAOib,cAAgBhM,EAASgM,eAE9BhM,EAASiM,mBACXlb,EAAOkb,iBAAmBjM,EAASiM,mBAItB,2BAAR/Q,GAA4C,uBAARA,GAAkC,iBAARA,GACjE8E,EAASkM,yBACXnb,EAAOmb,uBAAyBlM,EAASkM,wBAEvClM,EAASmM,wBACXpb,EAAOob,sBAAwBnM,EAASmM,wBAI3B,qBAARjR,GAAsC,2BAARA,GAAsC,qBAARA,IAC/D8E,EAASoM,yBACXrb,EAAOqb,uBAAyBpM,EAASoM,wBAEvCpM,EAASqM,4BACXtb,EAAOsb,0BAA4BrM,EAASqM,4BAIzCtb,CACT,CCyMwB,IA9axB,MACEgc,WAAAA,GACEC,KAAKC,eAAgB,EACrBD,KAAKE,gBAAiB,EACtBF,KAAKG,YAAc,KAGnBH,KAAKI,MAAQ,CACXC,MAAO,GACPC,UAAW,GACXC,UAAW,GACXC,YAAa,GACbC,gBAAiB,GACjBC,OAAQ,IAIVV,KAAKW,SAAW,CACdC,aAAc,KACdC,aAAc,KACdle,OAAQ,IAIVqd,KAAKc,eAAiB,CAAC,CACzB,CAKAC,sBAAAA,CAAuBC,GACrBhB,KAAKc,eAAiB,CACpBG,YAAaD,EAAUC,aAAW,MAAa,GAC/CC,aAAcF,EAAUE,cAAY,MAAa,GACjDC,oBAAqBH,EAAUG,qBAAmB,MAAa,GAC/DC,sBAAuBJ,EAAUI,uBAAqB,MAAa,GACnEC,0BAA2BL,EAAUK,2BAAyB,MAAa,GAC3EC,iBAAkBN,EAAUM,kBAAgB,MAAa,GACzDC,gBAAiBP,EAAUO,iBAAe,MAAa,GACvDC,oBAAqBR,EAAUQ,qBAAmB,MAAa,GAC/DC,oBAAqBT,EAAUS,qBAAmB,MAAa,GAC/DC,sBAAuBV,EAAUU,uBAAqB,MAAa,GACnEC,0BAA2BX,EAAUW,2BAAyB,MAAa,GAC3EC,iBAAkBZ,EAAUY,kBAAgB,MAAa,GAE7D,CAKA,gBAAMC,CAAUhhB,GAA0C,IAAzC,MAAEY,EAAK,SAAEC,EAAQ,WAAEogB,EAAa,MAAMjhB,EAErD,GAAImf,KAAKE,eAIP,aAFMF,KAAKG,YACXH,KAAK+B,oBACE/B,KAAKI,MAId,GAAIJ,KAAKC,cAGP,OADAD,KAAK+B,oBACE/B,KAAKI,MAGdJ,KAAKE,gBAAiB,EACtB,MAAM8B,EAAYC,KAAKC,MAEvBlC,KAAKG,YAAcH,KAAKmC,uBAAuB,CAAE1gB,QAAOC,WAAUogB,eAElE,UACQ9B,KAAKG,YAEX,MAAMiC,EAAWH,KAAKC,MAAQF,EAK9B,OAJAhC,KAAKW,SAASC,aAAe,IAAIqB,KACjCjC,KAAKW,SAASE,aAAeuB,EAC7BpC,KAAKC,eAAgB,EAEdD,KAAKI,KAEd,CAAE,MAAOnc,GAKP,MAJA+b,KAAKW,SAAShe,OAAO0f,KAAK,CACxBC,UAAW,IAAIL,KACfhe,MAAOA,EAAMoE,UAETpE,CACR,CAAC,QACC+b,KAAKE,gBAAiB,CACxB,CACF,CAKA,4BAAMiC,CAAsBI,GAAmC,IAAlC,MAAE9gB,EAAK,SAAEC,EAAQ,WAAEogB,GAAYS,EAC1D,MAAMC,IAAoBV,GAIxBW,EACAC,EACAC,EACAC,EACAC,EACAC,SACQC,QAAQC,WAAW,CAC3BhD,KAAKiD,WAAWxhB,EAAOC,EAAU8gB,GACjCxC,KAAKkD,eAAezhB,EAAOC,GAC3Bse,KAAKmD,eAAe1hB,EAAOC,GAC3Bse,KAAKoD,iBAAiB3hB,EAAOC,GAC7Bse,KAAKqD,qBAAqB5hB,EAAOC,GACjCse,KAAKsD,YAAY7hB,EAAOC,KAIpB6hB,EAAU,CACdlD,MAAOL,KAAKwD,cAAcf,EAAa,qBACvCnC,UAAWN,KAAKwD,cAAcd,EAAiB,oBAC/CnC,UAAWP,KAAKwD,cAAcb,EAAiB,kBAC/CnC,YAAaR,KAAKwD,cAAcZ,EAAmB,qBACnDnC,gBAAiBT,KAAKwD,cAAcX,EAAuB,uBAC3DnC,OAAQV,KAAKwD,cAAcV,EAAc,eAI3C9C,KAAKI,MAAQ,CACXC,MAAOkD,EAAQlD,MAAMpS,KACrBqS,UAAWiD,EAAQjD,UAAUrS,KAC7BsS,UAAWgD,EAAQhD,UAAUtS,KAC7BuS,YAAa+C,EAAQ/C,YAAYvS,KACjCwS,gBAAiB8C,EAAQ9C,gBAAgBxS,KACzCyS,OAAQ6C,EAAQ7C,OAAOzS,MAIzB+R,KAAK+B,oBAUL,OAPe9Z,OAAOwb,QAAQF,GAC3Bpe,OAAOue,IAAA,IAAEC,EAAG5f,GAAO2f,EAAA,OAAM3f,EAAO6f,UAChC/c,IAAIgd,IAAA,IAAEroB,GAAIqoB,EAAA,OAAKroB,IAEPgL,OAGJwZ,KAAKI,KACd,CAKA,gBAAM6C,CAAWxhB,EAAOC,EAAU8gB,GAAkB,IAADsB,EAAAC,EACd,QAAnCD,GAAAC,EAAA/D,KAAKc,gBAAeS,uBAAe,IAAAuC,GAAnCA,EAAAE,KAAAD,GAAsC,GAEtC,IACE,MAAM1D,QAAc4D,EAAAA,GAAAA,IAAc,CAAExiB,QAAOC,aAO3C,OAJiB8gB,EACbnC,GAAS,IACRA,GAAS,IAAIlb,OAAO+e,GAAyB,IAAjBA,EAAKC,SAAkC,MAAjBD,EAAKC,QAI9D,CAAE,MAAOlgB,GACP,MAAO,EACT,CAAC,QAAU,IAADmgB,EAAAC,EAC2B,QAAnCD,GAAAC,EAAArE,KAAKc,gBAAeS,uBAAe,IAAA6C,GAAnCA,EAAAJ,KAAAK,GAAsC,EACxC,CACF,CAKA,oBAAMnB,CAAezhB,EAAOC,GAAW,IAAD4iB,EAAAC,EACG,QAAvCD,GAAAC,EAAAvE,KAAKc,gBAAeU,2BAAmB,IAAA8C,GAAvCA,EAAAN,KAAAO,GAA0C,GAE1C,IACE,MAGMC,SAHkBC,EAAAA,GAAAA,IAAe,CAAEhjB,QAAOC,cAGnB,IAAIyD,OAAOuf,QACpBhF,IAAdgF,EAAEP,SAAuC,OAAdO,EAAEP,UACZ,IAAdO,EAAEP,SAA+B,MAAdO,EAAEP,UAmB9B,OAfkBK,EAAO3d,IAAI8d,IAC3B,MAAMC,EAAiBD,EAASE,WAAaF,EAASE,WAAa,IAAM,GACnEC,EAAYH,EAASI,OAAS,GAC9BC,EAAeL,EAASM,UAAY,GACpCC,EAAeP,EAASQ,SAAW,KAAOR,EAASQ,SAAW,GAC9D5W,EAAc,GAAAK,OAAGgW,GAAchW,OAAGkW,EAAS,KAAAlW,OAAIoW,GAAYpW,OAAGsW,GAAeE,QAAQ,OAAQ,KAAKrd,QAAU4c,EAASjjB,UAAQ,QAAAkN,OAAY+V,EAAS9V,IAAM8V,EAAStX,SAEvK,OAAAvI,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACK6f,GAAQ,IACXpW,cACA9P,MAAO8P,EACP3J,MAAO+f,EAAS9V,IAAM8V,EAAStX,WAMrC,CAAE,MAAOpJ,GACP,MAAO,EACT,CAAC,QAAU,IAADohB,EAAAC,EAC+B,QAAvCD,GAAAC,EAAAtF,KAAKc,gBAAeU,2BAAmB,IAAA6D,GAAvCA,EAAArB,KAAAsB,GAA0C,EAC5C,CACF,CAKA,oBAAMnC,CAAe1hB,EAAOC,GAAW,IAAD6jB,EAAAC,EACG,QAAvCD,GAAAC,EAAAxF,KAAKc,gBAAeW,2BAAmB,IAAA8D,GAAvCA,EAAAvB,KAAAwB,GAA0C,GAE1C,IAEE,aADwBC,EAAAA,GAAAA,IAAe,CAAEhkB,QAAOC,cAC5B,EAEtB,CAAE,MAAOuC,GACP,MAAO,EACT,CAAC,QAAU,IAADyhB,EAAAC,EAC+B,QAAvCD,GAAAC,EAAA3F,KAAKc,gBAAeW,2BAAmB,IAAAiE,GAAvCA,EAAA1B,KAAA2B,GAA0C,EAC5C,CACF,CAKA,sBAAMvC,CAAiB3hB,EAAOC,GAAW,IAADkkB,EAAAC,EACG,QAAzCD,GAAAC,EAAA7F,KAAKc,gBAAeY,6BAAqB,IAAAkE,GAAzCA,EAAA5B,KAAA6B,GAA4C,GAE5C,IACE,MAAMrF,QAAoBsF,EAAAA,GAAAA,IAAsB,CAAErkB,QAAOC,aACzD,OAAI6C,MAAMC,QAAQgc,IACZA,EAAYha,OAETga,GAEA,EAGX,CAAE,MAAOvc,GACP,MAAO,EACT,CAAC,QAAU,IAAD8hB,EAAAC,EACiC,QAAzCD,GAAAC,EAAAhG,KAAKc,gBAAeY,6BAAqB,IAAAqE,GAAzCA,EAAA/B,KAAAgC,GAA4C,EAC9C,CACF,CAKA,0BAAM3C,CAAqB5hB,EAAOC,GAAW,IAADukB,EAAAC,EACG,QAA7CD,GAAAC,EAAAlG,KAAKc,gBAAea,iCAAyB,IAAAsE,GAA7CA,EAAAjC,KAAAkC,GAAgD,GAEhD,IACE,MAAMC,QAAiBC,EAAAA,GAAAA,IAAqB,CAAE3kB,QAAOC,aAE/C2kB,EAAQ9hB,MAAMC,QAAQ2hB,GAAYA,EAAW,GAInD,OAHIE,EAAM7f,OAGH6f,CAET,CAAE,MAAOpiB,GACP,MAAO,EACT,CAAC,QAAU,IAADqiB,EAAAC,EACqC,QAA7CD,GAAAC,EAAAvG,KAAKc,gBAAea,iCAAyB,IAAA2E,GAA7CA,EAAAtC,KAAAuC,GAAgD,EAClD,CACF,CAKA,iBAAMjD,CAAY7hB,EAAOC,GAAW,IAAD8kB,EAAAC,EACG,QAApCD,GAAAC,EAAAzG,KAAKc,gBAAec,wBAAgB,IAAA4E,GAApCA,EAAAxC,KAAAyC,GAAuC,GAEvC,IAEE,aADqBC,EAAAA,GAAAA,IAAwB,CAAEjlB,QAAOC,cACrC,EAEnB,CAAE,MAAOuC,GACP,MAAO,EACT,CAAC,QAAU,IAAD0iB,EAAAC,EAC4B,QAApCD,GAAAC,EAAA5G,KAAKc,gBAAec,wBAAgB,IAAA+E,GAApCA,EAAA3C,KAAA4C,GAAuC,EACzC,CACF,CAKApD,aAAAA,CAAczf,EAAQyK,GACpB,MAAsB,cAAlBzK,EAAO8iB,aAA2CnH,IAAjB3b,EAAOa,OAAwC,OAAjBb,EAAOa,MACjE,CACLgf,SAAS,EACT3V,KAAMlK,EAAOa,OAGR,CACLgf,SAAS,EACT3V,KAAM,GAGZ,CAMA8T,iBAAAA,GAEwD,IAAD+E,EAAAC,EAGQC,EAAAC,EAGAC,EAAAC,EAGIC,EAAAC,EAGQC,EAAAC,EAGlBC,EAAAC,EAfnDzH,KAAK0H,gBAAgB,QAAS1H,KAAKI,MAAMC,SACZ,QAA/ByG,GAAAC,EAAA/G,KAAKc,gBAAeG,mBAAW,IAAA6F,GAA/BA,EAAA9C,KAAA+C,EAAkC/G,KAAKI,MAAMC,QAE3CL,KAAK0H,gBAAgB,YAAa1H,KAAKI,MAAME,aACf,QAAhC0G,GAAAC,EAAAjH,KAAKc,gBAAeI,oBAAY,IAAA8F,GAAhCA,EAAAhD,KAAAiD,EAAmCjH,KAAKI,MAAME,YAE5CN,KAAK0H,gBAAgB,YAAa1H,KAAKI,MAAMG,aACR,QAAvC2G,GAAAC,EAAAnH,KAAKc,gBAAeK,2BAAmB,IAAA+F,GAAvCA,EAAAlD,KAAAmD,EAA0CnH,KAAKI,MAAMG,YAEnDP,KAAK0H,gBAAgB,cAAe1H,KAAKI,MAAMI,eACR,QAAzC4G,GAAAC,EAAArH,KAAKc,gBAAeM,6BAAqB,IAAAgG,GAAzCA,EAAApD,KAAAqD,EAA4CrH,KAAKI,MAAMI,cAErDR,KAAK0H,gBAAgB,kBAAmB1H,KAAKI,MAAMK,mBACR,QAA7C6G,GAAAC,EAAAvH,KAAKc,gBAAeO,iCAAyB,IAAAiG,GAA7CA,EAAAtD,KAAAuD,EAAgDvH,KAAKI,MAAMK,kBAEzDT,KAAK0H,gBAAgB,SAAU1H,KAAKI,MAAMM,UACR,QAApC8G,GAAAC,EAAAzH,KAAKc,gBAAeQ,wBAAgB,IAAAkG,GAApCA,EAAAxD,KAAAyD,EAAuCzH,KAAKI,MAAMM,QAEtD,CAKAgH,eAAAA,CAAgBlsB,EAAKmsB,GACnB,MAAMC,EAAO,SAAAhZ,OAAYpT,GACnBqsB,EAAW7H,KAAK4H,GAGtB,OAAKC,EAMDA,EAASrhB,SAAWmhB,EAAQnhB,SAC9BwZ,KAAK4H,GAAWD,GACT,IAPP3H,KAAK4H,GAAWD,GACT,EAWX,CAMA,eAAMG,CAASC,GAAiD,IAAhD,MAAEtmB,EAAK,SAAEC,EAAQ,QAAEsmB,EAAO,YAAEC,EAAc,GAAGF,EAE3D,IAGE,MAAMG,QAAcC,EAAAA,GAAAA,YAAWH,EAASvmB,EAAOC,GAAU,GAGzD,IAAKwmB,EACH,MAAM,IAAIE,MAAM,oBAADxZ,OAAkBoZ,EAAO,qBAM1C,GAAIE,EAAM1H,YAAa,CACrB,MAAM7B,EAAYD,GAAgCwJ,EAAM1H,aAExDvY,OAAOogB,OAAOH,EAAOvJ,EACvB,CAOA,OAJIuJ,EAAMI,gBACRJ,EAAMI,cAAgBtK,GAA8BkK,EAAMI,gBAGrDJ,CAET,CAAE,MAAOjkB,GACP,MAAMA,CACR,CACF,CAKAskB,KAAAA,GACEvI,KAAKC,eAAgB,EACrBD,KAAKE,gBAAiB,EACtBF,KAAKG,YAAc,KACnBH,KAAKI,MAAQ,CACXC,MAAO,GACPC,UAAW,GACXC,UAAW,GACXC,YAAa,GACbC,gBAAiB,GACjBC,OAAQ,IAEVV,KAAKW,SAAW,CACdC,aAAc,KACdC,aAAc,KACdle,OAAQ,GAEZ,CAKA6lB,QAAAA,GACE,MAAO,CACLvI,cAAeD,KAAKC,cACpBC,eAAgBF,KAAKE,eACrBE,OAAKtb,EAAAA,EAAAA,GAAA,GAAOkb,KAAKI,OACjBO,UAAQ7b,EAAAA,EAAAA,GAAA,GAAOkb,KAAKW,UAExB,GAIF,MCnca8H,GAAc,SAACC,GAAgC,IAAlBC,EAAOlJ,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,CAAC,EACnD,MAAM,MACJmJ,EAAQ,IAAI,QACZhN,GAAU,EAAI,aACdiN,EAAe,IACbF,EAEEG,GAAa5c,EAAAA,EAAAA,QAAO,MACpB6c,GAAiB7c,EAAAA,EAAAA,SAAO,GACxB8c,GAAkB9c,EAAAA,EAAAA,QAAO,GAMzB+c,GAAiBzT,EAAAA,EAAAA,aAAY,KAC7BsT,EAAWtc,UACb8K,aAAawR,EAAWtc,SACxBsc,EAAWtc,QAAU,KACrBuc,EAAevc,SAAU,IAE1B,IAMG0c,GAAkB1T,EAAAA,EAAAA,aAAY,WAAwB,IAAvB2T,EAAS1J,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,IAAAA,UAAA,GAC5C,IAAK7D,EACH,OAIFqN,IAEA,MAAM/G,EAAMD,KAAKC,MACXkH,EAAoBlH,EAAM8G,EAAgBxc,QAGhD,GAAI2c,GAAaC,GA7BE,IAgCjB,OAFAJ,EAAgBxc,QAAU0V,OAC1BwG,GAAa,GAKfK,EAAevc,SAAU,EACzBsc,EAAWtc,QAAUM,WAAW,KAC9B,MAAMuc,EAAcpH,KAAKC,MACTmH,EAAcL,EAAgBxc,SAvC7B,MA2Cfwc,EAAgBxc,QAAU6c,EAC1BX,GAAa,IAGfK,EAAevc,SAAU,EACzBsc,EAAWtc,QAAU,MACpB2c,EAAY,EAAIP,EACrB,EAAG,CAAChN,EAASgN,EAAOF,EAAcO,KAAmBJ,IAarD,OARAhmB,EAAAA,EAAAA,WAAU,IACD,KACDimB,EAAWtc,SACb8K,aAAawR,EAAWtc,UAG3B,IAEI,CACL0c,kBACAD,iBACAK,YAAaA,IAAMP,EAAevc,QAEtC,E,4BCvEA,MAAM+c,G,SAAgBC,EAAMC,OAAO,CACjCC,QAASC,sCACTC,QAAS,CAAE,eAAgB,sBA6CtB,SAASC,GAA4BC,GAAM,IAADC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAC/C,OAAgB,QAAhBN,EAAID,EAAI3D,gBAAQ,IAAA4D,GAAM,QAANC,EAAZD,EAAc9b,YAAI,IAAA+b,GAAlBA,EAAoB3hB,QAAgByhB,EAAI3D,SAASlY,KAAK5F,QAC1C,QAAhB4hB,EAAIH,EAAI3D,gBAAQ,IAAA8D,GAAM,QAANC,EAAZD,EAAchc,YAAI,IAAAic,GAAlBA,EAAoBjmB,MAAc6lB,EAAI3D,SAASlY,KAAKhK,MACxC,QAAhBkmB,EAAIL,EAAI3D,gBAAQ,IAAAgE,GAAM,QAANC,EAAZD,EAAclc,YAAI,IAAAmc,GAAlBA,EAAoBN,IAAYA,EAAI3D,SAASlY,KAAK6b,IACtC,QAAhBO,EAAIP,EAAI3D,gBAAQ,IAAAkE,GAAZA,EAAcpc,MACiB,kBAAtB6b,EAAI3D,SAASlY,KAA0B6b,EAAI3D,SAASlY,KAE7D6b,EAAIzhB,QAAgByhB,EAAIzhB,QACrB,8DACT,CAguCOvE,eAAewmB,GAAeC,GAuBjC,IAvBkC,MACpC9oB,EAAK,SACLC,EAAQ,SACR8oB,EAAQ,WACRC,EAAa,KAAI,cACjBC,EAAa,OACbC,EAAS,QAAO,mBAChBC,EAAkB,UAClBxP,EAAS,oBACTyP,EAAsB,KAAI,kBAC1BC,EAAoB,KAAI,YACxBC,EAAc,EAAC,iBACfC,EAAmB,KAAI,YACvBC,EAAc,KAAI,iBAClBC,EAAmB,KAAI,2BAEvBlQ,EAA6B,KAAI,iCACjCmQ,EAAmC,KAAI,yBACvC9P,EAA2B,KAAI,kBAE/B+P,EAAoB,KAAI,qBACxBC,EAAuB,KAAI,qBAC3BC,EAAuB,MACxBf,EACC,IAAK9oB,IAAUC,EACb,MAAM,IAAI0mB,MAAM,8GAMlB,IAAKsC,EACH,MAAM,IAAItC,MAAM,mDAGlB,IAAKwC,EACH,MAAM,IAAIxC,MAAM,qDAGlB,IAAKhN,EACH,MAAM,IAAIgN,MAAM,gDAGlB,IACE,MAAMmD,EAAU,CACd7pB,WACAD,QACAipB,cAAepd,OAAOod,GACtBC,OAAQrd,OAAOqd,GACfC,qBACAxP,UAAW9N,OAAO8N,GAClB2P,YAAaS,OAAOT,IAIlBF,IACFU,EAAQV,oBAAsBA,GAG5BC,IACFS,EAAQT,kBAAoBA,GAG1BE,IACFO,EAAQP,iBAAmB1d,OAAO0d,IAGhCC,IACFM,EAAQN,YAAc3d,OAAO2d,IAG3BC,IACFK,EAAQL,iBAAmBA,GAIzBlQ,IACFuQ,EAAQvQ,2BAA6BA,GAGnCmQ,IACFI,EAAQJ,iCAAmC7d,OAAO6d,IAGhD9P,IACFkQ,EAAQlQ,yBAA2B/N,OAAO+N,IAIxC+P,IACFG,EAAQH,kBAAoBI,OAAOJ,IAGjCC,IACFE,EAAQF,qBAAuBA,GAG7BC,IACFC,EAAQD,qBAAuBA,GAI7Bb,IACFc,EAAQd,WAAae,OAAOf,IAI9B,MAAMgB,EAAWjB,EAAQ,YAAA5b,OACT4b,EAAQ,oBACpB,2BAGAA,IACFe,EAAQG,cAAgBF,OAAOhB,IAGjC,MAAMrE,QAAiBoD,GAAcoC,KACnCF,EACAF,EACA,CAAEK,QAAS,MAGb,GAAwB,MAApBzF,EAASU,QAAsC,MAApBV,EAASU,OAAgB,CACtD,MAAM5iB,EAAK,gDAAA2K,OAAgCuX,EAASU,QACpD,MAAM,IAAIuB,MAAMnkB,EAClB,CAEA,MAAMgK,EAAOkY,EAASlY,KAEtB,GAAoB,UAAhBA,EAAK4Y,OACP,MAAM,IAAIuB,MAAMna,EAAK5F,SAAW,+CAGlC,GAAoB,OAAhB4F,EAAK4Y,OACP,OAAO5Y,EAGT,MAAM,IAAIma,MAAM,4DAElB,CAAE,MAAOnkB,GACP,MAAM,IAAImkB,MAAMyB,GAA4B5lB,GAC9C,CACF,CAmGOH,eAAe+nB,GAAgBC,EAAWrqB,EAAOC,GAA+B,IAArBqqB,EAAUtM,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,IAAAA,UAAA,GAC1E,IAAKhe,IAAUC,EACb,MAAM,IAAI0mB,MAAM,8GAGlB,IAAK0D,EACH,MAAM,IAAI1D,MAAM,wBAGlB,IACE,MAAMmD,EAAU,CACd9pB,QACAC,WACAsqB,YAAaD,EAAa,EAAI,GAI1B5F,QAAiBoD,GAAc0C,OAAO,qBAADrd,OAAsBkd,GAAa,CAC5E7d,KAAMsd,EACNK,QAAS,MAGX,GAAwB,MAApBzF,EAASU,QAAsC,MAApBV,EAASU,OACtC,MAAM,IAAIuB,MAAM,6EAGlB,MAAMna,EAAOkY,EAASlY,KAGtB,GAAoB,UAAhBA,EAAK4Y,QAAsB5Y,EAAK6b,KAAO7b,EAAKhK,MAAO,CACrD,MAAMioB,EAAWje,EAAK5F,SAAW4F,EAAK6b,KAAO7b,EAAKhK,OAAS,sCAC3D,MAAM,IAAImkB,MAAM8D,EAClB,CAEA,GAAoB,OAAhBje,EAAK4Y,SAAoC,IAAjB5Y,EAAK2V,SAAwC,MAApBuC,EAASU,OAC5D,OAAO5Y,EAGT,MAAM,IAAIma,MAAM,4DAElB,CAAE,MAAOnkB,GACP,MAAM,IAAImkB,MAAMyB,GAA4B5lB,GAC9C,CACF,CA9iDAslB,GAAc4C,aAAahG,SAASiG,IACjCjG,GAAaA,EACbliB,IAAW,IAADooB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAKT,IAFoC,QAAZN,EAAApoB,EAAM2oB,cAAM,IAAAP,GAAK,QAALC,EAAZD,EAAcQ,WAAG,IAAAP,OAAL,EAAZA,EAAmBpnB,SAAS,iBAA6B,QAAhBqnB,EAAItoB,EAAM2oB,cAAM,IAAAL,GAAK,QAALC,EAAZD,EAAcM,WAAG,IAAAL,OAAL,EAAZA,EAAmBtnB,SAAS,YAI/F,OAAO6d,QAAQ+J,OAAO7oB,GAKxB,IAA+B,OAAb,QAAdwoB,EAAAxoB,EAAMkiB,gBAAQ,IAAAsG,OAAA,EAAdA,EAAgB5F,SAA6C,OAAb,QAAd6F,EAAAzoB,EAAMkiB,gBAAQ,IAAAuG,OAAA,EAAdA,EAAgB7F,UAC9B,qBAAXja,OAAwB,CACjC,MAAMoN,EAAQ,IAAI+S,YAAY,YAAa,CACzCC,OAAQ,CAAE3kB,QAAS,4FAErBuE,OAAOqgB,cAAcjT,EACvB,CAIF,MAAMkT,GAA6B,QAAdP,EAAA1oB,EAAMkiB,gBAAQ,IAAAwG,OAAA,EAAdA,EAAgB1e,OAAQ,GAC7C,GAA4B,kBAAjBif,GAA6BA,EAAahoB,SAAS,cACtC,qBAAX0H,OAAwB,CACjC,MAAMoN,EAAQ,IAAI+S,YAAY,YAAa,CACzCC,OAAQ,CAAE3kB,QAAS,uGAErBuE,OAAOqgB,cAAcjT,EACvB,CAGF,OAAO+I,QAAQ+J,OAAO7oB,K,uCCzDnB,MAAMkpB,GAAkB,CAC7BC,KAAM,CACJC,KAAM,OACN7e,KAAM,UACN8e,YAAa,0EACb/mB,MAAO,UACPV,KAAM,eACNqM,MAAO,SAETqb,sBAAuB,CACrBF,KAAM,wBACN7e,KAAM,qBACN8e,YAAa,sEACb/mB,MAAO,UACPV,KAAM,SACNqM,MAAO,YAETsb,UAAW,CACTH,KAAM,YACN7e,KAAM,kBACN8e,YAAa,4EACb/mB,MAAO,UACPV,KAAM,SACNqM,MAAO,YAETub,UAAW,CACTJ,KAAM,YACN7e,KAAM,eACN8e,YAAa,iDACb/mB,MAAO,UACPV,KAAM,SACNqM,MAAO,YAETwb,eAAgB,CACdL,KAAM,iBACN7e,KAAM,+BACN8e,YAAa,0EACb/mB,MAAO,UACPV,KAAM,eACNqM,MAAO,oBAETyb,UAAW,CACTN,KAAM,YACN7e,KAAM,2BACN8e,YAAa,+DACb/mB,MAAO,UACPV,KAAM,SACNqM,MAAO,sBAET0b,UAAW,CACTP,KAAM,YACN7e,KAAM,oBACN8e,YAAa,mEACb/mB,MAAO,UACPV,KAAM,eACNqM,MAAO,aAET2b,QAAS,CACPR,KAAM,UACN7e,KAAM,eACN8e,YAAa,gEACb/mB,MAAO,UACPV,KAAM,qBACNqM,MAAO,aAET4b,aAAc,CACZT,KAAM,eACN7e,KAAM,kBACN8e,YAAa,8DACb/mB,MAAO,UACPV,KAAM,eACNqM,MAAO,gBA+BE6b,GAAoBC,IAC/B,MAAMC,EAAQd,GAAgBa,GAC9B,OAAOC,EAAQA,EAAM/b,MAAQ,SC9FzBgc,IDwM+BjmB,OAAOkmB,OAAOhB,ICxM9B,CACnBxe,QAAS,kCACTyf,mBAAoB,SACpBC,YAAa,mBACblT,eAAgB,6BAChBmN,cAAe,iBACfvD,MAAO,uBACPuJ,MAAO,qBACPvrB,gBAAiB,sBACjBE,iBAAkB,oBAClBE,cAAe,sBACforB,kBAAmB,wBACnBC,oBAAqB,qBACrBC,mBAAoB,6BACpB7P,mBAAoB,gCACpBG,OAAQ,YACRC,cAAe,wBACfC,iBAAkB,8BAClBC,uBAAwB,mCACxBC,sBAAuB,gCACvBC,uBAAwB,wCACxBC,0BAA2B,wCAC3BqP,eAAgB,uBAChBC,mBAAoB,mBACpBC,sBAAuB,8BACvBC,2BAA4B,2BAC5BC,cAAe,qBACfC,aAAc,kBACdC,cAAe,qCACfC,aAAc,wBACdC,kBAAmB,4BAWRC,GAAuB,SAACnc,GAA2D,IAADoc,EAAAC,EAAA,IAAhDC,EAAY7P,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,OAAQ8P,EAAa9P,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,KACpF,MAAM9c,EAAS,CAAC,EACV6sB,ED6D0BF,KAGhC,MAAMG,EAAa,CAAC,UAAW,iBAAkB,gBAAiB,qBAAsB,cAAe,sBAEvG,OAAQH,GACN,IAAK,OA2CL,QACE,OAAOG,EAzCT,IAAK,wBACH,MAAO,IACFA,EACH,qBACA,cACA,QACA,SAGJ,IAAK,YACH,MAAO,IACFA,EACH,qBACA,cACA,QACA,QACA,kBACA,eAEA,kBACA,mBACA,gBAIA,sBACA,sBAGJ,IAAK,iBACH,MAAO,IACFA,EACH,qBACA,cACA,QACA,QACA,kBACA,uBC3GiBC,CAAkBJ,GA2BnCK,EAAiB,CAErBhhB,QAAS,SACTyf,mBAAoB,SACpBC,YAAa,SACblT,eAAgB,SAChBmN,cAAe,SACfvD,MAAO,SACPuJ,MAAO,SAGP1P,mBAAoB,cACpBG,OAAQ,cACRC,cAAe,cACfC,iBAAkB,cAClBC,uBAAwB,cACxBC,sBAAuB,cACvBC,uBAAwB,cACxBC,0BAA2B,cAG3Btc,gBAAiB,SACjBE,iBAAkB,SAClBE,cAAe,SACforB,kBAAmB,SACnBC,oBAAqB,SACrBC,mBAAoB,SAGpBC,eAAgB,YAChBG,2BAA4B,YAC5BC,cAAe,YACfC,aAAc,YAGdJ,mBAAoB,SACpBC,sBAAuB,UAKnBgB,EAAsB,MAC1B,MAAMC,EAAS7c,EAAS4L,mBACxB,IAAKiR,EAAQ,OAAO,EAEpB,GAAsB,kBAAXA,EACT,OAAOA,EAAOC,cAAc5qB,SAAS,YAEvC,GAAsB,kBAAX2qB,GAAkC,OAAXA,EAAiB,CAEjD,OADcA,EAAO/P,aAAe+P,EAAO/sB,OAAS,IACvCgtB,cAAc5qB,SAAS,WACtC,CACA,OAAO,CACR,EAZ2B,GAkNyC,IAAD6qB,EAOtCC,EA0BwCC,EAAAC,GArOtEV,EAAe1U,QAAQnW,IAAU,IAADwrB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAK9B,GApF0BC,EAACC,EAAY1V,KACvC,IAAKiU,IAAkByB,EAAY,OAAO,EAE1C,MAAMtV,EAAe6T,EAAcyB,GACnC,IAAKtV,EAAc,OAAO,EAQ1B,GAJ6B,CAC3B,kBAAmB,mBAAoB,gBAAiB,oBACxD,cAAe,iBAAkB,qBAAsB,UAAW,iBAE3CxW,SAASoW,GAEhC,OADuBI,EAAaC,QAOtC,OADuBD,EAAaC,UAAYD,EAAauV,QAiExDF,CAHcpB,EAAehrB,GAGGA,MAKjCirB,IAAuB,CAAC,kBAAmB,mBAAoB,gBAAiB,qBAAqB1qB,SAASP,IAIlH,OAAQA,GACN,IAAK,UACkB,QAAjBwrB,EAACnd,EAASrE,eAAO,IAAAwhB,GAAhBA,EAAkBpoB,SACrBpF,EAAOgM,QAAO,GAAAC,OAAMsf,GAAavf,QAAO,8EAE1C,MAEF,IAAK,mBACEqE,EAASmI,gBAAkBnI,EAASmI,gBAAkB,KACzDxY,EAAOwY,eAAc,GAAAvM,OAAMsf,GAAa/S,eAAc,uFAExD,MAEF,IAAK,kBACEnI,EAASsV,eACT/jB,MAAMC,QAAQwO,EAASsV,gBAAoD,IAAlCtV,EAASsV,cAAc9hB,UACnE7D,EAAO2lB,cAAa,GAAA1Z,OAAMsf,GAAa5F,cAAa,0FAEtD,MAEF,IAAK,qBACEtV,EAASob,oBAAsD,KAAhCpb,EAASob,qBAC3CzrB,EAAOyrB,mBAAkB,GAAAxf,OAAMsf,GAAaE,mBAAkB,qEAEhE,MAEF,IAAK,cACEpb,EAASqb,aAAwC,KAAzBrb,EAASqb,cACpC1rB,EAAO0rB,YAAW,GAAAzf,OAAMsf,GAAaG,YAAW,qEAElD,MAEF,IAAK,QACgB,QAAf+B,EAACpd,EAAS+R,aAAK,IAAAqL,GAAdA,EAAgBroB,QAA6B,cAAnBiL,EAAS+R,QACtCpiB,EAAOoiB,MAAK,GAAAnW,OAAMsf,GAAanJ,MAAK,sEAEtC,MAEF,IAAK,QACgB,QAAfsL,EAACrd,EAASsb,aAAK,IAAA+B,GAAdA,EAAgBtoB,OAET,6BAA6BC,KAAKgL,EAASsb,SACrD3rB,EAAO2rB,MAAQ,iFAFf3rB,EAAO2rB,MAAK,GAAA1f,OAAMsf,GAAaI,MAAK,sDAItC,MAEF,IAAK,kBAC0B,QAAzBgC,EAACtd,EAASjQ,uBAAe,IAAAutB,GAAxBA,EAA0BvoB,SAC7BpF,EAAOI,gBAAe,GAAA6L,OAAMsf,GAAanrB,gBAAe,uDAE1D,MAEF,IAAK,mBAE2B,QAA1BwtB,EAACvd,EAAS/P,wBAAgB,IAAAstB,GAAzBA,EAA2BxoB,SAC9BpF,EAAOM,iBAAgB,GAAA2L,OAAMsf,GAAajrB,iBAAgB,yDAE5D,MAEF,IAAK,gBACwB,QAAvButB,EAACxd,EAAS7P,qBAAa,IAAAqtB,GAAtBA,EAAwBzoB,SAC3BpF,EAAOQ,cAAa,GAAAyL,OAAMsf,GAAa/qB,cAAa,oEAEtD,MAEF,IAAK,sBAC8B,QAA7BstB,EAACzd,EAASwb,2BAAmB,IAAAiC,GAA5BA,EAA8B1oB,SACjCpF,EAAO6rB,oBAAmB,GAAA5f,OAAMsf,GAAaM,oBAAmB,+CAElE,MAEF,IAAK,qBACH,GAAKxb,EAASyb,oBAA6D,IAAvCzb,EAASyb,mBAAmBjoB,OAEzD,CAEL,IAAI0qB,GAAe,EACnBle,EAASyb,mBAAmB3T,QAAQ,CAACqW,EAASC,KAAW,IAADC,EAEpC,QAAdA,EAACF,EAAQG,aAAK,IAAAD,GAAbA,EAAetpB,SAClBpF,EAAO,WAADiM,OAAYwiB,EAAK,WAAS,gBAAAxiB,OAAcwiB,EAAQ,EAAC,mDACvDF,GAAe,KAGZC,EAAQI,cAAgBrW,WAAWiW,EAAQI,eAAiB,KAC/D5uB,EAAO,WAADiM,OAAYwiB,EAAK,kBAAgB,gBAAAxiB,OAAcwiB,EAAQ,EAAC,yEAC9DF,GAAe,KAGZC,EAAQK,YAActW,WAAWiW,EAAQK,aAAe,KAC3D7uB,EAAO,WAADiM,OAAYwiB,EAAK,gBAAc,gBAAAxiB,OAAcwiB,EAAQ,EAAC,uEAC5DF,GAAe,KAIfA,IACFvuB,EAAO8rB,mBAAqB,wGAEhC,MAzBE9rB,EAAO8rB,mBAAkB,GAAA7f,OAAMsf,GAAaO,mBAAkB,wEA0BhE,MAEF,IAAK,oBAC4B,QAA3BiC,EAAC1d,EAASub,yBAAiB,IAAAmC,GAA1BA,EAA4B3oB,SAC/BpF,EAAO4rB,kBAAiB,GAAA3f,OAAMsf,GAAaK,kBAAiB,+DAE9D,MAEF,IAAK,kBAE8B,QAA7BoC,EAAC3d,EAASwb,2BAAmB,IAAAmC,GAA5BA,EAA8B5oB,SACjCpF,EAAO6rB,oBAAmB,GAAA5f,OAAMsf,GAAaM,oBAAmB,+CAElE,MAEF,IAAK,cACL,IAAK,qBAGExb,EAAS4L,qBAC8B,kBAAhC5L,EAAS4L,oBAAoC5L,EAAS4L,mBAAmB7W,UACnFpF,EAAOic,mBAAkB,GAAAhQ,OAAMsf,GAAatP,mBAAkB,qDAEhE,MAEF,IAAK,SACE5L,EAAS+L,SACTxa,MAAMC,QAAQwO,EAAS+L,QAAqC,IAA3B/L,EAAS+L,OAAOvY,OACrB,kBAApBwM,EAAS+L,OAAuB/L,EAAS+L,OAAOhX,OAAUiL,EAAS+L,UAC9Epc,EAAOoc,OAAM,GAAAnQ,OAAMsf,GAAanP,OAAM,iFAExC,MAEF,IAAK,gBAGwB,QAAvB6R,EAAC5d,EAASgM,qBAAa,IAAA4R,GAAtBA,EAAwB7oB,SAC3BpF,EAAOqc,cAAa,GAAApQ,OAAMsf,GAAalP,cAAa,qEAEtD,MAEF,IAAK,yBAGiC,QAAhC6R,EAAC7d,EAASkM,8BAAsB,IAAA2R,GAA/BA,EAAiC9oB,SACpCpF,EAAOuc,uBAAsB,GAAAtQ,OAAMsf,GAAahP,uBAAsB,8DAExE,MAEF,IAAK,yBAGiC,QAAhC4R,EAAC9d,EAASoM,8BAAsB,IAAA0R,GAA/BA,EAAiC/oB,SACpCpF,EAAOyc,uBAAsB,GAAAxQ,OAAMsf,GAAa9O,uBAAsB,sEAiBzD,cAAjBkQ,GAA4D,QAA5BF,EAACpc,EAAS2b,0BAAkB,IAAAS,GAA3BA,EAA6BrnB,SAChEpF,EAAOgsB,mBAAkB,GAAA/f,OAAMsf,GAAaS,mBAAkB,4DAI/B,gBAA5B3b,EAASye,gBAAgE,YAA5Bze,EAASye,gBAC3B,QAA5BpC,EAACrc,EAAS2b,0BAAkB,IAAAU,GAA3BA,EAA6BtnB,SAChCpF,EAAOgsB,mBAAiD,gBAA5B3b,EAASye,eAAgC,GAAA7iB,OAC9Dsf,GAAaS,mBAAkB,gEAAA/f,OAC/Bsf,GAAaS,mBAAkB,+DAIpC3b,EAAS0e,eAAmD,KAAlC1e,EAAS0e,cAAc3pB,UACvB,QAAxBgoB,EAAC/c,EAAS0b,sBAAc,IAAAqB,GAAvBA,EAAyBhoB,SAC5BpF,EAAO+rB,eAAc,GAAA9f,OAAMsf,GAAaQ,eAAc,8DAKtD1b,EAAS2e,kBACwB,QAA/B3B,EAAChd,EAAS4b,6BAAqB,IAAAoB,GAA9BA,EAAgCjoB,SACnCpF,EAAOisB,sBAAqB,GAAAhgB,OAAMsf,GAAaU,sBAAqB,sEAQxE,IAAmC,IAA/B5b,EAASkc,mBAA6D,IAA/Blc,EAASkc,kBAAyB,CAE3E,MAAM0C,EAA8B,OAAbrC,QAAa,IAAbA,OAAa,EAAbA,EAAesC,yBACPD,GAAmBA,EAAejW,UAAYiW,EAAeX,UAGrFje,EAASgc,eAAkB1hB,OAAO0F,EAASgc,eAAejnB,SAC7DpF,EAAOqsB,cAAgB,yGAEpBhc,EAASic,cAAiB3hB,OAAO0F,EAASic,cAAclnB,SAC3DpF,EAAOssB,aAAe,iGAG5B,CAGIjc,EAAS8e,gBAAqD,KAAnC9e,EAAS8e,eAAe/pB,SACxB,QAAzBkoB,EAACjd,EAAS+e,uBAAe,IAAA9B,GAAxBA,EAA0BloB,SAC7BpF,EAAOovB,gBAAe,GAAAnjB,OAAMsf,GAAa6D,gBAAe,wDAI/B,QAAvB7B,EAACld,EAASgf,qBAAa,IAAA9B,GAAtBA,EAAwBnoB,SAC3BpF,EAAOqvB,cAAa,GAAApjB,OAAMsf,GAAa8D,cAAa,qEAIjDhf,EAASif,0BAA4B/W,WAAWlI,EAASif,2BAA6B,KACzFtvB,EAAOsvB,yBAAwB,GAAArjB,OAAMsf,GAAa+D,yBAAwB,+GAEvEjf,EAASkf,wBAA0BhX,WAAWlI,EAASkf,yBAA2B,KACrFvvB,EAAOuvB,uBAAsB,GAAAtjB,OAAMsf,GAAagE,uBAAsB,oIAI1E,OAAOvvB,CACT,EAQawvB,GAAuB,WAAgE,IAAxCC,EAAU3S,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,EAEvE,GAFoFA,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,IAAAA,UAAA,GAGlF,MAAO,CACL4S,YAAY,EACZC,WAAW,EACX9R,aAAa,EACb+R,WAAW,EACXC,SAAS,EACTC,SAAS,EACTC,iBAAiB,EACjBhB,eAAe,GAInB,MAAMiB,ED9O2BrD,KACjC,MAAMsD,EAAe,CAAC,aAAc,aAEpC,OAAQtD,GACN,IAAK,OAGL,IAAK,wBAiBL,IAAK,YAML,QACE,OAAOsD,EArBT,IAAK,YACL,IAAK,iBACL,IAAK,YACL,IAAK,YACH,MAAO,IACFA,EACH,cACA,YACA,UACA,UACA,kBACA,iBAMJ,IAAK,UACH,MAAO,IAAIA,EAAc,mBCkNLC,CAfuBpT,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,QAkB5CqT,EAAiB,CACrBT,WAAYM,EAAgBztB,SAAS,cACrCotB,UAAWK,EAAgBztB,SAAS,cAMhC6tB,EAAqB,CACzBvS,YAAamS,EAAgBztB,SAAS,eACtCqtB,UAAWH,GAAc,GAAKO,EAAgBztB,SAAS,aACvDstB,QAASJ,GAAc,GAAKO,EAAgBztB,SAAS,WACrDutB,QAASL,GAAc,GAAKO,EAAgBztB,SAAS,WACrDwtB,gBAAiBN,GAAc,GAAKO,EAAgBztB,SAAS,mBAC7DwsB,cAAeU,GAAc,GAAKO,EAAgBztB,SAAS,kBAG7D,OAAAJ,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKguB,GACAC,EAEP,E,uDCnasB,qBAAXnmB,SACJA,OAAOomB,+BACVpmB,OAAOomB,6BAA+B,MAEnCpmB,OAAOqmB,4BACVrmB,OAAOqmB,2BAA4B,IAIhC,MAAMC,GAAoBryB,IAS1B,IAT2B,MAChCY,EAAK,SACLC,EAAQ,OACRyxB,EAAM,YACNC,EAAW,iBACXC,EAAgB,aAChBC,EAAY,QACZC,EAAO,QACPC,GACD3yB,EACC,MAAM4yB,ECrBwBC,MAC9B,MAAOzF,EAAO0F,IAAYC,EAAAA,EAAAA,YAAWC,GAAAA,GAAkBC,GAAAA,IAKjDC,GAAwBve,EAAAA,EAAAA,aAAY,KACxCme,EAAS,CAAEh2B,KAAMq2B,GAAAA,GAAkBC,2BAClC,IAKGC,GAAqB1e,EAAAA,EAAAA,aAAY,KACrCme,EAAS,CAAEh2B,KAAMq2B,GAAAA,GAAkBG,uBAClC,IAKGC,GAAgB5e,EAAAA,EAAAA,aAAY,KAChCme,EAAS,CAAEh2B,KAAMq2B,GAAAA,GAAkBK,mBAClC,IAKGC,GAAa9e,EAAAA,EAAAA,aAAY,KAC7Bme,EAAS,CAAEh2B,KAAMq2B,GAAAA,GAAkBO,eAClC,IAKGC,GAAWhf,EAAAA,EAAAA,aAAY,KAC3Bme,EAAS,CAAEh2B,KAAMq2B,GAAAA,GAAkBS,SAClC,IAKGC,GAAWlf,EAAAA,EAAAA,aAAavR,IAC5B0vB,EAAS,CAAEh2B,KAAMq2B,GAAAA,GAAkBW,MAAOpJ,QAAStnB,KAClD,IAKGskB,GAAQ/S,EAAAA,EAAAA,aAAY,KACxBme,EAAS,CAAEh2B,KAAMq2B,GAAAA,GAAkBY,SAClC,IAEH,MAAO,CAEL1iB,MAAO+b,EAAM/b,MACbgO,eAAgB+N,EAAM/N,eACtB2U,sBAAuB5G,EAAM4G,sBAC7BC,kBAAmB7G,EAAM6G,kBACzBC,QAAS9G,EAAM8G,QACf9wB,MAAOgqB,EAAMhqB,MACb+wB,aAAc/G,EAAM+G,aAGpBjB,wBACAG,qBACAE,gBACAE,aACAE,WACAE,WACAnM,QAGA0M,UAAY/iB,GAAU+b,EAAM/b,QAAUA,EACtCgjB,YAAaA,IAAMjH,EAAM/b,QAAUijB,GAAAA,GAAiBC,iBDpDpC1B,GACZ2B,GAAeC,EAAAA,GAAAA,GAAgB,CAAE7zB,QAAOC,WAAUka,SAAS,IAC3D2Z,EErB0B10B,KAAwC,IAAvC,MAAEY,EAAK,SAAEC,EAAQ,aAAE2zB,GAAcx0B,EAClE,MAAO20B,EAASC,IAAczzB,EAAAA,EAAAA,WAAS,IAChCiC,EAAOywB,IAAY1yB,EAAAA,EAAAA,UAAS,MAC7B0zB,GAAaxpB,EAAAA,EAAAA,SAAO,GAKpBypB,GAA0BngB,EAAAA,EAAAA,aAAaogB,IAC3C,IAAKA,EAAc,OAAO,KAE1B,MAAM/Q,EAAa+Q,EAAa/Q,YAAc,GACxCE,EAAQ6Q,EAAa7Q,OAAS,GAC9BE,EAAW2Q,EAAa3Q,UAAY,GACpCE,EAAWyQ,EAAazQ,UAAY,GAI1C,MAAO,CACL5W,YAHkB,GAAAK,OAAGiW,EAAaA,EAAa,IAAM,IAAEjW,OAAGmW,EAAK,KAAAnW,OAAIqW,GAAQrW,OAAGuW,EAAW,KAAOA,EAAW,IAAKpd,OAIhHumB,MAAOsH,EAAatH,OAAS,GAC7BuH,QAASD,EAAaC,SAAW,KAElC,IAeGC,GAAqBtgB,EAAAA,EAAAA,aAAY,CAACugB,EAASV,KAAkB,IAADW,EAAAC,EAAAC,EAAAC,EAChE,IAAKJ,EAAS,OAAO,KAGrB,IAAIK,EAAiB,CAAC,EACtB,GAAIL,EAAQM,cAAe,CAAC,IAADC,EAAAC,EAEzB,GAAqB,QAArBD,EAAIP,EAAQS,iBAAS,IAAAF,GAAjBA,EAAmBjE,WAAY,CACjC,MAAMoE,EAAWd,EAAwBI,EAAQS,UAAUnE,YACvDoE,IACFL,EAAiB,CACfrR,MAAO0R,EAASloB,YAChB+f,MAAOmI,EAASnI,MAChBuH,QAASY,EAASZ,SAGxB,CAGA,IAAKO,EAAerR,OAAqB,OAAZsQ,QAAY,IAAZA,GAAkB,QAANkB,EAAZlB,EAAcpnB,YAAI,IAAAsoB,GAAlBA,EAAoBG,SAAU,CACzD,MAAMrE,EAAagD,EAAapnB,KAAKyoB,SAAS9W,KAAK+W,GAChDA,EAAE9nB,IAAM8nB,EAAE9nB,KAAOknB,EAAQM,eACzBM,EAAEtpB,SAAWspB,EAAEtpB,UAAY0oB,EAAQM,eAGtC,GAAIhE,EAAY,CACd,MAAMzN,EAAiByN,EAAWxN,WAAawN,EAAWxN,WAAa,IAAM,GACvEC,EAAYuN,EAAWtN,OAAS,GAChCC,EAAeqN,EAAWpN,UAAY,GACtCC,EAAemN,EAAWlN,SAAW,KAAOkN,EAAWlN,SAAW,GAGxEiR,EAAiB,CACfrR,MAHkB,GAAAnW,OAAGgW,GAAchW,OAAGkW,EAAS,KAAAlW,OAAIoW,GAAYpW,OAAGsW,GAAeE,QAAQ,OAAQ,KAAKrd,QAGhFsqB,EAAW3wB,UAAY,GAC7C4sB,MAAO+D,EAAW/D,OAAS,GAC3BuH,QAASxD,EAAWwD,SAAW,GAEnC,CACF,CACF,CAGA,MAAMe,EAEAryB,MAAMC,QAAQuxB,EAAQzN,eACTyN,EAAQzN,cAAczhB,IAAIsX,GAAO7Q,OAAO6Q,GAAK/P,eAIzC,QAAjByoB,EAAAd,EAAQS,iBAAS,IAAAK,GAAjBA,EAAmBtW,WAAahc,MAAMC,QAAQuxB,EAAQS,UAAUjW,WACnDwV,EAAQS,UAAUjW,UAAU1Z,IAAIiwB,GAAKA,EAAE3Y,IAAI/P,eAGrD,GAIH2oB,EAAoB,MAExB,GAAIhB,EAAQvV,aAA8C,kBAAxBuV,EAAQvV,YACxC,OAAOuV,EAAQvV,YAAYtS,KAAO,GAGpC,GAAI6nB,EAAQvV,aAA8C,kBAAxBuV,EAAQvV,YACxC,IACE,MAAMnC,EAASha,KAAKC,MAAMyxB,EAAQvV,aAClC,OAAOnC,EAAOnQ,KAAOmQ,EAAOC,WAAa,EAC3C,CAAE,MAAO7Z,GACP,OAAOsxB,EAAQnX,oBAAsB,EACvC,CAEF,OAAOmX,EAAQnX,oBAAsB,EACtC,EAfyB,GAfL,IAACiY,EAiCtB,IAAIG,EAAqB,CAAC,EACtBjB,EAAQvV,aAA8C,kBAAxBuV,EAAQvV,cACxCwW,EAAqB,CACnBjY,OAAQgX,EAAQvV,YAAY1B,SAAW,GACvCmY,SAAUlB,EAAQvV,YAAY1d,OAAS,GAEvCo0B,SAAUnB,EAAQvV,YAAY0W,UAAY,GAC1C/F,QAAS4E,EAAQvV,YAAY2Q,SAAW,GACxCgG,UAAWpB,EAAQvV,YAAY2W,WAAa,GAE5CnY,cAAe+W,EAAQ/W,eAAiB+W,EAAQvV,YAAYxB,eAAiB,GAC7EC,iBAAkB8W,EAAQ9W,kBAAoB8W,EAAQvV,YAAYvB,kBAAoB,KAK1F,MAAMC,EAAyB6W,EAAQ7W,uBACnC5R,OAAOyoB,EAAQ7W,wBACK,QAAnB8W,EAAAD,EAAQvV,mBAAW,IAAAwV,GAAnBA,EAAqB9W,uBAAyB5R,OAAOyoB,EAAQvV,YAAYtB,wBAA0B,GAClGC,EAAwB4W,EAAQ5W,wBAA4C,QAAvB8W,EAAIF,EAAQvV,mBAAW,IAAAyV,OAAA,EAAnBA,EAAqB9W,wBAAyB,GACvGC,EAAyB2W,EAAQ3W,yBAA6C,QAAvB8W,EAAIH,EAAQvV,mBAAW,IAAA0V,OAAA,EAAnBA,EAAqB9W,yBAA0B,GAC1GC,EAA4B0W,EAAQ1W,4BAAgD,QAAvB8W,EAAIJ,EAAQvV,mBAAW,IAAA2V,OAAA,EAAnBA,EAAqB9W,4BAA6B,GAGnH+X,EAEuC,kBAAhCrB,EAAQvH,oBACVuH,EAAQvH,oBAGbuH,EAAQvH,qBAA8D,kBAAhCuH,EAAQvH,sBACzCuH,EAAQvH,oBAAoBlQ,WAAayX,EAAQvH,oBAAoBrQ,MAEvE,GAIHkZ,EAAiB,MACrB,IAEE,MAAMC,EAAa/yB,MAAMC,QAAQuxB,EAAQwB,mBACrCxB,EAAQwB,kBACRlzB,KAAKC,MAAMyxB,EAAQwB,mBAAqB,YAE5C,IAAKhzB,MAAMC,QAAQ8yB,IAAqC,IAAtBA,EAAW9wB,OAC3C,MAAO,UAIT,MAAMgxB,EAAaF,EAAWA,EAAW9wB,OAAS,GAC5CixB,EAAWtK,GAAgBqK,GAEjC,OAAIC,EACKA,EAASjpB,KAIXgpB,GAAc,SACvB,CAAE,MAAO/yB,GACP,MAAO,SACT,CACD,EAxBsB,GA2BjBizB,GAAe5yB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAChBixB,GACAK,GAAc,IACjBvnB,GAAIknB,EAAQlnB,GACZ8oB,SAAU5B,EAAQ6B,kBAAoB7B,EAAQ4B,SAC9CJ,kBAAmBxB,EAAQwB,mBAAqB,OAChDM,gBAAiBR,EACjBS,kBAAmB/B,EAAQ+B,oBAAqB,EAIhDC,cAAe,MACb,IACE,MAAMT,EAAa/yB,MAAMC,QAAQuxB,EAAQwB,mBACrCxB,EAAQwB,kBACRlzB,KAAKC,MAAMyxB,EAAQwB,mBAAqB,MACtCS,EAAazzB,MAAMC,QAAQ8yB,IAAeA,EAAWpyB,SAAS,YAC9D+yB,IAAYlC,EAAQmC,YACpBC,IAAkBpC,EAAQqC,cAChC,OAAOJ,GAAcC,GAAWE,CAClC,CAAE,MAAO1zB,GACP,OAAO,CACT,CACD,EAZc,GAefktB,gBAAiB,MACf,IACE,MAAM2F,EAAa/yB,MAAMC,QAAQuxB,EAAQwB,mBACrCxB,EAAQwB,kBACRlzB,KAAKC,MAAMyxB,EAAQwB,mBAAqB,MAC5C,OAAOhzB,MAAMC,QAAQ8yB,IAAeA,EAAWpyB,SAAS,aAC1D,CAAE,MAAOT,GACP,OAAO,CACT,CACD,EATgB,GAejBgtB,eAAgB,MACd,IACE,MAAM6F,EAAa/yB,MAAMC,QAAQuxB,EAAQwB,mBACrCxB,EAAQwB,kBACRlzB,KAAKC,MAAMyxB,EAAQwB,mBAAqB,MAE5C,OAAKhzB,MAAMC,QAAQ8yB,GAGfA,EAAWpyB,SAAS,aACf,YACEoyB,EAAWpyB,SAAS,aACtB,cACEoyB,EAAWpyB,SAAS,WACtB,UAIF,GAZgC,EAazC,CAAE,MAAOT,GACP,MAAO,EACT,CACD,EAtBe,GAyBhBiqB,eAAgBqH,EAAQmC,aAAenC,EAAQsC,aAAetC,EAAQmC,aAAenC,EAAQsC,aAAaC,MAAM,KAAK,GAAK,GAC1HC,aAAcxC,EAAQmC,aAAenC,EAAQsC,aAAetC,EAAQmC,aAAenC,EAAQsC,aAAaC,MAAM,KAAK,GAAK,GACxHvJ,aAAcgH,EAAQhH,aAAegH,EAAQhH,aAAauJ,MAAM,KAAK,GAAK,GAC1EE,gBAAiBzC,EAAQ0C,aAAe1C,EAAQ0C,aAAaH,MAAM,KAAK,GAAK,GAC7EI,iBAAkB3C,EAAQ4C,aAAe5C,EAAQ4C,aAAaL,MAAM,KAAK,GAAK,GAC9EM,sBAAuB7C,EAAQ8C,iBAAmB9C,EAAQ8C,iBAAiBP,MAAM,KAAK,GAAMvC,EAAQ+C,cAAgB/C,EAAQ+C,cAAcR,MAAM,KAAK,GAAK,GAG1JF,cAAerC,EAAQqC,eAAiB,KACxCW,sBAAuBhD,EAAQgD,uBAAyB,KACxDC,aAAcjD,EAAQiD,cAAgB,KACtCC,wBAAyBlD,EAAQkD,wBAA0BlD,EAAQkD,wBAAwBX,MAAM,KAAK,GAAK,GAC3GY,6BAA8BnD,EAAQmD,8BAAgC,KACtEC,8BAA+BpD,EAAQoD,+BAAiC,GACxEne,2BAA4B,MAC1B,MAAMoe,EAAWrD,EAAQ/a,2BAEzB,MAAwB,mBAAboe,EAA+BA,EAAW,EAAI,EAEjC,kBAAbA,EAA8BA,EAEjB,kBAAbA,GAA8BniB,SAASmiB,EAAU,KAErD,CACR,EAV2B,GAW5BjO,iCAAkC4K,EAAQ5K,kCAAoC,GAC9E9P,yBAA0B0a,EAAQ1a,0BAA4B,GAC9Dge,aAActD,EAAQsD,cAAgB,KACtCC,mBAAoBvD,EAAQuD,oBAAsB,GAClDC,YAAaxD,EAAQwD,aAAe,KACpCC,aAAczD,EAAQyD,cAAgB,GACtCC,mBAAoB1D,EAAQ0D,oBAAsB,GAClDC,+BAAgC,MAC9B,MAAMN,EAAWrD,EAAQ2D,+BAEzB,MAAwB,mBAAbN,EAA+BA,EAAW,EAAI,EAEjC,kBAAbA,EAA8BA,EAEjB,kBAAbA,GAA8BniB,SAASmiB,EAAU,KAErD,CACR,EAV+B,GAahC9Q,cAAesO,EACfhY,mBAAoBmY,GACjBC,GAAkB,IAGrB9X,yBACAC,wBACAC,yBACAC,4BAGAmP,oBAAqB4I,EAGrB3I,mBAAoBlqB,MAAMC,QAAQuxB,EAAQ4D,SAAW5D,EAAQ4D,QAAU,GAGvE9e,QACOtW,MAAMC,QAAQuxB,EAAQlb,SAEpBkb,EAAQlb,QAAQhU,IAAIkU,IAAOjW,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC7BiW,GAAO,IAEVgQ,YAAahQ,EAAQ+P,kBAAoB,EAAI,EAC7C8O,aAAc7e,EAAQ8P,oBAAsB9P,EAAQ8P,oBAAoByN,MAAM,KAAK,GAAK,GAExFxN,kBAAmB/P,EAAQ+P,kBAC3BD,oBAAqB9P,EAAQ8P,oBAC7BD,mBAAoB7P,EAAQ6P,mBAE5BiP,YAAa9e,EAAQ8e,aAAe,MAZM,GAoB9ChL,2BAA4B,MAC1B,IAEE,MAAMiL,KAAiB/D,EAAQhH,eAAgBgH,EAAQgD,uBAGvD,IAAKhD,EAAQlH,4BAC8B,KAAvCkH,EAAQlH,4BACuC,kBAAvCkH,EAAQlH,4BAAyF,KAA9CkH,EAAQlH,2BAA2B9mB,OAEhG,OAAI+xB,EACK,CACLC,UAAW,MACXC,QAAS,GACTC,OAAQ,WAIL,CACLF,UAAW,KACXC,QAAS,GACTC,OAAQ,WAIZ,GAAkD,kBAAvClE,EAAQlH,2BAAyC,CAG1D,MAAMqL,EAASnE,EAAQlH,2BAOvB,MAAO,CACLkL,gBAL0Cra,IAArBwa,EAAOC,UAC1BD,EAAOC,UACPL,GAG0B,MAAQ,KAEpCE,QAASE,EAAOF,SAAWE,EAAOrK,QAAUqK,EAAOE,kBAAoB,GACvEH,OAAQ,UAEZ,CAAO,GAAkD,kBAAvClE,EAAQlH,2BAAyC,CAEjE,MAAMwL,EAAUtE,EAAQlH,2BAA2B9mB,OACnD,GAAuB,IAAnBsyB,EAAQ7zB,OACV,MAAO,CACLuzB,UAAW,KACXC,QAAS,GACTC,OAAQ,IAIZ,MAAM5b,EAASha,KAAKC,MAAM+1B,GAM1B,MAAO,CACLN,gBAL0Cra,IAArBrB,EAAO8b,UAC1B9b,EAAO8b,UACPL,GAG0B,MAAQ,KAEpCE,QAAS3b,EAAO2b,SAAW3b,EAAOwR,QAAUxR,EAAO+b,kBAAoB,GACvEH,OAAQ,UAEZ,CAEE,MAAO,CACLF,UAAW,KACXC,QAAS,GACTC,OAAQ,UAGd,CAAE,MAAOx1B,GACP,MAAO,CACLs1B,UAAW,KACXC,QAAS,GACTC,OAAQ,GAEZ,CACD,EA/E2B,KAoFxBK,EAAgB/1B,MAAMC,QAAQkzB,EAAgBH,mBAChDG,EAAgBH,kBACfG,EAAgBH,kBAAoB,CAACG,EAAgBH,mBAAqB,GAiD/E,MA9C+C,gBAA5BxB,EAAQ8B,iBACoB,mBAA5B9B,EAAQ8B,iBACRyC,EAAcp1B,SAAS,gBAKxCwyB,EAAgBH,kBAAoB,CAAC,eACrCG,EAAgBG,gBAAkB,iBAGlCH,EAAgBK,eAAgB,EAChCL,EAAgBjG,eAAiB,aAG7BiG,EAAgBxI,mBAA2D,IAAtCwI,EAAgBxI,qBACvDwI,EAAgB1I,cAAgB0I,EAAgB1I,gBAAiB,IAAI/M,MAAOsY,cAAcjC,MAAM,KAAK,IAIvGZ,EAAgB1c,2BAA6B,EAGT,IAAhC0c,EAAgBrJ,aAAqD,OAAhCqJ,EAAgBrJ,aAAwD,KAAhCqJ,EAAgBrJ,YAC/FqJ,EAAgBrJ,YAAc,IACrBqJ,EAAgBrJ,cACzBqJ,EAAgBrJ,YAAc/gB,OAAOoqB,EAAgBrJ,cAGf,IAApCqJ,EAAgB8C,iBAA6D,OAApC9C,EAAgB8C,iBAAgE,KAApC9C,EAAgB8C,gBACvG9C,EAAgB8C,gBAAkB,IACzB9C,EAAgB8C,kBACzB9C,EAAgB8C,gBAAkBltB,OAAOoqB,EAAgB8C,oBAKvB,OAAhC9C,EAAgBrJ,kBAAwD3O,IAAhCgY,EAAgBrJ,aAA6D,KAAhCqJ,EAAgBrJ,cACvGqJ,EAAgBrJ,YAAc/gB,OAAOoqB,EAAgBrJ,cAGf,OAApCqJ,EAAgB8C,sBAAgE9a,IAApCgY,EAAgB8C,iBAAqE,KAApC9C,EAAgB8C,kBAC/G9C,EAAgB8C,gBAAkBltB,OAAOoqB,EAAgB8C,mBAItD9C,GACN,CAAC/B,IAgRJ,MAAO,CACLH,UACAvxB,QACAw2B,kBA3KuBjlB,EAAAA,EAAAA,aAAY1R,UAAyC,IAAlC,QAAEkkB,EAAO,YAAEC,EAAc,GAAG1F,EACtE,IAAK9gB,IAAUC,EAEb,MADAmV,QAAQ5S,MAAM,0DACR,IAAImkB,MAAM,6BAQlB,GAAIsN,EAAWlpB,QAEb,OAAO,KAGTkpB,EAAWlpB,SAAU,EACrBipB,GAAW,GACXf,EAAS,MAET,IAGE,MAAMqB,QAAgB5N,EAAAA,GAAAA,YAAWH,EAASvmB,EAAOC,GAAU,GAG3D,IAAKq0B,EAEH,MADAlf,QAAQ5S,MAAM,gDACR,IAAImkB,MAAM,SAADxZ,OAAUoZ,EAAO,eAIlC,GAAI+N,EAAQlb,SAAWtW,MAAMC,QAAQuxB,EAAQlb,UAAYkb,EAAQlb,QAAQrU,OAAS,EAAG,CACnF,MAAMk0B,QAA+B3X,QAAQ4X,IAC3C5E,EAAQlb,QAAQhU,IAAI/C,UAClB,IAAI+1B,EAAc,GAGlB,GAAI9e,EAAQlM,KAAOvB,OAAOyN,EAAQlM,IAAI6L,WAAW,SAC/C,IAAK,IAADkgB,EACF,MAAMC,QAAuBC,EAAAA,GAAAA,IAC3B/f,EAAQlM,GACRnN,EACAD,EACAumB,GAEF6R,GAAiC,QAAnBe,EAAAC,EAAe5sB,YAAI,IAAA2sB,OAAA,EAAnBA,EAAqBf,cAAegB,EAAe5sB,MAAQ,EAC3E,CAAE,MAAO6b,GACPjT,QAAQ5S,MAAM,+FAAD2K,OAAgEmM,EAAQlM,GAAE,KAAKib,GAE5F+P,EAAc,EAChB,CAGF,OAAA/0B,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYiW,GAAO,IAAE8e,mBAKzB9D,EAAQlb,QAAU6f,CACpB,MAAW3E,EAAQlb,SAAWtW,MAAMC,QAAQuxB,EAAQlb,WAElDkb,EAAQlb,QAAUkb,EAAQlb,QAAQhU,IAAIk0B,IAACj2B,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUi2B,GAAC,IAAElB,YAAa,OAKnE,OAFwB/D,EAAmBC,EAASV,EAGtD,CAAE,MAAOvL,GAGP,MAFAjT,QAAQ5S,MAAM,yDAAqD6lB,GACnE4K,EAAS5K,EAAIzhB,SACPyhB,CACR,CAAC,QACC2L,GAAW,GACXC,EAAWlpB,SAAU,CACvB,GACC,CAAC/K,EAAOC,EAAU2zB,EAAcS,IAgGjCkF,kBA3FuBxlB,EAAAA,EAAAA,aAAY1R,UAAiD,IAA1C,QAAEkkB,EAAO,YAAEC,EAAc,EAAC,OAAEkL,GAAQzP,EAC9E,IAAKjiB,IAAUC,EACb,MAAM,IAAI0mB,MAAM,6BAQlB,GAAIsN,EAAWlpB,QAEb,OAAO,KAGTkpB,EAAWlpB,SAAU,EACrBipB,GAAW,GACXf,EAAS,MAET,IAEE,MAAMqB,QAAgB5N,EAAAA,GAAAA,YACpBH,EACAvmB,EACAC,GACA,GAGF,IAAKq0B,EACH,MAAM,IAAI3N,MAAM,SAADxZ,OAAUoZ,EAAO,eAIlC,MAAMiT,QAA2BC,EAAAA,GAAAA,IAAqBz5B,EAAOC,GAGvDy5B,GAA+B,OAAlBF,QAAkB,IAAlBA,OAAkB,EAAlBA,EAAoBG,uBAAyC,OAAlBH,QAAkB,IAAlBA,OAAkB,EAAlBA,EAAoBI,qBAAuC,OAAlBJ,QAAkB,IAAlBA,OAAkB,EAAlBA,EAAoBK,aAE3H,IAAKH,EACH,MAAM,IAAI/S,MAAM,kCAIlB,MAAMsP,EAAkB5B,EAAmBC,EAASV,GAkCpD,MAAO,CAAEpnB,MAhCQnJ,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACZ4yB,GAAe,IAGlB7oB,GAAI,KACJ6c,cAAe,KACfiM,SAAUwD,EACVvC,uBAAuB,IAAI3W,MAAOsY,cAAcjC,MAAM,KAAK,GAG3Df,kBAAmB,OACnBiD,gBAAiB,GACjBe,aAAc,GACd5M,mBAAoB,GAGpB6J,gBAAiB,GACjBgD,qBAAsB,GACtBC,qBAAsBtI,EACtBuI,YAAavI,EAGb4E,eAAe,EACfrJ,eAAgB,GAChBiD,iBAAiB,EACjB4G,aAAc,GAGdoD,kBAAmB,GACnB9gB,QAAS,KAGiB+gB,cAAe5T,EAC7C,CAAE,MAAO8B,GAEP,MADA4K,EAAS5K,EAAIzhB,SACPyhB,CACR,CAAC,QACC2L,GAAW,GACXC,EAAWlpB,SAAU,CACvB,GACC,CAAC/K,EAAOC,EAAU2zB,EAAcS,MFvsBX+F,CAAmB,CAAEp6B,QAAOC,WAAU2zB,iBACxDyG,EGzBkBC,MACxB,MAAO9N,EAAO0F,IAAYC,EAAAA,EAAAA,YAAWoI,GAAAA,GAAWC,GAAAA,IAG1CC,GAAY1mB,EAAAA,EAAAA,aAAa2mB,IAC7BxI,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWC,WAAY9Q,QAAS4Q,KAChD,IAEGG,GAAa9mB,EAAAA,EAAAA,aAAa2mB,IAC9BxI,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWG,YAAahR,QAAS4Q,KACjD,IAEGK,GAAiBhnB,EAAAA,EAAAA,aAAY,KACjCme,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWK,oBAC3B,IAGGC,GAAiBlnB,EAAAA,EAAAA,aAAamnB,IAClChJ,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWQ,gBAAiBrR,QAASoR,KACrD,IAEGE,GAAoBrnB,EAAAA,EAAAA,aAAY,KACpCme,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWU,uBAC3B,IAGGC,GAAkBvnB,EAAAA,EAAAA,aAAawnB,IACnCrJ,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWa,iBAAkB1R,QAASyR,KACtD,IAEGE,GAAgB1nB,EAAAA,EAAAA,aAAawnB,IACjCrJ,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWe,eAAgB5R,QAASyR,KACpD,IAEGI,GAAgB5nB,EAAAA,EAAAA,aAAawnB,IACjCrJ,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWiB,eAAgB9R,QAASyR,KACpD,IAEGM,GAAsB9nB,EAAAA,EAAAA,aAAY,KACtCme,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWmB,yBAC3B,IAEGC,GAAoBhoB,EAAAA,EAAAA,aAAY,KACpCme,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWqB,uBAC3B,IAEGC,GAAcloB,EAAAA,EAAAA,aAAawnB,IAC/BrJ,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWuB,aAAcpS,QAASyR,KAClD,IAEGY,GAAgBpoB,EAAAA,EAAAA,aAAawnB,IACjCrJ,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWyB,eAAgBtS,QAASyR,KACpD,IAGGc,GAAiBtoB,EAAAA,EAAAA,aAAY,CAACha,EAAKoJ,KACvC+uB,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAW2B,iBAAkBxS,QAAS,CAAE/vB,MAAKoJ,YAC7D,IAEGo5B,GAAiBxoB,EAAAA,EAAAA,aAAY,CAACha,EAAKoJ,KACvC+uB,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAW6B,iBAAkB1S,QAAS,CAAE/vB,MAAKoJ,YAC7D,IAGGs5B,GAAmB1oB,EAAAA,EAAAA,aAAY,KACnCme,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAW+B,qBAC3B,IAEGC,GAAgB5oB,EAAAA,EAAAA,aAAa5Q,IACjC+uB,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWiC,eAAgB9S,QAAS3mB,KACpD,IAGG05B,GAAc9oB,EAAAA,EAAAA,aAAY,KAC9Bme,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWmC,gBAC3B,IAEGC,GAAWhpB,EAAAA,EAAAA,aAAa5Q,IAC5B+uB,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWqC,UAAWlT,QAAS3mB,KAC/C,IAGG85B,GAAkBlpB,EAAAA,EAAAA,aAAY,CAAC5Q,EAAO+5B,KAC1ChL,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWwC,kBAAmBrT,QAAS,CAAE3mB,QAAO+5B,WAChE,IAEGE,GAAmBrpB,EAAAA,EAAAA,aAAY,KACnCme,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAW0C,sBAC3B,IAEGC,GAAmBvpB,EAAAA,EAAAA,aAAY,KACnCme,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAW4C,sBAC3B,IAGGC,GAAoBzpB,EAAAA,EAAAA,aAAaqR,IACrC8M,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAW8C,qBAAsB3T,QAAS1E,KAC1D,IAEGsY,GAAkB3pB,EAAAA,EAAAA,aAAavH,IACnC0lB,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWgD,mBAAoB7T,QAAStd,KACxD,IAGGoxB,GAAc7pB,EAAAA,EAAAA,aAAa5Q,IAC/B+uB,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWkD,cAAe/T,QAAS3mB,KACnD,IAGG2jB,GAAQ/S,EAAAA,EAAAA,aAAY,KACxBme,EAAS,CAAEh2B,KAAMy+B,GAAAA,GAAWxH,SAC3B,IAEH,MAAO,CAEL2K,OAAQtR,EAAMsR,OACdC,UAAWvR,EAAMuR,UACjBC,SAAUxR,EAAMwR,SAChBC,aAAczR,EAAMyR,aACpBC,aAAc1R,EAAM0R,aACpBC,WAAY3R,EAAM2R,WAClB9sB,qBAAsBmb,EAAMnb,qBAC5B+sB,MAAO5R,EAAM4R,MACbC,aAAc7R,EAAM6R,aACpBC,eAAgB9R,EAAM8R,eACtBC,aAAc/R,EAAM+R,aACpBC,SAAUhS,EAAMgS,SAGhB/D,YACAI,aACAE,iBACAE,iBACAG,oBACAE,kBACAG,gBACAE,gBACAE,sBACAE,oBACAE,cACAE,gBACAE,iBACAE,iBACAE,mBACAE,gBACAE,cACAE,WACAE,kBACAG,mBACAE,mBACAE,oBACAE,kBACAE,cACA9W,UHhISwT,GAGLmE,GAAgBh0B,EAAAA,EAAAA,QAAO,QAAD0C,OAASqT,KAAKC,MAAK,KAAAtT,OAAIwH,KAAK+pB,SAAShyB,SAAS,IAAIiyB,OAAO,EAAG,KAGlFC,GAAcn0B,EAAAA,EAAAA,SAAO,GACrBo0B,GAAap0B,EAAAA,EAAAA,SAAO,GACpBq0B,GAAoBr0B,EAAAA,EAAAA,SAAO,GAC3Bs0B,GAAet0B,EAAAA,EAAAA,SAAO,GACtBu0B,GAAuBv0B,EAAAA,EAAAA,SAAO,GAG9Bw0B,GAAex0B,EAAAA,EAAAA,UACfy0B,GAAkBz0B,EAAAA,EAAAA,UAClB00B,GAAqB10B,EAAAA,EAAAA,UACrB20B,GAAkB30B,EAAAA,EAAAA,UAClB40B,GAAa50B,EAAAA,EAAAA,UACb60B,GAAa70B,EAAAA,EAAAA,UAkPnB,OA/OAw0B,EAAal0B,QAAUinB,EACvBkN,EAAgBn0B,QAAU6oB,EAC1BuL,EAAmBp0B,QAAU+oB,EAC7BsL,EAAgBr0B,QAAU8mB,EAC1BwN,EAAWt0B,QAAU+mB,EACrBwN,EAAWv0B,QAAUgnB,GAQrB3wB,EAAAA,EAAAA,WAAU,KACR,MAAMm+B,EAAad,EAAc1zB,QAEjC,MAAO,KACL,MAAMy0B,EAAkBr0B,OAAOqmB,2BACTrmB,OAAOomB,+BAAiCgO,EAGxDE,EAAiBjf,KAAKC,MAAQjL,SAAS+pB,EAAW1I,MAAM,KAAK,IAE/D4I,EAAiB,KAAOD,EAG1BR,EAAqBj0B,SAAU,EAK7B00B,EAAiB,IAInBp0B,WAAW,KACLF,OAAOomB,+BAAiCgO,IAC1Cp0B,OAAOqmB,2BAA4B,EACnCrmB,OAAOomB,6BAA+B,MAExCsN,EAAW9zB,SAAU,GACpB,KAOLM,WAAW,KACLF,OAAOomB,+BAAiCgO,IAC1Cp0B,OAAOqmB,2BAA4B,EACnCrmB,OAAOomB,6BAA+B,MAExCsN,EAAW9zB,SAAU,GACpB,OAEJ,KAUH3J,EAAAA,EAAAA,WAAU,KAEWq9B,EAAc1zB,QAuBjC,GAtBAg0B,EAAah0B,SAAU,EAMvB+zB,EAAkB/zB,SAAU,EAC5B6zB,EAAY7zB,SAAU,EACtB8zB,EAAW9zB,SAAU,EACrBi0B,EAAqBj0B,SAAU,EAG3BI,OAAOomB,+BAAiCkN,EAAc1zB,UACxDI,OAAOqmB,2BAA4B,EACnCrmB,OAAOomB,6BAA+B,MAIxCS,EAAUlL,UAIN+X,EAAW9zB,SAAYi0B,EAAqBj0B,WAO5Ci0B,EAAqBj0B,UACvBi0B,EAAqBj0B,SAAU,GAG7B/K,GAASC,GAAU,CAErB6+B,EAAkB/zB,SAAU,EAE5B,MAAM20B,EAAOr9B,UAEX,MAAMk9B,EAAad,EAAc1zB,QAGjC,GAAI6zB,EAAY7zB,QACd,MAAO,CAAEoX,SAAS,EAAOwd,OAAQ,mBAInC,GAAIx0B,OAAOqmB,2BAA6BrmB,OAAOomB,+BAAiCgO,EAC9E,MAAO,CAAEpd,SAAS,EAAOwd,OAAQ,0BAInCf,EAAY7zB,SAAU,EACtBI,OAAOqmB,2BAA4B,EACnCrmB,OAAOomB,6BAA+BgO,EAEtC,IAEE,MAAMK,EAAmBX,EAAal0B,QAChC80B,EAAsBX,EAAgBn0B,QACtC+0B,EAAyBX,EAAmBp0B,QAC5Cg1B,EAAsBX,EAAgBr0B,QAEtCi1B,GADiBX,EAAWt0B,QACXu0B,EAAWv0B,SAOlC,GAAK80B,EAAoBvM,QAevBsM,EAAiBnN,yBAfe,CAChCmN,EAAiBtN,wBAIjB,UAFkCuN,EAAoBI,UAGpD,MAAM,IAAItZ,MAAM,+BAGduB,EAEJ0X,EAAiBnN,oBACnB,CAOA,IAAIyN,EAAa,KACb/F,EAAgB,KA8CpB,OAzCIxI,GAKFiO,EAAiBjN,gBAEjBuN,QAAmBJ,EAAuB9G,iBAAiB,CACzDzS,QAASoL,EACTnL,YAAkC,MAArBoL,EAA2B,EAAI,IAM9CgO,EAAiB/M,eAMjB+M,EAAiB/M,aACjBqN,EAAa,CAAC,GAIhBN,EAAiB7M,WAGbgN,GACFA,EAAoBG,EAAY/F,GAG9B6F,GACFA,IAIFpB,EAAY7zB,SAAU,EACtBI,OAAOqmB,2BAA4B,EAE5B,CACLrP,SAAS,EACT3V,KAAM0zB,EACN/F,gBAGJ,CAAE,MAAO33B,GACP,MAAMo9B,EAAmBX,EAAal0B,QAChCo1B,EAAiBd,EAAWt0B,QAelC,OAbA60B,EAAiB3M,SAASzwB,EAAMoE,SAGhCg4B,EAAY7zB,SAAU,EACtBI,OAAOqmB,2BAA4B,EAC/BrmB,OAAOomB,+BAAiCgO,IAC1Cp0B,OAAOomB,6BAA+B,MAGpC4O,GACFA,EAAe39B,GAGV,CACL2f,SAAS,EACT3f,MAAOA,EAAMoE,QAEjB,GAGF84B,GACF,GACC,CAAC1/B,EAAOC,EAAU0xB,IAEd,CAELK,UAAW,CACTvhB,MAAOuhB,EAAUvhB,MACjBgO,eAAgBuT,EAAUvT,eAC1B2U,sBAAuBpB,EAAUoB,sBACjCC,kBAAmBrB,EAAUqB,kBAC7BC,QAAStB,EAAUsB,QACnB9wB,MAAOwvB,EAAUxvB,MACjBgxB,UAAWxB,EAAUwB,UACrBC,YAAazB,EAAUyB,aAIzBG,aAAc,CACZpnB,KAAMonB,EAAapnB,KACnBunB,QAASH,EAAaG,QACtB7yB,OAAQ0yB,EAAa1yB,OACrBoyB,QAASM,EAAaN,QACtB8M,YAAaxM,EAAawM,YAC1BC,YAAazM,EAAayM,aAI5BvM,gBAAiB,CACfC,QAASD,EAAgBC,QACzBvxB,MAAOsxB,EAAgBtxB,MACvBw2B,iBAAkBlF,EAAgBkF,kBAKpCqB,KAIAvT,MAAOA,KACL,MAAMyY,EAAad,EAAc1zB,QACjCinB,EAAUlL,QACVuT,EAAGvT,QAGH8X,EAAY7zB,SAAU,EACtB8zB,EAAW9zB,SAAU,EACrB+zB,EAAkB/zB,SAAU,EAGxBI,OAAOomB,+BAAiCgO,IAC1Cp0B,OAAOqmB,2BAA4B,EACnCrmB,OAAOomB,6BAA+B,SIxUxC+O,GAAkB,IAAIC,IAqB5B,MAAMC,GAAuB3S,IAC3B,IAAKA,EAAc,MAAO,CAAC,yBAC3B,GAA4B,kBAAjBA,EACT,IACE,MAAMjR,EAASha,KAAKC,MAAMgrB,GAC1B,OAAI/qB,MAAMC,QAAQ6Z,GACTA,EAAO7X,OAAS,EAAI6X,EAAS,CAAC,yBAEhC,CAACiR,EACV,CAAE,MAAA4S,GACA,MAAO,CAAC5S,EACV,CAEF,MAAMvrB,EAASQ,MAAMC,QAAQ8qB,GAAgBA,EAAe,CAACA,GAC7D,OAAOvrB,EAAOyC,OAAS,EAAIzC,EAAS,CAAC,0BAMjCo+B,GAAmBA,CAAC7S,EAAcrB,KACtC,MAAMmU,EAASH,GAAoB3S,GAC7BvrB,EAASq+B,EAAOl9B,SAAS+oB,GAa/B,OAVqB,kBAAVA,GAAwC,kBAAVA,GAAsBA,EAAM/oB,SAAS,MAASX,MAAMC,QAAQypB,KA7CvG,SAAkBpf,EAAIwzB,EAAKC,GACzB,IACE,MAAM9mC,EAAMqT,EAAK,KAAOyzB,GAAwB,kBAATA,EAAoBj+B,KAAKuR,UAAU0sB,GAAQh1B,OAAOg1B,IACzF,GAAIP,GAAgBQ,IAAI/mC,GAAM,OAC9BumC,GAAgBS,IAAIhnC,EACtB,CAAE,MAAOinC,GAEP,GAAIV,GAAgBQ,IAAI1zB,GAAK,OAC7BkzB,GAAgBS,IAAI3zB,EACtB,CAEuB,qBAAZgI,UACLA,QAAQ5S,MAAO4S,QAAQ5S,MAAMo+B,EAAKC,GAC7BzrB,QAAQC,MAAMD,QAAQC,KAAKurB,EAAKC,GAE7C,CA+BII,CAAS,mBAAoB,mFAAkE,CAC7FzU,QACA0U,mBAAoB1U,EACpBzpB,QAASD,MAAMC,QAAQypB,GACvBqB,eACAsT,aAAcR,IAIXr+B,GAYH8+B,GAAsB,CAC1BxQ,WAAY,CACV7jB,KAAM,aACN0D,MAAO,EACP4wB,gBAAkBC,GAAYA,EAAQ/3B,cAAgB,EACtDg4B,UAAYD,IAAa,IAADE,EAAAC,EAEtB,QAA6B,IAAzBH,EAAQ/3B,eAAuB+3B,EAAQ/vB,SAASnE,OAK5B,QAAxBo0B,EAAIF,EAAQI,oBAAY,IAAAF,IAApBA,EAAsBG,WAMF,QAAxBF,EAAIH,EAAQI,oBAAY,IAAAD,IAApBA,EAAsBG,SAMtBN,EAAQ/3B,aAAe,MAO/BsnB,UAAW,CACT9jB,KAAM,kBACN0D,MAAO,EACP4wB,gBAAkBC,GAAYA,EAAQ/3B,cAAgB,EACtDg4B,UAAYD,IAAa,IAADO,EAAAC,EAEtB,QAA6B,IAAzBR,EAAQ/3B,eAAuB+3B,EAAQ/vB,SAASnE,OAK5B,QAAxBy0B,EAAIP,EAAQI,oBAAY,IAAAG,IAApBA,EAAsBF,WAMF,QAAxBG,EAAIR,EAAQI,oBAAY,IAAAI,IAApBA,EAAsBF,SAMtBN,EAAQ/3B,aAAe,MAS/BwV,YAAa,CACXhS,KAAM,oBACN0D,MAAO,EACP4wB,gBAAkBC,GAAYA,EAAQ/3B,cAAgB,EACtDg4B,UAAYD,KAENA,EAAQ/3B,cAAgB,GAAK+3B,EAAQ/3B,cAAgB,IAKrD+3B,EAAQ/3B,cAAgB,GAOhCunB,UAAW,CACT/jB,KAAM,YACN0D,MAAO,EACP4wB,gBAAkBC,GAAYA,EAAQ/3B,cAAgB,EACtDg4B,UAAYD,IAAa,IAADS,EACtB,OAAwB,QAAxBA,EAAIT,EAAQI,oBAAY,IAAAK,IAApBA,EAAsBC,kBAGtBV,EAAQ/3B,aAAe,IAM/BwnB,QAAS,CACPhkB,KAAM,UACN0D,MAAO,EACP4wB,gBAAkBC,GAAYA,EAAQ/3B,cAAgB,EACtDg4B,UAAYD,IAAa,IAADW,EACtB,OAAwB,QAAxBA,EAAIX,EAAQI,oBAAY,IAAAO,IAApBA,EAAsBD,kBAGtBV,EAAQ/3B,aAAe,IAM/BynB,QAAS,CACPjkB,KAAM,UACN0D,MAAO,EACP4wB,gBAAkBC,GAAYA,EAAQ/3B,cAAgB,EACtDg4B,UAAYD,IAAa,IAADY,EACtB,OAAwB,QAAxBA,EAAIZ,EAAQI,oBAAY,IAAAQ,IAApBA,EAAsBF,kBAGtBV,EAAQ/3B,aAAe,IAM/B0nB,gBAAiB,CACflkB,KAAM,wBACN0D,MAAO,EACP4wB,gBAAkBC,GAAYA,EAAQ/3B,cAAgB,EACtDg4B,UAAYD,IAAa,IAADa,EACtB,OAAwB,QAAxBA,EAAIb,EAAQI,oBAAY,IAAAS,IAApBA,EAAsBH,kBAGtBV,EAAQ/3B,aAAe,IAM/B0mB,cAAe,CACbljB,KAAM,sBACN0D,MAAO,EACP4wB,gBAAkBC,GAAYA,EAAQ/3B,cAAgB,EACtDg4B,UAAYD,IAAa,IAADc,EACtB,OAAwB,QAAxBA,EAAId,EAAQI,oBAAY,IAAAU,IAApBA,EAAsBJ,kBAGtBV,EAAQ/3B,aAAe,IAM/B84B,qBAAsB,CACpBt1B,KAAM,6BACN0D,MAAO,EACP4wB,gBAAkBC,IAEZA,EAAQgB,YACLhB,EAAQ/3B,cAAgB,EAEjCg4B,UAAYD,IAAa,IAADiB,EAEtB,OAAOjB,EAAQ/3B,cAAgB,KAA0B,QAArBg5B,EAACjB,EAAQI,oBAAY,IAAAa,GAApBA,EAAsBjK,aAG/DkK,cAAe,CACbz1B,KAAM,gBACN0D,MAAO,EACP4wB,gBAAkBC,IAAa,IAADmB,EAE5B,GAAInB,EAAQgB,WAAY,OAAO,EAI/B,MADgF,SAAhB,QAA3CG,EAAAnB,EAAQ/vB,SAAS6b,kCAA0B,IAAAqV,OAAA,EAA3CA,EAA6CnK,YAC3CgJ,EAAQ/3B,cAAgB,GAEjDg4B,UAAYD,IAAa,IAADoB,EAEtB,OAAOpB,EAAQ/3B,cAAgB,KAA0B,QAArBm5B,EAACpB,EAAQI,oBAAY,IAAAgB,GAApBA,EAAsBC,WAG/DvS,uBAAwB,CACtBrjB,KAAM,kCACN0D,MAAO,EACP4wB,gBAAkBC,IAEhB,GAAIA,EAAQgB,WAAY,OAAO,EAG/B,MAAMM,EAAelC,GAAiBY,EAAQ/vB,SAASukB,kBAAmB,aACpE+M,EAAgBnC,GAAiBY,EAAQ/vB,SAASukB,kBAAmB,cAC3E,OAAO8M,GAAgBC,GAEzBtB,UAAYD,IAAa,IAADwB,EAEtB,OAAOxB,EAAQ/3B,cAAgB,KAA0B,QAArBu5B,EAACxB,EAAQI,oBAAY,IAAAoB,GAApBA,EAAsBC,oBAG/DC,kBAAmB,CACjBj2B,KAAM,iCACN0D,MAAO,KACP4wB,gBAAiBA,KAAM,EACvBE,UAAWA,KAAM,GAEnB0B,iBAAkB,CAChBl2B,KAAM,sBACN0D,MAAO,KACP4wB,gBAAiBA,KAAM,EACvBE,UAAWA,KAAM,GAEnB2B,UAAW,CACTn2B,KAAM,YACN0D,MAAO,EACP4wB,gBAAkBC,IAEZA,EAAQgB,YAGLhB,EAAQ/3B,cAAgB,EAEjCg4B,UAAYD,IAAa,IAAD6B,EAEtB,OAAO7B,EAAQ/3B,cAAgB,KAA0B,QAArB45B,EAAC7B,EAAQI,oBAAY,IAAAyB,GAApBA,EAAsBD,aAG/DE,gBAAiB,CACfr2B,KAAM,6BACN0D,MAAO,EACP4wB,gBAAkBC,GAETA,EAAQ/3B,cAAgB,EAEjCg4B,UAAYD,IAAa,IAAD+B,EAEtB,OAAO/B,EAAQ/3B,cAAgB,KAA0B,QAArB85B,EAAC/B,EAAQI,oBAAY,IAAA2B,GAApBA,EAAsBD,mBAG/DE,UAAW,CACTv2B,KAAM,oBACN0D,MAAO,EACP4wB,gBAAkBC,GAKIZ,GAAiBY,EAAQ/vB,SAASukB,kBAAmB,aAG3EyL,UAAYD,IAAa,IAADiC,EAEtB,OAAO7C,GAAiBY,EAAQ/vB,SAASukB,kBAAmB,gBAAqC,QAArByN,EAACjC,EAAQI,oBAAY,IAAA6B,GAApBA,EAAsBD,cAiBnGE,GAAwB,SAACjI,EAAYhqB,GAA+C,IAArCmwB,EAAY1jB,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,CAAC,EAAGsjB,EAAOtjB,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,CAAC,EACjF,MAAMpF,EAAUwoB,GAAoB7F,GACpC,IAAK3iB,EACH,MAAO,CAAEsB,SAAS,EAAOC,SAAS,GAIpC,MAAM3Q,EAAa83B,EAAQ93B,aAAc,EAGnCi6B,EAAc,CAClBlyB,WACAhI,aAAc+3B,EAAQ/3B,cAAgBm6B,GAAsBnyB,GAC5D/H,aAIAk4B,aAAc,CACZC,OAAQD,EAAaC,SAAU,EAC/BC,OAAQF,EAAaE,SAAU,EAC/B+B,OAAQjC,EAAaiC,SAAU,EAC/BhB,QAASjB,EAAaiB,UAAW,EACjCO,UAAWxB,EAAawB,YAAa,EACrCE,gBAAiB1B,EAAa0B,kBAAmB,EACjDE,UAAW5B,EAAa4B,YAAa,EACrChL,UAAWoJ,EAAapJ,YAAa,GAIvCsL,wBAAyBtC,EAAQsC,0BAA2B,EAG5DxG,iBAAkBkE,EAAQlE,mBAAoB,EAC9Cp8B,SAAUsgC,EAAQtgC,WAAY,EAG9B6iC,iBAAkBvC,EAAQuC,mBAAoB,EAG9CC,yBAA0BxC,EAAQwC,2BAA4B,EAC9DC,yBAA0BzC,EAAQyC,2BAA4B,EAC9DC,yBAA0B1C,EAAQ0C,2BAA4B,EAG9DC,gBAAiB3C,EAAQ2C,kBAAmB,EAC5CC,yBAA0B5C,EAAQ4C,2BAA4B,EAC9DC,uBAAwB7C,EAAQ6C,yBAA0B,EAC1DC,kBAAmB9C,EAAQ8C,oBAAqB,GAK5ClqB,EAAU1Q,GAAcoP,EAAQyoB,gBAAgBoC,GAItD,GAAIA,EAAYI,iBACd,MAAO,CACL3pB,UACAC,SAAS,GAQb,MAAO,CACLD,UACAC,YAJaD,KAAW1Q,GAAqBoP,EAAQ2oB,UAAUkC,KAMnE,EA8BMY,GAAoB,CACxB,CAAEj3B,GAAI,EAAGL,KAAM,oBAAau3B,MAAO,UAAWzY,YAAa,8BAC3D,CAAEze,GAAI,EAAGL,KAAM,qBAAgBu3B,MAAO,UAAWzY,YAAa,mCAC9D,CAAEze,GAAI,EAAGL,KAAM,kBAAau3B,MAAO,UAAWzY,YAAa,oCAC3D,CAAEze,GAAI,EAAGL,KAAM,cAAYu3B,MAAO,UAAWzY,YAAa,0BAC1D,CAAEze,GAAI,EAAGL,KAAM,eAAau3B,MAAO,UAAWzY,YAAa,yBAC3D,CAAEze,GAAI,EAAGL,KAAM,gBAAcu3B,MAAO,UAAWzY,YAAa,2CAC5D,CAAEze,GAAI,EAAGL,KAAM,0BAAcu3B,MAAO,UAAWzY,YAAa,4DAC5D,CAAEze,GAAI,EAAGL,KAAM,YAAau3B,MAAO,UAAWzY,YAAa,2BAC3D,CAAEze,GAAI,EAAGL,KAAM,6BAAmBu3B,MAAO,UAAWzY,YAAa,8BACjE,CAAEze,GAAI,GAAIL,KAAM,oBAAau3B,MAAO,WAAYzY,YAAa,WAczD6X,GAAyBnyB,IAE7B,IAAKA,EAASnE,IAAMszB,GAAiBnvB,EAASukB,kBAAmB,QAC/D,OAAO,EAIT,MAAMyO,EAAiB/D,GAAoBjvB,EAASukB,mBAuBpD,MAnBwB,CACtB,UAAa,EACb,cAAiB,EACjB,gBAAmB,EACnB,UAAa,EACb,YAAe,EACf,WAAc,EACd,UAAa,EACb,UAAa,EACb,SAAY,EACZ,aAAgB,EAChB,UAAa,EACb,QAAW,EACX,UAAa,EACb,QAAW,EACX,sBAAyB,EACzB,KAAQ,GAnBQyO,EAAeA,EAAex/B,OAAS,KAsBpB,GAsK1By/B,GAAqB,SAACjzB,GAAkC,IAADkzB,EAAAC,EAAA,IAAvBl7B,EAAUwU,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,IAAAA,UAAA,GAErD,MAAO2mB,EAAoBC,IAAyBrkC,EAAAA,EAAAA,UAAS,GAOvD+hC,GAAauC,EAAAA,EAAAA,SAAQ,KAAO,IAADC,EAAAC,EAE/B,MAAMC,EAAuD,cAAb,QAApBF,EAAAvzB,EAASwN,mBAAW,IAAA+lB,OAAA,EAApBA,EAAsBtM,QAE5CyM,EAA4E,cAAb,QAAnCF,EAAAxzB,EAAS6b,kCAA0B,IAAA2X,OAAA,EAAnCA,EAAqCvM,QAEvE,OAAOwM,GAAuBC,GAC7B,CAAqB,QAArBR,EAAClzB,EAASwN,mBAAW,IAAA0lB,OAAA,EAApBA,EAAsBjM,OAA2C,QAArCkM,EAAEnzB,EAAS6b,kCAA0B,IAAAsX,OAAA,EAAnCA,EAAqClM,UAGhE0M,EAAkBC,IAAuB5kC,EAAAA,EAAAA,UAAS,CACvDohC,QAAQ,EACRC,QAAQ,EACRI,iBAAiB,EACjB1J,WAAW,EACXqK,SAAS,EACTI,kBAAkB,EAClBG,WAAW,EACXE,iBAAiB,EACjBE,WAAW,IAIPnH,GAAgBpoB,EAAAA,EAAAA,aAAawnB,IACjC4J,EAAoB/hC,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUD,GAAI,IAAE,CAACm4B,IAAa,MACrD,IAEGU,GAAcloB,EAAAA,EAAAA,aAAawnB,IAC/B4J,EAAoB/hC,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUD,GAAI,IAAE,CAACm4B,IAAa,MACrD,IAEG6J,GAAoBrxB,EAAAA,EAAAA,aAAawnB,GAC9B2J,EAAiB3J,KAAe,EACtC,CAAC2J,IAEEG,GAAkBtxB,EAAAA,EAAAA,aAAY,KAClCoxB,EAAoB,CAClBxD,QAAQ,EACRC,QAAQ,EACRI,iBAAiB,EACjB1J,WAAW,EACXqK,SAAS,EACTI,kBAAkB,EAClBG,WAAW,EACXE,iBAAiB,EACjBE,WAAW,KAEZ,IAGGgC,GAAevxB,EAAAA,EAAAA,aAAY,KAC/B6wB,EAAsBxhC,GAAQA,EAAO,IACpC,IAKGmG,GAAes7B,EAAAA,EAAAA,SAAQ,KAE3B,GAAIr7B,EACF,OAAO,EAIT,OADck6B,GAAsBnyB,IAEnC,CACDA,EAASnE,GACTmE,EAASukB,kBACT6O,EACAn7B,IAII+7B,GAAaV,EAAAA,EAAAA,SAAQ,KACzB,OAnPmBhX,EAmPEtc,EAASukB,kBAAmBvkB,EAAS2e,iBAjP5CwQ,GAAiB7S,EAAc,WACtC,cAIL6S,GAAiB7S,EAAc,cAC/B6S,GAAiB7S,EAAc,aAC1B,UAIL6S,GAAiB7S,EAAc,cAC/B6S,GAAiB7S,EAAc,YAC1B,UAIL6S,GAAiB7S,EAAc,aAC1B,UAIF,UAxBa2X,IAAC3X,GAoPlB,CAACtc,EAASukB,kBAAmBvkB,EAAS2e,kBAGnCuV,GAAgBZ,EAAAA,EAAAA,SAAQ,KAC5B,MAAMa,EAAWn0B,EAAS2e,gBACpBrC,EAAetc,EAASukB,kBAE9B,MAAO,CACLvsB,eACAo8B,OAAQtB,GAAkBj/B,IAAI,CAACqL,EAAOkf,KACpC,MAAMiW,EAAWjW,EAAQ,EACzB,IAAIkW,EAAYp1B,EAAM6zB,MAClBwB,GAAY,EAUhB,OAPKJ,GAAYhF,GAAiB7S,EAAc,aAAe+X,GAAY,GACzEC,EAAY,cACZC,EAAYF,GAAYjxB,KAAKC,IAAIrL,EAAc,IAE/Cu8B,EAAYF,GAAYr8B,GAG1BlG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKoN,GAAK,IACRq1B,YACAC,UAAWH,IAAar8B,EACxBs8B,kBAIL,CAACt8B,EAAcgI,EAAS2e,gBAAiB3e,EAASukB,oBAG/CkQ,GAA0BjyB,EAAAA,EAAAA,aAAY,IAAMxK,EAAc,CAACA,IAE3D08B,GAA2BlyB,EAAAA,EAAAA,aAAY,IAAM0xB,EAAe,CAACA,IAE7DS,GAAwBnyB,EAAAA,EAAAA,aAAY,IAAMwxB,EAAY,CAACA,IAEvDY,GAA8BpyB,EAAAA,EAAAA,aAAa6X,GACxC4U,GAAoB5U,GAAQra,EAASukB,mBAC3C,CAACvkB,EAASukB,oBAMPsQ,GAA2BryB,EAAAA,EAAAA,aAAY,CAACsyB,EAAqBC,SAE9CroB,IAAfqoB,EACK5F,GAAiBnvB,EAASukB,kBAAmBuQ,GAG/C3F,GAAiB2F,EAAqBC,GAC5C,CAAC/0B,EAASukB,oBAGPyQ,GAAoB1B,EAAAA,EAAAA,SAAQ,KAChC,MAAMlE,EAASH,GAAoBjvB,EAASukB,mBAGtC0Q,EAAiB,CACrB,YAAa,YAAa,iBAAkB,YAC5C,wBAAyB,YAAa,UAAW,QAInD,IAAK,MAAMC,KAAkBD,EAC3B,GAAI7F,EAAOl9B,SAASgjC,GAAiB,CAKnC,MAJqB,CACnB,QAAW,wBACX,SAAY,kBAEMA,IAAmBA,CACzC,CAIF,MAAMC,EAAY/F,EAAO57B,OAAS,EAAI47B,EAAOA,EAAO57B,OAAS,GAAK,OAGlE,MAAkB,iBAAd2hC,GAAgC/F,EAAOl9B,SAAS,aAC3C,YAGFijC,GAAa,QACnB,CAACn1B,EAASukB,oBAGP6Q,GAAkB5yB,EAAAA,EAAAA,aAAY,SAACwnB,GAA2D,IAA5BqL,EAAiB5oB,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,CAAC,EACvF,OAAOwlB,GAAsBjI,EAAYhqB,EADkByM,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,CAAC,GACA3a,EAAAA,EAAAA,GAAA,CAC7DkG,eACA+4B,aACA94B,cACGo9B,GAEP,EAAG,CAACr1B,EAAUhI,EAAc+4B,EAAY94B,IAGlCq9B,GAAsB9yB,EAAAA,EAAAA,aAAY,SAACwnB,GAA2D,IAA5BqL,EAAiB5oB,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,CAAC,EAC3F,OA1a8B,SAACud,EAAYhqB,GAG7C,OADciyB,GAAsBjI,EAAYhqB,EAFmByM,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,CAAC,EAAUA,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,CAAC,GAGvE7D,OAChB,CAsaW2sB,CAA0BvL,EAAYhqB,EADkByM,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,CAAC,GACA3a,EAAAA,EAAAA,GAAA,CACjEkG,eACA+4B,cACGsE,GAEP,EAAG,CAACr1B,EAAUhI,EAAc+4B,IAGtByE,GAA0BhzB,EAAAA,EAAAA,aAAY,WAAgD,IAA/C2tB,EAAY1jB,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,CAAC,EAAG4oB,EAAiB5oB,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,CAAC,EACnF,MAAMgpB,EAAa,CAAC,EAIpB,OAHAxgC,OAAOC,KAAK26B,IAAqB/nB,QAAQkiB,IACvCyL,EAAWzL,GAAcsL,EAAoBtL,EAAYmG,EAAckF,KAElEI,CACT,EAAG,CAACH,IAIEl1B,GAAsBkzB,EAAAA,EAAAA,SAAQ,OAEhCtzB,EAASnE,MACRg5B,EAAyB70B,EAASukB,kBAAmB,cACrDsQ,EAAyB70B,EAASukB,kBAAmB,cACrDsQ,EAAyB70B,EAASukB,kBAAmB,aAEvD,CAACvkB,EAASnE,GAAImE,EAASukB,kBAAmBsQ,EAA0BzB,IAGjEsC,GAAqBpC,EAAAA,EAAAA,SAAQ,OAE/BtzB,EAASnE,KACTg5B,EAAyB70B,EAASukB,kBAAmB,cAEtD,CAACvkB,EAASnE,GAAImE,EAASukB,kBAAmBsQ,EAA0BzB,IAGjEuC,GAAsBrC,EAAAA,EAAAA,SAAQ,OAEhCtzB,EAASnE,KACTg5B,EAAyB70B,EAASukB,kBAAmB,YAEtD,CAACvkB,EAASnE,GAAImE,EAASukB,kBAAmBsQ,EAA0BzB,IAIjEwC,GAAetC,EAAAA,EAAAA,SAAQ,IACpBlzB,GAAuBs1B,GAAsBC,EACnD,CAACv1B,EAAqBs1B,EAAoBC,IAGvCE,GAAsBrzB,EAAAA,EAAAA,aAAY,WAA6B,IAA5B6yB,EAAiB5oB,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,CAAC,EAC5D,MAAM2iB,EAAS,CAAC,EAEV0G,GAAehkC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAChBujC,GAAiB,IACpB/C,iBAAkBsD,IAMpB,OAJA3gC,OAAOC,KAAK26B,IAAqB/nB,QAAQkiB,IACvCoF,EAAOpF,GAAcoL,EAAgBpL,EAAY2J,EAAkBmC,KAG9D1G,CACT,EAAG,CAACgG,EAAiBp9B,EAAcgI,EAASnE,GAAI83B,EAAkBiC,IAG5DG,GAAevzB,EAAAA,EAAAA,aAAY,IAnXNxC,KAE3B,MAAMg2B,EAAkB3kC,KAAKuR,UAAU,CAAC,0BAExC,MAAO,CACLqzB,iBAAenkC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACVkO,GAAQ,IACX+kB,eAAe,EACfrJ,eAAgB,GAChBiD,iBAAiB,EACjB4G,aAAc,GACd3J,sBAAuB,GACvB2I,kBAAmByR,EACnBna,2BAA4B,CAAEkL,UAAW,GAAImP,MAAO,GAAIrZ,OAAQ,GAAIsZ,SAAU,IAC9Epa,aAAc,GACdqa,kBAAmB,GACnBC,kBAAmB,GACnBC,cAAe,GACfC,cAAe,GACfC,UAAW,GACXC,mBAAoB,GACpBC,kBAAmB,GACnB1X,cAAe,GACf2X,cAAe,GACfC,eAAgB,GAChBC,aAAc,GACdC,aAAc,GACd9a,cAAe,GACfC,aAAc,GACdC,mBAAmB,EACnBrU,QAAS,KAEXkvB,YAAa,SACbC,SAAU,IAmVHC,CAAoBj3B,GAC1B,CAACA,IAEEk3B,GAAe10B,EAAAA,EAAAA,aAAY,IA9UNxC,KAE3B,MAAMg2B,EAAkB3kC,KAAKuR,UAAU,CAAC,cAExC,MAAO,CACLqzB,iBAAenkC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACVkO,GAAQ,IACXukB,kBAAmByR,EACnBjR,eAAe,EACfrJ,eAAgB,GAChBG,2BAA4B,CAAEkL,UAAW,GAAImP,MAAO,GAAIrZ,OAAQ,GAAIsZ,SAAU,IAC9Epa,aAAc,GACdqa,kBAAmB,GACnBC,kBAAmB,GACnBC,cAAe,GACfC,cAAe,GACfC,UAAW,GACXC,mBAAoB,GACpBC,kBAAmB,GACnB1X,cAAe,GACf2X,cAAe,GACfC,eAAgB,GAChBC,aAAc,GACdC,aAAc,GACdjvB,QAAS,GACTmU,cAAe,GACfC,aAAc,GACdC,mBAAmB,EACnBgK,6BAA8B,GAC9BC,8BAA+B,GAC/B9d,yBAA0B,KAE5B0uB,YAAa,kBACbC,SAAU,IA8SHG,CAAoBn3B,GAC1B,CAACA,IAEEo3B,GAAe50B,EAAAA,EAAAA,aAAY,IAzSNxC,KAE3B,MAAMg2B,EAAkB3kC,KAAKuR,UAAU,CAAC,YAAa,aAErD,MAAO,CACLqzB,iBAAenkC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACVkO,GAAQ,IACXukB,kBAAmByR,EACnBna,2BAA4B,CAAEkL,UAAW,GAAImP,MAAO,GAAIrZ,OAAQ,GAAIsZ,SAAU,IAC9Epa,aAAc,GACdC,cAAe,GACfC,aAAc,GACdpU,QAAS,GACTqe,6BAA8B,KAC9BC,8BAA+B,GAC/Bne,2BAA4B,EAC5Bue,YAAa,KACbC,aAAc,GACdE,+BAAgC,IAElCqQ,YAAa,YACbC,SAAU,IAqRHK,CAAoBr3B,GAC1B,CAACA,IAGJ,MAAO,CAELhI,eACAg8B,aACAE,gBACAc,oBAGAjE,aAGA94B,aAGAmI,sBACAs1B,qBACAC,sBAGA5B,eAGAnJ,gBACAF,cACAmJ,oBACAC,kBACAiC,eACAmB,eACAE,eAGAE,gBAAiB7C,EACjB8C,iBAAkB7C,EAClBT,cAAeU,EACf1F,oBAAqB2F,EACrBzF,iBAAkB0F,EAGlBO,kBACAS,sBAGAP,sBACAE,0BACAgC,mBAAoB3H,GAGpB4H,iBAAkB3E,GAEtB,E,wGC38BA,MAAM4E,GAAeluC,EAAAA,EAAOC,IAAGC,KAAAA,IAAAC,EAAAA,EAAAA,GAAA,4NAczBguC,GAAiBnuC,EAAAA,EAAOC,IAAGI,KAAAA,IAAAF,EAAAA,EAAAA,GAAA,2LAU3BiuC,GAAcpuC,EAAAA,EAAOC,IAAGM,KAAAA,IAAAJ,EAAAA,EAAAA,GAAA,sOAUxBkuC,GAAaruC,EAAAA,EAAOS,GAAEC,KAAAA,IAAAP,EAAAA,EAAAA,GAAA,2HAStBQ,GAAcX,EAAAA,EAAOY,OAAMC,KAAAA,IAAAV,EAAAA,EAAAA,GAAA,oQAe3BmuC,GAAetuC,EAAAA,EAAOC,IAAGc,KAAAA,IAAAZ,EAAAA,EAAAA,GAAA,gHAQzBouC,GAAavuC,EAAAA,EAAOC,IAAGgB,KAAAA,IAAAd,EAAAA,EAAAA,GAAA,+KAcvBquC,GAAmBxuC,EAAAA,EAAOC,IAAGoB,KAAAA,IAAAlB,EAAAA,EAAAA,GAAA,gpBAyC7BsuC,GAAczuC,EAAAA,EAAOC,IAAGsB,KAAAA,IAAApB,EAAAA,EAAAA,GAAA,oJASxBa,GAAUhB,EAAAA,EAAOC,IAAGyB,KAAAA,IAAAvB,EAAAA,EAAAA,GAAA,mLAUpBuuC,GAAc1uC,EAAAA,EAAOC,IAAG2B,KAAAA,IAAAzB,EAAAA,EAAAA,GAAA,wEAMxB+D,GAASlE,EAAAA,EAAOY,OAAMmB,KAAAA,IAAA5B,EAAAA,EAAAA,GAAA,0RAkBtBwuC,IAAe3uC,EAAAA,EAAAA,GAAOkE,GAAPlE,CAAckC,KAAAA,IAAA/B,EAAAA,EAAAA,GAAA,kHAS7ByuC,IAAgB5uC,EAAAA,EAAAA,GAAOkE,GAAPlE,CAAcqC,KAAAA,IAAAlC,EAAAA,EAAAA,GAAA,0NAsSpC,GAlR0CkE,IAOnC,IAPoC,MACzCqnB,EAAK,UACLmjB,EAAS,SACTC,EAAQ,YACRC,EAAW,MACX9pC,EAAK,SACLC,GACDb,EACC,MAAO2qC,EAAQC,IAAazpC,EAAAA,EAAAA,UAAS,OAC9B0pC,EAAWC,IAAgB3pC,EAAAA,EAAAA,WAAS,IACpCS,EAAUC,IAAeV,EAAAA,EAAAA,WAAS,IAClC4pC,EAAYC,IAAiB7pC,EAAAA,EAAAA,UAAS,OACtC8pC,EAAcC,IAAmB/pC,EAAAA,EAAAA,UAAS,CAAC,IAGlDa,EAAAA,EAAAA,WAAU,KACgBiB,WACtB,IACE6nC,GAAa,GAGb,IAAIK,EAAU,KACd,IAEEA,QAD0BC,EAAAA,GAAAA,IAAoB,CAAExqC,QAAOC,WAAUmN,GAAI,GAEvE,CAAE,MAAOq9B,GACPr1B,QAAQC,KAAK,wDAA4Co1B,EAC3D,CAGA,IAAI3rB,EAAY,CAAC,EACjB,IACE,MAAM4rB,QAAsB1mB,EAAAA,GAAAA,IAAe,CAAEhkB,QAAOC,WAAUyiB,QAAS,IACnE5f,MAAMC,QAAQ2nC,KAChB5rB,EAAY4rB,EAAcC,OAAO,CAACC,EAAKvV,KACjCA,EAAEwV,gBACJD,EAAIvV,EAAEwV,eAAiBxV,EAAEyV,iBAAmBzV,EAAEwV,eAEzCD,GACN,CAAC,GAER,CAAE,MAAOG,GACP31B,QAAQC,KAAK,oDAAmC01B,EAClD,CAEAX,EAAcG,GACdD,EAAgBxrB,GAGhB,MAAMksB,EAAkB,GACxB,GAAIvkB,EAAMrN,SAAWtW,MAAMC,QAAQ0jB,EAAMrN,SACvC,IAAK,MAAME,KAAWmN,EAAMrN,QAAS,CACnC,MAAM6xB,GAAe5nC,EAAAA,EAAAA,GAAA,GAAQiW,GAG7B,GAAIA,EAAQme,6BACV,IACE,MAAMyT,QAAiBC,EAAAA,GAAAA,IAAc7xB,EAAQme,8BAC7CwT,EAAgBG,0BAA4BF,CAC9C,CAAE,MAAOG,GACPj2B,QAAQC,KAAK,oDAAmCg2B,EAClD,CAGFL,EAAgBpqB,KAAKqqB,EACvB,CAKF,MAAMK,GAAWjoC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACZojB,GAAK,IACRyR,QAASzR,EAAMuG,oBAAsBvG,EAAMyR,SAAW,GACtD9e,QAAS4xB,IAILO,QAAaC,EAAAA,GAAAA,KACjB1nC,EAAAA,GAAAA,KAAC2nC,GAAAA,EAAmB,CAClBhlB,MAAO6kB,EACPxB,YAAaA,EACbK,WAAYI,EACZF,aAAcvrB,KAEhB4sB,SAEItgB,EAAMugB,IAAIC,gBAAgBL,GAChCvB,EAAU5e,SAGJ,IAAI9J,QAAQuqB,GAAWxgC,WAAWwgC,EAAS,MAEjD3B,GAAa,EACf,CAAE,MAAO1nC,GACP4S,QAAQ5S,MAAM,wEAAmDA,GACjEspC,MAAM,wEACN5B,GAAa,EACf,GAGF6B,IACC,CAACtlB,EAAOqjB,EAAa9pC,EAAOC,KAG/BmB,EAAAA,EAAAA,WAAU,IACD,KACD2oC,IACF30B,QAAQ42B,IAAI,uCACZL,IAAIM,gBAAgBlC,KAGvB,CAACA,IAGJ,MAgEMmC,EAAeA,KACnBrC,KAcF,OAVAzoC,EAAAA,EAAAA,WAAU,KACR,MAAM+qC,EAAanpC,IACH,WAAVA,EAAEjJ,KAAqBiH,GACzBkrC,KAIJ,OADA/gC,OAAO4K,iBAAiB,UAAWo2B,GAC5B,IAAMhhC,OAAO6K,oBAAoB,UAAWm2B,IAClD,CAACnrC,KAEGorC,EAAAA,EAAAA,eACLtoC,EAAAA,GAAAA,KAACmlC,GAAY,CACXhlC,QAAUjB,IAAYA,EAAE2C,SAAW3C,EAAEyU,eAAkBzW,GAAaipC,GAAWiC,KAAkBnoC,UAEjGC,EAAAA,GAAAA,MAACklC,GAAc,CAACjlC,QAAUjB,GAAMA,EAAEkB,kBAAkBH,SAAA,EAClDC,EAAAA,GAAAA,MAACmlC,GAAW,CAAAplC,SAAA,EACVD,EAAAA,GAAAA,KAACslC,GAAU,CAAArlC,SAAC,2FAIZD,EAAAA,GAAAA,KAACpI,GAAW,CACVuI,QAASioC,EACTxuC,SAAUsD,GAAYipC,EACtBzlC,MAAM,uBAAcT,UAEpBD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAME,EAAAA,YAI3BR,EAAAA,GAAAA,KAACulC,GAAY,CAAAtlC,SACVkmC,GACCjmC,EAAAA,GAAAA,MAACulC,GAAgB,CAAAxlC,SAAA,EACfD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMioC,EAAAA,IAAWC,MAAI,KACtCxoC,EAAAA,GAAAA,KAAA,OAAKyoC,UAAU,YAAWxoC,SAAC,2CAC3BC,EAAAA,GAAAA,MAAA,OAAKuoC,UAAU,WAAUxoC,SAAA,CAAC,wDACeD,EAAAA,GAAAA,KAAA,SAAM,qEAKjDA,EAAAA,GAAAA,KAACwlC,GAAU,CAAAvlC,UACTD,EAAAA,GAAAA,KAAA,UACE0oC,IAAKzC,EACLvlC,MAAM,sCACN4I,GAAG,4BAMXpJ,EAAAA,GAAAA,MAACwlC,GAAW,CAAAzlC,SAAA,EACVC,EAAAA,GAAAA,MAACjI,GAAO,CAAAgI,SAAA,CAAC,iBACJD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,wFACXD,EAAAA,GAAAA,KAAA,SAAM,iNAKRE,EAAAA,GAAAA,MAACylC,GAAW,CAAA1lC,SAAA,EACVC,EAAAA,GAAAA,MAAC0lC,GAAY,CACXzlC,QAASioC,EACTxuC,SAAUsD,EAAS+C,SAAA,EAEnBD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMqoC,EAAAA,MAAiB,oCAI1C3oC,EAAAA,GAAAA,KAAC6lC,GAAa,CACZ1lC,QAzIU5B,UACpB,IACEpB,GAAY,GAGZ,MAAM+pC,EAAkB,GACxB,GAAIvkB,EAAMrN,SAAWtW,MAAMC,QAAQ0jB,EAAMrN,SACvC,IAAK,MAAME,KAAWmN,EAAMrN,QAAS,CACnC,MAAM6xB,GAAe5nC,EAAAA,EAAAA,GAAA,GAAQiW,GAG7B,GAAIA,EAAQme,6BACV,IACE,MAAMyT,QAAiBC,EAAAA,GAAAA,IAAc7xB,EAAQme,8BAC7CwT,EAAgBG,0BAA4BF,CAC9C,CAAE,MAAOG,GACPj2B,QAAQC,KAAK,oDAAmCg2B,EAClD,CAGFL,EAAgBpqB,KAAKqqB,EACvB,CAIF,MAAMK,GAAWjoC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACZojB,GAAK,IACRyR,QAASzR,EAAMuG,oBAAsBvG,EAAMyR,SAAW,GACtD9e,QAAS4xB,IAILO,QAAaC,EAAAA,GAAAA,KACjB1nC,EAAAA,GAAAA,KAAC2nC,GAAAA,EAAmB,CAClBhlB,MAAO6kB,EACPxB,YAAaA,EACbK,WAAYA,EACZE,aAAcA,KAEhBqB,SAIIgB,GADQ,IAAIlsB,MACIsY,cAAcjC,MAAM,KAAK,GACzC8V,GAAelmB,EAAM0P,kBAAoB,WAAWxS,QAAQ,gBAAiB,KAC7EipB,EAAQ,qBAAAz/B,OAAwBu/B,EAAO,KAAAv/B,OAAIw/B,EAAW,QAEtDE,EAAU,IAAIC,KAAK,CAACvB,GAAOqB,EAAU,CAAE1wC,KAAM,oBAEnDkZ,QAAQ42B,IAAI,6EAGZpC,EAAUiD,EAIZ,CAAE,MAAOrqC,GACP4S,QAAQ5S,MAAM,8CAA+BA,GAC7CspC,MAAM,wCAAD3+B,OAA8B3K,EAAMoE,SAAWpE,IACpDvB,GAAY,EACd,GA8EUvD,SAAUusC,GAAajpC,EAAS+C,SAE/B/C,GACCgD,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACED,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMioC,EAAAA,IAAWC,MAAI,IAAG,uBAI3CtoC,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACED,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMG,EAAAA,MAAiB,yDAStDyS,SAASsF,O,2mBCzXb,MAAMywB,GAAuBC,IAC3B,IAAKA,EAAM,MAAO,GAClB,MAAMlzC,EAAI,IAAI0mB,KAAKwsB,GACnB,GAAIC,MAAMnzC,EAAEozC,WAAY,MAAO,GAC/B,MAAMC,EAAOrzC,EAAEszC,cACTC,EAAQxhC,OAAO/R,EAAEwzC,WAAa,GAAGC,SAAS,EAAG,KAC7CC,EAAM3hC,OAAO/R,EAAE2zC,WAAWF,SAAS,EAAG,KAC5C,MAAM,GAANpgC,OAAUggC,EAAI,KAAAhgC,OAAIkgC,EAAK,KAAAlgC,OAAIqgC,IAIvBE,GAAiBxQ,GAChBA,EACEA,EACJ7O,cACAsf,UAAU,OACVhqB,QAAQ,mBAAoB,IAC5BA,QAAQ,WAAY,IACpBrd,OANe,GAUdsnC,GAA0BA,KAC9B,MAAMntB,EAAM,IAAID,KACV2sB,EAAO1sB,EAAI2sB,cACXC,EAAQxhC,OAAO4U,EAAI6sB,WAAa,GAAGC,SAAS,EAAG,KAC/CC,EAAM3hC,OAAO4U,EAAIgtB,WAAWF,SAAS,EAAG,KAC9C,MAAM,GAANpgC,OAAUggC,EAAI,KAAAhgC,OAAIkgC,EAAK,KAAAlgC,OAAIqgC,IAkBvBK,GAAY9yC,EAAAA,EAAOC,IAAGC,KAAAA,IAAAC,EAAAA,EAAAA,GAAA,oXAInBe,GAASA,EAAMuV,aAAe,IAAM,sGAGjCvV,GAASA,EAAMuV,aAAe,IAAM,iCAEpCvV,GAASA,EAAMuV,aAAe,QAAU,qJAEvCvV,GAASA,EAAMuV,aAAe,QAAU,QAU/Cs8B,GAAc/yC,EAAAA,EAAOC,IAAGI,KAAAA,IAAAF,EAAAA,EAAAA,GAAA,khBAO1Be,GAASA,EAAM8xC,YAAW,yDAGxB,GAKA9xC,GAASA,EAAM8xC,YAAW,+DAGxB,IAiBFC,GAAcjzC,EAAAA,EAAOC,IAAGM,KAAAA,IAAAJ,EAAAA,EAAAA,GAAA,gRAQdkE,IAAA,IAAC,MAAC6uC,GAAM7uC,EAAA,OAAK6uC,EAAMC,OAAOC,SAAW,YAM/CC,GAAqBrzC,EAAAA,EAAOC,IAAGS,KAAAA,IAAAP,EAAAA,EAAAA,GAAA,yZAIjCe,GAASA,EAAM8xC,YAAW,yDAGxB,GAKA9xC,GAASA,EAAM8xC,YAAW,+DAGxB,IAeFM,GAAoBtzC,EAAAA,EAAOC,IAAGY,KAAAA,IAAAV,EAAAA,EAAAA,GAAA,ipCAkD9BozC,GAAkBvzC,EAAAA,EAAOC,IAAGc,KAAAA,IAAAZ,EAAAA,EAAAA,GAAA,uZAY5BqzC,GAAaxzC,EAAAA,EAAOC,IAAGgB,KAAAA,IAAAd,EAAAA,EAAAA,GAAA,mOAavBszC,GAAazzC,EAAAA,EAAOC,IAAGoB,KAAAA,IAAAlB,EAAAA,EAAAA,GAAA,6KAuDvBuzC,IA3Ce1zC,EAAAA,EAAOC,IAAGsB,KAAAA,IAAApB,EAAAA,EAAAA,GAAA,qWAKfe,GAASA,EAAMyyC,aAAe,oDAAsD,oDAC9EzyC,GAASA,EAAMyyC,aAAe,UAAY,UAIrDzyC,GAASA,EAAMyyC,aAAe,UAAY,WAUnC3zC,EAAAA,EAAOC,IAAGyB,KAAAA,IAAAvB,EAAAA,EAAAA,GAAA,qVAuBHH,EAAAA,EAAOC,IAAG2B,KAAAA,IAAAzB,EAAAA,EAAAA,GAAA,6FAO7ByM,GAAc5M,EAAAA,EAAO4zC,GAAE7xC,KAAAA,IAAA5B,EAAAA,EAAAA,GAAA,4/BA6MvB0zC,IAhKY7zC,EAAAA,EAAOC,IAAGiC,KAAAA,IAAA/B,EAAAA,EAAAA,GAAA,0EAMNH,EAAAA,EAAOC,IAAGoC,KAAAA,IAAAlC,EAAAA,EAAAA,GAAA,qEAMXH,EAAAA,EAAOY,OAAM4B,KAAAA,IAAArC,EAAAA,EAAAA,GAAA,qhFAoJjBH,EAAAA,EAAOC,IAAG4C,KAAAA,IAAA1C,EAAAA,EAAAA,GAAA,kVA8BrB2zC,IAZiB9zC,EAAAA,EAAOC,IAAG+C,KAAAA,IAAA7C,EAAAA,EAAAA,GAAA,8KAYFH,EAAAA,EAAOC,IAAGkD,KAAAA,IAAAhD,EAAAA,EAAAA,GAAA,oFAgDnC4zC,IAzCwB/zC,EAAAA,EAAOC,IAAGqD,KAAAA,IAAAnD,EAAAA,EAAAA,GAAA,0HAQhBH,EAAAA,EAAOC,IAAGuD,KAAAA,IAAArD,EAAAA,EAAAA,GAAA,iHAQfH,EAAAA,EAAO2D,KAAID,KAAAA,IAAAvD,EAAAA,EAAAA,GAAA,gIAQXH,EAAAA,EAAO2D,KAAIC,KAAAA,IAAAzD,EAAAA,EAAAA,GAAA,kHAOXH,EAAAA,EAAO2D,KAAIG,KAAAA,IAAA3D,EAAAA,EAAAA,GAAA,8JAKde,GAASA,EAAM8yC,OAAS,UAAY,UACzC9yC,GAASA,EAAM8yC,OAAS,UAAY,UACzB9yC,GAASA,EAAM8yC,OAAS,UAAY,WAGxCh0C,EAAAA,EAAOC,IAAG8D,KAAAA,IAAA5D,EAAAA,EAAAA,GAAA,gGAOtB8zC,GAAmBj0C,EAAAA,EAAOC,IAAGgE,KAAAA,IAAA9D,EAAAA,EAAAA,GAAA,qKAU7B+zC,GAAel0C,EAAAA,EAAOC,IAAGkE,KAAAA,IAAAhE,EAAAA,EAAAA,GAAA,sOAgBzBg0C,GAAmBn0C,EAAAA,EAAOC,IAAGm0C,KAAAA,IAAAj0C,EAAAA,EAAAA,GAAA,+sCA0C7Bk0C,GAAer0C,EAAAA,EAAOC,IAAGq0C,KAAAA,IAAAn0C,EAAAA,EAAAA,GAAA,0UAazBo0C,GAAcv0C,EAAAA,EAAOC,IAAGu0C,KAAAA,IAAAr0C,EAAAA,EAAAA,GAAA,qEAMxBwN,GAAe3N,EAAAA,EAAOY,OAAM6zC,KAAAA,IAAAt0C,EAAAA,EAAAA,GAAA,utBA8C5BoxC,IAAOmD,EAAAA,EAAAA,IAASC,KAAAA,IAAAx0C,EAAAA,EAAAA,GAAA,oGAUhBy0C,GAAU50C,EAAAA,EAAO2D,KAAIkxC,KAAAA,IAAA10C,EAAAA,EAAAA,GAAA,6LAOZoxC,IAITuD,GAAc90C,EAAAA,EAAOY,OAAMm0C,KAAAA,IAAA50C,EAAAA,EAAAA,GAAA,8VAqB3B60C,GAAiBh1C,EAAAA,EAAOC,IAAGg1C,KAAAA,IAAA90C,EAAAA,EAAAA,GAAA,wLAqB3B+0C,IATgBl1C,EAAAA,EAAOC,IAAGk1C,KAAAA,IAAAh1C,EAAAA,EAAAA,GAAA,yJASVH,EAAAA,EAAOC,IAAGm1C,KAAAA,IAAAj1C,EAAAA,EAAAA,GAAA,mOAGrBe,GAASA,EAAMm0C,aAAe,UAAY,UAErCn0C,GAASA,EAAMm0C,aACzB,oDACA,oDAGgBn0C,GAASA,EAAMm0C,aAAe,UAAY,YAI1D/zC,GAActB,EAAAA,EAAOC,IAAGq1C,KAAAA,IAAAn1C,EAAAA,EAAAA,GAAA,uLASxBwM,GAAgB3M,EAAAA,EAAOC,IAAGs1C,KAAAA,IAAAp1C,EAAAA,EAAAA,GAAA,sMAQ5Be,IAEA,MAyCMiyC,EAzCiBqC,KACrB,OAAOA,GACL,IAAK,eACH,MAAO,CACLC,GAAI,CAAC,UAAW,WAChBvrC,OAAQ,UACRwrC,MAAO,CAAC,UAAW,YAEvB,IAAK,iBAwBL,QACE,MAAO,CACLD,GAAI,CAAC,UAAW,WAChBvrC,OAAQ,UACRwrC,MAAO,CAAC,UAAW,YAtBvB,IAAK,eACH,MAAO,CACLD,GAAI,CAAC,UAAW,WAChBvrC,OAAQ,UACRwrC,MAAO,CAAC,UAAW,YAEvB,IAAK,iBACH,MAAO,CACLD,GAAI,CAAC,UAAW,WAChBvrC,OAAQ,UACRwrC,MAAO,CAAC,UAAW,YAEvB,IAAK,cACH,MAAO,CACLD,GAAI,CAAC,UAAW,WAChBvrC,OAAQ,UACRwrC,MAAO,CAAC,UAAW,cAWZC,CAAcz0C,EAAMs0C,cAG7BI,EAAU10C,EAAM+e,SAAW,IAAM,MAEvC,MAAM,+CAAN7N,OACwC+gC,EAAOsC,GAAG,GAAE,SAAArjC,OAAQ+gC,EAAOsC,GAAG,GAAE,4CAAArjC,OAC3C+gC,EAAOjpC,OAAM,sBAAAkI,OAC7BwjC,EAAO,sEAAAxjC,OAGsB+gC,EAAOuC,MAAM,GAAE,SAAAtjC,OAAQ+gC,EAAOuC,MAAM,GAAE,iDAO9El0C,GAAexB,EAAAA,EAAOC,IAAG41C,KAAAA,IAAA11C,EAAAA,EAAAA,GAAA,wHAO3Be,IACA,OAAOA,EAAMs0C,cACX,IAAK,eACH,MAAO,kBACT,IAAK,iBAQL,QACE,MAAO,kBAPT,IAAK,eACH,MAAO,kBACT,IAAK,iBACH,MAAO,kBACT,IAAK,cACH,MAAO,qBAOT7gC,GAAc3U,EAAAA,EAAOC,IAAG61C,KAAAA,IAAA31C,EAAAA,EAAAA,GAAA,wCAG1Be,IACA,OAAOA,EAAMs0C,cACX,IAAK,eACH,MAAO,kBACT,IAAK,iBAQL,QACE,MAAO,kBAPT,IAAK,eACH,MAAO,kBACT,IAAK,iBACH,MAAO,kBACT,IAAK,cACH,MAAO,qBAOTO,GAAe/1C,EAAAA,EAAOC,IAAG+1C,KAAAA,IAAA71C,EAAAA,EAAAA,GAAA,yEAEhBe,GAASA,EAAM+0C,UAAY,eAAiB,iBAEvD/0C,IACA,OAAOA,EAAMs0C,cACX,IAAK,eACH,MAAO,kBACT,IAAK,iBAQL,QACE,MAAO,kBAPT,IAAK,eACH,MAAO,kBACT,IAAK,iBACH,MAAO,kBACT,IAAK,cACH,MAAO,qBAOTU,GAAkBl2C,EAAAA,EAAOC,IAAGk2C,KAAAA,IAAAh2C,EAAAA,EAAAA,GAAA,oEAM5Bi2C,GAAcp2C,EAAAA,EAAO2D,KAAI0yC,KAAAA,IAAAl2C,EAAAA,EAAAA,GAAA,8MAWzBm2C,GAAiBt2C,EAAAA,EAAOC,IAAGs2C,KAAAA,IAAAp2C,EAAAA,EAAAA,GAAA,sDAEpBe,GAASA,EAAM+0C,UAAY,OAAS,SAG3CO,GAAyBx2C,EAAAA,EAAOC,IAAGw2C,KAAAA,IAAAt2C,EAAAA,EAAAA,GAAA,6GAI5Be,GAASA,EAAMyB,SAAW,GAAM,EACzBzB,GAASA,EAAMyB,SAAW,OAAS,QAGjD+zC,GAAwB12C,EAAAA,EAAOiC,MAAK00C,KAAAA,IAAAx2C,EAAAA,EAAAA,GAAA,qsBAK9Be,GAASA,EAAMyB,SAAW,cAAgB,UAe9BzB,GAASA,EAAMqJ,QAAU,UAAY,UAc1CrJ,GAASA,EAAMqJ,QAAU,mBAAqB,gBAKrCrJ,GAASA,EAAMqJ,QAAU,yBAA2B,2BAI1EqsC,GAAuB52C,EAAAA,EAAO2D,KAAIkzC,KAAAA,IAAA12C,EAAAA,EAAAA,GAAA,mEAEvBe,GAASA,EAAMqJ,QAAU,MAAQ,MACvCrJ,GAASA,EAAMqJ,QAAU,UAAY,WAG1C5I,GAAU3B,EAAAA,EAAOC,IAAG62C,KAAAA,IAAA32C,EAAAA,EAAAA,GAAA,4PAepB2B,GAAY9B,EAAAA,EAAOC,IAAG82C,KAAAA,IAAA52C,EAAAA,EAAAA,GAAA,uEAMtB0D,GAAY7D,EAAAA,EAAOC,IAAG+2C,KAAAA,IAAA72C,EAAAA,EAAAA,GAAA,4JAUtB6B,GAAQhC,EAAAA,EAAOiC,MAAKg1C,KAAAA,IAAA92C,EAAAA,EAAAA,GAAA,6JAMXe,GAASA,EAAMiB,SAAW,OAAS,MAO5C+0C,GAAiBl3C,EAAAA,EAAOC,IAAGk3C,KAAAA,IAAAh3C,EAAAA,EAAAA,GAAA,2MAS3Bi3C,GAAYp3C,EAAAA,EAAOiC,MAAKo1C,KAAAA,IAAAl3C,EAAAA,EAAAA,GAAA,6JAMfe,GAASA,EAAMiB,SAAW,OAAS,MAM5Cm1C,GAAoBt3C,EAAAA,EAAOY,OAAM22C,KAAAA,IAAAp3C,EAAAA,EAAAA,GAAA,yaAY1Be,GAASA,EAAMs2C,SAAW,EAAI,EACvBt2C,GAASA,EAAMs2C,SAAW,OAAS,QAcjDp1C,GAAgBpC,EAAAA,EAAOC,IAAGw3C,KAAAA,IAAAt3C,EAAAA,EAAAA,GAAA,6RAiB1BmC,GAAQtC,EAAAA,EAAOuC,MAAKm1C,KAAAA,IAAAv3C,EAAAA,EAAAA,GAAA,oqCAGbe,GAASA,EAAMuB,QAAU,iCAAmC,UACnDvB,GAASA,EAAMwB,SAAW,UAAY,UAOjDxB,GAASA,EAAMkH,OAAyB,KAAhBlH,EAAMkH,MAAe,UAAY,UACnDlH,GACTA,EAAMyB,SAAiB,MACpBzB,EAAMkH,OAAyB,KAAhBlH,EAAMkH,MAAe,MAAQ,MAKnClH,GAASA,EAAMwB,SAAW,UAAY,UAC9BxB,GAASA,EAAMwB,SAAW,yBAA2B,0BAIpExB,GAASA,EAAMwB,SAAW,UAAY,WAwC7Ci1C,GAAW33C,EAAAA,EAAO43C,SAAQC,KAAAA,IAAA13C,EAAAA,EAAAA,GAAA,+qBAIVe,GAASA,EAAMwB,SAAW,UAAY,UAUjDxB,GAASA,EAAMkH,OAAyB,KAAhBlH,EAAMkH,MAAe,UAAY,UACnDlH,GACTA,EAAMyB,SAAiB,MACpBzB,EAAMkH,OAAyB,KAAhBlH,EAAMkH,MAAe,MAAQ,MAKnClH,GAASA,EAAMwB,SAAW,UAAY,UAC9BxB,GAASA,EAAMwB,SAAW,yBAA2B,2BA8F3Eo1C,IA7EyB93C,EAAAA,EAAOC,IAAG83C,KAAAA,IAAA53C,EAAAA,EAAAA,GAAA,0YAIzBe,GACRA,EAAM82C,SAAiB,UACvB92C,EAAM+2C,WACN/2C,EAAMg3C,YADkB,UAErB,UAEWh3C,GACdA,EAAM82C,SAAiB,UACvB92C,EAAM+2C,UAAkB,UACxB/2C,EAAMg3C,YAAoB,UACvB,WAmBiBl4C,EAAAA,EAAOC,IAAGk4C,KAAAA,IAAAh4C,EAAAA,EAAAA,GAAA,mDAKPH,EAAAA,EAAOC,IAAGm4C,KAAAA,IAAAj4C,EAAAA,EAAAA,GAAA,oFAOZH,EAAAA,EAAOC,IAAGo4C,KAAAA,IAAAl4C,EAAAA,EAAAA,GAAA,6HAK5Be,GACHA,EAAM82C,SAAiB,UACvB92C,EAAM+2C,UAAkB,UACxB/2C,EAAMg3C,YAAoB,UACvB,WAIkBl4C,EAAAA,EAAOC,IAAGq4C,KAAAA,IAAAn4C,EAAAA,EAAAA,GAAA,2GAG5Be,GACHA,EAAM82C,SAAiB,UACvB92C,EAAM+2C,UAAkB,UACxB/2C,EAAMg3C,YAAoB,UACvB,WAKoBl4C,EAAAA,EAAOC,IAAGs4C,KAAAA,IAAAp4C,EAAAA,EAAAA,GAAA,6EAOJH,EAAAA,EAAOC,IAAGu4C,KAAAA,IAAAr4C,EAAAA,EAAAA,GAAA,kDAKzCs4C,GAAyBz4C,EAAAA,EAAOC,IAAGy4C,KAAAA,IAAAv4C,EAAAA,EAAAA,GAAA,ohBA2BnCw4C,GAAwB34C,EAAAA,EAAOC,IAAG24C,KAAAA,IAAAz4C,EAAAA,EAAAA,GAAA,wNAelC04C,GAAyB74C,EAAAA,EAAOC,IAAG64C,KAAAA,IAAA34C,EAAAA,EAAAA,GAAA,qGAOnC44C,GAAwB/4C,EAAAA,EAAOC,IAAG+4C,KAAAA,IAAA74C,EAAAA,EAAAA,GAAA,oFAOlC84C,GAAyBj5C,EAAAA,EAAOC,IAAGi5C,KAAAA,IAAA/4C,EAAAA,EAAAA,GAAA,8FA8NnC+M,IAvNSlN,EAAAA,EAAOm5C,OAAMC,KAAAA,IAAAj5C,EAAAA,EAAAA,GAAA,6pBAINe,GAASA,EAAMwB,SAAW,UAAY,UAQjDxB,GAASA,EAAMkH,OAAyB,KAAhBlH,EAAMkH,OAAgC,gBAAhBlH,EAAMkH,MAA0B,UAAY,UACpFlH,GACTA,EAAMyB,SAAiB,MACpBzB,EAAMkH,OAAyB,KAAhBlH,EAAMkH,OAAgC,gBAAhBlH,EAAMkH,MAA0B,MAAQ,MAKpElH,GAASA,EAAMwB,SAAW,UAAY,UAC9BxB,GAASA,EAAMwB,SAAW,yBAA2B,2BAiBtD1C,EAAAA,EAAOC,IAAGo5C,KAAAA,IAAAl5C,EAAAA,EAAAA,GAAA,iEAGxBe,GAASA,EAAMoD,OAAS,IAAQ,GAGnBtE,EAAAA,EAAOC,IAAGq5C,KAAAA,IAAAn5C,EAAAA,EAAAA,GAAA,muBAIde,GAASA,EAAMwB,SAAW,UAAY,UAG5CxB,GAASA,EAAMyB,SAAW,UAAY,UAC1CzB,GAASA,EAAMyB,SAAW,cAAgB,UAC3CzB,GACHA,EAAMyB,SAAiB,UACvBzB,EAAM2J,cAAgB3J,EAAMkH,OAAyB,KAAhBlH,EAAMkH,MAAqB,UAC7D,UAGMlH,GAASA,EAAMyB,SAAW,MAASzB,EAAMkH,OAAyB,KAAhBlH,EAAMkH,OAAsC,SAAtBlH,EAAM2J,YAAyB,MAAQ,MAY1G3J,GACdA,EAAMyB,SACDzB,EAAMoD,OAAM,yiBAGVpD,EAAMwB,SACRxB,EAAMoD,OAAM,yiBAIZpD,EAAMoD,OAAM,yiBAULpD,GAASA,EAAMyB,SAAW,UAAazB,EAAMwB,SAAW,UAAY,UAKpExB,GAASA,EAAMwB,SAAW,UAAY,UAC9BxB,GAASA,EAAMwB,SAAW,yBAA2B,2BAI3D1C,EAAAA,EAAO2D,KAAI41C,KAAAA,IAAAp5C,EAAAA,EAAAA,GAAA,kIAKtBe,GAASA,EAAMs4C,QAAU,UAAY,UAC/Bt4C,GAASA,EAAMs4C,QAAU,MAAQ,OAGrBx5C,EAAAA,EAAOC,IAAGw5C,KAAAA,IAAAt5C,EAAAA,EAAAA,GAAA,ikBA6BZH,EAAAA,EAAOC,IAAGy5C,KAAAA,IAAAv5C,EAAAA,EAAAA,GAAA,+ZAiBjCe,GAASA,EAAM+B,UAAQ,kJAOCjD,EAAAA,EAAOC,IAAG05C,KAAAA,IAAAx5C,EAAAA,EAAAA,GAAA,68BA2CpBH,EAAAA,EAAOC,IAAG25C,KAAAA,IAAAz5C,EAAAA,EAAAA,GAAA,0IASRH,EAAAA,EAAOuC,MAAKs3C,KAAAA,IAAA15C,EAAAA,EAAAA,GAAA,4QA2D1B25C,IA7Ca95C,EAAAA,EAAOC,IAAG85C,KAAAA,IAAA55C,EAAAA,EAAAA,GAAA,yIASHH,EAAAA,EAAOC,IAAG+5C,KAAAA,IAAA75C,EAAAA,EAAAA,GAAA,iDAKVH,EAAAA,EAAOY,OAAMq5C,KAAAA,IAAA95C,EAAAA,EAAAA,GAAA,qcA0BXH,EAAAA,EAAAA,GAAOkN,GAAPlN,CAAmBk6C,KAAAA,IAAA/5C,EAAAA,EAAAA,GAAA,oCAKlBH,EAAAA,EAAOC,IAAGk6C,KAAAA,IAAAh6C,EAAAA,EAAAA,GAAA,4eA4BjCi6C,GAAuBp6C,EAAAA,EAAOC,IAAGo6C,KAAAA,IAAAl6C,EAAAA,EAAAA,GAAA,yYAqBjCm6C,GAAqBt6C,EAAAA,EAAOC,IAAGs6C,KAAAA,IAAAp6C,EAAAA,EAAAA,GAAA,uLAU/Bq6C,GAAqBx6C,EAAAA,EAAOC,IAAGw6C,KAAAA,IAAAt6C,EAAAA,EAAAA,GAAA,kGAO/Bu6C,GAAuB16C,EAAAA,EAAOC,IAAG06C,KAAAA,IAAAx6C,EAAAA,EAAAA,GAAA,4EAMjCy6C,GAAuB56C,EAAAA,EAAOC,IAAG46C,KAAAA,IAAA16C,EAAAA,EAAAA,GAAA,2EAMjC26C,GAAsB96C,EAAAA,EAAOY,OAAMm6C,KAAAA,IAAA56C,EAAAA,EAAAA,GAAA,sQAEnBe,GAA2B,WAAlBA,EAAMkD,QAAuB,UAAY,UAC7DlD,GAA2B,WAAlBA,EAAMkD,QAAuB,QAAU,UASnClD,GAA2B,WAAlBA,EAAMkD,QAAuB,UAAY,WAIpE42C,GAAgBh7C,EAAAA,EAAOC,IAAGg7C,KAAAA,IAAA96C,EAAAA,EAAAA,GAAA,oKAS1B+6C,GAAsBl7C,EAAAA,EAAOC,IAAGk7C,KAAAA,IAAAh7C,EAAAA,EAAAA,GAAA,kGAMhCi7C,GAAqBp7C,EAAAA,EAAOS,GAAE46C,KAAAA,IAAAl7C,EAAAA,EAAAA,GAAA,iJAU9Bm7C,GAA2Bt7C,EAAAA,EAAOY,OAAM26C,KAAAA,IAAAp7C,EAAAA,EAAAA,GAAA,kaA2BxCq7C,GAAoBx7C,EAAAA,EAAOC,IAAGw7C,KAAAA,IAAAt7C,EAAAA,EAAAA,GAAA,6EAI9Bu7C,GAAoB17C,EAAAA,EAAOC,IAAG07C,KAAAA,IAAAx7C,EAAAA,EAAAA,GAAA,qCAI9By7C,GAAgB57C,EAAAA,EAAOiC,MAAK45C,KAAAA,IAAA17C,EAAAA,EAAAA,GAAA,8KAU5B27C,GAAgB97C,EAAAA,EAAOuC,MAAKw5C,KAAAA,IAAA57C,EAAAA,EAAAA,GAAA,qVAuG5B67C,IAnFiBh8C,EAAAA,EAAOm5C,OAAM8C,KAAAA,IAAA97C,EAAAA,EAAAA,GAAA,+VAqBXH,EAAAA,EAAOC,IAAGi8C,KAAAA,IAAA/7C,EAAAA,EAAAA,GAAA,kIAORH,EAAAA,EAAOiC,MAAKk6C,KAAAA,IAAAh8C,EAAAA,EAAAA,GAAA,gXAKjBe,GAASA,EAAMqJ,QAAU,UAAY,UAI3CrJ,GAASA,EAAMqJ,QAAU,oDAAsD,QAI7ErJ,GAASA,EAAMqJ,QAAU,oDAAsD,WAMvEvK,EAAAA,EAAOuC,MAAK65C,KAAAA,IAAAj8C,EAAAA,EAAAA,GAAA,ggBA6BbH,EAAAA,EAAOC,IAAGo8C,KAAAA,IAAAl8C,EAAAA,EAAAA,GAAA,0FAGxBe,GAASA,EAAMqJ,QAAU,UAAY,WAInBvK,EAAAA,EAAOC,IAAGq8C,KAAAA,IAAAn8C,EAAAA,EAAAA,GAAA,6JASjCo8C,GAAuBv8C,EAAAA,EAAOY,OAAM47C,KAAAA,IAAAr8C,EAAAA,EAAAA,GAAA,6JAK9Be,GAASA,EAAMyB,SAAW,cAAgB,UAGlDzB,GAA2B,WAAlBA,EAAMkD,QAAoB,2LAAAgO,OAUrBlR,EAAMyB,SAAW,UAAY,UAAS,gDAAAyP,OAEhClR,EAAMyB,SAAW,UAAY,UAAS,kKA+ExD85C,IAlEoBz8C,EAAAA,EAAOC,IAAGy8C,KAAAA,IAAAv8C,EAAAA,EAAAA,GAAA,4yBACvBe,GAAyB,IAAhBA,EAAMy7C,MAAc,UAAY,6BAMtCz7C,GAAyB,IAAhBA,EAAMy7C,MAAc,UAAY,UACtCz7C,GAAyB,IAAhBA,EAAMy7C,MAAc,oBAAsB,oBACrDz7C,GAAyB,IAAhBA,EAAMy7C,MAAc,MAAQ,MAC3Cz7C,GAAyB,IAAhBA,EAAMy7C,MAAc,UAAY,UASlCz7C,GAAyB,IAAhBA,EAAMy7C,MAAc,UAAY,UAmBvCz7C,GAA8B,IAApBA,EAAMy7C,OAAS,GAC1Bz7C,GAAgC,KAAtBA,EAAMy7C,OAAS,GAAW,MAAQ,OAI5C38C,EAAAA,EAAOC,IAAG28C,KAAAA,IAAAz8C,EAAAA,EAAAA,GAAA,yFAOVH,EAAAA,EAAOiC,MAAK46C,KAAAA,IAAA18C,EAAAA,EAAAA,GAAA,mIASZH,EAAAA,EAAOuC,MAAKu6C,KAAAA,IAAA38C,EAAAA,EAAAA,GAAA,+DAOVH,EAAAA,EAAOY,OAAMm8C,KAAAA,IAAA58C,EAAAA,EAAAA,GAAA,oZA4B5B68C,GAAiBh9C,EAAAA,EAAOC,IAAGg9C,KAAAA,IAAA98C,EAAAA,EAAAA,GAAA,keAOPe,GAASA,EAAMs2C,SAAW,MAAQ,MAC1Bt2C,GAASA,EAAMs2C,SAAW,MAAQ,MAMvDt2C,GAASA,EAAMs2C,SAAW,EAAI,EAEvBt2C,GAASA,EAAMs2C,SAAW,OAAS,QAOjD0F,GAAiBl9C,EAAAA,EAAOC,IAAGk9C,KAAAA,IAAAh9C,EAAAA,EAAAA,GAAA,mYAQZe,GAASA,EAAMs2C,SAAW,EAAI,IAS7C4F,GAAiBp9C,EAAAA,EAAOC,IAAGo9C,KAAAA,IAAAl9C,EAAAA,EAAAA,GAAA,yPAMPe,GAASA,EAAMs2C,SAAW,IAAM,OAC7Ct2C,GAASA,EAAMs2C,SAAW,EAAI,GAIrC8F,GAAiBt9C,EAAAA,EAAOC,IAAGs9C,KAAAA,IAAAp9C,EAAAA,EAAAA,GAAA,4MAIPe,GAASA,EAAMs2C,SAAW,IAAM,OAC7Ct2C,GAASA,EAAMs2C,SAAW,EAAI,GAKrCgG,GAAcx9C,EAAAA,EAAOC,IAAGw9C,KAAAA,IAAAt9C,EAAAA,EAAAA,GAAA,8WAOJe,GAASA,EAAMs2C,SAAW,MAAQ,MAC1Bt2C,GAASA,EAAMs2C,SAAW,MAAQ,MAEvDt2C,GAASA,EAAMs2C,SAAW,EAAI,EAEvBt2C,GAASA,EAAMs2C,SAAW,OAAS,OACvCt2C,GAASA,EAAMs2C,SAAW,UAAY,UA8BhDkG,IAxBc19C,EAAAA,EAAOC,IAAG09C,KAAAA,IAAAx9C,EAAAA,EAAAA,GAAA,+FACbe,GAASA,EAAM08C,SAAW,MAAQ,MAE/B18C,GAASA,EAAM08C,SAAW,OAAS,QAGnB59C,EAAAA,EAAOC,IAAG49C,KAAAA,IAAA19C,EAAAA,EAAAA,GAAA,yLAUfH,EAAAA,EAAOC,IAAG69C,KAAAA,IAAA39C,EAAAA,EAAAA,GAAA,yMAQpBH,EAAAA,EAAOC,IAAG89C,KAAAA,IAAA59C,EAAAA,EAAAA,GAAA,+LAYzB69C,GAAqBh+C,EAAAA,EAAOC,IAAGg+C,KAAAA,IAAA99C,EAAAA,EAAAA,GAAA,kZAyB/B+9C,GAAiBl+C,EAAAA,EAAOC,IAAGk+C,KAAAA,IAAAh+C,EAAAA,EAAAA,GAAA,iZAyB3Bi+C,GAAqBp+C,EAAAA,EAAOC,IAAGo+C,KAAAA,IAAAl+C,EAAAA,EAAAA,GAAA,8PAC1Be,GAASA,EAAM+e,SAAW,UAAY,UACrC/e,GAASA,EAAM+e,SAAW,UAAY,cASrC/e,GAASA,EAAM+e,SAAW,EAAI,GAC3B/e,GAASA,EAAM+e,SAAW,2BAA6B,cAEnE/e,GAASA,EAAM+e,UAAQ,gPAerBq+B,GAAmBt+C,EAAAA,EAAOY,OAAM29C,KAAAA,IAAAp+C,EAAAA,EAAAA,GAAA,+gBA4BhCq+C,GAAuBx+C,EAAAA,EAAOC,IAAGw+C,KAAAA,IAAAt+C,EAAAA,EAAAA,GAAA,iUAmBjCu+C,GAAqB1+C,EAAAA,EAAOC,IAAG0+C,KAAAA,IAAAx+C,EAAAA,EAAAA,GAAA,qbAwB/By+C,GAAsB5+C,EAAAA,EAAOC,IAAG4+C,KAAAA,IAAA1+C,EAAAA,EAAAA,GAAA,iOAUhC2+C,GAAqB9+C,EAAAA,EAAOS,GAAEs+C,KAAAA,IAAA5+C,EAAAA,EAAAA,GAAA,gLAc9B6+C,GAA2Bh/C,EAAAA,EAAOY,OAAMq+C,KAAAA,IAAA9+C,EAAAA,EAAAA,GAAA,mVAmBxC++C,GAAsBl/C,EAAAA,EAAOuC,MAAK48C,KAAAA,IAAAh/C,EAAAA,EAAAA,GAAA,wTAmBlCi/C,GAAuBp/C,EAAAA,EAAOC,IAAGo/C,KAAAA,IAAAl/C,EAAAA,EAAAA,GAAA,6DAMjCm/C,GAAet/C,EAAAA,EAAOC,IAAGs/C,KAAAA,IAAAp/C,EAAAA,EAAAA,GAAA,+GAQzBq/C,GAAex/C,EAAAA,EAAOC,IAAGw/C,KAAAA,IAAAt/C,EAAAA,EAAAA,GAAA,0RAgBzBu/C,GAAmB1/C,EAAAA,EAAOC,IAAG0/C,KAAAA,IAAAx/C,EAAAA,EAAAA,GAAA,iUAmB7By/C,GAAiB5/C,EAAAA,EAAOC,IAAG4/C,KAAAA,IAAA1/C,EAAAA,EAAAA,GAAA,qbAwB3B2/C,GAAkB9/C,EAAAA,EAAOC,IAAG8/C,KAAAA,IAAA5/C,EAAAA,EAAAA,GAAA,iOAU5B6/C,GAAiBhgD,EAAAA,EAAOS,GAAEw/C,KAAAA,IAAA9/C,EAAAA,EAAAA,GAAA,+LAe1B+/C,GAAuBlgD,EAAAA,EAAOY,OAAMu/C,KAAAA,IAAAhgD,EAAAA,EAAAA,GAAA,oXAuBpCigD,GAAmBpgD,EAAAA,EAAOC,IAAGogD,KAAAA,IAAAlgD,EAAAA,EAAAA,GAAA,6DAM7BmgD,GAAuBtgD,EAAAA,EAAOuC,MAAKg+C,KAAAA,IAAApgD,EAAAA,EAAAA,GAAA,gVAoBnCqgD,GAAWxgD,EAAAA,EAAOC,IAAGwgD,KAAAA,IAAAtgD,EAAAA,EAAAA,GAAA,+GAQrBugD,GAAW1gD,EAAAA,EAAOC,IAAG0gD,KAAAA,IAAAxgD,EAAAA,EAAAA,GAAA,oQAcrBygD,GAAkB5gD,EAAAA,EAAOC,IAAG4gD,KAAAA,IAAA1gD,EAAAA,EAAAA,GAAA,oDAEfe,GAASA,EAAM4/C,WAAa,OAAS,KAGlDC,GAAkB/gD,EAAAA,EAAOC,IAAG+gD,KAAAA,IAAA7gD,EAAAA,EAAAA,GAAA,yGAQ5B8gD,GAAiBjhD,EAAAA,EAAOC,IAAGihD,KAAAA,IAAA/gD,EAAAA,EAAAA,GAAA,qSAQjBe,GACQ,WAAhBA,EAAMkC,MAA2B,oDACjB,SAAhBlC,EAAMkC,MAAyB,oDAC5B,qDAWL+9C,GAAkBnhD,EAAAA,EAAOC,IAAGmhD,KAAAA,IAAAjhD,EAAAA,EAAAA,GAAA,sHAQ5BkhD,GAAmBrhD,EAAAA,EAAOY,OAAM0gD,KAAAA,IAAAnhD,EAAAA,EAAAA,GAAA,siCAyEhCohD,IAvBqBvhD,EAAAA,EAAOm5C,OAAMqI,KAAAA,IAAArhD,EAAAA,EAAAA,GAAA,0YAuBbH,EAAAA,EAAOC,IAAGwhD,KAAAA,IAAAthD,EAAAA,EAAAA,GAAA,8LAa/BuhD,GAAoB1hD,EAAAA,EAAOC,IAAG0hD,KAAAA,IAAAxhD,EAAAA,EAAAA,GAAA,+HAQ9ByhD,GAAkB5hD,EAAAA,EAAOY,OAAMihD,KAAAA,IAAA1hD,EAAAA,EAAAA,GAAA,sbAEfe,GAASA,EAAM+B,SAAW,UAAY,UAE5C/B,GAASA,EAAM+B,SAAW,oDAAsD,QACrF/B,GAASA,EAAM+B,SAAW,QAAU,UACnC/B,GAASA,EAAMyB,SAAW,cAAgB,UACzCzB,GAASA,EAAMyB,SAAW,GAAM,EAY3BzB,GAASA,EAAM+B,SAAW,oDAAsD,WAQ5F6+C,GAAe9hD,EAAAA,EAAOC,IAAG8hD,KAAAA,IAAA5hD,EAAAA,EAAAA,GAAA,8HAOzB6hD,GAAehiD,EAAAA,EAAOiC,MAAKggD,KAAAA,IAAA9hD,EAAAA,EAAAA,GAAA,+eAMXe,GAASA,EAAM+B,SAAW,UAAY,UAE5C/B,GAASA,EAAM+B,SAAW,4BAA8B,QAC5D/B,GAASA,EAAMyB,SAAW,cAAgB,UACzCzB,GAASA,EAAMyB,SAAW,GAAM,EAIlCzB,GAASA,EAAM+B,SAAW,UAAY,UAUnC/B,GAASA,EAAMyB,SAAW,cAAgB,WAKlDu/C,GAAkBliD,EAAAA,EAAOC,IAAGkiD,KAAAA,IAAAhiD,EAAAA,EAAAA,GAAA,6dAyB5BiiD,GAAuBpiD,EAAAA,EAAOqiD,GAAEC,KAAAA,IAAAniD,EAAAA,EAAAA,GAAA,uFAI3Be,GACU,aAAjBA,EAAMmpB,OAAwB,UACb,UAAjBnpB,EAAMmpB,OAAqB,UACV,cAAjBnpB,EAAMmpB,OAAyB,UAAY,WAIzCk4B,GAAyBviD,EAAAA,EAAOC,IAAGuiD,KAAAA,IAAAriD,EAAAA,EAAAA,GAAA,8FAOnCsiD,GAAyBziD,EAAAA,EAAOC,IAAGyiD,KAAAA,IAAAviD,EAAAA,EAAAA,GAAA,6DAMnCwiD,GAAkB3iD,EAAAA,EAAOY,OAAMgiD,KAAAA,IAAAziD,EAAAA,EAAAA,GAAA,6mBAiD/B0iD,GAAe7iD,EAAAA,EAAOC,IAAG6iD,KAAAA,IAAA3iD,EAAAA,EAAAA,GAAA,8PAczB4iD,GAAiB/iD,EAAAA,EAAOC,IAAG+iD,KAAAA,IAAA7iD,EAAAA,EAAAA,GAAA,qOAY3B8iD,GAAgBjjD,EAAAA,EAAOC,IAAGijD,KAAAA,IAAA/iD,EAAAA,EAAAA,GAAA,kGAM1BgjD,GAAenjD,EAAAA,EAAOyB,GAAE2hD,KAAAA,IAAAjjD,EAAAA,EAAAA,GAAA,iJAUxBkjD,GAAqBrjD,EAAAA,EAAOY,OAAM0iD,KAAAA,IAAAnjD,EAAAA,EAAAA,GAAA,6WAsBlCojD,GAAiBvjD,EAAAA,EAAOC,IAAGujD,KAAAA,IAAArjD,EAAAA,EAAAA,GAAA,sIAQ3BsjD,GAAsBzjD,EAAAA,EAAOqiD,GAAEqB,KAAAA,IAAAvjD,EAAAA,EAAAA,GAAA,mNAY/BwjD,GAAe3jD,EAAAA,EAAOC,IAAG2jD,KAAAA,IAAAzjD,EAAAA,EAAAA,GAAA,mOAazB0jD,GAAoB7jD,EAAAA,EAAO2D,KAAImgD,KAAAA,IAAA3jD,EAAAA,EAAAA,GAAA,kHAQ/B4jD,GAAoB/jD,EAAAA,EAAO2D,KAAIqgD,KAAAA,IAAA7jD,EAAAA,EAAAA,GAAA,6JAU/B8jD,GAAmBjkD,EAAAA,EAAOC,IAAGikD,KAAAA,IAAA/jD,EAAAA,EAAAA,GAAA,kCAI7BgkD,GAAcnkD,EAAAA,EAAOC,IAAGmkD,KAAAA,IAAAjkD,EAAAA,EAAAA,GAAA,oLAYxBkkD,GAAmBrkD,EAAAA,EAAOC,IAAGqkD,KAAAA,IAAAnkD,EAAAA,EAAAA,GAAA,sGAO7BokD,GAAqBvkD,EAAAA,EAAOC,IAAGukD,KAAAA,IAAArkD,EAAAA,EAAAA,GAAA,iIAQ/BskD,GAAezkD,EAAAA,EAAO2D,KAAI+gD,KAAAA,IAAAvkD,EAAAA,EAAAA,GAAA,yMAChBe,GACO,OAAfA,EAAMC,KAAsB,UACb,YAAfD,EAAMC,KAA2B,UAC9B,WAWLwjD,GAAoB3kD,EAAAA,EAAOC,IAAG2kD,KAAAA,IAAAzkD,EAAAA,EAAAA,GAAA,6FAQ9B0kD,GAAuB7kD,EAAAA,EAAOC,IAAG6kD,KAAAA,IAAA3kD,EAAAA,EAAAA,GAAA,2EAMjC4kD,GAAiB/kD,EAAAA,EAAO2D,KAAIqhD,KAAAA,IAAA7kD,EAAAA,EAAAA,GAAA,+OAGvBe,GAASA,EAAMyB,SAAW,UAAY,WAYjD,SAASsiD,GAAal/B,GAA2E,IAA1E,UAAEjH,EAAS,MAAE1W,EAAK,SAAEoC,EAAQ,OAAE06C,EAAM,SAAEviD,EAAQ,SAAED,EAAQ,YAAEmI,GAAakb,EAC5F,MAAMo/B,GAAWz1C,EAAAA,EAAAA,QAAO,OACjB01C,EAAYC,IAAiB7/C,EAAAA,EAAAA,UAAS,KACtC8/C,EAAWC,IAAgB//C,EAAAA,EAAAA,WAAS,GAGrCggD,EAAkBC,IACtB,IAAKA,GAAe,IAARA,EAAW,MAAO,GAC9B,MAAMC,EAAMhnC,WAAW+mC,EAAI9zC,WAAWiX,QAAQ,YAAa,KAC3D,OAAIspB,MAAMwT,GAAa,GAEhBA,EAAIC,QAAQ,GAAG/8B,QAAQ,wBAAyB,KAAKA,QAAQ,IAAK,OAI3EviB,EAAAA,EAAAA,WAAU,KACR,IAAKi/C,EAAW,CACd,MAAMM,EAAiBJ,EAAep9C,GAAS,IAC3Cg9C,IAAeQ,GACjBP,EAAcO,EAElB,GACC,CAACx9C,EAAOk9C,IAyCX,OACEr8C,EAAAA,GAAAA,MAAC47C,GAAoB,CAAA77C,SAAA,EACnBC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAACkN,EAAAA,EAAU,KACXlN,EAAAA,GAAAA,KAACzG,GAAK,CACJ0O,IAAKm0C,EACLhkD,KAAK,OACL6Q,KAAM8M,EACNjU,YAAaA,EACbzC,MAAOg9C,EACP56C,SAjDcvC,IACpB,MAAM49C,EAAW59C,EAAE2C,OAAOxC,MAG1Bi9C,EAAcQ,GAId,MAAMC,EAAaD,EAASj9B,QAAQ,YAAa,IAAIA,QAAQ,IAAK,KAC5Dm9B,EAAWrnC,WAAWonC,GACtBE,EAAa9T,MAAM6T,GAAY,GAAKA,EAASJ,QAAQ,GAG3Dn7C,EAASsU,EAAWknC,IAqCdC,QAlCYC,KAClBX,GAAa,IAkCPL,OA/BgBiB,KACtBZ,GAAa,GAGb,MAAMa,EAAYZ,EAAeJ,GACjCC,EAAce,GAGd,MAAMN,EAAaV,EAAWx8B,QAAQ,YAAa,IAAIA,QAAQ,IAAK,KAC9Dm9B,EAAWrnC,WAAWonC,GACtBE,EAAa9T,MAAM6T,GAAY,GAAKA,EAASJ,QAAQ,GAIvDT,GACFA,EAAOpmC,EAAWknC,IAiBdrjD,SAAUA,EACViH,MAAO,CAAEE,UAAW,QAASu8C,aAAc,QAC3C3jD,SAAUA,EACVD,SAAO,QAGXsG,EAAAA,GAAAA,KAACg8C,GAAc,CAACpiD,SAAUA,EAASqG,SAAC,cAG1C,CAGA,SAASs9C,GAAUp/B,GAA6F,IAA5F,UAAEpI,EAAS,MAAE1W,EAAK,SAAEoC,EAAQ,OAAE06C,EAAM,SAAEviD,EAAQ,SAAED,EAAQ,YAAEmI,EAAc,iBAAiBqc,EAC3G,MAAO5iB,EAAQiiD,IAAa/gD,EAAAA,EAAAA,WAAS,IAC9BghD,EAAcC,IAAmBjhD,EAAAA,EAAAA,UAAS,IAAIigB,OAC9CihC,EAAaC,IAAkBnhD,EAAAA,EAAAA,WAAS,GACzCohD,GAAal3C,EAAAA,EAAAA,QAAO,MACpBm3C,GAAcn3C,EAAAA,EAAAA,QAAO,MAGrBo3C,EAAe1+C,EAAQ,IAAIqd,KAAKrd,GAAS,MAG/C/B,EAAAA,EAAAA,WAAU,KACR,GAAI+B,EAAO,CACT,MAAM6pC,EAAO,IAAIxsB,KAAKrd,GACjB8pC,MAAMD,EAAKE,YACdsU,EAAgBxU,EAEpB,GACC,CAAC7pC,KAGJ/B,EAAAA,EAAAA,WAAU,KACR,MAAMkX,EAAsBC,IACtBopC,EAAW52C,UAAY42C,EAAW52C,QAAQ2M,SAASa,EAAM5S,SAC3D27C,GAAU,IAOd,OAHIjiD,GACF2X,SAASjB,iBAAiB,YAAauC,GAElC,IAAMtB,SAAShB,oBAAoB,YAAasC,IACtD,CAACjZ,KAGJ+B,EAAAA,EAAAA,WAAU,KACR,GAAI/B,GAAUsiD,EAAW52C,QAAS,CAChC,MAAM+2C,EAAgBA,KACpB,IAAKH,EAAW52C,QAAS,OAEzB,MAAMg3C,EAAaJ,EAAW52C,QAAQE,wBAKhC+2C,EAAa72C,OAAO2J,YAAcitC,EAAWE,OAH9B,GACN,GAGTC,EAAaH,EAAWrrC,IAHf,GAQfgrC,EAFyBM,EAAa,KAAQA,EARvB,KAQsDE,EAAaF,EAAa,KAKzGF,IAGA,MAAMK,EAAkBnrC,SAASorC,cAAc,gCAC/C,GAAID,EAEF,OADAA,EAAgBpsC,iBAAiB,SAAU+rC,GACpC,IAAMK,EAAgBnsC,oBAAoB,SAAU8rC,EAE/D,GACC,CAACziD,IAGJ,MAqDMgjD,EAAoBrV,IACxB,MAAMsV,EA1CiBtV,KACvB,MAAMlzC,EAAI,IAAI0mB,KAAKwsB,GACbG,EAAOrzC,EAAEszC,cACTC,EAAQxhC,OAAO/R,EAAEwzC,WAAa,GAAGC,SAAS,EAAG,KAC7CC,EAAM3hC,OAAO/R,EAAE2zC,WAAWF,SAAS,EAAG,KAC5C,MAAM,GAANpgC,OAAUggC,EAAI,KAAAhgC,OAAIkgC,EAAK,KAAAlgC,OAAIqgC,IAqCL+U,CAAgBvV,GAEtCznC,EAAS+8C,GACLrC,GACFA,EAAOqC,GAEThB,GAAU,IAuCNkB,EAAQ,IAAIhiC,KACZiiC,EA/EkBC,MACtB,MAAMvV,EAAOoU,EAAanU,cACpBC,EAAQkU,EAAajU,WAErBqV,EAAW,IAAIniC,KAAK2sB,EAAME,EAAO,GACjCuV,EAAU,IAAIpiC,KAAK2sB,EAAME,EAAQ,EAAG,GAGpCwV,EAAO,GAGb,IAAK,IAAIC,GAJ8B,IAAtBH,EAASI,SAAiB,EAAIJ,EAASI,SAAW,GAI3C,EAAGD,GAAK,EAAGA,IAAK,CACtC,MAAM9V,EAAO,IAAIxsB,KAAK2sB,EAAME,GAAQyV,GACpCD,EAAKjiC,KAAK,CAAEosB,OAAMgW,cAAc,GAClC,CAGA,IAAK,IAAIF,EAAI,EAAGA,GAAKF,EAAQnV,UAAWqV,IAAK,CAC3C,MAAM9V,EAAO,IAAIxsB,KAAK2sB,EAAME,EAAOyV,GACnCD,EAAKjiC,KAAK,CAAEosB,OAAMgW,cAAc,GAClC,CAGA,MAAMC,EAAgB,GAAKJ,EAAK99C,OAChC,IAAK,IAAI+9C,EAAI,EAAGA,GAAKG,EAAeH,IAAK,CACvC,MAAM9V,EAAO,IAAIxsB,KAAK2sB,EAAME,EAAQ,EAAGyV,GACvCD,EAAKjiC,KAAK,CAAEosB,OAAMgW,cAAc,GAClC,CAEA,OAAOH,GAkDYH,GAEfQ,EAAc//C,EAtGO6pC,KACzB,IAAKA,EAAM,MAAO,GAClB,IACE,MAAMlzC,EAAI,IAAI0mB,KAAKwsB,GACnB,OAAIC,MAAMnzC,EAAEozC,WAAmB,GACxBpzC,EAAEqpD,mBAAmB,QAAS,CAAE3V,IAAK,UAAWH,MAAO,UAAWF,KAAM,WACjF,CAAE,MAAO9kB,GACP,MAAO,EACT,GA8F0B+6B,CAAkBjgD,GAASyC,EAEvD,OACE5B,EAAAA,GAAAA,MAACq/C,GAAiB,CAACt3C,IAAK41C,EAAY,aAAY9nC,EAAU9V,SAAA,EACxDC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAAC+M,EAAAA,EAAQ,KACT/M,EAAAA,GAAAA,KAACw/C,GAAe,CACdpnD,KAAK,SACL+H,QAASA,KAAOvG,GAAY4jD,GAAWjiD,GACvC3B,SAAUA,EACVD,SAAUA,EACV8lD,WAAYpgD,EACZ,kBAAiB0W,EAAU9V,SAE1Bm/C,IAIF//C,IAAUzF,IACToG,EAAAA,GAAAA,KAAC0/C,GAAe,CACdtnD,KAAK,SACL+H,QAAUjB,IACRA,EAAEuU,iBACFvU,EAAEkB,kBAtDOlB,KACfA,IACFA,EAAEuU,iBACFvU,EAAEkB,mBAEJqB,EAAS,IACL06C,GACFA,EAAO,IAETqB,GAAU,IA8CAmC,CAAYzgD,IAEdwB,MAAM,eAAcT,SACrB,YAMDrG,IACAoG,EAAAA,GAAAA,KAAC4/C,GAAe,CACdxnD,KAAK,SACL+H,QAAUjB,IACRA,EAAEuU,iBACFvU,EAAEkB,kBA7EOlB,KACfA,IACFA,EAAEuU,iBACFvU,EAAEkB,mBAEJm+C,EAAiB,IAAI7hC,OAyEXmjC,CAAY3gD,IAEdwB,MAAM,gCAAuBT,SAC9B,oBAMJ1E,IAAW3B,IACVsG,EAAAA,GAAAA,MAAC4/C,GAAiB,CAAC73C,IAAK61C,EAAaH,YAAaA,EAAY19C,SAAA,EAC5DC,EAAAA,GAAAA,MAAC6/C,GAAc,CAAA9/C,SAAA,EACbD,EAAAA,GAAAA,KAACggD,GAAW,CAAC7/C,QAAUjB,IACrBA,EAAEuU,iBACFvU,EAAEkB,kBAxEKlB,KACbA,IACFA,EAAEuU,iBACFvU,EAAEkB,mBAEJs9C,EAAgB,IAAIhhC,KAAK+gC,EAAanU,cAAemU,EAAajU,WAAa,KAoErEyW,CAAU/gD,IACVe,SAAC,YACHC,EAAAA,GAAAA,MAACggD,GAAa,CAAAjgD,SAAA,EACZD,EAAAA,GAAAA,KAAA,QAAAC,SAAOw9C,EAAa4B,mBAAmB,QAAS,CAAE9V,MAAO,YACzDvpC,EAAAA,GAAAA,KAAA,QAAAC,SAAOw9C,EAAanU,oBAEtBtpC,EAAAA,GAAAA,KAACggD,GAAW,CAAC7/C,QAAUjB,IACrBA,EAAEuU,iBACFvU,EAAEkB,kBAzEKlB,KACbA,IACFA,EAAEuU,iBACFvU,EAAEkB,mBAEJs9C,EAAgB,IAAIhhC,KAAK+gC,EAAanU,cAAemU,EAAajU,WAAa,KAqErE2W,CAAUjhD,IACVe,SAAC,eAGLC,EAAAA,GAAAA,MAACkgD,GAAY,CAAAngD,SAAA,EACXD,EAAAA,GAAAA,KAACqgD,GAAW,CAAApgD,SAAC,QACbD,EAAAA,GAAAA,KAACqgD,GAAW,CAAApgD,SAAC,WACbD,EAAAA,GAAAA,KAACqgD,GAAW,CAAApgD,SAAC,QACbD,EAAAA,GAAAA,KAACqgD,GAAW,CAAApgD,SAAC,aACbD,EAAAA,GAAAA,KAACqgD,GAAW,CAAApgD,SAAC,WACbD,EAAAA,GAAAA,KAACqgD,GAAW,CAAApgD,SAAC,QACbD,EAAAA,GAAAA,KAACqgD,GAAW,CAAApgD,SAAC,OAEZ0+C,EAAar9C,IAAI,CAACooC,EAAK7d,KACtB,MAAMy0B,EAAU5W,EAAIR,KAAKqX,iBAAmB7B,EAAM6B,eAC5CC,EAAazC,GAAgBrU,EAAIR,KAAKqX,iBAAmBxC,EAAawC,eAE5E,OACEvgD,EAAAA,GAAAA,KAACygD,GAAY,CAEXtgD,QAAUjB,IACRA,EAAEkB,kBACFm+C,EAAiB7U,EAAIR,OAEvBoX,QAASA,EACTE,WAAYA,EACZtB,aAAcxV,EAAIwV,aAAaj/C,SAE9BypC,EAAIR,KAAKS,WATL9d,SAeb3rB,EAAAA,GAAAA,MAACwgD,GAAc,CAAAzgD,SAAA,EACbD,EAAAA,GAAAA,KAAC2gD,GAAc,CACblY,UAAU,QACVtoC,QAAUjB,IACRA,EAAEuU,iBACFvU,EAAEkB,kBACFm+C,EAAiB,IAAI7hC,OACrBzc,SACH,UAGDD,EAAAA,GAAAA,KAAC2gD,GAAc,CACblY,UAAU,QACVtoC,QAAUjB,IACRA,EAAEuU,iBACFvU,EAAEkB,kBACFqB,EAAS,IACL06C,GACFA,EAAO,IAETqB,GAAU,IACVv9C,SACH,mBAQb,CAGA,MAAMs/C,GAAoBtoD,EAAAA,EAAOC,IAAG0pD,KAAAA,IAAAxpD,EAAAA,EAAAA,GAAA,iDAK9BooD,GAAkBvoD,EAAAA,EAAOY,OAAMgpD,KAAAA,IAAAzpD,EAAAA,EAAAA,GAAA,+qBAKlBe,GAASA,EAAMyB,SAAW,UAAYzB,EAAMsnD,SAAW,SAAW,OAC/DtnD,GAASA,EAAMwB,SAAW,UAAY,UAE5CxB,GAASA,EAAMyB,SAAW,UAAY,QAC3CzB,GAASA,EAAMyB,SAAW,UAAYzB,EAAMsnD,SAAW,UAAY,UAE7DtnD,GAASA,EAAMsnD,WAAatnD,EAAMyB,SAAW,MAAQ,MAE1DzB,GAASA,EAAMyB,SAAW,cAAgB,WAqBhD8lD,GAAkBzoD,EAAAA,EAAOY,OAAMipD,KAAAA,IAAA1pD,EAAAA,EAAAA,GAAA,4dA0B/BwoD,GAAkB3oD,EAAAA,EAAOY,OAAMkpD,KAAAA,IAAA3pD,EAAAA,EAAAA,GAAA,2fA2B/B0oD,GAAoB7oD,EAAAA,EAAOC,IAAG8pD,KAAAA,IAAA5pD,EAAAA,EAAAA,GAAA,kOAEhCe,GAASA,EAAMwlD,YAAW,6GAiBxBoC,GAAiB9oD,EAAAA,EAAOC,IAAG+pD,KAAAA,IAAA7pD,EAAAA,EAAAA,GAAA,kLAS3B4oD,GAAc/oD,EAAAA,EAAOY,OAAMqpD,KAAAA,IAAA9pD,EAAAA,EAAAA,GAAA,gYAsB3B8oD,GAAgBjpD,EAAAA,EAAOC,IAAGiqD,KAAAA,IAAA/pD,EAAAA,EAAAA,GAAA,4GAQ1BgpD,GAAenpD,EAAAA,EAAOC,IAAGkqD,KAAAA,IAAAhqD,EAAAA,EAAAA,GAAA,mFAMzBipD,GAAcppD,EAAAA,EAAOC,IAAGmqD,KAAAA,IAAAjqD,EAAAA,EAAAA,GAAA,wLAWxBqpD,GAAexpD,EAAAA,EAAOY,OAAMypD,KAAAA,IAAAlqD,EAAAA,EAAAA,GAAA,mWAQlBe,GAASA,EAAMmoD,QAAU,UAAYnoD,EAAMqoD,WAAa,UAAY,cACzEroD,GAASA,EAAMqoD,WAAa,QAAUroD,EAAM+mD,aAAe,UAAY,UACjE/mD,GAASA,EAAMmoD,SAAWnoD,EAAMqoD,WAAa,MAAQ,MAKpDroD,GAASA,EAAMqoD,WAAa,UAAY,UAE7CroD,GAASA,EAAMqoD,WAAa,QAAU,WAI7CE,GAAiBzpD,EAAAA,EAAOC,IAAGqqD,KAAAA,IAAAnqD,EAAAA,EAAAA,GAAA,6HAQ3BupD,GAAiB1pD,EAAAA,EAAOY,OAAM2pD,KAAAA,IAAApqD,EAAAA,EAAAA,GAAA,8ZAsC9BqqD,GAAyBxqD,EAAAA,EAAOC,IAAGwqD,KAAAA,IAAAtqD,EAAAA,EAAAA,GAAA,sTAmBnCuqD,GAAkB1qD,EAAAA,EAAO2D,KAAIgnD,KAAAA,IAAAxqD,EAAAA,EAAAA,GAAA,gOAe7ByqD,GAAuB5qD,EAAAA,EAAOC,IAAG4qD,KAAAA,IAAA1qD,EAAAA,EAAAA,GAAA,kgCA+CjC2qD,GAAoB9qD,EAAAA,EAAOC,IAAG8qD,KAAAA,IAAA5qD,EAAAA,EAAAA,GAAA,iMAY9B6qD,GAAsBhrD,EAAAA,EAAO2D,KAAIsnD,KAAAA,IAAA9qD,EAAAA,EAAAA,GAAA,kDAKjC+qD,GAAsBlrD,EAAAA,EAAO2D,KAAIwnD,KAAAA,IAAAhrD,EAAAA,EAAAA,GAAA,sKAoBjCirD,GAA0BA,CAACC,EAAgBC,KAC/C,IAAKvjD,MAAMC,QAAQqjD,IAA6C,IAA1BA,EAAerhD,OACnD,OAAOqhD,EAKT,OAAOA,EAAehhD,IAAIsX,GAET2pC,EAAiBloC,KAAKC,GAClCA,EAAIjb,OAASib,EAAIjb,QAAUuZ,GAC3B0B,EAAI1B,KAAO0B,EAAI1B,MAAQA,GACvB0B,EAAIvB,WAAauB,EAAIvB,YAAcH,GAO/BA,EAdkB,QAiCvB4pC,GAAkCC,IACtC,IAAKA,EAAa,MAAO,CAAC,EAE1B,MAAMC,GAAWnjD,EAAAA,EAAAA,GAAA,GAAQkjD,GA2BzB,GAxBIA,EAAYruB,UAAYquB,EAAYv5B,qBAEtCw5B,EAAYx5B,mBAAqBlqB,MAAMC,QAAQwjD,EAAYruB,SACvDquB,EAAYruB,QAAQ9yB,IAAIqX,IAAIpZ,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACvBoZ,GAAI,IACPqT,aAA2C,kBAAtBrT,EAAKqT,aACtBrT,EAAKqT,aAAa4wB,QAAQ,IACzBjnC,YAAYgD,EAAKqT,cAAgB,KAAKpjB,WAAWiX,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,GAAG+8B,QAAQ,GAChH3wB,WAAuC,kBAApBtT,EAAKsT,WACpBtT,EAAKsT,WAAW2wB,QAAQ,IACvBjnC,YAAYgD,EAAKsT,YAAc,KAAKrjB,WAAWiX,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,GAAG+8B,QAAQ,GAC9G+F,UAAWjxC,SAASiH,EAAKgqC,YAAc,MAEzC,UACGD,EAAYtuB,SAIjBquB,EAAY1/B,gBACd2/B,EAAY3/B,cAAgBtK,GAA8BgqC,EAAY1/B,gBAKpE0/B,EAAYxnC,YAAa,CAE3B,MAAM7B,EAAYD,GAAgCspC,EAAYxnC,aAG9DvY,OAAOogB,OAAO4/B,EAAatpC,EAC7B,CAaA,GANIqpC,EAAYpwB,mBAAqBowB,EAAYrwB,WAC/CswB,EAAYtwB,SAAWqwB,EAAYpwB,kBAKjCowB,EAAYzwB,mBAC+B,kBAAlCywB,EAAYzwB,mBAAkCywB,EAAYzwB,kBAAkBxvB,OAAO2S,WAAW,KACvG,IACE,MAAM2D,EAASha,KAAKC,MAAM0jD,EAAYzwB,mBAClChzB,MAAMC,QAAQ6Z,KAChB4pC,EAAY1wB,kBAAoBlZ,EAEpC,CAAE,MAAO5Z,GACP,MAQ6Cib,IAA/CsoC,EAAYtuB,iCACduuB,EAAYvuB,+BAAiCziB,SAAS+wC,EAAYtuB,+BAAgC,KAAO,QAKzEha,IAA9BsoC,EAAYjwB,gBACdkwB,EAAYlwB,cAAgB3Z,QAAQ4pC,EAAYjwB,qBAEdrY,IAAhCsoC,EAAYr2B,kBACds2B,EAAYt2B,gBAAkBvT,QAAQ4pC,EAAYr2B,kBAuBpD,GAhByB,CACvB,eACA,wBACA,gBACA,cACA,qBACA,kBAGe7W,QAAQnW,SACI+a,IAAvBsoC,EAAYrjD,KACdsjD,EAAYtjD,GAASqjD,EAAYrjD,MAKjCqjD,EAAY7e,SAAU,CAExB,IAAIgf,EAAeH,EAAY7e,SAG3Bif,EAAgB,EACpB,KAA+B,kBAAjBD,GAA6BA,EAAapgD,OAAO2S,WAAW,MAAQ0tC,EAAgB,GAAG,CACnG,IACE,MAAM/pC,EAASha,KAAKC,MAAM6jD,GAG1B,QAAoBzoC,IAAhBrB,EAAOsgB,KAIT,MAHAwpB,EAAe9pC,EAAOsgB,IAK1B,CAAE,MAAOl6B,GAEP,KACF,CACA2jD,GACF,CAEAH,EAAYI,oBAAsBF,SAC3BF,EAAY9e,QACrB,CAKA,GAAI6e,EAAYn5B,4BAAgF,kBAA3Cm5B,EAAYn5B,2BAC/D,IACE,MAAMxQ,EAASha,KAAKC,MAAM0jD,EAAYn5B,4BACtCo5B,EAAYp5B,2BAA6BxQ,CAC3C,CAAE,MAAO5Z,GACP,CAIJ,OAAOwjD,GAIT,SAASK,KAAe,IAAD/xB,EAAAgyB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAjjB,EAAAC,EAAAijB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GACrB,MAAMC,IAAWC,EAAAA,EAAAA,OACX,UAAEC,KAAcjpD,EAAAA,EAAAA,YAAWkpD,GAAAA,KAAiB,CAAC,GAC7C,WAAEnpD,GAAU,QAAE0L,GAAO,SAAE3L,GAAQ,MAAED,GAAK,KAAEyiB,GAAI,gBAAE7iB,GAAe,cAAE6J,KAAkBtJ,EAAAA,EAAAA,YAAWC,GAAAA,KAAgB,CAAC,GAC7G,gBAAEkpD,KAAoBC,EAAAA,GAAAA,OACtB,SAAEC,GAAUC,MAAOC,GAAqBC,YAAaC,GAAmBC,KAAMC,GAAoBC,KAAMC,GAAoBljC,MAAOmjC,KAAwB9pD,EAAAA,EAAAA,YAAW+pD,GAAAA,IAAoB,CAAC,EAG3LC,IAAwB1/C,EAAAA,EAAAA,SAAO,GAG/B2/C,IAAWC,EAAAA,EAAAA,MACXC,IAAYzlB,EAAAA,EAAAA,SAAQ,IAAM,IAAI0lB,gBAAgBH,GAASI,QAAS,CAACJ,GAASI,SAG1EC,GAAqBH,GAAUI,IAAI,QACnCxrC,GAAWyrC,GAAAA,QAAaC,cACxBC,GAA4B,OAAR3rC,SAAQ,IAARA,QAAQ,EAARA,GAAUyS,YAC9BA,GAAc84B,IAAsBI,IAG1CzpD,EAAAA,EAAAA,WAAU,KAEkBiB,WACxB,IAAIyoD,EAAe,OACfvkC,EAAU,KACVomB,EAAc,GAElB,IACE,GAAI/gC,GAAS,CACX++C,GAAAA,QAAaI,eAAen/C,IAGX++C,GAAAA,QAAaC,cAG9B,SAF2BD,GAAAA,QAAaK,WAEtB,CAChB,MAAMC,QAAkBN,GAAAA,QAAaO,YAEjCD,GAAaA,EAAU15C,WAErB05C,EAAUE,cAAgBF,EAAU15C,SAASnE,IAE/C09C,EAAe,UACfvkC,EAAU0kC,EAAUE,aACpBxe,EAAcse,EAAU15C,SAAS4kB,kBAAoB80B,EAAU15C,SAAS2kB,UAAY,KAGpF40B,EAAe,UACfvkC,EAAU,KACVomB,EAAc,IAGpB,MAAWhb,KAETm5B,EAAe,UACfvkC,EAAU/Q,SAASmc,IACnBgb,EAAc,GAGdge,GAAAA,QAAaS,aAAa,CAAEz5B,YAAaA,KAE7C,MAAWA,KAETm5B,EAAe,UACfvkC,EAAU/Q,SAASmc,IACnBgb,EAAc,GAElB,CAAE,MAAOnqC,GAEHmvB,KACFm5B,EAAe,UACfvkC,EAAU/Q,SAASmc,IACnBgb,EAAc,GAElB,CAGA,MAAMngB,EAAQ,CACZ6+B,WAA6B,YAAjBP,EACZQ,WAA6B,SAAjBR,EACZvkC,QAASA,EACTomB,YAAaA,EACbpjC,aAAc,EACdg9B,kBAAmB,OACnBykB,SAA2B,SAAjBF,EACVjqC,UAAWL,KAAKC,OAGlBtV,OAAOogD,iBAAmB/+B,EAC1BrhB,OAAOqgB,cAAc,IAAIF,YAAY,uBAAwB,CAAEC,OAAQiB,MAGzEg/B,IACC,CAAC75B,GAAa/lB,KAEjB,MAAMgmB,GAAmB04B,GAAUI,IAAI,gBAUhC58B,GAAe29B,KAAoBlrD,EAAAA,EAAAA,UAAS,CACjDqwB,YAAY,EACZC,WAAW,EACXxV,SAAS,EAGT0D,aAAa,EACb+R,WAAW,EACXC,SAAS,EACTC,SAAS,EACTC,iBAAiB,EACjBhB,eAAe,EAGfoS,sBAAsB,EACtBG,eAAe,EACfpS,wBAAwB,EAGxB4S,mBAAmB,EACnBC,kBAAkB,EAClBC,WAAW,EAEXI,WAAW,EACXooB,eAAe,KAIVztB,GAAc0tB,KAAmBprD,EAAAA,EAAAA,UAAS,CAC/CqrD,QAAQ,EACRC,UAAU,EACV/sC,WAAW,EACXC,aAAa,EACbzB,QAAQ,KAIH4gB,GAAc4tB,KAAmBvrD,EAAAA,EAAAA,UAAS,CAC/CqrD,OAAQ,GACRC,SAAU,GACV/sC,UAAW,GACXC,YAAa,GACbzB,OAAQ,MAIHyuC,GAAqBC,KAA0BzrD,EAAAA,EAAAA,UAAS,IAAIggC,MAG5D0rB,GAAkBC,KAAuB3rD,EAAAA,EAAAA,WAAS,IAGlDiR,GAAc26C,KAAmB5rD,EAAAA,EAAAA,WAAS,IAG1C6rD,GAAgBC,KAAqB9rD,EAAAA,EAAAA,UAAS,CACnD+rD,QAAS,CAAC,EACVv4B,QAAS,CAAC,KAILw4B,GAAcC,KAAmBjsD,EAAAA,EAAAA,UAAS,CAC/CksD,KAAM,GACNC,aAAa,EACbnhC,OAAQ,KACRohC,eAAe,EACfC,WAAY,GACZC,iBAAiB,EACjBC,yBAA0B,KAI5B1rD,EAAAA,EAAAA,WAAU,KACR,IAAKoQ,GAAc,OAEnB,MAAMu7C,EAAgBx0C,IACF,WAAdA,EAAMxe,KACRoyD,IAAgB,IAKpB,OADAhhD,OAAO4K,iBAAiB,UAAWg3C,GAC5B,IAAM5hD,OAAO6K,oBAAoB,UAAW+2C,IAClD,CAACv7C,KAKJ,MAAO4mB,GAAa40B,KAAkBzsD,EAAAA,EAAAA,UAAS,KAMxC0sD,GAAcC,KAAmB3sD,EAAAA,EAAAA,UAAS,CAC/C4sD,WAAW,EACX3uB,UAAU,EACV4uB,cAAc,EACdC,kBAAkB,EAClBC,aAAc,KACdC,qBAAqB,KAIhBC,GAAgBC,KAAqBltD,EAAAA,EAAAA,UAAS,CACnDmtD,YAAY,EACZd,WAAY,GACZ9qC,QAAS,GACTiS,SAAS,EACT45B,YAAa,MAIRC,GAAWC,KAAgBttD,EAAAA,EAAAA,UAAS,CACzCutD,WAAW,EACXtD,OAAQ,GACR1oC,QAAS,GACTiS,SAAS,EACTg6B,cAAe,KACfC,UAAW,CAAC,EACZxtD,cAAe,WACfE,cAAe,MAIVutD,GAAYC,KAAiB3tD,EAAAA,EAAAA,UAAS,CAC3C4tD,UAAW,GACXp6B,SAAS,KAIJq6B,GAAeC,KAAoB9tD,EAAAA,EAAAA,UAAS,CACjD0I,MAAM,EACNmc,OAAQ,KACR5Y,KAAM,KACN8hD,aAAa,KAIRC,GAAmBC,KAAwBjuD,EAAAA,EAAAA,UAAS,CACzD0I,MAAM,EACNugD,SAAU,EACVtsB,KAAM,MAKDuxB,GAAwBC,KAA6BnuD,EAAAA,EAAAA,WAAS,IAC9DouD,GAA0BC,KAA+BruD,EAAAA,EAAAA,WAAS,IAClEsuD,GAAqCC,KAA0CvuD,EAAAA,EAAAA,WAAS,IAGxFwuD,GAAkCC,KAAuCzuD,EAAAA,EAAAA,WAAS,IAClF0uD,GAA2BC,KAAgC3uD,EAAAA,EAAAA,WAAS,IACpE4uD,GAAiBC,KAAsB7uD,EAAAA,EAAAA,UAAS,OAGhD8Q,GAAsBg+C,KAA2B9uD,EAAAA,EAAAA,WAAS,IAG1D+uD,GAAgBC,KAAqBhvD,EAAAA,EAAAA,UAAS,CACnDivD,eAAe,EACfC,cAAe,KACfC,eAAgB,QAIXC,GAAWC,KAAgBrvD,EAAAA,EAAAA,UAAS,CACzCsvD,MAAM,EACNC,UAAW,QAINC,GAAcC,KAAmBzvD,EAAAA,EAAAA,UAAS,CAC/C0vD,WAAW,EACX1+C,UAAU,EACV2+C,cAAc,EACdC,aAAa,EACb3tD,MAAO,QAKF6oD,GAAY+E,KAAiB7vD,EAAAA,EAAAA,UAAS,KAC3C,IAEE,MAAM2e,EAAWyrC,GAAAA,QAAaC,cAE9B,GAAI1rC,IAAoC,IAAxBA,EAASmsC,WAAqB,CAE5C,GAAInsC,EAASyS,aAAezS,EAAS3N,SAASnE,GAAI,CAChC8R,EAASyS,aAAezS,EAAS3N,SAASnE,EAG5D,CAEA,OAAO,CACT,CACA,OAAO,CACT,CAAE,MAAAqzB,GACA,OAAO,CACT,KAIFr/B,EAAAA,EAAAA,WAAU,KACUiB,WAChB,GAAKrC,IAAUC,GAAf,CAEAc,IAAgB,GAChB,IACE,MAAMsvD,QAAkB9tD,EAAAA,GAAAA,IAAc,CAAEvC,SAAOC,cAC/CY,GAAkBwvD,GAAa,GACjC,CAAE,MAAO7tD,GACP3B,GAAkB,GACpB,CAAC,QACCE,IAAgB,EAClB,CAV+B,GAajC0B,IACC,CAACzC,GAAOC,MAGXmB,EAAAA,EAAAA,WAAU,KACR,GAAKwK,GAEL,IACE,MAAMsT,EAAWyrC,GAAAA,QAAaC,cAE1B1rC,GAAYA,EAASmsC,UAI3B,CAAE,MAAO7oD,GACT,GACC,CAACoJ,MAGJxK,EAAAA,EAAAA,WAAU,KACR,GAAIwK,GACF,IACE++C,GAAAA,QAAaS,aAAa,CAAEC,eAC9B,CAAE,MAAO7oD,GACT,GAED,CAAC6oD,GAAYz/C,MAGhBxK,EAAAA,EAAAA,WAAU,KACR,IAAKwK,GAAS,OAEd,IAAI0kD,EACJ,MAAMC,EAAgBvtD,IAEpB6S,aAAay6C,IAeTnO,EAAkBqO,GAAqBzlD,QAQ7C,OAPIo3C,EACFA,EAAgBpsC,iBAAiB,SAAUw6C,GAG3CplD,OAAO4K,iBAAiB,SAAUw6C,GAG7B,KACL16C,aAAay6C,GACTnO,EACFA,EAAgBnsC,oBAAoB,SAAUu6C,GAE9CplD,OAAO6K,oBAAoB,SAAUu6C,KAGxC,CAAC3kD,KAGJ,MAAO6kD,GAAgBC,KAAqBnwD,EAAAA,EAAAA,UAAS,CAAC,IAyI/CgR,GAAUo/C,KAAgBpwD,EAAAA,EAAAA,UAAS,CAExCq0B,cAAe,GACfqF,YAAa,GACbtN,mBAAoB,GACpBC,YAAa,GACbtJ,MAAO,GACPuJ,MAAO,GACPuH,QAAS,GAGTlnB,QAAS,GACT2Z,cAAe,GACfnN,eAAgB,GAChBk3C,gBAAiB,GACjBv6B,mBAAmB,EAGnBP,kBAAmBlzB,KAAKuR,UAAU,CAAC,SACnC4kB,gBAAiB,GACjBe,aAAc,GACd5M,mBAAoB,GAKpB/P,mBAAoB,GACpB4B,YAAa,GAEbzB,OAAQ,GACRC,cAAe,GACfC,iBAAkB,GAClBC,uBAAwB,GACxBC,sBAAuB,GACvBC,uBAAwB,GACxBC,0BAA2B,GAG3BizC,aAAc,GACdvvD,gBAAiB,GACjBE,iBAAkB,GAClBE,cAAe,GACfE,cAAe,GACfE,qBAAsB,GAGtBE,wBAAyB,GACzBE,wBAAyB,GACzBE,0BAA2B,GAG3B0uD,gBAAiB,GACjB/jC,oBAAqB,GACrBC,mBAAoB,GACpB5T,QAAS,GACTwtC,oBAAqB,GAGrBmK,+BAAgC,GAChCC,aAAc,GACdC,OAAQ,GAGR36B,eAAe,EACfrJ,eAAgB,GAChBiD,iBAAiB,EACjB4G,aAAc,GACdo6B,mBAAoB,GACpB/jC,sBAAuB,GACvBgkC,eAAgB,GAChBC,gBAAiB,GAGjBhkC,2BAA4B,CAC1BkL,UAAW,KACXC,QAAS,GACTC,OAAQ,WAEVlL,aAAc,GAGdC,cAAe,GACfC,aAAc,GACdC,mBAAmB,EAKnBka,kBAAmB,GACnBC,kBAAmB,GACnBC,cAAe,GAGfC,cAAe,GACfC,UAAW,GACXC,mBAAoB,GACpBC,kBAAmB,GAGnB1X,cAAe,GACf2X,cAAe,GACfC,eAAgB,GAChBC,aAAc,GACdnR,iBAAkB,GAClBo6B,gBAAiB,GACjBC,mBAAoB,GAQpBr5B,+BAAgC,EAGhCiC,kBAAmB,GAGnBhE,SAAU,GAGViB,uBAAuB,IAAI3W,MAAOsY,cAAcjC,MAAM,KAAK,GAG3DE,gBAAiB,KAIbw6B,IAAcx9C,EAAAA,EAAAA,aAAamS,IAAa,IAADsrC,EAER,QAApBA,GADD,IAAI7qC,OAAQ8qC,MACL56B,MAAM,MAAM,UAAE,IAAA26B,GAApBA,EAAsBlrD,OAGnCqqD,GADqB,oBAAZzqC,EACI9iB,GACI8iB,EAAQ9iB,GAKZ8iB,IAEd,KAGH9kB,EAAAA,EAAAA,WAAU,KACJmQ,GAASnE,KACXjC,OAAOumD,oBAAsBngD,GAASnE,GACtCjC,OAAOwmD,yBAA2BpgD,GAAS4kB,kBAAoB5kB,GAAS2kB,UAAQ,IAAA/oB,OAAQoE,GAASnE,KAG5F,YACEjC,OAAOumD,2BACPvmD,OAAOwmD,2BAEf,CAACpgD,GAASnE,GAAImE,GAAS4kB,iBAAkB5kB,GAAS2kB,YAGrD90B,EAAAA,EAAAA,WAAU,KAuDJwK,IAAW2F,IAtDmBqgD,MAChC,IACE,MAAMC,EAAU,uBAAA1kD,OAA0BoE,GAASnE,IAAM,SACnD0kD,EAAsB79C,aAAagB,QAAQ48C,GAEjD,GAAIC,EAAqB,CACvB,MAAMC,EAAmBnvD,KAAKC,MAAMivD,GAEhCC,EAAiBhtD,OAAS,IAC5BitD,GAAY,OAAQ,cAAe,kBAAkB,YAAD7kD,OACtC4kD,EAAiBhtD,OAAM,uDAGrCqkD,IAAaA,GACX,oHAAAj8C,OACe4kD,EAAiBhtD,OAAM,sBAAY,+DAElD,CACE7I,KAAM,OACNiuB,QAAS,IACT8nC,OAAQ,CACNC,YAAa,0BACbC,WAAY,SACZvoB,UAAWA,KAET,MAAMwoB,EAAsBL,EAAiB3sD,IAAIitD,IAAGhvD,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC/CgvD,GAAG,IACNjtC,OAAQ,oBACRktC,KAAM,KACNC,YAAa,qCAGfvF,GAAe5pD,GAAQ,IAAIA,KAASgvD,IAEpCJ,GAAY,UAAW,cAAe,mBAAmB,YAAD7kD,OAC1CilD,EAAoBrtD,OAAM,oCAE1C8kC,SAAUA,KAER51B,aAAau+C,WAAWX,GACxBG,GAAY,OAAQ,cAAe,aACjC,gFAMd,CACF,CAAE,MAAOxvD,GACPwvD,GAAY,QAAS,cAAe,wBAAyBxvD,EAAMoE,QACrE,GAKAgrD,IAED,CAAChmD,GAAS2F,GAASnE,KAGtB,MAAMqlD,IAAsBhoD,EAAAA,EAAAA,QAAO,MAqD7BjB,KAlDoBq7B,EAAAA,EAAAA,SAAQ,KAChC,IAAK4tB,GAAoB1nD,UAAYwG,GAASnE,GAC5C,OAAO,EAIT,MAAMslD,EAAWD,GAAoB1nD,QAG/B4nD,EAAkB,CACtB,UAAW,iBAAkB,kBAC7B,qBAAsB,kBAAmB,gBACzC,sBAAuB,sBACvB,iCAAkC,eAAgB,UAIpD,IAAK,MAAMzvD,KAASyvD,EAClB,GAAID,EAASxvD,KAAWqO,GAASrO,GAC/B,OAAO,EAKX,MAAM0vD,EAAkBF,EAAS1lC,oBAAsB,GACjD6lC,EAAiBthD,GAASyb,oBAAsB,GAEtD,GAAI4lC,EAAgB7tD,SAAW8tD,EAAe9tD,OAC5C,OAAO,EAIT,IAAK,IAAI+9C,EAAI,EAAGA,EAAI8P,EAAgB7tD,OAAQ+9C,IAAK,CAC/C,MAAMgQ,EAAWF,EAAgB9P,GAC3BiQ,EAAWF,EAAe/P,GAEhC,GAAIgQ,EAASjjC,QAAUkjC,EAASljC,OAC5BijC,EAASE,WAAaD,EAASC,UAC/BF,EAASG,kBAAoBF,EAASE,gBACxC,OAAO,CAEX,CAEA,OAAO,GACN,CAAC1hD,MAMeszB,EAAAA,EAAAA,SAAQ,IACW,gBAA7BtzB,GAAS6kB,iBACoB,mBAA7B7kB,GAAS6kB,gBACf,CAAC7kB,GAAS6kB,mBAEP88B,GAAkB1uB,GAAmBjzB,GAAU/H,KAG/C,aACJD,GACAg8B,WAAY4tB,GAAiB,cAC7B1tB,GAAa,kBACbc,GAAiB,gBACjBsC,GAAe,iBACfC,GAAgB,cAChBtD,GAAa,oBACbhF,GAAmB,iBACnBE,GAAgB,WAEhB4B,GAAU,oBAEV3wB,GAAmB,mBACnBs1B,GAAkB,oBAClBC,GAEA5B,aAAc8tB,GAAoB,gBAElCzsB,IACEusB,GAWE5H,IAAazmB,EAAAA,EAAAA,SAAQ,KAAOtzB,GAASnE,GAAI,CAACmE,GAASnE,KAInDimD,GAAkB7pD,GAOlB8pD,IAAwBzuB,EAAAA,EAAAA,SAAQ,IAC/BwuB,IAKLhwD,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKoiC,IAAa,IAChBE,OAAQF,GAAcE,OAAOvgC,IAAIqL,IAAKpN,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACjCoN,GAAK,IACRq1B,WAAW,EACXD,UAAW,iBATNJ,GAYR,CAAC4tB,GAAiB5tB,MAGd8tB,GAAWC,KAAgBjzD,EAAAA,EAAAA,WAAS,IAGpCkzD,GAAeC,KAAoBnzD,EAAAA,EAAAA,WAAS,GAM7CozD,IAAwB5/C,EAAAA,EAAAA,aAAayY,IAAW,IAADonC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EACnD,MAAMC,EAAY,CAChB9I,WAA4B,QAAlBuI,EAAEpnC,EAAM6+B,kBAAU,IAAAuI,EAAAA,EAAIvI,GAChCC,WAA4B,QAAlBuI,EAAErnC,EAAM8+B,kBAAU,IAAAuI,EAAAA,GAAKxI,GACjC9kC,QAAsB,QAAfutC,EAAEtnC,EAAMjG,eAAO,IAAAutC,EAAAA,EAAIviD,GAASnE,GACnCu/B,YAA8B,QAAnBonB,EAAEvnC,EAAMmgB,mBAAW,IAAAonB,EAAAA,EAAKxiD,GAAS4kB,kBAAoB5kB,GAAS2kB,SACzE3sB,aAAgC,QAApByqD,EAAExnC,EAAMjjB,oBAAY,IAAAyqD,EAAAA,EAAIzqD,GACpCg9B,kBAA0C,QAAzB0tB,EAAEznC,EAAM+Z,yBAAiB,IAAA0tB,EAAAA,EAAI1tB,GAC9CykB,SAAwB,QAAhBkJ,EAAE1nC,EAAMw+B,gBAAQ,IAAAkJ,EAAAA,EAAKX,IAAaE,GAC1C5yC,UAAWL,KAAKC,OAMlB,OAHAtV,OAAOogD,iBAAmB4I,EAC1BhpD,OAAOqgB,cAAc,IAAIF,YAAY,uBAAwB,CAAEC,OAAQ4oC,KAEhEA,GACN,CAAC9I,GAAY95C,GAASnE,GAAImE,GAAS4kB,iBAAkB5kB,GAAS2kB,SAAU3sB,GAAcg9B,GAAmBgtB,GAAWE,KAGjHW,IAA2B3pD,EAAAA,EAAAA,QAAOkpD,KACxCvyD,EAAAA,EAAAA,WAAU,KACRgzD,GAAyBrpD,QAAU4oD,IAClC,CAACA,KAGJ,MAAMU,GAAuBC,GACpBF,GAAyBrpD,QAAQupD,IAI1ClzD,EAAAA,EAAAA,WAAU,KAER,IAAKqyD,GAAe,OAGpB,MAAMc,IAAchjD,GAASnE,GAQ7B,IAAI09C,EAAe,OAEfyJ,EAEFzJ,EAAe,WACNyI,MAZa5hC,MActBm5B,EAAe,WAIjB,MAAMt+B,EAAQ,CACZ6+B,WAA6B,YAAjBP,EACZQ,WAA6B,SAAjBR,EACZvkC,QAASguC,EAAYhjD,GAASnE,GAAK,KACnCu/B,YAAap7B,GAAS4kB,kBAAoB5kB,GAAS2kB,UAAY,GAC/D3sB,gBACAg9B,qBACAykB,SAA2B,YAAjBF,GAA+C,YAAjBA,EACxCjqC,UAAWL,KAAKC,OAOlB,OAJAtV,OAAOogD,iBAAmB/+B,EAC1BrhB,OAAOqgB,cAAc,IAAIF,YAAY,uBAAwB,CAAEC,OAAQiB,KAGhE,KACLrhB,OAAOogD,iBAAmB,CACxBF,YAAY,EACZC,YAAY,EACZ/kC,QAAS,KACTomB,YAAa,GACbpjC,aAAc,EACdg9B,kBAAmB,OACnBykB,UAAU,EACVnqC,UAAWL,KAAKC,OAElBtV,OAAOqgB,cAAc,IAAIF,YAAY,uBAAwB,CAAEC,OAAQpgB,OAAOogD,sBAE/E,CAACkI,GAAeliD,GAASnE,GAAImE,GAAS4kB,iBAAkB5kB,GAAS2kB,SAAU3sB,GAAcg9B,GAAmBgtB,GAAW5hC,KAG1H,MAAO6iC,GAAWC,KAAgBl0D,EAAAA,EAAAA,UAAS,CACzCm0D,QAAQ,EACRC,aAAa,EACbC,iBAAiB,EACjBC,aAAc,KACdC,YAAY,EACZC,WAAY,OAERC,IAAqBvqD,EAAAA,EAAAA,SAAO,GAC5BwqD,IAAmBxqD,EAAAA,EAAAA,QAAO,MAG1ByqD,IAAezqD,EAAAA,EAAAA,SAAO,GAGtB0qD,IAAsB1qD,EAAAA,EAAAA,QAAO,MAG7B2qD,IAAmBrhD,EAAAA,EAAAA,aAAashD,IAChCF,GAAoBpqD,SACtBoqD,GAAoBpqD,QAAQsqD,IAE7B,KAIG,gBAAE5tC,GAAe,eAAED,IAAmBR,GAAYouC,GAAkB,CACxEjuC,MAAO,IACPhN,SAAUq6C,GAAUI,iBAAmBnB,GACvCrsC,aAAc,CAACotC,GAAUI,gBAAiBnB,GAAeliD,GAAS6H,YAa7Dk8C,GAAwBC,KAA6Bh1D,EAAAA,EAAAA,WAAS,IAC9Di1D,GAAsBC,KAA2Bl1D,EAAAA,EAAAA,UAAS,KAG1Dm1D,GAAeC,KAAoBp1D,EAAAA,EAAAA,UAAS,CACjDyU,MAAO,GACP4gD,OAAQ,GACRC,YAAa,CAAEzwC,OAAQ,KAAM5iB,MAAO,MACpCuxB,SAAS,EACT+hC,eAAe,EACf/oD,KAAM,GACN7Q,KAAM,KACN65D,aAAa,EACbC,SAAU,MACVC,eAAgB,KAChBC,iBAAkB,KAClBC,mBAAmB,EACnBC,cAAe,QAIVC,GAAeC,KAAoB/1D,EAAAA,EAAAA,UAAS,CACjDohC,QAAQ,EACRC,QAAQ,EACR+B,QAAQ,EACRhB,SAAS,EACTrK,WAAW,EACXi+B,eAAe,EACfrzB,WAAW,EACXI,WAAW,EACXkzB,QAAQ,KAIHC,GAAcC,KAAmBn2D,EAAAA,EAAAA,UAAS,CAC/CwzB,SAAS,EACT4iC,aAAa,EACbC,QAAS,KACTrlD,SAAU,CACR8X,kBAAmB0jB,GAAoB,IAAIvsB,MAC3C8I,YAAa,EACb3P,UAAW,GACXsP,cAAe,GACfM,iBAAkB,GAClBC,YAAa,GACb2O,aAAc,OAMX0+B,GAAkBC,KAAuBv2D,EAAAA,EAAAA,UAAS,CAAC,IAOnDw2D,GAAqBC,KAA0Bz2D,EAAAA,EAAAA,UAAS,CAC7DlB,QAAQ,EACR43D,UAAW,KACXC,aAAc,GACdC,YAAa,KAIRC,GAAeC,KAAoB92D,EAAAA,EAAAA,UAAS,CACjDlB,QAAQ,EACRmF,MAAO,GACPoC,QAAS,GACTgjC,UAAW,QAMN0tB,GAAYC,KAAiBh3D,EAAAA,EAAAA,UAAS,CAC3Ci3D,WAAY,GACZC,kBAAmB,KACnBC,iBAAkB,KAClBC,UAAW,KACXC,YAAa,GACbC,mBAAmB,EACnBC,cAAe,MAKVxmD,GAAkBymD,MAHFttD,EAAAA,EAAAA,QAAO,OAGkBlK,EAAAA,EAAAA,UAAS,CAAC,KACnDy3D,GAAkBC,KAAuB13D,EAAAA,EAAAA,WAAS,IAKlD23D,GAAuBC,KAA4B53D,EAAAA,EAAAA,UAAS,CAAC,IAE7D63D,GAASC,KAAc93D,EAAAA,EAAAA,UAAS,CACrC2mB,QAAS,GACT6M,SAAS,EACThV,YAAa,CAAC,IAOVu5C,GAA2B9K,GAAeE,WAC1C6K,GAA+B/X,GAAQiN,GAAkBp4B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEq4B,WAAYlN,KAClFgY,GAAqBhL,GAAeZ,WACpC6L,GAAyBjY,GAAQiN,GAAkBp4B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEu3B,WAAYpM,KAC5EkY,GAAwBlL,GAAe1rC,QACvC62C,GAA4BnY,GAAQiN,GAAkBp4B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEvT,QAAS0+B,KAC5EoY,GAAwBpL,GAAez5B,QACvC8kC,GAA4BrY,GAAQiN,GAAkBp4B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEtB,QAASysB,KAC5EsY,GAAsBtL,GAAeG,YACrCoL,GAA0BvY,GAAQiN,GAAkBp4B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEs4B,YAAanN,KAG9EwY,GAAgBpL,GAAUE,UAC1BmL,GAAoBzY,GAAQqN,GAAax4B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEy4B,UAAWtN,KACjE0Y,GAAatL,GAAUpD,OACvB2O,GAAiB3Y,GAAQqN,GAAax4B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEm1B,OAAQhK,KAC3D4Y,GAAcxL,GAAU9rC,QACxBu3C,GAAkB7Y,GAAQqN,GAAax4B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEvT,QAAS0+B,KAC7D8Y,GAAc1L,GAAU75B,QACxBwlC,GAAkB/Y,GAAQqN,GAAax4B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEtB,QAASysB,KAC7DuN,GAAgBH,GAAUG,cAC1ByL,GAAoBhZ,GAAQqN,GAAax4B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE04B,cAAevN,KACrEiZ,GAAgB7L,GAAUI,UAC1B0L,GAAoBlZ,GAAQqN,GAAax4B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE24B,UAAWxN,KACjEmZ,GAAoB/L,GAAUptD,cAC9Bo5D,GAAwBpZ,GAAQqN,GAAax4B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE70B,cAAeggD,KACzEqZ,GAAoBjM,GAAUltD,cAI9BE,GAAiBqtD,GAAWE,UAC5BttD,GAAqB2/C,GAAQ0N,GAAc74B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE84B,UAAW3N,KACnE1/C,GAAemtD,GAAWl6B,QAC1BhzB,GAAmBy/C,GAAQ0N,GAAc74B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEtB,QAASysB,KAG/DsZ,GAAe1L,GAAcnlD,KAC7B8wD,GAAmBvZ,GAAQ6N,GAAiBh5B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEpsB,KAAMu3C,KAC/DliB,GAAiB8vB,GAAchpC,OAC/BoY,GAAqBgjB,GAAQ6N,GAAiBh5B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEjQ,OAAQo7B,KACnEjiB,GAAe6vB,GAAc5hD,KAC7BkxB,GAAmB8iB,GAAQ6N,GAAiBh5B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE7oB,KAAMg0C,KAE/DwZ,IADiB5L,GAAcE,YACV9N,GAAQ6N,GAAiBh5B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEi5B,YAAa9N,MAGxEpjB,GAAmBmxB,GAAkBtlD,KACrCgxD,GAAuBzZ,GAAQgO,GAAqBn5B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEpsB,KAAMu3C,KACvEniB,GAAekwB,GAAkB/E,SACjCvsB,GAAmBujB,GAAQgO,GAAqBn5B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEm0B,SAAUhJ,KACvE0Z,GAAmB3L,GAAkBrxB,KACrCi9B,GAAuB3Z,GAAQgO,GAAqBn5B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE6H,KAAMsjB,KAGvE4Z,GAAiBnN,GAAaE,UAC9BkN,GAAqB7Z,GAAQ0M,GAAgB73B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE83B,UAAW3M,KACrEhiB,GAAWyuB,GAAazuB,SACxBZ,GAAe4iB,GAAQ0M,GAAgB73B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEmJ,SAAUgiB,KAC9D8Z,GAA4BrN,GAAaG,aACzCmN,GAAgC/Z,GAAQ0M,GAAgB73B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE+3B,aAAc5M,KACnFga,GAA6BvN,GAAaI,iBAC1CoN,GAAiCja,GAAQ0M,GAAgB73B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEg4B,iBAAkB7M,KACxFka,GAAqBzN,GAAaK,aAClCqN,GAAyBna,GAAQ0M,GAAgB73B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEi4B,aAAc9M,KAC5Eoa,GAAiC3N,GAAaM,oBAC9CsN,GAAqCra,GAAQ0M,GAAgB73B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEk4B,oBAAqB/M,KAG/Fsa,GAAwBxL,GAAeE,cACvCuL,GAA4Bva,GAAQ+O,GAAkBl6B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEm6B,cAAehP,KAClFwa,GAAwB1L,GAAeG,cACvCwL,GAA4Bza,GAAQ+O,GAAkBl6B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEo6B,cAAejP,KAClF0a,GAAyB5L,GAAeI,eACxCyL,GAA6B3a,GAAQ+O,GAAkBl6B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEq6B,eAAgBlP,KAGpF4a,GAAgBzL,GAAUE,KAC1BwL,GAAoB7a,GAAQoP,GAAav6B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEw6B,KAAMrP,KAC5D8a,GAAiB3L,GAAUG,UAC3ByL,GAAqB/a,GAAQoP,GAAav6B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEy6B,UAAWtP,KAGlEgb,GAAqBzL,GAAaE,UAElC58B,GAAoB08B,GAAax+C,SAGjCkqD,IADqB1L,GAAaG,aACT1P,GAAQwP,GAAgB36B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE66B,aAAc1P,MAC5EhiC,GAAgBuxC,GAAaI,YAC7BuL,GAAoBlb,GAAQwP,GAAgB36B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE86B,YAAa3P,KACtEmb,GAAsB5L,GAAavtD,MAInCxB,GAAWwzD,GAAUE,OACrBzzD,GAAeu/C,GAAQiU,GAAap/B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEq/B,OAAQlU,KAEzDob,IADgBpH,GAAUG,YACNnU,GAAQiU,GAAap/B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEs/B,YAAanU,MACnEoU,GAAkBJ,GAAUI,gBAC5BiH,GAAsBrb,IAC1BiU,GAAap/B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEu/B,gBAAiBpU,KAC3CwU,GAAmBjqD,QAAUy1C,GAEzBqU,GAAeL,GAAUK,aACzBiH,GAAmBtb,GAAQiU,GAAap/B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEw/B,aAAcrU,KACnEub,GAAevH,GAAUM,WACzBkH,GAAmBxb,GAAQiU,GAAap/B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEy/B,WAAYtU,KACjEuU,GAAaP,GAAUO,WACvBkH,GAAiBzb,GAAQiU,GAAap/B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE0/B,WAAYvU,KAG/D0b,GAAY9P,GAAeE,QAE3B6P,GAAmB/P,GAAer4B,QAClCqoC,GAAuB5b,GAAQ6L,GAAkBh3B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEtB,QAASysB,KAGvE6b,GAAc9P,GAAaE,KAC3B6P,GAAkB9b,GAAQgM,GAAgBn3B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEo3B,KAAMjM,KAC7D+b,GAAqBhQ,GAAaG,YAClC8P,GAAyBhc,GAAQgM,GAAgBn3B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEq3B,YAAalM,KAC3Eic,GAAgBlQ,GAAahhC,OAC7BmxC,GAAoBlc,GAAQgM,GAAgBn3B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE9J,OAAQi1B,KACjEmc,GAAuBpQ,GAAaI,cACpCiQ,GAA2Bpc,GAAQgM,GAAgBn3B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEs3B,cAAenM,KAC/Eqc,GAAoBtQ,GAAaK,WACjCkQ,GAAwBtc,GAAQgM,GAAgBn3B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEu3B,WAAYpM,KACzEuc,GAAyBxQ,GAAaM,gBACtCmQ,GAA6Bxc,GAAQgM,GAAgBn3B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEw3B,gBAAiBrM,KACnFyc,GAAiC1Q,GAAaO,wBAC9CoQ,GAAqC1c,GAAQgM,GAAgBn3B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEy3B,wBAAyBtM,KAGnGr3C,GAAiBusD,GAAc1gD,MAC/BmoD,GAAqB3c,GAAQmV,GAAiBtgC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAErgB,MAAOwrC,KAClEt3C,GAAkBwsD,GAAcE,OAChCwH,GAAsB5c,GAAQmV,GAAiBtgC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEugC,OAAQpV,KAEpE6c,IADuB3H,GAAcG,YACVrV,GAAQmV,GAAiBtgC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEwgC,YAAarV,MAC9Ep3C,GAAmBssD,GAAc3hC,QACjCupC,GAAuB9c,GAAQmV,GAAiBtgC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEtB,QAASysB,KACtE+c,GAAwB7H,GAAcI,cACtC0H,GAA4Bhd,GAAQmV,GAAiBtgC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEygC,cAAetV,KACjFid,GAAe/H,GAAc3oD,KAC7B2wD,GAAmBld,GAAQmV,GAAiBtgC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEtoB,KAAMyzC,KAC/Dmd,GAAejI,GAAcx5D,KAC7B0hE,GAAmBpd,GAAQmV,GAAiBtgC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEn5B,KAAMskD,KAG/DwV,IAFsBN,GAAcK,YAEzBL,GAAcM,UACzB6H,GAAerd,GAAQmV,GAAiBtgC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE2gC,SAAUxV,KAC/Dsd,GAAyBpI,GAAcO,eACvC8H,GAA6Bvd,GAAQmV,GAAiBtgC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE4gC,eAAgBzV,KAGnFwd,IAF2BtI,GAAcQ,iBAEbR,GAAcS,mBAC1C8H,GAAgCzd,GAAQmV,GAAiBtgC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE8gC,kBAAmB3V,KACzF0d,GAAwBxI,GAAcU,cACtC+H,GAA4B3d,GAAQmV,GAAiBtgC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE+gC,cAAe5V,KAGjF4d,GAA0B/H,GAAc10B,OACxC08B,GAA8B7d,GAAQ8V,GAAiBjhC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEsM,OAAQ6e,KAC5E8d,GAA0BjI,GAAcz0B,OACxC28B,GAA8B/d,GAAQ8V,GAAiBjhC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEuM,OAAQ4e,KAC5Ege,GAA0BnI,GAAc1yB,OACxC86B,GAA8Bje,GAAQ8V,GAAiBjhC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEsO,OAAQ6c,KAC5Eke,GAA2BrI,GAAc1zB,QACzCg8B,GAA+Bne,GAAQ8V,GAAiBjhC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEsN,QAAS6d,KAC9Eoe,GAA6BvI,GAAc/9B,UAC3CumC,GAAiCre,GAAQ8V,GAAiBjhC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEiD,UAAWkoB,KAClFse,GAA2BzI,GAAcE,cACzCwI,GAA+Bve,GAAQ8V,GAAiBjhC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEkhC,cAAe/V,KACpFwe,GAA6B3I,GAAcnzB,UAC3C+7B,GAAiCze,GAAQ8V,GAAiBjhC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE6N,UAAWsd,KAClF0e,GAA6B7I,GAAc/yB,UAC3C67B,GAAiC3e,GAAQ8V,GAAiBjhC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEiO,UAAWkd,KAClF4e,GAA0B/I,GAAcG,OACxC6I,GAA8B7e,GAAQ8V,GAAiBjhC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEmhC,OAAQhW,KAG5E8e,GAAiB7I,GAAa1iC,QAI9BwrC,IAFqB9I,GAAaE,YAEjBF,GAAaG,SAC9B4I,GAAqBhf,GAAQkW,GAAgBrhC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEuhC,QAASpW,KACnEif,GAAkBhJ,GAAallD,SAC/BmuD,GAAsBlf,GAAQkW,GAAgBrhC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE9jB,SAAUivC,KAOrEkX,IAJqBJ,GAAWE,WAEZF,GAAWG,kBAEZH,GAAWI,kBAC9BiI,GAAuBnf,GAAQ+W,GAAcliC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEqiC,iBAAkBlX,KAC5En2C,GAAoBitD,GAAWK,UAC/BiI,GAAwBpf,GAAQ+W,GAAcliC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEsiC,UAAWnX,KACtEl2C,GAAsBgtD,GAAWM,YACjCiI,GAA0Brf,GAAQ+W,GAAcliC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEuiC,YAAapX,KAC1EqX,GAAoBP,GAAWO,kBAE/BC,GAAgBR,GAAWQ,cAI3BgI,GAAoB1H,GAAQlxC,QAC5B64C,GAAwBvf,GAAQ6X,GAAWhjC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEnO,QAASs5B,KAC9C4X,GAAQrkC,QAEjBqkC,GAAQr5C,aAOxB3d,EAAAA,EAAAA,WAAU,KACR,IAAK0+D,IAAkD,IAA7BA,GAAkB/6D,SAAiB/E,KAAUC,GAAU,OAE7DoC,WAClB,MAAM29D,EAAQ,CAAC,EACf,IAAK,MAAMC,KAAMH,GACf,IACE,MAAMI,QAAaC,EAAAA,GAAAA,IAAc,CAAEngE,SAAOC,YAAUmgE,SAAUH,EAAGvjD,MAC7DwjD,IACFF,EAAMC,EAAG7yD,IAAM,CACbizD,MAAO5mD,WAAWymD,EAAKI,gBAAkB,EACzCC,QAAS9mD,WAAWymD,EAAKM,mBAAqB,EAC9CC,MAAOhnD,WAAWymD,EAAKQ,iBAAmB,GAGhD,CAAE,MAAOl+D,GACP4S,QAAQC,KAAK,gCAADlI,OAAyB8yD,EAAGvjD,IAAG,KAAKla,EAAMoE,QACxD,CAvBc45C,QAyBLwf,EAzBa3H,GAAWhjC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEtW,YAAayhC,MA4B/DmgB,IACC,CAACb,GAAmB9/D,GAAOC,KA8B9B,MAAM2gE,IAA+B7sD,EAAAA,EAAAA,aAAY1R,MAAOytD,EAAWvmD,KACjE,IAAK,IAADs3D,EAAAC,EAAAC,EAAAC,EAAAC,EAKF,MAAM18B,EAAiBurB,EAAUh6B,kBACS,kBAAhCg6B,EAAUh6B,kBAAiClzB,KAAKC,MAAMitD,EAAUh6B,mBAAqBg6B,EAAUh6B,kBAAqB,GAExHorC,EAAep+D,MAAMC,QAAQwhC,IAAmBA,EAAe9gC,SAAS,aAI9E,GAHoBX,MAAMC,QAAQwhC,IAAmBA,EAAe9gC,SAAS,YAI3E,OAAO,KAIT,MAAM09D,EAAiD,QAA/BN,EAAG/Q,EAAU3yC,0BAAkB,IAAA0jD,OAAA,EAA5BA,EAA8BxyC,cAAc5qB,SAAS,WAChF,IAAKy9D,IAAiBC,EACpB,OAAO,KAGT,IAAKA,EACH,OAAO,KAIT,IAD6C,QAAzBL,EAAAhR,EAAUxuD,uBAAe,IAAAw/D,OAAA,EAAzBA,EAA2Bx6D,UAAiC,QAA3By6D,EAAIjR,EAAUpuD,qBAAa,IAAAq/D,OAAA,EAAvBA,EAAyBz6D,QAEhF,OAAO,KAGT,MAAM86D,EAAsC,QAA1BJ,EAAGlR,EAAUvyC,qBAAa,IAAAyjD,OAAA,EAAvBA,EAAyB16D,OAC9C,IAAK86D,EACH,OAAO,KAIT,IAAIC,EAAqB,GACzB,IACE,MAAM38C,QAAiB48C,EAAAA,GAAAA,IAAe,CACpCthE,SACAC,YACAshE,eAAe,EACflB,MAAO,MAGG,OAAR37C,QAAQ,IAARA,GAAAA,EAAUlY,MAAQ1J,MAAMC,QAAQ2hB,EAASlY,QAC3C60D,EAAqB38C,EAASlY,KAElC,CAAE,MAAOg1D,GACP,OAAO,IACT,CAGA,MAAMC,EAAUJ,EAAmBljD,KAAKkX,GACtCA,EAAE9X,gBAAkB6jD,GACpB/rC,EAAEqsC,kBAAoBN,GAGxB,IAAKK,EACH,OAAO,KAGT,MAAME,EAA0B,QAAdV,EAAGQ,EAAQhgE,WAAG,IAAAw/D,OAAA,EAAXA,EAAa36D,OAClC,IAAKq7D,GAAgBA,EAAa58D,OAAS,EAEzC,MAAO,CACLzD,gBAAiBmgE,EAAQG,aAAe,GACxClgE,cAAe,GACfmgE,OAAQ,oBAKZ,IACE,MAAMC,QAAoBC,EAAAA,GAAAA,IAAoB,CAC5C/hE,MAAOA,GACPC,SAAUA,GACVwB,IAAKkgE,IAGP,GAAe,OAAXG,QAAW,IAAXA,GAAAA,EAAat1D,MAAQ1J,MAAMC,QAAQ++D,EAAYt1D,OAASs1D,EAAYt1D,KAAKzH,OAAS,EAAG,CACvF,MAAMi9D,EAAWF,EAAYt1D,KAAK,GAClC,MAAO,CACLlL,gBAAiB0gE,EAAS3gE,OAAS2gE,EAASj1D,MAAQ00D,EAAQG,aAAe,GAC3EpgE,iBAAkBwgE,EAASzgE,QAAUygE,EAASC,SAAW,GACzDvgE,cAAesgE,EAASvgE,KAAOkgE,EAC/B//D,cAAeogE,EAASrgE,KAAO,GAC/BG,qBAAsBkgE,EAASngE,YAAcmgE,EAASE,aAAe,GACrElgE,wBAAyBggE,EAASjgE,eAAiB,GACnDG,wBAAyB8/D,EAAS//D,eAAiB+/D,EAASn1C,OAAS,GACrEzqB,0BAA2B4/D,EAAS7/D,iBAAmB6/D,EAAS5tC,SAAW,GAC3EytC,OAAQ,QAEZ,CACF,CAAE,MAAOM,GACP,CAIF,IACE,MAAMC,EAAO,yEAAAj1D,OAA4Ew0D,GACnFU,QAAqBC,MAAMF,EAAS,CACxCG,OAAQ,MACRp6C,QAAS,CAAE,OAAU,sBAGvB,GAAIk6C,EAAaG,GAAI,CAAC,IAADC,EACnB,MAAMC,QAAiBL,EAAaM,OACpC,MAAO,CACLrhE,gBAAiBohE,EAASE,eAAiBnB,EAAQG,aAAe,GAClEpgE,kBAAgC,QAAdihE,EAAAC,EAASG,aAAK,IAAAJ,OAAA,EAAdA,EAAgBK,gBAAiB,GACnDphE,cAAeghE,EAASjhE,KAAOkgE,EAC/B//D,cAAe8gE,EAAS/gE,KAAO,GAC/BG,qBAAsB,GACtBE,wBAAyB,GACzBE,wBAAyB,GACzBE,0BAA2B,GAC3By/D,OAAQ,OAEZ,CACF,CAAE,MAAOkB,GACP,CAIF,MAAO,CACLzhE,gBAAiBmgE,EAAQG,aAAe,GACxClgE,cAAeigE,EACfE,OAAQ,UAGZ,CAAE,MAAOr/D,GACP,OAAO,IACT,GACC,CAACxC,GAAOC,KAGL+iE,IAAmBjvD,EAAAA,EAAAA,aAAY1R,MAAO69B,EAAY/F,KASpD,MAAM8oC,EAAgBtxC,KAAyB,OAAVuO,QAAU,IAAVA,OAAU,EAAVA,EAAY9yB,KAAM,MACvD,GAAI+8C,GAAsBp/C,UAAYk4D,EAIpC,cAIF9Y,GAAsBp/C,QAAUk4D,EAGhC53D,WAAW,KACL8+C,GAAsBp/C,UAAYk4D,IACpC9Y,GAAsBp/C,QAAU,OAEjC,KAIH,MAAMugD,GAAc35B,GAChB25B,IACFoI,IAAiB,GACjBgI,IAAiB,IAOL,OAAVx7B,QAAU,IAAVA,GAAAA,EAAY9yB,KACdgjD,IAAc,GAEdzF,GAAAA,QAAaS,aAAa,CAAEz5B,YAAa9lB,OAAOq0B,EAAW9yB,OAIzDukB,KACFy+B,IAAc,GAEdzF,GAAAA,QAAaS,aAAa,CAAEz5B,YAAa9lB,OAAO8lB,OAIlD,IAAIuxC,EAAYhjC,GAAc,CAAC,EAC/B,MAAMijC,EAAYjjC,GAAc15B,OAAOC,KAAKy5B,GAAYn7B,OAAS,EAEjE,GAAI6G,GACF,IACE++C,GAAAA,QAAaI,eAAen/C,IAG5B,SAFuB++C,GAAAA,QAAaK,WAEtB,CACZ,MAAMC,QAAkBN,GAAAA,QAAaO,YAErC,GAAa,OAATD,QAAS,IAATA,GAAAA,EAAW15C,SAAU,CAAC,IAAD6xD,EAEvB,MAAMC,EAAepY,EAAU15C,SAASnE,KAAwB,QAAtBg2D,EAAInY,EAAU15C,gBAAQ,IAAA6xD,OAAA,EAAlBA,EAAoBh2D,IAC5Dk2D,EAAiB3xC,KAAyB,OAAVuO,QAAU,IAAVA,OAAU,EAAVA,EAAY9yB,IAG9Ci2D,IACFjT,IAAc,GAGdzF,GAAAA,QAAaS,aAAa,CAAEz5B,YAAa9lB,OAAOw3D,MAI9CC,GAAkBD,GAAgBx3D,OAAOw3D,KAAkBx3D,OAAOy3D,GAEpEluD,QAAQC,KAAK,sEAA+C,CAAEguD,eAAcC,mBAM5EJ,EALSC,GAKA9/D,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACJ68B,GACA+qB,EAAU15C,UAAQ,IAGrBnE,GAAI8yB,EAAW9yB,GACf8oB,SAAUgK,EAAWhK,UAAYgK,EAAW/J,iBAC5CA,iBAAkB+J,EAAW/J,iBAC7BY,gBAAiBmJ,EAAWnJ,gBAC5BgD,qBAAsBmG,EAAWnG,qBAGjC3gB,QAAU6xC,EAAU15C,SAAS6H,SAAW6xC,EAAU15C,SAAS6H,QAAQrU,OAAS,EACxEkmD,EAAU15C,SAAS6H,QAClB8mB,EAAW9mB,SAAW,KAIjB6xC,EAAU15C,QAE1B,CACF,CACF,CAAE,MAAO/O,GACP4S,QAAQ5S,MAAM,uDAAgCA,EAChD,CAKF,GAAI8oD,IAAe4X,EAAUhtC,UAAYl2B,IAASC,GAChD,IACEmV,QAAQ42B,IAAI,qHACZ,MAAMu3B,QAAwB9pC,EAAAA,GAAAA,IAAqBz5B,GAAOC,IACpDujE,EAAaD,EAAgB3pC,mBAAqB2pC,EAAgB5pC,qBAAuB4pC,EAAgB1pC,YAE3G2pC,GACFN,EAAUhtC,SAAWstC,EACrBpuD,QAAQ42B,IAAI,sFAA6Dw3B,GAGrEr4D,OAAOs4D,qCACTt4D,OAAOs4D,mCAAmC14D,SAAU,IAGtDqK,QAAQC,KAAK,wEAEjB,CAAE,MAAO7S,GACP4S,QAAQ5S,MAAM,wFAAiEA,EAEjF,CAIF,GAAI8oD,GAAc1/C,KAAYs3D,EAAUv2C,qBAAuBu2C,EAAUt2C,YACvE,IACE,MAAM,6BAAE82C,GAAiCC,EAAQ,OAC3CC,EAAeF,EAA6BluD,SAAS5J,GAAS,KAIpE,GAFAwJ,QAAQ42B,IAAI,4FAAwEpgC,GAASg4D,GAEzFA,EAAc,CAEhB,GAAIA,EAAaC,mBAAwD,KAAnCD,EAAaC,mBAA+D,OAAnCD,EAAaC,kBAA4B,CACtH,MAAMC,EAA4D,kBAAnCF,EAAaC,kBACxCD,EAAaC,kBAAkB1gE,MAC/BygE,EAAaC,kBAEbC,GAAuC,KAApBA,IACrBZ,EAAUv2C,mBAAqB9gB,OAAOi4D,GACtC1uD,QAAQ42B,IAAI,2EAAiE83B,GAEjF,CAGA,GAAIF,EAAaG,qBAA4D,KAArCH,EAAaG,qBAAmE,OAArCH,EAAaG,oBAA8B,CAC5H,MAAMC,EAAgE,kBAArCJ,EAAaG,oBAC1CH,EAAaG,oBAAoB5gE,MACjCygE,EAAaG,oBAEbC,GAA2C,KAAtBA,IACvBd,EAAUt2C,YAAc/gB,OAAOm4D,GAC/B5uD,QAAQ42B,IAAI,oFAAkEg4B,GAElF,CACF,MACE5uD,QAAQ42B,IAAI,kFAEhB,CAAE,MAAOxpC,GACP4S,QAAQ5S,MAAM,+HAA0FA,EAC1G,CAKF,IAAIyhE,GAAgB,EACpB,GAAIz9D,OAAOC,KAAKy8D,GAAWn+D,OAAS,EAAG,CACrC,MAAMwE,EAAe+iB,GAAiB42C,EAAUptC,mBAEhD,IACE,MAAMouC,QAA6BtD,GAA6BsC,EAAW35D,GAEvE26D,IAEFhB,GAAS7/D,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACJ6/D,GACAgB,GAIL/I,GAA0B+I,EAAqBrC,QAE/CoC,GAAgB,EAEpB,CAAE,MAAOzhE,GACT,CACF,CAGA,GAAIgE,OAAOC,KAAKy8D,GAAWn+D,OAAS,EAAG,CAAC,IAADo/D,EAOrC,GANA5S,GAAY2R,GAME,OAAVhjC,QAAU,IAAVA,GAAuB,QAAbikC,EAAVjkC,EAAYnhB,mBAAW,IAAAolD,GAAvBA,EAAyBC,UAAYthE,MAAMC,QAAQm9B,EAAWnhB,YAAYqlD,UAAW,CACvF,MAAMC,EAAYnkC,EAAWnhB,YAAYqlD,SACtCh/D,IAAI66D,IAAE,CACL7yD,GAAI6yD,EAAG7yD,GACPsP,IAAKujD,EAAGG,UAAYH,EAAGvjD,KAAG,KAAAvP,OAAS8yD,EAAG7yD,IACtC/L,MAAO4+D,EAAG5+D,OAAS,eACnBijE,UAAWrE,EAAGqE,UACdjE,MAAOJ,EAAGI,OAASJ,EAAGK,cACtBC,QAASN,EAAGM,SAAWN,EAAGO,iBAC1BC,MAAOR,EAAGQ,OAASR,EAAGS,eACtB6D,IAAKtE,EAAGsE,IACRvnE,MAAM,GAADmQ,OAAK8yD,EAAGG,UAAYH,EAAGvjD,KAAG,KAAAvP,OAAS8yD,EAAG7yD,IAAI,OAAAD,OAAM8yD,EAAG5+D,OAAS,mBAElEmjE,KAAK,CAACvhD,EAAGwhD,IAAMxhD,EAAE5hB,MAAMqjE,cAAcD,EAAEpjE,MAAO,OAEjD0+D,GAAqBsE,EACvB,MAAO,GAAInB,EAAU5lD,QAAUxa,MAAMC,QAAQmgE,EAAU5lD,SAAW4lD,EAAU5lD,OAAOvY,OAAS,EAG1F,IAEE,IAAI4/D,EAAgBC,IAAiB,GACrC,IAAKA,IAA0C,IAAzBA,GAAc7/D,OAClC,IACE4/D,QAAsB1/C,EAAAA,GAAAA,IAAwB,CAAEjlB,SAAOC,aACzD,CAAE,MAAOooB,GACPjT,QAAQ5S,MAAM,yDAAiC6lB,GAC/Cs8C,EAAgB,EAClB,CAIF,MAoDME,SApDkBvjD,QAAQ4X,IAC9BgqC,EAAU5lD,OAAOlY,IAAI/C,UAEnB,IAAIyiE,EAAQC,EACZ,MAAMC,EAAgBD,EAEtB,IAIE,GAAIJ,GAAiBA,EAAc5/D,OAAS,EAAG,CAE7C,MAAMkgE,EAAWN,EAAcxmD,KAAKC,GAClCA,EAAIhR,KAAO23D,GACX3mD,EAAIhR,KAAO2c,OAAOg7C,IAClB3mD,EAAI1B,MAAQqoD,GACZ3mD,EAAIgiD,WAAa2E,GAGfE,EACFH,EAAQG,EAAS7E,UAAY6E,EAASvoD,KAAOqoD,EAE7C3vD,QAAQC,KAAK,mBAADlI,OAAU43D,EAAO,0CAAA53D,OAAmCw3D,EAAc5/D,OAAM,qBAGxF,MACEqQ,QAAQC,KAAK,uFAAuD0vD,GAGtE,MAAMG,QAAiB/E,EAAAA,GAAAA,IAAc,CAAEngE,SAAOC,YAAUmgE,SAAU0E,IAElE,OAAKI,GAAaA,EAAS93D,GAIpB,CACLA,GAAI83D,EAAS93D,GACbsP,IAAKwoD,EAAS9E,UAAY8E,EAASxoD,KAAG,KAAAvP,OAAS+3D,EAAS93D,IACxD/L,MAAO6jE,EAASC,YAAcD,EAAS7jE,OAAS,eAChDijE,UAAWY,EAASZ,UACpBjE,MAAO6E,EAAS5E,eAAiB,EACjCC,QAAS2E,EAAS1E,kBAAoB,EACtCC,MAAOyE,EAASxE,gBAAkB,EAClC6D,IAAKW,EAASX,IACdvnE,MAAM,GAADmQ,OAAK+3D,EAAS9E,UAAY8E,EAASxoD,KAAG,KAAAvP,OAAS+3D,EAAS93D,IAAI,OAAAD,OAAM+3D,EAASC,YAAcD,EAAS7jE,OAAS,kBAZhH+T,QAAQC,KAAK,mBAADlI,OAAU23D,EAAK,UAAA33D,OAAS63D,EAAa,kDAC1C,KAaX,CAAE,MAAO38C,GAEP,OADAjT,QAAQ5S,MAAM,0CAAD2K,OAAwB23D,EAAK,UAAA33D,OAAS63D,EAAa,MAAM38C,GAC/D,IACT,MAG6B3kB,OAAOu8D,GAAa,OAAPA,GAAauE,KAAK,CAACvhD,EAAGwhD,IAAMxhD,EAAE5hB,MAAMqjE,cAAcD,EAAEpjE,MAAO,OACzG0+D,GAAqB8E,EACvB,CAAE,MAAOx8C,GACPjT,QAAQ5S,MAAM,yDAAkC6lB,GAChD03C,GAAqB,GACvB,MAGAA,GAAqB,IASvB,GALImD,EAAU91D,KACZqlD,GAAoB1nD,QAAUnI,KAAKC,MAAMD,KAAKuR,UAAU+uD,KAItDe,GAAiBtyC,IAAeg5B,GAAAA,QAClC,IACEA,GAAAA,QAAaI,eAAen/C,UACtB++C,GAAAA,QAAaya,UAAUlC,EAAW,CACtC38C,QAAS/Q,SAASmc,KAEtB,CAAE,MAAO0zC,GACP,CAKAnC,EAAUhtC,UAAmC,0BAAvBgtC,EAAUhtC,UAC9B/qB,OAAOs4D,qCACTt4D,OAAOs4D,mCAAmC14D,SAAU,GAKxD2wD,IAAiB,EACnB,CAIKpQ,IAGHoI,IAAiB,GAGjB/I,GAAAA,QAAa2a,oBAAmB,EAAM,6BAGtCjR,GAAoB,CAClBhJ,YAAY,EACZC,YAAY,EACZ/kC,QAAS28C,EAAU91D,IAAMukB,GACzBgb,YAAau2B,EAAU/sC,kBAAoB+sC,EAAUhtC,UAAY,OAGtE,CAACvE,GAAa/lB,GAAS++C,GAAAA,QAAc4G,GAAanB,GAAesD,GAAkBgI,GAAkBkF,GAA8BzF,GAA2B9G,KAI3JkR,IAAqBxxD,EAAAA,EAAAA,aAAY,SAACnN,GAA4B,IAAnB1K,EAAI8hB,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,OACtD,MAAMwnD,EAAS,CACbhjE,MAAO,CACLguC,GAAI,UACJ1rC,MAAO,UACPV,MAAMN,EAAAA,GAAAA,KAAC2hE,EAAAA,EAAW,CAACv5D,KAAM,GAAIpH,MAAM,aAErCqd,QAAS,CACPquB,GAAI,UACJ1rC,MAAO,UACPV,MAAMN,EAAAA,GAAAA,KAACmN,EAAAA,EAAY,CAAC/E,KAAM,GAAIpH,MAAM,aAEtC4gE,QAAS,CACPl1B,GAAI,UACJ1rC,MAAO,UACPV,MAAMN,EAAAA,GAAAA,KAAC6hE,EAAAA,EAAa,CAACz5D,KAAM,GAAIpH,MAAM,aAEvC8gE,KAAM,CACJp1B,GAAI,UACJ1rC,MAAO,UACPV,MAAMN,EAAAA,GAAAA,KAAC+hE,EAAAA,EAAQ,CAAC35D,KAAM,GAAIpH,MAAM,cAI9BH,EAAQ6gE,EAAOtpE,IAASspE,EAAOI,KAErC,OACE5hE,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACT4/D,WAAY,aACZj4D,IAAK,OACLjJ,QAAS,MACTmhE,WAAY,wCACZhiE,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEqhE,WAAY,EAAGxgE,UAAW,OAAQzB,SAC7CY,EAAMP,QAETN,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVshE,KAAM,EACNxgE,SAAU,OACVqW,WAAY,MACZhX,MAAOH,EAAMG,OACbf,SACC6C,MAIT,EAAG,IAGGs/D,IAAcnyD,EAAAA,EAAAA,aAAavR,IAEtB,OAAT4mD,SAAS,IAATA,IAAAA,GAAYmc,GAAmB,uDAADp4D,OAAmC3K,EAAMoE,SAAW,SAAU,CAAE1K,KAAM,WACnG,CAACqpE,KAEEY,IAAcpyD,EAAAA,EAAAA,aAAY,OAI7B,IAGGqyD,GAAiB30C,GAAkB,CACvCzxB,SACAC,YACAyxB,OAAQ9lB,GACR+lB,eACAC,oBACAC,aAAcmxC,GACdlxC,QAASo0C,GACTn0C,QAASo0C,MAIL,UAAEn0C,GAAS,aAAE4B,GAAY,gBAAEE,GAAe,GAAEuG,IAAO+rC,GAInDnxC,IAA4B,QAAjBH,EAAAlB,GAAapnB,YAAI,IAAAsoB,OAAA,EAAjBA,EAAmBG,WAAY,GAC1CoxC,IAAiC,QAAjBvf,EAAAlzB,GAAapnB,YAAI,IAAAs6C,OAAA,EAAjBA,EAAmBjoC,YAAa,GAChDwnC,IAAoC,QAAjBU,EAAAnzB,GAAapnB,YAAI,IAAAu6C,OAAA,EAAjBA,EAAmBV,mBAAoB,GAC1DtoC,IAAsC,QAAjBipC,EAAApzB,GAAapnB,YAAI,IAAAw6C,OAAA,EAAjBA,EAAmBjpC,qBAAsB,GAC9DuoD,IAA0C,QAAjBrf,EAAArzB,GAAapnB,YAAI,IAAAy6C,OAAA,EAAjBA,EAAmBqf,yBAA0B,GAEtE1B,IAD0C,QAAjB1d,EAAAtzB,GAAapnB,YAAI,IAAA06C,GAAjBA,EAAmBqf,wBACX,QAAjBpf,EAAAvzB,GAAapnB,YAAI,IAAA26C,OAAA,EAAjBA,EAAmByd,gBAAiB,IACpD4B,IAAsC,QAAjBpf,EAAAxzB,GAAapnB,YAAI,IAAA46C,OAAA,EAAjBA,EAAmBof,qBAAsB,GAC9DC,IAAqC,QAAjBpf,EAAAzzB,GAAapnB,YAAI,IAAA66C,OAAA,EAAjBA,EAAmBof,oBAAqB,GAC5DC,IAAoC,QAAjBpf,EAAA1zB,GAAapnB,YAAI,IAAA86C,OAAA,EAAjBA,EAAmBof,mBAAoB,CAAC,EAG3DC,GAAkBC,EAAAA,QAAc,KACpC,IAAKr1D,GAASwb,oBAAqB,OAAO,EAE1C,MAAM85C,EAAUP,GAAuBnoD,KAAKC,GACzCA,EAAIvB,WAAauB,EAAIvB,YAActL,GAASwb,qBAC5C3O,EAAI1B,KAAO0B,EAAI1B,MAAQnL,GAASwb,qBAChC3O,EAAIjb,OAASib,EAAIjb,QAAUoO,GAASwb,qBAIvC,OAAoC,KAAtB,OAAP85C,QAAO,IAAPA,OAAO,EAAPA,EAASC,kBACf,CAACv1D,GAASwb,oBAAqBu5C,KAG5BS,GAAyBH,EAAAA,YAAmB1lE,IAChD,IAAKA,GAAyC,IAA/BsF,OAAOC,KAAKvF,GAAQ6D,OAAc,OAAO,KAIxD,MAAMiiE,EAAa,CACjBp2C,WAAY,CAAE5zB,MAAO,0BAA2BkE,OAAQ,IACxD2vB,UAAW,CAAE7zB,MAAO,+BAAuBkE,OAAQ,IACnD4vB,UAAW,CAAE9zB,MAAO,YAAakE,OAAQ,IACzC8vB,QAAS,CAAEh0B,MAAO,wBAAsBkE,OAAQ,IAChD+uB,cAAe,CAAEjzB,MAAO,+BAAuBkE,OAAQ,IACvDmhC,qBAAsB,CAAErlC,MAAO,yCAAoCkE,OAAQ,IAC3EgiC,UAAW,CAAElmC,MAAO,YAAakE,OAAQ,IACzCkiC,gBAAiB,CAAEpmC,MAAO,6BAAmBkE,OAAQ,IACrDkvB,uBAAwB,CAAEpzB,MAAO,gBAAiBkE,OAAQ,IAC1D+lE,QAAS,CAAEjqE,MAAO,aAAWkE,OAAQ,KAwDvC,OArDAsF,OAAOwb,QAAQ9gB,GAAQmY,QAAQiN,IAAqB,IAAnBvsB,EAAK6M,GAAQ0f,EAExC4gD,EAAetgE,EAMf7M,EAAI0J,SAAS,UAAY1J,EAAI0J,SAAS,UAAY1J,EAAI0J,SAAS,aAAe1J,EAAI0J,SAAS,UAC7FujE,EAAWp2C,WAAW1vB,OAAO0f,KAAKsmD,GAG3BntE,EAAI0J,SAAS,aAAe1J,EAAI0J,SAAS,aACzC1J,EAAI0J,SAAS,cAAgB1J,EAAI0J,SAAS,YAC1C1J,EAAI0J,SAAS,gBAAkB1J,EAAI0J,SAAS,WAAa1J,EAAI0J,SAAS,kBACtE1J,EAAI0J,SAAS,2BAA6B1J,EAAI0J,SAAS,oBAC9DujE,EAAWn2C,UAAU3vB,OAAO0f,KAAKsmD,GAG1BntE,EAAIkf,WAAW,aAAelf,EAAI0J,SAAS,oBAAsBmD,EAAQnD,SAAS,gBACzFujE,EAAWh2C,QAAQ9vB,OAAO0f,KAAKsmD,GAGxBntE,EAAI0J,SAAS,qBAAuB1J,EAAI0J,SAAS,iBAAmB1J,EAAI0J,SAAS,iBACxFujE,EAAW3kC,qBAAqBnhC,OAAO0f,KAAKsmD,GAGrCntE,EAAI0J,SAAS,cAAgB1J,EAAI0J,SAAS,QAAU1J,EAAI0J,SAAS,WAAa1J,EAAI0J,SAAS,WAClGujE,EAAWl2C,UAAU5vB,OAAO0f,KAAKsmD,GAG1BntE,EAAI0J,SAAS,mBAAqB1J,EAAI0J,SAAS,iBACtDujE,EAAW/2C,cAAc/uB,OAAO0f,KAAKsmD,GAG9BntE,EAAIkf,WAAW,aAAelf,EAAI0J,SAAS,mBAClDujE,EAAW5jC,gBAAgBliC,OAAO0f,KAAKsmD,GAGhCntE,EAAIkf,WAAW,YACtB+tD,EAAW9jC,UAAUhiC,OAAO0f,KAAKsmD,GAG1BntE,EAAI0J,SAAS,kBAAoB1J,EAAI0J,SAAS,YAAc1J,EAAI0J,SAAS,qBAChFujE,EAAW52C,uBAAuBlvB,OAAO0f,KAAKsmD,GAI9CF,EAAWC,QAAQ/lE,OAAO0f,KAAKsmD,MAMjCljE,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEohE,WAAY,uCAAwCjqD,WAAY,OAAQ/X,SAAA,EACpFC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVc,SAAU,OACVoW,WAAY,MACZE,aAAc,OACdjX,MAAO,UACPoB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,OACL9J,SAAA,EACAD,EAAAA,GAAAA,KAAC2hE,EAAAA,EAAW,CAACv5D,KAAM,GAAIpH,MAAM,UAAUH,MAAO,CAAEqhE,WAAY,MAC5DliE,EAAAA,GAAAA,KAAA,QAAAC,SAAM,kFAEPyC,OAAOkmB,OAAOs6C,GAAY5hE,IAAI,CAAC+hE,EAAK96D,IACnC86D,EAAIjmE,OAAO6D,OAAS,IAClBf,EAAAA,GAAAA,MAAA,OAAeW,MAAO,CACpBoX,aAAc,OACdnX,QAAS,OACTwiE,gBAAiB,UACjBliE,aAAc,OACdnB,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVkX,WAAY,MACZpW,SAAU,OACVX,MAAO,UACPiX,aAAc,OACdhY,SACCojE,EAAInqE,QAENmqE,EAAIjmE,OAAOkE,IAAI,CAACijB,EAAKg/C,KACpBrjE,EAAAA,GAAAA,MAAA,OAAkBW,MAAO,CACvBc,SAAU,OACVX,MAAO,OACPwiE,WAAY,MACZ9hE,UAAW,MACXU,QAAS,OACT4/D,WAAY,cACZ/hE,SAAA,EACAD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAE4iE,YAAa,MAAOziE,MAAO,UAAW+W,WAAY,QAAS9X,SAAC,YAC3ED,EAAAA,GAAAA,KAAA,QAAAC,SAAOskB,MATCg/C,MAfJh7D,QAgCjB,IAmBGm7D,IAf0BZ,EAAAA,QAAc,KAC5C,MAAMa,EAAW,IAAIjB,MAAuBC,IACtCiB,EAAY,IAAIC,IAStB,OANAF,EAASpuD,QAAQ+E,IACVspD,EAAU5mC,IAAI1iB,EAAIjb,QACrBukE,EAAUE,IAAIxpD,EAAIjb,MAAOib,KAItBtb,MAAMiV,KAAK2vD,EAAUh7C,WAC3B,CAAC85C,GAAoBC,KAGK7yC,GAAaN,UAInCu0C,GAAeC,KAAoBvnE,EAAAA,EAAAA,UAAS,IAC7B00B,GAASvxB,OAAOwxB,GAAmB,IAAdA,EAAExS,SAA+B,MAAdwS,EAAExS,SAAgC,IAAbwS,EAAEnS,QAA6B,MAAbmS,EAAEnS,SAMjGlE,IAAYgmB,EAAAA,EAAAA,SAAQ,IACyB,MAAzBtzB,GAASqb,aAAoD,MAA7Brb,GAASwnB,gBAO1D,CACL,CACE3rB,GAAI,IACJkW,MAAO,SACPE,SAAU,GACV1W,YAAa,SACb4V,QAAS,EACTqlD,YAAa,MAEZ1B,IAbIA,GAeR,CAACA,GAAe90D,GAASqb,YAAarb,GAASwnB,kBAG5CivC,GAA2BvB,IAIjCrlE,EAAAA,EAAAA,WAAU,KACR,MAAMkqD,GAAc35B,GAGpB+hC,IAAiB,GAEbpI,GAAc1/C,KAChB8nD,IAAiB,GAGjB/I,GAAAA,QAAa2a,oBAAmB,EAAM,8BAGvC,CAAC3zC,GAAa/lB,MAMjBxK,EAAAA,EAAAA,WAAU,KACR,GAAImQ,GAASyb,oBAAsBlqB,MAAMC,QAAQwO,GAASyb,oBAAqB,CAC7E,MAAMi7C,EAAiB,CAAC,EAGlBC,EAAuBvB,GAE7Bp1D,GAASyb,mBAAmB3T,QAAQqW,IAElC,MAAMy4C,EACHz4C,EAAQ04C,UAAwC,KAA5B14C,EAAQ04C,SAAS9hE,QACrCopB,EAAQ24C,YAA4C,KAA9B34C,EAAQ24C,WAAW/hE,QACzCopB,EAAQ44C,cAAgD,KAAhC54C,EAAQ44C,aAAahiE,QAC7CopB,EAAQgY,UAAwC,KAA5BhY,EAAQgY,SAASphC,OAWtC2hE,EAAev4C,EAAQtiB,OADrB86D,IAAwBC,KAS9BhQ,GAAyB8P,EAC3B,GACC,CAC0B,QAD1B1gB,EACDh2C,GAASyb,0BAAkB,IAAAu6B,OAAA,EAA3BA,EAA6BxiD,OAC7BwM,GAASwb,oBACT45C,GAGA/jE,KAAKuR,UAAqC,QAA5BqzC,EAACj2C,GAASyb,0BAAkB,IAAAw6B,OAAA,EAA3BA,EAA6BpiD,IAAImjE,IAAC,CAC/Cn7D,GAAIm7D,EAAEn7D,GACNjI,KAAMojE,EAAEH,SACRI,OAAQD,EAAEF,WACVI,SAAUF,EAAED,aACZ5gC,SAAU6gC,EAAE7gC,gBAKhBtmC,EAAAA,EAAAA,WAAU,KACJmQ,GAASgM,eAAiBhM,GAASgM,gBAAkBs/C,IACvDC,GAAqBvrD,GAASgM,gBAE/B,CAAChM,GAASgM,cAAes/C,KAG5B,MAAO6L,GAAgBC,KAAqBpoE,EAAAA,EAAAA,WAAS,IAC9CqoE,GAAkBC,KAAuBtoE,EAAAA,EAAAA,WAAS,IAGzDa,EAAAA,EAAAA,WAAU,IAED,KAML,GAAIqyD,IAAiB7nD,IAAW2F,GAAU,CAMxC,KAHqB/K,OAAOC,KAAK8K,IACOxM,QAAU,IAGhD,OAGF,IAME4lD,GAAAA,QAAaI,eAAen/C,IAG5B++C,GAAAA,QAAaya,UAAU7zD,GAAU,CAC/BgV,QAAShV,GAASnE,IAAM,MAK5B,CAAE,MAAO5K,GACT,CACF,GAGD,KAIHpB,EAAAA,EAAAA,WAAU,KAKR,IAAKwK,KAAY6nD,IAAiB9hC,GAChC,OAGF,IAAI3W,GAAW,EA+Hf,MA7HsB3Y,WACpB,IAAK,IAADymE,EACFne,GAAAA,QAAaI,eAAen/C,IAK5B,UAFuB++C,GAAAA,QAAaK,WAGlC,OAIF,MAAMC,QAAkBN,GAAAA,QAAaO,YAErC,GAAc,OAATD,QAAS,IAATA,IAAAA,EAAW15C,WAAayJ,EAC3B,OAIF,GAAIiwC,EAAU15C,SAASnE,GAAI,CAEzB,MAAM27D,QAAkBpe,GAAAA,QAAaqe,YACnC3mE,UACE,IACE,aAAa4mE,EAAAA,GAAAA,IAAoB1iD,EAASvmB,GAAOC,GACnD,CAAE,MAAOuC,GACP,OAAO,IACT,GAEFH,UACE,IACE,MAAMqiB,QAAiBgC,EAAAA,GAAAA,YAAWH,EAASvmB,GAAOC,IAClD,OAAe,OAARykB,QAAQ,IAARA,OAAQ,EAARA,EAAUlY,OAAQ,IAC3B,CAAE,MAAOhK,GAAQ,IAADwoB,EAKd,OAHsB,OAAb,OAALxoB,QAAK,IAALA,OAAK,EAALA,EAAO4iB,SAA8C,OAAvB,OAAL5iB,QAAK,IAALA,GAAe,QAAVwoB,EAALxoB,EAAOkiB,gBAAQ,IAAAsG,OAAV,EAALA,EAAiB5F,SAC5ChQ,QAAQC,KAAK,+EAER,IACT,IAIJ,IAAK2F,EAAU,OAEf,GAAI+tD,EAAUG,WAAaH,EAAUI,OAAQ,CAE3C,MAAMC,GAAU/lE,EAAAA,EAAAA,GAAA,GAAQ0lE,EAAUI,QAmBlC,OAlBKC,EAAWp8C,oBAA+D,IAAzCo8C,EAAWp8C,mBAAmBjoB,QAC9DwM,GAASyb,oBAAsBzb,GAASyb,mBAAmBjoB,OAAS,IACtEqkE,EAAWp8C,mBAAqBzb,GAASyb,oBAK7CukC,GAAY6X,GACZ5V,IAAa,GACbpD,IAAc,GAEdiE,GAAoB,CAClBhJ,YAAY,EACZC,YAAY,EACZ/kC,QAASwiD,EAAUI,OAAO/7D,GAC1Bu/B,YAAao8B,EAAUI,OAAOhzC,kBAAoB4yC,EAAUI,OAAOjzC,sBAE/Dy0B,GAAAA,QAAa0e,iBAAiBN,EAAUI,OAAQJ,EAAUI,OAAO/7D,GAEzE,CACF,CAKA,MAAMk8D,GAAgBjmE,EAAAA,EAAAA,GAAA,GAAQ4nD,EAAU15C,UAEpC+3D,EAAiBlwD,SAAWtW,MAAMC,QAAQumE,EAAiBlwD,WAC7DkwD,EAAiBlwD,QAAUkwD,EAAiBlwD,QAAQhU,IAAIkU,IAClDA,EAAQiQ,kBAAoBzmB,MAAMC,QAAQuW,EAAQiQ,oBAEpDjQ,EAAQiQ,iBAAmBjQ,EAAQiQ,iBAAiBnkB,IAAIqX,GAClC,kBAATA,EAA0BA,EAC9BA,EAAKtZ,OAASsZ,EAAKI,WAAaJ,EAAKrP,IAAMqP,IAG/CnD,KAIXi4C,GAAYnuD,IAAI,IAAAmmE,EAAAC,EAAA,OAAAnmE,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GACAkmE,GAAgB,IACnBl8D,IAAQ,OAAJhK,QAAI,IAAJA,OAAI,EAAJA,EAAMgK,KAAM69C,EAAU15C,SAASnE,GACnC2sB,sBAA0B,OAAJ32B,QAAI,IAAJA,OAAI,EAAJA,EAAM22B,uBAAwBkxB,EAAU15C,SAASwoB,qBAGvE/J,eAAgBs5C,EAAiBt5C,iBAAsB,OAAJ5sB,QAAI,IAAJA,OAAI,EAAJA,EAAM4sB,iBAAkB,GAC3EnJ,cAAgByiD,EAAiBziD,eAAiB/jB,MAAMC,QAAQumE,EAAiBziD,gBAAkByiD,EAAiBziD,cAAc9hB,OAAS,EACvIukE,EAAiBziD,eACZ,OAAJzjB,QAAI,IAAJA,OAAI,EAAJA,EAAMyjB,gBAAiB,GAG5BuG,4BAAwE,QAA3Cm8C,EAAAD,EAAiBl8C,kCAA0B,IAAAm8C,GAAS,QAATC,EAA3CD,EAA6ChxC,eAAO,IAAAixC,OAAT,EAA3CA,EAAsDzkE,QAAS,EACxFukE,EAAiBl8C,4BACZ,OAAJhqB,QAAI,IAAJA,OAAI,EAAJA,EAAMgqB,6BAA8Bk8C,EAAiBl8C,+BAG5DomC,IAAqC,IAAxBvI,EAAUsI,YAEnBtI,EAAU15C,SAASnE,IAAwB,QAAtB07D,EAAI7d,EAAU15C,gBAAQ,IAAAu3D,GAAlBA,EAAoB17D,MAC/CgjD,IAAc,GAEdiE,GAAoB,CAClBhJ,YAAY,EACZC,YAAY,EACZ/kC,QAAS0kC,EAAU15C,SAASnE,GAC5Bu/B,YAAase,EAAU15C,SAAS4kB,kBAAoB80B,EAAU15C,SAAS2kB,WAI7E,CAAE,MAAO1zB,GACT,GAGFinE,GAEO,KACLzuD,GAAW,IAEZ,CAACpP,GAAS6nD,GAAe9hC,KAK5B,MAAM+3C,IAAmB7kC,EAAAA,EAAAA,SAAQ,MAAQtzB,GAASnE,GAAI,CAACmE,GAASnE,KAM1Du8D,KALkB9kC,EAAAA,EAAAA,SAAQ,KACf/hC,MAAMC,QAAQwO,GAASukB,mBAAqBvkB,GAASukB,kBAAoB0K,GAAoBjvB,GAASukB,oBACvGryB,SAAS,aACtB,CAAC8N,GAASukB,oBAEapF,GAAqB6V,GAAmBh9B,GAAcC,KAG1EogE,GAAmBC,IACC,CAEtB,WAAc,eACd,UAAa,eAGb,YAAe,iBACf,UAAa,iBACb,QAAW,iBACX,gBAAmB,iBACnB,cAAiB,iBAGjB,QAAW,cAGX,qBAAwB,eACxB,cAAiB,eACjB,kBAAqB,eACrB,iBAAoB,eACpB,UAAa,eACb,cAAiB,eAGjB,uBAA0B,kBAGLA,IAAgB,kBAInCC,GAAgBrgE,KAAkBA,GAAc,iBAAmBA,GAAc,kBAAoBA,GAAc,mBAAqBA,GAAc,mBAGtJgI,IAAkBsC,EAAAA,EAAAA,aAAa81D,IACnC,MAAMp5D,EAAQlH,GAGd,GAAc,IAAVkH,EAAa,CACf,MACMs5D,EAAmC,CAAC,cAAe,WAGzD,QAJsB,CAAC,aAAc,aAInBtmE,SAASomE,OAKvBC,KAAiBC,EAAiCtmE,SAASomE,GAKjE,CAGA,OAAc,IAAVp5D,EACK,CAAC,cAAe,YAAa,UAAW,kBAAmB,UAAW,iBAAiBhN,SAASomE,GAIrGp5D,GAAS,GACJ,CAAC,uBAAwB,gBAAiB,oBAAqB,mBAAoB,YAAa,iBAAiBhN,SAASomE,IAIlI,CAACtgE,GAAcugE,KAGZE,GAAmBvgE,IAAiBA,GAAc,iBAClDwgE,GAAkBxgE,IAAiBA,GAAc,gBACjDygE,GAAiBzgE,IAAiBA,GAAc,eAChD0gE,GAAgB1gE,KAAkBA,GAAc,iBAAmBA,GAAc,mBAAqBA,GAAc,mBACpHm6B,GAA0BomC,IAAoBC,GAC9Cr4D,GAAqBnI,IAAiBA,GAAc,0BACpD2gE,GAAoB3gE,IAAiBA,GAAc,kBACnD4gE,GAAe5gE,KAAkBA,GAAc,iBAAmBA,GAAc,mBAAqBA,GAAc,mBAGnH6gE,GAAyB,OAAVpqE,SAAU,IAAVA,IAAiB,QAAPunD,EAAVvnD,GAAYqqE,aAAK,IAAA9iB,OAAP,EAAVA,EAAmB3qC,KAAK0tD,GAA0B,eAAlBA,EAAKC,UACpDC,GAAoB,OAAVxqE,SAAU,IAAVA,IAAiB,QAAPwnD,EAAVxnD,GAAYqqE,aAAK,IAAA7iB,OAAP,EAAVA,EAAmB5qC,KAAK0tD,GAA0B,kBAAlBA,EAAKC,UAC/CE,GAA2BlhE,IAAiBA,GAAc,gBAC1DoI,GAAoBy4D,IAAgBI,IAAWC,GAI/CC,GAAwBhE,EAAAA,QAAc,KAAO,IAADiE,EAEhD,IAAKt5D,GAASqb,YACZ,OAAOg4C,GAIT,MAAMkG,EAAmBjsD,GAAUV,KAAKsE,IACrCA,EAAKrV,IAAMqV,EAAK7W,WAAa4J,SAASjE,GAASqb,cAIlD,IAAKk+C,EAEH,OADA11D,QAAQC,KAAK,wDACNuvD,GAMT,MAAMmG,EAAoB91C,GAAS9W,KAAK+W,IACrCA,EAAE9nB,IAAM8nB,EAAEtpB,WAAa4J,SAASjE,GAASqb,cAI5C,GAF8C,OAAjBm+C,QAAiB,IAAjBA,GAAwB,QAAPF,EAAjBE,EAAmBR,aAAK,IAAAM,OAAP,EAAjBA,EAA0B/tD,KAAK0tD,GAA0B,eAAlBA,EAAKC,UAE/C,CAExB,MAAMjoB,EAAQ,IAAIhiC,KAGlB,OAFAgiC,EAAMwoB,SAAS,EAAG,EAAG,EAAG,GAEjBpG,GAAclhE,OAAOu8D,IAC1B,MAAMgL,EAAWhL,EAAGiL,UAAY,IAAI1qD,KAAKy/C,EAAGiL,WAAa,KACnDC,EAAWlL,EAAGmL,UAAY,IAAI5qD,KAAKy/C,EAAGmL,WAAa,KAGzD,OAFIH,GAAUA,EAASD,SAAS,EAAG,EAAG,EAAG,GACrCG,GAAUA,EAASH,SAAS,EAAG,EAAG,EAAG,KAChCC,GAAYA,GAAYzoB,MAAY2oB,GAAYA,GAAY3oB,IAEzE,CAGA,MAAM6oB,EAAiBP,EAAiBQ,QAExC,IAAKD,EAEH,OADAj2D,QAAQC,KAAK,iDAA6By1D,GACnClG,GAIT,MAAMpiB,EAAQ,IAAIhiC,KAClBgiC,EAAMwoB,SAAS,EAAG,EAAG,EAAG,GA4BxB,OAzBiBpG,GAAclhE,OAAOu8D,IAEpC,MAAMsL,EAAWtL,EAAGqL,SAAWrL,EAAG96D,KAClC,IAAKomE,GAAY1/D,OAAO0/D,KAAc1/D,OAAOw/D,GAC3C,OAAO,EAIT,MAAMJ,EAAWhL,EAAGiL,UAAY,IAAI1qD,KAAKy/C,EAAGiL,WAAa,KACnDC,EAAWlL,EAAGmL,UAAY,IAAI5qD,KAAKy/C,EAAGmL,WAAa,KAGrDH,GAAUA,EAASD,SAAS,EAAG,EAAG,EAAG,GACrCG,GAAUA,EAASH,SAAS,EAAG,EAAG,EAAG,GASzC,QAHIC,GAAYA,GAAYzoB,MACxB2oB,GAAYA,GAAY3oB,MAM7B,CAACjxC,GAASqb,YAAag4C,GAAe/lD,GAAWoW,KAS9Cu2C,IAAkB3mC,EAAAA,EAAAA,SAAQ,IAIvBlzB,GACN,CAACA,KAKED,IAAmBmzB,EAAAA,EAAAA,SAAQ,IACxBquB,GAAgB9rB,sBACtB,CAAC79B,GAAcgI,GAASnE,GAAI5D,GAAY+H,GAASukB,kBAAmBvkB,GAAS0mB,+BAAgCi7B,KAI1GuY,IAAoB5mC,EAAAA,EAAAA,SAAQ,MAChCz3B,GAAImE,GAASnE,GACbgM,QAAS7H,GAAS6H,QAClBM,eAAgBnI,GAASmI,iBACvB,CAACnI,GAASnE,GAAImE,GAAS6H,QAAS7H,GAASmI,iBAGvCgyD,IAAqB7mC,EAAAA,EAAAA,SAAQ,KACjC,IAAKzM,IAAsC,IAAvBA,GAAYrzB,OAC9B,MAAO,CAAE4mE,MAAO,EAAGzwD,WAAW,GAahC,MAAO,CAAEywD,MAVKvzC,GAAYrzB,OAUVmW,UAREkd,GAAYtb,KAAKu1C,IACb,IAApBA,EAAIuZ,aACW,UAAfvZ,EAAIjtC,QACW,WAAfitC,EAAIjtC,SACHitC,EAAIwZ,aACsB,KAA3BxZ,EAAIwZ,YAAYvlE,UAIjB,CAAC8xB,KAGE0zC,IAAwBjnC,EAAAA,EAAAA,SAAQ,KAAO,IAADC,EAAAC,EAC1C,MAAMpE,GAAMt9B,EAAAA,EAAAA,GAAA,GAAQqO,IAIhBH,GAASnE,KACXuzB,EAAOtlB,QAAU,CACfnB,SAAS,EACTC,SAAUqxD,GACVvvD,iBAAkByvD,GAAmBC,MACrCzvD,oBAAqBwvD,GAAmBxwD,YAK5C,MAAM8pB,EAAuD,cAAb,QAApBF,EAAAvzB,GAASwN,mBAAW,IAAA+lB,OAAA,EAApBA,EAAsBtM,QAC5CyM,EAA4E,cAAb,QAAnCF,EAAAxzB,GAAS6b,kCAA0B,IAAA2X,OAAA,EAAnCA,EAAqCvM,QACjE8J,EAAa0C,GAAuBC,EACpC8mC,EAAax6D,GAAS6H,SAAW7H,GAAS6H,QAAQrU,OAAS,EAE7D47B,EAAOuC,YACTvC,EAAOuC,WAAS7/B,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXs9B,EAAOuC,WAAS,IACnBhpB,SAAUooB,IACR8nC,GACI7gE,IAAgB,EACfA,IAAgB,GAAKwiE,MAMhC,MAAMC,EAAkBz6D,GAASgc,eAAiBhc,GAASic,aAmB3D,OAlBImT,EAAOvQ,yBACTuQ,EAAOvQ,wBAAsB/sB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACxBs9B,EAAOvQ,wBAAsB,IAChClW,QAASymB,EAAOvQ,uBAAuBlW,UACrCtI,IAAsBo6D,MAOxBrrC,EAAO2C,WAAazxB,IAAqBtI,IAAgB,IAC3Do3B,EAAO2C,WAASjgC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXs9B,EAAO2C,WAAS,IACnBppB,SAAS,KAINymB,GACN,CAACjvB,GAAkBnI,GAAc6gE,GAAmBx4D,GAC/B,QADiD6yB,EACrElzB,GAASwN,mBAAW,IAAA0lB,OAAA,EAApBA,EAAsBjM,OAA2C,QAArCkM,EAAEnzB,GAAS6b,kCAA0B,IAAAsX,OAAA,EAAnCA,EAAqClM,OACnEjnB,GAAS6H,QAAS7H,GAASgc,cAAehc,GAASic,aACnDjc,GAASnE,GAAIo+D,GAAiB35D,GAAmB65D,KAG/CO,IAAkBl4D,EAAAA,EAAAA,aAAakG,IAC3BA,EAAaE,SAAWijB,IAAoBp8B,GACnD,CAACo8B,GAAkBp8B,KAGhBkrE,GAAex6D,GAAiB8wB,cAChCyB,IAAmBioC,GAAa/xD,QAEhCgyD,GAAuBz6D,GAAiB0e,uBACxCg8C,IAA2BD,GAAqBhyD,QAEhDkyD,GAAiB36D,GAAiB2wB,qBAClCiqC,IAAqBD,GAAelyD,QAIpC2pB,GAA2BmoC,GADTv6D,GAAiBkf,YAInCmT,GAA2BkoC,GADVv6D,GAAiBmf,WAMlC07C,IAAiC/iE,IAAcD,IAAgB,IAAM2pD,GAAgB9tB,kBAAkB,UAGvGonC,GAAmB96D,GAAiBqN,YACpC0tD,GAA+BR,GAAgBO,IAI/CxoC,GAA2BioC,GADVv6D,GAAiBof,WAIlC47C,GAA8BT,GAAgBI,IAE9CM,GAAiBj7D,GAAiBwxB,UAClC0pC,IAA2BD,GAAexyD,UAAY5Q,IAAgB,GAAKm3B,GAAiBnvB,GAASukB,kBAAmB,cACxH+2C,IAAqBF,GAAexyD,QAMpC2yD,GAAiBp7D,GAAiB4xB,UAIlCypC,IAHqBD,GAAe3yD,QAGjBumB,GAAiBnvB,GAASukB,kBAAmB,cAChEk3C,GAAwBD,KAAqB7Z,GAAgB9tB,kBAAkB,aAI/E6nC,GAAkBvsC,GAAiBnvB,GAASukB,kBAAmB,iBAC/Do3C,GAA2B3jE,GAAe,GAAKA,IAAgB,GAAK0jE,IAAmBD,IAAyBxjE,GAGlGk3B,GAAiBnvB,GAASukB,kBAAmB,YACxC4K,GAAiBnvB,GAASukB,kBAAmB,YAqBtE10B,EAAAA,EAAAA,WAAU,KAEJuwB,KAGF+hC,IAAiB,GACjBgI,IAAiB,GAEjBvR,GAAsBp/C,QAAU,OAEjC,CAAC4mB,GAAa3xB,GAAOC,MAIxBmB,EAAAA,EAAAA,WAAU,OAMP,CAACuwB,GAAa3xB,GAAOC,GAAUwzD,GAAe+T,KAocjD,MAAM2F,IAAc1iE,EAAAA,EAAAA,QAAO,CAAE6/D,cAAc,EAAOI,SAAS,KAI3DtpE,EAAAA,EAAAA,WAAU,KAAO,IAADgsE,EAAAC,EACd,MAAM/C,EAAyB,OAAVpqE,SAAU,IAAVA,IAAiB,QAAPktE,EAAVltE,GAAYqqE,aAAK,IAAA6C,OAAP,EAAVA,EAAmBtwD,KAAK0tD,GAA0B,eAAlBA,EAAKC,UACpDC,EAAoB,OAAVxqE,SAAU,IAAVA,IAAiB,QAAPmtE,EAAVntE,GAAYqqE,aAAK,IAAA8C,OAAP,EAAVA,EAAmBvwD,KAAK0tD,GAA0B,kBAAlBA,EAAKC,UACrD0C,GAAYpiE,QAAU,CAAEu/D,eAAcI,YACrC,CAACxqE,MAIJkB,EAAAA,EAAAA,WAAU,KAER,GAAIkqD,IAAcmI,KAAkBliD,GAAS+R,OAASpjB,IAAc0L,GAAS,CAE3E,MAAM0X,EAAQ,GAAAnW,OAAGjN,GAAWkjB,WAAaljB,GAAWkjB,WAAa,IAAM,IAAEjW,OAAGjN,GAAWojB,OAAS,GAAE,KAAAnW,OAAIjN,GAAWsjB,UAAY,IAAErW,OAAGjN,GAAWwjB,SAAW,KAAOxjB,GAAWwjB,SAAW,IAAKC,QAAQ,OAAQ,KAAKrd,OAK/MirD,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACPkgB,MAAOA,EACPuJ,MAAO3sB,GAAW2sB,OAAS,GAC3BuH,QAASl0B,GAAWk0B,SAAW,GAC/B6F,YAAaruB,GACbgpB,cAAehpB,KAEnB,GACC,CAAC0/C,GAAYmI,GAAeliD,GAAS+R,MAAOpjB,GAAY0L,MAG3DxK,EAAAA,EAAAA,WAAU,IACD,OAMN,KAIHA,EAAAA,EAAAA,WAAU,KACJmQ,GAASnE,KAKN4qD,KACHD,GAAoB,CAAC,GACrB/L,GAAuB,IAAIzrB,MAIzB30B,IAAW2F,GAAS2kB,UACtBy0B,GAAAA,QAAaS,aAAa,CAAEkiB,kBAAmB/7D,GAAS2kB,aAK3D,CAAC3kB,GAASnE,KAGb,MAAMmgE,IAAwB9iE,EAAAA,EAAAA,SAAO,GAC/B+iE,IAAe/iE,EAAAA,EAAAA,QAAOlB,KAG5BnI,EAAAA,EAAAA,WAAU,KAAO,IAADqsE,EAQd,MAAMC,GAA2C,QAA3BD,EAAAl8D,GAASyb,0BAAkB,IAAAygD,OAAA,EAA3BA,EAA6B1oE,SAAU,EAQxD0uD,KAQD+Z,GAAaziE,UAAYxB,KAC3BgkE,GAAsBxiE,SAAU,EAChCyiE,GAAaziE,QAAUxB,IAMrBA,IAAgB,GACE,IAAlBmkE,IACCH,GAAsBxiE,UAEzBwiE,GAAsBxiE,SAAU,EAGhCwmD,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP4pB,mBAAoB,CAClB,CACE5f,GAAG,YAADD,OAAcqT,KAAKC,OACrBoP,MAAO,GACPmjC,SAAU,IACV2a,SAAU,KACV79C,aAAc,GACd22B,UAAW,KACX12B,WAAY,WAKnB,CAACxmB,GAAckqD,GAAeliD,GAASwb,oBAAgD,QAA7B46B,EAAEp2C,GAASyb,0BAAkB,IAAA26B,OAAA,EAA3BA,EAA6B5iD,UAc5F3D,EAAAA,EAAAA,WAAU,KAER,IAAKmQ,GAASyb,oBAA6D,IAAvCzb,GAASyb,mBAAmBjoB,OAAc,OAC9E,GAAqB,IAAjBwE,GAAoB,OAGxB,MAAMqkE,EAAqBr8D,GAAS6b,2BAEpC,KADsD,SAAhB,OAAlBwgD,QAAkB,IAAlBA,OAAkB,EAAlBA,EAAoBt1C,aAAyD,KAAhB,OAAlBs1C,QAAkB,IAAlBA,OAAkB,EAAlBA,EAAoBl1C,YACjE,OAGlB,GAAIgI,GAAiBnvB,GAASukB,kBAAmB,aAAc,OAC/D,GAAI4K,GAAiBnvB,GAASukB,kBAAmB,eAAgB,OAGjE,QAAmC7X,IAA/B1M,GAASkc,mBAAkE,OAA/Blc,GAASkc,kBAA4B,OAGrF,MAAMogD,EAAoBt8D,GAASyb,mBAAmB2d,OAAO,CAACmjC,EAAKp+C,IAI1Do+C,GAFYr0D,YAAYiW,EAAQI,cAAgB,KAAKpjB,WAAWiX,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,IACrGlK,WAAWiW,EAAQsjC,WAAa,GAEhD,GAGG+a,EAAeF,EAAoB,IACzCtc,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACPqqB,kBAAmBsgD,KAGrB/b,GAAY,OAAQ,UAAW,cAAc,QAAD7kD,OAClC0gE,EAAkBntB,QAAQ,GAAE,aAAAvzC,OAAO4gE,EAAe,IAAM,SAAG,uFAAA5gE,OAAsD4gE,KAE1H,CAACxkE,GAAcgI,GAASyb,mBAAoBzb,GAAS6b,2BAA4B7b,GAASukB,kBAAmBvkB,GAASkc,oBAGzH,MAAMugD,IAAgBj6D,EAAAA,EAAAA,aAAak6D,IACjC1c,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACPgW,QAAS60D,KAGXza,IAAa,IACZ,KAKHpyD,EAAAA,EAAAA,WAAU,KACR,IAAKmQ,GAAS4L,qBAAuBY,GAAmBhZ,OAAQ,OAEhE,MAAMmpE,EAAsBnwD,GAAmBI,KAAKC,GAClDA,EAAI1B,MAAQnL,GAAS4L,oBACrBiB,EAAIjb,QAAUoO,GAAS4L,sBAGQ,OAAnB+wD,QAAmB,IAAnBA,OAAmB,EAAnBA,EAAqB7sE,QAAS,IACnBgtB,cAAc5qB,SAAS,aAI9CgoD,GAAiBroD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAChBD,GAAI,IACP0tB,WAAW,KAIbygC,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACPytD,aAAc,KACdvvD,gBAAiB,GACjBE,iBAAkB,GAClBE,cAAe,GACfE,cAAe,GACfE,qBAAsB,GACtBE,wBAAyB,GACzBE,wBAAyB,GACzBE,0BAA2B,OAM7BqpD,GAAiBroD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAChBD,GAAI,IACP0tB,WAAW,MAGd,CAACvf,GAAS4L,mBAAoBY,GAAoBi6C,MAGrD52D,EAAAA,EAAAA,WAAU,KACR,MAAM+sE,EAAmBnrE,IACvBA,EAAEuU,iBACFvU,EAAEkB,mBAGE2T,EAAc7U,IAClBmrE,EAAgBnrE,IAWlB,MAPA,CAAC,YAAa,WAAY,YAAa,QAAQqW,QAAQ+0D,IACrDp3D,SAASjB,iBAAiBq4D,EAAWD,GAAiB,KAGxDn3D,SAASjB,iBAAiB,OAAQ8B,GAAY,GAGvC,KACL,CAAC,YAAa,WAAY,YAAa,QAAQwB,QAAQ+0D,IACrDp3D,SAAShB,oBAAoBo4D,EAAWD,GAAiB,KAE3Dn3D,SAAShB,oBAAoB,OAAQ6B,GAAY,KAElD,IAGH,MAAMw2D,IAAaxpC,EAAAA,EAAAA,SAAQ,IACpBtzB,GAASyb,oBAA6D,IAAvCzb,GAASyb,mBAAmBjoB,OAIzDwM,GAASyb,mBAAmB2d,OAAO,CAAC2jC,EAAO5+C,IAGzC4+C,GADM70D,YAAYiW,EAAQK,YAAc,KAAKrjB,WAAWiX,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,GAE7G,GAPM,EAQR,CAACpS,GAASyb,qBAGPuhD,IAAW1pC,EAAAA,EAAAA,SAAQ,KAAO,IAAD2pC,EAC7B,OAAO/0D,WAAkC,QAAxB+0D,EAACj9D,GAASmI,sBAAc,IAAA80D,OAAA,EAAvBA,EAAyB9hE,WAAWiX,QAAQ,YAAa,MAAQ,GAClF,CAACpS,GAASmI,iBAGP+0D,GAAkBJ,GAAaE,IAAYA,GAAW,EAItDV,IAAoBhpC,EAAAA,EAAAA,SAAQ,IAC3BtzB,GAASyb,oBAA6D,IAAvCzb,GAASyb,mBAAmBjoB,OAGzDwM,GAASyb,mBAAmB2d,OAAO,CAACmjC,EAAKp+C,IAIvCo+C,GAFYr0D,YAAYiW,EAAQI,cAAgB,KAAKpjB,WAAWiX,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,IACrGlK,WAAWiW,EAAQsjC,WAAa,GAEhD,GAPM,EAQR,CAACzhD,GAASyb,sBAGgB6X,EAAAA,EAAAA,SAAQ,IAC5BwpC,GAAa,KACnB,CAACA,MAIJjtE,EAAAA,EAAAA,WAAU,KACgBynC,MACmB,GACpBglC,GAAoB,MACnBt8D,GAASkc,mBACVlc,GAASnE,IAG9BnK,GAAkB,qBAAqB,IAExC,CAAC4lC,KAAmBglC,GAAmBt8D,GAASnE,GAAImE,GAASnE,MAGhEhM,EAAAA,EAAAA,WAAU,KACJmI,GAAe,GAAsB,OAAjBo0D,IACtBC,GAAgB,OAEjB,CAACr0D,GAAco0D,MAIlBv8D,EAAAA,EAAAA,WAAU,KACJmQ,GAASnE,IAAMpN,IAASC,KAAaqrD,KAAex9B,GAAczS,SAEpEqzD,MAED,CAACn9D,GAASnE,GAAImE,GAASnE,GAAIpN,GAAOC,GAAUqrD,GAAYx9B,GAAczS,UA2BzE,MAAM22C,GAAcA,CAACta,EAAO1+B,EAAUi5C,EAAQzlD,OAyBxCmiE,GAAmBj9C,IACvB,IAAKA,EAAQ,MAAO,GAGpB,IAAIjP,EAAOwS,GAAS9W,KAAK+W,IAAMA,EAAE9nB,IAAM8nB,EAAEtpB,WAAa4J,SAASkc,IAa/D,GAVKjP,IACHA,EAAO5D,GAAUV,KAAK+W,IAAMA,EAAE9nB,IAAM8nB,EAAEtpB,WAAa4J,SAASkc,MAIzDjP,GAAQjN,SAASkc,KAAYlc,SAAS5J,KAAY1L,KACrDuiB,EAAOviB,KAIJuiB,GAAQguC,GAAe/+B,GAC1B,OAAO++B,GAAe/+B,GAGxB,GAAIjP,EAAM,CAER,MAAMW,EAAaX,EAAKW,WAAaX,EAAKW,WAAa,IAAM,GACvDE,EAAQb,EAAKa,OAAS,GACtBE,EAAWf,EAAKe,UAAY,GAC5BE,EAAWjB,EAAKiB,SAAW,KAAOjB,EAAKiB,SAAW,GAExD,MAAO,GAAAvW,OAAGiW,GAAUjW,OAAGmW,EAAK,KAAAnW,OAAIqW,GAAQrW,OAAGuW,GAAWC,QAAQ,OAAQ,KAAKrd,MAC7E,CAoCA,OAjCKmqD,GAAe/+B,KAClBk9C,EAAAA,GAAAA,mBAAkB3uE,GAAUD,GAAO0xB,GAChCm9C,KAAK3uE,IACJ,GAAIA,EAAY,CACd,MAAMkjB,EAAaljB,EAAWkjB,WAAaljB,EAAWkjB,WAAa,IAAM,GACnEE,EAAQpjB,EAAWojB,OAAS,GAC5BE,EAAWtjB,EAAWsjB,UAAY,GAClCE,EAAWxjB,EAAWwjB,SAAW,KAAOxjB,EAAWwjB,SAAW,GAC9DorD,EAAW,GAAA3hE,OAAGiW,GAAUjW,OAAGmW,EAAK,KAAAnW,OAAIqW,GAAQrW,OAAGuW,GAAWC,QAAQ,OAAQ,KAAKrd,OAGrFoqD,GAAkBttD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACjBD,GAAI,IACP,CAACsuB,GAASo9C,IAEd,MAEEpe,GAAkBttD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACjBD,GAAI,IACP,CAACsuB,GAAQ,oBAAFvkB,OAAkBukB,QAI9Bq9C,MAAMvsE,IAELkuD,GAAkBttD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACjBD,GAAI,IACP,CAACsuB,GAAQ,oBAAFvkB,OAAkBukB,QAM1B,yBAIHs9C,GAAkB94C,KACjBA,IACY,0BAAbA,IACoB,kBAAbA,GAA6C,KAApBA,EAAS5vB,UAO/ClF,EAAAA,EAAAA,WAAU,KACkBiB,WAExB,IAAKmlE,IAA4C,IAApBvyC,GAASlwB,OACpC,OAIF,MAAMkqE,EAAch6C,GAASvxB,OAAOwxB,GAAmB,IAAdA,EAAExS,SAA+B,MAAdwS,EAAExS,SAAgC,IAAbwS,EAAEnS,QAA6B,MAAbmS,EAAEnS,QAG/FugD,EAAiB/xD,GAASnE,IAAMmE,GAASnE,GAE/C,IAAKmE,GAASob,qBAAuB22C,EAEnC,YADAwE,GAAiBmH,GASnB,GAJ2BA,EAAY9wD,KACrC+W,GAAMA,EAAE9nB,KAAOmE,GAASob,oBAAsBuI,EAAEtpB,UAAY2F,GAASob,oBAKrE,YADAm7C,GAAiBmH,GAKnB,MAAMC,EAAmBj6C,GAAS9W,KAChC+W,GAAMA,EAAE9nB,KAAOmE,GAASob,oBAAsBuI,EAAEtpB,UAAY2F,GAASob,oBAGvE,GAAIuiD,EACFpH,GAAiB,CAACoH,KAAqBD,SAMzC,GAAKhvE,IAAaD,GAKlB,IACE,MAAMmvE,QAA6BP,EAAAA,GAAAA,mBACjC3uE,GACAD,GACAuR,GAASob,oBAGX,GAAIwiD,EAAsB,CAExB,MAAMC,EAAmB,CACvBhiE,GAAI+hE,EAAqB/hE,IAAM+hE,EAAqBl1C,YACpDruB,QAASujE,EAAqB/hE,IAAM+hE,EAAqBl1C,YACzDh6B,SAAUkvE,EAAqBlvE,UAAYkvE,EAAqBE,MAChE/rD,MAAO6rD,EAAqB7rD,OAAS,GACrCE,SAAU2rD,EAAqB3rD,UAAY,GAC3CJ,WAAY+rD,EAAqB/rD,YAAc,GAC/CM,SAAUyrD,EAAqBzrD,UAAY,GAC3CmJ,MAAOsiD,EAAqBtiD,OAAS,GACrCnK,QAAS,GAIXolD,GAAiB,CAACsH,KAAqBH,GACzC,MACEnH,GAAiBmH,EAErB,CAAE,MAAOzsE,GACPslE,GAAiBmH,EACnB,MAhCEnH,GAAiBmH,IAmCrBK,IACC,CAAC/9D,GAASob,mBAAoBpb,GAASnE,GAAI6nB,GAAU1jB,GAASnE,GAAInN,GAAUD,GAAOwnE,KAYrDZ,EAAAA,YAAkB,KACjD,MAAKr1D,GAASnE,IAAM7D,GAAe,GAAK+1D,OAKnC/tD,GAAS6H,SAAuC,IAA5B7H,GAAS6H,QAAQrU,QAAc,CACtD,MAAMwqE,EAAcxiC,GAAoB,IAAIvsB,MAEtCgvD,EAAc,CAClBpiE,GAAG,QAADD,OAAUqT,KAAKC,OACjBwJ,cAAe1Y,GAASnE,GACxBic,kBAAmBkmD,EACnBjmD,YAAa,EACb3P,UAAW,GACXsP,cAAe,GACfM,iBAAkBhY,GAASsV,eAAiB,GAC5CsR,aAAc,GACd3O,YAAa,GACbwQ,qBAAsBpuB,GACtB6jE,eAAgBd,GAAgB/iE,IAChCorB,cAAc,IAAIxW,MAAOsY,cACzB42C,eAAgB,KAChBhtD,QAAS,EACTitD,QAAQ,GAGV3B,GAAc,CAACwB,GACjB,GACC,CAACj+D,GAASnE,GAAI7D,GAAc+1D,GAAgB/tD,GAAS6H,QAAS7H,GAASsV,cAAejb,KA7BzF,MA6HMgkE,IAAuB77D,EAAAA,EAAAA,aAAY1R,UAAsB,IAADwtE,EAE5D,GAAK5Y,IAAaprD,OAAOorD,GAAWh+C,WAAW,WAKhB,QAA/B42D,EAAIhZ,GAAiBI,UAAU,IAAA4Y,IAA3BA,EAA6BC,QAIjC,IACE,MAAMprD,QAAiBqrD,EAAAA,GAAAA,GAAoB9Y,EAAWj3D,GAAOC,IAEzDykB,GAAgC,OAApBA,EAASU,QAAmBV,EAASlY,MACnDsqD,GAAoB1zD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACnBD,GAAI,IACP,CAAC6zD,GAAY,CACX+Y,UAAWtrD,EAASlY,KAAKyjE,YAAc,GACvCH,QAAQ,KAIhB,CAAE,MAAOttE,GACP4S,QAAQ5S,MAAM,2EAAyCA,GAEvDs0D,GAAoB1zD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACnBD,GAAI,IACP,CAAC6zD,GAAY,CACX+Y,UAAW,GACXF,QAAQ,KAGd,GACC,CAAC9vE,GAAOC,GAAU42D,KAGfqZ,IAA2Bn8D,EAAAA,EAAAA,aAAY1R,MAAO40D,EAAWkZ,KAE7D,IAAKlZ,GAAaprD,OAAOorD,GAAWh+C,WAAW,SAE7C,OADA7D,QAAQC,KAAK,+EACN,EAGT,IAYE,aAXM+6D,EAAAA,GAAAA,GAAqBnZ,EAAWkZ,EAAenwE,GAAOC,IAG5D62D,GAAoB1zD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACnBD,GAAI,IACP,CAAC6zD,GAAY,CACX+Y,UAAWG,EACXL,QAAQ,OAIL,CACT,CAAE,MAAOttE,GAEP,MADA4S,QAAQ5S,MAAM,sEAAyCA,GACjDA,CACR,GACC,CAACxC,GAAOC,KA4HLowE,GAAoBA,CAACC,EAAWC,KACpC,MAAMC,EAAiB1tE,MAAMC,QAAQwO,GAAS6H,SAAW7H,GAAS6H,QAAU,GAG5E,GAAIk3D,EAAUG,gBAAiB,CAG7B,MAAMC,EAAiBF,EAAeprE,IAAIkU,IACxC,GAAIyQ,OAAOzQ,EAAQlM,MAAQ2c,OAAOwmD,GAAgB,CAwBhD,OAvBaltE,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACRiW,GAAO,IAEV2P,cAAeqnD,EAAUrnD,eAAiB3P,EAAQ2P,cAClDE,mBAAoBmnD,EAAUnnD,oBAAsB7P,EAAQ6P,mBAC5DwnD,6BAA8BL,EAAUK,8BAAgCr3D,EAAQq3D,6BAChFvnD,oBAAqBknD,EAAUlnD,qBAAuB9P,EAAQ8P,oBAC9D+O,aAAcm4C,EAAUlnD,qBAAuB9P,EAAQ6e,aACvD9O,kBAAmBinD,EAAUjnD,mBAAqB/P,EAAQ+P,kBAC1D1P,UAAW22D,EAAU32D,WAAaL,EAAQK,UAC1Ci3D,kBAAmBN,EAAUM,mBAAqBt3D,EAAQs3D,kBAC1DC,OAAQP,EAAUO,QAAUv3D,EAAQu3D,OACpCrnD,YAAa8mD,EAAU9mD,aAAelQ,EAAQkQ,YAC9CD,iBAAkB+mD,EAAU/mD,kBAAoBjQ,EAAQiQ,iBACxDD,YAAa,EACbomD,gBAAgB,IAAIlvD,MAAOsY,cAC3Bg4C,eAAe,EACfC,eAAgBT,EAAUS,eAC1BC,iBAAkBV,EAAUU,iBAC5BC,aAAcX,EAAUW,aACxBC,YAAY,GAIhB,CACA,OAAO53D,IAmBT,OAhBA00D,GAAc0C,GAGdnf,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACPmtB,cAAe+/C,EAAUrnD,eAAiB7lB,EAAKmtB,cAC/C2X,cAAeooC,EAAUnnD,oBAAsB/lB,EAAK8kC,cACpDjR,iBAAkBq5C,EAAUlnD,qBAAuBhmB,EAAK6zB,iBACxDkR,eAAgBmoC,EAAUM,mBAAqBxtE,EAAK+kC,eACpDC,aAAckoC,EAAU32D,WAAavW,EAAKglC,aAC1C+oC,cAAe3wD,KAAKC,cAItBpV,WAAW,IAAMoc,IAAgB,GAAO,IAG1C,CAMA,MAAM2pD,EAAa,CACjBhkE,GAAImjE,EACJtmD,cAAe1Y,GAASnE,GAExB6b,cAAeqnD,EAAUrnD,eAAiB,GAC1CE,mBAAoBmnD,EAAUnnD,oBAAsB,GACpDwnD,6BAA8BL,EAAUK,8BAAgC,GACxEvnD,oBAAqBknD,EAAUlnD,qBAAuB,GACtD+O,aAAcm4C,EAAUlnD,qBAAuB,GAC/CC,kBAAmBinD,EAAUjnD,mBAAqBukB,KAClDj0B,UAAW22D,EAAU32D,WAAa,GAClCi3D,kBAAmBN,EAAUM,mBAAqB,GAClDC,OAAQP,EAAUO,QAAU,GAC5BrnD,YAAa8mD,EAAU9mD,aAAe,GACtCD,iBAAkB+mD,EAAU/mD,mBAAqBzmB,MAAMC,QAAQwO,GAASsV,eAAiBtV,GAASsV,cAAgB,IAClHyC,YAAa,EAEb0Q,qBAAsBpuB,GACtB6jE,eAAgBd,GAAgB/iE,IAChCorB,cAAc,IAAIxW,MAAOsY,cACzB42C,eAAgB,KAChBhtD,QAAS,EACTouD,eAAe,EACfC,eAAgBT,EAAUS,eAC1BC,iBAAkBV,EAAUU,iBAC5BE,YAAY,EAEZxnD,iCAAkC,GAClC9P,yBAA0B,GAC1By3D,0BAA2B,GAIvBX,EAAiB,IAClBF,EAAe9sE,OAAO41B,IAAMztB,OAAOytB,EAAElsB,IAAI6L,WAAW,UACvDm4D,GAGFpD,GAAc0C,GAGdlR,GAAkB4R,GAClB1R,GAAmB0R,GAGnB7f,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACPmtB,cAAe6gD,EAAWnoD,eAAiB,GAC3Cif,cAAekpC,EAAWjoD,oBAAsB,GAChD8N,iBAAkBm6C,EAAWhoD,qBAAuB,GACpD+e,eAAgBipC,EAAWR,mBAAqB,GAChDxoC,aAAcgpC,EAAWz3D,WAAa,GACtCw3D,cAAe3wD,KAAKC,SAMtBpV,WAAW,IAAMoc,IAAgB,GAAO,MA0MpC6pD,IAAgCv9D,EAAAA,EAAAA,aAAY,SAACuF,GAA0B,IAADi4D,EAAAC,EAAA,IAAhBlf,EAAIt0C,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,KACjE,MAAMyzD,EAAgB,KAGjBn4D,EAAQ2P,eAAmD,kBAA1B3P,EAAQ2P,eAA+D,KAAjC3P,EAAQ2P,cAAc3iB,SAChGmrE,EAAc7wD,KAAK,gCAGhBtH,EAAQK,WAAaF,WAAWH,EAAQK,YAAc,IACzD83D,EAAc7wD,KAAK,oBAGhBtH,EAAQ+P,mBAA2D,kBAA9B/P,EAAQ+P,mBAAuE,KAArC/P,EAAQ+P,kBAAkB/iB,SAC5GmrE,EAAc7wD,KAAK,4BAGhBtH,EAAQ6e,cAAiD,kBAAzB7e,EAAQ6e,cAA6D,KAAhC7e,EAAQ6e,aAAa7xB,SAC7FmrE,EAAc7wD,KAAK,oBAWrB,OAPgB0xC,KACL,QAATif,EAAAjf,EAAKvlD,YAAI,IAAAwkE,OAAA,EAATA,EAAWljD,cAAcqjD,SAAS,aACzB,QADkCF,EAC3Clf,EAAKvlD,YAAI,IAAAykE,OAAA,EAATA,EAAWnjD,cAAcqjD,SAAS,aACpB,eAAdpf,EAAKp2D,MAKE,CACLy1E,SAAS,EACTC,OAAO,EACPC,SAAS,EACTJ,cAAeA,EACf7qE,QAAS6qE,EAAc1sE,OAAS,EAC5B,yEACA,+CAKJ0sE,EAAc1sE,OAAS,EAClB,CACL4sE,SAAS,EACTC,OAAO,EACPC,SAAS,EACTJ,cAAeA,EACf7qE,QAAQ,2DAADuG,OAA0CskE,EAAcK,KAAK,QAKjE,CACLH,SAAS,EACTC,OAAO,EACPC,SAAS,EACTJ,cAAe,GACf7qE,QAAS,iCAEb,EAAG,IAQGmrE,IAAiCh+D,EAAAA,EAAAA,aAAY,CAACkjD,EAAW+a,KAE7D,IAAIzB,EAAgBtZ,EAChB+a,GAAkBlvE,MAAMC,QAAQivE,IAAmBA,EAAejtE,OAAS,GAAKitE,EAAe,IAAMA,EAAe,GAAGC,aACzH1B,EAAgByB,EAAe,GAAGC,YAIpC,MAAMC,EAAoBpvE,MAAMC,QAAQivE,IAAmBA,EAAel1D,KAAKu1C,IAC7E,IAAKA,EAAK,OAAO,EACjB,MAAMwZ,EAAcxZ,EAAIwZ,aAAexZ,EAAI8f,aAAe,GAC1D,OAAOtG,EAAYx9C,cAAc5qB,SAAS,YACnCooE,EAAYx9C,cAAc5qB,SAAS,aAI5C8tD,GAAYnuD,IACV,MAAMstE,GAAkBttE,EAAKgW,SAAW,IAAIhU,IAAIk0B,GAE1CA,EAAElsB,KAAO6pD,GAAa39B,EAAElsB,KAAOmjE,GAAiB1kE,OAAOytB,EAAElsB,MAAQvB,OAAO0kE,IAC1EltE,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKi2B,GAAC,IACJlB,YAAa45C,EACbI,YAAaF,IAGV54C,GAGT,OAAAj2B,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYD,GAAI,IAAEgW,QAASs3D,MAI7BjpD,IAAgB,IACf,IAQG4qD,IAA0Bt+D,EAAAA,EAAAA,aAAY1R,UAC1C,IAAK,IAADiwE,EAAAC,EAEF,MAAMj5D,EAA0B,QAAnBg5D,EAAG/gE,GAAS6H,eAAO,IAAAk5D,OAAA,EAAhBA,EAAkBn0D,KAAKmb,GAAKA,EAAElsB,KAAOolE,GACrD,IAAKl5D,EACH,MAAM,IAAIqN,MAAM,gBAADxZ,OAAiBqlE,EAAa,qBAI/C,IAAKl5D,EAAQ2P,cACX,MAAM,IAAItC,MAAM,sCAElB,IAAKrN,EAAQ+P,kBACX,MAAM,IAAI1C,MAAM,uCAElB,IAAKrN,EAAQK,UACX,MAAM,IAAIgN,MAAM,uCAElB,IAAKrN,EAAQiQ,kBAAwD,IAApCjQ,EAAQiQ,iBAAiBxkB,OACxD,MAAM,IAAI4hB,MAAM,6CAIlB,MAAMJ,EAAUhV,GAASnE,IAAMmE,GAASnE,GACxC,IAAKmZ,EACH,MAAM,IAAII,MAAM,6CAIlB,IAAI8rD,EAAgB,GAChBn5D,EAAQiQ,kBAAoBzmB,MAAMC,QAAQuW,EAAQiQ,oBACpDkpD,EAAgBn5D,EAAQiQ,iBAAiBnkB,IAAIqX,GACvB,kBAATA,GAAqBA,EAAKI,UAC5BJ,EAAKI,UAEPJ,IAKX,MAAMi2D,EAAiB,CACrB1yE,SACAC,YACA8oB,SAAUxC,EACV0C,cAAe3P,EAAQ2P,cACvBE,mBAAoB7P,EAAQ+P,kBAC5B1P,UAAWL,EAAQK,UACnByP,oBAAqB9P,EAAQ6e,cAAgB,KAC7C9O,kBAAmB/P,EAAQ+P,kBAC3BC,YAAahQ,EAAQgQ,aAAe,EACpCC,iBAAkB3mB,KAAKuR,UAAUs+D,GACjCjpD,YAAalQ,EAAQkQ,aAAe,KACpCC,iBAAkBnQ,EAAQmQ,kBAAoB,MAI1C/E,QAAiBmE,GAAgB6pD,GAEjCnC,GAA6B,QAAbgC,EAAA7tD,EAASlY,YAAI,IAAA+lE,OAAA,EAAbA,EAAeI,aAAcjuD,EAASiuD,WAC5D,IAAKpC,EACH,MAAM,IAAI5pD,MAAM,kCAiBlB,OAbA4qC,GAAYnuD,IACV,MAAMstE,GAAkBttE,EAAKgW,SAAW,IAAIhU,IAAIk0B,GAC9CA,EAAElsB,KAAOolE,GAAanvE,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAEbi2B,GAAC,IACJlsB,GAAImjE,EACJZ,QAAQ,IAEVr2C,GAEN,OAAAj2B,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYD,GAAI,IAAEgW,QAASs3D,MAGtBH,CAET,CAAE,MAAOloD,GAKP,MAJAjT,QAAQw9D,MAAM,2DACVvqD,EAAI3D,SAERtP,QAAQy9D,WACFxqD,CACR,GACC,CAAC9W,GAAUA,GAASnE,GAAIpN,GAAOC,KAQ5B6yE,IAAkC/+D,EAAAA,EAAAA,aAAY1R,MAAO40D,EAAW8b,KAEhElnE,OAAOorD,GAAWh+C,WAAW,SAMjCwO,IAAgB,IACf,KA2CHrmB,EAAAA,EAAAA,WAAU,KAMR,MAAMgY,EAAU7H,GAAS6H,SAAW,GAEpC,GAAI7H,GAASnE,IACU,IAAnBgM,EAAQrU,SACP8nE,IACDtjE,IAAgB,EAAG,CAErB,MAAMgmE,EAAcxiC,GAAoB,IAAIvsB,MACtC5U,EAAU4J,SAASvB,aAAagB,QAAQ,WAAY,IAEpD+9D,EAAe,CACnB5lE,GAAG,QAADD,OAAUqT,KAAKC,OACjBwJ,cAAe1Y,GAASnE,GACxBic,kBAAmBkmD,EACnBjmD,YAAa,EACb3P,UAAW,GACXsP,cAAe,GACfM,iBAAkBzmB,MAAMC,QAAQwO,GAASsV,eAAiBtV,GAASsV,cAAgB,GACnF2C,YAAa,GACb2O,aAAc,GACd6B,qBAAsBpuB,EACtB6jE,eAAgBd,GAAgB/iE,GAChCorB,cAAc,IAAIxW,MAAOsY,cACzB42C,eAAgB,KAChBhtD,QAAS,EACTitD,QAAQ,EAERjmD,iCAAkC,GAClC9P,yBAA0B,GAC1By3D,0BAA2B,GAI7BrD,GAAc,CAACgF,IACfxT,GAAkBwT,GAClBtT,GAAmB,CACjBr2C,kBAAmBkmD,EACnBjmD,YAAa,EACb3P,UAAW,GACXsP,cAAe,GACfM,iBAAkBhY,GAASsV,eAAiB,GAC5C2C,YAAa,GACb2O,aAAc,GAEdzO,iCAAkC,GAClC9P,yBAA0B,GAC1By3D,0BAA2B,GAE/B,GACC,CAAC9/D,GAASnE,GAAoB,QAAlBw6C,EAAEr2C,GAAS6H,eAAO,IAAAwuC,OAAA,EAAhBA,EAAkB7iD,OAAQ8nE,GAAmBtjE,KA2B9D,MAAM0pE,GAAsB5wE,UAK1B,GAAIkP,GAASnE,GACX,OAAO,EAIT,MAAM8R,EAAWyrC,GAAAA,QAAaC,cAG9B,GAFqBS,KAAuC,KAAjB,OAARnsC,QAAQ,IAARA,OAAQ,EAARA,EAAUmsC,YAG3C,OAAO,EAIT,GAAI95C,GAAS2kB,UAAkC,0BAAtB3kB,GAAS2kB,SAChC,OAAO,EAIT,MACMvE,EADY,IAAI44B,gBAAgBp/C,OAAOi/C,SAASI,QACxBE,IAAI,QAClC,GAAI/4B,EACF,OAAO,EAITu6B,IAAoB,GAEpB,IAEE,MAAMqX,QAAwB9pC,EAAAA,GAAAA,IAAqBz5B,GAAOC,IACpDujE,EAAaD,EAAgB3pC,mBAAqB2pC,EAAgB5pC,qBAAuB4pC,EAAgB1pC,YAE/G,IAAK2pC,EACH,MAAM,IAAI78C,MAAM,sCAIlB,QAAIpV,GAASnE,IAAMi+C,KAAuC,KAAjB,OAARnsC,QAAQ,IAARA,OAAQ,EAARA,EAAUmsC,aAAuB15B,KAIlE4/B,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP8yB,SAAUstC,MAGL,EACT,CAAE,MAAOhhE,GAWP,OARA+uD,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP8yB,SAAU,QAIH,OAATkzB,SAAS,IAATA,IAAAA,GAAYmc,GAAmB,gGAAiE,SAAU,CAAErpE,KAAM,WAE3G,CACT,CAAC,QAECgwD,IAAoB,EACtB,GAqFIgnB,GAA+B7wE,eAAOsqC,EAAapmB,GAAiC,IAAxB4sD,EAAUn1D,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,IAAAA,UAAA,GAE1EorC,IAAaA,GAAU,6EAADj8C,OAAqCw/B,EAAW,+CAA+B,WAGrGstB,IAAoB,GACpBh9B,GAAgB,GAChBk9B,GAAoB,kCAGpB,MAAMiZ,EAAgB7sD,EACtB,GAAI6sD,GAAiBpzE,IAASC,KAAakzE,EACzC,UACQE,EAAAA,GAAAA,IAAc,CAAErzE,SAAOC,YAAUsmB,QAAS6sD,GAClD,CAAE,MAAO5wE,GACP4S,QAAQC,KAAK,iDAAgC7S,EAAMoE,QAErD,CAEF4sD,IAAa,GAGb,MAAM8f,EAAkB3oB,GAAAA,QAAa4oB,cAAc,CACjD5yD,SAAU,IACV6yD,WAAaC,IACXx2C,GAAgBw2C,IAElBC,WAAYA,KAEN/mC,GAAe/gC,IACjB++C,GAAAA,QAAagpB,YAAY,CAAEC,iBAAkBjnC,IAK/C0nB,GAAoB,CAClBhJ,YAAY,EACZ9kC,QAAS,KACTomB,YAAa,KAIfyjB,IAAc,GAGd/kD,WAAW,KAET69C,GAAS,iBAAkB,CAAEvlC,SAAS,IAGtCs2C,IAAoB,GACpBh5D,IAAY,IACX,OAMPkK,OAAO0oE,uBAAyBP,CAClC,EAMMQ,GAAyBzxE,MAAOkkB,EAASomB,EAAaonC,EAAkBC,EAAkBziE,KAC9F,IAEE,GAAIyiE,GAAoBD,IAAqBC,EAE3C,YADA5+D,QAAQ42B,IAAI,6FAQd,IAAIioC,EAAmB,KAKvB,MAAMC,EAAiBxzC,GAAiBqzC,EAAkB,yBACpDI,IAAiBH,GAAmBtzC,GAAiBszC,EAAkB,yBAEzEE,IAAmBC,IACrBF,EAAmB,4BAGf1iE,EAASob,mBAETpb,EAASqb,YAETrb,EAASwnB,iBAOf,MAAMmoC,EAAexgC,GAAiBqzC,EAAkB,aAClDK,IAAeJ,GAAmBtzC,GAAiBszC,EAAkB,aAErEK,EAAe3zC,GAAiBqzC,EAAkB,aAClDO,IAAeN,GAAmBtzC,GAAiBszC,EAAkB,cAEtE9S,IAAiBkT,GAAkBC,IAAiBC,KACvDL,EAAmB/S,EAAe,yBAA2B,yBAIzD3vD,EAASqjB,cAETrjB,EAASob,mBAITpb,EAASqb,aAAerb,EAASwnB,iBACjCvjB,SAASjE,EAASqb,eAAiBpX,SAASjE,EAASwnB,kBAC9CxnB,EAASqb,aAKtB,MAAM2nD,EAAY7zC,GAAiBqzC,EAAkB,WAC/CS,IAAYR,GAAmBtzC,GAAiBszC,EAAkB,WAEpEO,IAAcC,IAChBP,EAAmB,uBAGf1iE,EAASqjB,cAETrjB,EAASob,oBAOf,MAAM8nD,EAAc/zC,GAAiBqzC,EAAkB,YACjDW,IAAcV,GAAmBtzC,GAAiBszC,EAAkB,YAEtES,IAAgBC,IAClBT,EAAmB,yBASrB,MAAMU,EAAej0C,GAAiBqzC,EAAkB,aAClDa,IAAeZ,GAAmBtzC,GAAiBszC,EAAkB,aAEvEW,IAAiBC,IACnBX,EAAmB,0BAarB,MAAMpxC,EAAgBnC,GAAiBqzC,EAAkB,cACnDc,IAAgBb,GAAmBtzC,GAAiBszC,EAAkB,cAExEnxC,IAAkBgyC,IACpBZ,EAAmB,mCAQrB,MAAMa,EAAkBp0C,GAAiBqzC,EAAkB,gBACrDgB,IAAkBf,GAAmBtzC,GAAiBszC,EAAkB,gBAE1Ec,IAAoBC,IACtBd,EAAmB,6BASrB,MAAMe,EAAet0C,GAAiBqzC,EAAkB,aAClDkB,IAAejB,GAAmBtzC,GAAiBszC,EAAkB,aAEvEgB,IAAiBC,IACnBhB,EAAmB,6BAQrB,MAAMiB,EAAoBx0C,GAAiBqzC,EAAkB,mBACvDoB,IAAoBnB,GAAmBtzC,GAAiBszC,EAAkB,mBAE5EkB,IAAsBC,IACxBlB,EAAmB,8BAWrB,MAAMmB,EAAmB10C,GAAiBqzC,EAAkB,iBACtDsB,IAAmBrB,GAAmBtzC,GAAiBszC,EAAkB,iBAE3EoB,IAAqBC,IACvBpB,EAAmB,mCAYrB,MAAMqB,EAAe50C,GAAiBqzC,EAAkB,aAClDwB,IAAevB,GAAmBtzC,GAAiBszC,EAAkB,aAEvEsB,IAAiBC,IACnBtB,EAAmB,0BAOrB,MAAMuB,EAAa90C,GAAiBqzC,EAAkB,WAChD0B,IAAazB,GAAmBtzC,GAAiBszC,EAAkB,WASzE,GAPIwB,IAAeC,IACjBxB,EAAmB,wBAGrB7+D,QAAQ42B,IAAI,sEAA0DioC,IAGjEA,EAEH,YADA7+D,QAAQ42B,IAAI,4GAId52B,QAAQ42B,IAAI,gHACZ52B,QAAQ42B,IAAI,wBAAoBioC,GAChC7+D,QAAQ42B,IAAI,sBAAkBzlB,GAC9BnR,QAAQ42B,IAAI,6BAAyBpgC,IACrCwJ,QAAQ42B,IAAI,yEAiBd,CAAE,MAAOxpC,GACP4S,QAAQ5S,MAAM,mFAA8DA,EAE9E,GAmEIkzE,GAAiBrzE,iBAA8C,IAAvCszE,EAAyB33D,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,IAAAA,UAAA,GAErD,IAAKhe,KAAUC,GAEb,YADAmpD,IAAaA,GAAUmc,GAAmB,6EAAgD,SAAU,CAAErpE,KAAM,WAK9G,IAAK8yE,GAAez9D,GAAS2kB,UAE3B,YADAkzB,IAAaA,GAAU,+GAAkE,CAAEltD,KAAM,aAOnG,MAAM05E,EAAkE,IAA5CrkE,GAAS0mB,iCAAoF,IAA5C1mB,GAAS0mB,+BAChF49C,GAA+B,OAAf3iB,SAAe,IAAfA,QAAe,EAAfA,GAAiBxyB,iBAAiBnvB,GAASukB,kBAAmB,gBAAgB,EAEpG,GAAI8/C,IAAwBC,IAAkB5mB,KAA8B0mB,EAK1E,OAFAvgE,QAAQ42B,IAAI,oGACZgjB,IAAoC,GAWtC,GANA7jD,OAAO2qE,wBAAyB,EAGhC70E,IAAY,GAGRoyD,GAAiB,CAEnB,IAGE,MAAMvD,EAAY,CAAC,EAGflkD,KAASkkD,EAAU71B,YAAiC,kBAAZruB,GAAuB4J,SAAS5J,GAAS,IAAMA,IACvF2F,GAASqjB,gBAAek7B,EAAUl7B,cAAkD,kBAA3BrjB,GAASqjB,cAA6Bpf,SAASjE,GAASqjB,cAAe,IAAMrjB,GAASqjB,eAC/IrjB,GAASrE,UAAS4iD,EAAU5iD,QAAUqE,GAASrE,SAC/CqE,GAASob,qBAAoBmjC,EAAUnjC,mBAAqBpb,GAASob,oBACrEpb,GAASqb,cAAakjC,EAAUljC,YAAcrb,GAASqb,aACvDrb,GAASmI,iBAAgBo2C,EAAUp2C,eAAiBnI,GAASmI,gBAC7DnI,GAASwb,sBAAqB+iC,EAAU/iC,oBAAsBxb,GAASwb,qBACvExb,GAASm2B,WAAUooB,EAAUpoB,SAAWn2B,GAASm2B,UAGjDn2B,GAASsV,eAAiBtV,GAASsV,cAAc9hB,OAAS,IAC5D+qD,EAAUjpC,cAAgB9J,GAA6BxL,GAASsV,gBAI9DtV,GAAS4L,qBACX2yC,EAAU/wC,YAAcjB,GAA+BvM,GAAUwM,KAI/DxM,GAAS6kB,kBAAiB05B,EAAU15B,gBAAkB7kB,GAAS6kB,iBAC/D7kB,GAASukB,oBAAmBg6B,EAAUh6B,kBAAoBvkB,GAASukB,mBACnEvkB,GAASwkE,kBAAiBjmB,EAAUimB,gBAAkBxkE,GAASwkE,iBAG/DxkE,GAASykE,uBAAsBlmB,EAAUkmB,qBAAuBzkE,GAASykE,sBACzEzkE,GAASuoB,eAAcg2B,EAAUh2B,aAAevoB,GAASuoB,cACzDvoB,GAAS0kE,qBAAoBnmB,EAAUmmB,mBAAqB1kE,GAAS0kE,oBAGrE1kE,GAASkmB,+BAA8Bq4B,EAAUr4B,6BAA+BlmB,GAASkmB,8BACzFlmB,GAASmmB,gCAA+Bo4B,EAAUp4B,8BAAgCnmB,GAASmmB,+BAC3FnmB,GAAS2kE,2BAA0BpmB,EAAUomB,yBAA2B3kE,GAAS2kE,0BAGjF3kE,GAASyb,oBAAsBzb,GAASyb,mBAAmBjoB,OAAS,IACtE+qD,EAAU53B,QAAU3mB,GAASyb,mBAAmB5nB,IAAIsqB,IAAO,CACzDG,MAAOH,EAAQG,OAAS,GAExBC,aAAcrW,YAAYiW,EAAQI,cAAgB,KAAKpjB,WAAWiX,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,EACjH8iC,UAAWjxC,SAASka,EAAQ+2B,YAAc,GAC1C12B,WAAYtW,YAAYiW,EAAQK,YAAc,KAAKrjB,WAAWiX,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,EAC7GykD,SAAU14C,EAAQ04C,UAAY,KAC9BC,WAAY34C,EAAQ24C,YAAc,KAClCC,aAAc54C,EAAQ44C,cAAgB,KACtC5gC,SAAUhY,EAAQgY,UAAY,KAE9ByuC,MAAOzmD,EAAQymD,MAAQ3gE,SAASka,EAAQymD,OAAS,SAMrD,MAUMC,EAVmBC,MACvB,MAAM51D,EAAM,IAAID,KACV2sB,EAAO1sB,EAAI2sB,cACXC,EAAQxhC,OAAO4U,EAAI6sB,WAAa,GAAGC,SAAS,EAAG,KAC/CC,EAAM3hC,OAAO4U,EAAIgtB,WAAWF,SAAS,EAAG,KACxC+oC,EAAQzqE,OAAO4U,EAAI81D,YAAYhpC,SAAS,EAAG,KAC3CipC,EAAU3qE,OAAO4U,EAAIg2D,cAAclpC,SAAS,EAAG,KAC/CmpC,EAAU7qE,OAAO4U,EAAIk2D,cAAcppC,SAAS,EAAG,KACrD,MAAM,GAANpgC,OAAUggC,EAAI,KAAAhgC,OAAIkgC,EAAK,KAAAlgC,OAAIqgC,EAAG,KAAArgC,OAAImpE,EAAK,KAAAnpE,OAAIqpE,EAAO,KAAArpE,OAAIupE,IAEhCL,GACxBvmB,EAAUz4B,cAAgB++C,QAGCQ,EAAAA,GAAAA,IAAcrlE,GAASnE,GAAI0iD,EAAW9vD,GAAOC,IAKxE,GAHAmpD,IAAaA,GAAU,iFAADj8C,OAA2CoE,GAAS4kB,kBAAoB,iBAAa,0CAAsB,WAG7H5kB,GAASnE,IAAMmE,GAASnE,GAAI,CAC9B,MAAMypE,QAAuBnwD,EAAAA,GAAAA,YAAWlR,SAASjE,GAASnE,IAAMmE,GAASnE,IAAKpN,GAAOC,IAAU,GAE7E,OAAd42E,QAAc,IAAdA,GAAAA,EAAgBzpE,KAElBmkD,GAAYnuD,IACV,MAAM0zE,GAAWzzE,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACZD,GACAyzE,GAML,OAFApkB,GAAoB1nD,QAAUnI,KAAKC,MAAMD,KAAKuR,UAAU2iE,IAEjDA,IAIT1R,GAAUyR,EAAgB,CACxBnN,kBAAkB,EAClBve,aAAc0rB,EAAezpE,GAC7BmmD,WAAW,IAGjB,CACF,CAAE,MAAO/wD,GACP4mD,IAAaA,GAAU,UAADj8C,OAAW3K,EAAMoE,SAAW,CAAE1K,KAAM,SAC5D,CAAC,QACC+E,IAAY,GACZ26D,IAAiB,EACnB,CAEA,MACF,CAIA,IADgBmb,KAId,YADA91E,IAAY,GAKd,MAIM+1E,GAJczlE,GAASyb,oBAAsB,IAAI2d,OAAO,CAACmjC,EAAKrxD,IAClEqxD,GAAOr0D,WAAWgD,EAAKsT,aAAe,GAAI,IAE3BtW,WAAWlI,GAASmI,iBAAmB,GAGxD,GAAIs9D,EAAW,EAab,OAZA5tB,IAAaA,GAAU,iEAADj8C,OAC2B6pE,EAASC,eAAe,SAAQ,yEAC/E,CAAE/6E,KAAM,UAIN4xB,GAAckD,SAChBy6B,GAAiBroD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUD,GAAI,IAAE4tB,SAAS,UAIhD/vB,IAAY,GAId,IAAK,IAADi2E,EAAAC,EAAAC,EAAAC,EAAAC,EACF1b,IAAiB,GAIjB,MAAMya,EAAmBA,KACvB,MAAM51D,EAAM,IAAID,KACV2sB,EAAO1sB,EAAI2sB,cACXC,EAAQxhC,OAAO4U,EAAI6sB,WAAa,GAAGC,SAAS,EAAG,KAC/CC,EAAM3hC,OAAO4U,EAAIgtB,WAAWF,SAAS,EAAG,KACxC+oC,EAAQzqE,OAAO4U,EAAI81D,YAAYhpC,SAAS,EAAG,KAC3CipC,EAAU3qE,OAAO4U,EAAIg2D,cAAclpC,SAAS,EAAG,KAC/CmpC,EAAU7qE,OAAO4U,EAAIk2D,cAAcppC,SAAS,EAAG,KACrD,MAAM,GAANpgC,OAAUggC,EAAI,KAAAhgC,OAAIkgC,EAAK,KAAAlgC,OAAIqgC,EAAG,KAAArgC,OAAImpE,EAAK,KAAAnpE,OAAIqpE,EAAO,KAAArpE,OAAIupE,IAKlDa,EAAeA,KACnB,MAAM92D,EAAM,IAAID,KACV2sB,EAAO1sB,EAAI2sB,cACXC,EAAQxhC,OAAO4U,EAAI6sB,WAAa,GAAGC,SAAS,EAAG,KAC/CC,EAAM3hC,OAAO4U,EAAIgtB,WAAWF,SAAS,EAAG,KAC9C,MAAM,GAANpgC,OAAUggC,EAAI,KAAAhgC,OAAIkgC,EAAK,KAAAlgC,OAAIqgC,IAIvB88B,EAAyB,OAAVpqE,SAAU,IAAVA,IAAiB,QAAPg3E,EAAVh3E,GAAYqqE,aAAK,IAAA2M,OAAP,EAAVA,EAAmBp6D,KAAK0tD,GAA0B,eAAlBA,EAAKC,UACpDC,EAAoB,OAAVxqE,SAAU,IAAVA,IAAiB,QAAPi3E,EAAVj3E,GAAYqqE,aAAK,IAAA4M,OAAP,EAAVA,EAAmBr6D,KAAK0tD,GAA0B,kBAAlBA,EAAKC,UAC/C+M,EAAmBlN,GAAgBI,EAIzC,IAAIljC,GAAenkC,EAAAA,EAAAA,GAAA,GAAQkO,IAK3B,GAFAygD,GAAY,OAAQ,kBAAmB,mBAAmB,sBAAD7kD,OAAwBoE,GAASgI,2BAA0B,kBAAApM,OAAiBoE,GAASkmB,6BAA4B,cAAAtqB,OAAavB,KAE1I,IAAxC2F,GAASgI,6BAA4E,IAAxChI,GAASgI,4BACtDhI,GAASkmB,+BACV7rB,GAMFomD,GAAY,UAAW,kBAAmB,gBAAgB,gFAN/C,CACX,MAAMnxC,EAAYw1D,IAClB7uC,EAAgB/P,6BAA+B7rB,GAC/C47B,EAAgB9P,8BAAgC7W,EAChDmxC,GAAY,OAAQ,kBAAmB,cAAc,oEAAD7kD,OAAoDvB,GAAO,gBAAAuB,OAAe0T,GAChI,CAKA,MAAMivC,EAAY,CAAC,EAGnB,GAAIlkD,GAAS,CAEX,MAAM6rE,EAAsC,kBAAZ7rE,GAAuB4J,SAAS5J,GAAS,IAAMA,GAC/EkkD,EAAU71B,YAAcw9C,EACxBzlB,GAAY,OAAQ,OAAQ,cAAc,0BAAD7kD,OAA4BsqE,EAAgB,2BAAAtqE,cAAyBvB,GAAO,KACvH,MACEomD,GAAY,QAAS,OAAQ,sBAAuB,kCAWtD,GAPIzgD,GAASrE,UAAS4iD,EAAU5iD,QAAUqE,GAASrE,SAC/CqE,GAASob,qBAAoBmjC,EAAUnjC,mBAAqBpb,GAASob,oBACrEpb,GAASqb,cAAakjC,EAAUljC,YAAcrb,GAASqb,cAKtD88C,IAAoB99D,GAAS,CAEhC,MAAM8rE,EAAwC,kBAAZ9rE,GAAuB4J,SAAS5J,GAAS,IAAMA,GACjFkkD,EAAUl7B,cAAgB8iD,EAC1B1lB,GAAY,OAAQ,OAAQ,gBAAgB,4BAAD7kD,OAA8BuqE,EAAkB,4BAC7F,MAAO,GAAIhO,IAAoBn4D,GAASqjB,cAAe,CAErD,MAAM8iD,EAAuD,kBAA3BnmE,GAASqjB,cAA6Bpf,SAASjE,GAASqjB,cAAe,IAAMrjB,GAASqjB,cACxHk7B,EAAUl7B,cAAgB8iD,EAC1B1lB,GAAY,OAAQ,OAAQ,0BAA0B,8BAAD7kD,OAA6BuqE,EAAkB,2BACtG,CA4BA,GAzBInmE,GAASsV,eAAiBtV,GAASsV,cAAc9hB,OAAS,IAC5D+qD,EAAUjpC,cAAgB9J,GAA6BxL,GAASsV,eAChEmrC,GAAY,OAAQ,OAAQ,uBAAuB,mBAAD7kD,OAAgBvK,KAAKuR,UAAU5C,GAASsV,eAAc,QAAA1Z,OAAOvK,KAAKuR,UAAU27C,EAAUjpC,kBAGtItV,GAASmI,iBAAgBo2C,EAAUp2C,eAAiBnI,GAASmI,gBAGjEo2C,EAAUz5B,kBAAoB1Z,QAAQpL,GAAS8kB,mBAC/C27B,GAAY,OAAQ,OAAQ,oBAAoB,oCAAD7kD,OAAwBoE,GAAS8kB,kBAAiB,QAAAlpB,OAAO2iD,EAAUz5B,oBAK9G9kB,GAAS4L,oBACX2yC,EAAU/wC,YAAcjB,GAA+BvM,GAAUwM,IACjEi0C,GAAY,OAAQ,OAAQ,yBAAyB,sBAAD7kD,OAAkBvK,KAAKuR,UAAU27C,EAAU/wC,iBAG/F+wC,EAAU/wC,YAAc,KACxBizC,GAAY,UAAW,OAAQ,oBAAqB,iEAKlDzgD,GAASwb,oBAAqB,CAChC,MAAM85C,EAAUP,GAAuBnoD,KAAKC,GACzCA,EAAIvB,WAAauB,EAAIvB,YAActL,GAASwb,qBAC5C3O,EAAI1B,KAAO0B,EAAI1B,MAAQnL,GAASwb,qBAChC3O,EAAIjb,OAASib,EAAIjb,QAAUoO,GAASwb,qBAGjC4qD,EAAoB,CACxB96D,WAAkB,OAAPgqD,QAAO,IAAPA,OAAO,EAAPA,EAAShqD,aAAoB,OAAPgqD,QAAO,IAAPA,OAAO,EAAPA,EAASnqD,OAAc,OAAPmqD,QAAO,IAAPA,OAAO,EAAPA,EAAS1jE,QAASoO,GAASwb,oBAC5E1O,aAAoB,OAAPwoD,QAAO,IAAPA,OAAO,EAAPA,EAASxoD,eAAsB,OAAPwoD,QAAO,IAAPA,OAAO,EAAPA,EAASxlE,SAAgB,OAAPwlE,QAAO,IAAPA,OAAO,EAAPA,EAAS7pE,QAASuU,GAASwb,qBAGpF+iC,EAAU/iC,oBAAsBnqB,KAAKuR,UAAUwjE,GAC/C3lB,GAAY,OAAQ,OAAQ,iBAAiB,qCAAD7kD,OAAoCoE,GAASwb,oBAAmB,QAAA5f,OAAO2iD,EAAU/iC,qBAC/H,MAEE+iC,EAAU/iC,oBAAsB,KAChCilC,GAAY,OAAQ,OAAQ,aAAc,8EAKlB0X,IAAoBn4D,GAASnE,GAKjDmE,GAASyb,oBAAsBzb,GAASyb,mBAAmBjoB,OAAS,GACtE+qD,EAAU53B,QAAU3mB,GAASyb,mBAAmB5nB,IAAIsqB,IAAO,CACzDG,MAAOH,EAAQG,OAAS,GAExBC,aAAcrW,YAAYiW,EAAQI,cAAgB,KAAKpjB,WAAWiX,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,EACjH8iC,UAAWjxC,SAASka,EAAQ+2B,YAAc,GAC1C12B,WAAYtW,YAAYiW,EAAQK,YAAc,KAAKrjB,WAAWiX,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,EAE7GykD,SAAU14C,EAAQ04C,UAAY,KAC9BC,WAAY34C,EAAQ24C,YAAc,KAClCC,aAAc54C,EAAQ44C,cAAgB,KACtC5gC,SAAUhY,EAAQgY,UAAY,KAE9ByuC,MAAOzmD,EAAQymD,MAAQ3gE,SAASka,EAAQymD,OAAS,QAGnDnkB,GAAY,OAAQ,OAAQ,oBAAoB,2DAAD7kD,OAAkD5D,GAAY,OAAA4D,OAAMoE,GAASyb,mBAAmBjoB,OAAM,iEAGrJ+qD,EAAU53B,QAAU,GACpB85B,GAAY,UAAW,OAAQ,gBAAgB,mDAAD7kD,OAAuC5D,GAAY,0CAE1FA,IAAgB,GAAKgI,GAASyb,oBAAsBzb,GAASyb,mBAAmBjoB,OAAS,GAElG+qD,EAAU53B,QAAU3mB,GAASyb,mBAAmB5nB,IAAIsqB,IAAO,CACzDG,MAAOH,EAAQG,OAAS,GACxBC,aAAcrW,YAAYiW,EAAQI,cAAgB,KAAKpjB,WAAWiX,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,EACjH8iC,UAAWjxC,SAASka,EAAQ+2B,YAAc,GAC1C12B,WAAYtW,YAAYiW,EAAQK,YAAc,KAAKrjB,WAAWiX,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,EAC7GykD,SAAU14C,EAAQ04C,UAAY,KAC9BC,WAAY34C,EAAQ24C,YAAc,KAClCC,aAAc54C,EAAQ44C,cAAgB,KACtC5gC,SAAUhY,EAAQgY,UAAY,KAC9ByuC,MAAOzmD,EAAQymD,MAAQ3gE,SAASka,EAAQymD,OAAS,QAEnDnkB,GAAY,OAAQ,OAAQ,2BAA2B,2DAAD7kD,OAAkD5D,GAAY,OAAA4D,OAAMoE,GAASyb,mBAAmBjoB,OAAM,mBAE5JitD,GAAY,OAAQ,OAAQ,eAAe,uDAAD7kD,OAA2C5D,KAInFgI,GAASq1C,sBACXkJ,EAAUpoB,SAAWn2B,GAASq1C,oBAC9BoL,GAAY,OAAQ,OAAQ,eAAe,8CAAD7kD,OAAkCoE,GAASq1C,oBAAoB7hD,OAAM,iBAMjH+qD,EAAUpmC,iCAAmCnY,GAASmY,kCAAoC,GAC1FomC,EAAUl2C,yBAA2BrI,GAASqI,0BAA4B,GAE1E,MAAMg+D,EAAsBpwC,EAAgBjuB,2BAC5Cu2C,EAAUv2C,2BAAsD,IAAxBq+D,IAAqD,IAAxBA,EAAgC,EAAI,EAGzG9nB,EAAUr4B,6BAA+B+P,EAAgB/P,8BAAgC,KACzFq4B,EAAUp4B,8BAAgC8P,EAAgB9P,+BAAiC,KAG3Fs6B,GAAY,OAAQ,kBAAmB,YAAY,oDAAD7kD,OAAwC2iD,EAAUv2C,2BAA0B,gBAAApM,OAAe2iD,EAAUpmC,iCAAgC,iBAAAvc,OAAgB2iD,EAAUl2C,yBAAwB,eAAAzM,OAAc2iD,EAAUr4B,6BAA4B,SAAAtqB,OAAQ2iD,EAAUp4B,gCAG3SnmB,GAASw/C,iCAAgCjB,EAAUiB,+BAAiCx/C,GAASw/C,gCAC7Fx/C,GAASy/C,eAAclB,EAAUkB,aAAez/C,GAASy/C,cACzDz/C,GAAS0/C,SAAQnB,EAAUmB,OAAS1/C,GAAS0/C,QAG7C1/C,GAASs/C,eAAcf,EAAUe,aAAet/C,GAASs/C,cACzDt/C,GAASjQ,kBAAiBwuD,EAAUxuD,gBAAkBiQ,GAASjQ,iBAC/DiQ,GAAS/P,mBAAkBsuD,EAAUtuD,iBAAmB+P,GAAS/P,kBACjE+P,GAAS7P,gBAAeouD,EAAUpuD,cAAgB6P,GAAS7P,eAC3D6P,GAAS3P,gBAAekuD,EAAUluD,cAAgB2P,GAAS3P,eAC3D2P,GAASzP,uBAAsBguD,EAAUhuD,qBAAuByP,GAASzP,sBAGzEyP,GAASvP,0BAAyB8tD,EAAU9tD,wBAA0BuP,GAASvP,yBAC/EuP,GAASrP,0BAAyB4tD,EAAU5tD,wBAA0BqP,GAASrP,yBAC/EqP,GAASnP,4BAA2B0tD,EAAU1tD,0BAA4BmP,GAASnP,2BAGnFmP,GAASsmE,mBAAkB/nB,EAAU+nB,iBAAmBtmE,GAASsmE,kBACjEtmE,GAASumE,mBAAkBhoB,EAAUgoB,iBAAmBvmE,GAASumE,kBACjEvmE,GAASwmE,qBAAoBjoB,EAAUioB,mBAAqBxmE,GAASwmE,oBAGrExmE,GAASq/C,kBAAiBd,EAAUc,gBAAkBr/C,GAASq/C,iBAC/Dr/C,GAASymE,WAAUloB,EAAUkoB,SAAWzmE,GAASymE,UAGjDzmE,GAAS8J,SAAW9J,GAAS8J,QAAQtW,OAAS,IAChD+qD,EAAUz0C,QAAU9J,GAAS8J,SAS3B9J,GAASuoB,eAAcg2B,EAAUh2B,aAAevoB,GAASuoB,cAK7B,cAA5BvoB,GAASye,eAEX8/B,EAAU5iC,mBAAqB,GACtB3b,GAAS2b,qBAElB4iC,EAAU5iC,mBAAqB3b,GAAS2b,oBAK1C,IAAI+qD,EAAiBz3C,GAAoBjvB,GAASukB,mBAI9CyO,EAAiB,IAAI0zC,GAGzB,MAAMC,EAAa3mE,GAASnE,IAAMmE,GAASnE,GAG3C,GAAK8qE,GAkBC3zC,EAAe9gC,SAAS,SAAqC,IAA1B8gC,EAAex/B,QAA2C,IAA1Bw/B,EAAex/B,QAAsC,SAAtBw/B,EAAe,MACnHA,EAAiBA,EAAe7gC,OAAO2xB,GAAW,SAANA,GACvCkP,EAAe9gC,SAAS,2BAC3B8gC,EAAe3jB,KAAK,yBACpBoxC,GAAY,OAAQ,OAAQ,qBAAsB,6EAtBvC,CACfztB,EAAiB,GAMM,cAFAhzB,GAASye,gBAI9BuU,EAAiB,CAAC,aAClBytB,GAAY,OAAQ,OAAQ,eAAgB,0DAG5CztB,EAAiB,CAAC,yBAClBytB,GAAY,OAAQ,OAAQ,eAAgB,qEAEhD,CAaA,MAAMmmB,EAAiB5mE,GAASye,eAET,cAAnBmoD,GAEF5zC,EAAiBA,EAAe7gC,OAAO2xB,IAAM,CAAC,wBAAyB,UAAW,aAAa5xB,SAAS4xB,IACnGkP,EAAe9gC,SAAS,eAC3B8gC,EAAe3jB,KAAK,aACpBoxC,GAAY,OAAQ,OAAQ,kBAAmB,mCAErB,gBAAnBmmB,GAGT5zC,EAAiBA,EAAe7gC,OAAO2xB,IAAM,CAAC,wBAAyB,UAAW,aAAa5xB,SAAS4xB,IACnGkP,EAAe9gC,SAAS,eAC3B8gC,EAAe3jB,KAAK,aACpBoxC,GAAY,OAAQ,OAAQ,kBAAmB,mCAErB,YAAnBmmB,IAET5zC,EAAiBA,EAAe7gC,OAAO2xB,IAAM,CAAC,wBAAyB,YAAa,aAAa5xB,SAAS4xB,IACrGkP,EAAe9gC,SAAS,aAC3B8gC,EAAe3jB,KAAK,WACpBoxC,GAAY,OAAQ,OAAQ,kBAAmB,iCAQnD,MAAMomB,GAAmC,OAAdH,QAAc,IAAdA,OAAc,EAAdA,EAAgBx0E,SAAS,gBAAgB,EAC9D40E,EAAuC,cAAnBF,IAAmCC,GAEzD7zC,EAAe9gC,SAAS,cACvB8N,GAAS+kB,eACT/kB,GAAS2e,iBACTqU,EAAe9gC,SAAS,iBACxB40E,IAEH9zC,EAAe3jB,KAAK,gBACpBoxC,GAAY,OAAQ,OAAQ,kBAAmB,wGAK7CzgD,GAAS+kB,gBAAkB/kB,GAAS2e,iBAEtCqU,EAAiB,CAAC,YAAa,YAC/BytB,GAAY,OAAQ,OAAQ,iBAAkB,kFACpCzgD,GAAS+kB,eAAiBiO,EAAe9gC,SAAS,cAE5D8gC,EAAiB,CAAC,aAClBytB,GAAY,OAAQ,OAAQ,iBAAkB,0DAI5CzgD,GAAS2e,iBACNqU,EAAe9gC,SAAS,aAC3B8gC,EAAe3jB,KAAK,WACpBoxC,GAAY,OAAQ,OAAQ,kBAAmB,gCAGjDztB,EAAiBA,EAAe7gC,OAAO2xB,IAAM,CAAC,eAAgB,WAAY,aAAa5xB,SAAS4xB,KAGhGkP,EAAiBA,EAAe7gC,OAAO2xB,GAAW,YAANA,GAI9C,MAAMijD,EAA0E,SAAhB,QAAnClB,EAAA7lE,GAAS6b,kCAA0B,IAAAgqD,OAAA,EAAnCA,EAAqC9+C,YACP,cAA/B/mB,GAASo2B,kBAwBrC,GAvBI2wC,IAAyB/mE,GAAS2e,gBAC/BqU,EAAe9gC,SAAS,eAC3B8gC,EAAe3jB,KAAK,aACpBoxC,GAAY,OAAQ,OAAQ,kBAAmB,kEAEvCsmB,IAEV/zC,EAAiBA,EAAe7gC,OAAO2xB,IACpC,CAAC,YAAa,YAAa,cAAe,aAAc,YAAa,kBAAmB,gBAAiB,aAAa5xB,SAAS4xB,IAElI28B,GAAY,OAAQ,OAAQ,iBAAkB,2GAa5CztB,EAAe9gC,SAAS,eAAiB8N,GAAS2e,gBAAiB,EACd,IAA/B3e,GAASkc,mBAA6D,IAA/Blc,GAASkc,mBAIjE8W,EAAe9gC,SAAS,eAE3B8gC,EAAiBA,EAAe7gC,OAAO2xB,GAAW,gBAANA,GAA6B,eAANA,GACnEkP,EAAe3jB,KAAK,aACpBoxC,GAAY,OAAQ,OAAQ,kBAAmB,6DAI7CztB,EAAe9gC,SAAS,cAAgB8N,GAASgc,eAAiBhc,GAASic,eAE7E+W,EAAiBA,EAAe7gC,OAAO2xB,GAAW,cAANA,GAEvCkP,EAAe9gC,SAAS,gBAC3B8gC,EAAe3jB,KAAK,cACpBoxC,GAAY,OAAQ,OAAQ,kBAAmB,mIAKnDztB,EAAiBA,EAAe7gC,OAAO2xB,GAAW,cAANA,GAA2B,eAANA,GAC5DkP,EAAe9gC,SAAS,iBAC3B8gC,EAAe3jB,KAAK,eACpBoxC,GAAY,OAAQ,OAAQ,kBAAkB,wDAAD7kD,OAAkDoE,GAASkc,kBAAiB,OAGtH8W,EAAe9gC,SAAS,eAC3B8gC,EAAe3jB,KAAK,aACpBoxC,GAAY,OAAQ,OAAQ,kBAAmB,iHAGrD,CAGKztB,EAAe9gC,SAAS,eAAgB8N,GAAS2e,kBACpDqU,EAAiBA,EAAe7gC,OAAO2xB,IAAM,CAAC,YAAa,cAAe,cAAc5xB,SAAS4xB,IACjG28B,GAAY,OAAQ,OAAQ,kBAAmB,0FAIjD,MAAMhtB,EAAuD,cAAb,QAApBqyC,EAAA9lE,GAASwN,mBAAW,IAAAs4D,OAAA,EAApBA,EAAsB7+C,QAC5CyM,EAA4E,cAAb,QAAnCqyC,EAAA/lE,GAAS6b,kCAA0B,IAAAkqD,OAAA,EAAnCA,EAAqC9+C,QACjE8J,EAAa0C,GAAuBC,EAItC3C,IACCiC,EAAe9gC,SAAS,aACxB8gC,EAAe9gC,SAAS,cACxB8gC,EAAe9gC,SAAS,eACxB8gC,EAAe9gC,SAAS,kBACxB8N,GAAS2e,kBACPqU,EAAe9gC,SAAS,qBAC3B8gC,EAAe3jB,KAAK,mBACpBoxC,GAAY,OAAQ,OAAQ,kBAAmB,wIAM9C1vB,GAAc/wB,GAAS6H,SAAW7H,GAAS6H,QAAQrU,OAAS,IAAMwM,GAAS2e,kBAEzEqU,EAAe9gC,SAAS,eAC3B8gC,EAAe3jB,KAAK,aACpBoxC,GAAY,OAAQ,OAAQ,kBAAmB,qEAI7CztB,EAAe9gC,SAAS,eAAiB8gC,EAAe9gC,SAAS,qBACnE8gC,EAAe3jB,KAAK,mBACpBoxC,GAAY,OAAQ,OAAQ,kBAAmB,4EASnD,IAHgCzgD,GAAS6H,SAAW,IAAIrU,OAAS,IAC9DwM,GAAS6H,SAAW,IAAIoD,MAAM8c,GAAqC,IAAhCA,EAAE+3C,4BAAmE,IAAhC/3C,EAAE+3C,6BAE9C9/D,GAAS2e,gBACjCqU,EAAe9gC,SAAS,mBAC3B8gC,EAAe3jB,KAAK,iBACpBoxC,GAAY,OAAQ,OAAQ,kBAAkB,gCAAD7kD,OAAwBoE,GAAS6H,QAAQrU,OAAM,oHAEzF,CAGL,MAAMswE,EAAmB9wC,EAAe9gC,SAAS,iBAEjD,GADA8gC,EAAiBA,EAAe7gC,OAAO2xB,GAAW,kBAANA,GACxCggD,EAAkB,CACpB,MAAMkD,GAAsBhnE,GAAS6H,SAAW,IAAI1V,OAAO41B,KAAuC,IAAhCA,EAAE+3C,4BAAmE,IAAhC/3C,EAAE+3C,4BAAqCtsE,OAC9IitD,GAAY,OAAQ,OAAQ,kBAAkB,uDAAD7kD,OAA0CorE,EAAkB,oFAC3G,CACF,CAKA,MAAMC,EAAmE,IAA5CjnE,GAAS0mB,iCAAoF,IAA5C1mB,GAAS0mB,+BAEjFwgD,EAA4Bl0C,EAAe9gC,SAAS,iBAEtD+0E,GAAwBC,IAA8BlnE,GAAS2e,iBAC5DqU,EAAe9gC,SAAS,eAC3B8gC,EAAe3jB,KAAK,aACpBoxC,GAAY,OAAQ,OAAQ,kBAAmB,iFAI5CzgD,GAASumB,cACZg4B,EAAUh4B,YAAclsB,GACxBkkD,EAAU/3B,aAAes+C,IACzBrkB,GAAY,OAAQ,OAAQ,YAAY,6DAAD7kD,OAA+CvB,OAIxF24B,EAAiBA,EAAe7gC,OAAO2xB,GAAW,cAANA,GAK9CkP,EAAiB,IAAI,IAAIhE,IAAIgE,IAI7BA,EAAiBA,EAAe7gC,OAAO2xB,GAAW,gBAANA,GAGd,IAA1BkP,EAAex/B,SACjBw/B,EAAiB,CAAC,QAClBytB,GAAY,UAAW,OAAQ,oBAAqB,gDAItD,MAAM0mB,EAAgB,CACpB,OAAQ,wBAAyB,UAAW,YAAa,YACzD,eAAgB,WAAY,UAAW,YAAa,YAAa,cAAe,aAAc,YAAa,kBAAmB,gBAAiB,aAajJ,GAVAn0C,EAAeigC,KAAK,CAACvhD,EAAGwhD,KACtB,MAAMkU,EAASD,EAAcE,QAAQ31D,GAC/B41D,EAASH,EAAcE,QAAQnU,GACrC,QAAoB,IAAZkU,EAAgB,IAAMA,KAAuB,IAAZE,EAAgB,IAAMA,KAGjE/oB,EAAUh6B,kBAAoBlzB,KAAKuR,UAAUowB,GAIzCA,EAAex/B,OAAS,EAAG,CAC7B,MAAM+zE,EAAmBv0C,EAAeA,EAAex/B,OAAS,GAG1Dg0E,EAAiBrS,GAAiBoS,GAExC,GAAIC,EAEFjpB,EAAU15B,gBAAkB2iD,EAAe13E,MAC3C2wD,GAAY,OAAQ,OAAQ,kBAAkB,sCAAD7kD,OAAmC2iD,EAAU15B,gBAAe,+CAAAjpB,OAAmC2rE,EAAgB,UACvJ,CAEL,MAAME,EAAgBttD,GAAgBotD,GACtChpB,EAAU15B,gBAAkB4iD,EAAgBA,EAAcjsE,KAAO+rE,EACjE9mB,GAAY,UAAW,OAAQ,2BAA2B,gDAAD7kD,OAA6B2rE,EAAgB,+BAAA3rE,OAAyB2iD,EAAU15B,gBAAe,KAC1J,CACF,MACE05B,EAAU15B,gBAAkB,UAC5B47B,GAAY,UAAW,OAAQ,2BAA4B,kEAQtB/zC,IAAnC1M,GAAS+lB,wBAAqCw4B,EAAUx4B,sBAAwB/lB,GAAS+lB,uBAIzF/lB,GAASgc,eAAiBhc,GAASic,aAEhCjc,GAASgmB,aAKZu4B,EAAUv4B,aAAehmB,GAASgmB,cAJlCu4B,EAAUv4B,aAAe3rB,GACzBomD,GAAY,OAAQ,OAAQ,mBAAmB,sCAAD7kD,OAAwCvB,WAKrDqS,IAA1B1M,GAASgmB,eAElBu4B,EAAUv4B,aAAehmB,GAASgmB,cAGhChmB,GAASimB,0BAAyBs4B,EAAUt4B,wBAA0BjmB,GAASimB,yBAGnFs4B,EAAUr4B,kCAAyExZ,IAA1C1M,GAASkmB,6BAA6ClmB,GAASkmB,6BAA+B,KACvIq4B,EAAUp4B,8BAAgCnmB,GAASmmB,+BAAiC,KAGhFnmB,GAAS6H,SAAW7H,GAAS6H,QAAQrU,OAAS,GAAKw/B,EAAe9gC,SAAS,cAE7EqsD,EAAUl4B,aAAehsB,GACzBkkD,EAAUj4B,mBAAqBw+C,IAC/BrkB,GAAY,OAAQ,OAAQ,qBAAqB,iCAAD7kD,OAAgCvB,GAAO,0BAAAuB,OAAyB2iD,EAAUj4B,4BAG5F5Z,IAA1B1M,GAASqmB,eAA4Bk4B,EAAUl4B,aAAermB,GAASqmB,cACvErmB,GAASsmB,qBAAoBi4B,EAAUj4B,mBAAqBtmB,GAASsmB,qBAI3Ei4B,EAAUh4B,iBAAuC7Z,IAAzB1M,GAASumB,YAA4BvmB,GAASumB,YAAc,KACpFg4B,EAAU/3B,aAAexmB,GAASwmB,cAAgB,KAClD+3B,EAAU93B,wBAAqD/Z,IAAhC1M,GAASymB,mBAAmCzmB,GAASymB,mBAAqB,GAEzG,MAAMihD,EAAiB1nE,GAAS0mB,+BAehC,GAdA63B,EAAU73B,+BAAqD,IAAnBghD,IAA2C,IAAnBA,EAA2B,EAAI,EAEnGjnB,GAAY,OAAQ,OAAQ,kBAAkB,8CAAD7kD,OAAgD2iD,EAAUx4B,sBAAqB,gBAAAnqB,OAAe2iD,EAAUv4B,aAAY,sBAAApqB,OAAqB2iD,EAAUr4B,6BAA4B,gBAAAtqB,OAAe2iD,EAAUl4B,aAAY,eAAAzqB,OAAc2iD,EAAUh4B,cAGrRvmB,GAAS2e,kBACP3e,GAAS2/C,qBAAoBpB,EAAUoB,mBAAqB3/C,GAAS2/C,oBACrE3/C,GAAS4/C,iBAAgBrB,EAAUqB,eAAiB5/C,GAAS4/C,iBAO/D5/C,GAAS+kB,eAAiB/kB,GAAS2e,gBAAiB,CAItD,IAF0B8T,IAexB,IAVKzyB,GAASolB,eAAiB/qB,IAC7BkkD,EAAUn5B,cAAgB/qB,GAC1BomD,GAAY,OAAQ,OAAQ,0BAA0B,sCAAD7kD,OAAgCvB,GAAO,uCACnF2F,GAASolB,gBAElBm5B,EAAUn5B,cAAgBplB,GAASolB,cACnCq7B,GAAY,OAAQ,OAAQ,+BAA+B,8CAAD7kD,OAAqCoE,GAASolB,iBAItGplB,GAAS+kB,gBAAkB/kB,GAAS2e,gBAAiB,CAEvD,GAAK3e,GAASklB,YAMZq5B,EAAUr5B,YAAcllB,GAASklB,YACjCu7B,GAAY,OAAQ,OAAQ,0BAA0B,6CAAD7kD,OAAoCoE,GAASklB,kBAPzE,CACzB,MAAMyiD,EAAgB3nE,GAAS0b,gBAAkBsqD,IACjDznB,EAAUr5B,YAAcyiD,EACxBlnB,GAAY,OAAQ,OAAQ,qBAAqB,kCAAD7kD,OAAiC+rE,GACnF,CAKAppB,EAAU3iC,sBAAwB,EACpC,MAEK,GAAI5b,GAAS2e,gBAAiB,CAEjC,GAAK3e,GAASklB,YAMZq5B,EAAUr5B,YAAcllB,GAASklB,YACjCu7B,GAAY,OAAQ,OAAQ,wBAAwB,wDAAD7kD,OAA+CoE,GAASklB,kBAPlF,CACzB,MAAM0iD,EAAc5nE,GAASulB,cAAgBygD,IAC7CznB,EAAUr5B,YAAc0iD,EACxBnnB,GAAY,OAAQ,OAAQ,mBAAmB,6CAAD7kD,OAA4CgsE,GAC5F,CAKI5nE,GAAS4b,wBAAuB2iC,EAAU3iC,sBAAwB5b,GAAS4b,uBAE/E6kC,GAAY,OAAQ,OAAQ,eAAe,uCAAD7kD,OAA+BoE,GAAS4b,uBACpF,OAGI5b,GAASolB,gBAAem5B,EAAUn5B,cAAgBplB,GAASolB,eAC3DplB,GAASklB,cAAaq5B,EAAUr5B,YAAcllB,GAASklB,aACvDllB,GAAS4b,wBAAuB2iC,EAAU3iC,sBAAwB5b,GAAS4b,uBAC/E6kC,GAAY,OAAQ,OAAQ,kBAAkB,yEAElD,MAGElC,EAAUn5B,cAAgB,KAC1Bq7B,GAAY,OAAQ,OAAQ,mBAAmB,kFAQjD,GAFqBimB,EAAex0E,SAAS,cAAgB8gC,EAAe9gC,SAAS,aAEnE,CAIhB,IAF2BipE,GAEJ,CAErB,MAAM0M,EAAgB7nE,GAAS6b,4BAA8B,CAAC,EAGxDisD,EAAa,CACjB/gD,UAHgB8gD,EAAc9gD,WAAa,KAI3CC,QAASz1B,MAAMC,QAAQq2E,EAAc7gD,SAAW6gD,EAAc7gD,QAAU,GACxEC,OAAQ4gD,EAAc5gD,QAAU,IAGlCs3B,EAAU1iC,2BAA6BxqB,KAAKuR,UAAUklE,GAEtDrnB,GAAY,OAAQ,OAAQ,+BAA+B,0CAAD7kD,OAA+B2iD,EAAU1iC,4BACrG,MAEM7b,GAAS+nE,oCACXxpB,EAAU1iC,2BAA6B7b,GAAS+nE,oCACvC/nE,GAAS6b,6BAElB0iC,EAAU1iC,2BAA6BxqB,KAAKuR,UAAU5C,GAAS6b,6BAEjE4kC,GAAY,OAAQ,OAAQ,6BAA6B,+CAE7D,MAEEA,GAAY,OAAQ,OAAQ,2BAA2B,qCAKzD,GAAIzgD,GAAS+b,aAAc,CAEzB,MAAMisD,EAAiB1tE,OAAO0F,GAAS+b,cACnCisD,EAAe91E,SAAS,KAE1BqsD,EAAUxiC,aAAeisD,EAAe1iD,MAAM,KAAK,GAAGlT,QAAQ,IAAK,KAAKA,QAAQ,IAAK,IAErFmsC,EAAUxiC,aAAeisD,CAE7B,CACA,GAAIhoE,GAASgc,cAAe,CAC1B,MAAMisD,EAAkB3tE,OAAO0F,GAASgc,eACpCisD,EAAgB/1E,SAAS,KAC3BqsD,EAAUviC,cAAgBisD,EAAgB3iD,MAAM,KAAK,GAAGlT,QAAQ,IAAK,KAAKA,QAAQ,IAAK,IAEvFmsC,EAAUviC,cAAgBisD,CAE9B,CACIjoE,GAASic,eAAcsiC,EAAUtiC,aAAejc,GAASic,cAQ7D,MAAM4oD,EAAkBC,IAyGxB,IAAI/zE,EACAikB,EACAomB,EACA8sC,EAKJ,GAhHA3pB,EAAUz4B,cAAgB++C,EAErB1M,GAGH1X,GAAY,OAAQ,OAAQ,cAAc,6DAAD7kD,OAAyDipE,IAFlGpkB,GAAY,OAAQ,OAAQ,kBAAkB,0CAAD7kD,OAAsCipE,IAMhF7xC,EAAe9gC,SAAS,SAEvB8N,GAASwnB,iBAAmBxnB,GAASwnB,gBAAkB,IACzD+2B,EAAU/2B,gBAAkBxnB,GAASwnB,iBASrCxnB,GAAS6H,SAAW7H,GAAS6H,QAAQrU,OAAS,GAChD+qD,EAAU12C,QAAU7H,GAAS6H,QAAQhU,IAAI,CAACkU,EAASqW,KAAW,IAAD+pD,EAC3D,IAAIC,EAAiB,GACjBrgE,EAAQiQ,kBAAoBzmB,MAAMC,QAAQuW,EAAQiQ,mBAAqBjQ,EAAQiQ,iBAAiBxkB,OAAS,IAE3G40E,EAAiBrgE,EAAQiQ,iBAAiBnkB,IAAIqX,GACxB,kBAATA,GAAqBA,EAAKI,UAC5BJ,EAAKI,UAEPJ,IA+DX,MArDoB,CAClBrP,GAJgBkM,EAAQlM,KAAOvB,OAAOyN,EAAQlM,IAAI6L,WAAW,SACjC8Q,OAAOzQ,EAAQlM,IAAM,KAIjDuM,UAAW9N,OAAO4N,WAAWH,EAAQK,YAAc,GACnDsP,cAAe3P,EAAQ2P,eAAiB,GACxCK,YAAa,EACbH,mBAAoB7P,EAAQ6P,qBAAsB,IAAI3I,MAAOsY,cAAcjC,MAAM,KAAK,GACtFzN,oBAAqB9P,EAAQ6e,cAAgB7e,EAAQ8P,qBAAuB,GAC5EC,kBAAyD,kBAA9B/P,EAAQ+P,mBAAkC/P,EAAQ+P,kBAAkBuwD,MAAM,uBACjGtgE,EAAQ+P,mBACR,IAAI7I,MAAOsY,cAAcjC,MAAM,KAAK,GACxCtN,iBAAkBowD,EAClBnwD,YAAalQ,EAAQkQ,aAAe,GAEpCE,iCAAkCpQ,EAAQoQ,kCAAoC,GAC9E9P,yBAA0BN,EAAQM,0BAA4B,GAC9Dy3D,0BAAkE,IAAtC/3D,EAAQ+3D,4BAAyE,IAAtC/3D,EAAQ+3D,0BAAsC,EAAI,EACzH55C,6BAA8Bne,EAAQme,8BAAgC,KACtEC,8BAA+Bpe,EAAQoe,+BAAiC,KACxEjO,iBAAkBnQ,EAAQ84D,YACtB,CAEEyH,WAAY,WACZC,gBAAiB,CACf/iD,gBAAiBzd,EAAQ0d,eAAgB,IAAIxW,MAAOsY,cACpD4O,SAAUpuB,EAAQkQ,aAAe,GACjCuwD,eAAkC,QAAnBL,EAAApgE,EAAQ8e,mBAAW,IAAAshD,OAAA,EAAnBA,EAAqB30E,SAAU,EAC9Ci1B,qBAAsB1gB,EAAQ0gB,qBAC9By1C,eAAgBn2D,EAAQm2D,iBAG5Bn2D,EAAQ43D,YAAc53D,EAAQy3D,eAC5B,CAEE8I,WAAY,UACZG,MAAO,CACLzpD,cAAejX,EAAQ2P,cACvBgxD,gBAAiB3gE,EAAQ6P,mBACzB8N,iBAAkB3d,EAAQ8P,oBAC1Bgf,aAAc9uB,EAAQK,UACtBwuB,eAAgB7uB,EAAQs3D,kBACxBsJ,WAAY5gE,EAAQu3D,OACpB34C,QAAS5e,EAAQy3D,eACjBjgD,UAAWxX,EAAQ03D,mBAGvB,CAEE6I,WAAY,cAQxB7nB,GAAY,OAAQ,OAAQ,oBAAoB,mBAAD7kD,OAAaoE,GAAS6H,QAAQrU,OAAM,uBACnFitD,GAAY,OAAQ,OAAQ,iBAAiB,mBAAD7kD,OAAqBvK,KAAKuR,UAAU5C,GAAS6H,QAAS,KAAM,OAExG02C,EAAU12C,QAAU,GACpB44C,GAAY,OAAQ,OAAQ,gBAAiB,+CAa1CkmB,EAykBE,CAAC,IAADiC,EAAAC,EAAAC,EAEL,MAAMC,EAAiB/oE,GAASukB,kBAEhCk8B,GAAY,OAAQ,UAAW,eAAe,uBAAD7kD,OAAyBoE,GAASnE,GAAE,MAO7E0iD,EAAU12C,SAAW02C,EAAU12C,QAAQrU,OAG3CzC,QAAes0E,EAAAA,GAAAA,IAAcrlE,GAASnE,GAAI0iD,EAAW9vD,GAAOC,IAE5D+xD,GAAY,OAAQ,UAAW,iBAAiB,SAAD7kD,OAAWoE,GAASnE,GAAE,aAIrE4kD,GAAY,OAAQ,cAAe,kBAAmB,CACpDzrC,QAASjkB,EAAO8K,GAChBu/B,YAAarqC,EAAO6zB,kBAAoB7zB,EAAO4zB,SAC/CqkD,SAAUj4E,EAAOwzB,kBACjB0kD,YAAah0E,OAAOC,KAAKnE,GAAQyC,OACjCmzB,SAAuB,QAAdiiD,EAAA73E,EAAO41B,eAAO,IAAAiiD,OAAA,EAAdA,EAAgBp1E,SAAU,EACnCqU,SAAuB,QAAdghE,EAAA93E,EAAO8W,eAAO,IAAAghE,OAAA,EAAdA,EAAgBr1E,SAAU,IAMrC,IACE,MAAM4nC,EAAcp7B,GAAS2kB,UAAY3kB,GAAS4kB,kBAAoB5kB,GAASnE,SAGzE0mE,GAAuBviE,GAASnE,GAAIu/B,EAAarqC,EAAOwzB,kBAAmBwkD,EAAgB/oE,IAGjG,MAAM2iE,EAAiBxzC,GAAiBp+B,EAAOwzB,kBAAmB,yBAC5Dq+C,IAAiBmG,GAAiB55C,GAAiB45C,EAAgB,yBAEzE,GAAIpG,IAAmBC,EAErB,IAEE,MAAMsG,GAAkBlpE,GAASsV,eAAiB,IAAIzhB,IAAIsX,IACxD,MAAMg+D,EAAYr0B,GAAiBloC,KAAKC,GAAOA,EAAIjb,QAAUuZ,GAC7D,OAAOg+D,EAAYA,EAAU19E,MAAQ0f,UAGjCi+D,EAAAA,GAAAA,qBACJ,4BACAppE,GAASnE,GACTxB,IAAW2F,GAASqjB,cACpB,CACEgmD,aAAcjuC,EACdkuC,cAAetpE,GAASrE,SAAW,GACnC4tE,aAAcvpE,GAASqb,YACvBmuD,UAAWxpE,GAASob,mBACpBquD,WAAYzpE,GAASqjB,cACrBqmD,cAAe1pE,GAASjQ,iBAAmB,YAC3C45E,iBAAkBt4E,KAAKuR,UAAU27C,EAAU/wC,aAAe,CAAC,GAC3Do8D,gBAAiBV,EACjBW,mBAAoB7pE,GAASmI,gBAAkB,EAC/C2hE,UAAW9pE,GAAS8kB,oBAAqB,IAG7C27B,GAAY,UAAW,eAAgB,eAAe,0DAAD7kD,OAAyDw/B,GAChH,CAAE,MAAO2uC,GACPtpB,GAAY,UAAW,eAAgB,gBAAgB,sCAAD7kD,OAAmCmuE,EAAa10E,SACxG,CAEJ,CAAE,MAAO20E,GACT,CAGA,MAAM9B,EAA2Bn3E,EAC3Bk5E,EAAqBl5E,EAAOwzB,kBAQ5B2lD,GALa/6C,GAAiB86C,EAAoB,YACtC96C,GAAiB86C,EAAoB,WAI7Bl1B,GAA+BhkD,IAGrDm5E,EAAkB50D,eAAiB/jB,MAAMC,QAAQ04E,EAAkB50D,iBACrE40D,EAAkB50D,cAAgBs/B,GAChCs1B,EAAkB50D,cAClBw/B,KAKJ,MAAMq1B,GAAgBr4E,EAAAA,EAAAA,GAAA,GACjBo4E,GAGLzpB,GAAY,UAAW,SAAU,mBAAmB,qCAAD7kD,QAAkE,QAA9BktE,EAAAqB,EAAiB70D,qBAAa,IAAAwzD,OAAA,EAA9BA,EAAgCvI,KAAK,QAAS,OAAM,kBAAA3kE,OAAiBuuE,EAAiBv+D,oBAAsB,SAInM,MAAMyY,EAAiB,MACrB,IACE,MAAMC,EAAa/yB,MAAMC,QAAQy4E,GAC7BA,EACA54E,KAAKC,MAAM24E,GAAsB,YAC/BG,EAAc9lD,EAAWA,EAAW9wB,OAAS,GAC7CixB,EAAWtK,GAAgBiwD,GACjC,OAAe,OAAR3lD,QAAQ,IAARA,OAAQ,EAARA,EAAUjpB,OAAQ4uE,GAAe,SAC1C,CAAE,MAAO34E,GACP,MAAO,SACT,CACD,EAXsB,GAsBvB,GARA04E,EAAiBtlD,gBAAkBR,EAQ/B8lD,EAAiBtuD,4BAAqF,kBAAhDsuD,EAAiBtuD,2BAAyC,CAClH,MAAMqL,EAASijD,EAAiBtuD,2BAMhC,GAHAsuD,EAAiBpC,oCAAsC12E,KAAKuR,UAAUskB,QAG7Cxa,IAArBwa,EAAOH,UACTojD,EAAiBtuD,2BAA6B,CAC5CkL,UAAWG,EAAOH,WAAa,KAC/BC,QAASz1B,MAAMC,QAAQ01B,EAAOF,SAAWE,EAAOF,QAAU,GAC1DC,OAAQC,EAAOD,QAAU,IAE3Bw5B,GAAY,OAAQ,SAAU,yBAAyB,iFAAD7kD,OACYvK,KAAKuR,UAAUunE,EAAiBtuD,mCAG/F,QAAyBnP,IAArBwa,EAAOC,UACdgjD,EAAiBtuD,2BAA6B,CAC5CkL,UAAWG,EAAOC,UAAY,MAAQ,KACtCH,QAASE,EAAOrK,QAAUqK,EAAOE,kBAAoB,GACrDH,OAAQC,EAAOD,QAAUC,EAAOpL,eAAiB,IAEnD2kC,GAAY,OAAQ,SAAU,0BAA0B,wEAAD7kD,OACUvK,KAAKuR,UAAUunE,EAAiBtuD,mCAG9F,QAAsBnP,IAAlBwa,EAAOrK,aAA2CnQ,IAAnBwa,EAAOF,QAAuB,CACpE,MAAMF,KAAiBqjD,EAAiBpuD,eAAgBouD,EAAiBpkD,uBACzEokD,EAAiBtuD,2BAA6B,CAC5CkL,UAAWD,EAAc,MAAQ,KACjCE,QAASE,EAAOF,SAAWE,EAAOrK,QAAUqK,EAAOE,kBAAoB,GACvEH,OAAQC,EAAOD,QAAUC,EAAOpL,eAAiB,IAEnD2kC,GAAY,OAAQ,SAAU,+BAA+B,0EAAD7kD,OACavK,KAAKuR,UAAUunE,EAAiBtuD,6BAC3G,CACF,CAGA,MAAM6L,EAAyByiD,EAAiBtiE,cAAgBkI,QAAQ4X,IACtEwiD,EAAiBtiE,QAAQhU,IAAI/C,UAA0B,IAADu5E,EAEpD,MAAMtL,EAA0C,QAAjCsL,EAAGC,EAAcpyD,wBAAgB,IAAAmyD,OAAA,EAA9BA,EAAgC5B,MAGlD,IAAI8B,EAAkB,GACtB,IACMh5E,MAAMC,QAAQ84E,EAActyD,kBAC9BuyD,EAAkBD,EAActyD,iBACmB,kBAAnCsyD,EAActyD,mBAC9BuyD,EAAkBl5E,KAAKC,MAAMg5E,EAActyD,kBAAoB,OAIjEuyD,EAAkBA,EAAgB12E,IAAIqX,GAChB,kBAATA,EACFA,EAGFA,EAAKI,WAAaJ,EAAKtZ,OAASsZ,EAAKrP,IAAMqP,EAItD,CAAE,MAAOzZ,GACP84E,EAAkB,EACpB,CAGA,IAAI1jD,EAAc,GAClB,GAAIyjD,EAAczuE,KAAOvB,OAAOgwE,EAAczuE,IAAI6L,WAAW,SAC3D,IAAK,IAAD8iE,EACF,MAAM3iD,QAAuBC,EAAAA,GAAAA,IAC3BwiD,EAAczuE,GACdnN,GACAD,GACAuR,GAASnE,IAEXgrB,GAAiC,QAAnB2jD,EAAA3iD,EAAe5sB,YAAI,IAAAuvE,OAAA,EAAnBA,EAAqB3jD,cAAegB,EAAe5sB,MAAQ,GACzE4I,QAAQ42B,IAAI,sEAAD7+B,OAAgD0uE,EAAczuE,GAAE,KAAKgrB,EAClF,CAAE,MAAO/P,GACPjT,QAAQ5S,MAAM,wFAAD2K,OAAyD0uE,EAAczuE,GAAE,KAAKib,EAC7F,CAGF,OAAAhlB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKw4E,GAAa,IAEhBvyD,YAAauyD,EAAcxyD,kBAAoB,EAAI,EACnD8O,aAAc0jD,EAAc1jD,eAAiB0jD,EAAczyD,oBAAsByyD,EAAczyD,oBAAoByN,MAAM,KAAK,GAAK,IACnItN,iBAAkBuyD,EAElB1jD,YAAaA,EAEb/O,kBAAmBwyD,EAAcxyD,kBACjCD,oBAAqByyD,EAAczyD,oBACnCD,mBAAoB0yD,EAAc1yD,oBAE9BmnD,EAAY,CACdS,eAAgBT,EAAUp4C,QAC1B84C,iBAAkBV,EAAUx/C,UAC5BogD,YAAY,GACV,CAAC,MAGP,GAKJ3f,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GACAs4E,GAAgB,IAEnB5lD,kBAAmB0lD,EAEnB5mD,cAAexxB,EAAKwxB,eAAiB8mD,EAAiB9mD,cACtDtR,MAAOlgB,EAAKkgB,OAASo4D,EAAiBp4D,MACtCuJ,MAAOzpB,EAAKypB,OAAS6uD,EAAiB7uD,MACtCuH,QAAShxB,EAAKgxB,SAAWsnD,EAAiBtnD,QAE1Chb,QAAS6f,EAAuBl0B,OAAS,EAAIk0B,EAAyB71B,EAAKgW,WAG7E44C,GAAY,UAAW,SAAU,mBAAmB,sCAAD7kD,OAAqCquE,EAAkB,gBAAAruE,OAAeuuE,EAAiB70D,cAAcirD,KAAK,QAI7J,IAAK,IAADkK,EACF,MAAMnF,QAAuBnwD,EAAAA,GAAAA,YAAWnV,GAASnE,GAAIpN,GAAOC,IAAU,GAEtE,GAAkB,OAAd42E,QAAc,IAAdA,GAA2B,QAAbmF,EAAdnF,EAAgB93D,mBAAW,IAAAi9D,GAA3BA,EAA6B5X,UAAYthE,MAAMC,QAAQ8zE,EAAe93D,YAAYqlD,UAAW,CAC/F,MAAMC,EAAYwS,EAAe93D,YAAYqlD,SAC1Ch/D,IAAI66D,IAAE,CACL7yD,GAAI6yD,EAAG7yD,GACPsP,IAAKujD,EAAGG,UAAYH,EAAGvjD,KAAG,KAAAvP,OAAS8yD,EAAG7yD,IACtC/L,MAAO4+D,EAAG5+D,OAAS,eACnBijE,UAAWrE,EAAGqE,UACdjE,MAAOJ,EAAGI,OAASJ,EAAGK,cACtBC,QAASN,EAAGM,SAAWN,EAAGO,iBAC1BC,MAAOR,EAAGQ,OAASR,EAAGS,eACtB6D,IAAKtE,EAAGsE,IACRvnE,MAAM,GAADmQ,OAAK8yD,EAAGG,UAAYH,EAAGvjD,KAAG,KAAAvP,OAAS8yD,EAAG7yD,IAAI,OAAAD,OAAM8yD,EAAG5+D,OAAS,mBAElEmjE,KAAK,CAACvhD,EAAGwhD,IAAMxhD,EAAE5hB,MAAMqjE,cAAcD,EAAEpjE,MAAO,OAEjD0+D,GAAqBsE,GACrBrS,GAAY,UAAW,SAAU,sBAAsB,4CAAD7kD,OAAyCk3D,EAAUt/D,QAC3G,MACEitD,GAAY,UAAW,SAAU,qBAAsB,mDAE3D,CAAE,MAAOiqB,GACPjqB,GAAY,QAAS,SAAU,2BAA2B,qCAAD7kD,OAAkC8uE,EAAYr1E,SACzG,CAGA,GAAI2K,GAASgM,eAAiBhU,IAAgB,EAC5C,UACQ2yE,EAAAA,GAAAA,IAAqB,CACzBl8E,SACAC,YACAsd,cAAehM,GAASgM,gBAE1By0C,GAAY,UAAW,UAAW,cAAc,iDAAD7kD,OAA8BoE,GAASgM,cAAa,4BACrG,CAAE,MAAO/a,GACPwvD,GAAY,UAAW,UAAW,iBAAiB,8CAAD7kD,OAAiC3K,EAAMoE,SAE3F,CAIFuE,OAAO2qE,wBAAyB,EAGhC1iB,KAGAF,GAAgB7tB,kBAIhB,MAyBMkD,EAzB6B,SAAC4zC,EAAaC,GAC/C,OAAKA,EACD17C,GAAiBy7C,EAAa,cAE9Bz7C,GAAiBy7C,EAAa,iBAFqB,GAInDz7C,GAAiBy7C,EAAa,mBAA2B,EACzDz7C,GAAiBy7C,EAAa,aAAqB,EAGnDz7C,GAAiBy7C,EAAa,cAAsB,EAGpDz7C,GAAiBy7C,EAAa,eAAuB,EAGrDz7C,GAAiBy7C,EAAa,aAAqB,EAEnDz7C,GAAiBy7C,EAAa,aAAqB,EACnDz7C,GAAiBy7C,EAAa,YAAoB,EAClDz7C,GAAiBy7C,EAAa,cAAgBz7C,GAAiBy7C,EAAa,gBAAwB,EACpGz7C,GAAiBy7C,EAAa,0BAA4Bz7C,GAAiBy7C,EAAa,WAAmB,EACxG,EArBY,CAsBrB,CAEiBE,CAA2Bb,EAAoBE,EAAiBtuE,IAAMmE,GAASnE,GAAIsuE,GACpG1pB,GAAY,OAAQ,SAAU,kBAAkB,+DAAD7kD,OAAoCo7B,EAAQ,mBAAAp7B,OAAkBquE,IAM7G,IAAK,IAADc,EACF3xB,GAAAA,QAAaI,eAAen/C,IAK5B,MAAM2wE,GAAel5E,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAChBo2E,GACAiC,GAAgB,IAEnB1uD,mBAAoBysD,EAAyBzsD,oBAAsB,GACnE5T,QAAS6f,EAAuBl0B,OAAS,EAAIk0B,EAAyBwgD,EAAyBrgE,SAAW,GAE1Gwb,cAAe6kD,EAAyB7kD,eAAiB8mD,EAAiB9mD,cAC1EtR,MAAOm2D,EAAyBn2D,OAASo4D,EAAiBp4D,MAC1DuJ,MAAO4sD,EAAyB5sD,OAAS6uD,EAAiB7uD,MAC1DuH,QAASqlD,EAAyBrlD,SAAWsnD,EAAiBtnD,QAG9DjX,mBAAoBu+D,EAAiBv+D,oBAAsB5L,GAAS4L,oBAAsBs8D,EAAyBt8D,mBACnHG,OAAQo+D,EAAiBp+D,QAAU/L,GAAS+L,QAAUm8D,EAAyBn8D,OAC/EC,cAAem+D,EAAiBn+D,eAAiBhM,GAASgM,eAAiBk8D,EAAyBl8D,cACpGC,iBAAkBk+D,EAAiBl+D,kBAAoBjM,GAASiM,kBAAoBi8D,EAAyBj8D,iBAC7GC,uBAAwBi+D,EAAiBj+D,wBAA0BlM,GAASkM,wBAA0Bg8D,EAAyBh8D,uBAC/HC,sBAAuBg+D,EAAiBh+D,uBAAyBnM,GAASmM,uBAAyB+7D,EAAyB/7D,sBAC5HC,uBAAwB+9D,EAAiB/9D,wBAA0BpM,GAASoM,wBAA0B87D,EAAyB97D,uBAC/HC,0BAA2B89D,EAAiB99D,2BAA6BrM,GAASqM,2BAA6B67D,EAAyB77D,kCAGpI+sC,GAAAA,QAAaya,UAAUmX,EAAiB,CAC5CC,KAAM3zC,KACNzQ,YAAaA,GACblZ,SAAU,CACRu9D,QAAS,MACT/T,gBAAgB,EAChBgB,kBAAkB,EAClBve,aAAc55C,GAASnE,GACvBmmD,WAAW,EACX3/B,aAAc,CACZ/U,UAAWA,IAAa,GACxBD,MAAOqW,IAAY,GACnBnW,UAAWunC,IAAoB,GAC/BtnC,YAAahB,IAAsB,GACnCiB,gBAAiBsnD,IAA0B,GAC3CrnD,OAAQ2lD,IAAiB,OAI/B5S,GAAY,UAAW,SAAU,gBAAgB,6DAAD7kD,OAAyDquE,EAAkB,iBAAAruE,OAAgBuuE,EAAiB70D,cAAcirD,KAAK,MAAK,oBAAA3kE,QAAgD,QAAlCmvE,EAAAC,EAAgBvvD,0BAAkB,IAAAsvD,OAAA,EAAlCA,EAAoCv3E,SAAU,EAAC,yBAAAoI,OAAkBovE,EAAgBp/D,oBAAsB,OAAM,MAG/Ss1C,GAAoB1nD,QAAUnI,KAAKC,MAAMD,KAAKuR,UAAUooE,IAGxDloB,GAAoB,CAClBhJ,YAAY,EACZ9kC,QAAShV,GAASnE,GAClBu/B,YAAap7B,GAAS2kB,UAAY3kB,GAAS4kB,mBAE7C67B,GAAY,UAAW,SAAU,YAAY,0DAAD7kD,OAAyDoE,GAASnE,GAAE,KAClH,CAAE,MAAO5K,GACPwvD,GAAY,QAAS,SAAU,qBAAqB,sCAAD7kD,OAAmC3K,EAAMoE,SAC9F,CAEAorD,GAAY,UAAW,SAAU,kBAAkB,kCAAD7kD,OAAiCquE,IAGnFxpB,GAAY,UAAW,SAAU,iBAAiB,YAAD7kD,OAAcquE,EAAkB,wDAKjF,MAAMta,EAAexgC,GAAiB86C,EAAoB,aAC1DxpB,GAAY,OAAQ,SAAU,cAAc,oBAAD7kD,OAAmB+zD,EAAY,2CAAA/zD,OAA4B+zD,EAAe,IAAM,MAIvHxgC,GAAiB86C,EAAoB,cACvC3S,IAAoB,GACpB7W,GAAY,OAAQ,SAAU,gBAAiB,oEAE/CA,GAAY,OAAQ,SAAU,uBAAuB,iEAAD7kD,OAA6CquE,IAIjE96C,GAAiB86C,EAAoB,YACtC96C,GAAiB86C,EAAoB,WAMtExpB,GAAY,UAAW,SAAU,oBAAoB,4DAAD7kD,OAAuCquE,IAM3F,GAJE96C,GAAiB86C,EAAoB,aACrC96C,GAAiB86C,EAAoB,WAGd,CAEvB,IAAIkB,GAAqB,EACzB,IACE,MAAMC,EAAUhyB,GAAAA,QAAaiyB,aAC7B,GAAID,EAAS,CACX,MAAMrZ,EAAiB/xD,GAASnE,GAE5Bk2D,GAAkBqZ,EAAQE,gBAAkBvZ,IAA6C,IAA3BqZ,EAAQG,iBACxEJ,GAAqB,EAEzB,CACF,CAAE,MAAO15E,GACPgvD,GAAY,UAAW,SAAU,qBAAqB,iDAAD7kD,OAA8CnK,EAAE4D,SACvG,CAEI81E,EACF1qB,GAAY,OAAQ,SAAU,uBAAuB,mFAErDpD,IAA4B,EAEhC,CACAqJ,IAAoB,GAQpB,MAAM8kB,EAAgBz6E,EAAO8K,IAAMmE,GAASnE,IAAMmE,GAASnE,GAI3D4kD,GAAY,OAAQ,WAAY,iBAAiB,8FAMjDwB,IAAa,GAGb,MAAMwpB,GAAsBxF,EACtB7qC,EAAcp7B,GAAS2kB,UAAY3kB,GAAS4kB,kBAAoB5kB,GAASnE,GAE/E,GAAI4vE,EAAoB,CAStB,GAPAnhB,IAAmB,GACnB7G,GAAmBjqD,SAAU,EAC7BqlD,IAAc,GAEduY,IAAkB,GAGd/8D,GAAS,CACX++C,GAAAA,QAAaI,eAAen/C,UACN++C,GAAAA,QAAasyB,sBAGjCjrB,GAAY,UAAW,SAAU,sBAAsB,+DAG3D,CAGA,IACEkrB,GAAAA,EAAmBC,WAAWvxE,IAC9BomD,GAAY,UAAW,SAAU,qBAAsB,8CACzD,CAAE,MAAOhvD,GACPgvD,GAAY,QAAS,SAAU,2BAA2B,oCAAD7kD,OAAiCnK,EAAE4D,SAC9F,OAEMssE,GAA6BvmC,EAAaowC,EAClD,MAGElhB,IAAmB,GACnB7G,GAAmBjqD,SAAU,EAC7B4/C,GAAAA,QAAa2a,oBAAmB,EAAM,+CACtCtT,GAAY,OAAQ,SAAU,eAAe,wFAG7C5I,IAAaA,GAAU,iFAA4Czc,EAAc,yCAAsB,WAIvGqlB,GAAY,OAAQ,SAAU,gBAAiB,0DAEnD,KAxlCiB,CAAC,IAADorB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAKf,GAHA1rB,GAAY,OAAQ,UAAW,eAAgB,4BAG1B,IAAjBzoD,GAAoB,CACtB,MAAMo0E,EAAe,CACnB,cAAe,gBAAiB,UAAW,qBAC3C,cAAe,gBAAiB,iBAAkB,cAClD,sBAAuB,oBAAqB,kBAAmB,gBAC/D,qBAGFn3E,OAAOC,KAAKqpD,GAAWz2C,QAAQtf,IACxB4jF,EAAal6E,SAAS1J,WAClB+1D,EAAU/1D,IAGvB,CAKAuI,QAAes7E,EAAAA,GAAAA,IAAc9tB,EAAW9vD,GAAOC,IAE/C+xD,GAAY,OAAQ,UAAW,iBAAiB,qBAAD7kD,OAAuB7K,EAAO8K,KAK7EqsE,EAA2Bn3E,EAC3BikB,EAAUjkB,EAAO8K,GAEjBu/B,EAAcrqC,EAAO4zB,UAAY5zB,EAAO6zB,kBAAoB5kB,GAAS2kB,SAEhEyW,GACHqlB,GAAY,QAAS,UAAW,mBAAoB,oEAItD,MAAM6rB,EAAgBv7E,EAAO8W,SAAW,GAGxC,IAAI6f,EAAyB,GAE7B,GAAI4kD,GAAiB/6E,MAAMC,QAAQ86E,IAAkBA,EAAc94E,OAAS,EAAG,CAE7E,MAAM+4E,EAAkBvsE,GAAS6H,SAAW,GAG5C6f,QAA+B3X,QAAQ4X,IACrC2kD,EAAcz4E,IAAI/C,UAA0B,IAAD07E,EACzC,IAAI3lD,EAAc,GAGlB,MAAM4lD,EAAkBF,EAAgB3/D,KAAKmb,GAC3CztB,OAAOytB,EAAElsB,MAAQvB,OAAOgwE,EAAczuE,KACtCksB,EAAErQ,gBAAkB4yD,EAAc5yD,eAGpC,GAAI+0D,GAAmBA,EAAgB5lD,aAAe4lD,EAAgB5lD,YAAYrzB,OAAS,EAEzFqzB,EAAc4lD,EAAgB5lD,iBACzB,GAAIyjD,EAAczuE,KAAOvB,OAAOgwE,EAAczuE,IAAI6L,WAAW,SAElE,IAAK,IAADkgB,EACF,MAAMC,QAAuBC,EAAAA,GAAAA,IAC3BwiD,EAAczuE,GACdnN,GACAD,GACAi+E,EAAiB7wE,IAEnBgrB,GAAiC,QAAnBe,EAAAC,EAAe5sB,YAAI,IAAA2sB,OAAA,EAAnBA,EAAqBf,cAAegB,EAAe5sB,MAAQ,EAC3E,CAAE,MAAO6b,GACT,CAIF,MAAMioD,EAA0C,QAAjCyN,EAAGlC,EAAcpyD,wBAAgB,IAAAs0D,OAAA,EAA9BA,EAAgC/D,MAGlD,IAAI8B,EAAkB,GACtB,IACMh5E,MAAMC,QAAQ84E,EAActyD,kBAC9BuyD,EAAkBD,EAActyD,iBACmB,kBAAnCsyD,EAActyD,mBAC9BuyD,EAAkBl5E,KAAKC,MAAMg5E,EAActyD,kBAAoB,OAIjEuyD,EAAkBA,EAAgB12E,IAAIqX,IACpC,GAAoB,kBAATA,GAAqBA,EAAKI,UAAW,CAK9C,GAHewpC,GAAiBloC,KAAKC,GACnCA,EAAIvB,YAAcJ,EAAKI,WAAauB,EAAI1B,MAAQD,EAAKI,WAAauB,EAAIjb,QAAUsZ,EAAKI,WAGrF,OAAOJ,EAGT,MAAMyhE,EAAW73B,GAAiBloC,KAAKC,GACnB,QAAlBA,EAAIvB,WAAmC,QAAZuB,EAAI1B,KAA+B,QAAd0B,EAAIjb,OAEtD,OAAO+6E,EAAW,CAChBrhE,UAAWqhE,EAASrhE,WAAaqhE,EAASxhE,KAAOwhE,EAAS/6E,MAC1Dkb,YAAa6/D,EAAS7/D,aAAe6/D,EAAS78E,OAAS68E,EAASlhF,OAC9D,CAAE6f,UAAW,MAAOwB,YAAa,uBACvC,CAEA,MAAMq8D,EAAYr0B,GAAiBloC,KAAKC,GACtCA,EAAIvB,YAAcJ,GAAQ2B,EAAI1B,MAAQD,GAAQ2B,EAAIjb,QAAUsZ,GAE9D,GAAIi+D,EACF,MAAO,CACL79D,UAAW69D,EAAU79D,WAAa69D,EAAUh+D,KAAOg+D,EAAUv3E,MAC7Dkb,YAAaq8D,EAAUr8D,aAAeq8D,EAAUr5E,OAASq5E,EAAU19E,OAIvE,MAAMkhF,EAAW73B,GAAiBloC,KAAKC,GACnB,QAAlBA,EAAIvB,WAAmC,QAAZuB,EAAI1B,KAA+B,QAAd0B,EAAIjb,OAEtD,OAAO+6E,EAAW,CAChBrhE,UAAWqhE,EAASrhE,WAAaqhE,EAASxhE,KAAOwhE,EAAS/6E,MAC1Dkb,YAAa6/D,EAAS7/D,aAAe6/D,EAAS78E,OAAS68E,EAASlhF,OAC9D,CAAE6f,UAAW,MAAOwB,YAAa,yBAIzC,CAAE,MAAOrb,GACP84E,EAAkB,EACpB,CAEA,OAAAz4E,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKw4E,GAAa,IAEhBvyD,YAAauyD,EAAcxyD,kBAAoB,EAAI,EACnD8O,aAAc0jD,EAAc1jD,eAAiB0jD,EAAczyD,oBAAsByyD,EAAczyD,oBAAoByN,MAAM,KAAK,GAAK,IACnItN,iBAAkBuyD,EAElB1jD,YAAaA,EAEb/O,kBAAmBwyD,EAAcxyD,kBACjCD,oBAAqByyD,EAAczyD,oBACnCD,mBAAoB0yD,EAAc1yD,oBAE9BmnD,EAAY,CACdS,eAAgBT,EAAUp4C,QAC1B84C,iBAAkBV,EAAUx/C,UAC5BogD,YAAY,GACV,CAAC,MAMX3f,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACPgW,QAAS6f,KAGX+4B,GAAY,UAAW,OAAQ,kBAAkB,sDAAD7kD,OAA+C0wE,EAAc94E,OAAM,qCACrH,CAGA,IAAK,IAADo5E,EAEF,IAAIhC,GAAoB,QAANgC,EAAA77E,SAAM,IAAA67E,OAAA,EAANA,EAAQroD,oBAAqBg6B,EAAUh6B,kBAGzD,GAA2B,kBAAhBqmD,GAA4BA,EAAYljE,WAAW,KAC5D,IACEkjE,EAAcv5E,KAAKC,MAAMs5E,EAC3B,CAAE,MAAOn5E,GACT,CAOF,SAHM8wE,GAAuBvtD,EAASomB,EAAawvC,EAAa,KAAM5qE,IAGlEmvB,GAAiBy7C,EAAa,yBAChC,IAEE,MAAM1B,GAAkBlpE,GAASsV,eAAiB,IAAIzhB,IAAIsX,IACxD,MAAMg+D,EAAYr0B,GAAiBloC,KAAKC,GAAOA,EAAIjb,QAAUuZ,GAC7D,OAAOg+D,EAAYA,EAAU19E,MAAQ0f,UAIjCi+D,EAAAA,GAAAA,qBACJ,4BACAp0D,EACA3a,IAAW2F,GAASqjB,cACpB,CACEgmD,aAAcjuC,EACdkuC,cAAetpE,GAASrE,SAAW,GACnC4tE,aAAcvpE,GAASqb,YACvBmuD,UAAWxpE,GAASob,mBACpBquD,WAAYzpE,GAASqjB,cACrBqmD,cAAe1pE,GAASjQ,iBAAmB,YAC3C45E,iBAAkBt4E,KAAKuR,UAAU27C,EAAU/wC,aAAe,CAAC,GAC3Do8D,gBAAiBV,EACjBW,mBAAoB7pE,GAASmI,gBAAkB,EAC/C2hE,UAAW9pE,GAAS8kB,oBAAqB,IAG7C27B,GAAY,UAAW,eAAgB,mBAAmB,gEAAD7kD,OAA+Dw/B,GAC1H,CAAE,MAAO2uC,GACPtpB,GAAY,UAAW,eAAgB,oBAAoB,sCAAD7kD,OAAmCmuE,EAAa10E,SAC5G,CAEJ,CAAE,MAAO20E,GAEPvpB,GAAY,UAAW,OAAQ,qBAAqB,iDAAD7kD,OAAqCouE,EAAW30E,SACrG,CAOA,MAAMo2E,GAAsBxF,EAG5BiC,EAA2Bn3E,EAC3BikB,EAAUjkB,EAAO8K,GAGjBu/B,EAAcrqC,EAAO4zB,UAAY5zB,EAAO6zB,iBAIxC,MAAMslD,EAAoBn1B,GAA+BhkD,GAGrDm5E,EAAkB50D,eAAiB/jB,MAAMC,QAAQ04E,EAAkB50D,iBACrE40D,EAAkB50D,cAAgBs/B,GAChCs1B,EAAkB50D,cAClBw/B,KAIJ,MAAM43B,GAAgB56E,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACjBo4E,GAAiB,IACpBruE,GAAImZ,EAEJ2P,SAAUyW,IAkBZ,GAfAqlB,GAAY,UAAW,SAAU,mBAAmB,qCAAD7kD,QAAkE,QAA9BiwE,EAAAa,EAAiBp3D,qBAAa,IAAAu2D,OAAA,EAA9BA,EAAgCtL,KAAK,QAAS,OAAM,kBAAA3kE,OAAiB8wE,EAAiB9gE,oBAAsB,SAKnMo0C,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GACA66E,GAAgB,IAEnB7kE,QAAS6f,GAA0BA,EAAuBl0B,OAAS,EAAIk0B,EAA0BglD,EAAiB7kE,SAAWhW,EAAKgW,WAGpI44C,GAAY,UAAW,SAAU,mBAAmB,gCAAD7kD,OAA+BoZ,EAAO,gBAAApZ,QAA6C,QAA9BkwE,EAAAY,EAAiBp3D,qBAAa,IAAAw2D,OAAA,EAA9BA,EAAgCvL,KAAK,QAAS,OAAM,mCAAA3kE,QAAgD,QAAtBmwE,EAAArkD,SAAsB,IAAAqkD,OAAA,EAAtBA,EAAwBv4E,SAAU,IAGlM,QAAlBw4E,EAAAj7E,EAAOyc,mBAAW,IAAAw+D,GAAlBA,EAAoBnZ,UAAYthE,MAAMC,QAAQT,EAAOyc,YAAYqlD,UAAW,CAC9E,MAAMC,EAAY/hE,EAAOyc,YAAYqlD,SAClCh/D,IAAI66D,IAAE,CACL7yD,GAAI6yD,EAAG7yD,GACPsP,IAAKujD,EAAGG,UAAYH,EAAGvjD,KAAG,KAAAvP,OAAS8yD,EAAG7yD,IACtC/L,MAAO4+D,EAAG5+D,OAAS,eACnBijE,UAAWrE,EAAGqE,UACdjE,MAAOJ,EAAGI,OAASJ,EAAGK,cACtBC,QAASN,EAAGM,SAAWN,EAAGO,iBAC1BC,MAAOR,EAAGQ,OAASR,EAAGS,eACtB6D,IAAKtE,EAAGsE,IACRvnE,MAAM,GAADmQ,OAAK8yD,EAAGG,UAAYH,EAAGvjD,KAAG,KAAAvP,OAAS8yD,EAAG7yD,IAAI,OAAAD,OAAM8yD,EAAG5+D,OAAS,mBAElEmjE,KAAK,CAACvhD,EAAGwhD,IAAMxhD,EAAE5hB,MAAMqjE,cAAcD,EAAEpjE,MAAO,OAEjD0+D,GAAqBsE,GACrBrS,GAAY,UAAW,SAAU,oBAAoB,mDAAD7kD,OAAgDk3D,EAAUt/D,QAChH,CAUA,GAPAquD,KAGAF,GAAgB7tB,kBAIZ23C,EAAoB,CAStB,GANAnhB,IAAmB,GACnB7G,GAAmBjqD,SAAU,EAC7BqlD,IAAc,GACduY,IAAkB,GAGd/8D,GAAS,CACX++C,GAAAA,QAAaI,eAAen/C,UACN++C,GAAAA,QAAasyB,sBAGjCjrB,GAAY,UAAW,SAAU,sBAAsB,+DAG3D,CAGA,IACEkrB,GAAAA,EAAmBC,WAAWvxE,IAC9BomD,GAAY,UAAW,SAAU,qBAAsB,8CACzD,CAAE,MAAOhvD,GACPgvD,GAAY,QAAS,SAAU,2BAA2B,oCAAD7kD,OAAiCnK,EAAE4D,SAC9F,OAEMssE,GAA6BvmC,EAAapmB,EAElD,KAAO,CAGLs1C,IAAmB,GACnB7G,GAAmBjqD,SAAU,EAC7B4/C,GAAAA,QAAa2a,oBAAmB,EAAM,+CAGtC,IACE3a,GAAAA,QAAaI,eAAen/C,UACtB++C,GAAAA,QAAaya,UAAUqU,EAA0B,CACrD+C,KAAM3zC,KACNzQ,YAAaA,GACblZ,SAAU,CACRu9D,QAAS,MACT/T,gBAAgB,EAChBgB,kBAAkB,EAClBve,aAAc5kC,EACdgtC,WAAW,EACX3/B,aAAc,CACZ/U,UAAWA,IAAa,GACxBD,MAAOqW,IAAY,GACnBnW,UAAWunC,IAAoB,GAC/BtnC,YAAahB,IAAsB,GACnCiB,gBAAiBsnD,IAA0B,GAC3CrnD,OAAQ2lD,IAAiB,OAI/B5S,GAAY,UAAW,SAAU,oBAAqB,wCACxD,CAAE,MAAOxvD,GACPwvD,GAAY,QAAS,SAAU,oBAAoB,sDAAD7kD,OAA0C3K,EAAMoE,SACpG,CAMA,GAHAorD,GAAY,OAAQ,OAAQ,eAAe,6HAGvC5I,GAAW,CAKbA,IAJoBsgB,GAEhB,qDAAwC/8B,EAAc,wCACtD,yDAA4CA,EAAc,+BAC3C,UACrB,CAIAqlB,GAAY,OAAQ,SAAU,gBAAiB,qCACjD,CAMA,GAHAwB,IAAa,GAGTjiD,GAASgM,eAAiBhU,IAAgB,EAC5C,UACQ2yE,EAAAA,GAAAA,IAAqB,CACzBl8E,SACAC,YACAsd,cAAehM,GAASgM,gBAE1By0C,GAAY,UAAW,UAAW,cAAc,iDAAD7kD,OAA8BoE,GAASgM,cAAa,4BACrG,CAAE,MAAO/a,GACPwvD,GAAY,UAAW,UAAW,iBAAiB,8CAAD7kD,OAAiC3K,EAAMoE,SAE3F,CAKForD,GAAY,OAAQ,cAAe,kBAAmB,CACpDzrC,QAASA,EACTomB,YAAaA,EACb4tC,SAAUj4E,EAAOwzB,kBACjB0kD,YAAah0E,OAAOC,KAAKnE,GAAQyC,OACjCmzB,SAAuB,QAAdslD,EAAAl7E,EAAO41B,eAAO,IAAAslD,OAAA,EAAdA,EAAgBz4E,SAAU,EACnCqU,SAAuB,QAAdqkE,EAAAn7E,EAAO8W,eAAO,IAAAqkE,OAAA,EAAdA,EAAgB14E,SAAU,IAKrC,MAAMq5E,EAAoB97E,EAAOwzB,kBACd4K,GAAiB09C,EAAmB,YACrC19C,GAAiB09C,EAAmB,WAKtD,IAAK,IAADC,EACF1zB,GAAAA,QAAaI,eAAen/C,IAI5B,MAAM2wE,GAAel5E,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAChBo2E,GACAwE,GAAgB,IAEnBjxD,mBAAoBysD,EAAyBzsD,oBAAsB,GACnE5T,QAASqgE,EAAyBrgE,SAAW,GAE7Cwb,cAAeqpD,EAAiBrpD,eAAiB6kD,EAAyB7kD,cAC1EtR,MAAO26D,EAAiB36D,OAASm2D,EAAyBn2D,MAC1DuJ,MAAOoxD,EAAiBpxD,OAAS4sD,EAAyB5sD,MAC1DuH,QAAS6pD,EAAiB7pD,SAAWqlD,EAAyBrlD,gBAI1Du2B,GAAAA,QAAaya,UAAUmX,EAAiB,CAC5CC,KAAM3zC,KACNzQ,YAAaA,GACblZ,SAAU,CACRu9D,QAAS,MACT/T,gBAAgB,EAChBgB,kBAAkB,EAClBve,aAAc5kC,EACdgtC,WAAW,EACX3/B,aAAc,CACZ/U,UAAWA,IAAa,GACxBD,MAAOqW,IAAY,GACnBnW,UAAWunC,IAAoB,GAC/BtnC,YAAahB,IAAsB,GACnCiB,gBAAiBsnD,IAA0B,GAC3CrnD,OAAQ2lD,IAAiB,OAI/B5S,GAAY,UAAW,SAAU,gBAAgB,6DAAD7kD,OAAyDixE,EAAiB,iBAAAjxE,OAAgB8wE,EAAiBp3D,cAAcirD,KAAK,MAAK,oBAAA3kE,QAAgD,QAAlCkxE,EAAA9B,EAAgBvvD,0BAAkB,IAAAqxD,OAAA,EAAlCA,EAAoCt5E,SAAU,EAAC,yBAAAoI,OAAkBovE,EAAgBp/D,oBAAsB,OAAM,MAG9Ss1C,GAAoB1nD,QAAUnI,KAAKC,MAAMD,KAAKuR,UAAUooE,IAGxDloB,GAAoB,CAClBhJ,YAAY,EACZ9kC,QAASA,EACTomB,YAAaA,IAEfqlB,GAAY,UAAW,SAAU,YAAY,0DAAD7kD,OAAyDoZ,EAAO,KAC9G,CAAE,MAAO/jB,GACPwvD,GAAY,QAAS,SAAU,qBAAqB,sCAAD7kD,OAAmC3K,EAAMoE,SAC9F,CAOA,MAAM03E,EAAiBh8E,EAAOwzB,kBAC9Bk8B,GAAY,UAAW,OAAQ,eAAe,yDAAD7kD,OAA2CoZ,EAAO,UAAApZ,OAASw/B,EAAW,eAAAx/B,OAAcmxE,IAGjItsB,GAAY,UAAW,OAAQ,iBAAiB,YAAD7kD,OAAcmxE,EAAc,wDAIvE59C,GAAiB49C,EAAgB,cACnCzV,IAAoB,GACpB7W,GAAY,OAAQ,OAAQ,gBAAiB,oEAE7CA,GAAY,OAAQ,OAAQ,uBAAuB,iEAAD7kD,OAA6CmxE,IAInE59C,GAAiB49C,EAAgB,YAClC59C,GAAiB49C,EAAgB,WAM9DtsB,GAAY,UAAW,OAAQ,gBAAgB,gEAAD7kD,OAAiDmxE,IAM/F,GAJI59C,GAAiB49C,EAAgB,aACjC59C,GAAiB49C,EAAgB,WAGZ,CAEvB,IAAI5B,GAAqB,EACzB,IACE,MAAMC,EAAUhyB,GAAAA,QAAaiyB,aAC7B,GAAID,EAAS,CACX,MAAMrZ,EAAiB/xD,GAASnE,GAE5Bk2D,GAAkBqZ,EAAQE,gBAAkBvZ,IAA6C,IAA3BqZ,EAAQG,iBACxEJ,GAAqB,EAEzB,CACF,CAAE,MAAO15E,GACPgvD,GAAY,UAAW,OAAQ,qBAAqB,iDAAD7kD,OAA8CnK,EAAE4D,SACrG,CAEI81E,EACF1qB,GAAY,OAAQ,OAAQ,uBAAuB,mFAEnDpD,IAA4B,EAEhC,CAASqJ,IAAoB,IAGD50D,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACvBkO,IAAQ,IACXnE,GAAImZ,EACJ2P,SAAUyW,EACV7W,kBAAmBwoD,IACT,QAANZ,EAAAp7E,SAAM,IAAAo7E,OAAA,EAANA,EAAQ5jD,eAAgB,CAAEA,aAAcx3B,EAAOw3B,eALrD,MASMykD,EAAqB79C,GAAiB49C,EAAgB,aAC5DtsB,GAAY,OAAQ,SAAU,cAAc,oBAAD7kD,OAAmBoxE,EAAkB,2CAAApxE,OAA4BoxE,EAAqB,IAAM,MAIvIhtB,GAAYnuD,IAAS,IAADo7E,EAElB,MAAM5oD,EAAiB,MACrB,IACE,MAAMC,EAAa/yB,MAAMC,QAAQu7E,GAC7BA,EACA17E,KAAKC,MAAMy7E,GAAkB,YAC3B3C,EAAc9lD,EAAWA,EAAW9wB,OAAS,GAC7CixB,EAAWtK,GAAgBiwD,GACjC,OAAe,OAAR3lD,QAAQ,IAARA,OAAQ,EAARA,EAAUjpB,OAAQ4uE,GAAe,SAC1C,CAAE,MAAO34E,GACP,MAAO,SACT,CACD,EAXsB,GAuBvB,OAVaK,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACRD,GAAI,IACPgK,GAAImZ,EACJ2P,SAAUyW,EACV7W,kBAAmBwoD,EACnBloD,gBAAiBR,IACP,QAAN4oD,EAAAl8E,SAAM,IAAAk8E,OAAA,EAANA,EAAQ1kD,eAAgB,CAAEA,aAAcx3B,EAAOw3B,eAAgB,CAAF,GACjEjT,cAAeo3D,EAAiBp3D,kBAYpCmrC,GAAY,OAAQ,WAAY,wBAAwB,+FAMnDwlB,GAAoB5rE,IAEvB++C,GAAAA,QAAaI,eAAen/C,UACtB++C,GAAAA,QAAa8zB,cACnBzsB,GAAY,OAAQ,QAAS,sBAAuB,iHAC3CwlB,GACTxlB,GAAY,OAAQ,QAAS,oBAAqB,yFAGtD,CAihBF,CAAE,MAAOxvD,GACP,MAAMwnB,EAAa0/C,IAAqBn4D,GAASnE,GAA0B,kBAApB,kBAIvD,GAHA4kD,GAAY,QAAS,MAAOhoC,EAAUxnB,EAAMoE,SAGxCpE,EAAMk8E,UAAW,CACnB,MAAMC,EAAWn8E,EAAMk8E,UAIvB,IAAwB,IAApBC,EAASnvD,OAAiB,CAE5B,MAAMovD,EAAWD,EAASE,yBAAuB,kBAAA1xE,OAAiBwxE,EAASG,mBACrEC,EAAUJ,EAASK,iBAAgB,4BAAA7xE,OACnBwxE,EAASK,iBAAgB,cAC3C,GAEJ51B,IAAaA,GAAU,+EAADj8C,OACoCyxE,GAAQzxE,OAAG4xE,GACnE,CAAE7iF,KAAM,UAGV81D,GAAY,QAAS,OAAQ,wBAAwB,8CAAD7kD,OAAmCyxE,GACzF,KAAO,CAEL,MAAMn0D,GAAWw0D,EAAAA,GAAAA,GAA2Bz8E,EAAMoE,SAClDwiD,IAAaA,GAAU,iDAADj8C,OAAqCsd,GAAY,CAAEvuB,KAAM,UAE/E81D,GAAY,OAAQ,OAAQ,oBAAoB,oEAClD,CACF,KAAO,CACL,MAAMvnC,GAAWw0D,EAAAA,GAAAA,GAA2Bz8E,EAAMoE,SAClDwiD,IAAaA,GAAU,iDAADj8C,OAAqCsd,GAAY,CAAEvuB,KAAM,SACjF,CAGA2/D,IAAmB,GACnB7G,GAAmBjqD,SAAU,EAC7B4/C,GAAAA,QAAa2a,oBAAmB,EAAM,0CAEtCrkE,IAAY,EACd,CAAC,QAECqoD,KAEAsS,IAAiB,GAGbzwD,OAAO2qE,wBACT9jB,GAAY,OAAQ,OAAQ,uBAAuB,yDAGnD3mD,WAAW,KACT2mD,GAAY,OAAQ,OAAQ,sBAAsB,mDAClD7mD,OAAO2qE,wBAAyB,EAChC70E,IAAY,GACZ+wD,GAAY,OAAQ,OAAQ,kBAAkB,8CAC7C,OAEHA,GAAY,OAAQ,OAAQ,qBAAsB,0DAClD3mD,WAAW,KACTpK,IAAY,GACZ+wD,GAAY,OAAQ,OAAQ,kBAAkB,+CAC7C,MAIL,IACEA,GAAY,OAAQ,OAAQ,qBAAsB,8BAClDkrB,GAAAA,EAAmBC,WAAWvxE,GAChC,CAAE,MAAO5I,GACT,CAGA,IACEgvD,GAAY,OAAQ,OAAQ,qBAAsB,uDAClDktB,GAAAA,EAAsBC,WAAW,kBACnC,CAAE,MAAOn8E,GACT,CAGA,IAKsBuO,GAAS2kB,UAAY3kB,GAAS4kB,iBAClC5kB,GAASnE,IAAMmE,GAASnE,EAgC1C,CAAE,MAAOpK,GACP,CAEJ,CACF,EAGMo8E,GAAmB/8E,eAAOg9E,GAAkC,IAAlBn4D,EAAOlJ,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,CAAC,EACzD,MAAM,WACJq3C,GAAa,EAAK,qBAClBiqB,EAAoB,kBACpBC,EAAoBnnD,GAAW,cAC/BonD,GAAgB,GACdt4D,EAEJ,IAAKtb,GAIH,OAHKypD,GACHjM,IAAaA,GAAU,4DAA2C,CAAEltD,KAAM,WAErE,EAIT,GAAIm5D,IAAe1K,GAAAA,QAAa80B,oBAC9B,OAAO,EAIT,GAAgC,0BAA5BJ,EAAenpD,SACjB,OAAO,EAGT,IACMm/B,EACF2G,IAAgB,GAEhBJ,IAAiB,GAInBjR,GAAAA,QAAaI,eAAen/C,IAG5B,MAAM8zE,QAAsB/0B,GAAAA,QAAaK,WACzC,IAAI20B,EAAgB,KAKpB,IAFyBD,GAAiBrqB,EAGxCsqB,GAAgB,IAAIn/D,MAAOsY,cAG3Bu7B,GAAoB,CAClBhJ,YAAY,EACZC,YAAY,EACZ/kC,QAAS,KACTomB,YAAa,GACbqe,UAAU,EACVzhD,aAAcA,GACdg9B,kBAAmBA,UAEhB,GAAIm5C,EACT,IACE,MAAME,QAAiBj1B,GAAAA,QAAaO,YACpCy0B,GAAwB,OAARC,QAAQ,IAARA,OAAQ,EAARA,EAAUC,qBAAqB,IAAIr/D,MAAOsY,aAC5D,CAAE,MAAAgnD,GACAH,GAAgB,IAAIn/D,MAAOsY,aAC7B,CAIF,MAAMinD,GAAa18E,EAAAA,EAAAA,GAAA,GAAQg8E,GAE3B,GAAyC,kBAA9BU,EAAchhE,aAA0D,OAA9BghE,EAAchhE,YAAsB,CACvFizC,GAAY,UAAW,QAAS,+BAAgC,iFAChE,MAAMguB,EAAiB,CACrBC,gBAAiBZ,EAAeY,iBAAmB,GACnDC,eAAgBb,EAAea,gBAAkB,GACjDriE,gBAAiB,CAAC,GAGhBwhE,EAAec,4BAA2BH,EAAeniE,gBAAgBsiE,0BAA4Bd,EAAec,2BACpHd,EAAee,uBAAsBJ,EAAeniE,gBAAgBuiE,qBAAuBf,EAAee,sBAC1Gf,EAAegB,MAAKL,EAAeniE,gBAAgBwiE,IAAMhB,EAAegB,KACxEhB,EAAeiB,UAASN,EAAeniE,gBAAgByiE,QAAUjB,EAAeiB,SAE7C,sBAAnCjB,EAAeY,kBACbZ,EAAe1hE,yBAAwBqiE,EAAeniE,gBAAgBF,uBAAyB0hE,EAAe1hE,wBAC9G0hE,EAAezhE,4BAA2BoiE,EAAeniE,gBAAgBD,0BAA4ByhE,EAAezhE,4BAG1HmiE,EAAchhE,YAAcnc,KAAKuR,UAAU6rE,EAC7C,CAGA,MAAMO,EAA0BhB,EAAkBn6E,IAAIitD,IACpD,GAAIA,EAAIC,KAAM,CACZ,MAAM,KAAEA,GAAkBD,EAATmuB,GAAIC,EAAAA,EAAAA,GAAKpuB,EAAGquB,IAC7B,OAAAr9E,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYm9E,GAAI,IAAEG,UAAU,GAC9B,CACA,OAAOtuB,IAMHuuB,OAAiD3iE,IAAzBqhE,EAC1BA,EACC/tE,GAASnE,KAAOiyE,EAAejyE,GAAKiyE,EAAejyE,GAAK,MAOvDyzE,EAAmBlkE,QACvBojE,EAAcr2D,kCACdq2D,EAAcnmE,0BACdmmE,EAAc/nD,oBAqChB,aAjCM2yB,GAAAA,QAAaya,UAAU2a,EAAe,CAC1Cx5D,QAASq6D,EACTxoD,YAAamoD,EACbrhE,SAAU,CACR2gE,kBAAmBF,EACnBlD,QAAS,MACT/T,gBAAgB,EAChBgB,oBACAve,aAAcy1B,EACdrtB,WAAWisB,GAAgBqB,EAC3BjtD,aAAc,CACZ/U,UAAWA,IAAa,GACxBD,MAAOqW,IAAY,GACnBnW,UAAWunC,IAAoB,GAC/BtnC,YAAahB,IAAsB,GACnCiB,gBAAiBsnD,IAA0B,GAC3CrnD,OAAQ2lD,IAAiB,OAK/B9I,IAAgB,IAAIt7C,MAAOsY,eAC3B6vC,IAAkB,GAElBt9D,WAAW,KACT2wD,IAAgB,GAChBC,GAAc,OACb5G,EAAa,IAAM,GAEjBA,GACHjM,IAAaA,GAAU,4HAADj8C,OAAqDoE,GAAS4kB,kBAAoB,yBAAqB,YAGxH,CACT,CAAE,MAAO3zB,GAMP,OALK6yD,GACHjM,IAAaA,GAAU,yCAAgC,CAAEltD,KAAM,UAEjE8/D,IAAgB,GAChBJ,IAAiB,IACV,CACT,CACF,EAUMwJ,GAAY/iE,iBAA6E,IAAtEgzD,EAAUr3C,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,IAAAA,UAAA,GAAUwhE,EAAaxhE,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,IAAAA,UAAA,GAAU8iE,EAAc9iE,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,KAEnF,GAAIk3C,GAAanqD,QACf,MAAO,CAAEoX,SAAS,EAAOwd,OAAQ,gBAMnC,OAAOy/C,GAFY0B,GAAkBvvE,GAED,CAClC8jD,aACAmqB,iBAEJ,GAGAp+E,EAAAA,EAAAA,WAAU,KACR+zD,GAAoBpqD,QAAUq6D,IAC7B,CAACA,KAQJ,MAoHM2b,GAAyBA,KAC7B,GAAKn1E,GAEL,IAEE++C,GAAAA,QAAagpB,YAAY,CAAEmJ,gBAAgB,IAC3CluB,IAA4B,EAC9B,CAAE,MAAOpsD,GACT,IAuKFpB,EAAAA,EAAAA,WAAU,KACR,GAAImQ,GAASnE,IAAMxB,IAAW2F,GAASukB,oBAAsB+4B,GAE3D,IAEE,MAAM8tB,EAAUhyB,GAAAA,QAAaiyB,aAC7B,GAAID,GAAWA,EAAQG,gBAEjBH,EAAQE,gBAAkBtrE,GAASnE,KAAiC,IAA3BuvE,EAAQG,eAAyB,CAGxDp8C,GAAiBnvB,GAASukB,kBAAmB,YACxC4K,GAAiBnvB,GAASukB,kBAAmB,WADtE,MAMMkrD,EAAuBzvE,GAASukB,mBAAqB,OACrDmrD,EAAcvgD,GAAiBsgD,EAAsB,YACrDE,EAAaxgD,GAAiBsgD,EAAsB,WAGtDC,GAAeC,GACjBv2B,GAAAA,QAAagpB,YAAY,CAAEmJ,gBAAgB,IAC3CluB,IAA4B,IAE5BA,IAA4B,EAEhC,CAEJ,CAAE,MAAO5rD,GACP,GAGH,CAACuO,GAASnE,GAAIxB,GAAS2F,GAASukB,kBAAmB+4B,KAGtD,MAAOsyB,GAA0BC,KAA+B7gF,EAAAA,EAAAA,WAAS,IAEzEa,EAAAA,EAAAA,WAAU,KACJytD,KAAwCsyB,KAC1CC,IAA4B,GAC5BpvB,GAAY,OAAQ,gBAAiB,iBAAiB,mFAEvD,CAACnD,GAAqCsyB,MAGzC//E,EAAAA,EAAAA,WAAU,KACR,GAAImQ,GAASnE,IAAMmE,GAASukB,mBAAqBlqB,GAAS,CACxD,MAAMy1E,EAAc3gD,GAAiBnvB,GAASukB,kBAAmB,YAC3DwrD,EAAmB5gD,GAAiBnvB,GAASukB,kBAAmB,WAKtE,IAHgCurD,GAAeC,IAGhB3yB,GAA0B,CAEvD,IAAI+tB,GAAqB,EACzB,IACE,MAAMC,EAAUhyB,GAAAA,QAAaiyB,aACzBD,GAEEprE,GAASnE,IAAMuvE,EAAQE,gBAAkBtrE,GAASnE,KAAiC,IAA3BuvE,EAAQG,iBAClEJ,GAAqB,EAG3B,CAAE,MAAO15E,GACP,CAGF,IAAK05E,EAAoB,CACvB9tB,IAA4B,GAG5B,IACEjE,GAAAA,QAAagpB,YAAY,CAAEmJ,gBAAgB,GAC7C,CAAE,MAAO95E,GACP,CAEJ,CACF,CACF,GACC,CAACuO,GAASukB,kBAAmBvkB,GAASnE,GAAIxB,GAAS+iD,MAGtDvtD,EAAAA,EAAAA,WAAU,KACR,GAAIkqD,IAAcprD,IAAc0L,GAAS,CAGvC8nD,IAAiB,GACjBuI,GAAc,MACdnN,IAAuC,GAGvC,MAAMxrC,EAAQ,GAAAnW,OAAGjN,GAAWkjB,WAAaljB,GAAWkjB,WAAa,IAAM,IAAEjW,OAAGjN,GAAWojB,OAAS,GAAE,KAAAnW,OAAIjN,GAAWsjB,UAAY,IAAErW,OAAGjN,GAAWwjB,SAAW,KAAOxjB,GAAWwjB,SAAW,IAAKC,QAAQ,OAAQ,KAAKrd,OAE/MirD,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP62B,YAAaruB,GACbgpB,cAAehpB,GACf0X,MAAOA,EACPuJ,MAAO3sB,GAAW2sB,OAAS,GAC3BuH,QAASl0B,GAAWk0B,SAAW,GAE/BhnB,GAAI,KACJ8oB,SAAU,GACVC,iBAAkB,KAClBjpB,QAAS,GACT0jD,gBAAiB,GACjBl3C,eAAgB,GAChBsT,mBAAoB,CAAC,CAAE5f,GAAIoT,KAAKC,MAAOoP,MAAO,GAAIC,aAAc,GAAI22B,UAAW,KAAM12B,WAAY,QAInGkoC,IAAoB,GACpBF,GAAoB,CAAC,GACrB/L,GAAuB,IAAIzrB,IAG7B,GACC,CAAC+qB,GAAYprD,GAAY0L,MAG5BxK,EAAAA,EAAAA,WAAU,KACR,GAAIwK,GAAS,CACX,MAAM21E,EA9uGgBC,MACxB,IAAK51E,GAAS,OAAO,KACrB,IACE,MAAM+wE,EAAUhyB,GAAAA,QAAaiyB,aAC7B,OAAc,OAAPD,QAAO,IAAPA,OAAO,EAAPA,EAAS1iE,eAAgB,IAClC,CAAE,MAAOzX,GAEP,OAAO,IACT,GAsuG6Bg/E,GACvBD,IACF91B,GAAiBroD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAChBD,GACAm+E,IAELvvB,GAAY,UAAW,KAAM,iBAAiB,8CAAD7kD,OAAgCvK,KAAKuR,UAAUotE,KAEhG,GACC,CAAC31E,MAQJxK,EAAAA,EAAAA,WAAU,IAOD,KAELs6D,IAAiB,IAGlB,KAIHt6D,EAAAA,EAAAA,WAAU,KAERs6D,IAAiB,GACjBhI,IAAiB,GACjB+H,IAAsB,GAGlBgmB,GAAuB12E,UACzB02E,GAAuB12E,SAAU,GAK/B4mB,IAEF4/B,GAAY,CACV38B,cAAehpB,IAAW,GAC1BquB,YAAaruB,IAAW,GACxB+gB,mBAAoB/gB,IAAW,GAC/B0X,MAAO,GACPuJ,MAAO,GACPuH,QAAS,GACT8B,SAAU,wBACVnJ,oBAAqB,GACrBlG,cAAe,GACf1J,mBAAoB,GACpBuqB,SAAU,GACVrR,mBAAmB,EACnBrJ,mBAAoB,CAAC,CACnB3rB,MAAO,GACPqgF,YAAa,GACb1uB,SAAU,EACV2uB,eAAgB,GAChBC,gBAAiB,GACjBC,aAAc,IAEhB/wD,UAAW,CAAC,EACZ1X,QAAS,GACT0c,kBAAmB,CAAC,QACpB9F,eAAgB,qCAGnB,CAAC2B,GAAa/lB,MAOjBxK,EAAAA,EAAAA,WAAU,KAUJomE,IAAwBhpD,IAAiBi1C,IAC3CgI,IAAsB,IAEvB,CAAC9pC,GAAa61C,GAAsBhpD,GAAei1C,KAGtD,MAAMguB,IAAyBh3E,EAAAA,EAAAA,SAAO,GAGhC+lD,IAAuB/lD,EAAAA,EAAAA,QAAO,MAG9Bq3E,IAAiBr3E,EAAAA,EAAAA,QAAO,OAI9BrJ,EAAAA,EAAAA,WAAU,KACR+J,OAAOs4D,mCAAqCge,GAGxC71E,KACF++C,GAAAA,QAAaI,eAAen/C,IAC5B++C,GAAAA,QAAaK,WAAW6jB,KAAK7jB,IACtBA,GAAar5B,KAEhB8vD,GAAuB12E,SAAU,OAItC,CAACa,GAAS+lB,MAIbowD,EAAAA,EAAAA,iBAAgB,KACd,MAEMC,EAAqBA,KACzB,GAAIF,GAAe/2E,QAAS,CAC1B,MAAMxQ,EAASunF,GAAe/2E,QAAQ0J,aAEtCuC,SAASirE,gBAAgBt9E,MAAMu9E,YAAY,wBAAwB,GAAD/0E,OAAK5S,EAN/D,GAM2E,MACrF,GAIFynF,IAGA,MAAMG,EAAW,CACf92E,WAAW22E,EAAoB,IAC/B32E,WAAW22E,EAAoB,KAC/B32E,WAAW22E,EAAoB,KAC/B32E,WAAW22E,EAAoB,MAGjC72E,OAAO4K,iBAAiB,SAAUisE,GAGlC,MAAMI,EAAW,IAAIC,eAAe,KAClCL,MAOF,OAJIF,GAAe/2E,SACjBq3E,EAASE,QAAQR,GAAe/2E,SAG3B,KACLo3E,EAAS9oE,QAAQ9M,GAAKsJ,aAAatJ,IACnCpB,OAAO6K,oBAAoB,SAAUgsE,GACrCI,EAASG,eAEV,KAGHnhF,EAAAA,EAAAA,WAAU,KACR,GAAI0gF,GAAe/2E,QAAS,CAC1B,MAAMxQ,EAASunF,GAAe/2E,QAAQ0J,aACtCuC,SAASirE,gBAAgBt9E,MAAMu9E,YAAY,wBAAwB,GAAD/0E,OAAK5S,EAAS,GAAE,MACpF,GACC,CAACwyE,GAAkBC,GAAuBz7D,GAASukB,kBAAmBvkB,GAAS2kB,SAAU3kB,GAASumB,eAGrG12B,EAAAA,EAAAA,WAAU,KAIJqgF,GAAuB12E,SAKvBwG,GAASnE,IAKTi+C,KAKA95C,GAAS2kB,UAAkC,0BAAtB3kB,GAAS2kB,SAChCurD,GAAuB12E,SAAU,EAM/B/K,IAASC,IACXgzE,KAAsBpE,KAAK1sD,IACrBA,IACFs/D,GAAuB12E,SAAU,OAItC,CAACwG,GAASnE,GAAIi+C,GAAYrrD,GAAOC,KAGpC,MAAMuiF,IAAezuE,EAAAA,EAAAA,aAAY1R,UAC/B,IAAKogF,IAAiBziF,KAAUC,GAAU,OAG1C,MAAMglE,EAAWL,GAAczmD,KAAKC,GAAOA,EAAIhR,KAAOq1E,GAAgBrkE,EAAI1B,MAAQ+lE,GAClF,IAAKxd,EACH,OAIF,MAAM7E,EAAW6E,EAAS7E,UAAY6E,EAASjoE,OAASioE,EAASvoD,IACjE,GAAK0jD,EAAL,CAIAhE,GAAoBh5D,GAEdA,EAAKq/E,GAAsBr/E,GAC/BC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYD,GAAI,IAAE,CAACq/E,IAAe,KAGpC,IACE,MAAMl3D,QAAe40C,EAAAA,GAAAA,IAAc,CAAEngE,SAAOC,YAAUmgE,aAClD70C,IApgOci1B,EAqgOHp9C,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUD,GAAI,IAAE,CAACq/E,GAAel3D,IArgOzB8gC,GAAkBh3B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEi3B,QAAS9L,KAugOpE,CAAE,MAAOh+C,GAEFA,EAAMoE,QAAQnD,SAAS,QAAWjB,EAAMoE,QAAQnD,SAAS,QAC5D2lD,GAAU,gDAADj8C,OAAoC3K,EAAMoE,SAAW,QAElE,CAAC,QACCw1D,GAAoBh5D,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUD,GAAI,IAAE,CAACq/E,IAAe,IAC1D,CA9gOoBjiC,KA0/NpB,GAqBC,CAACxgD,GAAOC,GAAUmpD,GAAWwb,KAG1B8d,IAAkB3uE,EAAAA,EAAAA,aAAY1R,UAClC,GAAKrC,IAAUC,KACXs8D,GAAJ,CAEAC,IAAsB,GAEtB,IACE,MAAM93C,QAAiB48C,EAAAA,GAAAA,IAAe,CACpCthE,SACAC,YACAshE,eAAe,EACflB,MAAO,MAGG,OAAR37C,QAAQ,IAARA,GAAAA,EAAUlY,MAAQ1J,MAAMC,QAAQ2hB,EAASlY,MAC3C8vD,GAAe53C,EAASlY,MAExB8vD,GAAe,GAEnB,CAAE,MAAO95D,GAEP85D,GAAe,GACjB,CAAC,QACCE,IAAsB,EACxB,CAtB8B,GAuB7B,CAACx8D,GAAOC,GAAUs8D,KAGfomB,IAAoB5uE,EAAAA,EAAAA,aAAY1R,UACpC,GAAKkb,GAAkBvd,IAAUC,GAAjC,CAKA28D,IAAwB,GAExB,IAEE,MAAM6E,EAAUpF,GAAYl+C,KAAKkX,GAC/BA,EAAE9X,gBAAkBA,GACpB8X,EAAEqsC,kBAAoBnkD,GAKtBm/C,GAFE+E,GAKe,CAAEmhB,UAAU,GAEjC,CAAE,MAAOpgF,GACPk6D,GAAiB,CAAEkmB,UAAU,GAC/B,CAAC,QACChmB,IAAwB,EAC1B,CAtBA,MAFEF,GAAiB,OAyBlB,CAAC18D,GAAOC,GAAUo8D,GAAa9qD,GAASgM,iBAI3Cnc,EAAAA,EAAAA,WAAU,OAEP,CAACmQ,GAASgI,2BAA4BhI,GAAS0mB,+BAAgC1mB,GAASnE,MAQ3FhM,EAAAA,EAAAA,WAAU,KAER,MAAMyhF,EAAwB3iF,IACA0L,KACCy/C,KACAoI,KACAliD,GAASqjB,gBACTrjB,GAAS+R,QACT/R,GAASsb,MAGlCi2D,EAAgBvxE,GAASrE,SAAWrB,OAAO0F,GAASrE,SAAS5G,QAC/CiL,GAASob,oBACTpb,GAASqb,aACRrb,GAASsV,eAAiB/jB,MAAMC,QAAQwO,GAASsV,gBAAkBtV,GAASsV,cAAc9hB,OAAS,GACnGwM,GAASmI,gBAAkBD,WAAWlI,GAASmI,gBAAkB,GACjEnI,GAASq/C,iBAAmB/kD,OAAO0F,GAASq/C,iBAAiBtqD,OAElF,GAAIu8E,GAAyBC,EAAc,CAEzC,MAAMx/D,EAAQ,GAAAnW,OAAGjN,GAAWkjB,WAAaljB,GAAWkjB,WAAa,IAAM,IAAEjW,OAAGjN,GAAWojB,OAAS,GAAE,KAAAnW,OAAIjN,GAAWsjB,UAAY,IAAErW,OAAGjN,GAAWwjB,SAAW,KAAOxjB,GAAWwjB,SAAW,IAAKC,QAAQ,OAAQ,KAAKrd,OAE/MirD,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACPwxB,cAAehpB,GACf0X,MAAOA,GAAS,YAChBuJ,MAAO3sB,GAAW2sB,OAAS,GAC3BuH,QAASl0B,GAAWk0B,SAAW,KAEnC,GACC,CAACl0B,GAAY0L,GAASy/C,GAAYoI,GAAeliD,GAASqjB,cAAerjB,GAAS+R,MAAO/R,GAASsb,MACjGtb,GAASrE,QAASqE,GAASob,mBAAoBpb,GAASqb,YAAarb,GAASsV,cAC9EtV,GAASmI,eAAgBnI,GAASq/C,mBAGtCxvD,EAAAA,EAAAA,WAAU,KAER,IAAKmQ,GAASyb,oBAA6D,IAAvCzb,GAASyb,mBAAmBjoB,OAC9D,OAIwBwM,GAASyb,mBAAmB2d,OAAO,CAACmjC,EAAKp+C,IAI1Do+C,GAFMr0D,YAAYiW,EAAQI,cAAgB,KAAKpjB,WAAWiX,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,GAC/FlK,WAAWiW,EAAQsjC,UAAY,GAE/C,GAGqB,MAAUzhD,GAASkc,mBACzC8jC,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACPqqB,mBAAmB,MAGtB,CAAClc,GAASyb,mBAAoBzb,GAASkc,qBAK1CrsB,EAAAA,EAAAA,WAAU,KAER,GAAIwjE,GAAc7/D,OAAS,GACvBjC,MAAMC,QAAQwO,GAAS+L,SACvB/L,GAAS+L,OAAOvY,OAAS,EAAG,CAGbwM,GAAS+L,OAAOd,MAAMpP,GACrCw3D,GAAc9nD,KAAKsB,IAAQA,EAAIhR,IAAMgR,EAAI1B,OAAStP,GAYtD,GACC,CAACw3D,GAAerzD,GAAS+L,UAG5Blc,EAAAA,EAAAA,WAAU,KACH0B,MAAMC,QAAQwO,GAAS+L,SAAsC,IAA3B/L,GAAS+L,OAAOvY,QAKvDwM,GAAS+L,OAAOjE,QAAQ88D,IACjBja,GAAUia,IAAWha,GAAiBga,IACzCqM,GAAarM,MAIhB,CAAC5kE,GAAS+L,UAGblc,EAAAA,EAAAA,WAAU,KACJpB,IAASC,IAAmC,IAAvBo8D,GAAYt3D,SAAiBw3D,IACpDmmB,MAED,CAAC1iF,GAAOC,GAAUo8D,GAAYt3D,OAAQw3D,GAAoBmmB,MAG7DthF,EAAAA,EAAAA,WAAU,KAER,MAAM2hF,EAAiBhlE,GAAmBI,KAAKC,GAAOA,EAAI1B,MAAQnL,GAAS4L,oBACrE9b,GAAsB,OAAd0hF,QAAc,IAAdA,OAAc,EAAdA,EAAgB1hF,QAAS,GAGvC,KAFuBA,EAAMoC,SAAS,wBAAoBpC,EAAMoC,SAAS,gBAGvE,OAIF,IAAIu/E,EAAU,GASd,GARiC,kBAAtBzxE,GAAS2kB,SAClB8sD,EAAUzxE,GAAS2kB,SACmB,kBAAtB3kB,GAAS2kB,UAAyB3kB,GAAS2kB,WAC3D8sD,EAAUzxE,GAAS2kB,SAASyD,qBAClBpoB,GAAS2kB,SAAS0D,mBAClBroB,GAAS2kB,SAAS2D,aAAe,KAGxCmpD,IAAYA,EAAQ/pE,WAAW,MAClC,OAIF,MAAMgqE,EAASD,EAAQr/D,QAAQ,MAAO,MAGlCpS,GAASkM,yBAA2BwlE,GACtC1xB,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACPqa,uBAAwBwlE,MAG3B,CAAC1xE,GAAS2kB,SAAU3kB,GAAS4L,mBAAoBY,GAAoBxM,GAASkM,0BAGjFrc,EAAAA,EAAAA,WAAU,KAER,IAAKmQ,GAAS+L,SAAWxa,MAAMC,QAAQwO,GAAS+L,SAAsC,IAA3B/L,GAAS+L,OAAOvY,OACzE,OAIF,MAAMm+E,EAAgB3xE,GAAS+L,OACzB6lE,EAAavY,GAAsBxlE,IAAI66D,GAAMA,EAAG7yD,IAAM6yD,EAAGvjD,KAG1CwmE,EAAcpmE,KAAKsmE,IAASD,EAAW1/E,SAAS2/E,MAGnE7xB,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACPka,OAAQ,MAGV8rC,GAAU,uEAAiD,UAE5D,CAAC73C,GAASqb,YAAag+C,MAG1BxpE,EAAAA,EAAAA,WAAU,KACJmQ,GAASgM,eAAiBhM,GAASgM,cAAcjX,OACnDq8E,GAAkBpxE,GAASgM,cAAcjX,QAEzCo2D,GAAiB,OAElB,CAACnrD,GAASgM,cAAeolE,MAI5BvhF,EAAAA,EAAAA,WAAU,KACeiB,WAAa,IAADghF,EAAAl0D,EAAAN,EAAAE,EAEjC,MAAMmyC,EAAexgC,GAAiBnvB,GAASukB,kBAAmB,aAC5DwtD,EAA2D,aAApB,QAA3BD,EAAA9xE,GAAS4L,0BAAkB,IAAAkmE,OAAA,EAA3BA,EAA6B12E,eACzC42E,IAA0C,QAAvBp0D,EAAC5d,GAASgM,qBAAa,IAAA4R,IAAtBA,EAAwB7oB,QAC5Ck9E,IAA0C,QAAzB30D,EAACtd,GAASjQ,uBAAe,IAAAutB,GAAxBA,EAA0BvoB,WAAiC,QAAvByoB,EAACxd,GAAS7P,qBAAa,IAAAqtB,GAAtBA,EAAwBzoB,QAErF,GAAI46D,GAAgBoiB,GAAaC,GAAmBC,GAAkB/mB,KAAkBA,GAAcmmB,SACpG,IACE,MAAMpjF,QAAqBohE,GAA6BrvD,GAAUhI,IAE9D/J,IACF+xD,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GACA5D,IAEL27D,GAA0B37D,EAAaqiE,QACvCrO,IAAa,GAEjB,CAAE,MAAOhxD,GACT,GAIJihF,IACC,CAAClyE,GAASukB,kBAAmBvkB,GAAS4L,mBAAoB5L,GAASgM,cAAehM,GAASjQ,gBAAiBiQ,GAAS7P,cAAe+6D,GAAemE,GAA8Br3D,GAAcm3B,MAGlMt/B,EAAAA,EAAAA,WAAU,KAER,MAAMsiF,EACJnyE,GAASrE,SACTqE,GAASob,oBACTpb,GAASq/C,iBACTr/C,GAASmI,gBACTnI,GAASymE,UACTzmE,GAASjQ,iBACRiQ,GAASsV,eAAiBtV,GAASsV,cAAc9hB,OAAS,GAC1DwM,GAASyb,oBAAsBzb,GAASyb,mBAAmBlQ,KAAKyrD,GAAKA,EAAE14C,OAIpE8zD,GAAiB3sE,SAAS4sE,OAShC,IAAKh4E,KAAY83E,GAAmB1iF,IAAYo8B,IAAoBw3B,IAAmBI,GAAmBjqD,UAAY4/C,GAAAA,QAAa80B,sBAAwBkE,IAAkBlwB,GAC3K,OAMF,MAAMowB,EAAgBx4E,WAAW,KAC/B+5D,IAAU,IACT,KAGH,MAAO,IAAMvvD,aAAaguE,IACzB,CAACtyE,GAAU3F,GAAS5K,GAAUo8B,GAAkBw3B,GAAiBnB,MAGpEryD,EAAAA,EAAAA,WAAU,KACR,MAAM0iF,EAAyBA,KACzB9sE,SAAS4sE,QAOf,OADA5sE,SAASjB,iBAAiB,mBAAoB+tE,GACvC,IAAM9sE,SAAShB,oBAAoB,mBAAoB8tE,IAC7D,CAACvyE,GAAU3F,MAEdxK,EAAAA,EAAAA,WAAU,KACR,MAAM2iF,EAAsB/gF,IAE1B,IACE,MAAMm/C,EAAkBqO,GAAqBzlD,QACvCi5E,EAAiB7hC,EAAkBA,EAAgB1sC,UAAatK,OAAO84E,aAAejtE,SAASirE,gBAAgBxsE,UACrHk1C,GAAAA,QAAaS,aAAa,CAAE44B,kBAC9B,CAAE,MAAOxhF,GACT,CAGA,MAAM0hF,EAAqB9rD,GAAY10B,OAAO2uD,IAC3CA,EAAI8xB,UACU,aAAf9xB,EAAIjtC,SACHitC,EAAI+xB,YACL/xB,EAAIC,MAGA+xB,EAA0BjsD,GAAY10B,OAAO2uD,KAC/CA,EAAIwZ,aAA0C,KAA3BxZ,EAAIwZ,YAAYvlE,UACpC+rD,EAAI+xB,YAIP,GAAIF,EAAmBn/E,OAAS,GAAKs/E,EAAwBt/E,OAAS,EAAG,CACvE,IACE,MAAMw6E,EAAoB,IAAI2E,KAAuBG,GAAyBj/E,IAAIitD,IAAG,CACnFjlD,GAAIilD,EAAIjlD,GACRL,KAAMslD,EAAItlD,KACVb,KAAMmmD,EAAInmD,KACVhQ,KAAMm2D,EAAIn2D,KACV2vE,YAAaxZ,EAAIwZ,aAAe,GAChCyY,WAAYjyB,EAAIiyB,WAChBC,aAAclyB,EAAIkyB,cAAgB/jE,KAAKC,MAEvC+jE,kBAAkB,KAGd3yB,EAAU,uBAAA1kD,OAA0BoE,GAASnE,IAAM,SACzD6G,aAAaC,QAAQ29C,EAAYjvD,KAAKuR,UAAUorE,IAEhDvtB,GAAY,OAAQ,cAAe,aAAa,gBAAD7kD,OAClCoyE,EAAkBx6E,OAAM,uDACvC,CAAE,MAAOvC,GACPwvD,GAAY,QAAS,cAAe,mBAAoBxvD,EAAMoE,QAChE,CAGAorD,GAAY,UAAW,cAAe,kBAAkB,kCAAD7kD,OAC9B+2E,EAAmBn/E,OAAM,2BAAAoI,OAAkBk3E,EAAwBt/E,OAAM,2CACpG,GAGI0/E,EAAiBA,KAErB,MAAMP,EAAqB9rD,GAAY10B,OAAO2uD,IAC3CA,EAAI8xB,UAA2B,aAAf9xB,EAAIjtC,SAA0BitC,EAAI+xB,YAAc/xB,EAAIC,MAEjE+xB,EAA0BjsD,GAAY10B,OAAO2uD,KAC/CA,EAAIwZ,aAA0C,KAA3BxZ,EAAIwZ,YAAYvlE,UAAmB+rD,EAAI+xB,YAG9D,GAAIF,EAAmBn/E,OAAS,GAAKs/E,EAAwBt/E,OAAS,EAEpE,IACE,MAAMw6E,EAAoB,IAAI2E,KAAuBG,GAAyBj/E,IAAIitD,IAAG,CACnFjlD,GAAIilD,EAAIjlD,GACRL,KAAMslD,EAAItlD,KACVb,KAAMmmD,EAAInmD,KACVhQ,KAAMm2D,EAAIn2D,KACV2vE,YAAaxZ,EAAIwZ,aAAe,GAChCyY,WAAYjyB,EAAIiyB,WAChBC,aAAclyB,EAAIkyB,cAAgB/jE,KAAKC,MACvC+jE,kBAAkB,KAGd3yB,EAAU,uBAAA1kD,OAA0BoE,GAASnE,IAAM,SACzD6G,aAAaC,QAAQ29C,EAAYjvD,KAAKuR,UAAUorE,IAEhDvtB,GAAY,OAAQ,cAAe,qBAAqB,gBAAD7kD,OAC1CoyE,EAAkBx6E,OAAM,yDACvC,CAAE,MAAOvC,GACPwvD,GAAY,QAAS,cAAe,2BAA4BxvD,EAAMoE,QACxE,GASJ,OAJAuE,OAAO4K,iBAAiB,eAAgBguE,GACxC54E,OAAO4K,iBAAiB,WAAY0uE,GAG7B,KACLt5E,OAAO6K,oBAAoB,eAAgB+tE,GAC3C54E,OAAO6K,oBAAoB,WAAYyuE,KAExC,CAACrsD,GAAa7mB,GAAU3F,GAAS89D,GAAkBn4D,GAASnE,KAG/D,MAAMs3E,IAAkB3wE,EAAAA,EAAAA,aAAY,CAAC8F,EAAW1W,MAQzB6xD,GAAmBjqD,SAAW4/C,GAAAA,QAAa80B,sBAAwBz+E,KAAao8B,IAAoBq2B,IAGvHhsC,IAAgB,IAGjB,CAACnW,GAAkBtQ,GAAUo8B,GAAkBq2B,GAAehsC,MAGjErmB,EAAAA,EAAAA,WAAU,KAER,IACE,MAAMrH,EAAM6R,GAAO,mBAAAuB,OAAsBvB,IAAY,kBAC/C+4E,EAAS1wE,aAAagB,QAAQlb,GACpC,GAAI4qF,EAAQ,CACV,MAAMC,EAAYhiF,KAAKC,MAAM8hF,GACzB7hF,MAAMC,QAAQ6hF,IAChBznB,GAAkBynB,EAEtB,CACF,CAAE,MAAOpiF,GACT,CAGIxC,IAASC,IAAY2L,IAEvBi5E,MAED,CAACj5E,GAAS5L,GAAOC,KAEpB,MAAM07B,GAAiBJ,IACrBkwB,GAAiBroD,IACf,MAAM0hF,GAASzhF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACVD,GAAI,IACP,CAACm4B,IAAcn4B,EAAKm4B,KAkBtB,MAr9HuBoF,KACzB,GAAK/0B,GACL,IACE++C,GAAAA,QAAagpB,YAAY,CAAE15D,aAAc0mB,GAC3C,CAAE,MAAOn+B,GACP,GAi8HAuiF,CAAkBD,GAGC,YAAfvpD,GAA4Bn4B,EAAKm4B,KAAgBupD,EAAUvpD,IAKzDhqB,GAASnE,IAAMpN,IAASC,KAAaqrD,IAAc/hD,IAAgB,GACrE8B,WAAW,KACTqjE,MACC,KAIAoW,KAwDLE,GAA0BC,IAC9B,MAAMC,EAAgB9sD,GAAY10B,OAAO4uD,GACvCA,EAAKvlD,KAAKshB,gBAAkB42D,EAAY52D,eAE1C,OAAO62D,EAAcngF,OAAS,EAAImgF,EAAc,GAAK,MAIjDC,GAAoBrtE,IAExB,GAAInG,KAAwBE,GAE1B,YADAu3C,IAAaA,GAAU,8FAAoE,CAAEltD,KAAM,aAIrG,IAAK4b,GAA0B,IAAjBA,EAAM/S,OAClB,OAIF,MAAMqgF,EAA0BhtD,GAC7B10B,OAAO41B,GAA0B,SAArB+rD,GAAc/rD,KAA+B,aAAbA,EAAElU,QAAsC,cAAbkU,EAAElU,SACzEulB,OAAO,CAACmjC,EAAKx0C,IAAMw0C,GAAOx0C,EAAEptB,MAAQ,GAAI,GAErCo5E,EAAexiF,MAAMiV,KAAKD,GAAO6yB,OAAO,CAACmjC,EAAKxb,IAASwb,EAAMxb,EAAKpmD,KAAM,GACxEq5E,EAAYH,EAA0BE,EAG5C,GAAIC,EAFiB,UAES,CAC5B,MAAMC,GAAkBJ,EAA0B,KAAO,MAAM1kC,QAAQ,GACjE+kC,GAAaH,EAAe,KAAO,MAAM5kC,QAAQ,GACjDglC,GAAeH,EAAY,KAAO,MAAM7kC,QAAQ,GAWtD,YATA0I,IAAaA,GACX,uHAAAj8C,OACyBq4E,EAAc,SAAO,2BAAAr4E,OAC3Bs4E,EAAS,SAAO,gCAAAt4E,OACbu4E,EAAW,SAHjC,8JAMA,CAAExpF,KAAM,QAASiuB,QAAS,MAG9B,CAEAkwC,IAAkB,GAGlB,MAAMsrB,EAAW7iF,MAAMiV,KAAKD,GAAO1S,IAAI,CAACktD,EAAM3iC,KAE5C,KAAKi2D,EAAAA,GAAAA,IAAkBtzB,EAAKvlD,MAAO,CAAC,IAAD84E,EACjC,MAAMC,GAA0C,QAA1BD,EAAAvzB,EAAKvlD,KAAK8pB,MAAM,KAAKkvD,aAAK,IAAAF,OAAA,EAA1BA,EAA4Bx3D,gBAAiB,sBAenE,OAbA+6B,IAAaA,GACX,wCAAAj8C,OAAgCmlD,EAAKvlD,KAAI,yDAAAI,OACd24E,EAAa,MADxC,0VAUA,CAAE5pF,KAAM,QAASiuB,QAAS,MAErB,IACT,CAGA,MAAM67D,GAAc1zB,EAAKpmD,KAAO,KAAO,MAAMw0C,QAAQ,GAGrD,KAAKulC,EAAAA,GAAAA,IAAkB3zB,EAAKpmD,KAFV,IAUhB,OAPAk9C,IAAaA,GACX,kBAAAj8C,OAAamlD,EAAKvlD,KAAI,2EAAAI,OACE64E,EAAU,SAAO,sDAAA74E,OAL3B,GAM8B,WAAS,0EAErD,CAAEjR,KAAM,QAASiuB,QAAS,MAErB,KAIT,MAAM+7D,EAAYlB,GAAuB1yB,EAAKvlD,MAKxCmS,GAAWinE,EAAAA,GAAAA,IAAyB7zB,GAE1C,MAAO,CACLllD,GAAI8R,EAAS9R,GACbg5E,KAAMlnE,EAASknE,KACfr5E,KAAMulD,EAAKvlD,KACXs5E,aAAcnnE,EAASmnE,aACvBC,cAAepnE,EAASonE,cACxBC,gBAAiBrnE,EAASqnE,gBAC1Br6E,KAAMomD,EAAKpmD,KACXhQ,KAAMo2D,EAAKp2D,KACX2vE,YAAa,GACbyY,WAAYplE,EAASsnE,cAAe,IAAIhmE,MAAOsY,cAC/C1T,OAAQ,yBACRktC,KAAMA,EACNC,YAAa,KACb4xB,SAAU,KACVsC,WAAY,KACZC,cAAeR,EACfS,aAAsB,OAATT,QAAS,IAATA,OAAS,EAATA,EAAW94E,KAAM,QAE/B1J,OAAOiZ,SAGV40C,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP82B,kBAAmB,IAAK92B,EAAK82B,mBAAqB,MAAQyrD,MAG5D34B,GAAe5pD,GAAQ,IAAIA,KAASuiF,IAEpCtrB,IAAkB,IA6IdjiD,GAAoBpV,IACxB,MAAM8U,EAAQ9U,EAAE2C,OAAOmS,MACnBA,EAAM/S,OAAS,GACjBogF,GAAiBrtE,GAGnB9U,EAAE2C,OAAOxC,MAAQ,IAqIbyjF,GAAuBvkF,eAAOwkF,EAAQhb,GAAsC,IAADib,EAAA,IAAxBC,EAAU/oE,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,OACpE,MAAMs0C,EAAiC,QAA7Bw0B,EAAGv1E,GAAS2oB,yBAAiB,IAAA4sD,OAAA,EAA1BA,EAA4B3oE,KAAKmb,GAAKA,EAAElsB,KAAOy5E,GAE5D,GAAKv0B,EAAL,CAMA,IAAKA,EAAKA,KASR,OARAN,GAAY,QAAS,cAAe,wBAAwB,UAAD7kD,OAC/CmlD,EAAKvlD,KAAI,kFACrBq8C,IAAaA,GACX,iCAAAj8C,OAAoBmlD,EAAKvlD,KAAI,SAA7B,kFAGA,CAAE7Q,KAAM,UAAWiuB,QAAS,OAKhC,GAAoB,aAAhBmoC,EAAKltC,OAMT,IAAK,IAAD4hE,EAAAC,EAqBF,GAnBA11B,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP82B,kBAAmB92B,EAAK82B,kBAAkB90B,IAAIk0B,GAC5CA,EAAElsB,KAAOy5E,GAAMxjF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACNi2B,GAAC,IAAElU,OAAQ,YAAamtC,YAAa,KAAM20B,YAAaH,IAC7DztD,MAIR0zB,GAAe5pD,GAAQA,EAAKgC,IAAIk0B,GAC9BA,EAAElsB,KAAOy5E,GAAMxjF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACNi2B,GAAC,IAAElU,OAAQ,YAAamtC,YAAa,KAAM20B,YAAaH,IAC7DztD,IAGN04B,GAAY,OAAQ,cAAe,eAAe,yBAAD7kD,OAC5BmlD,EAAKvlD,KAAI,sBAAAI,OAAkB0+D,EAAW,gBAAA1+D,OAAe45E,EAAU,0BAG/Ex1E,GAASnE,GAEZ,MADAg8C,GAAU,sGAAyE,SAC7E,IAAIziC,MAAM,mDAGlB,MAAMrkB,QAAe6kF,EAAAA,GAAAA,IACnB51E,GAASnE,GACTklD,EAAKA,KACLryD,GACAD,GACA6rE,EACAkb,GAGF/0B,GAAY,UAAW,cAAe,iBAAiB,UAAD7kD,OAC1CmlD,EAAKvlD,KAAI,wCAAmBzK,GAGxC,MAAM8kF,GAA0B,QAAXJ,EAAA1kF,EAAOkK,YAAI,IAAAw6E,OAAA,EAAXA,EAAaK,iBAA4B,QAAfJ,EAAI3kF,EAAOkK,YAAI,IAAAy6E,OAAA,EAAXA,EAAa75E,IAGhEmkD,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP82B,kBAAmB92B,EAAK82B,kBAAkB90B,IAAIk0B,IAAC,IAAAguD,EAAAC,EAAAC,EAAA,OAC7CluD,EAAElsB,KAAOy5E,GAAMxjF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAENi2B,GAAC,IACJlU,OAAQ,WACR++D,SAAUiD,EACVX,YAAuB,QAAXa,EAAAhlF,EAAOkK,YAAI,IAAA86E,OAAA,EAAXA,EAAalB,OAAQ9zB,EAAKi0B,gBACtCh0B,YAAa,KACbD,KAAM,KACNm1B,oBAAgC,QAAbF,EAAEjlF,EAAOkK,YAAI,IAAA+6E,OAAA,EAAXA,EAAaG,oBAClCC,iBAA6B,QAAbH,EAAEllF,EAAOkK,YAAI,IAAAg7E,OAAA,EAAXA,EAAaG,mBAEjCruD,OAIR0zB,GAAe5pD,GAAQA,EAAKgC,IAAIk0B,IAAC,IAAAsuD,EAAAC,EAAAC,EAAA,OAC/BxuD,EAAElsB,KAAOy5E,GAAMxjF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAENi2B,GAAC,IACJlU,OAAQ,WACR++D,SAAUiD,EACVX,YAAuB,QAAXmB,EAAAtlF,EAAOkK,YAAI,IAAAo7E,OAAA,EAAXA,EAAaxB,OAAQ9zB,EAAKi0B,gBACtCh0B,YAAa,KACbD,KAAM,KACNm1B,oBAAgC,QAAbI,EAAEvlF,EAAOkK,YAAI,IAAAq7E,OAAA,EAAXA,EAAaH,oBAClCC,iBAA6B,QAAbG,EAAExlF,EAAOkK,YAAI,IAAAs7E,OAAA,EAAXA,EAAaH,mBAEjCruD,KAIN,MAAMyuD,GACJ/jF,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEohE,WAAY,uCAAwCjqD,WAAY,OAAQ/X,SAAA,EACpFC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVc,SAAU,OACVoW,WAAY,MACZE,aAAc,MACdjX,MAAO,UACPoB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,OACL9J,SAAA,EACAD,EAAAA,GAAAA,KAACmN,EAAAA,EAAY,CAAC/E,KAAM,GAAIpH,MAAM,UAAUH,MAAO,CAAEqhE,WAAY,MAC7DliE,EAAAA,GAAAA,KAAA,QAAAC,SAAM,6DAERD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVC,QAAS,MACTwiE,gBAAiB,UACjBliE,aAAc,MACdO,SAAU,OACVX,MAAO,WACPf,SACCuuD,EAAKvlD,UAIZq8C,IAAaA,GAAU2+B,EAAgB,CAAE7rF,KAAM,YAG/C,IACE,MAAM21D,EAAU,uBAAA1kD,OAA0BoE,GAASnE,IAAM,SACnD0kD,EAAsB79C,aAAagB,QAAQ48C,GAEjD,GAAIC,EAAqB,CACvB,MAEMk2B,EAFmBplF,KAAKC,MAAMivD,GAESpuD,OAAO2uD,GAAOA,EAAIjlD,KAAOy5E,GAEnC,IAA/BmB,EAAoBjjF,QAEtBkP,aAAau+C,WAAWX,GACxBG,GAAY,OAAQ,cAAe,aAAc,oFAGjD/9C,aAAaC,QAAQ29C,EAAYjvD,KAAKuR,UAAU6zE,IAChDh2B,GAAY,OAAQ,cAAe,aAAa,8CAAD7kD,OAAuC66E,EAAoBjjF,OAAM,oBAEpH,CACF,CAAE,MAAOvC,GACPwvD,GAAY,QAAS,cAAe,iBAAkBxvD,EAAMoE,QAC9D,CAEF,CAAE,MAAOpE,GAAQ,IAADyoB,EAAAg9D,EACdj2B,GAAY,QAAS,cAAe,eAAe,0BAAD7kD,OAC3BmlD,EAAKvlD,KAAI,MAAAI,OAAK3K,EAAMoE,UAG3C2qD,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP82B,kBAAmB92B,EAAK82B,kBAAkB90B,IAAIk0B,GAC5CA,EAAElsB,KAAOy5E,GAAMxjF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAENi2B,GAAC,IACJlU,OAAQ,QACRmtC,YAAa/vD,EAAMoE,UAErB0yB,MAIR0zB,GAAe5pD,GAAQA,EAAKgC,IAAIk0B,GAC9BA,EAAElsB,KAAOy5E,GAAMxjF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAENi2B,GAAC,IACJlU,OAAQ,QACRmtC,YAAa/vD,EAAMoE,UAErB0yB,IAIN,MAAM7O,GAAyB,QAAdQ,EAAAzoB,EAAMkiB,gBAAQ,IAAAuG,GAAM,QAANg9D,EAAdh9D,EAAgBze,YAAI,IAAAy7E,OAAN,EAAdA,EAAsBrhF,UAAWpE,EAAMoE,SAAW,sBACnEwiD,GAAU,6DAADj8C,OAAmCmlD,EAAKvlD,KAAI,OAAAI,OAAMsd,GAAY,QACzE,MAnKEunC,GAAY,OAAQ,cAAe,mBAAmB,UAAD7kD,OACzCmlD,EAAKvlD,KAAI,qCAhBvB,MAHEilD,GAAY,QAAS,cAAe,iBAAiB,eAAD7kD,OACnC05E,EAAM,sCAqL3B,EAGMqB,GAAoC7lF,iBAA+B,IAAxB8lF,EAAUnqE,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,IAAAA,UAAA,GACzD,GAAKzM,GAASnE,GAKd,IAAK,IAADg7E,EAAAC,EAAAC,EACF/tB,IAA6B,GAI7B,MAAMguB,QAAqBC,EAAAA,GAAAA,IACzBj3E,GAASnE,GACTnN,GACAD,IAIIyoF,GAA4B,OAAZF,QAAY,IAAZA,GAAkB,QAANH,EAAZG,EAAc/7E,YAAI,IAAA47E,OAAN,EAAZA,EAAoBhwD,eAA2B,OAAZmwD,QAAY,IAAZA,OAAY,EAAZA,EAAc/7E,OAAQ,GAI/E,IAAIk8E,EAAe,KACnB,GAAID,EAAc1jF,OAAS,EACzB,IACE2jF,QAAqBC,EAAAA,GAAAA,IACnBp3E,GAASnE,GACTnN,GACAD,GAGJ,CAAE,MAAO4oF,GACT,CAKF,MAAMC,EAAS,CACbC,WAAW,EAEXC,oBAAqB,GACrBC,gBAAiB,GACjBC,eAAgB,GAChBC,WAAY,GACZC,aAAc,GACdC,kBAAmB,IAIrBhxD,GAAY/e,QAAQ,CAACgwE,EAAU15D,KAC7B,IAcE,GAZK05D,EAASxd,aAAwC,KAAzBwd,EAASxd,cACpCgd,EAAOE,oBAAoBnoE,KAAKyoE,GAChCR,EAAOC,WAAY,GAIG,UAApBO,EAASjkE,SACXyjE,EAAOM,aAAavoE,KAAKyoE,GACzBR,EAAOC,WAAY,GAIjBO,EAASlF,SAAU,CACrB,MAAMmF,EAAcz9E,OAAOw9E,EAASlF,UAClBsE,EAActqE,KAAKorE,GACnCA,EAAMn8E,GAAGV,aAAe48E,GACxBC,EAAMn8E,GAAGV,aAAe48E,EAAY3lE,QAAQ,UAAW,OAGvDklE,EAAOG,gBAAgBpoE,KAAKyoE,GAC5BR,EAAOC,WAAY,EAEvB,KAA+B,aAApBO,EAASjkE,QAA6C,cAApBikE,EAASjkE,SAEpDyjE,EAAOG,gBAAgBpoE,KAAKyoE,GAC5BR,EAAOC,WAAY,EAEvB,CAAE,MAAOU,GACP,IAKJf,EAAcpvE,QAAQ,CAACkwE,EAAO55D,KAC5B,IAEyByI,GAAYja,KAAKkrE,IACtC,IAAKA,EAASlF,SAEZ,OAAOkF,EAASt8E,OAASw8E,EAAME,0BAAgD,aAApBJ,EAASjkE,OAGtE,MAAMkkE,EAAcz9E,OAAOw9E,EAASlF,UAC9BuF,EAAUH,EAAMn8E,GAAGV,WACzB,OACE48E,IAAgBI,GAChBJ,IAAW,UAAAn8E,OAAeu8E,IAC1BJ,EAAY3lE,QAAQ,UAAW,MAAQ+lE,GACtCL,EAASt8E,OAASw8E,EAAME,0BAAgD,aAApBJ,EAASjkE,WAIhEyjE,EAAOK,WAAWtoE,KAAK2oE,GACvBV,EAAOC,WAAY,EAEvB,CAAE,MAAOa,GACP,IAMJ,MAAMC,GAAkC,QAAZvB,EAAAK,SAAY,IAAAL,GAAM,QAANC,EAAZD,EAAc77E,YAAI,IAAA87E,OAAN,EAAZA,EAAoBlwD,cAAe,GA4B/D,GA3BIwxD,EAAoB7kF,OAAS,GAC/B6kF,EAAoBvwE,QAAQg5C,KAEF,IAApBA,EAAIuZ,aACNid,EAAOI,eAAeroE,KAAK,CACzB7T,KAAMslD,EAAIw3B,eAAiB,gBAC3B1F,SAAU9xB,EAAIg1B,eAAiBh1B,EAAIjlD,GACnC08E,KAAMz3B,EAAI03B,aAAe13B,EAAI+zB,KAC7B4D,WAAY33B,EAAI+zB,KAChBhhE,OAAQitC,EAAIjtC,SAEdyjE,EAAOC,WAAY,IAGO,IAAnBz2B,EAAI43B,aACXpB,EAAOO,kBAAkBxoE,KAAK,CAC5B7T,KAAMslD,EAAIw3B,eAAiB,gBAC3B1F,SAAU9xB,EAAIg1B,eAAiBh1B,EAAIjlD,GACnC88E,MAAM,qBAAD/8E,OAAuBklD,EAAI83B,QAAO,YAAAh9E,OAAWklD,EAAI+3B,YAAW,KACjEhlE,OAAQitC,EAAIjtC,SAEdyjE,EAAOC,WAAY,KAMpBD,EAAOC,WAKV,GAAIv/E,IAAgB,IAAM4+E,EAAY,CACpC,IAAIkC,EAAa,0DAEbxB,EAAOE,oBAAoBhkF,OAAS,IACtCslF,GAAU,gDAAAl9E,OAAuC07E,EAAOE,oBAAoBhkF,OAAM,QAClF8jF,EAAOE,oBAAoB1vE,QAAQg5C,IACjCg4B,GAAU,YAAAl9E,OAAWklD,EAAItlD,KAAI,sCAI/B87E,EAAOG,gBAAgBjkF,OAAS,IAClCslF,GAAU,0DAAAl9E,OAAyC07E,EAAOG,gBAAgBjkF,OAAM,QAChF8jF,EAAOG,gBAAgB3vE,QAAQg5C,IAC7Bg4B,GAAU,YAAAl9E,OAAWklD,EAAItlD,KAAI,OAAAI,OAAMklD,EAAI8xB,SAAW,kBAAY,eAAW,SAIzE0E,EAAOK,WAAWnkF,OAAS,IAC7BslF,GAAU,4CAAAl9E,OAAmC07E,EAAOK,WAAWnkF,OAAM,QACrE8jF,EAAOK,WAAW7vE,QAAQg5C,IACxBg4B,GAAU,YAAAl9E,OAAWklD,EAAIo3B,yBAAwB,UAAAt8E,OAASklD,EAAIjlD,GAAE,yCAIhEy7E,EAAOI,eAAelkF,OAAS,IACjCslF,GAAU,6CAAAl9E,OAAoC07E,EAAOI,eAAelkF,OAAM,QAC1E8jF,EAAOI,eAAe5vE,QAAQg5C,IAC5Bg4B,GAAU,YAAAl9E,OAAWklD,EAAItlD,KAAI,MAAAI,OAAKklD,EAAIy3B,MAAQz3B,EAAI23B,WAAU,UAI5DnB,EAAOO,kBAAkBrkF,OAAS,IACpCslF,GAAU,6CAAAl9E,OAA+B07E,EAAOO,kBAAkBrkF,OAAM,QACxE8jF,EAAOO,kBAAkB/vE,QAAQg5C,IAC/Bg4B,GAAU,YAAAl9E,OAAWklD,EAAItlD,KAAI,OAAAI,OAAMklD,EAAI63B,MAAK,SAI5CrB,EAAOM,aAAapkF,OAAS,IAC/BslF,GAAU,sCAAAl9E,OAA4B07E,EAAOM,aAAapkF,OAAM,QAChE8jF,EAAOM,aAAa9vE,QAAQg5C,IAC1Bg4B,GAAU,YAAAl9E,OAAWklD,EAAItlD,KAAI,SAIjCq8C,GAAUihC,EAAY,SAGlBxB,EAAOK,WAAWnkF,OAAS,GAC7BqkD,IAAaA,GACX,YAAAj8C,OAAY07E,EAAOK,WAAWnkF,OAAM,2KACU,CAC9C7I,KAAM,OACNiuB,QAAS,EACT8nC,OAAQ,CACNC,YAAa,eACbC,WAAY,KACZvoB,UAAWvnC,gBACHioF,GAAyBzB,EAAOK,eAK9C,OAGF,OAAOL,CAET,CAAE,MAAOrmF,GAEP4mD,GACE,iDAAAj8C,OAAyC3K,EAAMoE,QAAO,QAAtD,sJAKA,QAEJ,CAAC,QACC2zD,IAA6B,EAC/B,MAjOEnR,GAAU,sDAAiD,UAkO/D,EAGMkhC,GAA2BjoF,UAC/B,IAEE,IAAKomF,IAAkB3lF,MAAMC,QAAQ0lF,GAAgB,CACnD,IAAKl3E,GAASnE,GAEZ,YADAg8C,GAAU,mEAA8C,WAI1D,IAAK,IAADmhC,EACF,MAAMjoF,QAAekmF,EAAAA,GAAAA,IACnBj3E,GAASnE,GACTnN,GACAD,IAGIwqF,GAAuB,OAANloF,QAAM,IAANA,GAAY,QAANioF,EAANjoF,EAAQkK,YAAI,IAAA+9E,OAAN,EAANA,EAAcnyD,eAAqB,OAAN91B,QAAM,IAANA,OAAM,EAANA,EAAQkK,OAAQ,GAEpE,IAAK1J,MAAMC,QAAQynF,GAEjB,YADAphC,GAAU,qEAAsD,SAIlEq/B,EAAgB+B,CAClB,CAAE,MAAOhoF,GAEP,YADA4mD,GAAU,qEAAwC,QAEpD,CACF,CAEA,MAAMgJ,EAAsBq2B,EAAcrjF,IAAIqlF,IAAUpnF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACnDqnF,GAAwBD,IAAW,IACtCE,YAAY,KAId39B,GAAe5pD,IACb,MAAMwnF,EAAc,IAAIrqD,IAAIn9B,EAAKgC,IAAIitD,GAAOA,EAAI8xB,UAAY9xB,EAAIjlD,KAC1D4kE,EAAiB5f,EAAoB1uD,OAAO2uD,IAC/Cu4B,EAAY9pD,IAAIuxB,EAAI8xB,YAAcyG,EAAY9pD,IAAIuxB,EAAIjlD,KAIzD,MAAO,IAAIhK,KAAS4uE,KAGtB5oB,GAAU,mBAADj8C,OACOilD,EAAoBrtD,OAAM,6CACxC,UAGJ,CAAE,MAAOvC,GACP4mD,GAAU,2BAADj8C,OAAsB3K,EAAMoE,SAAW,QAClD,GAMI8nE,GAAyBrsE,UAC7B,GAAKkP,GAASnE,IAAOpN,IAAUC,KAI3B6tB,GAAczS,QAKlB,IAGE,MAAMwvE,EAA0BzyD,GAAY10B,OAAO2uD,IAChDA,EAAI8xB,UACU,aAAf9xB,EAAIjtC,SACHitC,EAAI+xB,YAIDoG,QAAuBM,KAIvBC,EAAoB,IAHJP,EAAeplF,IAAIslF,OAKpCG,GAIL79B,GAAe+9B,GAGXA,EAAkBhmF,OAAS,GAE7BsG,WAAW,KACT68E,IAAkC,IACjC,IAGP,CAAE,MAAO1lF,GACP4mD,GAAU,qBAADj8C,OAAsB3K,EAAMoE,SAAW,QAClD,GAkLIokF,GAAsBnE,IAE1Bt1B,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP82B,mBAAoB92B,EAAK82B,mBAAqB,IAAIx2B,OAAO4uD,GAAQA,EAAKllD,KAAOy5E,MAG/E75B,GAAe5pD,GAAQA,EAAKM,OAAO4uD,GAAQA,EAAKllD,KAAOy5E,KAuCnDoE,GAAiBA,KACM,IAAvB7yD,GAAYrzB,OAMhB81D,IAAkC,GALhCzR,GAAU,wDAA8B,SA+BtC0hC,GAA0BzoF,UAAa,IAAD6oF,EAC1C,IAAK35E,GAASnE,KAAOpN,KAAUC,GAC7B,MAAM,IAAI0mB,MAAM,yEAGlB,GAAImH,GAAczS,QAChB,MAAM,IAAIsL,MAAM,oFAGlB,MAAMrkB,QAAekmF,EAAAA,GAAAA,IACnBj3E,GAASnE,GACTnN,GACAD,IAIIwqF,GAAuB,OAANloF,QAAM,IAANA,GAAY,QAAN4oF,EAAN5oF,EAAQkK,YAAI,IAAA0+E,OAAN,EAANA,EAAc9yD,eAAqB,OAAN91B,QAAM,IAANA,OAAM,EAANA,EAAQkK,OAAQ,GAEpE,IAAK1J,MAAMC,QAAQynF,GACjB,MAAM,IAAI7jE,MAAM,wCAGlB,OAAO6jE,GAIHE,GAA2BD,IAI/B,MAAMU,EAAaV,EAAWV,aAAeU,EAAWlE,iBAAmBkE,EAAWW,gBAAkB,GAClGC,EAAWF,EAAWt0D,MAAM,KAAKkvD,OAASoF,EAEhD,IAAIpE,EAAa,OACbsE,EAASpyE,WAAW,OACtB8tE,EAAa,MACJsE,EAASpyE,WAAW,UAC7B8tE,EAAa,QAoCf,MAjCe,CAEb35E,GAAG,UAADD,OAAYs9E,EAAWr9E,IACzB+2E,SAAUsG,EAAWr9E,GACrB6c,cAAewgE,EAAW1hE,UAAY0hE,EAAWxgE,cACjDm8D,KAAMqE,EAAWrE,KACjBjU,YAAasY,EAAWvuF,MAAQuuF,EAAWtY,YAC3CsX,yBAA0BgB,EAAWZ,eAAiBY,EAAWhB,yBACjElD,gBAAiBkE,EAAWV,YAC5BuB,gBAAiBb,EAAWV,YAC5BwB,SAAUd,EAAWe,WAAaf,EAAWc,UAAYd,EAAWgB,mBACpEz0D,aAAcyzD,EAAWiB,aAAejB,EAAWkB,YAAclB,EAAWzzD,aAC5E04C,eAAgB+a,EAAWmB,YAAcnB,EAAW/a,eACpD+X,oBAAqBgD,EAAW/C,qBAAuB+C,EAAWhD,oBAClEE,iBAAkB8C,EAAW9C,iBAC7B/b,YAAa6e,EAAW7e,YACxBsb,YAAaH,EAGbh6E,KAAM09E,EAAWZ,eAAiBY,EAAWhB,yBAC7Cv9E,KAAMu+E,EAAWe,WAAaf,EAAWc,UAAYd,EAAWgB,mBAChEvvF,KAAM,2BACNqoF,aAAc,IAAI/jE,KAAKiqE,EAAWiB,aAAejB,EAAWkB,YAAclB,EAAWzzD,cAAgBxW,KAAKC,OAAOysB,UACjH2+B,YAAa4e,EAAWvuF,MAAQuuF,EAAWtY,YAC3C0Z,gBAAiBpB,EAAWV,YAG5B3kE,OAAQ,WACRk/D,WAAYmG,EAAWiB,aAAejB,EAAWkB,YAAclB,EAAWzzD,cAAgByzD,EAAW/a,gBAAkB,KACvH+W,WAAYgE,EAAWrE,KACvBhC,YAAY,IAOViB,GAAiB/yB,IAErB,GAAIA,EAAK40B,YACP,OAAO50B,EAAK40B,YAId,MAAMiE,EAAa74B,EAAKg5B,iBAAmBh5B,EAAKi0B,iBAAmBj0B,EAAKu5B,iBAAmB,GACrFR,EAAWF,EAAWt0D,MAAM,KAAKkvD,OAASoF,EAGhD,OAAIE,EAASpyE,WAAW,OACf,OAELoyE,EAASpyE,WAAW,QACf,SAOL6yE,GAAsBx5B,GACN,UAAhBA,EAAKltC,OAA2B,UAC/BktC,EAAKuZ,YACNvZ,EAAKo0B,aACW,cAAhBp0B,EAAKltC,OADoB,UAET,aAAhBktC,EAAKltC,OAA8B,UAChC,UAJuB,UAO1B2mE,GAA0Bz5B,GACV,UAAhBA,EAAKltC,OAA2B,UAC/BktC,EAAKuZ,YACNvZ,EAAKo0B,aACW,cAAhBp0B,EAAKltC,OADoB,UAET,aAAhBktC,EAAKltC,OAA8B,UAChC,QAJuB,UAyG1B4mE,GAAgBA,CAAC5+E,EAAIlK,EAAOC,KAChCouD,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP4pB,oBAAqB5pB,EAAK4pB,oBAAsB,IAAI5nB,IAAIsqB,IACtD,GAAIA,EAAQtiB,KAAOA,EAAI,CACrB,MAAM6+E,GAAc5oF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQqsB,GAAO,IAAE,CAACxsB,GAAQC,IAG9C,GAAc,iBAAVD,GAAsC,cAAVA,EAAuB,CACrD,MAEMgpF,GAFazyE,YAAYwyE,EAAen8D,cAAgB,KAAKnM,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,IAEnF,GADdlK,WAAWwyE,EAAexlC,YAAc,GACX,KAE9CwlC,EAAel8D,WAAam8D,EAASxrC,QAAQ,EAC/C,CAGA,GAAc,eAAVx9C,EAAwB,CAC1B,MAEMipF,GAFW1yE,YAAYwyE,EAAel8D,YAAc,KAAKpM,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,IAE/E,GADdlK,WAAWwyE,EAAexlC,YAAc,GACX,KAE9CwlC,EAAen8D,aAAeq8D,EAAWzrC,QAAQ,EACnD,CAEA,OAAOurC,CACT,CACA,OAAOv8D,OAMG,cAAVxsB,IAEG8xD,GAAmBjqD,UAAW4/C,GAAAA,QAAa80B,qBAAwBz+E,IAAao8B,KAAoBq2B,IACvGhsC,IAAgB,KAsBhB2kE,GAA8BA,KAAO,IAADC,EAAAv9D,EAAAw9D,EAAAC,EACxC,SAC0B,QAAxBF,EAAA96E,GAASjQ,uBAAe,IAAA+qF,GAAxBA,EAA0B/lF,QACD,QADOwoB,EAChCvd,GAAS/P,wBAAgB,IAAAstB,GAAzBA,EAA2BxoB,QACL,QADWgmF,EACjC/6E,GAAS7P,qBAAa,IAAA4qF,GAAtBA,EAAwBhmF,QACxB,UAAUC,KAA2B,QAAvBgmF,EAACh7E,GAAS7P,qBAAa,IAAA6qF,OAAA,EAAtBA,EAAwBjmF,UAKrCkmF,GAA+BnqF,UAcnC,GAAK+pF,KAML,IACEnxB,GAAyB,CAAElnC,SAAS,IAGpC,MAAMtyB,EAAM8P,GAAS7P,cAAc4E,OAC7BhE,QAAemqF,EAAAA,GAAAA,IAAsB,CACzCzsF,SACAC,YACA2L,WACAlJ,SAAoB,OAAVxC,SAAU,IAAVA,QAAU,EAAVA,GAAYwC,SACtBjB,IAAKA,EACLirF,SAAUjjF,IAAiBA,GAAc,oBASrCkjF,GALkBljF,IAAiBA,GAAc,kBAK/B3G,MAAMC,QAAQT,GAClCA,EAAOoB,OAAOs+D,IAAQ,IAAA4qB,EAAA,OAAgB,QAAZA,EAAA5qB,EAASvgE,WAAG,IAAAmrF,OAAA,EAAZA,EAActmF,UAAW7E,IACnD,IAGJ,GAAIkrF,EAAgB5nF,OAAS,EAAG,CAS9B,MAAMrF,EAAeitF,EAAgBxuE,KAAKkX,IAGxC,GAFgBA,EAAE3yB,UAAkC,KAAtB2yB,EAAE3yB,SAAS4D,QAAgC,OAAf+uB,EAAE3yB,UAAoC,SAAf2yB,EAAE3yB,SAGjF,IACE,MAAMmqF,EAAgBjqF,KAAKC,MAAMwyB,EAAE3yB,UAC7BoqF,EAAsB,OAAV5sF,SAAU,IAAVA,QAAU,EAAVA,GAAYwC,SAGxB2C,EAAUvC,MAAMC,QAAQ+pF,GAAaA,EAAY,CAACA,GAOxD,OAHsBhqF,MAAMC,QAAQ8pF,IACfxnF,EAAQyX,KAAKiwE,GAAUA,GAAUF,EAAcppF,SAASspF,GAG/E,CAAE,MAAO/pF,GACP,OAAO,CACT,CAEF,OAAO,IAIHvD,EAAmBktF,EAAgBxuE,KAAKkX,IAC5C,MAAM23D,EAAU33D,EAAE3yB,UAAkC,KAAtB2yB,EAAE3yB,SAAS4D,QAAgC,OAAf+uB,EAAE3yB,UAAoC,SAAf2yB,EAAE3yB,SAEnF,OADoB2yB,EAAEzpB,SAAyB,IAAdypB,EAAEzpB,SAA+B,MAAdypB,EAAEzpB,UAAqBohF,IAKvErtF,EAAiBgtF,EAAgBxuE,KAAKkX,IAC1C,MAAM23D,EAAU33D,EAAE3yB,UAAkC,KAAtB2yB,EAAE3yB,SAAS4D,QAAgC,OAAf+uB,EAAE3yB,UAAoC,SAAf2yB,EAAE3yB,SAEnF,OADgC,IAAd2yB,EAAEzpB,SAA+B,MAAdypB,EAAEzpB,WAAqBohF,IAM9D/xB,GAAyB,CACvBgyB,QAAQ,EACRxtF,iBAAkBA,GAAoB,KACtCC,aAAcA,GAAgB,KAC9BC,eAAgBA,GAAkB,KAElCqiE,SAAUviE,GAAoBC,GAAgBC,GAElD,MAEEs7D,GAAyB,CACvBgyB,QAAQ,EACRxtF,iBAAkB,KAClBC,aAAc,KACdC,eAAgB,KAChBqiE,SAAU,OAKdjH,IAAyB,EAC3B,CAAE,MAAOv4D,GACE,OAAT4mD,SAAS,IAATA,IAAAA,GAAY,mDAA4C,SACxD6R,GAAyB,KAC3B,MAvGW,OAAT7R,SAAS,IAATA,IAAAA,GAAY,wFAAiE,YA+N3E8jC,GAA0B7qF,iBAAmC,IAA5B8qF,EAAiBnvE,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,GAEzD,GAAI86C,GAAoB/zD,OAAS,EAC3BooF,GAAqBA,EAAkBpoF,QAAU,EACnDqoF,GAAsBD,GAEtBx0B,GAAyBG,QAJ7B,CASAD,IAAyB,GAEzB,IACE,MAAMv2D,QAAemqF,EAAAA,GAAAA,IAAsB,CACzCzsF,MAAOA,GACPC,SAAUA,GACV2L,QAASA,GACTlJ,UAAoB,OAAVxC,SAAU,IAAVA,QAAU,EAAVA,GAAYwC,gBAAYub,EAClCyuE,SAAUjjF,IAAiBA,GAAc,oBAG3C,GAAI3G,MAAMC,QAAQT,GAIhB,GAHAy2D,GAAuBz2D,GAGnB6qF,GAAqBA,EAAkBpoF,QAAU,EAAG,CAEtD,MAAMsoF,EAAmB3/C,GAAcy/C,GAGjCG,EAAWhrF,EAAOoB,OAAOs+D,IAC7B,MAAMj1D,EAAO2gC,GAAcs0B,EAAS3gE,OAAS2gE,EAASj1D,MAAQ,IACxDtL,GAAOugE,EAASvgE,KAAO,IAAI4sB,cAC3BxB,GAASm1C,EAAS//D,eAAiB+/D,EAASn1C,OAAS,IAAIwB,cACzDk/D,EAAU7/C,GAAcs0B,EAASjgE,eAAiB,IAExD,OAAOgL,EAAKtJ,SAAS4pF,IACd5rF,EAAIgC,SAAS0pF,EAAkB9+D,gBAC/BxB,EAAMppB,SAAS0pF,EAAkB9+D,gBACjCk/D,EAAQ9pF,SAAS4pF,KAE1B10B,GAAyB20B,EAC3B,MACE30B,GAAyBr2D,QAG3By2D,GAAuB,IACvBJ,GAAyB,GAG7B,CAAE,MAAOn2D,GACP4mD,IAAaA,GAAU,wDAAkC5mD,EAAMoE,QAAS,CAAE1K,KAAM,UAChF68D,GAAuB,IACvBJ,GAAyB,GAC3B,CAAC,QACCE,IAAyB,EAC3B,CAhDA,CAiDF,EAEMu0B,GAAyBxgC,IAC7B,IAAKA,GAAcA,EAAW7nD,OAAS,EAGrC,YADA4zD,GAAyBG,IAK3B,MAAMu0B,EAAmB3/C,GAAckf,GAGjC0gC,EAAWx0B,GAAoBp1D,OAAOs+D,IAC1C,MAAMj1D,EAAO2gC,GAAcs0B,EAAS3gE,OAAS2gE,EAASj1D,MAAQ,IACxDtL,GAAOugE,EAASvgE,KAAO,IAAI4sB,cAC3BxB,GAASm1C,EAAS//D,eAAiB+/D,EAASn1C,OAAS,IAAIwB,cACzDk/D,EAAU7/C,GAAcs0B,EAASjgE,eAAiB,IAExD,OAAOgL,EAAKtJ,SAAS4pF,IACd5rF,EAAIgC,SAASmpD,EAAWv+B,gBACxBxB,EAAMppB,SAASmpD,EAAWv+B,gBAC1Bk/D,EAAQ9pF,SAAS4pF,KAG1B10B,GAAyB20B,IAqCrBE,GAA2BA,KAE/B,MAAMC,EAAcl8E,GAASjQ,iBAAmB,GAC1CosF,EAAan8E,GAAS7P,eAAiB,GACvCkrD,EAAa6gC,GAAeC,EAElCv0B,GAAcvM,GACdqM,IAAiB,GACbrM,GAAcA,EAAW7nD,QAAU,GACrC4oF,GAAc/gC,IAIZ+gC,GAAgBtrF,iBAA4B,IAArBuqD,EAAU5uC,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,GACxC,MAAM4vE,EAA8B,OAAVhhC,QAAU,IAAVA,OAAU,EAAVA,EAAYtmD,OACtC,IAAKsnF,GAAqBA,EAAkB7oF,OAAS,EACnDs0D,GAAe,SAIjB,IACEE,IAAe,GAKf,IAAInuC,EAAKyiE,EAET,GAJc,QAAQtnF,KAAKqnF,GAIhB,CAETxiE,EAAG,yEAAAje,OAA4EygF,GAC/E,MAAMlpE,QAAiB49C,MAAMl3C,EAAK,CAChCm3C,OAAQ,MACRp6C,QAAS,CAAE,OAAU,sBAGvB,GAAIzD,EAAS89C,GAAI,CAAC,IAADsrB,EAAAC,EACf,MAAMvhF,QAAakY,EAASi+C,OACtBrgE,EAAS,CACbb,IAAK+K,EAAK/K,IACVE,IAAK6K,EAAK7K,KAAO,GACjBN,MAAOmL,EAAKo2D,eAAiB,GAC7BrhE,QAAkB,QAAVusF,EAAAthF,EAAKq2D,aAAK,IAAAirB,OAAA,EAAVA,EAAYhrB,gBAAiB,GACrCD,OAAiB,QAAVkrB,EAAAvhF,EAAKq2D,aAAK,IAAAkrB,OAAA,EAAVA,EAAYjrB,gBAAiB,IAEtCzJ,GAAe,CAAC/2D,GAClB,MACE+2D,GAAe,IACXu0B,EAAkB7oF,QAAU,GAC9BqkD,IAAaA,GAAU,iCAAkC,CAAEltD,KAAM,WAGvE,KAAO,CAELkvB,EAAM,iFAGN,MAAM4iE,EAAiB,CACrBJ,EACAlgD,GAAckgD,IACdlqF,OAAO,CAACuqF,EAAMt+D,EAAOu+D,IAAQA,EAAItV,QAAQqV,KAAUt+D,GAErD,IAAIw+D,EAAa,GAGjB,IAAK,MAAMC,KAAiBJ,EAAgB,CAC1C,IAAKI,EAAe,SAEpBP,EAAc,CACZjrB,cAAewrB,EACfC,MAAO,IAGT,MAAM3pE,QAAiB49C,MAAMl3C,EAAK,CAChCm3C,OAAQ,OACRp6C,QAAS,CAAE,eAAgB,oBAC3B7L,KAAM1Z,KAAKuR,UAAU05E,KAGvB,GAAInpE,EAAS89C,GAAI,CACf,MACM1gD,UADa4C,EAASi+C,QACN2rB,oBAAsB,IAAIlpF,IAAIqX,IAAI,IAAA8xE,EAAAC,EAAA,MAAK,CAC3D/sF,IAAKgb,EAAKhb,IACVE,IAAK8a,EAAK9a,KAAO,GACjBN,MAAOob,EAAKmmD,eAAiB,GAC7BrhE,QAAkB,QAAVgtF,EAAA9xE,EAAKomD,aAAK,IAAA0rB,OAAA,EAAVA,EAAYzrB,gBAAiB,GACrCD,OAAiB,QAAV2rB,EAAA/xE,EAAKomD,aAAK,IAAA2rB,OAAA,EAAVA,EAAY1rB,gBAAiB,MAEtCqrB,EAAWvtE,QAAQkB,EACrB,CACF,CAGA,MAAM2sE,EAAgBN,EAAWzqF,OAAO,CAAC+Y,EAAMkT,EAAOu+D,IACpDA,EAAIQ,UAAUC,GAASA,EAAMltF,MAAQgb,EAAKhb,OAASkuB,GAI/Ci/D,EAAuBlhD,GAAckgD,GAgB3C,GAfAa,EAAcjqB,KAAK,CAACvhD,EAAGwhD,KACrB,MAAMoqB,EAAYnhD,GAAczqB,EAAE5hB,OAC5BytF,EAAYphD,GAAc+2B,EAAEpjE,OAE5B0tF,EAAoBF,EAAUprF,SAASmrF,GACvCI,EAAoBF,EAAUrrF,SAASmrF,GAE7C,OAAIG,IAAsBC,GAA2B,GAChDD,GAAqBC,EAA0B,EAC7C,IAGT31B,GAAeo1B,GAGXA,EAAc1pF,OAAS,EAAG,CAC5B,MAAMkqF,EAAe,CAAC,EAGtB,IAAK,MAAMC,KAAYT,EACrB,GAAKS,EAASztF,IAEd,IACE,MAAM0tF,QAAkB1C,EAAAA,GAAAA,IAAsB,CAC5CzsF,SACAC,YACA2L,WACAlJ,SAAoB,OAAVxC,SAAU,IAAVA,QAAU,EAAVA,GAAYwC,SACtBjB,IAAKytF,EAASztF,IACdirF,SAAUjjF,IAAiBA,GAAc,oBAGrCkjF,EAAkB7pF,MAAMC,QAAQosF,GAClCA,EAAUzrF,OAAO2xB,IAAC,IAAA+5D,EAAA,OAAS,QAALA,EAAA/5D,EAAE5zB,WAAG,IAAA2tF,OAAA,EAALA,EAAO9oF,UAAW4oF,EAASztF,IAAI6E,SACrD,GAEJ,GAAIqmF,EAAgB5nF,OAAS,EAAG,CAE9B,MAAMM,EAAUvC,MAAMC,QAAkB,OAAV7C,SAAU,IAAVA,QAAU,EAAVA,GAAYwC,UACtCxC,GAAWwC,SACX,CAAW,OAAVxC,SAAU,IAAVA,QAAU,EAAVA,GAAYwC,UAGXhD,EAAeitF,EAAgBxuE,KAAKkX,IAExC,GADgBA,EAAE3yB,UAAkC,KAAtB2yB,EAAE3yB,SAAS4D,QAAgC,OAAf+uB,EAAE3yB,UAAoC,SAAf2yB,EAAE3yB,SAEjF,IACE,MAAMmqF,EAAgBjqF,KAAKC,MAAMwyB,EAAE3yB,UAEnC,OADsB2C,EAAQyX,KAAKiwE,GAAUA,GAAUF,EAAcppF,SAASspF,GAEhF,CAAE,MAAO/pF,GACP,OAAO,CACT,CAEF,OAAO,IAIHvD,EAAmBktF,EAAgBxuE,KAAKkX,IAC5C,MAAM23D,EAAU33D,EAAE3yB,UAAkC,KAAtB2yB,EAAE3yB,SAAS4D,QAAgC,OAAf+uB,EAAE3yB,UAAoC,SAAf2yB,EAAE3yB,SACnF,OAAO2yB,EAAEzpB,QAAU,GAAKypB,EAAEzpB,UAAYA,KAAYohF,IAI9CrtF,EAAiBgtF,EAAgBxuE,KAAKkX,IAC1C,MAAM23D,EAAU33D,EAAE3yB,UAAkC,KAAtB2yB,EAAE3yB,SAAS4D,QAAgC,OAAf+uB,EAAE3yB,UAAoC,SAAf2yB,EAAE3yB,SACnF,OAAqB,IAAd2yB,EAAEzpB,UAAkBohF,IAG7BiC,EAAaC,EAASztF,KAAO,CAC3BhC,mBAAoBA,EACpBC,eAAgBA,EAChBC,iBAAkBA,EAEtB,MACEsvF,EAAaC,EAASztF,KAAO,CAC3BhC,kBAAkB,EAClBC,cAAc,EACdC,gBAAgB,EAGtB,CAAE,MAAO6C,GACPysF,EAAaC,EAASztF,KAAO,CAC3BhC,kBAAkB,EAClBC,cAAc,EACdC,gBAAgB,EAEpB,CAGF+5D,GAAiBu1B,EACnB,CAEIR,EAAc1pF,MAGpB,CAEF,CAAE,MAAOvC,GACP62D,GAAe,IACfK,GAAiB,CAAC,GAClBtQ,IAAaA,GAAU,0CAA8B,CAAEltD,KAAM,SAC/D,CAAC,QACCq9D,IAAe,EACjB,CACF,EAGM81B,GAAwB7rF,IAhnTAg9C,QAinTPp9C,GACfA,EAAKK,SAASD,GACTJ,EAAKM,OAAOC,GAAOA,IAAQH,GAE3B,IAAIJ,EAAMI,GArnTeqqD,GAAax4B,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAE30B,cAAe8/C,MAyoTzE8uC,GAAoBJ,IACxB39B,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP9B,gBAAiB4tF,EAAS7tF,OAAS,GACnCG,iBAAkB0tF,EAAS3tF,QAAU2tF,EAASrsB,OAAS,GACvDnhE,cAAewtF,EAASztF,KAAO,GAC/BG,cAAestF,EAASvtF,KAAO,MAGjCs3D,IAAiB,GACjBE,GAAc,IACdE,GAAe,IACfjQ,IAAaA,GAAU,+BAA2B,CAAEltD,KAAM,aAItDqzF,GAAoBltF,MAAO6sF,EAAUM,KACzC,GAAKxvF,IAAUC,IAAa2L,GAA5B,CAKA4tD,GAAiB01B,EAASztF,KAE1B,IAEEuwD,GAAY,OAAQ,YAAa,oBAAoB,kBAAD7kD,OAAelN,GAAQ,mBAAAkN,OAAkB+8D,GAAc,eAAA/8D,OAAqB,OAAVjN,SAAU,IAAVA,QAAU,EAAVA,GAAYwC,SAAQ,wBAAAyK,OAAiBvK,KAAKuR,UAAUq7E,KAG1K,IAAIC,EAAe,EACfC,EAAgB,GAEpB,GAAqB,aAAjBF,EACFC,EAAe7jF,GACf8jF,EAAgB,GAChB19B,GAAY,OAAQ,YAAa,kBAAkB,yCAAD7kD,OAAqCsiF,SAClF,GAA4B,UAAZ,OAAZD,QAAY,IAAZA,OAAY,EAAZA,EAAcrxF,QAAqC,eAAjBqxF,EAA+B,CAE1EC,EAAe,EACf,MAAM/uF,GAA4B,OAAZ8uF,QAAY,IAAZA,OAAY,EAAZA,EAAcG,QAAS,EAAW,OAAVzvF,SAAU,IAAVA,QAAU,EAAVA,GAAYwC,WAAY,IACtEgtF,EAAgB9sF,KAAKuR,UAAUzT,GAC/BsxD,GAAY,OAAQ,YAAa,cAAc,0CAAD7kD,OAAmCzM,EAAcoxE,KAAK,MAAK,eAAA3kE,OAAcuiF,GACzH,KAA4B,WAAjBF,IACTC,EAAe,EACfC,EAAgB,GAChB19B,GAAY,OAAQ,YAAa,gBAAgB,4DAInD,UACQ49B,EAAAA,GAAAA,IAAoB,CACxB5vF,SACAC,YACAwB,IAAKytF,EAASztF,IACdJ,MAAO6tF,EAAS7tF,MAChBE,OAAQ2tF,EAAS3tF,QAAU2tF,EAASrsB,OAAS,GAC7ClhE,IAAKutF,EAASvtF,KAAO,GACrBE,WAAY,GACZE,cAAe,GACfE,cAAe,GACfE,gBAAiB,GACjByJ,QAAS6jF,EACT/sF,SAAUgtF,IAGZtmC,IAAaA,GAAU,4DAAiD,CAAEltD,KAAM,WAElF,CAAE,MAAO2zF,SAEDC,EAAAA,GAAAA,IAAe,CACnB9vF,SACAC,YACAoB,MAAO6tF,EAAS7tF,MAChBE,OAAQ2tF,EAAS3tF,QAAU2tF,EAASrsB,OAAS,GAC7CphE,IAAKytF,EAASztF,IACdE,IAAKutF,EAASvtF,KAAO,GACrBE,WAAY,GACZE,cAAe,GACfE,cAAe,GACfE,gBAAiB,GACjByJ,QAAS6jF,EACT/sF,SAAUgtF,IAGZtmC,IAAaA,GAAU,4DAA4C,CAAEltD,KAAM,WAC7E,CAGA68D,GAAuB,GAEzB,CAAE,MAAOv2D,GACP4mD,IAAaA,GAAU,qCAADj8C,OAAwB3K,EAAMoE,SAAW,CAAE1K,KAAM,SACzE,CAAC,QACCs9D,GAAiB,KACnB,CA1EA,MAFEpQ,IAAaA,GAAU,8CAA4B,CAAEltD,KAAM,WAqGzD6zF,GAAqB1tF,UACzB,MAAM2tF,EAAgB,OAAHvuF,QAAG,IAAHA,OAAG,EAAHA,EAAK6E,OACxB,GAAK0pF,KAAcA,EAAWjrF,OAAS,GAAvC,CAEAi1D,IAAkB,GAClBx8B,GAAkB,YAClBE,GAAgB,MAChBq8B,IAAgB,GAEhB,IAEE,MAAM+H,QAAoBC,EAAAA,GAAAA,IAAoB,CAC5C/hE,MAAOA,GACPC,SAAUA,GACVwB,IAAKuuF,IAGP,GAAe,OAAXluB,QAAW,IAAXA,GAAAA,EAAat1D,MAAQ1J,MAAMC,QAAQ++D,EAAYt1D,OAASs1D,EAAYt1D,KAAKzH,OAAS,EAAG,CAEvF,MAAMi9D,EAAWF,EAAYt1D,KAAK,GAClCgxB,GAAkB,eAClBE,IAAer6B,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAC,CAAC,EACZ2+D,GAAQ,IACXH,OAAQ,UAEZ,KAAO,CAEL,MAAMO,EAAO,yEAAAj1D,OAA4E6iF,GACnF3tB,QAAqBC,MAAMF,EAAS,CACxCG,OAAQ,MACRp6C,QAAS,CAAE,OAAU,sBAGvB,GAAIk6C,EAAaG,GAAI,CAAC,IAADytB,EACnB,MAAMvtB,QAAiBL,EAAaM,OACpCnlC,GAAkB,cAClBE,GAAgB,CACdj8B,IAAKihE,EAASjhE,IACdE,IAAK+gE,EAAS/gE,KAAO,GACrBN,MAAOqhE,EAASE,eAAiB,GACjCrhE,QAAsB,QAAd0uF,EAAAvtB,EAASG,aAAK,IAAAotB,OAAA,EAAdA,EAAgBntB,gBAAiB,GACzCjB,OAAQ,QAEZ,MACErkC,GAAkB,aAClBE,GAAgB,KAEpB,CACF,CAAE,MAAOl7B,GACPg7B,GAAkB,aAClBE,GAAgB,KAClB,CAAC,QACCs8B,IAAkB,EACpB,CAnDgD,GA2F5Ck2B,GAAoBA,KACnB3xD,KAELgzB,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP9B,gBAAiBi9B,GAAal9B,OAASk9B,GAAaxxB,MAAQ,GAC5DvL,iBAAkB+8B,GAAah9B,QAAUg9B,GAAa0jC,SAAW,GACjEvgE,cAAe68B,GAAa98B,KAAO,GACnCG,cAAe28B,GAAa58B,KAAO,GACnCG,qBAAsBy8B,GAAa18B,YAAc,GACjDG,wBAAyBu8B,GAAax8B,eAAiB,GACvDG,wBAAyBq8B,GAAat8B,eAAiB,GACvDG,0BAA2Bm8B,GAAap8B,iBAAmB,MAG7D43D,IAAgB,GAChBv8B,GAAkB,MAClBE,GAAgB,QAIZyyD,GAAkBA,KACtBp2B,IAAgB,GAChBv8B,GAAkB,MAClBE,GAAgB,OAgBZ0yD,GAA0B5jF,IAC9B,IAAK,IAAD6jF,EAAAC,EAAAC,EACF,MAAMC,EAAU,CAAC,EAIyC,IAADC,EAAzD,GAHQ,OAAJjkF,QAAI,IAAJA,GAAgB,QAAZ6jF,EAAJ7jF,EAAMS,kBAAU,IAAAojF,GAAhBA,EAAkBnjF,UAASsjF,EAAQtjF,QAAUV,EAAKS,WAAWC,SACzD,OAAJV,QAAI,IAAJA,GAAgB,QAAZ8jF,EAAJ9jF,EAAMS,kBAAU,IAAAqjF,GAAhBA,EAAkB52E,iBAAgB82E,EAAQh3E,QAAUhN,EAAKS,WAAWyM,gBAChE,OAAJlN,QAAI,IAAJA,GAAkB,QAAd+jF,EAAJ/jF,EAAM2B,oBAAY,IAAAoiF,GAAlBA,EAAoBjvF,kBAAiBkvF,EAAQ1/D,UAAYtkB,EAAK2B,aAAa7M,iBAC3EwB,MAAMC,QAAY,OAAJyJ,QAAI,IAAJA,OAAI,EAAJA,EAAM0rB,UAAY1rB,EAAK0rB,QAAQnzB,OAC/CyrF,EAAQt4D,QAAU1rB,EAAK0rB,QAAQnzB,OACZ,QAAnB0rF,EAAIjkF,EAAK0rB,QAAQ,UAAE,IAAAu4D,GAAfA,EAAiB5gE,QAAO2gE,EAAQE,aAAelkF,EAAK0rB,QAAQ,GAAGrI,OAErE,OAAO2gE,CACT,CAAE,MAAAG,GAAQ,MAAO,CAAC,CAAG,GAsFjBC,GAAoBA,CAAC3+B,EAAQ3F,KACjC,IACE,MAAMukC,EAAW,CACf/iF,GAAI0S,KAAKC,MACTwxC,SACA3F,QAASA,GAAW,CAAC,EACrB7pC,KAAMxiB,IAAY,WAv0TOugD,EAy0TLp9C,GAAQ,CAACytF,KAAaztF,EAAK0tF,MAAM,EAAG,KAz0TvBv5B,GAAcliC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEmiC,WAAYhX,IA00T5E,CAAE,MAAAuwC,GAAO,CA10ToBvwC,OA60TzBv9C,IAAoB8Q,EAAAA,EAAAA,aAAY,CAAC7Q,EAAOC,KAO5C,MAAM6tF,GAA2Bz9B,KAAcmW,GAG/ClW,IAAa,GAGRC,IACHC,IAAiB,GAIfs9B,EAEFvpE,IAAgB,GAGhBA,KAcF,GAVuB,CACrB,qBACA,cACA,gBACA,UACA,iBACA,SACA,qBACA,uBAEiBhkB,SAASP,GAAQ,CAGlC+tF,GAAc/tF,EAD8DC,EAE9E,CAEAouD,GAAYnuD,IACV,IAAI8tF,EAAiB/tF,EAIrB,MAAM+iB,GAAO7iB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACRD,GAAI,IACP,CAACF,GAAQguF,IAKG,uBAAVhuF,IAEFgjB,EAAQ5I,OAAS,GACjB4I,EAAQ3I,cAAgB,GACxB2I,EAAQ1I,iBAAmB,GAC3B0I,EAAQzI,uBAAyB,GACjCyI,EAAQxI,sBAAwB,GAChCwI,EAAQvI,uBAAyB,GACjCuI,EAAQtI,0BAA4B,IAOtC,MAAMuzE,EAAkBA,KACtB,MAAM1wE,EAAM,IAAID,KACV2sB,EAAO1sB,EAAI2sB,cACXC,EAAQxhC,OAAO4U,EAAI6sB,WAAa,GAAGC,SAAS,EAAG,KAC/CC,EAAM3hC,OAAO4U,EAAIgtB,WAAWF,SAAS,EAAG,KACxC+oC,EAAQzqE,OAAO4U,EAAI81D,YAAYhpC,SAAS,EAAG,KAC3CipC,EAAU3qE,OAAO4U,EAAIg2D,cAAclpC,SAAS,EAAG,KAC/CmpC,EAAU7qE,OAAO4U,EAAIk2D,cAAcppC,SAAS,EAAG,KACrD,MAAM,GAANpgC,OAAUggC,EAAI,KAAAhgC,OAAIkgC,EAAK,KAAAlgC,OAAIqgC,EAAG,KAAArgC,OAAImpE,EAAK,KAAAnpE,OAAIqpE,EAAO,KAAArpE,OAAIupE,IAIlD0a,EAAiBA,KACrB,MAAM3wE,EAAM,IAAID,KACV2sB,EAAO1sB,EAAI2sB,cACXC,EAAQxhC,OAAO4U,EAAI6sB,WAAa,GAAGC,SAAS,EAAG,KAC/CC,EAAM3hC,OAAO4U,EAAIgtB,WAAWF,SAAS,EAAG,KAC9C,MAAM,GAANpgC,OAAUggC,EAAI,KAAAhgC,OAAIkgC,EAAK,KAAAlgC,OAAIqgC,IAyD7B,GApDc,mBAAVtqC,IAEY,cAAVC,GAAyByI,IAEtBxI,EAAK21B,iBAKR7S,EAAQ6S,gBAAkB31B,EAAK21B,gBAC/B7S,EAAQ4T,aAAe12B,EAAK02B,eAL5B5T,EAAQ6S,gBAAkBntB,GAC1Bsa,EAAQ4T,aAAeq3D,KAOzBjrE,EAAQgH,mBAAqB,IAGZ,gBAAV/pB,GAaU,YAAVA,EAXFC,EAAK21B,iBAKR7S,EAAQ6S,gBAAkB31B,EAAK21B,gBAC/B7S,EAAQ4T,aAAe12B,EAAK02B,eAL5B5T,EAAQ6S,gBAAkBntB,GAC1Bsa,EAAQ4T,aAAeq3D,KAsBR,KAAVhuF,IAEP+iB,EAAQ6S,gBAAkB,GAC1B7S,EAAQ4T,aAAe,KAOb,kBAAV52B,EACF,IAAc,IAAVC,GAAmBC,EAAK6pB,gBAQrB,IAAc,IAAV9pB,EAAiB,CAE1B+iB,EAAQ+G,eAAiB,GAIzB+kC,GAAY,OAAQ,WAAY,qBAAqB,oGAGrD,MAAMgvB,EAAuB59E,EAAK0yB,mBAAqB,OACjDmrD,EAAcvgD,GAAiBsgD,EAAsB,YACrDE,EAAaxgD,GAAiBsgD,EAAsB,WAGtDC,GAAeC,GAAc99E,EAAK8sB,gBACpC8hC,GAAY,UAAW,gBAAiB,sBAAsB,2FAAD7kD,OAA+E6zE,EAAoB,OAGhKhvB,GAAY,OAAQ,gBAAiB,gBAAgB,sGACrD+uB,KAEJ,OA3BE76D,EAAQ+G,eAAiBmkE,IAIzBp/B,GAAY,OAAQ,WAAY,mBAAmB,oGA2BvD,GAAc,oBAAV9uD,EACF,IAAc,IAAVC,GAAmBC,EAAK0zB,cAcrB,IAAc,IAAV3zB,EAAiB,CAE1B+iB,EAAQ4Q,aAAe,GACvB5Q,EAAQgrC,mBAAqB,GAC7BhrC,EAAQirC,eAAiB,GACzBjrC,EAAQiH,sBAAwB,GAGhC,MAAM6zD,EAAuB59E,EAAK0yB,mBAAqB,OACjDmrD,EAAcvgD,GAAiBsgD,EAAsB,YACrDE,EAAaxgD,GAAiBsgD,EAAsB,WAGtDC,GAAeC,EACjBlvB,GAAY,UAAW,gBAAiB,6BAA6B,2HAAD7kD,OAAgG6zE,EAAoB,OAGxLhvB,GAAY,OAAQ,gBAAiB,uBAAuB,gIAC5D+uB,KAEJ,OAxBE,GARA76D,EAAQ4Q,aAAes6D,IAGnBxlF,KAAYxI,EAAK8tD,qBACnBhrC,EAAQgrC,mBAAqBtlD,IAI3B1L,KAAekD,EAAK+tD,eAAgB,CACtC,MAAM7tC,EAAQ,GAAAnW,OAAGjN,GAAWkjB,WAAaljB,GAAWkjB,WAAa,IAAM,IAAEjW,OAAGjN,GAAWojB,OAAS,GAAE,KAAAnW,OAAIjN,GAAWsjB,UAAY,IAAErW,OAAGjN,GAAWwjB,SAAW,KAAOxjB,GAAWwjB,SAAW,IAAKC,QAAQ,OAAQ,KAAKrd,OAC/M4f,EAAQirC,eAAiB7tC,CAC3B,CA0BJ,GAAc,+BAAVpgB,EACF,GAAc,IAAVC,IAAyB,IAAVA,EAEjB,GAAIyI,KAAYxI,EAAKq0B,6BAA8B,CAEjD,MAAMhX,EAAM,IAAID,KACV2sB,EAAO1sB,EAAI2sB,cACXC,EAAQxhC,OAAO4U,EAAI6sB,WAAa,GAAGC,SAAS,EAAG,KAC/CC,EAAM3hC,OAAO4U,EAAIgtB,WAAWF,SAAS,EAAG,KACxC+oC,EAAQzqE,OAAO4U,EAAI81D,YAAYhpC,SAAS,EAAG,KAC3CipC,EAAU3qE,OAAO4U,EAAIg2D,cAAclpC,SAAS,EAAG,KAC/CmpC,EAAU7qE,OAAO4U,EAAIk2D,cAAcppC,SAAS,EAAG,KAC/C8jD,EAAc,GAAAlkF,OAAMggC,EAAI,KAAAhgC,OAAIkgC,EAAK,KAAAlgC,OAAIqgC,EAAG,KAAArgC,OAAImpE,EAAK,KAAAnpE,OAAIqpE,EAAO,KAAArpE,OAAIupE,GAGtExwD,EAAQuR,6BAA+B7rB,GACvCsa,EAAQwR,8BAAgC25D,EACxCr/B,GAAY,OAAQ,kBAAmB,eAAe,uDAAD7kD,OAAyDvB,GAAO,SAAAuB,OAAQ+Y,EAAQwR,8BAA6B,qBAAAvqB,OAAoBhK,GACxL,MAAYyI,GAGVomD,GAAY,OAAQ,kBAAmB,uBAAuB,4BAAD7kD,OAAyB/J,EAAKq0B,+BAF3Fu6B,GAAY,QAAS,kBAAmB,aAAc,+FAIrC,IAAV7uD,IAAyB,IAAVA,GAExB6uD,GAAY,OAAQ,kBAAmB,iBAAkB,0EAK7D,GAAc,mCAAV9uD,EACF,GAAc,IAAVC,IAAyB,IAAVA,EAEjB,GAAIyI,GAAS,CACX,MAAM6U,EAAM,IAAID,KACV2sB,EAAO1sB,EAAI2sB,cACXC,EAAQxhC,OAAO4U,EAAI6sB,WAAa,GAAGC,SAAS,EAAG,KAC/CC,EAAM3hC,OAAO4U,EAAIgtB,WAAWF,SAAS,EAAG,KACxC+oC,EAAQzqE,OAAO4U,EAAI81D,YAAYhpC,SAAS,EAAG,KAC3CipC,EAAU3qE,OAAO4U,EAAIg2D,cAAclpC,SAAS,EAAG,KAC/CmpC,EAAU7qE,OAAO4U,EAAIk2D,cAAcppC,SAAS,EAAG,KAC/C8jD,EAAc,GAAAlkF,OAAMggC,EAAI,KAAAhgC,OAAIkgC,EAAK,KAAAlgC,OAAIqgC,EAAG,KAAArgC,OAAImpE,EAAK,KAAAnpE,OAAIqpE,EAAO,KAAArpE,OAAIupE,GAEtExwD,EAAQ4R,YAAclsB,GACtBsa,EAAQ6R,aAAes5D,CACzB,MACEr/B,GAAY,QAAS,YAAa,aAAc,sCAE/B,IAAV7uD,IAAyB,IAAVA,IAExB+iB,EAAQ4R,YAAc,KACtB5R,EAAQ6R,aAAe,MAI3B,OAAO7R,IAUY,CACnB,qBACA,cACA,gBACA,qBACA,SACA,sBACA,iBACA,gBACA,mBAKeziB,SAASP,KAEnB8xD,GAAmBjqD,UAAW4/C,GAAAA,QAAa80B,qBAAwBz+E,IAAao8B,KAAoBq2B,IACvGhsC,IAAgB,KAInB,CAACnW,GAAkBC,GAAU3F,GAASopD,GAAoBrK,GAAAA,QAAc3pD,GAAUo8B,GAAkBq2B,GAAehsC,GAAiBisC,KAGjI49B,IAAmBv9E,EAAAA,EAAAA,aAAa5Q,IAChCoO,GAASye,iBAAmB7sB,GAE9BF,GAAkB,iBAAkB,IAEpCA,GAAkB,qBAAsB,IAExCA,GAAkB,kBAAmB,MAGrCA,GAAkB,iBAAkBE,IAIhCyI,IAAsB,cAAVzI,GAAmC,gBAAVA,GAAqC,YAAVA,GAClEF,GAAkB,kBAAmB2I,KAKpCopD,GAAmBjqD,UAAW4/C,GAAAA,QAAa80B,qBAAwBz+E,IAAao8B,KAAoBq2B,IACvGhsC,IAAgB,IAEjB,CAAClW,GAASye,eAAgBpkB,GAASopD,GAAoBrK,GAAAA,QAAc3pD,GAAUo8B,GAAkBq2B,KAG9F89B,IAAuBx9E,EAAAA,EAAAA,aAAY,KACvCypD,IAAyB,GACzBK,GAAY,OACZE,GAA0B,MAC1BL,GAAgB,IAChBE,GAAgB,OACf,IAGG4zB,IAAuBz9E,EAAAA,EAAAA,aAAY,KACnC1C,IAEFo6C,GAAiBroD,IACf,MAAM0hF,GAASzhF,EAAAA,EAAAA,GAAA,GAAQD,GAIvB,OAHAoD,OAAOC,KAAKq+E,GAAWzrE,QAAQtf,IAC7B+qF,EAAU/qF,IAAO,IAEZ+qF,IAETz1B,IAAwB,KAGxB5D,GAAiBroD,IACf,MAAM0hF,GAASzhF,EAAAA,EAAAA,GAAA,GAAQD,GAGjBquF,EAAiB,GAuBvB,OAtBAjrF,OAAOC,KAAKq+E,GAAWzrE,QAAQkiB,IAI7B,GAAmB,kBAAfA,EACF,OAIF,MAAMthB,EAAevI,GAAiB6pB,GACrBthB,IAAiBA,EAAaE,UAG7C2qE,EAAUvpD,IAAc,EACxBk2D,EAAe7wE,KAAK2a,MAKpBk2D,EAAe1sF,OAGZ+/E,IAETz1B,IAAwB,KAEzB,CACDh+C,GACAK,GACAwhD,KAIIw+B,IAAkB39E,EAAAA,EAAAA,aAAY,SAACwnB,GAAqC,IAAzBo2D,EAAQ3zE,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,SAI1D,MAAMmkC,EAAkBqO,GAAqBzlD,QAC7C,IAAKo3C,EACH,OAAO,EAGT,MAAMyvC,EAAiBzvC,EAAgBC,cAAc,kBAADj1C,OAAmBouB,EAAU,OACjF,IAAKq2D,EACH,OAAO,EAIT,IAWE,MAAMC,EAAgBD,EAAexvC,cAAc,6BAC9BwvC,EAAexvC,cAAc,mBAK5C0vC,GAHgBD,GAAiBD,GAGNG,UAQ3BC,EAAkBF,EALEt8E,SACxBy8E,iBAAiBj7E,SAASirE,iBAAiBiQ,iBAAiB,0BAA4B,OAgB1F,MATiB,WAAbP,EACFxvC,EAAgBgwC,SAAS,CACvBz7E,IAAKs7E,EACLL,SAAU,WAGZxvC,EAAgB1sC,UAAYu8E,GAGvB,CACT,CAAE,MAAOxvF,GACP,OAAO,CACT,CACF,EAAG,CACDkP,GACAkyB,GACAsvB,GACA9J,KAIIgpC,IAA8Br+E,EAAAA,EAAAA,aAAaiG,IAG/C03E,GADoC,oBAAd13E,EAAkC,YAAcA,EACvC,WAC9B,CAAC03E,KAGEW,IAA2Bt+E,EAAAA,EAAAA,aAAa+D,IACxCA,GAASA,EAAM/S,OAAS,IAC1BogF,GAAiBrtE,GACjBsxC,IAAaA,GAAU,+BAADj8C,OAAgB2K,EAAM/S,OAAM,sBAAiB,CAAE7I,KAAM,WAE5E,CAACipF,GAAkB/7B,KAwDhBl3C,KAtDqB6B,EAAAA,EAAAA,aAAY1R,UACrC,GAAKkP,GAASnE,GAKd,GAAe,OAAVlN,SAAU,IAAVA,IAAAA,GAAYkN,GAKjB,IACE4kD,GAAY,OAAQ,gBAAiB,QAAQ,4DAAD7kD,OAA0CoE,GAASnE,GAAE,qBAAAD,OAAejN,GAAWkN,KAG3H,MAAM0iD,QAAkBppC,EAAAA,GAAAA,YAAWlR,SAASjE,GAASnE,IAAKpN,GAAOC,IAAU,GAE3E,IAAK6vD,IAAcA,EAAU1iD,GAC3B,MAAM,IAAIuZ,MAAM,sEAGlBqrC,GAAY,UAAW,gBAAiB,SAAS,qDAAD7kD,OAA4C2iD,EAAU15B,gBAAe,0BAAAjpB,OAAyB2iD,EAAUh6B,kBAAiB,MAGzKy7B,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP0yB,kBAAmBg6B,EAAUh6B,kBAC7BM,gBAAiB05B,EAAU15B,mBAI7B,MAAMoR,GAAenkC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAChBkO,IAAQ,IACXukB,kBAAmBg6B,EAAUh6B,kBAC7BM,gBAAiB05B,EAAU15B,kBAG7BgvC,GAAU59B,EAAiB,CACzBkiC,kBAAkB,EAClBve,aAAc55C,GAASnE,GACvBmmD,UAAWA,KAKbvB,GAAY,UAAW,gBAAiB,WAAY,iDAEtD,CAAE,MAAOxvD,GACPwvD,GAAY,QAAS,gBAAiB,SAAUxvD,EAAMoE,SACtDwiD,IAAaA,GAAU,8DAADj8C,OAAyC3K,EAAMoE,SAAW,CAAE1K,KAAM,SAC1F,MA3CEktD,IAAaA,GAAU,yFAA0D,CAAEltD,KAAM,eALzFktD,IAAaA,GAAU,+EAA0D,CAAEltD,KAAM,WAiD1F,CAACqV,GAAUrR,GAAYF,GAAOC,GAAUmpD,GAAWmK,MAG9Bx/C,EAAAA,EAAAA,aAAY,KAElC,IAAKxC,GAASnE,GACZ,OAAO,EAIT,GAAI7D,GAAe,EACjB,OAAO,EAKT,MAAM+oF,EAAkB5xD,GAAiBnvB,GAASukB,kBAAmB,gBAC/D2+C,EAAc/zC,GAAiBnvB,GAASukB,kBAAmB,YAC3D6+C,EAAej0C,GAAiBnvB,GAASukB,kBAAmB,aAIlE,QAHqB4K,GAAiBnvB,GAASukB,kBAAmB,iBAO7Dw8D,GAAoB7d,GAAgBE,IAKxC,CAACpjE,GAASnE,GAAImE,GAASukB,kBAAmBvsB,GAAcm3B,GAAkB6F,MAGvEgsD,IAAqBx+E,EAAAA,EAAAA,aAAY,KACrC,GAAK7B,KAYL,IACE8/C,GAAY,OAAQ,iBAAkB,cAAc,0DAAD7kD,OAAgDoE,GAASnE,KAG5G,MAAMolF,GAAYnvF,EAAAA,EAAAA,GAAA,CAChB4mB,cAAe1Y,GAASnE,GACxB+oB,iBAAkB5kB,GAAS4kB,iBAC3Bs8D,iBAAkBlhF,GAASkhF,kBAAoBlhF,GAASlQ,OACrDkQ,IAGLgqD,GAAkBi3B,GAClBn3B,IAAiB,EAEnB,CAAE,MAAO74D,GACPwvD,GAAY,QAAS,iBAAkB,QAASxvD,EAAMoE,SACtDwiD,IAAaA,GAAU,yDAADj8C,OAAyC3K,EAAMoE,SAAW,CAAE1K,KAAM,SAC1F,MA3BOqV,GAASnE,GAEH7D,GAAe,EACxB6/C,IAAaA,GAAU,2EAAwD,CAAEltD,KAAM,YAEvFktD,IAAaA,GAAU,mFAAiE,CAAEltD,KAAM,YAJhGktD,IAAaA,GAAU,6DAAmD,CAAEltD,KAAM,aA2BrF,CAACqV,GAAUhI,GAAc6/C,KAEtBspC,IAAuB3+E,EAAAA,EAAAA,aAAY,KACvCsnD,IAAiB,GACjBE,GAAkB,OACjB,IAEGo3B,IAAoB5+E,EAAAA,EAAAA,aAAY1R,UAGpC,GAAIsP,GAAqB,CACvB,IA2BE,GAvBAujD,GAAanqD,SAAU,EAGvB4/C,GAAAA,QAAa2a,oBAAmB,EAAO,8CAGvCtQ,GAAmBjqD,SAAU,EAG7B8wD,IAAmB,GAGfr0C,IACFA,KAIEytC,GAAiBlqD,UACnB8K,aAAao/C,GAAiBlqD,SAC9BkqD,GAAiBlqD,QAAU,MAIzBa,GAAS,CACX++C,GAAAA,QAAaI,eAAen/C,UACtB++C,GAAAA,QAAasyB,qBAGnB,IACEhpE,aAAau+C,WAAW,yBAADrlD,OAA0BvB,KACjDqI,aAAau+C,WAAW,sBAADrlD,OAAuBvB,KAC9CqI,aAAau+C,WAAW,2BAADrlD,OAA4BvB,KACnDqI,aAAau+C,WAAW,gBAADrlD,OAAiBvB,IAC1C,CAAE,MAAO5I,GACP,CAEJ,CAMA,MAAMowE,EAAgBzhD,IAAepgB,GAASnE,GAE9C,GAAIgmE,GAAiBpzE,IAASC,GAC5B,UACQozE,EAAAA,GAAAA,IAAc,CAAErzE,SAAOC,YAAUsmB,QAAS6sD,GAElD,CAAE,MAAO5wE,GACP4S,QAAQC,KAAK,kDAA0C+9D,EAAe5wE,EAAMoE,QAE9E,CAIF,IAEEwpD,IAAc,IAEdwiC,EAAAA,GAAAA,IAAsBhnF,IACtByoD,GAAoB,CAClBhJ,YAAY,EACZC,YAAY,EACZ/kC,QAAS,KACTomB,YAAa,WAIT,IAAIrrB,QAAQuqB,GAAWxgC,WAAWwgC,EAAS,IACnD,CAAE,MAAO7oC,GACP,CAIFkmD,GAAS,iBAAkB,CAAE18B,MAAO,CAAEqmE,aAAa,IACrD,CAAE,MAAOrwF,GACP4mD,IAAaA,GAAU,qCAADj8C,OAAwB3K,EAAMoE,SAAW,CAAE1K,KAAM,SACzE,CACA,MACF,CAGA,MAAMgoF,EAAqB9rD,GAAY10B,OAAO2uD,IAC3CA,EAAI8xB,UAA2B,aAAf9xB,EAAIjtC,SAA0BitC,EAAI+xB,YAAc/xB,EAAIC,MAEjE+xB,EAA0BjsD,GAAY10B,OAAO2uD,IAChDA,EAAIwZ,aAA0C,KAA3BxZ,EAAIwZ,YAAYvlE,QAGtC,IAAIwsF,EAAiB,iFAEjB5O,EAAmBn/E,OAAS,GAAKs/E,EAAwBt/E,OAAS,KACpE+tF,GAAc,8DAAA3lF,OAAwC+2E,EAAmBn/E,OAAM,gDAAAoI,OAA0Bk3E,EAAwBt/E,OAAM,yCAIzI0wD,GAAwBq9B,GACxBv9B,IAA0B,IACzB,CAACn9B,GAAazmB,GAAqB/F,GAAS2F,GAASnE,GAAIpN,GAAOC,GAAUmpD,GAAWF,KAElF6pC,IAAsBh/E,EAAAA,EAAAA,aAAY1R,UAEtC2vD,GAAY,OAAQ,SAAU,qBAAsB,yDAEpD,IA2CE,GAvCAkD,GAAanqD,SAAU,EAGvB4/C,GAAAA,QAAa2a,oBAAmB,EAAO,8CAGvCtQ,GAAmBjqD,SAAU,EAG7B8wD,IAAmB,GAGfr0C,IACFA,KAIEytC,GAAiBlqD,UACnB8K,aAAao/C,GAAiBlqD,SAC9BkqD,GAAiBlqD,QAAU,MAI7B9J,IAAY,GACZg5D,IAAoB,GACpBE,GAAoB,IACpBl9B,GAAgB,GAChB0rC,IAAkB,GAGdx9D,OAAO0oE,yBACT1oE,OAAO0oE,uBAAuBmf,SAC9B7nF,OAAO0oE,uBAAyB,MAO9BjoE,GAAS,CACX++C,GAAAA,QAAaI,eAAen/C,UACN++C,GAAAA,QAAasyB,sBAGjCjrB,GAAY,UAAW,SAAU,uBAAwB,4EAK/BrH,GAAAA,QAAaK,kBAGjCL,GAAAA,QAAasyB,qBAKrB,IACEhpE,aAAau+C,WAAW,yBAADrlD,OAA0BvB,KACjDqI,aAAau+C,WAAW,sBAADrlD,OAAuBvB,KAC9CqI,aAAau+C,WAAW,2BAADrlD,OAA4BvB,KACnDqI,aAAau+C,WAAW,gBAADrlD,OAAiBvB,IAC1C,CAAE,MAAO5I,GACP,CAEJ,CAIA,MAAMowE,EAAgBzhD,IAAepgB,GAASnE,GAE9C,GAAIgmE,GAAiBpzE,IAASC,GAC5B,IACEmV,QAAQ42B,IAAI,qDAA0ConC,EAAgB,8CAChEC,EAAAA,GAAAA,IAAc,CAAErzE,SAAOC,YAAUsmB,QAAS6sD,IAChDh+D,QAAQ42B,IAAI,wCAAqConC,GACjDphB,GAAY,UAAW,SAAU,SAAS,iBAAD7kD,OAAgBimE,EAAa,mBACxE,CAAE,MAAO5wE,GACP4S,QAAQC,KAAK,kDAA0C+9D,EAAe5wE,EAAMoE,SAC5EorD,GAAY,UAAW,SAAU,eAAe,mCAAD7kD,OAA0B3K,EAAMoE,QAAO,oBAExF,CAIF,IAEEwpD,IAAc,IAEdwiC,EAAAA,GAAAA,IAAsBhnF,UAGhB,IAAI0V,QAAQuqB,GAAWxgC,WAAWwgC,EAAS,KAEjDwoB,GAAoB,CAClBhJ,YAAY,EACZC,YAAY,EACZ/kC,QAAS,KACTomB,YAAa,KAGfqlB,GAAY,UAAW,SAAU,YAAa,4DAChD,CAAE,MAAOhvD,GACPgvD,GAAY,UAAW,SAAU,kBAAkB,8BAAD7kD,OAA2BnK,EAAE4D,SACjF,CAGA2uD,IAA0B,GAC1BE,GAAwB,IAExBzD,GAAY,OAAQ,SAAU,WAAY,yDAG1C3mD,WAAW,KACT69C,GAAS,iBAAkB,CAAE18B,MAAO,CAAEqmE,aAAa,MAClD,IAEL,CAAE,MAAOrwF,GACPwvD,GAAY,QAAS,SAAU,QAAQ,qCAAD7kD,OAAyB3K,EAAMoE,UACrEwiD,IAAaA,GAAU,qCAADj8C,OAAwB3K,EAAMoE,SAAW,CAAE1K,KAAM,UAGvE+E,IAAY,GACZg5D,IAAoB,GACpB1E,IAA0B,GAC1BE,GAAwB,IAGxBpqD,WAAW,KACT69C,GAAS,iBAAkB,CAAE18B,MAAO,CAAEqmE,aAAa,MAClD,IACL,GACC,CAACjnF,GAAS++C,GAAAA,QAAcp5C,GAASnE,GAAIpN,GAAOC,GAAUmpD,GAAWF,KAE9D+pC,IAAqBl/E,EAAAA,EAAAA,aAAY,KACrCwhD,IAA0B,GAC1BE,GAAwB,KACvB,KAqBIy9B,GAAeC,KAAoB5yF,EAAAA,EAAAA,WAAS,IAGnDa,EAAAA,EAAAA,WAAU,KAER,GAAI8xF,IAAiBvkC,KAA6B3tD,GAAU,CAC3CqB,WACb,IAEEpB,IAAY,GAGZ,MAAM6uD,EAAY,CAAC,EACfv+C,GAASrE,UAAS4iD,EAAU5iD,QAAUqE,GAASrE,SAC/CqE,GAASob,qBAAoBmjC,EAAUnjC,mBAAqBpb,GAASob,oBAGzE,MACMymE,EADiB5yD,GAAoBjvB,GAASukB,mBACjBpyB,OAAO2xB,GAAW,aAANA,GAA0B,YAANA,GACnEy6B,EAAUh6B,kBAAoBlzB,KAAKuR,UAAUi/E,GAG7CtjC,EAAUx5B,eAAgB,EAC1Bw5B,EAAU5/B,iBAAkB,QAKtB0mD,EAAAA,GAAAA,IAAcrlE,GAASnE,GAAI0iD,EAAW9vD,GAAOC,GAErD,CAAE,MAAOuC,GACP4mD,IAAaA,GAAU,qCAADj8C,OAAwB3K,EAAMoE,SAAW,CAAE1K,KAAM,SACzE,CAAC,QACCi3F,IAAiB,GACjBlyF,IAAY,EACd,GAEFoyF,EACF,GACC,CAACH,GAAevkC,GAA0B3tD,KAG7C,MAAMsyF,GAA8BzpB,IAClC7X,GAAY,OAAQ,SAAU6X,EAAa,wHAG3C5mE,GAAkB,6BAA8B,GAGhDA,GAAkB,iCAAkC,GAGpDmwD,KAGA/nD,WAAW,IAAMoc,IAAgB,GAAO,MAyFpCwpE,GAAgBA,CAACp3E,EAAW1W,KAEhC,MAAMowF,GAAYlwF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQkO,IAAQ,IAAE,CAACsI,GAAY1W,IAG3CqwF,EAAY9lE,GAAqB6lE,EADS,IAAjBhqF,GAAqB,OAASg9B,IAI7DwxB,GAAoB30D,IAClB,MAAME,GAASD,EAAAA,EAAAA,GAAA,GAAQD,GAMvB,OALIowF,EAAU35E,GACZvW,EAAUuW,GAAa25E,EAAU35E,UAE1BvW,EAAUuW,GAEZvW,KAMLyzE,GAAsBA,KAG1B,GAAI1jB,GAEF,OADA0E,GAAoB,CAAC,IACd,GAKT07B,EAAAA,EAAAA,WAAU,KACRx7B,IAAoB,KAGtB,IAAI/2D,EAAS,CAAC,EAGd,GAAIqQ,GAAS2e,gBAAiB,CAAC,IAAD3B,EAEO,QAA/BA,EAAChd,GAAS4b,6BAAqB,IAAAoB,GAA9BA,EAAgCjoB,SACnCpF,EAAOisB,sBAAwB,4CAEnC,KAAO,CAAC,IAADumE,EAAAC,EAAAC,EAIL,MAAMC,EAA0C,IAAjBtqF,GAAqB,OAASg9B,GAGvDzY,EAAgB,CACpB6T,OAAQ,CAAEznB,QAAS3Q,IAAgB,EAAGimB,OAAQsU,IAC9ClC,OAAQ,CAAE1nB,QAAS3Q,IAAgB,EAAGimB,OAAQuU,IAC9ChlB,YAAa,CAAE7E,QAASsyD,GAAiBtyD,QAASsV,QAASg9C,GAAiBryD,SAC5EwpB,OAAQ,CAAEzpB,QAAS3Q,IAAgB,EAAGimB,OAAQwU,IAC9C8vD,UAAW,CAAE55E,QAAS3Q,IAAgB,EAAGimB,OAAQk9C,IACjDt8C,uBAAwB,CAAElW,QAASiyD,GAAqBjyD,QAASsV,OAAQ48C,KAIrE2nB,EAAiBrmE,GAAqBnc,GAAUsiF,EAAwB/lE,GAC9E5sB,GAAMmC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQnC,GAAW6yF,GAKzB,MAAMC,EAA4BlmE,EAAc/O,YAAY7E,UAAY4T,EAAc/O,YAAYyQ,OAClG,GAAIjmB,IAAgB,GAAKgI,GAAS4L,oBAAsB62E,EAA2B,CACjF,MAAM9lB,EAAsBnwD,GAAmBI,KAAKC,GAClDA,EAAI1B,MAAQnL,GAAS4L,oBACrBiB,EAAIvB,YAActL,GAAS4L,oBAC3BiB,EAAIjb,QAAUoO,GAAS4L,oBAGzB,GAAI+wD,EAAqB,CACvB,MAAM7sE,EAAQ6sE,EAAoB7vD,aAAe6vD,EAAoB7sE,OAAS,GAqB9C,IAAD4yF,EA2BA5kE,EA3B/B,IAlBIhuB,EAAMoC,SAAS,cAAgBpC,EAAMoC,SAAS,wBAC3C8N,GAAS+L,QACTxa,MAAMC,QAAQwO,GAAS+L,SAAsC,IAA3B/L,GAAS+L,OAAOvY,UACrD7D,EAAOoc,OAAS,yFAKd/T,IAAgB,GAAKgI,GAASyb,oBAAsBzb,GAASyb,mBAAmBjoB,OAAS,GAC3FwM,GAASyb,mBAAmB3T,QAAQ,CAACqW,EAASC,KACvCD,EAAQwkE,eAAkBxkE,EAAQymD,QACrCj1E,EAAO,WAADiM,OAAYwiB,EAAK,QAAM,gBAAAxiB,OAAcwiB,EAAQ,EAAC,wFAOxDtuB,EAAMoC,SAAS,WACjB,GAA2B,QAAvBwwF,EAAC1iF,GAASgM,qBAAa,IAAA02E,GAAtBA,EAAwB3tF,OAEtB,CAEmB+1D,GAAYv/C,KAAKuY,GACxB,IAAdA,EAAE3S,UAA+B,IAAd2S,EAAE3S,UACrB2S,EAAE9X,gBAAkBhM,GAASgM,eAAiB8X,EAAEqsC,kBAAoBnwD,GAASgM,kBAI9Erc,EAAOqc,cAAgB,8GAE3B,MAXErc,EAAOqc,cAAgB,4EAe3B,GAAIlc,EAAMoC,SAAS,sBAAiB,EACmC,kBAApC8N,GAASkM,uBACtClM,GAASkM,uBACT,IACmBnX,SACrBpF,EAAOuc,uBAAyB,kHAEpC,CAGA,GAAIpc,EAAMoC,SAAS,WACmB,QAAhC4rB,EAAC9d,GAASoM,8BAAsB,IAAA0R,GAA/BA,EAAiC/oB,SACpCpF,EAAOyc,uBAAyB,4HAGtC,CACF,CAIA,GAAqB,IAAjBpU,IAAyE,SAAhB,QAAnCmqF,EAAAniF,GAAS6b,kCAA0B,IAAAsmE,OAAA,EAAnCA,EAAqCp7D,WAAqB,CAAC,IAAD67D,EAElF,MAAMC,EAAmB7iF,GAAS6b,4BACD,OAAhBgnE,QAAgB,IAAhBA,OAAgB,EAAhBA,EAAkB77D,UAAW67D,EAAiB77D,QAAQxzB,OAAS,IAG9E7D,EAAOksB,2BAA6B,2IAKjB,OAAhBgnE,QAAgB,IAAhBA,GAAAA,EAAkB57D,QAA6C,KAAnC47D,EAAiB57D,OAAOlyB,SACvDpF,EAAOmsB,cAAgB,uGAIC,QAAtB8mE,EAAC5iF,GAAS+b,oBAAY,IAAA6mE,GAArBA,EAAuB7tF,SAC1BpF,EAAOosB,aAAe,iEAE1B,CAaI/jB,IAAgB,GAFSo9D,IAEoBp1D,GAASyb,oBAAsBzb,GAASyb,mBAAmBjoB,OAAS,GACnHwM,GAASyb,mBAAmB3T,QAAQ,CAACqW,EAASC,KACvCD,EAAQ04C,UAAa14C,EAAQ04C,SAAS9hE,SACzCpF,EAAO,WAADiM,OAAYwiB,EAAK,cAAY,gBAAAxiB,OAAcwiB,EAAQ,EAAC,0FAEvDD,EAAQ24C,YAAe34C,EAAQ24C,WAAW/hE,SAC7CpF,EAAO,WAADiM,OAAYwiB,EAAK,gBAAc,gBAAAxiB,OAAcwiB,EAAQ,EAAC,yFAEzDD,EAAQ44C,cAAiB54C,EAAQ44C,aAAahiE,SACjDpF,EAAO,WAADiM,OAAYwiB,EAAK,kBAAgB,gBAAAxiB,OAAcwiB,EAAQ,EAAC,gGAQpE,MAAMqV,EAAuD,cAAb,QAApB2uD,EAAApiF,GAASwN,mBAAW,IAAA40E,OAAA,EAApBA,EAAsBn7D,QAC5CyM,EAA4E,cAAb,QAAnC2uD,EAAAriF,GAAS6b,kCAA0B,IAAAwmE,OAAA,EAAnCA,EAAqCp7D,QACjE8J,EAAa0C,GAAuBC,EAkC1C,GAhCI17B,IAAgB,IAAM+4B,GAAc/wB,GAAS6H,SAAW7H,GAAS6H,QAAQrU,OAAS,GACpFwM,GAAS6H,QAAQC,QAAQ,CAACC,EAASqW,KACjC,MAAM0kE,EAAa,WAAAlnF,OAAcwiB,EAAQ,KAGpCrW,EAAQ2P,eAAmD,kBAA1B3P,EAAQ2P,eAA+D,KAAjC3P,EAAQ2P,cAAc3iB,UAChGpF,EAAO,GAADiM,OAAIknF,EAAa,WAAS,WAAAlnF,OAAcwiB,EAAQ,EAAC,6CAIpDrW,EAAQK,WAAaF,WAAWH,EAAQK,YAAc,KACzDzY,EAAO,GAADiM,OAAIknF,EAAa,YAAU,WAAAlnF,OAAcwiB,EAAQ,EAAC,8FAIrDrW,EAAQ+P,mBAA2D,kBAA9B/P,EAAQ+P,mBAAuE,KAArC/P,EAAQ+P,kBAAkB/iB,UAC5GpF,EAAO,GAADiM,OAAIknF,EAAa,cAAY,WAAAlnF,OAAcwiB,EAAQ,EAAC,sDAIvDrW,EAAQ6e,cAAiD,kBAAzB7e,EAAQ6e,cAA6D,KAAhC7e,EAAQ6e,aAAa7xB,UAC7FpF,EAAO,GAADiM,OAAIknF,EAAa,eAAa,WAAAlnF,OAAcwiB,EAAQ,EAAC,yCAW7DpmB,IAAgB,IAAM+4B,GAAc/wB,GAAS6H,SAAW7H,GAAS6H,QAAQrU,OAAS,EAAG,CACvF,MAAMyU,EAAUC,WAAWlI,GAASmI,iBAAmB,EAEvDnI,GAAS6H,QAAQC,QAAQ,CAACC,EAASqW,KAES,IAAtCrW,EAAQ+3D,4BAAyE,IAAtC/3D,EAAQ+3D,4BACrDnwE,EAAO,WAADiM,OAAYwiB,EAAQ,EAAC,qBAAmB,WAAAxiB,OAAcwiB,EAAQ,EAAC,qGAIjDlW,WAAWH,EAAQK,YAAc,GACnCH,KAAaF,EAAQM,0BAAwE,KAA5CN,EAAQM,yBAAyBtT,UACpGpF,EAAO,WAADiM,OAAYwiB,EAAQ,EAAC,iBAAe,WAAAxiB,OAAcwiB,EAAQ,EAAC,qGAAAxiB,OAA0EqM,EAAQknC,QAAQ,GAAE,eAGnK,CACF,CAEA,MAAMxlC,EAAY1U,OAAOC,KAAKvF,GAAQ6D,OAAS,GAI/C0uF,EAAAA,EAAAA,WAAU,KACR17B,GAAoB72D,KAMtB,MAAMozF,EAAoB9tF,OAAOC,KAAKvF,GAAQwC,OAAO6wF,GACnDA,EAAE9wF,SAAS,cAAgB8wF,EAAE9wF,SAAS,gBAAkB8wF,EAAE9wF,SAAS,kBAGrE,GAAI6wF,EAAkBvvF,OAAS,EAAG,CAAC,IAADyvF,EAEhC,MAAMC,EAA2B,IAAIl0D,IACrC+zD,EAAkBj7E,QAAQtf,IACxB,MAAM6/E,EAAQ7/E,EAAI6/E,MAAM,kBACpBA,GACF6a,EAAyB1zD,IAAIvrB,SAASokE,EAAM,OAKhD,MAAM8a,GAAwBrxF,EAAAA,EAAAA,GAAA,GAAQ60D,IACX,QAA3Bs8B,EAAAjjF,GAASyb,0BAAkB,IAAAwnE,GAA3BA,EAA6Bn7E,QAAQ,CAACqW,EAASC,KACzC8kE,EAAyB3zD,IAAInR,KAC/B+kE,EAAyBhlE,EAAQtiB,KAAM,MAI3CqmF,EAAAA,EAAAA,WAAU,KACRt7B,GAAyBu8B,IAE7B,CAGA,GAAIx5E,EAAW,CACM1U,OAAOC,KAAKvF,GAAQ6D,OAEvC,GAAIwM,GAAS2e,gBAEXk5B,IAAaA,GAAU,wDAAiD,CAAEltD,KAAM,cAC3E,CAEL,MAAMy4F,EAAoB5tB,GAAuB7lE,GAEjDkoD,IAAaA,GAAUurC,EAAmB,CACxCz4F,KAAM,QACNiuB,QAAS,KAEb,CAGA9e,WAAW,KACTupF,GAAmB1zF,IAClB,IACL,CAEA,OAAQga,GAkOJ05E,GAAsB1zF,IAC1B,IAAKA,GAAyC,IAA/BsF,OAAOC,KAAKvF,GAAQ6D,OAAc,OAGjD,MAAM8vF,EAAa,CACjB,QACA,QACA,qBACA,UACA,cACA,iBACA,gBACA,qBACA,kBACA,mBACA,gBACA,sBACA,qBACA,qBACA,SACA,iBACA,6BACA,gBACA,eACA,gBACA,gBAIF,IAAK,MAAM3xF,KAAS2xF,EAClB,GAAI3zF,EAAOgC,GAAQ,CAEjB,IAAI4xF,EAAU,KACVC,EAAgB,KAEpB,OAAQ7xF,GACN,IAAK,QACH4xF,EAAU99E,SAASorC,cAAc,uBACjC,MACF,IAAK,QACH0yC,EAAU99E,SAASorC,cAAc,qCACjC,MACF,IAAK,qBACH0yC,EAAU99E,SAASorC,cAAc,yBACjC,MACF,IAAK,UACH0yC,EAAU99E,SAASorC,cAAc,yBACjC,MACF,IAAK,cACH0yC,EAAU99E,SAASorC,cAAc,2BACjC,MACF,IAAK,iBACH0yC,EAAU99E,SAASorC,cAAc,gCACjC,MACF,IAAK,gBACH0yC,EAAU99E,SAASorC,cAAc,4BACjC,MACF,IAAK,qBACH0yC,EAAU99E,SAASorC,cAAc,uCACjC,MACF,IAAK,kBACH0yC,EAAU99E,SAASorC,cAAc,iCACjC,MACF,IAAK,mBACH0yC,EAAU99E,SAASorC,cAAc,kCACjC,MACF,IAAK,gBACH0yC,EAAU99E,SAASorC,cAAc,+BACjC,MACF,IAAK,sBACH0yC,EAAU99E,SAASorC,cAAc,sCACjC,MACF,IAAK,qBAEH,MAAM4yC,EAAcxuF,OAAOC,KAAKvF,GAAQwC,OAAO6wF,GAAKA,EAAEt7E,WAAW,aACjE,GAAI+7E,EAAYjwF,OAAS,EAAG,CAC1B,MAAMkwF,EAAoBD,EAAY,GAChCrlE,EAAQna,SAASy/E,EAAkBp+D,MAAM,KAAK,IACpDi+D,EAAU99E,SAASorC,cAAc,wBAADj1C,OAAyBwiB,EAAK,OACzDmlE,IAEHA,EAAU99E,SAASorC,cAAc,4BAErC,CACA,MACF,IAAK,qBACH0yC,EAAU99E,SAASorC,cAAc,qCACjC,MACF,IAAK,SACH0yC,EAAU99E,SAASorC,cAAc,yBACjC,MACF,IAAK,iBACH0yC,EAAU99E,SAASorC,cAAc,gCACjC,MACF,IAAK,6BACH0yC,EAAU99E,SAASorC,cAAc,uCACjC,MACF,IAAK,gBACH0yC,EAAU99E,SAASorC,cAAc,0BACjC,MACF,IAAK,eACH0yC,EAAU99E,SAASorC,cAAc,8BACjC,MACF,IAAK,gBAEH0yC,EAAU99E,SAASorC,cAAc,iCACvBprC,SAASorC,cAAc,2CACjC,MACF,IAAK,eACH0yC,EAAU99E,SAASorC,cAAc,8BACjC,MACF,QAEE0yC,EAAU99E,SAASorC,cAAc,UAADj1C,OAAWjK,EAAK,qBAAAiK,OAAoBjK,EAAK,OAG7E,GAAI4xF,EAAS,CAGX,GADAC,EAAgBD,EAAQr8E,QAAQ,kBAC5Bs8E,EAAe,CACjB,MAAMlrB,EAAckrB,EAAcG,aAAa,gBAC/C,GAAIrrB,GAAe/7C,GAAc+7C,GAAc,CAE7Cpe,GAAiBroD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUD,GAAI,IAAE,CAACymE,IAAc,KAGpDx+D,WAAW,KACTypF,EAAQK,eAAe,CACrBxD,SAAU,SACVyD,MAAO,SACPC,OAAQ,YAIVhqF,WAAW,KACT,IAEE,MAAMiqF,EAAcR,EAAQ1yC,cAAc,SACtCkzC,EACFA,EAAY/pF,QAEZupF,EAAQvpF,OAEZ,CAAE,MAAOvI,GACP,GAED,MACF,KACH,KACF,CACF,CAGA8xF,EAAQK,eAAe,CACrBxD,SAAU,SACVyD,MAAO,SACPC,OAAQ,YAIVhqF,WAAW,KACT,IAEE,MAAMiqF,EAAcR,EAAQ1yC,cAAc,SACtCkzC,EACFA,EAAY/pF,QAEZupF,EAAQvpF,OAEZ,CAAE,MAAOvI,GACP,GAED,KACH,KACF,CACF,GA0OEuyF,GAA4BA,KAChCt3B,IAA6B,GAC7BE,GAAyB,OA+FrB0mB,GAAyBxiF,UAC7B,GAAKrC,IAAU4L,GAAf,CAEA0xD,IAAoB,GACpB,IAGE,IAAI54C,QAAiB8wE,EAAAA,GAAAA,IAA2B,CAC9Cv1F,UAAc,OAAJwiB,SAAI,IAAJA,QAAI,EAAJA,GAAMxiB,WAAYA,GAC5BD,SACA4L,QAASA,IAAW,EACpB04D,UAAW,eACXlmC,OAAO,IAMLwmD,EAAY,GAShB,GARI9hF,MAAMC,QAAgB,OAAR2hB,QAAQ,IAARA,OAAQ,EAARA,EAAU+wE,OAC1B7Q,EAAYlgE,EAAS+wE,OACZ3yF,MAAMC,QAAgB,OAAR2hB,QAAQ,IAARA,OAAQ,EAARA,EAAUlY,OAEhB,OAARkY,QAAQ,IAARA,GAAAA,EAAUvC,SAAWrf,MAAMC,QAAgB,OAAR2hB,QAAQ,IAARA,OAAQ,EAARA,EAAUlY,SADtDo4E,EAAYlgE,EAASlY,MAKnBo4E,EAAU7/E,OAAS,EAAG,CAExB,MAAM2wF,EAAa9Q,EAAUlhF,OAAO6I,GAAmB,IAAdA,EAAEX,SAAuC,MAAtBC,OAAOU,EAAEX,UAC/D+pF,EAAW/Q,EAAUlhF,OAAO6I,GAAmB,IAAdA,EAAEX,SAAuC,MAAtBC,OAAOU,EAAEX,UAG7DgqF,EAA2BF,EAAWtwF,IAAImH,IAC9C,MAAMQ,EAAOR,EAAEspF,eAAiBtpF,EAAElL,OAASkL,EAAEQ,MAAI,WAAAI,OAAeZ,EAAEa,IAC5DU,EAAKvB,EAAEmjE,gBAAkBnjE,EAAEyqB,cAAgBxW,KAAKC,MAChDjU,EAAOspF,GAAkBvpF,GAGzBwpF,EAAUxpF,EAAEE,KAAOF,EAAErQ,MAAQ,GAC7B85F,GAA+B,kBAAXD,EAAsBA,EAASlqF,OAAOkqF,GAAU,KAAKzvF,OAAO+nB,cACtF,IAAI4nE,EAAa,KACbD,IACgB,OAAdA,GAAoC,QAAdA,GAAqC,QAAdA,GAAqC,MAAdA,EAAmBC,EAAa,KACjF,WAAdD,GAAwC,QAAdA,GAAqC,YAAdA,EAAyBC,EAAa,SACzE,UAAdD,GAAuC,cAAdA,GAA2C,cAAdA,GAA2C,SAAdA,GAGtFA,EAAUvyF,SAAS,OAASuyF,EAAUvyF,SAAS,UAH6DwyF,EAAa,QAIpHD,EAAUvyF,SAAS,MAAOwyF,EAAa,KACvCD,EAAUvyF,SAAS,SAAQwyF,EAAa,WAKrD,MAAM/5F,EAAO+5F,IAAgBzpF,EAAKS,YAAcT,EAAK2B,aAAgB,QAAW3B,EAAKS,WAAa,KAAQT,EAAK2B,aAAe,SAAW,MAEzI,OAAA9K,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKkJ,GAAC,IACJQ,OACAC,OAAQT,EAAEspF,eAAiB,KAC3B/nF,GAAK,IAAI0S,KAAK1S,GAAKo/B,QAAW,IAAI1sB,KAAK1S,GAAKo/B,UAAY1sB,KAAKC,MAC7DvkB,OACAg6F,cAAc,EACd1pF,WAIJ4wD,GAAmBw4B,GAGnB,MAAMO,EAAyBR,EAASvwF,IAAImH,IAC1C,MAAMQ,EAAOR,EAAEspF,eAAiBtpF,EAAElL,OAASkL,EAAEQ,MAAI,WAAAI,OAAeZ,EAAEa,IAC5DU,EAAKvB,EAAEmjE,gBAAkBnjE,EAAEyqB,cAAgBxW,KAAKC,MAChDjU,EAAOspF,GAAkBvpF,GAGzBwpF,EAAUxpF,EAAEE,KAAOF,EAAErQ,MAAQ,GAC7B85F,GAA+B,kBAAXD,EAAsBA,EAASlqF,OAAOkqF,GAAU,KAAKzvF,OAAO+nB,cACtF,IAAI4nE,EAAa,KACbD,IACgB,OAAdA,GAAoC,QAAdA,GAAqC,QAAdA,GAAqC,MAAdA,EAAmBC,EAAa,KACjF,WAAdD,GAAwC,QAAdA,GAAqC,YAAdA,EAAyBC,EAAa,SACzE,UAAdD,GAAuC,cAAdA,GAA2C,cAAdA,GAA2C,SAAdA,GAGtFA,EAAUvyF,SAAS,OAASuyF,EAAUvyF,SAAS,UAH6DwyF,EAAa,QAIpHD,EAAUvyF,SAAS,MAAOwyF,EAAa,KACvCD,EAAUvyF,SAAS,SAAQwyF,EAAa,WAKrD,MAAM/5F,EAAO+5F,IAAgBzpF,EAAKS,YAAcT,EAAK2B,aAAgB,QAAW3B,EAAKS,WAAa,KAAQT,EAAK2B,aAAe,SAAW,MAEzI,OAAA9K,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKkJ,GAAC,IACJQ,OACAC,OAAQT,EAAEspF,eAAiB,KAC3B/nF,GAAK,IAAI0S,KAAK1S,GAAKo/B,QAAW,IAAI1sB,KAAK1S,GAAKo/B,UAAY1sB,KAAKC,MAC7DvkB,OACAg6F,cAAc,EACd1pF,WAIJ2wD,GAAkBg5B,GAGlB,IACE,MAAMp8F,EAAM6R,GAAO,mBAAAuB,OAAsBvB,IAAY,kBACrDqI,aAAaC,QAAQna,EAAK6I,KAAKuR,UAAUgiF,GAE3C,CAAE,MAAO3zF,GACT,CAIA66D,GAAwB,CACtBj4C,QAAgB,OAARV,QAAQ,IAARA,OAAQ,EAARA,EAAUU,SAAU,UAC5B5iB,OAAe,OAARkiB,QAAQ,IAARA,OAAQ,EAARA,EAAUliB,QAAS,KAC1B4zF,KAAa,OAAR1xE,QAAQ,IAARA,OAAQ,EAARA,EAAU0xE,MAAO,OAExBxF,GAAkB,QAAS,CAAEjlB,MAAOiZ,EAAU7/E,OAAQsxF,YAAaT,EAAyB7wF,OAAQuxF,UAAWH,EAAuBpxF,QACxI,MACEs4D,GAAwB,CACtBj4C,QAAgB,OAARV,QAAQ,IAARA,OAAQ,EAARA,EAAUU,SAAU,QAC5B5iB,OAAe,OAARkiB,QAAQ,IAARA,OAAQ,EAARA,EAAUliB,QAAS,2CAC1B4zF,KAAa,OAAR1xE,QAAQ,IAARA,OAAQ,EAARA,EAAU0xE,MAAO,MAG5B,CAAE,MAAO5zF,GACP66D,GAAwB,CAAEj4C,OAAQ,QAAS5iB,MAAOA,EAAMoE,SAC1D,CAAC,QACC02D,IAAoB,EACtB,CAtI8B,GA0I1Bw4B,GAAqBS,IACzB,IAEE,MAAMC,EAA0Bh2C,IAC9B,GAAY,OAARA,QAAwBviC,IAARuiC,EAAmB,OAAO,KAC9C,GAAmB,kBAARA,EAAkB,OAAOA,EACpC,MAAM41C,EAAM51C,EAAIl6C,OAChB,IAAK8vF,EAAK,OAAO,KAGjB,IAAM,OAAOxzF,KAAKC,MAAMuzF,EAAM,CAAE,MAAOpzF,GAAI,CAG3C,IAAIqyB,EAAI+gE,EAAIzyE,QAAQ,SAAU,KAAKrd,OAGnC,IACE+uB,EAAIA,EAAE1R,QAAQ,4BAA6B,UAC7C,CAAE,MAAO3gB,GAAI,CAGbqyB,EAAIA,EAAE1R,QAAQ,KAAM,KAGpB,IAAM,OAAO/gB,KAAKC,MAAMwyB,EAAI,CAAE,MAAOryB,GAAI,CAGzC,IAGE,OADW,IAAIyzF,SAAS,WAAaL,EAAM,KACpCM,EACT,CAAE,MAAO1zF,GACP,OAAO,IACT,GAGI2zF,EAAQJ,EAASK,WAAaJ,EAAuBD,EAASK,YAAc,KAC5EC,EAAYN,EAASO,eAAiBN,EAAuBD,EAASO,gBAAkB,KAGxFC,EAAkBC,IACtB,IAAKA,GAAsB,kBAARA,GAAoBl0F,MAAMC,QAAQi0F,GAAM,OAAOA,EAClE,MAAMC,EAAM,CAAC,EAuBb,OAtBAzwF,OAAOC,KAAKuwF,GAAK39E,QAAQk7E,IACvB,MAAM/zC,EAAMw2C,EAAIzC,GAChB,GAAIA,EAAE9wF,SAAS,KAAM,CACnB,MAAMyzF,EAAQ3C,EAAE19D,MAAM,KACtB,IAAIsgE,EAAMF,EACVC,EAAM79E,QAAQ,CAACkvD,EAAGl8D,KACZA,IAAQ6qF,EAAMnyF,OAAS,EACzBoyF,EAAI5uB,GAAK/nB,GAEJ22C,EAAI5uB,IAAwB,kBAAX4uB,EAAI5uB,KAAiB4uB,EAAI5uB,GAAK,CAAC,GACrD4uB,EAAMA,EAAI5uB,KAGhB,KAEqB,kBAAR/nB,GAA4B,OAARA,GAAiB19C,MAAMC,QAAQy9C,IAA0B,kBAAXy2C,EAAI1C,GAG/E0C,EAAI1C,GAAK/zC,EAFTy2C,EAAI1C,IAAElxF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQ4zF,EAAI1C,IAAO/zC,KAMxBy2C,GAGHG,EAAWT,EAAQI,EAAeJ,GAAS,KAC3CU,EAAeR,EAAYE,EAAeF,GAAa,KAEvDrqF,EAAO,CAAC,EAId,OAHI4qF,IAAU5qF,EAAKS,WAAamqF,GAC5BC,IAAc7qF,EAAK2B,aAAekpF,GAE/B7qF,CACT,CAAE,MAAOhK,GACP,MAAO,CAAC,CACV,GAkII80F,GAAwBj1F,MAAO0K,EAAMP,EAAMtQ,KAC/C,GAAK8D,IAAU4L,GAIf,IAEE,MAAMgrF,EAAuB,OAAT16F,GAA0B,UAATA,IAAqBsQ,EAAKS,WAE3D,GADArK,KAAKuR,UAAU3H,EAAKS,YAElB6pF,EAA2B,YAAT56F,GAA+B,UAATA,IAAqBsQ,EAAK2B,aAEpE,GADAvL,KAAKuR,UAAU3H,EAAK2B,cAGlB1B,EAAe,OAATvQ,EAAgB,KAAgB,YAATA,EAAqB,SAAW,QAE7DwoB,QAAiB6yE,EAAAA,GAAAA,IAAe,CACpCt3F,UAAc,OAAJwiB,SAAI,IAAJA,QAAI,EAAJA,GAAMxiB,WAAYA,GAC5BD,SACA4L,QAASA,IAAW,EACpBiqF,cAAe9oF,EACf6pF,aACAE,iBACArqF,MACA63D,UAAW,iBAGb,KAAY,OAAR5/C,QAAQ,IAARA,GAAAA,EAAUvC,SAAgC,QAAb,OAARuC,QAAQ,IAARA,OAAQ,EAARA,EAAUU,SA4B5B,CAAC,IAADoyE,EACL,MAAM/sE,GAAmB,OAAR/F,QAAQ,IAARA,OAAQ,EAARA,EAAU9d,WAAmB,OAAR8d,QAAQ,IAARA,GAAc,QAAN8yE,EAAR9yE,EAAUlY,YAAI,IAAAgrF,OAAN,EAARA,EAAgB5wF,UAAW,mCACjE,MAAM,IAAI+f,MAAM8D,EAClB,CA/BoD,CAAC,IAADgtE,EAElD,MAAMC,EAAc,CAClB3qF,OACAP,OACAsB,GAAI0S,KAAKC,MACTvkB,OACAkR,GAAIsX,EAASizE,UAAYjzE,EAAStX,KAAmB,QAAjBqqF,EAAI/yE,EAASlY,YAAI,IAAAirF,OAAA,EAAbA,EAAerqF,IACvDxB,WACAsqF,cAAc,GAGhB/4B,GAAkB/5D,IAChB,MAAMw0F,EAAmB,CAACF,KAAgBt0F,GAE1C,IACE,MAAMrJ,EAAM6R,GAAO,mBAAAuB,OAAsBvB,IAAY,kBACrDqI,aAAaC,QAAQna,EAAK6I,KAAKuR,UAAUyjF,GAC3C,CAAE,MAAOp1F,GACT,CACA,OAAOo1F,IAGThH,GAAkB,OAAQ,CAAE7jF,OAAM7Q,OAAM27F,KAAM,WAE1CzuC,IACFA,GAAU,iBAADj8C,OAAaJ,EAAI,uBAAkB,CAAE7Q,KAAM,WAExD,CAIF,CAAE,MAAOsG,GACH4mD,IACFA,GAAU,kDAADj8C,OAAgC3K,EAAMoE,SAAW,CAAE1K,KAAM,SAEtE,GAuCI47F,IAAiB/jF,EAAAA,EAAAA,aAAY,CAACgkF,EAAQ70F,KAC1C,IAAK60F,EAAQ,MAAO,GAEpB,OAAQ70F,GACN,IAAK,SACH,MAAO,GAAAiK,OAAG4qF,EAAO30E,WAAa20E,EAAO30E,WAAa,IAAM,IAAEjW,OAAG4qF,EAAOz0E,OAAS,GAAE,KAAAnW,OAAI4qF,EAAOv0E,UAAY,IAAErW,OAAG4qF,EAAOr0E,SAAW,KAAOq0E,EAAOr0E,SAAW,IAAKC,QAAQ,OAAQ,KAAKrd,OAClL,IAAK,WAEH,IAAKyxF,GAAqB,IAAXA,GAA8B,IAAdA,EAAO3qF,IAA+B,IAAnB2qF,EAAOnsF,SAA+B,OAAdmsF,EAAO3qF,IAAkC,OAAnB2qF,EAAOnsF,QACrG,MAAO,gBAIT,OAFiB,GAAAuB,OAAG4qF,EAAO30E,WAAa20E,EAAO30E,WAAa,IAAM,IAAEjW,OAAG4qF,EAAOz0E,OAAS,GAAE,KAAAnW,OAAI4qF,EAAOv0E,UAAY,IAAErW,OAAG4qF,EAAOr0E,SAAW,KAAOq0E,EAAOr0E,SAAW,IAAKC,QAAQ,OAAQ,KAAKrd,QAEtK,kBADDyxF,EAAOr1F,SAAQ,KAAAyK,OAAQ4qF,EAAOr1F,SAAQ,KAAM,IAEjE,IAAK,YACL,IAAK,gBAEH,OAAIq1F,EAAO/6F,MACF+6F,EAAO/6F,MAGT+6F,EAAOhrF,MAAQgrF,EAAO15E,aAAe05E,EAAOrrF,WACrD,IAAK,cACL,IAAK,qBAEH,OAAOqrF,EAAO15E,aAAe05E,EAAO12F,OAAS02F,EAAO/6F,QAA4B,kBAAX+6F,EAAsBA,EAAS,iBACtG,IAAK,SAEH,OAAOA,EAAO33B,SAAQ,GAAAjzD,OACf4qF,EAAO33B,SAAQ,OAAAjzD,OAAM4qF,EAAO5yB,YAAc,gBAAW,GAAAh4D,OACrD4qF,EAAO3qF,IAAM2qF,EAAM,OAAA5qF,OAAM4qF,EAAO5yB,YAAc4yB,EAAO12F,OAAS02F,EAAO/6F,OAAS,gBACvF,IAAK,sBAEH,MAAMg7F,EAAYD,EAAO15E,aAAe05E,EAAO12F,OAAS02F,EAAO/6F,QAA4B,kBAAX+6F,EAAsBA,EAAS,iBAG/G,OAF6C,IAA3BA,EAAOjxB,iBAAoD,MAA3BixB,EAAOjxB,gBAEzC,GAAA35D,OAAM6qF,EAAS,gBAAiBA,EAElD,IAAK,eACH,OAAOD,EAAO15E,aAAe05E,EAAO12F,OAAS02F,EAAOloE,OAASkoE,EAAOl7E,WAAak7E,EAAOr7E,KAAO7Q,OAAOksF,GACxG,IAAK,qBACL,IAAK,iBACH,OAAOA,EAAOjrF,aAAe,GAAAK,OAAG4qF,EAAOz0E,OAAS,GAAE,KAAAnW,OAAI4qF,EAAOv0E,UAAY,IAAKld,QAAU,eAC1F,IAAK,uBAEH,OAAKyxF,GAAqB,IAAXA,GAA8B,IAAdA,EAAO3qF,IAA+B,IAAnB2qF,EAAOnsF,SAA+B,OAAdmsF,EAAO3qF,IAAkC,OAAnB2qF,EAAOnsF,UAGhGmsF,EAAOjrF,aAAeirF,EAAOE,gBAAkB,GAAA9qF,OAAG4qF,EAAOz0E,OAAS,GAAE,KAAAnW,OAAI4qF,EAAOv0E,UAAY,IAAKld,SAF9F,gBAGX,IAAK,WACH,OAAOyxF,EAAO/6F,OAAS6O,OAAOksF,EAAO50F,OAAS40F,GAChD,QAEE,OAAI70F,GAA0B,kBAAVA,GAAsBA,EAAM+V,WAAW,aAAe/V,EAAMwuE,SAAS,OAEhFqmB,EAAO/6F,QAAU+6F,EAAOr7E,KAAOq7E,EAAO12F,MAAK,GAAA8L,OAAM4qF,EAAOr7E,IAAG,OAAAvP,OAAM4qF,EAAO12F,OAAUwK,OAAOksF,IAG3FA,EAAO/6F,QAA4B,kBAAX+6F,EAAsBA,EAASlsF,OAAOksF,MAExE,KAmUH32F,EAAAA,EAAAA,WAAU,KACR,MAAMkX,EAAsBC,IAErBA,EAAM5S,OAAO8S,QAAQ,yBArZ5BkzC,GAAgB,CACdC,QAAQ,EACRC,UAAU,EACV/sC,WAAW,EACXC,aAAa,EACbzB,QAAQ,KAsZV,OADAtG,SAASjB,iBAAiB,YAAauC,GAChC,KACLtB,SAAShB,oBAAoB,YAAasC,KAE3C,IAOH,MAAM4/E,IAAoBnkF,EAAAA,EAAAA,aAAa/Q,IAAO,IAADm1F,EAC3C,GAAc,QAAVn1F,EAAEjJ,IAAe,OAGrB,MAAMq+F,EAAgBphF,SAASohF,cAO/B,IAJkC,OAAbA,QAAa,IAAbA,OAAa,EAAbA,EAAe3/E,QAAQ,0BACX,OAAb2/E,QAAa,IAAbA,OAAa,EAAbA,EAAe3/E,QAAQ,gCACV,OAAb2/E,QAAa,IAAbA,OAAa,EAAbA,EAAe3/E,QAAQ,gCAIzC,OAIF,MAAM4/E,EAAgBrhF,SAASorC,cAAc,gCAC7C,IAAKi2C,EAAe,OAGpB,IAAKA,EAAc3gF,SAAS0gF,GAE1B,OAGF,MAAME,EAAqB,CACzB,6CACA,gDACA,8CACA,8CACA,kDACA,qDACAxmB,KAAK,KAKDymB,EAHcz1F,MAAMiV,KAAKsgF,EAAcG,iBAAiBF,IAG1B50F,OAAO+0F,IAEzC,IAAKA,EAAGC,cAA+B,UAAfD,EAAGE,SAAsC,aAAfF,EAAGE,QACnD,OAAO,EAIT,MAAMh0F,EAAQwG,OAAO8mF,iBAAiBwG,GACtC,MAAsB,SAAlB9zF,EAAMuB,SAA2C,WAArBvB,EAAMi0F,cAKlCH,EAAG/6F,UAAiD,SAArC+6F,EAAGvD,aAAa,oBAOrC,GAA+B,IAA3BqD,EAAgBxzF,OAAc,OAGlC,MAAM8zF,EAAeN,EAAgB3f,QAAQwf,GAEnB,IAADU,EAAzB,IAAsB,IAAlBD,EAIF,OAFA71F,EAAEuU,sBACgB,QAAlBuhF,EAAAP,EAAgB,UAAE,IAAAO,GAAlBA,EAAoBvtF,SAKtB,IAAIwtF,EACA/1F,EAAEg2F,UAEJD,EAAWF,EAAe,EACtBE,EAAW,IACbA,EAAWR,EAAgBxzF,OAAS,KAItCg0F,EAAWF,EAAe,EACtBE,GAAYR,EAAgBxzF,SAC9Bg0F,EAAW,IAKf/1F,EAAEuU,iBACuB,QAAzB4gF,EAAAI,EAAgBQ,UAAS,IAAAZ,GAAzBA,EAA2B5sF,SAI1B,IA2BmBq7D,EAAAA,QAAc,MAE9BpL,MAKAnoC,GAMH,CAACmoC,GAAoBnoC,KAIxB,IAAKrzB,KAAUC,GACb,OACE+D,EAAAA,GAAAA,MAAC+zC,GAAc,CAACxF,UAAU,EAAKxuC,SAAA,EAC7BD,EAAAA,GAAAA,KAACm0C,GAAc,CAAC1F,UAAU,KAC1BzuC,EAAAA,GAAAA,KAACq0C,GAAc,CAAC5F,UAAU,EAAKxuC,SAAC,qDAChCD,EAAAA,GAAAA,KAACu0C,GAAc,CAAC9F,UAAU,EAAKxuC,SAAC,uCAoBtC,IAAKiuB,GAAUsB,QACb,OACEtvB,EAAAA,GAAAA,MAAC+zC,GAAc,CAACxF,UAAU,EAAKxuC,SAAA,EAC7BD,EAAAA,GAAAA,KAACm0C,GAAc,CAAC1F,UAAU,KAC1BvuC,EAAAA,GAAAA,MAACm0C,GAAc,CAAC5F,UAAU,EAAKxuC,SAAA,CACR,aAApBiuB,GAAUvhB,OAAwB,mCACd,yBAApBuhB,GAAUvhB,OAAoC,6CAC1B,mBAApBuhB,GAAUvhB,OAA8B,0BACpB,iBAApBuhB,GAAUvhB,OAA4B,2CAClB,gBAApBuhB,GAAUvhB,OAA2B,2CACjB,UAApBuhB,GAAUvhB,OAAqB,uCAC9BuhB,GAAUvhB,OAAS,wDAEvBzM,EAAAA,GAAAA,MAACq0C,GAAc,CAAC9F,UAAU,EAAKxuC,SAAA,EAC3B6vB,GAAaN,SAAO,sBAAAnmB,OAAeymB,GAAawM,aAAe,EAAC,KAAAjzB,OAAIymB,GAAayM,aAAe,EAAC,iCAClGzM,GAAaN,SAAWtB,GAAUqB,mBAAqB,2CACvDO,GAAaN,UAAYtB,GAAUqB,oBAAsBrB,GAAUsB,SAAW,kCAYvF,GAAIqoC,KAAwB37D,GAC1B,OACE8D,EAAAA,GAAAA,KAAC+pC,GAAS,CAACr8B,aAAcA,GAAazN,UACpCD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEC,QAAS,OAAQC,UAAW,UAAWd,UACnDC,EAAAA,GAAAA,MAACy0C,GAAY,CAAA10C,SAAA,CAAC,uBACS43D,UAQ/B,MAAMs9B,IACJj1F,EAAAA,GAAAA,MAAC6pC,GAAS,CAACr8B,aAAcA,GAAazN,SAAA,EAEpCD,EAAAA,GAAAA,KAACo1F,GAAiB,CAChBhoF,eAAgBkhF,GAChBjhF,YAAakhF,GACbjhF,iBAAkBogF,GAClBngF,qBAAsBA,GACtB9H,aAAcs/B,KACdv3B,iBAAkBA,GAClBC,SAAUk6D,GACVj6D,aAAcA,GACdC,gBAAiBA,GACjBC,iBAAkBo6D,GAClBn6D,oBAAqBA,GACrBC,mBAAoBA,GACpBC,kBAAmBA,GACnBE,iBAAkBw/E,GAClBv/E,eAAgBugF,GAChBtgF,mBAAoBA,IAAMk6C,IAAiB36C,IAC3CU,gBAAiBA,OAAsB66D,GACvC56D,iBAAkBirB,KAAqBp8B,MAAchB,MAAW4L,KAAYmhE,GAC5E7jE,gBAAiBA,GACjBC,eAAgBA,GAChBC,iBAAkBA,GAClBC,YAAayuD,GACbxuD,WAAYuuD,GACZ73D,MAAOA,GACPyJ,cAAeA,GACf4I,iBAp3ZoBmuC,GAAQ+W,GAAcliC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEyiC,cAAetX,KAq3ZtEluC,uBAAwBA,KAAM6mF,OAv3ZN34C,EAu3Z2BnrB,IAAMA,EAv3ZzBkiC,GAAcliC,IAAChyB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASgyB,GAAC,IAAEwiC,kBAAmBrX,KAAtDA,OAw3ZxBjuC,mBAAoBsyE,GACpBryE,iBAh2BuB7G,IAC3B,GAAIpC,IAAgB,EAAG,OAEvB,MAAMiD,EAAY,OAALb,QAAK,IAALA,OAAK,EAALA,EAAOa,KACpB,GAAQ,OAAJA,QAAI,IAAJA,GAAAA,EAAMS,WAAY,CACpB,MAAM7J,GAAIC,EAAAA,EAAAA,GAAA,GAAQkO,IACZ6nF,GAAI/1F,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACLD,GACAoJ,EAAKS,YAAU,IAElBG,GAAIhK,EAAKgK,GACT8oB,SAAU9yB,EAAK8yB,WAGjBq7B,GAAY6nC,GACZxI,GAAkB,WAAY,CAC5B7jF,KAAMpB,EAAMoB,KACZ80D,OAAQ,QACR/zD,GAAInC,EAAMmC,GACV0iF,QAASJ,GAAuB5jF,KAIlCm+C,GAAAA,QAAa2a,oBAAmB,GAGhCF,IAAU,GAAM,EAAOg0B,GAAMrqB,MAAM/rE,MAErC,GAq0BI8G,cA3yBsB6B,IAC1B,GAAIpC,GAAe,EAAG,OAEtB,MAAMiD,EAAY,OAALb,QAAK,IAALA,OAAK,EAALA,EAAOa,KACpB,GAAS,OAAJA,QAAI,IAAJA,IAAAA,EAAM2B,aACT,OAIF,MAAMyqF,EAAaloE,GAAqB6V,GAAmBh9B,GAAcC,IACnE6vF,EAhCqB,CAC3Bt6E,YAAa,CACX,qBAAsB,cAAe,SAAU,gBAAiB,mBAChE,yBAA0B,wBAAyB,yBAA0B,6BAE/E+R,UAAW,CACT,eAAgB,kBAAmB,mBAAoB,gBACvD,gBAAiB,wBAEnBC,QAAS,CACP,0BAA2B,0BAA2B,6BAExDC,QAAS,CACP,kBAAmB,sBAAuB,uBAE5CC,gBAAiB,CACf,iCAAkC,eAAgB,UAEpDiH,QAAS,CAAC,uBAgBJ90B,GAAIC,EAAAA,EAAAA,GAAA,GAAQkO,IACZ6nF,GAAI/1F,EAAAA,EAAAA,GAAA,GAAQD,GAGlBoD,OAAOwb,QAAQq3E,GAAUhgF,QAAQigF,IAA2B,IAAzB/9D,EAAYg+D,GAAOD,GAEZ,YAAf/9D,EAA2Bq9D,EAAW5nE,QAAU4nE,EAAWr9D,KAGlFg+D,EAAOlgF,QAAQnW,SACoB+a,IAA7BzR,EAAK2B,aAAajL,KACpBk2F,EAAKl2F,GAASsJ,EAAK2B,aAAajL,QAOpC01F,EAAW5nE,SAAWluB,MAAMC,QAAQyJ,EAAK0rB,UAAY1rB,EAAK0rB,QAAQnzB,OAAS,IAC7Eq0F,EAAKpsE,mBAAqBxgB,EAAK0rB,SAIjCkhE,EAAKlsF,QAAU9J,EAAK8J,QACpBksF,EAAKxsE,YAAcxpB,EAAKwpB,YACxBwsE,EAAK1/E,eAAiBtW,EAAKsW,eAC3B0/E,EAAKvyE,cAAgBzjB,EAAKyjB,cAC1BuyE,EAAKzsE,mBAAqBvpB,EAAKupB,mBAC/BysE,EAAKhsF,GAAKhK,EAAKgK,GACfgsF,EAAKljE,SAAW9yB,EAAK8yB,SAGrBkjE,EAAKj8E,mBAAqB/Z,EAAK+Z,mBAC/Bi8E,EAAK97E,OAASla,EAAKka,OACnB87E,EAAK77E,cAAgBna,EAAKma,cAC1B67E,EAAK57E,iBAAmBpa,EAAKoa,iBAC7B47E,EAAK37E,uBAAyBra,EAAKqa,uBACnC27E,EAAK17E,sBAAwBta,EAAKsa,sBAClC07E,EAAKz7E,uBAAyBva,EAAKua,uBACnCy7E,EAAKx7E,0BAA4Bxa,EAAKwa,0BAEtC2zC,GAAY6nC,GACZxI,GAAkB,gBAAiB,CACjC7jF,KAAMpB,EAAMoB,KACZ80D,OAAQ,QACR/zD,GAAInC,EAAMmC,GACV0iF,QAASJ,GAAuB5jF,GAChCgtF,gBAAiBhzF,OAAOC,KAAK4yF,GAAU31F,OAAO6wF,GAAW,YAANA,EAAkBqE,EAAW5nE,QAAU4nE,EAAWrE,MAIvG5pC,GAAAA,QAAa2a,oBAAmB,GAGhCF,IAAU,GAAM,EAAOg0B,GAAMrqB,MAAM/rE,QA0uB/B+G,iBAAkBgjE,GAClBt6D,qBA33CuBpQ,UAC3B,GAAKrC,IAAU4L,IAAY6tF,EAI3B,IAAK,IAADC,EACF,MAAMC,EAAeF,EAAgBjtF,MAAQ,CAAC,EACxCixD,EAAeg8B,EAAgB1sF,MAAQ0sF,EAAgBzsF,QAAU,qBACjE4sF,EAAQ,GAAAzsF,OAAMswD,EAAY,YAG1Bm5B,EAAc+C,EAAa1sF,WAAcrK,KAAKuR,UAAUwlF,EAAa1sF,YAAc,GACnF6pF,EAAkB6C,EAAaxrF,aAAgBvL,KAAKuR,UAAUwlF,EAAaxrF,cAAgB,GAG3F1B,GAA0B,QAApBitF,EAAAD,EAAgBv9F,YAAI,IAAAw9F,OAAA,EAApBA,EAAsBhtF,WAAWC,gBAAiB,QAExDktF,QAAatC,EAAAA,GAAAA,IAAe,CAChCt3F,UAAc,OAAJwiB,SAAI,IAAJA,QAAI,EAAJA,GAAMxiB,WAAYA,GAC5BD,SACA4L,QAASA,IAAW,EACpBiqF,cAAe+D,EACfhD,aACAE,iBACArqF,MACA63D,UAAW,iBAGb,GAAIu1B,IAASA,EAAK13E,SAA2B,OAAhB03E,EAAKz0E,QAAkB,CAClD,MAAM00E,EAAUD,EAAKrtF,MAAQqtF,GAAQ,CAAC,EAChCluF,EAAQ,CACZoB,KAAM6sF,EACNptF,KAAMmtF,EACN7rF,GAAI0S,KAAKC,MACTvkB,KAAc,OAARuQ,EAAe,KAAgB,WAARA,EAAmB,UAAY,QAC5DW,GAAI0sF,EAAQ1sF,IAAM0sF,EAAQnC,SAC1B/rF,QAASA,GACTsqF,cAAc,GAyBhB,OArBA/4B,GAAkB/5D,IAChB,MACMkqF,GADWxqF,MAAMC,QAAQK,GAAQA,EAAO,IACpBM,OAAOV,IAAMA,EAAE+J,MAAQ,IAAIzG,OAAO+nB,gBAAkBurE,EAAStzF,OAAO+nB,eACxFupE,EAAmB,CAACjsF,KAAU2hF,GAAUwD,MAAM,EAAG,KAGvD,IACE,MAAM/2F,EAAM6R,GAAO,mBAAAuB,OAAsBvB,IAAY,kBACrDqI,aAAaC,QAAQna,EAAK6I,KAAKuR,UAAUyjF,GAC3C,CAAE,MAAOp1F,GACT,CAEA,OAAOo1F,IAGThH,GAAkB,OAAQ,CAAEvK,aAAc5oB,EAAcm8B,WAAU19F,KAAMuQ,EAAI4hB,cAAewpE,KAAM,WAE7FzuC,IACFA,GAAU,iBAADj8C,OAAaswD,EAAY,mCAAAtwD,OAA4BysF,EAAQ,KAAK,CAAE19F,KAAM,YAG9EyP,CACT,CACF,CAAE,MAAO0c,GACH+gC,IACFA,GAAU,oDAADj8C,QAAqC,OAAHkb,QAAG,IAAHA,OAAG,EAAHA,EAAKzhB,UAAW,uBAAmB,CAAE1K,KAAM,SAE1F,GAwzCIwW,uBApzC2BrQ,UAC/B,GAAK03F,GAAc/5F,IAAU4L,GAI7B,IACE,MAAM6xD,EAAes8B,EAAUhtF,MAAQgtF,EAAU/sF,QAAU,yCACrDgtF,EAAU,GAAA7sF,OAAMswD,EAAY,UAG5BjxD,EAAOutF,EAAUvtF,MAAQ,CAAC,EAC1ByB,EAAQzB,EAAKS,YAAczG,OAAOC,KAAK+F,EAAKS,YAAYlI,OAAS,EACjEmJ,EAAS1B,EAAK2B,cAAgB3H,OAAOC,KAAK+F,EAAK2B,cAAcpJ,OAAS,EAC5E,IAAI0H,EAAM,KACNwB,GAASC,EAAQzB,EAAM,YAClByB,IAAQzB,EAAM,UAEvB,MAAMnK,QAAei1F,EAAAA,GAAAA,IAAe,CAClCt3F,UAAc,OAAJwiB,SAAI,IAAJA,QAAI,EAAJA,GAAMxiB,WAAYA,GAC5BD,SACA4L,QAAS,EACTiqF,cAAemE,EACfpD,WAAY3oF,EAAQrL,KAAKuR,UAAU3H,EAAKS,YAAc,GACtD6pF,eAAgB5oF,EAAStL,KAAKuR,UAAU3H,EAAK2B,cAAgB,GAC7D1B,IAAKA,EAAI4hB,cACTi2C,UAAW,iBAGb,GAAuB,QAAb,OAANhiE,QAAM,IAANA,OAAM,EAANA,EAAQ8iB,QAUL,CAAC,IAAD60E,EACL,MAAMxvE,GAAiB,OAANnoB,QAAM,IAANA,OAAM,EAANA,EAAQsE,WAAiB,OAANtE,QAAM,IAANA,GAAY,QAAN23F,EAAN33F,EAAQkK,YAAI,IAAAytF,OAAN,EAANA,EAAcrzF,UAAW,oEAC7D,MAAM,IAAI+f,MAAM8D,EAClB,OAVQo6D,KAEN+L,GAAkB,eAAgB,CAAEvK,aAAc5oB,EAAcu8B,aAAY99F,KAAMuQ,EAAI4hB,cAAewpE,KAAM,WAEvGzuC,IACFA,GAAU,iBAADj8C,OAAaswD,EAAY,uDAAAtwD,OAA0C6sF,EAAU,KAAK,CAAE99F,KAAM,WAMzG,CAAE,MAAOmsB,GACH+gC,IACFA,GAAU,uEAADj8C,QAAkD,OAAHkb,QAAG,IAAHA,OAAG,EAAHA,EAAKzhB,UAAW,uBAAmB,CAAE1K,KAAM,SAEvG,GAuwCIyW,sBAxlGsBunF,CAAC3D,EAAU/pF,KACrC,MAAM2tF,EAlE8BC,EAAC7D,EAAU/pF,KAC/C,IACE,MAAMgkF,EAAU,CACd6J,aAAc,CACZttF,KAAMwpF,EAASxpF,MAAQ,eACvB7Q,KAAMq6F,EAASr6F,MAAQ,QACvB49F,QAASvD,EAASzoF,IAAKwsF,EAAAA,GAAAA,IAAe,IAAI95E,KAAK+1E,EAASzoF,KAAO,aAC/DysF,SAA+B,IAArBhE,EAAS3qF,SAErBqB,WAAY,KACZkB,aAAc,KACdsnF,MAAO,IAIT,GAAQ,OAAJjpF,QAAI,IAAJA,GAAAA,EAAMS,WAAY,CACpB,MAAMutF,EAAKhuF,EAAKS,WAChBujF,EAAQvjF,WAAa,CACnBC,QAASstF,EAAGttF,SAAW,GACvBsM,QAASghF,EAAG9gF,gBAAkB,GAC9B+gF,eAAgBD,EAAG5pC,iBAAmB,GACtC9xC,UAAWhc,MAAMC,QAAQy3F,EAAG3zE,eAAiB2zE,EAAG3zE,cAAgB,GAChE+J,WAAY4pE,EAAG5lE,eAAiB,GAChCg3B,OAAQ4uC,EAAG7tE,oBAAsB,GACjCk/B,SAAU2uC,EAAG5tE,aAAe,GAEhC,CAGA,GAAQ,OAAJpgB,QAAI,IAAJA,GAAAA,EAAM2B,aAAc,CACtB,MAAMusF,EAAKluF,EAAK2B,aAChBqiF,EAAQriF,aAAe,CACrBwsF,eAAgBD,EAAGp5F,iBAAmB,GACtCs5F,gBAAiBF,EAAGl5F,kBAAoB,GACxCq5F,aAAcH,EAAGh5F,eAAiB,GAClCo5F,aAAcJ,EAAG94F,eAAiB,GAClC0zB,kBAAmBolE,EAAGv9E,oBAAsB,GAC5C2nD,MAAO41B,EAAGp9E,QAAU,GACpBqY,eAAgB+kE,EAAG3tE,qBAAuB,GAC1C2a,SAAUgzD,EAAGhzD,UAAY,GACzBqzD,YAAaL,EAAGM,cAAgB,GAChCC,aAAcP,EAAGQ,eAAiB,GAClCC,aAAcT,EAAGU,eAAiB,GAEtC,CAcA,OAXIt4F,MAAMC,QAAY,OAAJyJ,QAAI,IAAJA,OAAI,EAAJA,EAAM0rB,WACtBs4D,EAAQiF,MAAQjpF,EAAK0rB,QAAQ9yB,IAAI,CAACqX,EAAMkT,KAAK,CAC3CA,MAAOA,EAAQ,EACfE,MAAOpT,EAAKoT,OAAS,GACrBw+D,MAAO5xE,EAAK4xE,OAAS,EACrB1gB,SAAUlxD,EAAKkxD,UAAY,GAC3B0tB,aAAc5+E,EAAK6+E,eAAiB,EACpCC,WAAY9+E,EAAK4xE,OAAS,IAAM5xE,EAAK6+E,eAAiB,OAInD9K,CACT,CAAE,MAAOhuF,GACP,OAAO,IACT,GAKoB43F,CAA8B7D,EAAU/pF,GACxD2tF,GACFx6B,GAAoB,CAAE42B,WAAU/pF,OAAMgkF,QAAS2J,KAslG7CvnF,iBAAmB2jF,IAAep4B,GAAyBo4B,GAAWt4B,IAA6B,IACnGprD,mBA/pC4B0jF,IAChC32B,GAAqB22B,EAASnpF,IAAMmpF,EAASzoF,IAC7C+xD,GAAuB02B,EAASxpF,MAAQ,KA8pCpC1C,kBAAmBA,GACnBC,oBAAqBA,GACrBwI,qBAvrGuBA,CAACnH,EAAO6vF,KAAW,IAADztF,EAAA0tF,EAAAztF,EAAA0tF,EAAAC,EAC7C,IAAKH,IAAUA,EAAMl1F,OAAQ,OAAO,EACpC,MAAMs1F,EAAkBluD,GAAc8tD,GAChCK,EAAYnuD,GAAc/hC,EAAMoB,MAAQpB,EAAMqB,QAAU,IACxD8uF,EAAepuD,IAAwB,QAAV3/B,EAAApC,EAAMa,YAAI,IAAAuB,GAAY,QAAZ0tF,EAAV1tF,EAAYd,kBAAU,IAAAwuF,OAAZ,EAAVA,EAAwBvuF,UAAW,IAChE6uF,EAAiBruD,IAAwB,QAAV1/B,EAAArC,EAAMa,YAAI,IAAAwB,GAAS,QAAT0tF,EAAV1tF,EAAYkqB,eAAO,IAAAwjE,GAAK,QAALC,EAAnBD,EAAsB,UAAE,IAAAC,OAAd,EAAVA,EAA0B9rE,QAAS,IACxE,OAAOgsE,EAAUp4F,SAASm4F,IAAoBE,EAAar4F,SAASm4F,IAAoBG,EAAet4F,SAASm4F,IAkrG5GpyF,WAAYA,KAMbmyD,KACC33D,EAAAA,GAAAA,MAACy0C,GAAY,CAAC9zC,MAAO,CAAEiX,OAAQ,QAAS7X,SAAA,CAAC,uEACL43D,OAItC33D,EAAAA,GAAAA,MAAC8pC,GAAW,CAAA/pC,SAAA,EAEVD,EAAAA,GAAAA,KAACkqC,GAAW,CAACjiC,IAAK+1E,GAAe/9E,UAC/BC,EAAAA,GAAAA,MAACoqC,GAAkB,CAAArqC,SAAA,EAEjBC,EAAAA,GAAAA,MAACuqC,GAAU,CAAAxqC,SAAA,EACTC,EAAAA,GAAAA,MAACwqC,GAAU,CAAAzqC,SAAA,EACTD,EAAAA,GAAAA,KAAC2qC,GAAgB,CAAA1qC,UACfC,EAAAA,GAAAA,MAAC2D,GAAW,CACVnD,MAAO6mD,IAAc95C,GAAS2kB,SAAQ,oCAAA/oB,OAA+BoE,GAAS2kB,UAAa,GAAGnyB,SAAA,CAC/F,gBAEEwN,GAASnE,KACRpJ,EAAAA,GAAAA,MAAA,QAAMuoC,UAAU,iBAAgBxoC,SAAA,CAAC,KAAGwN,GAASnE,WAOlDmhE,GAAW,IACVvqE,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,MACLjJ,QAAS,WACT0iE,WAAY,SACZtiE,WAAYypE,GACR,oDACA,oDACJxpE,OAAO,aAADkI,OAAeshE,GAAkB,UAAY,WACnDvpE,aAAc,MACdO,SAAU,UACVoW,WAAY,IACZ/W,MAAO2pE,GAAkB,UAAY,UACrCutB,UAAW,gCACXC,WAAY,UACZl4F,SAAA,EACAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQg2F,cAAe,SAAUruF,IAAK,MAAOi4D,WAAY,cAAe/hE,SAAA,EAC7FD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,SAAUkrC,QAAS,GAAK90B,WAAY,KAAM9X,SAAC,cACnEC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,UAAWoW,WAAY,KAAM9X,SAAA,CAClDwqE,GAAS0I,eAAe,QAAS,CAAEklB,sBAAuB,EAAGC,sBAAuB,IAAK,kBAG9Ft4F,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,OAAQoW,WAAY,OAAQ80B,QAAS,IAAM5sC,SAAC,YACpEC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQg2F,cAAe,SAAUruF,IAAK,MAAOi4D,WAAY,YAAa/hE,SAAA,EAC3FD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,SAAUkrC,QAAS,GAAK90B,WAAY,KAAM9X,SAAC,8BACnEC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,UAAWoW,WAAY,KAAM9X,SAAA,CAClDsqE,GAAW4I,eAAe,QAAS,CAAEklB,sBAAuB,EAAGC,sBAAuB,IAAK,wBAQtGp4F,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,UAAW9J,SAAA,EACnEC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQg2F,cAAe,SAAUp2B,WAAY,YAAa/hE,SAAA,EAC/ED,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,OAAQX,MAAO,OAAQiX,aAAc,OAAQhY,SAClE2lE,GAAmB,oBAAc,gDAGlC7U,IAAgBkH,IAAgBhH,MAChCjxD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVc,SAAU,OACVX,MAAO,OACPF,QAAS,UACTM,aAAc,MACdL,UAAW,QACXuiE,gBAAiBrL,GACb,UACe,aAAfhH,GACE,UACe,YAAfA,GACE,UACA,UACR9vD,OAAO,aAADkI,OACJ4uD,GACI,UACe,aAAfhH,GACE,UACe,YAAfA,GACE,UACA,WAEVsnC,WAAY,iBACZt4F,SACCg4D,IACCj4D,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEG,MAAO,WAAYf,SAAC,yCAClB,aAAfgxD,IACFjxD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEG,MAAO,WAAYf,SAAC,mCAClB,YAAfgxD,IACFjxD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEG,MAAO,WAAYf,SAAC,yDACjC8wD,IACF7wD,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACEC,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CAAEG,MAAO,WAAYf,SAAA,CAAC,UAAG2lE,GAAmB,eAAY,aAAiB,IAAE,IAAIlpD,KAAKq0C,IAAcynC,mBAAmB,QAAS,CACzIC,KAAM,UACNC,OAAQ,UACRC,OAAQ,eAGV,WAIV34F,EAAAA,GAAAA,KAACisC,GAAc,CAAAhsC,UACbD,EAAAA,GAAAA,KAACmsC,GAAa,CAACG,aAAc7+B,GAAS8kB,oBAAqB,EAAMtyB,SAI9DkoD,IACCjoD,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CACXG,MAAO,OACP43F,UAAW,SACXx2F,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACL9J,SAAA,EACAD,EAAAA,GAAAA,KAAC6rC,GAAO,IAAG,2BAGVq/B,GAAez9D,GAAS2kB,UAoBI,kBAAtB3kB,GAAS2kB,UACD,QAAjB2xB,EAAAt2C,GAAS2kB,gBAAQ,IAAA2xB,OAAA,EAAjBA,EAAmBjuB,qBACF,QADmBkuB,EACpCv2C,GAAS2kB,gBAAQ,IAAA4xB,OAAA,EAAjBA,EAAmBnuB,uBACF,QADqBouB,EACtCx2C,GAAS2kB,gBAAQ,IAAA6xB,OAAA,EAAjBA,EAAmBluB,cACnB,wBAEAtoB,GAAS2kB,UAAY,yBAzBrBlyB,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CACXuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACL/I,MAAO,WACPf,SAAA,EACAD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMu4F,EAAAA,IAAuBh4F,MAAO,CAAEG,MAAO,cAC9DhB,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEc,SAAU,QAAS1B,SAAC,oCACnCD,EAAAA,GAAAA,KAAC+rC,GAAW,CACV5rC,QAAUjB,IACRA,EAAEuU,iBACFvU,EAAEkB,kBACF+uE,MAEFzuE,MAAM,gDAA+BT,SACtC,qCAkBZ,MAEC,MAAMg/E,EAAiBhlE,GAAmBI,KAAKC,GAAOA,EAAIvB,YAActL,GAAS4L,oBAAsBiB,EAAI1B,MAAQnL,GAAS4L,oBACtH9b,GAAsB,OAAd0hF,QAAc,IAAdA,OAAc,EAAdA,EAAgB1kE,eAA6B,OAAd0kE,QAAc,IAAdA,OAAc,EAAdA,EAAgB1hF,QAAS,GAGtE,OAFwBA,EAAMoC,SAAS,cAAgBpC,EAAMoC,SAAS,qBAAeX,MAAMC,QAAQwO,GAAS+L,SAAW/L,GAAS+L,OAAOvY,OAAS,GAK9IjB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVa,UAAW,UACXuW,aAAc,MACdnX,QAAS,iBACTI,WAAY,oDACZC,OAAQ,oBACRC,aAAc,MACdO,SAAU,SACVS,QAAS,OACT02F,SAAU,OACV/uF,IAAK,SACLi4D,WAAY,UACZ/hE,SACCwN,GAAS+L,OAAOlY,IAAI+wE,IACnB,MAAM5qD,EAAS2wC,GAAUia,GACzB,IAAK5qD,EAAQ,OAAO,KAGpB,IAAIk1C,EAAOo8B,EAAYC,EAEvB,GAAIvzF,IAAgB,EAAG,CAErB,MAAMiQ,EAAUC,WAAWlI,GAASmI,iBAAmB,EACjDqjF,EAAUxrF,GAAS+L,OAAOvY,OAC1Bi4F,EAAcD,EAAU,EAAIvjF,EAAUujF,EAAU,EAGtDt8B,EADkBhnD,WAAW8R,EAAO0xE,iBAAmB,GACnCD,EACpBF,EAAkBE,EAClBH,EAAa,WACf,MAAWtzF,IAAgB,GAAKA,IAAgB,GAE9Ck3D,EAAQhnD,WAAW8R,EAAO2xE,kBAAoB,GAC9CL,EAAa,oBAGbp8B,EAAQhnD,WAAW8R,EAAOm1C,gBAAkB,GAC5Cm8B,EAAa,oBAGf,MAAMM,EAAa18B,EAAQ,EACrBwE,EAAWL,GAAczmD,KAAKC,IAAQA,EAAIhR,IAAMgR,EAAI1B,OAASy5D,GAC7DinB,GAAkB,OAARn4B,QAAQ,IAARA,OAAQ,EAARA,EAAU7E,WAAY+V,EAChCknB,GAAkB,OAARp4B,QAAQ,IAARA,OAAQ,EAARA,EAAUE,cAAsB,OAARF,QAAQ,IAARA,OAAQ,EAARA,EAAU5jE,QAAS,GAGrDi8F,EAAgB,OAAN/xE,QAAM,IAANA,OAAM,EAANA,EAAQ+xE,QAClBC,EAAcD,EAAU,GAAAnwF,OAAGmwF,EAAQh6E,OAAS,GAAE,KAAAnW,OAAImwF,EAAQ95E,UAAY,IAAKld,OAAS,GACpFk3F,EAAc,CAClBH,EAAO,GAAAlwF,OAAMiwF,EAAO,OAAAjwF,OAAMkwF,GAAYD,EACtCG,EAAW,OAAApwF,OAAUowF,GAAgB,IACrC75F,OAAOiZ,SAASm1D,KAAK,MAEvB,OACE9tE,EAAAA,GAAAA,MAAA,OAAiBW,MAAO,CACtBC,QAAS,gBACTI,WAAYm4F,EAAa,UAAY,QACrCl4F,OAAO,aAADkI,OAAegwF,EAAa,UAAY,WAC9Cj4F,aAAc,MACdgB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLpI,SAAU,UACV1B,SAAA,EACAD,EAAAA,GAAAA,KAAA,OACEa,MAAO,CAAEkX,WAAY,IAAK/W,MAAO,UAAWW,SAAU,SAAUg4F,OAAQ,QACxEj5F,MAAOg5F,EAAYz5F,SAElBq5F,KAEHp5F,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEkX,WAAY,IAAK/W,MAAOq4F,EAAa,UAAY,UAAW13F,SAAU,UAAW1B,SAAA,CAC5F08D,EAAQ,GAAK,SACb9rD,KAAK+oF,IAAIj9B,GAAOwW,eAAe,QAAS,CAAEklB,sBAAuB,EAAGC,sBAAuB,IAAK,cAElG7yF,IAAgB,GAAKuzF,EAAkB,IACtC94F,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACEC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,UAAWkrC,QAAS,GAAK7rC,MAAO,WAAYf,SAAA,CAAC,SACjE+4F,EAAgB7lB,eAAe,QAAS,CAAEklB,sBAAuB,EAAGC,sBAAuB,IAAK,eAEpGt4F,EAAAA,GAAAA,KAAA,OACEa,MAAO,CAAEc,SAAU,UAAWkrC,QAAS,GAAK7rC,MAAO,UAAW24F,OAAQ,QACtEj5F,MAAM,8EAAwDT,SAC/D,WAKJwF,IAAgB,IACfvF,EAAAA,GAAAA,MAAA,OACEW,MAAO,CAAEc,SAAU,UAAWkrC,QAAS,GAAK7rC,MAAO,UAAW24F,OAAQ,QACtEj5F,MAAO+E,IAAgB,GAAKA,IAAgB,EAAI,0FAAoD,mDAAgCxF,SAAA,CACrI,IACGwF,IAAgB,GAAKA,IAAgB,EAAI,IAAM,IAAI,SAtCjD4sE,OAzDU,IAuG7B,EA7GA,GAgHAlvC,IAECjjC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVC,QAAS,cACTY,UAAW,OACX4hE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdgB,QAAS,OACT4/D,WAAY,aACZj4D,IAAK,OACLgO,WAAY,MACZ/W,MAAO,WACPf,SAAA,EACAD,EAAAA,GAAAA,KAAC65F,EAAAA,EAAI,CAACzxF,KAAM,GAAIvH,MAAO,CAAEa,UAAW,UAAWwgE,WAAY,MAC3DhiE,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEshE,KAAM,GAAIliE,SAAA,EACtBD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEoX,aAAc,SAAUtW,SAAU,UAAW1B,SAAC,sCAG3DwN,GAAS2b,qBACRlpB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEkX,WAAY,SAAUpW,SAAU,WAAYsW,aAAc,UAAWhY,SAAA,EACjFD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,gCAAyB,IAAEwN,GAAS2b,sBAG/C3b,GAASwnB,kBACR/0B,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEkX,WAAY,SAAUpW,SAAU,YAAa1B,SAAA,EACzDD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,eAAgB,IAAE4qE,GAAgBp9D,GAASwnB,iBAClDxnB,GAASuoB,cAAY,WAAA3sB,OAAU,IAAIqT,KAAKjP,GAASuoB,cAAcqpB,mBAAmB,SAAQ,KAAAh2C,OAAI,IAAIqT,KAAKjP,GAASuoB,cAAcwiE,mBAAmB,QAAS,CAAEC,KAAM,UAAWC,OAAQ,oBAK5Lx4F,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQg2F,cAAe,SAAUruF,IAAK,SAAUm4D,WAAY,GAAIjiE,SAAA,EACrFC,EAAAA,GAAAA,MAAC0E,GAAY,CACX6jC,UAAU,aACVtoC,QAAS0uF,GACTnuF,MAAM,yEACNG,MAAO,CACLC,QAAS,cACTa,SAAU,WACV2hE,gBAAiB,UACjBtiE,MAAO,QACPG,OAAQ,OACRC,aAAc,MACdu4F,OAAQ,UACR5hF,WAAY,MACZ3V,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLouF,WAAY,SACZI,WAAY,yBAEduB,aAAe56F,GAAMA,EAAEyU,cAAc9S,MAAMyiE,gBAAkB,UAC7Dy2B,aAAe76F,GAAMA,EAAEyU,cAAc9S,MAAMyiE,gBAAkB,UAAUrjE,SAAA,EAEvED,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAME,EAAAA,MAAW,oBAInCuN,KACC7N,EAAAA,GAAAA,MAAC0E,GAAY,CACXzE,QAAUjB,IACRA,EAAEkB,kBACFq6D,IAA2B,IAE7B/5D,MAAM,yFACNG,MAAO,CACLC,QAAS,cACTa,SAAU,WACV2hE,gBAAiB,UACjBtiE,MAAO,QACPG,OAAQ,OACRC,aAAc,MACdu4F,OAAQ,UACR5hF,WAAY,MACZ3V,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLouF,WAAY,SACZI,WAAY,yBAEduB,aAAe56F,GAAMA,EAAEyU,cAAc9S,MAAMyiE,gBAAkB,UAC7Dy2B,aAAe76F,GAAMA,EAAEyU,cAAc9S,MAAMyiE,gBAAkB,UAAUrjE,SAAA,EAEvED,EAAAA,GAAAA,KAACg6F,EAAM,CAAC5xF,KAAM,KAAM,qBAM1Bg7B,IAEFljC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVC,QAAS,cACTY,UAAW,OACX4hE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdgB,QAAS,OACT4/D,WAAY,aACZj4D,IAAK,OACLgO,WAAY,MACZ/W,MAAO,WACPf,SAAA,EACAD,EAAAA,GAAAA,KAAC65F,EAAAA,EAAI,CAACzxF,KAAM,GAAIvH,MAAO,CAAEa,UAAW,UAAWwgE,WAAY,MAC3DhiE,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEshE,KAAM,GAAIliE,SAAA,EACtBD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEoX,aAAc,SAAUtW,SAAU,UAAW1B,SAAC,6CAG3DwN,GAAS4b,wBACRnpB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEkX,WAAY,SAAUpW,SAAU,WAAYsW,aAAc,UAAWhY,SAAA,EACjFD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,iCAA0B,IAAEwN,GAAS4b,yBAGhD5b,GAASolB,gBACR3yB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEkX,WAAY,SAAUpW,SAAU,YAAa1B,SAAA,EACzDD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,eAAmB,IAAE4qE,GAAgBp9D,GAASolB,eACrDplB,GAASklB,aAAW,WAAAtpB,OAAU,IAAIqT,KAAKjP,GAASklB,aAAa0sB,mBAAmB,SAAQ,KAAAh2C,OAAI,IAAIqT,KAAKjP,GAASklB,aAAa6lE,mBAAmB,QAAS,CAAEC,KAAM,UAAWC,OAAQ,oBAKzLx4F,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQg2F,cAAe,SAAUruF,IAAK,SAAUm4D,WAAY,GAAIjiE,SAAA,EACrFC,EAAAA,GAAAA,MAAC0E,GAAY,CACX6jC,UAAU,aACVtoC,QAAS0uF,GACTnuF,MAAM,yEACNG,MAAO,CACLC,QAAS,cACTa,SAAU,WACV2hE,gBAAiB,UACjBtiE,MAAO,QACPG,OAAQ,OACRC,aAAc,MACdu4F,OAAQ,UACR5hF,WAAY,MACZ3V,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLouF,WAAY,SACZI,WAAY,yBAEduB,aAAe56F,GAAMA,EAAEyU,cAAc9S,MAAMyiE,gBAAkB,UAC7Dy2B,aAAe76F,GAAMA,EAAEyU,cAAc9S,MAAMyiE,gBAAkB,UAAUrjE,SAAA,EAEvED,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAME,EAAAA,MAAW,oBAGnCuN,KACC7N,EAAAA,GAAAA,MAAC0E,GAAY,CACX6jC,UAAU,aACVtoC,QAASA,IAAMo7D,IAA2B,GAC1C76D,MAAM,sCACNG,MAAO,CACLC,QAAS,cACTa,SAAU,WACV2hE,gBAAiB,UACjBtiE,MAAO,QACPG,OAAQ,OACRC,aAAc,MACdu4F,OAAQ,UACR5hF,WAAY,MACZ3V,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLouF,WAAY,SACZI,WAAY,yBAEduB,aAAe56F,GAAMA,EAAEyU,cAAc9S,MAAMyiE,gBAAkB,UAC7Dy2B,aAAe76F,GAAMA,EAAEyU,cAAc9S,MAAMyiE,gBAAkB,UAAUrjE,SAAA,EAEvED,EAAAA,GAAAA,KAACg6F,EAAM,CAAC5xF,KAAM,KAAM,qBAM1ByF,IAEF3N,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVC,QAAS,cACTY,UAAW,OACX4hE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdgB,QAAS,OACT4/D,WAAY,aACZj4D,IAAK,OACLgO,WAAY,MACZ/W,MAAO,WACPf,SAAA,EACAD,EAAAA,GAAAA,KAAC65F,EAAAA,EAAI,CAACzxF,KAAM,GAAIvH,MAAO,CAAEa,UAAW,UAAWwgE,WAAY,MAC3DhiE,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEshE,KAAM,GAAIliE,SAAA,EACtBD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEoX,aAAc,UAAWhY,SAAC,8GAGvCwN,GAASumB,cACR9zB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEkX,WAAY,SAAUpW,SAAU,YAAa1B,SAAA,EACzDD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,mBAAkB,IAAE4qE,GAAgBp9D,GAASumB,aACpDvmB,GAASwmB,cAAY,WAAA5qB,OAAU,IAAIqT,KAAKjP,GAASwmB,cAAcorB,mBAAmB,SAAQ,KAAAh2C,OAAI,IAAIqT,KAAKjP,GAASwmB,cAAcukE,mBAAmB,QAAS,CAAEC,KAAM,UAAWC,OAAQ,oBAM5Lx4F,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQg2F,cAAe,SAAUruF,IAAK,SAAUm4D,WAAY,GAAIjiE,SAAA,EACrFC,EAAAA,GAAAA,MAAC0E,GAAY,CACX6jC,UAAU,aACVtoC,QAAS0uF,GACTnuF,MAAM,yEACNG,MAAO,CACLC,QAAS,cACTa,SAAU,WACV2hE,gBAAiB,UACjBtiE,MAAO,QACPG,OAAQ,OACRC,aAAc,MACdu4F,OAAQ,UACR5hF,WAAY,MACZ3V,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLouF,WAAY,SACZI,WAAY,yBAEduB,aAAe56F,GAAMA,EAAEyU,cAAc9S,MAAMyiE,gBAAkB,UAC7Dy2B,aAAe76F,GAAMA,EAAEyU,cAAc9S,MAAMyiE,gBAAkB,UAAUrjE,SAAA,EAEvED,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAME,EAAAA,MAAW,oBAKnCuN,KACC7N,EAAAA,GAAAA,MAAC0E,GAAY,CACXzE,QAAUjB,IACRA,EAAEkB,kBACFi7D,IAA8B,IAEhC36D,MAAM,mFACNG,MAAO,CACLC,QAAS,cACTa,SAAU,WACV2hE,gBAAiB,UACjBtiE,MAAO,QACPG,OAAQ,OACRC,aAAc,MACdu4F,OAAQ,UACR5hF,WAAY,MACZ3V,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLouF,WAAY,SACZI,WAAY,yBAEduB,aAAe56F,GAAMA,EAAEyU,cAAc9S,MAAMyiE,gBAAkB,UAC7Dy2B,aAAe76F,GAAMA,EAAEyU,cAAc9S,MAAMyiE,gBAAkB,UAAUrjE,SAAA,EAEvED,EAAAA,GAAAA,KAACg6F,EAAM,CAAC5xF,KAAM,KAAM,sBAQ9BlI,EAAAA,GAAAA,MAAC4qC,GAAQ,CAAA7qC,SAAA,EACPC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,OAAQo4D,KAAM,GAAIliE,SAAA,EAC1EC,EAAAA,GAAAA,MAAC6qC,GAAsB,CAAA9qC,SAAA,EACrBD,EAAAA,GAAAA,KAACgrC,GAAS,CAAA/qC,SACP,MAEC,GAAIwN,GAAS2e,iBAAmBwQ,GAAiBnvB,GAASukB,kBAAmB,WAC3E,MAAO,8BAeT,MAXoB,CAClB,EAAGy9B,GAAY,uBAAsB,qCACrC,EAAG,kCACH,EAAG,6CACH,EAAG,mCACH,EAAG,yCACH,EAAG,yBACH,EAAG,0CACH,EAAG,iCAGchqD,MAAkBgqD,GAAY,uBAAsB,qCACxE,EAnBA,MAuBHzvD,EAAAA,GAAAA,KAACkrC,GAAgB,CAAAjrC,SACduvD,GAAsB3tB,OAAOvgC,IAAI,CAACqL,EAAOkf,KACxC7rB,EAAAA,GAAAA,KAACmrC,GAAY,CAAAlrC,UACXD,EAAAA,GAAAA,KAACorC,GAAgB,CACf3C,UAAW97B,EAAMo1B,UACjBlhC,MAAO,CACLgsC,QAASlgC,EAAMq1B,UAAY,EAAI,IAC/Bi4D,UAAWttF,EAAMq1B,UAAY,YAAc,cAC3Ck4D,gBAAiB,WANJvtF,EAAMrD,UAe9B,MACC,MAAM21E,EAAiBhlE,GAAmBI,KAAKC,GAAOA,EAAI1B,MAAQnL,GAAS4L,oBAG3E,QAF4B,OAAd4lE,QAAc,IAAdA,OAAc,EAAdA,EAAgB1hF,QAAS,IACToC,SAAS,UAExC,EALA,IAKO8N,GAASgM,eAAiBk/C,KAAkBA,GAAcmmB,WAAajmB,IAC7E,MACE,MAAMshC,EAAgBxkF,WACpBgjD,GAAcyhC,eACdzhC,GAAc0hC,gBACd,GAEI59B,EAAU9mD,WACdgjD,GAAc2hC,gBACd3hC,GAAc8D,SACd,GAIF,IAAI89B,EAAoB,EAKxB,MAAMC,EAAsB/sF,GAASnE,IAAMmE,GAASnE,GAAK,EACnDmxF,EAAah1F,IAAgB,EAEnC,IAAK+0F,IAAwBC,EAAY,CAIvC,MACMC,EAAYj1F,IAAgB,GAAKA,IAAgB,EADrCA,IAAgB,EAKhC80F,EAAoB5kF,WAAWlI,GAASmI,gBAAkB,GACjD8kF,GAELjtF,GAASyb,oBAAsBlqB,MAAMC,QAAQwO,GAASyb,qBAAuBzb,GAASyb,mBAAmBjoB,OAAS,IACpHs5F,EAAoB9sF,GAASyb,mBAAmB2d,OAAO,CAACmjC,EAAKp+C,IAIpDo+C,GAFMr0D,YAAYiW,EAAQK,YAAcL,EAAQmyD,cAAgB,KAAKn1E,WAAWiX,QAAQ,YAAa,IAAIA,QAAQ,IAAK,OAAS,GACrHlK,WAAWiW,EAAQsjC,UAAY,GAE/C,IAGqB,IAAtBqrC,IACFA,EAAoB5kF,WAAWlI,GAASmI,gBAAkB,KAEnD6kF,GAELhtF,GAAS6H,SAAWtW,MAAMC,QAAQwO,GAAS6H,WAC7CilF,EAAoB9sF,GAAS6H,QAAQuxB,OAAO,CAACmjC,EAAKx0D,IACzCw0D,EAAMr0D,WAAWH,EAAQ6kF,gBAAkB7kF,EAAQmlF,QAAU,GACnE,GAGT,CAGA,MAAMh+B,EAAQw9B,EAAgB19B,EAAU89B,EAClClB,EAAa18B,EAAQ,EAE3B,OACE38D,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,MACLjJ,QAAS,WACTI,WAAYm4F,EACR,oDACA,oDACJl4F,OAAO,aAADkI,OAAegwF,EAAa,UAAY,WAC9Cj4F,aAAc,MACdO,SAAU,UACVoW,WAAY,IACZ/W,MAAOq4F,EAAa,UAAY,UAChCnB,UAAW,gCACXC,WAAY,UACZl4F,UACAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQg2F,cAAe,SAAUruF,IAAK,MAAOi4D,WAAY,YAAa/hE,SAAA,EAC3FC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,SAAUkrC,QAAS,GAAK90B,WAAY,KAAM9X,SAAA,CAAC,WACxDwN,GAASgM,kBAEpBvZ,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,UAAWoW,WAAY,KAAM9X,SAAA,CAClD4Q,KAAK+oF,IAAIj9B,GAAOwW,eAAe,QAAS,CAAEklB,sBAAuB,EAAGC,sBAAuB,IAAK,kBAK1G,EAtFD,OAyFJt4F,EAAAA,GAAAA,KAACsrC,GAAY,KAEbprC,EAAAA,GAAAA,MAACsrC,GAAW,CAAAvrC,SAAA,EACVC,EAAAA,GAAAA,MAAC0E,GAAY,CACX6jC,UAAU,WACVtoC,QAhkEQ5B,UAGtB2vD,GAAY,OAAQ,OAAQ,mBAAoB,+DAG1C0jB,MA2jEQh4E,SACEsD,IACAo8B,KACCitC,IACA14D,KAAwBE,IACzBo6C,KACC+iB,GAAez9D,GAAS2kB,UAE3B1xB,MACEynD,GACI,0DACC+iB,GAAez9D,GAAS2kB,UAEtBvkB,KAAwBE,GACvB,6EACCw4D,GAEC,4BADA,mEAJJ,oEAMPtmE,SAAA,EAEDD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMs6F,EAAAA,MACtBzyC,GAAmB,sCAAqBjrD,GAAW,mBAAe,kBAGrEgD,EAAAA,GAAAA,MAAC0E,GAAY,CACX6jC,UAAU,aACVtoC,QAAS0uF,GACTnuF,MAAM,kCACN9G,SAAU0/B,IAAoBp8B,GAAS+C,SAAA,EAEvCD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAME,EAAAA,MAAW,0BAQvC84B,KACCp5B,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVC,QAAS,OACTwiE,gBAAiB,UACjBu3B,UAAW,oBACXC,aAAc,qBACd76F,SAAA,EACAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,OACLkO,aAAc,WACdhY,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVc,SAAU,UACV1B,SAAC,YAGHC,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACED,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVkX,WAAY,MACZ/W,MAAO,UACPW,SAAU,OACVsW,aAAc,WACdhY,SAAC,gEAGHD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVG,MAAO,UACPW,SAAU,YACV1B,SACCm2D,YAMPp2D,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVrK,MAAO,OACPC,OAAQ,MACR6sE,gBAAiB,UACjBliE,aAAc,MACd25F,SAAU,UACV96F,UACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVrK,MAAM,GAAD6S,OAAKkxB,GAAY,KACtB9jC,OAAQ,OACR6sE,gBAAiB,UACjBi1B,WAAY,kBACZn3F,aAAc,YAIlBpB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVa,UAAW,SACXC,SAAU,UACVX,MAAO,UACPD,UAAW,UACXd,SAAC,sEASXD,EAAAA,GAAAA,KAACuqC,GAAiB,CAACtiC,IAAKykD,GAAsBsuC,UAAW5G,GAAkBn0F,UACzEC,EAAAA,GAAAA,MAACsqC,GAAe,CAAAvqC,SAAA,EAGhBC,EAAAA,GAAAA,MAAC3H,GAAW,CAAC,eAAa,aAAY0H,SAAA,EACxCC,EAAAA,GAAAA,MAAC0D,GAAa,CACZ6oC,aAAcq5B,GAAgB,cAC9B5uD,SAAUvJ,GAAgB,cAAc1N,SAAA,EAExCC,EAAAA,GAAAA,MAACzH,GAAY,CAACg0C,aAAcq5B,GAAgB,cAAc7lE,SAAA,EACxDD,EAAAA,GAAAA,KAAC4L,GAAW,CAAC6gC,aAAcq5B,GAAgB,cAAc7lE,UACvDD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMK,EAAAA,QACX,0BAGbq/B,KAA6BkpC,KAC5BlpE,EAAAA,GAAAA,KAACqtC,GAAW,CAAC3sC,MAAM,mLAAwIT,SAAC,wCAKhKC,EAAAA,GAAAA,MAACitC,GAAe,CAAAltC,SAAA,CAEb+/B,KAA6BkpC,IAAyBppC,KACrD9/B,EAAAA,GAAAA,KAAC0zC,GAAY,CACXvzC,QAAUjB,IACRA,EAAEkB,kBACFm6D,IAA2B,IAE7B75D,MAAM,iGAAoFT,UAE1FD,EAAAA,GAAAA,KAACg6F,EAAM,OAGXh6F,EAAAA,GAAAA,KAACgtC,GAAY,CACXE,UAAWljB,GAAc8C,WACzB2f,aAAcq5B,GAAgB,cAC9B3lE,QAASA,IAAM03B,GAAc,cAC7Bh3B,MAAO,CAAE84F,OAAQ,WAAY15F,UAE7BD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM26F,EAAAA,eAI7B/6F,EAAAA,GAAAA,MAACqtC,GAAc,CAACL,UAAWljB,GAAc8C,WAAW7sB,SAAA,EAClDC,EAAAA,GAAAA,MAACtH,GAAO,CAAAqH,SAAA,EACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,cAChBC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAAC3J,EAAAA,EAAI,KACL2J,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,QACLnH,YAAY,uBACZzC,MAAOoO,GAAS+R,OAAS,GACzB5lB,UAAQ,EACR8G,MAAO6mD,GAAa,oDAA+C95C,GAAS+R,MAAQ,qEAA6C,uDACjI7lB,WAAY6T,GAAiBgS,MAC7B9lB,SAAO,OAGV8T,GAAiBgS,QAChBxf,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiBgS,YAGjCtf,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,YAChBC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAACiC,EAAAA,EAAI,KACLjC,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,QACL6Q,KAAK,QACL5J,MAAOoO,GAASsb,OAAS,GACzBnvB,UAAQ,EACR8G,MAAO6mD,GAAa,oDAA+C95C,GAASsb,MAAQ,qEAA6C,uDACjIpvB,WAAY6T,GAAiBub,MAC7BrvB,SAAO,OAGV8T,GAAiBub,QAChB/oB,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiBub,YAGjC7oB,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,aACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAACkC,EAAAA,EAAK,KACNlC,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,MACLiH,MAAOoO,GAAS6iB,SAAW,GAC3B12B,UAAQ,EACRkI,YAAa2L,GAAS6iB,QAAU,GAAMi3B,GAAa,8BAA6B,uDAChF7mD,MAAO6mD,GAAa,oDAA+C95C,GAAS6iB,QAAU,qEAA6C,uDACnI52B,SAAO,cAKfsG,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC,wBAAkBkH,SAAA,EAC3BC,EAAAA,GAAAA,MAACiuC,GAAc,CAAAluC,SAAA,EACbD,EAAAA,GAAAA,KAACquC,GAAS,CAACj1C,UAAQ,EAAA6G,SAAC,YACpBD,EAAAA,GAAAA,KAACuuC,GAAiB,CAChBn2C,KAAK,SACLq2C,WAAYhhC,GAASob,mBACrB1oB,QAASA,IAAMhB,GAAkB,qBAAsB,IACvDuB,MAAM,wBAAeT,UAErBD,EAAAA,GAAAA,KAACsI,EAAAA,EAAC,CAACF,KAAM,WAGbpI,EAAAA,GAAAA,KAACk7F,GAAkB,CACjB77F,MAAOoO,GAASob,oBAAsB,GACtCpnB,SAAW05F,GAAkBh8F,GAAkB,qBAAsBg8F,GACrEh/C,OAAQA,CAAC/8C,EAAOC,IAAUuhF,GAAgB,qBAAsBvhF,GAChE+jB,QAAS2gD,GACTjiE,YAAY,kBACZlI,SAAUomC,GACVrmC,WAAY6T,GAAiBqb,mBAC7BzvB,UAAU,EACVgG,MAAM,SACN6wB,SAAS,EACTmrE,YAAY,GACZ96F,MAAMN,EAAAA,GAAAA,KAAC3J,EAAAA,EAAI,IACX29F,eAAgBA,GAChBqH,eAAgBA,CAACpH,EAAQ70F,IAAU60F,EAAO3qF,IAAM2qF,EAAOnsF,SAAWmsF,EAClE//B,iBAAkBA,MAElB1mD,GAAiBqb,oBAAuBqrC,KAAqBzmD,GAASob,sBACtE7oB,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SACPuN,GAAiBqb,oBAAsB,qCASpD3oB,EAAAA,GAAAA,MAAC3H,GAAW,CAAC,eAAa,YAAW0H,SAAA,EACnCC,EAAAA,GAAAA,MAAC0D,GAAa,CACZ6oC,aAAcq5B,GAAgB,aAC9B5uD,SAAUvJ,GAAgB,aAAa1N,SAAA,EAEvCC,EAAAA,GAAAA,MAACzH,GAAY,CAACg0C,aAAcq5B,GAAgB,aAAa7lE,SAAA,EACvDD,EAAAA,GAAAA,KAAC4L,GAAW,CAAC6gC,aAAcq5B,GAAgB,aAAa7lE,UACtDD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMsM,EAAAA,QACX,+BAGbozB,KAA6BkpC,KAC5BlpE,EAAAA,GAAAA,KAACqtC,GAAW,CAAC3sC,MAAM,sIAAiGT,SAAC,wCAKzHC,EAAAA,GAAAA,MAACitC,GAAe,CAAAltC,SAAA,CAEb+/B,KAA6BkpC,IAAyBppC,KACrD9/B,EAAAA,GAAAA,KAAC0zC,GAAY,CACXvzC,QAAUjB,IACRA,EAAEkB,kBACFq6D,IAA2B,IAE7B/5D,MAAM,uFAA0ET,UAEhFD,EAAAA,GAAAA,KAACg6F,EAAM,OAGXh6F,EAAAA,GAAAA,KAACgtC,GAAY,CACXE,UAAWljB,GAAc+C,UACzB0f,aAAcq5B,GAAgB,aAC9B3lE,QAASA,IAAM03B,GAAc,aAC7Bh3B,MAAO,CAAE84F,OAAQ,WAAY15F,UAE7BD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM26F,EAAAA,eAI7B/6F,EAAAA,GAAAA,MAACqtC,GAAc,CAACL,UAAWljB,GAAc+C,UAAU9sB,SAAA,EACjDD,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EACvCD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,uBAChBC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAACu7F,EAAAA,EAAQ,KACTv7F,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,UACLnH,YAAY,0CACZzC,MAAOoO,GAASrE,SAAW,GAC3B3H,SAAWvC,GAAMC,GAAkB,UAAWD,EAAE2C,OAAOxC,OACvD88C,OAAQA,IAAMykC,GAAgB,UAAWnzE,GAASrE,SAClDxP,SAAUomC,GACVrmC,WAAY6T,GAAiBpE,QAC7B1P,SAAO,OAGV8T,GAAiBpE,UAChBpJ,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiBpE,gBAInClJ,EAAAA,GAAAA,MAACtH,GAAO,CAAAqH,SAAA,EACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC,wBAAkBkH,SAAA,EAC3BC,EAAAA,GAAAA,MAACiuC,GAAc,CAAAluC,SAAA,EACbD,EAAAA,GAAAA,KAACquC,GAAS,CAACj1C,UAAQ,EAAA6G,SAAC,mCACpBD,EAAAA,GAAAA,KAACuuC,GAAiB,CAChBn2C,KAAK,SACLq2C,WAAYhhC,GAASqb,YACrB3oB,QAASA,IAAMhB,GAAkB,cAAe,IAChDuB,MAAM,wBAAeT,UAErBD,EAAAA,GAAAA,KAACsI,EAAAA,EAAC,CAACF,KAAM,WAGbpI,EAAAA,GAAAA,KAACk7F,GAAkB,CACjB77F,MAAOoO,GAASqb,aAAe,GAC/BrnB,SAAW05F,GAAkBh8F,GAAkB,cAAeg8F,GAC9Dh/C,OAAQA,CAAC/8C,EAAOC,IAAUuhF,GAAgB,cAAevhF,GACzD+jB,QAASrI,GACTjZ,YAAY,mCACZlI,SAAUomC,GACVrmC,WAAY6T,GAAiBsb,YAC7B1vB,UAAU,EACVgG,MAAM,WACN6wB,SAAS,EACTmrE,YAAY,GACZ96F,MAAMN,EAAAA,GAAAA,KAAClK,EAAAA,EAAK,IACZk+F,eAAgBA,GAChBqH,eAAgBA,CAACpH,EAAQ70F,IAAU60F,EAAO3qF,IAAM2qF,EAAOnsF,SAAWmsF,EAClE//B,iBAAkBA,MAElB1mD,GAAiBsb,aAAgBorC,KAAqBzmD,GAASqb,eAC/D9oB,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SACPuN,GAAiBsb,aAAe,uCAIvC5oB,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,gCAChBD,EAAAA,GAAAA,KAACk8C,GAAa,CACZnmC,UAAU,iBACV1W,MAAOoO,GAASmI,gBAAkB,GAClCnU,SA58Me+5F,CAACp8F,EAAOy9C,KAEnC,MAAM4+C,EApBe5+C,KACrB,IAAKA,EAAgB,MAAO,GAG5B,IAAIE,EAAaF,EACdh9B,QAAQ,MAAO,IACfA,QAAQ,WAAO,IAGdk9B,EAAWp9C,SAAS,OACtBo9C,EAAaA,EAAWl9B,QAAQ,IAAK,MAGvC,MAAMm9B,EAAWrnC,WAAWonC,GAC5B,OAAO5T,MAAM6T,GAAY,GAAKA,EAASp0C,YAMlB8yF,CAAc7+C,GAInC4Q,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP,CAACF,GAAQq8F,KAIX/rC,IAAa,IAi8MDvT,OAAQykC,GACRhnF,SAAUomC,GACVrmC,WAAY6T,GAAiBoI,eAC7B9T,YAAY,oBAEb0L,GAAiBoI,iBAChB5V,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiBoI,qBAGjC1V,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,qCACPC,EAAAA,GAAAA,MAACutC,GAAsB,CAAC7zC,SAAUomC,GAA0Bn/B,MAAO,CAAEpK,OAAQ,QAASwJ,SAAA,EACpFC,EAAAA,GAAAA,MAACytC,GAAqB,CACpBnsC,QAASiM,GAAS8kB,oBAAqB,EACvC34B,SAAUomC,GAAyB//B,SAAA,EAEnCD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,WACLoJ,QAASiM,GAAS8kB,oBAAqB,EACvC9wB,SAAWvC,GAAMC,GAAkB,oBAAqBD,EAAE2C,OAAOL,SACjE5H,SAAUomC,MAEZhgC,EAAAA,GAAAA,KAAA,eAEFA,EAAAA,GAAAA,KAAC6tC,GAAoB,CAACrsC,QAASiM,GAAS8kB,oBAAqB,EAAMtyB,SAChEwN,GAAS8kB,kBAAoB,qBAAoB,+CAK1DvyB,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC,wBAAmB8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EAC1DC,EAAAA,GAAAA,MAACiuC,GAAc,CAAAluC,SAAA,EACbD,EAAAA,GAAAA,KAACquC,GAAS,CAACj1C,UAAQ,EAAA6G,SAAC,oBACpBD,EAAAA,GAAAA,KAACuuC,GAAiB,CAChBn2C,KAAK,SACLq2C,SAAUzvC,MAAMC,QAAQwO,GAASsV,gBAAkBtV,GAASsV,cAAc9hB,OAAS,EACnFd,QAASA,IAAMhB,GAAkB,gBAAiB,IAClDuB,MAAM,wBAAeT,UAErBD,EAAAA,GAAAA,KAACsI,EAAAA,EAAC,CAACF,KAAM,WAGbpI,EAAAA,GAAAA,KAACk7F,GAAkB,CACjB77F,MAAOoO,GAASsV,eAAiB,GACjCthB,SAAWk6F,GAAmBx8F,GAAkB,gBAAiBw8F,GACjEx/C,OAAQA,CAAC/8C,EAAOC,IAAUuhF,GAAgB,gBAAiBvhF,GAC3D+jB,QAASm/B,GACTzgD,YAAY,2CACZ1C,MAAM,YACNxF,SAAUomC,GACVrmC,WAAY6T,GAAiBuV,cAC7B3pB,UAAU,EACVye,UAAU,EACVvX,MAAMN,EAAAA,GAAAA,KAAC4B,EAAAA,EAAQ,IACfoyF,eAAgBA,GAChBqH,eAAgBA,CAACpH,EAAQ70F,IAAU60F,EAAO50F,OAAS40F,EAAO3qF,IAAM2qF,EAChE//B,iBAAkBA,KAEnB1mD,GAAiBuV,gBAChB/iB,EAAAA,GAAAA,KAAClF,GAAS,CAAC+F,MAAO,CAAEa,UAAW,SAAUU,QAAS,SAAUnC,SACzDuN,GAAiBuV,sBAO1B/iB,EAAAA,GAAAA,KAACpH,GAAO,CAACiI,MAAO,CAAEa,UAAW,UAAWzB,UACtCC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EAEvCD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVg6F,UAAW,oBACX5iF,aAAc,aAGhBjY,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EACvCC,EAAAA,GAAAA,MAACiuC,GAAc,CAAAluC,SAAA,EACbD,EAAAA,GAAAA,KAACquC,GAAS,CAACj1C,UAAQ,EAAA6G,SAAC,mCACpBD,EAAAA,GAAAA,KAACuuC,GAAiB,CAChBn2C,KAAK,SACLq2C,WAAYhhC,GAAS4L,mBACrBlZ,QAASA,IAAMhB,GAAkB,qBAAsB,IACvDuB,MAAM,wBAAeT,UAErBD,EAAAA,GAAAA,KAACsI,EAAAA,EAAC,CAACF,KAAM,WAGbpI,EAAAA,GAAAA,KAACk7F,GAAkB,CACjB77F,MAAOoO,GAAS4L,oBAAsB,GACtC5X,SAAW05F,GAAkBh8F,GAAkB,qBAAsBg8F,GACrEh/C,OAAQA,CAAC/8C,EAAOC,IAAUuhF,GAAgB,qBAAsBvhF,GAChE+jB,QAASnJ,GACTnY,YAAY,qCACZ1C,MAAM,qBACN6wB,SAAS,EACTmrE,YAAY,GACZ96F,MAAMN,EAAAA,GAAAA,KAAC47F,EAAAA,EAAK,IACZhiG,SAAU+uE,GACVhvE,WAAY6T,GAAiB6L,mBAC7BjgB,UAAU,EACV46F,eAAgBA,GAChBqH,eAAgBA,CAACpH,EAAQ70F,IAAU60F,EAAOl7E,WAAak7E,EAAOr7E,KAAOq7E,EAAO3qF,IAAM2qF,IAEnFzmF,GAAiB6L,qBAChBrZ,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiB6L,0BAMlC,MACC,MAAM4lE,EAAiBhlE,GAAmBI,KAAKC,GAAOA,EAAIvB,YAActL,GAAS4L,oBAAsBiB,EAAI1B,MAAQnL,GAAS4L,oBACtH9b,GAAsB,OAAd0hF,QAAc,IAAdA,OAAc,EAAdA,EAAgB1kE,eAA6B,OAAd0kE,QAAc,IAAdA,OAAc,EAAdA,EAAgB1hF,QAAS,GACtE,OAAOA,EAAMoC,SAAS,cAAgBpC,EAAMoC,SAAS,kBACtD,EAJA,KAKCK,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EACvCC,EAAAA,GAAAA,MAACiuC,GAAc,CAAAluC,SAAA,EACbD,EAAAA,GAAAA,KAACquC,GAAS,CAACj1C,UAAQ,EAAA6G,SAAC,eACpBD,EAAAA,GAAAA,KAACuuC,GAAiB,CAChBn2C,KAAK,SACLq2C,SAAUzvC,MAAMC,QAAQwO,GAAS+L,SAAW/L,GAAS+L,OAAOvY,OAAS,EACrEd,QAASA,IAAMhB,GAAkB,SAAU,IAC3CuB,MAAM,wBAAeT,UAErBD,EAAAA,GAAAA,KAACsI,EAAAA,EAAC,CAACF,KAAM,WAGbpI,EAAAA,GAAAA,KAACk7F,GAAkB,CACjB77F,MAAOoO,GAAS+L,QAAU,GAC1B/X,SAAWk6F,GAAmBx8F,GAAkB,SAAUw8F,GAC1Dx/C,OAAQA,CAAC/8C,EAAOC,IAAUuhF,GAAgB,SAAUvhF,GACpD+jB,QAAS0jD,GACThlE,YAAa,MACX,IAAK2L,GAASqb,YAAa,MAAO,mCAClC,GAAqC,IAAjCg+C,GAAsB7lE,OAAc,MAAO,0CAG/C,MACM46F,EAAU/0B,GACbkmB,MAAM,EAFO,GAGb1rF,IAAI66D,GAAMA,EAAGG,UAAYH,EAAGvjD,KAC5Bo1D,KAAK,MAGR,OADgBlH,GAAsB7lE,OANtB,EAOF,cAAAoI,OAAYwyF,EAAO,uBAAAxyF,OAAmBwyF,EACrD,EAbY,GAcbz8F,MAAM,SACN6wB,SAAS,EACTmrE,YAAY,GACZ96F,MAAMN,EAAAA,GAAAA,KAAC+B,EAAAA,EAAI,IACXnI,SAAU+uE,KAAiCl7D,GAASqb,YACpDnvB,WAAY6T,GAAiBgM,OAC7BpgB,UAAU,EACVye,UAAU,EACVm8E,eAAgBA,KAGjBxmF,GAAiBgM,SAChBxZ,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiBgM,cAMpC,MACC,MAAMylE,EAAiBhlE,GAAmBI,KAAKC,GAAOA,EAAI1B,MAAQnL,GAAS4L,oBAE3E,QAD4B,OAAd4lE,QAAc,IAAdA,OAAc,EAAdA,EAAgB1hF,QAAS,IAC1BoC,SAAS,UACvB,EAJA,KAKCO,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACEC,EAAAA,GAAAA,MAACtH,GAAO,CAACiI,MAAO,CAACi7F,oBAAqB,WAAW77F,SAAA,EAC/CC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,2BAChBC,EAAAA,GAAAA,MAAC6uC,GAA4B,CAAA9uC,SAAA,EAC3BC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAACmH,OACrB4M,GAASgM,gBAAiBk/C,IAAkBA,GAAcmmB,UAClC,aAAvBnmB,GAAcyD,MAA8C,aAAvBzD,GAAcyD,KAEhD,CAAC,EADD,CAAEj7D,OAAQ,oBAAqBC,aAAc,OAElDnB,SAAA,EACCD,EAAAA,GAAAA,KAACqI,EAAAA,EAAM,KACPrI,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,gBACLnH,YAAY,qDACZzC,MAAO05D,GACPt3D,SAAWvC,IACT,MAAMG,EAAQH,EAAE2C,OAAOxC,MACvB25D,GAAqB35D,GACrB65D,GAA0B75D,EAAM4B,OAAS,GACzCm4D,IAAmC,GAG9B/5D,GACHF,GAAkB,gBAAiB,KAGvC67F,UAAY97F,IACV,IAAK+5D,GAAwB,OAE7B,MAAM8iC,EAAcnyD,GAAcmvB,IAC5BywB,EAAWjxB,GAAY34D,OAAO2xB,IAClC,GAAiB,GAAbA,EAAE3S,UAA8B,IAAd2S,EAAE3S,QAAmB,OAAO,EAClD,MAAMo9E,EAAQpyD,GAAcrY,EAAE9X,eAAiB8X,EAAEqsC,iBAAmB,IAC9DrgE,EAAQqsC,GAAcrY,EAAE0qE,eAAiB1qE,EAAEnoB,SAAW,IACtD8yF,EAAQtyD,GAAcrY,EAAEusC,aAAe,IACvCngE,EAAMisC,GAAcrY,EAAE5zB,KAAO,IAC7B0D,EAAOuoC,GAAcrY,EAAE3yB,UAAY,IACzC,OAAOo9F,EAAMr8F,SAASo8F,IACfx+F,EAAMoC,SAASo8F,IACfG,EAAMv8F,SAASo8F,IACfp+F,EAAIgC,SAASo8F,IACb16F,EAAK1B,SAASo8F,KACpB/O,MAAM,EAAG,IAEZ,GAAc,cAAV9tF,EAAEjJ,IACJiJ,EAAEuU,iBACF2lD,GAAkC95D,GAChCA,EAAOkqF,EAASvoF,OAAS,EAAI3B,EAAO,EAAIA,QAErC,GAAc,YAAVJ,EAAEjJ,IACXiJ,EAAEuU,iBACF2lD,GAAkC95D,GAChCA,EAAO,EAAIA,EAAO,GAAK,QAEpB,GAAc,UAAVJ,EAAEjJ,KAAmBkjE,IAAkC,EAAG,CACnEj6D,EAAEuU,iBACF,MAAMvZ,EAAWsvF,EAASrwB,IAC1B,GAAIj/D,EAAU,CACZ,MAAM8hG,EAAQ9hG,EAASuf,eAAiBvf,EAAS0jE,gBACjDz+D,GAAkB,gBAAiB68F,GACnChjC,GAAqBgjC,GACrB9iC,IAA0B,GAC1BE,IAAmC,EACrC,CACF,KAAqB,WAAVl6D,EAAEjJ,MACXijE,IAA0B,GAC1BE,IAAmC,KAGvClc,QAASA,KAEH6b,IAAqBA,GAAkB93D,OAAS,GAClDi4D,IAA0B,IAG9B/c,OAASj9C,IAEPqI,WAAW,KACT2xD,IAA0B,GAC1BE,IAAmC,GAGnC,MAAM+iC,EAAcpjC,GAAkBv2D,OACtC,GAAI25F,EAAa,CACM5jC,GAAYv/C,KAAKuY,GACrB,IAAdA,EAAE3S,UAA+B,IAAd2S,EAAE3S,UACrB2S,EAAE9X,gBAAkB0iF,GAAe5qE,EAAEqsC,kBAAoBu+B,IAKtD1uF,GAASgM,gBAAkB0iF,GAC7Bh9F,GAAkB,gBAAiBg9F,IAIrCh9F,GAAkB,gBAAiB,IACnC65D,GAAqB,IACrB1T,GAAU,uCAAqC,WAEnD,GACC,MAEL1rD,SAAU+uE,GACVhvE,WAAY6T,GAAiBiM,cAC7B/f,SAAO,OAKVu/D,IAA0BF,IAAqBA,GAAkB93D,OAAS,IACzEjB,EAAAA,GAAAA,KAAC0vC,GAAsB,CAAAzvC,SACpB,MACC,MAAM87F,EAAcnyD,GAAcmvB,IAE5BywB,EAAWjxB,GAAY34D,OAAO2xB,IAElC,GAAiB,GAAbA,EAAE3S,UAA8B,IAAd2S,EAAE3S,QAAmB,OAAO,EAElD,MAAMo9E,EAAQpyD,GAAcrY,EAAE9X,eAAiB8X,EAAEqsC,iBAAmB,IAC9DrgE,EAAQqsC,GAAcrY,EAAE0qE,eAAiB1qE,EAAEnoB,SAAW,IACtD8yF,EAAQtyD,GAAcrY,EAAEusC,aAAe,IACvCngE,EAAMisC,GAAcrY,EAAE5zB,KAAO,IAC7B0D,EAAOuoC,GAAcrY,EAAE3yB,UAAY,IAEzC,OAAOo9F,EAAMr8F,SAASo8F,IACfx+F,EAAMoC,SAASo8F,IACfG,EAAMv8F,SAASo8F,IACfp+F,EAAIgC,SAASo8F,IACb16F,EAAK1B,SAASo8F,KACpB/O,MAAM,EAAG,IAEZ,OAAIv0B,IAEAz4D,EAAAA,GAAAA,KAACkwC,GAAsB,CAAAjwC,SAAC,yCAMJ,IAApBupF,EAASvoF,QAETjB,EAAAA,GAAAA,KAACkwC,GAAsB,CAAAjwC,SAAC,+CAMrBupF,EAASloF,IAAI,CAACq8D,EAAS9xC,KAE5B,MAAMuwE,EAA8B,aAAjBz+B,EAAQvB,MAAwC,aAAjBuB,EAAQvB,KACpD5b,EAAa30B,IAAUstC,GAE7B,OACEj5D,EAAAA,GAAAA,MAAC0vC,GAAqB,CAEpBn5B,YAAcvX,IAEZA,EAAEuU,iBACF,MAAMuoF,EAAQr+B,EAAQlkD,eAAiBkkD,EAAQC,gBAC/Cz+D,GAAkB,gBAAiB68F,GACnChjC,GAAqBgjC,GACrB9iC,IAA0B,GAC1BE,IAAmC,IAErCv4D,OAAKtB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACC68F,EAAa,CAAEC,WAAY,oBAAqBxvD,QAAS,IAAQ,CAAC,GAClE2T,EAAa,CAAE8iB,gBAAiB,UAAW+4B,WAAY,qBAAwB,CAAC,GACpFp8F,SAAA,EAEFC,EAAAA,GAAAA,MAAC4vC,GAAsB,CAAA7vC,SAAA,CACpB09D,EAAQlkD,eAAiBkkD,EAAQC,gBACjCw+B,IAAcp8F,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEG,MAAO,UAAWwiE,WAAY,MAAO7hE,SAAU,UAAW1B,SAAC,mCAE3FC,EAAAA,GAAAA,MAAC8vC,GAAqB,CAAA/vC,SAAA,CACnB09D,EAAQs+B,gBAAiBj8F,EAAAA,GAAAA,KAAA,QAAAC,SAAO09D,EAAQs+B,gBACxCt+B,EAAQ08B,iBACPr6F,EAAAA,GAAAA,KAAA,QAAAC,SACG,IAAIq8F,KAAKC,aAAa,QAAS,CAC9B17F,MAAO,WACP27F,SAAU,MACVnE,sBAAuB,EACvBC,sBAAuB,IACtBmE,OAAO9+B,EAAQ08B,qBAIvB18B,EAAQG,cACP99D,EAAAA,GAAAA,KAACgwC,GAAqB,CAACnvC,MAAO,CAAEc,SAAU,QAASX,MAAO,UAAWU,UAAW,OAAQzB,UACtFC,EAAAA,GAAAA,MAAA,QAAAD,SAAA,CAAM,gBAAI09D,EAAQG,YAAaH,EAAQhgE,IAAG,KAAA0L,OAAQs0D,EAAQhgE,IAAG,KAAM,GAAIggE,EAAQ/+D,SAAQ,MAAAyK,OAASs0D,EAAQ/+D,UAAa,UAlCpH++D,EAAQr0D,KAwCpB,EAnFA,QAwFNkE,GAAiBiM,gBAChBzZ,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiBiM,oBAGjCvZ,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,iCACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAACu7F,EAAAA,EAAQ,KACTv7F,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,mBACLnH,YAAY,6CACZzC,MAAOoO,GAASiM,kBAAoB,GACpCjY,SAAWvC,GAAMC,GAAkB,mBAAoBD,EAAE2C,OAAOxC,OAChE88C,OAAQA,IAAMykC,GAAgB,mBAAoBnzE,GAASiM,kBAC3D9f,SAAU+uE,GACVhvE,WAAY6T,GAAiBkM,iBAC7BhgB,SAAO,OAGV8T,GAAiBkM,mBAChB1Z,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiBkM,yBAMlCjM,GAASgM,eAAiBk/C,KAAkBA,GAAcmmB,WACjC,aAAvBnmB,GAAcyD,MAA8C,aAAvBzD,GAAcyD,QACpDl8D,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVa,UAAW,OACXuW,aAAc,OACdnX,QAAS,WACTI,WAAY,UACZC,OAAQ,oBACRC,aAAc,MACdJ,MAAO,UACPW,SAAU,SACVoW,WAAY,IACZ3V,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,OACL9J,SAAA,CAAC,iDAEA04D,GAAc+jC,cACbx8F,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CAAEc,SAAU,UAAWoW,WAAY,KAAM9X,SAAA,CAAC,oBACnC,IAAIyc,KAAKi8C,GAAc+jC,aAAar9C,mBAAmB,kBAUpF,MACC,MAAM4/B,EAAiBhlE,GAAmBI,KAAKC,GAAOA,EAAI1B,MAAQnL,GAAS4L,oBACrE9b,GAAsB,OAAd0hF,QAAc,IAAdA,OAAc,EAAdA,EAAgB1hF,QAAS,GACvC,OAAOA,EAAMoC,SAAS,wBAAoBpC,EAAMoC,SAAS,cAC1D,EAJA,KAKCO,EAAAA,GAAAA,MAACtH,GAAO,CAACiI,MAAO,CAACi7F,oBAAqB,WAAW77F,SAAA,EAC/CC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,sCAChBC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAAC+B,EAAAA,EAAI,KACL/B,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,yBACLnH,YAAY,gDACZzC,MAAOoO,GAASkM,wBAA0B,GAC1ClY,SAAWvC,GAAMC,GAAkB,yBAA0BD,EAAE2C,OAAOxC,OACtEzF,UAAU,EACV+iG,UAAU,EACVhjG,WAAY6T,GAAiBmM,uBAC7BjgB,SAAO,EACPmH,MAAO,CAAEyiE,gBAAiB,UAAWq2B,OAAQ,oBAGhDnsF,GAAiBmM,yBAChB3Z,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiBmM,6BAGjCzZ,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,iBACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAACu7F,EAAAA,EAAQ,KACTv7F,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,wBACLnH,YAAY,8CACZzC,MAAOoO,GAASmM,uBAAyB,GACzCnY,SAAWvC,GAAMC,GAAkB,wBAAyBD,EAAE2C,OAAOxC,OACrEzF,SAAU+uE,GACVhvE,WAAY6T,GAAiBoM,sBAC7BlgB,SAAO,OAGV8T,GAAiBoM,wBAChB5Z,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiBoM,8BAMpC,MACC,MAAMqlE,EAAiBhlE,GAAmBI,KAAKC,GAAOA,EAAI1B,MAAQnL,GAAS4L,oBACrE9b,GAAsB,OAAd0hF,QAAc,IAAdA,OAAc,EAAdA,EAAgB1hF,QAAS,GACvC,OAAOA,EAAMoC,SAAS,gBAAepC,EAAMoC,SAAS,aACrD,EAJA,KAKCO,EAAAA,GAAAA,MAACtH,GAAO,CAACiI,MAAO,CAACi7F,oBAAqB,WAAW77F,SAAA,EAC/CC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,2CAChBC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAAC+B,EAAAA,EAAI,KACL/B,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,yBACLnH,YAAY,yDACZzC,MAAOoO,GAASoM,wBAA0B,GAC1CpY,SAAWvC,GAAMC,GAAkB,yBAA0BD,EAAE2C,OAAOxC,OACtEzF,SAAU+uE,GACVhvE,WAAY6T,GAAiBqM,uBAC7BngB,SAAO,OAGV8T,GAAiBqM,yBAChB7Z,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiBqM,6BAGjC3Z,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,2CACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAACu7F,EAAAA,EAAQ,KACTv7F,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,4BACLnH,YAAY,iDACZzC,MAAOoO,GAASqM,2BAA6B,GAC7CrY,SAAWvC,GAAMC,GAAkB,4BAA6BD,EAAE2C,OAAOxC,OACzEzF,SAAU+uE,GACVhvE,WAAY6T,GAAiBsM,0BAC7BpgB,SAAO,OAGV8T,GAAiBsM,4BAChB9Z,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiBsM,wCASzC9Z,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,GAQpCwN,GAASnE,KACVszB,GAAiBnvB,GAASukB,kBAAmB,UAC7Ck0C,IAAoBC,MACpBjmE,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EAEED,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVg6F,UAAW,oBACX5iF,aAAc,SACdvW,UAAW,WAGbxB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,GAE9BwN,GAASnE,KACVpJ,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACEC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQw6F,eAAgB,gBAAiB56B,WAAY,SAAU/pD,aAAc,QAAShY,SAAA,EAC3GD,EAAAA,GAAAA,KAAC/G,GAAK,CAAC4H,MAAO,CAAEc,SAAU,OAAQoW,WAAY,MAAOD,OAAQ,GAAI7X,SAAC,uCA1oG7D48F,MAC3B,MAAMz/F,EAASwsB,GAAqBnc,GAAU,QAC9C,OAAsC,IAA/B/K,OAAOC,KAAKvF,GAAQ6D,QA2oGJ47F,IAA0BpvF,GAASye,iBAClChsB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,UAAW9J,SAAA,EACnED,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEkX,WAAY,OAAS/W,MAAO,UAAWW,SAAU,YAAa1B,SAAC,gBAG9ED,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACXkX,WAAY,MACZ/W,MAAO,UACPsiE,gBAAiB,UACjBxiE,QAAS,iBACTM,aAAc,MACdO,SAAU,YACV1B,SACC4qE,GAAgB/iE,aAO7B5H,EAAAA,GAAAA,MAAA,SAAOW,MAAO,CACZuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,OACLjJ,QAAS,OACTK,OAAQ,oBACRC,aAAc,MACdkiE,gBAA6C,YAA5B71D,GAASye,eAA+B,UAAY,UACrEytE,OAAQlxB,GAAgC,cAAgB,UACxD57B,QAAS47B,GAAgC,GAAM,EAC/CxwD,aAAc,OACdtW,SAAU,OACVoW,WAAY,MACZ/W,MAAmC,YAA5ByM,GAASye,eAA+B,UAAY,UAC3D4wE,cAAer0B,GAAgC,OAAS,QAE1DtoE,QAAUjB,IACRA,EAAEuU,iBACF+5E,GAAiB,YACjBvtF,SAAA,EAEAD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,QACL6Q,KAAK,iBACL5J,MAAM,UACNmC,QAAqC,YAA5BiM,GAASye,eAClBzqB,SAAUA,OACV7H,SAAU6uE,GACV5nE,MAAO,CACLrK,MAAO,OACPC,OAAQ,OACRsmG,YAAa,UACbjlF,OAAQ,EACRoqD,WAAY,MAGhBliE,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM08F,EAAAA,GAAS50F,KAAK,OAAO,kBAEf,YAA5BqF,GAASye,iBACRlsB,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACX2iE,WAAY,SACZ7hE,SAAU,WACVX,MAAO,UACP+W,WAAY,OACZ9X,SAAC,eAOPC,EAAAA,GAAAA,MAAA,SAAOW,MAAO,CACZuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,OACLjJ,QAAS,OACTK,OAAQ,oBACRC,aAAc,MACdkiE,gBAA6C,gBAA5B71D,GAASye,eAAmC,UAAY,UACzEytE,OAAQlxB,GAAgC,cAAgB,UACxD57B,QAAS47B,GAAgC,GAAM,EAC/CxwD,aAAc,OACdtW,SAAU,OACVoW,WAAY,MACZ/W,MAAmC,gBAA5ByM,GAASye,eAAmC,UAAY,UAC/D4wE,cAAer0B,GAAgC,OAAS,QAE1DtoE,QAAUjB,IACRA,EAAEuU,iBACF+5E,GAAiB,gBACjBvtF,SAAA,EAEAD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,QACL6Q,KAAK,iBACL5J,MAAM,cACNmC,QAAqC,gBAA5BiM,GAASye,eAClBzqB,SAAUA,OACV7H,SAAU6uE,GACV5nE,MAAO,CACLrK,MAAO,OACPC,OAAQ,OACRsmG,YAAa,UACbjlF,OAAQ,EACRoqD,WAAY,MAGhBliE,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAME,EAAAA,IAAS4H,KAAK,OAAO,iBAEf,gBAA5BqF,GAASye,iBACRlsB,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACX2iE,WAAY,SACZ7hE,SAAU,WACVX,MAAO,UACP+W,WAAY,OACZ9X,SAAC,eAOPC,EAAAA,GAAAA,MAAA,SAAOW,MAAO,CACZuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,OACLjJ,QAAS,OACTK,OAAQ,oBACRC,aAAc,MACdkiE,gBAA6C,cAA5B71D,GAASye,eAAiC,UAAY,UACvEytE,OAAQlxB,GAAgC,cAAgB,UACxD57B,QAAS47B,GAAgC,GAAM,EAC/C9mE,SAAU,OACVoW,WAAY,MACZ/W,MAAmC,cAA5ByM,GAASye,eAAiC,UAAY,UAC7D4wE,cAAer0B,GAAgC,OAAS,QAE1DtoE,QAAUjB,IACRA,EAAEuU,iBACF+5E,GAAiB,cACjBvtF,SAAA,EAEAD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,QACL6Q,KAAK,iBACL5J,MAAM,YACNmC,QAAqC,cAA5BiM,GAASye,eAClBzqB,SAAUA,OACV7H,SAAU6uE,GACV5nE,MAAO,CACLrK,MAAO,OACPC,OAAQ,OACRsmG,YAAa,UACbjlF,OAAQ,EACRoqD,WAAY,MAGhBliE,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMyC,EAAAA,IAASqF,KAAK,OAAO,eAEf,cAA5BqF,GAASye,iBACRlsB,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACX2iE,WAAY,SACZ7hE,SAAU,WACVX,MAAO,UACP+W,WAAY,OACZ9X,SAAC,eAOuB,gBAA5BwN,GAASye,gBAAgE,YAA5Bze,GAASye,kBACtDhsB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEshE,KAAM,IAAK86B,SAAU,SAAUh9F,SAAA,EAC3CC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,UAAW9J,SAAA,EACnEC,EAAAA,GAAAA,MAAA,SAAOW,MAAO,CACZkX,WAAY,MACZ/W,MAAO,UACPW,SAAU,WACVw2F,WAAY,UACZl4F,SAAA,CAAC,eAEDD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEG,MAAO,UAAWwiE,WAAY,OAAQvjE,SAAC,UAExDC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAACmH,MAAO,CAAEshE,KAAM,GAAIliE,SAAA,EACxCD,EAAAA,GAAAA,KAACu7F,EAAAA,EAAQ,KACTv7F,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACLiH,MAAOoO,GAAS2b,oBAAsB,GACtC3nB,SAAWvC,GAAMC,GAAkB,qBAAsBD,EAAE2C,OAAOxC,OAClE88C,OAAQA,IAAMykC,GAAgB,qBAAsBnzE,GAAS2b,oBAC7DtnB,YAC8B,gBAA5B2L,GAASye,eACL,8CACA,iEAENxyB,SAAO,EACPC,WAAY6T,GAAiB4b,2BAIlC5b,GAAiB4b,qBAChBppB,EAAAA,GAAAA,KAAClF,GAAS,CAAC+F,MAAO,CAAEa,UAAW,WAAYzB,SAAEuN,GAAiB4b,2BASrEwT,GAAiBnvB,GAASukB,kBAAmB,cAAgBvkB,GAASye,kBAAoBze,GAASwnB,iBAAmBxnB,GAASuoB,eAC9H91B,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVa,UAAW,OACXZ,QAAS,OACTwiE,gBAA6C,cAA5B71D,GAASye,eAAiC,UACf,gBAA5Bze,GAASye,eAAmC,UAAY,UACxE/qB,OAAoC,cAA5BsM,GAASye,eAAiC,oBACd,gBAA5Bze,GAASye,eAAmC,oBAAsB,oBAC1E9qB,aAAc,MACdJ,MAAmC,cAA5ByM,GAASye,eAAiC,UACd,gBAA5Bze,GAASye,eAAmC,UAAY,WAC/DjsB,SAAA,EACAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVc,SAAU,OACVoW,WAAY,MACZE,aAAc,UACd7V,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACL9J,SAAA,EACAD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEc,SAAU,WAAY1B,SACN,cAA5BwN,GAASye,eAAiC,SACd,gBAA5Bze,GAASye,eAAmC,SAAM,WAExB,cAA5Bze,GAASye,eAAiC,0DACd,gBAA5Bze,GAASye,eAAmC,uDAC5C,mEAEHhsB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,WAAYqW,WAAY,OAAQ/X,SAAA,EACtDC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEoX,aAAc,UAAWhY,SAAA,EACrCD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,2BAAyB,KAAEi9F,EAAAA,GAAAA,IAAWzvF,GAASuoB,cAAc,YAAGh2B,EAAAA,GAAAA,KAAA,UAAAC,SACzC,cAA5BwN,GAASye,eAAiC,eACd,gBAA5Bze,GAASye,eAAmC,aAAY,eAClD,IAAE2+C,GAAgBp9D,GAASwnB,oBAGrCxnB,GAAS2b,oBAAkD,cAA5B3b,GAASye,iBACvChsB,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACED,EAAAA,GAAAA,KAAA,UAAAC,SAC+B,gBAA5BwN,GAASye,eAAmC,8BAChB,YAA5Bze,GAASye,eAA+B,4BAAmB,sBACrD,IAAEze,GAAS2b,oCAY/B3b,GAASnE,KACVszB,GAAiBnvB,GAASukB,kBAAmB,WAC5Ck0C,IAAoBC,KACtB14D,GAASye,kBAAoBze,GAASwnB,iBAAmBxnB,GAASuoB,eACjE91B,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVa,UAAW,OACXZ,QAAS,OACTwiE,gBAA6C,cAA5B71D,GAASye,eAAiC,UACf,gBAA5Bze,GAASye,eAAmC,UAAY,UACxE/qB,OAAoC,cAA5BsM,GAASye,eAAiC,oBACd,gBAA5Bze,GAASye,eAAmC,oBAAsB,oBAC1E9qB,aAAc,MACdJ,MAAmC,cAA5ByM,GAASye,eAAiC,UACd,gBAA5Bze,GAASye,eAAmC,UAAY,WAC/DjsB,SAAA,EACAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVc,SAAU,OACVoW,WAAY,MACZE,aAAc,UACd7V,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACL9J,SAAA,EACAD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEc,SAAU,WAAY1B,SACN,cAA5BwN,GAASye,eAAiC,SACd,gBAA5Bze,GAASye,eAAmC,SAAM,WAExB,cAA5Bze,GAASye,eAAiC,0DACd,gBAA5Bze,GAASye,eAAmC,uDAC5C,mEAEHhsB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,WAAYqW,WAAY,OAAQ/X,SAAA,EACtDC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEoX,aAAc,UAAWhY,SAAA,EACrCD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,2BAAyB,KAAEi9F,EAAAA,GAAAA,IAAWzvF,GAASuoB,cAAc,YAAGh2B,EAAAA,GAAAA,KAAA,UAAAC,SACzC,cAA5BwN,GAASye,eAAiC,eACd,gBAA5Bze,GAASye,eAAmC,aAAY,eAClD,IAAE2+C,GAAgBp9D,GAASwnB,oBAGrCxnB,GAAS2b,oBAAkD,cAA5B3b,GAASye,iBACvChsB,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACED,EAAAA,GAAAA,KAAA,UAAAC,SAC+B,gBAA5BwN,GAASye,eAAmC,8BAChB,YAA5Bze,GAASye,eAA+B,4BAAmB,sBACrD,IAAEze,GAAS2b,wCAapC1jB,IAA+B,IAAjBD,MAAwBgI,GAASye,iBAC/ChsB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACViX,OAAQ,SACRhX,QAAS,eACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdJ,MAAO,WACPf,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAOE,aAAc,SAAU7V,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,UAAW9J,SAAC,6DAGjHD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,YAAa1B,SAAC,qOAOzC4lE,GAAkB5qD,cACjB/a,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EAEEC,EAAAA,GAAAA,MAAC3H,GAAW,CAAC,eAAa,YAAW0H,SAAA,CAClC,MAEC,MAAMmqE,EAAsBnwD,GAAmBI,KAAKC,GAClDA,EAAI1B,MAAQnL,GAAS4L,oBACrBiB,EAAIjb,QAAUoO,GAAS4L,oBAGnBmlB,IAD2B,OAAnB4rC,QAAmB,IAAnBA,OAAmB,EAAnBA,EAAqB7sE,QAAS,IACnBgtB,cAAc5qB,SAAS,YAEhD,OACEK,EAAAA,GAAAA,KAAA0W,GAAAA,SAAA,CAAAzW,UACEC,EAAAA,GAAAA,MAAC0D,GAAa,CACZ6oC,aAAcq5B,GAAgB,aAC9B5uD,SAAUvJ,GAAgB,aAAa1N,SAAA,EAEvCC,EAAAA,GAAAA,MAACzH,GAAY,CAACg0C,aAAcq5B,GAAgB,aAAa7lE,SAAA,EACvDD,EAAAA,GAAAA,KAAC4L,GAAW,CAAC6gC,aAAcq5B,GAAgB,aAAa7lE,UACtDD,EAAAA,GAAAA,KAAC4B,EAAAA,EAAQ,MACG,YAEb48B,IACCx+B,EAAAA,GAAAA,KAACqtC,GAAW,CAAC3sC,MAAM,uFAAsEG,MAAO,CAAE2iE,WAAY,MAAOxiE,MAAO,WAAYf,SAAC,oEAK7IC,EAAAA,GAAAA,MAACitC,GAAe,CAAAltC,SAAA,CAEbqoF,OACCpoD,KACA1B,GACD74B,KACCA,GAAc,mBAAqBA,GAAc,mBACjD3F,EAAAA,GAAAA,KAACq1C,GAAkB,CACjBn+B,UAAU,EACV/W,QAASuoF,GACThoF,MAAM,6CACNG,MAAO,CACLgG,SAAU,WACVG,MAAO,OACP4L,IAAK,OACLqnF,UAAW,OACXx2B,YAAa,OACbxjE,UAEFC,EAAAA,GAAAA,MAAA,OAAK1J,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,OAAOC,OAAO,eAAeC,YAAY,IAAG1J,SAAA,EAC/FD,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,+CACRgK,EAAAA,GAAAA,KAAA,UAAQ9J,GAAG,MAAMC,GAAG,IAAIC,EAAE,OAC1B4J,EAAAA,GAAAA,KAAA,QAAMm9F,GAAG,KAAKC,GAAG,IAAIC,GAAG,KAAKC,GAAG,QAChCt9F,EAAAA,GAAAA,KAAA,QAAMm9F,GAAG,KAAKC,GAAG,KAAKC,GAAG,KAAKC,GAAG,YAItC9+D,GACCx+B,EAAAA,GAAAA,KAACgtC,GAAY,CACXE,WAAW,EACXT,aAAcq5B,GAAgB,aAC9BjlE,MAAO,CAAE84F,OAAQ,cAAe9sD,QAAS,IACzCnsC,MAAM,gDAA4CT,UAElDD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAME,EAAAA,SAGzBR,EAAAA,GAAAA,KAACgtC,GAAY,CACXE,UAAWljB,GAAcgD,UACzByf,aAAcq5B,GAAgB,aAC9B3lE,QAASA,IAAM03B,GAAc,aAC7Bh3B,MAAO,CAAE84F,OAAQ,WAAY15F,UAE7BD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM26F,EAAAA,eAOpC,EA5EA,IA6ED/6F,EAAAA,GAAAA,MAACqtC,GAAc,CAACL,UAAWljB,GAAcgD,UAAU/sB,SAAA,EACjDD,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EACvCC,EAAAA,GAAAA,MAACjH,GAAK,CAACG,UAAQ,EAAA6G,SAAA,CAAC,sBAEbm3D,KACCl3D,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CAACkX,WAAY,SAAUpW,SAAU,SAAUX,MAAO,OAAQwiE,WAAY,OAAOvjE,SAAA,CAAC,oBAE5D,UAA3Bm3D,GAAqC,mCACV,SAA3BA,GAAoC,OACT,YAA3BA,IAC2B,qBAA3BA,GADuC,UAEvC,0BACD,WAIPl3D,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAACmH,MAAO,CAACgG,SAAU,YAAY5G,SAAA,EACnDD,EAAAA,GAAAA,KAAC4B,EAAAA,EAAQ,KACT5B,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,kBACLnH,YAAY,4BACZzC,MAAOoO,GAASjQ,iBAAmB,GACnCiE,SAAWvC,IACTC,GAAkB,kBAAmBD,EAAE2C,OAAOxC,OAE1C+3D,IACFC,GAA0B,OAG9Blb,OAAQA,IAAMykC,GAAgB,kBAAmBnzE,GAASjQ,iBAC1D7D,WAAY6T,GAAiBhQ,gBAC7B9D,SAAO,EACPE,SAAUsmC,GACVr/B,MAAO,CAACy8C,aAAc,WAGxBp9C,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVgG,SAAU,WACVG,MAAO,MACP4L,IAAK,MACLqnF,UAAW,mBACX73F,QAAS,OACT2H,IAAK,MACLwzF,OAAQ,IACRt9F,SAAA,EACAD,EAAAA,GAAAA,KAACi1C,GAAkB,CACjB90C,QAAS+/B,QAA2B/lB,EAliMxB5b,UAEhC,MAAMorF,EAAcl8E,GAASjQ,iBAAmB,GAC1CggG,EAAa/vF,GAAS7P,eAAiB,GACvCkrD,EAAa6gC,GAAe6T,EAElC7oC,GAAsB7L,GACtB+L,GAAyB,IACzBJ,IAA4B,SAGtB20B,GAAwBtgC,IAwhMVpoD,MAAOw/B,GAA2B,iCAA2B,uDAC7Dr/B,MAAO,CAAEgsC,QAAS3M,GAA2B,GAAM,EAAGy5D,OAAQz5D,GAA2B,cAAgB,WAAYjgC,UAErHC,EAAAA,GAAAA,MAAA,OAAK1J,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,OAAOC,OAAO,eAAeC,YAAY,IAAG1J,SAAA,EAC/FD,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,+CACRgK,EAAAA,GAAAA,KAAA,UAAQ9J,GAAG,IAAIC,GAAG,IAAIC,EAAE,OACxB4J,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,gCACRgK,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,oCAGZgK,EAAAA,GAAAA,KAACm1C,GAAc,CACbh1C,QAAS+/B,QAA2B/lB,EAAYuvE,GAChDhpF,MAAOw/B,GAA2B,iCAA2B,2BAC7Dr/B,MAAO,CAAEgsC,QAAS3M,GAA2B,GAAM,EAAGy5D,OAAQz5D,GAA2B,cAAgB,WAAYjgC,UAErHC,EAAAA,GAAAA,MAAA,OAAK1J,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,OAAOC,OAAO,eAAeC,YAAY,IAAG1J,SAAA,EAC/FD,EAAAA,GAAAA,KAAA,WAAS9J,GAAG,KAAKC,GAAG,IAAIS,GAAG,IAAIC,GAAG,OAClCmJ,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,4CACRgK,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,kDAKfwX,GAAiBhQ,kBAChBwC,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiBhQ,wBAInC0C,EAAAA,GAAAA,MAACtH,GAAO,CAACiI,MAAO,CAACi7F,oBAAqB,eAAe77F,SAAA,EACnDC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,YAChBC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAAC1J,EAAAA,EAAM,KACP0J,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,mBACLnH,YAAY,kBACZzC,MAAOoO,GAAS/P,kBAAoB,GACpC+D,SAAWvC,GAAMC,GAAkB,mBAAoBD,EAAE2C,OAAOxC,OAChE88C,OAAQA,IAAMykC,GAAgB,mBAAoBnzE,GAAS/P,kBAC3D/D,WAAY6T,GAAiB9P,iBAC7BhE,SAAO,EACPE,SAAUsmC,QAGb1yB,GAAiB9P,mBAChBsC,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiB9P,uBAGjCwC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,cAChBC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAACmH,MAAO,CAACgG,SAAU,YAAY5G,SAAA,EACnDD,EAAAA,GAAAA,KAAC+B,EAAAA,EAAI,KACL/B,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,gBACLnH,YAAY,WACZzC,MAAOoO,GAAS7P,eAAiB,GACjC6D,SAAWvC,GAAMC,GAAkB,gBAAiBD,EAAE2C,OAAOxC,OAC7D88C,OAASj9C,GA54KNvB,KACrB,MAAMuuF,EAAgB,OAAHvuF,QAAG,IAAHA,OAAG,EAAHA,EAAK6E,OAGxBo+E,GAAgB,gBAAiBsL,GAE7BA,GAAcA,EAAWjrF,QAAU,GAAK,QAAQwB,KAAKypF,IACvDD,GAAmBC,IAq4KYuR,CAAcv+F,EAAE2C,OAAOxC,OACtC1F,WAAY6T,GAAiB5P,cAC7BlE,SAAO,EACPE,SAAUsmC,GACVr/B,MAAO,CAACy8C,aAAc,WAGxBt9C,EAAAA,GAAAA,KAACm1C,GAAc,CACbh1C,QAAS+/B,QAA2B/lB,EAAYuvE,GAChDhpF,MAAOw/B,GAA2B,iCAA2B,oCAC7Dr/B,MAAO,CAAEgsC,QAAS3M,GAA2B,GAAM,EAAGy5D,OAAQz5D,GAA2B,cAAgB,WAAYjgC,UAErHC,EAAAA,GAAAA,MAAA,OAAK1J,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,OAAOC,OAAO,eAAeC,YAAY,IAAG1J,SAAA,EAC/FD,EAAAA,GAAAA,KAAA,WAAS9J,GAAG,KAAKC,GAAG,IAAIS,GAAG,IAAIC,GAAG,OAClCmJ,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,4CACRgK,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,4CAKXggE,KACC91D,EAAAA,GAAAA,MAACi5C,GAAe,CAAC,cAAa3e,GAAev6B,SAAA,CACvB,aAAnBu6B,KACCt6B,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACED,EAAAA,GAAAA,KAACq5C,GAAoB,CAAC/3B,OAAO,WAAUrhB,SAAC,4BACxCD,EAAAA,GAAAA,KAACw5C,GAAsB,CAACl4B,OAAO,WAAUrhB,SAAC,yEAMzB,gBAAnBu6B,IAAuD,eAAnBA,KAAoCC,KACxEv6B,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACED,EAAAA,GAAAA,KAACq5C,GAAoB,CAAC/3B,OAAO,QAAOrhB,SACd,gBAAnBu6B,GAAmC,2BAA0B,+BAEhEt6B,EAAAA,GAAAA,MAACs5C,GAAsB,CAACl4B,OAAO,QAAOrhB,SAAA,EACpCD,EAAAA,GAAAA,KAAA,UAAAC,SAASw6B,GAAal9B,OAASk9B,GAAaxxB,MAAQ,kCAAkCjJ,EAAAA,GAAAA,KAAA,SAAK,aACrFy6B,GAAa98B,KAAIqC,EAAAA,GAAAA,KAAA,SACtBy6B,GAAa58B,MAAQqC,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CAAE,aAAMw6B,GAAa58B,KAAImC,EAAAA,GAAAA,KAAA,aAC7Cy6B,GAAah9B,QAAUg9B,GAAa0jC,WAAYj+D,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CAAGw6B,GAAah9B,QAAUg9B,GAAa0jC,SAAQn+D,EAAAA,GAAAA,KAAA,YAChGy6B,GAAa18B,aAAemC,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CAAE,kBAAaw6B,GAAa18B,YAAWiC,EAAAA,GAAAA,KAAA,YACnEy6B,GAAax8B,gBACZiC,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CAAE,YAAUw6B,GAAax8B,cACxBw8B,GAAat8B,gBAAkB+B,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CAAE,KAAGw6B,GAAat8B,iBACjDs8B,GAAap8B,kBAAoB6B,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CAAE,KAAGw6B,GAAap8B,oBACpD2B,EAAAA,GAAAA,KAAA,aAEFE,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAACc,SAAU,OAAQX,MAAO,OAAQU,UAAW,OAAOzB,SAAA,CAAC,UAC/B,UAAxBw6B,GAAasjC,OAAqB,4BAAqB,sBAGnE79D,EAAAA,GAAAA,MAACw5C,GAAsB,CAAAz5C,SAAA,EACrBD,EAAAA,GAAAA,KAAC45C,GAAe,CAACnR,UAAU,YAAYtoC,QAASisF,GAAkBnsF,SAAC,6BAG/C,eAAnBu6B,KACCx6B,EAAAA,GAAAA,KAAC45C,GAAe,CAACnR,UAAU,UAAUtoC,QAh4K3C5B,UACtB,GAAKk8B,GAAL,CAEA,GAA4B,SAAxBA,GAAasjC,OAEf,IACE,MAAMv/D,QAAewtF,EAAAA,GAAAA,IAAe,CAClC9vF,MAAOA,GACPC,SAAUA,GACVoB,MAAOk9B,GAAal9B,MACpBI,IAAK88B,GAAa98B,IAClBE,IAAK48B,GAAa58B,KAAO,GACzBJ,OAAQg9B,GAAah9B,QAAU,GAC/BM,WAAY,GACZE,cAAe,GACfE,cAAe,GACfE,gBAAiB,GACjByJ,QAASA,GACTlJ,SAAU,KAGZ,KAAU,OAANJ,QAAM,IAANA,GAAAA,EAAQkgE,IAAyB,QAAb,OAANlgE,QAAM,IAANA,OAAM,EAANA,EAAQ8iB,SAGxB,MAAM,IAAIuB,OAAY,OAANrkB,QAAM,IAANA,OAAM,EAANA,EAAQsE,UAAW,uBAFnCwiD,IAAaA,GAAU,wEAAoD,CAAEltD,KAAM,WAIvF,CAAE,MAAOsG,GAEP,YADA4mD,IAAaA,GAAU,4DAADj8C,OAAqC3K,EAAMoE,SAAW,CAAE1K,KAAM,UAEtF,CAIFg0F,IAhCyB,GA+3KiEnsF,SAAC,8CAIjED,EAAAA,GAAAA,KAAC45C,GAAe,CAACnR,UAAU,YAAYtoC,QAASksF,GAAgBpsF,SAAC,sBAOnD,cAAnBu6B,KACCt6B,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACED,EAAAA,GAAAA,KAACq5C,GAAoB,CAAC/3B,OAAO,YAAWrhB,SAAC,6BACzCD,EAAAA,GAAAA,KAACw5C,GAAsB,CAACl4B,OAAO,YAAWrhB,SAAC,oJAG3CD,EAAAA,GAAAA,KAAC05C,GAAsB,CAAAz5C,UACrBD,EAAAA,GAAAA,KAAC45C,GAAe,CAACnR,UAAU,YAAYtoC,QAASksF,GAAgBpsF,SAAC,+CAS5EuN,GAAiB5P,gBAChBoC,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiB5P,oBAGjCsC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,cACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAAC+B,EAAAA,EAAI,KACL/B,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,gBACLnH,YAAY,aACZzC,MAAOoO,GAAS3P,eAAiB,GACjC2D,SAAWvC,GAAMC,GAAkB,gBAAiBD,EAAE2C,OAAOxC,OAC7D88C,OAAQA,IAAMykC,GAAgB,gBAAiBnzE,GAAS3P,eACxDpE,SAAO,EACPE,SAAUsmC,eAKlBlgC,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EACvCD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,mBACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAAC3J,EAAAA,EAAI,KACL2J,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,uBACLnH,YAAY,qCACZzC,MAAOoO,GAASzP,sBAAwB,GACxCyD,SAAWvC,GAAMC,GAAkB,uBAAwBD,EAAE2C,OAAOxC,OACpE88C,OAAQA,IAAMykC,GAAgB,uBAAwBnzE,GAASzP,sBAC/DtE,SAAO,EACPE,SAAUsmC,cAOlBlgC,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EAEvCD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVrK,MAAO,OACPC,OAAQ,MACRyK,WAAY,kDACZ4W,OAAQ,sBAEV5X,EAAAA,GAAAA,MAACjH,GAAK,CAAC4H,MAAO,CACZc,SAAU,OACVoW,WAAY,MACZ/W,MAAO,UACPiX,aAAc,OACd7V,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLrI,UAAW,UACXzB,SAAA,EACAD,EAAAA,GAAAA,KAAC3J,EAAAA,EAAI,CAAC+R,KAAM,KAAM,yCAKxBlI,EAAAA,GAAAA,MAACtH,GAAO,CAAAqH,SAAA,EACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,oCACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAAC3J,EAAAA,EAAI,KACL2J,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,0BACLnH,YAAY,eACZzC,MAAOoO,GAASvP,yBAA2B,GAC3CuD,SAAWvC,GAAMC,GAAkB,0BAA2BD,EAAE2C,OAAOxC,OACvE88C,OAAQA,IAAMykC,GAAgB,0BAA2BnzE,GAASvP,yBAClExE,SAAO,EACPE,SAAUsmC,YAIhBhgC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,YACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAACiC,EAAAA,EAAI,KACLjC,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,QACL6Q,KAAK,0BACLnH,YAAY,yBACZzC,MAAOoO,GAASrP,yBAA2B,GAC3CqD,SAAWvC,GAAMC,GAAkB,0BAA2BD,EAAE2C,OAAOxC,OACvE88C,OAAQA,IAAMykC,GAAgB,0BAA2BnzE,GAASrP,yBAClE1E,SAAO,EACPE,SAAUsmC,YAIhBhgC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,aACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAACkC,EAAAA,EAAK,KACNlC,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,MACL6Q,KAAK,4BACLnH,YAAY,mBACZzC,MAAOoO,GAASnP,2BAA6B,GAC7CmD,SAAWvC,GAAMC,GAAkB,4BAA6BD,EAAE2C,OAAOxC,OACzE88C,OAAQA,IAAMykC,GAAgB,4BAA6BnzE,GAASnP,2BACpE5E,SAAO,EACPE,SAAUsmC,qBASpBx6B,IAAcD,IAAgB,KAE1BA,IAAgB,KAAOgI,GAASyb,oBAA6D,IAAvCzb,GAASyb,mBAAmBjoB,SAEpFsG,WAAW,KACJkG,GAASyb,oBAA6D,IAAvCzb,GAASyb,mBAAmBjoB,QAC9DwsD,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP4pB,mBAAoB,CAAC,CACnB5f,GAAG,iBAADD,OAAmBqT,KAAKC,OAC1BoP,MAAO,GACPmjC,SAAU,IACV2a,SAAU,KACV79C,aAAc,GACd22B,UAAW,KACX12B,WAAY,SAIjB,MAEE,KAET/rB,EAAAA,GAAAA,MAAC3H,GAAW,CAAC,eAAa,UAAS0H,SAAA,EACjCC,EAAAA,GAAAA,MAAC0D,GAAa,CACZ6oC,aAAcq5B,GAAgB,WAC9B5uD,SAAUvJ,GAAgB,WAAW1N,SAAA,EAErCC,EAAAA,GAAAA,MAACzH,GAAY,CAACg0C,aAAcq5B,GAAgB,WAAW7lE,SAAA,EACrDD,EAAAA,GAAAA,KAAC4L,GAAW,CAAC6gC,aAAcq5B,GAAgB,WAAW7lE,UACpDD,EAAAA,GAAAA,KAAC8M,EAAAA,EAAO,MACI,wBAGbozB,KAA6BgpC,KAC5BlpE,EAAAA,GAAAA,KAACqtC,GAAW,CAAC3sC,MAAM,oGAAqET,SAAC,wCAK7FC,EAAAA,GAAAA,MAACitC,GAAe,CAAAltC,SAAA,EAEdC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVc,SAAU,WACVoW,WAAY,MACZ/W,MAAO,UACPoB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACL9J,SAAA,EACAC,EAAAA,GAAAA,MAAA,QAAAD,SAAA,CAAM,iBAAesqE,GAAW4I,eAAe,SAAS,cACvD1I,GAAW,IACVzqE,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACXG,MAAOupE,GAAaE,GAAW,UAAY,UAC3C9oE,SAAU,UACVb,QAAS,UACTM,aAAc,MACdkiE,gBAAiBiH,GAAaE,GAAW,UAAY,UACrDtpE,OAAO,aAADkI,OAAekhE,GAAaE,GAAW,UAAY,YACzDxqE,SACCsqE,GAAaE,GAAQ,IAAAphE,QACbkhE,GAAaE,IAAU0I,eAAe,SAAQ,yBAAA9pE,QAC/CohE,GAAWF,IAAY4I,eAAe,SAAQ,4BAK5DnzE,EAAAA,GAAAA,KAACgtC,GAAY,CACXE,UAAWljB,GAAckD,QACzBuf,aAAcq5B,GAAgB,WAC9B3lE,QAASA,IAAM03B,GAAc,WAC7Bh3B,MAAO,CAAE84F,OAAQ,WAAY15F,UAE7BD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM26F,EAAAA,eAI7B/6F,EAAAA,GAAAA,MAACqtC,GAAc,CAACL,UAAWljB,GAAckD,QAAQjtB,SAAA,EAC/CD,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EACvCC,EAAAA,GAAAA,MAACiuC,GAAc,CAAAluC,SAAA,EACbD,EAAAA,GAAAA,KAACquC,GAAS,CAACj1C,UAAQ,EAAA6G,SAAC,eACpBD,EAAAA,GAAAA,KAACuuC,GAAiB,CAChBn2C,KAAK,SACLq2C,WAAYhhC,GAASwb,oBACrB9oB,QAASA,IAAMhB,GAAkB,sBAAuB,IACxDuB,MAAM,wBAAeT,UAErBD,EAAAA,GAAAA,KAACsI,EAAAA,EAAC,CAACF,KAAM,WAGbpI,EAAAA,GAAAA,KAACk7F,GAAkB,CACjB77F,MAAOoO,GAASwb,oBAChBxnB,SAAW05F,GAAkBh8F,GAAkB,sBAAuBg8F,GACtEh/C,OAAQA,CAAC/8C,EAAOC,IAAUuhF,GAAgB,sBAAuBvhF,GACjE+jB,QAASo/C,GACT1gE,YAAY,gCACZ1C,MAAM,sBACNkB,MAAMN,EAAAA,GAAAA,KAAC8M,EAAAA,EAAO,IACdlT,SAAUsmC,GACVvmC,WAAY6T,GAAiByb,oBAC7B7vB,UAAU,EACV62B,SAAS,EACT+jE,eAAgBA,GAChBqH,eAAgBA,CAACpH,EAAQ70F,IAAU60F,EAAOl7E,WAAak7E,EAAO50F,OAAS40F,EAAOr7E,KAAOq7E,EAAO3qF,IAAM2qF,IAEnGzmF,GAAiByb,sBAChBjpB,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiByb,4BAMnC/oB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAACa,UAAW,UAAUzB,SAAA,EAChCD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVuB,QAAS,OACTw6F,eAAgB,gBAChB56B,WAAY,SACZ/pD,aAAc,QACdhY,UACAC,EAAAA,GAAAA,MAAA,MAAIW,MAAO,CAACiX,OAAQ,EAAGnW,SAAU,OAAQoW,WAAY,MAAO/W,MAAO,WAAWf,SAAA,CAAC,+BAC1DD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAACG,MAAO,WAAWf,SAAC,WAIvDuN,GAAiB0b,qBAChBlpB,EAAAA,GAAAA,KAAClF,GAAS,CAAC+F,MAAO,CAACoX,aAAc,QAAQhY,SAAEuN,GAAiB0b,sBAG5Dzb,GAASyb,oBAAsB,IAAI5nB,IAAI,CAACsqB,EAASC,KACjD3rB,EAAAA,GAAAA,MAAA,OAAsBW,MAAO,CAC3BM,OAAQ,oBACRC,aAAc,MACdN,QAAS,OACTmX,aAAc,OACd/W,WAAY,WACZjB,SAAA,EACAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACTw6F,eAAgB,gBAChB56B,WAAY,SACZ/pD,aAAc,QACdhY,SAAA,EACAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAACuB,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,OAAQo4D,KAAM,GAAGliE,SAAA,EACxEC,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CAACkX,WAAY,MAAO/W,MAAO,UAAWoB,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,UAAU9J,SAAA,EACvGD,EAAAA,GAAAA,KAAClJ,EAAY,CAACsR,KAAM,GAAIvH,MAAO,CAAEG,MAAO,aAAe,gBAC9C6qB,EAAQ,EAAE,IAAY,IAAVA,IAAe7rB,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAACG,MAAO,WAAWf,SAAC,SAItEwF,IAAgB,GAAK,MAEpB,MAAMw5E,EAAiBhlE,GAAmBI,KAAKC,GAAOA,EAAIvB,YAActL,GAAS4L,oBAAsBiB,EAAI1B,MAAQnL,GAAS4L,oBACtH9b,GAAsB,OAAd0hF,QAAc,IAAdA,OAAc,EAAdA,EAAgB1kE,eAA6B,OAAd0kE,QAAc,IAAdA,OAAc,EAAdA,EAAgB1hF,QAAS,GAGtE,OAFwBA,EAAMoC,SAAS,cAAgBpC,EAAMoC,SAAS,qBAAeX,MAAMC,QAAQwO,GAAS+L,SAAW/L,GAAS+L,OAAOvY,OAAS,GAK9If,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAACshE,KAAM,EAAGsB,YAAa,SAAUrhE,QAAS,OAAQg2F,cAAe,SAAUruF,IAAK,WAAY,wBAAkB9J,SAAA,EACxHD,EAAAA,GAAAA,KAACk7F,GAAkB,CACjB77F,MAAOusB,EAAQymD,OAAS,GACxB5wE,SAAW05F,GAAkBjT,GAAct8D,EAAQtiB,GAAI,QAAS6xF,GAChE/3E,QAAS44C,GACTl6D,YACG2L,GAASnE,GAEuB,IAA7B0yD,GAAkB/6D,OAChB,kCACA,kBAHF,+BAKN7B,MAAK,WAAAiK,OAAauiB,EAAQtiB,GAAE,OAC5B1P,SAAUsmC,KAA6BzyB,GAASnE,GAChD3P,WAAY6T,GAAiB,WAADnE,OAAYwiB,EAAK,QAC7CzyB,UAAU,EACV86D,iBAAkBA,GAClB5zD,MAAMN,EAAAA,GAAAA,KAAC+B,EAAAA,EAAI,IACXiyF,eAAgBA,GAChBqH,eAAiBpH,GAAWA,EAAO3qF,KAEpCkE,GAAiB,WAADnE,OAAYwiB,EAAK,UAChC7rB,EAAAA,GAAAA,KAAClF,GAAS,CAAC+F,MAAO,CAACc,SAAU,SAAUD,UAAW,UAAUzB,SACzDuN,GAAiB,WAADnE,OAAYwiB,EAAK,aA1Bd,IA+B7B,EArCqB,OAyCtBpe,GAASyb,oBAAsB,IAAIjoB,OAAS,IAC5CjB,EAAAA,GAAAA,KAACu1C,GAAgB,CACfn9C,KAAK,SACL+H,QAAS+/B,QAA2B/lB,EAAY,KAAMujF,OAniNvDp0F,EAmiNqEsiB,EAAQtiB,SAliN3EmE,GAASyb,oBAAsB,IACnCjoB,QAAU,IAE7BwsD,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP4pB,oBAAqB5pB,EAAK4pB,oBAAsB,IAAItpB,OAAO6kE,GAAKA,EAAEn7D,KAAOA,MAI3E/B,WAAW,IAAM+5D,IAAU,GAAO,OAVbh4D,OAoiNC1P,SAAUsmC,GACVx/B,MAAOw/B,GAA2B,iCAA2B,sBAC7Dr/B,MAAO,CAAEgsC,QAAS3M,GAA2B,GAAM,EAAGy5D,OAAQz5D,GAA2B,cAAgB,WAAYjgC,UAErHD,EAAAA,GAAAA,KAAC8J,EAAAA,EAAK,CAAC1B,KAAM,WAKnBpI,EAAAA,GAAAA,KAACpH,GAAO,CAACiI,MAAO,CAACoX,aAAc,QAAQhY,UACrCC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EACvCD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,sBAChBC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAACu7F,EAAAA,EAAQ,KACTv7F,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL0J,YAAY,gCACZzC,MAAOusB,EAAQG,MACftqB,SAAWvC,GAAMgpF,GAAct8D,EAAQtiB,GAAI,QAASpK,EAAE2C,OAAOxC,OAC7D88C,OAAQA,IAAMykC,GAAgB,WAADv3E,OAAYwiB,EAAK,UAAUD,EAAQG,OAChEpyB,WAAY6T,GAAiB,WAADnE,OAAYwiB,EAAK,WAC7CnyB,SAAS,EACTE,SAAUsmC,QAGb1yB,GAAiB,WAADnE,OAAYwiB,EAAK,aAChC7rB,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiB,WAADnE,OAAYwiB,EAAK,mBAKnD3rB,EAAAA,GAAAA,MAACtH,GAAO,CAACiI,MAAO,CAACi7F,oBAAqB,eAAgB/xF,IAAK,OAAQi4D,WAAY,OAAO/hE,SAAA,EACpFC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,kBAChBD,EAAAA,GAAAA,KAACk8C,GAAa,CACZnmC,UAAS,WAAA1M,OAAawiB,EAAK,iBAC3BxsB,MAAOusB,EAAQI,cAAgB,GAC/BvqB,SAAUA,CAACrC,EAAOC,IAAU6oF,GAAct8D,EAAQtiB,GAAI,eAAgBjK,GACtE88C,OAAQA,CAAC/8C,EAAOC,IAAUuhF,GAAgB,WAADv3E,OAAYwiB,EAAK,iBAAiBxsB,GAC3EzF,SAAUsmC,GACVp+B,YAAY,OACZnI,WAAY6T,GAAiB,WAADnE,OAAYwiB,EAAK,oBAE9Cre,GAAiB,WAADnE,OAAYwiB,EAAK,oBAChC7rB,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiB,WAADnE,OAAYwiB,EAAK,wBAIjD3rB,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,SACPC,EAAAA,GAAAA,MAAA,UACEb,MAAOusB,EAAQ+2B,UACflhD,SAAWvC,GAAMgpF,GAAct8D,EAAQtiB,GAAI,YAAapK,EAAE2C,OAAOxC,OACjE88C,OAAQA,IAAMykC,GAAgB,WAADv3E,OAAYwiB,EAAK,cAAcD,EAAQ+2B,WACpE/oD,SAAUsmC,GACVr/B,MAAO,CACLC,QAAS,UACTK,OAAQ,oBACRC,aAAc,MACdO,SAAU,WACV2hE,gBAAiB,QACjB9sE,MAAO,QACPyJ,SAAA,EAEFD,EAAAA,GAAAA,KAAA,UAAQX,MAAM,KAAIY,SAAC,SACnBD,EAAAA,GAAAA,KAAA,UAAQX,MAAM,KAAIY,SAAC,eAIvBC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,gBAChBD,EAAAA,GAAAA,KAACk8C,GAAa,CACZnmC,UAAS,WAAA1M,OAAawiB,EAAK,eAC3BxsB,MAAOusB,EAAQK,YAAc,GAC7BxqB,SAAUA,CAACrC,EAAOC,IAAU6oF,GAAct8D,EAAQtiB,GAAI,aAAcjK,GACpE88C,OAAQA,CAAC/8C,EAAOC,IAAUuhF,GAAgB,WAADv3E,OAAYwiB,EAAK,eAAexsB,GACzEzF,SAAUsmC,GACVp+B,YAAY,OACZnI,WAAY6T,GAAiB,WAADnE,OAAYwiB,EAAK,kBAE9Cre,GAAiB,WAADnE,OAAYwiB,EAAK,kBAChC7rB,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiB,WAADnE,OAAYwiB,EAAK,yBAMnD3rB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEa,UAAW,QAASzB,SAAA,CAC/B,MAEC,MAAMmkE,EAAuBvB,GAE7B,OACE3iE,EAAAA,GAAAA,MAAA,UACE9H,KAAK,SACL+H,QAASA,KAEFikE,GACH/P,GAAyB/0D,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACxBD,GAAI,IACP,CAACssB,EAAQtiB,KAAMhK,EAAKssB,EAAQtiB,QAIlC1P,SAAUsmC,IAA4BkkC,EACtCvjE,MAAO,CACLuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLjJ,QAAS,WACTI,WAAY,cACZC,OAAQ,OACRH,MAAOojE,EAAuB,UAAY,UAC1CziE,SAAU,WACVoW,WAAYqsD,EAAuB,MAAQ,MAC3Cu1B,OAASz5D,IAA4BkkC,EAAwB,cAAgB,UAC7Ev3B,QAAS3M,GAA2B,GAAM,EAC1Cq4D,WAAY,cAEdoF,YAAcz+F,IAAOghC,KAA6BkkC,IAAyBllE,EAAEyU,cAAc9S,MAAMG,MAAQ,WACzG48F,WAAa1+F,IAAOghC,KAA6BkkC,IAAyBllE,EAAEyU,cAAc9S,MAAMG,MAAQ,WAAWf,SAAA,EAEjHmkE,IACApkE,EAAAA,GAAAA,KAAA,OACExJ,MAAM,KACNC,OAAO,KACP+S,QAAQ,YACRC,KAAK,OACLC,OAAO,eACPC,YAAY,IACZ9I,MAAO,CACLo5F,UAAW7lC,GAAsBxoC,EAAQtiB,IAAM,iBAAmB,eAClEivF,WAAY,kBACZt4F,UAEFD,EAAAA,GAAAA,KAAA,YAAU69F,OAAO,qBAEnB,gDACsBz5B,GAAwBpkE,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAACG,MAAO,WAAWf,SAAC,MAAY,mBAGlG,EArDA,GAuDAm0D,GAAsBxoC,EAAQtiB,KAAO,MAEpC,MAAM86D,EAAuBvB,GAE7B,OACE3iE,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVa,UAAW,UACXZ,QAAS,OACTI,WAAYkjE,EAAuB,UAAY,UAC/ChjE,aAAc,MACdD,OAAQijE,EAAuB,oBAAsB,sBACrDnkE,SAAA,EACAC,EAAAA,GAAAA,MAACtH,GAAO,CAACiI,MAAO,CAACi7F,oBAAqB,eAAe77F,SAAA,EACnDC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRC,EAAAA,GAAAA,MAACjH,GAAK,CAAAgH,SAAA,CAAC,WAAMmkE,IAAwBpkE,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAACG,MAAO,WAAWf,SAAC,UACtEC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAAC1J,EAAAA,EAAM,CAAC8R,KAAM,MACdpI,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAI,WAAAI,OAAawiB,EAAK,aACtB/pB,YAAY,aACZzC,MAAOusB,EAAQ04C,UAAY,GAC3B7iE,SAAWvC,GAAMgpF,GAAct8D,EAAQtiB,GAAI,WAAYpK,EAAE2C,OAAOxC,OAChE88C,OAAQA,IAAMykC,GAAgB,WAADv3E,OAAYwiB,EAAK,aAAaD,EAAQ04C,UACnE1qE,SAAUsmC,GACVvmC,WAAY6T,GAAiB,WAADnE,OAAYwiB,EAAK,cAC7ChrB,MAAO,CAAEi9F,YAAa,eAGzBtwF,GAAiB,WAADnE,OAAYwiB,EAAK,gBAChC7rB,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiB,WAADnE,OAAYwiB,EAAK,oBAIjD3rB,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRC,EAAAA,GAAAA,MAACjH,GAAK,CAAAgH,SAAA,CAAC,UAAQmkE,IAAwBpkE,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAACG,MAAO,WAAWf,SAAC,UACxEC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAAC1J,EAAAA,EAAM,CAAC8R,KAAM,MACdpI,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAI,WAAAI,OAAawiB,EAAK,eACtB/pB,YAAY,YACZzC,MAAOusB,EAAQ24C,YAAc,GAC7B9iE,SAAWvC,GAAMgpF,GAAct8D,EAAQtiB,GAAI,aAAcpK,EAAE2C,OAAOxC,OAClE88C,OAAQA,IAAMykC,GAAgB,WAADv3E,OAAYwiB,EAAK,eAAeD,EAAQ24C,YACrE3qE,SAAUsmC,GACVvmC,WAAY6T,GAAiB,WAADnE,OAAYwiB,EAAK,gBAC7ChrB,MAAO,CAAEi9F,YAAa,eAGzBtwF,GAAiB,WAADnE,OAAYwiB,EAAK,kBAChC7rB,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiB,WAADnE,OAAYwiB,EAAK,sBAIjD3rB,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRC,EAAAA,GAAAA,MAACjH,GAAK,CAAAgH,SAAA,CAAC,eAAUmkE,IAAwBpkE,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAACG,MAAO,WAAWf,SAAC,UAC1EC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAAC1J,EAAAA,EAAM,CAAC8R,KAAM,MACdpI,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAI,WAAAI,OAAawiB,EAAK,iBACtB/pB,YAAY,iBACZzC,MAAOusB,EAAQ44C,cAAgB,GAC/B/iE,SAAWvC,GAAMgpF,GAAct8D,EAAQtiB,GAAI,eAAgBpK,EAAE2C,OAAOxC,OACpE88C,OAAQA,IAAMykC,GAAgB,WAADv3E,OAAYwiB,EAAK,iBAAiBD,EAAQ44C,cACvE5qE,SAAUsmC,GACVvmC,WAAY6T,GAAiB,WAADnE,OAAYwiB,EAAK,kBAC7ChrB,MAAO,CAAEi9F,YAAa,eAGzBtwF,GAAiB,WAADnE,OAAYwiB,EAAK,oBAChC7rB,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiB,WAADnE,OAAYwiB,EAAK,2BAKnD7rB,EAAAA,GAAAA,KAACpH,GAAO,CAACiI,MAAO,CAACi7F,oBAAqB,OAAO77F,UAC3CC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,4BACPD,EAAAA,GAAAA,KAAC4uC,GAAQ,CACP3lC,KAAI,WAAAI,OAAawiB,EAAK,wBACtB/pB,YAAY,6DACZzC,MAAOusB,EAAQgY,UAAY,GAC3BniC,SAAWvC,GAAMgpF,GAAct8D,EAAQtiB,GAAI,WAAYpK,EAAE2C,OAAOxC,OAChE88C,OAAQA,IAAMykC,GAAgB,WAADv3E,OAAYwiB,EAAK,wBAAwBD,EAAQgY,UAC9EhqC,SAAUsmC,GACV69D,KAAM,WAMjB,EA7FqC,QAhNhCnyE,EAAQtiB,MAmTlB42B,KACAhgC,EAAAA,GAAAA,MAAA,UACE9H,KAAK,SACL+H,QAnzNC69F,KACjBvwC,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP4pB,mBAAoB,IACd5pB,EAAK4pB,oBAAsB,GAC/B,CACE5f,GAAIoT,KAAKC,MACToP,MAAO,GACPC,aAAc,GACd22B,UAAW,KACX12B,WAAY,GAEZq4C,SAAU,GACVC,WAAY,GACZC,aAAc,GACd5gC,SAAU,GAEVyuC,MAAO,UAMb9qE,WAAW,IAAM+5D,IAAU,GAAO,MA6xNlBzgE,MAAO,CACLrK,MAAO,OACPkL,UAAW,OACXZ,QAAS,OACTI,WAAY,cACZC,OAAQ,qBACRC,aAAc,MACdJ,MAAO,UACPW,SAAU,WACVoW,WAAY,MACZ4hF,OAAQ,UACRv3F,QAAS,OACT4/D,WAAY,SACZ46B,eAAgB,SAChB7yF,IAAK,SACLwuF,WAAY,iBAEdoF,YAAcz+F,IACZA,EAAEyU,cAAc9S,MAAMK,WAAa,UACnChC,EAAEyU,cAAc9S,MAAM6L,YAAc,WAEtCkxF,WAAa1+F,IACXA,EAAEyU,cAAc9S,MAAMK,WAAa,cACnChC,EAAEyU,cAAc9S,MAAM6L,YAAc,WACpCzM,SAAA,EAEFD,EAAAA,GAAAA,KAAC4J,EAAAA,EAAI,CAACxB,KAAM,MACZpI,EAAAA,GAAAA,KAAA,QAAAC,SAAM,kDAKZD,EAAAA,GAAAA,KAACpH,GAAO,CAACiI,MAAO,CAACa,UAAW,UAAUzB,UACpCC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EACvCD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,kBACPD,EAAAA,GAAAA,KAAC4uC,GAAQ,CACP3lC,KAAK,sBACLnH,YAAY,oDACZzC,MAAOoO,GAASq1C,qBAAuB,GACvCrhD,SAAWvC,GAAMC,GAAkB,sBAAuBD,EAAE2C,OAAOxC,OACnE88C,OAASj9C,GAAM0hF,GAAgB,sBAAuB1hF,EAAE2C,OAAOxC,OAC/DzF,SAAUsmC,GACV69D,KAAM,gBAShB79F,EAAAA,GAAAA,MAAC3H,GAAW,CAAC,eAAa,kBAAiB0H,SAAA,EACzCC,EAAAA,GAAAA,MAAC0D,GAAa,CACZ6oC,aAAcq5B,GAAgB,mBAC9B5uD,SAAUvJ,GAAgB,mBAAmB1N,SAAA,EAE7CC,EAAAA,GAAAA,MAACzH,GAAY,CAACg0C,aAAcq5B,GAAgB,mBAAmB7lE,SAAA,EAC7DD,EAAAA,GAAAA,KAAC4L,GAAW,CAAC6gC,aAAcq5B,GAAgB,mBAAmB7lE,UAC5DD,EAAAA,GAAAA,KAAC+M,EAAAA,EAAQ,MACG,6CAGbmzB,KAA6BgpC,KAC5BlpE,EAAAA,GAAAA,KAACqtC,GAAW,CAAC3sC,MAAM,oGAAqET,SAAC,wCAK7FD,EAAAA,GAAAA,KAACmtC,GAAe,CAAAltC,UACdD,EAAAA,GAAAA,KAACgtC,GAAY,CACXE,UAAWljB,GAAcmD,gBACzBsf,aAAcq5B,GAAgB,mBAC9B3lE,QAASA,IAAM03B,GAAc,mBAC7Bh3B,MAAO,CAAE84F,OAAQ,WAAY15F,UAE7BD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM26F,EAAAA,cAI7B/6F,EAAAA,GAAAA,MAACqtC,GAAc,CAACL,UAAWljB,GAAcmD,gBAAgBltB,SAAA,EACvDC,EAAAA,GAAAA,MAACtH,GAAO,CAACiI,MAAO,CAACi7F,oBAAqB,WAAW77F,SAAA,EAC/CC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,qDACPD,EAAAA,GAAAA,KAACu9C,GAAU,CACTxnC,UAAU,iCACV1W,MAAOoO,GAASw/C,+BAChBxrD,SAAWpC,GAAUF,GAAkB,iCAAkCE,GACzE88C,OAAS98C,GAAUuhF,GAAgB,iCAAkCvhF,GACrEzF,SAAUsmC,GACVvmC,WAAY6T,GAAiBy/C,+BAC7BnrD,YAAY,sBAGhB5B,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,2BACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAAC1J,EAAAA,EAAM,KACP0J,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,eACLnH,YAAY,+BACZzC,MAAOoO,GAASy/C,cAAgB,GAChCzrD,SAAWvC,GAAMC,GAAkB,eAAgBD,EAAE2C,OAAOxC,OAC5D88C,OAASj9C,GAAM0hF,GAAgB,eAAgB1hF,EAAE2C,OAAOxC,OACxDzF,SAAUsmC,GACVxmC,SAAO,cAKfsG,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EACvCD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,eACPC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAACu7F,EAAAA,EAAQ,KACTv7F,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,SACLnH,YAAY,8CACZzC,MAAOoO,GAAS0/C,QAAU,GAC1B1rD,SAAWvC,GAAMC,GAAkB,SAAUD,EAAE2C,OAAOxC,OACtD88C,OAASj9C,GAAM0hF,GAAgB,SAAU1hF,EAAE2C,OAAOxC,OAClDzF,SAAUsmC,GACVxmC,SAAO,mBAWnBwG,EAAAA,GAAAA,MAAC3H,GAAW,CAAC,eAAa,gBAAe0H,SAAA,EACvCC,EAAAA,GAAAA,MAAC0D,GAAa,CACZ6oC,aAAcq5B,GAAgB,iBAC9B5uD,SAAUvJ,GAAgB,iBAAiB1N,SAAA,EAE3CC,EAAAA,GAAAA,MAACzH,GAAY,CAACg0C,aAAcq5B,GAAgB,iBAAiB7lE,SAAA,EAC3DD,EAAAA,GAAAA,KAAC4L,GAAW,CAAC6gC,aAAcq5B,GAAgB,iBAAiB7lE,UAC1DD,EAAAA,GAAAA,KAAC8M,EAAAA,EAAO,MACI,oCAGbozB,KAA6BgpC,KAC5BlpE,EAAAA,GAAAA,KAACqtC,GAAW,CAAC3sC,MAAM,oGAAqET,SAAC,wCAK7FC,EAAAA,GAAAA,MAACitC,GAAe,CAAAltC,SAAA,CAEbigC,KAA6BgpC,IAAyB7C,KACrDrmE,EAAAA,GAAAA,KAAC0zC,GAAY,CACXvzC,QAAUjB,IACRA,EAAEkB,kBACFu6D,IAA2B,IAE7Bj6D,MAAM,4BAAwBT,UAE9BD,EAAAA,GAAAA,KAACg6F,EAAM,OAGXh6F,EAAAA,GAAAA,KAACgtC,GAAY,CACXE,UAAWljB,GAAcmC,cACzBsgB,aAAcq5B,GAAgB,iBAC9B3lE,QAASA,IAAM03B,GAAc,iBAC7Bh3B,MAAO,CAAE84F,OAAQ,WAAY15F,UAE7BD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM26F,EAAAA,eAI3Bj7F,EAAAA,GAAAA,KAACutC,GAAc,CAACL,UAAWljB,GAAcmC,cAAclsB,UACvDD,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EACvCD,EAAAA,GAAAA,KAAC/G,GAAK,CAAC4H,MAAO,CAAEoX,aAAc,OAAQtW,SAAU,OAAQoW,WAAY,OAAQ9X,SAAC,wCAK7EC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,OACLjJ,QAAS,OACTK,OAAQ,oBACRC,aAAc,MACdkiE,gBAAiB71D,GAAS+kB,cAAgB,UAAY,UACtDva,aAAc,OACd40B,QAAU3M,IAA4B5G,IAAoBp8B,GAAY,GAAM,GAC5E+C,SAAA,EACAC,EAAAA,GAAAA,MAAA,SAAOW,MAAO,CACZuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACLpI,SAAU,OACVoW,WAAY,MACZ4hF,OAASz5D,IAA4B5G,IAAoBp8B,GAAY,cAAgB,UACrF8D,MAAOyM,GAAS+kB,cAAgB,UAAY,WAC5CvyB,SAAA,EACAD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,WACL6Q,KAAK,gBACLzH,QAASiM,GAAS+kB,gBAAiB,EACnC54B,SAAUsmC,IAA4B5G,IAAoBp8B,GAC1DuE,SAAWvC,IACT,MAAM++F,EAAY/+F,EAAE2C,OAAOL,QAGvBy8F,IACF9+F,GAAkB,mBAAmB,GACrCA,GAAkB,eAAgB,IAClCA,GAAkB,wBAAyB,IAC3CA,GAAkB,qBAAsB,IACxCA,GAAkB,iBAAkB,KAItCA,GAAkB,gBAAiB8+F,IAErCp9F,MAAO,CACLrK,MAAO,OACPC,OAAQ,OACRsmG,YAAa,cAGjB/8F,EAAAA,GAAAA,KAAC8M,EAAAA,EAAO,CAAC1E,KAAM,KAAM,cAEpBqF,GAAS+kB,gBACRxyB,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACX2iE,WAAY,SACZ7hE,SAAU,WACVX,MAAO,UACP+W,WAAY,OACZ9X,SAAC,eAOLwN,GAAS+kB,eAAiB/kB,GAASklB,eACnCzyB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLy5D,WAAY,QACZvjE,SAAA,EACAD,EAAAA,GAAAA,KAAC/G,GAAK,CAAC4H,MAAO,CAAEiX,OAAQ,EAAGnW,SAAU,YAAa1B,SAAC,YACnDD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAErK,MAAO,SAAUyJ,UAC7BD,EAAAA,GAAAA,KAACu9C,GAAU,CACTxnC,UAAU,iBACV1W,MAAOoO,GAAS0b,eAChB1nB,SAAWpC,GAAUF,GAAkB,iBAAkBE,GACzD88C,OAAS98C,GAAUuhF,GAAgB,iBAAkBvhF,GACrDzF,SAAUsmC,GACVvmC,WAAY6T,GAAiB2b,eAC7BrnB,YAAY,mBAQtB5B,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,OACLjJ,QAAS,OACTK,OAAQ,oBACRC,aAAc,MACdkiE,gBAAiB71D,GAAS2e,gBAAkB,UAAY,UACxDygB,QAAU3M,IAA4B5G,IAAoBp8B,GAAY,GAAM,GAC5E+C,SAAA,EACAC,EAAAA,GAAAA,MAAA,SAAOW,MAAO,CACZuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACLpI,SAAU,OACVoW,WAAY,MACZ4hF,OAASz5D,IAA4B5G,IAAoBp8B,GAAY,cAAgB,UACrF8D,MAAOyM,GAAS2e,gBAAkB,UAAY,WAC9CnsB,SAAA,EACAD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,WACL6Q,KAAK,kBACLzH,QAASiM,GAAS2e,kBAAmB,EACrCxyB,SAAUsmC,IAA4B5G,IAAoBp8B,GAC1DuE,SAAWvC,IACT,MAAM++F,EAAY/+F,EAAE2C,OAAOL,QAGvBy8F,IACF9+F,GAAkB,iBAAiB,GACnCA,GAAkB,iBAAkB,KAItCA,GAAkB,kBAAmB8+F,IAEvCp9F,MAAO,CACLrK,MAAO,OACPC,OAAQ,OACRsmG,YAAa,cAGjB/8F,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAME,EAAAA,IAAS4H,KAAK,OAAO,gBAE3CqF,GAAS2e,kBACRpsB,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACX2iE,WAAY,SACZ7hE,SAAU,WACVX,MAAO,UACP+W,WAAY,OACZ9X,SAAC,eAOLwN,GAAS2e,iBAAmB3e,GAASulB,gBACrC9yB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLy5D,WAAY,QACZvjE,SAAA,EACAD,EAAAA,GAAAA,KAAC/G,GAAK,CAAC4H,MAAO,CAAEiX,OAAQ,EAAGnW,SAAU,YAAa1B,SAAC,YACnDD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAErK,MAAO,SAAUyJ,UAC7BD,EAAAA,GAAAA,KAACu9C,GAAU,CACTxnC,UAAU,eACV1W,MAAOoO,GAASulB,aAChBvxB,SAAWpC,GAAUF,GAAkB,eAAgBE,GACvD88C,OAAS98C,GAAUuhF,GAAgB,eAAgBvhF,GACnDzF,SAAUsmC,GACVvmC,WAAY6T,GAAiBwlB,aAC7BlxB,YAAY,6BAQrB2L,GAAS2e,kBACRlsB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEa,UAAW,QAASzB,SAAA,EAChCC,EAAAA,GAAAA,MAACjH,GAAK,CAAC4H,MAAO,CAAEoX,aAAc,UAAWhY,SAAA,CAAC,+BAExCD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEG,MAAO,UAAWwiE,WAAY,WAAYvjE,SAAC,UAE5DD,EAAAA,GAAAA,KAAC4uC,GAAQ,CACP3lC,KAAK,wBACLnH,YAAY,2DACZzC,MAAOoO,GAAS4b,uBAAyB,GACzC5nB,SAAWvC,GAAMC,GAAkB,wBAAyBD,EAAE2C,OAAOxC,OACrE88C,OAASj9C,GAAM0hF,GAAgB,wBAAyB1hF,EAAE2C,OAAOxC,OACjE0+F,KAAM,EACNl9F,MAAO,CACLM,OAAQ,oBACRmiE,gBAAiB,aAGpB91D,GAAiB6b,wBAChBrpB,EAAAA,GAAAA,KAAClF,GAAS,CAAC+F,MAAO,CAAEa,UAAW,UAAWzB,SAAEuN,GAAiB6b,2BAKlE7b,GAAiB2b,iBAChBnpB,EAAAA,GAAAA,KAAClF,GAAS,CAAC+F,MAAO,CAAEa,UAAW,UAAWzB,SAAEuN,GAAiB2b,iBAE9D3b,GAAiBwlB,eAChBhzB,EAAAA,GAAAA,KAAClF,GAAS,CAAC+F,MAAO,CAAEa,UAAW,UAAWzB,SAAEuN,GAAiBwlB,eAI9DvlB,GAAS+kB,eACRxyB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVa,UAAW,OACXZ,QAAS,eACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdJ,MAAO,UACPW,SAAU,YACV1B,UACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,OAAQ9X,SAC/BwN,GAASklB,aAAellB,GAASolB,eAAiB+J,GAAiBnvB,GAASukB,kBAAmB,aAE9F9xB,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CAAE,yCAEAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEa,UAAW,UAAWC,SAAU,WAAYoW,WAAY,UAAW9X,SAAA,EAC/ED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,0BAAwB,IAAE,MAEhC,MAAM2oC,EAAUn7B,GAASklB,YAAYI,MAAM,KAAK,IACzCsW,EAAME,EAAOG,GAAOd,EAAQ7V,MAAM,KACzC,MAAM,GAAN1pB,OAAUqgC,EAAG,MAAArgC,OAAKkgC,EAAK,MAAAlgC,OAAKggC,EAC7B,EALiC,GAK7B,YAAGrpC,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,aAAiB,IAAE4qE,GAAgBp9D,GAASolB,qBAG9DplB,GAAS0b,eACX,gEAAA9f,QACgDmtF,EAAAA,GAAAA,IAAe,IAAI95E,KAAKjP,GAAS0b,kBAEjF,kFAKJ1b,GAAS2e,iBACXpsB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVa,UAAW,OACXZ,QAAS,eACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdJ,MAAO,UACPW,SAAU,YACV1B,UACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,OAAQ9X,SAC/BwN,GAASklB,aAAellB,GAASolB,eAAiB+J,GAAiBnvB,GAASukB,kBAAmB,eAE9F9xB,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CAAE,2CAEAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEa,UAAW,SAAUC,SAAU,WAAYoW,WAAY,UAAW9X,SAAA,EAC9ED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,4BAA0B,IAAEwN,GAASklB,YAC5C,YACD3yB,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,eAAmB,IAAE4qE,GAAgBp9D,GAASolB,kBAEvDplB,GAAS4b,wBACRnpB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEa,UAAW,SAAUC,SAAU,WAAYoW,WAAY,UAAW9X,SAAA,EAC9ED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,iCAA0B,IAAEwN,GAAS4b,6BAMnDnpB,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CAAE,2CAC8BwN,GAASulB,aAAY,OAAA3pB,QAAUmtF,EAAAA,GAAAA,IAAe,IAAI95E,KAAKjP,GAASulB,gBAAmB,qBAChHvlB,GAAS4b,wBACRnpB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEa,UAAW,SAAUC,SAAU,WAAYoW,WAAY,UAAW9X,SAAA,EAC9ED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,iCAA0B,IAAEwN,GAAS4b,gCAOvD,gBAOV3jB,IAAcD,IAAgB,IAAMm3B,GAAiBnvB,GAASukB,kBAAmB,eAAiBvkB,GAAS+kB,gBAAkB/kB,GAAS2e,kBACtIlsB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACViX,OAAQ,SACRhX,QAAS,eACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdJ,MAAO,WACPf,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAOE,aAAc,SAAU7V,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,UAAW9J,SAAC,+DAGjHD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,YAAa1B,SAAC,kLAOxCyF,IAAcD,IAAgB,KAAOgI,GAAS2e,kBAC9ClsB,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CAKG,MACC,MAAMi+F,EAAaz4F,IAAgB,EAC7B04F,EAAgBvhE,GAAiBnvB,GAASukB,kBAAmB,aAC5C4K,GAAiBnvB,GAASukB,kBAAmB,aAGpE,OAFmBksE,GAAcC,CAGlC,EAPA,KAQDj+F,EAAAA,GAAAA,MAAC3H,GAAW,CAAC,eAAa,uBAAsB0H,SAAA,EAC9CC,EAAAA,GAAAA,MAAC0D,GAAa,CACZ6oC,aAAcq5B,GAAgB,wBAC9B5uD,SAAUvJ,GAAgB,wBAAwB1N,SAAA,EAElDC,EAAAA,GAAAA,MAACzH,GAAY,CAACg0C,aAAcq5B,GAAgB,wBAAwB7lE,SAAA,EAClED,EAAAA,GAAAA,KAAC4L,GAAW,CAAC6gC,aAAcq5B,GAAgB,wBAAwB7lE,UACjED,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMG,EAAAA,QACX,yCAGb+nE,KAAsBU,KACrBlpE,EAAAA,GAAAA,KAACqtC,GAAW,CAAC3sC,MAAM,0JAAyHT,SAAC,wCAKjJC,EAAAA,GAAAA,MAACitC,GAAe,CAAAltC,SAAA,CAEbuoE,KAAsBU,IAAyBn7D,KAC9C/N,EAAAA,GAAAA,KAAC0zC,GAAY,CACXvzC,QAAUjB,IACRA,EAAEkB,kBACF26D,IAA8B,IAEhCr6D,MAAM,6CAAyCT,UAE/CD,EAAAA,GAAAA,KAACg6F,EAAM,OAIXh6F,EAAAA,GAAAA,KAACgtC,GAAY,CACXE,UAAWljB,GAAcuU,qBACzBkO,aAAcq5B,GAAgB,wBAC9B3lE,QAASA,IAAM03B,GAAc,wBAC7Bh3B,MAAO,CAAE84F,OAAQ,WAAY15F,UAE7BD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM26F,EAAAA,eAI7B/6F,EAAAA,GAAAA,MAACqtC,GAAc,CAACL,UAAWljB,GAAcuU,qBAAsB,eAAa,uBAAsBt+B,SAAA,EAChGD,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EAEvCC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,OACLjJ,QAAS,OACTK,OAAQ,oBACRC,aAAc,MACdkiE,gBAAoE,SAAhB,QAAnCpf,EAAAz2C,GAAS6b,kCAA0B,IAAA46B,OAAA,EAAnCA,EAAqC1vB,WAAsB,UAAY,UACxFvc,aAAc,QACdhY,SAAA,EACAD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACXc,SAAU,OACVoW,WAAY,MACZ/W,MAAO,WACPf,SAAC,uCAGHD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEuB,QAAS,OAAQ2H,IAAK,QAAS9J,SAC1C,CAAC,MAAO,MAAMqB,IAAI2yF,IAAM,IAAAmK,EAAAC,EAAA,OACvBn+F,EAAAA,GAAAA,MAAA,SAAoBW,MAAO,CACzBuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLjJ,QAAS,cACTK,OAAQ,oBACRC,aAAc,MACdu4F,OAAQ/wB,GAA8B,cAAgB,UACtDtF,iBAAoD,QAAnC86B,EAAA3wF,GAAS6b,kCAA0B,IAAA80E,OAAA,EAAnCA,EAAqC5pE,aAAcy/D,EAAS,UAAY,OACzFpnD,QAAS+7B,GAA8B,GAAM,EAC7C7wD,WAAY,OACZ9X,SAAA,EACAD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,QACL6Q,KAAK,uBACL5J,MAAO40F,EACPzyF,SAA4C,QAAnC68F,EAAA5wF,GAAS6b,kCAA0B,IAAA+0E,OAAA,EAAnCA,EAAqC7pE,aAAcy/D,EAC5Dr6F,SAAUgvE,GACVnnE,SAAUA,OACVtB,QAAUjB,IAAO,IAADo/F,EAAAC,EAEd,IAAIzhD,EAIFA,GALsD,QAAtCwhD,EAAG7wF,GAAS6b,kCAA0B,IAAAg1E,OAAA,EAAnCA,EAAqC9pE,aAIrCt1B,EAAE2C,OAAOxC,MACjB,GAEAH,EAAE2C,OAAOxC,MAGtB,MAAM+iB,GAAO7iB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACRkO,GAAS6b,4BAA0B,IACtCkL,UAAWsoB,EACXroB,QAAsB,QAAbqoB,IAAwD,QAAnCyhD,EAAA9wF,GAAS6b,kCAA0B,IAAAi1E,OAAA,EAAnCA,EAAqC9pE,UAAgB,GACnFC,OAAqB,QAAbooB,EAAqB,UAAY,KAE3C39C,GAAkB,6BAA8BijB,GAG/B,QAAb06B,GAAsBh1C,IACxB3I,GAAkB,wBAAyB2I,IAC3ComD,GAAY,OAAQ,YAAa,qBAAqB,+CAAD7kD,OAAiDvB,MAChF,QAAbg1C,IACT39C,GAAkB,wBAAyB,MAC3C+uD,GAAY,OAAQ,YAAa,kBAAkB,iEAGvDrtD,MAAO,CAAE84F,OAAQ,aAElB1F,IAjDSA,UAwDkC,SAAhB,QAAnC9vC,EAAA12C,GAAS6b,kCAA0B,IAAA66B,OAAA,EAAnCA,EAAqC3vB,aACpCx0B,EAAAA,GAAAA,KAAA0W,GAAAA,SAAA,CAAAzW,UACEC,EAAAA,GAAAA,MAACtH,GAAO,CAAAqH,SAAA,EAENC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,8BAChBD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVuB,QAAS,OACTg2F,cAAe,SACfruF,IAAK,SACLrI,UAAW,UACXzB,SACC,CACC,CAAEZ,MAAO,QAASnG,MAAO,UACzB,CAAEmG,MAAO,UAAWnG,MAAO,gBAC3B,CAAEmG,MAAO,uBAAwBnG,MAAO,8BACxC,CAAEmG,MAAO,QAASnG,MAAO,WACzBoI,IAAI2yF,IAAW,IAADuK,EAAAC,EACd,MAAMR,IAAYj/F,MAAMC,QAA2C,QAApCu/F,EAAC/wF,GAAS6b,kCAA0B,IAAAk1E,OAAA,EAAnCA,EAAqC/pE,UACjEhnB,GAAS6b,2BAA2BmL,QAAQ90B,SAASs0F,EAAO50F,OAG1D4X,EAAgE,SAAhB,QAAnCwnF,EAAAhxF,GAAS6b,kCAA0B,IAAAm1E,OAAA,EAAnCA,EAAqCjqE,YACtDo0C,IACAtvC,IACAp8B,GAEIwhG,IAAuBlxF,GAAiB8b,2BAE9C,OACEppB,EAAAA,GAAAA,MAAA,SAA0BW,MAAO,CAC/BuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLjJ,QAAS,cACTK,OAAQu9F,EAAqB,oBAAsB,oBACnDt9F,aAAc,MACdu4F,OAAQ1iF,EAAa,cAAgB,UACrCqsD,gBAAiB26B,EAAY,UAAY,OACzCpxD,QAAS51B,EAAa,GAAM,GAC5BhX,SAAA,EACAD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,WACLoJ,QAASy8F,EACTrkG,SAAUqd,EACVxV,SAAWvC,IAAO,IAADy/F,EACf,MAAMC,EAAiB5/F,MAAMC,QAA2C,QAApC0/F,EAAClxF,GAAS6b,kCAA0B,IAAAq1E,OAAA,EAAnCA,EAAqClqE,SACtEhnB,GAAS6b,2BAA2BmL,QACpC,GAEJ,IAAIoqE,EAEFA,EADE3/F,EAAE2C,OAAOL,QACE,IAAIo9F,EAAgB3K,EAAO50F,OAE3Bu/F,EAAeh/F,OAAO88C,GAAOA,IAAQu3C,EAAO50F,OAG3D,MAAM+iB,GAAO7iB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACRkO,GAAS6b,4BAA0B,IACtCmL,QAASoqE,IAILliF,GAAM,IAAID,MAAOsY,cACvBy4B,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACPgqB,2BAA4BlH,EAC5BoH,aAAcq1E,EAAW59F,OAAS,EAAI0b,EAAM,MAE9C+yC,IAAa,IAEf7uD,MAAO,CAAE84F,OAAQ,aAElB1F,EAAO/6F,QA3CE+6F,EAAO50F,WAgDxBmO,GAAiB8b,6BAChBtpB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVG,MAAO,UACPW,SAAU,WACVD,UAAW,SACXqW,WAAY,OACZ9X,SACCuN,GAAiB8b,iCAMxBppB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQg2F,cAAe,SAAUruF,IAAK,QAAS9J,SAAA,CAEhB,SAAhB,QAAnCmkD,GAAA32C,GAAS6b,kCAA0B,IAAA86B,QAAA,EAAnCA,GAAqC5vB,aACtCt0B,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,qBAChBD,EAAAA,GAAAA,KAACu9C,GAAU,CACTxnC,UAAU,eACV1W,MAAOoO,GAAS+b,aAChB/nB,SAAWpC,GAAUF,GAAkB,eAAgBE,GACvD88C,OAAS98C,GAAUuhF,GAAgB,eAAgBvhF,GACnDzF,SACEgvE,IACAtvC,IACAp8B,GAEFvD,WAAY6T,GAAiBgc,aAC7B1nB,YAAY,qBAEb0L,GAAiBgc,eAChBxpB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVG,MAAO,UACPW,SAAU,WACVD,UAAW,SACXqW,WAAY,OACZ9X,SACCuN,GAAiBgc,mBAOxBtpB,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAAEa,UAAW,sBAAuBzB,SAAA,EACpDD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,wBAChBD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVuB,QAAS,OACTg2F,cAAe,SACfruF,IAAK,SACLrI,UAAW,UACXzB,UACAC,EAAAA,GAAAA,MAAA,SAAOW,MAAO,CACZuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLjJ,QAAS,cACTK,OAAQ,oBACRC,aAAc,MACdu4F,OAAQ,UACRr2B,gBAAiB,UACjB5hE,UAAW,OACXzB,SAAA,EACAD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,QACL6Q,KAAK,mBACL5J,MAAM,UACNmC,SAAS,EACT5H,SAAUgvE,IAA+BtvC,IAAoBp8B,GAC7Dy/F,UAAQ,EACR97F,MAAO,CAAE84F,OAAQ,aACjB,eAILnsF,GAAiB+b,gBAChBvpB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVG,MAAO,UACPW,SAAU,WACVD,UAAW,SACXqW,WAAY,OACZ9X,SACCuN,GAAiB+b,2BAUoB,SAAhB,QAAnC86B,GAAA52C,GAAS6b,kCAA0B,IAAA+6B,QAAA,EAAnCA,GAAqC7vB,aACF,QAAnC8vB,GAAA72C,GAAS6b,kCAA0B,IAAAg7B,IAAS,QAATC,GAAnCD,GAAqC7vB,eAAO,IAAA8vB,QAAT,EAAnCA,GAA8CtjD,QAAS,IACpB,QADqBujD,GACxD/2C,GAAS6b,kCAA0B,IAAAk7B,QAAA,EAAnCA,GAAqC9vB,UACpCjnB,GAAS+kB,eACV/sB,GAAe,IACdvF,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVyiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdN,QAAS,OACTY,UAAW,OACXU,QAAS,OACTg2F,cAAe,SACfruF,IAAK,UACL9J,SAAA,EACAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,UAAW9J,SAAA,EACnED,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CACdC,KAAMw+F,EAAAA,IACNj+F,MAAO,CAAEG,MAAO,UAAWW,SAAU,WAEvC3B,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEc,SAAU,WAAYX,MAAO,WAAYf,SAAC,6FAI1DwN,GAAS+b,eACRtpB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,WAAYX,MAAO,UAAWU,UAAW,WAAYzB,SAAA,EAC3ED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,wBAAyB,KAAEu2F,EAAAA,GAAAA,IAAe/oF,GAAS+b,cAC1D/b,GAAS+lB,wBACRtzB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEa,UAAW,WAAYzB,SAAA,EACnCD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,cAAkB,IAAE4qE,GAAgBp9D,GAAS+lB,qCAYpEoJ,GAAiBnvB,GAASukB,kBAAmB,cAAgBvkB,GAAS+lB,uBAAyB/lB,GAAS+b,cACvGtpB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVyiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdN,QAAS,OACTY,UAAW,OACXV,MAAO,UACPW,SAAU,YACV1B,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAOE,aAAc,WAAYhY,SAAC,6CAG5DC,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,wBAAyB,KAAEu2F,EAAAA,GAAAA,IAAe/oF,GAAS+b,cAAc,YAAGxpB,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,cAAkB,IAAE4qE,GAAgBp9D,GAAS+lB,4BAG9F,QAAnCixB,GAAAh3C,GAAS6b,kCAA0B,IAAAm7B,IAAS,QAATC,GAAnCD,GAAqChwB,eAAO,IAAAiwB,QAAT,EAAnCA,GAA8CzjD,QAAS,IAAwC,QAAvC0jD,GAAIl3C,GAAS6b,kCAA0B,IAAAq7B,QAAA,EAAnCA,GAAqCjwB,WACjGx0B,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACsC,QAAnC2kD,GAAAn3C,GAAS6b,kCAA0B,IAAAs7B,IAAS,QAATC,GAAnCD,GAAqCnwB,eAAO,IAAAowB,QAAT,EAAnCA,GAA8C5jD,QAAS,IACtDf,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,8BAA0B,IAAEwN,GAAS6b,2BAA2BmL,QAAQnzB,IAAIgpB,IACnE,CACb,MAAS,SACT,QAAW,eACX,qBAAwB,6BACxB,MAAS,UAEGA,IAAWA,IACxB0jD,KAAK,UAGwB,QAAnClpB,GAAAr3C,GAAS6b,kCAA0B,IAAAw7B,IAAS,QAATC,GAAnCD,GAAqCrwB,eAAO,IAAAswB,QAAT,EAAnCA,GAA8C9jD,QAAS,IAAwC,QAAvC+jD,GAAIv3C,GAAS6b,kCAA0B,IAAA07B,QAAA,EAAnCA,GAAqCtwB,SAAU,YACxE,QAAnCuwB,GAAAx3C,GAAS6b,kCAA0B,IAAA27B,QAAA,EAAnCA,GAAqCvwB,UACpCx0B,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,YAAgB,IAAiD,YAA/CwN,GAAS6b,2BAA2BoL,OAAuB,WACV,WAA/CjnB,GAAS6b,2BAA2BoL,OAAsB,yBAC1DjnB,GAAS6b,2BAA2BoL,iBAO1Ex0B,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVyiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdN,QAAS,OACTY,UAAW,OACXU,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACL9J,SAAA,EACAD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CACdC,KAAMw+F,EAAAA,IACNj+F,MAAO,CAAEG,MAAO,UAAWW,SAAU,cAEvCzB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEshE,KAAM,GAAIliE,SAAA,EACtBD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAO/W,MAAO,UAAWiX,aAAc,WAAYhY,SAAC,8DAG9ED,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,WAAYX,MAAO,WAAYf,SAAC,qGAajEmoE,GAAahyD,UACdlW,EAAAA,GAAAA,MAAC3H,GAAW,CAAC,eAAa,gBAAe0H,SAAA,EACvCC,EAAAA,GAAAA,MAAC0D,GAAa,CACZ6oC,aAAcq5B,GAAgB,iBAC9B5uD,SAAUvJ,GAAgB,iBAAiB1N,SAAA,EAE3CC,EAAAA,GAAAA,MAACzH,GAAY,CAACg0C,aAAcq5B,GAAgB,iBAAiB7lE,SAAA,EAC3DD,EAAAA,GAAAA,KAAC4L,GAAW,CAAC6gC,aAAcq5B,GAAgB,iBAAiB7lE,UAC1DD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM2M,EAAAA,SAEzBjN,EAAAA,GAAAA,KAAA,QAAAC,SAAM,6DAGLkgC,KAAoB+oC,KACnBlpE,EAAAA,GAAAA,KAACqtC,GAAW,CAAC3sC,MACV+M,GAASgc,eAAiBhc,GAASic,cAAgBjc,GAASkc,kBACzD,8IACiC,IAA/Blc,GAASkc,mBAA+BlkB,IAAgB,EACxD,2JACA,uHAEPxF,SAAC,wCAMNC,EAAAA,GAAAA,MAACitC,GAAe,CAAAltC,SAAA,CAEbkgC,KAAoB+oC,IAAyBp7D,KAC5C9N,EAAAA,GAAAA,KAAC0zC,GAAY,CACXvzC,QAAUjB,IACRA,EAAEkB,kBACFy6D,IAA4B,IAE9Bn6D,MAAM,gCAA+BT,UAErCD,EAAAA,GAAAA,KAACg6F,EAAM,OAIXh6F,EAAAA,GAAAA,KAACgtC,GAAY,CACXE,UAAWljB,GAAc0U,cACzB+N,aAAcq5B,GAAgB,iBAC9B3lE,QAASA,IAAM03B,GAAc,iBAC7Bh3B,MAAO,CAAE84F,OAAQ,WAAY15F,UAE7BD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM26F,EAAAA,eAI7B/6F,EAAAA,GAAAA,MAACqtC,GAAc,CAACL,UAAWljB,GAAc0U,cAAcz+B,SAAA,EAErDC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEoX,aAAc,UAAWhY,SAAA,EACrCD,EAAAA,GAAAA,KAAC/G,GAAK,CAAC4H,MAAO,CAAEoX,aAAc,UAAWhY,SAAC,6BAC1CC,EAAAA,GAAAA,MAAA,SAAOW,MAAO,CACVuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACLjJ,QAAS,gBACTwiE,gBAAiB71D,GAASkc,kBAAoB,UAAY,OAC1DxoB,OAAQsM,GAASkc,kBAAoB,oBAAsB,oBAC3DvoB,aAAc,MACdu4F,OAASx5D,GAAmB,cAAgB,UAC5Cx+B,SAAU,UACVoW,WAAY,MACZ/W,MAAOyM,GAASkc,kBAAoB,UAAY,UAChDkjB,QAAU1M,GAAmB,GAAM,EACnC4+D,UAAW,OACXC,UAAW,cACX/+F,SAAA,EACAD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,WACLoJ,QAASiM,GAASkc,oBAAqB,EACvCloB,SAAWvC,IAELihC,MAGCjhC,EAAE2C,OAAOL,SAAWiM,GAASkc,mBAAqBogD,IAAqB,IAC1E9O,IAA4B,GAG5B97D,GAAkB,oBAAqBD,EAAE2C,OAAOL,WAGpD5H,SAAUumC,GACVt/B,MAAO,CACLrK,MAAO,OACPC,OAAQ,OACRkjG,OAASx5D,GAAmB,cAAgB,UAC5C+hC,WAAY,MAGhBliE,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEshE,KAAM,GAAIliE,SACtBwF,IAAgB,EACb,mEACA,0CAKRzF,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVa,UAAW,UACXZ,QAAS,eACTwiE,gBAAiByG,IAAqB,IAAQ,UAAY,UAC1D5oE,OAAO,aAADkI,OAAe0gE,IAAqB,IAAQ,UAAY,WAC9D3oE,aAAc,MACdO,SAAU,WACVX,MAAO+oE,IAAqB,IAAQ,UAAY,WAChD9pE,UACAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,aAAcj4D,IAAK,UAAW9J,SAAA,EACvED,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CACdC,KAAMw+F,EAAAA,IACNj+F,MAAO,CAAEc,SAAU,OAAQD,UAAW,WAAYwgE,WAAY,MAEhEhiE,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACED,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAOE,aAAc,WAAYhY,SACxD8pE,IAAqB,IAAQ,qCAAuB,0CAEvD/pE,EAAAA,GAAAA,KAAA,OAAAC,SACG8pE,IAAqB,KACpB7pE,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CAAE,oBACaC,EAAAA,GAAAA,MAAA,UAAAD,SAAA,CAAS8pE,GAAkBoJ,eAAe,QAAS,CAAEklB,sBAAuB,EAAGC,sBAAuB,IAAK,sBAAoB,kDACjIt4F,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,wCAA4B,yCAGjDC,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CAAE,oBACaC,EAAAA,GAAAA,MAAA,UAAAD,SAAA,CAAS8pE,GAAkBoJ,eAAe,QAAS,CAAEklB,sBAAuB,EAAGC,sBAAuB,IAAK,sBAAoB,6GAW1J5yF,IAA+B,IAAjBD,MACdzF,EAAAA,GAAAA,KAAA0W,GAAAA,SAAA,CAAAzW,UACIwN,GAASkc,mBAAqBogD,GAAoB,MAClD/pE,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVC,QAAS,OACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdO,SAAU,WACVX,MAAO,WACPf,SAAC,0LAYZ,MACC,MAAMioE,EAAkBz6D,GAASgc,eAAiBhc,GAASic,aAE3D,OADsB2+C,GAAqBjyD,UAAYtI,KAAuBo6D,IAE5EhoE,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACViX,OAAQ,SACRhX,QAAS,eACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdJ,MAAO,WACPf,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAOE,aAAc,SAAU7V,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,UAAW9J,SAAC,2DAGjHD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,YAAa1B,SAAC,sLAK3C,EApBA,GA4BA,MACC,MAAMioE,EAAkBz6D,GAASgc,eAAiBhc,GAASic,aAI3D,OAHkC2+C,GAAqBjyD,UACrDtI,IAAsBo6D,KAG1BhoE,EAAAA,GAAAA,MAAC3H,GAAW,CAAC,eAAa,yBAAwB0H,SAAA,EAChDC,EAAAA,GAAAA,MAAC0D,GAAa,CACZ6oC,aAAcq5B,GAAgB,0BAC9B5uD,SAAUvJ,GAAgB,0BAA0B1N,SAAA,EAEpDC,EAAAA,GAAAA,MAACzH,GAAY,CAACg0C,aAAcq5B,GAAgB,0BAA0B7lE,SAAA,EACpED,EAAAA,GAAAA,KAAC4L,GAAW,CAAC6gC,aAAcq5B,GAAgB,0BAA0B7lE,UACnED,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM2M,EAAAA,SAEzBjN,EAAAA,GAAAA,KAAA,QAAAC,SAAM,wEAGLqoE,KAA4BY,KAC3BlpE,EAAAA,GAAAA,KAACqtC,GAAW,CAAC3sC,MAAM,uHAAuFT,SAAC,wCAM/GC,EAAAA,GAAAA,MAACitC,GAAe,CAAAltC,SAAA,CAEbqoE,KAA4BY,IAAyBp7D,KACpD9N,EAAAA,GAAAA,KAAC0zC,GAAY,CACXvzC,QAAUjB,IACRA,EAAEkB,kBACFy6D,IAA4B,IAE9Bn6D,MAAM,gCAA+BT,UAErCD,EAAAA,GAAAA,KAACg6F,EAAM,OAIXh6F,EAAAA,GAAAA,KAACgtC,GAAY,CACXE,UAAWljB,GAAcsC,uBACzBmgB,aAAcq5B,GAAgB,0BAC9B3lE,QAASA,IAAM03B,GAAc,0BAC7Bh3B,MAAO,CAAE84F,OAAQ,WAAY15F,UAE7BD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM26F,EAAAA,eAI7B/6F,EAAAA,GAAAA,MAACqtC,GAAc,CAACL,UAAWljB,GAAcsC,uBAAuBrsB,SAAA,EAE9DC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACT05F,oBAAqB,gBACrB/xF,IAAK,SACLi4D,WAAY,SACZ/hE,SAAA,EAEAC,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACED,EAAAA,GAAAA,KAAC/G,GAAK,CAAC4H,MAAO,CAAEoX,aAAc,UAAWhY,SAAC,6BAC1CC,EAAAA,GAAAA,MAAA,SAAOW,MAAO,CACZuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACLjJ,QAAS,gBACTwiE,gBAAiB71D,GAASkc,kBAAoB,UAAY,OAC1DxoB,OAAQsM,GAASkc,kBAAoB,oBAAsB,oBAC3DvoB,aAAc,MACdu4F,OAAQrxB,GAA0B,cAAgB,UAClD3mE,SAAU,UACVoW,WAAY,MACZ/W,MAAOyM,GAASkc,kBAAoB,UAAY,UAChDkjB,QAASy7B,GAA0B,GAAM,EACzCy2B,UAAW,OACXC,UAAW,cACX/+F,SAAA,EACAD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,WACLoJ,QAASiM,GAASkc,oBAAqB,EACvCloB,SAAWvC,IACLopE,MAGCppE,EAAE2C,OAAOL,SAAWiM,GAASkc,mBAAqBogD,IAAqB,IAC1E9O,IAA4B,GAE5B97D,GAAkB,oBAAqBD,EAAE2C,OAAOL,WAGpD5H,SAAU0uE,GACVznE,MAAO,CACLrK,MAAO,OACPC,OAAQ,OACRkjG,OAAQrxB,GAA0B,cAAgB,UAClDpG,WAAY,MAGhBliE,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEshE,KAAM,EAAGg2B,WAAY,UAAWl4F,SAAC,6CAKpDC,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACED,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,SAAUqU,GAASkc,kBAAkB1pB,SAAC,wCAC7CD,EAAAA,GAAAA,KAACu9C,GAAU,CACTxnC,UAAU,gBACV1W,MAAOoO,GAASgc,cAChBhoB,SAAWpC,IAET,GADAF,GAAkB,gBAAiBE,GAC/BA,IAAUoO,GAASgmB,aAAc,CACnC,MAAM3rB,EAAUqI,aAAagB,QAAQ,WACjCrJ,GACF3I,GAAkB,eAAgBuS,SAAS5J,EAAS,IAExD,GAEFq0C,OAAS98C,GAAUuhF,GAAgB,gBAAiBvhF,GACpDzF,UAAW6T,GAASkc,mBAAqB2+C,GACzC3uE,WAAY6T,GAAiBic,cAC7B3nB,YAAY,qBAEb0L,GAAiBic,gBAChBzpB,EAAAA,GAAAA,KAAClF,GAAS,CAAC+F,MAAO,CAAEa,UAAW,UAAWzB,SAAEuN,GAAiBic,oBAKjEvpB,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACED,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,SAAUqU,GAASkc,kBAAkB1pB,SAAC,sBAC7CC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM2+F,EAAAA,OACvBj/F,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACL6Q,KAAK,eACL5J,MAAOoO,GAASic,cAAgB,GAChCjoB,SAAWvC,IAET,GADAC,GAAkB,eAAgBD,EAAE2C,OAAOxC,OACvCH,EAAE2C,OAAOxC,QAAUoO,GAASgmB,aAAc,CAC5C,MAAM3rB,EAAUqI,aAAagB,QAAQ,WACjCrJ,GACF3I,GAAkB,eAAgBuS,SAAS5J,EAAS,IAExD,GAEFlO,UAAW6T,GAASkc,mBAAqB2+C,GACzC3uE,WAAY6T,GAAiBkc,aAC7BhwB,SAAO,EACPoI,YAAY,mCAGf0L,GAAiBkc,eAChB1pB,EAAAA,GAAAA,KAAClF,GAAS,CAAC+F,MAAO,CAAEa,UAAW,UAAWzB,SAAEuN,GAAiBkc,sBAMjEjc,GAASkc,oBACTzpB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVC,QAAS,gBACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdO,SAAU,WACVX,MAAO,UACPU,UAAW,OACXU,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACL9J,SAAA,EACAD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMw+F,EAAAA,IAAcj+F,MAAO,CAAEc,SAAU,WACxD3B,EAAAA,GAAAA,KAAA,OAAAC,UACED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,qEAMb28B,GAAiBnvB,GAASukB,kBAAmB,gBAC5C9xB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVa,UAAW,SACXZ,QAAS,OACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdO,SAAU,WACVX,MAAO,WACPf,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAOE,aAAc,WAAYhY,SAAC,qEAG5DC,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,mCAA0B,KAAEu2F,EAAAA,GAAAA,IAAe/oF,GAASgc,eAAe,YAAGzpB,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,oBAAmB,IAAE4qE,GAAgBp9D,GAASgmB,cACnIhmB,GAASic,eACRxpB,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CACG,YACDD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,iBAAqB,IAAEwN,GAASic,2BASrD,EA7MA,GAuNA,EAACw1E,EAAAC,EAAAC,KAGA,MAAMl+D,EAAuD,cAAb,QAApBg+D,EAAAzxF,GAASwN,mBAAW,IAAAikF,OAAA,EAApBA,EAAsBxqE,QAC5CyM,EAA4E,cAAb,QAAnCg+D,EAAA1xF,GAAS6b,kCAA0B,IAAA61E,OAAA,EAAnCA,EAAqCzqE,QACjE8J,EAAa0C,GAAuBC,EAQpC8mC,EAAax6D,GAAS6H,SAAW7H,GAAS6H,QAAQrU,OAAS,EAC3Do+F,GAAc7gE,IAClB8nC,GACI7gE,IAAgB,EACfA,IAAgB,GAAKwiE,GAKtBq3B,EAAkB,gBAAAj2F,QAA8B,QAAhB+1F,EAAA3xF,GAAS6H,eAAO,IAAA8pF,OAAA,EAAhBA,EAAkBn+F,SAAU,EAAC,KAEnE,OAAOo+F,GACPn/F,EAAAA,GAAAA,MAAC3H,GAAW,CAAC,eAAa,YAAW0H,SAAA,EACnCC,EAAAA,GAAAA,MAAC0D,GAAa,CACZ6oC,aAAa,kBACbv1B,UAAU,EACVrW,MAAO,CACLK,WAAY,oDACZwL,YAAa,WACbzM,SAAA,EAEFC,EAAAA,GAAAA,MAACzH,GAAY,CAACg0C,aAAa,kBAAkB5rC,MAAO,CAAEG,MAAO,QAASf,SAAA,EACpED,EAAAA,GAAAA,KAAC4L,GAAW,CAAC6gC,aAAa,kBAAkB5rC,MAAO,CAAEG,MAAO,QAASf,UACnED,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMi/F,EAAAA,QAfV,6BAkBfv/F,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACXc,SAAU,UACV6hE,WAAY,SACZzrD,WAAY,MACZ80B,QAAS,IACT5sC,SACCq/F,IAGFx2B,KAA4BI,KAC3BlpE,EAAAA,GAAAA,KAACqtC,GAAW,CAAC3sC,MAAM,gHAAqFT,SAAC,wCAM7GC,EAAAA,GAAAA,MAACitC,GAAe,CAAAltC,SAAA,CAEb6oE,KAA4BI,IAAyB5C,KACpDtmE,EAAAA,GAAAA,KAAC0zC,GAAY,CACXvzC,QAAUjB,IACRA,EAAEkB,kBACF+6D,IAA8B,IAEhCz6D,MAAM,4BAA2BT,UAEjCD,EAAAA,GAAAA,KAACg6F,EAAM,OAIXh6F,EAAAA,GAAAA,KAACgtC,GAAY,CACXE,UAAWljB,GAAcoV,UACzBj/B,QAASA,IAAM03B,GAAc,aAC7Bh3B,MAAO,CAAEG,MAAO,OAAQ24F,OAAQ,WAAY15F,UAE5CD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM26F,EAAAA,eAK7Bj7F,EAAAA,GAAAA,KAACutC,GAAc,CAACL,UAAWljB,GAAcoV,UAAUn/B,UACjDD,EAAAA,GAAAA,KAAA,OAAAC,SAEGu+B,GACCt+B,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEC,QAAS,UAAWb,SAAA,CAC/B,MAEC,KAAMwN,GAAS6H,SAAuC,IAA5B7H,GAAS6H,QAAQrU,UAAkBu6D,GAAgB,CAC3E,MAAMiQ,EAAcxiC,GAAoB,IAAIvsB,MACtC8iF,EAAiB,CACrBl2F,GAAG,iBAADD,OAAmBqT,KAAKC,OAC1BwJ,cAAe1Y,GAASnE,GACxBic,kBAAmBkmD,EACnBjmD,YAAa,EACb3P,UAAW,KACXsP,cAAe,GACfM,iBAAkBhY,GAASsV,eAAiB,GAC5CsR,aAAc,KACd3O,YAAa,GACbwQ,qBAAsBpuB,GACtB6jE,eAAgBd,GAAgB/iE,IAChCorB,cAAc,IAAIxW,MAAOsY,cACzB42C,eAAgB,KAChBhtD,QAAS,EACTitD,QAAQ,EACTyC,aAAa,EACZh6C,YAAa,IAGf/sB,WAAW,KACT2iE,GAAc,CAACs1B,KACd,EACL,CACA,OAAO,IACR,EA7BA,IA+BDt/F,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVK,WAAY,UACZC,OAAQ,oBACRC,aAAc,MACdN,QAAS,QACTb,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVc,SAAU,SACVsW,aAAc,OACdlX,UAAW,SACXC,MAAO,WACPf,SAAC,kBAGHD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVc,SAAU,WACVoW,WAAY,MACZ/W,MAAO,UACPiX,aAAc,SACdlX,UAAW,UACXd,SAAC,6CAGHD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVc,SAAU,WACVX,MAAO,UACPiX,aAAc,SACdlX,UAAW,UACXd,SAAC,mFAKFwN,GAAS6H,SAAW7H,GAAS6H,QAAQrU,OAAS,GAAKwM,GAAS6H,QAAQ,KACnEpV,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACED,EAAAA,GAAAA,KAACy/F,GAAAA,GAAyB,CAExBtsC,UAAW1lD,GAAS6H,QAAQ,GAAGhM,GAC/Bo2F,aAAcjyF,GAASnE,GACvB46D,yBAA0BA,GAC1By4B,SAAU5zB,GACV42B,cAAepzB,GACf9+D,SAAUA,GACV+H,QAAS/H,GAAS6H,QAAQ,GAC1Bk4D,8BAA+BA,GAC/BhvC,YAAY,EACZrN,SAAUA,GACVmD,YAAa,MACX,MAAMsrE,EAAOnyF,GAAS6H,QAAQ,GAAGgf,aAAe,GAEhD,OADAhjB,QAAQ42B,IAAI,0GAAD7+B,OAA8EoE,GAAS6H,QAAQ,GAAGhM,GAAE,MAAMs2F,GAC9GA,CACR,EAJY,GAKbC,oBAAsB3xB,IACpB58D,QAAQ42B,IAAI,6DAAiDgmC,GAC7DD,GAA+BxgE,GAAS6H,QAAQ,GAAGhM,GAAI4kE,IAEzD4xB,qBAAuB7wB,IACrBD,GAAgCvhE,GAAS6H,QAAQ,GAAGhM,GAAI2lE,IAE1D8wB,oBAAqBxxB,IAAwB,wBAAAllE,OAvBhBoE,GAAS6H,QAAQ,GAAGhM,GAAE,KAAAD,OAAIoE,GAASnE,MA2BlEtJ,EAAAA,GAAAA,KAACpH,GAAO,CAACiI,MAAO,CAAEa,UAAW,UAAWzB,UACtCC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAAEy6F,WAAY,UAAWr7F,SAAA,EACzCC,EAAAA,GAAAA,MAACjH,GAAK,CAAAgH,SAAA,CAAC,6BAELD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEc,SAAU,UAAWX,MAAO,UAAW+W,WAAY,SAAUyrD,WAAY,UAAWvjE,SAAC,uBAItGD,EAAAA,GAAAA,KAAC4uC,GAAQ,CACPvvC,MAAOoO,GAAS6H,QAAQ,GAAGoQ,aAAe,GAC1CjkB,SAAWvC,IACT,MAAM0tE,EAAiBn/D,GAAS6H,QAAQhU,IAAI,CAACk0B,EAAGjtB,IACtC,IAARA,GAAShJ,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACAi2B,GAAC,IAAE9P,YAAaxmB,EAAE2C,OAAOxC,QAC9Bm2B,GAEN00C,GAAc0C,IAEhBhzE,SAAUmvE,GACVjnE,YAAY,sEACZi8F,KAAM,aAQhB79F,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVa,UAAW,SACXZ,QAAS,OACTI,WAAY,UACZC,OAAQ,oBACRC,aAAc,MACdO,SAAU,WACVX,MAAO,UACPD,UAAW,QACXd,SAAA,EACAD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,8BAAqB,iPAOnCC,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CACD,MAGC,KAAMwN,GAAS6H,SAAuC,IAA5B7H,GAAS6H,QAAQrU,UAAkBu6D,GAAgB,CAC3E,MAAMiQ,EAAcxiC,GAAoB,IAAIvsB,MACtCgvD,EAAc,CAClBpiE,GAAG,QAADD,OAAUqT,KAAKC,OACjBwJ,cAAe1Y,GAASnE,GACxBic,kBAAmBkmD,EACnBjmD,YAAa,EACb3P,UAAW,GACXsP,cAAe,GACfM,iBAAkBhY,GAASsV,eAAiB,GAC5CsR,aAAc,GACd3O,YAAa,GACbwQ,qBAAsBpuB,GACtB6jE,eAAgBd,GAAgB/iE,IAChCorB,cAAc,IAAIxW,MAAOsY,cACzB42C,eAAgB,KAChBhtD,QAAS,EACTitD,QAAQ,EACRv3C,YAAa,IAIf/sB,WAAW,KACT2iE,GAAc,CAACwB,KACd,EACL,CACA,OAAO,IACR,EA9BA,GAgCAlQ,IACCx7D,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEE,UAAW,SAAUD,QAAS,OAAQE,MAAO,WAAYf,SAAC,sCAIxEC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEa,UAAW,UAAWzB,SAAA,CAE/BwN,GAAS6H,SAAuC,IAA5B7H,GAAS6H,QAAQrU,OActCwM,GAAS6H,QAAQhU,IAAI,CAACkU,EAASqW,KAAW,IAADm0E,EAAAC,EACzC,MAAMC,GAA0B,OAAdzkC,SAAc,IAAdA,QAAc,EAAdA,GAAgBnyD,MAAOkM,EAAQlM,GAC3C62F,EAAcD,EAAYvkC,GAAkBnmD,EAC5C4qF,EAAyD,IAAtC5qF,EAAQ+3D,0BAEjC,OACArtE,EAAAA,GAAAA,MAAA,OAAsBW,MAAO,CAC3BM,OAAQ,oBACRC,aAAc,OACdN,QAAS,IACTmX,aAAc,SACd/W,WAAYg/F,EAAY,UAAaE,EAAmB,UAAY,UACpElI,UAAW,gCACX6C,SAAU,WACV96F,SAAA,EAEAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVK,WAAY,oDACZF,MAAO,QACPF,QAAS,eACTiX,WAAY,MACZpW,SAAU,SACVS,QAAS,OACT4/D,WAAY,SACZ46B,eAAgB,gBAChB7yF,IAAK,OACL+wF,aAAc,oBACduF,cAAe,QACfC,cAAe,aACfrgG,SAAA,EACAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAACuB,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,WAAW9J,SAAA,EAClED,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMi/F,EAAAA,IAAc1+F,MAAO,CAAEc,SAAU,YAAc,YAC5DkqB,EAAQ,EACP,IAAVA,IAAe7rB,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAACG,MAAO,UAAWW,SAAU,UAAU1B,SAAC,MACpEuV,EAAQ2P,gBACPnlB,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACXkX,WAAY,MACZpW,SAAU,SACVT,WAAY,2BACZJ,QAAS,kBACTM,aAAc,MACdi/F,cAAe,SACfC,cAAe,QACfrgG,SACCuV,EAAQ2P,iBAKbjlB,EAAAA,GAAAA,MAACuhD,GAAsB,CAAAxhD,SAAA,EACrBD,EAAAA,GAAAA,KAAC2hD,GAAe,CAAClZ,UAAU,YAAWxoC,UACpCD,EAAAA,GAAAA,KAACugG,EAAAA,EAAI,OAEPrgG,EAAAA,GAAAA,MAAC2hD,GAAoB,CAACpZ,UAAU,iBAAgBxoC,SAAA,CAE7CuV,EAAQ03D,mBACPhtE,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACEC,EAAAA,GAAAA,MAAC6hD,GAAiB,CAAA9hD,SAAA,EAChBD,EAAAA,GAAAA,KAACiiD,GAAmB,CAAAhiD,SAAC,eACrBC,EAAAA,GAAAA,MAACiiD,GAAmB,CAACthD,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,MAAOgO,WAAY,OAAQ9X,SAAA,CAClGuV,EAAQ03D,iBAAiB3vE,OAAS,MAClCiY,EAAQ03D,iBAAiB3vE,QACxByC,EAAAA,GAAAA,KAACjJ,EAAI,CACHqR,KAAM,GACNvH,MAAO,CAAE84F,OAAQ,UAAW34F,MAAO,WACnCb,QAASA,KACPqgG,UAAUC,UAAUC,UAAUlrF,EAAQ03D,iBAAiB3vE,OACvD+nD,IAAaA,GAAU,4BAAoB,CAAEltD,KAAM,aAErDsI,MAAM,kCAKdR,EAAAA,GAAAA,MAAC6hD,GAAiB,CAAA9hD,SAAA,EAChBD,EAAAA,GAAAA,KAACiiD,GAAmB,CAAAhiD,SAAC,eACrBC,EAAAA,GAAAA,MAACiiD,GAAmB,CAACthD,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,OAAQ9J,SAAA,CAC/EuV,EAAQ03D,iBAAiBvvE,KAAO,MAChC6X,EAAQ03D,iBAAiBvvE,MACxBqC,EAAAA,GAAAA,KAACjJ,EAAI,CACHqR,KAAM,GACNvH,MAAO,CAAE84F,OAAQ,UAAW34F,MAAO,WACnCb,QAASA,KACPqgG,UAAUC,UAAUC,UAAUlrF,EAAQ03D,iBAAiBvvE,KACvD2nD,IAAaA,GAAU,6BAAmB,CAAEltD,KAAM,aAEpDsI,MAAM,kCAKdV,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEg6F,UAAW,oBAAqB/iF,OAAQ,cAKzDtC,EAAQ23D,eACPjtE,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACEC,EAAAA,GAAAA,MAAC6hD,GAAiB,CAAA9hD,SAAA,EAChBD,EAAAA,GAAAA,KAACiiD,GAAmB,CAAAhiD,SAAC,2BACrBC,EAAAA,GAAAA,MAACiiD,GAAmB,CAACthD,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,OAAQ9J,SAAA,CAC/EuV,EAAQ23D,cACTntE,EAAAA,GAAAA,KAACjJ,EAAI,CACHqR,KAAM,GACNvH,MAAO,CAAE84F,OAAQ,UAAW34F,MAAO,WACnCb,QAASA,KACPqgG,UAAUC,UAAUC,UAAUlrF,EAAQ23D,cACtC7nB,IAAaA,GAAU,yBAAoB,CAAEltD,KAAM,aAErDsI,MAAM,+BAIZV,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEg6F,UAAW,oBAAqB/iF,OAAQ,eAI1D5X,EAAAA,GAAAA,MAAC6hD,GAAiB,CAAA9hD,SAAA,EAChBD,EAAAA,GAAAA,KAACiiD,GAAmB,CAAAhiD,SAAC,4BACrBD,EAAAA,GAAAA,KAACmiD,GAAmB,CAAAliD,SAAEuV,EAAQ2P,eAAiB,YAEjDjlB,EAAAA,GAAAA,MAAC6hD,GAAiB,CAAA9hD,SAAA,EAChBD,EAAAA,GAAAA,KAACiiD,GAAmB,CAAAhiD,SAAC,qBACrBD,EAAAA,GAAAA,KAACmiD,GAAmB,CAAAliD,SACjBuV,EAAQK,UAAS,GAAAxM,OAAMsM,WAAWH,EAAQK,WAAWs9D,eAAe,SAAQ,YAAQ,YAGzFjzE,EAAAA,GAAAA,MAAC6hD,GAAiB,CAAA9hD,SAAA,EAChBD,EAAAA,GAAAA,KAACiiD,GAAmB,CAAAhiD,SAAC,yBACrBD,EAAAA,GAAAA,KAACmiD,GAAmB,CAAAliD,SACjBuV,EAAQ6P,oBAAqBmxE,EAAAA,GAAAA,IAAehhF,EAAQ6P,oBAAsB,YAG/EnlB,EAAAA,GAAAA,MAAC6hD,GAAiB,CAAA9hD,SAAA,EAChBD,EAAAA,GAAAA,KAACiiD,GAAmB,CAAAhiD,SAAC,uBACrBD,EAAAA,GAAAA,KAACmiD,GAAmB,CAAAliD,SAChBuV,EAAQ8P,qBAAuB9P,EAAQ6e,cACrCmiE,EAAAA,GAAAA,IAAehhF,EAAQ8P,qBAAuB9P,EAAQ6e,cACtD,YAGRn0B,EAAAA,GAAAA,MAAC6hD,GAAiB,CAAA9hD,SAAA,EAChBD,EAAAA,GAAAA,KAACiiD,GAAmB,CAAAhiD,SAAC,6BACrBD,EAAAA,GAAAA,KAACmiD,GAAmB,CAAAliD,SACjBuV,EAAQ+P,mBAAoBixE,EAAAA,GAAAA,IAAehhF,EAAQ+P,mBAAqB,YAG7ErlB,EAAAA,GAAAA,MAAC6hD,GAAiB,CAAA9hD,SAAA,EAChBD,EAAAA,GAAAA,KAACiiD,GAAmB,CAAAhiD,SAAC,iCACrBC,EAAAA,GAAAA,MAACiiD,GAAmB,CAAAliD,SAAA,CACqB,QAAtCuV,EAAQ+3D,4BACPrtE,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CACXuB,QAAS,cACT4/D,WAAY,SACZj4D,IAAK,UACL7I,WAAY,UACZF,MAAO,UACPF,QAAS,UACTM,aAAc,MACdO,SAAU,UACVoW,WAAY,OACZ9X,SAAA,EACAD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMG,EAAAA,MAAiB,SAIL,OAAtC+U,EAAQ+3D,4BACPrtE,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CACXuB,QAAS,cACT4/D,WAAY,SACZj4D,IAAK,UACL7I,WAAY,UACZF,MAAO,UACPF,QAAS,UACTM,aAAc,MACdO,SAAU,UACVoW,WAAY,OACZ9X,SAAA,EACAD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMqoC,EAAAA,MAAiB,SAI1CnzB,EAAQ+3D,4BACRvtE,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEG,MAAO,UAAWW,SAAU,YAAa1B,SAAC,8BAM9DuV,EAAQoQ,mCACP1lB,EAAAA,GAAAA,MAAC6hD,GAAiB,CAAA9hD,SAAA,EAChBD,EAAAA,GAAAA,KAACiiD,GAAmB,CAAAhiD,SAAC,kCACrBD,EAAAA,GAAAA,KAACmiD,GAAmB,CAAAliD,SACjBuV,EAAQoQ,sCAIdpQ,EAAQM,2BACP5V,EAAAA,GAAAA,MAAC6hD,GAAiB,CAAA9hD,SAAA,EAChBD,EAAAA,GAAAA,KAACiiD,GAAmB,CAAAhiD,SAAC,qBACrBD,EAAAA,GAAAA,KAACmiD,GAAmB,CAAAliD,SACjBuV,EAAQM,+BAIf5V,EAAAA,GAAAA,MAAC6hD,GAAiB,CAAA9hD,SAAA,EAChBD,EAAAA,GAAAA,KAACiiD,GAAmB,CAAAhiD,SAAC,qBACrBD,EAAAA,GAAAA,KAACmiD,GAAmB,CAACzhD,MACnB,MACE,MAAMsa,EAAYxF,EAAQiQ,iBAC1B,OAAKzK,EACDhc,MAAMC,QAAQ+b,GACTA,EACJ1Z,IAAIiwB,GAAkB,kBAANA,IAAkBA,EAAEr4B,OAASq4B,EAAEh0B,OAASg0B,EAAElyB,OAASkyB,EAAE3Y,MAAY2Y,GACjF3xB,OAAOiZ,SACPm1D,KAAK,OAAS,MAEM,kBAAdhzD,GACFA,GAEF,MAVgB,KAWxB,EAbD,GAcD/a,SACE,MACC,MAAM+a,EAAYxF,EAAQiQ,iBAC1B,OAAKzK,EACDhc,MAAMC,QAAQ+b,GACTA,EACJ1Z,IAAIiwB,GAAkB,kBAANA,IAAkBA,EAAEr4B,OAASq4B,EAAEh0B,OAASg0B,EAAElyB,OAASkyB,EAAE3Y,MAAY2Y,GACjF3xB,OAAOiZ,SACPm1D,KAAK,OAAS,MAEM,kBAAdhzD,GACFA,GAEF,MAVgB,KAWxB,EAbA,kBAmBXhb,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAACuB,QAAS,OAAQ2H,IAAK,UAAU9J,UAE3CD,EAAAA,GAAAA,KAAA,UACE5H,KAAK,SACLwB,SAAUmvE,GACV5oE,QAASA,KACP,GAAIqV,EAAQq2D,OAAQ,CAElB,MAAMa,EAAiB1tE,MAAMC,QAAQwO,GAAS6H,SAAW7H,GAAS6H,QAAU,GAE5E,GADA40D,GAAcwC,EAAe9sE,OAAO41B,GAAKA,EAAElsB,KAAOkM,EAAQlM,KACtD42F,EAAW,CACbxkC,GAAkB,MAClB,MAAMilC,EAAsBp2B,GAAW3hE,WACjC6iE,EAAcxiC,GAAoB,IAAIvsB,MAE5Ck/C,GAAmB,CACjBr2C,kBAAmBkmD,EAC3DjmD,YAAa,EAC2B3P,UAAW8qF,EACXx7E,cAAe,GACfM,iBAAkBhY,GAASsV,eAAiB,GAC5C2C,YAAa,GACb2O,aAAc,IAElB,CACF,KApidR91B,WAAsB,IAADqiG,EAE/C,MAAMprF,EAA0B,QAAnBorF,EAAGnzF,GAAS6H,eAAO,IAAAsrF,OAAA,EAAhBA,EAAkBvmF,KAAKmb,GAAKA,EAAElsB,KAAO6pD,GACrD,IAAK39C,EAAS,OAGd,IAAIqrF,EAAe,EAEnB,GAAI1tC,IAAcprD,OAAOorD,GAAWh+C,WAAW,SAC7C,IAAK,IAAD2rF,EACF,MAAMlgF,QAAiB2U,EAAAA,GAAAA,IACrB49B,EACAh3D,GACAD,GACAuR,GAASnE,IAGXu3F,IAA6B,QAAbC,EAAAlgF,EAASlY,YAAI,IAAAo4F,OAAA,EAAbA,EAAexsE,cAAe1T,EAASlY,MAAQ,IAAIzH,MACrE,CAAE,MAAOsjB,GACT,CAIF2uC,GAAuB,CACrB33D,QAAQ,EACR43D,UAAWA,EACXC,aAAc59C,EAAQ2P,eAAa,WAAA9b,OAAemM,EAAQlM,IAC1D+pD,YAAawtC,KA2gdqBE,CAAoBvrF,EAAQlM,KAGhC5I,MAAM,iBACNG,MAAO,CACLK,WAAY6nE,GAAoB,wBAA0B,yBAC1D/nE,MAAO,QACPG,OAAQ,kCACRC,aAAc,MACdN,QAAS,SACT64F,OAAQ5wB,GAAoB,cAAgB,UAC5C3mE,QAAS,OACT4/D,WAAY,SACZ46B,eAAgB,SAChBpmG,MAAO,OACPC,OAAQ,OACRo2C,QAASk8B,GAAoB,GAAM,EACnCwvB,WAAY,iBACZt4F,UAEFD,EAAAA,GAAAA,KAAC8J,EAAAA,EAAK,CAAC1B,KAAM,aAMnBlI,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEC,QAAS,WAAYb,SAAA,EAGnCC,EAAAA,GAAAA,MAACtH,GAAO,CAACiI,MAAO,CAACi7F,oBAAqB,iBAAiB77F,SAAA,EACrDC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,4BAChBD,EAAAA,GAAAA,KAACu9C,GAAU,CACTxnC,UAAS,MAAA1M,OAAQwiB,EAAQ,EAAC,mBAC1BxsB,MAAgC,QAA3B2gG,EAAExqF,EAAQ+P,yBAAiB,IAAAy6E,EAAAA,EAAKxqF,EAAQq2D,OAAS5iC,GAAoB,IAAIvsB,MAAU,GACxF/iB,WAAY6T,GAAiB,WAADnE,OAAYwiB,EAAQ,EAAC,oBACjDjyB,SAAUmvE,GACVtnE,SAAWpC,IACT,MAAMutE,EAAiBn/D,GAAS6H,QAAQhU,IAAIk0B,GAC1CA,EAAElsB,KAAOkM,EAAQlM,IAAE/J,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAEVi2B,GAAC,IACJjQ,kBAAmBlmB,EACnBmmB,YAAanmB,EAAQ,EAAI,EACzBwsE,QAAQ,IAEVr2C,GAEN00C,GAAc0C,IAEhB9qE,YAAY,uCAIhB5B,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,0BAChBC,EAAAA,GAAAA,MAAC7G,GAAa,CAACK,SAAO,EAAAuG,SAAA,EACpBD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM2+F,EAAAA,OACvBj/F,EAAAA,GAAAA,KAACzG,GAAK,CACJnB,KAAK,OACLiH,MAAOmW,EAAQ2P,eAAiB,GAChCxrB,WAAY6T,GAAiB,WAADnE,OAAYwiB,EAAQ,EAAC,WACjDjyB,SAAUmvE,GACVtnE,SAAWvC,IACT,MAAM0tE,EAAiBn/D,GAAS6H,QAAQhU,IAAIk0B,GAC1CA,EAAElsB,KAAOkM,EAAQlM,IAAE/J,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACVi2B,GAAC,IAAErQ,cAAejmB,EAAE2C,OAAOxC,MAAOwsE,QAAQ,IAC/Cr2C,GAEN00C,GAAc0C,IAEhBxzE,UAAQ,EACR0I,YAAY,WACZpI,SAAO,WAKbwG,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,iCAChBD,EAAAA,GAAAA,KAACk8C,GAAa,CACZnmC,UAAU,YACV1W,MAAwB,QAAnB4gG,EAAEzqF,EAAQK,iBAAS,IAAAoqF,EAAAA,EAAI,GAC5BtmG,WAAY6T,GAAiB,WAADnE,OAAYwiB,EAAQ,EAAC,YACjDjyB,SAAUmvE,GACVtnE,SAAUA,CAACrC,EAAOC,KAChB,MAAMutE,EAAiBn/D,GAAS6H,QAAQhU,IAAIk0B,GAC1CA,EAAElsB,KAAOkM,EAAQlM,IAAE/J,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACVi2B,GAAC,IAAE3f,UAAWxW,EAAOwsE,QAAQ,IAClCr2C,GAEN00C,GAAc0C,IAEhB9qE,YAAY,oBAKlB5B,EAAAA,GAAAA,MAACtH,GAAO,CAACiI,MAAO,CAACi7F,oBAAqB,aAAa77F,SAAA,EACjDC,EAAAA,GAAAA,MAACnH,GAAS,CAAAkH,SAAA,EACRD,EAAAA,GAAAA,KAAC/G,GAAK,CAACG,UAAQ,EAAA6G,SAAC,sBAChBD,EAAAA,GAAAA,KAACu9C,GAAU,CACTxnC,UAAS,MAAA1M,OAAQwiB,EAAQ,EAAC,cAC1BxsB,MAAO,CAAC2hG,IAEyB,IAADC,EAA9B,OAAuB,IAAnBzrF,EAAQq2D,OACiB,QAA3Bo1B,EAAOzrF,EAAQ6e,oBAAY,IAAA4sE,EAAAA,EAAI,GAGN,QAA3BD,EAAOxrF,EAAQ6e,oBAAY,IAAA2sE,EAAAA,EAAKxrF,EAAQ8P,oBAAsB9P,EAAQ8P,oBAAoByN,MAAM,KAAK,GAAK,EAC3G,EAPM,GAQPp5B,WAAY6T,GAAiB,WAADnE,OAAYwiB,EAAQ,EAAC,eACjDjyB,SAAUmvE,GACVtnE,SAAWpC,IACT,MAAMutE,EAAiBn/D,GAAS6H,QAAQhU,IAAIk0B,GAC1CA,EAAElsB,KAAOkM,EAAQlM,IAAE/J,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACVi2B,GAAC,IAAEnB,aAAch1B,EAAOwsE,QAAQ,IACrCr2C,GAEN00C,GAAc0C,IAEhB9qE,YAAY,iCAIhB5B,EAAAA,GAAAA,MAACnH,GAAS,CAAC,wBAAmB8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EAC1DC,EAAAA,GAAAA,MAACiuC,GAAc,CAAAluC,SAAA,EACbD,EAAAA,GAAAA,KAACquC,GAAS,CAAApuC,SAAC,oBACXD,EAAAA,GAAAA,KAACuuC,GAAiB,CAChBn2C,KAAK,SACLq2C,SAAU,MACR,MAAMzzB,EAAYxF,EAAQiQ,kBAAoB,GAC9C,OAAOzmB,MAAMC,QAAQ+b,IAAcA,EAAU/Z,OAAS,CACvD,EAHS,GAIVd,QAASA,KACP,MAAMysE,EAAiBn/D,GAAS6H,QAAQhU,IAAIk0B,GAC1CA,EAAElsB,KAAOkM,EAAQlM,IAAE/J,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQi2B,GAAC,IAAE/P,iBAAkB,GAAIomD,QAAQ,IAAUr2C,GAExE00C,GAAc0C,IAEhBlsE,MAAM,wBAAeT,UAErBD,EAAAA,GAAAA,KAACsI,EAAAA,EAAC,CAACF,KAAM,WAGbpI,EAAAA,GAAAA,KAACk7F,GAAkB,CACjB77F,MAAO,MACL,MAAMw0B,EAAWre,EAAQiQ,kBAAoBhY,GAASsV,eAAiB,GACvE,MAAwB,kBAAb8Q,GAAyBA,EAASrxB,OACpCqxB,EAASd,MAAM,KAAKzxB,IAAIiwB,GAAKA,EAAE/uB,QAAQ5C,OAAOiZ,SAEhD7Z,MAAMC,QAAQ40B,GAAYA,EAAW,EAC7C,EANM,GAOPj6B,SAAUmvE,GACVtnE,SAAWk6F,IACT,MAAMhtB,EAAgB3vE,MAAMC,QAAQ08F,GAChCA,EAAer6F,IAAIqX,GACG,kBAATA,EAA0BA,EAC9BA,EAAKtZ,OAASsZ,EAAKI,WAAaJ,EAAKrP,IAAMqP,GAEpD,GAEEi0D,EAAiBn/D,GAAS6H,QAAQhU,IAAIk0B,GAC1CA,EAAElsB,KAAOkM,EAAQlM,IAAE/J,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACVi2B,GAAC,IAAE/P,iBAAkBkpD,EAAe9C,QAAQ,IACjDr2C,GAEN00C,GAAc0C,IAEhBxpD,QAASm/B,GACTzgD,YAAY,8DACZ1C,MAAM,YACNhG,UAAU,EACVye,UAAU,EACVvX,MAAMN,EAAAA,GAAAA,KAAC4B,EAAAA,EAAQ,IACfoyF,eAAgBA,GAChBqH,eAAgBA,CAACpH,EAAQ70F,IAAU60F,EAAO50F,OAAS40F,EAAO3qF,IAAM2qF,WAKtEj0F,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EACvCD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,iBACPD,EAAAA,GAAAA,KAAC4uC,GAAQ,CACPvvC,MAAOmW,EAAQkQ,aAAe,GAC9B9rB,SAAUmvE,GACVtnE,SAAWvC,IACT,MAAM0tE,EAAiBn/D,GAAS6H,QAAQhU,IAAIk0B,GAC1CA,EAAElsB,KAAOkM,EAAQlM,IAAE/J,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACVi2B,GAAC,IAAE9P,YAAaxmB,EAAE2C,OAAOxC,MAAOwsE,QAAQ,IAC7Cr2C,GAEN00C,GAAc0C,IAEhB9qE,YAAY,8BACZi8F,KAAM,SAMXt4F,IAAgB,IACfvF,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVa,UAAW,SACXZ,QAAS,OACTI,WAAYk/F,EACR,oDACA,oDACJj/F,OAAQi/F,EAAmB,oBAAsB,oBACjDh/F,aAAc,OACdnB,SAAA,EACAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVkX,WAAY,MACZpW,SAAU,UACVX,MAAO,UACPiX,aAAc,OACd7V,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACL9J,SAAA,EACAD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMG,EAAAA,MAAiB,uCACdorB,EAAQ,KAInC,MAEC,MAAM5Q,EAAcxN,GAASwN,YAC7B,IAAKA,EACH,OAAO,KAGT,IAAK,IAADimF,EACF,MAAMC,EAA6B,kBAAhBlmF,EACfnc,KAAKC,MAAMkc,GACXA,EAUJ,MAJM,OAAHkmF,QAAG,IAAHA,OAAG,EAAHA,EAAKhlB,kBAAmBglB,EAAIhlB,gBAAgBx8E,SAAS,OACrDX,MAAMC,QAAQwO,GAAS+L,SAAW/L,GAAS+L,OAAOvY,OAAS,GAI5D,OAAO,KAIT,MAAMkyD,EAAY39C,EAAQlM,GACpB83F,EAAgBjuC,IAAcprD,OAAOorD,GAAWh+C,WAAW,UAG7DisF,GAA6C,QAA5BF,EAACnuC,GAAiBI,UAAU,IAAA+tC,GAA3BA,EAA6Bl1B,QAEjDxuD,QAAQuqB,UAAUgjC,KAAK,KACrBe,GAAqB3Y,KAKzB,MAAMkuC,EAAStuC,GAAiBI,IAAc,CAAE+Y,UAAW,GAAIF,QAAQ,GAEvE,OACE9rE,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVoX,aAAc,SACdnX,QAAS,OACTI,WAAY,UACZC,OAAQ,oBACRC,aAAc,OACdnB,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVkX,WAAY,MACZ/W,MAAO,UACPiX,aAAc,OACdtW,SAAU,UACV1B,SAAC,4DAGHD,EAAAA,GAAAA,KAACshG,GAAAA,GAAe,CACd9rF,QAASA,EACTw2C,UAAWv+C,GACXy+D,UAAWm1B,EAAOn1B,UAClBq1B,iBAAkBzgC,IAAiB,GACnCr/D,SAAW+/F,IAETxuC,GAAoB1zD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACnBD,GAAI,IACP,CAAC6zD,GAAY,CACX+Y,UAAWs1B,EACXx1B,QAAQ,MAKRo1B,GACFh1B,GAAyBjZ,EAAWquC,GACjCv2B,MAAM1mD,IACLjT,QAAQ5S,MAAM,iEAAoC6lB,GAClD+gC,IAAaA,GAAU,yDAAsC/gC,EAAIzhB,QAAS,cAIlFlJ,WAAY4b,EAAQ+3D,8BAI5B,CAAE,MAAOruE,GAEP,OADAoS,QAAQ5S,MAAM,iEAAkDQ,IAE9DgB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVC,QAAS,OACTI,WAAY,UACZC,OAAQ,oBACRC,aAAc,MACdJ,MAAO,UACPiX,aAAc,QACdhY,SAAA,CAAC,4DACiCf,EAAE4D,UAG1C,CACD,EAlGA,GAqGA,MACC,MAAM4S,EAAUC,WAAWlI,GAASmI,iBAAmB,EACjD6rF,EAAgB9rF,WAAWH,EAAQK,YAAc,EACjD6rF,EAASD,EAAgB/rF,EACzBisF,EAAaD,EAAS,EAE5B,OACExhG,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVK,WAAYygG,EAAa,UAAY,UACrCxgG,OAAO,aAADkI,OAAes4F,EAAa,UAAY,WAC9CvgG,aAAc,MACdN,QAAS,UACTmX,aAAc,OACdtW,SAAU,WACV1B,SAAA,EACAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQw6F,eAAgB,gBAAiB3kF,aAAc,UAAWhY,SAAA,EACvFD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEG,MAAO,WAAYf,SAAC,oCACnCC,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CAAEkX,WAAY,MAAO/W,MAAO,WAAYf,SAAA,CAClDyV,EAAQy9D,eAAe,QAAS,CAAEklB,sBAAuB,EAAGC,sBAAuB,IAAK,kBAG7Fp4F,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQw6F,eAAgB,gBAAiB3kF,aAAc,UAAWhY,SAAA,EACvFD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEG,MAAO,WAAYf,SAAC,mCACnCC,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CAAEkX,WAAY,MAAO/W,MAAO,WAAYf,SAAA,CAClDwhG,EAActuB,eAAe,QAAS,CAAEklB,sBAAuB,EAAGC,sBAAuB,IAAK,kBAGnGp4F,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACTw6F,eAAgB,gBAChBgF,WAAY,SACZ/G,UAAW,oBACX9iF,WAAY,OACZ9X,SAAA,EACAD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEG,MAAO2gG,EAAa,UAAY,WAAY1hG,SACxD0hG,EAAa,wCAAmB,uBAEnCzhG,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CAAEG,MAAO2gG,EAAa,UAAY,WAAY1hG,SAAA,CACxD0hG,EAAa,IAAM,GAAID,EAAOvuB,eAAe,QAAS,CAAEklB,sBAAuB,EAAGC,sBAAuB,IAAK,mBAKxH,EA3CA,IA6CDp4F,EAAAA,GAAAA,MAACtH,GAAO,CAAAqH,SAAA,EACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,EACvCD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,iCACPD,EAAAA,GAAAA,KAACzG,GAAK,CACJ8F,MAAOmW,EAAQoQ,kCAAoC,GACnDhsB,SAAUwvE,GACV3nE,SAAWvC,IACT,MAAM0tE,EAAiBn/D,GAAS6H,QAAQhU,IAAIk0B,GAC1CA,EAAElsB,KAAOkM,EAAQlM,IAAE/J,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACVi2B,GAAC,IAAE5P,iCAAkC1mB,EAAE2C,OAAOxC,MAAOwsE,QAAQ,IAClEr2C,GAEN00C,GAAc0C,IAEhB9qE,YAAY,sDAIhB5B,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,CACtC,MACC,MAAMyV,EAAUC,WAAWlI,GAASmI,iBAAmB,EAEjD+rF,GADgBhsF,WAAWH,EAAQK,YAAc,GACpBH,EACnC,OAAOxV,EAAAA,GAAAA,MAACjH,GAAK,CAACG,SAAUuoG,EAAY9gG,MAAO8gG,EAAa,CAAC3gG,MAAO,UAAW+W,WAAY,OAAS,CAAC,EAAE9X,SAAA,CAAC,4CAA4B0hG,EAAa,wDAA6C,KAC3L,EALA,IAMD3hG,EAAAA,GAAAA,KAAC4uC,GAAQ,CACPvvC,MAAOmW,EAAQM,0BAA4B,GAC3Clc,SAAUwvE,GACVzvE,WAAY6T,GAAiB,WAADnE,OAAYwiB,EAAQ,EAAC,iBACjDpqB,SAAWvC,IACT,MAAM0tE,EAAiBn/D,GAAS6H,QAAQhU,IAAIk0B,GAC1CA,EAAElsB,KAAOkM,EAAQlM,IAAE/J,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACVi2B,GAAC,IAAE1f,yBAA0B5W,EAAE2C,OAAOxC,MAAOwsE,QAAQ,IAC1Dr2C,GAEN00C,GAAc0C,IAEhB9qE,YAAY,4DACZi8F,KAAM,IAEPvwF,GAAiB,WAADnE,OAAYwiB,EAAQ,EAAC,mBACpC7rB,EAAAA,GAAAA,KAAClF,GAAS,CAAAmF,SAAEuN,GAAiB,WAADnE,OAAYwiB,EAAQ,EAAC,yBAMtD,MACC,MAAMlyB,IAAa6T,GAAiB,WAADnE,OAAYwiB,EAAQ,EAAC,qBACxD,OACE3rB,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACEC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVa,UAAW,OACXZ,QAAS,UACTI,WAAYvH,EAAW,UAAY,UACnCwH,OAAQxH,EAAW,oBAAsB,oBACzCyH,aAAc,OACdnB,SAAA,EACAC,EAAAA,GAAAA,MAAA,SAAOW,MAAO,CACZuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACL4vF,OAAQvwB,GAA2B,cAAgB,UACnDznE,SAAU,SACVoW,WAAYqxD,GAA2B,MAAQ,MAC/CpoE,MAAOrH,EAAW,UAAayvE,GAA2B,UAAY,WACtEnpE,SAAA,EACAD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,WACLoJ,QAA+C,IAAtCgU,EAAQ+3D,0BACjB3zE,SAAUwvE,GAChB3nE,SAAWvC,IACT,MAAM49C,EAAW59C,EAAE2C,OAAOL,QAAU,EAAI,EAGxC,GAAiB,IAAbs7C,EAAgB,CAElB,MAAM7hC,EAAcxN,GAASwN,YAC7B,GAAIA,EACF,IACE,MAAMkmF,EAA6B,kBAAhBlmF,EACfnc,KAAKC,MAAMkc,GACXA,EAEJ,GAAiB,QAAV,OAAHkmF,QAAG,IAAHA,OAAG,EAAHA,EAAKx4F,KAAc,CAErB,MAAMwqD,EAAY39C,EAAQlM,GACpB+3F,EAAStuC,GAAiBI,GAC1B+Y,GAAkB,OAANm1B,QAAM,IAANA,OAAM,EAANA,EAAQn1B,YAAa,GAMvC,GAJA56D,QAAQ42B,IAAI,2EAAuDirB,GACnE7hD,QAAQ42B,IAAI,oDAAgCgkC,IAGvCA,GAAkC,IAArBA,EAAUjrE,QAAgBirE,EAAUxzD,MAAMyjD,IAAOA,EAAG0lC,UAAY1lC,EAAGw+B,QAAU,GAE7F,YADAr1C,IAAaA,GAAU,+EAA+D,UAKxF,MAAMw8C,EAAU51B,EAAUrlC,OAAO,CAACmjC,EAAK7N,IAAO6N,GAAOr0D,WAAWwmD,EAAGw+B,SAAW,GAAI,GAC5E8G,EAAgB9rF,WAAWH,EAAQK,YAAc,EAEvD,GAAIisF,EAAUL,EAEZ,YADAn8C,IAAaA,GAAU,sCAADj8C,OAAuBy4F,EAAQ3uB,eAAe,SAAQ,2DAAA9pE,OAAmCo4F,EAActuB,eAAe,SAAQ,aAAQ,UAI9J7hE,QAAQ42B,IAAI,0DACd,CACF,CAAE,MAAOhpC,GAGP,OAFAoS,QAAQ5S,MAAM,wDAAoCQ,QAClDomD,IAAaA,GAAU,gDAAiC,SAE1D,CAEJ,CAEA,IAAIy8C,EAAgB,CAAEx0B,0BAA2BzwB,EAAU+uB,QAAQ,GACnE,GAAiB,IAAb/uB,GAAkBh1C,KAAY0N,EAAQme,6BAA8B,CACtE,MAAMhX,EAAM,IAAID,KACV2sB,EAAO1sB,EAAI2sB,cACXC,EAAQxhC,OAAO4U,EAAI6sB,WAAa,GAAGC,SAAS,EAAG,KAC/CC,EAAM3hC,OAAO4U,EAAIgtB,WAAWF,SAAS,EAAG,KACxC+oC,EAAQzqE,OAAO4U,EAAI81D,YAAYhpC,SAAS,EAAG,KAC3CipC,EAAU3qE,OAAO4U,EAAIg2D,cAAclpC,SAAS,EAAG,KAC/CmpC,EAAU7qE,OAAO4U,EAAIk2D,cAAcppC,SAAS,EAAG,KAC/C8jD,EAAc,GAAAlkF,OAAMggC,EAAI,KAAAhgC,OAAIkgC,EAAK,KAAAlgC,OAAIqgC,EAAG,KAAArgC,OAAImpE,EAAK,KAAAnpE,OAAIqpE,EAAO,KAAArpE,OAAIupE,GAEtEmvB,EAAcpuE,6BAA+B7rB,GAC7Ci6F,EAAcnuE,8BAAgC25D,EAC9Cr/B,GAAY,OAAQ,gBAAiB,eAAe,YAAD7kD,OAAcmM,EAAQlM,GAAE,mBAAAD,OAAkBvB,GAAO,SAAAuB,OAAQkkF,GAC9G,CAEA,MAAM3gB,EAAiBn/D,GAAS6H,QAAQhU,IAAIk0B,GAC1CA,EAAElsB,KAAOkM,EAAQlM,IAAE/J,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACVi2B,GAAMusE,GACXvsE,GAEN00C,GAAc0C,IAEhB/rE,MAAO,CACLrK,MAAO,OACPC,OAAQ,OACRkjG,OAAQvwB,GAA2B,cAAgB,UACnD2zB,YAAa3zB,GAA2B,UAAY,cAGxDlpE,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CAAEshE,KAAM,GAAIliE,SAAA,CAAC,+CACa4rB,EAAQ,KAEP,IAAtCrW,EAAQ+3D,4BACRvtE,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACXc,SAAU,UACVX,MAAO,UACPE,WAAY,UACZJ,QAAS,iBACTM,aAAc,MACd2W,WAAY,OACZ9X,SAAC,+BAON,MACC,MAAMg+F,EAAaiC,EAAuD,IAA1CC,EAAY5yB,0BAA0E,IAAtC/3D,EAAQ+3D,0BAClF9c,EAAYj7C,EAAQlM,KAAOvB,OAAOyN,EAAQlM,IAAI6L,WAAW,SACzD6sF,EAAexsF,EAAQoe,8BAG7B,IAAKqqE,IAAcxtC,IAAcuxC,KAFJv8F,IAAgB,GAE2B,OAAO,KAG/E,MAAMq1E,EAAWtlE,EAAQysF,gCACrB,GAAA54F,OAAGmM,EAAQysF,gCAA+B,KAAA54F,OAAImM,EAAQ0sF,oCAAsC,IAAK1/F,OAChGgT,EAAQme,6BAA+Bk3C,GAAgBr1D,EAAQme,8BAAgC,KAEpG,OACEzzB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVa,UAAW,SACXZ,QAAS,iBACTI,WAAY,UACZC,OAAQ,oBACRC,aAAc,MACdO,SAAU,SACVX,MAAO,WACPf,SAAA,EACAD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,cAAkB,IAAE66E,GAAY,YACvC,KAAI96E,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,WAAW,KACxBD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,WAAe,KAAEi9F,EAAAA,GAAAA,IAAW1nF,EAAQoe,iCAGjD,EA5BA,MA8BFj6B,IACCqG,EAAAA,GAAAA,KAAClF,GAAS,CAAC+F,MAAO,CAAEa,UAAW,UAAWzB,SACvCuN,GAAiB,WAADnE,OAAYwiB,EAAQ,EAAC,yBAKzC,EA5JA,OAiKL7rB,EAAAA,GAAAA,KAACy/F,GAAAA,GAAyB,CAExBtsC,UAAW39C,EAAQlM,GACnBo2F,aAAcjyF,GAASnE,GACvB46D,yBAA0BA,GAC1By4B,SAAU5zB,GACV42B,cAAepzB,GACf9+D,SAAUA,GACV+H,QAASA,EACTg4D,8BAA+BA,GAC/Br8C,SAAUA,GACVmD,YAAa9e,EAAQ8e,aAAe,GACpCurE,oBAAsB3xB,IACpBD,GAA+Bz4D,EAAQlM,GAAI4kE,IAE7C4xB,qBAAuB7wB,IAErBD,GAAgCx5D,EAAQlM,GAAI2lE,IAE9C8wB,oBAAqBxxB,IAAwB,uBAAAllE,OAlBjBwiB,EAAK,KAAAxiB,OAAIoE,GAASnE,MAwB9CkM,EAAQq2D,SACR3rE,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVg6F,UAAW,oBACX+G,WAAY,SACZlgG,UAAW,UACXC,SAAU,UACVX,MAAO,UACPoB,QAAS,OACTw6F,eAAgB,iBAChB38F,SAAA,EACAC,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,mBAAkB,IAAEuV,EAAQm2D,gBAAkBd,GAAgBr1D,EAAQ0gB,0BAEhFh2B,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,oBAAmB,KAAEi9F,EAAAA,GAAAA,IAAW1nF,EAAQ0d,yBAl3B9C1d,EAAQlM,OAnBlBpJ,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVM,OAAQ,qBACRC,aAAc,MACdN,QAAS,OACTC,UAAW,SACXC,MAAO,UACPE,WAAY,WACZjB,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,UAAWsW,aAAc,UAAWhY,SAAC,kBAC7DD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAOE,aAAc,UAAWhY,SAAC,4CAC3DD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,YAAa1B,SAAC,uCAu4BxC8oE,KACA7oE,EAAAA,GAAAA,MAAA,UACE9H,KAAK,SACL+H,QAASA,KACP,MAAMsrE,EAAcxiC,GAAoB,IAAIvsB,MACtC4wD,EAAa,CACjBhkE,GAAG,QAADD,OAAUqT,KAAKC,OACjBwJ,cAAe1Y,GAASnE,GACxBic,kBAAmBkmD,EACnBjmD,YAAa,EACb3P,UAAW,GACXsP,cAAe,GACfM,iBAAkBzmB,MAAMC,QAAQwO,GAASsV,eAAiBtV,GAASsV,cAAgB,GACnF2C,YAAa,GACb2O,aAAc,GACd6B,qBAAsBpuB,GACtB6jE,eAAgBd,GAAgB/iE,IAChCorB,cAAc,IAAIxW,MAAOsY,cACzB42C,eAAgB,KAChBhtD,QAAS,EACTitD,QAAQ,EACRjmD,iCAAkC,GAClC9P,yBAA0B,GAC1By3D,0BAA2B,GAEvBb,EAAiB1tE,MAAMC,QAAQwO,GAAS6H,SAAW7H,GAAS6H,QAAU,GAC5E40D,GAAc,IAAIwC,EAAgBY,IAClC5R,GAAkB4R,GAClB1R,GAAmB,CACjBr2C,kBAAmBkmD,EACnBjmD,YAAa,EACb3P,UAAW,GACXsP,cAAe,GACfM,iBAAkBhY,GAASsV,eAAiB,GAC5C2C,YAAa,GACb2O,aAAc,GACdzO,iCAAkC,GAClC9P,yBAA0B,GAC1By3D,0BAA2B,KAG/B1sE,MAAO,CACLrK,MAAO,OACPkL,UAAW,OACXZ,QAAS,OACTI,WAAY,cACZF,MAAO,UACPG,OAAQ,qBACRC,aAAc,MACdO,SAAU,SACVoW,WAAY,MACZ4hF,OAAQ,UACRv3F,QAAS,OACT4/D,WAAY,SACZ46B,eAAgB,SAChB7yF,IAAK,SACLwuF,WAAY,iBAEduB,aAAe56F,IACbA,EAAEyU,cAAc9S,MAAMK,WAAa,2BACnChC,EAAEyU,cAAc9S,MAAM6L,YAAc,WAEtCqtF,aAAe76F,IACbA,EAAEyU,cAAc9S,MAAMK,WAAa,cACnChC,EAAEyU,cAAc9S,MAAM6L,YAAc,WACpCzM,SAAA,EAEFD,EAAAA,GAAAA,KAAC4J,EAAAA,EAAI,CAACxB,KAAM,KAAM,0CAQzBqF,GAAS6H,SAAW7H,GAAS6H,QAAQrU,OAAS,GAAKwM,GAASqmB,cAAgBrmB,GAASsmB,qBACpF7zB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVa,UAAW,SACXZ,QAAS,OACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdJ,MAAO,UACPW,SAAU,YACV1B,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAOE,aAAc,WAAYhY,SAAC,yCAG5DC,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,4BAA0B,KAAEi9F,EAAAA,GAAAA,IAAWzvF,GAASsmB,oBAAoB,YAAG/zB,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,eAAmB,IAAE4qE,GAAgBp9D,GAASqmB,8BAS/I,IACH,EA5vCA,GA+vCA,MACC,MAAM0K,EAAa,MACjB,MAAM4rC,EAAsBnwD,GAAmBI,KAAKC,GAClDA,EAAI1B,MAAQnL,GAAS4L,oBACrBiB,EAAIjb,QAAUoO,GAAS4L,oBAGzB,QADiC,OAAnB+wD,QAAmB,IAAnBA,OAAmB,EAAnBA,EAAqB7sE,QAAS,IAC/BgtB,cAAc5qB,SAAS,WACrC,EAPkB,GAQbsoE,EAAax6D,GAAS6H,SAAW7H,GAAS6H,QAAQrU,OAAS,EAEjE,OADuBu9B,GAA+B,IAAjB/4B,KAAuB6gE,KAAsB2B,IAEhF/nE,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACViX,OAAQ,SACRhX,QAAS,eACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdJ,MAAO,WACPf,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAOE,aAAc,SAAU7V,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,UAAW9J,SAAC,0DAGjHC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,YAAa1B,SAAA,CAAC,uJACiED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,2BAAuB,+GAI3I,EA5BA,IA+BCyF,IAA+B,IAAjBD,KAAuBgI,GAAS6H,SAAW7H,GAAS6H,QAAQrU,OAAS,IACnFf,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACViX,OAAQ,SACRhX,QAAS,eACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdJ,MAAO,WACPf,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAOE,aAAc,SAAU7V,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,UAAW9J,SAAC,4DAGjHC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,YAAa1B,SAAA,CAClCwN,GAASqmB,cAAgBrmB,GAASsmB,qBACjC7zB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEoX,aAAc,UAAWhY,SAAA,EACrCD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,yBAAwB,IAAE4qE,GAAgBp9D,GAASqmB,cAC1D,YACD9zB,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,WAAe,KAAEi9F,EAAAA,GAAAA,IAAWzvF,GAASsmB,uBAE/C,sIACmF/zB,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,2BAAuB,WASxH8N,IAAqB6uB,GAAiBnvB,GAASukB,kBAAmB,gBAClE4K,GAAiBnvB,GAASukB,kBAAmB,kBAAoB4K,GAAiBnvB,GAASukB,kBAAmB,eAC/G,OASGvkB,GAASnE,IACmC,IAA5CmE,GAAS0mB,gCACTyI,GAAiBnvB,GAASukB,kBAAmB,aAH/C,MAMMmwE,GAA0Bn5B,GAAe3yD,QAK/C,OACAnW,EAAAA,GAAAA,MAAC3H,GAAW,CAAC,eAAa,YAAW0H,SAAA,EACnCC,EAAAA,GAAAA,MAAC0D,GAAa,CACZ6oC,aAAa,oBACbv1B,UAAU,EACVrW,MAAO,CACLK,WAAY,oDACZwL,YAAa,WACbzM,SAAA,EAEFC,EAAAA,GAAAA,MAACzH,GAAY,CAACg0C,aAAa,oBAAoB5rC,MAAO,CAAEG,MAAO,OAAQoB,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,UAAW9J,SAAA,EAC5HD,EAAAA,GAAAA,KAAC4L,GAAW,CAAC6gC,aAAa,oBAAoB5rC,MAAO,CAAEG,MAAO,QAASf,UACrED,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMG,EAAAA,QACX,sCAGhBT,EAAAA,GAAAA,KAACmtC,GAAe,CAACtsC,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,WAAY9J,UAChFD,EAAAA,GAAAA,KAACgtC,GAAY,CACXE,UAAWljB,GAAcwV,UACzBr/B,QAASA,IAAM03B,GAAc,aAC7Bh3B,MAAO,CAAEG,MAAO,OAAQ24F,OAAQ,WAAY15F,UAE5CD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM26F,EAAAA,cAK7Bj7F,EAAAA,GAAAA,KAACutC,GAAc,CAACL,UAAWljB,GAAcwV,UAAUv/B,UACjDC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEC,QAAS,UAAWb,SAAA,EAEhCC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVK,WAAY,UACZC,OAAQ,oBACRC,aAAc,MACdN,QAAS,OACTmX,aAAc,UACdhY,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAO/W,MAAO,UAAWiX,aAAc,WAAYhY,SAAC,uEAG9EC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,WAAYX,MAAO,UAAWgX,WAAY,OAAQ/X,SAAA,CAAC,mDAEzEC,EAAAA,GAAAA,MAAA,MAAIW,MAAO,CAAEa,UAAW,SAAU8hE,WAAY,SAAU4+B,UAAW,OAAQtE,YAAa,GAAI79F,SAAA,EAC1FC,EAAAA,GAAAA,MAAA,MAAIW,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAU/pD,aAAc,UAAWhY,SAAA,CAAC,2BAC9DwN,GAASuoB,cAAeknE,EAAAA,GAAAA,IAAWzvF,GAASuoB,cAAgB,GAAG,WAAIvoB,GAASwnB,gBAAkB41C,GAAgBp9D,GAASwnB,iBAAmB,GAAG,QAE7J/0B,EAAAA,GAAAA,MAAA,MAAIW,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAU/pD,aAAc,UAAWhY,SAAA,CAAC,qCACpDwN,GAASklB,aAAcuqE,EAAAA,GAAAA,IAAWzvF,GAASklB,aAAe,GAAG,WAAIllB,GAASolB,cAAgBg4C,GAAgBp9D,GAASolB,eAAiB,GAAG,QAEjK3yB,EAAAA,GAAAA,MAAA,MAAIW,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAU/pD,aAAc,UAAWhY,SAAA,CAAC,sCAChDwN,GAAS+b,cAAegtE,EAAAA,GAAAA,IAAe/oF,GAAS+b,cAAgB,GAAG,WAAI/b,GAAS+lB,sBAAwBq3C,GAAgBp9D,GAAS+lB,uBAAyB,GAAG,QAE3LtzB,EAAAA,GAAAA,MAAA,MAAIW,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAU/pD,aAAc,UAAWhY,SAAA,CAAC,wBAC3DwN,GAASgc,eAA4C,eAA3Bhc,GAASgc,cAA8B,IAAApgB,QAC5EmtF,EAAAA,GAAAA,IAAe/oF,GAASgc,eAAc,YAAApgB,OAAMoE,GAASgmB,aAAeo3C,GAAgBp9D,GAASgmB,cAAgB,GAAE,KACnH,2DAEJvzB,EAAAA,GAAAA,MAAA,MAAIW,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAU/pD,aAAc,UAAWhY,SAAA,CAAC,qBAC9DwN,GAASsmB,oBAAqBmpE,EAAAA,GAAAA,IAAWzvF,GAASsmB,oBAAsB,GAAG,WAAItmB,GAASqmB,aAAe+2C,GAAgBp9D,GAASqmB,cAAgB,GAAG,OAGlKrmB,GAAS6H,SAAW7H,GAAS6H,QAAQrU,OAAS,GAAKwM,GAAS6H,QAAQhU,IAAI,CAACkU,EAASqW,KACjF,MAAMw2E,EAAoD,IAAtC7sF,EAAQ+3D,0BACtBuN,EAAWtlE,EAAQysF,gCACrB,GAAA54F,OAAGmM,EAAQysF,gCAA+B,KAAA54F,OAAImM,EAAQ0sF,oCAAsC,IAAK1/F,OAChGgT,EAAQme,6BAA+Bk3C,GAAgBr1D,EAAQme,8BAAgC,GAC9FgQ,EAAQnuB,EAAQoe,+BAAgCspE,EAAAA,GAAAA,IAAW1nF,EAAQoe,+BAAiC,GAE1G,OACE1zB,EAAAA,GAAAA,MAAA,MAA8BW,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAU/pD,aAAc,UAAWhY,SAAA,CACpGoiG,EAAc,SAAM,eAAK,wCAA2Bx2E,EAAQ,EAAE,IAAE8X,EAAK,IAAAt6B,OAAOs6B,EAAK,YAAAt6B,OAAMyxE,EAAQ,KAAM,KAD/FtlE,EAAQlM,IAAMuiB,SAM7B7rB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEa,UAAW,UAAWqW,WAAY,OAAQ9X,SAAC,+EAO5D,MACC,MAAMyV,EAAUC,WAAWlI,GAASmI,iBAAmB,EACjD0sF,EAAgB70F,GAAS6H,QAAU7H,GAAS6H,QAAQuxB,OAAO,CAACmjC,EAAKx0D,IAE9Dw0D,GADQr0D,WAAWH,EAAQK,YAAc,GAE/C,GAAK,EAEF6rF,EAASY,EAAgB5sF,EAI/B,OAHmBgsF,EAAS,GAGG,IAAZhsF,GAAmC,IAAlB4sF,GAGlCpiG,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVK,WAAY,oDACZC,OAAQ,oBACRC,aAAc,OACdN,QAAS,OACTmX,aAAc,SACdigF,UAAW,qCACX91F,QAAS,OACT4/D,WAAY,aACZj4D,IAAK,WACL9J,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,SAAUD,UAAW,UAAWzB,SAAC,kBACzDC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEshE,KAAM,GAAIliE,SAAA,EACtBD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAOpW,SAAU,OAAQX,MAAO,UAAWiX,aAAc,UAAWhY,SAAC,yFAG/FC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACT05F,oBAAqB,YACrB/xF,IAAK,cACLpI,SAAU,WACVX,MAAO,UACPiX,aAAc,WACdhY,SAAA,EACAD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEkX,WAAY,OAAQ9X,SAAC,uCACpCC,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CAAEohE,WAAY,YAAalqD,WAAY,MAAOhX,UAAW,SAAUd,SAAA,CAAEyV,EAAQy9D,eAAe,SAAS,eAElHnzE,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEkX,WAAY,OAAQ9X,SAAC,iDACpCC,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CAAEohE,WAAY,YAAalqD,WAAY,MAAOhX,UAAW,SAAUd,SAAA,CAAEqiG,EAAcnvB,eAAe,SAAS,eAExHnzE,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEkX,WAAY,OAAQ9X,SAAC,gCACpCC,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CAAEohE,WAAY,YAAalqD,WAAY,MAAO/W,MAAO,UAAWD,UAAW,SAAUd,SAAA,CAAC,IAC/FyhG,EAAOvuB,eAAe,SAAS,iBAGpC1lE,GAASqI,2BACR9V,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVg6F,UAAW,oBACX+G,WAAY,UACZjgG,SAAU,WACVX,MAAO,WACPf,UACAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEmX,WAAY,OAAQ/X,SAAA,EAChCD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEkX,WAAY,OAAQ9X,SAAC,wBACnC,KACDC,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CAAE+3F,UAAW,UAAW34F,SAAA,CAAC,IAClCwN,GAASqI,yBAAyB,kBAjDc,IAyDjE,EApEA,IAuED9V,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAAEy6F,WAAY,UAAWr7F,SAAA,EACzCD,EAAAA,GAAAA,KAAC/G,GAAK,CAAAgH,SAAC,oDACPD,EAAAA,GAAAA,KAAC4uC,GAAQ,CACPvvC,MAAOoO,GAASymB,oBAAsB,GACtCzyB,SAAWvC,GAAMC,GAAkB,qBAAsBD,EAAE2C,OAAOxC,OAClEyC,YAAY,gEACZi8F,KAAM,EACNnkG,SAAUuoG,EACVthG,MAAO,CACLK,WAAYihG,EAAyB,eAAYhoF,EACjDw/E,OAAQwI,EAAyB,mBAAgBhoF,EACjD0yB,QAASs1D,EAAyB,GAAM,WAOhDniG,EAAAA,GAAAA,KAACpH,GAAO,CAACiI,MAAO,CAAEa,UAAW,UAAWzB,UACtCD,EAAAA,GAAAA,KAACjH,GAAS,CAAC8H,MAAO,CAAEy6F,WAAY,UAAWr7F,UACzCC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVK,WAAYihG,EAAyB,UAAY,UACjDhhG,OAAO,aAADkI,OAAe84F,EAAyB,UAAY,WAC1D/gG,aAAc,MACdN,QAAS,UACT+rC,QAASs1D,EAAyB,GAAM,GACxCliG,SAAA,EACAC,EAAAA,GAAAA,MAAA,SAAOW,MAAO,CACZuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,OACL4vF,OAAQwI,EAAyB,cAAgB,UACjDxgG,SAAU,OACVoW,WAAY,MACZ/W,MAAOyM,GAASumB,YAAc,UAAY,UAC1C6Y,QAASp/B,GAASumB,YAAc,GAAM,GACtC/zB,SAAA,EACAD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,WACLoJ,QAC8C,IAA5CiM,GAAS0mB,iCACmC,IAA5C1mB,GAAS0mB,gCACTyI,GAAiBnvB,GAASukB,kBAAmB,aAE/CvwB,SAAWvC,IACTC,GAAkB,iCAAkCD,EAAE2C,OAAOL,QAAU,EAAI,IAE7EpI,UAAQ,EACRQ,SAAUgjC,GAAiBnvB,GAASukB,kBAAmB,aACvDnxB,MAAO,CACLrK,MAAO,OACPC,OAAQ,OACRkjG,OAAQwI,EAAyB,cAAgB,UACjDpF,YAAa,cAGjB78F,EAAAA,GAAAA,MAAA,QAAAD,SAAA,CAAM,kEAEJD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEG,MAAO,UAAWwiE,WAAY,WAAYvjE,SAAC,aAG9DD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVc,SAAU,WACVX,MAAOmhG,EAAyB,UAAY,UAC5CzgG,UAAW,UACX8hE,WAAY,UACZvjE,SACCkiG,GACCjiG,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACEC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVkX,WAAY,MACZ3V,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,SACLkO,aAAc,UACdhY,SAAA,EACAD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEc,SAAU,UAAW1B,SAAC,kBACrCD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,wDAEVD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,SAAUX,MAAO,UAAWgX,WAAY,OAAQ/X,SAAC,sIAK3E,wHAUjB,EA3QA,IAiRuB,EAqBvB28B,GAAiBnvB,GAASukB,kBAAmB,mBAAqBvkB,GAASkmB,+BAC1EzzB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACViX,OAAQ,SACRhX,QAAS,eACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdJ,MAAO,WACPf,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAOE,aAAc,SAAU7V,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,UAAW9J,SAAC,8GAGjHC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,YAAa1B,SAAA,CAAC,6MAEnCwN,GAAS6H,SAAW7H,GAAS6H,QAAQrU,OAAS,IAC7Cf,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEa,UAAW,UAAWzB,SAAA,EAClCD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,yBAA6B,IAAEwN,GAAS6H,QAAQrU,iBAQhE8M,KACA6uB,GAAiBnvB,GAASukB,kBAAmB,kBAAoB4K,GAAiBnvB,GAASukB,kBAAmB,eAC/GvkB,GAASkmB,+BACRiJ,GAAiBnvB,GAASukB,kBAAmB,eAC7C9xB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACViX,OAAQ,SACRhX,QAAS,SACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdL,UAAW,UACXd,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,OAAQsW,aAAc,QAAShY,SAAC,YACxDD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAO/W,MAAO,UAAWiX,aAAc,UAAWtW,SAAU,UAAW1B,SAAC,qDAGlGD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,WAAYX,MAAO,UAAWgX,WAAY,OAAQ/X,SAAC,6HAG3ED,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,WAAYX,MAAO,UAAWU,UAAW,UAAWk3F,UAAW,UAAW34F,SAAC,iGAOrGyF,IAAcD,IAAgB,KAAOgI,GAAS2e,iBAAsE,SAAhB,QAAnC84B,GAAAz3C,GAAS6b,kCAA0B,IAAA47B,QAAA,EAAnCA,GAAqC1wB,aACtGt0B,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACViX,OAAQ,SACRhX,QAAS,eACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdJ,MAAO,WACPf,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAOE,aAAc,SAAU7V,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,UAAW9J,SAAC,kEAGjHC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,YAAa1B,SAAA,CAAC,6LAEnCwN,GAAS0b,iBACRjpB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEa,UAAW,UAAWzB,SAAA,EAClCD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,0BAAwB,IAAE,MAEhC,MAAM2oC,EAAUn7B,GAAS0b,eAAe4J,MAAM,KAAK,IAC5CsW,EAAME,EAAOG,GAAOd,EAAQ7V,MAAM,KACzC,MAAM,GAAN1pB,OAAUqgC,EAAG,MAAArgC,OAAKkgC,EAAK,MAAAlgC,OAAKggC,EAC7B,EALiC,GAMjC57B,GAASolB,gBACR3yB,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,CACG,YACDD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,aAAiB,IAAE4qE,GAAgBp9D,GAASolB,4BAsKjE,QAiHJplB,GAASnE,KAIRpJ,EAAAA,GAAAA,MAAC3H,GAAW,CAAC,eAAa,UAAS0H,SAAA,EACjCC,EAAAA,GAAAA,MAAC0D,GAAa,CACZ6oC,aAAcq5B,GAAgB,WAC9B5uD,SAAUvJ,GAAgB,WAAW1N,SAAA,EAErCC,EAAAA,GAAAA,MAACzH,GAAY,CAACg0C,aAAcq5B,GAAgB,WAAW7lE,SAAA,EACrDD,EAAAA,GAAAA,KAAC4L,GAAW,CAAC6gC,aAAcq5B,GAAgB,WAAW7lE,UACpDD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM4X,EAAAA,QACX,kCAGbwvD,KACC1nE,EAAAA,GAAAA,KAACqtC,GAAW,CAAC3sC,MAAM,qHAAoFT,SAAC,qBAK5GD,EAAAA,GAAAA,KAACgtC,GAAY,CACXE,UAAWljB,GAAczS,QACzBk1B,aAAcq5B,GAAgB,WAC9B3lE,QAASA,IAAM03B,GAAc,WAC7Bh3B,MAAO,CAAE84F,OAAQ,WAAY15F,UAE7BD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM26F,EAAAA,YAG3Bj7F,EAAAA,GAAAA,KAACutC,GAAc,CAACL,UAAWljB,GAAczS,QAAQtX,UAC/CD,EAAAA,GAAAA,KAACpH,GAAO,CAAAqH,UACNC,EAAAA,GAAAA,MAACnH,GAAS,CAAC8H,MAAO,CAACy6F,WAAY,UAAUr7F,SAAA,CAEtCynE,KACCxnE,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVK,WAAY,UACZC,OAAQ,oBACRC,aAAc,MACdN,QAAS,OACTmX,aAAc,OACd7V,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,WACL9J,SAAA,EACAD,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAEc,SAAU,UAAW1B,SAAC,kBACrCC,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACED,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAO/W,MAAO,UAAWiX,aAAc,WAAYhY,SAAC,4DAG9ED,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,WAAYX,MAAO,WAAYf,SAAC,mGAQ9DC,EAAAA,GAAAA,MAAA,OACEW,MAAO,CACLM,OAAO,cAADkI,OAAgBq+D,GAAkB,UAAahtC,GAAW,UAAY,WAC5Et5B,aAAc,MACdN,QAAS,OACTC,UAAW,SACXuiE,gBAAiBoE,GAAkB,UAAahtC,GAAW,2BAA6B,2BACxFziB,aAAc,OACdsgF,WAAY,gBACZoB,OAAQjyB,GAAkB,cAAgB,UAC1C76B,QAAS66B,GAAkB,GAAM,EACjCo1B,cAAep1B,GAAkB,OAAS,QAE5C9vD,OAAS1Y,IACHwoE,KACJxoE,EAAEuU,iBACFvU,EAAEkB,kBACF05B,IAAY,GA5qWV56B,KACtBA,EAAEuU,iBACFvU,EAAEkB,kBACF05B,IAAY,GAEZ,MAAM9lB,EAAQ9U,EAAEgV,aAAaF,MAEzBA,GAASA,EAAM/S,OAAS,GAC1BogF,GAAiBrtE,IAqqWCuuF,CAAerjG,KAEjByY,WAAazY,IACPwoE,KACJxoE,EAAEuU,iBACFvU,EAAEkB,kBACF05B,IAAY,KAEdriB,YAAcvY,IACRwoE,KACJxoE,EAAEuU,iBACFvU,EAAEkB,kBACF05B,IAAY,KAEdpiB,YAAcxY,IACRwoE,KACJxoE,EAAEuU,iBACFvU,EAAEkB,kBAEGlB,EAAEyU,cAAcC,SAAS1U,EAAE2U,gBAC9BimB,IAAY,KAGhB35B,QAASA,KAAOunE,IAAmBx0D,SAASsvF,eAAe,aAAanuF,QAAQpU,SAAA,CAE/Eq2D,IACCt2D,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVrK,MAAO,OACPC,OAAQ,OACR0K,OAAQ,oBACR05F,UAAW,oBACXz5F,aAAc,MACdqhG,UAAW,0BACX3qF,OAAQ,uBAGV9X,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVc,SAAU,OACVsW,aAAc,OACdjX,MAAO05B,GAAW,UAAY,UAC9B69D,WAAY,mBACZt4F,SAAC,kBAILD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVc,SAAU,OACVoW,WAAY,MACZE,aAAc,SACdjX,MAAO05B,GAAW,UAAY47B,GAAiB,UAAY,WAC3Dr2D,SACCq2D,GAAiB,4BAAwB57B,GAAW,yBAAsB,yCAE7Ex6B,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,WAAYX,MAAO,UAAWiX,aAAc,QAAShY,SAAA,CAAC,oHACAD,EAAAA,GAAAA,KAAA,UAC5EE,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CAAEc,SAAU,SAAUX,MAAO,WAAYf,SAAA,CAAC,gFACUD,EAAAA,GAAAA,KAAA,SAAK,2CAC7CA,EAAAA,GAAAA,KAAA,SAAK,2DAC0BA,EAAAA,GAAAA,KAAA,SAAK,+CACjBA,EAAAA,GAAAA,KAAA,SAAK,6CACPA,EAAAA,GAAAA,KAAA,SAAK,sDACCA,EAAAA,GAAAA,KAAA,SAAK,wCAChBA,EAAAA,GAAAA,KAAA,SAAK,yCAI5CA,EAAAA,GAAAA,KAAA,UACE5H,KAAK,SACLwB,SAAU8tE,GACV7mE,MAAO,CACLa,UAAW,OACXR,WAAYwmE,GAAkB,UAAY,UAC1C1mE,MAAO,QACPG,OAAQ,OACRC,aAAc,MACdN,QAAS,cACTa,SAAU,WACVoW,WAAY,MACZ4hF,OAAQjyB,GAAkB,cAAgB,UAC1C76B,QAAS66B,GAAkB,GAAM,GAEnCvnE,QAAUjB,IACJwoE,KACJxoE,EAAEkB,kBACF8S,SAASsvF,eAAe,aAAanuF,UACrCpU,SACH,eAMHD,EAAAA,GAAAA,KAAA,SACEsJ,GAAG,YACHlR,KAAK,OACLyf,UAAQ,EACR6qF,OAAO,uDACPjhG,SAAU6S,GACV1a,SAAU8tE,GACV7mE,MAAO,CAAEuB,QAAS,UAInBkyB,IAAeA,GAAY10B,OAAOuf,GAA0B,SAArBoiE,GAAcpiE,IAAele,OAAS,IAC5Ef,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEa,UAAW,QAASzB,SAAA,EAChCC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACTw6F,eAAgB,gBAChB56B,WAAY,SACZ/pD,aAAc,QACdhY,SAAA,EACAC,EAAAA,GAAAA,MAACjH,GAAK,CAAAgH,SAAA,CAAC,+BACSD,EAAAA,GAAAA,KAAA,UAAAC,SAASq0B,GAAY10B,OAAOuf,GAA0B,SAArBoiE,GAAcpiE,IAAele,SAAgB,mBACnFjB,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAACG,MAAO,WAAWf,UAACD,EAAAA,GAAAA,KAAA,UAAAC,SAASq0B,GAAY10B,OAAO41B,GAA0B,SAArB+rD,GAAc/rD,IAA8B,aAAbA,EAAElU,QAAuBrgB,WAAuB,iBAChJjB,EAAAA,GAAAA,KAAA,UAAAC,SAAS,MACjB,MAAMwhF,EAAYntD,GACf10B,OAAO41B,GAA0B,SAArB+rD,GAAc/rD,IAA8B,aAAbA,EAAElU,QAC7CulB,OAAO,CAACmjC,EAAKx0C,IAAMw0C,GAAOx0C,EAAEptB,MAAQ,GAAI,GAC3C,OAAOq5E,EAAY,EAAC,GAAAp4E,QAAOo4E,EAAY,KAAO,MAAM7kC,QAAQ,GAAE,OAAQ,MACvE,EALkB,SAQrB18C,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEuB,QAAS,OAAQ4/D,WAAY,SAAUj4D,IAAK,UAAW9J,SAAA,EAEnED,EAAAA,GAAAA,KAAA,UACE5H,KAAK,SACL+H,QAASA,IAAMikF,IAAkC,GACjDxqF,SAAU48D,GACV31D,MAAO,CACLK,WAAY,UACZF,MAAO,QACPG,OAAQ,OACRC,aAAc,MACdN,QAAS,WACTa,SAAU,WACVg4F,OAAQnjC,GAA4B,cAAgB,UACpDp0D,QAAS,OACT4/D,WAAY,SACZ46B,eAAgB,SAChB/vD,QAAS2pB,GAA4B,GAAM,GAE7C91D,MAAM,qIAA8GT,UAEpHD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMqiG,EAAAA,SAIzB3iG,EAAAA,GAAAA,KAAA,UACE5H,KAAK,SACL+H,QAASyqE,GACT/pE,MAAO,CACLK,WAAY,UACZF,MAAO,QACPG,OAAQ,OACRC,aAAc,MACdN,QAAS,WACTa,SAAU,WACVg4F,OAAQ,UACRv3F,QAAS,OACT4/D,WAAY,SACZ46B,eAAgB,UAElBl8F,MAAM,6LAA6GT,UAEnHD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMsiG,EAAAA,SAIzB5iG,EAAAA,GAAAA,KAAA,UACE5H,KAAK,SACL+H,QAASA,IAAMqmF,IAAyB,GACxC3lF,MAAO,CACLK,WAAY,UACZF,MAAO,QACPG,OAAQ,OACRC,aAAc,MACdN,QAAS,WACTa,SAAU,WACVg4F,OAAQ,UACRv3F,QAAS,OACT4/D,WAAY,SACZ46B,eAAgB,UAElBl8F,MAAM,0IAAmFT,UAEzFD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM4H,EAAAA,SAIvBw/D,KACA1nE,EAAAA,GAAAA,KAAA,UACE5H,KAAK,SACL+H,QAASgnF,GACTtmF,MAAO,CACLK,WAAY,UACZF,MAAO,QACPG,OAAQ,OACRC,aAAc,MACdN,QAAS,kBACTa,SAAU,UACVg4F,OAAQ,WACR15F,SACH,+BAMNq0B,GAAY10B,OAAOuf,GAA0B,SAArBoiE,GAAcpiE,IAAe7d,IAAI,CAACktD,EAAM3iC,KAAK,IAAAg3E,EAAAC,EAAA,OACpE5iG,EAAAA,GAAAA,MAAA,OAAmBW,MAAO,CACxBuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACLjJ,QAAS,UACTK,OAAO,aAADkI,OAAe2+E,GAAmBx5B,IACxCptD,aAAc,MACdkiE,gBAAiB2kB,GAAuBz5B,GACxCv2C,aAAc,SACd40B,QAAyB,cAAhB2hB,EAAKltC,OAAyB,GAAM,GAC7CrhB,SAAA,EAEAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVrK,MAAO,OACPC,OAAQ,OACR2L,QAAS,OACT4/D,WAAY,SACZ46B,eAAgB,SAChB16B,WAAY,EACZr7D,SAAU,YACV5G,SAAA,EACAD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CACdC,MAA2B,IAArBkuD,EAAKsZ,YAAwBi7B,EAAAA,IAAoBC,EAAAA,IACvDniG,MAAO,CACLG,OAA4B,IAArBwtD,EAAKsZ,YAAwB,UAA6B,aAAhBtZ,EAAKltC,OAAwB,UAAY,UAC1F3f,SAAU,UAGG,cAAhB6sD,EAAKltC,SACJthB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVgG,SAAU,WACV+L,IAAK,OACL5L,MAAO,OACPxQ,MAAO,OACPC,OAAQ,OACR6sE,gBAAiB,UACjBliE,aAAc,MACdqhG,UAAW,6BAGE,aAAhBj0C,EAAKltC,SACJthB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVgG,SAAU,WACV+L,IAAK,OACL5L,MAAO,OACPxQ,MAAO,OACPC,OAAQ,OACR6sE,gBAAiB,UACjBliE,aAAc,aAMpBlB,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEshE,KAAM,EAAG86B,SAAU,GAAIh9F,SAAA,EACnCD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVkX,WAAY,MACZpW,SAAU,WACVX,MAAO,UACPiX,aAAc,OACdhY,UAEAC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACL9J,SAAA,EAEAC,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CACXk6F,SAAU,SACVkI,aAAc,WACd9K,WAAY,SACZh2B,KAAM,EACN86B,SAAU,EACVp2F,SAAU,YACV5G,SAAA,CACCuuD,EAAKvlD,MAEJulD,EAAKuZ,cACL/nE,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACXG,MAAO,UACPW,SAAU,SACVoW,WAAY,OACZlR,SAAU,WACV+L,IAAK,OACL4wD,WAAY,OACZvjE,SAAC,UAOe,IAArBuuD,EAAKsZ,cACJ9nE,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACXG,MAAO,UACPW,SAAU,SACVoW,WAAY,OACZurD,gBAAiB,UACjBxiE,QAAS,UACTM,aAAc,MACd8gE,WAAY,GACZjiE,SAAC,4BAMJuuD,EAAKo0B,cACJ5iF,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACXG,MAAO,UACPW,SAAU,SACVoW,WAAY,OACZurD,gBAAiB,UACjBxiE,QAAS,UACTM,aAAc,MACd8gE,WAAY,GACZjiE,SAAC,iBAMLC,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CACXG,MAAO,UACP+W,WAAY,SACZpW,SAAU,UACVugE,WAAY,GACZjiE,SAAA,CAAC,IACC4Q,KAAKqyF,OAAO10C,EAAKi5B,UAAYj5B,EAAKpmD,MAAQ,GAAK,MAAM,UAIxC,aAAhBomD,EAAKltC,QAAyBktC,EAAK6xB,WAClCrgF,EAAAA,GAAAA,KAAA,UACE5H,KAAK,SACL+H,QAASA,IA1yVN5B,WACrC,GAAKooF,EAAWtG,UAAankF,IAAUC,GAAvC,CAMA,GAA+B,WAA3BwqF,EAAWtY,aAA4BsY,EAAWhB,yBAA0B,CAC9E,MACMwd,EAAM,GAAA95F,OADc+a,uCACS/a,OAAGs9E,EAAWhB,0BAEjDz3B,GAAY,OAAQ,cAAe,kBAAkB,kDAAD7kD,OACjBs9E,EAAW19E,KAAI,+BAAAI,OAAwB85F,IAG1E,MAAMC,EAAOlwF,SAASmwF,cAAc,KASpC,OARAD,EAAKE,KAAOH,EACZC,EAAKG,SAAW5c,EAAWhB,yBAC3Byd,EAAKviG,MAAMuB,QAAU,OACrB8Q,SAASsF,KAAKgrF,YAAYJ,GAC1BA,EAAK/uF,QACLnB,SAASsF,KAAKirF,YAAYL,QAE1B99C,GAAU,iCAADj8C,OAAgBs9E,EAAWhB,yBAAwB,yCAAmC,OAEjG,CAEA,IACEz3B,GAAY,OAAQ,cAAe,iBAAiB,mCAAD7kD,OAC5Bs9E,EAAW19E,KAAI,mBAEtC,MAAMw+B,QAAai8D,EAAAA,GAAAA,yBACjBj2F,GAASnE,GACTq9E,EAAWtG,SACXlkF,GACAD,IAIIorB,EAAMjgB,OAAOwgC,IAAIC,gBAAgBL,GACjC27D,EAAOlwF,SAASmwF,cAAc,KACpCD,EAAKE,KAAOh8E,EACZ87E,EAAKG,SAAW5c,EAAW19E,MAAQ,UACnCiK,SAASsF,KAAKgrF,YAAYJ,GAC1BA,EAAK/uF,QACLnB,SAASsF,KAAKirF,YAAYL,GAC1B/7F,OAAOwgC,IAAIM,gBAAgB7gB,GAE3B4mC,GAAY,UAAW,cAAe,mBAAmB,mBAAD7kD,OAC3Cs9E,EAAW19E,KAAI,2CAM9B,CAAE,MAAOvK,GAEP,MAAMilG,EAAejlG,EAAMoE,SAAW,iDAGhC8gG,EAAgBD,EAAahkG,SAAS,oCACvBgkG,EAAahkG,SAAS,8BAE3C2lD,GAAUq+C,EAAc,CAAEvrG,KAAMwrG,EAAgB,UAAY,UAE5D11C,GAAY01C,EAAgB,UAAY,QAAS,cAAe,iBAAiB,kCAADv6F,OACvDs9E,EAAW19E,KAAI,MAAAI,OAAKs6F,GAC/C,CA/DA,MAFEr+C,GAAU,yDAA4C,UAwyVPu+C,CAA+Br1C,GAC9C3tD,MAAO,CACLK,WAAY,OACZC,OAAQ,OACRH,MAAO,UACP24F,OAAQ,UACR74F,QAAS,MACTsB,QAAS,OACT4/D,WAAY,SACZrgE,SAAU,OACVugE,WAAY,GAEdxhE,MAAM,qBAAiBT,UAEvBD,EAAAA,GAAAA,KAACu7F,EAAAA,EAAQ,CAACnzF,KAAM,QAKlBs/D,KACA1nE,EAAAA,GAAAA,KAAA,UACE5H,KAAK,SACL+H,QAASA,IAAMquD,EAAK6xB,SAzvVnB9hF,WACnC,MAAMooF,EAAaryD,GAAYja,KAAKmb,GAAKA,EAAElsB,KAAOy5E,GAC7C4D,IAKL9vB,GAAsB,CAAEksB,SAAQ4D,aAAYmd,cAAc,IAC1DntC,IAA8B,KAivVmCotC,CAA6Bv1C,EAAKllD,IA/rVjFy5E,KAClB,MAAMv0B,EAAOl6B,GAAYja,KAAKmb,GAAKA,EAAElsB,KAAOy5E,GACvCv0B,IAGLqI,GAAsB,CAAEksB,SAAQ4D,WAAYn4B,EAAMs1C,cAAc,IAChEntC,IAA8B,KAyrV2EqtC,CAAWx1C,EAAKllD,IACvF1P,SAA0B,cAAhB40D,EAAKltC,OACfzgB,MAAO,CACLK,WAAY,OACZC,OAAQ,OACRH,MAAuB,cAAhBwtD,EAAKltC,OAAyB,UAAY,UACjDq4E,OAAwB,cAAhBnrC,EAAKltC,OAAyB,cAAgB,UACtDxgB,QAAS,MACTsB,QAAS,OACT4/D,WAAY,SACZn1B,QAAyB,cAAhB2hB,EAAKltC,OAAyB,GAAM,EAC7C3f,SAAU,OACVugE,WAAY,GAEdxhE,MAAO8tD,EAAK6xB,SAAW,oBAAsB,gBAAgBpgF,UAE7DD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAM2jG,EAAAA,cAK/B/jG,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVc,SAAU,UACVX,MAAO,UACPoB,QAAS,OACT4/D,WAAY,SACZj4D,IAAK,UACL9J,SAAA,EACAD,EAAAA,GAAAA,KAAA,QAAAC,SACGuuD,EAAKgyB,aAAer3C,MAAM,IAAIzsB,KAAK8xC,EAAKgyB,YAAYp3C,WAAU,GAAA//B,QACxDmtF,EAAAA,GAAAA,IAAe,IAAI95E,KAAK8xC,EAAKgyB,aAAY,KAAAn3E,OAAI,IAAIqT,KAAK8xC,EAAKgyB,YAAYgY,mBAAmB,QAAS,CAAEC,KAAM,UAAWC,OAAQ,aACjI,qBAGN14F,EAAAA,GAAAA,KAAA,QAAAC,SAAM,YACND,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACXy/F,cAAe,YACfh9B,gBAAiB,UACjBtiE,MAAO,UACPF,QAAS,UACTM,aAAc,MACdO,SAAU,YACVoW,WAAY,OACZ9X,SACCuuD,EAAKp2D,KAAKuH,SAAS,OAAS,MAAQ6uD,EAAKvlD,KAAK8pB,MAAM,KAAKkvD,SAE5DjiF,EAAAA,GAAAA,KAAA,QAAAC,SAAM,YACNC,EAAAA,GAAAA,MAAA,QAAMW,MAAO,CACXyiE,gBAAiB,UACjBtiE,MAAO,UACPF,QAAS,UACTM,aAAc,MACdO,SAAU,YACVoW,WAAY,OACZ9X,SAAA,CAAC,gBAC8B,QAArB4iG,EAAAr0C,EAAKq1B,wBAAgB,IAAAgf,OAAA,EAArBA,EAAuBnjF,YAAsB,OAAVtjB,SAAU,IAAVA,QAAU,EAAVA,GAAYsjB,WAAY,gBAAU,KAAuB,QAArBojF,EAAAt0C,EAAKq1B,wBAAgB,IAAAif,OAAA,EAArBA,EAAuBtjF,SAAmB,OAAVpjB,SAAU,IAAVA,QAAU,EAAVA,GAAYojB,QAAS,0BAM5Itf,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEo8F,SAAU,QAAS/6B,WAAY,GAAIjiE,SAAA,CAItC,MAETC,EAAAA,GAAAA,MAAA,UACEb,MAAOmvD,EAAKuZ,aAAe,GAC3BtmE,SAAWvC,GA5kXXX,OAAOwkF,EAAQhb,KAC3C,MAAMvZ,EAAOl6B,GAAYja,KAAKmb,GAAKA,EAAElsB,KAAOy5E,GAC5C,GAAKv0B,EAsBL,GAjBAf,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP82B,mBAAoB92B,EAAK82B,mBAAqB,IAAI90B,IAAIktD,GACpDA,EAAKllD,KAAOy5E,GAAMxjF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQivD,GAAI,IAAEuZ,gBAAgBvZ,MAIpDtF,GAAe5pD,GAAQA,EAAKgC,IAAIktD,GAC9BA,EAAKllD,KAAOy5E,GAAMxjF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQivD,GAAI,IAAEuZ,gBAAgBvZ,IAI7C0C,GAAmBjqD,UAAW4/C,GAAAA,QAAa80B,qBAAwBz+E,IAAao8B,KAAoBq2B,IACvGhsC,IAAgB,GAId6qC,EAAK6xB,UAA4B,aAAhB7xB,EAAKltC,OAAuB,CAG/C,IAAKymD,GAAsC,KAAvBA,EAAYvlE,OAE9B,YADA8iD,GAAU,gFAA4D,WAIxE,IACE,MAAM9mD,QAAe0lG,EAAAA,GAAAA,IACnBz2F,GAASnE,GACTklD,EAAK6xB,SACL,CAAEjoF,KAAM2vE,GACR7rE,GACAC,IAGF,GAAsB,OAAlBqC,EAAO8iB,QAAqC,YAAlB9iB,EAAO8iB,OAAsB,CAGzD,GAAI9iB,EAAOkK,KAAM,CACf,MAAMsqE,EAAc,CAClB3E,YAAa7vE,EAAOkK,KAAKtQ,MAAQ2vE,EACjC6D,eAAgBptE,EAAOkK,KAAKo/E,WAC5B/f,YAAavpE,EAAOkK,KAAKtQ,MAAQ2vE,GAGnCta,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP82B,mBAAoB92B,EAAK82B,mBAAqB,IAAI90B,IAAIk0B,GACpDA,EAAElsB,KAAOy5E,GAAMxjF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQi2B,GAAMw9C,GAAgBx9C,MAIjD0zB,GAAe5pD,GAAQA,EAAKgC,IAAIk0B,GAC9BA,EAAElsB,KAAOy5E,GAAMxjF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQi2B,GAAMw9C,GAAgBx9C,GAEjD,OAGM4uD,IAAkC,GAExC9+B,GAAU,qDAAqCkJ,EAAKvlD,KAAO,wBAAW8+D,EAAa,WAGnF7Z,GAAY,UAAW,cAAe,2BAA2B,uCAAD7kD,OACjCmlD,EAAKvlD,KAAI,YAAAI,OAAM0+D,GAEhD,CACF,CAAE,MAAOrpE,GAEP,MAAMioB,GAAWw0D,EAAAA,GAAAA,GAA2Bz8E,EAAMoE,SAElDwiD,GAAU,kDAADj8C,OAAyCsd,GAAY,SAE9DunC,GAAY,QAAS,cAAe,kCAAkC,uCAAD7kD,OAC5Bsd,IAIzC8mC,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP82B,mBAAoB92B,EAAK82B,mBAAqB,IAAI90B,IAAIk0B,GACpDA,EAAElsB,KAAOy5E,GAAMxjF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQi2B,GAAC,IAAEuyC,YAAavZ,EAAKuZ,cAAgBvyC,MAIhE0zB,GAAe5pD,GAAQA,EAAKgC,IAAIk0B,GAC9BA,EAAElsB,KAAOy5E,GAAMxjF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQi2B,GAAC,IAAEuyC,YAAavZ,EAAKuZ,cAAgBvyC,GAEhE,CACF,MAIE,GAAIuyC,GAAsC,KAAvBA,EAAYvlE,OAAe,CAC5C,IAAKiL,GAASnE,GAYZ,OAVA4kD,GAAY,UAAW,cAAe,iBAAiB,mBAAD7kD,OACpCmlD,EAAKvlD,KAAI,kDAE3Bq8C,IAAaA,GACX,2EAAAj8C,OACcmlD,EAAKvlD,KAAI,MAAI,6CAAAI,OACG0+D,EAAW,QAAM,8FAE/C,CAAE3vE,KAAM,UAAWiuB,QAAS,OAKhC,IAAKnqB,KAAUC,GAIb,OAHA+xD,GAAY,QAAS,cAAe,iBAAiB,mBAAD7kD,OAClCmlD,EAAKvlD,KAAI,yCAC3Bq8C,IAAaA,GAAU,6DAA8C,CAAEltD,KAAM,WAK/E,MAAM6qF,EAAaz0B,EAAK40B,aAAe,aACjCN,GAAqBC,EAAQhb,EAAakb,EAClD,GA+8W2CkhB,CAAsB31C,EAAKllD,GAAIpK,EAAE2C,OAAOxC,OACzDzF,SAA0B,cAAhB40D,EAAKltC,QAA+C,WAArBktC,EAAK6f,aAA4B3G,GAC1E7mE,MAAO,CACLrK,MAAO,OACPsK,QAAS,iBACTK,OAAO,aAADkI,OAAgBmlD,EAAKuZ,YAA+C,WAArBvZ,EAAK6f,YAA2B,UAAY,UAAxD,WACzCjtE,aAAc,MACdO,SAAU,WACV2hE,gBAAiC,cAAhB9U,EAAKltC,OAAyB,UAAiC,WAArBktC,EAAK6f,YAA2B,UAAY3G,GAAkB,UAAY,QACrI1mE,MAAOwtD,EAAKuZ,YAAc,UAAY,UACtC4xB,OAAwB,cAAhBnrC,EAAKltC,QAA+C,WAArBktC,EAAK6f,aAA4B3G,GAAkB,cAAgB,UAC1G76B,QAAyB,cAAhB2hB,EAAKltC,QAA0BomD,GAAkB,GAAM,EAChE3vD,WAAiC,WAArBy2C,EAAK6f,YAA2B,MAAQ,UAEtD3tE,MAAOgnE,GAAkB,6DAAwE,WAArBlZ,EAAK6f,YAA2B,wDAA0C,GAAIpuE,SAAA,EAE1JD,EAAAA,GAAAA,KAAA,UAAQX,MAAM,GAAGwB,MAAO,CAAEG,MAAO,WAAYf,SAAC,eAC7CyiE,GAAmBphE,IAAIqH,IACtB3I,EAAAA,GAAAA,KAAA,UAAgCX,MAAOsJ,EAAIiQ,KAAOjQ,EAAIW,GAAGrJ,SACtD0I,EAAIpL,OAASoL,EAAIM,MADPN,EAAIiQ,KAAOjQ,EAAIW,aArP1BklD,EAAKllD,UAkQrBpJ,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVyiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdN,QAAS,OACTY,UAAW,OACXU,QAAS,OACT4/D,WAAY,aACZj4D,IAAK,WACL9J,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVc,SAAU,UACVugE,WAAY,EACZlqD,WAAY,GACZ/X,SAAC,kBAGHC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVc,SAAU,WACVX,MAAO,UACPgX,WAAY,OACZ/X,SAAA,EACAD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,8CAA6B,2RAiBtDu0D,IAA4Bj8C,EAAAA,cAC3BvY,EAAAA,GAAAA,KAACy1C,GAAoB,CAAAx1C,UACnBC,EAAAA,GAAAA,MAACy1C,GAAkB,CAACx1C,QAAUjB,GAAMA,EAAEkB,kBAAkBH,SAAA,EACtDC,EAAAA,GAAAA,MAAC21C,GAAmB,CAAA51C,SAAA,EAClBC,EAAAA,GAAAA,MAAC61C,GAAkB,CAAA91C,SAAA,EACjBD,EAAAA,GAAAA,KAAClK,EAAAA,EAAK,CAACsS,KAAM,KAAM,sCAGrBpI,EAAAA,GAAAA,KAACi2C,GAAwB,CAAC91C,QAnpUJikG,KAChC3vC,IAA4B,GAC5BE,GAAsB,IACtBE,GAAyB,KAgpU8C50D,SAAC,aAKhEC,EAAAA,GAAAA,MAACm2C,GAAoB,CAAAp2C,SAAA,EAEnBD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEoX,aAAc,QAAShY,UACnCD,EAAAA,GAAAA,KAACm2C,GAAmB,CAClB/9C,KAAK,OACLiH,MAAOq1D,GACPjzD,SA1rUoBvC,IAClC,MAAMG,EAAQH,EAAE2C,OAAOxC,MACvBs1D,GAAsBt1D,GAGtBiqF,GAAsBjqF,IAsrURyC,YAAY,2CACZuiG,WAAS,OAKbrkG,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEk+F,UAAW,SAAU9+F,SAChC60D,IACC50D,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACTg2F,cAAe,SACfp2B,WAAY,SACZlhE,QAAS,YACTC,UAAW,UACXd,SAAA,EACAD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVrK,MAAO,OACPC,OAAQ,OACR0K,OAAQ,oBACR05F,UAAW,oBACXz5F,aAAc,MACdqhG,UAAW,0BACXxqF,aAAc,WAEhBjY,EAAAA,GAAAA,KAAA,KAAGa,MAAO,CAAEG,MAAO,UAAW8W,OAAQ,GAAI7X,SAAC,sCAE3C20D,GAAsB3zD,OAAS,GACjCjB,EAAAA,GAAAA,KAACu2C,GAAY,CAAAt2C,SACV20D,GAAsBtzD,IAAI,CAAC48D,EAAUryC,KACpC3rB,EAAAA,GAAAA,MAACu2C,GAAY,CAEXt2C,QAASA,IAltUK+9D,KAElCzQ,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP9B,gBAAiB0gE,EAAS3gE,OAAS2gE,EAASj1D,MAAQ,GACpDvL,iBAAkBwgE,EAASzgE,QAAUygE,EAASC,SAAW,GACzDvgE,cAAesgE,EAASvgE,KAAO,GAC/BG,cAAeogE,EAASrgE,KAAO,GAC/BG,qBAAsBkgE,EAASngE,YAAcmgE,EAASE,aAAe,GACrElgE,wBAAyBggE,EAASjgE,eAAkBigE,EAASomC,eAAiBpmC,EAASomC,cAAcr7F,MAAS,GAC9G7K,wBAAyB8/D,EAAS//D,eAAkB+/D,EAASomC,eAAiBpmC,EAASomC,cAAcv7E,OAAUm1C,EAASn1C,OAAS,GACjIzqB,0BAA2B4/D,EAAS7/D,iBAAoB6/D,EAASomC,eAAiBpmC,EAASomC,cAAcC,OAAUrmC,EAAS5tC,SAAW,MAGzImkC,IAA4B,GAC5BE,GAAsB,IACtBE,GAAyB,IACzBvP,IAAaA,GAAU,0BAAwB,CAAEltD,KAAM,aAisUpBosG,CAA2BtmC,GAAUj+D,SAAA,EAEpDD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAO/W,MAAO,UAAWiX,aAAc,OAAQhY,SACtEi+D,EAAS3gE,OAAS2gE,EAASj1D,QAE9BjJ,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,WAAYX,MAAO,UAAWiX,aAAc,OAAQhY,SACzEi+D,EAASzgE,QAAUygE,EAASC,SAAWD,EAASa,SAEnD7+D,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,WAAYX,MAAO,UAAWiX,aAAc,OAAQhY,SAAA,CACzEi+D,EAASvgE,KAAG,aAAA0L,OAAY60D,EAASvgE,KAAM,IAAEugE,EAASrgE,KAAG,oBAAAwL,OAAc60D,EAASrgE,SAE7EqgE,EAASjgE,eAAiBigE,EAAS//D,iBACnC+B,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,UAAWX,MAAO,WAAYf,SAAA,CAAC,YAC3Ci+D,EAASjgE,cAAc,IAAEigE,EAAS//D,eAAa,UAAAkL,OAAS60D,EAAS//D,oBAd1E+/D,EAAS50D,IAAMuiB,MAoBO,IAA/BmpC,GAAoB/zD,QACtBjB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVE,UAAW,SACXD,QAAS,YACTE,MAAO,WACPf,UACAD,EAAAA,GAAAA,KAAA,KAAAC,SAAG,yDAEHy0D,GAAmBzzD,QAAU,GAC/BjB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVE,UAAW,SACXD,QAAS,YACTE,MAAO,WACPf,UACAC,EAAAA,GAAAA,MAAA,KAAAD,SAAA,CAAG,sEAA0Cy0D,GAAmB,WAGlE10D,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVE,UAAW,SACXD,QAAS,YACTE,MAAO,WACPf,UACAD,EAAAA,GAAAA,KAAA,KAAAC,SAAG,kFAOfiT,SAASsF,MAIV08C,IAAiB38C,EAAAA,cAChBvY,EAAAA,GAAAA,KAAC22C,GAAgB,CAAA12C,UACfC,EAAAA,GAAAA,MAAC22C,GAAc,CAAC12C,QAAUjB,GAAMA,EAAEkB,kBAAkBH,SAAA,EAClDC,EAAAA,GAAAA,MAAC62C,GAAe,CAAA92C,SAAA,EACdC,EAAAA,GAAAA,MAAC+2C,GAAc,CAAAh3C,SAAA,EACbC,EAAAA,GAAAA,MAAA,OAAK1J,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,OAAOC,OAAO,eAAeC,YAAY,IAAG1J,SAAA,EAC/FD,EAAAA,GAAAA,KAAA,WAAS9J,GAAG,KAAKC,GAAG,IAAIS,GAAG,IAAIC,GAAG,OAClCmJ,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,4CACRgK,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,0CACJ,sEAGRgK,EAAAA,GAAAA,KAACm3C,GAAoB,CACnBh3C,QAASA,KACPg1D,IAAiB,GACjBE,GAAc,KACdp1D,UAEFC,EAAAA,GAAAA,MAAA,OAAK1J,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,OAAOC,OAAO,eAAeC,YAAY,IAAG1J,SAAA,EAC/FD,EAAAA,GAAAA,KAAA,QAAMm9F,GAAG,KAAKC,GAAG,IAAIC,GAAG,IAAIC,GAAG,QAC/Bt9F,EAAAA,GAAAA,KAAA,QAAMm9F,GAAG,IAAIC,GAAG,IAAIC,GAAG,KAAKC,GAAG,gBAKrCp9F,EAAAA,GAAAA,MAACm3C,GAAgB,CAAAp3C,SAAA,EACfD,EAAAA,GAAAA,KAACu3C,GAAoB,CACnBn/C,KAAK,OACL0J,YAAY,iDACZzC,MAAO+1D,GACP3zD,SAjjUkBvC,IAC9B,MAAMG,EAAQH,EAAE2C,OAAOxC,MACvBg2D,GAAch2D,GAGVA,EAAM4B,QAAU,GAClB8Q,aAAa1K,OAAOo9F,mBACpBp9F,OAAOo9F,kBAAoBl9F,WAAW,KACpCsiF,GAAcxqF,IACb,MAEHk2D,GAAe,KAuiUL8uC,WAAS,KAIXnkG,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEoX,aAAc,QAAShY,SAAA,EACnCD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,OAAQoW,WAAY,MAAO/W,MAAO,UAAWiX,aAAc,MAAOqoF,cAAe,YAAaD,cAAe,SAAUpgG,SAAC,4BAGhJC,EAAAA,GAAAA,MAACy4C,GAAiB,CAAA14C,SAAA,EAEhBC,EAAAA,GAAAA,MAAC24C,GAAe,CACdzgD,KAAK,SACL8B,SAAgC,aAAtB27D,GACV11D,QAASA,IAAM21D,GAAqB,YAAY71D,SAAA,EAEhDD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMK,EAAAA,OACvBX,EAAAA,GAAAA,KAAA,QAAAC,SAAM,kBAIRC,EAAAA,GAAAA,MAAC24C,GAAe,CACdzgD,KAAK,SACL8B,SAAgC,SAAtB27D,GACV11D,QAASA,IAAMwF,IAAiBA,GAAc,iBAAmBmwD,GAAqB,QACtFl8D,UAAW+L,KAAkBA,GAAc,gBAC3CjF,MAASiF,IAAkBA,GAAc,gBAA4D,GAAzC,2DAA4C1F,SAAA,EAExGD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMC,EAAAA,OACvBP,EAAAA,GAAAA,KAAA,QAAAC,SAAM,gBAIRC,EAAAA,GAAAA,MAAC24C,GAAe,CACdzgD,KAAK,SACL8B,SAAgC,WAAtB27D,GACV11D,QAASA,IAAMwF,IAAiBA,GAAc,mBAAqBmwD,GAAqB,UACxFl8D,UAAW+L,KAAkBA,GAAc,kBAC3CjF,MAASiF,IAAkBA,GAAc,kBAA+D,GAA1C,4DAA6C1F,SAAA,EAE3GD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMM,EAAAA,OACvBZ,EAAAA,GAAAA,KAAA,QAAAC,SAAM,4BAMW,SAAtB41D,KACC31D,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEoX,aAAc,QAAShY,SAAA,EACnCD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,OAAQoW,WAAY,MAAO/W,MAAO,UAAWiX,aAAc,OAAQqoF,cAAe,YAAaD,cAAe,SAAUpgG,SAC7ImmE,GAAiB,8BAAa,wBAAA/8D,QAA0B,OAAVjN,SAAU,IAAVA,QAAU,EAAVA,GAAYwC,WAAY,SAExE5B,IACCgD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEC,QAAS,OAAQC,UAAW,SAAUC,MAAO,WAAYf,SAAC,mCAG5C,IAA1BnD,GAAemE,QACjBjB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEC,QAAS,OAAQI,WAAY,UAAWC,OAAQ,oBAAqBC,aAAc,MAAOJ,MAAO,WAAYf,SAAC,0DAI5HD,EAAAA,GAAAA,KAAC+4C,GAAY,CAAA94C,UACTmmE,GAAiBtpE,GACjBA,GAAe8C,OAAOyB,GAAQA,EAAKzC,YAAuB,OAAVxC,SAAU,IAAVA,QAAU,EAAVA,GAAYwC,YAC5D0C,IAAI,CAACD,EAAMwqB,KACX3rB,EAAAA,GAAAA,MAAC+4C,GAAY,CAEX/+C,SAAU67D,GAAkBp2D,SAAS0B,EAAKzC,UAC1CuB,QAASA,IAAMorF,GAAqBlqF,EAAKzC,UAAUqB,SAAA,EAEnDD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,WACLoJ,QAASu0D,GAAkBp2D,SAAS0B,EAAKzC,UACzC6C,SAAUA,IAAM8pF,GAAqBlqF,EAAKzC,YAE3CyC,EAAKzC,WATDyC,EAAKzC,UAAYitB,MAcA,IAA7BkqC,GAAkB90D,SAAiBjE,IAAgBF,GAAemE,OAAS,IAC1EjB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEa,UAAW,MAAOZ,QAAS,MAAOI,WAAY,UAAWC,OAAQ,oBAAqBC,aAAc,MAAOO,SAAU,OAAQX,MAAO,WAAYf,SAAC,wGAOrKD,EAAAA,GAAAA,KAACy3C,GAAQ,CAAAx3C,SACNu1D,IACCt1D,EAAAA,GAAAA,MAACs4C,GAAkB,CAAAv4C,SAAA,EACjBD,EAAAA,GAAAA,KAAA,OAAKxJ,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,OAAOC,OAAO,eAAeC,YAAY,IAAI9I,MAAO,CAAE4hG,UAAW,2BAA4BxiG,UAChJD,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,kCAEVgK,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CAAE2iE,WAAY,QAASvjE,SAAC,kCAErCq1D,GAAYr0D,OAAS,EACvBq0D,GAAYh0D,IAAI,CAAC8pF,EAAUv/D,KACzB,MAAM64E,EAAoBz6C,KAAkBmhC,EAASztF,IAErD,OACEuC,EAAAA,GAAAA,MAACy3C,GAAQ,CAAA13C,SAAA,EACPC,EAAAA,GAAAA,MAAC23C,GAAe,CACdE,YAAY,EACZ53C,QAASA,IAAMqrF,GAAiBJ,GAAUnrF,SAAA,EAE1CD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEkX,WAAY,MAAO/W,MAAO,UAAWiX,aAAc,OAAQhY,SACtEmrF,EAAS7tF,SAEZyC,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEc,SAAU,WAAYX,MAAO,UAAWiX,aAAc,OAAQhY,SACzEmrF,EAASrsB,OAASqsB,EAAS3tF,UAE9ByC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CAAEc,SAAU,WAAYX,MAAO,WAAYf,SAAA,CAAC,aAChDmrF,EAASztF,IAAI,IAAEytF,EAASvtF,KAAG,oBAAAwL,OAAc+hF,EAASvtF,QAIzD83D,GAAcy1B,EAASztF,OACtBg4D,GAAcy1B,EAASztF,KAAK9B,gBAC5B85D,GAAcy1B,EAASztF,KAAK/B,cAC5B+5D,GAAcy1B,EAASztF,KAAKhC,oBAE5BuE,EAAAA,GAAAA,MAAC83C,GAAe,CAAA/3C,SAAA,CACb01D,GAAcy1B,EAASztF,KAAK9B,iBAC3BqE,EAAAA,GAAAA,MAACg4C,GAAc,CAAC79C,MAAM,SAAQ4F,SAAA,EAC5BD,EAAAA,GAAAA,KAAA,OAAKxJ,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,eAAcxJ,UACjED,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,wDACJ,oBAIT2/D,GAAcy1B,EAASztF,KAAK/B,eAC3BsE,EAAAA,GAAAA,MAACg4C,GAAc,CAAC79C,MAAM,OAAM4F,SAAA,EAC1BD,EAAAA,GAAAA,KAAA,OAAKxJ,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,eAAcxJ,UACjED,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,wDACJ,aAIT2/D,GAAcy1B,EAASztF,KAAKhC,mBAC3BuE,EAAAA,GAAAA,MAACg4C,GAAc,CAAC79C,MAAM,WAAU4F,SAAA,EAC9BD,EAAAA,GAAAA,KAAA,OAAKxJ,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,eAAcxJ,UACjED,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,wDACJ,sBAQhBkK,EAAAA,GAAAA,MAACk4C,GAAe,CAAAn4C,SAAA,EACdC,EAAAA,GAAAA,MAACo4C,GAAgB,CACf7P,UAAU,UACVtoC,QAASA,IAAMqrF,GAAiBJ,GAAUnrF,SAAA,EAE1CC,EAAAA,GAAAA,MAAA,OAAK1J,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,OAAOC,OAAO,eAAeC,YAAY,IAAG1J,SAAA,EAC/FD,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,oBACRgK,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,6DACJ,qBAIRgK,EAAAA,GAAAA,KAACs4C,GAAgB,CACf7P,UAAU,UACVtoC,QAASA,KAKPsrF,GAAkBL,EAHyB,SAAtBv1B,GACjB,CAAEx7D,MAAO,OAAQwxF,MAAO91B,IACxBF,IAEJ21B,GAAiBJ,IAEnBxxF,SAAU8qG,GAA4C,SAAtB7uC,IAA6D,IAA7BE,GAAkB90D,OAClFP,MAA8B,SAAtBm1D,IAA6D,IAA7BE,GAAkB90D,OAAgB,qCAA+B,GAAGhB,SAE3GykG,GACCxkG,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACED,EAAAA,GAAAA,KAAA,OAAKxJ,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,OAAOC,OAAO,eAAeC,YAAY,IAAI9I,MAAO,CAAE4hG,UAAW,2BAA4BxiG,UAChJD,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,iCACJ,uBAIRkK,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACEC,EAAAA,GAAAA,MAAA,OAAK1J,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,OAAOC,OAAO,eAAeC,YAAY,IAAG1J,SAAA,EAC/FD,EAAAA,GAAAA,KAAA,QAAMhK,EAAE,iEACRgK,EAAAA,GAAAA,KAAA,YAAU69F,OAAO,2BACjB79F,EAAAA,GAAAA,KAAA,YAAU69F,OAAO,oBACb,yCAxFDhyE,KAiGjBupC,GAAWn0D,QAAU,GACvBjB,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVE,UAAW,SACXD,QAAS,YACTE,MAAO,WACPf,UACAD,EAAAA,GAAAA,KAAA,KAAAC,SAAG,8DAGLD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CACVE,UAAW,SACXD,QAAS,YACTE,MAAO,WACPf,UACAD,EAAAA,GAAAA,KAAA,KAAAC,SAAG,8EAOfiT,SAASsF,MAIVihD,IAAyBlhD,EAAAA,cACxBvY,EAAAA,GAAAA,KAAC+wC,GAAoB,CAAA9wC,UACnBC,EAAAA,GAAAA,MAAC+xC,GAAa,CAAC9xC,QAAUjB,GAAMA,EAAEkB,kBAAkBH,SAAA,EACjDD,EAAAA,GAAAA,KAACuyC,GAAwB,CACvBn6C,KAAK,SACL+H,QAASA,KACPu5D,IAAyB,GACzBE,GAAgB,IAChBE,GAAgB,MAChBC,GAAY,OACZE,GAA0B,OAC1Bh6D,UAEFC,EAAAA,GAAAA,MAAA,OAAK1J,MAAM,KAAKC,OAAO,KAAK+S,QAAQ,YAAYC,KAAK,OAAOC,OAAO,eAAeC,YAAY,IAAG1J,SAAA,EAC/FD,EAAAA,GAAAA,KAAA,QAAMm9F,GAAG,KAAKC,GAAG,IAAIC,GAAG,IAAIC,GAAG,QAC/Bt9F,EAAAA,GAAAA,KAAA,QAAMm9F,GAAG,IAAIC,GAAG,IAAIC,GAAG,KAAKC,GAAG,aAInCt9F,EAAAA,GAAAA,KAACmyC,GAAmB,CAAAlyC,UAClBD,EAAAA,GAAAA,KAACqyC,GAAkB,CAAApyC,SAAC,gCAKtBC,EAAAA,GAAAA,MAACuyC,GAAiB,CAAAxyC,SAAA,EAEhBC,EAAAA,GAAAA,MAACyyC,GAAiB,CAAA1yC,SAAA,EAChBD,EAAAA,GAAAA,KAAC6yC,GAAa,CAAA5yC,SAAC,gBACfD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEuB,QAAS,OAAQ2H,IAAK,OAAQ9J,SACzC,CACC,CAAEZ,MAAO,MAAOnG,MAAO,iBAAUU,UAAU,GAC3C,CAAEyF,MAAO,SAAUnG,MAAO,4BAAmBU,SAA6D,IAAnD,IAAIyL,MAAmBD,IAAiBnE,QAC/F,CAAE5B,MAAO,QAASnG,MAAO,4BAAcU,SAA6D,IAAnD,IAAIyL,MAAmBD,IAAiBnE,SACzFK,IAAI2yF,IACJ/zF,EAAAA,GAAAA,MAAA,SAA0BW,MAAO,CAC/BshE,KAAM,EACN//D,QAAS,OACT4/D,WAAY,SACZ46B,eAAgB,SAChB7yF,IAAK,MACLjJ,QAAS,YACTM,aAAc,MACdD,OAAO,aAADkI,OAAe6oD,KAAa+hC,EAAO50F,MAAQ,UAAY,WAC7DikE,gBAAiBpR,KAAa+hC,EAAO50F,MAAQ,UAAY,QACzDs6F,OAAQ1F,EAAOr6F,SAAW,cAAgB,UAC1CizC,QAASonD,EAAOr6F,SAAW,GAAM,EACjC+H,SAAU,WACVoW,WAAY,MACZwgF,WAAY,YACZt4F,SAAA,EACAD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,QACL6Q,KAAK,WACL5J,MAAO40F,EAAO50F,MACdmC,QAAS0wD,KAAa+hC,EAAO50F,MAC7BoC,SAAWvC,GAAM66D,GAAY76D,EAAE2C,OAAOxC,OACtCzF,SAAUq6F,EAAOr6F,SACjBiH,MAAO,CAAEuB,QAAS,UAEnB6xF,EAAO/6F,QAzBE+6F,EAAO50F,cAgCV,WAAb6yD,IAAsC,UAAbA,MACzBhyD,EAAAA,GAAAA,MAACyyC,GAAiB,CAAA1yC,SAAA,EAChBD,EAAAA,GAAAA,KAAC6yC,GAAa,CAAA5yC,SAAC,0BACfD,EAAAA,GAAAA,KAACk7F,GAAkB,CACjB97F,MAAM,iBACNC,OAA6B,OAAtB26D,SAAsB,IAAtBA,QAAsB,EAAtBA,GAAwB1wD,MAA4B,OAAtB0wD,SAAsB,IAAtBA,QAAsB,EAAtBA,GAAwBhwD,KAAM,GACnEvI,SAAW05F,IAET,MACMjhG,EADe,IAAImL,MAAmBD,IACdiV,KAAK5R,IAAMA,EAAEa,IAAMb,EAAEuB,IAAIpB,aAAeb,OAAOozF,IAC7ElhC,GAA0B//D,GACT,WAAbg4D,IAAyBh4D,GAC3B0/D,GAAgB1/D,EAAS+O,MAAQ,KAGrCma,QAAS,IAAI/d,MAAmBD,IAChCtD,YAAY,0BACZkyF,eAAiBC,IACf,MAAMl2B,EAASk2B,EAAO7B,aAAe,SAAW,gBAChD,MAAM,GAAN/oF,OAAU4qF,EAAOhrF,KAAI,MAAAI,OAAK00D,EAAM,MAElCs9B,eAAiBpH,GAAWA,EAAO3qF,IAAM2qF,EAAOjqF,SAMvC,QAAbkoD,IAAmC,UAAbA,MACtBhyD,EAAAA,GAAAA,MAACyyC,GAAiB,CAAA1yC,SAAA,EAChBD,EAAAA,GAAAA,KAAC6yC,GAAa,CAAA5yC,SAAC,cACfD,EAAAA,GAAAA,KAAC+yC,GAAa,CACZ36C,KAAK,OACLiH,MAAOs6D,GACPl4D,SAAWvC,GAAM06D,GAAgB16D,EAAE2C,OAAOxC,OAC1CyC,YAA0B,UAAbowD,GAAuB,yCAA2B,wBAC/DmyC,UAAwB,QAAbnyC,SAMjBhyD,EAAAA,GAAAA,MAACyyC,GAAiB,CAAA1yC,SAAA,EAChBD,EAAAA,GAAAA,KAAC6yC,GAAa,CAAA5yC,SAAC,SACfD,EAAAA,GAAAA,KAAA,OAAKa,MAAO,CAAEuB,QAAS,OAAQ2H,IAAK,OAAQ9J,SACzC,CACC,CAAEZ,MAAO,KAAMnG,MAAO,KAAMU,UAAU,GACtC,CAAEyF,MAAO,UAAWnG,MAAO,UAAWU,UAAW8L,IAAcD,GAAe,GAC9E,CAAEpG,MAAO,QAASnG,MAAO,WAAOU,UAAW8L,IAAcD,GAAe,IACxEnE,IAAI2yF,IACJ/zF,EAAAA,GAAAA,MAAA,SAA0BW,MAAO,CAC/BshE,KAAM,EACN//D,QAAS,OACT4/D,WAAY,SACZ46B,eAAgB,SAChB97F,QAAS,YACTM,aAAc,MACdD,OAAO,aAADkI,OAAewwD,KAAiBo6B,EAAO50F,MAAQ,UAAY,WACjEikE,gBAAiBzJ,KAAiBo6B,EAAO50F,MAAQ,UAAY,QAC7Ds6F,OAAQ1F,EAAOr6F,SAAW,cAAgB,UAC1CizC,QAASonD,EAAOr6F,SAAW,GAAM,EACjC+H,SAAU,WACVoW,WAAY,MACZwgF,WAAY,YACZt4F,SAAA,EACAD,EAAAA,GAAAA,KAAA,SACE5H,KAAK,QACL6Q,KAAK,eACL5J,MAAO40F,EAAO50F,MACdmC,QAASq4D,KAAiBo6B,EAAO50F,MACjCoC,SAAWvC,GAAM46D,GAAgB56D,EAAE2C,OAAOxC,OAC1CzF,SAAUq6F,EAAOr6F,SACjBiH,MAAO,CAAEuB,QAAS,UAEnB6xF,EAAO/6F,QAxBE+6F,EAAO50F,WA4BpBqG,IAAcD,GAAe,IAC9BvF,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVa,UAAW,MACXZ,QAAS,WACTwiE,gBAAiB,UACjBniE,OAAQ,oBACRC,aAAc,MACdO,SAAU,UACVX,MAAO,WACPf,SAAA,CAAC,mDAC8BD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,OAAW,wGAM1DC,EAAAA,GAAAA,MAAC+yC,GAAoB,CAAAhzC,SAAA,EACnBD,EAAAA,GAAAA,KAACwzC,GAAoB,CACnBp7C,KAAK,SACLiD,QAAQ,SACR8E,QAASA,KACPu5D,IAAyB,GACzBE,GAAgB,IAChBE,GAAgB,OAChB75D,SACH,iBAGDD,EAAAA,GAAAA,KAACwzC,GAAoB,CACnBp7C,KAAK,SACLiD,QAAQ,UACR8E,QAAS5B,UACP,IAAKo7D,GAAan3D,OAAQ,OAG1B,MAAMqzF,EAAe,CAAC,EAChBf,EAAaloE,GAAqB6V,GAAmBh9B,GAAcC,IACnE6vF,EAv1PO,CAC3Bt6E,YAAa,CACX,qBAAsB,cAAe,SAAU,gBAAiB,mBAChE,yBAA0B,wBAAyB,yBAA0B,6BAE/E+R,UAAW,CACT,eAAgB,kBAAmB,mBAAoB,gBACvD,gBAAiB,wBAEnBC,QAAS,CACP,0BAA2B,0BAA2B,6BAExDC,QAAS,CACP,kBAAmB,sBAAuB,uBAE5CC,gBAAiB,CACf,iCAAkC,eAAgB,UAEpDiH,QAAS,CAAC,uBA41PI,GApBqB,OAAjBylC,IAA0C,UAAjBA,KAC3Bg8B,EAAa1sF,WAAa,CACxBC,QAASqE,GAASrE,SAAW,GAC7B0f,YAAarb,GAASqb,aAAe,GACrClT,eAAgBnI,GAASmI,gBAAkB,GAC3CmN,cAAetV,GAASsV,eAAiB,GACzC8F,mBAAoBpb,GAASob,oBAAsB,GAEnDxP,mBAAoB5L,GAAS4L,oBAAsB,GACnDG,OAAQ/L,GAAS+L,QAAU,GAC3BC,cAAehM,GAASgM,eAAiB,GACzCC,iBAAkBjM,GAASiM,kBAAoB,GAC/CC,uBAAwBlM,GAASkM,wBAA0B,GAC3DC,sBAAuBnM,GAASmM,uBAAyB,GACzDC,uBAAwBpM,GAASoM,wBAA0B,GAC3DC,0BAA2BrM,GAASqM,2BAA6B,KAKhD,YAAjB+/C,IAA+C,UAAjBA,GAA0B,CAC1D,GAAIp0D,GAAe,EAEjB,YADS,OAAT6/C,SAAS,IAATA,IAAAA,GAAY,kEAAsD,YAIpEuwC,EAAaxrF,aAAe,CAAC,EAG7B3H,OAAOwb,QAAQq3E,GAAUhgF,QAAQovF,IAA2B,IAAzBltE,EAAYg+D,GAAOkP,GACZ,YAAfltE,EAA2Bq9D,EAAW5nE,QAAU4nE,EAAWr9D,KAGlFg+D,EAAOlgF,QAAQnW,IACC,uBAAVA,QAAsD+a,IAApB1M,GAASrO,KAC7Cy2F,EAAaxrF,aAAajL,GAASqO,GAASrO,IAAU,QAO1D01F,EAAW5nE,SAAWluB,MAAMC,QAAQwO,GAASyb,qBAAuBzb,GAASyb,mBAAmBjoB,OAAS,IAC3G40F,EAAazhE,QAAU3mB,GAASyb,mBAAmB5nB,IAAIqX,IAAI,CACzDoT,MAAOpT,EAAKoT,OAAS,GACrBC,aAAcrT,EAAKqT,cAAgB,GACnC22B,UAAWhqC,EAAKgqC,WAAa,GAC7B12B,WAAYtT,EAAKsT,YAAc,MAGrC,CAEA,GAAiB,QAAbimC,SAEIshC,GAAsB75B,GAAan3D,OAAQqzF,EAAch8B,SAC1D,GAAiB,WAAb3H,GAET,GAAI8H,GAAuBo4B,aAEzB,IACE,MAAMU,EAA+B,OAAjBj5B,IAA0C,UAAjBA,KAA6Bg8B,EAAa1sF,WAEnF,GADArK,KAAKuR,UAAUwlF,EAAa1sF,YAE1B6pF,EAAmC,YAAjBn5B,IAA+C,UAAjBA,KAA6Bg8B,EAAaxrF,aAE5F,GADAvL,KAAKuR,UAAUwlF,EAAaxrF,cAG1B7L,QAAeomG,EAAAA,GAAAA,IAAe,CAClCzoG,UAAc,OAAJwiB,SAAI,IAAJA,QAAI,EAAJA,GAAMxiB,WAAYA,GAC5BD,SACA4L,QAASkyD,GAAuBlyD,SAAW,EAC3CwB,GAAI0wD,GAAuB1wD,GAC3ByoF,cAAe/3B,GAAuB/wD,KACtC6pF,aACAE,iBACArqF,IAAKkxD,GACL2G,UAAW,iBAGU,QAAb,OAANhiE,QAAM,IAANA,OAAM,EAANA,EAAQ8iB,gBACJy/D,KACFz7B,IACFA,GAAU,iBAADj8C,OAAa2wD,GAAuB/wD,KAAI,2BAAwB,CAAE7Q,KAAM,YAGvF,CAAE,MAAOsG,GACH4mD,IACFA,GAAU,qDAA4C,CAAEltD,KAAM,SAElE,MAGAihE,GAAkB/5D,GAAQA,EAAKgC,IAAImxF,GACjCA,EAASzoF,KAAOgwD,GAAuBhwD,IAAEzK,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAChCkzF,GAAQ,IAAE/pF,KAAMmtF,EAAcz9F,KAAMyhE,KACzC44B,IAEFntC,IACFA,GAAU,iBAADj8C,OAAa2wD,GAAuB/wD,KAAI,2BAAwB,CAAE7Q,KAAM,iBAGhF,GAAiB,UAAb85D,GAAsB,CAE/B,MAAMoT,GAAU/lE,EAAAA,EAAAA,GAAA,GAAQy6D,GAAuBtxD,MAIf,IAADm8F,EAA/B,GAHIhP,EAAa1sF,aACfm8D,EAAWn8D,YAAU5J,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQ+lE,EAAWn8D,YAAe0sF,EAAa1sF,aAElE0sF,EAAaxrF,aACfi7D,EAAWj7D,cAAY9K,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQ+lE,EAAWj7D,cAAiBwrF,EAAaxrF,eAEnC,QAAjCw6F,EAAAhP,EAAaxrF,aAAa+pB,eAAO,IAAAywE,OAAA,EAAjCA,EAAmC5jG,QAAS,IAC9CqkE,EAAWj7D,aAAa+pB,QAAU,IAC5BkxC,EAAWj7D,aAAa+pB,SAAW,MACpCyhE,EAAaxrF,aAAa+pB,gBAK7Bo/D,GAAsB75B,GAAan3D,OAAQ8iE,EAAY,SACzDhgB,IACFA,GAAU,iBAADj8C,OAAaswD,GAAY,2CAA8B,CAAEvhE,KAAM,WAE5E,CAEAshE,IAAyB,GACzBE,GAAgB,IAChBE,GAAgB,MAChBC,GAAY,OACZE,GAA0B,OAE5BrgE,SACgB,QAAbs4D,KAAuByH,GAAan3D,SACtB,WAAb0vD,IAAsC,UAAbA,MAA0B8H,IACvC,UAAb9H,KAAyByH,GAAan3D,OACxCvC,SAEa,QAAbiyD,GAAqB,2BACR,WAAbA,GAAwB,4BACxB,sCAKTh/C,SAASsF,MAIV0hD,IAA6B3hD,EAAAA,cAC5BvY,EAAAA,GAAAA,KAACqxC,GAAoB,CAAClxC,QAAUjB,IAAYA,EAAE2C,SAAW3C,EAAEyU,eAAe89E,MAA+BxxF,UACvGC,EAAAA,GAAAA,MAACqxC,GAAkB,CAACpxC,QAAUjB,GAAMA,EAAEkB,kBAAkBH,SAAA,EACtDD,EAAAA,GAAAA,KAACyxC,GAAkB,CAAAxxC,SAAC,yCAGpBC,EAAAA,GAAAA,MAACyxC,GAAoB,CAAA1xC,SAAA,CAAC,uCACUC,EAAAA,GAAAA,MAAA,UAAAD,SAAA,CAAQ,IAAuB,OAArBm6D,SAAqB,IAArBA,QAAqB,EAArBA,GAAuBnxD,KAAK,OAAU,KAC9EjJ,EAAAA,GAAAA,KAAA,UAAMA,EAAAA,GAAAA,KAAA,SAAM,gCAGdE,EAAAA,GAAAA,MAAC2xC,GAAoB,CAAA5xC,SAAA,EACnBD,EAAAA,GAAAA,KAAC+xC,GAAmB,CAAC5xC,QAASsxF,GAA0BxxF,SAAC,iBAGzDD,EAAAA,GAAAA,KAAC+xC,GAAmB,CAAC12C,QAAQ,SAAS8E,QA17Qf2kG,KACjC,GAAK1qC,GAEL,IACE,MAAMv4D,EAASu4D,GAGXv4D,IAAWA,EAAOuwF,cAAgBvwF,EAAOyH,KAAOpN,IAASC,GAC3D,WACE,IACE,MAAM4oG,EAAiBljG,QAA8BsY,IAAnBtY,EAAOiG,SAA4C,OAAnBjG,EAAOiG,QAAqBjG,EAAOiG,QAAWA,IAAW,EAG3H,GAA8B,IAA1Bme,OAAO8+E,MAA0Bp/F,KAAkBA,GAAc,oBAInE,YAHI2/C,IACFA,GAAU,2EAAoD,CAAEltD,KAAM,WAK1E,MAAM29F,QAAaiP,EAAAA,GAAAA,IAAe,CAChC7oG,UAAc,OAAJwiB,SAAI,IAAJA,QAAI,EAAJA,GAAMxiB,WAAYA,GAC5BD,SACA4L,QAASi9F,GAAiB,EAC1Bz7F,GAAIzH,EAAOyH,KAGP27F,EAAelP,GAAQA,EAAKrtF,OAASqtF,EAAKrtF,KAAK4Y,QAAUy0E,EAAKrtF,KAAKlK,SAAWu3F,EAAKrtF,KAAKg2D,GAAK,KAAO,OACpGwmC,EAAanP,GAAQA,EAAKrtF,OAASqtF,EAAKrtF,KAAKA,MAAQqtF,EAAKrtF,MAGhE,KAFkBu8F,GAAuD,OAAvCl9F,OAAOk9F,GAAc16E,eAA0B26E,KAAsC,IAAvBA,EAAWC,SAA2C,SAAvBD,EAAWC,UAErH,OAAJpP,QAAI,IAAJA,GAAAA,EAAM13E,SAA4B,QAAb,OAAJ03E,QAAI,IAAJA,OAAI,EAAJA,EAAMz0E,SAsBtC,MAAM,IAAIuB,MAAM,8CApBhBy2C,GAAmBh6D,GAAQN,MAAMC,QAAQK,GAAQA,EAAKM,OAAO6kE,GAAK18D,OAAO08D,EAAEn7D,MAAQvB,OAAOlG,EAAOyH,KAAOhK,GAGxG+5D,GAAkB/5D,IAChB,MAAMw0F,EAAmBx0F,EAAKM,OAAOV,KAAOA,EAAEoK,IAAMzH,EAAOyH,IAAMvB,OAAO7I,EAAEoK,MAAQvB,OAAOlG,EAAOyH,MAEhG,IACE,MAAMrT,EAAM6R,GAAO,mBAAAuB,OAAsBvB,IAAY,kBACrDqI,aAAaC,QAAQna,EAAK6I,KAAKuR,UAAUyjF,GAC3C,CAAE,MAAOp1F,GACT,CACA,OAAOo1F,IAGThH,GAAkB,SAAU,CAAE7jF,KAAY,OAANpH,QAAM,IAANA,OAAM,EAANA,EAAQoH,KAAMK,GAAU,OAANzH,QAAM,IAANA,OAAM,EAANA,EAAQyH,GAAIyqF,KAAM,WAEpEzuC,IACFA,GAAU,gCAAyB,CAAEltD,KAAM,WAKjD,CAAE,MAAOmsB,GAGP80C,GAAkB/5D,IAChB,MAAMw0F,EAAmBx0F,EAAKM,OAAOV,KAAOA,EAAE8K,KAAOnI,EAAOmI,IAAM9K,EAAE+J,OAASpH,EAAOoH,OAEpF,IACE,MAAMhT,EAAM6R,GAAO,mBAAAuB,OAAsBvB,IAAY,kBACrDqI,aAAaC,QAAQna,EAAK6I,KAAKuR,UAAUyjF,GAC3C,CAAE,MAAOp1F,GACT,CACA,OAAOo1F,IAGLxuC,IACFA,GAAU,uCAADj8C,QAAgC,OAAHkb,QAAG,IAAHA,OAAG,EAAHA,EAAKzhB,UAAW,iBAAmB,CAAE1K,KAAM,SAErF,CACD,EAjED,IAoEAihE,GAAkB/5D,IAChB,MAAMw0F,EAAmBx0F,EAAKM,OAAOV,KAAOA,EAAE8K,KAAOowD,GAAsBpwD,IAAM9K,EAAE+J,OAASmxD,GAAsBnxD,OAElH,IACE,MAAMhT,EAAM6R,GAAO,mBAAAuB,OAAsBvB,IAAY,kBACrDqI,aAAaC,QAAQna,EAAK6I,KAAKuR,UAAUyjF,GAC3C,CAAE,MAAOp1F,GACT,CACA,OAAOo1F,IAGThH,GAAkB,SAAU,CAAE7jF,KAA2B,OAArBmxD,SAAqB,IAArBA,QAAqB,EAArBA,GAAuBnxD,KAAMe,GAAyB,OAArBowD,SAAqB,IAArBA,QAAqB,EAArBA,GAAuBpwD,GAAI+pF,KAAM,UAE1G,CAAC,QACC55B,IAA6B,GAC7BE,GAAyB,KAC3B,GA81QoFp6D,SAAC,mBAMjFiT,SAASsF,MAIVo7C,IAAoBr7C,EAAAA,cACnBvY,EAAAA,GAAAA,KAAC85C,GAAY,CAAC35C,QAASA,IAAM07D,GAAoB,MAAM57D,UACrDC,EAAAA,GAAAA,MAAC85C,GAAc,CAAC75C,QAASjB,GAAKA,EAAEkB,kBAAkBH,SAAA,EAChDC,EAAAA,GAAAA,MAACg6C,GAAa,CAAAj6C,SAAA,EACZC,EAAAA,GAAAA,MAACk6C,GAAY,CAAAn6C,SAAA,EACXD,EAAAA,GAAAA,KAAC6J,GAAAA,EAAG,CAACzB,KAAM,KAAM,6BAGnBpI,EAAAA,GAAAA,KAACs6C,GAAkB,CAACn6C,QAASA,IAAM07D,GAAoB,MAAM57D,UAC3DD,EAAAA,GAAAA,KAACsI,EAAAA,EAAC,CAACF,KAAM,WAKblI,EAAAA,GAAAA,MAACs6C,GAAc,CAAAv6C,SAAA,EACbC,EAAAA,GAAAA,MAACw6C,GAAmB,CAAAz6C,SAAA,EAClBD,EAAAA,GAAAA,KAACu7F,EAAAA,EAAQ,CAACnzF,KAAM,KAAM,oCAGxBlI,EAAAA,GAAAA,MAAC06C,GAAY,CAAA36C,SAAA,EACXD,EAAAA,GAAAA,KAAC86C,GAAiB,CAAA76C,SAAC,eACnBD,EAAAA,GAAAA,KAACg7C,GAAiB,CAAA/6C,SAAE2zD,GAAiB84B,QAAQ6J,aAAattF,WAE5D/I,EAAAA,GAAAA,MAAC06C,GAAY,CAAA36C,SAAA,EACXD,EAAAA,GAAAA,KAAC86C,GAAiB,CAAA76C,SAAC,UACnBD,EAAAA,GAAAA,KAACg7C,GAAiB,CAAA/6C,UAChBD,EAAAA,GAAAA,KAAC07C,GAAY,CAACtjD,KAAMw7D,GAAiB84B,QAAQ6J,aAAan+F,KAAK6H,SACb,OAA/C2zD,GAAiB84B,QAAQ6J,aAAan+F,KAAgB,kBACP,YAA/Cw7D,GAAiB84B,QAAQ6J,aAAan+F,KAAqB,UAAY,yBAI9E8H,EAAAA,GAAAA,MAAC06C,GAAY,CAAA36C,SAAA,EACXD,EAAAA,GAAAA,KAAC86C,GAAiB,CAAA76C,SAAC,qBACnBD,EAAAA,GAAAA,KAACg7C,GAAiB,CAAA/6C,SAAE2zD,GAAiB84B,QAAQ6J,aAAaP,cAE5D91F,EAAAA,GAAAA,MAAC06C,GAAY,CAAA36C,SAAA,EACXD,EAAAA,GAAAA,KAAC86C,GAAiB,CAAA76C,SAAC,iBACnBD,EAAAA,GAAAA,KAACg7C,GAAiB,CAAA/6C,SACf2zD,GAAiB84B,QAAQ6J,aAAaE,SAAW,yBAAqB,4BAM5E7iC,GAAiB84B,QAAQvjF,aACxBjJ,EAAAA,GAAAA,MAACs6C,GAAc,CAAAv6C,SAAA,EACbC,EAAAA,GAAAA,MAACw6C,GAAmB,CAAAz6C,SAAA,EAClBD,EAAAA,GAAAA,KAAColG,GAAAA,EAAW,CAACh9F,KAAM,KAAM,+BAG1BwrD,GAAiB84B,QAAQvjF,WAAWC,UACnClJ,EAAAA,GAAAA,MAAC06C,GAAY,CAAA36C,SAAA,EACXD,EAAAA,GAAAA,KAAC86C,GAAiB,CAAA76C,SAAC,wBACnBD,EAAAA,GAAAA,KAACg7C,GAAiB,CAAA/6C,SAAE2zD,GAAiB84B,QAAQvjF,WAAWC,aAG3DwqD,GAAiB84B,QAAQvjF,WAAWuM,UACnCxV,EAAAA,GAAAA,MAAC06C,GAAY,CAAA36C,SAAA,EACXD,EAAAA,GAAAA,KAAC86C,GAAiB,CAAA76C,SAAC,sBACnBC,EAAAA,GAAAA,MAAC86C,GAAiB,CAAA/6C,SAAA,CAAE2zD,GAAiB84B,QAAQvjF,WAAWuM,QAAQ,iBAGnEk+C,GAAiB84B,QAAQvjF,WAAWwtF,iBACnCz2F,EAAAA,GAAAA,MAAC06C,GAAY,CAAA36C,SAAA,EACXD,EAAAA,GAAAA,KAAC86C,GAAiB,CAAA76C,SAAC,2BACnBD,EAAAA,GAAAA,KAACg7C,GAAiB,CAAA/6C,SAAE2zD,GAAiB84B,QAAQvjF,WAAWwtF,oBAG3D/iC,GAAiB84B,QAAQvjF,WAAW6R,UAAU/Z,OAAS,IACtDf,EAAAA,GAAAA,MAAC06C,GAAY,CAAA36C,SAAA,EACXD,EAAAA,GAAAA,KAAC86C,GAAiB,CAAA76C,SAAC,qBACnBC,EAAAA,GAAAA,MAAC86C,GAAiB,CAAA/6C,SAAA,CAAE2zD,GAAiB84B,QAAQvjF,WAAW6R,UAAU/Z,OAAO,uBAOhF2yD,GAAiB84B,QAAQriF,eACxBnK,EAAAA,GAAAA,MAACs6C,GAAc,CAAAv6C,SAAA,EACbC,EAAAA,GAAAA,MAACw6C,GAAmB,CAAAz6C,SAAA,EAClBD,EAAAA,GAAAA,KAAC8M,EAAAA,EAAO,CAAC1E,KAAM,KAAM,2BAGtBwrD,GAAiB84B,QAAQriF,aAAawsF,iBACrC32F,EAAAA,GAAAA,MAAC06C,GAAY,CAAA36C,SAAA,EACXD,EAAAA,GAAAA,KAAC86C,GAAiB,CAAA76C,SAAC,gBACnBD,EAAAA,GAAAA,KAACg7C,GAAiB,CAAA/6C,SAAE2zD,GAAiB84B,QAAQriF,aAAawsF,oBAG7DjjC,GAAiB84B,QAAQriF,aAAa0sF,eACrC72F,EAAAA,GAAAA,MAAC06C,GAAY,CAAA36C,SAAA,EACXD,EAAAA,GAAAA,KAAC86C,GAAiB,CAAA76C,SAAC,eACnBD,EAAAA,GAAAA,KAACg7C,GAAiB,CAAA/6C,SAAE2zD,GAAiB84B,QAAQriF,aAAa0sF,kBAG7DnjC,GAAiB84B,QAAQriF,aAAamnB,oBACrCtxB,EAAAA,GAAAA,MAAC06C,GAAY,CAAA36C,SAAA,EACXD,EAAAA,GAAAA,KAAC86C,GAAiB,CAAA76C,SAAC,wBACnBD,EAAAA,GAAAA,KAACg7C,GAAiB,CAAA/6C,SAAE2zD,GAAiB84B,QAAQriF,aAAamnB,uBAG7DoiC,GAAiB84B,QAAQriF,aAAa4sF,cACrC/2F,EAAAA,GAAAA,MAAC06C,GAAY,CAAA36C,SAAA,EACXD,EAAAA,GAAAA,KAAC86C,GAAiB,CAAA76C,SAAC,yBACnBD,EAAAA,GAAAA,KAACg7C,GAAiB,CAAA/6C,SAAE2zD,GAAiB84B,QAAQriF,aAAa4sF,iBAG7DrjC,GAAiB84B,QAAQriF,aAAau5B,WACrC1jC,EAAAA,GAAAA,MAAC06C,GAAY,CAAA36C,SAAA,EACXD,EAAAA,GAAAA,KAAC86C,GAAiB,CAAA76C,SAAC,kBACnBD,EAAAA,GAAAA,KAACg7C,GAAiB,CAAA/6C,SAAE2zD,GAAiB84B,QAAQriF,aAAau5B,iBAOjEgwB,GAAiB84B,QAAQiF,MAAM1wF,OAAS,IACvCf,EAAAA,GAAAA,MAACs6C,GAAc,CAAAv6C,SAAA,EACbC,EAAAA,GAAAA,MAACw6C,GAAmB,CAAAz6C,SAAA,EAClBD,EAAAA,GAAAA,KAAClJ,EAAY,CAACsR,KAAM,KAAM,iBAChBwrD,GAAiB84B,QAAQiF,MAAM1wF,OAAO,QAElDf,EAAAA,GAAAA,MAACg7C,GAAgB,CAAAj7C,SAAA,CACd2zD,GAAiB84B,QAAQiF,MAAM3E,MAAM,EAAG,GAAG1rF,IAAI,CAACqX,EAAMkT,KACrD3rB,EAAAA,GAAAA,MAACk7C,GAAW,CAAAn7C,SAAA,EACVC,EAAAA,GAAAA,MAACo7C,GAAgB,CAAAr7C,SAAA,CACd0Y,EAAKkT,MAAM,KAAGlT,EAAKoT,OAAS,iBAE/B7rB,EAAAA,GAAAA,MAACs7C,GAAkB,CAAAv7C,SAAA,EACjBC,EAAAA,GAAAA,MAAA,QAAAD,SAAA,CAAO0Y,EAAK4xE,MAAM,QAAG5xE,EAAK4+E,aAAa,YAAK5+E,EAAKkxD,UAAY,SAC7D3pE,EAAAA,GAAAA,MAAA,UAAAD,SAAA,CAAS0Y,EAAK8+E,UAAUtkB,eAAe,SAAS,mBANlCtnD,IAUnB+nC,GAAiB84B,QAAQiF,MAAM1wF,OAAS,IACvCf,EAAAA,GAAAA,MAAC07C,GAAiB,CAAA37C,SAAA,CAAC,yBACF2zD,GAAiB84B,QAAQiF,MAAM1wF,OAAS,EAAE,mBAG5D2yD,GAAiB84B,QAAQiF,MAAM1wF,OAAS,IACvCf,EAAAA,GAAAA,MAAC06C,GAAY,CAAC/5C,MAAO,CAAEa,UAAW,UAAWkgG,WAAY,UAAW/G,UAAW,qBAAsB56F,SAAA,EACnGD,EAAAA,GAAAA,KAAC86C,GAAiB,CAAA76C,SAAC,sBACnBC,EAAAA,GAAAA,MAAC86C,GAAiB,CAACn6C,MAAO,CAAEkX,WAAY,OAAQ/W,MAAO,WAAYf,SAAA,CAChE2zD,GAAiB84B,QAAQiF,MAAM9qD,OAAO,CAACmjC,EAAKrxD,IAASqxD,EAAMrxD,EAAK8+E,UAAW,GAAGtkB,eAAe,SAAS,wBASjHvf,GAAiB84B,QAAQvjF,aAAeyqD,GAAiB84B,QAAQriF,cAA0D,IAA1CupD,GAAiB84B,QAAQiF,MAAM1wF,SAChHjB,EAAAA,GAAAA,KAAC47C,GAAiB,CAAA37C,SAAC,4DAMzBiT,SAASsF,OAIXxY,EAAAA,GAAAA,KAACqlG,GAAAA,EAAa,CACZ9pG,OAAQi2D,GACRh2D,QAAS2zF,GACTrpD,UAAWmpD,GACXvuF,MAAM,kCACNJ,KAAMu4F,EAAAA,IACNx9F,QAAQ,UACR+yD,YAAY,sBACZC,WAAW,kBAAYpuD,SAEtByxD,IAAwB,mFAI7BxxD,EAAAA,GAAAA,MAACmlG,GAAAA,EAAa,CACZ9pG,OAAQm7D,GACRl7D,QA1qXiC8pG,KACnC3uC,IAA8B,GAC9BE,GAAsB,OAyqXpB/wB,UA/rXkCvnC,UACpC,IAAKq4D,GAAoB,OAEzB,MAAM,OAAEmsB,EAAM,WAAE4D,EAAU,aAAEmd,GAAiBltC,GAEzCktC,OA9DoCvlG,OAAOwkF,EAAQ4D,KACvD,GAAIA,EAAWtG,UAAYnkF,IAASC,GAClC,IACE+xD,GAAY,OAAQ,cAAe,eAAe,gCAAD7kD,OAC7Bs9E,EAAW19E,KAAI,yBAERs8F,EAAAA,GAAAA,IACzB93F,GAASnE,GACTq9E,EAAWtG,SACXlkF,GACAD,IAGFgyD,GAAY,UAAW,cAAe,iBAAiB,mBAAD7kD,OACzCs9E,EAAW19E,KAAI,2BAG5Bq8C,GAAU,uCAADj8C,OAAiBs9E,EAAW19E,KAAI,+CAA0B,UAErE,CAAE,MAAOvK,GAAQ,IAAD0oB,EAAAo+E,EAEdt3C,GAAY,QAAS,cAAe,eAAe,+BAAD7kD,OAC5Bs9E,EAAW19E,KAAI,MAAAI,OAAK3K,EAAMoE,UAGhD,MAAM6jB,GAAyB,QAAdS,EAAA1oB,EAAMkiB,gBAAQ,IAAAwG,GAAM,QAANo+E,EAAdp+E,EAAgB1e,YAAI,IAAA88F,OAAN,EAAdA,EAAsB1iG,UAAWpE,EAAMoE,SAAW,sBAEnE,YADAwiD,GAAU,uDAADj8C,OAAgCs9E,EAAW19E,KAAI,OAAAI,OAAMsd,GAAY,QAE5E,CAIFugE,GAAmBnE,IAgCX0iB,CAAkC1iB,EAAQ4D,EAAYA,EAAW19E,OAGvEi+E,GAAmBnE,GACnBz9B,GAAU,4BAAwB,SAIpCqR,IAA8B,GAC9BE,GAAsB,OAgrXpBn2D,MAAM,yBACNJ,KAAM2jG,EAAAA,IACN5oG,QAAQ,SACR+yD,YAAY,cACZC,WAAW,cAAQpuD,SAAA,EAEnBC,EAAAA,GAAAA,MAAA,KAAAD,SAAA,CAAG,0BAAsBC,EAAAA,GAAAA,MAAA,UAAAD,SAAA,CAAQ,KAAoB,OAAlB22D,SAAkB,IAAlBA,IAA8B,QAAZzR,GAAlByR,GAAoB+vB,kBAAU,IAAAxhC,QAAZ,EAAlBA,GAAgCl8C,OAAQ,eAAe,OAAU,QACjF,OAAlB2tD,SAAkB,IAAlBA,QAAkB,EAAlBA,GAAoBktC,gBACnB5jG,EAAAA,GAAAA,MAAA,KAAGW,MAAO,CACRK,WAAY,oDACZJ,QAAS,UACTM,aAAc,MACdD,OAAQ,mCACRH,MAAO,UACPW,SAAU,SACVmW,OAAQ,aACR7X,SAAA,EACAD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,wBAAkB,yEAMhCC,EAAAA,GAAAA,MAACmlG,GAAAA,EAAa,CACZ9pG,OAAQu7D,GACRt7D,QArqXqCkqG,KACvC3uC,IAAkC,IAqqXhCjxB,UAtrXsC6/D,KAExCl4C,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP82B,kBAAmB,MAGrB8yB,GAAe,IAEf5D,GAAU,iCAADj8C,OAAqBirB,GAAYrzB,OAAM,uCAA6B,WAG7E81D,IAAkC,IA2qXhCr2D,MAAM,sCACNJ,KAAM2jG,EAAAA,IACN5oG,QAAQ,SACR+yD,YAAY,uBACZC,WAAW,cAAQpuD,SAAA,EAEnBC,EAAAA,GAAAA,MAAA,KAAAD,SAAA,CAAG,0BAAsBC,EAAAA,GAAAA,MAAA,UAAAD,SAAA,CAAQ,iCAAkBq0B,GAAYrzB,OAAO,oBAAkB,QACxFf,EAAAA,GAAAA,MAAA,KAAGW,MAAO,CACRK,WAAY,oDACZJ,QAAS,UACTM,aAAc,MACdD,OAAQ,mCACRH,MAAO,UACPW,SAAU,SACVmW,OAAQ,aACR7X,SAAA,EACAD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,wBAAkB,oGAK9BC,EAAAA,GAAAA,MAACmlG,GAAAA,EAAa,CACZ9pG,OAAQ03D,GAAoB13D,OAC5BC,QAASA,IAAM03D,GAAuB,CAAE33D,QAAQ,EAAO43D,UAAW,KAAMC,aAAc,GAAIC,YAAa,IACvGvtB,UAl6iByBvnC,UAC3B,MAAM,UAAE40D,EAAS,aAAEC,EAAY,YAAEC,GAAgBJ,GAKjD,GAFAC,GAAuB,CAAE33D,QAAQ,EAAO43D,UAAW,KAAMC,aAAc,GAAIC,YAAa,IAEnFF,EAEL,IAEE,MAAMiuC,EAAgBjuC,IAAcprD,OAAOorD,GAAWh+C,WAAW,SAGjE,GAAIisF,GAAiB/tC,EAAc,EACjC,IAAK,IAADuyC,EACF,MAAMhlF,QAAiB2U,EAAAA,GAAAA,IACrB49B,EACAh3D,GACAD,GACAuR,GAASnE,IAGLiO,GAAuB,QAAbquF,EAAAhlF,EAASlY,YAAI,IAAAk9F,OAAA,EAAbA,EAAetxE,cAAe1T,EAASlY,MAAQ,GAG/D,IAAK,MAAMm9F,KAAWtuF,EACpB,UACQuuF,EAAAA,GAAAA,IACJ3yC,EACA0yC,EAAQv8F,GACRnN,GACAD,GAEJ,CAAE,MAAOqoB,GAEP+gC,IAAaA,GAAU,oDAAwC,CAAEltD,KAAM,SACzE,CAOJ,CAAE,MAAOmsB,GACP+gC,IAAaA,GAAU,oDAAwC,CAAEltD,KAAM,SACzE,CAIF,GAAIgpG,EACF,UAEQ96E,GAAgB6sC,EAAWj3D,GAAOC,IAAU,GAClDmpD,IAAaA,GAAU,kDAADj8C,OAAiC+pD,GAAgB,UAAS,kDAAsB,UACxG,CAAE,MAAO7uC,GACP+gC,IAAaA,GAAU,oCAAgC,CAAEltD,KAAM,SAEjE,CAIF,MACMw0E,GADiB5tE,MAAMC,QAAQwO,GAAS6H,SAAW7H,GAAS6H,QAAU,IACtC1V,OAAO41B,GAAKA,EAAElsB,KAAO6pD,GAC3D+W,GAAc0C,GAQdjpD,IAAgB,EAElB,CAAE,MAAOY,GACP+gC,IAAaA,GAAU,oCAAgC,CAAEltD,KAAM,SACjE,GAw1iBEsI,MAAM,iBACNJ,KAAM2jG,EAAAA,IACN5oG,QAAQ,SACR+yD,YAAY,SACZC,WAAW,cAAQpuD,SAAA,EAEnBC,EAAAA,GAAAA,MAAA,KAAAD,SAAA,CAAG,kCAA8BC,EAAAA,GAAAA,MAAA,UAAAD,SAAA,CAAQ,IAAEgzD,GAAoBG,aAAa,OAAU,OACrFH,GAAoBI,YAAc,IACjCnzD,EAAAA,GAAAA,MAAA,KAAGW,MAAO,CAAEK,WAAY,UAAWJ,QAAS,UAAWM,aAAc,MAAOD,OAAQ,oBAAqB2W,OAAQ,aAAc7X,SAAA,EAC7HD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,wBAAkB,mBAAYC,EAAAA,GAAAA,MAAA,UAAAD,SAAA,CAASgzD,GAAoBI,YAAY,qCAAyB,8CAM9GnzD,EAAAA,GAAAA,MAACmlG,GAAAA,EAAa,CACZ9pG,OAAQ++D,GACR9+D,QAASA,IAAM++D,IAA2B,GAC1Cz0B,UAAWA,KACTy0B,IAA2B,GAvqTLh8D,WAE1B,MAAM,gBAAEmlC,EAAe,YAAEc,EAAW,SAAEC,GAAa2qB,GAAgB5rB,eAGnEiqB,GAAY/pB,GAKZn8B,WAAW,KACToc,IAAgB,GAChBuqC,GAAY,UAAW,SAAU1pB,EAAY,WAADn7B,OAAUo7B,EAAQ,8BAAAp7B,OAAwBq6B,EAAgB1R,qBACrG,MA2pTC+zE,IAEFrlG,MAAM,wDACNJ,KAAMu4F,EAAAA,IACNx9F,QAAQ,SACR+yD,YAAY,0BACZC,WAAW,cAAQpuD,SAAA,EAEnBC,EAAAA,GAAAA,MAAA,KAAGW,MAAO,CAAEK,WAAY,UAAWJ,QAAS,UAAWM,aAAc,MAAOD,OAAQ,oBAAqB2W,OAAQ,aAAc7X,SAAA,EAC7HD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,iCAAqB,4CAAwBD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,qEAA8C,QAE7GC,EAAAA,GAAAA,MAAA,KAAAD,SAAA,CAAG,iCAA6BD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,mCAA8B,QACtED,EAAAA,GAAAA,KAAA,KAAAC,UAAGD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,0CAIbC,EAAAA,GAAAA,MAACmlG,GAAAA,EAAa,CACZ9pG,OAAQi/D,GACRh/D,QAASA,IAAMi/D,IAA2B,GAC1C30B,UAAWA,KACT20B,IAA2B,GAjnTGl8D,WAGlC,MAAM,gBAAEmlC,EAAe,YAAEc,EAAW,SAAEC,GAAa2qB,GAAgB5rB,eAGnEiqB,GAAY/pB,GAOZn8B,WAAW,KACToc,IAAgB,GAChBuqC,GAAY,UAAW,SAAU1pB,EAAY,WAADn7B,OAAUo7B,EAAQ,8BAAAp7B,OAAwBq6B,EAAgB1R,qBACrG,MAkmTCg0E,IAEFtlG,MAAM,wCACNJ,KAAMu4F,EAAAA,IACNx9F,QAAQ,SACR+yD,YAAY,iBACZC,WAAW,cAAQpuD,SAAA,EAEnBD,EAAAA,GAAAA,KAAA,KAAAC,SAAG,2DACHC,EAAAA,GAAAA,MAAA,KAAGW,MAAO,CAAEa,UAAW,SAAUV,MAAO,WAAYf,SAAA,EAClDD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,qCAAuB,iHAEjCD,EAAAA,GAAAA,KAAA,KAAGa,MAAO,CAAEa,UAAW,UAAWzB,SAAC,4GAMrCC,EAAAA,GAAAA,MAACmlG,GAAAA,EAAa,CACZ9pG,OAAQm/D,GACRl/D,QAASA,IAAMm/D,IAA2B,GAC1C70B,UAAWA,KACT60B,IAA2B,GAnnTGp8D,WAElC,MAAM,gBAAEmlC,EAAe,YAAEc,EAAW,SAAEC,GAAa2qB,GAAgBzqB,eAGnEmmB,IAA4B,GAG5BvjD,WAAW,KACTkmD,GAAY/pB,GAGZ8rD,GAA2B,UAG3BjoF,WAAW,KACToc,IAAgB,GAChBuqC,GAAY,UAAW,SAAU1pB,EAAY,WAADn7B,OAAUo7B,EAAQ,8BAAAp7B,OAAwBq6B,EAAgB1R,qBACrG,MACF,KAimTCi0E,IAEFvlG,MAAM,mCACNJ,KAAMu4F,EAAAA,IACNx9F,QAAQ,SACR+yD,YAAY,0BACZC,WAAW,cAAQpuD,SAAA,EAEnBC,EAAAA,GAAAA,MAAA,OAAKW,MAAO,CACVuB,QAAS,OACT2H,IAAK,OACLjJ,QAAS,OACTwiE,gBAAiB,yBACjBniE,OAAQ,mCACRC,aAAc,MACd6W,aAAc,QACdhY,SAAA,EACAD,EAAAA,GAAAA,KAACK,EAAAA,EAAe,CAACC,KAAMu4F,EAAAA,IAAuBh4F,MAAO,CAAEG,MAAO,UAAWW,SAAU,OAAQD,UAAW,UACtGxB,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACED,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,oBAAkB,mHAG9BC,EAAAA,GAAAA,MAAA,KAAAD,SAAA,CAAG,iCAC4BD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,gBAAiB,QAExDD,EAAAA,GAAAA,KAAA,KAAGa,MAAO,CAAEa,UAAW,UAAWzB,SAAC,wCAMrCC,EAAAA,GAAAA,MAACmlG,GAAAA,EAAa,CACZ9pG,OAAQq/D,GACRp/D,QAASA,IAAMq/D,IAA4B,GAC3C/0B,UAAWA,KACT+0B,IAA4B,GAC5BzL,GAAgB/2B,cAAc,oBAG9B,MAKM6tE,GALgBlnG,MAAMC,QAAQwO,GAASukB,mBACzCvkB,GAASukB,kBACRvkB,GAASukB,kBAAoB,CAACvkB,GAASukB,mBAAqB,IAG7BpyB,OAAO2xB,GAAW,eAANA,GAC3C20E,EAAcvmG,SAAS,cAC1BumG,EAAcppF,KAAK,aAIhBopF,EAAcvmG,SAAS,aAAaumG,EAAcppF,KAAK,YACvDopF,EAAcvmG,SAAS,cAAcumG,EAAcppF,KAAK,aAE7D2wC,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP0yB,kBAAmBk0E,KAGrBh4C,GAAY,OAAQ,SAAU,mBAAoB,uEAGlD3mD,WAAW,KACToc,IAAgB,IACf,MAELjjB,MAAM,gCACNJ,KAAMu4F,EAAAA,IACNx9F,QAAQ,SACR+yD,YAAY,YACZC,WAAW,cAAQpuD,SAAA,EAEnBC,EAAAA,GAAAA,MAAA,KAAAD,SAAA,CAAG,mCAC8BD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,kBAAsB,oBAE/DC,EAAAA,GAAAA,MAAA,KAAGW,MAAO,CAAEa,UAAW,UAAWzB,SAAA,CAAC,kDACOD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,cAAkB,WAKtEC,EAAAA,GAAAA,MAACmlG,GAAAA,EAAa,CACZ9pG,OAAQu/D,GACRp6D,MAAM,6CACN0tD,YAAY,iBACZC,WAAW,cACXhzD,QAAQ,UACRiF,KAAMu4F,EAAAA,IACN/yD,UAAWA,KACTi1B,IAA8B,GAC9B3L,GAAgB/2B,cAAc,aAC9B+2B,GAAgB/2B,cAAc,WAG9B,MAAM,gBAAEqL,GAAoB0rB,GAAgBvqB,eAC5C4oB,GAAY/pB,GAEZ8rD,GAA2B,aAG3BjoF,WAAW,KACToc,IAAgB,IACf,MAELnoB,QAASA,IAAMu/D,IAA8B,GAAO96D,SAAA,EAEpDC,EAAAA,GAAAA,MAAA,KAAAD,SAAA,CAAG,mCAA+BD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,+BAAgC,oBAC1EC,EAAAA,GAAAA,MAAA,KAAGW,MAAO,CAAEa,UAAW,UAAWzB,SAAA,CAAC,+CACHD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,kBAAsB,uCAA6BD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,4BAA0B,WAK/HD,EAAAA,GAAAA,KAACqlG,GAAAA,EAAa,CACZ9pG,OAAQy/D,GACRt6D,MAAM,uDACN0tD,YAAY,uBACZC,WAAW,kCACXhzD,QAAQ,SACRiF,KAAMu4F,EAAAA,IACN/yD,UAAWA,KACTm1B,IAA4B,GAC5B97D,GAAkB,qBAAqB,GACvCA,GAAkB,gBAAiB,IACnCA,GAAkB,eAAgB,IAClCA,GAAkB,eAAgB,MAClC+uD,GAAY,OAAQ,UAAW,oBAAqB,mDAEtD1yD,QAASA,IAAMy/D,IAA4B,GAAOh7D,UAElDC,EAAAA,GAAAA,MAAA,OAAAD,SAAA,EACEC,EAAAA,GAAAA,MAAA,KAAGW,MAAO,CAAEoX,aAAc,QAAShY,SAAA,CAAC,qCACPC,EAAAA,GAAAA,MAAA,UAAAD,SAAA,CAAS8pE,GAAkBoJ,eAAe,QAAS,CAAEklB,sBAAuB,EAAGC,sBAAuB,IAAK,sBAAqB,gDAE7Jt4F,EAAAA,GAAAA,KAAA,KAAGa,MAAO,CACRc,SAAU,UACVX,MAAO,UACP+W,WAAY,MACZE,aAAc,UACdnX,QAAS,UACTwiE,gBAAiB,UACjBliE,aAAc,MACdD,OAAQ,qBACRlB,SAAC,sGAGHD,EAAAA,GAAAA,KAAA,KAAGa,MAAO,CACRc,SAAU,SACVX,MAAO,UACPiX,aAAc,UACdhY,SAAC,+FAGHC,EAAAA,GAAAA,MAAA,MAAIW,MAAO,CACTc,SAAU,SACVX,MAAO,UACP88F,YAAa,SACbhmF,OAAQ,GACR7X,SAAA,EACAD,EAAAA,GAAAA,KAAA,MAAAC,SAAI,mCACJD,EAAAA,GAAAA,KAAA,MAAAC,SAAI,sBACJD,EAAAA,GAAAA,KAAA,MAAAC,SAAI,4CAMVC,EAAAA,GAAAA,MAACmlG,GAAAA,EAAa,CACZ9pG,OAAQ2/D,GACRx6D,MAAM,4BACN0tD,YAAY,YACZ/yD,QAAQ,UACRyqC,UAAWA,KACTq1B,IAA8B,GAC9B/L,GAAgB/2B,cAAc,aAG9B,MAKM6tE,GALgBlnG,MAAMC,QAAQwO,GAASukB,mBACzCvkB,GAASukB,kBACRvkB,GAASukB,kBAAoB,CAACvkB,GAASukB,mBAAqB,IAG7BpyB,OAAO2xB,IACxC,CAAC,YAAa,kBAAmB,gBAAiB,aAAa5xB,SAAS4xB,IAG3Ek8B,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP0yB,kBAAmBk0E,KAGrBh4C,GAAY,OAAQ,SAAU,YAAa,sHAG3CshC,GAA2B,aAG3BjoF,WAAW,KACToc,IAAgB,IACf,MAELnoB,QAASA,IAAM2/D,IAA8B,GAAOl7D,SAAA,EAEpDC,EAAAA,GAAAA,MAAA,KAAAD,SAAA,CAAG,mCAA+BD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,cAAkB,oBAC5DC,EAAAA,GAAAA,MAAA,KAAGW,MAAO,CAAEa,UAAW,SAAUV,MAAO,WAAYf,SAAA,CAAC,4BAC9BD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,yDAA6D,kCAAwBD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,gBAAiB,WAO/IC,EAAAA,GAAAA,MAACmlG,GAAAA,EAAa,CACZ9pG,OAAQ6/D,GACR16D,MAAM,0CACN0tD,YAAY,iBACZC,WAAW,cACXhzD,QAAQ,UACRiF,KAAMu4F,EAAAA,IACN/yD,UAAWA,KACTu1B,IAA8B,GAE9BnN,GAAY,OAAQ,SAAU,YAAa,8DAI3C,MAAMi4C,EAAkB14F,GAASukB,mBAAqB,GACtD,IAAIo0E,EAGFA,EADEpnG,MAAMC,QAAQknG,GACA,IAAIA,GAEJp+F,OAAOo+F,GAAiBpzE,MAAM,KAAKzxB,IAAIiwB,GAAKA,EAAE/uB,QAAQ5C,OAAO2xB,GAAKA,GAIpF60E,EAAgBA,EAAcxmG,OAAO2xB,GAAW,cAANA,GAGrC60E,EAAczmG,SAAS,kBAC1BymG,EAActpF,KAAK,iBAKrB2wC,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP60B,+BAAgC,EAChCo5C,0BAA2B,EAC3Bv7C,kBAAmBo0E,KAIrBh3C,GAAgB/2B,cAAc,aAC9Bi3B,KAEApB,GAAY,OAAQ,SAAU,YAAY,kEAE5C1yD,QAASA,IAAM6/D,IAA8B,GAAOp7D,SAAA,EAEpDD,EAAAA,GAAAA,KAAA,KAAAC,SAAG,6DACHC,EAAAA,GAAAA,MAAA,KAAGW,MAAO,CAAEa,UAAW,SAAUV,MAAO,WAAYf,SAAA,EAClDD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,qCAAuB,qFAKnCC,EAAAA,GAAAA,MAACmlG,GAAAA,EAAa,CACZ9pG,OAAQ+/D,GACR56D,MAAM,sCACN0tD,YAAY,iBACZC,WAAW,cACXhzD,QAAQ,SACRiF,KAAMu4F,EAAAA,IACN/yD,UAAWvnC,UACTg9D,IAA2B,GAE3BrN,GAAY,OAAQ,SAAU,YAAY,0DAAD7kD,OAA4CoE,GAASnE,KAG9F,MAAM+8F,GAAmB54F,GAASukB,mBAAqB,IACpDe,MAAM,KACNnzB,OAAO2xB,GAAkB,YAAbA,EAAE/uB,QACdwrE,KAAK,KAGFs4B,GAAW/mG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACZkO,IAAQ,IACXukB,kBAAmBq0E,EACnBE,aAAc,KACdC,eAAgB,KAChBC,UAAW,KACXr6E,gBAAiB,UAIbgjC,GAAgB/2B,cAAc,UAGpCo1B,GAAY64C,GACZh3C,KAEApB,GAAY,OAAQ,SAAU,YAAY,qFAE5C1yD,QAASA,IAAM+/D,IAA2B,GAAOt7D,SAAA,EAEjDD,EAAAA,GAAAA,KAAA,KAAAC,SAAG,yDACHC,EAAAA,GAAAA,MAAA,KAAGW,MAAO,CAAEa,UAAW,SAAUV,MAAO,WAAYf,SAAA,EAClDD,EAAAA,GAAAA,KAAA,UAAAC,SAAQ,qCAAuB,iHAEjCD,EAAAA,GAAAA,KAAA,KAAGa,MAAO,CAAEa,UAAW,UAAWzB,SAAC,sEAMpCqzD,GAAc/3D,SACbyE,EAAAA,GAAAA,KAACqlG,GAAAA,EAAa,CACZ9pG,OAAQ+3D,GAAc/3D,OACtBmF,MAAO4yD,GAAc5yD,MACrBoC,QAASwwD,GAAcxwD,QACvBsrD,YAAY,iBACZC,WAAW,cACXhzD,QAAQ,SACRiF,KAAMu4F,EAAAA,IACN/yD,UAAWA,KACLwtB,GAAcxtB,WAChBwtB,GAAcxtB,YAEhBytB,GAAiB,CAAEh4D,QAAQ,EAAOmF,MAAO,GAAIoC,QAAS,GAAIgjC,UAAW,QAEvEtqC,QAASA,IAAM+3D,GAAiB,CAAEh4D,QAAQ,EAAOmF,MAAO,GAAIoC,QAAS,GAAIgjC,UAAW,UAKxF9lC,EAAAA,GAAAA,KAAC0mG,GAAiB,CAChBnrG,OAAQy7D,GACRx7D,QAASA,KACPy7D,IAAyB,GACzBE,GAAyB,OAE3B17D,OA1rXkC8C,eAAO7C,EAAcrB,GAAyB,IAAlBwxF,EAAK3xE,UAAAjZ,OAAA,QAAAkZ,IAAAD,UAAA,GAAAA,UAAA,GAAG,KAMxE,IAEE,IAAI0T,EACAluB,EAEU,aAAVrF,GACFuzB,EAAS9lB,GACTpI,EAAU,IACS,SAAVrF,GACTuzB,EAAS,EACTluB,EAAUmsF,GAAS,KAEnBj+D,EAAS,EACTluB,EAAU,IAMZ,MAAM61E,EAAa,CACjBh4E,MAAO7B,EAAa6B,OAAS7B,EAAa8B,iBAAmB,GAC7DC,OAAQ/B,EAAa+B,QAAU/B,EAAagC,kBAAoB,GAChEC,IAAKjC,EAAaiC,KAAOjC,EAAakC,eAAiB,GACvDC,IAAKnC,EAAamC,KAAOnC,EAAaoC,eAAiB,GACvDC,WAAYrC,EAAaqC,YAAcrC,EAAasC,sBAAwB,GAC5EC,cAAevC,EAAauC,eAAiBvC,EAAawC,yBAA2B,GACrFC,cAAezC,EAAayC,eAAiBzC,EAAa0C,yBAA2B,GACrFC,gBAAiB3C,EAAa2C,iBAAmB3C,EAAa4C,2BAA6B,GAC3FwJ,QAAS8lB,EACThvB,SAAUc,GAKZ,IAAIlB,EAEqB,OAArB04D,SAAqB,IAArBA,IAAAA,GAAuBiyB,QAAU9uF,IAAU68D,GAAsB78D,OAWnEmE,QAAestF,EAAAA,GAAAA,IAAoB,CACjC5vF,SACAC,YACA2L,QAAS8lB,EACThvB,SAAUc,EACV/B,IAAK43E,EAAW53E,IAChBJ,MAAOg4E,EAAWh4E,MAClBE,OAAQ83E,EAAW93E,OACnBI,IAAK03E,EAAW13E,IAChBE,WAAYw3E,EAAWx3E,WACvBE,cAAes3E,EAAWt3E,cAC1BE,cAAeo3E,EAAWp3E,cAC1BE,gBAAiBk3E,EAAWl3E,kBAIrB,OAATinD,SAAS,IAATA,IAAAA,GAAY,6EAAiD,aAe7D9mD,QAAewtF,EAAAA,GAAAA,IAAe,CAC5B9vF,SACAC,YACA2L,QAAS8lB,EACThvB,SAAUc,EAEVnC,MAAOg4E,EAAWh4E,MAClBE,OAAQ83E,EAAW93E,OACnBE,IAAK43E,EAAW53E,IAChBE,IAAK03E,EAAW13E,IAChBE,WAAYw3E,EAAWx3E,WACvBE,cAAes3E,EAAWt3E,cAC1BE,cAAeo3E,EAAWp3E,cAC1BE,gBAAiBk3E,EAAWl3E,kBAIrB,OAATinD,SAAS,IAATA,IAAAA,GAAY,6EAA4C,YAI1D2P,GAAuB,IAIvBgC,IAAyB,GACzBE,GAAyB,KAC3B,CAAE,MAAOz4D,GACP,MAAM,IAAImkB,MAAMnkB,EAAMoE,SAAW,6DACnC,CACF,EAykXIpH,aAAc,CACZ8B,gBAAiBiQ,GAASjQ,gBAC1BE,iBAAkB+P,GAAS/P,iBAC3BE,cAAe6P,GAAS7P,cACxBE,cAAe2P,GAAS3P,cACxBE,qBAAsByP,GAASzP,qBAC/BE,wBAAyBuP,GAASvP,wBAClCE,wBAAyBqP,GAASrP,wBAClCE,0BAA2BmP,GAASnP,2BAEtC3C,kBAAuC,OAArBu7D,SAAqB,IAArBA,QAAqB,EAArBA,GAAuBv7D,mBAAoB,KAC7DC,cAAmC,OAArBs7D,SAAqB,IAArBA,QAAqB,EAArBA,GAAuBt7D,eAAgB,KACrDC,gBAAqC,OAArBq7D,SAAqB,IAArBA,QAAqB,EAArBA,GAAuBr7D,iBAAkB,KACzDC,gBAAiB,CACfC,eAAgB4J,KAAkBA,GAAc,mBAAqBA,GAAc,iBACnF3J,WAAY2J,KAAkBA,GAAc,mBAAqBA,GAAc,iBAC/E1J,aAAc0J,IAAiBA,GAAc,qBAKhDA,GAAc,iBACb3F,EAAAA,GAAAA,KAAC2mG,GAAAA,EAAY,CACXC,YAAY,gBAKftvC,KACCt3D,EAAAA,GAAAA,KAAC6mG,GAAAA,mBAAkB,CACjBlkF,MAAO60C,GACPj8D,OAAQ+7D,GACR97D,QAASozF,KAKZ3jC,KACCjrD,EAAAA,GAAAA,KAAC8mG,GAAiC,CAChCnkF,MAAOlV,GACPq4B,UA96hB0BvnC,UAC9B+S,QAAQ42B,IAAI,mFAGZgjB,IAAoC,GACpCE,IAA6B,GAE7B,IAEE95C,QAAQ42B,IAAI,4CACNm7C,EAAAA,GAAAA,IACJ51E,GAASnE,GACTy/B,EACA5sC,GACAD,GACA,UACA,OAIFoV,QAAQ42B,IAAI,oGACN0pC,IAAe,GAGrBtgE,QAAQ42B,IAAI,oEACN0iC,KAENt5D,QAAQ42B,IAAI,wBACZod,IAAaA,GAAU,+EAAsD,CAAEltD,KAAM,WAEvF,CAAE,MAAOsG,GACP4S,QAAQ5S,MAAM,gBAAYA,GAC1B4mD,IAAaA,GAAU,UAADj8C,OAAW3K,EAAMoE,SAAWpE,GAAS,CAAEtG,KAAM,SACrE,CAAC,QAECgzD,IAA6B,EAC/B,GA24hBIrlB,SAv4hByBghE,KAC7B,IAEE77C,IAAoC,GACpCE,IAA6B,GAG7BqC,GAAYnuD,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACXD,GAAI,IACP60B,+BAAgC,KAMlCmxB,IAAaA,GAAU,mFAAmD,CAAEltD,KAAM,QAEpF,CAAE,MAAOsG,GACP4S,QAAQ5S,MAAM,oDAAgCA,EAChD,GAq3hBIsnC,YAAa,CACXglC,SAAU5uE,GAAa,GAAAiN,OAAGjN,GAAWkjB,YAAc,GAAE,KAAAjW,OAAIjN,GAAWojB,OAAS,GAAE,KAAAnW,OAAIjN,GAAWsjB,UAAY,GAAE,KAAArW,OAAIjN,GAAWwjB,UAAY,IAAKpd,OAASrG,GACrJ0K,UAAoB,OAAVzK,SAAU,IAAVA,QAAU,EAAVA,GAAY4qG,eAAgB,iBAExC9qG,MAAOA,GACPC,SAAUA,MAKZm9B,IAAoBp8B,MACpB8C,EAAAA,GAAAA,KAACy0C,GAAW,CAAChG,UAAU,OAO3B,OAAI/gC,GACK6K,EAAAA,aAAsB48E,GAAajiF,SAASsF,MAI9C28E,EACT,CAIA,SAAeryB,EAAAA,KAAW/f,IAOpBkkD,GAAsBhwG,EAAAA,EAAOC,IAAGgwG,KAAAA,IAAA9vG,EAAAA,EAAAA,GAAA,iDAKhC+vG,GAAqBlwG,EAAAA,EAAOY,OAAMuvG,KAAAA,IAAAhwG,EAAAA,EAAAA,GAAA,08BAGNe,GAASA,EAAMuB,QAAU,OAAS,OAE9CvB,GAASA,EAAMwB,SAAW,UAAYxB,EAAMoD,OAAS,UAAY,UAI3EpD,GAASA,EAAMyB,SAAW,cAAgB,UAMrCzB,GAASA,EAAMyB,SAAW,MAASzB,EAAMsnD,SAAW,MAAQ,MAClEtnD,GAASA,EAAMyB,SAAW,UAAYzB,EAAMsnD,SAAW,UAAY,UAG1DtnD,GAASA,EAAMwB,SAAW,UAAY,UAKtCxB,GAASA,EAAMwB,SAAW,UAAY,UAC9BxB,GAASA,EAAMwB,SAAW,yBAA2B,0BAcxCxB,GAASA,EAAMoD,OAAS,SAAW,QAUtE8rG,GAAuBpwG,EAAAA,EAAOC,IAAGowG,KAAAA,IAAAlwG,EAAAA,EAAAA,GAAA,8oBAkCjCmwG,GAAwBtwG,EAAAA,EAAOC,IAAGswG,KAAAA,IAAApwG,EAAAA,EAAAA,GAAA,2IASlCqwG,GAA0BxwG,EAAAA,EAAOuC,MAAKkuG,KAAAA,IAAAtwG,EAAAA,EAAAA,GAAA,yQActCuwG,GAAyB1wG,EAAAA,EAAOC,IAAG0wG,KAAAA,IAAAxwG,EAAAA,EAAAA,GAAA,yIASnCywG,GAAqB5wG,EAAAA,EAAOC,IAAG4wG,KAAAA,IAAA1wG,EAAAA,EAAAA,GAAA,q0BACxBe,GAAyB,IAAhBA,EAAMy7C,MAAc,eAAiB,0BAC/Cz7C,GAASA,EAAM4vG,SAAW,UAAY,UAEvC5vG,GAAyB,IAAhBA,EAAMy7C,MAAc,UAAY,UAIpCz7C,GACZA,EAAM4vG,SAAW,UACjB5vG,EAAM+B,SAAW,UAAY,QAEhB/B,GAASA,EAAM+B,SAAW,oBAAsB,wBAC9C/B,GAAyB,IAAhBA,EAAMy7C,MAAc,oBAAsB,OACrDz7C,GAASA,EAAM+B,SAAW,MAAQ,MAKjC/B,GACZA,EAAM4vG,SAAW,UACjB5vG,EAAM+B,SAAW,UAAY,UAEhB/B,GAASA,EAAM+B,SAAW,MAAQ,MAmBjC/B,GAA8B,IAApBA,EAAMy7C,OAAS,GAC1Bz7C,GAASA,EAAM+B,SAAW,MAAQ,OAI/C8tG,GAAoB/wG,EAAAA,EAAO2D,KAAIqtG,KAAAA,IAAA7wG,EAAAA,EAAAA,GAAA,+FAQ/B8wG,GAAuB9uE,GACtBA,EACEA,EACJ7O,cACAsf,UAAU,OACVhqB,QAAQ,mBAAoB,IAJb,GAQdq7E,GAAqBp4B,EAAAA,KAAWqlC,IAkB/B,IAlBgC,MACrC9oG,EAAK,SACLoC,EAAQ,OACR06C,EAAM,QACN/4B,EAAU,GAAE,YACZthB,EAAc,aAAY,SAC1BlI,GAAW,EAAK,SAChBD,GAAW,EAAK,SAChBP,GAAW,EAAK,MAChBgG,EAAK,QACL6wB,GAAU,EAAK,YACfmrE,EAAc,4BAAa,KAC3B96F,EAAO,KAAI,SACXuX,GAAW,EAAK,YAChBuwF,GAAc,EAAK,eACnBpU,EAAc,eACdqH,EAAc,iBACdnnC,GAAmB,GACpBi0C,EACC,MAAO5sG,EAAQiiD,IAAa/gD,EAAAA,EAAAA,WAAS,IAC9BqsD,EAAYu/C,IAAiB5rG,EAAAA,EAAAA,UAAS,KACtC6rG,EAAgBC,IAAqB9rG,EAAAA,EAAAA,UAAS,GAE/CohD,GAAal3C,EAAAA,EAAAA,QAAO,MACpB6hG,GAAY7hG,EAAAA,EAAAA,QAAO,MACnBC,GAAcD,EAAAA,EAAAA,QAAO,MACrBD,GAAiBC,EAAAA,EAAAA,QAAO,MACxB8hG,GAAoB9hG,EAAAA,EAAAA,SAAO,GAG3B+hG,EAAkB7wF,EAAY7Y,MAAMC,QAAQI,GAASA,EAAQ,GAAMA,EAGnEspG,GAAkB5nE,EAAAA,EAAAA,SAAQ,KAC9B,IAAK+nB,GAAc74B,EAAS,OAAO7M,EAGnC,MAAMwlF,EAAmBV,GAAoBp/C,GAE7C,OAAO1lC,EAAQxjB,OAAOq0F,IACpB,IAAI/6F,EAEFA,EADE86F,EACMA,EAAeC,EAAQ70F,GAGjB,cAAVA,GAAmC,kBAAVA,EACnB60F,EAAO/6F,OAAS+6F,EAAOhrF,MAAQgrF,EAAO15E,aAAexS,OAAOksF,GACjD,WAAV70F,EACD60F,EAAO33B,SAAQ,GAAAjzD,OAAM4qF,EAAO33B,SAAQ,OAAAjzD,OAAM4qF,EAAO5yB,YAAc,IAAO4yB,EAAO/6F,OAAS6O,OAAOksF,GAE7FA,EAAO/6F,OAAS+6F,EAAO12F,OAAS02F,EAAOhrF,MAAQlB,OAAOksF,GAMlE,OADwBiU,GAAoBhvG,GACrByG,SAASipG,MAEjC,CAACxlF,EAAS0lC,EAAY74B,EAAS+jE,EAAgB50F,IAG5CypG,GAAe9nE,EAAAA,EAAAA,SAAQ,KAC3B,GAAIlpB,EAAU,CACZ,GAA+B,IAA3B6wF,EAAgBznG,OAAc,OAAOa,EA4BzC,OA1Be4mG,EAAgBpnG,IAAIo7C,IACjC,MAAMu3C,EAAS7wE,EAAQ/I,KAAKC,IACX+gF,EAAiBA,EAAe/gF,EAAKlb,GAAUkb,EAAIhR,IAAMgR,EAAIjb,OAASib,EAAIvB,WAAauB,EAAI1B,KAAO0B,IAEhGoiC,GAGnB,OAAIu3C,EAEED,EACKA,EAAeC,EAAQ70F,GAGlB,cAAVA,GAAmC,kBAAVA,EACpB60F,EAAO/6F,OAAS+6F,EAAOhrF,MAAQgrF,EAAO15E,aAAexS,OAAOksF,GAEvD,WAAV70F,EAEK60F,EAAO/6F,QAAU+6F,EAAO33B,SAAQ,GAAAjzD,OAAM4qF,EAAO33B,SAAQ,OAAAjzD,OAAM4qF,EAAO5yB,YAAc,IAAOt5D,OAAOksF,IAEhGA,EAAO/6F,OAAS+6F,EAAO12F,OAAS02F,EAAOhrF,MAAQlB,OAAOksF,GAGxDlsF,OAAO20C,KACbsxB,KAAK,KAGV,CAAO,CACL,IAAK06B,EAAiB,OAAO5mG,EAC7B,MAAMmyF,EAAS7wE,EAAQ/I,KAAKC,IACX+gF,EAAiBA,EAAe/gF,EAAKlb,GAAUkb,EAAIhR,IAAMgR,EAAIjb,OAASib,EAAIvB,WAAauB,EAAI1B,KAAO0B,IAEhGouF,GAEnB,OAAIzU,EACED,EACKA,EAAeC,EAAQ70F,GAEzB60F,EAAO/6F,OAAS+6F,EAAO12F,OAAS02F,EAAOhrF,MAAQlB,OAAOksF,GAGhD,aAAV70F,GAAkC,iBAAVA,GAAkD,IAApBspG,GAA6C,OAApBA,GAAgD,MAApBA,EAGzG3gG,OAAO2gG,GAFL,eAGX,GACC,CAACA,EAAiBtlF,EAASthB,EAAa+V,EAAUm8E,EAAgBqH,EAAgBj8F,KAGrF9B,EAAAA,EAAAA,WAAU,KACR,MAAMkX,EAAsBC,IACtBopC,EAAW52C,UAAY42C,EAAW52C,QAAQ2M,SAASa,EAAM5S,UAC3D27C,GAAU,GACV6qD,EAAc,MAIlB,GAAI9sG,EAEF,OADA2X,SAASjB,iBAAiB,YAAauC,GAChC,IAAMtB,SAAShB,oBAAoB,YAAasC,IAExD,CAACjZ,KAGJ+B,EAAAA,EAAAA,WAAU,KACJ/B,GAAUmL,EAAeO,SAAW0hG,EAAgB1nG,OAAS,GAC/DsG,WAAW,SAAAC,EAAA,OAA4B,QAA5BA,EAAMd,EAAeO,eAAO,IAAAO,OAAA,EAAtBA,EAAwBC,SAAS,MAEnD,CAAClM,EAAQotG,EAAgB1nG,UAG5B3D,EAAAA,EAAAA,WAAU,KACR,IAAKugD,EAAW52C,QAAS,OAEzB,MAAM6hG,EAA2BA,KAAO,IAADC,GACG,QAArBA,EAAGlrD,EAAW52C,eAAO,IAAA8hG,OAAA,EAAlBA,EAAoBC,aAAa,uBACjCP,EAAkBxhG,UACtCwhG,EAAkBxhG,SAAU,IAMhC6hG,IAGIhgD,GACFggD,KAED,CAAChgD,EAAY1pD,KAGhB9B,EAAAA,EAAAA,WAAU,KACR,GAAI/B,GAAUutD,GAAyC,IAA3B6/C,EAAgB1nG,SAAiB4W,GAAY4wF,EAAkBxhG,QAAS,CAElG,MAAMgiG,EAAQ1hG,WAAW,KACvB,MAAM0sF,EAAS0U,EAAgB,GACzBO,EAAc7N,EAAiBA,EAAepH,EAAQ70F,GAAU60F,EAAO3qF,IAAM2qF,EAAO50F,OAAS40F,EAG/FyU,IAAoBQ,IACtBznG,EAASynG,GACL/sD,GAAQA,EAAO/8C,EAAO8pG,GAC1B1rD,GAAU,GACV6qD,EAAc,IACdI,EAAkBxhG,SAAU,EAExB42C,EAAW52C,SACb42C,EAAW52C,QAAQkiG,gBAAgB,sBAGtC,KAEH,MAAO,IAAMp3F,aAAak3F,EAC5B,GACC,CAAC1tG,EAAQutD,EAAY6/C,EAAiB9wF,EAAUwjF,EAAgBj8F,EAAOspG,EAAiBjnG,EAAU06C,KAGrG7+C,EAAAA,EAAAA,WAAU,KACR,GAAI/B,GAAUitG,EAAUvhG,SAAWL,EAAYK,QAAS,CACtD,MAAMmiG,EAAiBA,KACrB,IAAKZ,EAAUvhG,UAAYL,EAAYK,QAAS,OAChD,MAAMg3C,EAAauqD,EAAUvhG,QAAQE,wBAC/BuN,EAAW9N,EAAYK,QAKvBi3C,EAAa72C,OAAO2J,YAAcitC,EAAWE,OAF9B,GACN,GAETC,EAAaH,EAAWrrC,IAFf,GAITy2F,EAAmBnrD,EAAa,KAAQA,EANpB,KAMsDE,EAAaF,EAAa,GAE1GxpC,EAAS7T,MAAMkG,KAAOk3C,EAAWl3C,KAAO,KACxC2N,EAAS7T,MAAMrK,MAAQynD,EAAWznD,MAAQ,KAC1Cke,EAAS7T,MAAMyoG,UAAYC,QAEvBF,GAEF30F,EAAS7T,MAAMs9C,OAAU92C,OAAO2J,YAAcitC,EAAWrrC,IAAM,EAAK,KACpE8B,EAAS7T,MAAM+R,IAAM,SAGrB8B,EAAS7T,MAAM+R,IAAOqrC,EAAWE,OAAS,EAAK,KAC/CzpC,EAAS7T,MAAMs9C,OAAS,SAI5BirD,IAEA,MAAM38C,EAAgBh4C,IAEhB7N,EAAYK,UAAYL,EAAYK,QAAQ2M,SAASa,EAAM5S,SAC7DunG,KAQJ,OAHA/hG,OAAO4K,iBAAiB,SAAUw6C,EAAc,CAAE+8C,SAAS,EAAMC,SAAS,IAC1EpiG,OAAO4K,iBAAiB,SAAUm3F,EAAgB,CAAEI,SAAS,IAEtD,KACLniG,OAAO6K,oBAAoB,SAAUu6C,EAAc,CAAEg9C,SAAS,IAC9DpiG,OAAO6K,oBAAoB,SAAUk3F,GAEzC,GACC,CAAC7tG,KAGJ+B,EAAAA,EAAAA,WAAU,KACJsJ,EAAYK,SAAWqhG,EAAiB,IAC1C1hG,EAAYK,QAAQ0K,UAAY22F,IAEjC,CAACK,EAAiBL,IAErB,MAWMoB,EAAqBzV,IAErBrtF,EAAYK,SACdshG,EAAkB3hG,EAAYK,QAAQ0K,WAGxC,MAAMu3F,EAAc7N,EAAiBA,EAAepH,EAAQ70F,GAAU60F,EAAO3qF,IAAM2qF,EAAO50F,OAAS40F,EAEnG,GAAIp8E,EAAU,CACZ,MAAM8xF,EAAgB3qG,MAAMC,QAAQypG,GAAmBA,EAAkB,GACnEkB,EAAYD,EAAchqG,SAASupG,GACrCS,EAAc/pG,OAAOiqG,GAAKA,IAAMX,GAChC,IAAIS,EAAeT,GAGvBznG,EAASmoG,GACLztD,GAAQA,EAAO/8C,EAAOwqG,EAC5B,MAEEnoG,EAASynG,GACL/sD,GAAQA,EAAO/8C,EAAO8pG,GAC1B1rD,GAAU,GACV6qD,EAAc,IAEdI,EAAkBxhG,SAAU,EACxB42C,EAAW52C,SACb42C,EAAW52C,QAAQkiG,gBAAgB,qBAanC1pD,EAAW5nC,EACZ7Y,MAAMC,QAAQypG,IAAoBA,EAAgBznG,OAAS,IAC1DynG,EACAoB,EAAkBnwG,GAAaP,IAAaqmD,IAAaxvB,IAAYr2B,GAAYs6D,EAEvF,OACEh0D,EAAAA,GAAAA,MAAC+mG,GAAmB,CAACh/F,IAAK41C,EAAY,wBAAmB,aAAYz+C,EAAMa,SAAA,EACzEC,EAAAA,GAAAA,MAACinG,GAAkB,CACjBl/F,IAAKugG,EACLpwG,KAAK,SACL+H,QA5De4pG,KACnB,GAAInwG,EAAU,OAGd4jD,GADkBjiD,GAGdA,GACF8sG,EAAc,KAsDZzuG,SAAUA,EACVD,SAAUmwG,EACVvuG,OAAQA,EACRkkD,SAAUA,EACV/lD,UAAW4G,EACX,aAAYlB,EAAMa,SAAA,CAEjBK,IACCN,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACXgG,SAAU,WACVE,KAAM,OACN/F,MAAO,UACPxK,MAAO,OACPC,OAAQ,OACR2L,QAAS,OACT4/D,WAAY,SACZ46B,eAAgB,UAChB38F,SACC6iE,EAAAA,aAAmBxiE,EAAM,CAAE8H,KAAM,QAGtCpI,EAAAA,GAAAA,KAACgoG,GAAiB,CAACtnG,MAAOmoG,EAAa5oG,SACpC,MAEC,GAAc,wBAAVb,GAAmCspG,EAAiB,CACtD,MAAMtuF,EAAiBgJ,EAAQ/I,KAAKC,IACnB+gF,EAAiBA,EAAe/gF,EAAKlb,GAAUkb,EAAIhR,IAAMgR,EAAIjb,OAASib,EAAIvB,WAAauB,EAAI1B,KAAO0B,IAChGouF,GAEnB,GAAItuF,IAAsD,IAAnCA,EAAe4oD,iBAA4D,MAAnC5oD,EAAe4oD,iBAA0B,CACtG,MAAMgnC,EAAanB,EAAahpF,QAAQ,eAAgB,IACxD,OACE3f,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACED,EAAAA,GAAAA,KAAA,QAAAC,SAAO+pG,KACPhqG,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACX2iE,WAAY,MACZ7hE,SAAU,UACVX,MAAO,UACP+W,WAAY,MACZjX,QAAS,UACTwiE,gBAAiB,UACjBliE,aAAc,MACdD,OAAQ,qBACRlB,SAAC,gBAKT,CACF,CACA,OAAO4oG,CACR,EA7BA,KA+BFT,IAAgBxuG,GAAY6lD,IAC3Bz/C,EAAAA,GAAAA,KAAA,QACE0mE,KAAK,SACLujC,SAAU,EACV9pG,QAAUjB,IACRA,EAAEkB,kBAEFqB,EADqBoW,EAAW,GAAK,KAGvCmjF,UAAY97F,IACV,GAAc,UAAVA,EAAEjJ,KAA6B,MAAViJ,EAAEjJ,IAAa,CACtCiJ,EAAEuU,iBACFvU,EAAEkB,kBAEFqB,EADqBoW,EAAW,GAAK,GAEvC,GAEFnX,MAAM,iBACNG,MAAO,CACLgG,SAAU,WACVG,MAAO,OACP4L,IAAK,MACLqnF,UAAW,mBACX/4F,WAAY,OACZC,OAAQ,OACRL,QAAS,MACT64F,OAAQ,UACR34F,MAAO,UACPoB,QAAS,OACT4/D,WAAY,SACZ46B,eAAgB,SAChBpmG,MAAO,OACPC,OAAQ,OACR2K,aAAc,MACdm3F,WAAY,gBACZgF,OAAQ,GAEVzD,aAAe56F,IACbA,EAAEyU,cAAc9S,MAAMK,WAAa,UACnChC,EAAEyU,cAAc9S,MAAMG,MAAQ,WAEhC+4F,aAAe76F,IACbA,EAAEyU,cAAc9S,MAAMK,WAAa,OACnChC,EAAEyU,cAAc9S,MAAMG,MAAQ,WAC9Bf,UAEFD,EAAAA,GAAAA,KAACsI,EAAAA,EAAC,CAACF,KAAM,UAKd7M,IAAW3B,IACVsG,EAAAA,GAAAA,MAACmnG,GAAoB,CAACp/F,IAAKrB,EAAY3G,SAAA,EACrCC,EAAAA,GAAAA,MAACqnG,GAAqB,CAAAtnG,SAAA,EACpBD,EAAAA,GAAAA,KAAC2nG,GAAsB,CAAA1nG,UACrBD,EAAAA,GAAAA,KAACqI,EAAAA,EAAM,CAACD,KAAM,QAEhBpI,EAAAA,GAAAA,KAACynG,GAAuB,CACtBx/F,IAAKvB,EACLtO,KAAK,OACL0J,YAAY,cACZzC,MAAOypD,EACPrnD,SAAWvC,IAELA,EAAEgrG,YAAYC,WAAajrG,EAAEgrG,YAAYC,UAAUh1F,WAAW,YAChEszF,EAAkBxhG,SAAU,GAE9BohG,EAAcnpG,EAAE2C,OAAOxC,QAEzBc,QAAUjB,GAAMA,EAAEkB,kBAClB46F,UAAY97F,IACV,GAAc,cAAVA,EAAEjJ,KAGJ,GADAiJ,EAAEuU,iBACEk1F,EAAgB1nG,OAAS,EAAG,CAAC,IAADmpG,EAC9B,MAAMC,EAAiC,QAAtBD,EAAGxjG,EAAYK,eAAO,IAAAmjG,OAAA,EAAnBA,EAAqB9rD,cAAc,wCACnD+rD,GACFA,EAAY5iG,OAEhB,OACK,GAAc,YAAVvI,EAAEjJ,KAGX,GADAiJ,EAAEuU,iBACEk1F,EAAgB1nG,OAAS,EAAG,CAAC,IAADqpG,EAC9B,MAAMlnF,EAAUpkB,MAAMiV,MAAwB,QAAnBq2F,EAAA1jG,EAAYK,eAAO,IAAAqjG,OAAA,EAAnBA,EAAqB5V,iBAAiB,0CAA2C,IACtG6V,EAAannF,EAAQA,EAAQniB,OAAS,GACxCspG,GACFA,EAAW9iG,OAEf,OACK,GAAc,QAAVvI,EAAEjJ,IAEX,GAAI0yG,EAAgB1nG,OAAS,EAAG,CAAC,IAADupG,EAC9BtrG,EAAEuU,iBACF,MAAM42F,EAAiC,QAAtBG,EAAG5jG,EAAYK,eAAO,IAAAujG,OAAA,EAAnBA,EAAqBlsD,cAAc,4CACnD+rD,GACFA,EAAY5iG,OAEhB,MAEE+1C,GAAU,OAEO,WAAVt+C,EAAEjJ,KACXiJ,EAAEuU,iBACF+pC,GAAU,GAENgrD,EAAUvhG,SACZuhG,EAAUvhG,QAAQQ,SAED,UAAVvI,EAAEjJ,MACXiJ,EAAEuU,iBACFvU,EAAEkB,yBAMT6vB,GACCjwB,EAAAA,GAAAA,KAAC6nG,GAAkB,CAAA5nG,SAAEm7F,IACnBuN,EAAgB1nG,OAAS,EAC3B0nG,EAAgBrnG,IAAI,CAAC2yF,EAAQpoE,KAC3B,MAAMq9E,EAAc7N,EAAiBA,EAAepH,EAAQ70F,GAAU60F,EAAO3qF,IAAM2qF,EAAO50F,OAAS40F,EACnG,IAAIwW,EAGFA,EADEzW,EACYA,EAAeC,EAAQ70F,GAGvB,cAAVA,GAAmC,kBAAVA,EACb60F,EAAO/6F,OAAS+6F,EAAOhrF,MAAQgrF,EAAO15E,aAAexS,OAAOksF,GACvD,WAAV70F,EACK60F,EAAO33B,SAAQ,GAAAjzD,OAAM4qF,EAAO33B,SAAQ,OAAAjzD,OAAM4qF,EAAO5yB,YAAc,IAAO4yB,EAAO/6F,OAAS6O,OAAOksF,GAE7FA,EAAO/6F,OAAS+6F,EAAO12F,OAAS02F,EAAOhrF,MAAQlB,OAAOksF,GAIxE,MAAM/5F,EAjNE+5F,KAClB,MAAMiV,EAAc7N,EAAiBA,EAAepH,EAAQ70F,GAAU60F,EAAO3qF,IAAM2qF,EAAO50F,OAAS40F,EACnG,OAAOp8E,EACH6wF,EAAgB/oG,SAASupG,GACzBR,IAAoBQ,GA6MG1oD,CAAWyzC,GACtBrgD,EAAQqgD,EAAOrgD,OAAS,EACxBm0D,EAAW9T,EAAO8T,UAAuB,IAAVn0D,IAAgBqgD,EAAO50F,QAAU40F,EAAO3qF,GAGvEohG,EAA4B,wBAAVtrG,IAA+D,IAA3B60F,EAAOjxB,iBAAoD,MAA3BixB,EAAOjxB,iBAEnG,OACE9iE,EAAAA,GAAAA,MAAC2nG,GAAkB,CAEjB3tG,SAAUA,EACV05C,MAAOA,EACPm0D,SAAUA,EACVkC,SAAUlC,GAAY,EAAI,EAC1BrhC,KAAK,SACL,gBAAexsE,EACfiG,QAAUjB,IACRA,EAAEuU,iBACFvU,EAAEkB,kBAEG2nG,GACH2B,EAAkBzV,IAGtB+G,UAAY97F,IACV,GAAc,UAAVA,EAAEjJ,KAA6B,MAAViJ,EAAEjJ,IACzBiJ,EAAEuU,iBACGs0F,GACH2B,EAAkBzV,QAEf,GAAc,cAAV/0F,EAAEjJ,IAAqB,CAAC,IAAD00G,EAEhCzrG,EAAEuU,iBACF,MAAM2P,EAAUpkB,MAAMiV,MAAwB,QAAnB02F,EAAA/jG,EAAYK,eAAO,IAAA0jG,OAAA,EAAnBA,EAAqBjW,iBAAiB,0CAA2C,IAEtGkW,EADaxnF,EAAQ0xD,QAAQ51E,EAAE2C,QACR,EAGrB,IAADgpG,EAFP,GAAID,EAAUxnF,EAAQniB,OACpBmiB,EAAQwnF,GAASnjG,aAGP,QAAVojG,EAAAznF,EAAQ,UAAE,IAAAynF,GAAVA,EAAYpjG,OAEhB,MAAO,GAAc,YAAVvI,EAAEjJ,IAAmB,CAAC,IAAD60G,EAE9B5rG,EAAEuU,iBACF,MAAM2P,EAAUpkB,MAAMiV,MAAwB,QAAnB62F,EAAAlkG,EAAYK,eAAO,IAAA6jG,OAAA,EAAnBA,EAAqBpW,iBAAiB,0CAA2C,IAEtGqW,EADa3nF,EAAQ0xD,QAAQ51E,EAAE2C,QACR,EAOnB,IAADmpG,EANT,GAAID,GAAW,EACb3nF,EAAQ2nF,GAAStjG,aAGjB,GAAIf,EAAeO,QACjBP,EAAeO,QAAQQ,aAEI,QAA3BujG,EAAA5nF,EAAQA,EAAQniB,OAAS,UAAE,IAAA+pG,GAA3BA,EAA6BvjG,OAGnC,MAAO,GAAc,WAAVvI,EAAEjJ,IACXiJ,EAAEuU,iBACF+pC,GAAU,GACNgrD,EAAUvhG,SACZuhG,EAAUvhG,QAAQQ,aAEf,GAAc,QAAVvI,EAAEjJ,IAAe,CAAC,IAADg1G,EAE1B,MAAM7nF,EAAUpkB,MAAMiV,MAAwB,QAAnBg3F,EAAArkG,EAAYK,eAAO,IAAAgkG,OAAA,EAAnBA,EAAqBvW,iBAAiB,0CAA2C,IACtGwW,EAAa9nF,EAAQ0xD,QAAQ51E,EAAE2C,QAEjC3C,EAAEg2F,SAEe,IAAfgW,IACFhsG,EAAEuU,iBACE/M,EAAeO,SACjBP,EAAeO,QAAQQ,SAKvByjG,IAAe9nF,EAAQniB,OAAS,IAClC/B,EAAEuU,iBACF+pC,GAAU,GAIhB,GACAv9C,SAAA,CAED4X,IAAakwF,IACZ/nG,EAAAA,GAAAA,KAAA,SACE5H,KAAK,WACLoJ,QAAStH,EACTyiG,UAAQ,EACRl7F,SAAUA,SAGbipG,GACCxqG,EAAAA,GAAAA,MAAAwW,GAAAA,SAAA,CAAAzW,SAAA,EACED,EAAAA,GAAAA,KAAA,QAAAC,SAAOwqG,EAAY5qF,QAAQ,eAAgB,OAC3C7f,EAAAA,GAAAA,KAAA,QAAMa,MAAO,CACX2iE,WAAY,MACZ7hE,SAAU,UACVX,MAAO,UACP+W,WAAY,MACZjX,QAAS,UACTwiE,gBAAiB,UACjBliE,aAAc,MACdD,OAAQ,qBACRlB,SAAC,kBAKLD,EAAAA,GAAAA,KAAA,QAAAC,SAAOwqG,MAxGJvB,GAAer9E,MA8G1B7rB,EAAAA,GAAAA,KAAC6nG,GAAkB,CAAA5nG,SAAC,wCAM7B,CAACkrG,EAAWC,IAMTD,EAAU9rG,QAAU+rG,EAAU/rG,QAC9B8rG,EAAUrpG,cAAgBspG,EAAUtpG,cACpCqpG,EAAUvxG,WAAawxG,EAAUxxG,WACjCuxG,EAAUxxG,WAAayxG,EAAUzxG,WACjCwxG,EAAU/xG,WAAagyG,EAAUhyG,WACjC+xG,EAAU/rG,QAAUgsG,EAAUhsG,QAC9B+rG,EAAUl7E,UAAYm7E,EAAUn7E,UAChCk7E,EAAU/P,cAAgBgQ,EAAUhQ,cACpC+P,EAAUtzF,WAAauzF,EAAUvzF,WACjCszF,EAAUj3C,mBAAqBk3C,EAAUl3C,mBAGzCi3C,EAAU/nF,QAAQniB,SAAWmqG,EAAUhoF,QAAQniB,SAG/CkqG,EAAU/nF,UAAYgoF,EAAUhoF,UAGhC+nF,EAAU7qG,OAAS8qG,EAAU9qG,OAK7B6qG,EAAU1pG,WAAa2pG,EAAU3pG,WACjC0pG,EAAUhvD,SAAWivD,EAAUjvD,SAC/BgvD,EAAUnX,iBAAmBoX,EAAUpX,gBACvCmX,EAAU9P,iBAAmB+P,EAAU/P,8B,mCC1z1BtC,MAsBDxxF,GAAM9T,E,SAAAA,GAAiB,MAtBO,CAClC,CACE,OACA,CACEC,EAAG,wGACHC,IAAK,WAGT,CAAC,SAAU,CAAEC,GAAI,KAAMC,GAAI,KAAMC,EAAG,IAAKH,IAAK,Y,mCCRzC,MAgBDgM,GAAOlM,E,SAAAA,GAAiB,OAhBM,CAClC,CAAC,OAAQ,CAAEC,EAAG,0CAA2CC,IAAK,WAC9D,CAAC,OAAQ,CAAES,EAAG,IAAKC,EAAG,IAAKH,MAAO,KAAMC,OAAQ,KAAMG,GAAI,IAAKX,IAAK,Y,mCCF/D,MAkBDkS,GAAYpS,E,SAAAA,GAAiB,aAlBC,CAClC,CAAC,OAAQ,CAAEC,EAAG,qDAAsDC,IAAK,WACzE,CAAC,OAAQ,CAAED,EAAG,aAAcC,IAAK,WACjC,CAAC,OAAQ,CAAED,EAAG,sDAAuDC,IAAK,WAC1E,CAAC,OAAQ,CAAED,EAAG,YAAaC,IAAK,Y,kBCF3B,SAASo1G,EAAsB1H,GACpC,IAAKA,GAAwC,kBAAjBA,EAC1B,OAAOA,GAAgB,sBAIzB,GAAIA,EAAahkG,SAAS,YAAcgkG,EAAahkG,SAAS,YAAa,CACzE,MAAMm2E,EAAQ6tB,EAAa7tB,MAAM,+BACjC,GAAIA,EAAO,CACT,MAAMw1B,EAAYx1B,EAAM,GAClBy1B,EAAa16F,KAAKqyF,MAAMoI,EAAY,KAC1C,MAAM,4CAANjiG,OAAiCkiG,EAAU,6CAC7C,CACE,MAAO,mFAEX,CAGA,OAAI5H,EAAahkG,SAAS,iBACjB,qEAGLgkG,EAAahkG,SAAS,uCACjB,4DAGLgkG,EAAahkG,SAAS,uCACjB,sDAGLgkG,EAAahkG,SAAS,uCACjB,gEAGLgkG,EAAahkG,SAAS,uCACjB,qFAGLgkG,EAAahkG,SAAS,iBAAmBgkG,EAAahkG,SAAS,sBAC1D,qFAGLgkG,EAAahkG,SAAS,cAAgBgkG,EAAahkG,SAAS,yBACvD,iDAIFgkG,CACT,CAOO,SAASxoB,EAA2BwoB,GACzC,IAAKA,GAAwC,kBAAjBA,EAC1B,OAAOA,GAAgB,sBAIzB,GAAIA,EAAahkG,SAAS,YAAcgkG,EAAahkG,SAAS,YAAa,CACzE,MAAMm2E,EAAQ6tB,EAAa7tB,MAAM,+BACjC,GAAIA,EAAO,CACT,MAAMw1B,EAAYx1B,EAAM,GAClBy1B,EAAa16F,KAAKqyF,MAAMoI,EAAY,KAC1C,MAAM,4CAANjiG,OAAiCkiG,EAAU,IAC7C,CACE,MAAO,0CAEX,CAGA,OAAOF,EAAsB1H,EAC/B,C,2DC5EO,MAgBD9J,GAAO9jG,E,SAAAA,GAAiB,OAhBM,CAClC,CAAC,OAAQ,CAAES,MAAO,KAAMC,OAAQ,KAAMC,EAAG,IAAKC,EAAG,KAAMC,GAAI,IAAKC,GAAI,IAAKZ,IAAK,WAC9E,CAAC,OAAQ,CAAED,EAAG,2BAA4BC,IAAK,Y,mCCF1C,MAgBD2T,GAAO7T,E,SAAAA,GAAiB,OAhBM,CAClC,CAAC,OAAQ,CAAEC,EAAG,WAAYC,IAAK,WAC/B,CAAC,OAAQ,CAAED,EAAG,WAAYC,IAAK,Y,mCCF1B,MAwBDiX,GAAanX,E,SAAAA,GAAiB,aAxBA,CAClC,CAAC,OAAQ,CAAES,MAAO,KAAMC,OAAQ,KAAMC,EAAG,IAAKC,EAAG,IAAKC,GAAI,IAAKX,IAAK,WACpE,CAAC,OAAQ,CAAEknG,GAAI,IAAKE,GAAI,KAAMD,GAAI,IAAKE,GAAI,IAAKrnG,IAAK,WACrD,CAAC,OAAQ,CAAEknG,GAAI,KAAME,GAAI,KAAMD,GAAI,KAAME,GAAI,KAAMrnG,IAAK,WACxD,CAAC,OAAQ,CAAED,EAAG,aAAcC,IAAK,WACjC,CAAC,OAAQ,CAAED,EAAG,aAAcC,IAAK,WACjC,CAAC,OAAQ,CAAED,EAAG,YAAaC,IAAK,WAChC,CAAC,OAAQ,CAAED,EAAG,aAAcC,IAAK,WACjC,CAAC,OAAQ,CAAED,EAAG,YAAaC,IAAK,WAChC,CAAC,OAAQ,CAAED,EAAG,aAAcC,IAAK,WACjC,CAAC,OAAQ,CAAED,EAAG,YAAaC,IAAK,Y,mCCV3B,MAqBDiM,GAAQnM,E,SAAAA,GAAiB,QArBK,CAClC,CACE,OACA,CACEC,EAAG,wNACHC,IAAK,Y,mCCLJ,MAaD2gB,GAAc7gB,E,SAAAA,GAAiB,eAbD,CAAC,CAAC,OAAQ,CAAEC,EAAG,eAAgBC,IAAK,Y,mCCAjE,MAkBD2lG,GAAQ7lG,E,SAAAA,GAAiB,QAlBK,CAClC,CAAC,SAAU,CAAEG,GAAI,IAAKC,GAAI,IAAKC,EAAG,IAAKH,IAAK,WAC5C,CAAC,OAAQ,CAAED,EAAG,kCAAmCC,IAAK,WACtD,CAAC,OAAQ,CAAED,EAAG,WAAYC,IAAK,WAC/B,CAAC,OAAQ,CAAED,EAAG,8BAA+BC,IAAK,Y","sources":["../node_modules/lucide-react/src/icons/users.ts","../node_modules/lucide-react/src/icons/user.ts","../node_modules/lucide-react/src/icons/map-pin.ts","../node_modules/lucide-react/src/icons/lock-open.ts","../node_modules/lucide-react/src/icons/shopping-cart.ts","../node_modules/lucide-react/src/icons/copy.ts","components/SupplierAddDialog.js","../node_modules/lucide-react/src/icons/menu.ts","../node_modules/lucide-react/src/icons/maximize-2.ts","../node_modules/lucide-react/src/icons/minimize-2.ts","../node_modules/lucide-react/src/icons/chevron-left.ts","../node_modules/lucide-react/src/icons/file-down.ts","../node_modules/lucide-react/src/icons/minus.ts","../node_modules/lucide-react/src/icons/chevron-right.ts","../node_modules/lucide-react/src/icons/upload.ts","components/TemplateDropdown.js","components/FloatingNavigator.js","utils/dataTransformHelpers.js","services/FormDataManager.js","hooks/useAutosave.js","services/apiInvoiceV2.js","constants/workflow25.js","utils/workflowUtils.js","forms/OrderForm25/hooks/useFormController.js","forms/OrderForm25/hooks/useFormLifecycle.js","forms/OrderForm25/hooks/useOrderDataLoader.js","forms/OrderForm25/hooks/useUIState.js","forms/OrderForm25/hooks/useWorkflowManager.js","components/FinancialControlConfirmationModal.js","forms/OrderForm25.js","../node_modules/lucide-react/src/icons/eye.ts","../node_modules/lucide-react/src/icons/mail.ts","../node_modules/lucide-react/src/icons/refresh-cw.ts","utils/errorTranslation.js","../node_modules/lucide-react/src/icons/lock.ts","../node_modules/lucide-react/src/icons/plus.ts","../node_modules/lucide-react/src/icons/calculator.ts","../node_modules/lucide-react/src/icons/phone.ts","../node_modules/lucide-react/src/icons/chevron-down.ts","../node_modules/lucide-react/src/icons/coins.ts"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2', key: '1yyitq' }],\n  ['path', { d: 'M16 3.128a4 4 0 0 1 0 7.744', key: '16gr8j' }],\n  ['path', { d: 'M22 21v-2a4 4 0 0 0-3-3.87', key: 'kshegd' }],\n  ['circle', { cx: '9', cy: '7', r: '4', key: 'nufk8' }],\n];\n\n/**\n * @component @name Users\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTYgMjF2LTJhNCA0IDAgMCAwLTQtNEg2YTQgNCAwIDAgMC00IDR2MiIgLz4KICA8cGF0aCBkPSJNMTYgMy4xMjhhNCA0IDAgMCAxIDAgNy43NDQiIC8+CiAgPHBhdGggZD0iTTIyIDIxdi0yYTQgNCAwIDAgMC0zLTMuODciIC8+CiAgPGNpcmNsZSBjeD0iOSIgY3k9IjciIHI9IjQiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/users\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Users = createLucideIcon('users', __iconNode);\n\nexport default Users;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2', key: '975kel' }],\n  ['circle', { cx: '12', cy: '7', r: '4', key: '17ys0d' }],\n];\n\n/**\n * @component @name User\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTkgMjF2LTJhNCA0IDAgMCAwLTQtNEg5YTQgNCAwIDAgMC00IDR2MiIgLz4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/user\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst User = createLucideIcon('user', __iconNode);\n\nexport default User;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0',\n      key: '1r0f0z',\n    },\n  ],\n  ['circle', { cx: '12', cy: '10', r: '3', key: 'ilqhr7' }],\n];\n\n/**\n * @component @name MapPin\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjAgMTBjMCA0Ljk5My01LjUzOSAxMC4xOTMtNy4zOTkgMTEuNzk5YTEgMSAwIDAgMS0xLjIwMiAwQzkuNTM5IDIwLjE5MyA0IDE0Ljk5MyA0IDEwYTggOCAwIDAgMSAxNiAwIiAvPgogIDxjaXJjbGUgY3g9IjEyIiBjeT0iMTAiIHI9IjMiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/map-pin\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst MapPin = createLucideIcon('map-pin', __iconNode);\n\nexport default MapPin;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['rect', { width: '18', height: '11', x: '3', y: '11', rx: '2', ry: '2', key: '1w4ew1' }],\n  ['path', { d: 'M7 11V7a5 5 0 0 1 9.9-1', key: '1mm8w8' }],\n];\n\n/**\n * @component @name LockOpen\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cmVjdCB3aWR0aD0iMTgiIGhlaWdodD0iMTEiIHg9IjMiIHk9IjExIiByeD0iMiIgcnk9IjIiIC8+CiAgPHBhdGggZD0iTTcgMTFWN2E1IDUgMCAwIDEgOS45LTEiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/lock-open\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst LockOpen = createLucideIcon('lock-open', __iconNode);\n\nexport default LockOpen;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '8', cy: '21', r: '1', key: 'jimo8o' }],\n  ['circle', { cx: '19', cy: '21', r: '1', key: '13723u' }],\n  [\n    'path',\n    {\n      d: 'M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12',\n      key: '9zh506',\n    },\n  ],\n];\n\n/**\n * @component @name ShoppingCart\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSI4IiBjeT0iMjEiIHI9IjEiIC8+CiAgPGNpcmNsZSBjeD0iMTkiIGN5PSIyMSIgcj0iMSIgLz4KICA8cGF0aCBkPSJNMi4wNSAyLjA1aDJsMi42NiAxMi40MmEyIDIgMCAwIDAgMiAxLjU4aDkuNzhhMiAyIDAgMCAwIDEuOTUtMS41N2wxLjY1LTcuNDNINS4xMiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/shopping-cart\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ShoppingCart = createLucideIcon('shopping-cart', __iconNode);\n\nexport default ShoppingCart;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['rect', { width: '14', height: '14', x: '8', y: '8', rx: '2', ry: '2', key: '17jyea' }],\n  ['path', { d: 'M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2', key: 'zix9uf' }],\n];\n\n/**\n * @component @name Copy\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cmVjdCB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHg9IjgiIHk9IjgiIHJ4PSIyIiByeT0iMiIgLz4KICA8cGF0aCBkPSJNNCAxNmMtMS4xIDAtMi0uOS0yLTJWNGMwLTEuMS45LTIgMi0yaDEwYzEuMSAwIDIgLjkgMiAyIiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/copy\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Copy = createLucideIcon('copy', __iconNode);\n\nexport default Copy;\n","import React, { useState, useEffect, useContext } from 'react';\nimport styled from '@emotion/styled';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTimes, faCheck, faGlobe, faUser, faBuilding, faCheckCircle } from '@fortawesome/free-solid-svg-icons';\nimport { Building, MapPin, Hash, Mail, Phone, User } from 'lucide-react';\nimport { AuthContext } from '../context/AuthContext';\nimport { fetchUskyList } from '../services/api2auth';\n\n// Styled Components\nconst DialogOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n`;\n\nconst DialogContainer = styled.div`\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 700px;\n  max-height: 90vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp 0.3s ease-out;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n`;\n\nconst DialogHeader = styled.div`\n  padding: 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n`;\n\nconst DialogTitle = styled.h2`\n  margin: 0;\n  font-size: 20px;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n\n  svg {\n    font-size: 24px;\n  }\n`;\n\nconst CloseButton = styled.button`\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n`;\n\nconst DialogContent = styled.div`\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n`;\n\nconst InfoBox = styled.div`\n  background: ${props => {\n    if (props.type === 'update') return '#fff4e6';\n    if (props.type === 'exists-own') return '#e6f7ff';\n    if (props.type === 'exists-global') return '#fff0f6';\n    return '#f0f9ff';\n  }};\n  border: 1px solid ${props => {\n    if (props.type === 'update') return '#ffd591';\n    if (props.type === 'exists-own') return '#91d5ff';\n    if (props.type === 'exists-global') return '#ffadd2';\n    return '#bae7ff';\n  }};\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 20px;\n  display: flex;\n  align-items: flex-start;\n  gap: 12px;\n\n  svg {\n    font-size: 20px;\n    margin-top: 2px;\n    color: ${props => {\n      if (props.type === 'update') return '#fa8c16';\n      if (props.type === 'exists-own') return '#1890ff';\n      if (props.type === 'exists-global') return '#eb2f96';\n      return '#1890ff';\n    }};\n  }\n`;\n\nconst InfoText = styled.div`\n  flex: 1;\n\n  strong {\n    display: block;\n    margin-bottom: 4px;\n    font-size: 14px;\n    color: #262626;\n  }\n\n  p {\n    margin: 0;\n    font-size: 13px;\n    color: #595959;\n    line-height: 1.5;\n  }\n`;\n\nconst FormSection = styled.div`\n  margin-bottom: 20px;\n`;\n\nconst SectionTitle = styled.h3`\n  font-size: 14px;\n  font-weight: 600;\n  color: #262626;\n  margin: 0 0 12px 0;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n`;\n\nconst FormRow = styled.div`\n  display: grid;\n  grid-template-columns: ${props => props.columns || '1fr'};\n  gap: 16px;\n  margin-bottom: 16px;\n`;\n\nconst FormGroup = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n`;\n\nconst Label = styled.label`\n  font-size: 13px;\n  font-weight: 500;\n  color: #595959;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n\n  ${props => props.required && `\n    &:after {\n      content: '*';\n      color: #ff4d4f;\n      margin-left: 2px;\n    }\n  `}\n`;\n\nconst InputWithIcon = styled.div`\n  position: relative;\n  display: flex;\n  align-items: center;\n\n  svg {\n    position: absolute;\n    left: 12px;\n    width: 16px;\n    height: 16px;\n    color: #8c8c8c;\n    pointer-events: none;\n  }\n`;\n\nconst Input = styled.input`\n  width: 100%;\n  padding: 10px 12px 10px ${props => props.hasIcon ? '38px' : '12px'};\n  border: 1px solid ${props => props.hasError ? '#ff4d4f' : '#d9d9d9'};\n  border-radius: 6px;\n  font-size: 14px;\n  transition: all 0.2s;\n  background: ${props => props.disabled ? '#f5f5f5' : 'white'};\n  color: ${props => props.disabled ? '#8c8c8c' : '#262626'};\n\n  &:focus {\n    outline: none;\n    border-color: ${props => props.hasError ? '#ff4d4f' : '#40a9ff'};\n    box-shadow: 0 0 0 2px ${props => props.hasError ? 'rgba(255,77,79,0.1)' : 'rgba(24,144,255,0.1)'};\n  }\n\n  &:disabled {\n    cursor: not-allowed;\n  }\n`;\n\nconst ScopeSelector = styled.div`\n  display: grid;\n  grid-template-columns: repeat(${props => props.optionsCount}, 1fr);\n  gap: 8px;\n  margin-top: 8px;\n`;\n\nconst ScopeOption = styled.button`\n  padding: 12px;\n  border: 2px solid ${props => props.selected ? '#667eea' : '#e5e7eb'};\n  border-radius: 8px;\n  background: ${props => props.selected ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : 'white'};\n  color: ${props => props.selected ? 'white' : '#595959'};\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  opacity: ${props => props.disabled ? 0.5 : 1};\n  transition: all 0.2s;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 6px;\n  font-size: 13px;\n  font-weight: 500;\n  position: relative;\n\n  &:hover:not(:disabled) {\n    border-color: #667eea;\n    background: ${props => props.selected ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : '#f9fafb'};\n  }\n\n  svg {\n    font-size: 18px;\n  }\n`;\n\nconst ExistingIndicator = styled.div`\n  position: absolute;\n  top: 6px;\n  right: 6px;\n  background: ${props => props.scope === 'global' ? '#10b981' : (props.scope === 'usek' ? '#3b82f6' : '#06b6d4')};\n  color: white;\n  width: 20px;\n  height: 20px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 11px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\n  svg {\n    font-size: 11px;\n  }\n`;\n\nconst UsekGrid = styled.div`\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));\n  gap: 8px;\n  margin-top: 12px;\n`;\n\nconst UsekItem = styled.label`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  padding: 8px 10px;\n  border: 2px solid ${props => props.selected ? '#667eea' : '#e5e7eb'};\n  border-radius: 6px;\n  background: ${props => props.selected ? 'rgba(102, 126, 234, 0.05)' : 'white'};\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  opacity: ${props => props.disabled ? 0.5 : 1};\n  transition: all 0.2s;\n  font-size: 13px;\n  font-weight: 600;\n  color: ${props => props.selected ? '#667eea' : '#374151'};\n\n  &:hover:not([disabled]) {\n    border-color: #667eea;\n    background: rgba(102, 126, 234, 0.05);\n  }\n\n  input[type=\"checkbox\"] {\n    width: 16px;\n    height: 16px;\n    cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  }\n`;\n\nconst UsekInfo = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n  flex: 1;\n`;\n\nconst UsekCode = styled.span`\n  font-weight: 600;\n  color: #667eea;\n`;\n\nconst UsekName = styled.span`\n  font-size: 11px;\n  color: #6b7280;\n`;\n\nconst ErrorText = styled.span`\n  color: #ff4d4f;\n  font-size: 12px;\n  margin-top: 4px;\n`;\n\nconst DialogFooter = styled.div`\n  padding: 16px 24px;\n  border-top: 1px solid #e5e7eb;\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  background: #fafafa;\n`;\n\nconst Button = styled.button`\n  padding: 10px 20px;\n  border: none;\n  border-radius: 6px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  ${props => props.variant === 'primary' && `\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n\n    &:hover:not(:disabled) {\n      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n      transform: translateY(-1px);\n    }\n\n    &:disabled {\n      opacity: 0.6;\n      cursor: not-allowed;\n    }\n  `}\n\n  ${props => props.variant === 'secondary' && `\n    background: white;\n    color: #595959;\n    border: 1px solid #d9d9d9;\n\n    &:hover:not(:disabled) {\n      border-color: #40a9ff;\n      color: #40a9ff;\n    }\n  `}\n`;\n\n/**\n * Dialog pro pidn dodavatele do lokln databze\n *\n * Props:\n * - isOpen: bool - zda je dialog oteven\n * - onClose: func - callback pro zaven dialogu\n * - onSave: func(supplierData, scope) - callback po spnm uloen\n * - supplierData: obj - data dodavatele z formule\n * - existsInPersonal: obj|null - existujc zznam v Personal scope\n * - existsInUsek: obj|null - existujc zznam v sek scope\n * - existsInGlobal: obj|null - existujc zznam v Global scope\n * - userPermissions: obj - uivatelsk prva { canAddPersonal, canAddUsek, canAddGlobal }\n */\nconst SupplierAddDialog = ({\n  isOpen,\n  onClose,\n  onSave,\n  supplierData,\n  existsInPersonal = null,\n  existsInUsek = null,\n  existsInGlobal = null,\n  userPermissions = { canAddPersonal: true, canAddUsek: false, canAddGlobal: false }\n}) => {\n  const { token, username, userDetail } = useContext(AuthContext);\n  const [editedData, setEditedData] = useState({});\n  const [selectedScope, setSelectedScope] = useState('personal');\n  const [selectedUseky, setSelectedUseky] = useState([]); // Vybran seky pro scope 'usek'\n  const [availableUseky, setAvailableUseky] = useState([]); // Seznam vech sek\n  const [usekyLoading, setUsekyLoading] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [errors, setErrors] = useState({});\n\n  // Inicializace dat pi oteven dialogu\n  useEffect(() => {\n    if (isOpen && supplierData) {\n      setEditedData({\n        nazev: supplierData.dodavatel_nazev || '',\n        adresa: supplierData.dodavatel_adresa || '',\n        ico: supplierData.dodavatel_ico || '',\n        dic: supplierData.dodavatel_dic || '',\n        zastoupeny: supplierData.dodavatel_zastoupeny || '',\n        kontakt_jmeno: supplierData.dodavatel_kontakt_jmeno || '',\n        kontakt_email: supplierData.dodavatel_kontakt_email || '',\n        kontakt_telefon: supplierData.dodavatel_kontakt_telefon || ''\n      });\n\n      // Vchoz scope podle toho, kde kontakt existuje\n      // Priority: Personal > sek > Global (co m uivatel monost upravit)\n      if (existsInPersonal) {\n        setSelectedScope('personal');\n      } else if (existsInUsek) {\n        setSelectedScope('usek');\n        // seky se natou a pedvypln v dalm useEffect\n      } else if (existsInGlobal && userPermissions.canAddGlobal) {\n        setSelectedScope('global');\n      } else {\n        setSelectedScope('personal');\n      }\n\n      setErrors({});\n    }\n  }, [isOpen, supplierData, existsInPersonal, existsInUsek, existsInGlobal, userPermissions.canAddGlobal]);\n\n  // Naten seznamu sek pi oteven dialogu\n  useEffect(() => {\n    const loadUseky = async () => {\n      if (!isOpen || !userPermissions.canAddUsek) return;\n\n      try {\n        setUsekyLoading(true);\n        const result = await fetchUskyList({ token, username });\n        setAvailableUseky(result || []);\n      } catch (error) {\n      } finally {\n        setUsekyLoading(false);\n      }\n    };\n\n    loadUseky();\n  }, [isOpen, userPermissions.canAddUsek, token, username]);\n\n  // Pedvyplnn sek pokud existuje dodavatel v sek scope\n  useEffect(() => {\n    if (!isOpen) return;\n\n    if (existsInUsek && existsInUsek.usek_zkr) {\n      try {\n        const usekArray = typeof existsInUsek.usek_zkr === 'string'\n          ? JSON.parse(existsInUsek.usek_zkr)\n          : existsInUsek.usek_zkr;\n        if (Array.isArray(usekArray)) {\n          setSelectedUseky(usekArray);\n        }\n      } catch (e) {\n      }\n    } else {\n      // Pokud nen existsInUsek, vyma vybran seky\n      setSelectedUseky([]);\n    }\n  }, [isOpen, existsInUsek]);\n\n  const handleInputChange = (field, value) => {\n    setEditedData(prev => ({\n      ...prev,\n      [field]: value\n    }));\n\n    // Clear error for this field\n    if (errors[field]) {\n      setErrors(prev => {\n        const newErrors = { ...prev };\n        delete newErrors[field];\n        return newErrors;\n      });\n    }\n  };\n\n  // Handler pro pepnut vbru seku\n  const handleUsekToggle = (usekZkr) => {\n    setSelectedUseky(prev => {\n      if (prev.includes(usekZkr)) {\n        return prev.filter(zkr => zkr !== usekZkr);\n      } else {\n        return [...prev, usekZkr];\n      }\n    });\n  };\n\n  const validateData = () => {\n    const newErrors = {};\n\n    if (!editedData.nazev?.trim()) {\n      newErrors.nazev = 'Nzev je povinn';\n    }\n\n    if (!editedData.ico?.trim()) {\n      newErrors.ico = 'IO je povinn';\n    } else if (!/^\\d{8}$/.test(editedData.ico.trim())) {\n      newErrors.ico = 'IO mus mt 8 slic';\n    }\n\n    if (editedData.kontakt_email && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(editedData.kontakt_email)) {\n      newErrors.kontakt_email = 'Neplatn email';\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSave = async () => {\n    if (!validateData()) {\n      return;\n    }\n\n    // Pokud je vybran scope 'usek', ale dn seky nejsou zakrtnut,\n    // pouije se scope 'personal' (osobn)\n    let finalScope = selectedScope;\n    let finalUseky = null;\n\n    if (selectedScope === 'usek') {\n      if (selectedUseky.length === 0) {\n        // dn seky  pepnout na osobn\n        finalScope = 'personal';\n        finalUseky = null;\n      } else {\n        finalUseky = selectedUseky;\n      }\n    } else if (selectedScope === 'global') {\n      // Global  user_id = 0, usek_zkr = przdn\n      finalUseky = null;\n    }\n\n    setIsSaving(true);\n\n    try {\n      await onSave(editedData, finalScope, finalUseky);\n      onClose();\n    } catch (error) {\n      setErrors({ general: error.message || 'Chyba pi ukldn dodavatele' });\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  // Urit typ akce a info box\n  const getActionType = () => {\n    // Zkontroluj existence v jednotlivch scope\n    if (existsInPersonal || existsInUsek || existsInGlobal) {\n      return 'exists';\n    }\n    return 'add';\n  };\n\n  const actionType = getActionType();\n\n  // Urit text tlatka podle vybranho scope a existence\n  const getButtonText = () => {\n    if (isSaving) return 'Ukldm...';\n\n    // Zkontroluj, jestli v aktuln vybranm scope dodavatel existuje\n    const existsInSelectedScope =\n      (selectedScope === 'personal' && existsInPersonal) ||\n      (selectedScope === 'usek' && existsInUsek) ||\n      (selectedScope === 'global' && existsInGlobal);\n\n    if (existsInSelectedScope) {\n      return 'Aktualizovat'; // Aktualizujeme existujc zznam v tomto scope\n    }\n\n    return 'Pidat dodavatele'; // Pidvme do novho scope nebo nov dodavatel\n  };\n\n  // Zjisti jestli aktualizujeme existujc zznam\n  const isUpdatingExisting =\n    (selectedScope === 'personal' && existsInPersonal) ||\n    (selectedScope === 'usek' && existsInUsek) ||\n    (selectedScope === 'global' && existsInGlobal);\n\n  return (\n    <DialogOverlay>\n      <DialogContainer onClick={(e) => e.stopPropagation()}>\n        <DialogHeader>\n          <DialogTitle>\n            <FontAwesomeIcon icon={faBuilding} />\n            {isUpdatingExisting ? 'Aktualizovat dodavatele' : 'Pidat dodavatele do adrese'}\n          </DialogTitle>\n          <CloseButton onClick={onClose}>\n            <FontAwesomeIcon icon={faTimes} />\n          </CloseButton>\n        </DialogHeader>\n\n        <DialogContent>\n          {/* Info box podle situace */}\n          {actionType === 'add' && (\n            <InfoBox type=\"add\">\n              <FontAwesomeIcon icon={faBuilding} />\n              <InfoText>\n                <strong>Nov dodavatel</strong>\n                <p>Dodavatel s tmto IO nebyl nalezen v databzi. Mete ho pidat.</p>\n              </InfoText>\n            </InfoBox>\n          )}\n\n          {actionType === 'exists' && (\n            <InfoBox type=\"exists-own\">\n              <FontAwesomeIcon icon={faCheckCircle} />\n              <InfoText>\n                <strong>Dodavatel ji existuje v adresi</strong>\n                <p>\n                  Fajfky u scope oznauj, kde je dodavatel ji uloen.\n                  {existsInPersonal && ' Mte ho ve svm osobnm adresi.'}\n                  {existsInUsek && ' Existuje v sekovm adresi.'}\n                  {existsInGlobal && ' Existuje v globlnm adresi.'}\n                </p>\n              </InfoText>\n            </InfoBox>\n          )}\n\n          {/* Rozsah uloen */}\n          <FormSection>\n            <SectionTitle>Rozsah uloen</SectionTitle>\n            <ScopeSelector optionsCount={3}>\n              {/* Osobn - vdy viditeln */}\n              <ScopeOption\n                selected={selectedScope === 'personal'}\n                onClick={() => userPermissions.canAddPersonal && setSelectedScope('personal')}\n                disabled={!userPermissions.canAddPersonal}\n              >\n                {existsInPersonal && (\n                  <ExistingIndicator scope=\"personal\" title=\"Kontakt ji existuje v osobnm adresi\">\n                    <FontAwesomeIcon icon={faCheckCircle} />\n                  </ExistingIndicator>\n                )}\n                <FontAwesomeIcon icon={faUser} />\n                <span>Osobn</span>\n              </ScopeOption>\n\n              {/* sek - vdy viditeln */}\n              <ScopeOption\n                selected={selectedScope === 'usek'}\n                onClick={() => userPermissions.canAddUsek && setSelectedScope('usek')}\n                disabled={!userPermissions.canAddUsek}\n              >\n                {existsInUsek && (\n                  <ExistingIndicator scope=\"usek\" title=\"Kontakt ji existuje v adresi seku\">\n                    <FontAwesomeIcon icon={faCheckCircle} />\n                  </ExistingIndicator>\n                )}\n                <FontAwesomeIcon icon={faBuilding} />\n                <span>sek</span>\n              </ScopeOption>\n\n              {/* Globln - vdy viditeln */}\n              <ScopeOption\n                selected={selectedScope === 'global'}\n                onClick={() => userPermissions.canAddGlobal && setSelectedScope('global')}\n                disabled={!userPermissions.canAddGlobal}\n              >\n                {existsInGlobal && (\n                  <ExistingIndicator scope=\"global\" title=\"Kontakt ji existuje v globlnm adresi\">\n                    <FontAwesomeIcon icon={faCheckCircle} />\n                  </ExistingIndicator>\n                )}\n                <FontAwesomeIcon icon={faGlobe} />\n                <span>Globln</span>\n              </ScopeOption>\n            </ScopeSelector>\n          </FormSection>\n\n          {/* Vbr sek - zobraz se pouze kdy je vybran scope 'usek' */}\n          {selectedScope === 'usek' && (\n            <FormSection>\n              <SectionTitle>Vbr sek</SectionTitle>\n              {usekyLoading ? (\n                <div style={{ padding: '1rem', textAlign: 'center', color: '#6b7280' }}>\n                  Natm seky...\n                </div>\n              ) : availableUseky.length === 0 ? (\n                <div style={{ padding: '1rem', background: '#fef2f2', border: '1px solid #fecaca', borderRadius: '8px', color: '#dc2626' }}>\n                   dn seky nebyly nateny\n                </div>\n              ) : (\n                <UsekGrid>\n                  {(userPermissions.canAddGlobal ? availableUseky :\n                    availableUseky.filter(usek => {\n                      // userDetail.usek_zkr me bt pole ['IT', 'EN'] nebo string 'IT'\n                      const myUseky = Array.isArray(userDetail?.usek_zkr)\n                        ? userDetail.usek_zkr\n                        : [userDetail?.usek_zkr];\n                      return myUseky.includes(usek.usek_zkr);\n                    })\n                  ).map((usek) => (\n                    <UsekItem\n                      key={usek.usek_zkr}\n                      selected={selectedUseky.includes(usek.usek_zkr)}\n                      disabled={!userPermissions.canAddGlobal && (() => {\n                        const myUseky = Array.isArray(userDetail?.usek_zkr)\n                          ? userDetail.usek_zkr\n                          : [userDetail?.usek_zkr];\n                        return !myUseky.includes(usek.usek_zkr);\n                      })()}\n                      onClick={() => {\n                        const myUseky = Array.isArray(userDetail?.usek_zkr)\n                          ? userDetail.usek_zkr\n                          : [userDetail?.usek_zkr];\n                        if (userPermissions.canAddGlobal || myUseky.includes(usek.usek_zkr)) {\n                          handleUsekToggle(usek.usek_zkr);\n                        }\n                      }}\n                    >\n                      <input\n                        type=\"checkbox\"\n                        checked={selectedUseky.includes(usek.usek_zkr)}\n                        onChange={() => handleUsekToggle(usek.usek_zkr)}\n                        disabled={!userPermissions.canAddGlobal && (() => {\n                          const myUseky = Array.isArray(userDetail?.usek_zkr)\n                            ? userDetail.usek_zkr\n                            : [userDetail?.usek_zkr];\n                          return !myUseky.includes(usek.usek_zkr);\n                        })()}\n                      />\n                      <UsekCode>{usek.usek_zkr}</UsekCode>\n                    </UsekItem>\n                  ))}\n                </UsekGrid>\n              )}\n              {selectedUseky.length === 0 && !usekyLoading && (\n                <div style={{ marginTop: '8px', padding: '8px', background: '#e0f2fe', border: '1px solid #0ea5e9', borderRadius: '6px', fontSize: '12px', color: '#0c4a6e' }}>\n                   Pokud nevyberete dn sek, kontakt se ulo jako osobn\n                </div>\n              )}\n            </FormSection>\n          )}\n\n          {/* Zkladn daje */}\n          <FormSection>\n            <SectionTitle>Zkladn daje</SectionTitle>\n            <FormRow columns=\"1fr\">\n              <FormGroup>\n                <Label required>Nzev spolenosti</Label>\n                <InputWithIcon>\n                  <Building />\n                  <Input\n                    type=\"text\"\n                    value={editedData.nazev || ''}\n                    onChange={(e) => handleInputChange('nazev', e.target.value)}\n                    hasError={!!errors.nazev}\n                    hasIcon\n                    placeholder=\"Nzev dodavatele\"\n                  />\n                </InputWithIcon>\n                {errors.nazev && <ErrorText>{errors.nazev}</ErrorText>}\n              </FormGroup>\n            </FormRow>\n\n            <FormRow columns=\"2fr 1fr 1fr\">\n              <FormGroup>\n                <Label required>Adresa</Label>\n                <InputWithIcon>\n                  <MapPin />\n                  <Input\n                    type=\"text\"\n                    value={editedData.adresa || ''}\n                    onChange={(e) => handleInputChange('adresa', e.target.value)}\n                    hasError={!!errors.adresa}\n                    hasIcon\n                    placeholder=\"Adresa sdla\"\n                  />\n                </InputWithIcon>\n                {errors.adresa && <ErrorText>{errors.adresa}</ErrorText>}\n              </FormGroup>\n\n              <FormGroup>\n                <Label required>IO</Label>\n                <InputWithIcon>\n                  <Hash />\n                  <Input\n                    type=\"text\"\n                    value={editedData.ico || ''}\n                    onChange={(e) => handleInputChange('ico', e.target.value)}\n                    hasError={!!errors.ico}\n                    hasIcon\n                    placeholder=\"12345678\"\n                    maxLength={8}\n                  />\n                </InputWithIcon>\n                {errors.ico && <ErrorText>{errors.ico}</ErrorText>}\n              </FormGroup>\n\n              <FormGroup>\n                <Label>DI</Label>\n                <InputWithIcon>\n                  <Hash />\n                  <Input\n                    type=\"text\"\n                    value={editedData.dic || ''}\n                    onChange={(e) => handleInputChange('dic', e.target.value)}\n                    hasIcon\n                    placeholder=\"CZ12345678\"\n                  />\n                </InputWithIcon>\n              </FormGroup>\n            </FormRow>\n\n            <FormRow columns=\"1fr\">\n              <FormGroup>\n                <Label>Zastoupen(a)</Label>\n                <InputWithIcon>\n                  <User />\n                  <Input\n                    type=\"text\"\n                    value={editedData.zastoupeny || ''}\n                    onChange={(e) => handleInputChange('zastoupeny', e.target.value)}\n                    hasIcon\n                    placeholder=\"Jmno jednajcho\"\n                  />\n                </InputWithIcon>\n              </FormGroup>\n            </FormRow>\n          </FormSection>\n\n          {/* Kontaktn daje */}\n          <FormSection>\n            <SectionTitle>Kontaktn osoba</SectionTitle>\n            <FormRow columns=\"1fr\">\n              <FormGroup>\n                <Label>Jmno kontaktn osoby</Label>\n                <InputWithIcon>\n                  <User />\n                  <Input\n                    type=\"text\"\n                    value={editedData.kontakt_jmeno || ''}\n                    onChange={(e) => handleInputChange('kontakt_jmeno', e.target.value)}\n                    hasIcon\n                    placeholder=\"Jmno a pjmen\"\n                  />\n                </InputWithIcon>\n              </FormGroup>\n            </FormRow>\n\n            <FormRow columns=\"1fr 1fr\">\n              <FormGroup>\n                <Label>Email</Label>\n                <InputWithIcon>\n                  <Mail />\n                  <Input\n                    type=\"email\"\n                    value={editedData.kontakt_email || ''}\n                    onChange={(e) => handleInputChange('kontakt_email', e.target.value)}\n                    hasError={!!errors.kontakt_email}\n                    hasIcon\n                    placeholder=\"email@example.com\"\n                  />\n                </InputWithIcon>\n                {errors.kontakt_email && <ErrorText>{errors.kontakt_email}</ErrorText>}\n              </FormGroup>\n\n              <FormGroup>\n                <Label>Telefon</Label>\n                <InputWithIcon>\n                  <Phone />\n                  <Input\n                    type=\"tel\"\n                    value={editedData.kontakt_telefon || ''}\n                    onChange={(e) => handleInputChange('kontakt_telefon', e.target.value)}\n                    hasIcon\n                    placeholder=\"+420 123 456 789\"\n                  />\n                </InputWithIcon>\n              </FormGroup>\n            </FormRow>\n          </FormSection>\n\n          {errors.general && (\n            <ErrorText style={{ display: 'block', marginTop: '16px', fontSize: '14px' }}>\n              {errors.general}\n            </ErrorText>\n          )}\n        </DialogContent>\n\n        <DialogFooter>\n          <Button variant=\"secondary\" onClick={onClose} disabled={isSaving}>\n            <FontAwesomeIcon icon={faTimes} />\n            Zruit\n          </Button>\n          <Button variant=\"primary\" onClick={handleSave} disabled={isSaving}>\n            <FontAwesomeIcon icon={faCheck} />\n            {getButtonText()}\n          </Button>\n        </DialogFooter>\n      </DialogContainer>\n    </DialogOverlay>\n  );\n};\n\nexport default SupplierAddDialog;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M4 5h16', key: '1tepv9' }],\n  ['path', { d: 'M4 12h16', key: '1lakjw' }],\n  ['path', { d: 'M4 19h16', key: '1djgab' }],\n];\n\n/**\n * @component @name Menu\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNNCA1aDE2IiAvPgogIDxwYXRoIGQ9Ik00IDEyaDE2IiAvPgogIDxwYXRoIGQ9Ik00IDE5aDE2IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/menu\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Menu = createLucideIcon('menu', __iconNode);\n\nexport default Menu;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M15 3h6v6', key: '1q9fwt' }],\n  ['path', { d: 'm21 3-7 7', key: '1l2asr' }],\n  ['path', { d: 'm3 21 7-7', key: 'tjx5ai' }],\n  ['path', { d: 'M9 21H3v-6', key: 'wtvkvv' }],\n];\n\n/**\n * @component @name Maximize2\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTUgM2g2djYiIC8+CiAgPHBhdGggZD0ibTIxIDMtNyA3IiAvPgogIDxwYXRoIGQ9Im0zIDIxIDctNyIgLz4KICA8cGF0aCBkPSJNOSAyMUgzdi02IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/maximize-2\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Maximize2 = createLucideIcon('maximize-2', __iconNode);\n\nexport default Maximize2;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'm14 10 7-7', key: 'oa77jy' }],\n  ['path', { d: 'M20 10h-6V4', key: 'mjg0md' }],\n  ['path', { d: 'm3 21 7-7', key: 'tjx5ai' }],\n  ['path', { d: 'M4 14h6v6', key: 'rmj7iw' }],\n];\n\n/**\n * @component @name Minimize2\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTQgMTAgNy03IiAvPgogIDxwYXRoIGQ9Ik0yMCAxMGgtNlY0IiAvPgogIDxwYXRoIGQ9Im0zIDIxIDctNyIgLz4KICA8cGF0aCBkPSJNNCAxNGg2djYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/minimize-2\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Minimize2 = createLucideIcon('minimize-2', __iconNode);\n\nexport default Minimize2;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'm15 18-6-6 6-6', key: '1wnfg3' }]];\n\n/**\n * @component @name ChevronLeft\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTUgMTgtNi02IDYtNiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/chevron-left\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ChevronLeft = createLucideIcon('chevron-left', __iconNode);\n\nexport default ChevronLeft;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z', key: '1rqfz7' }],\n  ['path', { d: 'M14 2v4a2 2 0 0 0 2 2h4', key: 'tnqrlb' }],\n  ['path', { d: 'M12 18v-6', key: '17g6i2' }],\n  ['path', { d: 'm9 15 3 3 3-3', key: '1npd3o' }],\n];\n\n/**\n * @component @name FileDown\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTUgMkg2YTIgMiAwIDAgMC0yIDJ2MTZhMiAyIDAgMCAwIDIgMmgxMmEyIDIgMCAwIDAgMi0yVjdaIiAvPgogIDxwYXRoIGQ9Ik0xNCAydjRhMiAyIDAgMCAwIDIgMmg0IiAvPgogIDxwYXRoIGQ9Ik0xMiAxOHYtNiIgLz4KICA8cGF0aCBkPSJtOSAxNSAzIDMgMy0zIiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/file-down\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst FileDown = createLucideIcon('file-down', __iconNode);\n\nexport default FileDown;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'M5 12h14', key: '1ays0h' }]];\n\n/**\n * @component @name Minus\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNNSAxMmgxNCIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/minus\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Minus = createLucideIcon('minus', __iconNode);\n\nexport default Minus;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'm9 18 6-6-6-6', key: 'mthhwq' }]];\n\n/**\n * @component @name ChevronRight\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtOSAxOCA2LTYtNi02IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/chevron-right\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ChevronRight = createLucideIcon('chevron-right', __iconNode);\n\nexport default ChevronRight;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M12 3v12', key: '1x0j5s' }],\n  ['path', { d: 'm17 8-5-5-5 5', key: '7q97r8' }],\n  ['path', { d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4', key: 'ih7n3h' }],\n];\n\n/**\n * @component @name Upload\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTIgM3YxMiIgLz4KICA8cGF0aCBkPSJtMTcgOC01LTUtNSA1IiAvPgogIDxwYXRoIGQ9Ik0yMSAxNXY0YTIgMiAwIDAgMS0yIDJINWEyIDIgMCAwIDEtMi0ydi00IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/upload\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Upload = createLucideIcon('upload', __iconNode);\n\nexport default Upload;\n","import React, { useState, useRef, useEffect } from 'react';\nimport styled from '@emotion/styled';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faUser, faDatabase } from '@fortawesome/free-solid-svg-icons';\nimport { Search, X, RefreshCw, Eye, Plus, Trash } from 'lucide-react';\n\n// Styled Components\nconst DropdownContainer = styled.div`\n  position: absolute;\n  top: calc(100% + 3px);\n  left: ${props => props.$left || '0'};\n  right: ${props => props.$right || 'auto'};\n  z-index: 999999;\n  width: 450px;\n  background-color: white;\n  border: 2px solid #10b981;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  max-height: 500px;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst SectionHeader = styled.div`\n  padding: 0.5rem 0.75rem;\n  font-weight: 700;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n  border-bottom: 1px solid #e5e7eb;\n`;\n\nconst HeaderTitle = styled.span`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n`;\n\nconst HeaderActions = styled.span`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n`;\n\nconst IconButton = styled.button`\n  background: none;\n  border: none;\n  padding: 0;\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  color: ${props => props.disabled ? '#9ca3af' : (props.$color || '#374151')};\n  \n  &:hover:not(:disabled) {\n    opacity: 0.7;\n  }\n`;\n\nconst SearchBox = styled.div`\n  position: relative;\n  padding: 0 0.75rem 0.5rem;\n`;\n\nconst SearchIcon = styled.div`\n  position: absolute;\n  left: 1.5rem;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #9ca3af;\n  pointer-events: none;\n`;\n\nconst SearchInput = styled.input`\n  width: 100%;\n  padding: 0.5rem 2.5rem 0.5rem 2.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  outline: none;\n  \n  &:focus {\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n`;\n\nconst SearchClearButton = styled.button`\n  position: absolute;\n  right: 1.5rem;\n  top: 50%;\n  transform: translateY(-50%);\n  background: none;\n  border: none;\n  padding: 0;\n  cursor: pointer;\n  color: #6b7280;\n  \n  &:hover {\n    color: #374151;\n  }\n`;\n\nconst TemplateList = styled.div`\n  max-height: 14rem;\n  overflow-y: auto;\n  \n  &::-webkit-scrollbar {\n    width: 6px;\n  }\n  \n  &::-webkit-scrollbar-track {\n    background: #f3f4f6;\n  }\n  \n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 3px;\n    \n    &:hover {\n      background: #9ca3af;\n    }\n  }\n`;\n\nconst TemplateItem = styled.div`\n  padding: 0.5rem 0.75rem;\n  display: flex;\n  justify-content: space-between;\n  gap: 0.5rem;\n  align-items: flex-start;\n  transition: background-color 0.15s ease, border-left 0.15s ease;\n  cursor: pointer;\n  border-left: 3px solid transparent;\n  \n  &:hover {\n    background-color: ${props => props.$type === 'user' ? '#f0fdf4' : '#f8fafc'};\n    border-left-color: ${props => props.$type === 'user' ? '#22c55e' : '#3b82f6'};\n  }\n  \n  &:not(:last-child) {\n    border-bottom: 0.5px solid #f3f4f6;\n  }\n`;\n\nconst TemplateInfo = styled.div`\n  flex: 1;\n  min-width: 0;\n`;\n\nconst TemplateName = styled.div`\n  font-weight: 600;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n`;\n\nconst TemplateBadge = styled.div`\n  margin-top: 3px;\n  color: #1e40af;\n  font-size: 0.7rem;\n  background: #dbeafe;\n  padding: 0.1rem 0.4rem;\n  border-radius: 0.25rem;\n  display: inline-block;\n`;\n\nconst TemplateActions = styled.div`\n  display: flex;\n  gap: 0.25rem;\n  align-items: center;\n`;\n\nconst ActionButton = styled.button`\n  background: none;\n  border: none;\n  color: ${props => props.$color || '#6b7280'};\n  padding: 0.125rem;\n  cursor: pointer;\n  \n  &:hover {\n    opacity: 0.7;\n  }\n`;\n\nconst LoadButton = styled.button`\n  font-size: 0.75rem;\n  padding: 0.25rem 0.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 0.25rem;\n  background: ${props => props.disabled ? '#f3f4f6' : '#eff6ff'};\n  color: ${props => props.disabled ? '#9ca3af' : '#1e3a8a'};\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  pointer-events: ${props => props.disabled ? 'none' : 'auto'};\n  opacity: ${props => props.disabled ? 0.6 : 1};\n  \n  &:hover:not(:disabled) {\n    background: #dbeafe;\n  }\n`;\n\nconst EmptyMessage = styled.div`\n  padding: 0.5rem 0.75rem;\n  color: ${props => props.$muted ? '#9ca3af' : '#6b7280'};\n  ${props => props.$italic && 'font-style: italic;'}\n`;\n\nconst Divider = styled.hr`\n  margin: 0.5rem 0;\n  border-color: #d1d5db;\n  border-width: 2px;\n  border-style: double;\n`;\n\n/**\n * TemplateDropdown - Komponent pro dropdown se ablonami\n * Zobrazuje peddefinovan a uivatelsk ablony s monost naten do formule\n */\nconst TemplateDropdown = ({\n  show,\n  serverTemplates = [],\n  savedTemplates = [],\n  templatesLoading = false,\n  searchQuery = '',\n  showSearch = false,\n  currentPhase = 1,\n  isArchived = false,\n  token = null,\n  hasPermission,\n  onSearch,\n  onToggleSearch,\n  onRefresh,\n  onFillPo,\n  onFillDetails,\n  canFillTemplate = true,\n  onCopyToUser,\n  onCopyToGlobal,\n  onShowPreview,\n  onDelete,\n  onEditName,\n  editingTemplateId = null,\n  editingTemplateName = '',\n  matchesQuery\n}) => {\n  const searchInputRef = useRef(null);\n  const dropdownRef = useRef(null);\n  const [position, setPosition] = useState({ left: '0', right: 'auto' });\n\n  // Pepotat pozici dropdownu, aby se veel do okna\n  useEffect(() => {\n    if (show && dropdownRef.current) {\n      const rect = dropdownRef.current.getBoundingClientRect();\n      const viewportWidth = window.innerWidth;\n      const dropdownWidth = 450; // ka dropdownu\n\n      // Pokud dropdown pesahuje prav okraj okna\n      if (rect.right > viewportWidth) {\n        // Pesunout doleva - zarovnat k pravmu okraji\n        setPosition({ left: 'auto', right: '0' });\n      } \n      // Pokud dropdown pesahuje lev okraj okna (me nastat pi right: 0)\n      else if (rect.left < 0) {\n        // Vrtit zpt k levmu okraji\n        setPosition({ left: '0', right: 'auto' });\n      }\n      // Pokud je dostatek msta, standardn pozice\n      else if (rect.left >= 0 && rect.right <= viewportWidth) {\n        setPosition({ left: '0', right: 'auto' });\n      }\n    }\n  }, [show]);\n\n  useEffect(() => {\n    if (showSearch && searchInputRef.current) {\n      setTimeout(() => searchInputRef.current?.focus(), 50);\n    }\n  }, [showSearch]);\n\n  if (!show) return null;\n\n  //  Oeten, pokud serverTemplates nebo savedTemplates nen array\n  const safeServerTemplates = Array.isArray(serverTemplates) ? serverTemplates : [];\n  const safeSavedTemplates = Array.isArray(savedTemplates) ? savedTemplates : [];\n\n  const filteredServerTemplates = safeServerTemplates\n    .filter(entry => entry && (entry.user_id === 0 || String(entry.user_id) === '0'))\n    .filter(entry => matchesQuery(entry, searchQuery));\n\n  const filteredSavedTemplates = safeSavedTemplates\n    .filter(entry => matchesQuery(entry, searchQuery));\n\n  return (\n    <DropdownContainer ref={dropdownRef} $left={position.left} $right={position.right}>\n      {/* Peddefinovan ablony */}\n      <SectionHeader>\n        <HeaderTitle>\n          <FontAwesomeIcon icon={faDatabase} style={{ color: '#3b82f6', fontSize: '14px' }} />\n          <span>Peddefinovan ablony</span>\n        </HeaderTitle>\n        <HeaderActions>\n          <IconButton\n            onClick={(e) => { e.stopPropagation(); onRefresh(); }}\n            title=\"Aktualizovat ablony z DB\"\n            disabled={!token || templatesLoading}\n            $color=\"#10b981\"\n          >\n            <RefreshCw size={16} />\n          </IconButton>\n          <IconButton\n            onClick={onToggleSearch}\n            title={showSearch ? 'Skrt hledn' : 'Hledat'}\n          >\n            <Search size={16} />\n          </IconButton>\n        </HeaderActions>\n      </SectionHeader>\n\n      {/* Vyhledvn */}\n      {showSearch && (\n        <SearchBox>\n          <SearchIcon>\n            <Search size={16} />\n          </SearchIcon>\n          <SearchInput\n            ref={searchInputRef}\n            type=\"text\"\n            value={searchQuery}\n            onChange={(e) => onSearch(e.target.value)}\n            placeholder=\"Hledat v ablonch...\"\n          />\n          {searchQuery && (\n            <SearchClearButton\n              onClick={() => onSearch('')}\n              title=\"Vymazat vyhledvn\"\n            >\n              <X size={14} />\n            </SearchClearButton>\n          )}\n        </SearchBox>\n      )}\n\n      {/* Seznam peddefinovanch ablon */}\n      <TemplateList>\n        {filteredServerTemplates.map((entry, idx) => {\n          const t = entry.data || {};\n          const typ = (entry.type || '').toString().toUpperCase();\n          const allowedPo = typ.includes('PO') || typ === 'OBEJD' || typ === 'MIXED';\n          const allowedDet = typ.includes('DET') || typ === 'OBEJD' || typ === 'MIXED';\n          const displayName = entry.name || entry.dbName || (t.poApproval?.predmet || `ablona ${entry.id || '?'}`);\n          const badge = (typ === 'OBEJD' || (allowedPo && allowedDet)) ? 'PO+Detaily' : (allowedDet ? 'Detaily' : 'PO');\n\n          return (\n            <TemplateItem key={`predef-${entry.id}-${entry.ts}-${idx}`} $type=\"server\">\n              <TemplateInfo>\n                <TemplateName>\n                  {displayName}\n                  {hasPermission?.('TEMPLATE_MANAGE') && (\n                    <ActionButton\n                      onClick={(e) => { e.stopPropagation(); onEditName(entry); }}\n                      title=\"Pejmenovat ablonu\"\n                    >\n                      <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                        <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"></path>\n                        <path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"></path>\n                      </svg>\n                    </ActionButton>\n                  )}\n                </TemplateName>\n                <TemplateBadge>{badge}</TemplateBadge>\n              </TemplateInfo>\n              \n              <TemplateActions>\n                <ActionButton onClick={() => onCopyToUser(entry)} title=\"Koprovat do mch ablon\" $color=\"#065f46\">\n                  <Plus size={16} />\n                </ActionButton>\n                <ActionButton onClick={() => onShowPreview(entry, entry.data)} title=\"Detailn nhled ablony\">\n                  <Eye size={16} />\n                </ActionButton>\n                {hasPermission?.('TEMPLATE_MANAGE') && (\n                  <ActionButton onClick={() => onDelete(entry)} title=\"Smazat\" $color=\"#dc2626\">\n                    <Trash size={16} />\n                  </ActionButton>\n                )}\n              </TemplateActions>\n              \n              <div style={{ display: 'flex', gap: '0.25rem' }}>\n                <LoadButton\n                  onClick={() => onFillPo(entry)}\n                  disabled={!canFillTemplate || (!isArchived && currentPhase >= 2) || !allowedPo}\n                  title={!canFillTemplate ? 'Vyplovn nelze - objednvka je dokonena nebo m neuloen zmny' : ((!isArchived && currentPhase >= 2) ? 'Nelze vloit PO po schvlen' : (!allowedPo ? 'Tato ablona neobsahuje PO' : 'Nast PO'))}\n                >\n                  PO\n                </LoadButton>\n                <LoadButton\n                  onClick={() => onFillDetails(entry)}\n                  disabled={!canFillTemplate || (!isArchived && currentPhase < 3) || !allowedDet}\n                  title={!canFillTemplate ? 'Vyplovn nelze - objednvka je dokonena nebo m neuloen zmny' : ((!isArchived && currentPhase < 3) ? 'Detaily se nataj a ve fzi 3 (po schvlen)' : (!allowedDet ? 'Tato ablona neobsahuje Detaily' : 'Nast detaily'))}\n                >\n                  Detaily\n                </LoadButton>\n              </div>\n            </TemplateItem>\n          );\n        })}\n        \n        {searchQuery.trim() && filteredServerTemplates.length === 0 && (\n          <EmptyMessage $muted>Nenalezeno</EmptyMessage>\n        )}\n      </TemplateList>\n\n      <Divider />\n\n      {/* Uivatelsk ablony */}\n      <SectionHeader>\n        <HeaderTitle>\n          <FontAwesomeIcon icon={faUser} style={{ color: '#22c55e', fontSize: '14px' }} />\n          <span>Moje ablony</span>\n        </HeaderTitle>\n      </SectionHeader>\n\n      {safeSavedTemplates.length === 0 && (\n        <EmptyMessage>dn ablony</EmptyMessage>\n      )}\n\n      <TemplateList>\n        {filteredSavedTemplates.map((entry, idx) => {\n          const typ = (entry.type || '').toString().toUpperCase();\n          const hasPo = typ === 'PO' || typ === 'OBEJD' || typ === 'MIXED' || !!entry?.data?.poApproval;\n          const hasDet = typ === 'DETAIL' || typ === 'OBEJD' || typ === 'MIXED' || !!entry?.data?.orderDetails;\n          const badge = (typ === 'OBEJD' || (hasPo && hasDet)) ? 'PO+Detaily' : (hasDet ? 'Detaily' : 'PO');\n\n          return (\n            <TemplateItem key={`user-${entry.id}-${entry.ts}-${idx}`} $type=\"user\">\n              <TemplateInfo>\n                <TemplateName>\n                  {entry.name}\n                  <ActionButton\n                    onClick={(e) => { e.stopPropagation(); onEditName(entry); }}\n                    title=\"Pejmenovat ablonu\"\n                  >\n                    <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                      <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"></path>\n                      <path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"></path>\n                    </svg>\n                  </ActionButton>\n                </TemplateName>\n                <TemplateBadge>{badge}</TemplateBadge>\n              </TemplateInfo>\n              \n              <TemplateActions>\n                <ActionButton onClick={() => onShowPreview(entry, entry.data)} title=\"Detailn nhled ablony\">\n                  <Eye size={16} />\n                </ActionButton>\n                {hasPermission?.('TEMPLATE_MANAGE') && (\n                  <ActionButton onClick={() => onCopyToGlobal(entry)} title=\"Koprovat do globlnch ablon\" $color=\"#059669\">\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n                      <path d=\"m9 12 2 2 4-4\"></path>\n                    </svg>\n                  </ActionButton>\n                )}\n                <ActionButton onClick={() => onDelete(entry)} title=\"Smazat\" $color=\"#dc2626\">\n                  <Trash size={16} />\n                </ActionButton>\n              </TemplateActions>\n              \n              <div style={{ display: 'flex', gap: '0.25rem' }}>\n                <LoadButton\n                  onClick={() => onFillPo(entry)}\n                  disabled={!canFillTemplate || (!isArchived && currentPhase >= 2) || !hasPo}\n                  title={!canFillTemplate ? 'Vyplovn nelze - objednvka je dokonena nebo m neuloen zmny' : ((!isArchived && currentPhase >= 2) ? 'Nelze vloit PO po schvlen' : (!hasPo ? 'Tato ablona neobsahuje PO' : 'Nast PO'))}\n                >\n                  PO\n                </LoadButton>\n                <LoadButton\n                  onClick={() => onFillDetails(entry)}\n                  disabled={!canFillTemplate || (!isArchived && currentPhase < 3) || !hasDet}\n                  title={!canFillTemplate ? 'Vyplovn nelze - objednvka je dokonena nebo m neuloen zmny' : ((!isArchived && currentPhase < 3) ? 'Detaily se nataj a ve fzi 3 (po schvlen)' : (!hasDet ? 'Tato ablona neobsahuje Detaily' : 'Nast detaily'))}\n                >\n                  Detaily\n                </LoadButton>\n              </div>\n            </TemplateItem>\n          );\n        })}\n        \n        {searchQuery.trim() && filteredSavedTemplates.length === 0 && (\n          <EmptyMessage $muted>Nenalezeno</EmptyMessage>\n        )}\n      </TemplateList>\n    </DropdownContainer>\n  );\n};\n\nexport default TemplateDropdown;\n","import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport ReactDOM from 'react-dom';\nimport styled from '@emotion/styled';\nimport {\n  Menu,\n  ChevronLeft,\n  ChevronRight,\n  ChevronDown,\n  Upload,\n  Building,\n  Package,\n  Calendar,\n  FileText as FileTextIcon,\n  Calculator,\n  Maximize2,\n  Minimize2,\n  Minus,\n  CheckCircle2,\n  FileDown\n} from 'lucide-react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faUser,\n  faClipboardCheck,\n  faFileContract,\n  faCheckCircle,\n  faClipboard,\n  faBookmark,\n  faExpand,\n  faCompress,\n  faSave\n} from '@fortawesome/free-solid-svg-icons';\nimport TemplateDropdown from './TemplateDropdown';\n\n//  KRITICK: Kategorizace chybovch kl do sekc navigtoru\n// MUS BT 100% SHODN s OrderForm25.formatValidationErrors() !!!\n// Jakkoliv zmna zde MUS bt provedena i v OrderForm25.js\nconst categorizeErrorKey = (key) => {\n  // POAD JE DLEIT - specifitj podmnky mus bt PED obecnjmi!\n  \n  // 1. Informace o objednateli (vetn garanta!)\n  if (key.includes('jmeno') || key.includes('email') || key.includes('ev_cislo') || key.includes('garant')) {\n    return 'objednatel';\n  }\n  \n  // 2. Schvlen nkupu PO (FZE 1-2) - vetn FINANCOVN!\n  if (key.includes('prikazce') || key.includes('max_cena') || \n      key.includes('strediska') || key.includes('predmet') ||\n      key.includes('financovani') || key.includes('lp_kod') || key.includes('cislo_smlouvy') ||\n      key.includes('individualni_schvaleni') || key.includes('pojistna_udalost')) {\n    return 'schvaleni';\n  }\n  \n  // 3. Detaily objednvky (FZE 3+: poloky + druh + lokalizace) - MUS BT PED dodavatelem!\n  if (key.startsWith('polozka_') || key.includes('druh_objednavky')) {\n    return 'detaily';\n  }\n  \n  // 4. Potvrzen objednvky dodavatelem - MUS BT PED \"dodavatel\" (kvli dodavatel_zpusob_potvrzeni)\n  if (key.includes('zpusob_potvrzeni') || key.includes('dt_akceptace') || key.includes('zpusob_platby')) {\n    return 'potvrzeni_objednavky';\n  }\n  \n  // 5. Dodavatel - MUS BT PO potvrzen (kvli dodavatel_zpusob_potvrzeni)\n  if (key.includes('dodavatel') || key.includes('ico') || key.includes('adresa') || key.includes('kontakt')) {\n    return 'dodavatel';\n  }\n  \n  // 6. Odesln objednvky\n  if (key.includes('datum_odeslani') || key.includes('stav_odeslani')) {\n    return 'stav_odeslani';\n  }\n  \n  // 7. Vcn sprvnost - MUS BT PED obecnm \"faktura_\"\n  if (key.startsWith('faktura_') && key.includes('vecna_spravnost')) {\n    return 'vecna_spravnost';\n  }\n  \n  // 8. Fakturace\n  if (key.startsWith('faktura_')) {\n    return 'fakturace';\n  }\n  \n  // 9. Registr smluv\n  if (key.includes('dt_zverejneni') || key.includes('registr') || key.includes('ma_byt_zverejnena')) {\n    return 'registr_smluv_vyplneni';\n  }\n  \n  // 10. Ostatn (fallback)\n  return null;\n};\n\n// Konstanta pro ku navigtoru\nconst NAVIGATOR_WIDTH = 305; // +25px\nconst NAVIGATOR_MINIMIZED_WIDTH = 40;\nconst NAVIGATOR_COMPACT_WIDTH = 305; // Kompaktn reim (jen dropzone)\nconst DROPZONE_HEIGHT = 120;\n\n// Styled Components\nconst NavigatorContainer = styled.div`\n  position: fixed;\n  top: ${props => props.$position.y}px;\n  left: ${props => props.$position.x}px;\n  width: ${props => {\n    if (props.$isMinimized) return `${NAVIGATOR_MINIMIZED_WIDTH}px`;\n    if (props.$isCompact) return `${NAVIGATOR_COMPACT_WIDTH}px`;\n    return `${NAVIGATOR_WIDTH}px`;\n  }};\n  background: ${props => props.$isMinimized\n    ? 'linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.98) 100%)'\n    : 'linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.98) 100%)'\n  };\n  backdrop-filter: blur(12px);\n  border-radius: ${props => props.$isMinimized ? '0 8px 8px 0' : '12px'};\n  box-shadow: ${props => props.$isMinimized\n    ? '0 4px 16px rgba(0, 0, 0, 0.1), 0 1px 4px rgba(0, 0, 0, 0.06)'\n    : '0 8px 32px rgba(0, 0, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(0, 0, 0, 0.08)'};\n  z-index: ${props => props.$isFullscreen ? '999999' : '99999'};\n  cursor: ${props => props.$isDragging ? 'grabbing' : 'default'};\n  transition: ${props => props.$isDragging\n    ? 'none'\n    : 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)'};\n  display: flex;\n  flex-direction: column;\n  max-height: ${props => props.$isMinimized ? '400px' : '80vh'};\n  user-select: none;\n  will-change: width, left, border-radius, box-shadow;\n\n  ${props => props.$isMinimized && `\n    left: 0;\n    border-radius: 0 8px 8px 0;\n  `}\n`;\n\nconst NavigatorHeader = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: ${props => props.$isMinimized ? '12px 8px' : '16px 20px'};\n  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n  border-bottom: 2px solid #e2e8f0;\n  cursor: ${props => props.$isMinimized ? 'default' : 'grab'};\n  border-radius: ${props => props.$isMinimized ? '0 8px 0 0' : '12px 12px 0 0'};\n  transition: padding 0.4s cubic-bezier(0.4, 0, 0.2, 1), border-radius 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n\n  &:active {\n    cursor: ${props => props.$isMinimized ? 'default' : 'grabbing'};\n  }\n`;\n\nconst MinimizedText = styled.div`\n  writing-mode: vertical-rl;\n  text-orientation: mixed;\n  font-size: 14px;\n  font-weight: 600;\n  color: #334155;\n  letter-spacing: 2px;\n  text-transform: uppercase;\n  line-height: 1.2;\n  animation: fadeInScaleDelayed 0.3s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;\n\n  @keyframes fadeInScaleDelayed {\n    from {\n      opacity: 0;\n      transform: scale(0.9) translateY(10px);\n    }\n    to {\n      opacity: 1;\n      transform: scale(1) translateY(0);\n    }\n  }\n`;\n\nconst NavigatorTitle = styled.div`\n  font-size: 15px;\n  font-weight: 600;\n  color: #1e293b;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  animation: fadeInSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n\n  @keyframes fadeInSlide {\n    from {\n      opacity: 0;\n      transform: translateX(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateX(0);\n    }\n  }\n\n  svg {\n    width: 18px;\n    height: 18px;\n    color: #3b82f6;\n  }\n`;\n\nconst HeaderControls = styled.div`\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  animation: fadeInSlideLeft 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n\n  @keyframes fadeInSlideLeft {\n    from {\n      opacity: 0;\n      transform: translateX(10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateX(0);\n    }\n  }\n`;\n\nconst ToolbarSection = styled.div`\n  padding: 12px 16px;\n  border-bottom: 2px solid #e2e8f0;\n  background: linear-gradient(135deg, #fefefe 0%, #f8fafc 100%);\n  animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n      transform: translateY(-5px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n`;\n\nconst ToolbarButtons = styled.div`\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n`;\n\nconst ToolbarButton = styled.button`\n  background: #ffffff;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  transition: all 0.2s ease;\n  color: #475569;\n  opacity: ${props => props.disabled ? 0.4 : 1};\n  position: relative;\n\n  &:hover:not(:disabled) {\n    background: #f8fafc;\n    border-color: #cbd5e1;\n    color: #1e293b;\n    transform: scale(1.05);\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n  }\n\n  &:active:not(:disabled) {\n    transform: scale(0.95);\n  }\n\n  ${props => props.$withPlus && `\n    &::after {\n      content: '+';\n      position: absolute;\n      top: -2px;\n      right: -2px;\n      width: 14px;\n      height: 14px;\n      background: #f59e0b;\n      color: white;\n      border-radius: 50%;\n      font-size: 10px;\n      font-weight: bold;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border: 2px solid white;\n    }\n  `}\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n`;\n\nconst IconButton = styled.button`\n  background: #ffffff;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  color: #475569;\n\n  &:hover {\n    background: #f8fafc;\n    border-color: #cbd5e1;\n    color: #1e293b;\n    transform: scale(1.05);\n  }\n\n  &:active {\n    transform: scale(0.95);\n  }\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n`;\n\nconst MinimizedExpandButton = styled(IconButton)`\n  margin: 8px auto;\n  display: flex;\n  animation: fadeInBounce 0.3s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;\n\n  @keyframes fadeInBounce {\n    0% {\n      opacity: 0;\n      transform: scale(0.8) translateY(-10px);\n    }\n    60% {\n      transform: scale(1.05) translateY(0);\n    }\n    100% {\n      opacity: 1;\n      transform: scale(1) translateY(0);\n    }\n  }\n`;\n\nconst NavigatorContent = styled.div`\n  flex: 1;\n  overflow: hidden;\n  padding: ${props => props.$isMinimized ? '8px 4px' : '12px 8px'};\n  transition: padding 0.4s cubic-bezier(0.4, 0, 0.2, 1),\n              opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1),\n              transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n  opacity: ${props => props.$isMinimized ? '0' : '1'};\n  transform: ${props => props.$isMinimized ? 'scale(0.95) translateX(-10px)' : 'scale(1) translateX(0)'};\n  transform-origin: left center;\n\n  ${props => !props.$isMinimized && `\n    overflow-y: auto;\n  `}\n\n  &::-webkit-scrollbar {\n    width: 6px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: rgba(226, 232, 240, 0.3);\n    border-radius: 3px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: rgba(148, 163, 184, 0.5);\n    border-radius: 3px;\n\n    &:hover {\n      background: rgba(100, 116, 139, 0.7);\n    }\n  }\n`;\n\nconst SectionItem = styled.div`\n  padding: ${props => props.$isMinimized ? '8px 4px' : '10px 14px'};\n  margin-bottom: 6px;\n  border-radius: 8px;\n  cursor: pointer; /*  Vdy pointer - umouje scrollovn i k zamenm sekcm */\n  transition: all 0.2s ease;\n  opacity: ${props => props.$isDisabled ? 0.45 : 1};\n  background: ${props => {\n    if (props.$isDisabled) return 'linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)';\n    return props.$bgColor || 'rgba(255, 255, 255, 0.8)';\n  }};\n  border: 2px solid ${props => {\n    if (props.$isDisabled) return '#cbd5e1';\n    return props.$borderColor || '#94a3b8';\n  }};\n  box-shadow: ${props => props.$isActive\n    ? '0 2px 8px rgba(0, 0, 0, 0.12), inset 0 0 0 1px rgba(59, 130, 246, 0.3)'\n    : '0 1px 3px rgba(0, 0, 0, 0.05)'\n  };\n\n  &:hover {\n    opacity: ${props => props.$isDisabled ? 0.55 : 1}; /*  Mrn zesvtlen i pro disabled */\n    transform: translateX(2px); /*  Hover efekt i pro disabled - ukazuje e je to klikateln */\n    box-shadow: ${props => props.$isDisabled\n      ? '0 2px 6px rgba(0, 0, 0, 0.08)' /*  Mrn stn pro disabled */\n      : '0 4px 12px rgba(0, 0, 0, 0.12)'\n    };\n  }\n`;\n\nconst SectionItemContent = styled.div`\n  display: flex;\n  align-items: center;\n  gap: ${props => props.$isMinimized ? '0' : '12px'};\n  justify-content: ${props => props.$isMinimized ? 'center' : 'flex-start'};\n`;\n\nconst SectionIcon = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  color: ${props => props.$isDisabled ? '#64748b' : props.$color || '#94a3b8'};\n  flex-shrink: 0;\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n`;\n\nconst SectionInfo = styled.div`\n  flex: 1;\n  min-width: 0;\n  color: ${props => props.$textColor || '#1e293b'};\n`;\n\nconst SectionName = styled.div`\n  font-size: 13px;\n  font-weight: 600;\n  line-height: 1.4;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst ValidationBadge = styled.span`\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background: ${props => {\n    if (props.$hasErrors) return '#ef4444'; // erven pro chyby\n    if (props.$hasMissingFields) return '#f59e0b'; // Oranov teka pro nevyplnn pole\n    return '#10b981'; // Zelen pro OK (nepouv se)\n  }};\n  color: white;\n  font-size: 11px;\n  font-weight: 600;\n  padding: ${props => props.$hasMissingFields && !props.$hasErrors ? '5px' : '2px 6px'};\n  border-radius: 50%;\n  width: ${props => props.$hasMissingFields && !props.$hasErrors ? '8px' : '20px'};\n  height: ${props => props.$hasMissingFields && !props.$hasErrors ? '8px' : '20px'};\n  min-width: ${props => props.$hasMissingFields && !props.$hasErrors ? '8px' : '20px'};\n  min-height: ${props => props.$hasMissingFields && !props.$hasErrors ? '8px' : '20px'};\n  margin-left: auto;\n  flex-shrink: 0;\n  line-height: 1;\n`;\n\nconst AttachmentBadge = styled.span`\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background: ${props => props.$hasErrors ? '#dc2626' : '#10b981'}; // erven nebo zelen\n  color: white;\n  font-size: 11px;\n  font-weight: 600;\n  padding: 2px 6px;\n  border-radius: 50%;\n  width: 20px;\n  height: 20px;\n  min-width: 20px;\n  min-height: 20px;\n  margin-left: auto;\n  flex-shrink: 0;\n  line-height: 1;\n  border: 1px solid ${props => props.$hasErrors ? '#dc2626' : '#10b981'};\n`;\n\nconst DropzoneContainer = styled.div`\n  margin: 12px 8px 12px 8px;\n  padding: ${props => props.$isMinimized ? '12px 8px' : '20px'};\n  border: 2px dashed ${props => props.$isDisabled ? '#d1d5db' : (props.$isDragOver ? '#dc2626' : '#fca5a5')};\n  border-radius: 8px;\n  background: ${props => props.$isDisabled\n    ? '#f3f4f6'\n    : (props.$isDragOver\n      ? 'linear-gradient(135deg, rgba(254, 202, 202, 0.5) 0%, rgba(252, 165, 165, 0.5) 100%)'\n      : 'linear-gradient(135deg, rgba(254, 226, 226, 0.3) 0%, rgba(254, 202, 202, 0.3) 100%)')\n  };\n  transition: all 0.2s ease;\n  cursor: ${props => props.$isDisabled ? 'not-allowed' : 'pointer'};\n  opacity: ${props => props.$isDisabled ? 0.5 : 1};\n  pointer-events: ${props => props.$isDisabled ? 'none' : 'auto'};\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: ${props => props.$isMinimized ? '4px' : '8px'};\n  height: ${props => props.$isMinimized ? '60px' : `${DROPZONE_HEIGHT}px`};\n\n  &:hover {\n    border-color: ${props => props.$isDisabled ? '#d1d5db' : '#dc2626'};\n    background: ${props => props.$isDisabled ? '#f3f4f6' : 'linear-gradient(135deg, rgba(254, 202, 202, 0.5) 0%, rgba(252, 165, 165, 0.5) 100%)'};\n  }\n`;\n\nconst DropzoneIcon = styled.div`\n  color: ${props => props.$isDisabled ? '#9ca3af' : (props.$isDragOver ? '#dc2626' : '#991b1b')};\n  transition: all 0.2s ease;\n\n  svg {\n    width: ${props => props.$isMinimized ? '20px' : '32px'};\n    height: ${props => props.$isMinimized ? '20px' : '32px'};\n  }\n`;\n\nconst DropzoneText = styled.div`\n  font-size: ${props => props.$isMinimized ? '10px' : '13px'};\n  font-weight: 600;\n  color: ${props => props.$isDisabled ? '#9ca3af' : (props.$isDragOver ? '#dc2626' : '#991b1b')};\n  text-align: center;\n  line-height: 1.4;\n`;\n\n// Definice sekc formule - barvy odpovdaj OrderForm25 schmatu\nconst FORM_SECTIONS = [\n  {\n    id: 'objednatel',\n    name: 'Informace o objednateli',\n    icon: faUser,\n    color: '#4b5563', // section-grey text color\n    bgColor: 'linear-gradient(135deg, rgba(249, 250, 251, 0.95) 0%, rgba(243, 244, 246, 0.95) 100%)',\n    borderColor: '#9ca3af',\n    phase: 1,\n    required: ['jmeno', 'prijmeni']\n  },\n  {\n    id: 'schvaleni',\n    name: 'Schvlen nkupu PO',\n    icon: faClipboardCheck,\n    color: '#4b5563', // section-grey text color\n    bgColor: 'linear-gradient(135deg, rgba(249, 250, 251, 0.95) 0%, rgba(243, 244, 246, 0.95) 100%)',\n    borderColor: '#9ca3af',\n    phase: 1,\n    required: ['schvalovatel_id']\n  },\n  // 'financovani' je podsekce schvlen - nen v navigtoru samostatn\n  {\n    id: 'dodavatel',\n    name: 'Dodavatel',\n    icon: Building,\n    iconType: 'lucide',\n    color: '#92400e', // section-orange text color\n    bgColor: 'linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)',\n    borderColor: '#f59e0b',\n    phase: 2,\n    required: ['dodavatel_ico', 'dodavatel_nazev']\n  },\n  {\n    id: 'detaily',\n    name: 'Detaily objednvky',\n    icon: Package,\n    iconType: 'lucide',\n    color: '#92400e', // section-orange text color\n    bgColor: 'linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)',\n    borderColor: '#f59e0b',\n    phase: 2,\n    required: ['predmet', 'celkova_cena']\n  },\n  {\n    id: 'dodaci_podminky',\n    name: 'Dodac a zrun podmnky',\n    icon: Calendar,\n    iconType: 'lucide',\n    color: '#92400e', // section-orange text color\n    bgColor: 'linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)',\n    borderColor: '#f59e0b',\n    phase: 2,\n    required: []\n  },\n  {\n    id: 'prilohy',\n    name: 'Plohy k objednvce',\n    icon: FileTextIcon,\n    iconType: 'lucide',\n    color: '#991b1b', // section-red text color\n    bgColor: 'linear-gradient(135deg, rgba(254, 226, 226, 0.95) 0%, rgba(254, 202, 202, 0.95) 100%)',\n    borderColor: '#dc2626',\n    phase: 2,\n    required: []\n  },\n  {\n    id: 'stav_odeslani',\n    name: 'Stav odesln objednvky',\n    icon: Package,\n    iconType: 'lucide',\n    color: '#92400e', // section-orange text color\n    bgColor: 'linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(253, 230, 138, 0.95) 100%)',\n    borderColor: '#f59e0b',\n    phase: 3,\n    required: []\n  },\n  {\n    id: 'potvrzeni_objednavky',\n    name: 'Potvrzen objednvky',\n    icon: faCheckCircle,\n    color: '#1e40af', // section-blue text color\n    bgColor: 'linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)',\n    borderColor: '#3b82f6',\n    phase: 3,\n    required: []\n  },\n  {\n    id: 'registr_smluv',\n    name: 'Registr smluv',\n    icon: faFileContract,\n    color: '#1e40af', // section-blue text color\n    bgColor: 'linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)',\n    borderColor: '#3b82f6',\n    phase: 4,\n    required: []\n  },\n  {\n    id: 'registr_smluv_vyplneni',\n    name: 'Potvrzen zveejnn',\n    icon: faFileContract,\n    color: '#7e22ce', // section-purple text color\n    bgColor: 'linear-gradient(135deg, rgba(243, 232, 255, 0.95) 0%, rgba(233, 213, 255, 0.95) 100%)',\n    borderColor: '#a855f7',\n    phase: 5,\n    required: []\n  },\n  {\n    id: 'fakturace',\n    name: 'Fakturace',\n    icon: Calculator,\n    iconType: 'lucide',\n    color: '#1e40af', // section-blue text color\n    bgColor: 'linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)',\n    borderColor: '#3b82f6',\n    phase: 6,\n    required: []\n  },\n  {\n    id: 'vecna_spravnost',\n    name: 'Vcn sprvnost',\n    icon: CheckCircle2,\n    iconType: 'lucide',\n    color: '#1e40af', // section-blue text color\n    bgColor: 'linear-gradient(135deg, rgba(219, 234, 254, 0.95) 0%, rgba(191, 219, 254, 0.95) 100%)',\n    borderColor: '#3b82f6',\n    phase: 7,\n    required: []\n  },\n  {\n    id: 'dokonceni',\n    name: 'Dokonen',\n    icon: faCheckCircle,\n    color: '#059669', // zelen pro dokonen\n    bgColor: 'linear-gradient(135deg, rgba(209, 250, 229, 0.95) 0%, rgba(167, 243, 208, 0.95) 100%)',\n    borderColor: '#10b981',\n    phase: 8,\n    required: []\n  }\n  //  \"Plohy k objednvce\" jsou vyrenderovan SAMOSTATN POD dropzone (viz ne v JSX)\n];\n\n/**\n * FloatingNavigator - Plovouc navigtor pro OrderForm25\n *\n * @param {Object} props\n * @param {Function} props.onSectionClick - Callback pi kliknut na sekci (sectionId)\n * @param {Function} props.onFilesDrop - Callback pi dropnut soubor (files)\n * @param {number} props.currentPhase - Aktuln fze workflow (1-5+)\n * @param {Object} props.validationErrors - Objekt s validanmi chybami\n * @param {Object} props.formData - Data formule pro kontrolu vyplnn\n * @param {boolean} props.isFullscreen - Zda je formul ve fullscreen reimu\n * @param {Function} props.isSectionActive - Funkce pro uren, zda je sekce aktivn\n * @param {boolean} props.canPublishRegistry - M uivatel prvo ORDER_PUBLISH_REGISTRY\n */\nconst FloatingNavigator = ({\n  onSectionClick,\n  onFilesDrop,\n  onToggleSections, //  Nov: callback pro sbalen/rozbalen sekc\n  areSectionsCollapsed = false, //  Nov: stav sbalen sekc\n  currentPhase = 1,\n  validationErrors = {},\n  formData = {},\n  isFullscreen = false,\n  isSectionActive,\n  allSectionStates = {}, //  Pidno: stavy sekc z workflowManager\n  isWorkflowCompleted = false, //  Nov: indiktor dokonenho workflow (DOKONCENA/ZAMITNUTA/ZRUSENA)\n  canPublishRegistry = false, //  Nov: oprvnn pro sekci registru smluv\n  canUnlockAnything = false, //  Nov: pouze ADMIN + ORDER_MANAGE vid sekci Dokonen\n  //  NOV: Toolbar akce\n  onTemplateClick,\n  onSaveAsTemplate,\n  onGenerateDocx,\n  onToggleFullscreen,\n  canGenerateDocx = false,\n  canSaveTemplate = false,\n  //  Template Dropdown props\n  showTemplateDropdown = false,\n  serverTemplates = [],\n  savedTemplates = [],\n  templatesLoading = false,\n  searchQuery = '',\n  showSearch = false,\n  token = null,\n  hasPermission,\n  onTemplateSearch,\n  onToggleTemplateSearch,\n  onRefreshTemplates,\n  onFillPoApproval,\n  onFillDetails,\n  canFillTemplate = true, //  Nov: me uivatel vyplnit data ze ablony\n  onCopyTemplateToUser,\n  onCopyTemplateToGlobal,\n  onShowTemplatePreview,\n  onDeleteTemplate,\n  onEditTemplateName,\n  editingTemplateId = null,\n  editingTemplateName = '',\n  matchesTemplateQuery,\n  isArchived = false\n}) => {\n  const [isMinimized, setIsMinimized] = useState(false);\n  const [isCompact, setIsCompact] = useState(false); //  Nov: Kompaktn reim\n  const [isDragging, setIsDragging] = useState(false);\n  const [isDragOver, setIsDragOver] = useState(false);\n  const [position, setPosition] = useState({ x: 20, y: 150 });\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n  const [isTemplateDropdownOpen, setIsTemplateDropdownOpen] = useState(false); //  State pro dropdown ablon\n  const containerRef = useRef(null);\n  const fileInputRef = useRef(null);\n  const contentRef = useRef(null); //  Ref pro scroll pozici\n\n  // Save position to localStorage\n  const savePosition = useCallback((newPosition) => {\n    localStorage.setItem('floatingNavigatorPosition', JSON.stringify(newPosition));\n  }, []);\n\n  //  Funkce pro kontrolu a pravu pozice pi zmn velikosti okna\n  const constrainToViewport = useCallback((pos) => {\n    const navigatorWidth = isMinimized ? NAVIGATOR_MINIMIZED_WIDTH :\n                           isCompact ? NAVIGATOR_COMPACT_WIDTH : NAVIGATOR_WIDTH;\n\n    // Minimln okraj kolem navigtoru\n    const margin = 20;\n    \n    // Zskat skutenou vku navigtoru z DOM\n    const navigatorHeight = containerRef.current?.offsetHeight || 400;\n\n    const maxX = Math.max(0, window.innerWidth - navigatorWidth - margin);\n    const maxY = Math.max(0, window.innerHeight - navigatorHeight - margin);\n\n    const constrainedX = Math.max(0, Math.min(pos.x, maxX));\n    const constrainedY = Math.max(0, Math.min(pos.y, maxY));\n\n    return { x: constrainedX, y: constrainedY };\n  }, [isMinimized, isCompact]);\n\n    // Load position and scroll from localStorage\n  useEffect(() => {\n    const saved = localStorage.getItem('floatingNavigatorPosition');\n    if (saved) {\n      try {\n        const savedPos = JSON.parse(saved);\n        //  Zkontrolovat, zda uloen pozice je stle validn pro aktuln velikost okna\n        const constrainedPos = constrainToViewport(savedPos);\n        setPosition(constrainedPos);\n\n        // Uloit upravenou pozici, pokud se zmnila\n        if (constrainedPos.x !== savedPos.x || constrainedPos.y !== savedPos.y) {\n          savePosition(constrainedPos);\n        }\n      } catch (e) {\n        console.warn('Failed to parse saved navigator position');\n      }\n    }\n\n    const savedMinimized = localStorage.getItem('floatingNavigatorMinimized');\n    if (savedMinimized === 'true') {\n      setIsMinimized(true);\n    }\n\n    const savedCompact = localStorage.getItem('floatingNavigatorCompact');\n    if (savedCompact === 'true') {\n      setIsCompact(true);\n    }\n\n    //  Obnoven scroll pozice\n    const savedScroll = localStorage.getItem('floatingNavigatorScroll');\n    if (savedScroll && contentRef.current) {\n      try {\n        const scrollPos = parseInt(savedScroll, 10);\n        contentRef.current.scrollTop = scrollPos;\n      } catch (e) {\n        console.warn('Failed to restore scroll position');\n      }\n    }\n  }, [constrainToViewport, savePosition]);\n\n  //  Handler pro zmnu velikosti okna\n  const handleWindowResize = useCallback(() => {\n    setPosition(prevPosition => {\n      const newPosition = constrainToViewport(prevPosition);\n\n      // Uloit novou pozici jen pokud se skuten zmnila\n      if (newPosition.x !== prevPosition.x || newPosition.y !== prevPosition.y) {\n        savePosition(newPosition);\n        return newPosition;\n      }\n\n      return prevPosition;\n    });\n  }, [constrainToViewport, savePosition]);\n\n  //  Sledovn zmn velikosti okna\n  useEffect(() => {\n    const handleResize = () => {\n      // Debounce resize handler pro lep vkon\n      clearTimeout(handleResize.timeoutId);\n      handleResize.timeoutId = setTimeout(handleWindowResize, 150);\n    };\n\n    window.addEventListener('resize', handleResize);\n\n    return () => {\n      window.removeEventListener('resize', handleResize);\n      clearTimeout(handleResize.timeoutId);\n    };\n  }, [handleWindowResize]);\n\n  // Save minimized state\n  const saveMinimizedState = useCallback((minimized) => {\n    localStorage.setItem('floatingNavigatorMinimized', minimized.toString());\n  }, []);\n\n  // Save compact state\n  const saveCompactState = useCallback((compact) => {\n    localStorage.setItem('floatingNavigatorCompact', compact.toString());\n  }, []);\n\n  //  Save scroll position (debounced)\n  const scrollTimeoutRef = useRef(null);\n  const saveScrollPosition = useCallback(() => {\n    if (scrollTimeoutRef.current) {\n      clearTimeout(scrollTimeoutRef.current);\n    }\n    scrollTimeoutRef.current = setTimeout(() => {\n      if (contentRef.current) {\n        localStorage.setItem('floatingNavigatorScroll', contentRef.current.scrollTop.toString());\n      }\n    }, 300); // ulo a po 300ms bez scrollovn\n  }, []);\n\n  // Drag handlers\n  const handleMouseDown = useCallback((e) => {\n    if (isMinimized) return;\n\n    const rect = containerRef.current.getBoundingClientRect();\n    setDragOffset({\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top\n    });\n    setIsDragging(true);\n  }, [isMinimized]);\n\n  const handleMouseMove = useCallback((e) => {\n    if (!isDragging) return;\n\n    const newX = e.clientX - dragOffset.x;\n    const newY = e.clientY - dragOffset.y;\n\n    // Pout centralizovanou constraint logiku\n    const constrainedPosition = constrainToViewport({ x: newX, y: newY });\n\n    setPosition(constrainedPosition);\n  }, [isDragging, dragOffset, constrainToViewport]);\n\n  const handleMouseUp = useCallback(() => {\n    if (isDragging) {\n      setIsDragging(false);\n      savePosition(position);\n    }\n  }, [isDragging, position, savePosition]);\n\n  useEffect(() => {\n    if (isDragging) {\n      document.addEventListener('mousemove', handleMouseMove);\n      document.addEventListener('mouseup', handleMouseUp);\n\n      return () => {\n        document.removeEventListener('mousemove', handleMouseMove);\n        document.removeEventListener('mouseup', handleMouseUp);\n      };\n    }\n  }, [isDragging, handleMouseMove, handleMouseUp]);\n\n  // Toggle minimized\n  const toggleMinimized = useCallback(() => {\n    const newMinimized = !isMinimized;\n    setIsMinimized(newMinimized);\n    saveMinimizedState(newMinimized);\n\n    if (newMinimized) {\n      // Pilepit k levmu okraji\n      const newPosition = { ...position, x: 0 };\n      setPosition(newPosition);\n      savePosition(newPosition);\n    } else {\n      // Pi rozblen zkontrolovat, zda je pozice stle validn\n      setPosition(prevPos => {\n        const constrainedPos = constrainToViewport(prevPos);\n        if (constrainedPos.x !== prevPos.x || constrainedPos.y !== prevPos.y) {\n          savePosition(constrainedPos);\n        }\n        return constrainedPos;\n      });\n    }\n  }, [isMinimized, position, saveMinimizedState, savePosition, constrainToViewport]);\n\n  // Toggle compact mode\n  const toggleCompact = useCallback(() => {\n    const newCompact = !isCompact;\n    setIsCompact(newCompact);\n    saveCompactState(newCompact);\n\n    // Po zmn compact reimu zkontrolovat pozici (jin ka navigtoru)\n    setTimeout(() => {\n      setPosition(prevPos => {\n        const constrainedPos = constrainToViewport(prevPos);\n        if (constrainedPos.x !== prevPos.x || constrainedPos.y !== prevPos.y) {\n          savePosition(constrainedPos);\n        }\n        return constrainedPos;\n      });\n    }, 50); // Krtk prodleva pro dokonen CSS pechodu\n  }, [isCompact, saveCompactState, constrainToViewport, savePosition]);\n\n  // Dropzone handlers\n  const handleDragEnter = useCallback((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(true);\n  }, []);\n\n  const handleDragLeave = useCallback((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    // Zkontroluj, zda opravdu opoutme celou dropzone oblast\n    if (!e.currentTarget.contains(e.relatedTarget)) {\n      setIsDragOver(false);\n    }\n  }, []);\n\n  const handleDragOver = useCallback((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(true);\n  }, []);\n\n  const handleDrop = useCallback((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(false);\n\n    const files = Array.from(e.dataTransfer.files);\n    if (files.length > 0 && onFilesDrop) {\n      onFilesDrop(files);\n    }\n  }, [onFilesDrop]);\n\n  const handleDropzoneClick = useCallback(() => {\n    fileInputRef.current?.click();\n  }, []);\n\n  const handleFileSelect = useCallback((e) => {\n    const files = Array.from(e.target.files);\n    if (files.length > 0 && onFilesDrop) {\n      onFilesDrop(files);\n    }\n    // Reset input\n    e.target.value = '';\n  }, [onFilesDrop]);\n\n  //  Handler pro toggle template dropdownu\n  const handleToggleTemplateDropdown = useCallback(() => {\n    setIsTemplateDropdownOpen(prev => !prev);\n    // Pi oteven voliteln zavolat refresh ablon\n    if (!isTemplateDropdownOpen && onRefreshTemplates) {\n      onRefreshTemplates();\n    }\n  }, [isTemplateDropdownOpen, onRefreshTemplates]);\n\n  //  Zavt dropdown pi kliknut mimo nj\n  useEffect(() => {\n    if (!isTemplateDropdownOpen) return;\n\n    const handleClickOutside = (event) => {\n      // Zkontroluj, jestli klik nebyl na tlatko nebo dropdown\n      const dropdown = event.target.closest('[data-template-dropdown]');\n      const toolbarButton = event.target.closest('[data-template-button]');\n      \n      if (!dropdown && !toolbarButton) {\n        setIsTemplateDropdownOpen(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [isTemplateDropdownOpen]);\n\n  // Section click handler - umouje scrollovn i k zamenm sekcm pro ten\n  const handleSectionClick = useCallback((section) => {\n    if (onSectionClick) {\n      onSectionClick(section.id);\n    }\n  }, [onSectionClick]);\n\n  //  Mapovn validanch kl na sekce navigtoru\n  const FIELD_TO_SECTION = {\n    // Sekce: Objednatel (informace o objednateli)\n    jmeno: 'objednatel',\n    prijmeni: 'objednatel',\n    email: 'objednatel',\n    telefon: 'objednatel',\n    \n    // Sekce: Schvlen nkupu PO\n    schvalovatel_id: 'schvaleni',\n    prikazce_id: 'schvaleni',\n    garant_uzivatel_id: 'schvaleni',\n    strediska_kod: 'schvaleni',\n    zpusob_financovani: 'schvaleni',\n    lp_kod: 'schvaleni',\n    cislo_smlouvy: 'schvaleni',\n    smlouva_poznamka: 'schvaleni',\n    individualni_schvaleni: 'schvaleni',\n    individualni_poznamka: 'schvaleni',\n    pojistna_udalost_cislo: 'schvaleni',\n    pojistna_udalost_poznamka: 'schvaleni',\n    schvaleni_komentar: 'schvaleni',\n    \n    // Sekce: Dodavatel\n    dodavatel_ico: 'dodavatel',\n    dodavatel_nazev: 'dodavatel',\n    dodavatel_adresa: 'dodavatel',\n    dodavatel_kontakt: 'dodavatel',\n    ico: 'dodavatel',\n    nazev: 'dodavatel',\n    ulice: 'dodavatel',\n    psc: 'dodavatel',\n    obec: 'dodavatel',\n    \n    // Sekce: Detaily objednvky\n    predmet: 'detaily',\n    nazev_objednavky: 'detaily',\n    max_cena_s_dph: 'detaily',\n    celkova_cena: 'detaily',\n    druh_objednavky_kod: 'detaily',\n    polozky_objednavky: 'detaily',\n    // Poloky objednvky (pattern match)\n    // polozka_N_popis, polozka_N_cena_bez_dph, polozka_N_cena_s_dph atd.\n    \n    // Sekce: Dodac a zrun podmnky\n    dodaci_termin: 'dodaci_podminky',\n    misto_dodani: 'dodaci_podminky',\n    zarucni_doba: 'dodaci_podminky',\n    zaruka_poznamka: 'dodaci_podminky',\n    \n    // Sekce: Plohy k objednvce\n    // (nem validan pole, jen vizuln zobrazen)\n    \n    // Sekce: Stav odesln objednvky\n    datum_odeslani: 'stav_odeslani',\n    odeslani_storno_duvod: 'stav_odeslani',\n    \n    // Sekce: Potvrzen objednvky\n    dodavatel_zpusob_potvrzeni: 'potvrzeni_objednavky',\n    zpusob_platby: 'potvrzeni_objednavky',\n    dt_akceptace: 'potvrzeni_objednavky',\n    \n    // Sekce: Registr smluv\n    ma_byt_zverejnena: 'registr_smluv',\n    \n    // Sekce: Potvrzen zveejnn (registr_smluv_vyplneni)\n    dt_zverejneni: 'registr_smluv_vyplneni',\n    registr_iddt: 'registr_smluv_vyplneni',\n    \n    // Sekce: Fakturace\n    // faktura_N_cislo, faktura_N_castka, faktura_N_dorucena, faktura_N_splatnost atd.\n    \n    // Sekce: Vcn sprvnost\n    // faktura_N_vecna_spravnost, faktura_N_poznamka_vs atd.\n  };\n\n  // Count fields for section - pot chyby validace + nevyplnn povinn pole\n  const getSectionValidationInfo = useCallback((section) => {\n    // Pouij centralizovanou kategorizaci chyb\n    const sectionErrors = Object.keys(validationErrors).filter(key => {\n      const category = categorizeErrorKey(key);\n      const matches = category === section.id;\n      return matches;\n    });\n\n    const errorCount = sectionErrors.length;\n\n    //  Spotat nevyplnn povinn pole (jen pokud NEJSOU validan chyby)\n    // Toto slou k zobrazen \"oranov teky\" ped pokusem o uloen\n    let missingCount = 0;\n    \n    // Speciln logika pro sekci vcn sprvnosti - kontrola checkbox u faktur\n    if (errorCount === 0 && section.id === 'vecna_spravnost' && formData.faktury && formData.faktury.length > 0) {\n      // Zkontroluj kadou fakturu, zda m potvrzenou vcnou sprvnost\n      formData.faktury.forEach((faktura) => {\n        if (faktura.potvrzeni_vecne_spravnosti !== 1 && faktura.potvrzeni_vecne_spravnosti !== true) {\n          missingCount++;\n        }\n        \n        // Pokud faktura pekrauje max cenu, kontroluj i poznmku\n        const maxCena = parseFloat(formData.max_cena_s_dph) || 0;\n        const fakturaCastka = parseFloat(faktura.fa_castka) || 0;\n        if (fakturaCastka > maxCena && (!faktura.vecna_spravnost_poznamka || faktura.vecna_spravnost_poznamka.trim() === '')) {\n          missingCount++;\n        }\n      });\n    }\n    // Bn logika pro ostatn sekce\n    else if (errorCount === 0 && section.required && section.required.length > 0) {\n      section.required.forEach(fieldName => {\n        const value = formData[fieldName];\n        \n        // Kontrola, zda je pole przdn\n        const isEmpty = !value || \n          (typeof value === 'string' && value.trim() === '') ||\n          (Array.isArray(value) && value.length === 0);\n        \n        if (isEmpty) {\n          missingCount++;\n        }\n      });\n    }\n\n    return {\n      missingCount: missingCount,\n      errorCount: errorCount,\n      totalRequired: section.required?.length || 0\n    };\n  }, [validationErrors, formData]);\n\n  //  Kontrola viditelnosti a enabled stavu podle WorkflowManager\n  const isSectionVisibleAndEnabled = useCallback((sectionId) => {\n    const sectionState = allSectionStates[sectionId];\n    if (!sectionState) return { visible: true, enabled: true }; // fallback\n\n    //  Pouvat section states pmo z WorkflowManager (pes allSectionStates)\n    // Vechny podmnky viditelnosti jsou u vyeen v OrderForm25 (extendedSectionStates)\n    return {\n      visible: sectionState.visible !== false, // sekce je viditeln\n      enabled: sectionState.enabled !== false  // sekce je enabled (ne disabled)\n    };\n  }, [allSectionStates]);\n\n  // Render section icon\n  const renderSectionIcon = (section) => {\n    if (section.iconType === 'lucide') {\n      const IconComponent = section.icon;\n      return <IconComponent />;\n    }\n    return <FontAwesomeIcon icon={section.icon} />;\n  };\n\n  const navigatorContent = (\n    <NavigatorContainer\n      ref={containerRef}\n      $position={position}\n      $isMinimized={isMinimized}\n      $isCompact={isCompact}\n      $isDragging={isDragging}\n      $isFullscreen={isFullscreen}\n    >\n      <NavigatorHeader\n        $isMinimized={isMinimized}\n        onMouseDown={handleMouseDown}\n      >\n        {isMinimized ? (\n          <MinimizedText>NAVIGATOR</MinimizedText>\n        ) : (\n          <>\n            <NavigatorTitle>\n              <Menu />\n              Navigace\n            </NavigatorTitle>\n            <HeaderControls>\n              <IconButton\n                onClick={toggleCompact}\n                title={isCompact ? \"Zobrazit vechny sekce\" : \"Zobrazit jen Plohy + Dropzone\"}\n              >\n                {isCompact ? <Maximize2 /> : <Minimize2 />}\n              </IconButton>\n              <IconButton onClick={toggleMinimized} title=\"Minimalizovat (schovat na levou stranu)\">\n                <ChevronLeft />\n              </IconButton>\n            </HeaderControls>\n          </>\n        )}\n      </NavigatorHeader>\n\n      {/*  TOOLBAR: Akce pro prci s objednvkou */}\n      {!isMinimized && (\n        <ToolbarSection>\n          <ToolbarButtons>\n            <ToolbarButton\n              data-template-button\n              onClick={handleToggleTemplateDropdown}\n              title={canFillTemplate ? \"Nast ablonu objednvky\" : \"Natn ablon nen k dispozici - objednvka je dokonena nebo m neuloen zmny\"}\n              disabled={!canFillTemplate}\n            >\n              <FontAwesomeIcon icon={faBookmark} />\n            </ToolbarButton>\n            {onSaveAsTemplate && (\n              <ToolbarButton\n                $withPlus\n                onClick={onSaveAsTemplate}\n                title=\"Uloit aktuln formul jako ablonu\"\n                disabled={!canSaveTemplate}\n              >\n                <FontAwesomeIcon icon={faBookmark} />\n              </ToolbarButton>\n            )}\n            {onGenerateDocx && (\n              <ToolbarButton\n                onClick={onGenerateDocx}\n                title=\"Generovat DOCX ze ablony\"\n                disabled={!canGenerateDocx}\n              >\n                <FileDown size={16} />\n              </ToolbarButton>\n            )}\n            {onToggleSections && (\n              <ToolbarButton\n                onClick={onToggleSections}\n                title={areSectionsCollapsed ? \"Rozbalit vechny sekce\" : \"Sbalit zamen sekce\"}\n              >\n                {areSectionsCollapsed ? <ChevronDown size={16} /> : <Minus size={16} />}\n              </ToolbarButton>\n            )}\n            {onToggleFullscreen && (\n              <ToolbarButton\n                onClick={onToggleFullscreen}\n                title={isFullscreen ? \"Ukonit fullscreen reim\" : \"Pepnout do fullscreen reimu\"}\n              >\n                <FontAwesomeIcon icon={isFullscreen ? faCompress : faExpand} />\n              </ToolbarButton>\n            )}\n          </ToolbarButtons>\n          \n          {/*  Dropdown se ablonami - zobraz se pod ikonami */}\n          <div data-template-dropdown style={{ position: 'relative' }}>\n            <TemplateDropdown\n              show={isTemplateDropdownOpen}\n              serverTemplates={serverTemplates}\n              savedTemplates={savedTemplates}\n              templatesLoading={templatesLoading}\n              searchQuery={searchQuery}\n              showSearch={showSearch}\n              currentPhase={currentPhase}\n              isArchived={isArchived}\n              token={token}\n              hasPermission={hasPermission}\n              onSearch={onTemplateSearch}\n              onToggleSearch={onToggleTemplateSearch}\n              onRefresh={onRefreshTemplates}\n              onFillPo={onFillPoApproval}\n              onFillDetails={onFillDetails}\n              canFillTemplate={canFillTemplate}\n              onCopyToUser={onCopyTemplateToUser}\n              onCopyToGlobal={onCopyTemplateToGlobal}\n              onShowPreview={onShowTemplatePreview}\n              onDelete={onDeleteTemplate}\n              onEditName={onEditTemplateName}\n              editingTemplateId={editingTemplateId}\n              editingTemplateName={editingTemplateName}\n              matchesQuery={matchesTemplateQuery}\n            />\n          </div>\n        </ToolbarSection>\n      )}\n\n      {/* Tlatko pro rozbalen kdy je minimalizovan */}\n      {isMinimized && (\n        <MinimizedExpandButton\n          onClick={toggleMinimized}\n          title=\"Rozbalit navigtor\"\n        >\n          <ChevronRight />\n        </MinimizedExpandButton>\n      )}\n\n      {!isMinimized && (\n        <NavigatorContent\n          ref={contentRef}\n          $isMinimized={isMinimized}\n          onScroll={saveScrollPosition}\n        >\n          {/*  ST 1: Vechny poloky menu z FORM_SECTIONS */}\n          {FORM_SECTIONS.map((section) => {\n            //  SKIP \"prilohy\" - renderuje se samostatn pod dropzone\n            if (section.id === 'prilohy') return null;\n\n            //  V kompaktnm reimu SKRT vechny bn sekce\n            if (isCompact) return null;\n\n            //  Kontrola viditelnosti podle WorkflowManager\n            const { visible, enabled } = isSectionVisibleAndEnabled(section.id);\n\n            // Pokud sekce nen viditeln, neukzat ji\n            if (!visible) return null;\n\n            const isDisabled = !enabled; //  Disabled podle WorkflowManager\n            const isActive = isSectionActive ? isSectionActive(section.id) : false;\n            const validationInfo = getSectionValidationInfo(section);\n            \n            //  Zobrazen badge podle stavu:\n            // 1. erven koleko s slem = jsou chyby po validaci\n            // 2. Oranov teka = jsou nevyplnn povinn pole (jen kdy nen aktivn validace)\n            // 3. dn badge = ve OK\n            const hasErrors = validationInfo.errorCount > 0;\n            const hasMissingFields = !hasErrors && validationInfo.missingCount > 0;\n            const showBadge = hasErrors || hasMissingFields;\n\n            return (\n              <SectionItem\n                key={section.id}\n                $isDisabled={isDisabled}\n                $isActive={isActive}\n                $color={section.color}\n                $bgColor={section.bgColor}\n                $borderColor={section.borderColor}\n                $isMinimized={isMinimized}\n                onClick={() => handleSectionClick(section)}\n                title={isDisabled ? `${section.name} (zameno - kliknutm zobrazte vyplnn data)` : section.name}\n              >\n                <SectionItemContent $isMinimized={isMinimized}>\n                  <SectionIcon $color={section.color} $isDisabled={isDisabled}>\n                    {renderSectionIcon(section)}\n                  </SectionIcon>\n                  {!isMinimized && (\n                    <SectionInfo $textColor={isDisabled ? '#64748b' : section.color}>\n                      <SectionName $isDisabled={isDisabled}>\n                        {section.name}\n                        {showBadge && (\n                          <ValidationBadge \n                            $hasErrors={hasErrors}\n                            $hasMissingFields={hasMissingFields}\n                          >\n                            {hasErrors ? validationInfo.errorCount : ''}\n                          </ValidationBadge>\n                        )}\n                      </SectionName>\n                    </SectionInfo>\n                  )}\n                </SectionItemContent>\n              </SectionItem>\n            );\n          })}\n        </NavigatorContent>\n      )}\n\n      {/*  DROPZONE - JEN kdy m objednvka ID (je uloen) */}\n      {!isMinimized && formData.id && (() => {\n        //  Pout stejnou logiku jako pro sekci Plohy\n        const sectionState = allSectionStates?.prilohy;\n        const isDropzoneDisabled = sectionState ? !sectionState.enabled : isWorkflowCompleted;\n        \n        return (\n        <DropzoneContainer\n          $isDragOver={isDragOver}\n          $isMinimized={isMinimized}\n          $isDisabled={isDropzoneDisabled}\n          onDragEnter={handleDragEnter}\n          onDragLeave={handleDragLeave}\n          onDragOver={handleDragOver}\n          onDrop={handleDrop}\n          onClick={handleDropzoneClick}\n        >\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            multiple\n            style={{ display: 'none' }}\n            onChange={handleFileSelect}\n          />\n          <DropzoneIcon \n            $isDragOver={isDragOver} \n            $isMinimized={isMinimized}\n            $isDisabled={isDropzoneDisabled}\n          >\n            <Upload />\n          </DropzoneIcon>\n          <DropzoneText \n            $isDragOver={isDragOver} \n            $isMinimized={isMinimized}\n            $isDisabled={isDropzoneDisabled}\n          >\n            {isDragOver ? 'Puste soubory zde' : 'Pethnte soubory'}\n          </DropzoneText>\n        </DropzoneContainer>\n        );\n      })()}\n\n      {/*  INFORMAN BANNER - kdy je dropzone vypnut kvli zamen objednvce */}\n      {!isMinimized && formData.id && (() => {\n        const sectionState = allSectionStates?.prilohy;\n        const isDropzoneDisabled = sectionState ? !sectionState.enabled : isWorkflowCompleted;\n        return isDropzoneDisabled && (\n        <div style={{\n          margin: '12px 8px',\n          padding: '16px',\n          background: 'linear-gradient(135deg, rgba(229, 229, 229, 0.95) 0%, rgba(209, 213, 219, 0.95) 100%)',\n          border: '2px solid #9ca3af',\n          borderRadius: '8px',\n          textAlign: 'center',\n          color: '#4b5563',\n          fontSize: '13px',\n          fontWeight: '600',\n          lineHeight: '1.4'\n        }}>\n          <div style={{ marginBottom: '4px' }}> Objednvka zamena</div>\n          <div style={{ fontSize: '11px', fontWeight: '400' }}>\n            Plohy jsou uzamen\n          </div>\n        </div>\n        );\n      })()}\n\n      {/*  ST 3: Sekce \"Plohy k objednvce\" POD dropzone - JEN kdy m objednvka ID */}\n      {!isMinimized && formData.id && (() => {\n        //  Samostatn sekce \"Plohy k objednvce\" (nen v FORM_SECTIONS ani SECTION_DEFINITIONS)\n        const section = {\n          id: 'prilohy',\n          name: 'Plohy k objednvce',\n          icon: faClipboard,\n          color: '#991b1b',\n          bgColor: 'linear-gradient(135deg, rgba(254, 226, 226, 0.95) 0%, rgba(254, 202, 202, 0.95) 100%)',\n          borderColor: '#dc2626'\n        };\n\n        //  Sekce Plohy je disabled, kdy je objednvka zamen (dokonena/zamtnuta/zruena) - CENTRLN ZEN\n        //  DLEIT: Pout allSectionStates pokud je dostupn (pichz z OrderForm25.js s isPrilohyLocked)\n        const sectionState = allSectionStates?.prilohy;\n        const isDisabled = sectionState ? !sectionState.enabled : isWorkflowCompleted;\n        const isActive = isSectionActive ? isSectionActive(section.id) : false;\n        \n        //  Zskn info o plohch ze sectionState\n        const attachmentsCount = sectionState?.attachmentsCount || 0;\n        const hasAttachmentErrors = sectionState?.hasAttachmentErrors || false;\n        \n        //  Zobrazen badge pro plohy\n        const showAttachmentsBadge = attachmentsCount > 0;\n        const badgeText = attachmentsCount.toString();\n\n        return (\n          <NavigatorContent $isMinimized={isMinimized}>\n            <SectionItem\n              $isDisabled={isDisabled}\n              $isActive={isActive}\n              $color={section.color}\n              $bgColor={section.bgColor}\n              $borderColor={section.borderColor}\n              $isMinimized={isMinimized}\n              onClick={() => handleSectionClick(section)}\n              title={isDisabled ? `${section.name} (zameno - kliknutm zobrazte vyplnn data)` : section.name}\n            >\n              <SectionItemContent $isMinimized={isMinimized}>\n                <SectionIcon $color={section.color} $isDisabled={isDisabled}>\n                  <FontAwesomeIcon icon={section.icon} />\n                </SectionIcon>\n                {!isMinimized && (\n                  <SectionInfo $textColor={isDisabled ? '#64748b' : section.color}>\n                    <SectionName $isDisabled={isDisabled}>\n                      {section.name}\n                      {showAttachmentsBadge && (\n                        <AttachmentBadge $hasErrors={hasAttachmentErrors}>\n                          {badgeText}\n                        </AttachmentBadge>\n                      )}\n                    </SectionName>\n                  </SectionInfo>\n                )}\n              </SectionItemContent>\n            </SectionItem>\n          </NavigatorContent>\n        );\n      })()}\n    </NavigatorContainer>\n  );\n\n  // Pouit React Portal pro vykreslen mimo DOM hierarchii rodie\n  return typeof document !== 'undefined'\n    ? ReactDOM.createPortal(navigatorContent, document.body)\n    : navigatorContent;\n};\n\nexport default FloatingNavigator;\n","/**\n *  DATA TRANSFORM HELPERS\n *\n * Centrln msto pro transformace dat mezi Frontend  Backend\n * Specifikace: DATA-FORMAT-CONTRACT.md\n *\n * @author OrderForm25 Team\n * @date 2025-11-01\n */\n\n/**\n *  STEDISKA: Backend  Frontend\n *\n * Normalizuje stediska z BE do FE formtu\n *\n * @param {any} data - Raw data z backendu (me bt array, JSON string, objekty)\n * @returns {string[]} - Array kd stedisek UPPERCASE\n *\n * @example\n * // Backend posl array string (IDELN)\n * normalizeStrediskaFromBackend([\"KLADNO\", \"BENESOV\"])\n * //  [\"KLADNO\", \"BENESOV\"]\n *\n * @example\n * // Backend posl JSON string (DEPRECATED)\n * normalizeStrediskaFromBackend('[\"KLADNO\",\"BENESOV\"]')\n * //  [\"KLADNO\", \"BENESOV\"]\n *\n * @example\n * // Backend posl objekty (DEPRECATED)\n * normalizeStrediskaFromBackend([{kod_stavu: \"KLADNO\", nazev_stavu: \"Kladno\"}])\n * //  [\"KLADNO\"]\n */\nexport function normalizeStrediskaFromBackend(data) {\n  if (!data) return [];\n\n  //  IDELN: U je array string  vrtit UPPERCASE\n  if (Array.isArray(data) && data.every(item => typeof item === 'string')) {\n    return data.map(kod => String(kod).toUpperCase().trim()).filter(Boolean);\n  }\n\n  //  FALLBACK 1: JSON string  parsovat\n  if (typeof data === 'string') {\n    try {\n      const parsed = JSON.parse(data);\n      if (Array.isArray(parsed)) {\n        return parsed.map(item => {\n          if (typeof item === 'string') return item.toUpperCase().trim();\n          if (item?.kod_stavu) return String(item.kod_stavu).toUpperCase().trim();\n          if (item?.kod) return String(item.kod).toUpperCase().trim();\n          return String(item).toUpperCase().trim();\n        }).filter(Boolean);\n      }\n    } catch (e) {\n      console.error(' [normalizeStrediskaFromBackend] Chyba parsovn JSON:', e, 'Data:', data);\n      return [];\n    }\n  }\n\n  //  FALLBACK 2: Array objekt  extrahovat kdy\n  if (Array.isArray(data) && data.some(item => typeof item === 'object' && item !== null)) {\n    return data.map(item => {\n      if (item?.kod_stavu) return String(item.kod_stavu).toUpperCase().trim();\n      if (item?.kod) return String(item.kod).toUpperCase().trim();\n      if (typeof item === 'string') return item.toUpperCase().trim();\n      return String(item).toUpperCase().trim();\n    }).filter(Boolean);\n  }\n\n  console.warn(' [normalizeStrediskaFromBackend] Neznm formt dat:', typeof data, data);\n  return [];\n}\n\n/**\n *  STEDISKA: Frontend  Backend\n *\n * Normalizuje stediska z FE do BE formtu\n *\n * @param {string[]} codes - Array kd stedisek z formData\n * @returns {string[]} - Array kd stedisek UPPERCASE (BE oekv pesn tento formt)\n *\n * @example\n * normalizeStrediskaForBackend([\"kladno\", \"benesov\"])\n * //  [\"KLADNO\", \"BENESOV\"]\n */\nexport function normalizeStrediskaForBackend(codes) {\n  if (!Array.isArray(codes)) return [];\n\n  return codes\n    .map(kod => String(kod).toUpperCase().trim())\n    .filter(Boolean);\n}\n\n/**\n *  FINANCOVN: Backend  Frontend\n *\n * Normalizuje financovn z BE do FE formtu (flat struktura pro formData)\n *\n * @param {any} data - Raw financovani objekt z backendu (me bt objekt nebo JSON string)\n * @returns {object} - Flat objekt pro formData\n *\n * @example\n * // Backend posl objekt (IDELN)\n * normalizeFinancovaniFromBackend({\n *   typ: \"LP\",\n *   lp_kody: [\"LP123\", \"LP456\"]\n * })\n * //  {\n * //   zpusob_financovani: \"LP\",\n * //   lp_kod: [\"LP123\", \"LP456\"],\n * //   cislo_smlouvy: \"\",\n * //   ...\n * // }\n *\n * @example\n * // Backend posl JSON string (FALLBACK)\n * normalizeFinancovaniFromBackend('{\"typ\":\"LP\",\"lp_kody\":[\"LP123\"]}')\n * //  { zpusob_financovani: \"LP\", lp_kod: [\"LP123\"], ... }\n *\n * @example\n * // Backend posl star formt (DEPRECATED)\n * normalizeFinancovaniFromBackend({\n *   kod_stavu: \"LP\",\n *   nazev_stavu: \"Limitovan pslib\",\n *   doplnujici_data: { lp_kod: [\"LP123\"] }\n * })\n * //  { zpusob_financovani: \"LP\", lp_kod: [\"LP123\"], ... }\n */\nexport function normalizeFinancovaniFromBackend(data) {\n  if (!data) {\n    return {};\n  }\n\n  let financing = data;\n\n  //  FALLBACK: JSON string  parsovat\n  if (typeof data === 'string') {\n    try {\n      financing = JSON.parse(data);\n    } catch (e) {\n      console.error(' [normalizeFinancovaniFromBackend] Chyba parsovn JSON:', e, 'Data:', data);\n      return {};\n    }\n  }\n\n  //  FORMT Z DB: {typ, lp_kody?, cislo_smlouvy?, individualni_schvaleni?, pojistna_udalost_cislo?}\n  const result = {\n    zpusob_financovani: financing.typ || financing.kod_stavu || financing.zdroj || ''\n  };\n\n  // LP kdy\n  if (financing.lp_kody) result.lp_kod = financing.lp_kody;\n  else if (financing.lp_kod) result.lp_kod = financing.lp_kod;\n\n  // SMLOUVA pole\n  if (financing.cislo_smlouvy) result.cislo_smlouvy = financing.cislo_smlouvy;\n  if (financing.smlouva_poznamka) result.smlouva_poznamka = financing.smlouva_poznamka;\n\n  // INDIVIDULN pole\n  if (financing.individualni_schvaleni) result.individualni_schvaleni = financing.individualni_schvaleni;\n  if (financing.individualni_poznamka) result.individualni_poznamka = financing.individualni_poznamka;\n\n  // POJISTN UDLOST pole\n  if (financing.pojistna_udalost_cislo) result.pojistna_udalost_cislo = financing.pojistna_udalost_cislo;\n  if (financing.pojistna_udalost_poznamka) result.pojistna_udalost_poznamka = financing.pojistna_udalost_poznamka;\n\n  //  FALLBACK: STAR FORMT s doplnujici_data (pro zptnou kompatibilitu)\n  if (financing.doplnujici_data) {\n    const data = financing.doplnujici_data;\n    if (data.lp_kod && !result.lp_kod) result.lp_kod = data.lp_kod;\n    if (data.lp_kody && !result.lp_kod) result.lp_kod = data.lp_kody;\n    if (data.cislo_smlouvy && !result.cislo_smlouvy) result.cislo_smlouvy = data.cislo_smlouvy;\n    if (data.smlouva_poznamka && !result.smlouva_poznamka) result.smlouva_poznamka = data.smlouva_poznamka;\n    if (data.individualni_schvaleni && !result.individualni_schvaleni) result.individualni_schvaleni = data.individualni_schvaleni;\n    if (data.individualni_poznamka && !result.individualni_poznamka) result.individualni_poznamka = data.individualni_poznamka;\n    if (data.pojistna_udalost_cislo && !result.pojistna_udalost_cislo) result.pojistna_udalost_cislo = data.pojistna_udalost_cislo;\n    if (data.pojistna_udalost_poznamka && !result.pojistna_udalost_poznamka) result.pojistna_udalost_poznamka = data.pojistna_udalost_poznamka;\n  }\n\n  return result;\n}\n\n/**\n *  FINANCOVN: Frontend  Backend\n *\n * Normalizuje financovn z FE do BE formtu (vnoen struktura)\n *\n * @param {object} formData - Frontend form data\n * @param {array} financovaniOptions - Seznam dostupnch zdroj financovn (pro dohledn nzvu)\n * @returns {object|null} - Objekt pro backend API nebo null pokud nen vyplnno\n *\n * @example\n * normalizeFinancovaniForBackend({\n *   zpusob_financovani: \"LP\",\n *   lp_kod: [\"LP123\", \"LP456\"],\n *   cislo_smlouvy: \"\",\n *   ...\n * }, financovaniOptions)\n * //  {\n * //   typ: \"LP\",\n * //   nazev: \"Limitovan pslib\",\n * //   nazev_stavu: \"Limitovan pslib\",\n * //   kod_stavu: \"LP\",\n * //   lp_kody: [\"LP123\", \"LP456\"]\n * // }\n */\nexport function normalizeFinancovaniForBackend(formData, financovaniOptions = []) {\n  if (!formData || !formData.zpusob_financovani) {\n    return null;\n  }\n\n  //  Najt nzev v financovaniOptions pro backend validaci\n  const selectedOption = financovaniOptions.find(opt => \n    opt.kod === formData.zpusob_financovani ||\n    opt.kod_stavu === formData.zpusob_financovani ||\n    opt.value === formData.zpusob_financovani\n  );\n\n  const result = {\n    typ: formData.zpusob_financovani,\n    nazev: selectedOption?.nazev || selectedOption?.nazev_stavu || selectedOption?.label || formData.zpusob_financovani,\n    nazev_stavu: selectedOption?.nazev_stavu || selectedOption?.nazev || selectedOption?.label || formData.zpusob_financovani\n  };\n\n  //  KRITICK: Poslat POUZE pole odpovdajc vybranmu typu!\n  const typ = formData.zpusob_financovani;\n  \n  // LP: poslat POUZE lp_kody\n  if (typ === 'LP') {\n    if (formData.lp_kod && Array.isArray(formData.lp_kod) && formData.lp_kod.length > 0) {\n      // Backend oekv array sel: [3, 5], NE [\"3\", \"5\"]\n      result.lp_kody = formData.lp_kod.map(id => parseInt(id, 10));\n    }\n  }\n  // SMLOUVA: poslat POUZE cislo_smlouvy a smlouva_poznamka\n  else if (typ === 'SMLOUVA') {\n    if (formData.cislo_smlouvy) {\n      result.cislo_smlouvy = formData.cislo_smlouvy;\n    }\n    if (formData.smlouva_poznamka) {\n      result.smlouva_poznamka = formData.smlouva_poznamka;\n    }\n  }\n  // INDIVIDUALNI_SCHVALENI: poslat POUZE individualni_schvaleni a poznamka\n  else if (typ === 'INDIVIDUALNI_SCHVALENI' || typ === 'INDIVIDULN' || typ === 'INDIVIDUALNI') {\n    if (formData.individualni_schvaleni) {\n      result.individualni_schvaleni = formData.individualni_schvaleni;\n    }\n    if (formData.individualni_poznamka) {\n      result.individualni_poznamka = formData.individualni_poznamka;\n    }\n  }\n  // POJISTNA_UDALOST: poslat POUZE pojistna_udalost_cislo a poznamka\n  else if (typ === 'POJISTNA_UDALOST' || typ === 'POJISTN UDLOST' || typ === 'POJISTNA UDALOST') {\n    if (formData.pojistna_udalost_cislo) {\n      result.pojistna_udalost_cislo = formData.pojistna_udalost_cislo;\n    }\n    if (formData.pojistna_udalost_poznamka) {\n      result.pojistna_udalost_poznamka = formData.pojistna_udalost_poznamka;\n    }\n  }\n\n  return result;\n}\n\n/**\n *  FAKTURY STEDISKA: Backend  Frontend\n *\n * Alias pro normalizeStrediskaFromBackend (stejn logika pro fa_strediska_kod)\n *\n * @param {any} data - Raw fa_strediska_kod z backendu\n * @returns {string[]} - Array kd stedisek UPPERCASE\n */\nexport function normalizeFakturaStrediskaFromBackend(data) {\n  return normalizeStrediskaFromBackend(data);\n}\n\n/**\n *  FAKTURY STEDISKA: Frontend  Backend\n *\n * Alias pro normalizeStrediskaForBackend (stejn logika pro fa_strediska_kod)\n *\n * @param {string[]} codes - Array kd stedisek\n * @returns {string[]} - Array kd stedisek UPPERCASE\n */\nexport function normalizeFakturaStrediskaForBackend(codes) {\n  return normalizeStrediskaForBackend(codes);\n}\n\n/**\n *  TEST HELPER: Validuje, zda data odpovdaj oekvanmu formtu\n *\n * @param {any} data - Data k validaci\n * @param {string} type - Typ dat ('strediska' | 'financovani')\n * @returns {boolean} - True pokud data odpovdaj formtu\n */\nexport function validateDataFormat(data, type) {\n  switch (type) {\n    case 'strediska':\n      return Array.isArray(data) && data.every(item => typeof item === 'string');\n\n    case 'financovani':\n      return (\n        data &&\n        typeof data === 'object' &&\n        typeof data.typ === 'string' &&\n        !data.kod_stavu && // Star formt\n        !data.nazev_stavu && // Star formt\n        !data.doplnujici_data // Star formt\n      );\n\n    default:\n      return false;\n  }\n}\n\n/**\n *  DEBUG HELPER: Loguje formt dat pro debugging\n *\n * @param {any} data - Data k analze\n * @param {string} label - Label pro log\n */\nexport function debugDataFormat(data, label = 'Data') {\n  console.log(` [DEBUG] ${label}:`, {\n    type: typeof data,\n    isArray: Array.isArray(data),\n    isString: typeof data === 'string',\n    isObject: typeof data === 'object' && !Array.isArray(data),\n    value: data,\n    keys: typeof data === 'object' ? Object.keys(data) : undefined\n  });\n}\n","/**\n * FormDataManager - Centralizovan manaer pro inicializaci a sprvu dat formule\n *\n * e problmy:\n * - Asynchronn natn selnk\n * - Synchronizaci s React state\n * - Race conditions pi inicializaci\n * - Sprvn poad natn dat\n *\n * @author Robert Holovsk\n * @date 2025-10-28\n */\n\nimport {\n  fetchAllUsers,\n  fetchApprovers,\n  fetchLimitovanePrisliby\n} from './api2auth';\n\nimport {\n  getStrediska25,\n  getFinancovaniZdroj25,\n  getDruhyObjednavky25\n} from './api25orders';\n\n//  NOV: Import V2 API pro natn objednvek\nimport { getOrderV2 } from './apiOrderV2';\n\n//  KRITICK: Import transformanch utilit pro sprvn mapovn dat\nimport {\n  normalizeFinancovaniFromBackend,\n  normalizeStrediskaFromBackend\n} from '../utils/dataTransformHelpers';\n\nclass FormDataManager {\n  constructor() {\n    this.isInitialized = false;\n    this.isInitializing = false;\n    this.initPromise = null;\n\n    // Cache pro naten data\n    this.cache = {\n      users: [],\n      approvers: [],\n      strediska: [],\n      financovani: [],\n      druhyObjednavky: [],\n      lpKody: []\n    };\n\n    // Metadata o stavu\n    this.metadata = {\n      lastInitTime: null,\n      initDuration: null,\n      errors: []\n    };\n\n    // Callbacks pro state update (nastav React komponenta)\n    this.stateCallbacks = {};\n  }\n\n  /**\n   * Registrace callback funkc pro update React state\n   */\n  registerStateCallbacks(callbacks) {\n    this.stateCallbacks = {\n      setAllUsers: callbacks.setAllUsers || (() => {}),\n      setApprovers: callbacks.setApprovers || (() => {}),\n      setStrediskaOptions: callbacks.setStrediskaOptions || (() => {}),\n      setFinancovaniOptions: callbacks.setFinancovaniOptions || (() => {}),\n      setDruhyObjednavkyOptions: callbacks.setDruhyObjednavkyOptions || (() => {}),\n      setLpKodyOptions: callbacks.setLpKodyOptions || (() => {}),\n      setLoadingUsers: callbacks.setLoadingUsers || (() => {}),\n      setLoadingApprovers: callbacks.setLoadingApprovers || (() => {}),\n      setLoadingStrediska: callbacks.setLoadingStrediska || (() => {}),\n      setLoadingFinancovani: callbacks.setLoadingFinancovani || (() => {}),\n      setLoadingDruhyObjednavky: callbacks.setLoadingDruhyObjednavky || (() => {}),\n      setLoadingLpKody: callbacks.setLoadingLpKody || (() => {})\n    };\n  }\n\n  /**\n   * Hlavn inicializan metoda - vol se pouze jednou\n   */\n  async initialize({ token, username, formDataId = null }) {\n    // Pokud u b inicializace, vra stejn Promise\n    if (this.isInitializing) {\n      //  KRITICK: I kdy ekme, musme aktualizovat React state z cache!\n      await this.initPromise;\n      this._updateReactState();\n      return this.cache;\n    }\n\n    // Pokud u je inicializovno, vra cached data\n    if (this.isInitialized) {\n      //  KRITICK: Aktualizuj React state i kdy vracme cache!\n      this._updateReactState();\n      return this.cache;\n    }\n\n    this.isInitializing = true;\n    const startTime = Date.now();\n\n    this.initPromise = this._performInitialization({ token, username, formDataId });\n\n    try {\n      await this.initPromise;\n\n      const duration = Date.now() - startTime;\n      this.metadata.lastInitTime = new Date();\n      this.metadata.initDuration = duration;\n      this.isInitialized = true;\n\n      return this.cache;\n\n    } catch (error) {\n      this.metadata.errors.push({\n        timestamp: new Date(),\n        error: error.message\n      });\n      throw error;\n    } finally {\n      this.isInitializing = false;\n    }\n  }\n\n  /**\n   * Intern metoda pro paraleln naten vech dat\n   */\n  async _performInitialization({ token, username, formDataId }) {\n    const isLoadingFromDB = !!formDataId;\n\n    // Nast vechna data paraleln\n    const [\n      usersResult,\n      approversResult,\n      strediskaResult,\n      financovaniResult,\n      druhyObjednavkyResult,\n      lpKodyResult\n    ] = await Promise.allSettled([\n      this._loadUsers(token, username, isLoadingFromDB),\n      this._loadApprovers(token, username),\n      this._loadStrediska(token, username),\n      this._loadFinancovani(token, username),\n      this._loadDruhyObjednavky(token, username),\n      this._loadLpKody(token, username)\n    ]);\n\n    // Kontrola vsledk\n    const results = {\n      users: this._handleResult(usersResult, 'Uivatel'),\n      approvers: this._handleResult(approversResult, 'Schvalovatel'),\n      strediska: this._handleResult(strediskaResult, 'Stediska'),\n      financovani: this._handleResult(financovaniResult, 'Financovn'),\n      druhyObjednavky: this._handleResult(druhyObjednavkyResult, 'Druhy objednvky'),\n      lpKody: this._handleResult(lpKodyResult, 'LP kdy')\n    };\n\n    // Aktualizuj cache\n    this.cache = {\n      users: results.users.data,\n      approvers: results.approvers.data,\n      strediska: results.strediska.data,\n      financovani: results.financovani.data,\n      druhyObjednavky: results.druhyObjednavky.data,\n      lpKody: results.lpKody.data\n    };\n\n    // Aktualizuj React state synchronn\n    this._updateReactState();\n\n    // Kontrola chyb\n    const errors = Object.entries(results)\n      .filter(([_, result]) => !result.success)\n      .map(([key]) => key);\n\n    if (errors.length > 0) {\n    }\n\n    return this.cache;\n  }\n\n  /**\n   * Naten uivatel\n   */\n  async _loadUsers(token, username, isLoadingFromDB) {\n    this.stateCallbacks.setLoadingUsers?.(true);\n\n    try {\n      const users = await fetchAllUsers({ token, username });\n\n      // Filtrovn podle reimu\n      const filtered = isLoadingFromDB\n        ? users || []\n        : (users || []).filter(user => user.aktivni === 1 || user.aktivni === '1');\n\n      return filtered;\n\n    } catch (error) {\n      return [];\n    } finally {\n      this.stateCallbacks.setLoadingUsers?.(false);\n    }\n  }\n\n  /**\n   * Naten schvalovatel\n   */\n  async _loadApprovers(token, username) {\n    this.stateCallbacks.setLoadingApprovers?.(true);\n\n    try {\n      const approvers = await fetchApprovers({ token, username });\n\n      // Filtrovat aktivn\n      const active = (approvers || []).filter(a => {\n        if (a.aktivni === undefined || a.aktivni === null) return true;\n        return a.aktivni === 1 || a.aktivni === '1';\n      });\n\n      // Zpracovat jmna\n      const processed = active.map(approver => {\n        const titul_pred_str = approver.titul_pred ? approver.titul_pred + ' ' : '';\n        const jmeno_str = approver.jmeno || '';\n        const prijmeni_str = approver.prijmeni || '';\n        const titul_za_str = approver.titul_za ? ', ' + approver.titul_za : '';\n        const displayName = `${titul_pred_str}${jmeno_str} ${prijmeni_str}${titul_za_str}`.replace(/\\s+/g, ' ').trim() || approver.username || `User ${approver.id || approver.user_id}`;\n\n        return {\n          ...approver,\n          displayName,\n          label: displayName,\n          value: approver.id || approver.user_id\n        };\n      });\n\n      return processed;\n\n    } catch (error) {\n      return [];\n    } finally {\n      this.stateCallbacks.setLoadingApprovers?.(false);\n    }\n  }\n\n  /**\n   * Naten stedisek\n   */\n  async _loadStrediska(token, username) {\n    this.stateCallbacks.setLoadingStrediska?.(true);\n\n    try {\n      const strediska = await getStrediska25({ token, username });\n      return strediska || [];\n\n    } catch (error) {\n      return [];\n    } finally {\n      this.stateCallbacks.setLoadingStrediska?.(false);\n    }\n  }\n\n  /**\n   * Naten financovn\n   */\n  async _loadFinancovani(token, username) {\n    this.stateCallbacks.setLoadingFinancovani?.(true);\n\n    try {\n      const financovani = await getFinancovaniZdroj25({ token, username });\n      if (Array.isArray(financovani)) {\n        if (financovani.length > 0) {\n        }\n        return financovani;\n      } else {\n        return [];\n      }\n\n    } catch (error) {\n      return [];\n    } finally {\n      this.stateCallbacks.setLoadingFinancovani?.(false);\n    }\n  }\n\n  /**\n   * Naten druh objednvky\n   */\n  async _loadDruhyObjednavky(token, username) {\n    this.stateCallbacks.setLoadingDruhyObjednavky?.(true);\n\n    try {\n      const response = await getDruhyObjednavky25({ token, username });\n      //  OPRAVA: API nyn vrac pmo pole, ne objekt s options\n      const druhy = Array.isArray(response) ? response : [];\n      if (druhy.length > 0) {\n      }\n\n      return druhy;\n\n    } catch (error) {\n      return [];\n    } finally {\n      this.stateCallbacks.setLoadingDruhyObjednavky?.(false);\n    }\n  }\n\n  /**\n   * Naten LP kd\n   */\n  async _loadLpKody(token, username) {\n    this.stateCallbacks.setLoadingLpKody?.(true);\n\n    try {\n      const lpKody = await fetchLimitovanePrisliby({ token, username });\n      return lpKody || [];\n\n    } catch (error) {\n      return [];\n    } finally {\n      this.stateCallbacks.setLoadingLpKody?.(false);\n    }\n  }\n\n  /**\n   * Helper pro zpracovn Promise.allSettled vsledk\n   */\n  _handleResult(result, name) {\n    if (result.status === 'fulfilled' && result.value !== undefined && result.value !== null) {\n      return {\n        success: true,\n        data: result.value\n      };\n    } else {\n      return {\n        success: false,\n        data: []\n      };\n    }\n  }\n\n  /**\n   * Aktualizace React state - vol registrovan callbacks\n   *  OPTIMALIZACE: Vol setState JEN kdy se data skuten zmnila\n   */\n  _updateReactState() {\n    // Kontrola jestli se data zmnila ped volnm setState\n    if (this._hasDataChanged('users', this.cache.users)) {\n      this.stateCallbacks.setAllUsers?.(this.cache.users);\n    }\n    if (this._hasDataChanged('approvers', this.cache.approvers)) {\n      this.stateCallbacks.setApprovers?.(this.cache.approvers);\n    }\n    if (this._hasDataChanged('strediska', this.cache.strediska)) {\n      this.stateCallbacks.setStrediskaOptions?.(this.cache.strediska);\n    }\n    if (this._hasDataChanged('financovani', this.cache.financovani)) {\n      this.stateCallbacks.setFinancovaniOptions?.(this.cache.financovani);\n    }\n    if (this._hasDataChanged('druhyObjednavky', this.cache.druhyObjednavky)) {\n      this.stateCallbacks.setDruhyObjednavkyOptions?.(this.cache.druhyObjednavky);\n    }\n    if (this._hasDataChanged('lpKody', this.cache.lpKody)) {\n      this.stateCallbacks.setLpKodyOptions?.(this.cache.lpKody);\n    }\n  }\n\n  /**\n   * Pomocn metoda: Kontrola jestli se data zmnila\n   */\n  _hasDataChanged(key, newData) {\n    const prevKey = `_prev_${key}`;\n    const prevData = this[prevKey];\n\n    // Prvn voln - vdy true\n    if (!prevData) {\n      this[prevKey] = newData;\n      return true;\n    }\n\n    // Porovnn dlky pole\n    if (prevData.length !== newData.length) {\n      this[prevKey] = newData;\n      return true;\n    }\n\n    // Data se nezmnila\n    return false;\n  }\n\n  /**\n   * Naten objednvky\n   *  NOV: Pouv Order V2 API s enriched daty\n   */\n  async loadOrder({ token, username, orderId, archivovano = 0 }) {\n\n    try {\n\n      //  NOV: Pouvme V2 API s enriched daty\n      const order = await getOrderV2(orderId, token, username, true); // enriched = true\n\n\n      if (!order) {\n        throw new Error(`Objednvka ID ${orderId} nebyla nalezena`);\n      }\n\n      //  DEBUG: RAW DATA Z BACKENDU\n\n      //  KRITICK OPRAVA: Transformuj financovn z BE do FE formtu\n      if (order.financovani) {\n        const financing = normalizeFinancovaniFromBackend(order.financovani);\n        // Rozbal flat strukturu do order objektu\n        Object.assign(order, financing);\n      }\n\n      //  KRITICK OPRAVA: Transformuj stediska z BE do FE formtu\n      if (order.strediska_kod) {\n        order.strediska_kod = normalizeStrediskaFromBackend(order.strediska_kod);\n      }\n\n      return order;\n\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  /**\n   * Reset manageru (pro testing)\n   */\n  reset() {\n    this.isInitialized = false;\n    this.isInitializing = false;\n    this.initPromise = null;\n    this.cache = {\n      users: [],\n      approvers: [],\n      strediska: [],\n      financovani: [],\n      druhyObjednavky: [],\n      lpKody: []\n    };\n    this.metadata = {\n      lastInitTime: null,\n      initDuration: null,\n      errors: []\n    };\n  }\n\n  /**\n   * Zskn aktulnho stavu\n   */\n  getState() {\n    return {\n      isInitialized: this.isInitialized,\n      isInitializing: this.isInitializing,\n      cache: { ...this.cache },\n      metadata: { ...this.metadata }\n    };\n  }\n}\n\n// Singleton instance\nconst formDataManager = new FormDataManager();\n\nexport default formDataManager;\n","import { useRef, useCallback, useEffect } from 'react';\n\n/**\n * Centralizovan hook pro autosave s debounce logikou\n *\n * @param {Function} saveFunction - Funkce kter se zavol pro uloen\n * @param {Object} options - Konfigurace\n * @param {number} options.delay - Zpodn v ms ped uloenm (default: 3000)\n * @param {boolean} options.enabled - Zda je autosave povoleno (default: true)\n * @param {Array} options.dependencies - Zvislosti pro useCallback\n *\n * @returns {Object} - { triggerAutosave, cancelAutosave, isScheduled }\n */\nexport const useAutosave = (saveFunction, options = {}) => {\n  const {\n    delay = 3000,\n    enabled = true,\n    dependencies = []\n  } = options;\n\n  const timeoutRef = useRef(null);\n  const isScheduledRef = useRef(false);\n  const lastSaveTimeRef = useRef(0);\n  const MIN_INTERVAL = 1000; // Minimln interval mezi uloenmi (1s)\n\n  /**\n   * Zru naplnovan autosave\n   */\n  const cancelAutosave = useCallback(() => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n      timeoutRef.current = null;\n      isScheduledRef.current = false;\n    }\n  }, []);\n\n  /**\n   * Spust autosave s debounce\n   * @param {boolean} immediate - Pokud true, ulo okamit (pro selecty)\n   */\n  const triggerAutosave = useCallback((immediate = false) => {\n    if (!enabled) {\n      return;\n    }\n\n    // Zru pedchoz timeout\n    cancelAutosave();\n\n    const now = Date.now();\n    const timeSinceLastSave = now - lastSaveTimeRef.current;\n\n    // Pokud je immediate a od poslednho uloen uplynula minimln doba\n    if (immediate && timeSinceLastSave >= MIN_INTERVAL) {\n      lastSaveTimeRef.current = now;\n      saveFunction(true); // true = isAutoSave\n      return;\n    }\n\n    // Jinak nastav debounce timeout\n    isScheduledRef.current = true;\n    timeoutRef.current = setTimeout(() => {\n      const currentTime = Date.now();\n      const elapsed = currentTime - lastSaveTimeRef.current;\n\n      // Pouze pokud uplynula minimln doba\n      if (elapsed >= MIN_INTERVAL) {\n        lastSaveTimeRef.current = currentTime;\n        saveFunction(true); // true = isAutoSave\n      }\n\n      isScheduledRef.current = false;\n      timeoutRef.current = null;\n    }, immediate ? 0 : delay);\n  }, [enabled, delay, saveFunction, cancelAutosave, ...dependencies]);\n\n  /**\n   * Vyist timeout pi unmount\n   */\n  useEffect(() => {\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, []);\n\n  return {\n    triggerAutosave,\n    cancelAutosave,\n    isScheduled: () => isScheduledRef.current\n  };\n};\n\n/**\n * Hook pro input pole s automatickm debouncem\n * Vrac handleChange a handleBlur funkce\n *\n * @param {Function} onChange - Pvodn onChange handler\n * @param {Function} triggerAutosave - Funkce pro sputn autosave\n * @param {Object} options - Konfigurace\n * @param {boolean} options.saveOnBlur - Ukldat pi oputn pole (default: true)\n * @param {boolean} options.isSelectField - Je to select/checkbox? (default: false)\n *\n * @returns {Object} - { handleChange, handleBlur }\n */\nexport const useAutosaveField = (onChange, triggerAutosave, options = {}) => {\n  const {\n    saveOnBlur = true,\n    isSelectField = false\n  } = options;\n\n  const handleChange = useCallback((fieldOrEvent, value) => {\n    // Zavolej pvodn onChange\n    if (typeof fieldOrEvent === 'string') {\n      // handleInputChange(field, value)\n      onChange(fieldOrEvent, value);\n    } else {\n      // handleChange(event)\n      onChange(fieldOrEvent);\n    }\n\n    // Pro select/checkbox ulo okamit (s debouncem), pro text ekej na blur\n    if (isSelectField) {\n      triggerAutosave(true); // immediate = true\n    } else {\n      // Pro textov pole zatm nic - ekme na blur\n    }\n  }, [onChange, triggerAutosave, isSelectField]);\n\n  const handleBlur = useCallback((fieldName, value) => {\n    // Spus autosave pi oputn pole (pouze pro textov pole)\n    if (saveOnBlur && !isSelectField) {\n      triggerAutosave(false); // s debouncem\n    }\n  }, [triggerAutosave, saveOnBlur, isSelectField]);\n\n  return {\n    handleChange,\n    handleBlur\n  };\n};\n\nexport default useAutosave;\n","/* eslint-disable no-unused-vars */\nimport axios from 'axios';\n\n/**\n * INVOICES25 ATTACHMENTS API Service\n * Implementace podle BE dokumentace - Invoice Attachments API\n * Verze: v2025.03_25\n * Datum: 27. jna 2025\n *\n * Endpointy:\n * 1. invoices25/attachments/upload - Upload plohy faktury\n * 2. invoices25/attachments/by-invoice - Seznam ploh faktury\n * 3. invoices25/attachments/by-order - Seznam ploh vech faktur objednvky\n * 4. invoices25/attachments/by-id - Detail plohy\n * 5. invoices25/attachments/download - Download plohy\n * 6. invoices25/attachments/update - Aktualizace metadat\n * 7. invoices25/attachments/delete - Smazn plohy\n */\n\n// Reuse axios instance from api25orders\nconst api25invoices = axios.create({\n  baseURL: process.env.REACT_APP_API2_BASE_URL,\n  headers: { 'Content-Type': 'application/json' }\n});\n\n// Response interceptor to handle token expiration\napi25invoices.interceptors.response.use(\n  (response) => response,\n  (error) => {\n    //  TEMPORARY FIX: Disable auto-logout for delete invoice endpoint\n    // Dvod: BE pravdpodobn vrac 401/403 i s platnm tokenem (timezone issue?)\n    const isDeleteInvoice = error.config?.url?.includes('/invoices/') && error.config?.url?.includes('/delete');\n\n    if (isDeleteInvoice) {\n      // Vrtit error BEZ triggeru authError event\n      return Promise.reject(error);\n    }\n\n    // Pro ostatn endpointy zachovat pvodn chovn (auto-logout)\n    // Check for authentication errors\n    if (error.response?.status === 401 || error.response?.status === 403) {\n      if (typeof window !== 'undefined') {\n        const event = new CustomEvent('authError', {\n          detail: { message: 'Vae pihlen vyprelo. Pihlaste se prosm znovu.' }\n        });\n        window.dispatchEvent(event);\n      }\n    }\n\n    // Check for HTML response (login page instead of JSON)\n    const responseText = error.response?.data || '';\n    if (typeof responseText === 'string' && responseText.includes('<!doctype')) {\n      if (typeof window !== 'undefined') {\n        const event = new CustomEvent('authError', {\n          detail: { message: 'Vae pihlen vyprelo. Obnovte strnku a pihlaste se znovu.' }\n        });\n        window.dispatchEvent(event);\n      }\n    }\n\n    return Promise.reject(error);\n  }\n);\n\n/**\n * Normalize error messages from API responses\n */\nexport function normalizeApi25InvoicesError(err) {\n  if (err.response?.data?.message) return err.response.data.message;\n  if (err.response?.data?.error) return err.response.data.error;\n  if (err.response?.data?.err) return err.response.data.err;\n  if (err.response?.data) {\n    if (typeof err.response.data === 'string') return err.response.data;\n  }\n  if (err.message) return err.message;\n  return 'Neoekvan chyba pi komunikaci se serverem';\n}\n\n/**\n * Get user-friendly error message from API error\n */\nexport function getUserErrorMessage25Invoices(err) {\n  return normalizeApi25InvoicesError(err);\n}\n\n// ===================================================================\n// 1. UPLOAD - Nahrn plohy faktury\n// ===================================================================\n\n/**\n * Upload plohy k faktue\n *\n *  NOV ORDER V2 API STRUKTURA (27.10.2025)\n * POST /order-v2/invoices/{invoice_id}/attachments/upload\n *\n * @param {Object} params - Parameters\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number|string} params.faktura_id - ID faktury (invoice_id v URL)\n * @param {number|string} params.objednavka_id - ID objednvky (order_id v body)\n * @param {string} params.typ_prilohy - Typ plohy (FAKTURA, ISDOC, DOPLNEK_FA)\n * @param {File} params.file - Soubor k nahrn\n * @returns {Promise<Object>} Response s detaily nahran plohy\n */\nexport async function uploadInvoiceAttachment25({\n  token,\n  username,\n  faktura_id,\n  objednavka_id,\n  typ_prilohy,\n  file\n}) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  if (!faktura_id) {\n    throw new Error('Chyb ID faktury.');\n  }\n\n  // objednavka_id je nepovinn pro standalone faktury\n  // if (!objednavka_id) {\n  //   throw new Error('Chyb ID objednvky.');\n  // }\n\n  if (!typ_prilohy) {\n    throw new Error('Chyb typ plohy.');\n  }\n\n  if (!file || !(file instanceof File)) {\n    throw new Error('Chyb soubor k nahrn.');\n  }\n\n  try {\n    const formData = new FormData();\n    formData.append('token', token);\n    formData.append('username', username);\n\n    //  WORKAROUND: BE endpoint potebuje user_id explicitn (stejn jako createInvoiceWithAttachment25)\n    const userId = localStorage.getItem('user_id');\n    if (userId) {\n      formData.append('user_id', userId);\n    }\n\n    //  order_id je nepovinn pro standalone faktury (backend me vyadovat przdn string)\n    formData.append('order_id', objednavka_id ? String(objednavka_id) : '');\n    formData.append('typ_prilohy', typ_prilohy);\n    formData.append('file', file);\n\n    //  NOV URL STRUKTURA: /order-v2/invoices/{invoice_id}/attachments/upload\n    const response = await api25invoices.post(\n      `order-v2/invoices/${faktura_id}/attachments/upload`,\n      formData,\n      {\n        timeout: 60000, // 60s pro velk soubory\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      }\n    );\n\n    if (response.status !== 200 && response.status !== 201) {\n      const error = `Neoekvan kd odpovdi pi uploadu plohy faktury: ${response.status}`;\n      throw new Error(error);\n    }\n\n    const data = response.data;\n\n    //  NOV STRUKTURA: { success: true, message: \"...\", priloha: {...} }\n    if (data.success === true) {\n      return data;\n    }\n\n    //  STAR STRUKTURA: { status: 'ok', ... } (backwards compatibility)\n    if (data.status === 'ok') {\n      return data;\n    }\n\n    //  CHYBA - NOV STRUKTURA: { success: false, error: \"...\" }\n    if (data.success === false) {\n      throw new Error(data.error || data.message || 'Chyba pi nahrvn plohy faktury');\n    }\n\n    //  CHYBA - STAR STRUKTURA: { status: 'error', message: \"...\" }\n    if (data.status === 'error') {\n      throw new Error(data.message || 'Chyba pi nahrvn plohy faktury');\n    }\n\n    throw new Error('Neoekvan struktura odpovdi ze serveru');\n\n  } catch (error) {\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n// ===================================================================\n// 2. LIST BY INVOICE - Seznam ploh faktury\n// ===================================================================\n\n/**\n * Seznam ploh pro konkrtn fakturu\n *\n *  NOV ORDER V2 API STRUKTURA (27.10.2025)\n * GET /order-v2/invoices/{invoice_id}/attachments?order_id=X\n *\n * @param {Object} params - Parameters\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number|string} params.faktura_id - ID faktury (invoice_id v URL)\n * @param {number|string} params.objednavka_id - ID objednvky (order_id v query string)\n * @returns {Promise<Object>} Response se seznamem ploh\n */\nexport async function listInvoiceAttachments25({ token, username, faktura_id, objednavka_id }) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  if (!faktura_id) {\n    throw new Error('Chyb ID faktury.');\n  }\n\n  //  objednavka_id nen povinn - faktury mohou existovat samostatn (nov modul FA)\n\n  //  DEBUG: Kontrola typu faktura_id\n  if (typeof faktura_id === 'string' && faktura_id.includes('{')) {\n    throw new Error('Neplatn ID faktury - placeholder nebyl nahrazen');\n  }\n\n  try {\n    const payload = {\n      token,\n      username\n    };\n\n    // Pokud je objednavka_id poskytnut, pidej ji do payloadu\n    if (objednavka_id) {\n      payload.order_id = Number(objednavka_id);\n    }\n\n    //  NOV URL STRUKTURA: POST /order-v2/invoices/{invoice_id}/attachments (token + username v BODY)\n    const response = await api25invoices.post(\n      `order-v2/invoices/${faktura_id}/attachments`,\n      payload,\n      {\n        timeout: 10000\n      }\n    );\n\n    if (response.status !== 200) {\n      const error = 'Neoekvan kd odpovdi pi natn ploh faktury';\n      throw new Error(error);\n    }\n\n    const data = response.data;\n\n    //  NOV STRUKTURA: { success: true, data: { attachments: [...] } }\n    if (data.success === true) {\n      return data;\n    }\n\n    //  STAR STRUKTURA: { status: 'ok', ... } (backwards compatibility)\n    if (data.status === 'ok') {\n      return data;\n    }\n\n    //  CHYBA - NOV STRUKTURA: { success: false, error: \"...\" }\n    if (data.success === false) {\n      throw new Error(data.error || data.message || 'Chyba pi natn ploh faktury');\n    }\n\n    //  CHYBA - STAR STRUKTURA: { status: 'error', message: \"...\" }\n    if (data.status === 'error') {\n      throw new Error(data.message || 'Chyba pi natn ploh faktury');\n    }\n\n    // Pokud nen ani success ani status, je nco patn\n    throw new Error('Neoekvan struktura odpovdi ze serveru');\n\n  } catch (error) {\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n// ===================================================================\n// 3. LIST BY ORDER - Seznam ploh vech faktur objednvky\n// ===================================================================\n\n/**\n * Seznam ploh vech faktur pro objednvku\n *\n * @param {Object} params - Parameters\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number|string} params.objednavka_id - ID objednvky\n * @returns {Promise<Object>} Response se seznamem ploh\n */\nexport async function listOrderInvoiceAttachments25({ token, username, objednavka_id }) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  if (!objednavka_id) {\n    throw new Error('Chyb ID objednvky.');\n  }\n\n  try {\n    const payload = {\n      token,\n      username,\n      objednavka_id: Number(objednavka_id)\n    };\n\n\n    const response = await api25invoices.post('invoices25/attachments/by-order', payload, {\n      timeout: 10000\n    });\n\n    if (response.status !== 200) {\n      const error = 'Neoekvan kd odpovdi pi natn ploh faktur objednvky';\n      throw new Error(error);\n    }\n\n    const data = response.data;\n\n    if (data.status === 'error') {\n      throw new Error(data.message || 'Chyba pi natn ploh faktur objednvky');\n    }\n\n    if (data.status === 'ok') {\n      return data;\n    }\n\n    throw new Error('Neoekvan struktura odpovdi ze serveru');\n\n  } catch (error) {\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n// ===================================================================\n// 4. GET BY ID - Detail plohy\n// ===================================================================\n\n/**\n * Detail konkrtn plohy faktury\n *\n * @param {Object} params - Parameters\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number|string} params.priloha_id - ID plohy\n * @returns {Promise<Object>} Response s detailem plohy\n */\nexport async function getInvoiceAttachmentById25({ token, username, priloha_id }) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  if (!priloha_id) {\n    throw new Error('Chyb ID plohy.');\n  }\n\n  try {\n    const payload = {\n      token,\n      username,\n      priloha_id: Number(priloha_id)\n    };\n\n\n    const response = await api25invoices.post('invoices25/attachments/by-id', payload, {\n      timeout: 10000\n    });\n\n    if (response.status !== 200) {\n      const error = 'Neoekvan kd odpovdi pi natn detailu plohy';\n      throw new Error(error);\n    }\n\n    const data = response.data;\n\n    if (data.status === 'error') {\n      throw new Error(data.message || 'Chyba pi natn detailu plohy');\n    }\n\n    if (data.status === 'ok') {\n      return data;\n    }\n\n    throw new Error('Neoekvan struktura odpovdi ze serveru');\n\n  } catch (error) {\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n// ===================================================================\n// 5. DOWNLOAD - Staen plohy\n// ===================================================================\n\n/**\n * Download plohy faktury\n *\n *  ORDER V2 API (1.11.2025)\n * POST /order-v2/invoices/{invoice_id}/attachments/{attachment_id}/download\n *\n * @param {Object} params - Parameters\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number|string} params.faktura_id - ID faktury (invoice_id v URL)\n * @param {number|string} params.priloha_id - ID plohy (attachment_id v URL)\n * @param {number|string} params.objednavka_id - ID objednvky (order_id v body - pro kontrolu pstupu)\n * @returns {Promise<Blob>} Binrn data souboru\n */\nexport async function downloadInvoiceAttachment25({ token, username, faktura_id, priloha_id, objednavka_id }) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  if (!faktura_id) {\n    throw new Error('Chyb ID faktury.');\n  }\n\n  if (!priloha_id) {\n    throw new Error('Chyb ID plohy.');\n  }\n\n  //  objednavka_id nen nutn pro standalone faktury\n  // if (!objednavka_id) {\n  //   throw new Error('Chyb ID objednvky.');\n  // }\n\n  try {\n\n    const payload = {\n      token,\n      username\n    };\n\n    //  Pidat order_id jen pokud je k dispozici\n    if (objednavka_id) {\n      payload.order_id = Number(objednavka_id);\n    }\n    //  Pidat order_id jen pokud je k dispozici\n    if (objednavka_id) {\n      payload.order_id = Number(objednavka_id);\n    }\n\n    //  ORDER V2 API: POST s token + username + order_id v BODY\n    const response = await api25invoices.post(\n      `order-v2/invoices/${faktura_id}/attachments/${priloha_id}/download`,\n      payload,\n      {\n        timeout: 30000,\n        responseType: 'blob'\n      }\n    );\n\n    if (response.status !== 200) {\n      const error = 'Neoekvan kd odpovdi pi stahovn plohy';\n      throw new Error(error);\n    }\n\n    return response.data;\n\n  } catch (error) {\n    // Blob error response - parsuj JSON a extrahuj message\n    if (error.response?.data instanceof Blob) {\n      const text = await error.response.data.text();\n      \n      let errorMessage = text;\n      try {\n        const data = JSON.parse(text);\n        errorMessage = data.message || data.err || data.error || text;\n      } catch (parseError) {\n        // Pokud JSON parse sele, pouij raw text\n      }\n      \n      throw new Error(errorMessage || 'Nepodailo se sthnout plohu faktury');\n    }\n    \n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n// ===================================================================\n// 6. UPDATE - Aktualizace metadat plohy\n// ===================================================================\n\n/**\n * Aktualizace metadat plohy faktury\n *\n *  ORDER V2 API (1.11.2025)\n * PUT/POST /order-v2/invoices/{invoice_id}/attachments/{attachment_id}/update\n *\n * @param {Object} params - Parameters\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number|string} params.faktura_id - ID faktury (invoice_id v URL)\n * @param {number|string} params.priloha_id - ID plohy (attachment_id v URL)\n * @param {number|string} params.objednavka_id - ID objednvky (order_id v body)\n * @param {string} [params.typ_prilohy] - Nov typ plohy\n * @param {string} [params.originalni_nazev_souboru] - Nov nzev souboru\n * @returns {Promise<Object>} Response s aktualizovanmi daty\n */\nexport async function updateInvoiceAttachment25({\n  token,\n  username,\n  faktura_id,\n  priloha_id,\n  objednavka_id,\n  typ_prilohy,\n  type,  //  Pidn parametr 'type' (m pednost ped typ_prilohy)\n  originalni_nazev_souboru,\n  original_name  //  Anglick verze nzvu souboru\n}) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  if (!faktura_id) {\n    throw new Error('Chyb ID faktury.');\n  }\n\n  if (!priloha_id) {\n    throw new Error('Chyb ID plohy.');\n  }\n\n  //  objednavka_id nen nutn pro standalone faktury\n  // if (!objednavka_id) {\n  //   throw new Error('Chyb ID objednvky.');\n  // }\n\n  try {\n    const payload = {\n      token,\n      username\n    };\n\n    //  Pidat order_id jen pokud je k dispozici\n    if (objednavka_id) {\n      payload.order_id = Number(objednavka_id);\n    }\n\n    //  Preferuj 'type' (anglicky) pokud je poslan, jinak 'typ_prilohy' (esky)\n    if (type) {\n      payload.type = type;\n    } else if (typ_prilohy) {\n      payload.typ_prilohy = typ_prilohy;\n    }\n\n    //  Preferuj 'original_name' (anglicky) pokud je poslan\n    if (original_name) {\n      payload.original_name = original_name;\n    } else if (originalni_nazev_souboru) {\n      payload.originalni_nazev_souboru = originalni_nazev_souboru;\n    }\n\n    //  ORDER V2 API: POST (podporuje i PUT) /order-v2/invoices/{invoice_id}/attachments/{attachment_id}/update\n    const response = await api25invoices.post(\n      `order-v2/invoices/${faktura_id}/attachments/${priloha_id}/update`,\n      payload,\n      {\n        timeout: 10000\n      }\n    );\n\n    if (response.status !== 200) {\n      const error = 'Neoekvan kd odpovdi pi aktualizaci plohy';\n      throw new Error(error);\n    }\n\n    const data = response.data;\n\n    //  NOV STRUKTURA: { success: true, message: \"...\", attachment: {...} }\n    if (data.success === true) {\n      return data;\n    }\n\n    //  STAR STRUKTURA: { status: 'ok', ... } (backwards compatibility)\n    if (data.status === 'ok') {\n      return data;\n    }\n\n    //  CHYBA - NOV STRUKTURA: { success: false, error: \"...\" }\n    if (data.success === false) {\n      throw new Error(data.error || data.message || 'Chyba pi aktualizaci plohy');\n    }\n\n    //  CHYBA - STAR STRUKTURA: { status: 'error', message: \"...\" }\n    if (data.status === 'error') {\n      throw new Error(data.message || 'Chyba pi aktualizaci plohy');\n    }\n\n    throw new Error('Neoekvan struktura odpovdi ze serveru');\n\n  } catch (error) {\n    //  DEBUG: Zobrazit celou error response z backendu\n    if (error.response) {\n      console.error(' Backend error response:', {\n        status: error.response.status,\n        data: error.response.data,\n        headers: error.response.headers\n      });\n    }\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n// ===================================================================\n// 7. DELETE - Smazn plohy\n// ===================================================================\n\n/**\n * Smazn plohy faktury\n *\n *  NOV ORDER V2 API STRUKTURA (1.11.2025)\n * DELETE /order-v2/invoices/{invoice_id}/attachments/{attachment_id}\n * POST /order-v2/invoices/{invoice_id}/attachments/{attachment_id} (s _method: DELETE)\n *\n * **SOFT DELETE (default):**\n * - Nastav `deleted = 1`, `dt_deleted = NOW()` v DB\n * - Fyzick soubor zstv na disku (pro audit)\n * - Ploha se nezobrazuje v seznamech\n *\n * **HARD DELETE:**\n * - Fyzicky smae soubor z disku\n * - Smae zznam z databze\n * - Nevratn operace!\n *\n * @param {Object} params - Parameters\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number|string} params.faktura_id - ID faktury (invoice_id v URL)\n * @param {number|string} params.priloha_id - ID plohy (attachment_id v URL)\n * @param {number|string} params.objednavka_id - ID objednvky (order_id v body)\n * @param {number} [params.hard_delete=0] - 0 = soft delete (default), 1 = hard delete (fyzick smazn souboru)\n * @returns {Promise<Object>} Response s potvrzenm smazn\n *\n * @example\n * // Soft delete (default)\n * await deleteInvoiceAttachment25({\n *   token, username,\n *   faktura_id: 123,\n *   priloha_id: 456,\n *   objednavka_id: 789\n * });\n *\n * @example\n * // Hard delete (fyzick smazn)\n * await deleteInvoiceAttachment25({\n *   token, username,\n *   faktura_id: 123,\n *   priloha_id: 456,\n *   objednavka_id: 789,\n *   hard_delete: 1\n * });\n */\nexport async function deleteInvoiceAttachment25({ token, username, faktura_id, priloha_id, objednavka_id, hard_delete = 0 }) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  if (!faktura_id) {\n    throw new Error('Chyb ID faktury.');\n  }\n\n  if (!priloha_id) {\n    throw new Error('Chyb ID plohy.');\n  }\n\n  //  objednavka_id nen nutn pro standalone faktury\n  // if (!objednavka_id) {\n  //   throw new Error('Chyb ID objednvky.');\n  // }\n\n  try {\n\n    const payload = {\n      token,\n      username,\n      hard_delete: Number(hard_delete), //  0 = soft delete, 1 = hard delete\n      _method: 'DELETE' //  Pro ppady kdy server preferuje POST s _method\n    };\n\n    //  Pidat order_id jen pokud je k dispozici\n    if (objednavka_id) {\n      payload.order_id = Number(objednavka_id);\n    }\n\n    //  NOV URL STRUKTURA: POST /order-v2/invoices/{invoice_id}/attachments/{attachment_id}/delete\n    // Token, username a order_id poslme v BODY\n    const response = await api25invoices.post(\n      `order-v2/invoices/${faktura_id}/attachments/${priloha_id}/delete`,\n      payload,\n      {\n        timeout: 10000\n      }\n    );\n\n    if (response.status !== 200) {\n      const error = 'Neoekvan kd odpovdi pi mazn plohy';\n      throw new Error(error);\n    }\n\n    const data = response.data;\n\n    //  NOV STRUKTURA: { success: true, message: \"...\" }\n    if (data.success === true) {\n      return data;\n    }\n\n    //  STAR STRUKTURA: { status: 'ok', ... } (backwards compatibility)\n    if (data.status === 'ok') {\n      return data;\n    }\n\n    //  CHYBA - NOV STRUKTURA: { success: false, error: \"...\" }\n    if (data.success === false) {\n      throw new Error(data.error || data.message || 'Chyba pi mazn plohy');\n    }\n\n    //  CHYBA - STAR STRUKTURA: { status: 'error', message: \"...\" }\n    if (data.status === 'error') {\n      throw new Error(data.message || 'Chyba pi mazn plohy');\n    }\n\n    throw new Error('Neoekvan struktura odpovdi ze serveru');\n\n  } catch (error) {\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n// ===================================================================\n// 6. VERIFY - Oven integrity ploh faktur\n// ===================================================================\n\n/**\n * Oven integrity ploh konkrtn faktury\n *\n * Zkontroluje, zda vechny plohy faktury existuj na disku a odpovdaj metadata v databzi\n *\n *  ORDER V2 API STRUKTURA\n * POST /order-v2/invoices/{invoice_id}/attachments/verify\n *\n * @param {Object} params - Parameters\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number|string} params.invoice_id - ID faktury (pouije se v URL)\n * @param {number|string} params.objednavka_id - ID objednvky (posl se v payload)\n * @returns {Promise<Object>} Response s vsledky verifikace\n *\n * @example\n * const result = await verifyInvoiceAttachments25({\n *   token,\n *   username,\n *   invoice_id: 9,        // ID konkrtn faktury\n *   objednavka_id: 11248  // ID objednvky (pro kontrolu prv)\n * });\n */\nexport async function verifyInvoiceAttachments25({ token, username, invoice_id, objednavka_id }) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  if (!invoice_id) {\n    throw new Error('Chyb ID faktury pro oven ploh.');\n  }\n\n  // objednavka_id je nepovinn pro standalone faktury\n  // if (!objednavka_id) {\n  //   throw new Error('Chyb ID objednvky pro oven ploh.');\n  // }\n\n  try {\n    const payload = {\n      token,\n      username\n    };\n    \n    //  objednavka_id je nepovinn pro standalone faktury\n    if (objednavka_id) {\n      payload.objednavka_id = Number(objednavka_id);\n    }\n\n    //  SPRVN URL STRUKTURA: POST /order-v2/invoices/{invoice_id}/attachments/verify\n    // invoice_id je v URL (identifikuje fakturu)\n    // objednavka_id je v payload (pro kontrolu prv)\n    const response = await api25invoices.post(\n      `order-v2/invoices/${invoice_id}/attachments/verify`,\n      payload,\n      {\n        timeout: 15000\n      }\n    );\n\n    if (response.status !== 200) {\n      const error = 'Neoekvan kd odpovdi pi ovovn ploh';\n      throw new Error(error);\n    }\n\n    const data = response.data;\n\n    //  NOV STRUKTURA: { success: true, summary: {...}, attachments: [...] }\n    if (data.success === true) {\n      return data;\n    }\n\n    //  STAR STRUKTURA: { status: 'ok', data: {...} } (backwards compatibility)\n    if (data.status === 'ok') {\n      return data.data || data;\n    }\n\n    //  CHYBA - NOV STRUKTURA: { success: false, error: \"...\" }\n    if (data.success === false) {\n      throw new Error(data.error || data.message || 'Chyba pi ovovn ploh');\n    }\n\n    //  CHYBA - STAR STRUKTURA: { status: 'error', message: \"...\" }\n    if (data.status === 'error') {\n      throw new Error(data.message || 'Chyba pi ovovn ploh');\n    }\n\n    throw new Error('Neoekvan struktura odpovdi ze serveru');\n\n  } catch (error) {\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n// ===================================================================\n// UTILITY FUNCTIONS\n// ===================================================================\n\n/**\n * Validace typu souboru (frontend check)\n */\nexport function isAllowedInvoiceFileType(filename) {\n  const allowedExtensions = ['pdf', 'isdoc', 'jpg', 'jpeg', 'png', 'xml', 'doc', 'docx', 'xls', 'xlsx', 'txt', 'csv'];\n  const ext = filename.split('.').pop().toLowerCase();\n  return allowedExtensions.includes(ext);\n}\n\n/**\n * Validace velikosti souboru (frontend check)\n */\nexport function isAllowedInvoiceFileSize(fileSize) {\n  const maxSize = 10 * 1024 * 1024; // 10 MB\n  return fileSize <= maxSize;\n}\n\n/**\n * Detekce ISDOC formtu (frontend check)\n */\nexport function isISDOCFile(filename) {\n  const ext = filename.split('.').pop().toLowerCase();\n  return ext === 'isdoc';\n}\n\n/**\n * Formtovn velikosti souboru\n */\nexport function formatFileSize(bytes) {\n  if (bytes === 0) return '0 B';\n  const k = 1024;\n  const sizes = ['B', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n}\n\n// ===================================================================\n//  ATOMICK VYTVOEN FAKTURY + PLOHY\n// ===================================================================\n\n/**\n * Atomick vytvoen faktury vetn plohy v jedn transakci\n *\n * @param {Object} params - Parameters\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number|string} params.objednavka_id - ID objednvky (POVINN)\n * @param {string} params.fa_castka - stka faktury (POVINN)\n * @param {string} params.fa_cislo_vema - slo faktury (POVINN)\n * @param {File} params.file - Soubor k nahrn (POVINN)\n * @param {number} [params.fa_dorucena=0] - Pznak doruen (0/1)\n * @param {string} [params.fa_datum_vystaveni] - Datum vystaven (YYYY-MM-DD nebo null)\n * @param {string} [params.fa_datum_splatnosti] - Datum splatnosti (YYYY-MM-DD nebo null)\n * @param {string} [params.fa_datum_doruceni] - Datum doruen (YYYY-MM-DD nebo null)\n * @param {string} [params.fa_strediska_kod] - Kd stediska (string nebo null)\n * @param {string} [params.fa_poznamka] - Poznmka (text nebo null)\n * @param {string} [params.typ_prilohy='ISDOC'] - Typ plohy\n * @param {Object} [params.rozsirujici_data] - JSON objekt s dalmi daty\n * @returns {Promise<Object>} Response s detaily faktury + plohy\n *\n * @example\n * const result = await createInvoiceWithAttachment25({\n *   token: userToken,\n *   username: 'admin',\n *   objednavka_id: 11165,\n *   fa_castka: '12500.00',\n *   fa_cislo_vema: '2025/001',\n *   fa_datum_vystaveni: '2025-01-15',\n *   fa_datum_splatnosti: '2025-02-14',\n *   fa_poznamka: 'Importovno z ISDOC',\n *   file: isdocFile,\n *   typ_prilohy: 'ISDOC'\n * });\n * // result.faktura_id - ID nov vytvoen faktury\n * // result.priloha_id - ID nov nahran plohy\n */\nexport async function createInvoiceWithAttachment25({\n  token,\n  username,\n  objednavka_id,\n  fa_castka,\n  fa_cislo_vema,\n  file,\n  fa_dorucena = 0,\n  fa_datum_vystaveni = null,\n  fa_datum_splatnosti = null,\n  fa_datum_doruceni = null,\n  fa_strediska_kod = null,\n  fa_poznamka = null,\n  typ_prilohy = 'ISDOC',\n  rozsirujici_data = null\n}) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  if (!objednavka_id) {\n    throw new Error('Chyb ID objednvky.');\n  }\n\n  if (!fa_castka) {\n    throw new Error('Chyb stka faktury.');\n  }\n\n  if (!fa_cislo_vema) {\n    throw new Error('Chyb slo faktury.');\n  }\n\n  if (!file || !(file instanceof File)) {\n    throw new Error('Chyb soubor k nahrn.');\n  }\n\n  try {\n    const formData = new FormData();\n\n    // Autorizace\n    formData.append('token', token);\n    formData.append('username', username);\n\n    //  WORKAROUND: BE endpoint potebuje user_id explicitn\n    const userId = localStorage.getItem('user_id');\n    if (userId) {\n      formData.append('user_id', userId);\n    }\n\n    // Povinn daje faktury\n    formData.append('objednavka_id', String(objednavka_id));\n    formData.append('fa_castka', String(fa_castka));\n    formData.append('fa_cislo_vema', String(fa_cislo_vema));\n\n    // Voliteln daje faktury\n    formData.append('fa_dorucena', String(fa_dorucena));\n\n    if (fa_datum_vystaveni) {\n      formData.append('fa_datum_vystaveni', fa_datum_vystaveni);\n    }\n\n    if (fa_datum_splatnosti) {\n      formData.append('fa_datum_splatnosti', fa_datum_splatnosti);\n    }\n\n    if (fa_datum_doruceni) {\n      formData.append('fa_datum_doruceni', fa_datum_doruceni);\n    }\n\n    if (fa_strediska_kod) {\n      formData.append('fa_strediska_kod', String(fa_strediska_kod));\n    }\n\n    if (fa_poznamka) {\n      formData.append('fa_poznamka', String(fa_poznamka));\n    }\n\n    if (rozsirujici_data) {\n      formData.append('rozsirujici_data', JSON.stringify(rozsirujici_data));\n    }\n\n    // Ploha\n    formData.append('file', file);\n    formData.append('typ_prilohy', typ_prilohy);\n\n    const response = await api25invoices.post('invoices25/create-with-attachment', formData, {\n      timeout: 60000, // 60s pro velk soubory\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n\n    if (response.status !== 200 && response.status !== 201) {\n      const error = `Neoekvan kd odpovdi: ${response.status}`;\n      throw new Error(error);\n    }\n\n    const data = response.data;\n\n    if (data.status === 'error' || data.err) {\n      const errorMsg = data.message || data.err || 'Chyba pi vytven faktury s plohou';\n      throw new Error(errorMsg);\n    }\n\n    if (data.status === 'ok') {\n      return data;\n    }\n\n    throw new Error('Neoekvan struktura odpovdi ze serveru');\n\n  } catch (error) {\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n// ===================================================================\n// SMAZN FAKTURY\n// ===================================================================\n\n/**\n * Smazn faktury z databze\n *\n * @param {Object} params - Parameters\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number|string} params.faktura_id - ID faktury ke smazn\n * @returns {Promise<Object>} Response s potvrzenm smazn\n */\nexport async function deleteInvoice25({ token, username, faktura_id }) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  if (!faktura_id) {\n    throw new Error('Chyb ID faktury.');\n  }\n\n  try {\n    const payload = {\n      token,\n      username,\n      id: Number(faktura_id), // Backend oekv \"id\", ne \"faktura_id\"\n      hard_delete: 1 // Vdy hard delete (prozatm, pozdji podle prv)\n    };\n\n\n    const response = await api25invoices.post(`order-v2/invoices/${faktura_id}/delete`, payload, {\n      timeout: 10000\n    });\n\n\n    if (response.status !== 200 && response.status !== 201) {\n      const error = 'Neoekvan kd odpovdi pi mazn faktury';\n      throw new Error(error);\n    }\n\n    const data = response.data;\n\n    // Kontrola rznch formt odpovdi\n    if (data.status === 'error' || data.err || data.error) {\n      const errorMsg = data.message || data.err || data.error || 'Chyba pi mazn faktury';\n      throw new Error(errorMsg);\n    }\n\n    if (data.status === 'ok' || data.success === true || response.status === 200) {\n      return data;\n    }\n\n    throw new Error('Neoekvan struktura odpovdi ze serveru');\n\n  } catch (error) {\n\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n// ===================================================================\n// ORDER V2 INVOICE API (NEW - 31.10.2025)\n// ===================================================================\n\n/**\n * Vytvoen faktury s plohou (atomic operation)\n *\n * Order V2 API: POST /api.eeo/order-v2/{order_id}/invoices/create-with-attachment\n *\n * @param {Object} params - Parameters\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number|string} params.order_id - ID objednvky\n * @param {File} params.file - Soubor plohy (povinn)\n * @param {string} params.fa_cislo_vema - slo faktury (povinn)\n * @param {string} params.fa_datum_vystaveni - Datum vystaven YYYY-MM-DD (povinn)\n * @param {string} params.fa_castka - stka faktury (povinn)\n * @param {string} [params.fa_datum_splatnosti] - Datum splatnosti YYYY-MM-DD\n * @param {string} [params.fa_datum_doruceni] - Datum doruen YYYY-MM-DD\n * @param {number} [params.fa_dorucena] - Zda byla doruena (0/1)\n * @param {string} [params.fa_strediska_kod] - Kd stediska\n * @param {string} [params.fa_poznamka] - Poznmka k faktue\n * @param {Object} [params.rozsirujici_data] - Roziujc JSON data\n * @returns {Promise<Object>} Response s invoice_id a attachment_id\n *\n * @example\n * const result = await createInvoiceWithAttachmentV2({\n *   token: userToken,\n *   username: 'admin',\n *   order_id: 123,\n *   fa_cislo_vema: 'FA-2025-001',\n *   fa_datum_vystaveni: '2025-10-31',\n *   fa_datum_splatnosti: '2025-11-30',\n *   fa_castka: '25000.00',\n *   file: selectedFile\n * });\n * // result.data.invoice_id - ID nov vytvoen faktury\n * // result.data.attachment_id - ID nov nahran plohy\n */\nexport async function createInvoiceWithAttachmentV2({\n  token,\n  username,\n  order_id,\n  smlouva_id = null,\n  file,\n  klasifikace = null, // Klasifikace plohy (FAKTURA_TYP)\n  fa_cislo_vema,\n  fa_typ = 'BEZNA',\n  fa_datum_vystaveni,\n  fa_castka,\n  fa_datum_splatnosti = null,\n  fa_datum_doruceni = null,\n  fa_dorucena = 0,\n  fa_strediska_kod = null,\n  fa_poznamka = null,\n  rozsirujici_data = null,\n  // Vcn sprvnost (nov fieldy)\n  potvrzeni_vecne_spravnosti = null,\n  vecna_spravnost_umisteni_majetku = null,\n  vecna_spravnost_poznamka = null,\n  // Pedn zamstnanci (nov fieldy)\n  fa_predana_zam_id = null,\n  fa_datum_predani_zam = null,\n  fa_datum_vraceni_zam = null\n}) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  //  order_id je nyn NEPOVINN - faktura me bt bez objednvky\n\n  if (!file || !(file instanceof File)) {\n    throw new Error('Chyb soubor k nahrn.');\n  }\n\n  // Validace povinnch pol\n  if (!fa_cislo_vema) {\n    throw new Error('Chyb slo faktury (fa_cislo_vema).');\n  }\n\n  if (!fa_datum_vystaveni) {\n    throw new Error('Chyb datum vystaven (fa_datum_vystaveni).');\n  }\n\n  if (!fa_castka) {\n    throw new Error('Chyb stka faktury (fa_castka).');\n  }\n\n  try {\n    const formData = new FormData();\n\n    // Auth\n    formData.append('username', username);\n    formData.append('token', token);\n\n    // Povinn fieldy\n    formData.append('fa_cislo_vema', String(fa_cislo_vema));\n    formData.append('fa_typ', String(fa_typ));\n    formData.append('fa_datum_vystaveni', fa_datum_vystaveni);\n    formData.append('fa_castka', String(fa_castka));\n\n    // Voliteln fieldy\n    if (fa_datum_splatnosti) {\n      formData.append('fa_datum_splatnosti', fa_datum_splatnosti);\n    }\n\n    if (fa_datum_doruceni) {\n      formData.append('fa_datum_doruceni', fa_datum_doruceni);\n    }\n\n    formData.append('fa_dorucena', String(fa_dorucena));\n\n    if (fa_strediska_kod) {\n      formData.append('fa_strediska_kod', String(fa_strediska_kod));\n    }\n\n    if (fa_poznamka) {\n      formData.append('fa_poznamka', String(fa_poznamka));\n    }\n\n    if (rozsirujici_data) {\n      formData.append('rozsirujici_data', JSON.stringify(rozsirujici_data));\n    }\n\n    // Vcn sprvnost\n    if (potvrzeni_vecne_spravnosti) {\n      formData.append('potvrzeni_vecne_spravnosti', potvrzeni_vecne_spravnosti);\n    }\n\n    if (vecna_spravnost_umisteni_majetku) {\n      formData.append('vecna_spravnost_umisteni_majetku', String(vecna_spravnost_umisteni_majetku));\n    }\n\n    if (vecna_spravnost_poznamka) {\n      formData.append('vecna_spravnost_poznamka', String(vecna_spravnost_poznamka));\n    }\n\n    // Pedn zamstnanci\n    if (fa_predana_zam_id) {\n      formData.append('fa_predana_zam_id', String(fa_predana_zam_id));\n    }\n\n    if (fa_datum_predani_zam) {\n      formData.append('fa_datum_predani_zam', fa_datum_predani_zam);\n    }\n\n    if (fa_datum_vraceni_zam) {\n      formData.append('fa_datum_vraceni_zam', fa_datum_vraceni_zam);\n    }\n\n    // Smlouva (me bt null)\n    if (smlouva_id) {\n      formData.append('smlouva_id', String(smlouva_id));\n    }\n\n    // Objednvka (me bt null)\n    if (order_id) {\n      formData.append('objednavka_id', String(order_id));\n    }\n\n    // Soubor\n    formData.append('file', file);\n\n    // Klasifikace plohy (typ plohy)\n    if (klasifikace) {\n      formData.append('klasifikace', String(klasifikace));\n    }\n\n    //  VDY pouij V2 API - bu s order_id nebo standalone\n    const endpoint = order_id \n      ? `order-v2/${order_id}/invoices/create-with-attachment`\n      : 'order-v2/invoices/create-with-attachment'; // V2 standalone API\n\n    const response = await api25invoices.post(\n      endpoint,\n      formData,\n      {\n        timeout: 60000,\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      }\n    );\n\n    if (response.status !== 200 && response.status !== 201) {\n      const error = `Neoekvan kd odpovdi: ${response.status}`;\n      throw new Error(error);\n    }\n\n    const data = response.data;\n\n    if (data.status === 'error') {\n      throw new Error(data.message || 'Chyba pi vytven faktury s plohou');\n    }\n\n    if (data.status === 'ok') {\n      return data;\n    }\n\n    throw new Error('Neoekvan struktura odpovdi ze serveru');\n\n  } catch (error) {\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n/**\n * Vytvoen faktury bez plohy\n *\n * Order V2 API: POST /api.eeo/order-v2/{order_id}/invoices/create\n *\n * @param {Object} params - Parameters\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number|string} params.order_id - ID objednvky\n * @param {string} params.fa_cislo_vema - slo faktury (povinn)\n * @param {string} params.fa_datum_vystaveni - Datum vystaven YYYY-MM-DD (povinn)\n * @param {string} params.fa_castka - stka faktury (povinn)\n * @param {string} [params.fa_datum_splatnosti] - Datum splatnosti YYYY-MM-DD\n * @param {string} [params.fa_datum_doruceni] - Datum doruen YYYY-MM-DD\n * @param {number} [params.fa_dorucena] - Zda byla doruena (0/1)\n * @param {string} [params.fa_strediska_kod] - Kd stediska\n * @param {string} [params.fa_poznamka] - Poznmka k faktue\n * @param {Object} [params.rozsirujici_data] - Roziujc JSON data\n * @returns {Promise<Object>} Response s invoice_id\n *\n * @example\n * const result = await createInvoiceV2({\n *   token: userToken,\n *   username: 'admin',\n *   order_id: 123,\n *   fa_cislo_vema: 'FA-2025-002',\n *   fa_datum_vystaveni: '2025-10-31',\n *   fa_datum_splatnosti: '2025-12-31',\n *   fa_castka: '15000.00'\n * });\n * // result.data.invoice_id - ID nov vytvoen faktury\n */\nexport async function createInvoiceV2({\n  token,\n  username,\n  order_id,\n  smlouva_id = null,\n  fa_cislo_vema,\n  fa_typ = 'BEZNA',\n  fa_datum_vystaveni,\n  fa_castka,\n  fa_datum_splatnosti = null,\n  fa_datum_doruceni = null,\n  fa_dorucena = 0,\n  fa_strediska_kod = null,\n  fa_poznamka = null,\n  rozsirujici_data = null,\n  // Vcn sprvnost (nov fieldy)\n  potvrzeni_vecne_spravnosti = null,\n  vecna_spravnost_umisteni_majetku = null,\n  vecna_spravnost_poznamka = null,\n  // Pedn zamstnanci (nov fieldy)\n  fa_predana_zam_id = null,\n  fa_datum_predani_zam = null,\n  fa_datum_vraceni_zam = null\n}) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  //  order_id je nyn NEPOVINN - faktura me bt bez objednvky\n\n  // Validace povinnch pol\n  if (!fa_cislo_vema) {\n    throw new Error('Chyb slo faktury (fa_cislo_vema).');\n  }\n\n  if (!fa_datum_vystaveni) {\n    throw new Error('Chyb datum vystaven (fa_datum_vystaveni).');\n  }\n\n  if (!fa_castka) {\n    throw new Error('Chyb stka faktury (fa_castka).');\n  }\n\n  try {\n    const payload = {\n      username,\n      token,\n      fa_cislo_vema: String(fa_cislo_vema),\n      fa_typ: String(fa_typ),\n      fa_datum_vystaveni,\n      fa_castka: String(fa_castka),\n      fa_dorucena: Number(fa_dorucena)\n    };\n\n    // Voliteln fieldy\n    if (fa_datum_splatnosti) {\n      payload.fa_datum_splatnosti = fa_datum_splatnosti;\n    }\n\n    if (fa_datum_doruceni) {\n      payload.fa_datum_doruceni = fa_datum_doruceni;\n    }\n\n    if (fa_strediska_kod) {\n      payload.fa_strediska_kod = String(fa_strediska_kod);\n    }\n\n    if (fa_poznamka) {\n      payload.fa_poznamka = String(fa_poznamka);\n    }\n\n    if (rozsirujici_data) {\n      payload.rozsirujici_data = rozsirujici_data;\n    }\n\n    // Vcn sprvnost\n    if (potvrzeni_vecne_spravnosti) {\n      payload.potvrzeni_vecne_spravnosti = potvrzeni_vecne_spravnosti;\n    }\n\n    if (vecna_spravnost_umisteni_majetku) {\n      payload.vecna_spravnost_umisteni_majetku = String(vecna_spravnost_umisteni_majetku);\n    }\n\n    if (vecna_spravnost_poznamka) {\n      payload.vecna_spravnost_poznamka = String(vecna_spravnost_poznamka);\n    }\n\n    // Pedn zamstnanci\n    if (fa_predana_zam_id) {\n      payload.fa_predana_zam_id = Number(fa_predana_zam_id);\n    }\n\n    if (fa_datum_predani_zam) {\n      payload.fa_datum_predani_zam = fa_datum_predani_zam;\n    }\n\n    if (fa_datum_vraceni_zam) {\n      payload.fa_datum_vraceni_zam = fa_datum_vraceni_zam;\n    }\n\n    // Smlouva\n    if (smlouva_id) {\n      payload.smlouva_id = Number(smlouva_id);\n    }\n\n    //  VDY pouij V2 API - bu s order_id nebo standalone\n    const endpoint = order_id \n      ? `order-v2/${order_id}/invoices/create`\n      : 'order-v2/invoices/create'; // V2 standalone API\n    \n    // Pidat objednavka_id do payload (me bt null)\n    if (order_id) {\n      payload.objednavka_id = Number(order_id);\n    }\n\n    const response = await api25invoices.post(\n      endpoint,\n      payload,\n      { timeout: 10000 }\n    );\n\n    if (response.status !== 200 && response.status !== 201) {\n      const error = `Neoekvan kd odpovdi: ${response.status}`;\n      throw new Error(error);\n    }\n\n    const data = response.data;\n\n    if (data.status === 'error') {\n      throw new Error(data.message || 'Chyba pi vytven faktury');\n    }\n\n    if (data.status === 'ok') {\n      return data;\n    }\n\n    throw new Error('Neoekvan struktura odpovdi ze serveru');\n\n  } catch (error) {\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n/**\n * Aktualizace faktury\n *\n * Order V2 API: POST /api.eeo/order-v2/invoices/{invoice_id}/update\n *\n * @param {Object} params - Parameters\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number|string} params.invoice_id - ID faktury\n * @param {Object} params.updateData - Data k aktualizaci (pouze fieldy kter chce zmnit)\n * @returns {Promise<Object>} Response s updated_fields\n *\n * @example\n * const result = await updateInvoiceV2({\n *   token: userToken,\n *   username: 'admin',\n *   invoice_id: 456,\n *   updateData: {\n *     fa_datum_splatnosti: '2025-12-15',\n *     fa_poznamka: 'Aktualizovan poznmka'\n *   }\n * });\n * // result.data.updated_fields - pole nzv aktualizovanch field\n */\nexport async function updateInvoiceV2({\n  token,\n  username,\n  invoice_id,\n  updateData = {}\n}) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  if (!invoice_id) {\n    throw new Error('Chyb ID faktury.');\n  }\n\n  if (!updateData || Object.keys(updateData).length === 0) {\n    throw new Error('Chyb data k aktualizaci.');\n  }\n\n  try {\n    const payload = {\n      username,\n      token,\n      id: invoice_id,  // PHP oekv 'id', ne 'invoice_id'\n      ...updateData\n    };\n\n\n    const response = await api25invoices.post(\n      `order-v2/invoices/${invoice_id}/update`,\n      payload,\n      { timeout: 10000 }\n    );\n\n    if (response.status !== 200 && response.status !== 201) {\n      const error = `Neoekvan kd odpovdi: ${response.status}`;\n      throw new Error(error);\n    }\n\n    const data = response.data;\n\n    if (data.status === 'error') {\n      throw new Error(data.message || 'Chyba pi aktualizaci faktury');\n    }\n\n    if (data.status === 'ok') {\n      return data;\n    }\n\n    throw new Error('Neoekvan struktura odpovdi ze serveru');\n\n  } catch (error) {\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n/**\n * Smazn faktury\n *\n * Order V2 API: DELETE /api.eeo/order-v2/invoices/{invoice_id}\n *\n * @param {number|string} invoiceId - ID faktury ke smazn\n * @param {string} token - Auth token\n * @param {string} username - Username\n * @param {boolean} [hardDelete=false] - Pokud true, provede hard delete (nenvratn)\n * @returns {Promise<Object>} Response data\n *\n * @example\n * // Soft delete (vchoz)\n * await deleteInvoiceV2(123, token, username);\n *\n * // Hard delete (smazn zznamu + soubor)\n * await deleteInvoiceV2(123, token, username, true);\n */\nexport async function deleteInvoiceV2(invoiceId, token, username, hardDelete = false) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  if (!invoiceId) {\n    throw new Error('Chyb ID faktury.');\n  }\n\n  try {\n    const payload = {\n      token,\n      username,\n      hard_delete: hardDelete ? 1 : 0\n    };\n\n    //  V2 API: DELETE /order-v2/invoices/{id}\n    const response = await api25invoices.delete(`order-v2/invoices/${invoiceId}`, {\n      data: payload,\n      timeout: 10000\n    });\n\n    if (response.status !== 200 && response.status !== 201) {\n      throw new Error('Neoekvan kd odpovdi pi mazn faktury');\n    }\n\n    const data = response.data;\n\n    // Kontrola rznch formt odpovdi\n    if (data.status === 'error' || data.err || data.error) {\n      const errorMsg = data.message || data.err || data.error || 'Chyba pi mazn faktury';\n      throw new Error(errorMsg);\n    }\n\n    if (data.status === 'ok' || data.success === true || response.status === 200) {\n      return data;\n    }\n\n    throw new Error('Neoekvan struktura odpovdi ze serveru');\n\n  } catch (error) {\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n// ===================================================================\n// INVOICE LIST - Naten seznamu faktur\n// ===================================================================\n\n/**\n * Nate seznam vech faktur s filtrovnm a strnkovnm\n * \n *  HOTOVO: Backend implementovn 30. listopadu 2025\n * POST /api.eeo/invoices25/list\n * \n * Administrtoi (SUPERADMIN, ADMINISTRATOR) vid VE.\n * Non-admin uivatel vid pouze faktury svch objednvek + faktury kter vytvoili.\n * \n * @param {Object} params - Parametry\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number} [params.page=1] - slo strnky (server-side pagination)\n * @param {number} [params.per_page=50] - Poet zznam na strnku\n * @param {number} [params.year] - Rok vystaven (filtr)\n * @param {number} [params.objednavka_id] - ID objednvky\n * @param {0|1} [params.fa_dorucena] - 0 = nedorueno, 1 = dorueno\n * @param {string} [params.fa_cislo_vema] - slo faktury (partial match, case-insensitive)\n * @param {string} [params.datum_od] - Datum vystaven od (YYYY-MM-DD)\n * @param {string} [params.datum_do] - Datum vystaven do (YYYY-MM-DD)\n * @param {string} [params.stredisko] - Stedisko kd (partial match)\n * @param {number} [params.organizace_id] - ID organizace\n * @param {number} [params.usek_id] - ID seku (automaticky aplikovn pro non-admin)\n * @returns {Promise<Object>} Response object\n * @returns {Array} return.faktury - Pole faktur (BE vrac ji naparsovan pole!)\n * @returns {Object} return.pagination - { page, per_page, total, total_pages }\n * @returns {Object} return.user_info - { is_admin, roles, usek_id, usek_zkr, filter_applied }\n * \n *  BE u parsuje JSON pole - NEN poteba volat JSON.parse()!\n * - fa_strediska_kod je ji array: [\"STR001\"] nebo []\n * - rozsirujici_data je ji object nebo null\n * - vytvoril_uzivatel_detail obsahuje kompletn info o uivateli\n */\nexport async function listInvoices25({ \n  token, \n  username, \n  page = 1, \n  per_page = 50, \n  year,\n  objednavka_id,\n  fa_dorucena,\n  fa_cislo_vema,\n  datum_od,\n  datum_do,\n  stredisko,\n  organizace_id,\n  usek_id,\n  filter_status,  // Dashboard filter (paid/unpaid/overdue/without_order/my_invoices)\n  search_term,    //  Globln vyhledvn\n  cislo_objednavky,  //  Sloupcov filtr - slo objednvky\n  filter_datum_vystaveni,  //  Sloupcov filtr - datum vystaven\n  filter_datum_splatnosti,  //  Sloupcov filtr - datum splatnosti\n  filter_stav,  //  Sloupcov filtr - stav faktury\n  filter_vytvoril_uzivatel,  //  Sloupcov filtr - uivatel\n  castka_min,  //  Sloupcov filtr - minimln stka\n  castka_max,  //  Sloupcov filtr - maximln stka\n  filter_ma_prilohy,  //  Sloupcov filtr - plohy\n  filter_vecna_kontrola,  //  Sloupcov filtr - vcn kontrola\n  filter_vecnou_provedl,  //  Sloupcov filtr - kdo provedl vcnou kontrolu\n  filter_predano_zamestnanec  //  Sloupcov filtr - pedno zamstnanci\n}) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  try {\n    // Sestaven payload s FLAT strukturou (filtry na top-level, NE v sub-objektu!)\n    const payload = {\n      token,\n      username,\n      page,\n      per_page\n    };\n\n    // Pidat voliteln filtry (pouze pokud jsou definovan)\n    if (year !== undefined) payload.year = year;\n    if (objednavka_id !== undefined) payload.objednavka_id = objednavka_id;\n    if (fa_dorucena !== undefined) payload.fa_dorucena = fa_dorucena;\n    if (fa_cislo_vema !== undefined) payload.fa_cislo_vema = fa_cislo_vema;\n    if (datum_od !== undefined) payload.datum_od = datum_od;\n    if (datum_do !== undefined) payload.datum_do = datum_do;\n    if (stredisko !== undefined) payload.stredisko = stredisko;\n    if (organizace_id !== undefined) payload.organizace_id = organizace_id;\n    if (usek_id !== undefined) payload.usek_id = usek_id;\n    if (filter_status !== undefined && filter_status !== '') payload.filter_status = filter_status;\n    \n    //  Globln vyhledvn\n    if (search_term !== undefined && search_term !== '') payload.search_term = search_term;\n    \n    //  Sloupcov filtry\n    if (cislo_objednavky !== undefined && cislo_objednavky !== '') payload.cislo_objednavky = cislo_objednavky;\n    if (filter_datum_vystaveni !== undefined && filter_datum_vystaveni !== '') payload.filter_datum_vystaveni = filter_datum_vystaveni;\n    if (filter_datum_splatnosti !== undefined && filter_datum_splatnosti !== '') payload.filter_datum_splatnosti = filter_datum_splatnosti;\n    if (filter_stav !== undefined && filter_stav !== '') payload.filter_stav = filter_stav;\n    if (filter_vytvoril_uzivatel !== undefined && filter_vytvoril_uzivatel !== '') payload.filter_vytvoril_uzivatel = filter_vytvoril_uzivatel;\n    \n    //  Filtry pro stku\n    if (castka_min !== undefined && castka_min !== '') payload.castka_min = castka_min;\n    if (castka_max !== undefined && castka_max !== '') payload.castka_max = castka_max;\n    \n    //  Filtr pro plohy\n    if (filter_ma_prilohy !== undefined && filter_ma_prilohy !== '') payload.filter_ma_prilohy = filter_ma_prilohy;\n    \n    //  Filtry pro vcnou kontrolu a pedn zamstnanci\n    if (filter_vecna_kontrola !== undefined && filter_vecna_kontrola !== '') payload.filter_vecna_kontrola = filter_vecna_kontrola;\n    if (filter_vecnou_provedl !== undefined && filter_vecnou_provedl !== '') payload.filter_vecnou_provedl = filter_vecnou_provedl;\n    if (filter_predano_zamestnanec !== undefined && filter_predano_zamestnanec !== '') payload.filter_predano_zamestnanec = filter_predano_zamestnanec;\n\n    const response = await api25invoices.post('invoices25/list', payload, {\n      timeout: 30000\n    });\n\n    if (response.status !== 200) {\n      throw new Error('Neoekvan kd odpovdi pi natn faktur');\n    }\n\n    const data = response.data;\n\n    // Kontrola chyb\n    if (data.status === 'error' || data.err || data.error) {\n      const errorMsg = data.message || data.err || data.error || 'Chyba pi natn faktur';\n      throw new Error(errorMsg);\n    }\n\n    //  Vrtit data podle BE dokumentace (status: \"ok\")\n    if (data.status === 'ok') {\n      return {\n        faktury: data.faktury || [],\n        pagination: data.pagination || { page: 1, per_page: 50, total: 0, total_pages: 0 },\n        statistiky: data.statistiky || null,\n        user_info: data.user_info || null\n      };\n    }\n\n    // Fallback - przdn data\n    return {\n      faktury: [],\n      pagination: { page: 1, per_page: 50, total: 0, total_pages: 0 },\n      statistiky: null,\n      user_info: null\n    };\n\n  } catch (error) {\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n/**\n * Nate faktury pro konkrtn objednvku\n * \n * POST /api.eeo/invoices25/by-order\n * \n * @param {Object} params - Parametry\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number} params.objednavka_id - ID objednvky\n * @returns {Promise<Array>} Pole faktur\n */\nexport async function getInvoicesByOrder25({ token, username, objednavka_id }) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  if (!objednavka_id) {\n    throw new Error('Chyb ID objednvky.');\n  }\n\n  try {\n    const payload = {\n      token,\n      username,\n      objednavka_id\n    };\n\n    const response = await api25invoices.post('invoices25/by-order', payload, {\n      timeout: 30000\n    });\n\n    if (response.status !== 200) {\n      throw new Error('Neoekvan kd odpovdi pi natn faktur objednvky');\n    }\n\n    const data = response.data;\n\n    // Kontrola chyb\n    if (data.status === 'error' || data.err || data.error) {\n      const errorMsg = data.message || data.err || data.error || 'Chyba pi natn faktur';\n      throw new Error(errorMsg);\n    }\n\n    // Vrtit pole faktur\n    return data.faktury || data.invoices || [];\n\n  } catch (error) {\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n/**\n * Nate detail konkrtn faktury\n * \n * POST /api.eeo/invoices25/by-id\n * \n * @param {Object} params - Parametry\n * @param {string} params.token - Auth token\n * @param {string} params.username - Username\n * @param {number} params.id - ID faktury\n * @returns {Promise<Object>} Detail faktury\n */\nexport async function getInvoiceById25({ token, username, id }) {\n  if (!token || !username) {\n    throw new Error('Chyb pstupov token nebo uivatelsk jmno. Pihlaste se prosm znovu.');\n  }\n\n  if (!id) {\n    throw new Error('Chyb ID faktury.');\n  }\n\n  try {\n    const payload = {\n      token,\n      username,\n      id\n    };\n\n    const response = await api25invoices.post('invoices25/by-id', payload, {\n      timeout: 10000\n    });\n\n    if (response.status !== 200) {\n      throw new Error('Neoekvan kd odpovdi pi natn faktury');\n    }\n\n    const data = response.data;\n\n    // Kontrola chyb\n    if (data.status === 'error' || data.err || data.error) {\n      const errorMsg = data.message || data.err || data.error || 'Chyba pi natn faktury';\n      throw new Error(errorMsg);\n    }\n\n    // Vrtit data faktury\n    return data;\n\n  } catch (error) {\n    throw new Error(normalizeApi25InvoicesError(error));\n  }\n}\n\n/**\n * Export vech funkc\n */\nexport default {\n  uploadInvoiceAttachment25,\n  listInvoiceAttachments25,\n  listOrderInvoiceAttachments25,\n  getInvoiceAttachmentById25,\n  downloadInvoiceAttachment25,\n  updateInvoiceAttachment25,\n  deleteInvoiceAttachment25,\n  deleteInvoice25,\n  createInvoiceWithAttachment25,\n  // Order V2 Invoice API (NEW)\n  createInvoiceWithAttachmentV2,\n  createInvoiceV2,\n  updateInvoiceV2,\n  deleteInvoiceV2,\n  // Invoice List API (NEW)\n  listInvoices25,\n  getInvoicesByOrder25,\n  getInvoiceById25,\n  // Utils\n  isAllowedInvoiceFileType,\n  isAllowedInvoiceFileSize,\n  isISDOCFile,\n  formatFileSize\n};\n","// Workflow constants for Order Management System 2025\n// Centralizovan definice stav a pechod pro objednvky\n\nexport const WORKFLOW_STATES = {\n  NOVA: {\n    code: 'NOVA',\n    name: 'Nov',\n    description: 'Objednvka je v pprav, viditeln pouze pro autora',\n    color: '#94a3b8',\n    icon: '',\n    phase: 'draft'\n  },\n  ODESLANA_KE_SCHVALENI: {\n    code: 'ODESLANA_KE_SCHVALENI',\n    name: 'Ke schvlen',\n    description: 'Objednvka byla odeslna a ek na akci schvalovatele',\n    color: '#f59e0b',\n    icon: '',\n    phase: 'approval'\n  },\n  SCHVALENA: {\n    code: 'SCHVALENA',\n    name: 'Schvlen',\n    description: 'Objednvka byla schvlena pslunm manaerem',\n    color: '#10b981',\n    icon: '',\n    phase: 'approved'\n  },\n  ZAMITNUTA: {\n    code: 'ZAMITNUTA',\n    name: 'Zamtnuta',\n    description: 'Objednvka byla schvalovatelem zamtnuta',\n    color: '#ef4444',\n    icon: '',\n    phase: 'rejected'\n  },\n  CEKA_POTVRZENI: {\n    code: 'CEKA_POTVRZENI',\n    name: 'ek na potvrzen',\n    description: 'Objednvka byla odeslna, ek na potvrzen dodavatele',\n    color: '#3b82f6',\n    icon: '',\n    phase: 'supplier_pending'\n  },\n  POTVRZENA: {\n    code: 'POTVRZENA',\n    name: 'Potvrzen dodavatelem',\n    description: 'Dodavatel potvrdil pijet a akceptaci objednvky',\n    color: '#059669',\n    icon: '',\n    phase: 'supplier_confirmed'\n  },\n  DOKONCENA: {\n    code: 'DOKONCENA',\n    name: 'Dokonen',\n    description: 'Zbo/sluba bylo dodno, proces je uzaven',\n    color: '#6b7280',\n    icon: '',\n    phase: 'completed'\n  },\n  ZRUSENA: {\n    code: 'ZRUSENA',\n    name: 'Zruena',\n    description: 'Objednvka byla stornovna ped dokonenm',\n    color: '#9ca3af',\n    icon: '',\n    phase: 'cancelled'\n  },\n  ROZPRACOVANA: {\n    code: 'ROZPRACOVANA',\n    name: 'Rozpracovan',\n    description: 'Schvlen objednvka je v procesu zpracovn',\n    color: '#8b5cf6',\n    icon: '',\n    phase: 'in_progress'\n  }\n};\n\n// Povolen pechody mezi stavy\nexport const WORKFLOW_TRANSITIONS = {\n  NOVA: ['ODESLANA_KE_SCHVALENI', 'ZRUSENA'],\n  ODESLANA_KE_SCHVALENI: ['SCHVALENA', 'ZAMITNUTA', 'NOVA'], // vrcen k prav\n  SCHVALENA: ['CEKA_POTVRZENI', 'DOKONCENA', 'ZRUSENA', 'ROZPRACOVANA'],\n  ZAMITNUTA: ['NOVA', 'ZRUSENA'], // monost opravy\n  CEKA_POTVRZENI: ['POTVRZENA', 'ZRUSENA'],\n  POTVRZENA: ['DOKONCENA', 'ZRUSENA'],\n  ROZPRACOVANA: ['CEKA_POTVRZENI', 'DOKONCENA', 'ZRUSENA'],\n  DOKONCENA: [], // finln stav\n  ZRUSENA: [] // finln stav\n};\n\n// Fze workflow pro UI logiku\nexport const WORKFLOW_PHASES = {\n  DRAFT: 'draft',           // NOVA\n  APPROVAL: 'approval',     // ODESLANA_KE_SCHVALENI\n  APPROVED: 'approved',     // SCHVALENA\n  REJECTED: 'rejected',     // ZAMITNUTA\n  SUPPLIER_PENDING: 'supplier_pending',   // CEKA_POTVRZENI\n  SUPPLIER_CONFIRMED: 'supplier_confirmed', // POTVRZENA\n  IN_PROGRESS: 'in_progress',  // ROZPRACOVANA\n  COMPLETED: 'completed',   // DOKONCENA\n  CANCELLED: 'cancelled'    // ZRUSENA\n};\n\n// Mapovn stav na fze\nexport const getWorkflowPhase = (stateCode) => {\n  const state = WORKFLOW_STATES[stateCode];\n  return state ? state.phase : 'draft';\n};\n\n// Kontrola povolench pechod\nexport const canTransitionTo = (fromState, toState) => {\n  const allowedTransitions = WORKFLOW_TRANSITIONS[fromState] || [];\n  return allowedTransitions.includes(toState);\n};\n\n// Validace povinnch pol podle stavu workflow\nexport const getRequiredFields = (workflowCode) => {\n  //  Financovn je povinn ve vech fzch od zatku\n  //  OPRAVA: prikazce_id a garant_uzivatel_id jsou povinn u v NOVA fzi (formul je oznauje jako required)\n  const baseFields = ['predmet', 'max_cena_s_dph', 'strediska_kod', 'zpusob_financovani', 'prikazce_id', 'garant_uzivatel_id'];\n\n  switch (workflowCode) {\n    case 'NOVA':\n      return baseFields;\n\n    case 'ODESLANA_KE_SCHVALENI':\n      return [\n        ...baseFields,\n        'garant_uzivatel_id',\n        'prikazce_id',\n        'jmeno',\n        'email'\n      ];\n\n    case 'SCHVALENA':\n      return [\n        ...baseFields,\n        'garant_uzivatel_id',\n        'prikazce_id',\n        'jmeno',\n        'email',\n        'schvalovatel_id',\n        'dt_schvaleni',\n        // Fze 3 - Povinn pole pro dodavatele\n        'dodavatel_nazev',\n        'dodavatel_adresa', // v DB je dodavatel_adresa, ne dodavatel_sidlo\n        'dodavatel_ico',\n        // dodavatel_dic nen povinn\n        // dodavatel_zastoupeny nen povinn\n        // kontaktn adresa nen povinn (dodavatel_kontakt_*)\n        'druh_objednavky_kod', // v DB je druh_objednavky_kod\n        'polozky_objednavky' // min. 1 poloka s povinnmi poli\n      ];\n\n    case 'CEKA_POTVRZENI':\n      return [\n        ...baseFields,\n        'garant_uzivatel_id',\n        'prikazce_id',\n        'jmeno',\n        'email',\n        'dodavatel_nazev',\n        'dodavatel_kontakt'\n      ];\n\n    default:\n      return baseFields;\n  }\n};\n\n// Sekce formule viditeln podle stavu workflow\nexport const getVisibleSections = (workflowCode) => {\n  const baseSections = ['objednatel', 'schvaleni'];\n\n  switch (workflowCode) {\n    case 'NOVA':\n      return baseSections;\n\n    case 'ODESLANA_KE_SCHVALENI':\n      return baseSections;\n\n    case 'SCHVALENA':\n    case 'CEKA_POTVRZENI':\n    case 'POTVRZENA':\n    case 'DOKONCENA':\n      return [\n        ...baseSections,\n        'financovani',\n        'dodavatel',\n        'kontakt',\n        'detaily',\n        'dodaci_podminky',\n        'stav_odeslani'\n      ];\n\n    case 'ZAMITNUTA':\n      return baseSections;\n\n    case 'ZRUSENA':\n      return [...baseSections, 'stav_odeslani'];\n\n    default:\n      return baseSections;\n  }\n};\n\n// Helper funkce pro zskn informac o stavu\nexport const getWorkflowInfo = (stateCode) => {\n  return WORKFLOW_STATES[stateCode] || WORKFLOW_STATES.NOVA;\n};\n\n// Export vech stav jako pole pro selecty\nexport const WORKFLOW_STATES_ARRAY = Object.values(WORKFLOW_STATES);","\n// Utility functions for workflow management in OrderForm25\nimport {\n  WORKFLOW_STATES,\n  WORKFLOW_PHASES,\n  getWorkflowPhase,\n  canTransitionTo,\n  getRequiredFields,\n  getVisibleSections,\n  getWorkflowInfo\n} from '../constants/workflow25';\n\n// Mapa pro peklad systmovch nzv pol na lidsky iteln labely\nconst FIELD_LABELS = {\n  predmet: 'Pedmt objednvky',\n  garant_uzivatel_id: 'Garant',\n  prikazce_id: 'Pkazce',\n  max_cena_s_dph: 'Maximln cena s DPH',\n  strediska_kod: 'Stedisko',\n  jmeno: 'Jmno objednatele',\n  email: 'E-mail objednatele',\n  dodavatel_nazev: 'Nzev dodavatele',\n  dodavatel_adresa: 'Adresa dodavatele',\n  dodavatel_ico: 'IO dodavatele',\n  dodavatel_kontakt: 'Kontakt na dodavatele',\n  druh_objednavky_kod: 'Druh objednvky',\n  polozky_objednavky: 'Poloky objednvky',\n  zpusob_financovani: 'Zpsob financovn',\n  lp_kod: 'LP kd',\n  cislo_smlouvy: 'slo smlouvy',\n  smlouva_poznamka: 'Poznmka ke smlouv',\n  individualni_schvaleni: 'Identifiktor schvlen',\n  individualni_poznamka: 'Poznmka k schvlen',\n  pojistna_udalost_cislo: 'slo pojistn udlosti',\n  pojistna_udalost_poznamka: 'Poznmka k pojistn udlosti',\n  datum_odeslani: 'Datum odesln',\n  schvaleni_komentar: 'Koment',\n  odeslani_storno_duvod: 'Dvod stornovn',\n  dodavatel_zpusob_potvrzeni: 'Zpsob potvrzen',\n  zpusob_platby: 'Zpsob platby',\n  dt_akceptace: 'Datum akceptace',\n  dt_zverejneni: 'Datum zveejnn (VZ)',\n  registr_iddt: 'Identifiktor IDDT',\n  ma_byt_zverejnena: 'Zveejnn'\n};\n\n/**\n * Validates form data based on current workflow state\n * @param {Object} formData - Current form data\n * @param {string} workflowCode - Current workflow state code\n * @param {Object} sectionStates - Optional object with section visibility and lock states\n *   e.g. { phase1: { visible: true, locked: false }, phase3: { visible: true, locked: true } }\n * @returns {Object} - Validation errors object\n */\nexport const validateWorkflowData = (formData, workflowCode = 'NOVA', sectionStates = null) => {\n  const errors = {};\n  const requiredFields = getRequiredFields(workflowCode);\n\n  // Helper: Ur, zda validovat pole podle fze/sekce\n  const shouldValidateField = (fieldPhase, fieldName) => {\n    if (!sectionStates || !fieldPhase) return true; // Pokud nemme info o sekcch, validuj vdy\n\n    const sectionState = sectionStates[fieldPhase];\n    if (!sectionState) return true; // Pokud sekce nen definovna, validuj\n\n    //  VJIMKY: Tato pole se VDY validuj i kdy je sekce zamen\n    // Dvod: Jsou to KRITICK pole kter mus bt vyplnn pro uloen objednvky\n    const alwaysValidateFields = [\n      'dodavatel_nazev', 'dodavatel_adresa', 'dodavatel_ico', 'dodavatel_kontakt', // Dodavatel\n      'prikazce_id', 'max_cena_s_dph', 'garant_uzivatel_id', 'predmet', 'strediska_kod' // Schvlen PO - FZE 1\n    ];\n    if (alwaysValidateFields.includes(fieldName)) {\n      const shouldValidate = sectionState.visible;\n      return shouldValidate; // Validuj pokud je sekce viditeln (ignoruj locked)\n    }\n\n    // VALIDOVAT: Sekce je viditeln A odemen\n    // NEVALIDOVAT: Sekce nen viditeln NEBO je zamen\n    const shouldValidate = sectionState.visible && !sectionState.locked;\n    return shouldValidate;\n  };\n\n  // Mapa pole  fze/sekce (pro kontrolu viditelnosti a zamen)\n  const FIELD_TO_PHASE = {\n    // Fze 1: Zkladn daje\n    predmet: 'phase1',\n    garant_uzivatel_id: 'phase1',\n    prikazce_id: 'phase1',\n    max_cena_s_dph: 'phase1',\n    strediska_kod: 'phase1',\n    jmeno: 'phase1',\n    email: 'phase1',\n\n    // Financovn: Samostatn sekce (viditeln ve FZI 1, validovan podle svho stavu)\n    zpusob_financovani: 'financovani',\n    lp_kod: 'financovani',\n    cislo_smlouvy: 'financovani',\n    smlouva_poznamka: 'financovani',\n    individualni_schvaleni: 'financovani',\n    individualni_poznamka: 'financovani',\n    pojistna_udalost_cislo: 'financovani',\n    pojistna_udalost_poznamka: 'financovani',\n\n    // Fze 3: Dodavatel a poloky\n    dodavatel_nazev: 'phase3',\n    dodavatel_adresa: 'phase3',\n    dodavatel_ico: 'phase3',\n    dodavatel_kontakt: 'phase3',\n    druh_objednavky_kod: 'phase3',\n    polozky_objednavky: 'phase3',\n\n    // Fze 4-6: Odesln a potvrzen\n    datum_odeslani: 'phase4to6',\n    dodavatel_zpusob_potvrzeni: 'phase4to6',\n    zpusob_platby: 'phase4to6',\n    dt_akceptace: 'phase4to6',\n\n    // Fze 2: Schvlen\n    schvaleni_komentar: 'phase2',\n    odeslani_storno_duvod: 'phase2'\n  };\n\n  // Zkontroluj, zda je vybran Pokladna jako zpsob financovn\n  // Pokud ano, pesko validaci dodavatele\n  const isPokladnaFinancing = (() => {\n    const zpusob = formData.zpusob_financovani;\n    if (!zpusob) return false;\n    // Me bt string nebo objekt - kontroluj nazev_stavu nebo nazev\n    if (typeof zpusob === 'string') {\n      return zpusob.toLowerCase().includes('pokladna');\n    }\n    if (typeof zpusob === 'object' && zpusob !== null) {\n      const nazev = zpusob.nazev_stavu || zpusob.nazev || '';\n      return nazev.toLowerCase().includes('pokladna');\n    }\n    return false;\n  })();\n\n  requiredFields.forEach(field => {\n    // Zjisti, ve kter fzi/sekci pole je\n    const fieldPhase = FIELD_TO_PHASE[field];\n\n    //  NOV LOGIKA: Validuj pouze pokud je sekce viditeln a odemen\n    if (!shouldValidateField(fieldPhase, field)) {\n      return; // Pesko validaci - sekce je neviditeln nebo zamen\n    }\n\n    // Skip dodavatel fields kdy je vybran Pokladna\n    if (isPokladnaFinancing && ['dodavatel_nazev', 'dodavatel_adresa', 'dodavatel_ico', 'dodavatel_kontakt'].includes(field)) {\n      return; // Pesko validaci tohoto pole\n    }\n\n    switch (field) {\n      case 'predmet':\n        if (!formData.predmet?.trim()) {\n          errors.predmet = `${FIELD_LABELS.predmet} je povinn - zadejte strun popis toho, co objednvte`;\n        }\n        break;\n\n      case 'max_cena_s_dph':\n        if (!formData.max_cena_s_dph || formData.max_cena_s_dph <= 0) {\n          errors.max_cena_s_dph = `${FIELD_LABELS.max_cena_s_dph} je povinn - zadejte pedpokldanou celkovou cenu vetn DPH`;\n        }\n        break;\n\n      case 'strediska_kod':\n        if (!formData.strediska_kod ||\n            (Array.isArray(formData.strediska_kod) && formData.strediska_kod.length === 0)) {\n          errors.strediska_kod = `${FIELD_LABELS.strediska_kod} - vyberte alespo jedno stedisko, ke ktermu se objednvka vztahuje`;\n        }\n        break;\n\n      case 'garant_uzivatel_id':\n        if (!formData.garant_uzivatel_id || formData.garant_uzivatel_id === '') {\n          errors.garant_uzivatel_id = `${FIELD_LABELS.garant_uzivatel_id} je povinn - vyberte osobu zodpovdnou za objednvku`;\n        }\n        break;\n\n      case 'prikazce_id':\n        if (!formData.prikazce_id || formData.prikazce_id === '') {\n          errors.prikazce_id = `${FIELD_LABELS.prikazce_id} je povinn - vyberte osobu, kter schvaluje objednvku`;\n        }\n        break;\n\n      case 'jmeno':\n        if (!formData.jmeno?.trim() || formData.jmeno === 'Neuvedeno') {\n          errors.jmeno = `${FIELD_LABELS.jmeno} je povinn - zkontrolujte sv uivatelsk daje`;\n        }\n        break;\n\n      case 'email':\n        if (!formData.email?.trim()) {\n          errors.email = `${FIELD_LABELS.email} je povinn - zadejte platnou e-mailovou adresu`;\n        } else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)) {\n          errors.email = 'E-mail m neplatn formt - zkontrolujte, zda obsahuje @ a domnu';\n        }\n        break;\n\n      case 'dodavatel_nazev':\n        if (!formData.dodavatel_nazev?.trim()) {\n          errors.dodavatel_nazev = `${FIELD_LABELS.dodavatel_nazev} je povinn - zadejte nzev firmy dodavatele`;\n        }\n        break;\n\n      case 'dodavatel_adresa':\n        // Formul i DB pouvaj dodavatel_adresa\n        if (!formData.dodavatel_adresa?.trim()) {\n          errors.dodavatel_adresa = `${FIELD_LABELS.dodavatel_adresa} je povinn - zadejte plnou adresu dodavatele`;\n        }\n        break;\n\n      case 'dodavatel_ico':\n        if (!formData.dodavatel_ico?.trim()) {\n          errors.dodavatel_ico = `${FIELD_LABELS.dodavatel_ico} je povinn - zadejte IO dodavatele (8 slic)`;\n        }\n        break;\n\n      case 'druh_objednavky_kod':\n        if (!formData.druh_objednavky_kod?.trim()) {\n          errors.druh_objednavky_kod = `${FIELD_LABELS.druh_objednavky_kod} je povinn - vyberte typ objednvky`;\n        }\n        break;\n\n      case 'polozky_objednavky':\n        if (!formData.polozky_objednavky || formData.polozky_objednavky.length === 0) {\n          errors.polozky_objednavky = `${FIELD_LABELS.polozky_objednavky} - pidejte alespo jednu poloku s nzvem a cenou`;\n        } else {\n          // Validace jednotlivch poloek\n          let hasItemError = false;\n          formData.polozky_objednavky.forEach((polozka, index) => {\n            // Nzev/popis je povinn (formul i DB: popis)\n            if (!polozka.popis?.trim()) {\n              errors[`polozka_${index}_popis`] = `Poloka ${index + 1}: Vyplte nzev nebo popis poloky`;\n              hasItemError = true;\n            }\n            // Cena bez DPH je povinn\n            if (!polozka.cena_bez_dph || parseFloat(polozka.cena_bez_dph) <= 0) {\n              errors[`polozka_${index}_cena_bez_dph`] = `Poloka ${index + 1}: Zadejte cenu bez DPH (mus bt vt ne 0)`;\n              hasItemError = true;\n            }\n            // Cena s DPH je povinn\n            if (!polozka.cena_s_dph || parseFloat(polozka.cena_s_dph) <= 0) {\n              errors[`polozka_${index}_cena_s_dph`] = `Poloka ${index + 1}: Zadejte cenu s DPH (mus bt vt ne 0)`;\n              hasItemError = true;\n            }\n            // DPH sazba nen povinn, m vchoz hodnotu (formul i DB: sazba_dph)\n          });\n          if (hasItemError) {\n            errors.polozky_objednavky = 'Nkter poloky obsahuj chyby - zkontrolujte nzev a ceny vech poloek';\n          }\n        }\n        break;\n\n      case 'dodavatel_kontakt':\n        if (!formData.dodavatel_kontakt?.trim()) {\n          errors.dodavatel_kontakt = `${FIELD_LABELS.dodavatel_kontakt} je povinn - zadejte e-mail nebo telefon na dodavatele`;\n        }\n        break;\n\n      case 'druh_objednavky':\n        // Legacy podpora druh_objednavky - mapuje na druh_objednavky_kod\n        if (!formData.druh_objednavky_kod?.trim()) {\n          errors.druh_objednavky_kod = `${FIELD_LABELS.druh_objednavky_kod} je povinn - vyberte typ objednvky`;\n        }\n        break;\n\n      case 'financovani':\n      case 'zpusob_financovani':\n        //  Validace zpsobu financovn (formData obsahuje STRING kd typu financovn)\n        // Formt: formData.zpusob_financovani = \"LP\" | \"POKLADNA\" | \"SMLOUVA\" | \"DOTACE\" atd.\n        if (!formData.zpusob_financovani ||\n            (typeof formData.zpusob_financovani === 'string' && !formData.zpusob_financovani.trim())) {\n          errors.zpusob_financovani = `${FIELD_LABELS.zpusob_financovani} je povinn - vyberte zdroj financovn`;\n        }\n        break;\n\n      case 'lp_kod':\n        if (!formData.lp_kod ||\n            (Array.isArray(formData.lp_kod) ? formData.lp_kod.length === 0 :\n             (typeof formData.lp_kod === 'string' ? !formData.lp_kod.trim() : !formData.lp_kod))) {\n          errors.lp_kod = `${FIELD_LABELS.lp_kod} je povinn - vyberte limitovan pslib pro financovn`;\n        }\n        break;\n\n      case 'cislo_smlouvy':\n        //  Podmnn validace - pouze pokud je vybran \"Smlouva\" jako zpsob financovn\n        // Tato validace se provd dynamicky v OrderForm25.js (dek 13246)\n        if (!formData.cislo_smlouvy?.trim()) {\n          errors.cislo_smlouvy = `${FIELD_LABELS.cislo_smlouvy} je povinn - zadejte evidenn slo smlouvy`;\n        }\n        break;\n\n      case 'individualni_schvaleni':\n        //  Podmnn validace - pouze pokud je vybran \"Individuln schvlen\"\n        // Tato validace se provd dynamicky v OrderForm25.js (dek 13252)\n        if (!formData.individualni_schvaleni?.trim()) {\n          errors.individualni_schvaleni = `${FIELD_LABELS.individualni_schvaleni} je povinn - zadejte identifiktor schvlen`;\n        }\n        break;\n\n      case 'pojistna_udalost_cislo':\n        //  Podmnn validace - pouze pokud je vybran \"Pojistn udlost\"\n        // Tato validace se provd dynamicky v OrderForm25.js (dek 13263)\n        if (!formData.pojistna_udalost_cislo?.trim()) {\n          errors.pojistna_udalost_cislo = `${FIELD_LABELS.pojistna_udalost_cislo} je povinn - zadejte slo pojistn udlosti`;\n        }\n        break;\n\n      // Poznmkov pole k financovn - nejsou povinn, proto nen validace\n      case 'smlouva_poznamka':\n      case 'individualni_poznamka':\n      case 'pojistna_udalost_poznamka':\n        // Poznmky nejsou povinn - peskoit validaci\n        break;\n\n      default:\n        break;\n    }\n  });\n\n  // Speciln validace podle stavu\n  if (workflowCode === 'ZAMITNUTA' && !formData.schvaleni_komentar?.trim()) {\n    errors.schvaleni_komentar = `${FIELD_LABELS.schvaleni_komentar} - uvete dvod zamtnut objednvky`;\n  }\n\n  // Validace komente kdy je zobrazen (neschvleno nebo ek se)\n  if ((formData.stav_schvaleni === 'neschvaleno' || formData.stav_schvaleni === 'ceka_se') &&\n      !formData.schvaleni_komentar?.trim()) {\n    errors.schvaleni_komentar = formData.stav_schvaleni === 'neschvaleno'\n      ? `${FIELD_LABELS.schvaleni_komentar} - vysvtlete, pro objednvku neschvalujete`\n      : `${FIELD_LABELS.schvaleni_komentar} - uvete dvod odloen schvlen`;\n  }\n\n  // Validace stavu odesln a data\n  if (formData.stav_odeslani && formData.stav_odeslani.trim() !== '') {\n    if (!formData.datum_odeslani?.trim()) {\n      errors.datum_odeslani = `${FIELD_LABELS.datum_odeslani} je povinn pi vybranm stavu odesln`;\n    }\n  }\n\n  // Validace stornovn - dvod je povinn pi stornovn\n  if (formData.stav_stornovano) {\n    if (!formData.odeslani_storno_duvod?.trim()) {\n      errors.odeslani_storno_duvod = `${FIELD_LABELS.odeslani_storno_duvod} je povinn - uvete, pro objednvku stornujete`;\n    }\n  }\n\n  //  VALIDACE ZVEEJNN V REGISTRU SMLUV\n  // Pokud je checkbox \"M bt zveejnna\" zakrtnut, pak jsou POVINN:\n  // - dt_zverejneni (Datum zveejnn VZ)\n  // - registr_iddt (Identifiktor IDDT)\n  if (formData.ma_byt_zverejnena === true || formData.ma_byt_zverejnena === 1) {\n    // Zkontroluj, zda je sekce registr_smluv_vyplneni viditeln a odemen\n    const registrSection = sectionStates?.registr_smluv_vyplneni;\n    const shouldValidateRegistr = !registrSection || (registrSection.visible && !registrSection.locked);\n    \n    if (shouldValidateRegistr) {\n      if (!formData.dt_zverejneni || !String(formData.dt_zverejneni).trim()) {\n        errors.dt_zverejneni = 'Datum zveejnn je povinn kdy m bt objednvka zveejnna';\n      }\n      if (!formData.registr_iddt || !String(formData.registr_iddt).trim()) {\n        errors.registr_iddt = 'Identifiktor IDDT je povinn kdy m bt objednvka zveejnna';\n      }\n    }\n  }\n\n  // Validace stavu fakturace a data\n  if (formData.stav_fakturace && formData.stav_fakturace.trim() !== '') {\n    if (!formData.datum_fakturace?.trim()) {\n      errors.datum_fakturace = `${FIELD_LABELS.datum_fakturace} je povinn pi vybranm stavu fakturace`;\n    }\n\n    // Validace sla faktury\n    if (!formData.cislo_faktury?.trim()) {\n      errors.cislo_faktury = `${FIELD_LABELS.cislo_faktury} je povinn - zadejte slo pijat faktury`;\n    }\n\n    // Validace stek fakturace\n    if (!formData.fakturovana_cena_bez_dph || parseFloat(formData.fakturovana_cena_bez_dph) <= 0) {\n      errors.fakturovana_cena_bez_dph = `${FIELD_LABELS.fakturovana_cena_bez_dph} je povinn a mus bt vt ne 0 - zadejte stku z faktury bez DPH`;\n    }\n    if (!formData.fakturovana_cena_s_dph || parseFloat(formData.fakturovana_cena_s_dph) <= 0) {\n      errors.fakturovana_cena_s_dph = `${FIELD_LABELS.fakturovana_cena_s_dph} je povinn a mus bt vt ne 0 - zadejte celkovou stku z faktury vetn DPH`;\n    }\n  }\n\n  return errors;\n};\n\n/**\n * Determines which sections should be visible based on workflow state and order phase\n * @param {string} workflowCode - Current workflow state code\n * @param {number} orderPhase - Current order phase (1 = NOV, 2 = PO SCHVLEN)\n * @returns {Object} - Object with section visibility flags\n */\nexport const getSectionVisibility = (workflowCode = 'NOVA', orderPhase = 1, isArchived = false) => {\n  //  ARCHIVOVAN OBJEDNVKY: Zobraz VECHNY sekce\n  if (isArchived) {\n    return {\n      objednatel: true,\n      schvaleni: true,\n      financovani: true,\n      dodavatel: true,\n      kontakt: true,\n      detaily: true,\n      dodaci_podminky: true,\n      stav_odeslani: true\n    };\n  }\n\n  const visibleSections = getVisibleSections(workflowCode);\n\n  // Zkladn sekce viditeln vdy\n  const baseVisibility = {\n    objednatel: visibleSections.includes('objednatel'),\n    schvaleni: visibleSections.includes('schvaleni')\n  };\n\n  //  Rozen sekce\n  // Financovn: Viditeln od FZE 1 (soust sekce Schvlen PO)\n  // Ostatn sekce: Viditeln od FZE 2/8 (ODESLANA_KE_SCHVALENI - po uloen do DB)\n  const extendedVisibility = {\n    financovani: visibleSections.includes('financovani'), //  Financovn viditeln VDY (je soust sekce Schvlen PO ve FZI 1)\n    dodavatel: orderPhase >= 2 && visibleSections.includes('dodavatel'),\n    kontakt: orderPhase >= 2 && visibleSections.includes('kontakt'),\n    detaily: orderPhase >= 2 && visibleSections.includes('detaily'),\n    dodaci_podminky: orderPhase >= 2 && visibleSections.includes('dodaci_podminky'),\n    stav_odeslani: orderPhase >= 2 && visibleSections.includes('stav_odeslani')\n  };\n\n  return {\n    ...baseVisibility,\n    ...extendedVisibility\n  };\n};\n\n/**\n * Determines which fields should be editable based on workflow state and user permissions\n * @param {string} workflowCode - Current workflow state code\n * @param {Object} userPermissions - User permissions object\n * @param {string} currentUserId - Current user ID\n * @param {string} orderAuthorId - Order author ID\n * @returns {Object} - Object with field editability flags\n */\nexport const getFieldEditability = (workflowCode, userPermissions = {}, currentUserId, orderAuthorId) => {\n  const phase = getWorkflowPhase(workflowCode);\n  const isAuthor = currentUserId === orderAuthorId;\n  const canApprove = userPermissions.ORDER_APPROVE || userPermissions.hasPermission?.('ORDER_APPROVE');\n  const canEdit = userPermissions.ORDER_EDIT || userPermissions.hasPermission?.('ORDER_EDIT');\n\n  switch (phase) {\n    case 'draft':\n      // Nov - autor me editovat ve\n      return {\n        basic_info: isAuthor,\n        approval_section: false,\n        extended_sections: false,\n        workflow_actions: isAuthor\n      };\n\n    case 'approval':\n      // ek na schvlen - pouze schvalovatel me mnit stav schvlen\n      return {\n        basic_info: false,\n        approval_section: canApprove,\n        extended_sections: false,\n        workflow_actions: canApprove\n      };\n\n    case 'approved':\n      // Schvleno - rozen sekce editovateln, zkladn info uzameno\n      return {\n        basic_info: false,\n        approval_section: canApprove, // monost vrtit ke schvlen\n        extended_sections: canEdit || isAuthor,\n        workflow_actions: canEdit || canApprove\n      };\n\n    case 'rejected':\n      // Zamtnuto - autor me editovat a poslat znovu\n      return {\n        basic_info: isAuthor,\n        approval_section: false,\n        extended_sections: false,\n        workflow_actions: isAuthor\n      };\n\n    case 'supplier_pending':\n    case 'supplier_confirmed':\n      // U dodavatele - omezen editace\n      return {\n        basic_info: false,\n        approval_section: false,\n        extended_sections: canEdit,\n        workflow_actions: canEdit\n      };\n\n    case 'completed':\n    case 'cancelled':\n      // Finln stavy - pouze ten\n      return {\n        basic_info: false,\n        approval_section: false,\n        extended_sections: false,\n        workflow_actions: false\n      };\n\n    default:\n      return {\n        basic_info: false,\n        approval_section: false,\n        extended_sections: false,\n        workflow_actions: false\n      };\n  }\n};\n\n/**\n * Gets available workflow actions based on current state and user permissions\n * @param {string} workflowCode - Current workflow state code\n * @param {Object} userPermissions - User permissions object\n * @param {string} currentUserId - Current user ID\n * @param {string} orderAuthorId - Order author ID\n * @returns {Array} - Array of available actions\n */\nexport const getAvailableActions = (workflowCode, userPermissions = {}, currentUserId, orderAuthorId) => {\n  const phase = getWorkflowPhase(workflowCode);\n  const isAuthor = currentUserId === orderAuthorId;\n  const canApprove = userPermissions.ORDER_APPROVE || userPermissions.hasPermission?.('ORDER_APPROVE');\n  const canEdit = userPermissions.ORDER_EDIT || userPermissions.hasPermission?.('ORDER_EDIT');\n\n  const actions = [];\n\n  switch (phase) {\n    case 'draft':\n      if (isAuthor) {\n        actions.push({\n          code: 'SEND_FOR_APPROVAL',\n          label: 'Odeslat ke schvlen',\n          targetState: 'ODESLANA_KE_SCHVALENI',\n          color: '#f59e0b',\n          icon: ''\n        });\n        actions.push({\n          code: 'SAVE_DRAFT',\n          label: 'Uloit koncept',\n          targetState: 'NOVA',\n          color: '#6b7280',\n          icon: ''\n        });\n      }\n      break;\n\n    case 'approval':\n      if (canApprove) {\n        actions.push({\n          code: 'APPROVE',\n          label: 'Schvlit',\n          targetState: 'SCHVALENA',\n          color: '#10b981',\n          icon: ''\n        });\n        actions.push({\n          code: 'REJECT',\n          label: 'Zamtnout',\n          targetState: 'ZAMITNUTA',\n          color: '#ef4444',\n          icon: ''\n        });\n        actions.push({\n          code: 'RETURN_TO_AUTHOR',\n          label: 'Vrtit k prav',\n          targetState: 'NOVA',\n          color: '#6b7280',\n          icon: ''\n        });\n      }\n      break;\n\n    case 'approved':\n      if (canEdit || isAuthor) {\n        actions.push({\n          code: 'SEND_TO_SUPPLIER',\n          label: 'Odeslat dodavateli',\n          targetState: 'CEKA_POTVRZENI',\n          color: '#3b82f6',\n          icon: ''\n        });\n      }\n      if (canApprove) {\n        actions.push({\n          code: 'REOPEN_APPROVAL',\n          label: 'Znovu ke schvlen',\n          targetState: 'ODESLANA_KE_SCHVALENI',\n          color: '#f59e0b',\n          icon: ''\n        });\n      }\n      break;\n\n    case 'rejected':\n      if (isAuthor) {\n        actions.push({\n          code: 'RESUBMIT',\n          label: 'Poslat znovu ke schvlen',\n          targetState: 'ODESLANA_KE_SCHVALENI',\n          color: '#f59e0b',\n          icon: ''\n        });\n        actions.push({\n          code: 'EDIT_DRAFT',\n          label: 'Upravit koncept',\n          targetState: 'NOVA',\n          color: '#6b7280',\n          icon: ''\n        });\n      }\n      break;\n\n    case 'supplier_pending':\n      if (canEdit) {\n        actions.push({\n          code: 'CONFIRM_SUPPLIER',\n          label: 'Potvrdit od dodavatele',\n          targetState: 'POTVRZENA',\n          color: '#059669',\n          icon: ''\n        });\n      }\n      break;\n\n    case 'supplier_confirmed':\n      if (canEdit) {\n        actions.push({\n          code: 'COMPLETE',\n          label: 'Dokonit objednvku',\n          targetState: 'DOKONCENA',\n          color: '#6b7280',\n          icon: ''\n        });\n      }\n      break;\n  }\n\n  // Vechny stavy krom finlnch umouj zruen\n  if (!['completed', 'cancelled'].includes(phase) && (canEdit || isAuthor)) {\n    actions.push({\n      code: 'CANCEL',\n      label: 'Zruit objednvku',\n      targetState: 'ZRUSENA',\n      color: '#9ca3af',\n      icon: '',\n      confirmRequired: true\n    });\n  }\n\n  return actions;\n};\n\n/**\n * Formats workflow state for display\n * @param {string} workflowCode - Workflow state code\n * @returns {Object} - Formatted state info for UI\n */\nexport const formatWorkflowState = (workflowCode) => {\n  const info = getWorkflowInfo(workflowCode);\n  return {\n    code: info.code,\n    name: info.name,\n    description: info.description,\n    color: info.color,\n    icon: info.icon,\n    phase: info.phase\n  };\n};\n\n/**\n * Gets human-readable label for a field\n * @param {string} fieldName - Field name\n * @returns {string} - Human-readable label\n */\nexport const getFieldLabel = (fieldName) => {\n  return FIELD_LABELS[fieldName] || fieldName;\n};\n\nexport default {\n  validateWorkflowData,\n  getSectionVisibility,\n  getFieldEditability,\n  getAvailableActions,\n  formatWorkflowState,\n  getFieldLabel\n};","/**\n *  useFormController Hook\n * MASTER HOOK - d celou inicializaci a lifecycle formule\n */\n\nimport { useCallback, useEffect, useRef } from 'react';\nimport { useFormLifecycle } from './useFormLifecycle';\nimport { useDictionaries } from './useDictionaries';\nimport { useOrderDataLoader } from './useOrderDataLoader';\nimport { useUIState } from './useUIState';\nimport { LIFECYCLE_PHASES } from '../reducers';\n\n//  COMPONENT INSTANCE TRACKING\n// Kad instance formule m vlastn ID\n// Window flag obsahuje ID aktuln bc inicializace\nif (typeof window !== 'undefined') {\n  if (!window.__orderFormCurrentInstanceId) {\n    window.__orderFormCurrentInstanceId = null;\n  }\n  if (!window.__orderFormInitInProgress) {\n    window.__orderFormInitInProgress = false;\n  }\n}\n\nexport const useFormController = ({\n  token,\n  username,\n  userId,\n  editOrderId,\n  archivovanoParam,\n  onDataLoaded, // Callback kdy jsou data natena\n  onError, // Callback pi chyb\n  onReady // Callback kdy je formul ready\n}) => {\n  const lifecycle = useFormLifecycle();\n  const dictionaries = useDictionaries({ token, username, enabled: true });\n  const orderDataLoader = useOrderDataLoader({ token, username, dictionaries });\n  const ui = useUIState();\n\n  //  Vytvo uniktn ID pro tuto instanci komponenty\n  const instanceIdRef = useRef(`form_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`);\n\n  //  Ref-based lock pro prevenci duplicitn inicializace\n  const initLockRef = useRef(false);\n  const cleanupRef = useRef(false);\n  const hasInitializedRef = useRef(false); //  Ref pro tracking zda u probhla inicializace\n  const isMountedRef = useRef(true); //  Tracking mounting state\n  const strictModeUnmountRef = useRef(false); //  Detekce StrictMode unmount\n\n  //  REFS pro useEffect - zabrnit opakovanmu voln\n  const lifecycleRef = useRef();\n  const dictionariesRef = useRef();\n  const orderDataLoaderRef = useRef();\n  const onDataLoadedRef = useRef();\n  const onErrorRef = useRef();\n  const onReadyRef = useRef();\n\n  // Update refs pi kadm renderu\n  lifecycleRef.current = lifecycle;\n  dictionariesRef.current = dictionaries;\n  orderDataLoaderRef.current = orderDataLoader;\n  onDataLoadedRef.current = onDataLoaded;\n  onErrorRef.current = onError;\n  onReadyRef.current = onReady;\n\n  //  REMOVED: initializeForm - moved inline to useEffect to prevent dependency loops\n\n  /**\n   *  CLEANUP EFFECT\n   * Samostatn effect pro cleanup aby ml vlastn lifecycle\n   */\n  useEffect(() => {\n    const instanceId = instanceIdRef.current;\n\n    return () => {\n      const wasInitializing = window.__orderFormInitInProgress &&\n                            window.__orderFormCurrentInstanceId === instanceId;\n\n      //  STRICTMODE DETECTION\n      const timeSinceMount = Date.now() - parseInt(instanceId.split('_')[1]);\n\n      if (timeSinceMount < 100 && wasInitializing) {\n        if (process.env.NODE_ENV === 'development') {\n        }\n        strictModeUnmountRef.current = true;\n        return;\n      }\n\n      //  HMR DETECTION - pokud je unmount tsn po mount, je to pravdpodobn HMR\n      if (timeSinceMount < 500) {\n        if (process.env.NODE_ENV === 'development') {\n        }\n        // Pro HMR nastavme cleanup s delm timeoutem\n        setTimeout(() => {\n          if (window.__orderFormCurrentInstanceId === instanceId) {\n            window.__orderFormInitInProgress = false;\n            window.__orderFormCurrentInstanceId = null;\n          }\n          cleanupRef.current = true;\n        }, 1000); // Del timeout pro HMR\n        return;\n      }\n\n      // Normln cleanup - delayed pro StrictMode safety\n      if (process.env.NODE_ENV === 'development') {\n      }\n      setTimeout(() => {\n        if (window.__orderFormCurrentInstanceId === instanceId) {\n          window.__orderFormInitInProgress = false;\n          window.__orderFormCurrentInstanceId = null;\n        }\n        cleanupRef.current = true;\n      }, 200);\n    };\n  }, []); // Spust se jednou pi mount/unmount\n\n  /**\n   *  Auto-initialization pi mountu\n   * Spust se kdy jsou token a username dostupn\n   *\n   *  INSTANCE-BASED: Kad instance m vlastn ID\n   *  STRICTMODE DETECTION: Ignoruje StrictMode test unmount\n   *  NAVIGATION FIX: Re-initialize when editOrderId changes\n   */\n  useEffect(() => {\n    // console.log(' [useFormController] useEffect SE SPOUT! token:', !!token, 'username:', !!username, 'editOrderId:', editOrderId);\n    const instanceId = instanceIdRef.current;\n    isMountedRef.current = true;\n\n    //  NAVIGATION FIX: Reset VDY kdy se zmn editOrderId\n    // This allows re-initialization when navigating between orders\n    \n    //  CRITICAL: Reset VECH flag pro re-inicializaci\n    hasInitializedRef.current = false;\n    initLockRef.current = false;\n    cleanupRef.current = false;\n    strictModeUnmountRef.current = false;\n    \n    //  CRITICAL: Reset global window flags\n    if (window.__orderFormCurrentInstanceId === instanceIdRef.current) {\n      window.__orderFormInitInProgress = false;\n      window.__orderFormCurrentInstanceId = null;\n    }\n    \n    //  CRITICAL: Reset lifecycle state pi zmn editOrderId\n    lifecycle.reset();\n\n    // Skip pokud u je oznaen pro cleanup (ale ne StrictMode unmount nebo HMR)\n    //  V production mode by cleanup ml zastavit re-init, ale v dev mode (HMR) ne\n    if (cleanupRef.current && !strictModeUnmountRef.current) {\n      if (process.env.NODE_ENV === 'development') {\n      }\n      return;\n    }\n\n    // Reset StrictMode flag pokud byl nastaven\n    if (strictModeUnmountRef.current) {\n      strictModeUnmountRef.current = false;\n    }\n\n    if (token && username) {\n      // console.log(' [useFormController] Mm token a username, VOLM init()');\n      hasInitializedRef.current = true; //  Oznait e inicializace zaala\n      //  Call initializeForm directly to avoid dependency loop - use refs\n      const init = async () => {\n        // console.log(' [useFormController] init() FUNKCE SE SPOUT!');\n        const instanceId = instanceIdRef.current;\n\n        //  DOUBLE CHECK LOCK - prevence race conditions\n        if (initLockRef.current) {\n          return { success: false, reason: 'already_running' };\n        }\n\n        // Check jestli jin instance u b\n        if (window.__orderFormInitInProgress && window.__orderFormCurrentInstanceId !== instanceId) {\n          return { success: false, reason: 'other_instance_running' };\n        }\n\n        //  SET LOCK - OKAMIT, synchronn\n        initLockRef.current = true;\n        window.__orderFormInitInProgress = true;\n        window.__orderFormCurrentInstanceId = instanceId;\n\n        try {\n          // Use current refs to get latest values\n          const currentLifecycle = lifecycleRef.current;\n          const currentDictionaries = dictionariesRef.current;\n          const currentOrderDataLoader = orderDataLoaderRef.current;\n          const currentOnDataLoaded = onDataLoadedRef.current;\n          const currentOnError = onErrorRef.current;\n          const currentOnReady = onReadyRef.current;\n\n          // FZE 1: Naten selnk\n          if (process.env.NODE_ENV === 'development') {\n          }\n          \n          //  Optimalizace: Pokud selnky u jsou naten' (nap. po HMR), pesko\n          if (!currentDictionaries.isReady) {\n            currentLifecycle.startDictionariesLoad();\n\n            const dictionariesSuccess = await currentDictionaries.loadAll();\n\n            if (!dictionariesSuccess) {\n              throw new Error('Failed to load dictionaries');\n            }\n\n            if (process.env.NODE_ENV === 'development') {\n            }\n            currentLifecycle.dictionariesLoaded();\n          } else {\n            if (process.env.NODE_ENV === 'development') {\n            }\n            currentLifecycle.dictionariesLoaded();\n          }\n\n          // FZE 2: Naten dat objednvky (pokud edit/copy)\n          let loadedData = null;\n          let sourceOrderId = null;\n\n          if (process.env.NODE_ENV === 'development') {\n          }\n\n          if (editOrderId) {\n            // EDIT MODE\n            // console.log(' [useFormController] EDIT MODE - editOrderId:', editOrderId, 'archivovano:', archivovanoParam);\n            if (process.env.NODE_ENV === 'development') {\n            }\n            currentLifecycle.startDataLoad();\n\n            loadedData = await currentOrderDataLoader.loadOrderForEdit({\n              orderId: editOrderId,\n              archivovano: archivovanoParam === '1' ? 1 : 0\n            });\n            // console.log(' [useFormController] loadedData po loadOrderForEdit:', loadedData);\n\n            if (process.env.NODE_ENV === 'development') {\n            }\n            currentLifecycle.dataLoaded();\n\n          } else {\n            // NEW ORDER - dn data k naten, ale stle zavolat callback pro draft loading!\n            if (process.env.NODE_ENV === 'development') {\n            }\n            currentLifecycle.dataLoaded(); // Peskoit data loading fzi\n            loadedData = {}; //  Przdn objekt aby se zavolal onDataLoaded\n          }\n\n          // FZE 3: Formul ready\n          currentLifecycle.setReady();\n\n          // Callbacks -  Volat VDY, i pro NEW order (kvli draft loading)\n          if (currentOnDataLoaded) {\n            currentOnDataLoaded(loadedData, sourceOrderId);\n          }\n\n          if (currentOnReady) {\n            currentOnReady();\n          }\n\n          //  FIX: Uvolnit lock po spnm dokonen\n          initLockRef.current = false;\n          window.__orderFormInitInProgress = false;\n\n          return {\n            success: true,\n            data: loadedData,\n            sourceOrderId\n          };\n\n        } catch (error) {\n          const currentLifecycle = lifecycleRef.current;\n          const currentOnError = onErrorRef.current;\n\n          currentLifecycle.setError(error.message);\n\n          // Reset locks pi chyb\n          initLockRef.current = false;\n          window.__orderFormInitInProgress = false;\n          if (window.__orderFormCurrentInstanceId === instanceId) {\n            window.__orderFormCurrentInstanceId = null;\n          }\n\n          if (currentOnError) {\n            currentOnError(error);\n          }\n\n          return {\n            success: false,\n            error: error.message\n          };\n        }\n      };\n\n      init();\n    }\n  }, [token, username, editOrderId]); //  FIX: REMOVED initializeForm and copyOrderId to prevent infinite loop\n\n  return {\n    // Lifecycle\n    lifecycle: {\n      phase: lifecycle.phase,\n      isInitializing: lifecycle.isInitializing,\n      isLoadingDictionaries: lifecycle.isLoadingDictionaries,\n      isLoadingFormData: lifecycle.isLoadingFormData,\n      isReady: lifecycle.isReady,\n      error: lifecycle.error,\n      isInPhase: lifecycle.isInPhase,\n      canLoadData: lifecycle.canLoadData\n    },\n\n    // Dictionaries\n    dictionaries: {\n      data: dictionaries.data,\n      loading: dictionaries.loading,\n      errors: dictionaries.errors,\n      isReady: dictionaries.isReady,\n      loadedCount: dictionaries.loadedCount,\n      totalToLoad: dictionaries.totalToLoad\n    },\n\n    // Order data loader\n    orderDataLoader: {\n      loading: orderDataLoader.loading,\n      error: orderDataLoader.error,\n      loadOrderForEdit: orderDataLoader.loadOrderForEdit\n      // loadOrderForCopy: Funkce existuje v useOrderDataLoader, ale nen pouita v UI\n    },\n\n    // UI State\n    ui,\n\n    // Master functions\n    // initializeForm: removed - inline in useEffect to prevent loops\n    reset: () => {\n      const instanceId = instanceIdRef.current;\n      lifecycle.reset();\n      ui.reset();\n\n      // Reset vechny lock flagy\n      initLockRef.current = false;\n      cleanupRef.current = false;\n      hasInitializedRef.current = false; //  Reset hasInitialized flag\n\n      // Reset global flags pokud tato instance je ta aktivn\n      if (window.__orderFormCurrentInstanceId === instanceId) {\n        window.__orderFormInitInProgress = false;\n        window.__orderFormCurrentInstanceId = null;\n      }\n    }\n  };\n};\n","/**\n *  useFormLifecycle Hook\n * d cel ivotn cyklus formule od mountu po ready state\n */\n\nimport { useReducer, useCallback, useEffect } from 'react';\nimport {\n  lifecycleReducer,\n  initialLifecycleState,\n  LIFECYCLE_ACTIONS,\n  LIFECYCLE_PHASES\n} from '../reducers';\n\nexport const useFormLifecycle = () => {\n  const [state, dispatch] = useReducer(lifecycleReducer, initialLifecycleState);\n\n  /**\n   * Start natn selnk\n   */\n  const startDictionariesLoad = useCallback(() => {\n    dispatch({ type: LIFECYCLE_ACTIONS.START_DICTIONARIES_LOAD });\n  }, []);\n\n  /**\n   * selnky nateny - ready pro data\n   */\n  const dictionariesLoaded = useCallback(() => {\n    dispatch({ type: LIFECYCLE_ACTIONS.DICTIONARIES_LOADED });\n  }, []);\n\n  /**\n   * Start natn dat objednvky\n   */\n  const startDataLoad = useCallback(() => {\n    dispatch({ type: LIFECYCLE_ACTIONS.START_DATA_LOAD });\n  }, []);\n\n  /**\n   * Data natena\n   */\n  const dataLoaded = useCallback(() => {\n    dispatch({ type: LIFECYCLE_ACTIONS.DATA_LOADED });\n  }, []);\n\n  /**\n   * Formul ready pro editaci\n   */\n  const setReady = useCallback(() => {\n    dispatch({ type: LIFECYCLE_ACTIONS.READY });\n  }, []);\n\n  /**\n   * Chyba pi inicializaci\n   */\n  const setError = useCallback((error) => {\n    dispatch({ type: LIFECYCLE_ACTIONS.ERROR, payload: error });\n  }, []);\n\n  /**\n   * Reset lifecycle\n   */\n  const reset = useCallback(() => {\n    dispatch({ type: LIFECYCLE_ACTIONS.RESET });\n  }, []);\n\n  return {\n    // State\n    phase: state.phase,\n    isInitializing: state.isInitializing,\n    isLoadingDictionaries: state.isLoadingDictionaries,\n    isLoadingFormData: state.isLoadingFormData,\n    isReady: state.isReady,\n    error: state.error,\n    phaseHistory: state.phaseHistory,\n\n    // Actions\n    startDictionariesLoad,\n    dictionariesLoaded,\n    startDataLoad,\n    dataLoaded,\n    setReady,\n    setError,\n    reset,\n\n    // Helpers\n    isInPhase: (phase) => state.phase === phase,\n    canLoadData: () => state.phase === LIFECYCLE_PHASES.READY_FOR_DATA\n  };\n};\n","/**\n *  useOrderDataLoader Hook\n * Nat data objednvky z DB a transformuje je pro formul\n *\n *  V2 API Migration: Uses Order V2 API with standardized data types\n * - strediska_kod: string[] (array of codes)\n * - financovani: {typ, nazev, lp_kody?}\n * - druh_objednavky_kod: string\n * - max_cena_s_dph: string (for precision)\n */\n\nimport { useState, useCallback, useRef } from 'react';\nimport { getOrderV2, getNextOrderNumberV2, listInvoiceAttachments } from '../../../services/apiOrderV2'; //  V2 API + plohy faktur\nimport { WORKFLOW_STATES } from '../../../constants/workflow25';\n\nexport const useOrderDataLoader = ({ token, username, dictionaries }) => {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const loadingRef = useRef(false);\n\n  /**\n   * Helper: Extrahovn enriched user dat z backendu\n   */\n  const extractEnrichedUserData = useCallback((enrichedUser) => {\n    if (!enrichedUser) return null;\n\n    const titul_pred = enrichedUser.titul_pred || '';\n    const jmeno = enrichedUser.jmeno || '';\n    const prijmeni = enrichedUser.prijmeni || '';\n    const titul_za = enrichedUser.titul_za || '';\n\n    const displayName = `${titul_pred ? titul_pred + ' ' : ''}${jmeno} ${prijmeni}${titul_za ? ', ' + titul_za : ''}`.trim();\n\n    return {\n      displayName,\n      email: enrichedUser.email || '',\n      telefon: enrichedUser.telefon || ''\n    };\n  }, []);\n\n  /**\n   * Helper: Transformace dat z DB do formtu formule\n   *\n   *  V2 API: Backend u posl standardizovan formt:\n   * - strediska_kod: string[] (ne objekty!)\n   * - financovani: {typ, nazev, lp_kody} (ne kod_stavu!)\n   * - druh_objednavky_kod: string (ne objekt!)\n   * - max_cena_s_dph: string (ne number!)\n   *\n   *  V2 API /enriched endpoint:\n   * - Posl _enriched.objednatel data (user info)\n   * - Nen poteba fallback na dictionaries.data.allUsers\n   */\n  const transformOrderData = useCallback((dbOrder, dictionaries) => {\n    if (!dbOrder) return null;\n\n    // Doplnit daje objednatele z _enriched (V2 API /enriched endpoint)\n    let objednatelData = {};\n    if (dbOrder.objednatel_id) {\n      // V2 /enriched endpoint: Data pijdou v _enriched.objednatel\n      if (dbOrder._enriched?.objednatel) {\n        const enriched = extractEnrichedUserData(dbOrder._enriched.objednatel);\n        if (enriched) {\n          objednatelData = {\n            jmeno: enriched.displayName,\n            email: enriched.email,\n            telefon: enriched.telefon\n          };\n        }\n      }\n\n      // Fallback na selnk jen pokud enriched data chyb\n      if (!objednatelData.jmeno && dictionaries?.data?.allUsers) {\n        const objednatel = dictionaries.data.allUsers.find(u =>\n          (u.id && u.id === dbOrder.objednatel_id) ||\n          (u.user_id && u.user_id === dbOrder.objednatel_id)\n        );\n\n        if (objednatel) {\n          const titul_pred_str = objednatel.titul_pred ? objednatel.titul_pred + ' ' : '';\n          const jmeno_str = objednatel.jmeno || '';\n          const prijmeni_str = objednatel.prijmeni || '';\n          const titul_za_str = objednatel.titul_za ? ', ' + objednatel.titul_za : '';\n          const displayName = `${titul_pred_str}${jmeno_str} ${prijmeni_str}${titul_za_str}`.replace(/\\s+/g, ' ').trim();\n\n          objednatelData = {\n            jmeno: displayName || objednatel.username || '',\n            email: objednatel.email || '',\n            telefon: objednatel.telefon || ''\n          };\n        }\n      }\n    }\n\n    //  V2 API: Stediska jsou u array string [\"KLADNO\", \"PRAHA\"]\n    const strediskaKod = (() => {\n      // Backend V2 vrac u sprvn formt\n      if (Array.isArray(dbOrder.strediska_kod)) {\n        const result = dbOrder.strediska_kod.map(kod => String(kod).toUpperCase());\n        return result;\n      }\n      // Fallback: enriched data (pro kompatibilitu se starm API)\n      if (dbOrder._enriched?.strediska && Array.isArray(dbOrder._enriched.strediska)) {\n        const result = dbOrder._enriched.strediska.map(s => s.kod.toUpperCase());\n        return result;\n      }\n      return [];\n    })();\n\n    //  V2 API: Financovn je {typ, nazev, lp_kody}\n    const zpusobFinancovani = (() => {\n      // Backend V2 vrac {typ: \"LP\", nazev: \"...\", lp_kody: [...]}\n      if (dbOrder.financovani && typeof dbOrder.financovani === 'object') {\n        return dbOrder.financovani.typ || '';\n      }\n      // Fallback pro star formt (bhem migrace)\n      if (dbOrder.financovani && typeof dbOrder.financovani === 'string') {\n        try {\n          const parsed = JSON.parse(dbOrder.financovani);\n          return parsed.typ || parsed.kod_stavu || '';\n        } catch (e) {\n          return dbOrder.zpusob_financovani || '';\n        }\n      }\n      return dbOrder.zpusob_financovani || '';\n    })();\n\n    //  V2 API: Vnoen data financovn\n    let financovaniVnorena = {};\n    if (dbOrder.financovani && typeof dbOrder.financovani === 'object') {\n      financovaniVnorena = {\n        lp_kod: dbOrder.financovani.lp_kody || [], // V2 pouv \"lp_kody\"\n        lp_nazev: dbOrder.financovani.nazev || '', // Nzev LP\n        // Dal pole (pokud existuj)\n        paragraf: dbOrder.financovani.paragraf || '',\n        polozka: dbOrder.financovani.polozka || '',\n        investice: dbOrder.financovani.investice || '',\n        //  SMLOUVA - slo a poznmka (nataj se z root objektu, fallback na financovani)\n        cislo_smlouvy: dbOrder.cislo_smlouvy || dbOrder.financovani.cislo_smlouvy || '',\n        smlouva_poznamka: dbOrder.smlouva_poznamka || dbOrder.financovani.smlouva_poznamka || ''\n      };\n    }\n\n    //  INDIVIDULN SCHVLEN a POJISTN UDLOST - natat z root objektu (stejn jako cislo_smlouvy)\n    const individualni_schvaleni = dbOrder.individualni_schvaleni \n      ? String(dbOrder.individualni_schvaleni)\n      : (dbOrder.financovani?.individualni_schvaleni ? String(dbOrder.financovani.individualni_schvaleni) : '');\n    const individualni_poznamka = dbOrder.individualni_poznamka || dbOrder.financovani?.individualni_poznamka || '';\n    const pojistna_udalost_cislo = dbOrder.pojistna_udalost_cislo || dbOrder.financovani?.pojistna_udalost_cislo || '';\n    const pojistna_udalost_poznamka = dbOrder.pojistna_udalost_poznamka || dbOrder.financovani?.pojistna_udalost_poznamka || '';\n\n    //  V2 API: Druh objednvky je string \"AUTA\"\n    const druhObjednavky = (() => {\n      // Backend V2 vrac u jen string\n      if (typeof dbOrder.druh_objednavky_kod === 'string') {\n        return dbOrder.druh_objednavky_kod;\n      }\n      // Fallback pro star formt (bhem migrace)\n      if (dbOrder.druh_objednavky_kod && typeof dbOrder.druh_objednavky_kod === 'object') {\n        return dbOrder.druh_objednavky_kod.kod_stavu || dbOrder.druh_objednavky_kod.kod || '';\n      }\n      return '';\n    })();\n\n    //  Stav objednvky - pevst workflow kd na text\n    const stavObjednavky = (() => {\n      try {\n        // Parsuj workflow stavy (me bt array nebo JSON string)\n        const stavyArray = Array.isArray(dbOrder.stav_workflow_kod)\n          ? dbOrder.stav_workflow_kod\n          : JSON.parse(dbOrder.stav_workflow_kod || '[\"NOVA\"]');\n\n        if (!Array.isArray(stavyArray) || stavyArray.length === 0) {\n          return 'Nov';\n        }\n\n        // Zskej posledn (nejvznamnj) stav\n        const poslednSta = stavyArray[stavyArray.length - 1];\n        const stavInfo = WORKFLOW_STATES[poslednSta];\n\n        if (stavInfo) {\n          return stavInfo.name;\n        }\n\n        // Fallback\n        return poslednSta || 'Nov';\n      } catch (e) {\n        return 'Nov';\n      }\n    })();\n\n    // Transformovan data\n    const transformedData = {\n      ...dbOrder,\n      ...objednatelData,\n      id: dbOrder.id,\n      ev_cislo: dbOrder.cislo_objednavky || dbOrder.ev_cislo,\n      stav_workflow_kod: dbOrder.stav_workflow_kod || 'NOVA',\n      stav_objednavky: stavObjednavky, //  Textov popis stavu\n      mimoradna_udalost: dbOrder.mimoradna_udalost || false, // Mimodn udlost\n\n      //  Detekce stav checkbox podle workflow\n      // ODESLANA: stav obsahuje \"ODESLANA\" + dt_odeslani != null + odesilatel_id != null\n      stav_odeslano: (() => {\n        try {\n          const stavyArray = Array.isArray(dbOrder.stav_workflow_kod)\n            ? dbOrder.stav_workflow_kod\n            : JSON.parse(dbOrder.stav_workflow_kod || '[]');\n          const maOdeslanu = Array.isArray(stavyArray) && stavyArray.includes('ODESLANA');\n          const maDatum = !!dbOrder.dt_odeslani;\n          const maOdesilatele = !!dbOrder.odesilatel_id;\n          return maOdeslanu && maDatum && maOdesilatele;\n        } catch (e) {\n          return false;\n        }\n      })(),\n\n      // STORNOVANA: stav obsahuje \"STORNOVANA\"\n      stav_stornovano: (() => {\n        try {\n          const stavyArray = Array.isArray(dbOrder.stav_workflow_kod)\n            ? dbOrder.stav_workflow_kod\n            : JSON.parse(dbOrder.stav_workflow_kod || '[]');\n          return Array.isArray(stavyArray) && stavyArray.includes('STORNOVANA');\n        } catch (e) {\n          return false;\n        }\n      })(),\n\n      //  FZE 1: Stav schvlen (UI helper odvozen ze workflow stav)\n      //  Checkbox se zobrazuje pro vechny stavy KROM \"NOVA\"\n      // Mapovn stav: SCHVALENA  'schvaleno', ZAMITNUTA  'neschvaleno', CEKA_SE  'ceka_se'\n      // Pro ostatn stavy (ODESLAN_KE_SCHVALENI apod.)  checkbox zstane przdn\n      stav_schvaleni: (() => {\n        try {\n          const stavyArray = Array.isArray(dbOrder.stav_workflow_kod)\n            ? dbOrder.stav_workflow_kod\n            : JSON.parse(dbOrder.stav_workflow_kod || '[]');\n\n          if (!Array.isArray(stavyArray)) return '';\n\n          //  Mapovn workflow stav na UI checkbox hodnoty\n          if (stavyArray.includes('SCHVALENA')) {\n            return 'schvaleno';\n          } else if (stavyArray.includes('ZAMITNUTA')) {\n            return 'neschvaleno';\n          } else if (stavyArray.includes('CEKA_SE')) {\n            return 'ceka_se';\n          }\n\n          // ODESLAN_KE_SCHVALENI nebo jin  checkbox zstane przdn (ale zobraz se)\n          return '';\n        } catch (e) {\n          return '';\n        }\n      })(),\n\n      // Datumov pole\n      datum_odeslani: dbOrder.dt_odeslani || dbOrder.dt_odeslano ? (dbOrder.dt_odeslani || dbOrder.dt_odeslano).split(' ')[0] : '',\n      datum_storna: dbOrder.dt_odeslani || dbOrder.dt_odeslano ? (dbOrder.dt_odeslani || dbOrder.dt_odeslano).split(' ')[0] : '',\n      dt_akceptace: dbOrder.dt_akceptace ? dbOrder.dt_akceptace.split(' ')[0] : '',\n      datum_vytvoreni: dbOrder.dt_vytvoreni ? dbOrder.dt_vytvoreni.split(' ')[0] : '',\n      datum_splatnosti: dbOrder.dt_splatnost ? dbOrder.dt_splatnost.split(' ')[0] : '',\n      temp_datum_objednavky: dbOrder.datum_objednavky ? dbOrder.datum_objednavky.split(' ')[0] : (dbOrder.dt_objednavky ? dbOrder.dt_objednavky.split(' ')[0] : ''),\n\n      // Workflow tracking pole\n      odesilatel_id: dbOrder.odesilatel_id || null,\n      dodavatel_potvrdil_id: dbOrder.dodavatel_potvrdil_id || null,\n      zverejnil_id: dbOrder.zverejnil_id || null,\n      dt_zverejneni_potvrzeni: dbOrder.dt_zverejneni_potvrzeni ? dbOrder.dt_zverejneni_potvrzeni.split(' ')[0] : '',\n      potvrdil_vecnou_spravnost_id: dbOrder.potvrdil_vecnou_spravnost_id || null,\n      dt_potvrzeni_vecne_spravnosti: dbOrder.dt_potvrzeni_vecne_spravnosti || '',\n      potvrzeni_vecne_spravnosti: (() => {\n        const rawValue = dbOrder.potvrzeni_vecne_spravnosti;\n        // Handle boolean from V2 API\n        if (typeof rawValue === 'boolean') return rawValue ? 1 : 0;\n        // Handle number\n        if (typeof rawValue === 'number') return rawValue;\n        // Handle string\n        if (typeof rawValue === 'string') return parseInt(rawValue, 10) || 0;\n        // Default\n        return 0;\n      })(),\n      vecna_spravnost_umisteni_majetku: dbOrder.vecna_spravnost_umisteni_majetku || '',\n      vecna_spravnost_poznamka: dbOrder.vecna_spravnost_poznamka || '',\n      fakturant_id: dbOrder.fakturant_id || null,\n      dt_faktura_pridana: dbOrder.dt_faktura_pridana || '',\n      dokoncil_id: dbOrder.dokoncil_id || null,\n      dt_dokonceni: dbOrder.dt_dokonceni || '',\n      dokonceni_poznamka: dbOrder.dokonceni_poznamka || '',\n      potvrzeni_dokonceni_objednavky: (() => {\n        const rawValue = dbOrder.potvrzeni_dokonceni_objednavky;\n        // Handle boolean from V2 API\n        if (typeof rawValue === 'boolean') return rawValue ? 1 : 0;\n        // Handle number\n        if (typeof rawValue === 'number') return rawValue;\n        // Handle string\n        if (typeof rawValue === 'string') return parseInt(rawValue, 10) || 0;\n        // Default\n        return 0;\n      })(),\n\n      //  V2 API: Stediska a financovn v novm formtu\n      strediska_kod: strediskaKod,\n      zpusob_financovani: zpusobFinancovani,\n      ...financovaniVnorena,\n      \n      //  INDIVIDULN SCHVLEN a POJISTN UDLOST - z root objektu\n      individualni_schvaleni,\n      individualni_poznamka,\n      pojistna_udalost_cislo,\n      pojistna_udalost_poznamka,\n\n      //  V2 API: Druh objednvky jako string\n      druh_objednavky_kod: druhObjednavky,\n\n      // Poloky objednvky - backend posl jako 'polozky', frontend pouv 'polozky_objednavky'\n      polozky_objednavky: Array.isArray(dbOrder.polozky) ? dbOrder.polozky : [],\n\n      //  FAKTURY: Mapovn DB -> FE (fa_datum_splatnosti -> fa_splatnost)\n      faktury: (() => {\n        if (!Array.isArray(dbOrder.faktury)) return [];\n\n        return dbOrder.faktury.map(faktura => ({\n          ...faktura,\n          //  MAPOVN 1:1 mezi DB sloupci a FE poli\n          fa_dorucena: faktura.fa_datum_doruceni ? 1 : 0, //  Boolean flag zda m datum doruen\n          fa_splatnost: faktura.fa_datum_splatnosti ? faktura.fa_datum_splatnosti.split(' ')[0] : '', //  DB -> FE: fa_datum_splatnosti -> fa_splatnost\n          //  Zachovat originln DB pole pro API odesln\n          fa_datum_doruceni: faktura.fa_datum_doruceni,\n          fa_datum_splatnosti: faktura.fa_datum_splatnosti,\n          fa_datum_vystaveni: faktura.fa_datum_vystaveni,\n          //  PLOHY: Penst attachments z dbOrder (naten v loadOrderForEdit)\n          attachments: faktura.attachments || []\n          //  VCN SPRVNOST: 1:1 mapovn - dn pejmenovvn pol!\n          // vecna_spravnost_umisteni_majetku, vecna_spravnost_poznamka, vecna_spravnost_potvrzeno,\n          // potvrdil_vecnou_spravnost_id, dt_potvrzeni_vecne_spravnosti - ve 1:1 z DB\n        }));\n      })(),\n\n      //  V2 API: Dodavatel zpsob potvrzen {zpusob_potvrzeni[], zpusob_platby}\n      dodavatel_zpusob_potvrzeni: (() => {\n        try {\n          //  ANO = pokud existuje dt_akceptace A dodavatel_potvrdil_id (bez ohledu na dodavatel_zpusob_potvrzeni)\n          const maAkceptaci = !!(dbOrder.dt_akceptace && dbOrder.dodavatel_potvrdil_id);\n\n          // Kontrola przdn hodnoty\n          if (!dbOrder.dodavatel_zpusob_potvrzeni ||\n              dbOrder.dodavatel_zpusob_potvrzeni === '' ||\n              (typeof dbOrder.dodavatel_zpusob_potvrzeni === 'string' && dbOrder.dodavatel_zpusob_potvrzeni.trim() === '')) {\n            // Pokud mme dt_akceptace + dodavatel_potvrdil_id, ale chyb dodavatel_zpusob_potvrzeni -> ANO s przdnmi daty\n            if (maAkceptaci) {\n              return {\n                potvrzeni: 'ANO',\n                zpusoby: [],\n                platba: 'faktura' // vdy faktura (pevn nastaveno)\n              };\n            }\n            // Jinak NE\n            return {\n              potvrzeni: 'NE',\n              zpusoby: [],\n              platba: 'faktura' // vdy faktura (pevn nastaveno)\n            };\n          }\n\n          if (typeof dbOrder.dodavatel_zpusob_potvrzeni === 'object') {\n            //  BE formt: {potvrzeno: true, zpusoby: [], platba: \"\"}\n            // NEBO star formt BEZ potvrzeno: {zpusoby: [], platba: \"\"}\n            const beData = dbOrder.dodavatel_zpusob_potvrzeni;\n\n            //  FALLBACK: Pokud DB neobsahuje 'potvrzeno', odvo z dt_akceptace\n            const potvrzenoValue = beData.potvrzeno !== undefined\n              ? beData.potvrzeno          // DB m potvrzeno\n              : maAkceptaci;              // DB nem  odvozeno z dt_akceptace\n\n            return {\n              potvrzeni: potvrzenoValue ? 'ANO' : 'NE',\n              //  OPRAVA: zpusoby (mnon slo!) - DB vrac \"zpusoby\" ne \"zpusob\"\n              zpusoby: beData.zpusoby || beData.zpusob || beData.zpusob_potvrzeni || [],\n              platba: 'faktura' // vdy faktura (pevn nastaveno)\n            };\n          } else if (typeof dbOrder.dodavatel_zpusob_potvrzeni === 'string') {\n            // Star formt (fallback bhem migrace) - parsuj jen neprzdn string\n            const trimmed = dbOrder.dodavatel_zpusob_potvrzeni.trim();\n            if (trimmed.length === 0) {\n              return {\n                potvrzeni: 'NE',\n                zpusoby: [],\n                platba: ''\n              };\n            }\n\n            const parsed = JSON.parse(trimmed);\n            //  FALLBACK: Pokud DB nem 'potvrzeno', odvo z dt_akceptace\n            const potvrzenoValue = parsed.potvrzeno !== undefined\n              ? parsed.potvrzeno    // DB m potvrzeno\n              : maAkceptaci;        // DB nem  odvozeno z dt_akceptace\n\n            return {\n              potvrzeni: potvrzenoValue ? 'ANO' : 'NE',\n              //  OPRAVA: zpusoby (mnon slo!) - DB vrac \"zpusoby\" ne \"zpusob\"\n              zpusoby: parsed.zpusoby || parsed.zpusob || parsed.zpusob_potvrzeni || [],\n              platba: 'faktura' // vdy faktura (pevn nastaveno)\n            };\n          } else {\n            // Default - NE\n            return {\n              potvrzeni: 'NE',\n              zpusoby: [],\n              platba: 'faktura' // vdy faktura (pevn nastaveno)\n            };\n          }\n        } catch (e) {\n          return {\n            potvrzeni: 'NE',\n            zpusoby: [],\n            platba: ''\n          };\n        }\n      })()\n    };\n\n    //  ARCHIVOVAN OBJEDNVKY - speciln pravidla\n    // Detekce archivovan objednvky (stav workflow)\n    const currentStates = Array.isArray(transformedData.stav_workflow_kod)\n      ? transformedData.stav_workflow_kod\n      : (transformedData.stav_workflow_kod ? [transformedData.stav_workflow_kod] : []);\n\n    //  KRITICK: Detekovat podle PVODN DB hodnoty stav_objednavky, NE podle transformovan!\n    const isArchived = dbOrder.stav_objednavky === 'ARCHIVOVANO' ||\n                       dbOrder.stav_objednavky === 'Archivovno' ||\n                       currentStates.includes('ARCHIVOVANO');\n\n    if (isArchived) {\n\n      // 1. Nastav workflow stav pouze na ARCHIVOVANO (NESM SE PEPSAT!)\n      transformedData.stav_workflow_kod = ['ARCHIVOVANO'];\n      transformedData.stav_objednavky = 'Archivovno';\n\n      // 2. Nastav vechny dokonen fze jako completed\n      transformedData.stav_odeslano = true;\n      transformedData.stav_schvaleni = 'schvaleno';\n\n      // 3. Pokud m \"m bt zveejnna\", ozna jako zveejnnou\n      if (transformedData.ma_byt_zverejnena || transformedData.ma_byt_zverejnena === 1) {\n        transformedData.dt_zverejneni = transformedData.dt_zverejneni || new Date().toISOString().split('T')[0];\n      }\n\n      // 4. Nastav jako zkontrolovno\n      transformedData.potvrzeni_vecne_spravnosti = 1;\n\n      // 5. Normalizuj pkazce a schvalovatele na string (vetn '0' pro SYSTEM)\n      if (transformedData.prikazce_id === 0 || transformedData.prikazce_id === null || transformedData.prikazce_id === '') {\n        transformedData.prikazce_id = '0'; // SYSTEM\n      } else if (transformedData.prikazce_id) {\n        transformedData.prikazce_id = String(transformedData.prikazce_id);\n      }\n\n      if (transformedData.schvalovatel_id === 0 || transformedData.schvalovatel_id === null || transformedData.schvalovatel_id === '') {\n        transformedData.schvalovatel_id = '0'; // SYSTEM\n      } else if (transformedData.schvalovatel_id) {\n        transformedData.schvalovatel_id = String(transformedData.schvalovatel_id);\n      }\n\n    } else {\n      //  BN OBJEDNVKY - dn speciln logika, jen normalizace ID na string\n      if (transformedData.prikazce_id !== null && transformedData.prikazce_id !== undefined && transformedData.prikazce_id !== '') {\n        transformedData.prikazce_id = String(transformedData.prikazce_id);\n      }\n\n      if (transformedData.schvalovatel_id !== null && transformedData.schvalovatel_id !== undefined && transformedData.schvalovatel_id !== '') {\n        transformedData.schvalovatel_id = String(transformedData.schvalovatel_id);\n      }\n    }\n\n    return transformedData;\n  }, [extractEnrichedUserData]);\n\n  /**\n    // Detekce archivovan objednvky (URL param nebo stav workflow)\n    const currentStates = Array.isArray(transformedData.stav_workflow_kod)\n      ? transformedData.stav_workflow_kod\n      : (transformedData.stav_workflow_kod ? [transformedData.stav_workflow_kod] : []);\n\n    const isArchived = transformedData.archivovano === 1 ||\n                       transformedData.archivovano === '1' ||\n                       currentStates.includes('ARCHIVOVANO') ||\n                       transformedData.stav_objednavky === 'ARCHIVOVANO' ||\n                       transformedData.stav_objednavky === 'Archivovno';\n\n    if (isArchived) {\n      console.log(' Detekovna ARCHIVOVAN objednvka - aplikuji speciln pravidla');\n\n      // 1. Nastav workflow stav pouze na ARCHIVOVANO (NESM SE PEPSAT!)\n      transformedData.stav_workflow_kod = ['ARCHIVOVANO'];\n      transformedData.stav_objednavky = 'Archivovno';\n\n      // 2. Nastav vechny dokonen fze jako completed\n      transformedData.stav_odeslano = true;\n      transformedData.stav_schvaleni = 'schvaleno';\n\n      // 3. Pokud m \"m bt zveejnna\", ozna jako zveejnnou\n      if (transformedData.ma_byt_zverejnena || transformedData.ma_byt_zverejnena === 1) {\n        transformedData.dt_zverejneni = transformedData.dt_zverejneni || new Date().toISOString().split('T')[0];\n      }\n\n      // 4. Nastav jako zkontrolovno\n      transformedData.potvrzeni_vecne_spravnosti = 1;\n\n      // 5. Normalizuj pkazce a schvalovatele na '0' pokud chyb\n      if (!transformedData.prikazce_id ||\n          transformedData.prikazce_id === 0 ||\n          transformedData.prikazce_id === null) {\n        transformedData.prikazce_id = '0';\n      } else {\n        transformedData.prikazce_id = String(transformedData.prikazce_id);\n      }\n\n      if (!transformedData.schvalovatel_id ||\n          transformedData.schvalovatel_id === 0 ||\n          transformedData.schvalovatel_id === null) {\n        transformedData.schvalovatel_id = '0';\n      } else {\n        transformedData.schvalovatel_id = String(transformedData.schvalovatel_id);\n      }\n\n    } else {\n      //  PRIORITA 2: BN OBJEDNVKY - normalizace SYSTEM uivatel\n      let maSystemUzivatele = false;\n\n      // Pokud nen pkazce (null, undefined, '', 0), nastav SYSTEM (string '0')\n      if (!transformedData.prikazce_id ||\n          transformedData.prikazce_id === '' ||\n          transformedData.prikazce_id === null ||\n          transformedData.prikazce_id === 0 ||\n          transformedData.prikazce_id === '0') {\n        transformedData.prikazce_id = '0';\n        maSystemUzivatele = true;\n      } else {\n        // Zajisti e ID je string\n        transformedData.prikazce_id = String(transformedData.prikazce_id);\n      }\n\n      // Pokud nen schvalovatel (null, undefined, '', 0), nastav SYSTEM (string '0')\n      if (!transformedData.schvalovatel_id ||\n          transformedData.schvalovatel_id === '' ||\n          transformedData.schvalovatel_id === null ||\n          transformedData.schvalovatel_id === 0 ||\n          transformedData.schvalovatel_id === '0') {\n        transformedData.schvalovatel_id = '0';\n        maSystemUzivatele = true;\n      } else {\n        // Zajisti e ID je string\n        transformedData.schvalovatel_id = String(transformedData.schvalovatel_id);\n      }\n\n      // Pokud m SYSTEM uivatele, nastav workflow stavy na SCHVALENA + ROZPRACOVANA\n      if (maSystemUzivatele) {\n        transformedData.stav_workflow_kod = ['SCHVALENA', 'ROZPRACOVANA'];\n        transformedData.stav_objednavky = 'Schvlen';\n      }\n    }\n\n    console.log(' Po normalizaci:', {\n      prikazce_id: transformedData.prikazce_id,\n      prikazce_id_type: typeof transformedData.prikazce_id,\n      schvalovatel_id: transformedData.schvalovatel_id,\n      schvalovatel_id_type: typeof transformedData.schvalovatel_id,\n      stav_workflow_kod: transformedData.stav_workflow_kod,\n      stav_objednavky: transformedData.stav_objednavky\n    });\n\n    return transformedData;\n  }, [extractEnrichedUserData]);\n\n  /**\n   *  Naten objednvky pro EDIT reim\n   *\n   *  V2 API Migration: Uses getOrderV2() instead of getOrder25()\n   */\n  const loadOrderForEdit = useCallback(async ({ orderId, archivovano = 0 }) => {\n    if (!token || !username) {\n      console.error(' [useOrderDataLoader] Missing token or username!');\n      throw new Error('Missing token or username');\n    }\n\n    //  NOTE: dictionaries.isReady check REMOVED\n    // Reason: Closure captures old dictionaries state\n    // Check is now done in useFormController with polling\n    // See: useFormController.js lines 63-83\n\n    if (loadingRef.current) {\n      // Already loading - skip duplicate call\n      return null;\n    }\n\n    loadingRef.current = true;\n    setLoading(true);\n    setError(null);\n\n    try {\n      // console.log(' [useOrderDataLoader] Volm getOrderV2 pro orderId:', orderId);\n      //  V2 API: Use getOrderV2() - returns standardized data with enriched=true\n      const dbOrder = await getOrderV2(orderId, token, username, true); //  enriched=true pro financovani.lp_nazvy\n      // console.log(' [useOrderDataLoader] Obdrel jsem dbOrder:', dbOrder);\n\n      if (!dbOrder) {\n        console.error(' [useOrderDataLoader] dbOrder is null!');\n        throw new Error(`Order ${orderId} not found`);\n      }\n\n      //  NAST PLOHY PRO FAKTURY (pokud existuj)\n      if (dbOrder.faktury && Array.isArray(dbOrder.faktury) && dbOrder.faktury.length > 0) {\n        const fakturyWithAttachments = await Promise.all(\n          dbOrder.faktury.map(async (faktura) => {\n            let attachments = [];\n            \n            // Nast plohy pouze pro reln ID (ne temp-)\n            if (faktura.id && !String(faktura.id).startsWith('temp-')) {\n              try {\n                const attachResponse = await listInvoiceAttachments(\n                  faktura.id,\n                  username,\n                  token,\n                  orderId\n                );\n                attachments = attachResponse.data?.attachments || attachResponse.data || [];\n              } catch (err) {\n                console.error(` [useOrderDataLoader] Chyba pi natn ploh faktury ID=${faktura.id}:`, err);\n                // Pokraovat i pi chyb - plohy jsou optional\n                attachments = []; //  Ujistit se, e attachments je pole i pi chyb\n              }\n            }\n            \n            return { ...faktura, attachments };\n          })\n        );\n        \n        // Nahradit faktury vetn ploh\n        dbOrder.faktury = fakturyWithAttachments;\n      } else if (dbOrder.faktury && Array.isArray(dbOrder.faktury)) {\n        //  I kdy faktury nemaj plohy, ujistit se e maj przdn pole attachments\n        dbOrder.faktury = dbOrder.faktury.map(f => ({ ...f, attachments: [] }));\n      }\n\n      const transformedData = transformOrderData(dbOrder, dictionaries);\n      // console.log(' [useOrderDataLoader] Transformovan data:', transformedData);\n      return transformedData;\n    } catch (err) {\n      console.error(' [useOrderDataLoader] Error in loadOrderForEdit:', err);\n      setError(err.message);\n      throw err;\n    } finally {\n      setLoading(false);\n      loadingRef.current = false;\n    }\n  }, [token, username, dictionaries, transformOrderData]);\n\n  /**\n   *  Naten objednvky pro COPY reim\n   */\n  const loadOrderForCopy = useCallback(async ({ orderId, archivovano = 0, userId }) => {\n    if (!token || !username) {\n      throw new Error('Missing token or username');\n    }\n\n    //  NOTE: dictionaries.isReady check REMOVED\n    // Reason: Closure captures old dictionaries state\n    // Check is now done in useFormController with polling\n    // See: useFormController.js lines 63-83\n\n    if (loadingRef.current) {\n      // Already loading - skip duplicate call\n      return null;\n    }\n\n    loadingRef.current = true;\n    setLoading(true);\n    setError(null);\n\n    try {\n      // Nati zdrojovou objednvku -  V2 API\n      const dbOrder = await getOrderV2(\n        orderId,\n        token,\n        username,\n        true // enriched = true\n      );\n\n      if (!dbOrder) {\n        throw new Error(`Order ${orderId} not found`);\n      }\n\n      // Zskej nov evidenn slo (pouze pro ZOBRAZEN) -  V2 API\n      const nextNumberResponse = await getNextOrderNumberV2(token, username);\n      // V2 API vrac: { data: { next_order_string, order_number_string, ... } }\n      //  DLEIT: Toto slo je POUZE pro ZOBRAZEN - neposl se v CREATE/UPDATE\n      const newEvCislo = nextNumberResponse?.order_number_string || nextNumberResponse?.next_order_string || nextNumberResponse?.next_number;\n\n      if (!newEvCislo) {\n        throw new Error('Failed to get new order number');\n      }\n\n      // Transformuj a reset pol pro kopii\n      const transformedData = transformOrderData(dbOrder, dictionaries);\n\n      const copiedOrder = {\n        ...transformedData,\n\n        // Reset ID a evidennho sla\n        id: null,\n        objednavka_id: null,\n        ev_cislo: newEvCislo,\n        temp_datum_objednavky: new Date().toISOString().split('T')[0],\n\n        // Reset workflow\n        stav_workflow_kod: 'NOVA',\n        schvalovatel_id: '',\n        dt_schvaleni: '',\n        schvaleni_komentar: '',\n\n        // Reset asovch raztek\n        datum_vytvoreni: '',\n        datum_posledni_zmeny: '',\n        vytvoril_uzivatel_id: userId,\n        uzivatel_id: userId,\n\n        // Reset stav\n        stav_odeslano: false,\n        datum_odeslani: '',\n        stav_stornovano: false,\n        datum_storna: '',\n\n        // Reset ploh a faktur\n        prilohy_dokumenty: [],\n        faktury: []\n      };\n\n      return { data: copiedOrder, sourceOrderId: orderId };\n    } catch (err) {\n      setError(err.message);\n      throw err;\n    } finally {\n      setLoading(false);\n      loadingRef.current = false;\n    }\n  }, [token, username, dictionaries, transformOrderData]);\n\n  return {\n    loading,\n    error,\n    loadOrderForEdit,\n    loadOrderForCopy\n  };\n};\n","/**\n *  useUIState Hook\n * Spravuje UI states - modals, dialogs, sections, atd.\n */\n\nimport { useReducer, useCallback } from 'react';\nimport {\n  uiReducer,\n  initialUIState,\n  UI_ACTIONS\n} from '../reducers';\n\nexport const useUIState = () => {\n  const [state, dispatch] = useReducer(uiReducer, initialUIState);\n\n  // Modals\n  const openModal = useCallback((modalKey) => {\n    dispatch({ type: UI_ACTIONS.OPEN_MODAL, payload: modalKey });\n  }, []);\n\n  const closeModal = useCallback((modalKey) => {\n    dispatch({ type: UI_ACTIONS.CLOSE_MODAL, payload: modalKey });\n  }, []);\n\n  const closeAllModals = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.CLOSE_ALL_MODALS });\n  }, []);\n\n  // Dropdowns\n  const toggleDropdown = useCallback((dropdownKey) => {\n    dispatch({ type: UI_ACTIONS.TOGGLE_DROPDOWN, payload: dropdownKey });\n  }, []);\n\n  const closeAllDropdowns = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.CLOSE_ALL_DROPDOWNS });\n  }, []);\n\n  // Sections\n  const collapseSection = useCallback((sectionKey) => {\n    dispatch({ type: UI_ACTIONS.COLLAPSE_SECTION, payload: sectionKey });\n  }, []);\n\n  const expandSection = useCallback((sectionKey) => {\n    dispatch({ type: UI_ACTIONS.EXPAND_SECTION, payload: sectionKey });\n  }, []);\n\n  const toggleSection = useCallback((sectionKey) => {\n    dispatch({ type: UI_ACTIONS.TOGGLE_SECTION, payload: sectionKey });\n  }, []);\n\n  const collapseAllSections = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.COLLAPSE_ALL_SECTIONS });\n  }, []);\n\n  const expandAllSections = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.EXPAND_ALL_SECTIONS });\n  }, []);\n\n  const lockSection = useCallback((sectionKey) => {\n    dispatch({ type: UI_ACTIONS.LOCK_SECTION, payload: sectionKey });\n  }, []);\n\n  const unlockSection = useCallback((sectionKey) => {\n    dispatch({ type: UI_ACTIONS.UNLOCK_SECTION, payload: sectionKey });\n  }, []);\n\n  // Select states\n  const setSelectState = useCallback((key, value) => {\n    dispatch({ type: UI_ACTIONS.SET_SELECT_STATE, payload: { key, value } });\n  }, []);\n\n  const setSearchState = useCallback((key, value) => {\n    dispatch({ type: UI_ACTIONS.SET_SEARCH_STATE, payload: { key, value } });\n  }, []);\n\n  // Fullscreen\n  const toggleFullscreen = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.TOGGLE_FULLSCREEN });\n  }, []);\n\n  const setFullscreen = useCallback((value) => {\n    dispatch({ type: UI_ACTIONS.SET_FULLSCREEN, payload: value });\n  }, []);\n\n  // Debug panel\n  const toggleDebug = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.TOGGLE_DEBUG });\n  }, []);\n\n  const pinDebug = useCallback((value) => {\n    dispatch({ type: UI_ACTIONS.PIN_DEBUG, payload: value });\n  }, []);\n\n  // Save progress\n  const setSaveProgress = useCallback((value, text) => {\n    dispatch({ type: UI_ACTIONS.SET_SAVE_PROGRESS, payload: { value, text } });\n  }, []);\n\n  const showSaveProgress = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.SHOW_SAVE_PROGRESS });\n  }, []);\n\n  const hideSaveProgress = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.HIDE_SAVE_PROGRESS });\n  }, []);\n\n  // ICO check\n  const setIcoCheckStatus = useCallback((status) => {\n    dispatch({ type: UI_ACTIONS.SET_ICO_CHECK_STATUS, payload: status });\n  }, []);\n\n  const setIcoCheckData = useCallback((data) => {\n    dispatch({ type: UI_ACTIONS.SET_ICO_CHECK_DATA, payload: data });\n  }, []);\n\n  // Drag & Drop\n  const setDragOver = useCallback((value) => {\n    dispatch({ type: UI_ACTIONS.SET_DRAG_OVER, payload: value });\n  }, []);\n\n  // Reset\n  const reset = useCallback(() => {\n    dispatch({ type: UI_ACTIONS.RESET });\n  }, []);\n\n  return {\n    // State\n    modals: state.modals,\n    dropdowns: state.dropdowns,\n    sections: state.sections,\n    selectStates: state.selectStates,\n    searchStates: state.searchStates,\n    fullscreen: state.fullscreen,\n    areSectionsCollapsed: state.areSectionsCollapsed,\n    debug: state.debug,\n    saveProgress: state.saveProgress,\n    icoCheckStatus: state.icoCheckStatus,\n    icoCheckData: state.icoCheckData,\n    dragOver: state.dragOver,\n\n    // Actions\n    openModal,\n    closeModal,\n    closeAllModals,\n    toggleDropdown,\n    closeAllDropdowns,\n    collapseSection,\n    expandSection,\n    toggleSection,\n    collapseAllSections,\n    expandAllSections,\n    lockSection,\n    unlockSection,\n    setSelectState,\n    setSearchState,\n    toggleFullscreen,\n    setFullscreen,\n    toggleDebug,\n    pinDebug,\n    setSaveProgress,\n    showSaveProgress,\n    hideSaveProgress,\n    setIcoCheckStatus,\n    setIcoCheckData,\n    setDragOver,\n    reset\n  };\n};\n","/**\n * useWorkflowManager.js\n *\n *  CENTRALIZOVAN WORKFLOW MANAGER pro OrderForm25\n *\n * el:\n * - Jednotn logika pro uren aktuln fze objednvky (1-10)\n * - Generovn progress baru s fzemi\n * - Uren tma barev podle fze\n * - Eliminace duplicitn logiky v komponent\n *\n * @author Senior Developer\n * @date 31. jna 2025\n */\n\nimport { useMemo, useCallback, useState } from 'react';\n\n// Dedupe varovn (spam)  zapamatujeme si u vypsan varovn a vypeme je pouze jednou.\nconst _loggedWarnings = new Set();\nfunction warnOnce(id, msg, meta) {\n  try {\n    const key = id + '|' + (meta && typeof meta === 'object' ? JSON.stringify(meta) : String(meta));\n    if (_loggedWarnings.has(key)) return;\n    _loggedWarnings.add(key);\n  } catch (_err) {\n    // Pokud JSON.stringify sele, fallback na id-only kl\n    if (_loggedWarnings.has(id)) return;\n    _loggedWarnings.add(id);\n  }\n\n  if (typeof console !== 'undefined') {\n    if (console.error) console.error(msg, meta);\n    else if (console.warn) console.warn(msg, meta);\n  }\n}\n\n/**\n * Helper funkce pro parsovn workflow stav z JSON\n */\nconst parseWorkflowStates = (workflowCode) => {\n  if (!workflowCode) return ['ODESLANA_KE_SCHVALENI'];\n  if (typeof workflowCode === 'string') {\n    try {\n      const parsed = JSON.parse(workflowCode);\n      if (Array.isArray(parsed)) {\n        return parsed.length > 0 ? parsed : ['ODESLANA_KE_SCHVALENI'];\n      }\n      return [workflowCode];\n    } catch {\n      return [workflowCode];\n    }\n  }\n  const result = Array.isArray(workflowCode) ? workflowCode : [workflowCode];\n  return result.length > 0 ? result : ['ODESLANA_KE_SCHVALENI'];\n};\n\n/**\n * Helper funkce pro kontrolu ptomnosti workflow stavu\n */\nconst hasWorkflowState = (workflowCode, state) => {\n  const states = parseWorkflowStates(workflowCode);\n  const result = states.includes(state);\n\n  //  DEBUG: Log typu state parametru  vypisujeme pouze jednou pro stejn payload\n  if (typeof state !== 'string' || (typeof state === 'string' && state.includes(',')) || Array.isArray(state)) {\n    warnOnce('hasWorkflowState', ' [hasWorkflowState] CHYBA: state by ml bt string, ne pole!', {\n      state,\n      typeofState: typeof state,\n      isArray: Array.isArray(state),\n      workflowCode,\n      parsedStates: states\n    });\n  }\n\n  return result;\n};\n\n/**\n *  DEFINICE SEKC S JEJICH WORKFLOW VAZBAMI\n *\n * Kad sekce m:\n * - name: Lidsky iteln nzev\n * - phase: slo fze, kdy se sekce zobrazuje (null = vdy viditeln)\n * - visibilityLogic: Funkce urujc, zda je sekce VIDITELN (context) => boolean\n * - lockLogic: Funkce urujc, zda je sekce ZAMEN/DISABLED (context) => boolean\n */\nconst SECTION_DEFINITIONS = {\n  objednatel: {\n    name: 'Objednatel',\n    phase: 1,\n    visibilityLogic: (context) => context.currentPhase >= 1,\n    lockLogic: (context) => {\n      //  FZE 1 (NOVA) = VDY ODEMENO pro nov objednvky\n      if (context.currentPhase === 1 && !context.formData.id) {\n        return false; // ODEMENO\n      }\n\n      //  ADMIN UNLOCK: Pokud admin odemkl fzi 1, povolit editaci\n      if (context.unlockStates?.phase1) {\n        return false; // ODEMENO adminorem\n      }\n\n      //  ADMIN UNLOCK FZE 2: Pokud admin odemkl fzi 2 (resetuje na FZI 2), povolit editaci\n      // Tento unlock se pouv z PO sekce a resetuje workflow na ODESLANA_KE_SCHVALENI\n      if (context.unlockStates?.phase2) {\n        return false; // ODEMENO adminorem (resetoval na FZI 2, objednatel mus bt odemen)\n      }\n\n      //  Zamknout POUZE pokud jsme PELI fzi 2 (currentPhase > 2)\n      // FZE 2 = ODESLANA_KE_SCHVALENI - sekce Objednatel mus bt odemen\n      if (context.currentPhase > 2) {\n        return true; // ZAMENO (jsme u dl ne fze 2)\n      }\n\n      return false; // Jinak ODEMENO\n    }\n  },\n  schvaleni: {\n    name: 'Schvlen',\n    phase: 1,\n    visibilityLogic: (context) => context.currentPhase >= 1,\n    lockLogic: (context) => {\n      //  FZE 1 (NOVA) = VDY ODEMENO pro nov objednvky\n      if (context.currentPhase === 1 && !context.formData.id) {\n        return false; // ODEMENO\n      }\n\n      //  ADMIN UNLOCK: Pokud admin odemkl fzi 1, povolit editaci\n      if (context.unlockStates?.phase1) {\n        return false; // ODEMENO adminorem\n      }\n\n      //  ADMIN UNLOCK FZE 2: Pokud admin odemkl fzi 2 (resetuje na FZI 2), povolit editaci\n      // Tento unlock se pouv z PO sekce a resetuje workflow na ODESLANA_KE_SCHVALENI\n      if (context.unlockStates?.phase2) {\n        return false; // ODEMENO adminorem (resetoval na FZI 2, take PO sekce mus bt odemen)\n      }\n\n      //  Zamknout POUZE pokud jsme PELI fzi 2 (currentPhase > 2)\n      // FZE 2 = ODESLANA_KE_SCHVALENI - PO sekce (schvlen) mus bt odemen\n      if (context.currentPhase > 2) {\n        return true; // ZAMENO (jsme u dl ne fze 2)\n      }\n\n      return false; // Jinak ODEMENO\n    }\n  },\n  //  SEKCE \"prilohy\" ODSTRANNA - je nyn mimo workflow systm, zena samostatn v OrderForm25.js\n  // Viditeln pouze kdy m objednvka ID, zamen pouze pi stavu DOKONCENA\n  financovani: {\n    name: 'Financovn',\n    phase: 1, //  Fze 1-2 (viditeln a editovateln od zatku)\n    visibilityLogic: (context) => context.currentPhase >= 1, //  Viditeln od fze 1\n    lockLogic: (context) => {\n      //  FZE 1-2: Odemeno pro vyplnn (povinn ve FZI 1 a 2)\n      if (context.currentPhase >= 1 && context.currentPhase <= 2) {\n        return false; // ODEMENO\n      }\n\n      //  FZE 3+: Zameno (financovn se u nemn po schvlen)\n      if (context.currentPhase >= 3) {\n        return true; // ZAMENO\n      }\n\n      return false; // Jinak odemeno (fallback)\n    }\n  },\n  dodavatel: {\n    name: 'Dodavatel',\n    phase: 3, //  Fze 3\n    visibilityLogic: (context) => context.currentPhase >= 3,\n    lockLogic: (context) => {\n      if (context.unlockStates?.phase3_sections) {\n        return false;\n      }\n      if (context.currentPhase > 3) {\n        return true;\n      }\n      return false;\n    }\n  },\n  kontakt: {\n    name: 'Kontakt',\n    phase: 3, //  Fze 3\n    visibilityLogic: (context) => context.currentPhase >= 3,\n    lockLogic: (context) => {\n      if (context.unlockStates?.phase3_sections) {\n        return false;\n      }\n      if (context.currentPhase > 3) {\n        return true;\n      }\n      return false;\n    }\n  },\n  detaily: {\n    name: 'Detaily',\n    phase: 3, //  Fze 3\n    visibilityLogic: (context) => context.currentPhase >= 3,\n    lockLogic: (context) => {\n      if (context.unlockStates?.phase3_sections) {\n        return false;\n      }\n      if (context.currentPhase > 3) {\n        return true;\n      }\n      return false;\n    }\n  },\n  dodaci_podminky: {\n    name: 'Dodac podmnky',\n    phase: 3, //  Fze 3\n    visibilityLogic: (context) => context.currentPhase >= 3,\n    lockLogic: (context) => {\n      if (context.unlockStates?.phase3_sections) {\n        return false;\n      }\n      if (context.currentPhase > 3) {\n        return true;\n      }\n      return false;\n    }\n  },\n  stav_odeslani: {\n    name: 'Stav odesln',\n    phase: 3, //  Fze 3\n    visibilityLogic: (context) => context.currentPhase >= 3,\n    lockLogic: (context) => {\n      if (context.unlockStates?.phase3_sections) {\n        return false;\n      }\n      if (context.currentPhase > 3) {\n        return true;\n      }\n      return false;\n    }\n  },\n  potvrzeni_objednavky: {\n    name: 'Potvrzen objednvky',\n    phase: 3,\n    visibilityLogic: (context) => {\n      //  SKRYT pro POKLADNA reim\n      if (context.isPokladna) return false;\n      return context.currentPhase >= 4;\n    },\n    lockLogic: (context) => {\n      //  Zamknuto od FZE 5+ (pokud nen explicitn odemeno)\n      return context.currentPhase >= 5 && !context.unlockStates?.potvrzeni;\n    }\n  },\n  registr_smluv: {\n    name: 'Registr smluv',\n    phase: 4,  //  FZE 4 - pouze CHECKBOX \"M bt zveejnna\"\n    visibilityLogic: (context) => {\n      //  SKRYT pro POKLADNA reim\n      if (context.isPokladna) return false;\n      //  Viditeln ve FZI 4+ kdy dodavatel potvrdil ANO\n      //  ZMNA: Zobrazit i ve FZI 6+ (historie rozhodnut)\n      const potvrzeniAno = context.formData.dodavatel_zpusob_potvrzeni?.potvrzeni === 'ANO';\n      return potvrzeniAno && context.currentPhase >= 4;\n    },\n    lockLogic: (context) => {\n      //  Zamknuto od FZE 5+ (pokud nen explicitn odemeno)\n      return context.currentPhase >= 5 && !context.unlockStates?.registr;\n    }\n  },\n  registr_smluv_vyplneni: {\n    name: 'Vyplnn registru smluv',\n    phase: 5,  //  NOV FZE 5 - DATUM + IDDT + checkbox\n    visibilityLogic: (context) => {\n      //  SKRYT pro POKLADNA reim\n      if (context.isPokladna) return false;\n      //  Viditeln kdy workflow obsahuje UVEREJNIT nebo UVEREJNENA\n      //  ZMNA: Zobrazit i kdy je UVEREJNENA (jako disabled ve FZI 6+)\n      const hasUverejnit = hasWorkflowState(context.formData.stav_workflow_kod, 'UVEREJNIT');\n      const hasUverejnena = hasWorkflowState(context.formData.stav_workflow_kod, 'UVEREJNENA');\n      return hasUverejnit || hasUverejnena;\n    },\n    lockLogic: (context) => {\n      //  Zamknuto od FZE 6+ (pokud nen explicitn odemeno)\n      return context.currentPhase >= 6 && !context.unlockStates?.registr_vyplneni;\n    }\n  },\n  prubeh_objednavky: {\n    name: 'Prbh objednvky',\n    phase: null,\n    visibilityLogic: () => true, // Vdy viditeln\n    lockLogic: () => false // Nikdy zamen\n  },\n  dodaci_informace: {\n    name: 'Dodac informace',\n    phase: null,\n    visibilityLogic: () => true,\n    lockLogic: () => false\n  },\n  fakturace: {\n    name: 'Fakturace',\n    phase: 6,  //  ZMNA: 8  6\n    visibilityLogic: (context) => {\n      //  SKRYT pro POKLADNA reim\n      if (context.isPokladna) return false;\n      //  Viditeln od fze 6 A VE (6, 7, 8, 9)\n      // Zobraz se kdy: UVEREJNENA (z FZE 5) nebo NEUVEREJNIT (peskoeno z FZE 4) nebo FAKTURACE\n      return context.currentPhase >= 6;\n    },\n    lockLogic: (context) => {\n      //  Zamknuto od FZE 7+ (pokud nen explicitn odemeno)\n      return context.currentPhase >= 7 && !context.unlockStates?.fakturace;\n    }\n  },\n  vecna_spravnost: {\n    name: 'Vcn sprvnost',\n    phase: 7,  //  ZMNA: 9  7\n    visibilityLogic: (context) => {\n      //  Viditeln od fze 7 A VE (7, 8, 9)\n      return context.currentPhase >= 7;\n    },\n    lockLogic: (context) => {\n      //  Zamknuto od FZE 8+ (pokud nen explicitn odemeno)\n      return context.currentPhase >= 8 && !context.unlockStates?.vecna_spravnost;\n    }\n  },\n  dokonceni: {\n    name: 'Dokonen',\n    phase: 8,  //  FZE 8 - zobrazuje se po ZKONTROLOVANA (ve stejn fzi)\n    visibilityLogic: (context) => {\n      //  Viditeln POUZE kdy:\n      // 1. Objednvka je SKUTEN DOKONENA (stav DOKONCENA)\n      // 2. NEBO m uivatel prvo canUnlockAnything (bude pedno z extendedSectionStates)\n      // Poznmka: canUnlockAnything kontrola je v OrderForm25.js v extendedSectionStates\n      const isDokoncena = hasWorkflowState(context.formData.stav_workflow_kod, 'DOKONCENA');\n      return isDokoncena; // zkladn viditelnost - rozeno v extendedSectionStates\n    },\n    lockLogic: (context) => {\n      //  Zamknuto po DOKONCENA (pokud nen explicitn odemeno)\n      return hasWorkflowState(context.formData.stav_workflow_kod, 'DOKONCENA') && !context.unlockStates?.dokonceni;\n    }\n  }\n};\n\n/**\n *  CENTRALIZOVAN LOGIKA STAVU SEKC\n *\n * Uruje kompletn stav sekce: visible (viditeln) a enabled (odemen).\n * Toto je JEDIN SOURCE OF TRUTH pro stavy sekc!\n *\n * @param {string} sectionKey - Kl sekce (nap. 'objednatel', 'prilohy')\n * @param {Object} formData - Data formule\n * @param {Object} unlockStates - Stavy odemen sekc\n * @param {Object} context - Dodaten kontext (permissions, flags)\n * @returns {Object} { visible: boolean, enabled: boolean }\n */\nconst calculateSectionState = (sectionKey, formData, unlockStates = {}, context = {}) => {\n  const section = SECTION_DEFINITIONS[sectionKey];\n  if (!section) {\n    return { visible: false, enabled: false }; // neznm sekce nen viditeln ani odemen\n  }\n\n  //  Detekce archivovan objednvky\n  const isArchived = context.isArchived || false;\n\n  // Kontext pro vyhodnocen (vechny potebn flagy)\n  const evalContext = {\n    formData,\n    currentPhase: context.currentPhase || calculateCurrentPhase(formData),\n    isArchived, //  Pidn flag pro archivovan objednvky\n\n    // Unlock stavy (pro pstup v lockLogic funkcch)\n    //  FIX: Pout sprvn kle z OrderForm25.js (phase1, phase2, phase3, ...)\n    unlockStates: {\n      phase1: unlockStates.phase1 || false,\n      phase2: unlockStates.phase2 || false,\n      phase3: unlockStates.phase3 || false,\n      registr: unlockStates.registr || false,\n      fakturace: unlockStates.fakturace || false,\n      vecna_spravnost: unlockStates.vecna_spravnost || false,\n      dokonceni: unlockStates.dokonceni || false,\n      potvrzeni: unlockStates.potvrzeni || false\n    },\n\n    // Permissions\n    canEditApprovedSections: context.canEditApprovedSections || false,\n\n    // UI flags\n    showSaveProgress: context.showSaveProgress || false,\n    isSaving: context.isSaving || false,\n\n    // Workflow locks (centrln vypotan hodnoty)\n    isWorkflowLocked: context.isWorkflowLocked || false,\n\n    // Phase-specific locks (vypotan v OrderForm25)\n    shouldLockPhase1Sections: context.shouldLockPhase1Sections || false,\n    shouldLockPhase2Sections: context.shouldLockPhase2Sections || false,\n    shouldLockPhase3Sections: context.shouldLockPhase3Sections || false,\n\n    // Section-specific locks\n    isRegistrLocked: context.isRegistrLocked || false,\n    isFakturaceDisplayLocked: context.isFakturaceDisplayLocked || false,\n    isVecnaSpravnostLocked: context.isVecnaSpravnostLocked || false,\n    isDokonceniLocked: context.isDokonceniLocked || false\n  };\n\n  //  ARCHIVOVAN OBJEDNVKY: Zobraz VECHNY sekce (viditeln vdy = true)\n  // Vyhodnotit viditelnost: bu archivovan (vdy true) NEBO pvodn logika podle fze\n  const visible = isArchived || section.visibilityLogic(evalContext);\n\n  //  CENTRLN GLOBLN ZMEK: Pokud je isWorkflowLocked = true, VECHNY sekce jsou zamen\n  // isWorkflowLocked = isFormLocked (DOKONCENA || ZAMITNUTA || ZRUSENA) && !canUnlockAnything\n  if (evalContext.isWorkflowLocked) {\n    return {\n      visible,\n      enabled: false // GLOBLN ZAMENO - formul je v jednom z finlnch stav\n    };\n  }\n\n  //  ARCHIVOVAN OBJEDNVKY: Vechny sekce ODEMEN (locked = false)\n  // Vyhodnotit zamen: bu archivovan (vdy false = odemeno) NEBO pvodn logika\n  const locked = visible ? (isArchived ? false : section.lockLogic(evalContext)) : false;\n\n  return {\n    visible,\n    enabled: !locked // enabled = opak locked\n  };\n};\n\n/**\n *  ZPTN KOMPATIBILITA: CENTRALIZOVAN LOGIKA ZAMYKN SEKC\n *\n * @deprecated Pouij radji calculateSectionState() kter vrac { visible, enabled }\n * @returns {boolean} true = sekce JE zamen, false = sekce NEN zamen\n */\nconst calculateSectionLockState = (sectionKey, formData, unlockStates = {}, context = {}) => {\n  // Pouij novou funkci a vra jen 'enabled' stav (invertovan)\n  const state = calculateSectionState(sectionKey, formData, unlockStates, context);\n  return !state.enabled; // locked = opak enabled\n};\n\n/**\n *  DEFINICE 10 FZ WORKFLOW\n *\n * FZE 1/10: NOVA - Vytvoen konceptu (nen v DB)\n * FZE 2/10: ODESLANA_KE_SCHVALENI - ek na schvlen\n * FZE 3/10: SCHVALENA (+ROZPRACOVANA) - Schvlen, uivatel vypluje detaily\n *             - SCHVALENA = prv odemknuto, ek na vyplnn\n *             - SCHVALENA + ROZPRACOVANA = uloeno, ale jet neodeslno (pracuje se na tom)\n * FZE 4/10: ODESLANA - Odeslno dodavateli (nahrazuje ROZPRACOVANA)\n * FZE 5/10: POTVRZENA - Potvrzena dodavatelem (zobraz se sekce Registr smluv s checkboxem \"M bt zveejnna\")\n * FZE 6/10: (REZERVOVNO - nyn nepouito)\n * FZE 7/10: UVEREJNIT - Rozhodnuto o zveejnn (vyplovn daj o zveejnn)\n * FZE 8/10: FAKTURACE nebo NEUVEREJNIT - Faktury pidny (nebo peskoeno ze 5 pokud NE)\n * FZE 9/10: KONTROLA/ZKONTROLOVANA - Vcn sprvnost\n * FZE 10/10: DOKONCENA - Hotovo\n */\nconst PHASE_DEFINITIONS = [\n  { id: 1, name: 'Vytvoen', class: 'phase-1', description: 'Vytvoen konceptu' },\n  { id: 2, name: 'Ke schvlen', class: 'phase-2', description: 'ek na schvlen' },\n  { id: 3, name: 'Schvlen', class: 'phase-3', description: 'Schvlen, rozpracovan' },\n  { id: 4, name: 'Odeslno', class: 'phase-4', description: 'Odeslno dodavateli' },\n  { id: 5, name: 'Potvrzen', class: 'phase-5', description: 'Potvrzena dodavatelem' },\n  { id: 6, name: 'Rozhodnut', class: 'phase-6', description: 'Rozhodnut o zveejnn' },\n  { id: 7, name: 'Uveejnn', class: 'phase-7', description: 'Vyplnn daj o zveejnn' },\n  { id: 8, name: 'Fakturace', class: 'phase-8', description: 'Faktury pidny' },\n  { id: 9, name: 'Vcn sprvnost', class: 'phase-9', description: 'Vcn sprvnost' },\n  { id: 10, name: 'Dokonen', class: 'phase-10', description: 'Hotovo' }\n];\n\n/**\n *  CENTRALIZOVAN LOGIKA PRO UREN AKTULN FZE\n *\n * Tato funkce je JEDIN SOURCE OF TRUTH pro uren fze objednvky.\n * Veker logika je zde - dn duplicity!\n *\n *  FZE SE URUJE PODLE POSLEDNHO STAVU V stav_workflow_kod\n *\n * @param {Object} formData - Data formule objednvky\n * @returns {number} slo aktuln fze (1-10)\n */\nconst calculateCurrentPhase = (formData) => {\n  // FZE 1: Nen uloeno v DB NEBO m explicitn stav NOVA/KONCEPT\n  if (!formData.id || hasWorkflowState(formData.stav_workflow_kod, 'NOVA')) {\n    return 1;\n  }\n\n  //  KLOV ZMNA: Bere POUZE POSLEDN STAV (aktuln), ne vechny historick\n  const workflowStates = parseWorkflowStates(formData.stav_workflow_kod);\n  const lastState = workflowStates[workflowStates.length - 1];\n\n  // Mapovn poslednho stavu na fzi (8 fz celkem)\n  const stateToPhaseMap = {\n    'DOKONCENA': 8,          //  DOKONCENA = konec procesu ve FZI 8 (ne samostatn fze 9)\n    'ZKONTROLOVANA': 8,      //  FZE 8 - zobraz sekci Dokonen\n    'VECNA_SPRAVNOST': 7,    //  FZE 7 - Vcn sprvnost\n    'FAKTURACE': 6,          //  FZE 6 - Fakturace\n    'NEUVEREJNIT': 6,        //  FZE 6 - pesko FZI 5\n    'UVEREJNENA': 6,         //  FZE 6\n    'UVEREJNIT': 5,          //  FZE 5 - voliteln (vyplnn registru)\n    'POTVRZENA': 4,          //  FZE 4 - Potvrzen dodavatele + rozhodnut o zveejnn\n    'ODESLANA': 4,\n    'ROZPRACOVANA': 3,\n    'SCHVALENA': 3,\n    'ZRUSENA': 3,            //  STORNOVNA = FZE 3 (storno ped odeslnm, viditeln jen do schvlen)\n    'ZAMITNUTA': 3,          //  ZAMTNUTA = FZE 3 (zamtnut pi schvlen)\n    'CEKA_SE': 2,\n    'ODESLANA_KE_SCHVALENI': 2,\n    'NOVA': 1\n  };\n\n  return stateToPhaseMap[lastState] || 1;\n};\n\n/**\n *  Uren tma barvy podle fze\n */\nconst getPhaseTheme = (workflowCode, isStorno) => {\n  // Storno m error tma\n  if (isStorno || hasWorkflowState(workflowCode, 'ZRUSENA')) {\n    return 'phase-error';\n  }\n\n  // FZE 4+: POTVRZENA nebo DOKONCENA\n  if (hasWorkflowState(workflowCode, 'POTVRZENA') ||\n      hasWorkflowState(workflowCode, 'DOKONCENA')) {\n    return 'phase-4';\n  }\n\n  // FZE 3: SCHVALENA + ODESLANA\n  if (hasWorkflowState(workflowCode, 'SCHVALENA') &&\n      hasWorkflowState(workflowCode, 'ODESLANA')) {\n    return 'phase-3';\n  }\n\n  // FZE 2: Pouze SCHVALENA (ale ne ODESLANA)\n  if (hasWorkflowState(workflowCode, 'SCHVALENA')) {\n    return 'phase-2';\n  }\n\n  // FZE 1: NOVA, CEKA_SE, ZAMITNUTA\n  return 'phase-1';\n};\n\n/**\n *  UNLOCK HELPERS - Funkce pro odemykn sekc s modifikac workflow\n *\n * Tyto funkce vrac POUZE DATA pro aktualizaci - nemodifikuj state pmo!\n * OrderForm25 je zodpovdn za voln setFormData() s vrcenmi daty.\n */\n\n/**\n * Piprav data pro odemknut FZE 2 (Plohy)\n * Vrac: { updatedFormData, unlockState }\n */\nconst preparePhase2Unlock = (formData) => {\n  //  ODEMKNUT FZE 2 = vrtit se na ODESLANA_KE_SCHVALENI (vymazat vechny vy fze)\n  const newWorkflowCode = JSON.stringify(['ODESLANA_KE_SCHVALENI']);\n\n  return {\n    updatedFormData: {\n      ...formData,\n      stav_odeslano: false,\n      datum_odeslani: '',\n      stav_stornovano: false,\n      datum_storna: '',\n      odeslani_storno_duvod: '',\n      stav_workflow_kod: newWorkflowCode,\n      dodavatel_zpusob_potvrzeni: { potvrzeni: '', datum: '', zpusob: '', poznamka: '' },\n      dt_akceptace: '',\n      stav_u_dodavatele: '',\n      datum_zmeny_stavu: '',\n      poznamka_stav: '',\n      cislo_zasilky: '',\n      prepravce: '',\n      ocekavane_doruceni: '',\n      skutecne_doruceni: '',\n      cislo_faktury: '',\n      datum_faktury: '',\n      castka_bez_dph: '',\n      castka_s_dph: '',\n      datum_platby: '',\n      dt_zverejneni: '',\n      registr_iddt: '',\n      ma_byt_zverejnena: false,\n      faktury: []\n    },\n    unlockState: 'phase2',\n    newPhase: 2\n  };\n};\n\n/**\n * Piprav data pro odemknut FZE 3 (Financovn, Dodavatel, Detaily...)\n * Vrac: { updatedFormData, unlockState }\n */\nconst preparePhase3Unlock = (formData) => {\n  //  ODEMKNUT FZE 3 = vrtit se na SCHVALENA (vymazat vechny vy fze)\n  const newWorkflowCode = JSON.stringify(['SCHVALENA']);\n\n  return {\n    updatedFormData: {\n      ...formData,\n      stav_workflow_kod: newWorkflowCode,\n      stav_odeslano: false,\n      datum_odeslani: '',\n      dodavatel_zpusob_potvrzeni: { potvrzeni: '', datum: '', zpusob: '', poznamka: '' },\n      dt_akceptace: '',\n      stav_u_dodavatele: '',\n      datum_zmeny_stavu: '',\n      poznamka_stav: '',\n      cislo_zasilky: '',\n      prepravce: '',\n      ocekavane_doruceni: '',\n      skutecne_doruceni: '',\n      cislo_faktury: '',\n      datum_faktury: '',\n      castka_bez_dph: '',\n      castka_s_dph: '',\n      datum_platby: '',\n      faktury: [],\n      dt_zverejneni: '',\n      registr_iddt: '',\n      ma_byt_zverejnena: false,\n      potvrdil_vecnou_spravnost_id: '',\n      dt_potvrzeni_vecne_spravnosti: '',\n      vecna_spravnost_poznamka: ''\n    },\n    unlockState: 'phase3_sections',\n    newPhase: 3\n  };\n};\n\n/**\n * Piprav data pro odemknut FZE 4 (Potvrzen dodavatele)\n * Vrac: { updatedFormData, unlockState }\n */\nconst preparePhase4Unlock = (formData) => {\n  //  ODEMKNUT FZE 4 = vrtit se na [\"SCHVALENA\", \"ODESLANA\"] (vymazat vechny vy fze)\n  const newWorkflowCode = JSON.stringify(['SCHVALENA', 'ODESLANA']);\n\n  return {\n    updatedFormData: {\n      ...formData,\n      stav_workflow_kod: newWorkflowCode,\n      dodavatel_zpusob_potvrzeni: { potvrzeni: '', datum: '', zpusob: '', poznamka: '' },\n      dt_akceptace: '',\n      dt_zverejneni: '',\n      registr_iddt: '',\n      faktury: [],\n      potvrdil_vecnou_spravnost_id: null,\n      dt_potvrzeni_vecne_spravnosti: '',\n      potvrzeni_vecne_spravnosti: 0,\n      dokoncil_id: null,\n      dt_dokonceni: '',\n      potvrzeni_dokonceni_objednavky: 0\n    },\n    unlockState: 'potvrzeni',\n    newPhase: 4\n  };\n};\n\n/**\n *  HLAVN HOOK - useWorkflowManager\n *\n * Poskytuje centralizovan pstup k workflow logice:\n * - getCurrentPhase() - aktuln fze (1-10)\n * - getPhaseProgress() - data pro progress bar\n * - getPhaseTheme() - tma barvy pro fzi\n * - parseWorkflowStates() - parsovn workflow kdu\n * - hasWorkflowState() - kontrola ptomnosti stavu\n * - unlockSection() - NOV: Odemknut sekce s vrcenm dat pro update\n *\n * @param {Object} formData - Data formule objednvky\n * @param {boolean} isArchived - TRUE pokud je objednvka archivovan\n * @returns {Object} Workflow manager API\n */\nexport const useWorkflowManager = (formData, isArchived = false) => {\n  //  INTERN STATE: Force refresh kl pro pepoet workflow po zmnch\n  const [workflowRefreshKey, setWorkflowRefreshKey] = useState(0);\n\n  //  DETEKCE POKLADNA REIMU\n  // Reim POKLADNA znamen:\n  // - Peskoen fz 3-6 (Potvrzen dodavatele, Registr, Zveejnn, Fakturace)\n  // - Automatick skok z ODESLANA  VECNA_SPRAVNOST (Fze 7)\n  // - Kontrola MAX ceny podle soutu poloek (ne faktur)\n  const isPokladna = useMemo(() => {\n    // Kontrola v objektu financovn\n    const isPlatbaPokladnaObj = formData.financovani?.platba === 'pokladna';\n    // Kontrola v dodavatel_zpusob_potvrzeni\n    const isPlatbaPokladnaDodavatel = formData.dodavatel_zpusob_potvrzeni?.platba === 'pokladna';\n\n    return isPlatbaPokladnaObj || isPlatbaPokladnaDodavatel;\n  }, [formData.financovani?.platba, formData.dodavatel_zpusob_potvrzeni?.platba]);\n\n  //  UNLOCK STATES: Centralizovan stavy pro odemykn sekc\n  const [unlockedSections, setUnlockedSections] = useState({\n    phase1: false,\n    phase2: false,\n    phase3_sections: false,\n    potvrzeni: false,\n    registr: false,\n    registr_vyplneni: false,\n    fakturace: false,\n    vecna_spravnost: false,\n    dokonceni: false\n  });\n\n  //  METODY PRO ODEMYKN/ZAMYKN SEKC\n  const unlockSection = useCallback((sectionKey) => {\n    setUnlockedSections(prev => ({ ...prev, [sectionKey]: true }));\n  }, []);\n\n  const lockSection = useCallback((sectionKey) => {\n    setUnlockedSections(prev => ({ ...prev, [sectionKey]: false }));\n  }, []);\n\n  const isSectionUnlocked = useCallback((sectionKey) => {\n    return unlockedSections[sectionKey] || false;\n  }, [unlockedSections]);\n\n  const resetAllUnlocks = useCallback(() => {\n    setUnlockedSections({\n      phase1: false,\n      phase2: false,\n      phase3_sections: false,\n      potvrzeni: false,\n      registr: false,\n      registr_vyplneni: false,\n      fakturace: false,\n      vecna_spravnost: false,\n      dokonceni: false\n    });\n  }, []);\n\n  //  FORCE REFRESH: Funkce pro vynucen pepotu workflow (exportovna v API)\n  const forceRefresh = useCallback(() => {\n    setWorkflowRefreshKey(prev => prev + 1);\n  }, []);\n\n  //  Aktuln fze - useMemo pro optimalizaci\n  //  FZE SE URUJE JEN PODLE stav_workflow_kod - dn dal atributy!\n  //  Pro archivovan objednvky nastavme fzi na 8 (vechny sekce viditeln)\n  const currentPhase = useMemo(() => {\n    //  Archivovan objednvky = fze 8 (maximum)\n    if (isArchived) {\n      return 8;\n    }\n\n    const phase = calculateCurrentPhase(formData);\n    return phase;\n  }, [\n    formData.id,\n    formData.stav_workflow_kod,\n    workflowRefreshKey,\n    isArchived\n  ]);\n\n  //  Tma barvy pro fzi\n  const phaseTheme = useMemo(() => {\n    return getPhaseTheme(formData.stav_workflow_kod, formData.stav_stornovano);\n  }, [formData.stav_workflow_kod, formData.stav_stornovano]);\n\n  //  Progress bar data - kompletn informace o vech fzch\n  const phaseProgress = useMemo(() => {\n    const isStorno = formData.stav_stornovano;\n    const workflowCode = formData.stav_workflow_kod;\n\n    return {\n      currentPhase,\n      phases: PHASE_DEFINITIONS.map((phase, index) => {\n        const phaseNum = index + 1;\n        let fillClass = phase.class;\n        let isVisible = false;\n\n        // Uren viditelnosti a barvy segmentu\n        if ((isStorno || hasWorkflowState(workflowCode, 'ZRUSENA')) && phaseNum >= 2) {\n          fillClass = 'phase-error';\n          isVisible = phaseNum <= Math.max(currentPhase, 2);\n        } else {\n          isVisible = phaseNum <= currentPhase;\n        }\n\n        return {\n          ...phase,\n          isVisible,\n          isCurrent: phaseNum === currentPhase,\n          fillClass\n        };\n      })\n    };\n  }, [currentPhase, formData.stav_stornovano, formData.stav_workflow_kod]);\n\n  //  Helper funkce jako useCallback\n  const getCurrentPhaseCallback = useCallback(() => currentPhase, [currentPhase]);\n\n  const getPhaseProgressCallback = useCallback(() => phaseProgress, [phaseProgress]);\n\n  const getPhaseThemeCallback = useCallback(() => phaseTheme, [phaseTheme]);\n\n  const parseWorkflowStatesCallback = useCallback((code) => {\n    return parseWorkflowStates(code || formData.stav_workflow_kod);\n  }, [formData.stav_workflow_kod]);\n\n  //  OPRAVA: Callback mus pijmat 2 parametry (workflowCode, state)\n  // protoe v OrderForm25.js se vol ve 2 formch:\n  // 1) hasWorkflowState(formData.stav_workflow_kod, 'STATE') - explicitn workflowCode\n  // 2) hasWorkflowState('STATE') - pouije formData.stav_workflow_kod\n  const hasWorkflowStateCallback = useCallback((workflowCodeOrState, maybeState) => {\n    // Pokud je pouze 1 parametr, pouij formData.stav_workflow_kod jako workflowCode\n    if (maybeState === undefined) {\n      return hasWorkflowState(formData.stav_workflow_kod, workflowCodeOrState);\n    }\n    // Pokud jsou 2 parametry, pouij prvn jako workflowCode\n    return hasWorkflowState(workflowCodeOrState, maybeState);\n  }, [formData.stav_workflow_kod]);\n\n  //  Hlavn workflow state (pro zptnou kompatibilitu s workflow25.js)\n  const mainWorkflowState = useMemo(() => {\n    const states = parseWorkflowStates(formData.stav_workflow_kod);\n\n    // Hierarchie stav pro uren hlavnho stavu\n    const stateHierarchy = [\n      'DOKONCENA', 'POTVRZENA', 'CEKA_POTVRZENI', 'SCHVALENA',\n      'ODESLANA_KE_SCHVALENI', 'ZAMITNUTA', 'ZRUSENA', 'NOVA'\n    ];\n\n    // Najdi nejvznamnj stav\n    for (const hierarchyState of stateHierarchy) {\n      if (states.includes(hierarchyState)) {\n        const stateMapping = {\n          'CEKA_SE': 'ODESLANA_KE_SCHVALENI',\n          'ODESLANA': 'CEKA_POTVRZENI'\n        };\n        return stateMapping[hierarchyState] || hierarchyState;\n      }\n    }\n\n    // Fallback na posledn stav\n    const lastState = states.length > 0 ? states[states.length - 1] : 'NOVA';\n\n    // ROZPRACOVANA se chov jako SCHVALENA\n    if (lastState === 'ROZPRACOVANA' && states.includes('SCHVALENA')) {\n      return 'SCHVALENA';\n    }\n\n    return lastState || 'NOVA';\n  }, [formData.stav_workflow_kod]);\n\n  //  Section state helper (NOV FUNKCE)\n  const getSectionState = useCallback((sectionKey, unlockStates = {}, additionalContext = {}) => {\n    return calculateSectionState(sectionKey, formData, unlockStates, {\n      currentPhase,\n      isPokladna,  //  Pidno: pro podmnky skrvn sekc v POKLADNA reimu\n      isArchived,  //  Pro zobrazen vech sekc u archivovanch\n      ...additionalContext\n    });\n  }, [formData, currentPhase, isPokladna, isArchived]);\n\n  //  Section locking helper (DEPRECATED - pouij getSectionState)\n  const getSectionLockState = useCallback((sectionKey, unlockStates = {}, additionalContext = {}) => {\n    return calculateSectionLockState(sectionKey, formData, unlockStates, {\n      currentPhase,\n      isPokladna,  //  Pidno: pro podmnky skrvn sekc v POKLADNA reimu\n      ...additionalContext\n    });\n  }, [formData, currentPhase, isPokladna]);\n\n  //  Get all section lock states (for Collapse All button)\n  const getAllSectionLockStates = useCallback((unlockStates = {}, additionalContext = {}) => {\n    const lockStates = {};\n    Object.keys(SECTION_DEFINITIONS).forEach(sectionKey => {\n      lockStates[sectionKey] = getSectionLockState(sectionKey, unlockStates, additionalContext);\n    });\n    return lockStates;\n  }, [getSectionLockState]);\n\n  //  DETEKCE DOKONEN WORKFLOW (konen stavy)\n  //  TRUE pro DOKONCENA, ZAMITNUTA, ZRUSENA - vechny jsou konec workflow\n  const isWorkflowCompleted = useMemo(() => {\n    return !!(\n      formData.id && // Mus mt ID (uloeno v DB)\n      (hasWorkflowStateCallback(formData.stav_workflow_kod, 'DOKONCENA') ||\n       hasWorkflowStateCallback(formData.stav_workflow_kod, 'ZAMITNUTA') ||\n       hasWorkflowStateCallback(formData.stav_workflow_kod, 'ZRUSENA'))\n    );\n  }, [formData.id, formData.stav_workflow_kod, hasWorkflowStateCallback, workflowRefreshKey]);\n\n  //  DETEKCE ZAMTNUT OBJEDNVKY\n  const isWorkflowRejected = useMemo(() => {\n    return !!(\n      formData.id && // Mus mt ID (uloeno v DB)\n      hasWorkflowStateCallback(formData.stav_workflow_kod, 'ZAMITNUTA') // Objednvka byla zamtnuta\n    );\n  }, [formData.id, formData.stav_workflow_kod, hasWorkflowStateCallback, workflowRefreshKey]);\n\n  //  DETEKCE ZRUEN (STORNOVAN) OBJEDNVKY\n  const isWorkflowCancelled = useMemo(() => {\n    return !!(\n      formData.id && // Mus mt ID (uloeno v DB)\n      hasWorkflowStateCallback(formData.stav_workflow_kod, 'ZRUSENA') // Objednvka byla stornovna\n    );\n  }, [formData.id, formData.stav_workflow_kod, hasWorkflowStateCallback, workflowRefreshKey]);\n\n  //  UNIVERZLN ZAMEN FORMULE\n  // TRUE kdy je objednvka v jednom z finlnch stav: DOKONCENA, ZAMITNUTA, ZRUSENA (stornovna)\n  const isFormLocked = useMemo(() => {\n    return isWorkflowCompleted || isWorkflowRejected || isWorkflowCancelled;\n  }, [isWorkflowCompleted, isWorkflowRejected, isWorkflowCancelled]);\n\n  //  Get all section states (NOV FUNKCE) - MUS BT A PO isFormLocked!\n  const getAllSectionStates = useCallback((additionalContext = {}) => {\n    const states = {};\n    //  Pidat isWorkflowLocked do kontextu - kdy je formul zamen (DOKONCENA/ZAMITNUTA/ZRUSENA), vechny sekce jsou disabled\n    const contextWithLock = {\n      ...additionalContext,\n      isWorkflowLocked: isFormLocked //  Pedat isFormLocked do vech sekc\n    };\n    Object.keys(SECTION_DEFINITIONS).forEach(sectionKey => {\n      states[sectionKey] = getSectionState(sectionKey, unlockedSections, contextWithLock);\n    });\n\n    return states;\n  }, [getSectionState, currentPhase, formData.id, unlockedSections, isFormLocked]);\n\n  //  UNLOCK API - Funkce pro ppravu odemknut sekc\n  const unlockPhase2 = useCallback(() => {\n    return preparePhase2Unlock(formData);\n  }, [formData]);\n\n  const unlockPhase3 = useCallback(() => {\n    return preparePhase3Unlock(formData);\n  }, [formData]);\n\n  const unlockPhase4 = useCallback(() => {\n    return preparePhase4Unlock(formData);\n  }, [formData]);\n\n  //  Return API\n  return {\n    // Computed values\n    currentPhase,\n    phaseTheme,\n    phaseProgress,\n    mainWorkflowState,\n\n    //  Payment mode detection\n    isPokladna,                // NOV: TRUE pokud je reim POKLADNA (peskakuj se fze 3-6)\n\n    //  Archive mode detection\n    isArchived,  // NOV: TRUE pokud je objednvka archivovan\n\n    //  Workflow locking states\n    isWorkflowCompleted,       // NOV: objednvka je v konenm stavu (DOKONCENA || ZAMITNUTA || ZRUSENA)\n    isWorkflowRejected,        // NOV: objednvka byla zamtnuta\n    isWorkflowCancelled,       // NOV: objednvka byla stornovna\n\n    //  FORCE REFRESH API\n    forceRefresh,              // NOV: funkce pro vynucen pepotu workflow\n\n    //  UNLOCK/LOCK API - NOV: Centralizovan zen odemykn sekc\n    unlockSection,             // Odemkne konkrtn sekci\n    lockSection,               // Zamkne konkrtn sekci\n    isSectionUnlocked,         // Zjist zda je sekce odemena\n    resetAllUnlocks,           // Resetuje vechny unlock states (po uloen)\n    unlockPhase2,              // Odemkne FZI 2 (Plohy) - piprav data\n    unlockPhase3,              // Odemkne FZI 3 (Financovn, Dodavatel...) - piprav data\n    unlockPhase4,              // Odemkne FZI 4 (Potvrzen dodavatele) - piprav data\n\n    // Helper functions\n    getCurrentPhase: getCurrentPhaseCallback,\n    getPhaseProgress: getPhaseProgressCallback,\n    getPhaseTheme: getPhaseThemeCallback,\n    parseWorkflowStates: parseWorkflowStatesCallback,\n    hasWorkflowState: hasWorkflowStateCallback,\n\n    // Section state API (NOV)\n    getSectionState,           // NOV: vrac { visible, enabled }\n    getAllSectionStates,       // NOV: vrac vechny stavy sekc\n\n    // Section locking API (DEPRECATED - pouij getSectionState)\n    getSectionLockState,\n    getAllSectionLockStates,\n    sectionDefinitions: SECTION_DEFINITIONS,\n\n    // Raw phase definitions (for UI rendering)\n    phaseDefinitions: PHASE_DEFINITIONS\n  };\n};\n\n//  REMOVED: export default - pouvme named export\n\n","import React, { useState, useEffect } from 'react';\nimport { createPortal } from 'react-dom';\nimport styled from '@emotion/styled';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTimes, faSpinner, faCheckCircle, faTimesCircle } from '@fortawesome/free-solid-svg-icons';\nimport { pdf } from '@react-pdf/renderer';\nimport FinancialControlPDF from './FinancialControlPDF';\nimport { getOrganizaceDetail } from '../services/apiv2Dictionaries';\nimport { getStrediska25 } from '../services/api25orders';\nimport { uploadOrderAttachment } from '../services/apiOrderV2';\nimport { getUserDetail } from '../services/apiEntityDetail';\n\n// Styled components\nconst ModalOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.85);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n  padding: 0;\n`;\n\nconst ModalContainer = styled.div`\n  background: white;\n  border-radius: 0;\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n`;\n\nconst ModalHeader = styled.div`\n  padding: 20px 24px;\n  border-bottom: 2px solid #e5e7eb;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  background: linear-gradient(135deg, #059669 0%, #047857 100%);\n  color: white;\n`;\n\nconst ModalTitle = styled.h2`\n  margin: 0;\n  font-size: 1.5rem;\n  font-weight: 700;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n`;\n\nconst CloseButton = styled.button`\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  font-size: 1.5rem;\n  cursor: pointer;\n  padding: 8px 12px;\n  border-radius: 6px;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n`;\n\nconst ModalContent = styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background: #f9fafb;\n`;\n\nconst PDFPreview = styled.div`\n  flex: 1;\n  padding: 0;\n  overflow: hidden;\n  display: flex;\n\n  iframe {\n    width: 100%;\n    height: 100%;\n    border: none;\n    background: white;\n  }\n`;\n\nconst LoadingContainer = styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: #6b7280;\n  gap: 20px;\n  min-height: 400px;\n  background: #f9fafb;\n\n  svg {\n    font-size: 4rem;\n    color: #059669;\n    animation: spin 1s linear infinite;\n  }\n\n  .main-text {\n    font-size: 1.2rem;\n    font-weight: 600;\n    color: #374151;\n    text-align: center;\n  }\n\n  .sub-text {\n    font-size: 1rem;\n    color: #6b7280;\n    text-align: center;\n    margin-top: 8px;\n  }\n\n  @keyframes spin {\n    from {\n      transform: rotate(0deg);\n    }\n    to {\n      transform: rotate(360deg);\n    }\n  }\n`;\n\nconst ModalFooter = styled.div`\n  padding: 20px 24px;\n  border-top: 2px solid #e5e7eb;\n  background: white;\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n`;\n\nconst InfoBox = styled.div`\n  background: #eff6ff;\n  border-left: 4px solid #3b82f6;\n  padding: 12px 16px;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  line-height: 1.5;\n  color: #1e40af;\n`;\n\nconst ButtonGroup = styled.div`\n  display: flex;\n  gap: 12px;\n  justify-content: flex-end;\n`;\n\nconst Button = styled.button`\n  padding: 12px 24px;\n  border-radius: 8px;\n  font-size: 1rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n  border: none;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n`;\n\nconst ButtonCancel = styled(Button)`\n  background: #f3f4f6;\n  color: #374151;\n\n  &:hover:not(:disabled) {\n    background: #e5e7eb;\n  }\n`;\n\nconst ButtonConfirm = styled(Button)`\n  background: linear-gradient(135deg, #059669 0%, #047857 100%);\n  color: white;\n\n  &:hover:not(:disabled) {\n    transform: translateY(-1px);\n    box-shadow: 0 4px 6px -1px rgba(5, 150, 105, 0.3);\n  }\n`;\n\n/**\n * Modal pro potvrzen dokonen objednvky s nhledem finann kontroly\n * \n * @param {Object} order - Objednvka s kompletnmi daty\n * @param {Function} onConfirm - Callback pro potvrzen (ulo PDF + dokon objednvku)\n * @param {Function} onCancel - Callback pro zruen (odkrtne checkbox + ulo bez dokonen)\n * @param {Object} generatedBy - Informace o genertorovi {fullName, position}\n * @param {string} token - JWT token\n * @param {string} username - Username\n */\nconst FinancialControlConfirmationModal = ({ \n  order, \n  onConfirm, \n  onCancel, \n  generatedBy,\n  token,\n  username\n}) => {\n  const [pdfUrl, setPdfUrl] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSaving, setIsSaving] = useState(false);\n  const [organizace, setOrganizace] = useState(null);\n  const [strediskaMap, setStrediskaMap] = useState({});\n\n  // Generovn PDF nhledu pi oteven\n  useEffect(() => {\n    const generatePreview = async () => {\n      try {\n        setIsLoading(true);\n\n        //  Naten vizitky organizace (ID=1 - hlavn organizace)\n        let orgData = null;\n        try {\n          const orgResponse = await getOrganizaceDetail({ token, username, id: 1 });\n          orgData = orgResponse;\n        } catch (orgError) {\n          console.warn('Nepodailo se nast vizitku organizace:', orgError);\n        }\n\n        //  Naten stedisek pro pevod kd na nzvy\n        let strediska = {};\n        try {\n          const strediskaData = await getStrediska25({ token, username, aktivni: 1 });\n          if (Array.isArray(strediskaData)) {\n            strediska = strediskaData.reduce((acc, s) => {\n              if (s.kod_strediska) {\n                acc[s.kod_strediska] = s.nazev_strediska || s.kod_strediska;\n              }\n              return acc;\n            }, {});\n          }\n        } catch (strediskaError) {\n          console.warn('Nepodailo se nast stediska:', strediskaError);\n        }\n\n        setOrganizace(orgData);\n        setStrediskaMap(strediska);\n\n        //  Naten uivatel pro faktury s vcnou kontrolou\n        const enrichedFaktury = [];\n        if (order.faktury && Array.isArray(order.faktury)) {\n          for (const faktura of order.faktury) {\n            const enrichedFaktura = { ...faktura };\n            \n            // Nast uivatele pro vcnou kontrolu\n            if (faktura.potvrdil_vecnou_spravnost_id) {\n              try {\n                const userData = await getUserDetail(faktura.potvrdil_vecnou_spravnost_id);\n                enrichedFaktura.potvrdil_vecnou_spravnost = userData;\n              } catch (userError) {\n                console.warn('Nepodailo se nast uivatele:', userError);\n              }\n            }\n            \n            enrichedFaktury.push(enrichedFaktura);\n          }\n        }\n\n        //  Mapovn dat z OrderForm25 formData na formt oekvan FinancialControlPDF\n        // OrderForm25 m: polozky_objednavky, FinancialControlPDF oekv: polozky\n        const orderForPDF = {\n          ...order,\n          polozky: order.polozky_objednavky || order.polozky || [],\n          faktury: enrichedFaktury // Pout faktury s natenmi uivateli\n        };\n\n        // Vygenerovat PDF blob\n        const blob = await pdf(\n          <FinancialControlPDF \n            order={orderForPDF} \n            generatedBy={generatedBy}\n            organizace={orgData}\n            strediskaMap={strediska}\n          />\n        ).toBlob();\n\n        const url = URL.createObjectURL(blob);\n        setPdfUrl(url);\n        \n        // Minimln delay pro lep UX - aby loading nebyl pli rychl\n        await new Promise(resolve => setTimeout(resolve, 500));\n        \n        setIsLoading(false);\n      } catch (error) {\n        console.error('Chyba pi generovn nhledu finann kontroly:', error);\n        alert('Chyba pi generovn nhledu finann kontroly');\n        setIsLoading(false);\n      }\n    };\n\n    generatePreview();\n  }, [order, generatedBy, token, username]);\n\n  // Cleanup PDF URL pi unmount\n  useEffect(() => {\n    return () => {\n      if (pdfUrl) {\n        console.log(' Cleaning up PDF URL...');\n        URL.revokeObjectURL(pdfUrl);\n      }\n    };\n  }, [pdfUrl]);\n\n  //  POTVRDIT - Vrtit PDF data parent komponent pro upload\n  const handleConfirm = async () => {\n    try {\n      setIsSaving(true);\n\n      //  Naten uivatel pro faktury s vcnou kontrolou (stejn jako v generatePreview)\n      const enrichedFaktury = [];\n      if (order.faktury && Array.isArray(order.faktury)) {\n        for (const faktura of order.faktury) {\n          const enrichedFaktura = { ...faktura };\n          \n          // Nast uivatele pro vcnou kontrolu\n          if (faktura.potvrdil_vecnou_spravnost_id) {\n            try {\n              const userData = await getUserDetail(faktura.potvrdil_vecnou_spravnost_id);\n              enrichedFaktura.potvrdil_vecnou_spravnost = userData;\n            } catch (userError) {\n              console.warn('Nepodailo se nast uivatele:', userError);\n            }\n          }\n          \n          enrichedFaktury.push(enrichedFaktura);\n        }\n      }\n\n      //  Mapovn dat z OrderForm25 formData na formt oekvan FinancialControlPDF\n      const orderForPDF = {\n        ...order,\n        polozky: order.polozky_objednavky || order.polozky || [],\n        faktury: enrichedFaktury // Pout faktury s natenmi uivateli\n      };\n\n      // 1. Vygenerovat PDF jako File\n      const blob = await pdf(\n        <FinancialControlPDF \n          order={orderForPDF} \n          generatedBy={generatedBy}\n          organizace={organizace}\n          strediskaMap={strediskaMap}\n        />\n      ).toBlob();\n\n      // 2. Vytvoit nzev souboru: \"Financni_kontrola_YYYY-MM-DD_cislo_obj.pdf\"\n      const today = new Date();\n      const dateStr = today.toISOString().split('T')[0]; // YYYY-MM-DD\n      const orderNumber = (order.cislo_objednavky || 'neznama').replace(/[^a-zA-Z0-9]/g, '_');\n      const filename = `Financni_kontrola_${dateStr}_${orderNumber}.pdf`;\n\n      const pdfFile = new File([blob], filename, { type: 'application/pdf' });\n\n      console.log(' PDF vygenerovno, pedvm parent komponent...');\n\n      // 3. Pedat PDF parent komponent a OKAMIT zavt modal\n      onConfirm(pdfFile);\n      \n      // Modal je nyn zaven, parent pokrauje asynchronn na pozad\n\n    } catch (error) {\n      console.error(' Chyba pi generovn PDF:', error);\n      alert(`Chyba pi generovn PDF: ${error.message || error}`);\n      setIsSaving(false);\n    }\n  };\n\n  //  ZRUIT - Odkrtnout checkbox + uloit bez DOKONCENA\n  const handleCancel = () => {\n    onCancel();\n  };\n\n  // Zaven na ESC\n  useEffect(() => {\n    const handleEsc = (e) => {\n      if (e.key === 'Escape' && !isSaving) {\n        handleCancel();\n      }\n    };\n    window.addEventListener('keydown', handleEsc);\n    return () => window.removeEventListener('keydown', handleEsc);\n  }, [isSaving]);\n\n  return createPortal(\n    <ModalOverlay \n      onClick={(e) => { if (e.target === e.currentTarget && !isSaving && !isLoading) handleCancel(); }}\n    >\n      <ModalContainer onClick={(e) => e.stopPropagation()}>\n        <ModalHeader>\n          <ModalTitle>\n             Finann kontrola - Potvrzen dokonen objednvky\n          </ModalTitle>\n          \n          <CloseButton \n            onClick={handleCancel} \n            disabled={isSaving || isLoading}\n            title=\"Zavt (ESC)\"\n          >\n            <FontAwesomeIcon icon={faTimes} />\n          </CloseButton>\n        </ModalHeader>\n\n        <ModalContent>\n          {isLoading ? (\n            <LoadingContainer>\n              <FontAwesomeIcon icon={faSpinner} spin />\n              <div className=\"main-text\">Generuji finann kontrolu...</div>\n              <div className=\"sub-text\">\n                Prosm pokejte, dokument se pipravuje<br />\n                Natm data a vytvm PDF nhled\n              </div>\n            </LoadingContainer>\n          ) : (\n            <PDFPreview>\n              <iframe \n                src={pdfUrl} \n                title=\"Nhled finann kontroly\"\n                id=\"pdf-preview-iframe\"\n              />\n            </PDFPreview>\n          )}\n        </ModalContent>\n\n        <ModalFooter>\n          <InfoBox>\n             <strong>Ped dokonenm objednvky zkontrolujte finann kontrolu.</strong>\n            <br />\n            Po potvrzen bude dokument automaticky uloen jako ploha objednvky s klasifikac \"Kontrolka\" \n            a objednvka bude oznaena jako DOKONEN (nelze ji editovat).\n          </InfoBox>\n\n          <ButtonGroup>\n            <ButtonCancel \n              onClick={handleCancel}\n              disabled={isSaving}\n            >\n              <FontAwesomeIcon icon={faTimesCircle} />\n              Zruit dokonen\n            </ButtonCancel>\n\n            <ButtonConfirm \n              onClick={handleConfirm}\n              disabled={isLoading || isSaving}\n            >\n              {isSaving ? (\n                <>\n                  <FontAwesomeIcon icon={faSpinner} spin />\n                  Ukldm...\n                </>\n              ) : (\n                <>\n                  <FontAwesomeIcon icon={faCheckCircle} />\n                  Potvrdit a dokonit objednvku\n                </>\n              )}\n            </ButtonConfirm>\n          </ButtonGroup>\n        </ModalFooter>\n      </ModalContainer>\n    </ModalOverlay>,\n    document.body\n  );\n};\n\nexport default FinancialControlConfirmationModal;\n","import React, { useState, useContext, useEffect, useLayoutEffect, useRef, useCallback, useMemo } from 'react';\nimport ReactDOM, { flushSync } from 'react-dom';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport styled from '@emotion/styled';\nimport { keyframes } from '@emotion/react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faUser, faClipboardCheck, faChevronUp, faChevronDown, faTimes, faClipboard, faSave, faCheckCircle, faFileContract, faHashtag, faLock, faUnlock, faFileAlt, faFileCircleXmark, faTrash, faSync, faBrain, faDatabase, faDownload, faCheck, faClock, faBookmark, faInfoCircle, faExpand, faCompress, faCreditCard, faPlus, faMinus, faBuilding, faGlobe, faExclamationTriangle, faTimesCircle } from '@fortawesome/free-solid-svg-icons';\nimport { User, Package, Calendar, FileText, Building, CreditCard, Hash, Users, Mail, Phone, MapPin, Calculator, Coins, Unlock, Lock, Plus, Trash, Search, X, RefreshCw, Bookmark, Eye, CheckCircle, ShoppingCart, Info, Copy, FileDown, AlertCircle, CheckCircle2, AlertTriangle, InfoIcon } from 'lucide-react';\nimport { CustomSelect, SelectWithIcon } from '../components/CustomSelect';\nimport { InvoiceAttachmentsCompact, LPCerpaniEditor } from '../components/invoices';\nimport ConfirmDialog from '../components/ConfirmDialog';\nimport SupplierAddDialog from '../components/SupplierAddDialog';\nimport ModernHelper from '../components/ModernHelper'; //  Modern Sponka helper\nimport FloatingNavigator from '../components/FloatingNavigator'; //  Plovouc navigtor po sekcch\nimport { ToastContext } from '../context/ToastContext';\nimport { AuthContext } from '../context/AuthContext';\nimport { useActivity } from '../context/ActivityContext';\nimport { ProgressContext } from '../context/ProgressContext';\nimport backgroundTaskService from '../services/backgroundTaskService';\nimport ordersCacheService from '../services/ordersCacheService';\nimport draftManager from '../services/DraftManager'; //  CENTRALIZOVAN DRAFT MANAGER\nimport formDataManager from '../services/FormDataManager'; //  CENTRALIZOVAN DATA MANAGER\nimport { useAutosave } from '../hooks/useAutosave'; //  CENTRALIZOVAN AUTOSAVE HOOK\nimport { prettyDate, formatDateOnly } from '../utils/format';\nimport { fetchAllUsers, fetchApprovers, fetchLimitovanePrisliby, fetchLPDetail, searchSupplierByIco, searchSuppliersList, fetchSupplierContacts, createSupplier, updateSupplierByIco, fetchTemplatesList, fetchTemplatesListWithMeta, createTemplate, updateTemplate, deleteTemplate, getUserDetailApi2, fetchUskyList } from '../services/api2auth';\nimport { getSmlouvyList, getSmlouvaDetail, prepocetCerpaniSmluv } from '../services/apiSmlouvy';\n// NOTE: setDebugLogger removed - was unused (only commented call on line 11445)\nimport {\n  //  V2 API: Core CRUD operations\n  getOrderV2,           //  V2 API: GET order by ID\n  createOrderV2,        //  V2 API: CREATE order\n  updateOrderV2,        //  V2 API: UPDATE order\n  deleteOrderV2,        //  V2 API: DELETE order\n  getNextOrderNumberV2, //  V2 API: GET next order number\n  checkOrderNumberV2,   //  V2 API: CHECK order number availability\n  getOrderTimestampV2,  //  V2 API: GET order timestamp (lightweight)\n  //  V2 API: Order Attachments\n  uploadOrderAttachment,\n  listOrderAttachments,\n  downloadOrderAttachment,\n  deleteOrderAttachment,\n  verifyOrderAttachments,\n  //  V2 API: Invoice Attachments\n  uploadInvoiceAttachment,\n  listInvoiceAttachments,\n  downloadInvoiceAttachment,\n  deleteInvoiceAttachment,\n  //  V2 API: Lock/Unlock\n  lockOrderV2,\n  unlockOrderV2,\n  //  V2 API: Dictionaries\n  getTypyPrilohV2,\n  getTypyFakturV2,\n  //  V2 API: Utilities\n  generateAttachmentGUID,\n  generateSystemFilename,\n  createAttachmentMetadata,\n  isAllowedFileType,\n  isAllowedFileSize,\n  formatFileSize,\n  //  V2 API: Helpers\n  prepareDataForAPI,\n  normalizeError,\n  updateAttachmentV2\n} from '../services/apiOrderV2';\nimport { deleteInvoiceV2, createInvoiceV2, updateInvoiceV2 } from '../services/apiInvoiceV2';\nimport { saveFakturaLPCerpani, getFakturaLPCerpani } from '../services/apiFakturyLPCerpani';\nimport { notificationService, NOTIFICATION_TYPES } from '../services/notificationsUnified';\nimport { triggerNotification } from '../services/notificationsApi'; //  Org-hierarchy-aware notifications\nimport { WORKFLOW_STATES, getWorkflowPhase, canTransitionTo } from '../constants/workflow25';\nimport {\n  validateWorkflowData,\n  getSectionVisibility,\n  getFieldEditability,\n  getAvailableActions,\n  formatWorkflowState\n} from '../utils/workflowUtils';\nimport {\n  broadcastDraftUpdated,\n  broadcastDraftDeleted,\n  broadcastOrderSaved,\n  broadcastMessage\n} from '../utils/tabSync';\nimport { translateErrorMessageShort } from '../utils/errorTranslation';\nimport {\n  normalizeStrediskaFromBackend,\n  normalizeStrediskaForBackend,\n  normalizeFinancovaniFromBackend,\n  normalizeFinancovaniForBackend,\n  normalizeFakturaStrediskaFromBackend,\n  normalizeFakturaStrediskaForBackend\n} from '../utils/dataTransformHelpers';\n\n//  NOV: Import refactored hooks pro state management\nimport { useFormController, useWorkflowManager } from './OrderForm25/hooks';\nimport { DocxGeneratorModal } from '../components/DocxGeneratorModal';\nimport FinancialControlConfirmationModal from '../components/FinancialControlConfirmationModal';\n\n// Pomocn funkce pro formtovn data pro DatePicker (YYYY-MM-DD formt)\nconst formatDateForPicker = (date) => {\n  if (!date) return '';\n  const d = new Date(date);\n  if (isNaN(d.getTime())) return '';\n  const year = d.getFullYear();\n  const month = String(d.getMonth() + 1).padStart(2, '0');\n  const day = String(d.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n};\n\n// Pomocn funkce pro normalizaci textu - odstrann diakritiky a pevod na mal psmena\nconst normalizeText = (text) => {\n  if (!text) return '';\n  return text\n    .toLowerCase()\n    .normalize('NFD') // Rozlo diakritiku na zkladn znaky + kombinujc znaky\n    .replace(/[\\u0300-\\u036f]/g, '') // Odstran kombinujc znaky (diakritiku)\n    .replace(/[^\\w\\s]/g, '') // Odstran interpunkci\n    .trim();\n};\n\n// Globln pomocn funkce pro aktuln datum ve formtu YYYY-MM-DD\nconst getCurrentDateFormatted = () => {\n  const now = new Date();\n  const year = now.getFullYear();\n  const month = String(now.getMonth() + 1).padStart(2, '0');\n  const day = String(now.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n};\n\n/**\n *  Z-INDEX HIERARCHIE PRO ORDERFORM25\n *\n * Pehled vech z-index hodnot pro sprvn vrstven komponent:\n *\n * 1-100:     Zkladn elementy (headers, shadows, atd.)\n * 10000:     Dropdown menu (CustomSelect, MultiSelect)\n * 99999:     Fullscreen reim (Container.isFullscreen)\n * 100000:    Dialogy nad fullscreenem (SupplierAddDialog, AresPopup, SupplierPopup, DeleteConfirm)\n * 999999:    Nejvy vrstva (ConfirmDialog, TemplateModal, LoadingOverlay, PreviewModal)\n *\n *  DLEIT: Dialogy a modly MUS mt vy z-index ne fullscreen (99999),\n *              aby se zobrazovaly i kdy je formul ve fullscreen mdu!\n */\n\nconst Container = styled.div`\n  background: #f8fafc;\n  padding: 0;\n  position: fixed;\n  top: ${props => props.isFullscreen ? '0' : 'var(--app-fixed-offset-actual, calc(var(--app-header-height, 96px) + var(--app-menu-height, 48px)))'};\n  left: 0;\n  right: 0;\n  bottom: ${props => props.isFullscreen ? '0' : 'var(--app-footer-height, 54px)'};\n  width: 100%;\n  height: ${props => props.isFullscreen ? '100vh' : 'calc(100vh - var(--app-fixed-offset-actual, calc(var(--app-header-height, 96px) + var(--app-menu-height, 48px))) - var(--app-footer-height, 54px))'};\n  overflow: hidden;\n  z-index: ${props => props.isFullscreen ? '99999' : 'auto'};\n  transition: all 0.3s ease-in-out;\n\n  /* Animace pro loading spinner */\n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n`;\n\nconst FormWrapper = styled.div`\n  width: 100%;\n  max-width: 990px;\n  margin: 0 auto;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  ${props => props.debugPinned ? `\n    margin-left: 420px;\n    margin-right: auto;\n  ` : ''}\n  background: transparent;\n  transition: margin-left 0.3s ease-in-out, margin-right 0.3s ease-in-out;\n\n  @media (max-width: 1400px) {\n    ${props => props.debugPinned ? `\n      margin-left: 380px;\n      margin-right: auto;\n    ` : ''}\n  }\n\n  @media (max-width: 1200px) {\n    margin-left: auto;\n    margin-right: auto;\n    max-width: 990px;\n  }\n\n  @media (max-width: 768px) {\n    max-width: 100%;\n    padding: 0 0.5rem;\n    margin-left: auto;\n    margin-right: auto;\n  }\n`;\n\nconst FixedHeader = styled.div`\n  position: absolute;\n  top: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 100%;\n  max-width: 990px;\n  z-index: 100;\n  background: ${({theme}) => theme.colors.gray100 || '#f8fafc'};\n  border-bottom: 1px solid #e5e7eb;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  padding: 1rem 0 1rem 0;\n`;\n\nconst FixedHeaderContent = styled.div`\n  width: 100%;\n  max-width: 990px;\n  margin: 0 auto;\n  ${props => props.debugPinned ? `\n    margin-left: 420px;\n    margin-right: auto;\n  ` : ''}\n  padding: 0 1rem;\n  transition: margin-left 0.3s ease-in-out, margin-right 0.3s ease-in-out;\n\n  @media (max-width: 1400px) {\n    ${props => props.debugPinned ? `\n      margin-left: 380px;\n      margin-right: auto;\n    ` : ''}\n  }\n\n  @media (max-width: 1200px) {\n    margin-left: auto;\n    margin-right: auto;\n    max-width: 990px;\n  }\n\n  @media (max-width: 768px) {\n    max-width: 100%;\n    padding: 0 1rem;\n  }\n`;\n\nconst ScrollableContent = styled.div`\n  /* Scrollovateln obsah - scrollbar na pravm okraji okna prohlee */\n  position: absolute;\n  top: 0px;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 0;\n\n  /* Decentn scrollbar - 80% prhledn ve vchozm stavu */\n  scrollbar-width: thin;\n  scrollbar-color: rgba(148, 163, 184, 0.2) transparent;\n\n  /* Pi hover vce viditeln */\n  &:hover {\n    scrollbar-color: rgba(148, 163, 184, 0.8) transparent;\n  }\n\n  /* Webkit browsers (Chrome, Safari, Edge) */\n  &::-webkit-scrollbar {\n    width: 10px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: transparent;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background-color: rgba(148, 163, 184, 0.2);\n    border-radius: 5px;\n    border: 2px solid transparent;\n    background-clip: content-box;\n    transition: background-color 0.3s ease;\n  }\n\n  &:hover::-webkit-scrollbar-thumb {\n    background-color: rgba(148, 163, 184, 0.8);\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background-color: rgba(100, 116, 139, 0.95);\n  }\n\n  @media (max-width: 768px) {\n    padding: 0;\n  }\n`;\n\nconst ScrollableInner = styled.div`\n  /* Vnitn wrapper pro centrovn obsahu */\n  max-width: 990px;\n  margin: 0 auto;\n  /*  Dynamick padding-top: vka headeru + 20px gap (u zapotno v CSS variable) */\n  padding: var(--fixed-header-height, 200px) 1rem 2rem 1rem;\n\n  @media (max-width: 768px) {\n    padding: var(--fixed-header-height, 200px) 0.5rem 2rem 0.5rem;\n  }\n`;\n\nconst FormHeader = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 0.75rem;\n\n  @media (max-width: 768px) {\n    flex-direction: column;\n    gap: 0.75rem;\n    align-items: stretch;\n  }\n`;\n\nconst HeaderLeft = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  flex-wrap: wrap;\n  flex: 1;\n\n  @media (max-width: 768px) {\n    justify-content: space-between;\n  }\n`;\n\nconst PriceSummary = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 8px 16px;\n  background: ${props => props.isOverBudget ? 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)' : 'linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)'};\n  border: 2px solid ${props => props.isOverBudget ? '#fca5a5' : '#bbf7d0'};\n  border-radius: 8px;\n  font-size: 14px;\n  font-weight: 600;\n  color: ${props => props.isOverBudget ? '#991b1b' : '#166534'};\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n\n  @media (max-width: 768px) {\n    font-size: 12px;\n    padding: 6px 12px;\n    gap: 8px;\n  }\n`;\n\nconst PriceItem = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n\n  .label {\n    font-size: 10px;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    opacity: 0.8;\n    font-weight: 500;\n  }\n\n  .value {\n    font-size: 16px;\n    font-weight: 700;\n\n    @media (max-width: 768px) {\n      font-size: 14px;\n    }\n  }\n`;\n\nconst TitleWithButtons = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  position: relative;\n`;\n\nconst HeaderTitle = styled.h1`\n  font-size: 1.8125rem;\n  font-weight: 700;\n  color: #b45309;\n  margin: 0;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-variant: small-caps;\n  position: relative;\n\n  /* Vt prvn psmeno s gradientnm zvraznnm */\n  &::first-letter {\n    font-size: 1.3em;\n    font-variant: normal;\n    font-weight: 800;\n    background: linear-gradient(135deg, #d97706 0%, #b45309 50%, #92400e 100%);\n    background-clip: text;\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    text-shadow: 0 2px 4px rgba(180, 83, 9, 0.3);\n  }\n\n  /* Horn index pro ID objednvky */\n  .order-id-badge {\n    font-size: 0.4em;\n    font-weight: 500;\n    color: #6b7280;\n    margin-left: 0.1em;\n    vertical-align: top;\n    line-height: 1;\n    position: relative;\n    top: -0.5em;\n    left: -6px;\n  }\n\n  @media (max-width: 768px) {\n    font-size: 1.75rem;\n\n    .order-id-badge {\n      font-size: 0.55em;\n    }\n  }\n`;\n\nconst PhaseInfo = styled.div`\n  font-size: 0.875rem;\n  color: #6b7280;\n  font-weight: 500;\n`;\n\nconst HeaderButtons = styled.div`\n  display: flex;\n  gap: 0.75rem;\n  align-items: center;\n`;\n\nconst HeaderButton = styled.button`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border-radius: 8px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &.template-btn {\n    background: #10b981;\n    color: white;\n    cursor: pointer;\n    opacity: 1;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:hover {\n      background: #059669;\n      transform: scale(1.05);\n    }\n  }\n\n  &.reload-btn {\n    background: #0ea5e9;\n    color: white;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:disabled {\n      cursor: not-allowed;\n      opacity: 0.6;\n\n      &:hover {\n        background: #0ea5e9;\n      }\n    }\n\n    &:not(:disabled) {\n      cursor: pointer;\n      opacity: 1;\n\n      &:hover {\n        background: #0284c7;\n        transform: translateY(-1px);\n      }\n    }\n  }\n\n  &.cancel-btn {\n    background: #dc2626;\n    color: white;\n\n    &:hover {\n      background: #b91c1c;\n    }\n  }\n\n  &.draft-btn {\n    background: #059669;\n    color: white;\n\n    &:hover {\n      background: #047857;\n    }\n\n    &:disabled {\n      background: #9ca3af;\n      cursor: not-allowed;\n    }\n  }\n\n  &.fullscreen-btn {\n    background: #10b981;\n    color: white;\n    cursor: pointer;\n    opacity: 1;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:hover {\n      background: #059669;\n      transform: scale(1.05);\n    }\n  }\n\n  &.toggle-sections-btn {\n    background: #8b5cf6;\n    color: white;\n    cursor: pointer;\n    opacity: 1;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:hover {\n      background: #7c3aed;\n      transform: scale(1.05);\n    }\n  }\n\n  &.generate-docx-btn {\n    background: #f97316;\n    color: white;\n    cursor: pointer;\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    &:disabled {\n      background: #9ca3af;\n      cursor: not-allowed;\n      opacity: 0.6;\n\n      &:hover {\n        background: #9ca3af;\n        transform: none;\n      }\n    }\n\n    &:not(:disabled):hover {\n      background: #ea580c;\n      transform: scale(1.05);\n    }\n  }\n`;\n\nconst PhaseRow = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: #f3f4f6;\n  border: 1px solid #d1d5db;\n  border-radius: 8px;\n  padding: 0.5rem 1rem;\n  margin-bottom: 0;\n  gap: 1rem;\n\n  @media (max-width: 768px) {\n    flex-direction: column;\n    gap: 0.75rem;\n    align-items: stretch;\n  }\n`;\n\nconst PhaseIndicator = styled.div`\n  font-size: 0.875rem;\n  font-weight: 700;\n  text-align: center;\n  position: relative;\n  flex: 1;\n\n  @media (max-width: 768px) {\n    text-align: left;\n  }\n`;\n\nconst PhaseProgressContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  flex: 1;\n`;\n\nconst PriceSummaryContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  gap: 0.25rem;\n  padding-right: 1rem;\n`;\n\nconst PriceSummaryRow = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.875rem;\n  font-weight: 600;\n`;\n\nconst PriceLabel = styled.span`\n  color: #dc2626;\n  font-size: 0.8rem;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  font-weight: 700;\n`;\n\nconst PriceValue = styled.span`\n  color: #dc2626;\n  font-size: 1.1rem;\n  font-weight: 800;\n  font-family: 'Courier New', monospace;\n`;\n\nconst PriceBadge = styled.span`\n  font-size: 0.75rem;\n  padding: 3px 8px;\n  border-radius: 4px;\n  font-weight: 600;\n  background: ${props => props.isOver ? '#fef2f2' : '#f0fdf4'};\n  color: ${props => props.isOver ? '#dc2626' : '#059669'};\n  border: 1px solid ${props => props.isOver ? '#fecaca' : '#bbf7d0'};\n`;\n\nconst PhaseText = styled.div`\n  font-size: 0.875rem;\n  color: #374151;\n  font-weight: 700;\n  text-align: left;\n`;\n\nconst PhaseProgressBar = styled.div`\n  display: flex;\n  height: 6px;\n  background: #e5e7eb;\n  border-radius: 3px;\n  overflow: hidden;\n  position: relative;\n  border: 1px solid #d1d5db;\n`;\n\nconst PhaseSegment = styled.div`\n  flex: 1;\n  position: relative;\n\n  &:not(:last-child)::after {\n    content: '';\n    position: absolute;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    width: 1px;\n    background: #d1d5db;\n    z-index: 2;\n  }\n`;\n\nconst PhaseSegmentFill = styled.div`\n  height: 100%;\n  transition: all 0.3s ease;\n\n  /* Barevn pechody pro jednotliv fze */\n  &.phase-1 {\n    background: linear-gradient(90deg, #9ca3af 0%, #6b7280 100%); /* ed - zatek */\n  }\n\n  &.phase-2 {\n    background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%); /* Oranov - v procesu */\n  }\n\n  &.phase-3 {\n    background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%); /* Modr - odeslno */\n  }\n\n  &.phase-4 {\n    background: linear-gradient(90deg, #10b981 0%, #059669 100%); /* Zelen - potvrzeno */\n  }\n\n  &.phase-5 {\n    background: linear-gradient(90deg, #8b5cf6 0%, #7c3aed 100%); /* Fialov - registr */\n  }\n\n  &.phase-6 {\n    background: linear-gradient(90deg, #06b6d4 0%, #0891b2 100%); /* Tyrkysov - fakturace */\n  }\n\n  &.phase-7 {\n    background: linear-gradient(90deg, #14b8a6 0%, #0d9488 100%); /* Teal - vcn sprvnost */\n  }\n\n  &.phase-8 {\n    background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%); /* Svtle zelen - dokoneno */\n  }\n\n  &.phase-error {\n    background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%); /* erven - chyba/storno */\n  }\n`;\n\nconst PhaseDivider = styled.div`\n  width: 2px;\n  height: 40px;\n  background: linear-gradient(to bottom, transparent, #d1d5db 20%, #d1d5db 80%, transparent);\n  border-radius: 1px;\n\n  @media (max-width: 768px) {\n    width: 100%;\n    height: 2px;\n    background: linear-gradient(to right, transparent, #d1d5db 20%, #d1d5db 80%, transparent);\n  }\n`;\n\nconst FormActions = styled.div`\n  display: flex;\n  gap: 0.75rem;\n  align-items: center;\n`;\n\nconst ActionButton = styled.button`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &.save-btn {\n    background: #10b981;\n    color: white;\n\n    &:hover:not(:disabled) {\n      background: #059669;\n    }\n\n    &:disabled {\n      background: #6b7280;\n      cursor: not-allowed;\n    }\n  }\n\n  &.cancel-btn {\n    background: #dc2626;\n    color: white;\n\n    &:hover {\n      background: #b91c1c;\n    }\n  }\n\n  &.icon-only {\n    padding: 0.5rem;\n    width: 38px;\n    height: 38px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n`;\n\n//  Keyframe animace pro spinner\nconst spin = keyframes`\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n`;\n\n//  Styled spinner komponent\nconst Spinner = styled.span`\n  display: inline-block;\n  width: 14px;\n  height: 14px;\n  border: 2px solid #ddd;\n  border-top: 2px solid #666;\n  border-radius: 50%;\n  animation: ${spin} 0.8s linear infinite;\n`;\n\n//  Styled retry button - nenpadn, ale funkn\nconst RetryButton = styled.button`\n  padding: 2px 8px;\n  fontSize: 11px;\n  backgroundColor: #fef3c7;\n  border: 1px solid #fbbf24;\n  borderRadius: 4px;\n  color: #92400e;\n  cursor: pointer;\n  fontWeight: 500;\n  transition: all 0.2s ease;\n\n  &:hover {\n    background-color: #fde68a;\n    border-color: #f59e0b;\n  }\n\n  &:active {\n    transform: scale(0.95);\n  }\n`;\n\nconst EvidenceNumber = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n\n  @media (max-width: 768px) {\n    flex-direction: column;\n    gap: 0.25rem;\n    align-items: flex-start;\n  }\n`;\n\nconst EvidenceLabel = styled.div`\n  font-size: 0.75rem;\n  color: #6b7280;\n  font-weight: 500;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  white-space: nowrap;\n`;\n\nconst EvidenceValue = styled.div`\n  font-size: 1rem;\n  font-weight: 700;\n  color: ${props => props.$isEmergency ? '#fde047' : '#1e40af'};\n  font-family: 'Courier New', monospace;\n  background: ${props => props.$isEmergency \n    ? 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)' \n    : 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)'};\n  padding: 0.4rem 0.6rem;\n  border-radius: 6px;\n  border: 1px solid ${props => props.$isEmergency ? '#991b1b' : '#93c5fd'};\n  white-space: nowrap;\n`;\n\nconst FormSection = styled.div`\n  background: #ffffff;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n  margin-bottom: 1.5rem;\n  overflow: visible;\n  border: 1px solid #e2e8f0;\n`;\n\nconst SectionHeader = styled.div`\n  padding: 1rem 1.25rem;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  transition: all 0.3s ease;\n\n  /* Barevn schma podle typu sekce */\n  ${props => {\n    // Ur zkladn barvu podle typu sekce\n    const getBaseColors = (sectionTheme) => {\n      switch(sectionTheme) {\n        case 'section-grey':\n          return {\n            bg: ['#f9fafb', '#f3f4f6'],\n            border: '#9ca3af',\n            hover: ['#f3f4f6', '#e5e7eb']\n          };\n        case 'section-orange':\n          return {\n            bg: ['#fef3c7', '#fde68a'],\n            border: '#f59e0b',\n            hover: ['#fde68a', '#facc15']\n          };\n        case 'section-blue':\n          return {\n            bg: ['#dbeafe', '#bfdbfe'],\n            border: '#3b82f6',\n            hover: ['#bfdbfe', '#93c5fd']\n          };\n        case 'section-purple':\n          return {\n            bg: ['#f3e8ff', '#e9d5ff'],\n            border: '#a855f7',\n            hover: ['#e9d5ff', '#d8b4fe']\n          };\n        case 'section-red':\n          return {\n            bg: ['#fee2e2', '#fecaca'],\n            border: '#dc2626',\n            hover: ['#fecaca', '#fca5a5']\n          };\n        default:\n          return {\n            bg: ['#fef3c7', '#fde68a'],\n            border: '#f59e0b',\n            hover: ['#fde68a', '#facc15']\n          };\n      }\n    };\n\n    const colors = getBaseColors(props.sectionTheme);\n\n    // Uprav intenzitu podle toho, jestli je sekce aktivn\n    const opacity = props.isActive ? '1' : '0.6';\n\n    return `\n      background: linear-gradient(135deg, ${colors.bg[0]} 0%, ${colors.bg[1]} 100%);\n      border-bottom: 1px solid ${colors.border};\n      opacity: ${opacity};\n\n      &:hover {\n        background: linear-gradient(135deg, ${colors.hover[0]} 0%, ${colors.hover[1]} 100%);\n        opacity: 1;\n      }\n    `;\n  }}\n`;\n\nconst SectionTitle = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  font-weight: 600;\n  font-size: 1.1rem;\n\n  ${props => {\n    switch(props.sectionTheme) {\n      case 'section-grey':\n        return 'color: #4b5563;';\n      case 'section-orange':\n        return 'color: #92400e;';\n      case 'section-blue':\n        return 'color: #1e40af;';\n      case 'section-purple':\n        return 'color: #7e22ce;';\n      case 'section-red':\n        return 'color: #991b1b;';\n      default:\n        return 'color: #92400e;';\n    }\n  }}\n`;\n\nconst SectionIcon = styled.div`\n  font-size: 1.2rem;\n\n  ${props => {\n    switch(props.sectionTheme) {\n      case 'section-grey':\n        return 'color: #6b7280;';\n      case 'section-orange':\n        return 'color: #f59e0b;';\n      case 'section-blue':\n        return 'color: #3b82f6;';\n      case 'section-purple':\n        return 'color: #a855f7;';\n      case 'section-red':\n        return 'color: #dc2626;';\n      default:\n        return 'color: #f59e0b;';\n    }\n  }}\n`;\n\nconst CollapseIcon = styled.div`\n  transition: transform 0.2s ease;\n  transform: ${props => props.collapsed ? 'rotate(0deg)' : 'rotate(180deg)'};\n\n  ${props => {\n    switch(props.sectionTheme) {\n      case 'section-grey':\n        return 'color: #4b5563;';\n      case 'section-orange':\n        return 'color: #92400e;';\n      case 'section-blue':\n        return 'color: #1e40af;';\n      case 'section-purple':\n        return 'color: #7e22ce;';\n      case 'section-red':\n        return 'color: #991b1b;';\n      default:\n        return 'color: #92400e;';\n    }\n  }}\n`;\n\nconst SectionControls = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n`;\n\nconst LockWarning = styled.span`\n  margin-left: 0.75rem;\n  color: #dc2626;\n  font-size: 0.7rem;\n  font-weight: 500;\n  background: rgba(255, 255, 255, 0.2);\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n  cursor: help;\n`;\n\nconst SectionContent = styled.div`\n  padding: 1.5rem 1.25rem;\n  display: ${props => props.collapsed ? 'none' : 'block'};\n`;\n\nconst EmergencyToggleWrapper = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  opacity: ${props => props.disabled ? 0.6 : 1};\n  pointer-events: ${props => props.disabled ? 'none' : 'auto'};\n`;\n\nconst EmergencyToggleSwitch = styled.label`\n  position: relative;\n  display: inline-block;\n  width: 56px;\n  height: 28px;\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  flex-shrink: 0;\n\n  input {\n    opacity: 0;\n    width: 0;\n    height: 0;\n  }\n\n  span {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: ${props => props.checked ? '#ef4444' : '#cbd5e1'};\n    border-radius: 28px;\n    transition: all 0.3s ease;\n\n    &::before {\n      content: '';\n      position: absolute;\n      height: 20px;\n      width: 20px;\n      left: 4px;\n      bottom: 4px;\n      background-color: white;\n      border-radius: 50%;\n      transition: all 0.3s ease;\n      transform: ${props => props.checked ? 'translateX(28px)' : 'translateX(0)'};\n    }\n  }\n\n  input:focus + span {\n    box-shadow: 0 0 0 3px ${props => props.checked ? 'rgba(239, 68, 68, 0.1)' : 'rgba(59, 130, 246, 0.1)'};\n  }\n`;\n\nconst EmergencyToggleLabel = styled.span`\n  font-size: 0.9rem;\n  font-weight: ${props => props.checked ? '700' : '400'};\n  color: ${props => props.checked ? '#dc2626' : '#374151'};\n`;\n\nconst FormRow = styled.div`\n  display: grid;\n  grid-template-columns: 1fr 1fr 1fr;\n  gap: 1rem;\n  margin-bottom: 1rem;\n\n  @media (max-width: 1024px) {\n    grid-template-columns: 1fr 1fr;\n  }\n\n  @media (max-width: 768px) {\n    grid-template-columns: 1fr;\n  }\n`;\n\nconst FormGroup = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n`;\n\nconst ErrorText = styled.div`\n  color: #dc2626;\n  font-size: 0.75rem;\n  font-weight: 500;\n  margin-top: 0.25rem;\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n`;\n\nconst Label = styled.label`\n  font-weight: 600;\n  font-size: 0.875rem;\n  color: #374151;\n\n  &::after {\n    content: ${props => props.required ? '\" *\"' : '\"\"'};\n    color: #dc2626;\n    margin-left: 2px;\n  }\n`;\n\n// Label s Clear tlatkem vpravo (pro selects)\nconst LabelWithClear = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n  width: 100%;\n  min-height: 1.25rem; /* Minimln vka pro konzistenci s Label */\n`;\n\nconst LabelText = styled.label`\n  font-weight: 600;\n  font-size: 0.875rem;\n  color: #374151;\n\n  &::after {\n    content: ${props => props.required ? '\" *\"' : '\"\"'};\n    color: #dc2626;\n    margin-left: 2px;\n  }\n`;\n\nconst ClearSelectButton = styled.button`\n  background: none;\n  border: none;\n  padding: 0.25rem 0.5rem;\n  cursor: pointer;\n  color: #9ca3af;\n  font-size: 0.75rem;\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  transition: all 0.2s ease;\n  border-radius: 4px;\n  opacity: ${props => props.$visible ? 1 : 0};\n  pointer-events: ${props => props.$visible ? 'auto' : 'none'};\n\n  &:hover {\n    color: #ef4444;\n    background: rgba(239, 68, 68, 0.1);\n  }\n\n  svg {\n    width: 12px;\n    height: 12px;\n  }\n`;\n\n// Wrapper pro input s ikonou\nconst InputWithIcon = styled.div`\n  position: relative;\n  width: 100%;\n\n  > svg {\n    position: absolute;\n    left: 0.75rem;\n    top: 50%;\n    transform: translateY(-50%);\n    color: #9ca3af;\n    z-index: 1;\n    pointer-events: none;\n    width: 16px !important;\n    height: 16px !important;\n  }\n`;\n\nconst Input = styled.input`\n  width: 100%;\n  box-sizing: border-box;\n  padding: ${props => props.hasIcon ? '0.75rem 0.75rem 0.75rem 2.5rem' : '0.75rem'};\n  border: 2px solid ${props => props.hasError ? '#dc2626' : '#e5e7eb'};\n  border-radius: 8px;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n  background: #ffffff;\n\n  /* Zvraznn vyplnn hodnoty vs. placeholder - sladno s CustomSelect */\n  color: ${props => props.value && props.value !== '' ? '#1f2937' : '#6b7280'};\n  font-weight: ${props => {\n    if (props.disabled) return '400'; // Disabled elementy maj normln font-weight\n    return props.value && props.value !== '' ? '600' : '400'; // Sladno s CustomSelect\n  }};\n\n  &:focus {\n    outline: none;\n    border-color: ${props => props.hasError ? '#dc2626' : '#3b82f6'};\n    box-shadow: 0 0 0 3px ${props => props.hasError ? 'rgba(220, 38, 38, 0.1)' : 'rgba(59, 130, 246, 0.1)'};\n  }\n\n  &:focus + svg {\n    color: ${props => props.hasError ? '#dc2626' : '#3b82f6'};\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    color: #6b7280;\n    cursor: not-allowed;\n  }\n\n  /* Sjednocen placeholder barvy se selecty */\n  &::placeholder {\n    color: #9ca3af;\n    opacity: 1;\n    font-weight: 400;\n  }\n\n  &::-webkit-input-placeholder {\n    color: #9ca3af;\n    font-weight: 400;\n  }\n\n  &::-moz-placeholder {\n    color: #9ca3af;\n    opacity: 1;\n    font-weight: 400;\n  }\n\n  /* Odstrann spinner arrows u number input */\n  &[type=\"number\"] {\n    -moz-appearance: textfield; /* Firefox */\n    appearance: textfield;\n\n    &::-webkit-outer-spin-button,\n    &::-webkit-inner-spin-button {\n      -webkit-appearance: none;\n      margin: 0;\n    }\n  }\n`;\n\nconst TextArea = styled.textarea`\n  width: 100%;\n  box-sizing: border-box;\n  padding: 0.75rem;\n  border: 2px solid ${props => props.hasError ? '#dc2626' : '#e5e7eb'};\n  border-radius: 8px;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n  background: #ffffff;\n  font-family: inherit;\n  resize: vertical;\n  min-height: 80px;\n\n  /* Zvraznn vyplnn hodnoty vs. placeholder - sladno s CustomSelect */\n  color: ${props => props.value && props.value !== '' ? '#1f2937' : '#6b7280'};\n  font-weight: ${props => {\n    if (props.disabled) return '400'; // Disabled elementy maj normln font-weight\n    return props.value && props.value !== '' ? '600' : '400'; // Sladno s CustomSelect\n  }};\n\n  &:focus {\n    outline: none;\n    border-color: ${props => props.hasError ? '#dc2626' : '#3b82f6'};\n    box-shadow: 0 0 0 3px ${props => props.hasError ? 'rgba(220, 38, 38, 0.1)' : 'rgba(59, 130, 246, 0.1)'};\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    color: #6b7280;\n    cursor: not-allowed;\n  }\n\n  &::placeholder {\n    color: #9ca3af;\n    opacity: 1;\n    font-weight: 400;\n  }\n`;\n\n//  Komponenta pro zobrazen zbvajc stky (LP a Smlouvy)\nconst RemainingAmountDisplay = styled.div`\n  margin-top: 0.75rem;\n  padding: 0.75rem;\n  border-radius: 8px;\n  background: ${props => {\n    if (props.$loading) return '#f3f4f6';\n    if (props.$notFound) return '#fef2f2';\n    if (props.$isNegative) return '#fef2f2';\n    return '#f0fdf4';\n  }};\n  border: 2px solid ${props => {\n    if (props.$loading) return '#e5e7eb';\n    if (props.$notFound) return '#fecaca';\n    if (props.$isNegative) return '#fca5a5';\n    return '#86efac';\n  }};\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  animation: slideDown 0.3s ease;\n\n  @keyframes slideDown {\n    from {\n      opacity: 0;\n      transform: translateY(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n`;\n\nconst RemainingAmountIcon = styled.div`\n  font-size: 1.5rem;\n  flex-shrink: 0;\n`;\n\nconst RemainingAmountContent = styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n`;\n\nconst RemainingAmountLabel = styled.div`\n  font-size: 0.75rem;\n  font-weight: 500;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n  color: ${props => {\n    if (props.$loading) return '#6b7280';\n    if (props.$notFound) return '#991b1b';\n    if (props.$isNegative) return '#b91c1c';\n    return '#15803d';\n  }};\n`;\n\nconst RemainingAmountValue = styled.div`\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: ${props => {\n    if (props.$loading) return '#6b7280';\n    if (props.$notFound) return '#991b1b';\n    if (props.$isNegative) return '#dc2626';\n    return '#16a34a';\n  }};\n  font-variant-numeric: tabular-nums;\n`;\n\nconst RemainingAmountSubtext = styled.div`\n  font-size: 0.75rem;\n  color: #6b7280;\n  margin-top: 0.125rem;\n`;\n\n//  Styled komponenty pro autocomplete smluv\nconst SmlouvaAutocompleteContainer = styled.div`\n  position: relative;\n  width: 100%;\n`;\n\nconst SmlouvaSuggestionsList = styled.div`\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  margin-top: 0.25rem;\n  background: white;\n  border: 2px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  max-height: 300px;\n  overflow-y: auto;\n  z-index: 1000;\n  animation: slideDown 0.2s ease;\n\n  @keyframes slideDown {\n    from {\n      opacity: 0;\n      transform: translateY(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n`;\n\nconst SmlouvaSuggestionItem = styled.div`\n  padding: 0.75rem;\n  cursor: pointer;\n  border-bottom: 1px solid #f3f4f6;\n  transition: all 0.15s ease;\n\n  &:hover {\n    background: #f3f4f6;\n  }\n\n  &:last-child {\n    border-bottom: none;\n  }\n`;\n\nconst SmlouvaSuggestionTitle = styled.div`\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #1f2937;\n  margin-bottom: 0.25rem;\n`;\n\nconst SmlouvaSuggestionMeta = styled.div`\n  font-size: 0.75rem;\n  color: #6b7280;\n  display: flex;\n  gap: 1rem;\n`;\n\nconst SmlouvaSuggestionEmpty = styled.div`\n  padding: 1rem;\n  text-align: center;\n  color: #6b7280;\n  font-size: 0.875rem;\n`;\n\nconst Select = styled.select`\n  width: 100%;\n  box-sizing: border-box;\n  padding: 0.75rem;\n  border: 2px solid ${props => props.hasError ? '#dc2626' : '#e5e7eb'};\n  border-radius: 8px;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n  background: #ffffff;\n  cursor: pointer;\n\n  /* Zvraznn vybran hodnoty vs. placeholder - sladno s CustomSelect */\n  color: ${props => props.value && props.value !== '' && props.value !== 'placeholder' ? '#1f2937' : '#6b7280'};\n  font-weight: ${props => {\n    if (props.disabled) return '400'; // Disabled elementy maj normln font-weight\n    return props.value && props.value !== '' && props.value !== 'placeholder' ? '600' : '400'; // Sladno s CustomSelect\n  }};\n\n  &:focus {\n    outline: none;\n    border-color: ${props => props.hasError ? '#dc2626' : '#3b82f6'};\n    box-shadow: 0 0 0 3px ${props => props.hasError ? 'rgba(220, 38, 38, 0.1)' : 'rgba(59, 130, 246, 0.1)'};\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    color: #6b7280;\n    cursor: not-allowed;\n  }\n\n  /* Placeholder styl pro prvn option */\n  option:first-of-type {\n    color: #9ca3af;\n    font-weight: 400;\n  }\n`;\n\n// Multi-select komponenta pro stediska - lokln komponenty\nconst MultiSelectWrapper = styled.div`\n  position: relative;\n  width: 100%;\n  z-index: ${props => props.isOpen ? 10000 : 1};\n`;\n\nconst MultiSelectButton = styled.div`\n  width: 100%;\n  box-sizing: border-box;\n  padding: 0.75rem 1.75rem 0.75rem 0.75rem;\n  border: 2px solid ${props => props.hasError ? '#dc2626' : '#e5e7eb'};\n  border-radius: 8px;\n  font-size: 0.875rem;\n  background: ${props => props.disabled ? '#f9fafb' : '#ffffff'};\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  color: ${props => {\n    if (props.disabled) return '#6b7280';\n    if (props.placeholder || !props.value || props.value === '') return '#9ca3af';\n    return '#1f2937';\n  }};\n\n  font-weight: ${props => props.disabled ? '400' : (props.value && props.value !== '' && props.placeholder !== \"true\" ? '600' : '400')};\n  min-height: 2.5rem;\n\n  display: flex;\n  align-items: center;\n  position: relative;\n  transition: all 0.2s ease;\n\n  /* Custom arrow */\n  appearance: none;\n  -moz-appearance: none;\n  -webkit-appearance: none;\n  background-image: ${props => {\n    if (props.disabled) {\n      return props.isOpen\n        ? `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='18 15 12 9 6 15'%3E%3C/polyline%3E%3C/svg%3E\")`\n        : `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")`;\n    } else if (props.hasError) {\n      return props.isOpen\n        ? `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23b91c1c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='18 15 12 9 6 15'%3E%3C/polyline%3E%3C/svg%3E\")`\n        : `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23b91c1c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")`;\n    } else {\n      return props.isOpen\n        ? `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23374151' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='18 15 12 9 6 15'%3E%3C/polyline%3E%3C/svg%3E\")`\n        : `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23374151' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\")`;\n    }\n  }};\n  background-repeat: no-repeat;\n  background-position: right 0.5rem center;\n  background-size: 16px 16px;\n\n  &:hover {\n    border-color: ${props => props.disabled ? '#e5e7eb' : (props.hasError ? '#dc2626' : '#3b82f6')};\n  }\n\n  &:focus {\n    outline: none;\n    border-color: ${props => props.hasError ? '#dc2626' : '#3b82f6'};\n    box-shadow: 0 0 0 3px ${props => props.hasError ? 'rgba(220, 38, 38, 0.1)' : 'rgba(59, 130, 246, 0.1)'};\n  }\n`;\n\nconst SelectedValue = styled.span`\n  flex: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  color: ${props => props.isEmpty ? '#9ca3af' : '#1f2937'};\n  font-weight: ${props => props.isEmpty ? '400' : '600'};\n`;\n\nconst CustomSelectDropdown = styled.div`\n  position: fixed;\n  z-index: 40;\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.1);\n  max-height: 300px;\n  overflow-y: auto;\n  min-width: 200px;\n\n  /* Prevent text selection while scrolling */\n  user-select: none;\n\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #f9fafb;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 4px;\n  }\n`;\n\nconst CustomSelectOption = styled.div`\n  padding: 0.75rem;\n  cursor: pointer;\n  font-size: 0.875rem;\n  border-bottom: 1px solid #f3f4f6;\n  color: #1f2937;\n  font-weight: 400 !important; /* Normal font pro vechny monosti - s !important */\n\n  &:hover {\n    background: #f8fafc;\n    font-weight: 400 !important; /* Zstv normal i pi hover */\n  }\n\n  &:last-child {\n    border-bottom: none;\n  }\n\n  ${props => props.selected && `\n    background: #eff6ff;\n    border-left: 3px solid #3b82f6;\n    font-weight: 600 !important; /* Bold jen pro vybranou monost */\n  `}\n`;\n\nconst MultiSelectDropdown = styled.div`\n  position: fixed;\n  z-index: 40;\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.1);\n  max-height: 300px;\n  overflow-y: auto;\n  min-width: 200px;\n\n  /* Prevent text selection while scrolling */\n  user-select: none;\n\n  /* Optimalizace pro plynulej scrollovn */\n  scroll-behavior: auto;\n  contain: layout style paint;\n  will-change: scroll-position;\n  transform: translateZ(0); /* Force hardware acceleration */\n\n  /* Lep scrollbar styling */\n  scrollbar-width: thin;\n  scrollbar-color: #d1d5db #f9fafb;\n\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #f9fafb;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background: #9ca3af;\n  }\n`;\n\nconst SearchBox = styled.div`\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n  padding: 0.75rem;\n  border-bottom: 1px solid #e5e7eb;\n`;\n\nconst SearchInput = styled.input`\n  width: 100%;\n  padding: 0.75rem 0.75rem 0.75rem 2.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  font-size: 0.875rem;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n  }\n`;\n\nconst SearchIcon = styled.div`\n  position: absolute;\n  left: 1rem;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #6b7280;\n  pointer-events: none;\n`;\n\nconst TemplateSearchBox = styled.div`\n  position: relative;\n  width: 100%;\n`;\n\nconst SearchClearButton = styled.button`\n  position: absolute;\n  right: 0.75rem;\n  top: 50%;\n  transform: translateY(-50%);\n  background: none;\n  border: none;\n  color: #9ca3af;\n  cursor: pointer;\n  padding: 0.25rem;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n\n  &:hover {\n    color: #6b7280;\n    background: #f3f4f6;\n  }\n\n  &:active {\n    transform: translateY(-50%) scale(0.95);\n  }\n`;\n\nconst TemplateSearchInput = styled(SearchInput)`\n  padding-right: 2.5rem;\n`;\n\n// Modern Template Save Modal komponenty\nconst TemplateModalOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.4);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 999999;\n  padding: 1rem;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n`;\n\n// Delete Confirmation Modal Components - vy z-index ne fullscreen (100000+)\nconst DeleteConfirmOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n`;\n\nconst DeleteConfirmModal = styled.div`\n  background: white;\n  padding: 2rem;\n  border-radius: 8px;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n  max-width: 400px;\n  width: 90%;\n  z-index: 100001;\n`;\n\nconst DeleteConfirmTitle = styled.div`\n  font-size: 1.125rem;\n  font-weight: 600;\n  margin-bottom: 1rem;\n  color: #dc2626;\n`;\n\nconst DeleteConfirmMessage = styled.div`\n  margin-bottom: 1.5rem;\n  color: #374151;\n  line-height: 1.5;\n`;\n\nconst DeleteConfirmActions = styled.div`\n  display: flex;\n  gap: 0.75rem;\n  justify-content: flex-end;\n`;\n\nconst DeleteConfirmButton = styled.button`\n  padding: 0.75rem 1.5rem;\n  background-color: ${props => props.variant === 'danger' ? '#dc2626' : '#f3f4f6'};\n  color: ${props => props.variant === 'danger' ? 'white' : '#374151'};\n  border: none;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.15s ease;\n\n  &:hover {\n    background-color: ${props => props.variant === 'danger' ? '#b91c1c' : '#e5e7eb'};\n  }\n`;\n\nconst TemplateModal = styled.div`\n  background: white;\n  border-radius: 8px;\n  width: 100%;\n  max-width: 600px;\n  padding: 2rem;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n`;\n\nconst TemplateModalHeader = styled.div`\n  margin-bottom: 1.5rem;\n  border-bottom: 1px solid #e5e7eb;\n  padding-bottom: 1rem;\n`;\n\nconst TemplateModalTitle = styled.h2`\n  margin: 0;\n  color: #1e293b;\n  font-size: 1.25rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n`;\n\nconst TemplateModalCloseButton = styled.button`\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  background: transparent;\n  border: none;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: #64748b;\n  transition: all 0.2s;\n  border-radius: 4px;\n\n  &:hover {\n    background: #f1f5f9;\n    color: #1e293b;\n  }\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n`;\n\nconst TemplateModalBody = styled.div`\n  /* dn padding - u je v hlavnm modalu */\n`;\n\nconst TemplateFormGroup = styled.div`\n  margin-bottom: 1.25rem;\n`;\n\nconst TemplateLabel = styled.label`\n  display: block;\n  font-size: 0.75rem;\n  font-weight: 700;\n  color: #64748b;\n  margin-bottom: 0.5rem;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n`;\n\nconst TemplateInput = styled.input`\n  width: 100%;\n  padding: 10px 12px;\n  border: 2px solid #e5e7eb;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n  background: white;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n\n  &::placeholder {\n    color: #9ca3af;\n  }\n`;\n\nconst TemplateSelect = styled.select`\n  width: 100%;\n  padding: 10px 12px;\n  border: 2px solid #e5e7eb;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n  background: white;\n  cursor: pointer;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n\n  option {\n    padding: 8px;\n  }\n`;\n\nconst TemplateTypeGrid = styled.div`\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n  gap: 1rem;\n  margin-top: 0.75rem;\n`;\n\nconst TemplateTypeOption = styled.label`\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  padding: 1rem;\n  border: 2px solid ${props => props.checked ? '#10b981' : '#e5e7eb'};\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  background: ${props => props.checked ? 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)' : 'white'};\n\n  &:hover {\n    border-color: #10b981;\n    background: ${props => props.checked ? 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)' : '#f8fafc'};\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);\n  }\n`;\n\nconst TemplateTypeRadio = styled.input`\n  appearance: none;\n  width: 20px;\n  height: 20px;\n  border: 2px solid #d1d5db;\n  border-radius: 50%;\n  position: relative;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  margin-top: 2px;\n\n  &:checked {\n    border-color: #10b981;\n    background: #10b981;\n  }\n\n  &:checked::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 8px;\n    height: 8px;\n    background: white;\n    border-radius: 50%;\n  }\n`;\n\nconst TemplateTypeText = styled.div`\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: ${props => props.checked ? '#065f46' : '#374151'};\n  line-height: 1.4;\n`;\n\nconst TemplateModalActions = styled.div`\n  display: flex;\n  gap: 0.75rem;\n  justify-content: flex-end;\n  margin-top: 1.5rem;\n  padding-top: 1.5rem;\n  border-top: 1px solid #e5e7eb;\n`;\n\nconst TemplateActionButton = styled.button`\n  padding: 0.625rem 1.25rem;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  transition: all 0.2s;\n\n  ${props => props.variant === 'cancel' ? `\n    background: white;\n    color: #64748b;\n    border: 1px solid #e2e8f0;\n\n    &:hover {\n      background: #f8fafc;\n      border-color: #cbd5e1;\n    }\n  ` : `\n    background: ${props.disabled ? '#cbd5e1' : '#3b82f6'};\n    color: white;\n    border: 1px solid ${props.disabled ? '#cbd5e1' : '#3b82f6'};\n\n    &:hover:not(:disabled) {\n      background: #2563eb;\n      border-color: #2563eb;\n    }\n\n    &:disabled {\n      cursor: not-allowed;\n    }\n  `}\n`;\n\nconst MultiSelectOption = styled.div`\n  padding: ${props => props.level === 0 ? '0.75rem' : '0.5rem 0.75rem 0.5rem 2rem'};\n  cursor: pointer;\n  font-size: 0.875rem;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  background: ${props => props.level === 0 ? '#f9fafb' : '#ffffff'};\n  border-bottom: ${props => props.level === 0 ? '2px solid #e5e7eb' : '1px solid #f3f4f6'};\n  font-weight: ${props => props.level === 0 ? '600' : '400'};\n  color: ${props => props.level === 0 ? '#111827' : '#4b5563'};\n  position: relative;\n  /* Optimalizace pro plynulej scrollovn */\n  will-change: transform;\n  backface-visibility: hidden;\n  /* Focusable pro tab navigaci */\n  outline: none;\n\n  &:hover {\n    background: ${props => props.level === 0 ? '#f3f4f6' : '#f8fafc'};\n  }\n\n  &:focus {\n    background: #dbeafe;\n    box-shadow: inset 0 0 0 2px #3b82f6;\n  }\n\n  &:last-child {\n    border-bottom: none;\n  }\n\n  input[type=\"checkbox\"] {\n    margin: 0;\n    /* Zabrnit pefokusovn pi kliknut na checkbox */\n    pointer-events: none;\n  }\n\n  span {\n    padding-left: ${props => (props.level || 0) * 20}px;\n    font-weight: ${props => (props.level || 0) === 0 ? '600' : '400'};\n  }\n`;\n\nconst RadioGroup = styled.div`\n  display: flex;\n  gap: 1rem;\n  align-items: center;\n  margin-top: 0.5rem;\n`;\n\nconst RadioLabel = styled.label`\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-size: 0.875rem;\n  color: #374151;\n`;\n\nconst RadioInput = styled.input`\n  width: 16px;\n  height: 16px;\n  cursor: pointer;\n`;\n\n// Unlock button pro FZE 1 sekce - bez pozad, jen ikona\nconst UnlockButton = styled.button`\n  background: transparent;\n  color: #f59e0b;\n  border: none;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n  padding: 0;\n  margin-right: 8px;\n\n  &:hover {\n    color: #d97706;\n    transform: scale(1.1);\n  }\n\n  &:active {\n    transform: scale(0.95);\n  }\n\n  svg {\n    width: 16px;\n    height: 16px;\n  }\n`;\n\n// Loading overlay pro inicializaci formule with blur and fade\nconst LoadingOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(248, 250, 252, 0.95);\n  backdrop-filter: blur(${props => props.$visible ? '8px' : '0px'});\n  -webkit-backdrop-filter: blur(${props => props.$visible ? '8px' : '0px'});\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  z-index: 999999;\n  opacity: ${props => props.$visible ? 1 : 0};\n  transition: opacity 0.5s ease-in-out, backdrop-filter 0.6s ease-in-out;\n  pointer-events: ${props => props.$visible ? 'auto' : 'none'};\n\n  @media (max-width: 768px) {\n    padding: 1rem;\n  }\n`;\n\nconst LoadingSpinner = styled.div`\n  width: 64px;\n  height: 64px;\n  border: 4px solid #e2e8f0;\n  border-top: 4px solid #f59e0b;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n  margin-bottom: 1.5rem;\n  transform: scale(${props => props.$visible ? 1 : 0.8});\n  transition: transform 0.5s ease-in-out;\n\n  @keyframes spin {\n    0% { transform: rotate(0deg) scale(1); }\n    100% { transform: rotate(360deg) scale(1); }\n  }\n`;\n\nconst LoadingMessage = styled.div`\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #374151;\n  text-align: center;\n  margin-bottom: 0.5rem;\n  transform: translateY(${props => props.$visible ? '0' : '10px'});\n  opacity: ${props => props.$visible ? 1 : 0};\n  transition: transform 0.5s ease-in-out 0.1s, opacity 0.5s ease-in-out 0.1s;\n`;\n\nconst LoadingSubtext = styled.div`\n  font-size: 0.875rem;\n  color: #6b7280;\n  text-align: center;\n  transform: translateY(${props => props.$visible ? '0' : '10px'});\n  opacity: ${props => props.$visible ? 1 : 0};\n  transition: transform 0.5s ease-in-out 0.15s, opacity 0.5s ease-in-out 0.15s;\n`;\n\n//  Save Overlay - blur efekt pro zbytek strnky krom hlaviky pi ukldn\nconst SaveOverlay = styled.div`\n  position: fixed;\n  top: var(--fixed-header-height, 0px);\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.2);\n  backdrop-filter: blur(${props => props.$visible ? '5px' : '0px'});\n  -webkit-backdrop-filter: blur(${props => props.$visible ? '5px' : '0px'});\n  z-index: 99;\n  opacity: ${props => props.$visible ? 1 : 0};\n  transition: opacity 0.3s ease-in-out, backdrop-filter 0.3s ease-in-out;\n  pointer-events: ${props => props.$visible ? 'auto' : 'none'};\n  visibility: ${props => props.$visible ? 'visible' : 'hidden'};\n`;\n\n//  Hlasov rozpoznvn je implementovno globln v Layout.js\n// OrderForm25 NEPOUV vlastn indiktor, aby nedochzelo ke kolizm\n\nconst PageContent = styled.div`\n  filter: blur(${props => props.$blurred ? '3px' : '0px'});\n  transition: filter 0.6s ease-in-out;\n  pointer-events: ${props => props.$blurred ? 'none' : 'auto'};\n`;\n\nconst LoadingProgressBarContainer = styled.div`\n  width: 300px;\n  height: 6px;\n  background: #e2e8f0;\n  border-radius: 3px;\n  overflow: hidden;\n  margin-top: 1.5rem;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) inset;\n`;\n\nconst LoadingProgressBarFill = styled.div`\n  height: 100%;\n  background: linear-gradient(90deg, #2e7d32, #4caf50 40%, #66bb6a);\n  border-radius: 3px;\n  transition: width 250ms ease;\n  box-shadow: 0 0 6px rgba(76, 175, 80, 0.55);\n`;\n\nconst ErrorMessage = styled.div`\n  background: #fee2e2;\n  border: 1px solid #fecaca;\n  border-radius: 8px;\n  padding: 1rem;\n  color: #dc2626;\n  font-size: 0.875rem;\n  margin: 1rem 0;\n  text-align: center;\n`;\n\n// Ikony pro dodavatelsk pole\nconst SupplierSearchIcon = styled.div`\n  position: absolute;\n  right: 35px;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #059669;\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n\n  &:hover {\n    background-color: #f0fdf4;\n    color: #047857;\n  }\n\n  &:active {\n    background-color: #dcfce7;\n  }\n`;\n\nconst AresSearchIcon = styled.div`\n  position: absolute;\n  right: 8px;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #059669;\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n\n  &:hover {\n    background-color: #f0fdf4;\n    color: #047857;\n  }\n\n  &:active {\n    background-color: #dcfce7;\n  }\n`;\n\nconst AddToDirectoryIcon = styled.div`\n  color: ${props => props.isActive ? '#667eea' : '#d1d5db'};\n  cursor: ${props => props.isActive ? 'pointer' : 'not-allowed'};\n  padding: 6px;\n  border-radius: 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  transition: all 0.2s;\n  opacity: ${props => props.isActive ? 1 : 0.5};\n  background: ${props => props.isActive ? 'rgba(102, 126, 234, 0.1)' : 'transparent'};\n\n  ${props => props.isActive && `\n    &:hover {\n      background-color: rgba(102, 126, 234, 0.2);\n      color: #764ba2;\n      transform: scale(1.1);\n    }\n\n    &:active {\n      background-color: rgba(118, 75, 162, 0.2);\n      transform: scale(1.05);\n    }\n  `}\n`;\n\n// Ikona koe pro mazn poloek\nconst DeleteItemButton = styled.button`\n  background: #ef4444;\n  color: white;\n  border: 2px solid white;\n  border-radius: 6px;\n  padding: 0.375rem;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  transition: all 0.2s;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\n  &:hover {\n    background-color: #dc2626;\n    transform: scale(1.1);\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);\n  }\n\n  &:active {\n    background-color: #b91c1c;\n    transform: scale(0.95);\n  }\n`;\n\n// Supplier Directory Popup Styled Components\nconst SupplierPopupOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n`;\n\nconst SupplierPopupModal = styled.div`\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 800px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  animation: slideUp 0.3s ease-out;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n`;\n\nconst SupplierPopupHeader = styled.div`\n  padding: 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n`;\n\nconst SupplierPopupTitle = styled.h2`\n  margin: 0;\n  font-size: 20px;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  color: white;\n\n  svg {\n    font-size: 24px;\n  }\n`;\n\nconst SupplierPopupCloseButton = styled.button`\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 24px;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n`;\n\nconst SupplierSearchInput = styled.input`\n  width: 100%;\n  padding: 10px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 6px;\n  font-size: 14px;\n  transition: all 0.2s;\n\n  &:focus {\n    outline: none;\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 2px rgba(24,144,255,0.1);\n  }\n\n  &::placeholder {\n    color: #8c8c8c;\n  }\n`;\n\nconst SupplierPopupContent = styled.div`\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n`;\n\nconst SupplierList = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  max-height: 400px;\n  overflow-y: auto;\n`;\n\nconst SupplierItem = styled.div`\n  padding: 16px;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s;\n  background: white;\n\n  &:hover {\n    border-color: #667eea;\n    background-color: #f9fafb;\n    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);\n  }\n`;\n\n// ARES Popup Styled Components\nconst AresPopupOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 100000;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n`;\n\nconst AresPopupModal = styled.div`\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 900px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  animation: slideUp 0.3s ease-out;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n`;\n\nconst AresPopupHeader = styled.div`\n  padding: 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n`;\n\nconst AresPopupTitle = styled.h2`\n  margin: 0;\n  font-size: 18px;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  color: white;\n\n  svg {\n    width: 24px;\n    height: 24px;\n  }\n`;\n\nconst AresPopupCloseButton = styled.button`\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n`;\n\nconst AresPopupContent = styled.div`\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n`;\n\nconst AresSearchInputField = styled.input`\n  width: 100%;\n  padding: 10px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 6px;\n  font-size: 14px;\n  margin-bottom: 20px;\n  transition: all 0.2s;\n\n  &:focus {\n    outline: none;\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 2px rgba(24,144,255,0.1);\n  }\n\n  &::placeholder {\n    color: #8c8c8c;\n  }\n`;\n\nconst AresList = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  max-height: 400px;\n  overflow-y: auto;\n`;\n\nconst AresItem = styled.div`\n  padding: 16px;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  background: white;\n  position: relative;\n\n  &:hover {\n    border-color: #667eea;\n    background-color: #f9fafb;\n    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);\n  }\n`;\n\nconst AresItemContent = styled.div`\n  cursor: pointer;\n  margin-bottom: ${props => props.hasButtons ? '12px' : '0'};\n`;\n\nconst AresScopeBadges = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  margin-top: 8px;\n  flex-wrap: wrap;\n`;\n\nconst AresScopeBadge = styled.div`\n  display: inline-flex;\n  align-items: center;\n  gap: 4px;\n  padding: 4px 10px;\n  border-radius: 12px;\n  font-size: 11px;\n  font-weight: 600;\n  background: ${props => {\n    if (props.scope === 'global') return 'linear-gradient(135deg, #10b981 0%, #059669 100%)';\n    if (props.scope === 'usek') return 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';\n    return 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)'; // personal\n  }};\n  color: white;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\n  svg {\n    width: 12px;\n    height: 12px;\n  }\n`;\n\nconst AresItemButtons = styled.div`\n  display: flex;\n  gap: 8px;\n  margin-top: 12px;\n  padding-top: 12px;\n  border-top: 1px solid #e5e7eb;\n`;\n\nconst AresActionButton = styled.button`\n  padding: 10px 16px;\n  border: none;\n  border-radius: 6px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  white-space: nowrap;\n\n  &:disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n  }\n\n  &.primary {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);\n\n    &:hover:not(:disabled) {\n      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);\n      transform: translateY(-1px);\n    }\n\n    &:active:not(:disabled) {\n      transform: translateY(0);\n    }\n  }\n\n  &.success {\n    background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n    color: white;\n    box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);\n\n    &:hover:not(:disabled) {\n      box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);\n      transform: translateY(-1px);\n    }\n\n    &:active:not(:disabled) {\n      transform: translateY(0);\n    }\n  }\n`;\n\nconst AresLocationSelect = styled.select`\n  width: 100%;\n  padding: 10px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 6px;\n  background: white;\n  font-size: 14px;\n  color: #262626;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n\n  &:focus {\n    outline: none;\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 2px rgba(24,144,255,0.1);\n  }\n\n  &:hover {\n    border-color: #40a9ff;\n  }\n`;\n\nconst AresLoadingSpinner = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 40px 20px;\n  color: #6b7280;\n\n  @keyframes spin {\n    to { transform: rotate(360deg); }\n  }\n`;\n\n//  ARES Scope Selector Components - PESN STEJN jako v SupplierAddDialog\nconst AresScopeSelector = styled.div`\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 8px;\n  margin-top: 8px;\n  margin-bottom: 16px;\n`;\n\nconst AresScopeOption = styled.button`\n  padding: 12px;\n  border: 2px solid ${props => props.selected ? '#667eea' : '#e5e7eb'};\n  border-radius: 8px;\n  background: ${props => props.selected ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : 'white'};\n  color: ${props => props.selected ? 'white' : '#595959'};\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  opacity: ${props => props.disabled ? 0.5 : 1};\n  transition: all 0.2s;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 6px;\n  font-size: 13px;\n  font-weight: 500;\n  position: relative;\n\n  &:hover:not(:disabled) {\n    border-color: #667eea;\n    background: ${props => props.selected ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : '#f9fafb'};\n  }\n\n  svg {\n    font-size: 18px;\n  }\n`;\n\nconst AresUsekGrid = styled.div`\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));\n  gap: 8px;\n  margin-top: 12px;\n`;\n\nconst AresUsekItem = styled.label`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  padding: 8px 10px;\n  border: 2px solid ${props => props.selected ? '#667eea' : '#e5e7eb'};\n  border-radius: 6px;\n  background: ${props => props.selected ? 'rgba(102, 126, 234, 0.05)' : 'white'};\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  opacity: ${props => props.disabled ? 0.5 : 1};\n  transition: all 0.2s;\n  font-size: 13px;\n  font-weight: 600;\n  color: ${props => props.selected ? '#667eea' : '#374151'};\n\n  &:hover:not([disabled]) {\n    border-color: #667eea;\n    background: rgba(102, 126, 234, 0.05);\n  }\n\n  input[type=\"checkbox\"] {\n    width: 16px;\n    height: 16px;\n    cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  }\n`;\n\n// IO Check Notification Components\nconst IcoNotification = styled.div`\n  position: absolute;\n  top: calc(100% + 8px);\n  left: 0;\n  right: 0;\n  background: white;\n  border: 2px solid #e5e7eb;\n  border-radius: 8px;\n  padding: 16px;\n  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);\n  z-index: 100;\n\n  &[data-status=\"checking\"] {\n    border-color: #3b82f6;\n  }\n\n  &[data-status=\"found-local\"], &[data-status=\"found-ares\"] {\n    border-color: #10b981;\n  }\n\n  &[data-status=\"not-found\"] {\n    border-color: #ef4444;\n  }\n`;\n\nconst IcoNotificationTitle = styled.h4`\n  margin: 0 0 8px 0;\n  font-size: 14px;\n  font-weight: 600;\n  color: ${props =>\n    props.status === 'checking' ? '#3b82f6' :\n    props.status === 'found' ? '#10b981' :\n    props.status === 'not-found' ? '#ef4444' : '#111827'\n  };\n`;\n\nconst IcoNotificationMessage = styled.div`\n  font-size: 13px;\n  color: #6b7280;\n  margin-bottom: 12px;\n  line-height: 1.4;\n`;\n\nconst IcoNotificationActions = styled.div`\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n`;\n\nconst IcoActionButton = styled.button`\n  padding: 6px 12px;\n  border-radius: 6px;\n  font-size: 12px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n\n  &.primary {\n    background: #10b981;\n    color: white;\n    border: 1px solid #10b981;\n\n    &:hover {\n      background: #059669;\n    }\n  }\n\n  &.fill-form {\n    background: #3b82f6;\n    color: white;\n    border: 1px solid #3b82f6;\n\n    &:hover {\n      background: #2563eb;\n    }\n  }\n\n  &.secondary {\n    background: white;\n    color: #6b7280;\n    border: 1px solid #d1d5db;\n\n    &:hover {\n      background: #f9fafb;\n      color: #374151;\n    }\n  }\n`;\n\n// CSS for spinner animation\nconst GlobalStyle = `\n  @keyframes spin {\n    to { transform: rotate(360deg); }\n  }\n`;\n\n// =============== TEMPLATE PREVIEW KOMPONENTY ===============\n\nconst PreviewModal = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 999999;\n  padding: 1rem;\n`;\nconst PreviewContent = styled.div`\n  background: white;\n  border-radius: 8px;\n  padding: 2rem;\n  max-width: 700px;\n  width: 100%;\n  max-height: 85vh;\n  overflow-y: auto;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n  position: relative;\n`;\n\nconst PreviewHeader = styled.div`\n  margin-bottom: 1.5rem;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid #e5e7eb;\n`;\n\nconst PreviewTitle = styled.h3`\n  margin: 0;\n  color: #1e293b;\n  font-size: 1.25rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n`;\n\nconst PreviewCloseButton = styled.button`\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  background: transparent;\n  border: none;\n  border-radius: 4px;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: #64748b;\n  transition: all 0.2s;\n\n  &:hover {\n    background: #f1f5f9;\n    color: #1e293b;\n  }\n`;\n\nconst PreviewSection = styled.div`\n  margin-bottom: 1.5rem;\n  padding: 1.25rem;\n  background: #f8fafc;\n  border-radius: 8px;\n  border: 1px solid #e5e7eb;\n`;\n\nconst PreviewSectionTitle = styled.h4`\n  margin: 0 0 1rem 0;\n  color: #1e293b;\n  font-size: 0.875rem;\n  font-weight: 700;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n`;\n\nconst PreviewField = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  padding: 0.625rem 0;\n  border-bottom: 1px solid #e5e7eb;\n\n  &:last-child {\n    border-bottom: none;\n    padding-bottom: 0;\n  }\n`;\n\nconst PreviewFieldLabel = styled.span`\n  color: #64748b;\n  font-size: 0.875rem;\n  font-weight: 500;\n  min-width: 120px;\n  flex-shrink: 0;\n`;\n\nconst PreviewFieldValue = styled.span`\n  color: #1e293b;\n  font-size: 0.875rem;\n  font-weight: 600;\n  text-align: right;\n  flex: 1;\n  margin-left: 1rem;\n  word-break: break-word;\n`;\n\nconst PreviewItemsList = styled.div`\n  margin-top: 0.75rem;\n`;\n\nconst PreviewItem = styled.div`\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 0.75rem;\n  margin-bottom: 0.5rem;\n\n  &:last-child {\n    margin-bottom: 0;\n  }\n`;\n\nconst PreviewItemTitle = styled.div`\n  font-weight: 600;\n  color: #1e293b;\n  font-size: 0.875rem;\n  margin-bottom: 0.375rem;\n`;\n\nconst PreviewItemDetails = styled.div`\n  font-size: 0.75rem;\n  color: #64748b;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n`;\n\nconst PreviewBadge = styled.span`\n  background: ${props => {\n    if (props.type === 'po') return '#3b82f6';\n    if (props.type === 'details') return '#10b981';\n    return '#8b5cf6';\n  }};\n  color: white;\n  padding: 0.25rem 0.625rem;\n  border-radius: 4px;\n  font-size: 0.6875rem;\n  font-weight: 700;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n`;\n\nconst PreviewEmptyState = styled.div`\n  text-align: center;\n  padding: 2rem;\n  color: #9ca3af;\n  font-style: italic;\n`;\n\n// Currency Input Wrapper - pro zobrazen K fixn vpravo\nconst CurrencyInputWrapper = styled.div`\n  position: relative;\n  display: flex;\n  align-items: center;\n`;\n\nconst CurrencySymbol = styled.span`\n  position: absolute;\n  right: 12px;\n  color: ${props => props.disabled ? '#9ca3af' : '#374151'};\n  font-weight: 600;\n  font-size: 0.875rem;\n  font-family: inherit;\n  pointer-events: none;\n  user-select: none;\n  display: flex;\n  align-items: center;\n  height: 100%;\n`;\n\n// Currency Input Component - Zachovv pozici kurzoru pi psan\nfunction CurrencyInput({ fieldName, value, onChange, onBlur, disabled, hasError, placeholder }) {\n  const inputRef = useRef(null);\n  const [localValue, setLocalValue] = useState('');\n  const [isFocused, setIsFocused] = useState(false);\n\n  // Funkce pro formtovn mny (BEZ K, protoe to je fixn vpravo)\n  const formatCurrency = (val) => {\n    if (!val && val !== 0) return '';\n    const num = parseFloat(val.toString().replace(/[^0-9.-]/g, ''));\n    if (isNaN(num)) return '';\n    // Pro faktury/etnictv pesn 2 desetinn msta\n    return num.toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ' ').replace('.', ',');\n  };\n\n  // Inicializace lokln hodnoty z props (pouze kdy nen focused)\n  useEffect(() => {\n    if (!isFocused) {\n      const formattedValue = formatCurrency(value || '');\n      if (localValue !== formattedValue) {\n        setLocalValue(formattedValue);\n      }\n    }\n  }, [value, isFocused]);\n\n  const handleChange = (e) => {\n    const newValue = e.target.value;\n\n    // Aktualizovat lokln hodnotu okamit (bez formtovn)\n    setLocalValue(newValue);\n\n    //  FIX: Ped odeslnm do onChange oistit hodnotu od formtovn\n    // Parsovat a vrtit jako string s tekou (ne rkou) pro konzistentn ukldn\n    const cleanValue = newValue.replace(/[^\\d,.-]/g, '').replace(',', '.');\n    const numValue = parseFloat(cleanValue);\n    const finalValue = isNaN(numValue) ? '' : numValue.toFixed(2);\n\n    //  VOLAT onChange pi kadm znaku pro pepoet DPH s oitnou hodnotou\n    onChange(fieldName, finalValue);\n  };\n\n  const handleFocus = () => {\n    setIsFocused(true);\n  };\n\n  const handleBlurLocal = () => {\n    setIsFocused(false);\n\n    // Formtovat hodnotu pi ztrt fokusu (BEZ K)\n    const formatted = formatCurrency(localValue);\n    setLocalValue(formatted);\n\n    //  FIX: Ped odeslnm do onBlur oistit hodnotu od formtovn\n    const cleanValue = localValue.replace(/[^\\d,.-]/g, '').replace(',', '.');\n    const numValue = parseFloat(cleanValue);\n    const finalValue = isNaN(numValue) ? '' : numValue.toFixed(2);\n\n    //  onChange u se vol pi kadm znaku, pi blur jen formatujeme\n    // Ale stle musme zavolat parent onBlur pro validaci\n    if (onBlur) {\n      onBlur(fieldName, finalValue);\n    }\n  };\n\n  return (\n    <CurrencyInputWrapper>\n      <InputWithIcon hasIcon>\n        <Calculator />\n        <Input\n          ref={inputRef}\n          type=\"text\"\n          name={fieldName}\n          placeholder={placeholder}\n          value={localValue}\n          onChange={handleChange}\n          onFocus={handleFocus}\n          onBlur={handleBlurLocal}\n          disabled={disabled}\n          style={{ textAlign: 'right', paddingRight: '40px' }}\n          hasError={hasError}\n          hasIcon\n        />\n      </InputWithIcon>\n      <CurrencySymbol disabled={disabled}>K</CurrencySymbol>\n    </CurrencyInputWrapper>\n  );\n}\n\n// DatePicker Component - prevzato z src/components/DatePicker.js\nfunction DatePicker({ fieldName, value, onChange, onBlur, disabled, hasError, placeholder = 'Vyberte datum' }) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [currentMonth, setCurrentMonth] = useState(new Date());\n  const [openUpwards, setOpenUpwards] = useState(false); //  Detekce smru oteven\n  const wrapperRef = useRef(null);\n  const calendarRef = useRef(null);\n\n  // Parse value to Date\n  const selectedDate = value ? new Date(value) : null;\n\n  // Update currentMonth when value changes to show correct month\n  useEffect(() => {\n    if (value) {\n      const date = new Date(value);\n      if (!isNaN(date.getTime())) {\n        setCurrentMonth(date);\n      }\n    }\n  }, [value]);\n\n  // Close calendar when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {\n        setIsOpen(false);\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n    }\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, [isOpen]);\n\n  //  Detekce smru oteven kalende (nahoru/dol) podle dostupnho msta\n  useEffect(() => {\n    if (isOpen && wrapperRef.current) {\n      const checkPosition = () => {\n        if (!wrapperRef.current) return;\n\n        const buttonRect = wrapperRef.current.getBoundingClientRect();\n        const calendarHeight = 380; // Piblin vka kalende\n        const footerHeight = 54; // Vka fixn patiky\n        const buffer = 20; // Extra buffer pro bezpenost\n\n        const spaceBelow = window.innerHeight - buttonRect.bottom - footerHeight - buffer;\n        const spaceAbove = buttonRect.top - buffer;\n\n        // Otevi nahoru pokud: nen dost msta dole NEBO je nahoe vrazn vce msta\n        const shouldOpenUpward = spaceBelow < 300 || (spaceBelow < calendarHeight && spaceAbove > spaceBelow + 50);\n\n        setOpenUpwards(shouldOpenUpward);\n      };\n\n      checkPosition();\n\n      // Pidej scroll listener pro re-pozicovn\n      const scrollContainer = document.querySelector('[class*=\"ScrollableContent\"]');\n      if (scrollContainer) {\n        scrollContainer.addEventListener('scroll', checkPosition);\n        return () => scrollContainer.removeEventListener('scroll', checkPosition);\n      }\n    }\n  }, [isOpen]);\n\n  // Format date for display\n  const formatDisplayDate = (date) => {\n    if (!date) return '';\n    try {\n      const d = new Date(date);\n      if (isNaN(d.getTime())) return ''; // Invalid date check\n      return d.toLocaleDateString('cs-CZ', { day: '2-digit', month: '2-digit', year: 'numeric' });\n    } catch (err) {\n      return '';\n    }\n  };\n\n  // Format date for input (YYYY-MM-DD)\n  const formatInputDate = (date) => {\n    const d = new Date(date);\n    const year = d.getFullYear();\n    const month = String(d.getMonth() + 1).padStart(2, '0');\n    const day = String(d.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n  };\n\n  // Get calendar days for current month\n  const getCalendarDays = () => {\n    const year = currentMonth.getFullYear();\n    const month = currentMonth.getMonth();\n\n    const firstDay = new Date(year, month, 1);\n    const lastDay = new Date(year, month + 1, 0);\n\n    const startDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1; // Monday = 0\n    const days = [];\n\n    // Previous month days\n    for (let i = startDay - 1; i >= 0; i--) {\n      const date = new Date(year, month, -i);\n      days.push({ date, isOtherMonth: true });\n    }\n\n    // Current month days\n    for (let i = 1; i <= lastDay.getDate(); i++) {\n      const date = new Date(year, month, i);\n      days.push({ date, isOtherMonth: false });\n    }\n\n    // Next month days\n    const remainingDays = 42 - days.length; // 6 rows * 7 days\n    for (let i = 1; i <= remainingDays; i++) {\n      const date = new Date(year, month + 1, i);\n      days.push({ date, isOtherMonth: true });\n    }\n\n    return days;\n  };\n\n  const handleDateSelect = (date) => {\n    const formattedDate = formatInputDate(date);\n    // Volat onChange s hodnotou - fieldName je u v props\n    onChange(formattedDate);\n    if (onBlur) {\n      onBlur(formattedDate);\n    }\n    setIsOpen(false);\n  };\n\n  const handleToday = (e) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    handleDateSelect(new Date());\n  };\n\n  const handleClear = (e) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    onChange('');\n    if (onBlur) {\n      onBlur('');\n    }\n    setIsOpen(false);\n  };\n\n  const prevMonth = (e) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1));\n  };\n\n  const nextMonth = (e) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1));\n  };\n\n  const today = new Date();\n  const calendarDays = getCalendarDays();\n\n  const displayText = value ? formatDisplayDate(value) : placeholder;\n\n  return (\n    <DatePickerWrapper ref={wrapperRef} data-field={fieldName}>\n      <InputWithIcon hasIcon>\n        <Calendar />\n        <DateInputButton\n          type=\"button\"\n          onClick={() => !disabled && setIsOpen(!isOpen)}\n          disabled={disabled}\n          hasError={hasError}\n          hasValue={!!value}\n          data-datepicker={fieldName}\n        >\n          {displayText}\n        </DateInputButton>\n\n        {/* Kek pro smazn */}\n        {value && !disabled && (\n          <DateClearButton\n            type=\"button\"\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              handleClear(e);\n            }}\n            title=\"Smazat datum\"\n          >\n            \n          </DateClearButton>\n        )}\n\n        {/* Tlatko pro dnen datum */}\n        {!disabled && (\n          <DateTodayButton\n            type=\"button\"\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              handleToday(e);\n            }}\n            title=\"Nastavit dnen datum\"\n          >\n            \n          </DateTodayButton>\n        )}\n      </InputWithIcon>\n\n      {isOpen && !disabled && (\n        <DateCalendarPopup ref={calendarRef} openUpwards={openUpwards}>\n          <CalendarHeader>\n            <CalendarNav onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              prevMonth(e);\n            }}></CalendarNav>\n            <CalendarTitle>\n              <span>{currentMonth.toLocaleDateString('cs-CZ', { month: 'long' })}</span>\n              <span>{currentMonth.getFullYear()}</span>\n            </CalendarTitle>\n            <CalendarNav onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              nextMonth(e);\n            }}></CalendarNav>\n          </CalendarHeader>\n\n          <CalendarGrid>\n            <CalendarDay>Po</CalendarDay>\n            <CalendarDay>t</CalendarDay>\n            <CalendarDay>St</CalendarDay>\n            <CalendarDay>t</CalendarDay>\n            <CalendarDay>P</CalendarDay>\n            <CalendarDay>So</CalendarDay>\n            <CalendarDay>Ne</CalendarDay>\n\n            {calendarDays.map((day, index) => {\n              const isToday = day.date.toDateString() === today.toDateString();\n              const isSelected = selectedDate && day.date.toDateString() === selectedDate.toDateString();\n\n              return (\n                <CalendarDate\n                  key={index}\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleDateSelect(day.date);\n                  }}\n                  isToday={isToday}\n                  isSelected={isSelected}\n                  isOtherMonth={day.isOtherMonth}\n                >\n                  {day.date.getDate()}\n                </CalendarDate>\n              );\n            })}\n          </CalendarGrid>\n\n          <CalendarFooter>\n            <CalendarButton\n              className=\"today\"\n              onClick={(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                handleDateSelect(new Date());\n              }}\n            >\n              Dnes\n            </CalendarButton>\n            <CalendarButton\n              className=\"clear\"\n              onClick={(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                onChange('');\n                if (onBlur) {\n                  onBlur('');\n                }\n                setIsOpen(false);\n              }}\n            >\n              Smazat\n            </CalendarButton>\n          </CalendarFooter>\n        </DateCalendarPopup>\n      )}\n    </DatePickerWrapper>\n  );\n}\n\n// DatePicker styled components\nconst DatePickerWrapper = styled.div`\n  position: relative;\n  width: 100%;\n`;\n\nconst DateInputButton = styled.button`\n  width: 100%;\n  display: block;\n  padding: 0.75rem;\n  padding-left: 2.75rem;\n  padding-right: ${props => props.disabled ? '0.75rem' : props.hasValue ? '4.5rem' : '3rem'};\n  border: 2px solid ${props => props.hasError ? '#ef4444' : '#e5e7eb'};\n  border-radius: 8px;\n  background: ${props => props.disabled ? '#f9fafb' : 'white'};\n  color: ${props => props.disabled ? '#6b7280' : props.hasValue ? '#1f2937' : '#9ca3af'};\n  font-size: 0.875rem;\n  font-weight: ${props => props.hasValue && !props.disabled ? '600' : '400'};\n  line-height: 1.5;\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  transition: all 0.2s ease;\n  text-align: left;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  min-height: 42px;\n  box-sizing: border-box;\n\n  &:hover:not(:disabled) {\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  }\n`;\n\nconst DateClearButton = styled.button`\n  position: absolute;\n  right: 36px;\n  top: 50%;\n  transform: translateY(-50%);\n  background: #ef4444;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: bold;\n  transition: all 0.2s ease;\n  z-index: 1;\n\n  &:hover {\n    background: #dc2626;\n    transform: translateY(-50%) scale(1.1);\n  }\n`;\n\nconst DateTodayButton = styled.button`\n  position: absolute;\n  right: 8px;\n  top: 50%;\n  transform: translateY(-50%);\n  background: transparent;\n  color: #3b82f6;\n  border: none;\n  border-radius: 4px;\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  font-size: 13px;\n  font-weight: bold;\n  transition: all 0.2s ease;\n  z-index: 1;\n\n  &:hover {\n    background: transparent;\n    color: #2563eb;\n    transform: translateY(-50%) scale(1.15);\n  }\n`;\n\nconst DateCalendarPopup = styled.div`\n  position: absolute;\n  ${props => props.openUpwards ? `\n    bottom: calc(100% + 4px);\n    top: auto;\n  ` : `\n    top: calc(100% + 4px);\n    bottom: auto;\n  `}\n  left: 0;\n  right: 0;\n  z-index: 10001;\n  background: white;\n  border: 2px solid #3b82f6;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n  padding: 0.5rem;\n`;\n\nconst CalendarHeader = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n  padding-bottom: 0.35rem;\n  border-bottom: 1px solid #e5e7eb;\n`;\n\nconst CalendarNav = styled.button`\n  background: #f3f4f6;\n  border: none;\n  border-radius: 4px;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: #374151;\n  font-weight: 600;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n\n  &:hover {\n    background: #3b82f6;\n    color: white;\n    transform: scale(1.1);\n  }\n`;\n\nconst CalendarTitle = styled.div`\n  font-weight: 600;\n  font-size: 0.85rem;\n  color: #111827;\n  display: flex;\n  gap: 0.35rem;\n`;\n\nconst CalendarGrid = styled.div`\n  display: grid;\n  grid-template-columns: repeat(7, 1fr);\n  gap: 1px;\n`;\n\nconst CalendarDay = styled.div`\n  aspect-ratio: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 0.65rem;\n  font-weight: 600;\n  color: #6b7280;\n  padding: 0.15rem;\n`;\n\nconst CalendarDate = styled.button`\n  aspect-ratio: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 0.75rem;\n  border: none;\n  border-radius: 4px;\n  background: ${props => props.isToday ? '#dbeafe' : props.isSelected ? '#3b82f6' : 'transparent'};\n  color: ${props => props.isSelected ? 'white' : props.isOtherMonth ? '#9ca3af' : '#374151'};\n  font-weight: ${props => props.isToday || props.isSelected ? '600' : '400'};\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &:hover {\n    background: ${props => props.isSelected ? '#2563eb' : '#f3f4f6'};\n    transform: scale(1.1);\n    color: ${props => props.isSelected ? 'white' : '#111827'};\n  }\n`;\n\nconst CalendarFooter = styled.div`\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 0.5rem;\n  padding-top: 0.5rem;\n  border-top: 2px solid #e5e7eb;\n`;\n\nconst CalendarButton = styled.button`\n  flex: 1;\n  padding: 0.5rem;\n  border: none;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &.today {\n    background: #dbeafe;\n    color: #1e40af;\n\n    &:hover {\n      background: #bfdbfe;\n    }\n  }\n\n  &.clear {\n    background: #fee2e2;\n    color: #991b1b;\n\n    &:hover {\n      background: #fecaca;\n    }\n  }\n`;\n\n// ========================================\n//  FAKTURY PLOHY - nyn eeno samostatnou komponentou InvoiceAttachmentsCompact\n// Star styled components (FakturaAttachmentsWrapper, DropZone, AttachmentsList, atd.) odstranny\n// ========================================\n\n// ========================================\n//  TOOLTIP PRO INFO FAKTURY\n// ========================================\n\nconst FakturaInfoIconWrapper = styled.div`\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 6px;\n  cursor: help;\n\n  &:hover .tooltip-bubble {\n    opacity: 1;\n    visibility: visible;\n    transform: translateY(0);\n  }\n\n  &:hover .help-icon {\n    color: #3b82f6;\n  }\n`;\n\nconst FakturaInfoIcon = styled.span`\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  width: 16px;\n  height: 16px;\n  color: #6b7280;\n  transition: color 0.2s ease;\n\n  svg {\n    width: 16px;\n    height: 16px;\n  }\n`;\n\nconst FakturaTooltipBubble = styled.div`\n  position: absolute;\n  bottom: calc(100% + 8px);\n  left: 50%;\n  transform: translateX(-50%) translateY(-4px);\n  width: 320px;\n  padding: 12px;\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);\n  opacity: 0;\n  visibility: hidden;\n  transition: all 0.2s ease;\n  z-index: 1000;\n  pointer-events: none;\n\n  /* ipka dol */\n  &::after {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    width: 0;\n    height: 0;\n    border-left: 6px solid transparent;\n    border-right: 6px solid transparent;\n    border-top: 6px solid #ffffff;\n  }\n\n  &::before {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    width: 0;\n    height: 0;\n    border-left: 7px solid transparent;\n    border-right: 7px solid transparent;\n    border-top: 7px solid #e5e7eb;\n    margin-top: 1px;\n    z-index: -1;\n  }\n`;\n\nconst FakturaTooltipRow = styled.div`\n  display: flex;\n  justify-content: space-between;\n  padding: 6px 0;\n  font-size: 0.75rem;\n  border-bottom: 1px solid #f3f4f6;\n\n  &:last-child {\n    border-bottom: none;\n  }\n`;\n\nconst FakturaTooltipLabel = styled.span`\n  color: #6b7280;\n  font-weight: 500;\n`;\n\nconst FakturaTooltipValue = styled.span`\n  color: #1f2937;\n  font-weight: 600;\n  text-align: right;\n  max-width: 180px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n`;\n\n/**\n *  VALIDACE STEDISEK: Fallback pro neaktivn stediska\n *\n * Zkontroluje, zda jsou vechna stediska aktivn.\n * Pokud ne, nahrad neaktivn stediska za \"100\" (Sprva Kladno).\n *\n * @param {string[]} strediskaCodes - Array kd stedisek\n * @param {Array} strediskaOptions - Dostupn aktivn stediska\n * @returns {string[]} - Validovan array stedisek\n */\nconst validateAndFixStrediska = (strediskaCodes, strediskaOptions) => {\n  if (!Array.isArray(strediskaCodes) || strediskaCodes.length === 0) {\n    return strediskaCodes;\n  }\n\n  const FALLBACK_STREDISKO = \"100\"; // 100 Sprva Kladno\n\n  return strediskaCodes.map(kod => {\n    // Zkontroluj, zda stedisko existuje v aktivnch\n    const exists = strediskaOptions.find(opt =>\n      (opt.value && opt.value === kod) ||\n      (opt.kod && opt.kod === kod) ||\n      (opt.kod_stavu && opt.kod_stavu === kod)\n    );\n\n    if (!exists) {\n      return FALLBACK_STREDISKO;\n    }\n\n    return kod;\n  });\n};\n\n/**\n *  CENTRLN TRANSFORMACE: Backend  Frontend\n *\n * Transformuje data z backendu do formtu pro frontend form\n * Specifikace: DATA-FORMAT-CONTRACT.md\n *\n * @see src/utils/dataTransformHelpers.js\n * @param {object} backendData - Raw data z V2 API\n * @returns {object} - Transformovan data pro formData\n *\n * Pouit:\n * - Po INSERT/UPDATE objednvky (saveOrderToAPI)\n * - Po naten objednvky (loadOrderData)\n * - Po jakkoli komunikaci s backendem\n */\nconst transformBackendDataToFrontend = (backendData) => {\n  if (!backendData) return {};\n\n  const transformed = { ...backendData };\n\n  // 1. POLOKY: Backend vrac 'polozky', FE pouv 'polozky_objednavky'\n  if (backendData.polozky && !backendData.polozky_objednavky) {\n    //  FIX: Normalizovat ceny z DB - zajistit e jsou ve formtu \"12345.67\" (string s tekou, 2 des. msta)\n    transformed.polozky_objednavky = Array.isArray(backendData.polozky) \n      ? backendData.polozky.map(item => ({\n          ...item,\n          cena_bez_dph: typeof item.cena_bez_dph === 'number' \n            ? item.cena_bez_dph.toFixed(2) \n            : (parseFloat((item.cena_bez_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0).toFixed(2),\n          cena_s_dph: typeof item.cena_s_dph === 'number' \n            ? item.cena_s_dph.toFixed(2) \n            : (parseFloat((item.cena_s_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0).toFixed(2),\n          sazba_dph: parseInt(item.sazba_dph) || 21\n        }))\n      : [];\n    delete transformed.polozky; // Vyistit BE pole\n  }\n\n  // 2.  STEDISKA: Normalizovat do array string\n  if (backendData.strediska_kod) {\n    transformed.strediska_kod = normalizeStrediskaFromBackend(backendData.strediska_kod);\n  }\n\n  // 3.  FINANCOVN: Normalizovat do flat struktury (POUZE LP a SMLOUVA pole)\n  \n  if (backendData.financovani) {\n    \n    const financing = normalizeFinancovaniFromBackend(backendData.financovani);\n    \n    \n    Object.assign(transformed, financing);\n  } else {\n  }\n\n  // 3.5.  VECHNA POLE (LP, SMLOUVA, INDIVIDULN, POJISTN UDLOST) se nataj z financovani objektu\n  // normalizeFinancovaniFromBackend() u to udlal v kroku 3\n\n  // 4. SLOVN: cislo_objednavky  ev_cislo\n  if (backendData.cislo_objednavky && !backendData.ev_cislo) {\n    transformed.ev_cislo = backendData.cislo_objednavky;\n  }\n\n  // 5.  WORKFLOW: Parsovat stav_workflow_kod z JSON stringu na array\n  // Backend vrac: '[\"NOVA\",\"SCHVALENA\"]'  FE oekv: [\"NOVA\",\"SCHVALENA\"]\n  if (backendData.stav_workflow_kod) {\n    if (typeof backendData.stav_workflow_kod === 'string' && backendData.stav_workflow_kod.trim().startsWith('[')) {\n      try {\n        const parsed = JSON.parse(backendData.stav_workflow_kod);\n        if (Array.isArray(parsed)) {\n          transformed.stav_workflow_kod = parsed;\n        }\n      } catch (e) {\n        // Zachovat pvodn hodnotu\n      }\n    }\n    // Pokud u je array nebo nen JSON string, zachovat pvodn hodnotu\n  }\n\n  // 5.5.  DOKONEN: Zajistit sprvn parsovn potvrzeni_dokonceni_objednavky\n  // Backend vrac slo (0/1), FE oekv integer\n  if (backendData.potvrzeni_dokonceni_objednavky !== undefined) {\n    transformed.potvrzeni_dokonceni_objednavky = parseInt(backendData.potvrzeni_dokonceni_objednavky, 10) || 0;\n  }\n\n  // 5.6.  STAV ODESLN: Parsovat boolean/integer fieldy pro odesln a storno\n  // Backend me vracet 0/1 nebo true/false\n  if (backendData.stav_odeslano !== undefined) {\n    transformed.stav_odeslano = Boolean(backendData.stav_odeslano);\n  }\n  if (backendData.stav_stornovano !== undefined) {\n    transformed.stav_stornovano = Boolean(backendData.stav_stornovano);\n  }\n\n  //   INDIVIDULN SCHVLEN a POJISTN UDLOST: Nataj se z root objektu (krok 3.5)\n  //     stejn jako cislo_smlouvy - NEJSOU vnoen ve financovani objektu\n\n  // 5.8.  DATUMY A TEXTOV FIELDY: Koprovat pmo bez transformace\n  const directCopyFields = [\n    'datum_storna',\n    'odeslani_storno_duvod',\n    'identifikator',\n    'dt_odeslani',\n    'storno_uzivatel_id',\n    'storno_provedl'\n  ];\n\n  directCopyFields.forEach(field => {\n    if (backendData[field] !== undefined) {\n      transformed[field] = backendData[field];\n    }\n  });\n\n  // 6. POZNMKA: Backend vrac 'poznamka', FE pouv 'poznamka_objednavky'\n  if (backendData.poznamka) {\n    // Pokud je poznmka JSON string (chyba z Notes panelu), zkus parsovat text\n    let poznamkaText = backendData.poznamka;\n\n    // Opakovan parsuj, dokud je to JSON (e vcensobn zanoovn)\n    let maxIterations = 5; // Ochrana proti nekonen smyce\n    while (typeof poznamkaText === 'string' && poznamkaText.trim().startsWith('{') && maxIterations > 0) {\n      try {\n        const parsed = JSON.parse(poznamkaText);\n\n        // Pokud m strukturu {text, datum, typ} z Notes panelu, extrahuj text\n        if (parsed.text !== undefined) {\n          poznamkaText = parsed.text;\n        } else {\n          // Jin JSON struktura - zachovej pvodn\n          break;\n        }\n      } catch (e) {\n        // Nen validn JSON - konec parsovn\n        break;\n      }\n      maxIterations--;\n    }\n\n    transformed.poznamka_objednavky = poznamkaText;\n    delete transformed.poznamka; // Vyistit BE pole\n  }\n\n  // 7.  POTVRZEN DODAVATELEM: Parsovat JSON string z DB\n  // Backend vrac: '{\"potvrzeni\":\"ANO\",\"zpusoby\":[\"podepsana_objednavka\"],\"platba\":\"faktura\"}'\n  // FE oekv: {potvrzeni: 'ANO', zpusoby: ['podepsana_objednavka'], platba: 'faktura'}\n  if (backendData.dodavatel_zpusob_potvrzeni && typeof backendData.dodavatel_zpusob_potvrzeni === 'string') {\n    try {\n      const parsed = JSON.parse(backendData.dodavatel_zpusob_potvrzeni);\n      transformed.dodavatel_zpusob_potvrzeni = parsed;\n    } catch (e) {\n      // Zachovat pvodn hodnotu pi chyb\n    }\n  }\n\n  return transformed;\n};\n\n// OrderForm25 - Modern form for 2025 orders following workflow phases\nfunction OrderForm25() {\n  const navigate = useNavigate();\n  const { showToast } = useContext(ToastContext) || {};\n  const { userDetail, user_id, username, token, user, userPermissions, hasPermission } = useContext(AuthContext) || {};\n  const { triggerActivity } = useActivity();\n  const { progress, start: startGlobalProgress, setProgress: setGlobalProgress, done: doneGlobalProgress, fail: failGlobalProgress, reset: resetGlobalProgress } = useContext(ProgressContext) || {};\n\n  //  REF: onDataLoaded protection flag - pout ref msto window\n  const onDataLoadedCalledRef = useRef(false);\n\n  //  OPRAVENO: Pouit useLocation() pro reaktivn URL parametry\n  const location = useLocation();\n  const urlParams = useMemo(() => new URLSearchParams(location.search), [location.search]);\n  \n  //  PERSISTENCE: ti editOrderId z URL nebo z draftManager\n  const editOrderIdFromUrl = urlParams.get('edit');\n  const metadata = draftManager.getMetadata();\n  const editOrderIdFromLS = metadata?.editOrderId;\n  const editOrderId = editOrderIdFromUrl || editOrderIdFromLS;\n  \n  //  OKAMIT BROADCAST MenuBaru pi mount - podle dostupnch dat\n  useEffect(() => {\n    //  PRIORITA: Zkontrolovat draft NEJDV (me mt vce informac ne URL)\n    const checkInitialState = async () => {\n      let menuBarState = 'NOVA'; // Default\n      let orderId = null;\n      let orderNumber = '';\n      \n      try {\n        if (user_id) {\n          draftManager.setCurrentUser(user_id);\n          \n          // Nast draft metadata\n          const metadata = draftManager.getMetadata();\n          const hasDraftData = await draftManager.hasDraft();\n          \n          if (hasDraftData) {\n            const draftData = await draftManager.loadDraft();\n            \n            if (draftData && draftData.formData) {\n              // Draft existuje - urit stav podle savedOrderId\n              if (draftData.savedOrderId && draftData.formData.id) {\n                // M savedOrderId  EDITACE skuten objednvky\n                menuBarState = 'EDITACE';\n                orderId = draftData.savedOrderId;\n                orderNumber = draftData.formData.cislo_objednavky || draftData.formData.ev_cislo || '';\n              } else {\n                // Nem savedOrderId  KONCEPT (autosave po prvn zmn)\n                menuBarState = 'KONCEPT';\n                orderId = null;\n                orderNumber = '';\n              }\n            }\n          } else if (editOrderId) {\n            // Nem draft, ale m editOrderId z URL  natn EDITACE\n            menuBarState = 'EDITACE';\n            orderId = parseInt(editOrderId);\n            orderNumber = ''; // Bude doplnno po naten\n            \n            // Ulo editOrderId do draftManager\n            draftManager.saveMetadata({ editOrderId: editOrderId });\n          }\n        } else if (editOrderId) {\n          // Anonymn uivatel s editOrderId\n          menuBarState = 'EDITACE';\n          orderId = parseInt(editOrderId);\n          orderNumber = '';\n        }\n      } catch (error) {\n        // Chyba pi kontrole draftu - fallback na URL parametr\n        if (editOrderId) {\n          menuBarState = 'EDITACE';\n          orderId = parseInt(editOrderId);\n          orderNumber = '';\n        }\n      }\n      \n      //  POSLAT BROADCAST s urenm stavem\n      const state = {\n        isEditMode: menuBarState === 'EDITACE',\n        isNewOrder: menuBarState === 'NOVA',\n        orderId: orderId,\n        orderNumber: orderNumber,\n        currentPhase: 1,\n        mainWorkflowState: 'NOVA',\n        hasDraft: menuBarState !== 'NOVA',\n        timestamp: Date.now()\n      };\n      \n      window.__orderFormState = state;\n      window.dispatchEvent(new CustomEvent('orderFormStateChange', { detail: state }));\n    };\n    \n    checkInitialState();\n  }, [editOrderId, user_id]); // Spust se pi mount a zmn editOrderId\n  \n  const archivovanoParam = urlParams.get('archivovano'); // Parametr pro naten archivovanch objednvek\n\n  //  NOV REFACTORED STATE MANAGEMENT\n\n  //  NOV REFACTORED STATE MANAGEMENT\n  // Callbacks pro useFormController budou definovny a po state variables\n\n  //  POZOR: Star useState hooks ne budou postupn nahrazeny formController state\n  // Pro nyn je ponechvme pro zachovn funknosti bhem refactoringu\n\n  const [sectionStates, setSectionStates] = useState({\n    objednatel: false,\n    schvaleni: false,\n    prilohy: false,  // FZE 2: Plohy\n\n    // Rozen sekce - viditeln jen po schvlen\n    financovani: false,\n    dodavatel: false,\n    kontakt: false,\n    detaily: false,\n    dodaci_podminky: false,\n    stav_odeslani: false,\n\n    // Nov sekce po stavu objednvky\n    potvrzeni_objednavky: false,\n    registr_smluv: false,  // FZE 4: Checkbox \"M bt zveejnna\"\n    registr_smluv_vyplneni: false,  // FZE 5: Vyplnn datum + IDDT\n\n    // FZE 3: Sekce po odesln objednvky\n    prubeh_objednavky: false,\n    dodaci_informace: false,\n    fakturace: false,\n    // vecna_spravnost: false,  //  ODSTRANNO - refaktorovno na per-invoice\n    dokonceni: false,  // FZE 8: Dokonen objednvky\n    storno_detail: false,\n  });\n\n  // State pro vlastn select komponenty\n  const [selectStates, setSelectStates] = useState({\n    garant: false,\n    prikazce: false,\n    strediska: false,\n    financovani: false,\n    lp_kod: false,\n  });\n\n  // Search states pro selecty\n  const [searchStates, setSearchStates] = useState({\n    garant: '',\n    prikazce: '',\n    strediska: '',\n    financovani: '',\n    lp_kod: '',\n  });\n\n  // Tracking kter Custom Select fields byly \"touched\" (uivatel s nimi interagoval)\n  const [touchedSelectFields, setTouchedSelectFields] = useState(new Set());\n\n  //  Loading state pro ev. slo (EEN PROBLMU #1)\n  const [isLoadingEvCislo, setIsLoadingEvCislo] = useState(false);\n\n  // Fullscreen reim\n  const [isFullscreen, setIsFullscreen] = useState(false);\n\n  //  SPRINT 4: Consolidated LP Details State (21 hook)\n  const [lpDetailsState, setLpDetailsState] = useState({\n    details: {}, // { lp_id: { zbyva_skutecne, celkovy_limit, ... } }\n    loading: {} // { lp_id: true/false }\n  });\n  \n  //  SPRINT 4: Consolidated Smlouvy (Contracts) State (61 hook)\n  const [smlouvyState, setSmlouvyState] = useState({\n    list: [], // Seznam vech smluv pro autocomplete\n    loadingList: false,\n    detail: null, // Detail vybran smlouvy\n    loadingDetail: false,\n    searchTerm: '', // Vyhledvac term pro smlouvy\n    showSuggestions: false,\n    selectedSuggestionIndex: -1 // Index vybran poloky v dropdownu\n  });\n\n  // useEffect pro ESC klvesy v fullscreen reimu\n  useEffect(() => {\n    if (!isFullscreen) return;\n\n    const handleEscKey = (event) => {\n      if (event.key === 'Escape') {\n        setIsFullscreen(false);\n      }\n    };\n\n    window.addEventListener('keydown', handleEscKey);\n    return () => window.removeEventListener('keydown', handleEscKey);\n  }, [isFullscreen]);\n\n  //  REFACTORED: selnky budou definovny a po formController\n\n  // Stavy pro plohy\n  const [attachments, setAttachments] = useState([]); // Lokln seznam ploh\n  \n  //  OBNOVEN NEULOENCH PLOH Z LOCALSTORAGE\n\n  \n  //  SPRINT 4: Consolidated Attachment UI State (61 hook)\n  const [attachmentUI, setAttachmentUI] = useState({\n    uploading: false,\n    dragOver: false,\n    checkingSync: false,\n    showDeleteDialog: false,\n    deleteTarget: null,\n    showDeleteAllDialog: false\n  });\n\n  //  SPRINT 4: Consolidated Supplier Search State (51 hook)\n  const [supplierSearch, setSupplierSearch] = useState({\n    showDialog: false,\n    searchTerm: '',\n    results: [],\n    loading: false,\n    allContacts: [] // Vechny kontakty naten jednou\n  });\n  \n  //  SPRINT 4: Consolidated ARES State (81 hook)\n  const [aresState, setAresState] = useState({\n    popupOpen: false,\n    search: '',\n    results: [],\n    loading: false,\n    savingToLocal: null, // ID zznamu kter se ukld\n    scopeInfo: {}, // { ico: { existsInPersonal, existsInUsek, existsInGlobal } }\n    selectedScope: 'personal', // Vybran scope pro ARES dialog\n    selectedUseky: [] // Vybran seky pro ARES scope 'usek'\n  });\n\n  //  SPRINT 4: Consolidated Useky State (21 hook)\n  const [usekyState, setUsekyState] = useState({\n    available: [],\n    loading: false\n  });\n\n  //  SPRINT 4: Consolidated ICO Check State (41 hook)\n  const [icoCheckState, setIcoCheckState] = useState({\n    show: false,\n    status: null, // null, 'checking', 'found-local', 'found-ares', 'not-found'\n    data: null,\n    isOperation: false\n  });\n\n  //  SPRINT 4: Consolidated Save Progress State (31 hook)\n  const [saveProgressState, setSaveProgressState] = useState({\n    show: false,\n    progress: 0,\n    text: ''\n  });\n\n  //  State pro odemykn FZE 3 SEKC (Dodavatel  Stav odesln)\n  //  POZNMKA: Financovn je soust FZE 1-2, ne FZE 3!\n  const [isPhase3SectionsLocked, setIsPhase3SectionsLocked] = useState(false);\n  const [isPhase3SectionsUnlocked, setIsPhase3SectionsUnlocked] = useState(false); // Vchoz stav - zameno\n  const [isPhase3SectionsLockProcessedFromDB, setIsPhase3SectionsLockProcessedFromDB] = useState(false); // Flag e zamen bylo zpracovno pi naten z DB\n\n  //  State pro modal potvrzen finann kontroly ped dokonenm objednvky\n  const [showFinancialControlConfirmation, setShowFinancialControlConfirmation] = useState(false);\n  const [financialControlConfirmed, setFinancialControlConfirmed] = useState(false);\n  const [pendingSaveData, setPendingSaveData] = useState(null); // Data pro odloen uloen po potvrzen\n\n  // State pro sledovn stavu sbalen/rozbalen sekc\n  const [areSectionsCollapsed, setAreSectionsCollapsed] = useState(false);\n\n  //  SPRINT 4: Consolidated Supplier Dialog State (31 hook)\n  const [supplierDialog, setSupplierDialog] = useState({\n    showAddDialog: false,\n    existingCheck: null, // Vsledek detekce dodavatele v DB\n    autoFillSource: null // Zdroj automatickho vyplnn dodavatele (local/ares/smlouva)\n  });\n\n  //  SPRINT 4: Consolidated DOCX Modal State (21 hook)\n  const [docxModal, setDocxModal] = useState({\n    open: false,\n    orderData: null\n  });\n\n  //  SPRINT 4: Consolidated Loading State (51 hook)\n  const [loadingState, setLoadingState] = useState({\n    ciselniky: true, // Natn selnk (selecty, dropdown options)\n    formData: false, // Natn dat formule (editace objednvky)\n    initializing: true, // Celkov loading stav pro inicializaci\n    initialized: false, //  Flag pro dokonenou inicializaci\n    error: null // Chyba pi inicializaci\n  });\n\n  //  isEditMode - persistuje v localStorage pro sprvn MenuBar zobrazen\n  // NIKDY se nesm ztratit po F5 refresh!\n  const [isEditMode, setIsEditMode] = useState(() => {\n    try {\n      //  Nast z DraftManager\n      const metadata = draftManager.getMetadata();\n\n      if (metadata && metadata.isEditMode === true) {\n        //  PIDAT: Nast i formData.id pi inicializaci\n        if (metadata.editOrderId || metadata.formData.id) {\n          const orderId = metadata.editOrderId || metadata.formData.id;\n          // Poznmka: setSavedOrderId nelze volat zde (useState init),\n          // take to udlme v useEffect ne\n        }\n\n        return true;\n      }\n      return false;\n    } catch {\n      return false;\n    }\n  });\n\n  //  Nast seky z API pro ARES scope selector\n  useEffect(() => {\n    const loadUseky = async () => {\n      if (!token || !username) return;\n\n      setUsekyLoading(true);\n      try {\n        const usekyData = await fetchUskyList({ token, username });\n        setAvailableUseky(usekyData || []);\n      } catch (error) {\n        setAvailableUseky([]);\n      } finally {\n        setUsekyLoading(false);\n      }\n    };\n\n    loadUseky();\n  }, [token, username]);\n\n  //  Nast formData.id z metadata pi mount (nelze v useState init)\n  useEffect(() => {\n    if (!user_id) return;\n\n    try {\n      const metadata = draftManager.getMetadata();\n\n      if (metadata && metadata.isEditMode === true) {\n        // NOTE: setSavedOrderId removed - formData.id is single source of truth\n        // Metadata is used only for editOrderId initialization\n      }\n    } catch (error) {\n    }\n  }, [user_id]);\n\n  //  Uloit isEditMode pes DraftManager pi kad zmn\n  useEffect(() => {\n    if (user_id) {\n      try {\n        draftManager.saveMetadata({ isEditMode });\n      } catch (error) {\n      }\n    }\n  }, [isEditMode, user_id]);\n\n  //  Ukldat scroll pozici pi scrollovn\n  useEffect(() => {\n    if (!user_id) return;\n\n    let scrollTimeout;\n    const handleScroll = (e) => {\n      // Debounce - ukldej a po 500ms neinnosti\n      clearTimeout(scrollTimeout);\n      //  ZRUENO: Ukldn scroll pozice (na dost uivatele)\n      // scrollTimeout = setTimeout(() => {\n      //   try {\n      //     const scrollContainer = scrollableContentRef.current;\n      //     const scrollPosition = scrollContainer ? scrollContainer.scrollTop : (window.pageYOffset || document.documentElement.scrollTop);\n      //     draftManager.saveMetadata({ scrollPosition });\n      //     // console.log(' [Scroll] Uloena pozice:', scrollPosition);\n      //   } catch (error) {\n      //     console.error(' [Scroll] Chyba pi ukldn pozice:', error);\n      //   }\n      // }, 500);\n    };\n\n    // Pipoj listener pmo na ref element\n    const scrollContainer = scrollableContentRef.current;\n    if (scrollContainer) {\n      scrollContainer.addEventListener('scroll', handleScroll);\n    } else {\n      // Fallback na window scroll\n      window.addEventListener('scroll', handleScroll);\n    }\n\n    return () => {\n      clearTimeout(scrollTimeout);\n      if (scrollContainer) {\n        scrollContainer.removeEventListener('scroll', handleScroll);\n      } else {\n        window.removeEventListener('scroll', handleScroll);\n      }\n    };\n  }, [user_id]);\n\n  // Cache pro naten uivatele z DB (pro getUserNameById)\n  const [userNamesCache, setUserNamesCache] = useState({});\n\n  //  CENTRALIZOVAN WORKFLOW MANAGER - PESUNUT PO DEFINICI formData\n  // (Nyn ne v kdu, po useState formData)\n\n  // Helper funkce pro prci s workflow stavy (modifikace)\n  const addWorkflowState = (currentStates, newState) => {\n    const states = parseWorkflowStates(currentStates);\n    if (!states.includes(newState)) {\n      states.push(newState);\n    }\n    return JSON.stringify(states);\n  };\n\n  const removeWorkflowState = (currentStates, stateToRemove) => {\n    const states = parseWorkflowStates(currentStates);\n    const filtered = states.filter(s => s !== stateToRemove);\n    return JSON.stringify(filtered);\n  };\n\n  // Helper funkce pro zskn textu stavu objednvky z DB\n  const getOrderStatusInfo = () => {\n    // Mapovn stav na esk texty a detaily\n    const statusMapping = {\n      'NOVA': {\n        text: isChanged ? 'Koncept' : 'Nov objednvka',\n        icon: '',\n        type: 'info',\n        description: 'Objednvka je v pprav'\n      },\n      'ODESLANA_KE_SCHVALENI': {\n        text: 'Odeslno ke schvlen',\n        icon: '',\n        type: 'warning',\n        description: 'Objednvka ek na schvlen pslunm schvalovatelem'\n      },\n      'SCHVALENA': {\n        text: 'Schvlen objednvka',\n        icon: '',\n        type: 'success',\n        description: 'Objednvka byla schvlena a je pipravena k dalm krokm'\n      },\n      'ZAMITNUTA': {\n        text: 'Zamtnut objednvka',\n        icon: '',\n        type: 'error',\n        description: 'Objednvka byla zamtnuta'\n      },\n      'NESCHVALENA': {\n        text: 'Neschvlen objednvka',\n        icon: '',\n        type: 'error',\n        description: 'Objednvka nebyla schvlena'\n      },\n      'CEKA_SE': {\n        text: 'ek se na rozhodnut',\n        icon: '',\n        type: 'warning',\n        description: 'ek se na dal kroky'\n      },\n      'ROZPRACOVANA': {\n        text: 'Rozpracovan objednvka',\n        icon: '',\n        type: 'info',\n        description: 'Objednvka se zpracovv'\n      },\n      'ODESLANA': {\n        text: 'Odeslno dodavateli',\n        icon: '',\n        type: 'info',\n        description: 'Objednvka byla odeslna dodavateli'\n      },\n      'POTVRZENA': {\n        text: 'Potvrzeno dodavatelem',\n        icon: '',\n        type: 'success',\n        description: 'Dodavatel potvrdil objednvku'\n      },\n      'DOKONCENA': {\n        text: 'Dokonen objednvky',\n        icon: '',\n        type: 'success',\n        description: 'Objednvka byla spn dokonena'\n      },\n      'ZRUSENA': {\n        text: 'Stornovan objednvka',\n        icon: '',\n        type: 'error',\n        description: 'Objednvka byla stornovna'\n      }\n    };\n\n    // Zskej aktuln stav z workflow\n    const currentStates = parseWorkflowStates(formData.stav_workflow_kod);\n    const latestState = currentStates[currentStates.length - 1];\n\n    // Pokud existuje stav_objednavky, preferuj ho\n    if (formData.stav_objednavky) {\n      // Najdi stav podle nzvu\n      const foundState = Object.entries(statusMapping).find(([key, info]) =>\n        info.text === formData.stav_objednavky ||\n        key === formData.stav_objednavky\n      );\n\n      if (foundState) {\n        return {\n          ...foundState[1],\n          code: foundState[0],\n          hasReason: !!formData.schvaleni_komentar,\n          reason: formData.schvaleni_komentar,\n          dateApproved: formData.dt_schvaleni\n        };\n      }\n    }\n\n    // Fallback na workflow stav\n    const statusInfo = statusMapping[latestState] || statusMapping['NOVA'];\n\n    return {\n      ...statusInfo,\n      code: latestState,\n      hasReason: !!formData.schvaleni_komentar,\n      reason: formData.schvaleni_komentar,\n      dateApproved: formData.dt_schvaleni\n    };\n  };\n\n  //  Fzovn objednvky (8 fz podle workflow)\n  // FZE 1/8: NOVA - Vytvoen konceptu\n  // FZE 2/8: ODESLANA_KE_SCHVALENI - ek na schvlen\n  // FZE 3/8: SCHVALENA + ROZPRACOVANA - Schvlen, rozpracovan\n  // FZE 4/8: ODESLANA + POTVRZENA - Potvrzen dodavatele + checkbox \"M bt zveejnna\"\n  // FZE 5/8: UVEREJNIT - Vyplnn registru smluv (datum + IDDT) [VOLITELN - pouze kdy ANO]\n  // FZE 6/8: UVEREJNENA / NEUVEREJNIT / FAKTURACE - Fakturace\n  // FZE 7/8: VECNA_SPRAVNOST - Kontrola vcn sprvnosti\n  // FZE 8/8: ZKONTROLOVANA  zobraz sekci Dokonen  pid DOKONCENA a proces kon\n\n  const [formData, _setFormData] = useState({\n    // Informace o objednateli (nateno z userDetail)\n    objednatel_id: '', // z databze uivatel\n    uzivatel_id: '', // souasn uivatel (vytvoil objednvku)\n    garant_uzivatel_id: '', // garant objednvky\n    prikazce_id: '', // pkazce objednvky (dve po_uzivatel)\n    jmeno: '', // nateno z userDetail\n    email: '', // nateno z userDetail\n    telefon: '', // nateno z userDetail\n\n    // Schvlen nkupu PO\n    predmet: '',\n    strediska_kod: [], // Zmnno na pole pro multi-select\n    max_cena_s_dph: '',\n    popis_pozadavku: '', // Podrobn popis poadavku\n    mimoradna_udalost: false, // Mimodn udlost (krize, havrie)\n\n    // Workflow system - pouv nov konstanty\n    stav_workflow_kod: JSON.stringify(['NOVA']), //  Vchoz stav: NOVA (nov/koncept objednvka)\n    schvalovatel_id: '', // ID uivatele, kter schvlil/zamtl\n    dt_schvaleni: '', // Datum schvlen/zamtnut\n    schvaleni_komentar: '', // Koment/dvod schvlen i zamtnut\n\n    // === DAL ST - VIDITELN JEN PO SCHVLEN ===\n\n    // Financovn objednvky\n    zpusob_financovani: '',\n    financovani: '', // JSON pole pro uloen do DB\n    // Dynamick pole pro financovn\n    lp_kod: [], // LP kdy pro Limitovan pslib (multiselect)\n    cislo_smlouvy: '', // slo smlouvy pro Smlouva\n    smlouva_poznamka: '', // Poznmka ke smlouv\n    individualni_schvaleni: '', // Identifiktor pro Individuln schvlen\n    individualni_poznamka: '', // Poznmka pro Individuln schvlen\n    pojistna_udalost_cislo: '', // slo pojistn udlosti\n    pojistna_udalost_poznamka: '', // Poznmka k pojistn udlosti\n\n    // Informace o dodavateli\n    dodavatel_id: '',\n    dodavatel_nazev: '',\n    dodavatel_adresa: '',\n    dodavatel_ico: '',\n    dodavatel_dic: '',\n    dodavatel_zastoupeny: '',\n\n    // Kontaktn osoba dodavatele\n    dodavatel_kontakt_jmeno: '',\n    dodavatel_kontakt_email: '',\n    dodavatel_kontakt_telefon: '',\n\n    // Detaily objednvky\n    druh_objednavky: '',\n    druh_objednavky_kod: '', // Sprvn pole pro databzi\n    polozky_objednavky: [], // Poloky se inicializuj v useEffect\n    faktury: [], // Faktury se natou s objednvkou z BE\n    poznamka_objednavky: '',\n\n    // Dodac a zrun podmnky\n    dt_predpokladany_termin_dodani: '',\n    misto_dodani: '',\n    zaruka: '',\n\n    // Stav odesln objednvky\n    stav_odeslano: false, // FZE 3: checkbox \"Odeslno\"\n    datum_odeslani: '',\n    stav_stornovano: false, // FZE 3: checkbox \"Stornovno\"\n    datum_storna: '',\n    storno_uzivatel_id: '', // ID uivatele, kter provedl storno\n    odeslani_storno_duvod: '', // DB pole pro dvod storna\n    storno_provedl: '',\n    storno_poznamky: '',\n\n    // Potvrzen objednvky od dodavatele - struktura JSON pro DB\n    dodavatel_zpusob_potvrzeni: {\n      potvrzeni: 'NE', // 'ANO' nebo 'NE'\n      zpusoby: [], // pole zpsob: 'email', 'telefon', 'podepsana_objednavka', 'eshop'\n      platba: 'faktura' // vdy faktura (pevn nastaveno)\n    },\n    dt_akceptace: '',\n\n    // Registr smluv\n    dt_zverejneni: '',\n    registr_iddt: '',\n    ma_byt_zverejnena: false,\n\n    // === FZE 3: SEKCE PO ODESLN OBJEDNVKY ===\n\n    // Prbh objednvky\n    stav_u_dodavatele: '', // 'potvrzeno', 've_vyrobe', 'pripraveno', 'odeslano', 'doruceno', 'stornovno'\n    datum_zmeny_stavu: '',\n    poznamka_stav: '',\n\n    // Dodac informace\n    cislo_zasilky: '',\n    prepravce: '',\n    ocekavane_doruceni: '',\n    skutecne_doruceni: '',\n\n    // Fakturace\n    cislo_faktury: '',\n    datum_faktury: '',\n    castka_bez_dph: '',\n    castka_s_dph: '',\n    datum_splatnosti: '',\n    datum_zaplaceni: '',\n    faktury_objednavky: [], //  Faktury k objednvce - ukldaj se do konceptu\n\n    //  Vcn sprvnost - FZE 7 ODSTRANNA - refaktorovno na per-invoice\n    // vecna_spravnost_umisteni_majetku: '', \n    // vecna_spravnost_poznamka: '',\n    // vecna_spravnost_potvrzeno: 0,\n\n    // Dokonen objednvky - FZE 8\n    potvrzeni_dokonceni_objednavky: 0, // ANO/NE checkbox (0/1) - finln potvrzen\n\n    // Plohy k objednvce\n    prilohy_dokumenty: [],\n\n    // Evidenn slo objednvky (nateno z API)\n    ev_cislo: '',\n\n    // Doasn datum objednvky pro koncepty (generuje se na FE, pepe se pi prvnm uloen na BE)\n    temp_datum_objednavky: new Date().toISOString().split('T')[0], //  OPRAVA: Nastavit ihned pi inicializaci\n\n    // Datum vytvoen objednvky (nastavuje se a pi uloen do DB)\n    datum_vytvoreni: ''\n  });\n\n  //  DEBUG: Interceptor pro setFormData - trackuje vechna voln\n  const setFormData = useCallback((newData) => {\n    const stack = new Error().stack;\n    const caller = stack.split('\\n')[2]?.trim() || 'unknown';\n\n    if (typeof newData === 'function') {\n      _setFormData(prev => {\n        const result = newData(prev);\n        // DEBUG: FORMDATA UPDATE logging removed for performance\n        return result;\n      });\n    } else {\n      _setFormData(newData);\n    }\n  }, []);\n\n  //  Registrace aktivn objednvky (pro detekci konfliktu v InvoiceEvidencePage)\n  useEffect(() => {\n    if (formData.id) {\n      window.__activeOrderFormId = formData.id;\n      window.__activeOrderFormEvCislo = formData.cislo_objednavky || formData.ev_cislo || `#${formData.id}`;\n    }\n    \n    return () => {\n      delete window.__activeOrderFormId;\n      delete window.__activeOrderFormEvCislo;\n    };\n  }, [formData.id, formData.cislo_objednavky, formData.ev_cislo]);\n\n  //  LocalStorage obnoven neuloench ploh (mus bt A PO formData definici)\n  useEffect(() => {\n    const restoreUnsavedAttachments = () => {\n      try {\n        const storageKey = `unsaved_attachments_${formData.id || 'draft'}`;\n        const savedAttachmentsStr = localStorage.getItem(storageKey);\n        \n        if (savedAttachmentsStr) {\n          const savedAttachments = JSON.parse(savedAttachmentsStr);\n          \n          if (savedAttachments.length > 0) {\n            addDebugLog('info', 'ATTACHMENTS', 'restore-from-ls',\n              `Nalezeno ${savedAttachments.length} neuloench ploh v LocalStorage`);\n            \n            // Zobrazit upozornn uivateli\n            showToast && showToast(\n              ` Nalezeny neuloen plohy z pedchoz session!\\n\\n` +\n              ` Obnoveno ${savedAttachments.length} ploh.\\n` +\n              ` Soubory bude nutn znovu vybrat a nahrt.`, \n              { \n                type: 'info', \n                timeout: 8000,\n                action: {\n                  confirmText: 'Obnovit plohy',\n                  cancelText: 'Smazat',\n                  onConfirm: () => {\n                    // Obnovit plohy bez file objekt (budou oznaeny pro novou selekci)\n                    const restoredAttachments = savedAttachments.map(att => ({\n                      ...att,\n                      status: 'needs_reselection',\n                      file: null,\n                      uploadError: 'Soubor je nutn znovu vybrat'\n                    }));\n                    \n                    setAttachments(prev => [...prev, ...restoredAttachments]);\n                    \n                    addDebugLog('success', 'ATTACHMENTS', 'restored-from-ls',\n                      `Obnoveno ${restoredAttachments.length} ploh z LocalStorage`);\n                  },\n                  onCancel: () => {\n                    // Smazat z LocalStorage\n                    localStorage.removeItem(storageKey);\n                    addDebugLog('info', 'ATTACHMENTS', 'cleared-ls',\n                      'LocalStorage plohy smazny na dost uivatele');\n                  }\n                }\n              }\n            );\n          }\n        }\n      } catch (error) {\n        addDebugLog('error', 'ATTACHMENTS', 'restore-from-ls-error', error.message);\n      }\n    };\n\n    // Obnovit pouze pokud mme user_id a formData je naten\n    if (user_id && formData) {\n      restoreUnsavedAttachments();\n    }\n  }, [user_id, formData.id]); // Trigger pi zmn user_id nebo order ID\n\n  //  SNAPSHOT pvodnho stavu formule pro detekci zmn\n  const originalFormDataRef = useRef(null);\n\n  //  Detekce zmn v objednvce - porovnv aktuln stav s pvodnm snapshotem\n  const hasUnsavedChanges = useMemo(() => {\n    if (!originalFormDataRef.current || !formData.id) {\n      return false; // Nov objednvka nebo snapshot jet nen vytvoen\n    }\n\n    // Porovnn klovch pol formule\n    const original = originalFormDataRef.current;\n    \n    // Pole kter budeme porovnvat\n    const fieldsToCompare = [\n      'predmet', 'max_cena_s_dph', 'popis_pozadavku',\n      'zpusob_financovani', 'dodavatel_nazev', 'dodavatel_ico',\n      'druh_objednavky_kod', 'poznamka_objednavky',\n      'dt_predpokladany_termin_dodani', 'misto_dodani', 'zaruka'\n    ];\n\n    // Kontrola zkladnch pol\n    for (const field of fieldsToCompare) {\n      if (original[field] !== formData[field]) {\n        return true;\n      }\n    }\n\n    // Kontrola pole poloek objednvky\n    const originalPolozky = original.polozky_objednavky || [];\n    const currentPolozky = formData.polozky_objednavky || [];\n    \n    if (originalPolozky.length !== currentPolozky.length) {\n      return true;\n    }\n\n    // Porovnn jednotlivch poloek\n    for (let i = 0; i < originalPolozky.length; i++) {\n      const origItem = originalPolozky[i];\n      const currItem = currentPolozky[i];\n      \n      if (origItem.popis !== currItem.popis ||\n          origItem.mnozstvi !== currItem.mnozstvi ||\n          origItem.cena_jednotkova !== currItem.cena_jednotkova) {\n        return true;\n      }\n    }\n\n    return false;\n  }, [formData]);\n\n  // CENTRALIZOVANY WORKFLOW MANAGER\n  // Poskytuje jednotnou logiku pro workflow (eliminuje duplicity)\n  // MUSI byt AZ PO useState(formData), protoze potrebuje formData jako zavislost\n  // JEDINA PROMENNA pro archivovane objednavky\n  const isArchived = useMemo(() => {\n    return formData.stav_objednavky === 'ARCHIVOVANO' ||\n           formData.stav_objednavky === 'Archivovno';\n  }, [formData.stav_objednavky]);\n\n  const workflowManager = useWorkflowManager(formData, isArchived);\n\n  // Rozbalen API pro snadnj pouit\n  const {\n    currentPhase,\n    phaseTheme: currentPhaseTheme,\n    phaseProgress,\n    mainWorkflowState,\n    getCurrentPhase,\n    getPhaseProgress,\n    getPhaseTheme,\n    parseWorkflowStates,\n    hasWorkflowState,\n    //  Payment mode detection\n    isPokladna,\n    //  Workflow locking states z WorkflowManager\n    isWorkflowCompleted, //  TRUE pro DOKONCENA, ZAMITNUTA, ZRUSENA (vechny konen stavy workflow)\n    isWorkflowRejected,\n    isWorkflowCancelled,\n    //  Force refresh API\n    forceRefresh: workflowForceRefresh,\n    //  Section state API\n    getSectionState\n  } = workflowManager;\n\n  //  NOTE: formData.id removed - using formData.id directly as single source of truth\n\n  //  [WORKFLOW MANAGER] Logovn zmny fze - DISABLED to prevent infinite loop\n  // useEffect(() => {\n  //   if formData.id {\n  //   }\n  // }, [currentPhase, currentPhaseTheme, mainWorkflowState, formData.id, formData.id]);\n\n  // Uren zda je to nov objednvka - odvozeno z formData.id (single source of truth)\n  const isNewOrder = useMemo(() => !formData.id, [formData.id]);\n\n  //  COMPUTED: Detekce archivovan objednvky\n  // Flag kter indikuje, e pracujeme s archivovanou objednvkou\n  const isArchivedOrder = isArchived;\n\n  // Pro archivovan objednvky nastavit fzi na maximum (8)\n  // POZNMKA: currentPhase u je 8 pro archivovan dky logice v useWorkflowManager\n  const currentPhaseOverride = currentPhase;\n\n  //  OVERRIDE: Pro archivovan objednvky zobrazit vechny fze jako dokonen\n  const phaseProgressOverride = useMemo(() => {\n    if (!isArchivedOrder) {\n      return phaseProgress; // Bn objednvka - pouij originln progress\n    }\n\n    // Archivovan objednvka - vechny fze completed\n    return {\n      ...phaseProgress,\n      phases: phaseProgress.phases.map(phase => ({\n        ...phase,\n        isVisible: true,\n        fillClass: 'completed' // Vechny fze jako dokonen\n      }))\n    };\n  }, [isArchivedOrder, phaseProgress]);\n\n  //  Flag pro zmny proti DB - d prioritu koncept vs DB\n  const [isChanged, setIsChanged] = useState(false);\n  \n  //  Sleduje zda u probhlo naten draftu\n  const [isDraftLoaded, setIsDraftLoaded] = useState(false);\n\n  //  [CENTRLN SPRVCE STAVU MENUBARU]\n  // Jedno msto pro inicializaci, update a deinicializaci - HOTOVO, KONEC!\n  \n  // Centrln funkce pro broadcast stavu\n  const broadcastMenuBarState = useCallback((state) => {\n    const fullState = {\n      isEditMode: state.isEditMode ?? isEditMode,\n      isNewOrder: state.isNewOrder ?? !isEditMode,\n      orderId: state.orderId ?? formData.id,\n      orderNumber: state.orderNumber ?? (formData.cislo_objednavky || formData.ev_cislo),\n      currentPhase: state.currentPhase ?? currentPhase,\n      mainWorkflowState: state.mainWorkflowState ?? mainWorkflowState,\n      hasDraft: state.hasDraft ?? (isChanged || isDraftLoaded),\n      timestamp: Date.now()\n    };\n    \n    window.__orderFormState = fullState;\n    window.dispatchEvent(new CustomEvent('orderFormStateChange', { detail: fullState }));\n    \n    return fullState;\n  }, [isEditMode, formData.id, formData.cislo_objednavky, formData.ev_cislo, currentPhase, mainWorkflowState, isChanged, isDraftLoaded]);\n  \n  // Ref pro pstup z async funkc\n  const broadcastMenuBarStateRef = useRef(broadcastMenuBarState);\n  useEffect(() => {\n    broadcastMenuBarStateRef.current = broadcastMenuBarState;\n  }, [broadcastMenuBarState]);\n  \n  // Helper pro voln z async funkc\n  const broadcastOrderState = (overrides) => {\n    return broadcastMenuBarStateRef.current(overrides);\n  };\n  \n  //  SYNCHRONN BROADCAST MenuBaru - reaguje OKAMIT na zmny\n  useEffect(() => {\n    // ekat dokud nen isDraftLoaded = skuten nateno\n    if (!isDraftLoaded) return;\n    \n    //  URIT STAV podle formData.id a editOrderId (SINGLE SOURCE OF TRUTH)\n    const hasRealId = !!formData.id; // DB ID = skuten objednvka v databzi\n    const hasEditIntent = !!editOrderId; // URL parametr edit=123 = editan zmr\n    \n    //  JEDNOZNAN LOGIKA:\n    // 1. M DB ID (formData.id)  EDITACE (nezle na editOrderId)\n    // 2. Nem DB ID, ale m zmny (isChanged)  KONCEPT\n    // 3. Nem DB ID ani zmny  NOV\n    \n    let menuBarState = 'NOVA'; // Default\n    \n    if (hasRealId) {\n      // M DB ID  EDITACE\n      menuBarState = 'EDITACE';\n    } else if (isChanged || hasEditIntent) {\n      // Nem DB ID, ale m zmny nebo editan zmr  KONCEPT\n      menuBarState = 'KONCEPT';\n    }\n    \n    //  POSLAT BROADCAST s jednoznanm stavem\n    const state = {\n      isEditMode: menuBarState === 'EDITACE',\n      isNewOrder: menuBarState === 'NOVA',\n      orderId: hasRealId ? formData.id : null,\n      orderNumber: formData.cislo_objednavky || formData.ev_cislo || '',\n      currentPhase,\n      mainWorkflowState,\n      hasDraft: menuBarState === 'KONCEPT' || menuBarState === 'EDITACE',\n      timestamp: Date.now()\n    };\n    \n    window.__orderFormState = state;\n    window.dispatchEvent(new CustomEvent('orderFormStateChange', { detail: state }));\n    \n    //  DEINICIALIZACE pi unmount - zruit vechny ID a nastavit \"dn objednvka\"\n    return () => {\n      window.__orderFormState = {\n        isEditMode: false,\n        isNewOrder: false,\n        orderId: null,\n        orderNumber: '',\n        currentPhase: 1,\n        mainWorkflowState: 'NOVA',\n        hasDraft: false,\n        timestamp: Date.now()\n      };\n      window.dispatchEvent(new CustomEvent('orderFormStateChange', { detail: window.__orderFormState }));\n    };\n  }, [isDraftLoaded, formData.id, formData.cislo_objednavky, formData.ev_cislo, currentPhase, mainWorkflowState, isChanged, editOrderId]); //  Reaguje na vechny relevantn zmny!\n\n  //  SPRINT 4: Consolidated Save State (61 hook)\n  const [saveState, setSaveState] = useState({\n    saving: false,\n    savingDraft: false,\n    disableAutosave: false, //  ZAKZAT autosave po spnm uloen\n    lastAutoSave: null,\n    autoSaving: false,\n    dataSource: null // 'concept', 'database', null\n  });\n  const disableAutosaveRef = useRef(false); //  REF pro OKAMITOU kontrolu (bez async delay)\n  const autoSaveTimerRef = useRef(null); //  Timer pro debounce autosave pi psan\n  \n  //  KRITICK FLAG: Globln blokovn VECH save operac pi zavrn\n  const isClosingRef = useRef(false);\n\n  //  CENTRALIZOVAN AUTOSAVE s debounce logikou (3 sekundy neaktivity)\n  const autosaveCallbackRef = useRef(null);\n\n  // Pomocn funkce pro saveDraft - bude nastavena pozdji\n  const performSaveDraft = useCallback((isAutoSave) => {\n    if (autosaveCallbackRef.current) {\n      autosaveCallbackRef.current(isAutoSave);\n    }\n  }, []);\n  \n  //  AUTOSAVE HOOK - Defined early to be accessible throughout the component\n  // Uses saveState directly instead of aliases to avoid initialization order issues\n  const { triggerAutosave, cancelAutosave } = useAutosave(performSaveDraft, {\n    delay: 3000, // 3 sekundy neaktivity\n    enabled: !saveState.disableAutosave && isDraftLoaded,\n    dependencies: [saveState.disableAutosave, isDraftLoaded, formData.faktury]\n  });\n  \n  //  POZOR: Hlasov rozpoznvn je implementovno GLOBLN v Layout.js\n  // OrderForm25 NEPOUV vlastn hook, protoe by to zpsobovalo konflikty\n  // Pokud uivatel chce nahrvat do poznmky formule:\n  //   1. Fokusne textarea poznmky\n  //   2. Zmkne CTRL+Space\n  //   3. Text se vlo pmo do textarea (dky logice v hooku)\n\n  // NOTE: sourceOrderIdForUnlock removed - using formData.id directly\n\n  // Stav pro cancel confirm modal\n  const [showCancelConfirmModal, setShowCancelConfirmModal] = useState(false);\n  const [cancelWarningMessage, setCancelWarningMessage] = useState('');\n\n  //  SPRINT 4: Consolidated Template State (131 hook)\n  const [templateState, setTemplateState] = useState({\n    saved: [], // [{ name, data, ts }]\n    server: [], // array of { name, data, ts, type, id, user_id }\n    fetchStatus: { status: null, error: null },\n    loading: false,\n    showSaveModal: false,\n    name: '',\n    type: 'po', // 'po', 'details', 'mixed'\n    saveChecked: false,\n    saveMode: 'new', // 'new', 'update', 'merge'\n    selectedTarget: null, // cel template objekt\n    selectedTargetTs: null,\n    showDeleteConfirm: false,\n    pendingDelete: null\n  });\n\n  //  SPRINT 4: Consolidated Unlock Confirm Dialogs (91 hook)\n  const [unlockDialogs, setUnlockDialogs] = useState({\n    phase1: false,\n    phase2: false,\n    phase3: false,\n    registr: false,\n    potvrzeni: false,\n    cancelPublish: false, // Confirm pro zruen zveejnn\n    fakturace: false,\n    dokonceni: false,\n    storno: false\n  });\n\n  //  SPRINT 4: Consolidated Faktury (Invoice) State (41 hook)\n  const [fakturyState, setFakturyState] = useState({\n    loading: false,\n    showAddForm: false,\n    editing: null, // Faktura being edited\n    formData: {\n      fa_datum_doruceni: formatDateForPicker(new Date()), //  Sprvn pole pro datum\n      fa_dorucena: 1, //  Boolean flag (0/1)\n      fa_castka: '',\n      fa_cislo_vema: '',\n      fa_strediska_kod: [], //  Sprvn nzev pole pro stediska\n      fa_poznamka: '',\n      fa_splatnost: ''\n    }\n  });\n\n  //  LP ERPN NA FAKTURCH - state pro kadou fakturu\n  // Struktura: { [fakturaId]: { lpCerpani: [...], loaded: boolean } }\n  const [fakturyLPCerpani, setFakturyLPCerpani] = useState({});\n\n  //  PLOHY FAKTUR - u eeno samostatnou komponentou InvoiceAttachmentsCompact\n  // (star state promnn fakturaAttachments, uploadingFakturaFiles, draggingFakturaId, fakturaFileInputRefs odstranny)\n  //  REMOVED: fakturaTypyPrilohOptions a loadingFakturaTypyPriloh budou definovny a po dictionaries\n\n  //  Confirm dialog pro mazn faktury\n  const [deleteFacturaDialog, setDeleteFacturaDialog] = useState({\n    isOpen: false,\n    fakturaId: null,\n    fakturaNazev: '',\n    pocetPriloh: 0\n  });\n\n  //  Confirm dialog pro odemykn sekc (univerzln)\n  const [confirmDialog, setConfirmDialog] = useState({\n    isOpen: false,\n    title: '',\n    message: '',\n    onConfirm: null\n  });\n\n  //  SPRINT 5: Broadcast consolidated above (was 41 hook)\n\n  //  SPRINT 4: Consolidated Template UI State (71 hook)\n  const [templateUI, setTemplateUI] = useState({\n    actionsLog: [],\n    hoveredPreviewKey: null,\n    previewModalData: null, // {template, data}\n    editingId: null,\n    editingName: '',\n    showSearchPredefs: false,\n    searchPredefs: ''\n  });\n  const searchInputRef = useRef(null);\n\n  // Validan chyby - state pro oznaen ervench pol\n  const [validationErrors, setValidationErrors] = useState({});\n  const [hasTriedToSubmit, setHasTriedToSubmit] = useState(false);\n  \n\n\n  //  SPRINT 4: Consolidated LP (lokalizace) States (42 hooks)\n  const [lokalizacePanelStates, setLokalizacePanelStates] = useState({}); // Rozkldac panely u poloek\n  \n  const [lpState, setLpState] = useState({\n    options: [], // LP options pro dropdown v polokch objednvky\n    loading: false,\n    financovani: {} //  LP stavy z API (limit, erpno, zbv) - pro pesn zobrazen erpn\n  });\n\n  //  SPRINT 4: Backward Compatibility Aliases - ALL STATES (defined AFTER all useState declarations)\n  // This ensures no \"Cannot access before initialization\" errors\n  \n  // Supplier Search Aliases\n  const showSupplierSearchDialog = supplierSearch.showDialog;\n  const setShowSupplierSearchDialog = (val) => setSupplierSearch(s => ({...s, showDialog: val}));\n  const supplierSearchTerm = supplierSearch.searchTerm;\n  const setSupplierSearchTerm = (val) => setSupplierSearch(s => ({...s, searchTerm: val}));\n  const supplierSearchResults = supplierSearch.results;\n  const setSupplierSearchResults = (val) => setSupplierSearch(s => ({...s, results: val}));\n  const supplierSearchLoading = supplierSearch.loading;\n  const setSupplierSearchLoading = (val) => setSupplierSearch(s => ({...s, loading: val}));\n  const allSupplierContacts = supplierSearch.allContacts;\n  const setAllSupplierContacts = (val) => setSupplierSearch(s => ({...s, allContacts: val}));\n  \n  // ARES State Aliases\n  const aresPopupOpen = aresState.popupOpen;\n  const setAresPopupOpen = (val) => setAresState(s => ({...s, popupOpen: val}));\n  const aresSearch = aresState.search;\n  const setAresSearch = (val) => setAresState(s => ({...s, search: val}));\n  const aresResults = aresState.results;\n  const setAresResults = (val) => setAresState(s => ({...s, results: val}));\n  const loadingAres = aresState.loading;\n  const setLoadingAres = (val) => setAresState(s => ({...s, loading: val}));\n  const savingToLocal = aresState.savingToLocal;\n  const setSavingToLocal = (val) => setAresState(s => ({...s, savingToLocal: val}));\n  const aresScopeInfo = aresState.scopeInfo;\n  const setAresScopeInfo = (val) => setAresState(s => ({...s, scopeInfo: val}));\n  const aresSelectedScope = aresState.selectedScope;\n  const setAresSelectedScope = (val) => setAresState(s => ({...s, selectedScope: val}));\n  const aresSelectedUseky = aresState.selectedUseky;\n  const setAresSelectedUseky = (val) => setAresState(s => ({...s, selectedUseky: val}));\n  \n  // Useky State Aliases\n  const availableUseky = usekyState.available;\n  const setAvailableUseky = (val) => setUsekyState(s => ({...s, available: val}));\n  const usekyLoading = usekyState.loading;\n  const setUsekyLoading = (val) => setUsekyState(s => ({...s, loading: val}));\n  \n  // ICO Check State Aliases\n  const showIcoCheck = icoCheckState.show;\n  const setShowIcoCheck = (val) => setIcoCheckState(s => ({...s, show: val}));\n  const icoCheckStatus = icoCheckState.status;\n  const setIcoCheckStatus = (val) => setIcoCheckState(s => ({...s, status: val}));\n  const icoCheckData = icoCheckState.data;\n  const setIcoCheckData = (val) => setIcoCheckState(s => ({...s, data: val}));\n  const isIcoOperation = icoCheckState.isOperation;\n  const setIsIcoOperation = (val) => setIcoCheckState(s => ({...s, isOperation: val}));\n  \n  // Save Progress State Aliases\n  const showSaveProgress = saveProgressState.show;\n  const setShowSaveProgress = (val) => setSaveProgressState(s => ({...s, show: val}));\n  const saveProgress = saveProgressState.progress;\n  const setSaveProgress = (val) => setSaveProgressState(s => ({...s, progress: val}));\n  const saveProgressText = saveProgressState.text;\n  const setSaveProgressText = (val) => setSaveProgressState(s => ({...s, text: val}));\n  \n  // Attachment UI Aliases\n  const uploadingFiles = attachmentUI.uploading;\n  const setUploadingFiles = (val) => setAttachmentUI(s => ({...s, uploading: val}));\n  const dragOver = attachmentUI.dragOver;\n  const setDragOver = (val) => setAttachmentUI(s => ({...s, dragOver: val}));\n  const isCheckingSyncAttachments = attachmentUI.checkingSync;\n  const setIsCheckingSyncAttachments = (val) => setAttachmentUI(s => ({...s, checkingSync: val}));\n  const showDeleteAttachmentDialog = attachmentUI.showDeleteDialog;\n  const setShowDeleteAttachmentDialog = (val) => setAttachmentUI(s => ({...s, showDeleteDialog: val}));\n  const attachmentToDelete = attachmentUI.deleteTarget;\n  const setAttachmentToDelete = (val) => setAttachmentUI(s => ({...s, deleteTarget: val}));\n  const showDeleteAllAttachmentsDialog = attachmentUI.showDeleteAllDialog;\n  const setShowDeleteAllAttachmentsDialog = (val) => setAttachmentUI(s => ({...s, showDeleteAllDialog: val}));\n  \n  // Supplier Dialog Aliases\n  const showSupplierAddDialog = supplierDialog.showAddDialog;\n  const setShowSupplierAddDialog = (val) => setSupplierDialog(s => ({...s, showAddDialog: val}));\n  const existingSupplierCheck = supplierDialog.existingCheck;\n  const setExistingSupplierCheck = (val) => setSupplierDialog(s => ({...s, existingCheck: val}));\n  const supplierAutoFillSource = supplierDialog.autoFillSource;\n  const setSupplierAutoFillSource = (val) => setSupplierDialog(s => ({...s, autoFillSource: val}));\n  \n  // DOCX Modal Aliases\n  const docxModalOpen = docxModal.open;\n  const setDocxModalOpen = (val) => setDocxModal(s => ({...s, open: val}));\n  const docxModalOrder = docxModal.orderData;\n  const setDocxModalOrder = (val) => setDocxModal(s => ({...s, orderData: val}));\n  \n  // Loading State Aliases\n  const isLoadingCiselniky = loadingState.ciselniky;\n  const setIsLoadingCiselniky = (val) => setLoadingState(s => ({...s, ciselniky: val}));\n  const isLoadingFormData = loadingState.formData;\n  const setIsLoadingFormData = (val) => setLoadingState(s => ({...s, formData: val}));\n  const isFormInitializing = loadingState.initializing;\n  const setIsFormInitializing = (val) => setLoadingState(s => ({...s, initializing: val}));\n  const isInitialized = loadingState.initialized;\n  const setIsInitialized = (val) => setLoadingState(s => ({...s, initialized: val}));\n  const initializationError = loadingState.error;\n  const setInitializationError = (val) => setLoadingState(s => ({...s, error: val}));\n  \n  // Save State Aliases\n  const isSaving = saveState.saving;\n  const setIsSaving = (val) => setSaveState(s => ({...s, saving: val}));\n  const isSavingDraft = saveState.savingDraft;\n  const setIsSavingDraft = (val) => setSaveState(s => ({...s, savingDraft: val}));\n  const disableAutosave = saveState.disableAutosave;\n  const setDisableAutosave = (val) => {\n    setSaveState(s => ({...s, disableAutosave: val}));\n    disableAutosaveRef.current = val; // Sync ref\n  };\n  const lastAutoSave = saveState.lastAutoSave;\n  const setLastAutoSave = (val) => setSaveState(s => ({...s, lastAutoSave: val}));\n  const isAutoSaving = saveState.autoSaving;\n  const setIsAutoSaving = (val) => setSaveState(s => ({...s, autoSaving: val}));\n  const dataSource = saveState.dataSource;\n  const setDataSource = (val) => setSaveState(s => ({...s, dataSource: val}));\n  \n  // LP Details Aliases\n  const lpDetails = lpDetailsState.details;\n  const setLpDetails = (val) => setLpDetailsState(s => ({...s, details: val}));\n  const loadingLpDetails = lpDetailsState.loading;\n  const setLoadingLpDetails = (val) => setLpDetailsState(s => ({...s, loading: val}));\n  \n  // Smlouvy (Contracts) Aliases\n  const smlouvyList = smlouvyState.list;\n  const setSmlouvyList = (val) => setSmlouvyState(s => ({...s, list: val}));\n  const loadingSmlouvyList = smlouvyState.loadingList;\n  const setLoadingSmlouvyList = (val) => setSmlouvyState(s => ({...s, loadingList: val}));\n  const smlouvaDetail = smlouvyState.detail;\n  const setSmlouvaDetail = (val) => setSmlouvyState(s => ({...s, detail: val}));\n  const loadingSmlouvaDetail = smlouvyState.loadingDetail;\n  const setLoadingSmlouvaDetail = (val) => setSmlouvyState(s => ({...s, loadingDetail: val}));\n  const smlouvaSearchTerm = smlouvyState.searchTerm;\n  const setSmlouvaSearchTerm = (val) => setSmlouvyState(s => ({...s, searchTerm: val}));\n  const showSmlouvySuggestions = smlouvyState.showSuggestions;\n  const setShowSmlouvySuggestions = (val) => setSmlouvyState(s => ({...s, showSuggestions: val}));\n  const selectedSmlouvaSuggestionIndex = smlouvyState.selectedSuggestionIndex;\n  const setSelectedSmlouvaSuggestionIndex = (val) => setSmlouvyState(s => ({...s, selectedSuggestionIndex: val}));\n  \n  // Template State Aliases\n  const savedTemplates = templateState.saved;\n  const setSavedTemplates = (val) => setTemplateState(s => ({...s, saved: val}));\n  const serverTemplates = templateState.server;\n  const setServerTemplates = (val) => setTemplateState(s => ({...s, server: val}));\n  const templatesFetchStatus = templateState.fetchStatus;\n  const setTemplatesFetchStatus = (val) => setTemplateState(s => ({...s, fetchStatus: val}));\n  const templatesLoading = templateState.loading;\n  const setTemplatesLoading = (val) => setTemplateState(s => ({...s, loading: val}));\n  const showTemplateSaveModal = templateState.showSaveModal;\n  const setShowTemplateSaveModal = (val) => setTemplateState(s => ({...s, showSaveModal: val}));\n  const templateName = templateState.name;\n  const setTemplateName = (val) => setTemplateState(s => ({...s, name: val}));\n  const templateType = templateState.type;\n  const setTemplateType = (val) => setTemplateState(s => ({...s, type: val}));\n  const templateSaveChecked = templateState.saveChecked;\n  const setTemplateSaveChecked = (val) => setTemplateState(s => ({...s, saveChecked: val}));\n  const saveMode = templateState.saveMode;\n  const setSaveMode = (val) => setTemplateState(s => ({...s, saveMode: val}));\n  const selectedTargetTemplate = templateState.selectedTarget;\n  const setSelectedTargetTemplate = (val) => setTemplateState(s => ({...s, selectedTarget: val}));\n  const selectedTargetTemplateTs = templateState.selectedTargetTs;\n  const setSelectedTargetTemplateTs = (val) => setTemplateState(s => ({...s, selectedTargetTs: val}));\n  const showDeleteTemplateConfirm = templateState.showDeleteConfirm;\n  const setShowDeleteTemplateConfirm = (val) => setTemplateState(s => ({...s, showDeleteConfirm: val}));\n  const templatePendingDelete = templateState.pendingDelete;\n  const setTemplatePendingDelete = (val) => setTemplateState(s => ({...s, pendingDelete: val}));\n  \n  // Unlock Dialogs Aliases\n  const showUnlockPhase1Confirm = unlockDialogs.phase1;\n  const setShowUnlockPhase1Confirm = (val) => setUnlockDialogs(s => ({...s, phase1: val}));\n  const showUnlockPhase2Confirm = unlockDialogs.phase2;\n  const setShowUnlockPhase2Confirm = (val) => setUnlockDialogs(s => ({...s, phase2: val}));\n  const showUnlockPhase3Confirm = unlockDialogs.phase3;\n  const setShowUnlockPhase3Confirm = (val) => setUnlockDialogs(s => ({...s, phase3: val}));\n  const showUnlockRegistrConfirm = unlockDialogs.registr;\n  const setShowUnlockRegistrConfirm = (val) => setUnlockDialogs(s => ({...s, registr: val}));\n  const showUnlockPotvrzeniConfirm = unlockDialogs.potvrzeni;\n  const setShowUnlockPotvrzeniConfirm = (val) => setUnlockDialogs(s => ({...s, potvrzeni: val}));\n  const showCancelPublishConfirm = unlockDialogs.cancelPublish;\n  const setShowCancelPublishConfirm = (val) => setUnlockDialogs(s => ({...s, cancelPublish: val}));\n  const showUnlockFakturaceConfirm = unlockDialogs.fakturace;\n  const setShowUnlockFakturaceConfirm = (val) => setUnlockDialogs(s => ({...s, fakturace: val}));\n  const showUnlockDokonceniConfirm = unlockDialogs.dokonceni;\n  const setShowUnlockDokonceniConfirm = (val) => setUnlockDialogs(s => ({...s, dokonceni: val}));\n  const showUnlockStornoConfirm = unlockDialogs.storno;\n  const setShowUnlockStornoConfirm = (val) => setUnlockDialogs(s => ({...s, storno: val}));\n  \n  // Faktury (Invoice) State Aliases\n  const fakturyLoading = fakturyState.loading;\n  const setFakturyLoading = (val) => setFakturyState(s => ({...s, loading: val}));\n  const showAddFakturaForm = fakturyState.showAddForm;\n  const setShowAddFakturaForm = (val) => setFakturyState(s => ({...s, showAddForm: val}));\n  const editingFaktura = fakturyState.editing;\n  const setEditingFaktura = (val) => setFakturyState(s => ({...s, editing: val}));\n  const fakturaFormData = fakturyState.formData;\n  const setFakturaFormData = (val) => setFakturyState(s => ({...s, formData: val}));\n  \n  // Template UI Aliases\n  const templateActionsLog = templateUI.actionsLog;\n  const setTemplateActionsLog = (val) => setTemplateUI(s => ({...s, actionsLog: val}));\n  const hoveredPreviewKey = templateUI.hoveredPreviewKey;\n  const setHoveredPreviewKey = (val) => setTemplateUI(s => ({...s, hoveredPreviewKey: val}));\n  const previewModalData = templateUI.previewModalData;\n  const setPreviewModalData = (val) => setTemplateUI(s => ({...s, previewModalData: val}));\n  const editingTemplateId = templateUI.editingId;\n  const setEditingTemplateId = (val) => setTemplateUI(s => ({...s, editingId: val}));\n  const editingTemplateName = templateUI.editingName;\n  const setEditingTemplateName = (val) => setTemplateUI(s => ({...s, editingName: val}));\n  const showSearchPredefs = templateUI.showSearchPredefs;\n  const setShowSearchPredefs = (val) => setTemplateUI(s => ({...s, showSearchPredefs: val}));\n  const searchPredefs = templateUI.searchPredefs;\n  const setSearchPredefs = (val) => setTemplateUI(s => ({...s, searchPredefs: val}));\n  \n  // LP State Aliases\n  const lpOptionsForItems = lpState.options;\n  const setLpOptionsForItems = (val) => setLpState(s => ({...s, options: val}));\n  const lpOptionsLoading = lpState.loading;\n  const setLpOptionsLoading = (val) => setLpState(s => ({...s, loading: val}));\n  const lpStavy = lpState.financovani;\n  const setLpStavy = (val) => setLpState(s => ({...s, financovani: val}));\n\n  //  LP options se nataj automaticky v enriched objednvce z backendu\n  // Viz handleDataLoaded() kde se extrahuj z response.lp_options\n  \n  //  Nast aktuln stavy LP z API kdy se zmn lpOptionsForItems\n  useEffect(() => {\n    if (!lpOptionsForItems || lpOptionsForItems.length === 0 || !token || !username) return;\n    \n    const loadLPStavy = async () => {\n      const stavy = {};\n      for (const lp of lpOptionsForItems) {\n        try {\n          const stav = await fetchLPDetail({ token, username, cislo_lp: lp.kod });\n          if (stav) {\n            stavy[lp.id] = {\n              limit: parseFloat(stav.celkovy_limit) || 0,\n              cerpano: parseFloat(stav.skutecne_cerpano) || 0,\n              zbyva: parseFloat(stav.zbyva_skutecne) || 0\n            };\n          }\n        } catch (error) {\n          console.warn(`Nelze nast stav LP ${lp.kod}:`, error.message);\n        }\n      }\n      setLpStavy(stavy);\n    };\n    \n    loadLPStavy();\n  }, [lpOptionsForItems, token, username]);\n\n  //  WORKFLOW TRACKING - VYPNUTO (zpsobovalo hluk v konzoli)\n  // useEffect(() => {\n  //   if (!formData.stav_workflow_kod) return;\n  //\n  //   const workflowStates = parseWorkflowStates(formData.stav_workflow_kod);\n  //   const phaseInfo = getPhaseProgressInternal(formData.stav_workflow_kod, false, !!formData.id);\n  //\n  //   addDebugLog('info', 'WORKFLOW', 'state-changed', {\n  //     phase: phaseInfo.currentPhase,\n  //     states: workflowStates,\n  //     orderId: formData.id || 'NEW',\n  //     orderNumber: formData.ev_cislo || formData.cislo_objednavky || 'N/A'\n  //   });\n  // }, [formData.stav_workflow_kod, formData.id]);\n\n  //  REMOVED: useEffect pro natn typ faktur - nyn se nat pes useDictionaries.loadAll()\n  // Typy faktur jsou nyn dostupn v dictionaries.data.typyFakturOptions (alias: fakturaTypyPrilohOptions)\n  // Loading stav je v dictionaries.loading.typyFaktur (alias: loadingFakturaTypyPriloh)\n  // Fallback pi chyb je een pmo v useDictionaries reducer\n\n  /**\n   *  Automatick doplnn dodavatele ze smlouvy\n   * Pouit: Pi naten objednvky ve fzi 3+ s financovnm \"Smlouva\"\n   * Priorita: 1) Lokln adres, 2) ARES, 3) Data ze smlouvy\n   * @param {Object} orderData - Data objednvky s cislo_smlouvy a zpusob_financovani\n   * @param {number} currentPhase - Aktuln fze objednvky\n   * @returns {Object|null} - Dodavatelsk data nebo null\n   */\n  const autoFillSupplierFromContract = useCallback(async (orderData, currentPhase) => {\n    try {\n      // 1 KONTROLA PODMNEK\n      // Spustit POUZE kdy:\n      // - Objednvka je SCHVLEN (ale jet nen ODESLAN) - stav po schvlen\n      // - NEBO je rozpracovan s financovnm Smlouva\n      const workflowStates = orderData.stav_workflow_kod ? \n        (typeof orderData.stav_workflow_kod === 'string' ? JSON.parse(orderData.stav_workflow_kod) : orderData.stav_workflow_kod) : [];\n      \n      const hasSchvalena = Array.isArray(workflowStates) && workflowStates.includes('SCHVALENA');\n      const hasOdeslana = Array.isArray(workflowStates) && workflowStates.includes('ODESLANA');\n      \n      // NEPOUVAT pro objednvky co jsou u ODESLAN (tam mus bt dodavatel vyplnn)\n      if (hasOdeslana) {\n        return null;\n      }\n      \n      // Mus bt bu SCHVLEN nebo rozpracovan s financovnm Smlouva\n      const isSmlouvaFinancing = orderData.zpusob_financovani?.toLowerCase().includes('smlouva');\n      if (!hasSchvalena && !isSmlouvaFinancing) {\n        return null;\n      }\n      \n      if (!isSmlouvaFinancing) {\n        return null;\n      }\n\n      const hasSupplier = orderData.dodavatel_nazev?.trim() || orderData.dodavatel_ico?.trim();\n      if (hasSupplier) {\n        return null; // U je vyplnn - bu z DB nebo z draftu\n      }\n\n      const cisloSmlouvy = orderData.cislo_smlouvy?.trim();\n      if (!cisloSmlouvy) {\n        return null;\n      }\n      \n      // 2 NAST SEZNAM SMLUV PMO (eliminace zvislosti na state)\n      let currentSmlouvyList = [];\n      try {\n        const response = await getSmlouvyList({\n          token,\n          username,\n          show_inactive: false,\n          limit: 500\n        });\n        \n        if (response?.data && Array.isArray(response.data)) {\n          currentSmlouvyList = response.data;\n        }\n      } catch (loadError) {\n        return null;\n      }\n\n      // 3 NAJT SMLOUVU V SEZNAMU\n      const smlouva = currentSmlouvyList.find(s => \n        s.cislo_smlouvy === cisloSmlouvy || \n        s.evidencni_cislo === cisloSmlouvy\n      );\n\n      if (!smlouva) {\n        return null;\n      }\n\n      const icoZeSmlouvy = smlouva.ico?.trim();\n      if (!icoZeSmlouvy || icoZeSmlouvy.length < 8) {\n        // Smlouva nem IO nebo je neplatn - vrtme jen nzev\n        return {\n          dodavatel_nazev: smlouva.nazev_firmy || '',\n          dodavatel_ico: '',\n          source: 'smlouva-fallback'\n        };\n      }\n\n      // 4 HLEDAT V LOKLNM ADRESI (primrn zdroj)\n      try {\n        const localResult = await searchSupplierByIco({\n          token: token,\n          username: username,\n          ico: icoZeSmlouvy\n        });\n\n        if (localResult?.data && Array.isArray(localResult.data) && localResult.data.length > 0) {\n          const supplier = localResult.data[0];\n          return {\n            dodavatel_nazev: supplier.nazev || supplier.name || smlouva.nazev_firmy || '',\n            dodavatel_adresa: supplier.adresa || supplier.address || '',\n            dodavatel_ico: supplier.ico || icoZeSmlouvy,\n            dodavatel_dic: supplier.dic || '',\n            dodavatel_zastoupeny: supplier.zastoupeny || supplier.represented || '',\n            dodavatel_kontakt_jmeno: supplier.kontakt_jmeno || '',\n            dodavatel_kontakt_email: supplier.kontakt_email || supplier.email || '',\n            dodavatel_kontakt_telefon: supplier.kontakt_telefon || supplier.telefon || '',\n            source: 'local'\n          };\n        }\n      } catch (localError) {\n        // Error in local directory search\n      }\n\n      // 5 FALLBACK NA ARES\n      try {\n        const aresUrl = `https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/${icoZeSmlouvy}`;\n        const aresResponse = await fetch(aresUrl, {\n          method: 'GET',\n          headers: { 'Accept': 'application/json' }\n        });\n\n        if (aresResponse.ok) {\n          const aresData = await aresResponse.json();\n          return {\n            dodavatel_nazev: aresData.obchodniJmeno || smlouva.nazev_firmy || '',\n            dodavatel_adresa: aresData.sidlo?.textovaAdresa || '',\n            dodavatel_ico: aresData.ico || icoZeSmlouvy,\n            dodavatel_dic: aresData.dic || '',\n            dodavatel_zastoupeny: '',\n            dodavatel_kontakt_jmeno: '',\n            dodavatel_kontakt_email: '',\n            dodavatel_kontakt_telefon: '',\n            source: 'ares'\n          };\n        }\n      } catch (aresError) {\n        // Error in ARES query\n      }\n\n      // 6 FALLBACK NA DATA ZE SMLOUVY (pouze nzev a IO)\n      return {\n        dodavatel_nazev: smlouva.nazev_firmy || '',\n        dodavatel_ico: icoZeSmlouvy,\n        source: 'smlouva'\n      };\n\n    } catch (error) {\n      return null;\n    }\n  }, [token, username]);\n\n  //  FIX: Callback funkce pro useFormController - definovan a po vech state promnnch\n  const handleDataLoaded = useCallback(async (loadedData, sourceOrderId) => {\n      // Callback kdy jsou data natena z DB\n      // KRITICK: Nastavit formData s natenmi daty\n\n      //  DEBUG: RAW CEL OBJEDNVKY z backendu\n      // console.log(' RAW CEL OBJEDNVKA z DB:', loadedData);\n\n      //  OCHRANA: Zabrnit opakovanmu voln onDataLoaded PRO STEJNOU objednvku\n      //  FIX: Kontroluj souasn editOrderId, ne jen flag\n      const currentEditId = editOrderId || loadedData?.id || 'NEW';\n      if (onDataLoadedCalledRef.current === currentEditId) {\n        if (process.env.NODE_ENV === 'development') {\n          console.warn(' handleDataLoaded u byl zavoln pro:', currentEditId, '- ignoruji duplicitn voln');\n        }\n        return;\n      }\n\n      // KRITICK: Nastavit ochranu PED jakmikoliv async operacemi\n      onDataLoadedCalledRef.current = currentEditId;\n\n      //  DAL OCHRANA: Reset ochrany po 5 sekundch pro ppad e by dolo k chyb\n      setTimeout(() => {\n        if (onDataLoadedCalledRef.current === currentEditId) {\n          onDataLoadedCalledRef.current = null;\n        }\n      }, 5000);\n\n      //  FIX: Pro NOVOU objednvku okamit povolit autosave\n      // Nen poteba ekat na draft loading - form je ready hned\n      const isNewOrder = !editOrderId;\n      if (isNewOrder) {\n        setIsDraftLoaded(true); //  Povolit autosave OKAMIT pro nov objednvky\n        setIsInitialized(true); //  Oznait jako inicializovan aby se nespustil duplicitn effect\n      }\n\n      // NOTE: sourceOrderIdForUnlock removed - formData.id is used directly\n      // NOTE: formData.id removed - formData.id is single source of truth\n\n      // Nastavit edit mode pokud m loadedData ID\n      if (loadedData?.id) {\n        setIsEditMode(true);\n        //  PERSISTENCE: Ulo editOrderId do draftManager pro refresh\n        draftManager.saveMetadata({ editOrderId: String(loadedData.id) });\n      }\n\n      //  NEBO pokud je editOrderId v URL - OKAMIT nastavit editMode\n      if (editOrderId) {\n        setIsEditMode(true);\n        //  PERSISTENCE: Ulo editOrderId do draftManager pro refresh\n        draftManager.saveMetadata({ editOrderId: String(editOrderId) });\n      }\n\n      //  NOV: Nati draft PMO TADY bhem inicializace!\n      let finalData = loadedData || {};\n      const hasDbData = loadedData && Object.keys(loadedData).length > 0;\n\n      if (user_id) {\n        try {\n          draftManager.setCurrentUser(user_id);\n          const hasDraft = await draftManager.hasDraft();\n\n          if (hasDraft) {\n            const draftData = await draftManager.loadDraft();\n\n            if (draftData?.formData) {\n              //  KONTROLA: Pat draft k tto objednvce?\n              const draftOrderId = draftData.formData.id || draftData.formData?.id;\n              const currentOrderId = editOrderId || loadedData?.id;\n\n              //  Pokud draft m ID objednvky, JE TO EDITACE - nastav HNED!\n              if (draftOrderId) {\n                setIsEditMode(true);\n                // NOTE: formData.id removed - formData.id is single source of truth\n                //  PERSISTENCE: Ulo do draftManager pro refresh\n                draftManager.saveMetadata({ editOrderId: String(draftOrderId) });\n              }\n\n              //  Pokud je draft od JIN objednvky, IGNORUJ ho!\n              if (currentOrderId && draftOrderId && String(draftOrderId) !== String(currentOrderId)) {\n                // NEPOUVAT tento draft - pat k jin objednvce\n                console.warn(' Draft pat k jin objednvce, ignoruji:', { draftOrderId, currentOrderId });\n              } else if (hasDbData) {\n                //  Draft pat k TTO objednvce - pouij ho!\n                //  NOV LOGIKA: LocalStorage VDY m prioritu (obsahuje aktuln zmny uivatele)\n                // DB slou jen jako zklad pro systmov/immutable pole\n\n                finalData = {\n                  ...loadedData, // Nejdv DB (zkladn systmov data)\n                  ...draftData.formData, // Pak LS draft PEPE vechny user-editable fieldy\n                  \n                  //  IMMUTABLE systmov pole - VDY Z DB (nelze mnit)\n                  id: loadedData.id,\n                  ev_cislo: loadedData.ev_cislo || loadedData.cislo_objednavky,\n                  cislo_objednavky: loadedData.cislo_objednavky,\n                  datum_vytvoreni: loadedData.datum_vytvoreni,\n                  datum_posledni_zmeny: loadedData.datum_posledni_zmeny,\n                  \n                  //  FAKTURY: Preferovat draft faktury (obsahuj lokln zmny), fallback na DB\n                  faktury: (draftData.formData.faktury && draftData.formData.faktury.length > 0) \n                    ? draftData.formData.faktury \n                    : (loadedData.faktury || [])\n                };\n              } else {\n                // NEW: Pouij draft\n                finalData = draftData.formData;\n              }\n            }\n          }\n        } catch (error) {\n          console.error(' Chyba pi natn draftu:', error);\n        }\n      }\n\n      //  KRITICK: SYNCHRONN NATEN EV_CISLO pro nov objednvky\n      // Priorita: Nast slo PED nastavenm formData, ne asynchronn v useEffect\n      if (isNewOrder && !finalData.ev_cislo && token && username) {\n        try {\n          console.log(' [OrderForm25/handleDataLoaded] Natm evidenn slo synchronn...');\n          const orderNumberData = await getNextOrderNumberV2(token, username);\n          const nextNumber = orderNumberData.next_order_string || orderNumberData.order_number_string || orderNumberData.next_number;\n          \n          if (nextNumber) {\n            finalData.ev_cislo = nextNumber;\n            console.log(' [OrderForm25/handleDataLoaded] Evidenn slo nateno:', nextNumber);\n            \n            // Oznait e ev_cislo je nateno aby useEffect ho u nenatal\n            if (window.__orderForm_hasLoadedNextNumberRef) {\n              window.__orderForm_hasLoadedNextNumberRef.current = true;\n            }\n          } else {\n            console.warn(' [OrderForm25/handleDataLoaded] API nevrtilo ev_cislo');\n          }\n        } catch (error) {\n          console.error(' [OrderForm25/handleDataLoaded] Chyba pi natn ev_cislo:', error);\n          // Fallback - useEffect to zkus nast\n        }\n      }\n\n      //  NOV OBJEDNVKA: Aplikovat vchoz hodnoty garanta a pkazce z user settings\n      if (isNewOrder && user_id && !finalData.garant_uzivatel_id && !finalData.prikazce_id) {\n        try {\n          const { loadSettingsFromLocalStorage } = require('../services/userSettingsApi');\n          const userSettings = loadSettingsFromLocalStorage(parseInt(user_id, 10));\n          \n          console.log(' [OrderForm25/handleDataLoaded] Natm user settings pro user_id:', user_id, userSettings);\n          \n          if (userSettings) {\n            // Extrahuj hodnoty garanta\n            if (userSettings.vychozi_garant_id && userSettings.vychozi_garant_id !== '' && userSettings.vychozi_garant_id !== null) {\n              const defaultGarantId = typeof userSettings.vychozi_garant_id === 'object' \n                ? userSettings.vychozi_garant_id.value \n                : userSettings.vychozi_garant_id;\n              \n              if (defaultGarantId && defaultGarantId !== '') {\n                finalData.garant_uzivatel_id = String(defaultGarantId);\n                console.log(' [OrderForm25/handleDataLoaded] Nastavuji vchozho garanta:', defaultGarantId);\n              }\n            }\n            \n            // Extrahuj hodnoty pkazce\n            if (userSettings.vychozi_prikazce_id && userSettings.vychozi_prikazce_id !== '' && userSettings.vychozi_prikazce_id !== null) {\n              const defaultPrikazceId = typeof userSettings.vychozi_prikazce_id === 'object'\n                ? userSettings.vychozi_prikazce_id.value\n                : userSettings.vychozi_prikazce_id;\n              \n              if (defaultPrikazceId && defaultPrikazceId !== '') {\n                finalData.prikazce_id = String(defaultPrikazceId);\n                console.log(' [OrderForm25/handleDataLoaded] Nastavuji vchozho pkazce:', defaultPrikazceId);\n              }\n            }\n          } else {\n            console.log(' [OrderForm25/handleDataLoaded] User settings nejsou v localStorage');\n          }\n        } catch (error) {\n          console.error(' [OrderForm25/handleDataLoaded] Chyba pi natn vchozch hodnot garanta/pkazce:', error);\n        }\n      }\n\n      //  AUTOMATICK DOPLNN DODAVATELE ZE SMLOUVY\n      // Pokud je fze 3+, financovn = Smlouva a dodavatel przdn, zkusit doplnit\n      let wasAutoFilled = false;\n      if (Object.keys(finalData).length > 0) {\n        const currentPhase = getWorkflowPhase(finalData.stav_workflow_kod);\n        \n        try {\n          const supplierFromContract = await autoFillSupplierFromContract(finalData, currentPhase);\n          \n          if (supplierFromContract) {\n            // Slouit dodavatelsk data do finalData\n            finalData = {\n              ...finalData,\n              ...supplierFromContract\n            };\n            \n            // Nastavit zdroj pro zobrazen v labelu\n            setSupplierAutoFillSource(supplierFromContract.source);\n            \n            wasAutoFilled = true;\n          }\n        } catch (error) {\n        }\n      }\n\n      // Nastavit finln data (pokud nen przdn)\n      if (Object.keys(finalData).length > 0) {\n        setFormData(finalData);\n\n        //  EXTRAHOVAT LP OPTIONS z enriched order response\n        // LP options jsou v loadedData.financovani.lp_nazvy (ne v lp_options!)\n        \n        // Extrahuj LP z financovani.lp_nazvy (primrn zdroj pro poloky)\n        if (loadedData?.financovani?.lp_nazvy && Array.isArray(loadedData.financovani.lp_nazvy)) {\n          const lpOptions = loadedData.financovani.lp_nazvy\n            .map(lp => ({\n              id: lp.id,\n              kod: lp.cislo_lp || lp.kod || `LP${lp.id}`,\n              nazev: lp.nazev || 'Bez nzvu',\n              kategorie: lp.kategorie,\n              limit: lp.limit || lp.celkovy_limit,\n              cerpano: lp.cerpano || lp.skutecne_cerpano,\n              zbyva: lp.zbyva || lp.zbyva_skutecne,\n              rok: lp.rok,\n              label: `${lp.cislo_lp || lp.kod || `LP${lp.id}`} - ${lp.nazev || 'Bez nzvu'}`\n            }))\n            .sort((a, b) => a.nazev.localeCompare(b.nazev, 'cs'));\n          \n          setLpOptionsForItems(lpOptions);\n        } else if (finalData.lp_kod && Array.isArray(finalData.lp_kod) && finalData.lp_kod.length > 0) {\n          //  FALLBACK: Objednvka m LP financovn, ale chyb lp_nazvy data - nati z API\n          \n          try {\n            //  KROK 1: Pokud lpKodyOptions nen dostupn, nati vechny LP\n            let lpMappingData = lpKodyOptions || [];\n            if (!lpKodyOptions || lpKodyOptions.length === 0) {\n              try {\n                lpMappingData = await fetchLimitovanePrisliby({ token, username });\n              } catch (err) {\n                console.error(' Chyba natn LP mapovn:', err);\n                lpMappingData = [];\n              }\n            }\n            \n            //  KROK 2: Nati detaily pro kad LP (peve ID  KD)\n            const lpDetails = await Promise.all(\n              finalData.lp_kod.map(async (lpValue) => {\n                // Deklarujeme promnn na rovni map callbacku, aby byly dostupn i v catch\n                let lpKod = lpValue;\n                const originalValue = lpValue;\n                \n                try {\n                  //  lpValue me bt ID (number/string-number) nebo KD (string)\n                  // Pokud je to slo, najdi KD z lpMappingData, jinak pouij pmo\n                  \n                  if (lpMappingData && lpMappingData.length > 0) {\n                    // Zkus najt podle ID nebo KD\n                    const lpOption = lpMappingData.find(opt => \n                      opt.id === lpValue || \n                      opt.id === Number(lpValue) ||\n                      opt.kod === lpValue ||\n                      opt.cislo_lp === lpValue\n                    );\n                    \n                    if (lpOption) {\n                      lpKod = lpOption.cislo_lp || lpOption.kod || lpValue;\n                    } else {\n                      console.warn(` LP ${lpValue} nebylo nalezeno v LP mapovn (${lpMappingData.length} zznam)`);\n                      // Zkusme pout hodnotu pmo - mon je to u KD\n                    }\n                  } else {\n                    console.warn(' LP mapovn nen dostupn, zkusm hodnotu pmo:', lpValue);\n                  }\n                  \n                  const lpDetail = await fetchLPDetail({ token, username, cislo_lp: lpKod });\n                  //  Zkontroluj, jestli API vrtilo platn data\n                  if (!lpDetail || !lpDetail.id) {\n                    console.warn(` LP ${lpKod} (ID: ${originalValue}) nebylo nalezeno nebo nem platn data`);\n                    return null;\n                  }\n                  return {\n                    id: lpDetail.id,\n                    kod: lpDetail.cislo_lp || lpDetail.kod || `LP${lpDetail.id}`,\n                    nazev: lpDetail.nazev_uctu || lpDetail.nazev || 'Bez nzvu',\n                    kategorie: lpDetail.kategorie,\n                    limit: lpDetail.celkovy_limit || 0,\n                    cerpano: lpDetail.skutecne_cerpano || 0,\n                    zbyva: lpDetail.zbyva_skutecne || 0,\n                    rok: lpDetail.rok,\n                    label: `${lpDetail.cislo_lp || lpDetail.kod || `LP${lpDetail.id}`} - ${lpDetail.nazev_uctu || lpDetail.nazev || 'Bez nzvu'}`\n                  };\n                } catch (err) {\n                  console.error(` Chyba natn LP ${lpKod} (ID: ${originalValue}):`, err);\n                  return null;\n                }\n              })\n            );\n            const validLpOptions = lpDetails.filter(lp => lp !== null).sort((a, b) => a.nazev.localeCompare(b.nazev, 'cs'));\n            setLpOptionsForItems(validLpOptions);\n          } catch (err) {\n            console.error(' Chyba pi natn LP z API:', err);\n            setLpOptionsForItems([]);\n          }\n        } else {\n          // Nen LP financovn\n          setLpOptionsForItems([]);\n        }\n\n        //  ULOIT SNAPSHOT pvodnho stavu pro detekci zmn\n        if (finalData.id) {\n          originalFormDataRef.current = JSON.parse(JSON.stringify(finalData));\n        }\n\n        //  ULOIT DRAFT po autoFill (aby se zmny zachovaly pi F5)\n        if (wasAutoFilled && editOrderId && draftManager) {\n          try {\n            draftManager.setCurrentUser(user_id);\n            await draftManager.saveDraft(finalData, {\n              orderId: parseInt(editOrderId)\n            });\n          } catch (draftError) {\n            // Nepodailo se uloit draft\n          }\n        }\n\n        //  KRITICK: Pokud m ev_cislo, nastavit ref aby se u neptalo na next-number!\n        if (finalData.ev_cislo && finalData.ev_cislo !== 'Natm...') {\n          if (window.__orderForm_hasLoadedNextNumberRef) {\n            window.__orderForm_hasLoadedNextNumberRef.current = true;\n          }\n        }\n\n        //  Nastavit isInitialized flag aby se zabrnilo duplicitnmu natn\n        setIsInitialized(true);\n      }\n\n      //  Pro EDIT mode: Oznait e inicializace je hotov a tady (po naten draftu)\n      // Pro NEW order u je isDraftLoaded=true nastaveno ve\n      if (!isNewOrder) {\n        if (process.env.NODE_ENV === 'development') {\n        }\n        setIsDraftLoaded(true);\n        \n        //  KRITICK: Povolit autosave i pro EDIT mode!\n        draftManager.setAutosaveEnabled(true, 'EDIT order initialization');\n        \n        //  KRITICK: Poslat broadcast MenuBaru - EDIT MODE JE READY!\n        broadcastOrderState({\n          isEditMode: true,\n          isNewOrder: false,\n          orderId: finalData.id || editOrderId,\n          orderNumber: finalData.cislo_objednavky || finalData.ev_cislo || ''\n        });\n      }\n  }, [editOrderId, user_id, draftManager, setFormData, setIsEditMode, setIsDraftLoaded, setIsInitialized, autoFillSupplierFromContract, setSupplierAutoFillSource, broadcastOrderState]);\n\n  //  HELPER FUNKCE PRO FORMTOVAN TOASTY\n  // Vytv jednotn vzhled pro vechny toast zprvy s ikonami a barvami\n  const formatToastMessage = useCallback((message, type = 'info') => {\n    const styles = {\n      error: {\n        bg: '#fff1f0',\n        color: '#d32f2f',\n        icon: <AlertCircle size={18} color=\"#ff4d4f\" />,\n      },\n      success: {\n        bg: '#f0f9ff',\n        color: '#0d7d3e',\n        icon: <CheckCircle2 size={18} color=\"#10b981\" />,\n      },\n      warning: {\n        bg: '#fff7e6',\n        color: '#d46b08',\n        icon: <AlertTriangle size={18} color=\"#f59e0b\" />,\n      },\n      info: {\n        bg: '#f5f5f5',\n        color: '#4b5563',\n        icon: <InfoIcon size={18} color=\"#6b7280\" />,\n      }\n    };\n\n    const style = styles[type] || styles.info;\n\n    return (\n      <div style={{ \n        display: 'flex', \n        alignItems: 'flex-start', \n        gap: '10px',\n        padding: '4px',\n        fontFamily: 'system-ui, -apple-system, sans-serif'\n      }}>\n        <div style={{ flexShrink: 0, marginTop: '2px' }}>\n          {style.icon}\n        </div>\n        <div style={{ \n          flex: 1,\n          fontSize: '14px',\n          lineHeight: '1.5',\n          color: style.color\n        }}>\n          {message}\n        </div>\n      </div>\n    );\n  }, []);\n\n  // Ostatn callback funkce pro formController\n  const handleError = useCallback((error) => {\n    // Callback pi chyb inicializace\n    showToast?.(formatToastMessage(`Nepodailo se nast formul: ${error.message}`, 'error'), { type: 'error' });\n  }, [formatToastMessage]); //  FIX: Remove showToast dependency to prevent infinite loop\n\n  const handleReady = useCallback(() => {\n    // Formul ready - meme dodaten inicializovat UI\n\n    //  ZRUENO: Auto-scroll po naten formule (na dost uivatele)\n  }, []);\n\n  // Tento hook d celou inicializaci formule a eliminuje race conditions\n  const formController = useFormController({\n    token,\n    username,\n    userId: user_id,\n    editOrderId,\n    archivovanoParam,\n    onDataLoaded: handleDataLoaded,\n    onError: handleError,\n    onReady: handleReady\n  });\n\n  // Rozbalen formController pro snadnj pstup\n  const { lifecycle, dictionaries, orderDataLoader, ui } = formController;\n\n  //  REFACTORED: selnky a jejich loading states nyn z formController\n  // Aliasy pro zachovn zptn kompatibility se stvajcm kdem\n  const allUsers = dictionaries.data?.allUsers || [];\n  const approversBase = dictionaries.data?.approvers || [];\n  const strediskaOptions = dictionaries.data?.strediskaOptions || [];\n  const financovaniOptions = dictionaries.data?.financovaniOptions || [];\n  const druhyObjednavkyOptions = dictionaries.data?.druhyObjednavkyOptions || [];\n  const druhyObjednavkyRawData = dictionaries.data?.druhyObjednavkyRawData || null;\n  const lpKodyOptions = dictionaries.data?.lpKodyOptions || [];\n  const prilohyTypyOptions = dictionaries.data?.prilohyTypyOptions || [];\n  const typyFakturOptions = dictionaries.data?.typyFakturOptions || []; // Typy faktur z reduceru\n  const stavyWorkflowMap = dictionaries.data?.stavyWorkflowMap || {}; //  Mapa workflow stav z DB selnku\n\n  //  Memoizovan hodnota: Je druh objednvky majetek (atribut_objektu = 1)?\n  const isMaterialOrder = React.useMemo(() => {\n    if (!formData.druh_objednavky_kod) return false;\n    \n    const druhObj = druhyObjednavkyOptions.find(opt =>\n      (opt.kod_stavu && opt.kod_stavu === formData.druh_objednavky_kod) ||\n      (opt.kod && opt.kod === formData.druh_objednavky_kod) ||\n      (opt.value && opt.value === formData.druh_objednavky_kod)\n    );\n    \n    // Kontrola atribut_objektu = 1 (majetek)\n    return druhObj?.atribut_objektu === 1;\n  }, [formData.druh_objednavky_kod, druhyObjednavkyOptions]);\n\n  //  Helper: Formtovn chybovch hlek do strukturovan podoby\n  const formatValidationErrors = React.useCallback((errors) => {\n    if (!errors || Object.keys(errors).length === 0) return null;\n\n    //  SJEDNOCENO S FloatingNavigator.categorizeErrorKey() - MUS BT 100% STEJN!\n    // Kategorizace chyb podle sekc NAVIGTORU (odpovd FloatingNavigator.js sekce IDs)\n    const categories = {\n      objednatel: { label: 'Informace o objednateli', errors: [] },\n      schvaleni: { label: 'Schvlen nkupu PO', errors: [] },\n      dodavatel: { label: 'Dodavatel', errors: [] },\n      detaily: { label: 'Detaily objednvky', errors: [] },\n      stav_odeslani: { label: 'Odesln objednvky', errors: [] },\n      potvrzeni_objednavky: { label: 'Potvrzen objednvky dodavatelem', errors: [] },\n      fakturace: { label: 'Fakturace', errors: [] },\n      vecna_spravnost: { label: 'Vcn sprvnost', errors: [] },\n      registr_smluv_vyplneni: { label: 'Registr smluv', errors: [] },\n      ostatni: { label: 'Ostatn', errors: [] }\n    };\n\n    Object.entries(errors).forEach(([key, message]) => {\n      // Vytvo lidsky itelnou zprvu (odstra technick prefixy)\n      let cleanMessage = message;\n      \n      //  KRITICK: Detekce kategorie MUS bt IDENTICK s FloatingNavigator.categorizeErrorKey()\n      // POAD JE DLEIT - specifitj podmnky mus bt PED obecnjmi!\n      \n      // 1. Informace o objednateli (vetn garanta!)\n      if (key.includes('jmeno') || key.includes('email') || key.includes('ev_cislo') || key.includes('garant')) {\n        categories.objednatel.errors.push(cleanMessage);\n      }\n      // 2. Schvlen nkupu PO (FZE 1-2) - vetn FINANCOVN!\n      else if (key.includes('prikazce') || key.includes('max_cena') || \n               key.includes('strediska') || key.includes('predmet') ||\n               key.includes('financovani') || key.includes('lp_kod') || key.includes('cislo_smlouvy') ||\n               key.includes('individualni_schvaleni') || key.includes('pojistna_udalost')) {\n        categories.schvaleni.errors.push(cleanMessage);\n      }\n      // 3. Detaily objednvky (FZE 3+: poloky + druh + lokalizace) - MUS BT PED dodavatelem!\n      else if (key.startsWith('polozka_') || key.includes('druh_objednavky') || message.includes('Poloka')) {\n        categories.detaily.errors.push(cleanMessage);\n      }\n      // 4. Potvrzen objednvky dodavatelem - MUS BT PED \"dodavatel\" (kvli dodavatel_zpusob_potvrzeni)\n      else if (key.includes('zpusob_potvrzeni') || key.includes('dt_akceptace') || key.includes('zpusob_platby')) {\n        categories.potvrzeni_objednavky.errors.push(cleanMessage);\n      }\n      // 5. Dodavatel - MUS BT PO potvrzen (kvli dodavatel_zpusob_potvrzeni)\n      else if (key.includes('dodavatel') || key.includes('ico') || key.includes('adresa') || key.includes('kontakt')) {\n        categories.dodavatel.errors.push(cleanMessage);\n      }\n      // 6. Odesln objednvky\n      else if (key.includes('datum_odeslani') || key.includes('stav_odeslani')) {\n        categories.stav_odeslani.errors.push(cleanMessage);\n      }\n      // 7. Vcn sprvnost - MUS BT PED obecnm \"faktura_\"\n      else if (key.startsWith('faktura_') && key.includes('vecna_spravnost')) {\n        categories.vecna_spravnost.errors.push(cleanMessage);\n      }\n      // 8. Fakturace\n      else if (key.startsWith('faktura_')) {\n        categories.fakturace.errors.push(cleanMessage);\n      }\n      // 9. Registr smluv\n      else if (key.includes('dt_zverejneni') || key.includes('registr') || key.includes('ma_byt_zverejnena')) {\n        categories.registr_smluv_vyplneni.errors.push(cleanMessage);\n      }\n      // 10. Ostatn (fallback)\n      else {\n        categories.ostatni.errors.push(cleanMessage);\n      }\n    });\n\n    // Sestaven strukturovan zprvy - pouze neprzdn kategorie\n    return (\n      <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n        <div style={{ \n          fontSize: '15px', \n          fontWeight: '600', \n          marginBottom: '12px', \n          color: '#1a1a1a',\n          display: 'flex',\n          alignItems: 'center',\n          gap: '8px'\n        }}>\n          <AlertCircle size={20} color=\"#ff4d4f\" style={{ flexShrink: 0 }} />\n          <span>Pro uloen je nutn vyplnit nsledujc poloky:</span>\n        </div>\n        {Object.values(categories).map((cat, idx) => \n          cat.errors.length > 0 && (\n            <div key={idx} style={{ \n              marginBottom: '10px',\n              padding: '10px',\n              backgroundColor: '#fff1f0',\n              borderRadius: '4px'\n            }}>\n              <div style={{ \n                fontWeight: '600', \n                fontSize: '13px',\n                color: '#d32f2f',\n                marginBottom: '6px'\n              }}>\n                {cat.label}\n              </div>\n              {cat.errors.map((err, errIdx) => (\n                <div key={errIdx} style={{ \n                  fontSize: '12px',\n                  color: '#666',\n                  marginLeft: '8px',\n                  marginTop: '4px',\n                  display: 'flex',\n                  alignItems: 'flex-start'\n                }}>\n                  <span style={{ marginRight: '6px', color: '#ff4d4f', fontWeight: 'bold' }}></span>\n                  <span>{err}</span>\n                </div>\n              ))}\n            </div>\n          )\n        )}\n      </div>\n    );\n  }, []);\n\n  //  Kombinovan options pro dodaten dokumenty (PRILOHA_TYP + FAKTURA_TYP)\n  //  OPRAVA: Deduplikace podle value, aby nedolo k duplicitnm klm v React\n  const dodatecneDokladyOptions = React.useMemo(() => {\n    const combined = [...prilohyTypyOptions, ...typyFakturOptions];\n    const uniqueMap = new Map();\n\n    // Deduplikace - pokud je duplicitn value, ponechme prvn vskyt\n    combined.forEach(opt => {\n      if (!uniqueMap.has(opt.value)) {\n        uniqueMap.set(opt.value, opt);\n      }\n    });\n\n    return Array.from(uniqueMap.values());\n  }, [prilohyTypyOptions, typyFakturOptions]);\n\n  //  REFACTORED: areDictionariesReady nyn z formController.dictionaries.isReady\n  const areDictionariesReady = dictionaries.isReady;\n\n  //  State pro garant dropdown options (active users + inactive garant if editing)\n  // Inicializuj HNED s aktivnmi uivateli pokud jsou k dispozici\n  const [garantOptions, setGarantOptions] = useState(() => {\n    const activeUsers = allUsers.filter(u => u.aktivni === 1 || u.aktivni === '1' || u.active === 1 || u.active === '1');\n    return activeUsers;\n  });\n\n  //  SYSTEM uivatel - pid se JEN kdy m objednvka prikazce_id nebo schvalovatel_id = '0'\n  // Pouv se POUZE u archivovanch objednvek\n  const approvers = useMemo(() => {\n    const needsSystemUser = formData.prikazce_id === '0' || formData.schvalovatel_id === '0';\n\n    if (!needsSystemUser) {\n      return approversBase; // Bn objednvky - bez SYSTEM\n    }\n\n    // Archivovan objednvka s SYSTEM uivatelem\n    return [\n      {\n        id: '0',\n        jmeno: 'SYSTEM',\n        prijmeni: '',\n        displayName: 'SYSTEM',\n        aktivni: 1,\n        deaktivovan: 0\n      },\n      ...approversBase\n    ];\n  }, [approversBase, formData.prikazce_id, formData.schvalovatel_id]);\n\n  // Pejmenovn pro zptnou kompatibilitu (rzn sti kdu pouvaj rzn nzvy)\n  const fakturaTypyPrilohOptions = typyFakturOptions; // Alias\n  const loadingFakturaTypyPriloh = false; // selnky u jsou naten kdy se formul zobrazuje\n\n  //  CRITICAL FIX: Reset a povolit autosave pi zmn editOrderId\n  useEffect(() => {\n    const isNewOrder = !editOrderId;\n    \n    //  FIX: RESET isDraftLoaded pi zmn editOrderId (pepnut mezi objednvkami)\n    setIsDraftLoaded(false);\n    \n    if (isNewOrder && user_id) {\n      setIsDraftLoaded(true);\n\n      //  KRITICK: Povolit autosave v DraftManageru!\n      draftManager.setAutosaveEnabled(true, 'NEW order initialization');\n    } else {\n    }\n  }, [editOrderId, user_id]); // Spust se pi zmn editOrderId\n\n  // Automatick rozbalen lokalizanch panel s vyplnnmi hodnotami\n  // VDY rozbalit pokud:\n  // 1. Je to majetkov poloka (atribut_objektu = 1)  POVINN lokalizace\n  // 2. M vyplnn lokalizan data (sek, budova, mstnost, poznmka)\n  useEffect(() => {\n    if (formData.polozky_objednavky && Array.isArray(formData.polozky_objednavky)) {\n      const newPanelStates = {};\n      \n      // Zkontroluj, jestli druh objednvky m atribut_objektu = 1 (majetek)\n      const isMaterialOrderValue = isMaterialOrder;\n      \n      formData.polozky_objednavky.forEach(polozka => {\n        // Zkontroluj, zda m poloka vyplnn lokalizan data\n        const hasLocationData =\n          (polozka.usek_kod && polozka.usek_kod.trim() !== '') ||\n          (polozka.budova_kod && polozka.budova_kod.trim() !== '') ||\n          (polozka.mistnost_kod && polozka.mistnost_kod.trim() !== '') ||\n          (polozka.poznamka && polozka.poznamka.trim() !== '');\n\n        //  ROZBALIT pokud:\n        // - Je to majetek (lokalizace je POVINN)  mus bt vidt erven rmeky pi validaci\n        // - M vyplnn data (aby uivatel vidl co u vyplnil)\n        // \n        // DLEIT: Panel se rozbal pi:\n        // - Naten objednvky s majetkovmi polokami (i kdy lokalizace nen vyplnn)\n        // - Naten objednvky s vyplnnmi lokalizanmi daty\n        // - Zmn druhu objednvky na majetek\n        if (isMaterialOrderValue || hasLocationData) {\n          newPanelStates[polozka.id] = true;\n        } else {\n          // Zavt pouze pokud NEN majetek A NEM data\n          newPanelStates[polozka.id] = false;\n        }\n      });\n\n      // Nastav VDY - aby se panely mohly otevt i zavt pi zmn stavu\n      setLokalizacePanelStates(newPanelStates);\n    }\n  }, [\n    formData.polozky_objednavky?.length, \n    formData.druh_objednavky_kod, \n    isMaterialOrder,\n    //  KRITICK: Sledovat i zmny v lokalizanch datech poloek\n    // Kdy se nate objednvka z DB, mus se panely rozbalit\n    JSON.stringify(formData.polozky_objednavky?.map(p => ({\n      id: p.id,\n      usek: p.usek_kod,\n      budova: p.budova_kod,\n      mistnost: p.mistnost_kod,\n      poznamka: p.poznamka\n    })))\n  ])\n\n  // Synchronizace smlouvaSearchTerm s formData.cislo_smlouvy pi naten dat\n  useEffect(() => {\n    if (formData.cislo_smlouvy && formData.cislo_smlouvy !== smlouvaSearchTerm) {\n      setSmlouvaSearchTerm(formData.cislo_smlouvy);\n    }\n  }, [formData.cislo_smlouvy, smlouvaSearchTerm]);\n\n  // JEDNODUCH WORKFLOW - pmo z DB stavu bez mapovn\n  const [isConceptSaved, setIsConceptSaved] = useState(false); // Pouze localStorage koncept\n  const [isPhase1Unlocked, setIsPhase1Unlocked] = useState(false); // Stav pro odemknut FZE 1\n\n  //  Cleanup pi unmount - uloit draft ped unmount\n  useEffect(() => {\n    // dn logika tady - jen cleanup funkce\n    return () => {\n      // Cleanup POUZE pi unmount komponenty\n      //  POZOR: Pouij REF pro pstup k aktulnm hodnotm - dependencies mus bt przdn!\n\n      //  KRITICK: Uloit draft ped unmount (i kdy autosave jet neprobhlo)\n      // Scn: User zmn pole  navigace pry bhem 3s delay  bez tohoto by se draft neukldal\n      if (isDraftLoaded && user_id && formData) {\n        //  OCHRANA: Ukldat POUZE pokud m formData smyslupln obsah\n        // Minimln 40 kl (przdn formData m ~78 kl)\n        const formDataKeys = Object.keys(formData);\n        const hasSignificantData = formDataKeys.length >= 40;\n\n        if (!hasSignificantData) {\n          return;\n        }\n\n        try {\n          //  ZRUENO: Ukldn scroll pozice ped unmount (na dost uivatele)\n          // const scrollContainer = scrollableContentRef.current;\n          // const scrollPosition = scrollContainer ? scrollContainer.scrollTop : (window.pageYOffset || document.documentElement.scrollTop);\n\n          //  Nastavit current user ped ukldnm\n          draftManager.setCurrentUser(user_id);\n\n          //  Sprvn API: saveDraft(formData, options)\n          draftManager.saveDraft(formData, {\n            orderId: formData.id || null\n          });\n\n          //  ZRUENO: Ukldn scroll pozice\n          // draftManager.saveMetadata({ scrollPosition });\n        } catch (error) {\n        }\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []); //  PRZDN dependencies - spust se JEN pi mount/unmount!\n\n  //  CENTRLN NATN DRAFTU pi obnoven strnky (F5)\n  // Tento useEffect se spust kdy isDraftLoaded=true a nen editOrderId v URL\n  useEffect(() => {\n    // Ochrana: Nast draft pouze pokud:\n    // 1. user_id existuje\n    // 2. isDraftLoaded=true (inicializace dokonena)\n    // 3. NEN editOrderId (editace se e v handleDataLoaded)\n    if (!user_id || !isDraftLoaded || editOrderId) {\n      return;\n    }\n\n    let isActive = true;\n\n    const loadDraftData = async () => {\n      try {\n        draftManager.setCurrentUser(user_id);\n\n        // Kontrola existence draftu\n        const hasDraft = await draftManager.hasDraft();\n\n        if (!hasDraft) {\n          return;\n        }\n\n        // Nati draft\n        const draftData = await draftManager.loadDraft();\n\n        if (!draftData?.formData || !isActive) {\n          return;\n        }\n\n        //  DB SYNC CHECK - pouze pro EDIT mode\n        if (draftData.formData.id) {\n\n          const syncCheck = await draftManager.checkDBSync(\n            async (orderId) => {\n              try {\n                return await getOrderTimestampV2(orderId, token, username);\n              } catch (error) {\n                return null;\n              }\n            },\n            async (orderId) => {\n              try {\n                const response = await getOrderV2(orderId, token, username);\n                return response?.data || null;\n              } catch (error) {\n                //  HIERARCHIE: Pokud backend vrtil 403, nemme prvo\n                if (error?.status === 403 || error?.response?.status === 403) {\n                  console.warn(' HIERARCHY: Pstup k objednvce zamtnut hierarchi');\n                }\n                return null;\n              }\n            }\n          );\n\n          if (!isActive) return;\n\n          if (syncCheck.needsSync && syncCheck.dbData) {\n            //  OCHRANA: Zachovat existujc poloky pokud DB data je nem\n            const mergedData = { ...syncCheck.dbData };\n            if (!mergedData.polozky_objednavky || mergedData.polozky_objednavky.length === 0) {\n              if (formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n                mergedData.polozky_objednavky = formData.polozky_objednavky;\n                // DEBUG: Local items protection - logging removed\n              }\n            }\n\n            setFormData(mergedData);\n            setIsChanged(false);\n            setIsEditMode(true);\n            //  KRITICK: Poslat broadcast po DB sync\n            broadcastOrderState({\n              isEditMode: true,\n              isNewOrder: false,\n              orderId: syncCheck.dbData.id,\n              orderNumber: syncCheck.dbData.cislo_objednavky || syncCheck.dbData.ev_cislo\n            });\n            await draftManager.syncWithDatabase(syncCheck.dbData, syncCheck.dbData.id);\n            return;\n          }\n        }\n\n        //  Aplikuj draft data\n\n        //  VYISTIT objekty ve fa_strediska_kod (pokud tam jsou)\n        const cleanedDraftData = { ...draftData.formData };\n\n        if (cleanedDraftData.faktury && Array.isArray(cleanedDraftData.faktury)) {\n          cleanedDraftData.faktury = cleanedDraftData.faktury.map(faktura => {\n            if (faktura.fa_strediska_kod && Array.isArray(faktura.fa_strediska_kod)) {\n              // Extrahovat jen stringy z objekt\n              faktura.fa_strediska_kod = faktura.fa_strediska_kod.map(item => {\n                if (typeof item === 'string') return item;\n                return item.value || item.kod_stavu || item.id || item;\n              });\n            }\n            return faktura;\n          });\n        }\n\n        setFormData(prev => ({\n          ...prev,  //  KRITICK: Zachovat vechny vchoz hodnoty (78 kl)\n          ...cleanedDraftData,  //  Pepsat jen zmnn hodnoty z draftu (VYITN!)\n          id: prev?.id || draftData.formData.id,\n          datum_posledni_zmeny: prev?.datum_posledni_zmeny || draftData.formData.datum_posledni_zmeny,\n          //  FIX: Zachovat stav_schvaleni a strediska_kod z prev pokud draft neobsahuje validn hodnoty\n          // prev obsahuje u SPRVN TRANSFORMOVAN data z useOrderDataLoader\n          stav_schvaleni: cleanedDraftData.stav_schvaleni || prev?.stav_schvaleni || '',\n          strediska_kod: (cleanedDraftData.strediska_kod && Array.isArray(cleanedDraftData.strediska_kod) && cleanedDraftData.strediska_kod.length > 0)\n            ? cleanedDraftData.strediska_kod\n            : (prev?.strediska_kod || []),\n          //  FIX: dodavatel_zpusob_potvrzeni - pout draft JEN pokud m NEPRZDN zpusoby\n          // Pokud je pole przdn, zachovat hodnotu z DB (prev)\n          dodavatel_zpusob_potvrzeni: (cleanedDraftData.dodavatel_zpusob_potvrzeni?.zpusoby?.length > 0)\n            ? cleanedDraftData.dodavatel_zpusob_potvrzeni\n            : (prev?.dodavatel_zpusob_potvrzeni || cleanedDraftData.dodavatel_zpusob_potvrzeni)\n        }));\n\n        setIsChanged(draftData.isChanged === true);\n\n        if (draftData.formData.id || draftData.formData?.id) {\n          setIsEditMode(true);\n          //  KRITICK: Poslat broadcast po naten draftu s editId\n          broadcastOrderState({\n            isEditMode: true,\n            isNewOrder: false,\n            orderId: draftData.formData.id,\n            orderNumber: draftData.formData.cislo_objednavky || draftData.formData.ev_cislo\n          });\n        }\n\n      } catch (error) {\n      }\n    };\n\n    loadDraftData();\n\n    return () => {\n      isActive = false;\n    };\n  }, [user_id, isDraftLoaded, editOrderId]); //  Spust se kdy isDraftLoaded=true a nen editOrderId\n\n  // Flag pro kontrolu odesln u nen poteba - odvozuje se pmo z DB stavu\n\n  // Vechno odvozen pmo z formData.stav_workflow_kod (DB stav) - useMemo optimalizace\n  const isOrderSavedToDB = useMemo(() => !!formData.id, [formData.id]);\n  const isApprovedOrder = useMemo(() => {\n    const states = Array.isArray(formData.stav_workflow_kod) ? formData.stav_workflow_kod : parseWorkflowStates(formData.stav_workflow_kod);\n    return states.includes('SCHVALENA');\n  }, [formData.stav_workflow_kod]);\n\n  const sectionVisibility = getSectionVisibility(mainWorkflowState, currentPhase, isArchived);\n\n  // Mapovn sekc na jejich pevn barvy podle typu\n  const getSectionTheme = (sectionName) => {\n    const sectionColorMap = {\n      // ED sekce (zkladn info)\n      'objednatel': 'section-grey',\n      'schvaleni': 'section-grey',\n\n      // ORANOV sekce (pprava objednvky)\n      'financovani': 'section-orange',\n      'dodavatel': 'section-orange',\n      'detaily': 'section-orange',\n      'dodaci_podminky': 'section-orange',\n      'stav_odeslani': 'section-orange',\n\n      // ERVEN sekce (plohy - mimo workflow)\n      'prilohy': 'section-red',\n\n      // MODR sekce (potvrzen a realizace)\n      'potvrzeni_objednavky': 'section-blue',\n      'registr_smluv': 'section-blue',\n      'prubeh_objednavky': 'section-blue',\n      'dodaci_informace': 'section-blue',\n      'fakturace': 'section-blue',\n      'storno_detail': 'section-blue',\n\n      // FIALOV sekce (registr - potvrzen zveejnn)\n      'registr_smluv_vyplneni': 'section-purple'\n    };\n\n    return sectionColorMap[sectionName] || 'section-orange'; // default oranov\n  };\n\n  //  FIX: Define canEditPhase2 before isSectionActive uses it\n  const canEditPhase2 = hasPermission && (hasPermission('ORDER_MANAGE') || hasPermission('ORDER_APPROVE') || hasPermission('ORDER_EDIT_OWN') || hasPermission('ORDER_EDIT_ALL')); // Pro odemykn FZE 2\n\n  // Uren, zda je sekce aktivn podle aktuln fze\n  const isSectionActive = useCallback((sectionName) => {\n    const phase = currentPhase; //  Use pre-calculated currentPhase instead of getCurrentPhase()\n\n    // FZE 1: Zkladn info sekce jsou vdy aktivn + financovn a detaily pro uivatele s oprvnnm\n    if (phase === 1) {\n      const basicSections = ['objednatel', 'schvaleni'];\n      const phase2SectionsForAuthorizedUsers = ['financovani', 'detaily'];\n\n      // Zkladn sekce jsou vdy aktivn ve FZI 1\n      if (basicSections.includes(sectionName)) {\n        return true;\n      }\n\n      // Pokud m uivatel oprvnn k editaci objednvek, povol tak klov sekce FZE 2\n      if (canEditPhase2 && phase2SectionsForAuthorizedUsers.includes(sectionName)) {\n        return true;\n      }\n\n      return false;\n    }\n\n    // FZE 2: Pprava objednvky - oranov sekce aktivn\n    if (phase === 2) {\n      return ['financovani', 'dodavatel', 'detaily', 'dodaci_podminky', 'prilohy', 'stav_odeslani'].includes(sectionName);\n    }\n\n    // FZE 3+: Potvrzen a realizace - modr sekce aktivn\n    if (phase >= 3) {\n      return ['potvrzeni_objednavky', 'registr_smluv', 'prubeh_objednavky', 'dodaci_informace', 'fakturace', 'storno_detail'].includes(sectionName);\n    }\n\n    return false; // Default neaktivn\n  }, [currentPhase, canEditPhase2]); //  Add dependencies for useCallback\n\n  // Kontrola oprvnn pro schvalovn objednvek\n  const canApproveOrders = hasPermission && hasPermission('ORDER_APPROVE');\n  const canManageOrders = hasPermission && hasPermission('ORDER_MANAGE');\n  const canManageUsers = hasPermission && hasPermission('USER_MANAGE'); // Pro prci s kontakty\n  const canEditPhase3 = hasPermission && (hasPermission('ORDER_MANAGE') || hasPermission('ORDER_EDIT_OWN') || hasPermission('ORDER_EDIT_ALL')); // Pro odemykn FZE 3\n  const canEditApprovedSections = canApproveOrders || canManageOrders;\n  const canPublishRegistry = hasPermission && hasPermission('ORDER_PUBLISH_REGISTRY'); //  Pro editaci pol registru smluv\n  const canManageInvoices = hasPermission && hasPermission('INVOICE_MANAGE'); //  Pro editaci faktur ve Fzi 7\n  const canSaveOrder = hasPermission && (hasPermission('ORDER_MANAGE') || hasPermission('ORDER_EDIT_OWN') || hasPermission('ORDER_EDIT_ALL')); // Pro ukldn objednvek\n\n  // Kontrola rol pro speciln oprvnn - MUS BT PED pouitm!\n  const isSuperAdmin = userDetail?.roles?.some(role => role.kod_role === 'SUPERADMIN');\n  const isAdmin = userDetail?.roles?.some(role => role.kod_role === 'ADMINISTRATOR');\n  const hasOrderManagePermission = hasPermission && hasPermission('ORDER_MANAGE');\n  const canUnlockAnything = isSuperAdmin || isAdmin || hasOrderManagePermission; // SUPER, ADMIN a ORDER_MANAGE mohou odemknout cokoliv\n\n  //  Filtrovan LP kdy podle seku vybranho pkazce a platnosti\n  // MUS bt A PO definici isSuperAdmin a approvers!\n  const filteredLpKodyOptions = React.useMemo(() => {\n    // Pokud nen vybran pkazce, vrtit vechny LP kdy\n    if (!formData.prikazce_id) {\n      return lpKodyOptions;\n    }\n\n    // Najt vybranho pkazce v seznamu approvers\n    const selectedPrikazce = approvers.find(user => \n      (user.id || user.user_id) === parseInt(formData.prikazce_id)\n    );\n\n    // Pokud pkazce nenalezen, vrtit vechny LP kdy\n    if (!selectedPrikazce) {\n      console.warn(' Pkazce nenalezen v approvers!');\n      return lpKodyOptions;\n    }\n\n    //  VJIMKA: Pokud je VYBRAN PKAZCE SUPERADMIN  zobrazit VECHNY LP kdy\n    // (kontrolujeme roli VYBRANHO pkazce, ne pihlenho uivatele!)\n    // Najt pkazce v allUsers (kde jsou role)\n    const prikazceWithRoles = allUsers.find(u => \n      (u.id || u.user_id) === parseInt(formData.prikazce_id)\n    );\n    const prikazceIsSuperAdmin = prikazceWithRoles?.roles?.some(role => role.kod_role === 'SUPERADMIN');\n    \n    if (prikazceIsSuperAdmin) {\n      // Stle aplikovat filtr platnosti\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      \n      return lpKodyOptions.filter(lp => {\n        const platneOd = lp.platne_od ? new Date(lp.platne_od) : null;\n        const platneDo = lp.platne_do ? new Date(lp.platne_do) : null;\n        if (platneOd) platneOd.setHours(0, 0, 0, 0);\n        if (platneDo) platneDo.setHours(0, 0, 0, 0);\n        return (!platneOd || platneOd <= today) && (!platneDo || platneDo >= today);\n      });\n    }\n\n    // Zskat usek_id pkazce (u by ml bt v response z API)\n    const prikazceUsekId = selectedPrikazce.usek_id;\n    \n    if (!prikazceUsekId) {\n      console.warn(' Pkazce nem usek_id:', selectedPrikazce);\n      return lpKodyOptions;\n    }\n\n    // Aktuln datum pro kontrolu platnosti\n    const today = new Date();\n    today.setHours(0, 0, 0, 0); // Normalizovat na plnoc\n\n    // Filtrovat LP kdy podle usek_id a platnosti\n    const filtered = lpKodyOptions.filter(lp => {\n      // 1. Kontrola seku\n      const lpUsekId = lp.usek_id || lp.usek;\n      if (!lpUsekId || String(lpUsekId) !== String(prikazceUsekId)) {\n        return false;\n      }\n\n      // 2. Kontrola platnosti (platne_od / platne_do)\n      const platneOd = lp.platne_od ? new Date(lp.platne_od) : null;\n      const platneDo = lp.platne_do ? new Date(lp.platne_do) : null;\n\n      // Normalizovat datumy na plnoc\n      if (platneOd) platneOd.setHours(0, 0, 0, 0);\n      if (platneDo) platneDo.setHours(0, 0, 0, 0);\n\n      // LP mus bt platn DNES\n      // - pokud m platne_od, mus bt <= today\n      // - pokud m platne_do, mus bt >= today\n      const jeAktivni = \n        (!platneOd || platneOd <= today) && \n        (!platneDo || platneDo >= today);\n\n      return jeAktivni;\n    });\n\n    return filtered;\n  }, [formData.prikazce_id, lpKodyOptions, approvers, allUsers]);\n\n  //  WORKFLOW LOCKING - isWorkflowCompleted, isWorkflowRejected, isWorkflowCancelled\n  // pichzej z workflowManager. WorkflowManager d zamykn CENTRLN pes isWorkflowCompleted.\n  // isWorkflowCompleted = TRUE pro DOKONCENA, ZAMITNUTA, ZRUSENA (vechny konen stavy workflow)\n  // SUPER/ADMIN/ORDER_MANAGE mohou odemknout pes unlock dialogy.\n  \n  //  CENTRLN ZAMYKN PRO PLOHY: Pouit workflowManager.getSectionState() pro sprvn zamykn\n  // Sekce 'prilohy' NEN v SECTION_DEFINITIONS, take pouijeme fallback na isWorkflowCompleted\n  const isPrilohyLocked = useMemo(() => {\n    //  SPRVN LOGIKA: Plohy jsou zamen kdy je workflow dokoneno\n    //  DLEIT: Plohy jsou zamen PRO VECHNY vetn admin (nen monost odemen)\n    // Dvod: Plohy k dokonen/zamtnut/stornovan objednvce by nemly bt mniteln\n    return isWorkflowCompleted;\n  }, [isWorkflowCompleted]);\n\n  //  NOV: Pout centralizovan section states z workflowManager\n  //  WorkflowManager vrac { visible, enabled } pro kadou sekci (bez unlock states parametru)\n  //  FIX: Stable section states - pouze zvislost na klovch hodnotch, ne na celm workflowManager\n  const allSectionStates = useMemo(() => {\n    return workflowManager.getAllSectionStates();\n  }, [currentPhase, formData.id, isArchived, formData.stav_workflow_kod, formData.potvrzeni_dokonceni_objednavky, workflowManager]); //  Kompletn dependencies pro refresh\n\n  //  FIX: Memoize formData for FloatingNavigator to prevent re-renders\n  //  Include faktury for vcn sprvnost validation badge\n  const navigatorFormData = useMemo(() => ({ \n    id: formData.id,\n    faktury: formData.faktury,\n    max_cena_s_dph: formData.max_cena_s_dph\n  }), [formData.id, formData.faktury, formData.max_cena_s_dph]);\n\n  //  Helper: Potn ploh a jejich stav\n  const getAttachmentsInfo = useMemo(() => {\n    if (!attachments || attachments.length === 0) {\n      return { count: 0, hasErrors: false };\n    }\n\n    const count = attachments.length;\n    //  Chyba = soubor neexistuje (file_exists: false), status: 'error', nebo chyb klasifikace\n    const hasErrors = attachments.some(att => \n      att.file_exists === false || \n      att.status === 'error' || \n      att.status === 'failed' ||\n      !att.klasifikace || \n      att.klasifikace.trim() === ''\n    );\n\n    return { count, hasErrors };\n  }, [attachments]);\n\n  //  Rozen section states pro navigator - zahrnuje inline podmnky viditelnosti\n  const extendedSectionStates = useMemo(() => {\n    const states = { ...allSectionStates };\n    \n    //  PLOHY - manuln pidn stavu (nen v SECTION_DEFINITIONS)\n    // Viditeln pouze kdy m objednvka ID, zamen kdy je workflow dokoneno\n    if (formData.id) {\n      states.prilohy = {\n        visible: true,  // Vdy viditeln kdy m objednvka ID\n        enabled: !isPrilohyLocked,  // Odemen pouze kdy nen workflow dokoneno\n        attachmentsCount: getAttachmentsInfo.count,  //  Poet ploh\n        hasAttachmentErrors: getAttachmentsInfo.hasErrors  //  Stav chyb\n      };\n    }\n    \n    // Fakturace - upravit viditelnost podle prv a vyplnnch dat\n    const isPlatbaPokladnaObj = formData.financovani?.platba === 'pokladna';\n    const isPlatbaPokladnaDodavatel = formData.dodavatel_zpusob_potvrzeni?.platba === 'pokladna';\n    const isPokladna = isPlatbaPokladnaObj || isPlatbaPokladnaDodavatel;\n    const hasFaktury = formData.faktury && formData.faktury.length > 0;\n    \n    if (states.fakturace) {\n      states.fakturace = {\n        ...states.fakturace,\n        visible: !isPokladna && (\n          canManageInvoices \n            ? currentPhase >= 6 \n            : (currentPhase >= 7 || hasFaktury)\n        )\n      };\n    }\n    \n    // Registr smluv vyplnn - upravit viditelnost podle prv a vyplnnch dat\n    const isRegistrFilled = formData.dt_zverejneni && formData.registr_iddt;\n    if (states.registr_smluv_vyplneni) {\n      states.registr_smluv_vyplneni = {\n        ...states.registr_smluv_vyplneni,\n        visible: states.registr_smluv_vyplneni.visible && (\n          canPublishRegistry || isRegistrFilled\n        )\n      };\n    }\n    \n    //  DOKONEN - rozit viditelnost pro ADMIN + ORDER_MANAGE\n    // WorkflowManager kontroluje stav DOKONCENA, my pidme viditelnost pro adminy ve fzi 8+\n    if (states.dokonceni && canUnlockAnything && currentPhase >= 8) {\n      states.dokonceni = {\n        ...states.dokonceni,\n        visible: true  // Admin vid sekci od fze 8 (i kdy nen dokonen)\n      };\n    }\n    \n    return states;\n  }, [allSectionStates, currentPhase, canManageInvoices, canPublishRegistry, \n      formData.financovani?.platba, formData.dodavatel_zpusob_potvrzeni?.platba, \n      formData.faktury, formData.dt_zverejneni, formData.registr_iddt, \n      formData.id, isPrilohyLocked, canUnlockAnything, getAttachmentsInfo]);\n\n  //  HELPER: Zjist jestli je pole disabled (kombinace workflow lock + UI stav)\n  const isFieldDisabled = useCallback((sectionState) => {\n    return !sectionState.enabled || showSaveProgress || isSaving;\n  }, [showSaveProgress, isSaving]);\n\n  //  NOV: Pout workflowManager pro section states\n  const registrState = allSectionStates.registr_smluv;\n  const isRegistrLocked = !registrState.enabled; // Locked = !enabled\n\n  const registrVyplneniState = allSectionStates.registr_smluv_vyplneni;\n  const isRegistrVyplneniLocked = !registrVyplneniState.enabled; // Locked = !enabled\n\n  const potvrzeniState = allSectionStates.potvrzeni_objednavky;\n  const isPotvrzeniLocked = !potvrzeniState.enabled; // Locked = !enabled\n\n  //  FIX: Pout 'objednatel' sekci (ne 'vytvoreni' - ta neexistuje v SECTION_DEFINITIONS)\n  const objednatelState = allSectionStates.objednatel;\n  const shouldLockPhase1Sections = isFieldDisabled(objednatelState);\n\n  const schvaleniState = allSectionStates.schvaleni;\n  const shouldLockPhase2Sections = isFieldDisabled(schvaleniState);\n\n  //  CHECKBOXY \"Stav schvlen\" - VDY odemen ve FZI 2, zamen a ve FZI 3+\n  //  ARCHIVOVAN: Vdy odemen (isArchived = false)\n  // Toto je aktivn st workflow ve FZI 2 (uivatel mus zakrtnout Schvleno/Neschvleno/ek se)\n  const shouldLockSchvaleniCheckboxes = !isArchived && currentPhase >= 3 && !workflowManager.isSectionUnlocked('phase2');\n\n  //  Financovn je FZE 1-2 (samostatn sekce)\n  const financovaniState = allSectionStates.financovani;\n  const shouldLockFinancovaniSection = isFieldDisabled(financovaniState);\n\n  //  FZE 3: Dodavatel, Poloky, Detaily\n  const dodavatelState = allSectionStates.dodavatel;\n  const shouldLockPhase3Sections = isFieldDisabled(dodavatelState);\n\n  //  potvrzeniState u je definovan ve (dek 4969)\n  const shouldLockPhase4to6Sections = isFieldDisabled(potvrzeniState);\n\n  const fakturaceState = allSectionStates.fakturace;\n  const isFakturaceLockedPhase7 = !fakturaceState.enabled && (currentPhase >= 8 || hasWorkflowState(formData.stav_workflow_kod, 'FAKTURACE'));\n  const shouldLockFaktury = !fakturaceState.enabled;\n\n  //  ODSTRANNO: vecnaSpravnostState - refaktorovno na per-invoice\n  // const vecnaSpravnostState = allSectionStates.vecna_spravnost;\n  // const isVecnaSpravnostLocked = !vecnaSpravnostState.enabled;\n\n  const dokonceniState = allSectionStates.dokonceni;\n  const isDokonceniLocked = !dokonceniState.enabled;\n\n  //  GLOBLN ZMEK: Po dokonen objednvky zamknout VECHNY sekce\n  const isOrderCompleted = hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA');\n  const shouldLockAllSections = isOrderCompleted && !workflowManager.isSectionUnlocked('dokonceni');\n  \n  //  VCN SPRVNOST: Pole vcn sprvnosti jsou editovateln ve FZI 7+, i kdy zbytek faktury je zamen\n  //  VE FZI ZKONTROLOVANA (8) je vcn sprvnost ZAKZNA\n  const isZkontrolovana = hasWorkflowState(formData.stav_workflow_kod, 'ZKONTROLOVANA');\n  const shouldLockVecnaSpravnost = currentPhase < 7 || currentPhase >= 8 || isZkontrolovana || shouldLockAllSections || isArchived;\n\n  // Helper promnn pro workflow stavy (pouvaj se v jinch stech kdu)\n  const isOrderSent = hasWorkflowState(formData.stav_workflow_kod, 'ODESLANA');\n  const isOrderCancelled = hasWorkflowState(formData.stav_workflow_kod, 'ZRUSENA');\n\n  //  POUVME PMO currentPhase a phaseProgress Z WorkflowManager\n  // WorkflowManager automaticky pepot fzi kdy se zmn formData.stav_workflow_kod\n  // Nen poteba manuln mnit fzi podle unlock states - WorkflowManager to dl sm\n\n  // =====================================================\n  // FZE 3 SEKCE (DodavatelStav odesln): ZAMENO ve FZI 4+\n  //  POZNMKA: Financovn je soust FZE 1-2, nikoliv FZE 3!\n  // =====================================================\n  // const shouldLockPhase3Sections = ...\n\n  //  FZE 4-6: Zamykn sekc \"Potvrzen\" a \"Registr smluv\" kdy jsme v pozdj fzi (6+)\n  // DEPRECATED - NYN EENO PES workflowManager.getSectionState('potvrzeni_objednavky')\n  // const shouldLockPhase4to6Sections = ...\n\n  // Kdo me zobrazit tlatko pro odemknut?\n  // SUPER/ADMIN mohou vdy, bn uivatel pouze pokud jsou v aktuln/posledn fzi\n  const canShowUnlockPhase3Button = canUnlockAnything || (currentPhase >= 3 && currentPhase <= 6);\n\n  //  NOV useEffect: Reset stavu pi zmn editOrderId (proklik z jin objednvky)\n  useEffect(() => {\n    // Pokud se zmn editOrderId (nap. z notifikace nebo universal search), resetuj stav\n    if (editOrderId) {\n      // NOTE: unlockOrderIdRef removed - previous order unlock no longer tracked\n      \n      setIsDraftLoaded(false);\n      setIsInitialized(false);\n      //  KRITICK: Reset protection flag aby se pi F5 sprvn naetl draft\n      onDataLoadedCalledRef.current = null;\n    }\n  }, [editOrderId, token, username]);\n\n  // Zpracovn editace objednvky z URL parametru\n  //  DEPRECATED: Data se nyn nataj v initializeForm() PED prvnm renderem\n  useEffect(() => {\n    //  Tento useEffect je te zlon - pouije se jen pokud initializeForm() selhal\n    if (editOrderId && token && username && !isDraftLoaded && areDictionariesReady) {\n      // // console.log(` ZLON natn objednvky #${editOrderId} (initializeForm() neprobhl sprvn)`);\n      // Nech pvodn kd zstane jako fallback...\n    }\n  }, [editOrderId, token, username, isDraftLoaded, areDictionariesReady]);\n\n  // Pvodn useEffect pro editaci - ZAKOMENTOVNO, nyn se dje v initializeForm()\n  /*\n  useEffect(() => {\n    //  KRITICK KONTROLA: ekej na explicitn flag areDictionariesReady\n    if (editOrderId && token && username && !isDraftLoaded && areDictionariesReady) {\n      const loadOrderForEdit = async () => {\n        try {\n          //  NEJDV zkontroluj jestli u existuje draft z Orders25List\n          draftManager.setCurrentUser(user_id);\n          const existingDraft = await draftManager.loadDraft();\n\n          if (existingDraft && existingDraft.formData && existingDraft.formData.id == editOrderId) {\n            //  Mme erstv draft z Orders25List - pouij ho!\n            \n            console.log(` [OrderForm25 LOAD DRAFT] Draft faktury:`, existingDraft.formData.faktury);\n            \n            //  NAST PLOHY PRO FAKTURY Z DRAFTU (draft neobsahuje attachments)\n            if (existingDraft.formData.faktury && Array.isArray(existingDraft.formData.faktury)) {\n              const fakturyWithAttachments = await Promise.all(\n                existingDraft.formData.faktury.map(async faktura => {\n                  console.log(` [OrderForm25 LOAD DRAFT] Natm plohy pro fakturu ID=${faktura.id}`);\n                  let attachments = [];\n                  if (faktura.id && !String(faktura.id).startsWith('temp-')) {\n                    try {\n                      const attachResponse = await listInvoiceAttachments(\n                        faktura.id,\n                        username,\n                        token,\n                        editOrderId\n                      );\n                      attachments = attachResponse.data?.attachments || attachResponse.data || [];\n                      console.log(` [OrderForm25 LOAD DRAFT] Nateny plohy faktury ID=${faktura.id}:`, attachments);\n                    } catch (err) {\n                      console.error(` [OrderForm25 LOAD DRAFT] Chyba pi natn ploh faktury ID=${faktura.id}:`, err);\n                    }\n                  }\n                  return { ...faktura, attachments };\n                })\n              );\n              \n              existingDraft.formData.faktury = fakturyWithAttachments;\n              console.log(` [OrderForm25 LOAD DRAFT] Faktury s plohami:`, fakturyWithAttachments);\n            }\n\n            // Aplikuj draft data na formData\n            setFormData(existingDraft.formData);\n            setAttachments(existingDraft.attachments || []);\n            setIsChanged(existingDraft.isChanged || false);\n            // NOTE: formData.id removed - formData.id is single source of truth\n            setIsDraftLoaded(true);\n            \n            //  KRITICK: Nastavit isEditMode state komponenty\n            setIsEditMode(true);\n\n            return; // HOTOVO - draft naten\n          }\n\n          // Pokud draft neexistuje, nati z databze\n\n          //  V2 API: Nati objednvku s enriched daty\n          let dbOrder;\n          try {\n            dbOrder = await getOrderV2(editOrderId, token, username, true);\n          } catch (error) {\n            //  HIERARCHIE: Zachy 403 error (hierarchie zamtla pstup)\n            if (error?.status === 403 || error?.response?.status === 403) {\n              showToast?.(\n                'Nemte oprvnn k zobrazen tto objednvky podle aktulnho organizanho du',\n                { type: 'error' }\n              );\n              navigate('/orders25-list', { replace: true });\n              return;\n            }\n            \n            // Jin chyba\n            showToast?.(formatToastMessage('Nepodailo se nast objednvku', 'error'), { type: 'error' });\n            return;\n          }\n\n          if (!dbOrder) {\n            showToast?.(formatToastMessage('Nepodailo se nast objednvku', 'error'), { type: 'error' });\n            return;\n          }\n\n          //  KONTROLA ZAMEN podle nov BE logiky (24.10.2025)\n          // BE vrac locked: true POUZE kdy je zamen JINM uivatelem\n          // locked: false znamen \"mu editovat\" (voln NEBO moje zamen)\n          //  Blokuj pouze pokud locked=true A NEN mj zmek A NEN expired (>15 min)\n\n          if (dbOrder.lock_info?.locked === true && !dbOrder.lock_info?.is_owned_by_me && !dbOrder.lock_info?.is_expired) {\n            //  Zamen JINM uivatelem - BLOKUJ a pesmruj\n            const lockInfo = dbOrder.lock_info;\n            const lockedByUserName = lockInfo.locked_by_user_fullname || `uivatel #${lockInfo.locked_by_user_id}`;\n\n            showToast?.(\n              `Objednvka je zamena uivatelem ${lockedByUserName}. Nelze ji otevt pro editaci.`,\n              'warning'\n            );\n\n            addDebugLog('warning', 'EDIT', 'locked', `Objednvka ${editOrderId} je zamena uivatelem ${lockedByUserName}`);\n\n            //  OPRAVENO: Pout React Router navigate msto window.location.href\n            navigate('/orders25-list', { replace: true });\n            return; // ZABLOKOVAT naten formule\n          } else if (dbOrder.lock_info?.is_owned_by_me === true) {\n            //  Moje zamen objednvka - pokrauj v editaci\n            // NOTE: unlockOrderIdRef removed - formData.id is used for unlock\n          } else {\n            // Objednvka nen zamen - normln lock\n            try {\n              const lockResult = await lockOrderV2({ token, username, orderId: editOrderId });\n              if (lockResult.success) {\n                showToast?.(\n                  `Objednvka zamknuta pro editaci`,\n                  'info'\n                );\n                addDebugLog('success', 'EDIT', 'locked', `Objednvka ${editOrderId} byla zamknuta pro editaci`);\n              }\n            } catch (lockError) {\n\n              // Pokud m lockError lock_info, je zamen jinm uivatelem\n              if (lockError.lock_info) {\n                const lockInfo = lockError.lock_info;\n                const userName = lockInfo.locked_by_user_fullname || `uivatel #${lockInfo.locked_by_user_id}`;\n\n                showToast?.(\n                  `Objednvka je zamena uivatelem ${userName}`,\n                  'warning'\n                );\n\n                window.history.replaceState({}, '', '/orders25-list');\n                return;\n              }\n\n              // Jin chyba - varovn, ale pokrauj\n              showToast?.('Varovn: Nepodailo se zamknout objednvku', 'warning');\n            }\n          }\n\n          addDebugLog('success', 'EDIT', 'url-loaded', `Objednvka natena z URL parametru: ${dbOrder.cislo_objednavky || dbOrder.ev_cislo}`);\n\n          //  DEBUG: Co BE vrac\n          if (dbOrder.faktury && dbOrder.faktury.length > 0) {\n            if (dbOrder.faktury[0].fa_polozky && dbOrder.faktury[0].fa_polozky.length > 0) {\n            }\n          }\n          // Vytvo draft pro editaci (stejn jako v Orders25List.js)\n          const orderId = dbOrder.id;\n\n          // Nati detaily objednatele\n          let objednatelDetails = null;\n          if (dbOrder.objednatel_id) {\n            try {\n              const { getUserDetailApi2 } = await import('../services/api2auth');\n              objednatelDetails = await getUserDetailApi2(username, token, dbOrder.objednatel_id);\n            } catch (error) {\n              objednatelDetails = null;\n            }\n          }\n\n          //  NAST PLOHY PRO FAKTURY (PED vytvoenm draft objektu)\n          console.log(` [OrderForm25 LOAD] dbOrder.faktury:`, dbOrder.faktury);\n          const fakturyWithAttachments = dbOrder.faktury && Array.isArray(dbOrder.faktury)\n            ? await Promise.all(dbOrder.faktury.map(async faktura => {\n                console.log(` [OrderForm25 LOAD] Natm plohy pro fakturu ID=${faktura.id}`);\n                // Nati plohy\n                let attachments = [];\n                if (faktura.id && !String(faktura.id).startsWith('temp-')) {\n                  try {\n                    const attachResponse = await listInvoiceAttachments(\n                      faktura.id,\n                      username,\n                      token,\n                      dbOrder.id\n                    );\n                    attachments = attachResponse.data?.attachments || attachResponse.data || [];\n                    console.log(` [OrderForm25 LOAD] Nateny plohy faktury ID=${faktura.id}:`, attachments);\n                  } catch (err) {\n                    console.error(` [OrderForm25 LOAD] Chyba pi natn ploh faktury ID=${faktura.id}:`, err);\n                  }\n                }\n                \n                return { ...faktura, attachments };\n              }))\n            : [];\n          \n          console.log(` [OrderForm25 LOAD] fakturyWithAttachments:`, fakturyWithAttachments);\n\n          // Vytvo daje objednatele\n          let objednatelData = {\n            objednatel_id: dbOrder.objednatel_id || user_id,\n            jmeno: 'Neuvedeno',\n            email: '',\n            telefon: ''\n          };\n\n          if (objednatelDetails) {\n            const jmeno = `${objednatelDetails.titul_pred ? objednatelDetails.titul_pred + ' ' : ''}${objednatelDetails.jmeno || ''} ${objednatelDetails.prijmeni || ''}${objednatelDetails.titul_za ? ', ' + objednatelDetails.titul_za : ''}`.replace(/\\s+/g, ' ').trim();\n            objednatelData = {\n              objednatel_id: dbOrder.objednatel_id,\n              jmeno: jmeno || 'Neuvedeno',\n              email: objednatelDetails.email || '',\n              telefon: objednatelDetails.telefon || ''\n            };\n          }\n\n          // Helper funkce pro workflow stavy\n          const hasWorkflowState = (workflowCode, state) => {\n            if (!workflowCode) return false;\n            try {\n              if (typeof workflowCode === 'string' && workflowCode.startsWith('[')) {\n                const states = JSON.parse(workflowCode);\n                return Array.isArray(states) && states.includes(state);\n              }\n              return String(workflowCode).includes(state);\n            } catch {\n              return String(workflowCode).includes(state);\n            }\n          };\n\n          // Odvozen UI stav ze workflow\n          const isSchvalena = hasWorkflowState(dbOrder.stav_workflow_kod, 'SCHVALENA');\n          const isOdeslana = hasWorkflowState(dbOrder.stav_workflow_kod, 'ODESLANA');\n          const isZrusena = hasWorkflowState(dbOrder.stav_workflow_kod, 'ZRUSENA');\n          const isZamitnuta = hasWorkflowState(dbOrder.stav_workflow_kod, 'ZAMITNUTA');\n          const isCekaSe = hasWorkflowState(dbOrder.stav_workflow_kod, 'CEKA_SE');\n\n          //  Mapovn workflow stav na UI checkbox (stav_schvaleni je POUZE UI helper, neukld se do DB!)\n          let stavSchvaleni = '';\n          if (isSchvalena) {\n            stavSchvaleni = 'schvaleno';\n          } else if (isZamitnuta) {\n            stavSchvaleni = 'neschvaleno';\n          } else if (isCekaSe) {\n            stavSchvaleni = 'ceka_se';\n          }\n          // ODESLANA_KE_SCHVALENI  checkbox zstane przdn (nen vybran dn stav)\n\n          // Vytvo fresh draft s DB daty\n          //  KRITICK OPRAVA: Pouij transformBackendDataToFrontend pro sprvn mapovn financovn!\n          const transformedDbOrder = transformBackendDataToFrontend(dbOrder);\n\n          //  VALIDACE STEDISEK: Fallback pro neaktivn stediska\n          if (transformedDbOrder.strediska_kod && Array.isArray(transformedDbOrder.strediska_kod)) {\n            transformedDbOrder.strediska_kod = validateAndFixStrediska(\n              transformedDbOrder.strediska_kod,\n              strediskaOptions\n            );\n          }\n\n          const freshDraft = {\n            formData: {\n              ...transformedDbOrder,\n              uzivatel_id: user_id,\n              ev_cislo: dbOrder.cislo_objednavky || dbOrder.ev_cislo || 'CHYBA: Chyb slo v DB!',\n              stav_schvaleni: stavSchvaleni,\n              stav_odeslano: isOdeslana,\n              stav_stornovano: isZrusena,\n              //  FZE 7: Explicitn parsovn vcn sprvnosti z DB\n              //  ODSTRANNO: Vcn sprvnost global fields - refaktorovno na per-invoice\n              // vecna_spravnost_potvrzeno: 0,\n              // potvrdil_vecnou_spravnost_id: null,\n              // dt_vecna_spravnost_potvrzeno: null,\n              // vecna_spravnost_umisteni_majetku: '',\n              // vecna_spravnost_poznamka: '',\n              //  FZE 8: Explicitn parsovn dokonen z DB\n              potvrzeni_dokonceni_objednavky: dbOrder.potvrzeni_dokonceni_objednavky !== undefined\n                ? parseInt(dbOrder.potvrzeni_dokonceni_objednavky, 10)\n                : 0,\n              dokoncil_id: dbOrder.dokoncil_id || null,\n              dt_dokonceni: dbOrder.dt_dokonceni || null,\n              dokonceni_poznamka: dbOrder.dokonceni_poznamka || '',\n\n              ...(objednatelData && {\n                objednatel_id: objednatelData.objednatel_id,\n                jmeno: objednatelData.jmeno,\n                email: objednatelData.email,\n                telefon: objednatelData.telefon\n              }),\n              //  KRITICK OPRAVA: Mapovn faktur z DB na FE formt (stejn jako v dku 7867)\n              faktury: (() => {\n                if (fakturyWithAttachments && Array.isArray(fakturyWithAttachments) && fakturyWithAttachments.length > 0) {\n                  return fakturyWithAttachments.map(faktura => {\n                    //  DETEKCE POKLADNHO DOKLADU z rozsirujici_data\n                    const rozsirujiciData = typeof faktura.rozsirujici_data === 'string'\n                      ? JSON.parse(faktura.rozsirujici_data || '{}')\n                      : (faktura.rozsirujici_data || {});\n\n                    const isPokladna = rozsirujiciData.typ_platby === 'pokladna' || rozsirujiciData.pokladni_doklad;\n\n                    const mappedFaktura = {\n                      ...faktura,\n                      //  PZNAK POKLADNY\n                      _isPokladna: isPokladna,\n                      rozsirujici_data: rozsirujiciData,\n                      //  MAPOVN 1:1 mezi DB sloupci a FE poli\n                      fa_dorucena: faktura.fa_datum_doruceni ? 1 : 0, //  Boolean flag zda m datum doruen\n                      fa_splatnost: faktura.fa_datum_splatnosti ? faktura.fa_datum_splatnosti.split(' ')[0] : '', // DB -> FE: fa_datum_splatnosti -> fa_splatnost\n                      //  PARSOVN STEDISEK z DB: JSON string kd  FE objekty s nzvy\n                    fa_strediska_kod: (() => {\n                      try {\n                        let parsed = [];\n\n                        if (Array.isArray(faktura.fa_strediska_kod)) {\n                          parsed = faktura.fa_strediska_kod; // U je pole\n                        } else if (typeof faktura.fa_strediska_kod === 'string') {\n                          parsed = JSON.parse(faktura.fa_strediska_kod) || []; // Parsuj JSON: [\"KLADNO\",\"BENESOV\"]\n                        }\n\n                        //  Transformuj kdy na objekty s nzvy (pro zobrazen v SELECTu)\n                        const result = parsed.map(item => {\n                          if (typeof item === 'object' && item.kod_stavu) {\n                            // U je objekt  zkontroluj zda existuje v aktivnch\n                            const exists = strediskaOptions.find(opt =>\n                              opt.kod_stavu === item.kod_stavu || opt.kod === item.kod_stavu || opt.value === item.kod_stavu\n                            );\n                            if (exists) {\n                              return item;\n                            }\n                            // Neaktivn stedisko  nahradit za 100 Sprva Kladno\n                            const fallback = strediskaOptions.find(opt =>\n                              opt.kod_stavu === \"100\" || opt.kod === \"100\" || opt.value === \"100\"\n                            );\n                            return fallback ? {\n                              kod_stavu: fallback.kod_stavu || fallback.kod || fallback.value,\n                              nazev_stavu: fallback.nazev_stavu || fallback.nazev || fallback.label\n                            } : { kod_stavu: \"100\", nazev_stavu: \"100 Sprva Kladno\" };\n                          }\n                          // Je to jen kd (string)  najt stedisko v options a vzt cel objekt\n                          const stredisko = strediskaOptions.find(opt =>\n                            opt.kod_stavu === item || opt.kod === item || opt.value === item\n                          );\n                          if (stredisko) {\n                            return {\n                              kod_stavu: stredisko.kod_stavu || stredisko.kod || stredisko.value,\n                              nazev_stavu: stredisko.nazev_stavu || stredisko.nazev || stredisko.label\n                            };\n                          }\n                          // Neaktivn stedisko  nahradit za 100 Sprva Kladno\n                          const fallback = strediskaOptions.find(opt =>\n                            opt.kod_stavu === \"100\" || opt.kod === \"100\" || opt.value === \"100\"\n                          );\n                          return fallback ? {\n                            kod_stavu: fallback.kod_stavu || fallback.kod || fallback.value,\n                            nazev_stavu: fallback.nazev_stavu || fallback.nazev || fallback.label\n                          } : { kod_stavu: \"100\", nazev_stavu: \"100 Sprva Kladno\" };\n                        });\n\n                        return result;\n\n                      } catch (e) {\n                        addDebugLog('warning', 'EDIT-FAKTURY-LOAD', 'json-parse-error', `Chyba pi parsovn fa_strediska_kod faktury ID ${faktura.id}: ${e.message}, data: ${faktura.fa_strediska_kod}`);\n                        return [];\n                      }\n                    })(),\n                    // Zachovat originln DB pole pro API odesln\n                    fa_datum_doruceni: faktura.fa_datum_doruceni,\n                    fa_datum_splatnosti: faktura.fa_datum_splatnosti,\n                    fa_datum_vystaveni: faktura.fa_datum_vystaveni,\n                    //  PLOHY jsou u nateny v fakturyWithAttachments\n                    attachments: faktura.attachments || []\n                    };\n\n                    console.log(` [OrderForm25 LOAD] Mapovan faktura:`, { id: mappedFaktura.id, attachments: mappedFaktura.attachments });\n                    return mappedFaktura;\n                  });\n                } else {\n                  console.log(` [OrderForm25 LOAD] dn faktury k mapovn`);\n                  return []; // dn faktury\n                }\n              })()\n            },\n            timestamp: Date.now(),\n            version: '1.4',\n            isConceptSaved: true,\n            isChanged: false,\n            isOrderSavedToDB: true,\n            formData.id: orderId,\n            attachments: []\n          };\n\n          // Draft cleanup je nyn een automaticky pes draftManager\n\n          //  KRITICK OPRAVA: Pokud DB nem faktury, explicitn nastav przdn pole\n          if (!freshDraft.formData.faktury || freshDraft.formData.faktury.length === 0) {\n            freshDraft.formData.faktury = []; // Explicitn przdn pole\n          }\n\n          //  Ulo draft pes DraftManager s invalidated: false (editace ze seznamu = validn draft)\n          draftManager.setCurrentUser(user_id);\n          await draftManager.syncWithDatabase(freshDraft.formData, orderId);\n\n          //  PIDAT: Explicitn ulo metadata pro EDIT mode\n          draftManager.saveMetadata({\n            isEditMode: true,\n            editOrderId: orderId,\n            openConceptNumber: freshDraft.formData.ev_cislo || freshDraft.formData.cislo_objednavky\n          });\n\n          //  KRITICK: Nastavit isEditMode state komponenty\n          setIsEditMode(true);\n\n          //  DEBUG LOG - FZE 2: Objednvka natena z URL\n          const currentPhaseNum = (() => {\n            // Highest phases first\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'DOKONCENA')) return 10;\n            // ZKONTROLOVANA - fze 10 (ped dokonenm)\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'ZKONTROLOVANA')) return 10;\n            // VECNA_SPRAVNOST - fze 9 (vcn sprvnost)\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'VECNA_SPRAVNOST')) return 9;\n            // Fakturace (fze 8)\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'FAKTURACE')) return 8;\n            // Registr smluv - FZE 7\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'DOKONCENA')) return 9;\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'ZKONTROLOVANA')) return 8;\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'VECNA_SPRAVNOST')) return 7;\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'FAKTURACE')) return 6;\n            // Pokud UVEREJNENA  FZE 6 (Fakturace)\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'UVEREJNENA')) return 6;\n            // Pokud bylo rozhodnuto NEUVEREJNIT  FZE 6 (Fakturace)\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'NEUVEREJNIT')) return 6;\n            // Pokud bylo rozhodnuto UVEREJNIT  FZE 5 (Vyplnn registru)\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'UVEREJNIT')) return 5;\n            // Potvrzeno dodavatelem - ZSTV ve FZI 4\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'POTVRZENA')) return 4;\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'ODESLANA')) return 4;\n            if (hasWorkflowState(dbOrder.stav_workflow_kod, 'SCHVALENA')) return 2;\n            return 1;\n          })();\n          // Vyisti URL od edit parametru\n          const newUrl = window.location.pathname;\n          window.history.replaceState({}, '', newUrl);\n\n        } catch (error) {\n\n          showToast?.('Nepodailo se nast objednvku pro editaci', 'error');\n        }\n      };\n\n      loadOrderForEdit();\n    } else if (editOrderId && !areDictionariesReady) {\n      //  ekn na naten slovnk (tich reim - bez logovn)\n    }\n  }, [editOrderId, token, username, isDraftLoaded, showToast, areDictionariesReady]);\n  */\n\n  //  CLEANUP: Odemkni objednvku pi unmount komponenty (zaven formule)\n  // OPRAVA: Pouit useRef pro uloen aktuln hodnoty bez triggeru cleanup pi zmn dependencies\n\n\n  const userRoleRef = useRef({ isSuperAdmin: false, isAdmin: false });\n  // NOTE: unlockOrderIdRef removed - using formData.id directly in cleanup logic\n\n  // Aktualizuj ref s rolemi uivatele\n  useEffect(() => {\n    const isSuperAdmin = userDetail?.roles?.some(role => role.kod_role === 'SUPERADMIN');\n    const isAdmin = userDetail?.roles?.some(role => role.kod_role === 'ADMINISTRATOR');\n    userRoleRef.current = { isSuperAdmin, isAdmin };\n  }, [userDetail]);\n\n  //  NOV OBJEDNVKA: Automatick vyplnn daj pihlenho uivatele\n  // Spust se POUZE pokud je to nov objednvka BEZ daj v formData\n  useEffect(() => {\n    // Podmnky: je to nov objednvka + draft je naten + nen vyplnno jmno + mme userDetail\n    if (isNewOrder && isDraftLoaded && !formData.jmeno && userDetail && user_id) {\n\n      const jmeno = `${userDetail.titul_pred ? userDetail.titul_pred + ' ' : ''}${userDetail.jmeno || ''} ${userDetail.prijmeni || ''}${userDetail.titul_za ? ', ' + userDetail.titul_za : ''}`.replace(/\\s+/g, ' ').trim();\n\n      // NOTE: Vchoz hodnoty garanta a pkazce se nyn nastavuj v handleDataLoaded\n      // (v loading gate fzi, kde jsou k dispozici vechny selnky)\n\n      setFormData(prev => ({\n        ...prev,\n        jmeno: jmeno,\n        email: userDetail.email || '',\n        telefon: userDetail.telefon || '',\n        uzivatel_id: user_id, // ID uivatele kter vytv objednvku\n        objednatel_id: user_id // Implicitn objednatel = vytvoil\n      }));\n    }\n  }, [isNewOrder, isDraftLoaded, formData.jmeno, userDetail, user_id]);\n\n  // Cleanup se spust POUZE pi skutenm unmount (przdn dependencies)\n  useEffect(() => {\n    return () => {\n      //  DLEIT: Automatick odemykn pi unmount VYPNUTO\n      // Zmek se uvoln POUZE explicitn pes handleCancelOrder (tlatko ZAVT)\n      // nebo pi oteven jin objednvky\n      // Tm zajistme, e i ADMIN/SUPERADMIN dr zmek pi Save a zstvaj na formuli\n    };\n  }, []); //  Przdn dependencies = cleanup POUZE pi unmount\n\n  // DEBUG logy odstranny - zpsobovaly nekonen re-rendery!\n  // NOTE: formData.id sync removed - formData.id is single source of truth\n  useEffect(() => {\n    if (formData.id) {\n\n      // KRITICK: Reset validanch stav pouze pi ZMN ID (nat se jin objednvka)\n      //  NEISTIT validationErrors pokud uivatel prv zkusil uloit (hasTriedToSubmit)\n      //  istit pouze kdy se mn ID objednvky (nat se jin zznam)\n      if (!hasTriedToSubmit) {\n        setValidationErrors({});\n        setTouchedSelectFields(new Set());\n      }\n\n      //  Uloit slo objednvky pes DraftManager pro zvraznn v seznamu\n      if (user_id && formData.ev_cislo) {\n        draftManager.saveMetadata({ openConceptNumber: formData.ev_cislo });\n      }\n\n      // Flag u nepotebujeme - fze se odvozuje pmo z workflow stavu\n    }\n  }, [formData.id]); //  ODSTRANIT stav_workflow_kod z dependencies!\n\n  //  Ref pro zabrnn duplicitnho vytven poloek\n  const hasCreatedInitialItem = useRef(false);\n  const lastPhaseRef = useRef(currentPhase);\n\n  // Inicializace poloek objednvky pi pechodu do fze 2 nebo po naten konceptu\n  useEffect(() => {\n    // KRITICK: Vytvoit przdnou poloku POUZE pokud:\n    // 1. Jsme ve fzi 2+\n    // 2. Nejsou dn poloky\n    // 3. Sekce Detail objednvky NEN zamen (pokud je odemen, mus bt vidt min. 1 poloka)\n    // 4. Draft u byl naten (aby se nespustilo bhem natn dat)\n    // 5. Jet jsme nevytvoili przdnou poloku v tto fzi\n\n    const polozkyLength = formData.polozky_objednavky?.length || 0;\n\n    //  DEBUG: Logovn vech podmnek\n    if (currentPhase >= 3) {\n      // DEBUG: POLOZKY phase 3+ debug logging removed for performance\n    }\n\n    //  OCHRANA: Zabrnit sputn bhem inicializace\n    if (!isDraftLoaded) {\n      // DEBUG: Draft loading wait - logging removed\n      return;\n    }\n\n    //  Pro nov objednvky nemus bt vybrn druh objednvky - poloky se mohou vytvoit i bez nj\n\n    //  Resetovat pi zmn fze nebo druhu objednvky\n    if (lastPhaseRef.current !== currentPhase) {\n      hasCreatedInitialItem.current = false;\n      lastPhaseRef.current = currentPhase;\n      // DEBUG: Phase change reset - logging removed\n    }\n\n    //  OPRAVA: Zmna z fze 2+ na fze 3+ (Detail objednvky se zobrazuje od fze 3)\n    //  ADDITIONAL FIX: Vytvoit poloku i kdy je sekce zamen (aby se zobrazila)\n    if (currentPhase >= 3 &&\n        polozkyLength === 0 &&\n        !hasCreatedInitialItem.current) {\n\n      hasCreatedInitialItem.current = true; //  Zamknout dal vytven\n\n      // DEBUG: Creating empty item - logging removed\n      setFormData(prev => ({\n        ...prev,\n        polozky_objednavky: [\n          {\n            id: `new_item_${Date.now()}`,\n            popis: '',\n            mnozstvi: '1',\n            jednotka: 'ks',\n            cena_bez_dph: '',\n            sazba_dph: '21',\n            cena_s_dph: ''\n          }\n        ]\n      }));\n    }\n  }, [currentPhase, isDraftLoaded, formData.druh_objednavky_kod, formData.polozky_objednavky?.length]);\n\n  // DEBUG: Sledovn zmn v polokch (disabled to prevent console flood)\n  // useEffect(() => {\n  //   if (formData.polozky_objednavky) {\n  //     addDebugLog('info', 'POLOZKY', 'change-detected', `Zmna v polokch - aktuln poet: ${formData.polozky_objednavky.length}`);\n  //     if (formData.polozky_objednavky.length > 0) {\n  //       const firstItem = formData.polozky_objednavky[0];\n  //       addDebugLog('info', 'POLOZKY', 'first-item', `Prvn poloka: popis=\"${firstItem.popis}\", cena_bez_dph=\"${firstItem.cena_bez_dph}\"`);\n  //     }\n  //   }\n  // }, [formData.polozky_objednavky]);\n\n  //  AUTOMATICK DETEKCE CENY > 50 000 K bez DPH pro \"M bt zveejnna\"\n  useEffect(() => {\n    // Aktivovat pouze ve FZI 4 (ODESLANA/POTVRZENA) kdy dodavatel potvrd ANO\n    if (!formData.polozky_objednavky || formData.polozky_objednavky.length === 0) return;\n    if (currentPhase !== 4) return; // Pouze ve FZI 4\n\n    // Mus bt potvrzeno dodavatelem ANO\n    const dodavatelPotvrzeni = formData.dodavatel_zpusob_potvrzeni;\n    const potvrdilAno = dodavatelPotvrzeni?.potvrzeni === 'ANO' || dodavatelPotvrzeni?.potvrzeno === true;\n    if (!potvrdilAno) return;\n\n    // Pokud u je rozhodnuto (UVEREJNIT nebo NEUVEREJNIT), nepepisuj\n    if (hasWorkflowState(formData.stav_workflow_kod, 'UVEREJNIT')) return;\n    if (hasWorkflowState(formData.stav_workflow_kod, 'NEUVEREJNIT')) return;\n\n    // Pokud u je hodnota nastavena (uivatel kliknul), nepepisuj\n    if (formData.ma_byt_zverejnena !== undefined && formData.ma_byt_zverejnena !== null) return;\n\n    // Seti vechny ceny bez DPH\n    const celkovaCenaBezDPH = formData.polozky_objednavky.reduce((sum, polozka) => {\n      //  FIX: Odstranit formtovn ped parseFloat\n      const cenaBezDPH = parseFloat((polozka.cena_bez_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\n      const mnozstvi = parseFloat(polozka.mnozstvi) || 1;\n      return sum + (cenaBezDPH * mnozstvi);\n    }, 0);\n\n    // Nastavit vchoz hodnotu podle ceny\n    const defaultValue = celkovaCenaBezDPH > 50000;\n    setFormData(prev => ({\n      ...prev,\n      ma_byt_zverejnena: defaultValue\n    }));\n\n    addDebugLog('info', 'REGISTR', 'auto-detect',\n      `Cena ${celkovaCenaBezDPH.toFixed(2)} K ${defaultValue ? '>' : ''} 50 000 K  vchoz hodnota \"M bt zveejnna\" = ${defaultValue}`\n    );\n  }, [currentPhase, formData.polozky_objednavky, formData.dodavatel_zpusob_potvrzeni, formData.stav_workflow_kod, formData.ma_byt_zverejnena]);\n\n  //  HELPER FUNKCE PRO PRCI S FAKTURAMI (stejn pattern jako poloky)\n  const updateFaktury = useCallback((newFaktury) => {\n    setFormData(prev => ({\n      ...prev,\n      faktury: newFaktury\n    }));\n    //  KRITICK: Nastavit isChanged pi zmn faktur\n    setIsChanged(true);\n  }, []);\n\n  // Zamykn se e pmo v saveOrderToAPI() po uloen\n\n  // Reaktivn logika pro zpusob_financovani: Pokud je vybran Pokladna, zablokuj Dodavatel sekci\n  useEffect(() => {\n    if (!formData.zpusob_financovani || !financovaniOptions.length) return;\n\n    const selectedFinancovani = financovaniOptions.find(opt =>\n      opt.kod === formData.zpusob_financovani ||\n      opt.value === formData.zpusob_financovani\n    );\n\n    const nazev = selectedFinancovani?.nazev || '';\n    const isPokladna = nazev.toLowerCase().includes('pokladna');\n\n    if (isPokladna) {\n      // 1. Svinout (collapse) sekci Dodavatel\n      setSectionStates(prev => ({\n        ...prev,\n        dodavatel: true // true = collapsed\n      }));\n\n      // 2. Vymazat vechny hodnoty pol dodavatele\n      setFormData(prev => ({\n        ...prev,\n        dodavatel_id: null,\n        dodavatel_nazev: '',\n        dodavatel_adresa: '',\n        dodavatel_ico: '',\n        dodavatel_dic: '',\n        dodavatel_zastoupeny: '',\n        dodavatel_kontakt_jmeno: '',\n        dodavatel_kontakt_email: '',\n        dodavatel_kontakt_telefon: ''\n      }));\n\n      // Validace probh POUZE pi Save, live mazn chyb nen poteba\n    } else {\n      // Pokud NEN Pokladna, rozbal sekci Dodavatel (aby byla viditeln)\n      setSectionStates(prev => ({\n        ...prev,\n        dodavatel: false // false = expanded/rozbalen\n      }));\n    }\n  }, [formData.zpusob_financovani, financovaniOptions, hasTriedToSubmit]);\n\n  // Globln drag and drop prevention (zabrn oteven souboru v prohlei)\n  useEffect(() => {\n    const preventDefaults = (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n    };\n\n    const handleDrop = (e) => {\n      preventDefaults(e);\n    };\n\n    // Pidat event listenery\n    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {\n      document.addEventListener(eventName, preventDefaults, false);\n    });\n\n    document.addEventListener('drop', handleDrop, false);\n\n    // Cleanup\n    return () => {\n      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {\n        document.removeEventListener(eventName, preventDefaults, false);\n      });\n      document.removeEventListener('drop', handleDrop, false);\n    };\n  }, []);\n\n  // Vpoet celkov ceny poloek s DPH (optimalizovno s useMemo)\n  const totalPrice = useMemo(() => {\n    if (!formData.polozky_objednavky || formData.polozky_objednavky.length === 0) {\n      return 0;\n    }\n\n    return formData.polozky_objednavky.reduce((total, polozka) => {\n      //  FIX: Odstranit formtovn ped parseFloat\n      const cena = parseFloat((polozka.cena_s_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\n      return total + cena;\n    }, 0);\n  }, [formData.polozky_objednavky]);\n\n  // Porovnn s maximln cenou\n  const maxPrice = useMemo(() => {\n    return parseFloat(formData.max_cena_s_dph?.toString().replace(/[^0-9.-]/g, '')) || 0;\n  }, [formData.max_cena_s_dph]);\n\n  const priceDifference = maxPrice - totalPrice;\n  const isPriceExceeded = totalPrice > maxPrice && maxPrice > 0;\n  const isPriceWithinLimit = totalPrice <= maxPrice && maxPrice > 0 && totalPrice > 0;\n\n  // Vpoet ceny BEZ DPH (pro registr smluv) - sprvn z poloek\n  const celkovaCenaBezDPH = useMemo(() => {\n    if (!formData.polozky_objednavky || formData.polozky_objednavky.length === 0) {\n      return 0;\n    }\n    return formData.polozky_objednavky.reduce((sum, polozka) => {\n      //  FIX: Odstranit formtovn ped parseFloat\n      const cenaBezDPH = parseFloat((polozka.cena_bez_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\n      const mnozstvi = parseFloat(polozka.mnozstvi) || 1;\n      return sum + (cenaBezDPH * mnozstvi);\n    }, 0);\n  }, [formData.polozky_objednavky]);\n\n  // DEPRECATED: Star vpoet DPH\n  const totalPriceWithoutDPH = useMemo(() => {\n    return totalPrice / 1.21; // Pedpokldme 21% DPH\n  }, [totalPrice]);\n\n  // Automatick zakrtvn registru smluv pi pechodu do FZE 3 (pokud cena BEZ DPH > 50 000 K)\n  //  POZOR: Automaticky se nastav jen pokud objednvka JE ULOEN v DB (m formData.id)\n  useEffect(() => {\n    const currentPhaseNum = getCurrentPhase();\n    const shouldAutoCheck = currentPhaseNum >= 3 &&\n                           celkovaCenaBezDPH > 50000 &&\n                           !formData.ma_byt_zverejnena &&\n                           formData.id; //  Kontrola e objednvka je uloen v DB\n\n    if (shouldAutoCheck) {\n      handleInputChange('ma_byt_zverejnena', true);\n    }\n  }, [getCurrentPhase(), celkovaCenaBezDPH, formData.id, formData.id]); //  Pidna zvislost na formData.id\n\n  // Vynucen typu ablony 'po' ve FZI 1 (ped schvlenm)\n  useEffect(() => {\n    if (currentPhase < 2 && templateType !== 'po') {\n      setTemplateType('po');\n    }\n  }, [currentPhase, templateType]);\n\n  // Smart naten ploh pi refreshi formule (DB + lokln neuloen)\n  // POZOR: Nat se vdy, kdy m objednvka ID a sekce ploh je viditeln (!sectionStates.prilohy)\n  useEffect(() => {\n    if (formData.id && token && username && !isNewOrder && !sectionStates.prilohy) {\n\n      loadAttachmentsSmartly();\n    }\n  }, [formData.id, formData.id, token, username, isNewOrder, sectionStates.prilohy]);\n\n  //  REMOVED: useEffect pro natn typ ploh - DEPRECATED\n  // Typy ploh se nataj pi inicializaci pes useDictionaries.loadAll()\n  // Nejsou poteba lazy loading - jsou dostupn ihned v prilohyTypyOptions (alias na dictionaries.data.prilohyTypyOptions)\n\n  // TICH validace pro zobrazen ervench pol (pouze pokud ji uivatel se pokusil uloit)\n  //  DOASN ZAKOMENTOVNO: Tyto useEffecty zpsobuj PEPSN validationErrors a mizen ervench rmek\n  // Validace se dl pouze pi kliknut na \"Uloit\" v validateFormForSave()\n  // Live validace bhem editace nen poteba a zpsobuje race conditions\n  \n  // useEffect(() => {\n  //   // Spus TICHOU validaci pouze pokud se uivatel u jednou pokusil odeslat formul\n  //   // POUZE pro kritick pole, ne pro vechna pole formule\n  //   if (hasTriedToSubmit) {\n  //     validateFormSilently();\n  //   }\n  // }, [hasTriedToSubmit, formData.polozky_objednavky?.length, formData.stav_workflow_kod, shouldLockPhase1Sections, shouldLockPhase2Sections, shouldLockPhase3Sections, shouldLockPhase4to6Sections]);\n\n  // useEffect(() => {\n  //   // Reset validanho stavu pi pechodu mezi fzemi\n  //   if (hasTriedToSubmit) {\n  //     validateFormSilently();\n  //   }\n  // }, [currentPhase, hasTriedToSubmit, formData.stav_workflow_kod, formData.zpusob_financovani, formData.lp_kod, formData.cislo_smlouvy, formData.individualni_schvaleni, formData.pojistna_udalost_cislo, shouldLockPhase1Sections, shouldLockPhase2Sections, financovaniState.visible, financovaniState.enabled, shouldLockPhase3Sections, shouldLockPhase4to6Sections]);\n\n  //  Kompaktn debug logging pro workflow tracking\n  const addDebugLog = (level, category, action, data) => {\n    const styles = {\n      workflow: 'background: #4CAF50; color: white; padding: 2px 6px; border-radius: 3px; font-weight: bold;',\n      autosave: 'background: #2196F3; color: white; padding: 2px 6px; border-radius: 3px;',\n      db: 'background: #FF9800; color: white; padding: 2px 6px; border-radius: 3px; font-weight: bold;',\n      error: 'background: #f44336; color: white; padding: 2px 6px; border-radius: 3px;',\n    };\n\n    // Workflow stavy - VDY zobrazuj\n    if (category === 'WORKFLOW' || category === 'DB-RESPONSE') {\n    }\n    // Autosave - pouze dleit udlosti\n    else if (category === 'AUTOSAVE' && (action === 'saved' || action === 'triggered')) {\n    }\n    // DB response - strukturovan vpis\n    else if (category === 'DB' || category === 'SAVE') {\n    }\n    // Chyby - vdy\n    else if (level === 'error') {\n    }\n  };\n\n  const clearDebugLogs = () => {}; // No-op\n\n  // Funkce pro zskn jmna uivatele podle ID\n  const getUserNameById = (userId) => {\n    if (!userId) return '';\n\n    // Nejdve hledej mezi vemi uivateli\n    let user = allUsers.find(u => (u.id || u.user_id) === parseInt(userId));\n\n    // Pokud nenajde, hledej mezi schvalovateli\n    if (!user) {\n      user = approvers.find(u => (u.id || u.user_id) === parseInt(userId));\n    }\n\n    // Pokud je to aktuln uivatel\n    if (!user && parseInt(userId) === parseInt(user_id) && userDetail) {\n      user = userDetail;\n    }\n\n    // Zkontroluj cache\n    if (!user && userNamesCache[userId]) {\n      return userNamesCache[userId];\n    }\n\n    if (user) {\n      // Sprvn poad: Titul ped + Jmno + Pjmen + Titul za\n      const titul_pred = user.titul_pred ? user.titul_pred + ' ' : '';\n      const jmeno = user.jmeno || '';\n      const prijmeni = user.prijmeni || '';\n      const titul_za = user.titul_za ? ', ' + user.titul_za : '';\n\n      return `${titul_pred}${jmeno} ${prijmeni}${titul_za}`.replace(/\\s+/g, ' ').trim();\n    }\n\n    // Pokud uivatel nen v cache, nati ho z DB asynchronn\n    if (!userNamesCache[userId]) {\n      getUserDetailApi2(username, token, userId)\n        .then(userDetail => {\n          if (userDetail) {\n            const titul_pred = userDetail.titul_pred ? userDetail.titul_pred + ' ' : '';\n            const jmeno = userDetail.jmeno || '';\n            const prijmeni = userDetail.prijmeni || '';\n            const titul_za = userDetail.titul_za ? ', ' + userDetail.titul_za : '';\n            const fullName = `${titul_pred}${jmeno} ${prijmeni}${titul_za}`.replace(/\\s+/g, ' ').trim();\n\n            // Ulo do cache\n            setUserNamesCache(prev => ({\n              ...prev,\n              [userId]: fullName\n            }));\n          } else {\n            // Uivatel neexistuje\n            setUserNamesCache(prev => ({\n              ...prev,\n              [userId]: `Uivatel ID ${userId}`\n            }));\n          }\n        })\n        .catch(error => {\n          // Error loading user\n          setUserNamesCache(prev => ({\n            ...prev,\n            [userId]: `Uivatel ID ${userId}`\n          }));\n        });\n    }\n\n    // Mezitm zobraz placeholder\n    return 'Natm...';\n  };\n\n  //  Helper funkce pro validaci ev. sla (EEN PROBLMU #3)\n  const isValidEvCislo = (ev_cislo) => {\n    if (!ev_cislo) return false;\n    if (ev_cislo === 'Natm...') return false;\n    if (typeof ev_cislo === 'string' && ev_cislo.trim() === '') return false;\n    return true;\n  };\n\n  //  useEffect: Nast neaktivnho garanta pokud nen v allUsers (pi editaci)\n  // allUsers nyn obsahuje JEN aktivn uivatele (fetchActiveUsers)\n  // Pokud editujeme objednvku s neaktivnm garantem, musme jej explicitn nast\n  useEffect(() => {\n    const loadGarantOptions = async () => {\n      //  Pokej ne se natou selnky\n      if (!areDictionariesReady || allUsers.length === 0) {\n        return;\n      }\n\n      // 1. Filtruj AKTIVN uivatele z allUsers\n      const activeUsers = allUsers.filter(u => u.aktivni === 1 || u.aktivni === '1' || u.active === 1 || u.active === '1');\n\n      // 2. Pokud NEN editace nebo nen garant, pouij jen aktivn\n      const currentOrderId = formData.id || formData.id;\n\n      if (!formData.garant_uzivatel_id || !currentOrderId) {\n        setGarantOptions(activeUsers);\n        return;\n      }\n\n      // 3. EDITACE: Zkontroluj jestli je garant v aktivnch\n      const garantInActiveList = activeUsers.find(\n        u => (u.id === formData.garant_uzivatel_id || u.user_id === formData.garant_uzivatel_id)\n      );\n\n      if (garantInActiveList) {\n        setGarantOptions(activeUsers);\n        return;\n      }\n\n      // 4. Garant NEN aktivn  zkontroluj jestli je v allUsers (neaktivn)\n      const garantInAllUsers = allUsers.find(\n        u => (u.id === formData.garant_uzivatel_id || u.user_id === formData.garant_uzivatel_id)\n      );\n\n      if (garantInAllUsers) {\n        setGarantOptions([garantInAllUsers, ...activeUsers]);\n        return;\n      }\n\n      // 5. Garant nen ani v allUsers  nati explicitn (star user)\n\n      if (!username || !token) {\n        setGarantOptions(activeUsers);\n        return;\n      }\n\n      try {\n        const inactiveGarantDetail = await getUserDetailApi2(\n          username,\n          token,\n          formData.garant_uzivatel_id\n        );\n\n        if (inactiveGarantDetail) {\n          // Normalizuj formt jako ostatn users z allUsers\n          const normalizedGarant = {\n            id: inactiveGarantDetail.id || inactiveGarantDetail.uzivatel_id,\n            user_id: inactiveGarantDetail.id || inactiveGarantDetail.uzivatel_id,\n            username: inactiveGarantDetail.username || inactiveGarantDetail.login,\n            jmeno: inactiveGarantDetail.jmeno || '',\n            prijmeni: inactiveGarantDetail.prijmeni || '',\n            titul_pred: inactiveGarantDetail.titul_pred || '',\n            titul_za: inactiveGarantDetail.titul_za || '',\n            email: inactiveGarantDetail.email || '',\n            aktivni: 0 // Ozname jako neaktivn\n          };\n\n          // Pidej neaktivnho garanta na zatek seznamu\n          setGarantOptions([normalizedGarant, ...activeUsers]);\n        } else {\n          setGarantOptions(activeUsers);\n        }\n      } catch (error) {\n        setGarantOptions(activeUsers);\n      }\n    };\n\n    loadGarantOptions();\n  }, [formData.garant_uzivatel_id, formData.id, allUsers, formData.id, username, token, areDictionariesReady]);\n\n  //  DEPRECATED: Tyto funkce byly nahrazeny FormDataManager\n  //  ============================================\n  // FAKTURY - Funkce pro sprvu faktur k objednvce\n  // ============================================\n\n  // Naten faktur z API\n  //  FAKTURY jsou nyn soust formData.faktury (natou se s objednvkou z BE)\n\n  //  FUNKCE: Zajist, e vdy existuje alespo jedna faktura ve fzi 7+\n  // Vol se pmo pi renderovn sekce Faktury (ne v useEffect)\n  const ensureFirstInvoiceExists = React.useCallback(() => {\n    if (!formData.id || currentPhase < 7 || fakturyLoading) {\n      return;\n    }\n\n    // Pokud nejsou dn faktury, vytvo prvn\n    if (!formData.faktury || formData.faktury.length === 0) {\n      const dnesniDatum = formatDateForPicker(new Date());\n\n      const novaFaktura = {\n        id: `temp-${Date.now()}`, // Temporary ID\n        objednavka_id: formData.id,\n        fa_datum_doruceni: dnesniDatum,\n        fa_dorucena: 1,\n        fa_castka: '',\n        fa_cislo_vema: '',\n        fa_strediska_kod: formData.strediska_kod || [],\n        fa_splatnost: '',\n        fa_poznamka: '',\n        vytvoril_uzivatel_id: user_id,\n        vytvoril_jmeno: getUserNameById(user_id),\n        dt_vytvoreni: new Date().toISOString(),\n        dt_aktualizace: null,\n        aktivni: 1,\n        _isNew: true\n      };\n\n      updateFaktury([novaFaktura]);\n    }\n  }, [formData.id, currentPhase, fakturyLoading, formData.faktury, formData.strediska_kod, user_id]);\n\n  // Pidat novou fakturu\n  const handleAddFaktura = async () => {\n    if (!formData.id) {\n      showToast && showToast(formatToastMessage('Nejprve ulote objednvku', 'error'), { type: 'error' });\n      return;\n    }\n\n    // Validace povinnch pol\n    if (!fakturaFormData.fa_datum_doruceni || (typeof fakturaFormData.fa_datum_doruceni === 'string' && fakturaFormData.fa_datum_doruceni.trim() === '')) {\n      showToast && showToast('Datum doruen faktury je povinn', { type: 'error' });\n      return;\n    }\n\n    if (!fakturaFormData.fa_castka || parseFloat(fakturaFormData.fa_castka) <= 0) {\n      showToast && showToast('stka faktury je povinn a mus bt vt ne 0', { type: 'error' });\n      return;\n    }\n\n    if (!fakturaFormData.fa_cislo_vema || (typeof fakturaFormData.fa_cislo_vema === 'string' && fakturaFormData.fa_cislo_vema.trim() === '')) {\n      showToast && showToast('Variabiln symbol je povinn', { type: 'error' });\n      return;\n    }\n\n    if (!fakturaFormData.fa_splatnost || (typeof fakturaFormData.fa_splatnost === 'string' && fakturaFormData.fa_splatnost.trim() === '')) {\n      showToast && showToast('Datum splatnosti je povinn', { type: 'error' });\n      return;\n    }\n\n    //  POUZE LOKLN AKTUALIZACE - faktury se ulo s objednvkou\n    //  NEPOTEBUJEME nastavovat fakturant_id ZDE - nastav se automaticky pi uloen objednvky\n\n    //  VYISTIT fa_strediska_kod - zajistit e jsou JEN stringy\n    const cleanedStrediska = Array.isArray(fakturaFormData.fa_strediska_kod)\n      ? fakturaFormData.fa_strediska_kod.map(item => {\n          if (typeof item === 'string') return item;\n          return item.value || item.kod_stavu || item.id || item;\n        })\n      : [];\n\n    // Vytvoit novou fakturu s temp ID\n    const newFaktura = {\n      ...fakturaFormData,\n      id: `temp-${Date.now()}`, // Doasn ID - BE piad sprvn pi uloen objednvky\n      objednavka_id: formData.id,\n      fa_strediska_kod: cleanedStrediska, //  POUT VYITN STRINGY\n      vytvoril_uzivatel_id: user_id,\n      vytvoril_jmeno: getUserNameById(user_id),\n      dt_vytvoreni: new Date().toISOString(),\n      aktivni: 1,\n      _isNew: false, // Oznait jako uloenou (ulo se s objednvkou)\n      // fa_dorucena je VDY 1 (boolean flag e faktura je doruen)\n      fa_dorucena: 1,\n      //  OPRAVA MAPOVN DATUMOVCH POL\n      fa_datum_doruceni: fakturaFormData.fa_dorucena || new Date().toISOString().split('T')[0], // fa_dorucena obsahuje datum doruen!\n      fa_datum_vystaveni: fakturaFormData.fa_datum_vystaveni || new Date().toISOString().split('T')[0], // Pidat datum vystaven\n      fa_datum_splatnosti: fakturaFormData.fa_splatnost || '', // fa_splatnost obsahuje datum splatnosti!\n      //  PLOHY FAKTURY - ukldaj se do konceptu stejn jako prilohy_dokumenty\n      attachments: [], // Pole ploh faktury (formt stejn jako u objednvek)\n      //  NOV: Per-invoice vcn sprvnost (FZE 7/8) - 1:1 s DB\n      vecna_spravnost_umisteni_majetku: fakturaFormData.vecna_spravnost_umisteni_majetku || '',\n      vecna_spravnost_poznamka: fakturaFormData.vecna_spravnost_poznamka || '',\n      vecna_spravnost_potvrzeno: fakturaFormData.vecna_spravnost_potvrzeno || 0\n    };\n\n    // Pidat do formData.faktury\n    const currentFaktury = Array.isArray(formData.faktury) ? formData.faktury : [];\n    updateFaktury([...currentFaktury, newFaktura]);\n\n    // Reset formule s auto-vyplnnm stedisek z objednvky\n    const dnesniDatum = formatDateForPicker(new Date());\n\n    setFakturaFormData({\n      fa_datum_doruceni: dnesniDatum,\n      fa_dorucena: 1, //  Boolean flag\n      fa_castka: '', //  Przdn - uivatel vypln sm\n      fa_cislo_vema: '',\n      fa_strediska_kod: formData.strediska_kod || [],\n      fa_poznamka: '',\n      fa_splatnost: '',\n      //  NOV: Per-invoice vcn sprvnost\n      vecna_spravnost_umisteni_majetku: '',\n      vecna_spravnost_poznamka: '',\n      vecna_spravnost_potvrzeno: 0\n    });\n    setEditingFaktura(null);\n    setShowAddFakturaForm(false);\n\n    showToast && showToast(` Faktura spn pidna\\n ${fakturaFormData.fa_cislo || 'Nov faktura'}\\n Ulo se s objednvkou`, 'success');\n\n    // Spustit autosave po zmn faktur\n    triggerAutosave(true);\n  };\n\n  //  LP ERPN: Nast LP erpn pro fakturu\n  const loadFakturaLPCerpani = useCallback(async (fakturaId) => {\n    // Skip pro temp faktury (jet nejsou v DB)\n    if (!fakturaId || String(fakturaId).startsWith('temp-')) {\n      return;\n    }\n\n    // Skip pokud u je naten\n    if (fakturyLPCerpani[fakturaId]?.loaded) {\n      return;\n    }\n\n    try {\n      const response = await getFakturaLPCerpani(fakturaId, token, username);\n      \n      if (response && response.status === 'ok' && response.data) {\n        setFakturyLPCerpani(prev => ({\n          ...prev,\n          [fakturaId]: {\n            lpCerpani: response.data.lp_cerpani || [],\n            loaded: true\n          }\n        }));\n      }\n    } catch (error) {\n      console.error(' [LP] Chyba pi natn LP erpn:', error);\n      // Oznait jako naten (ale przdn) aby se neopakoval request\n      setFakturyLPCerpani(prev => ({\n        ...prev,\n        [fakturaId]: {\n          lpCerpani: [],\n          loaded: true\n        }\n      }));\n    }\n  }, [token, username, fakturyLPCerpani]);\n\n  //  LP ERPN: Uloit LP erpn faktury\n  const saveFakturaLPCerpaniData = useCallback(async (fakturaId, lpCerpaniData) => {\n    // Skip pro temp faktury\n    if (!fakturaId || String(fakturaId).startsWith('temp-')) {\n      console.warn(' [LP] Nelze uloit LP erpn pro temp fakturu');\n      return false;\n    }\n\n    try {\n      await saveFakturaLPCerpani(fakturaId, lpCerpaniData, token, username);\n      \n      // Aktualizovat lokln state\n      setFakturyLPCerpani(prev => ({\n        ...prev,\n        [fakturaId]: {\n          lpCerpani: lpCerpaniData,\n          loaded: true\n        }\n      }));\n      \n      return true;\n    } catch (error) {\n      console.error(' [LP] Chyba pi ukldn LP erpn:', error);\n      throw error;\n    }\n  }, [token, username]);\n\n  const handleUpdateFaktura = async () => {\n    if (!editingFaktura) return;\n\n    // Validace\n    if (!fakturaFormData.fa_datum_doruceni || (typeof fakturaFormData.fa_datum_doruceni === 'string' && fakturaFormData.fa_datum_doruceni.trim() === '')) {\n      showToast && showToast('Datum doruen faktury je povinn', { type: 'error' });\n      return;\n    }\n\n    if (!fakturaFormData.fa_castka || parseFloat(fakturaFormData.fa_castka) <= 0) {\n      console.groupEnd();\n      showToast && showToast('stka faktury je povinn a mus bt vt ne 0', { type: 'error' });\n      return;\n    }\n\n    if (!fakturaFormData.fa_cislo_vema || (typeof fakturaFormData.fa_cislo_vema === 'string' && fakturaFormData.fa_cislo_vema.trim() === '')) {\n      console.groupEnd();\n      showToast && showToast('Variabiln symbol je povinn', { type: 'error' });\n      return;\n    }\n\n    if (!fakturaFormData.fa_splatnost || (typeof fakturaFormData.fa_splatnost === 'string' && fakturaFormData.fa_splatnost.trim() === '')) {\n      console.groupEnd();\n      showToast && showToast('Datum splatnosti je povinn', { type: 'error' });\n      return;\n    }\n\n    try {\n      // Zkontroluj e faktura m reln ID (ne temp-)\n      const isRealInvoice = editingFaktura.id && !String(editingFaktura.id).startsWith('temp-');\n      \n      if (!isRealInvoice) {\n        console.groupEnd();\n        showToast && showToast(formatToastMessage('Pidejte nejprve plohu faktury', 'error'), { type: 'error' });\n        return;\n      }\n\n      //  VYISTIT fa_strediska_kod - zajistit e jsou JEN stringy\n      const cleanedStrediska = Array.isArray(fakturaFormData.fa_strediska_kod)\n        ? fakturaFormData.fa_strediska_kod.map(item => {\n            if (typeof item === 'string') return item;\n            return item.value || item.kod_stavu || item.id || item;\n          })\n        : [];\n\n      // Piprav data pro API update\n      const updateData = {\n        fa_cislo_vema: fakturaFormData.fa_cislo_vema,\n        fa_datum_vystaveni: fakturaFormData.fa_datum_vystaveni || fakturaFormData.fa_datum_doruceni,\n        fa_castka: fakturaFormData.fa_castka,\n        fa_datum_splatnosti: fakturaFormData.fa_splatnost,\n        fa_datum_doruceni: fakturaFormData.fa_datum_doruceni,\n        fa_dorucena: 1,\n        fa_strediska_kod: JSON.stringify(cleanedStrediska),\n        fa_poznamka: fakturaFormData.fa_poznamka || null,\n        rozsirujici_data: fakturaFormData.rozsirujici_data || null,\n        //  RESET: Pi aktualizaci faktury se zru JEN checkbox (umstn a poznmka zstvaj)\n        vecna_spravnost_umisteni_majetku: fakturaFormData.vecna_spravnost_umisteni_majetku || '',\n        vecna_spravnost_poznamka: fakturaFormData.vecna_spravnost_poznamka || '',\n        vecna_spravnost_potvrzeno: 0,\n        potvrdil_vecnou_spravnost_id: null,\n        dt_potvrzeni_vecne_spravnosti: null\n      };\n\n      // Volej API update\n      const response = await updateInvoiceV2({\n        token,\n        username,\n        invoice_id: editingFaktura.id,\n        updateData\n      });\n\n      // Aktualizovat fakturu v loklnm state\n      const currentFaktury = Array.isArray(formData.faktury) ? formData.faktury : [];\n      const updatedFaktury = currentFaktury.map(faktura =>\n        faktura.id === editingFaktura.id\n          ? {\n              ...faktura,\n              ...fakturaFormData,\n              fa_strediska_kod: cleanedStrediska,\n              dt_aktualizace: new Date().toISOString(),\n              fa_dorucena: 1,\n              fa_datum_doruceni: fakturaFormData.fa_datum_doruceni,\n              fa_datum_vystaveni: fakturaFormData.fa_datum_vystaveni || fakturaFormData.fa_datum_doruceni,\n              fa_datum_splatnosti: fakturaFormData.fa_splatnost\n            }\n          : faktura\n      );\n\n      updateFaktury(updatedFaktury);\n\n      // Reset formule\n      const dnesniDatum = formatDateForPicker(new Date());\n      setFakturaFormData({\n        fa_datum_doruceni: dnesniDatum,\n        fa_dorucena: 1,\n        fa_castka: '',\n        fa_cislo_vema: '',\n        fa_strediska_kod: formData.strediska_kod || [],\n        fa_poznamka: '',\n        fa_splatnost: '',\n        //  NOV: Per-invoice vcn sprvnost\n        vecna_spravnost_umisteni_majetku: '',\n        vecna_spravnost_poznamka: '',\n        vecna_spravnost_potvrzeno: 0\n      });\n      setEditingFaktura(null);\n      setShowAddFakturaForm(false);\n\n      showToast && showToast(` Faktura spn aktualizovna\\n ${fakturaFormData.fa_cislo || 'Faktura'}\\n Zmny uloeny`, 'success');\n\n    } catch (err) {\n      console.group(' CHYBA pi aktualizaci faktury');\n      if (err.response) {\n      }\n      console.groupEnd();\n\n      showToast && showToast(`Chyba pi aktualizaci faktury: ${err.message}`, { type: 'error' });\n    }\n  };\n\n  //  Handler pro vyplnn faktury z ISDOC souboru - NOV ATOMICK WORKFLOW\n  const handleISDOCParsed = (isdocData, realFakturaId) => {\n    const currentFaktury = Array.isArray(formData.faktury) ? formData.faktury : [];\n\n    //  KONTROLA: M se UPDATOVAT existujc faktura?\n    if (isdocData._updateExisting) {\n\n      // UPDATOVAT existujc fakturu novmi daty z ISDOC\n      const updatedFaktury = currentFaktury.map(faktura => {\n        if (Number(faktura.id) === Number(realFakturaId)) {\n          const updated = {\n            ...faktura,\n            //  PEPSAT data z ISDOC\n            fa_cislo_vema: isdocData.fa_cislo_vema || faktura.fa_cislo_vema,\n            fa_datum_vystaveni: isdocData.fa_datum_vystaveni || faktura.fa_datum_vystaveni,\n            fa_datum_zdanitelneho_plneni: isdocData.fa_datum_zdanitelneho_plneni || faktura.fa_datum_zdanitelneho_plneni,\n            fa_datum_splatnosti: isdocData.fa_datum_splatnosti || faktura.fa_datum_splatnosti,\n            fa_splatnost: isdocData.fa_datum_splatnosti || faktura.fa_splatnost,\n            fa_datum_doruceni: isdocData.fa_datum_doruceni || faktura.fa_datum_doruceni,\n            fa_castka: isdocData.fa_castka || faktura.fa_castka,\n            fa_castka_bez_dph: isdocData.fa_castka_bez_dph || faktura.fa_castka_bez_dph,\n            fa_dph: isdocData.fa_dph || faktura.fa_dph,\n            fa_poznamka: isdocData.fa_poznamka || faktura.fa_poznamka,\n            fa_strediska_kod: isdocData.fa_strediska_kod || faktura.fa_strediska_kod,\n            fa_dorucena: 1,\n            dt_aktualizace: new Date().toISOString(),\n            _isdoc_parsed: true,\n            _isdoc_polozky: isdocData._isdoc_polozky,\n            _isdoc_dodavatel: isdocData._isdoc_dodavatel,\n            _isdoc_email: isdocData._isdoc_email,\n            _fromISDOC: true\n          };\n\n          return updated;\n        }\n        return faktura;\n      });\n\n      updateFaktury(updatedFaktury);\n\n      //  NAPLNIT HLAVN POLE FORMDATA\n      setFormData(prev => ({\n        ...prev,\n        cislo_faktury: isdocData.fa_cislo_vema || prev.cislo_faktury,\n        datum_faktury: isdocData.fa_datum_vystaveni || prev.datum_faktury,\n        datum_splatnosti: isdocData.fa_datum_splatnosti || prev.datum_splatnosti,\n        castka_bez_dph: isdocData.fa_castka_bez_dph || prev.castka_bez_dph,\n        castka_s_dph: isdocData.fa_castka || prev.castka_s_dph,\n        _isdocRefresh: Date.now()\n      }));\n\n      // Toast odstrann - uivatel vid vyplnn data v formuli\n      setTimeout(() => triggerAutosave(true), 300);\n\n      return; //  KONEC - faktura byla updatovna\n    }\n\n    //  VYTVOEN NOV FAKTURY (pvodn logika)\n    //  VYTVOEN NOV FAKTURY (pvodn logika)\n\n    // Vytvoit novou fakturu s daty z ISDOC + relnm ID z BE\n    const newFaktura = {\n      id: realFakturaId, //  RELN ID z BE\n      objednavka_id: formData.id,\n      // Data z ISDOC\n      fa_cislo_vema: isdocData.fa_cislo_vema || '',\n      fa_datum_vystaveni: isdocData.fa_datum_vystaveni || '',\n      fa_datum_zdanitelneho_plneni: isdocData.fa_datum_zdanitelneho_plneni || '',\n      fa_datum_splatnosti: isdocData.fa_datum_splatnosti || '',\n      fa_splatnost: isdocData.fa_datum_splatnosti || '',\n      fa_datum_doruceni: isdocData.fa_datum_doruceni || getCurrentDateFormatted(),\n      fa_castka: isdocData.fa_castka || '',\n      fa_castka_bez_dph: isdocData.fa_castka_bez_dph || '',\n      fa_dph: isdocData.fa_dph || '',\n      fa_poznamka: isdocData.fa_poznamka || '',\n      fa_strediska_kod: isdocData.fa_strediska_kod || (Array.isArray(formData.strediska_kod) ? formData.strediska_kod : []),\n      fa_dorucena: 1,\n      // Metadata\n      vytvoril_uzivatel_id: user_id,\n      vytvoril_jmeno: getUserNameById(user_id),\n      dt_vytvoreni: new Date().toISOString(),\n      dt_aktualizace: null,\n      aktivni: 1,\n      _isdoc_parsed: true,\n      _isdoc_polozky: isdocData._isdoc_polozky,\n      _isdoc_dodavatel: isdocData._isdoc_dodavatel,\n      _fromISDOC: true, // Flag pro rozpoznn ISDOC faktury\n      //  NOV: Per-invoice vcn sprvnost (przdn pi ISDOC importu)\n      vecna_spravnost_umisteni_majetku: '',\n      vecna_spravnost_poznamka: '',\n      vecna_spravnost_potvrzeno: 0\n    };\n\n    //  KRITICK OPRAVA: Najdi a odstra vechny temp faktury, pak pidej relnou\n    const updatedFaktury = [\n      ...currentFaktury.filter(f => !String(f.id).startsWith('temp-')), // Odstranit vechny temp faktury\n      newFaktura // Pidat novou relnou fakturu\n    ];\n\n    updateFaktury(updatedFaktury);\n\n    //  Nastavit jako editovanou (aby se zobrazila)\n    setEditingFaktura(newFaktura);\n    setFakturaFormData(newFaktura);\n\n    //  NAPLNIT HLAVN POLE FORMDATA DATA Z ISDOC\n    setFormData(prev => ({\n      ...prev,\n      cislo_faktury: newFaktura.fa_cislo_vema || '',\n      datum_faktury: newFaktura.fa_datum_vystaveni || '',\n      datum_splatnosti: newFaktura.fa_datum_splatnosti || '',\n      castka_bez_dph: newFaktura.fa_castka_bez_dph || '', //  OPRAVEN KL\n      castka_s_dph: newFaktura.fa_castka || '',           //  OPRAVEN KL\n      _isdocRefresh: Date.now()\n    }));\n\n    // Toast odstrann - uivatel vid vyplnn data v formuli\n\n    // Spustit autosave\n    setTimeout(() => triggerAutosave(true), 300);\n  };\n\n  // Smazat fakturu - zobraz confirm dialog\n  const handleDeleteFaktura = async (fakturaId) => {\n    // Najdi fakturu\n    const faktura = formData.faktury?.find(f => f.id === fakturaId);\n    if (!faktura) return;\n\n    // Kontrola ploh - nati ze serveru pokud m reln ID\n    let prilohyCount = 0;\n\n    if (fakturaId && !String(fakturaId).startsWith('temp-')) {\n      try {\n        const response = await listInvoiceAttachments(\n          fakturaId,  // invoiceId\n          username,   // username\n          token,      // token\n          formData.id  // orderId\n        );\n\n        prilohyCount = (response.data?.attachments || response.data || []).length;\n      } catch (err) {\n      }\n    }\n\n    // Zobrazit confirm dialog\n    setDeleteFacturaDialog({\n      isOpen: true,\n      fakturaId: fakturaId,\n      fakturaNazev: faktura.fa_cislo_vema || `Faktura ${faktura.id}`,\n      pocetPriloh: prilohyCount\n    });\n  };\n\n  // Potvrzen smazn faktury z dialogu\n  const confirmDeleteFaktura = async () => {\n    const { fakturaId, fakturaNazev, pocetPriloh } = deleteFacturaDialog;\n\n    // Zavt dialog\n    setDeleteFacturaDialog({ isOpen: false, fakturaId: null, fakturaNazev: '', pocetPriloh: 0 });\n\n    if (!fakturaId) return;\n\n    try {\n      // Kontrola, zda je faktura uloen v DB (reln ID, ne temp-xxx)\n      const isRealInvoice = fakturaId && !String(fakturaId).startsWith('temp-');\n\n      // 1. Pokud m plohy, sma je ze serveru\n      if (isRealInvoice && pocetPriloh > 0) {\n        try {\n          const response = await listInvoiceAttachments(\n            fakturaId,  // invoiceId\n            username,   // username\n            token,      // token\n            formData.id  // orderId\n          );\n\n          const prilohy = response.data?.attachments || response.data || [];\n\n          // Sma kadou plohu\n          for (const priloha of prilohy) {\n            try {\n              await deleteInvoiceAttachment(\n                fakturaId,    // invoiceId\n                priloha.id,   // attachmentId\n                username,     // username\n                token         // token\n              );\n            } catch (err) {\n              // Technick detaily odstranny - uivatel vid jen lidskou zprvu\n              showToast && showToast('Nepodailo se smazat plohu faktury', { type: 'error' });\n            }\n          }\n\n          //  Toast odstrann - uivatel vid, e plohy zmizely ze seznamu\n          // if (prilohy.length > 0) {\n          //   showToast && showToast(`Smazno ${prilohy.length} ploh faktury`, { type: 'success' });\n          // }\n        } catch (err) {\n          showToast && showToast('Nepodailo se smazat plohy faktury', { type: 'error' });\n        }\n      }\n\n      // 2. Pokud je faktura uloen v DB, sma ji ze serveru (hard delete - smae i soubory)\n      if (isRealInvoice) {\n        try {\n          //  V2 API: deleteInvoiceV2(invoiceId, token, username, hardDelete=true)\n          await deleteInvoiceV2(fakturaId, token, username, true);\n          showToast && showToast(` Faktura trvale smazna\\n ${fakturaNazev || 'Faktura'}\\n Vetn ploh`, 'success');\n        } catch (err) {\n          showToast && showToast('Nepodailo se smazat fakturu', { type: 'error' });\n          // Pokrauj i pi chyb - odeber fakturu alespo lokln\n        }\n      }\n\n      // 3. LOKLN ODEBRN - odstranit fakturu ze seznamu\n      const currentFaktury = Array.isArray(formData.faktury) ? formData.faktury : [];\n      const updatedFaktury = currentFaktury.filter(f => f.id !== fakturaId);\n      updateFaktury(updatedFaktury);\n\n      //  Toast odstrann - autosave v pozad, faktura zmizela ze seznamu\n      // if (!isRealInvoice) {\n      //   showToast && showToast('Faktura odebrna - zmna se ulo s objednvkou', { type: 'success' });\n      // }\n\n      // Spustit autosave po smazn faktury\n      triggerAutosave(true);\n\n    } catch (err) {\n      showToast && showToast('Nepodailo se smazat fakturu', { type: 'error' });\n    }\n  };\n\n  // Zat editovat fakturu\n  const handleEditFaktura = (faktura) => {\n    setEditingFaktura(faktura);\n\n    //  PARSOVN stedisek: DB JSON string kd  FE objekty s nzvy\n    let strediskaArray = [];\n    if (faktura.fa_strediska_kod) {\n      if (Array.isArray(faktura.fa_strediska_kod)) {\n        strediskaArray = faktura.fa_strediska_kod; // U je pole objekt\n      } else if (typeof faktura.fa_strediska_kod === 'string') {\n        try {\n          // Parsuj JSON: [\"KLADNO\",\"BENESOV\"] nebo [{kod_stavu, nazev_stavu}]\n          const parsed = JSON.parse(faktura.fa_strediska_kod) || [];\n          // Transformuj kdy na objekty s nzvy\n          strediskaArray = parsed.map(item => {\n            if (typeof item === 'object' && item.kod_stavu) {\n              return item; // U je objekt\n            }\n            // Je to jen kd  najt v options\n            const stredisko = strediskaOptions.find(opt =>\n              opt.kod_stavu === item || opt.kod === item || opt.value === item\n            );\n            return stredisko ? {\n              kod_stavu: stredisko.kod_stavu || stredisko.kod || stredisko.value,\n              nazev_stavu: stredisko.nazev_stavu || stredisko.nazev || stredisko.label\n            } : { kod_stavu: item, nazev_stavu: item };\n          });\n        } catch (e) {\n          // Fallback pro star formt (comma-separated stringy)\n          strediskaArray = faktura.fa_strediska_kod.split(',').map(s => s.trim()).filter(Boolean);\n        }\n      }\n    }\n\n    // Pro nov faktury nebo faktury bez data doruen nastavit dnen datum\n    const dnesniDatum = formatDateForPicker(new Date());\n\n    setFakturaFormData({\n      fa_datum_doruceni: faktura.fa_datum_doruceni || dnesniDatum,\n      fa_dorucena: faktura.fa_dorucena || 1, //  Boolean flag\n      fa_castka: faktura.fa_castka || '', //  Neauto-vyplovat pi editaci\n      fa_cislo_vema: faktura.fa_cislo_vema || '',\n      fa_strediska_kod: strediskaArray,\n      fa_poznamka: faktura.fa_poznamka || '',\n      fa_splatnost: faktura.fa_splatnost || (faktura.fa_datum_splatnosti ? faktura.fa_datum_splatnosti.split(' ')[0] : ''), //  DB -> FE: fa_datum_splatnosti -> fa_splatnost\n      //  NOV: Per-invoice vcn sprvnost\n      vecna_spravnost_umisteni_majetku: faktura.vecna_spravnost_umisteni_majetku || '',\n      vecna_spravnost_poznamka: faktura.vecna_spravnost_poznamka || '',\n      vecna_spravnost_potvrzeno: faktura.vecna_spravnost_potvrzeno || 0\n    });\n    setShowAddFakturaForm(true);\n  };\n\n  // Zruit pidn/editaci faktury\n  const handleCancelFakturaForm = () => {\n    const dnesniDatum = formatDateForPicker(new Date());\n\n    setFakturaFormData({\n      fa_datum_doruceni: dnesniDatum,\n      fa_dorucena: 1, //  Boolean flag\n      fa_castka: '', //  Przdn - uivatel vypln sm\n      fa_cislo_vema: '',\n      fa_strediska_kod: formData.strediska_kod || [],\n      fa_poznamka: '',\n      fa_splatnost: '',\n      //  NOV: Per-invoice vcn sprvnost\n      vecna_spravnost_umisteni_majetku: '',\n      vecna_spravnost_poznamka: '',\n      vecna_spravnost_potvrzeno: 0\n    });\n    setEditingFaktura(null);\n    setShowAddFakturaForm(false);\n  };\n\n  // ========================================\n  // PLOHY FAKTUR - Sprva podle vzoru ploh objednvek\n  // ========================================\n\n  /**\n   * Validace faktury pro pidn ploh\n   * @param {Object} faktura - Objekt faktury\n   * @param {File} file - Nahrvan soubor (voliteln, pro detekci ISDOC)\n   * @returns {Object} { isValid: boolean, valid: boolean, isISDOC: boolean, missingFields: string[], message: string }\n   * \n   * Pravidla:\n   * - ISDOC soubory lze nahrt KDYKOLIV (i bez vyplnnch pol) - automatick vyten hodnot\n   * - Bn soubory vyaduj vyplnn povinn pole (fa_cislo_vema, fa_castka, fa_datum_doruceni, fa_splatnost)\n   */\n  const validateInvoiceForAttachments = useCallback((faktura, file = null) => {\n    const missingFields = [];\n    \n    // Kontrola povinnch pol\n    if (!faktura.fa_cislo_vema || (typeof faktura.fa_cislo_vema === 'string' && faktura.fa_cislo_vema.trim() === '')) {\n      missingFields.push('slo faktury VEMA');\n    }\n    \n    if (!faktura.fa_castka || parseFloat(faktura.fa_castka) <= 0) {\n      missingFields.push('stka');\n    }\n    \n    if (!faktura.fa_datum_doruceni || (typeof faktura.fa_datum_doruceni === 'string' && faktura.fa_datum_doruceni.trim() === '')) {\n      missingFields.push('Datum doruen');\n    }\n    \n    if (!faktura.fa_splatnost || (typeof faktura.fa_splatnost === 'string' && faktura.fa_splatnost.trim() === '')) {\n      missingFields.push('Datum splatnosti');\n    }\n    \n    // Detekce ISDOC souboru\n    const isISDOC = file && (\n      file.name?.toLowerCase().endsWith('.isdoc') ||\n      file.name?.toLowerCase().endsWith('.isdocx') ||\n      file.type === 'text/isdoc'\n    );\n\n    //  ISDOC soubory - vdy povolit (monost vyten hodnot)\n    if (isISDOC) {\n      return {\n        isValid: true,          // Vdy TRUE pro ISDOC\n        valid: true,\n        isISDOC: true,\n        missingFields: missingFields, // Informativn (pro ppadn automatick doplnn)\n        message: missingFields.length > 0 \n          ? 'ISDOC soubor - data lze automaticky vytit po nahrn' \n          : 'ISDOC soubor pipraven k nahrn'\n      };\n    }\n\n    //  Bn soubory - vyadovat vyplnn pole\n    if (missingFields.length > 0) {\n      return {\n        isValid: false,         // FALSE - blokovat nahrvn\n        valid: false,\n        isISDOC: false,\n        missingFields: missingFields,\n        message: `Pro nahrn plohy vyplte nejprve: ${missingFields.join(', ')}`\n      };\n    }\n    \n    //  Vechna pole vyplnna - povolit nahrvn\n    return {\n      isValid: true,\n      valid: true,\n      isISDOC: false,\n      missingFields: [],\n      message: 'Pipraven k nahrn'\n    };\n  }, []);\n\n  /**\n   * Handler pro zmnu ploh faktury\n   * Vol se z InvoiceAttachmentsCompact komponenty\n   * @param {string} fakturaId - ID faktury (temp-xxx nebo reln)\n   * @param {Array} newAttachments - Nov pole ploh\n   */\n  const handleInvoiceAttachmentsChange = useCallback((fakturaId, newAttachments) => {\n    //  OPRAVA: Pokud attachments maj faktura_id, pouij to jako skuten ID\n    let realFakturaId = fakturaId;\n    if (newAttachments && Array.isArray(newAttachments) && newAttachments.length > 0 && newAttachments[0] && newAttachments[0].faktura_id) {\n      realFakturaId = newAttachments[0].faktura_id;\n    }\n\n    //  DETEKCE POKLADNHO DOKLADU podle klasifikace ploh\n    const hasPokladniDoklad = Array.isArray(newAttachments) && newAttachments.some(att => {\n      if (!att) return false;\n      const klasifikace = att.klasifikace || att.typ_prilohy || '';\n      return klasifikace.toLowerCase().includes('pokladn') ||\n             klasifikace.toLowerCase().includes('paragon');\n    });\n\n    //  FUNKN UPDATE - pouij aktuln state, ne closure\n    setFormData(prev => {\n      const updatedFaktury = (prev.faktury || []).map(f => {\n        // Porovnej jak pvodn ID, tak reln ID\n        if (f.id === fakturaId || f.id === realFakturaId || String(f.id) === String(realFakturaId)) {\n          return {\n            ...f,\n            attachments: newAttachments,\n            _isPokladna: hasPokladniDoklad //  Nastavit pznak podle klasifikace\n          };\n        }\n        return f;\n      });\n\n      return { ...prev, faktury: updatedFaktury };\n    });\n\n    // Spustit autosave (plohy se ulo do konceptu)\n    triggerAutosave(true);\n  }, []);\n\n  /**\n   *  Handler pro vytvoen faktury v DB (z temp ID na reln ID)\n   * Vol se z InvoiceAttachmentsCompact pi pokusu o upload plohy s temp ID\n   * @param {string} tempFakturaId - Temp ID faktury (temp-xxx)\n   * @returns {Promise<number>} - Reln ID faktury z DB\n   */\n  const handleCreateInvoiceInDB = useCallback(async (tempFakturaId) => {\n    try {\n      // Najdi fakturu podle temp ID\n      const faktura = formData.faktury?.find(f => f.id === tempFakturaId);\n      if (!faktura) {\n        throw new Error(`Faktura s ID ${tempFakturaId} nebyla nalezena`);\n      }\n\n      // Validace povinnch pol\n      if (!faktura.fa_cislo_vema) {\n        throw new Error('Vyplte slo faktury');\n      }\n      if (!faktura.fa_datum_doruceni) {\n        throw new Error('Vyplte datum doruen');\n      }\n      if (!faktura.fa_castka) {\n        throw new Error('Vyplte stku faktury');\n      }\n      if (!faktura.fa_strediska_kod || faktura.fa_strediska_kod.length === 0) {\n        throw new Error('Vyberte alespo jedno stedisko');\n      }\n\n      // Zkontroluj e objednvka je uloen\n      const orderId = formData.id || formData.id;\n      if (!orderId) {\n        throw new Error('Nejdv ulote objednvku');\n      }\n\n      // Piprav stediska - extrahuj jen kdy z objekt\n      let strediskaKody = [];\n      if (faktura.fa_strediska_kod && Array.isArray(faktura.fa_strediska_kod)) {\n        strediskaKody = faktura.fa_strediska_kod.map(item => {\n          if (typeof item === 'object' && item.kod_stavu) {\n            return item.kod_stavu; // Objekt  extrahuj kod_stavu\n          }\n          return item; // U je string  pouij pmo\n        });\n      }\n\n      //  DEBUG: Payload ped odeslnm\n      const invoicePayload = {\n        token,\n        username,\n        order_id: orderId,\n        fa_cislo_vema: faktura.fa_cislo_vema,\n        fa_datum_vystaveni: faktura.fa_datum_doruceni,\n        fa_castka: faktura.fa_castka,\n        fa_datum_splatnosti: faktura.fa_splatnost || null,\n        fa_datum_doruceni: faktura.fa_datum_doruceni,\n        fa_dorucena: faktura.fa_dorucena || 1,\n        fa_strediska_kod: JSON.stringify(strediskaKody),\n        fa_poznamka: faktura.fa_poznamka || null,\n        rozsirujici_data: faktura.rozsirujici_data || null\n      };\n\n      // Vytvo fakturu v DB pomoc createInvoiceV2\n      const response = await createInvoiceV2(invoicePayload);\n\n      const realFakturaId = response.data?.invoice_id || response.invoice_id;\n      if (!realFakturaId) {\n        throw new Error('Backend nevrtil ID faktury');\n      }\n\n      // Aktualizuj fakturu v state (temp ID  reln ID)\n      setFormData(prev => {\n        const updatedFaktury = (prev.faktury || []).map(f =>\n          f.id === tempFakturaId\n            ? {\n                ...f,\n                id: realFakturaId,\n                _isNew: false // U nen nov, je v DB\n              }\n            : f\n        );\n        return { ...prev, faktury: updatedFaktury };\n      });\n\n      return realFakturaId;\n\n    } catch (err) {\n      console.group(' CHYBA pi vytven faktury v DB');\n      if (err.response) {\n      }\n      console.groupEnd();\n      throw err;\n    }\n  }, [formData, formData.id, token, username]);\n\n  /**\n   * Handler po spnm uploadu plohy faktury\n   * Pokud m faktura temp ID, vytvo fakturu v DB a zsk reln ID\n   * @param {string} fakturaId - ID faktury\n   * @param {object} uploadedAttachment - Nahran ploha\n   */\n  const handleInvoiceAttachmentUploaded = useCallback(async (fakturaId, uploadedAttachment) => {\n    // Pokud je ID temp, musme vytvoit fakturu v DB\n    if (String(fakturaId).startsWith('temp-')) {\n      // Faktura se vytvo v DB pi ptm uloen objednvky (saveOrderToAPI)\n      // Po uloen dostane reln ID a plohy se automaticky propoj\n    }\n\n    // Spustit autosave\n    triggerAutosave(true);\n  }, []);\n\n  // ========================================\n  // KONEC PLOHY FAKTUR\n  // ========================================\n\n  // Automatick vytvoen prvn faktury (pokud nen pokladn objednvka)\n  const ensureMinimalFaktura = () => {\n    // Pouze pokud je objednvka uloen a nen pokladn\n    if (!formData.id) return;\n\n    // Zkontroluj, zda nen pokladn objednvka (kontrola dodavatele atd.)\n    // TODO: Doplnit kontrolu podle logiky dodavatele/pokladny\n\n    if ((formData.faktury?.length || 0) === 0 && !showAddFakturaForm) {\n      const dnesniDatum = formatDateForPicker(new Date());\n\n      // Automaticky otevi formul s pedvyplnnmi stedisky\n      setFakturaFormData({\n        fa_datum_doruceni: dnesniDatum, //  Sprvn pole pro datum\n        fa_dorucena: 1, //  Boolean flag\n        fa_castka: '', //  Przdn - uivatel vypln sm\n        fa_cislo_vema: '',\n        fa_strediska_kod: formData.strediska_kod || [],\n        fa_poznamka: '',\n        fa_splatnost: '',\n        //  NOV: Per-invoice vcn sprvnost\n        vecna_spravnost_umisteni_majetku: '',\n        vecna_spravnost_poznamka: '',\n        vecna_spravnost_potvrzeno: 0\n      });\n      setShowAddFakturaForm(true);\n    }\n  };\n\n  //  ZRUENO: Automatick reinicializace stky faktury pi zmn cen\n  // Uivatel vypln stku run\n  // useEffect(() => {\n  //   if (totalPrice > 0 &&\n  //       (!fakturaFormData.fa_castka || fakturaFormData.fa_castka === '')) {\n  //     const predpokladanaCastka = totalPrice.toString();\n\n  //  AUTOMATICK VYTVOEN PRVN FAKTURY pi zobrazen sekce Fakturace\n  useEffect(() => {\n    // Pouze pokud:\n    // 1. Objednvka je uloen (formData.id)\n    // 2. Pole faktur je przdn\n    // 3. Sekce nen zamen\n    // 4. Jsme ve fzi 7+ (UVEREJNENA - zobrazuje se Fakturace)\n    const faktury = formData.faktury || [];\n\n    if (formData.id &&\n        faktury.length === 0 &&\n        !shouldLockFaktury &&\n        currentPhase >= 7) {\n\n      const dnesniDatum = formatDateForPicker(new Date());\n      const user_id = parseInt(localStorage.getItem('user_id'), 10);\n\n      const firstFaktura = {\n        id: `temp-${Date.now()}`,\n        objednavka_id: formData.id,\n        fa_datum_doruceni: dnesniDatum,\n        fa_dorucena: 1,\n        fa_castka: '',\n        fa_cislo_vema: '',\n        fa_strediska_kod: Array.isArray(formData.strediska_kod) ? formData.strediska_kod : [],\n        fa_poznamka: '',\n        fa_splatnost: '',\n        vytvoril_uzivatel_id: user_id,\n        vytvoril_jmeno: getUserNameById(user_id),\n        dt_vytvoreni: new Date().toISOString(),\n        dt_aktualizace: null,\n        aktivni: 1,\n        _isNew: true,\n        //  NOV: Per-invoice vcn sprvnost\n        vecna_spravnost_umisteni_majetku: '',\n        vecna_spravnost_poznamka: '',\n        vecna_spravnost_potvrzeno: 0\n      };\n\n      // Pidat prvn fakturu do state\n      updateFaktury([firstFaktura]);\n      setEditingFaktura(firstFaktura);\n      setFakturaFormData({\n        fa_datum_doruceni: dnesniDatum,\n        fa_dorucena: 1,\n        fa_castka: '',\n        fa_cislo_vema: '',\n        fa_strediska_kod: formData.strediska_kod || [],\n        fa_poznamka: '',\n        fa_splatnost: '',\n        //  NOV: Per-invoice vcn sprvnost\n        vecna_spravnost_umisteni_majetku: '',\n        vecna_spravnost_poznamka: '',\n        vecna_spravnost_potvrzeno: 0\n      });\n    }\n  }, [formData.id, formData.faktury?.length, shouldLockFaktury, currentPhase]);\n  //     const dnesniDatum = formatDateForPicker(new Date());\n  //\n  //     setFakturaFormData(prev => ({\n  //       ...prev,\n  //       fa_datum_doruceni: prev.fa_datum_doruceni || dnesniDatum,\n  //       fa_dorucena: prev.fa_dorucena || 1,\n  //       fa_castka: predpokladanaCastka\n  //     }));\n  //   }\n  // }, [totalPrice]);\n\n  //  REMOVED: loadStrediska() - DEPRECATED\n  // selnky se nyn nataj pes useFormController  useDictionaries.loadAll()\n\n  //  REMOVED: loadPrilohyTypy() - DEPRECATED\n  // selnky se nyn nataj pes useFormController  useDictionaries.loadAll()\n\n  //  REMOVED: loadDruhyObjednavky() - DEPRECATED\n  // selnky se nyn nataj pes useFormController  useDictionaries.loadAll()\n\n  //  REMOVED: loadFinancovani() - DEPRECATED\n  // selnky se nyn nataj pes useFormController  useDictionaries.loadAll()\n\n  //  REMOVED: loadLpKody() - DEPRECATED\n  // selnky se nyn nataj pes useFormController  useDictionaries.loadAll()\n\n  const loadNextOrderNumber = async () => {\n    //  KRITICK: Next-number jen pro NOV objednvky!\n    // Po uloen do DB  pouvat ev_cislo z DB\n\n    // 1 Zkontrolovat formData.id (uloeno v DB)\n    if (formData.id) {\n      return false;\n    }\n\n    // 2 Zkontrolovat metadata\n    const metadata = draftManager.getMetadata();\n    const isInEditMode = isEditMode || metadata?.isEditMode === true;\n\n    if (isInEditMode) {\n      return false;\n    }\n\n    // 3 Pokud mme ev_cislo (ne \"Natm...\"), skipnout\n    if (formData.ev_cislo && formData.ev_cislo !== 'Natm...') {\n      return false;\n    }\n\n    // 4 Zkontrolovat URL parametry\n    const urlParams = new URLSearchParams(window.location.search);\n    const editOrderId = urlParams.get('edit');\n    if (editOrderId) {\n      return false;\n    }\n\n    //  EEN PROBLMU #1: Aktivuj loading state\n    setIsLoadingEvCislo(true);\n\n    try {\n      //  EEN PROBLMU #2: V2 API s retry mechanismem (bude pidn do apiOrderV2.js)\n      const orderNumberData = await getNextOrderNumberV2(token, username);\n      const nextNumber = orderNumberData.next_order_string || orderNumberData.order_number_string || orderNumberData.next_number;\n\n      if (!nextNumber) {\n        throw new Error(`API nevrtilo next_order_string`);\n      }\n\n      //  DOUBLE CHECK ped nastavenm\n      if (formData.id || isEditMode || metadata?.isEditMode === true || editOrderId) {\n        return false;\n      }\n\n      setFormData(prev => ({\n        ...prev,\n        ev_cislo: nextNumber\n      }));\n\n      return true;\n    } catch (error) {\n\n      //  EEN PROBLMU #1: Fallback na null msto \"Natm...\"\n      setFormData(prev => ({\n        ...prev,\n        ev_cislo: null\n      }));\n\n      //  Zobraz uivateli error toast\n      showToast?.(formatToastMessage('Nepodailo se nast evidenn slo. Zkuste strnku obnovit.', 'error'), { type: 'error' });\n\n      return false;\n    } finally {\n      //  EEN PROBLMU #1: Vdy vypni loading state\n      setIsLoadingEvCislo(false);\n    }\n  };\n\n  // Funkce pro prci s koncepty - ORDER25 SYSTEM\n  const getOrder25DraftKey = () => `order25_draft_new_${user_id}`;\n\n  //  Uloen stavu sekc pes DraftManager\n  const saveSectionStates = (states) => {\n    if (!user_id) return;\n    try {\n      draftManager.saveUIState({ sectionState: states });\n    } catch (error) {\n      // Error saving section states\n    }\n  };\n\n  //  Naten stavu sekc pes DraftManager\n  const loadSectionStates = () => {\n    if (!user_id) return null;\n    try {\n      const uiState = draftManager.getUIState();\n      return uiState?.sectionState || null;\n    } catch (error) {\n      // Error loading section states\n      return null;\n    }\n  };\n\n  //  Uloen pozice scrollu pes DraftManager\n\n  //  Naten pozice scrollu pes DraftManager\n  const loadScrollPosition = () => {\n    if (!user_id) return;\n\n    try {\n      const uiState = draftManager.getUIState();\n      const scrollPos = uiState?.scrollPosition;\n      const scrollElementSelector = uiState?.scrollElementSelector || 'main';\n\n      if (scrollPos !== undefined && scrollPos !== null) {\n        if (!isNaN(scrollPos) && scrollPos > 0) {\n          // Delay pro zajitn, e je obsah naten\n          setTimeout(() => {\n            const targetElement = document.querySelector(scrollElementSelector);\n\n            if (targetElement) {\n              targetElement.scrollTop = scrollPos;\n\n              // Pokud scrollTop zstal 0, zkus scroll pes window\n              if (targetElement.scrollTop === 0 && scrollPos > 0) {\n                window.scrollTo({\n                  top: scrollPos,\n                  left: 0,\n                  behavior: 'instant'\n                });\n\n                // Pokud ani window nefunguje, zkus najt prvn scrollovateln child\n                const scrollableChild = Array.from(targetElement.querySelectorAll('*')).find(el => {\n                  const style = window.getComputedStyle(el);\n                  return style.overflowY === 'auto' || style.overflowY === 'scroll';\n                });\n\n                if (scrollableChild) {\n                  scrollableChild.scrollTop = scrollPos;\n                }\n              }\n            } else {\n              window.scrollTo({\n                top: scrollPos,\n                left: 0,\n                behavior: 'instant'\n              });\n            }\n\n            addDebugLog('success', 'UI', 'scroll-restore', `Obnovena pozice scrollu: ${scrollPos}px`);\n          }, 500);\n        }\n      }\n    } catch (error) {\n      // Error loading scroll position\n    }\n  };\n\n  // Progress indiktor a pesmrovn po spnm uloen\n  //  skipUnlock: Pro ADMIN/SUPERADMIN nezamykme - zstvaj editovat\n  const startSaveProgressAndRedirect = async (orderNumber, orderId, skipUnlock = false) => {\n    //  Toast zprva o spnm uloen\n    showToast && showToast(` Objednvka spn uloena\\n ${orderNumber}\\n Databze aktualizovna`, 'success');\n    \n    //  Spustit progress pes DraftManager (automaticky zake autosave)\n    setShowSaveProgress(true);\n    setSaveProgress(0);\n    setSaveProgressText('Ukldm objednvku...');\n\n    //  KRITICK: Odemkni objednvku PED navigac (AWAIT!) - TUTOVKA!\n    const unlockOrderId = orderId; // NOTE: sourceOrderIdForUnlock removed, using orderId directly\n    if (unlockOrderId && token && username && !skipUnlock) {\n      try {\n        await unlockOrderV2({ token, username, orderId: unlockOrderId });\n      } catch (error) {\n        console.warn(' Unlock FAILED po uloen:', error.message);\n        // Ignoruj chybu odemykn - pokrauj s navigac\n      }\n    }\n    setIsChanged(false);\n\n    //  Spustit progress pes DraftManager\n    const progressControl = draftManager.startProgress({\n      duration: 1000, //  Zkrceno z 3000ms na 1000ms (2 sekundy krat)\n      onProgress: (percent) => {\n        setSaveProgress(percent);\n      },\n      onComplete: () => {\n        //  Uloit highlightOrderId pes DraftManager\n        if (orderNumber && user_id) {\n          draftManager.saveUIState({ highlightOrderId: orderNumber });\n        }\n\n        //  OPRAVEN POAD PRO BN UIVATELE:\n        // 1. Reset MenuBaru PED navigac\n        broadcastOrderState({\n          isEditMode: false,\n          orderId: null,\n          orderNumber: ''\n        });\n\n        // 2. Zruit status editace\n        setIsEditMode(false);\n\n        // 3. Pokej 50ms, aby se broadcast propagoval\n        setTimeout(() => {\n          // 4. Pepnout na seznam objednvek\n          navigate('/orders25-list', { replace: true });\n          \n          // 5. Skrt progress a ukonit ukldn\n          setShowSaveProgress(false);\n          setIsSaving(false);\n        }, 50);\n      }\n    });\n\n    // Uloit control pro mon zruen\n    // (meme pout nap. pi zavrn formule)\n    window._activeProgressControl = progressControl;\n  };\n\n  // Pomocn funkce pro odesln notifikac pi zmnch stavu objednvky\n  //  MIGRACE NA NOV BACKEND API (commit 3a28a99)\n  // Backend automaticky napln 50+ placeholder z order_id\n  //  ROZEN PRAVIDLA NOTIFIKAC (01.11.2025)\n  const sendOrderNotifications = async (orderId, orderNumber, newWorkflowState, oldWorkflowState, formData) => {\n    try {\n      // Pokud se stav nezmnil, nic neposlej\n      if (oldWorkflowState && newWorkflowState === oldWorkflowState) {\n        console.log(' [sendOrderNotifications] Stav se nezmnil, notifikace se neodelou');\n        return;\n      }\n\n\n      //  NOV VERZE - Backend API s automatickmi placeholdery\n\n      // Detekce typu notifikace podle zmny workflow stavu\n      let notificationType = null;\n\n      // === 1. NOV OBJEDNVKA / ODESLNA KE SCHVLEN ===\n      // Pjemci: garant, pkazce, pp. schvalovatel\n      // Vyjmka: pokud je aktuln uivatel pkazcem, dostane notifikaci\n      const hasKeSchvaleni = hasWorkflowState(newWorkflowState, 'ODESLANA_KE_SCHVALENI');\n      const hadKeSchvaleni = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'ODESLANA_KE_SCHVALENI') : false;\n\n      if (hasKeSchvaleni && !hadKeSchvaleni) {\n        notificationType = 'order_status_ke_schvaleni';\n\n\n        if (formData.garant_uzivatel_id) {\n        }\n        if (formData.prikazce_id) {\n        }\n        if (formData.schvalovatel_id) {\n        }\n      }\n\n      // === 2. STAV SCHVLEN - SCHVLENA / ZAMTNUTA ===\n      // Pjemci: vdy objednatel, garant\n      // Pkazce JEN pokud je jin ne schvalovatel\n      const hasSchvalena = hasWorkflowState(newWorkflowState, 'SCHVALENA');\n      const hadSchvalena = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'SCHVALENA') : false;\n\n      const hasZamitnuta = hasWorkflowState(newWorkflowState, 'ZAMITNUTA');\n      const hadZamitnuta = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'ZAMITNUTA') : false;\n\n      if ((hasSchvalena && !hadSchvalena) || (hasZamitnuta && !hadZamitnuta)) {\n        notificationType = hasSchvalena ? 'order_status_schvalena' : 'order_status_zamitnuta';\n\n\n        // Vdy: objednatel a garant\n        if (formData.objednatel_id) {\n        }\n        if (formData.garant_uzivatel_id) {\n        }\n\n        // Pkazce JEN pokud je jin ne schvalovatel\n        if (formData.prikazce_id && formData.schvalovatel_id &&\n            parseInt(formData.prikazce_id) !== parseInt(formData.schvalovatel_id)) {\n        } else if (formData.prikazce_id) {\n        }\n      }\n\n      // Objednvka ek (CEKA_SE) - schvalovatel vrtil k doplnn\n      const hasCekaSe = hasWorkflowState(newWorkflowState, 'CEKA_SE');\n      const hadCekaSe = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'CEKA_SE') : false;\n\n      if (hasCekaSe && !hadCekaSe) {\n        notificationType = 'order_status_ceka_se';\n\n        // Pro ek: objednatel a garant\n        if (formData.objednatel_id) {\n        }\n        if (formData.garant_uzivatel_id) {\n        }\n      }\n\n      // === 3. STAV ODESLN - ODESLANA DODAVATELI ===\n      // Pjemci: VICHNI zastnn (objednatel, garant, pkazce, schvalovatel)\n      // Uniktn *_id - pokud je nkdo ve vce rolch, notifikace jen jednou\n      const hasOdeslana = hasWorkflowState(newWorkflowState, 'ODESLANA');\n      const hadOdeslana = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'ODESLANA') : false;\n\n      if (hasOdeslana && !hadOdeslana) {\n        notificationType = 'order_status_odeslana';\n\n\n        // VICHNI zastnn (Set zajist uniktnost)\n      }\n\n      // === 4. POTVRZEN DODAVATELE - POTVRZENA ===\n      // Pjemci: VICHNI zastnn (objednatel, garant, pkazce, schvalovatel)\n      // Uniktn *_id - pokud je nkdo ve vce rolch, notifikace jen jednou\n      const hasPotvrzena = hasWorkflowState(newWorkflowState, 'POTVRZENA');\n      const hadPotvrzena = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'POTVRZENA') : false;\n\n      if (hasPotvrzena && !hadPotvrzena) {\n        notificationType = 'order_status_potvrzena';\n\n\n        // VICHNI zastnn (Set zajist uniktnost)\n      }\n\n      // === 5. REGISTR - EK NA SCHVLEN ===\n      // TODO: Pokud se m schvalovat, notifikace uivatelm s prvy VEREJNE_ZAKAZKY\n      // Zatm ponechno pro budouc implementaci - vyaduje naten uivatel podle prv\n\n      // === 6. REGISTR - ZVEEJNNA ===\n      // Pjemci: garant, objednatel, pkazce, schvalovatel\n      // Uniktn *_id - pokud je nkdo ve vce rolch, notifikace jen jednou\n      const hasUverejnena = hasWorkflowState(newWorkflowState, 'UVEREJNENA');\n      const hadUverejnena = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'UVEREJNENA') : false;\n\n      if (hasUverejnena && !hadUverejnena) {\n        notificationType = 'order_status_registr_zverejnena'; //  OPRAVENO: pouvat sprvn nzev z DB\n\n\n        // VICHNI zastnn (Set zajist uniktnost)\n      }\n\n      // === 6b. REGISTR - EK NA ZVEEJNN (NEUVEREJNENA) ===\n      // Pjemci: uivatel s prvy VEREJNE_ZAKAZKY + garant\n      const hasNeuverejnena = hasWorkflowState(newWorkflowState, 'NEUVEREJNENA');\n      const hadNeuverejnena = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'NEUVEREJNENA') : false;\n\n      if (hasNeuverejnena && !hadNeuverejnena) {\n        notificationType = 'order_status_registr_ceka';\n\n\n        // Garant + TODO: uivatel s prvy VEREJNE_ZAKAZKY\n      }\n\n      // === 7. FZE FAKTURACE - EK NA FAKTURU ===\n      // Pjemci: garant a objednatel (pokud nen zrove garantem)\n      // Uniktn *_id - pokud je objednatel = garant, notifikace jen jednou\n      const hasFakturace = hasWorkflowState(newWorkflowState, 'FAKTURACE');\n      const hadFakturace = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'FAKTURACE') : false;\n\n      if (hasFakturace && !hadFakturace) {\n        notificationType = 'order_status_faktura_ceka'; //  OPRAVENO: ek na fakturu, ne \"fakturace\"\n\n\n        // Garant a objednatel (Set zajist uniktnost pokud jsou stejn)\n      }\n\n      // === 8. FZE VCN SPRVNOST - EK NA KONTROLU ===\n      // Pjemci: garant a objednatel\n      const hasVecnaSpravnost = hasWorkflowState(newWorkflowState, 'VECNA_SPRAVNOST');\n      const hadVecnaSpravnost = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'VECNA_SPRAVNOST') : false;\n\n      if (hasVecnaSpravnost && !hadVecnaSpravnost) {\n        notificationType = 'order_status_kontrola_ceka';\n\n\n        // Garant a objednatel (Set zajist uniktnost pokud jsou stejn)\n      }\n\n      // === 9. FZE ZKONTROLOVNA (VCN SPRVNOST POTVRZENA) ===\n      // Pjemci: uivatel s rolemi VEREJNE_ZAKAZKY, HLAVNI_UCETNI, ROZPOCTAR\n      // + objednatel (pokud nen zrove garantem)\n      // Vyjmka: NEN ten, kdo vcnou kontrolu provdl\n      // TODO: Vyaduje naten uivatel podle prv - zatm ponechno pro budouc implementaci\n      const hasZkontrolovana = hasWorkflowState(newWorkflowState, 'ZKONTROLOVANA');\n      const hadZkontrolovana = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'ZKONTROLOVANA') : false;\n\n      if (hasZkontrolovana && !hadZkontrolovana) {\n        notificationType = 'order_status_kontrola_potvrzena'; //  OPRAVENO: vcn sprvnost potvrzena\n\n\n        // Objednatel (pokud nen garant - Set zajist uniktnost)\n\n        // TODO: Pidat uivatele s prvy VEREJNE_ZAKAZKY, HLAVNI_UCETNI, ROZPOCTAR\n        // Vyaduje voln API pro zskn uivatel podle prv\n      }\n\n      // === 10. OBJEDNVKA DOKONENA ===\n      // Pjemci: VICHNI zastnn (objednatel, garant, pkazce, schvalovatel)\n      // Uniktn *_id - pokud je nkdo ve vce rolch, notifikace jen jednou\n      const hasDokoncena = hasWorkflowState(newWorkflowState, 'DOKONCENA');\n      const hadDokoncena = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'DOKONCENA') : false;\n\n      if (hasDokoncena && !hadDokoncena) {\n        notificationType = 'order_status_dokoncena';\n\n\n        // VICHNI zastnn (Set zajist uniktnost)\n      }\n\n      // === 11. OBJEDNVKA ZRUENA/STORNOVNA ===\n      const hasZrusena = hasWorkflowState(newWorkflowState, 'ZRUSENA');\n      const hadZrusena = oldWorkflowState ? hasWorkflowState(oldWorkflowState, 'ZRUSENA') : false;\n\n      if (hasZrusena && !hadZrusena) {\n        notificationType = 'order_status_zrusena';\n      }\n\n      console.log(' [sendOrderNotifications] Detekovan typ notifikace:', notificationType);\n\n      // Pokud nebyl detekovn dn typ notifikace, skoni\n      if (!notificationType) {\n        console.log(' [sendOrderNotifications] dn typ notifikace nebyl detekovn, konm');\n        return;\n      }\n\n      console.log(' [sendOrderNotifications] Odeslm notifikace pes NOV org-hierarchy systm...');\n      console.log('    Event Type:', notificationType);\n      console.log('    Order ID:', orderId);\n      console.log('    Trigger User ID:', user_id);\n      console.log('    Backend najde pjemce v org hierarchii automaticky!');\n\n      //  DEPRECATED: Tato funkce u nen poteba - notifikace se odeslaj pmo v saveOrderToAPI\n      // pomoc triggerNotification() s plnmi placeholder daty\n      //  NOV BACKEND API - Org-hierarchy-aware notifications (Generic Recipient System)\n      // Backend automaticky:\n      // 1. Najde aktivn hierarchick profil\n      // 2. Najde template s tmto event typem\n      // 3. Najde edges z template a ur pjemce pomoc resolveRecipients()\n      // 4. Aplikuje scope_filter (PARTICIPANTS_ALL, PARTICIPANTS_PRIKAZCE, LOCATION, etc.)\n      //     DEPRECATED: onlyOrderParticipants, onlyOrderLocation (nahrazeno scope_filter)\n      // 5. Napln placeholdery z order_id pomoc loadOrderPlaceholders()\n      // 6. Odele notifikace s prioritou podle recipientRole (APPROVAL, INFO, EXCEPTIONAL)\n\n      //  DISABLED - Notifikace se odeslaj v saveOrderToAPI s plnmi daty\n      // await notificationService.trigger(eventType, orderId, user_id);\n\n    } catch (error) {\n      console.error(' [sendOrderNotifications] Chyba pi odesln notifikac:', error);\n      // Nezastavuj workflow kvli chyb notifikace\n    }\n  };\n\n  //  CALLBACK: Potvrzen dokonen objednvky (po vygenerovn PDF)\n  const handleConfirmCompletion = async (pdfFile) => {\n    console.log(' [handleConfirmCompletion] Modal se zavel, pokraujem...');\n    \n    // 1. OKAMIT zavt modal a nastavit flag PED volnm save\n    setShowFinancialControlConfirmation(false);\n    setFinancialControlConfirmed(true); //  DLEIT: Nastavit PED saveOrderToAPI()\n    \n    try {\n      // 2. Na pozad nahrt PDF\n      console.log(' Nahrvm PDF...');\n      await uploadOrderAttachment(\n        formData.id,\n        pdfFile,\n        username,\n        token,\n        'KOSILKA',\n        'fk-'\n      );\n      \n      // 3. NYN save - pedm flag pmo jako parametr\n      console.log(' Spoutm save s peskoenm finann kontroly...');\n      await saveOrderToAPI(true); //  Pedm flag pmo\n\n      // 4. Penast plohy aby se zobrazila nov nahran finann kontrola\n      console.log(' Penatm plohy...');\n      await loadAttachmentsSmartly();\n\n      console.log(' Hotovo!');\n      showToast && showToast(' Objednvka dokonena a finann kontrola uloena', { type: 'success' });\n\n    } catch (error) {\n      console.error(' Chyba:', error);\n      showToast && showToast(`Chyba: ${error.message || error}`, { type: 'error' });\n    } finally {\n      // 5. Reset flag na konci (a u spch nebo chyba)\n      setFinancialControlConfirmed(false);\n    }\n  };\n\n  //  CALLBACK: Zruen dokonen objednvky\n  const handleCancelCompletion = () => {\n    try {\n      // 1. Zavt modal a resetovat flag\n      setShowFinancialControlConfirmation(false);\n      setFinancialControlConfirmed(false); //  Reset flag\n\n      // 2. Odkrtnout checkbox - vrtit zpt bez uloen\n      setFormData(prev => ({\n        ...prev,\n        potvrzeni_dokonceni_objednavky: 0\n      }));\n\n      // 3. NEULOIT - uivatel zruil akci, vrtme ho na formul\n      \n      // 4. Toast info\n      showToast && showToast(' Dokonen bylo zrueno, zmny nebyly uloeny', { type: 'info' });\n\n    } catch (error) {\n      console.error('Chyba pi zruen dokonen:', error);\n    }\n  };\n\n  // Uloen objednvky do API (kdy je validn)\n  const saveOrderToAPI = async (skipFinancialControlModal = false) => {\n    \n    if (!token || !username) {\n      showToast && showToast(formatToastMessage('Pro uloen objednvky muste bt pihleni', 'error'), { type: 'error' });\n      return;\n    }\n\n    //  EEN PROBLMU #3: Validace ev_cislo PED uloenm\n    if (!isValidEvCislo(formData.ev_cislo)) {\n      showToast && showToast('Evidenn slo se stle nat. Pokejte prosm na dokonen.', { type: 'warning' });\n      return;\n    }\n\n    //  INTERCEPT: Kontrola zda uivatel chce dokonit objednvku\n    // Pokud je zakrtnut checkbox dokonen a objednvka NEN ve stavu DOKONCENA,\n    // oteve se modal s nhledem finann kontroly ped potvrzenm\n    const jeCheckboxZaskrtnut = formData.potvrzeni_dokonceni_objednavky === 1 || formData.potvrzeni_dokonceni_objednavky === true;\n    const jeUzDokoncena = workflowManager?.hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA') || false;\n    \n    if (jeCheckboxZaskrtnut && !jeUzDokoncena && !financialControlConfirmed && !skipFinancialControlModal) {\n      //  STOP - NEPOKRAOVAT v normlnm save!\n      //  Otevt modal pro potvrzen finann kontroly\n      console.log(' [DOKONCENI] Otevrm modal pro potvrzen finann kontroly...');\n      setShowFinancialControlConfirmation(true);\n      return; // Ukonit - ek se na uivatelovo rozhodnut v modalu\n    }\n\n    //  KRITICK: Vyistit workflow update flag na zatku\n    window.__workflowStateUpdated = false;\n\n    // Nastavit saving state\n    setIsSaving(true);\n\n    //  ARCHIVOVAN OBJEDNVKY: Partial update - jen vyplnn pole\n    if (isArchivedOrder) {\n\n      try {\n        // PARTIAL UPDATE - sestavit orderData STEJN jako u bnch objednvek\n        // Poslat jen skuten DB pole, vyfiltrovat agregovan/potan pole\n        const orderData = {};\n\n        // Zkladn pole - poslat jen pokud jsou vyplnn\n        if (user_id) orderData.uzivatel_id = typeof user_id === 'string' ? parseInt(user_id, 10) : user_id;\n        if (formData.objednatel_id) orderData.objednatel_id = typeof formData.objednatel_id === 'string' ? parseInt(formData.objednatel_id, 10) : formData.objednatel_id;\n        if (formData.predmet) orderData.predmet = formData.predmet;\n        if (formData.garant_uzivatel_id) orderData.garant_uzivatel_id = formData.garant_uzivatel_id;\n        if (formData.prikazce_id) orderData.prikazce_id = formData.prikazce_id;\n        if (formData.max_cena_s_dph) orderData.max_cena_s_dph = formData.max_cena_s_dph;\n        if (formData.druh_objednavky_kod) orderData.druh_objednavky_kod = formData.druh_objednavky_kod;\n        if (formData.poznamka) orderData.poznamka = formData.poznamka;\n\n        // Stediska - normalizovat\n        if (formData.strediska_kod && formData.strediska_kod.length > 0) {\n          orderData.strediska_kod = normalizeStrediskaForBackend(formData.strediska_kod);\n        }\n\n        // Financovn - normalizovat\n        if (formData.zpusob_financovani) {\n          orderData.financovani = normalizeFinancovaniForBackend(formData, financovaniOptions);\n        }\n\n        // Workflow pole\n        if (formData.stav_objednavky) orderData.stav_objednavky = formData.stav_objednavky;\n        if (formData.stav_workflow_kod) orderData.stav_workflow_kod = formData.stav_workflow_kod;\n        if (formData.faze_objednavky) orderData.faze_objednavky = formData.faze_objednavky;\n\n        // Schvlen\n        if (formData.schvalil_uzivatel_id) orderData.schvalil_uzivatel_id = formData.schvalil_uzivatel_id;\n        if (formData.dt_schvaleni) orderData.dt_schvaleni = formData.dt_schvaleni;\n        if (formData.poznamka_schvaleni) orderData.poznamka_schvaleni = formData.poznamka_schvaleni;\n\n        // Vcn sprvnost\n        if (formData.potvrdil_vecnou_spravnost_id) orderData.potvrdil_vecnou_spravnost_id = formData.potvrdil_vecnou_spravnost_id;\n        if (formData.dt_potvrzeni_vecne_spravnosti) orderData.dt_potvrzeni_vecne_spravnosti = formData.dt_potvrzeni_vecne_spravnosti;\n        if (formData.poznamka_vecna_spravnost) orderData.poznamka_vecna_spravnost = formData.poznamka_vecna_spravnost;\n\n        // Poloky (pokud existuj)\n        if (formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n          orderData.polozky = formData.polozky_objednavky.map(polozka => ({\n            popis: polozka.popis || '',\n            //  FIX: Odstranit mezery a formtovn ped parseFloat (parseFloat(\"67 000\") vrac 67, ne 67000!)\n            cena_bez_dph: parseFloat((polozka.cena_bez_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0,\n            sazba_dph: parseInt(polozka.sazba_dph) || 21,\n            cena_s_dph: parseFloat((polozka.cena_s_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0,\n            usek_kod: polozka.usek_kod || null,\n            budova_kod: polozka.budova_kod || null,\n            mistnost_kod: polozka.mistnost_kod || null,\n            poznamka: polozka.poznamka || null,\n            //  LP kd na rovni poloky\n            lp_id: polozka.lp_id ? parseInt(polozka.lp_id) : null\n          }));\n        }\n\n        //  KRITICK: dt_objednavky = aktuln datum a as VDY pi kadm uloen\n        //  Pouij stejnou helper funkci jako v bnm saveOrderToAPI\n        const getMySQLDateTime = () => {\n          const now = new Date();\n          const year = now.getFullYear();\n          const month = String(now.getMonth() + 1).padStart(2, '0');\n          const day = String(now.getDate()).padStart(2, '0');\n          const hours = String(now.getHours()).padStart(2, '0');\n          const minutes = String(now.getMinutes()).padStart(2, '0');\n          const seconds = String(now.getSeconds()).padStart(2, '0');\n          return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n        };\n        const currentDateTime = getMySQLDateTime(); //  LOKLN AS\n        orderData.dt_objednavky = currentDateTime;\n\n        // updateOrderV2 vrac pmo data nebo hod error\n        const updatedOrder = await updateOrderV2(formData.id, orderData, token, username);\n\n        showToast && showToast(` Objednvka spn aktualizovna\\n ${formData.cislo_objednavky || 'Archivovan'}\\n Zmny uloeny`, 'success');\n\n        // Znovu nast aktuln data z DB (pouije se getOrderV2)\n        if (formData.id || formData.id) {\n          const freshOrderData = await getOrderV2(parseInt(formData.id || formData.id), token, username, true);\n\n          if (freshOrderData?.id) {\n            // Aktualizovat formData s novmi daty z DB\n            setFormData(prev => {\n              const updatedData = {\n                ...prev,\n                ...freshOrderData\n              };\n              \n              //  AKTUALIZOVAT SNAPSHOT po spnm uloen archivovan objednvky\n              originalFormDataRef.current = JSON.parse(JSON.stringify(updatedData));\n              \n              return updatedData;\n            });\n\n            // Uloit do konceptu\n            saveDraft(freshOrderData, {\n              isOrderSavedToDB: true,\n              savedOrderId: freshOrderData.id,\n              isChanged: false\n            });\n          }\n        }\n      } catch (error) {\n        showToast && showToast(`Chyba: ${error.message}`, { type: 'error' });\n      } finally {\n        setIsSaving(false);\n        setIsSavingDraft(false);\n      }\n\n      return; //  KONEC pro archivovan objednvky\n    }\n\n    // VALIDACE POUZE PI POKUSU O ULOEN DO DATABZE (bn objednvky)\n    const isValid = validateFormForSave();\n    if (!isValid) {\n      // Chybov zprva se zobraz v validateFormForSave()\n      setIsSaving(false);\n      return;\n    }\n\n    // VALIDACE NADLIMITU - nepovol uloen pokud je pekroen limit\n    const totalPrice = (formData.polozky_objednavky || []).reduce((sum, item) =>\n      sum + (parseFloat(item.cena_s_dph) || 0), 0\n    );\n    const maxPrice = parseFloat(formData.max_cena_s_dph) || 0;\n    const nadlimit = totalPrice - maxPrice;\n\n    if (nadlimit > 0) {\n      showToast && showToast(\n        `Nelze uloit objednvku - pekroen limit o ${nadlimit.toLocaleString('cs-CZ')} K! Upravte poloky nebo zvyte maximln cenu.`,\n        { type: 'error' }\n      );\n\n      // Rozbalit sekci Detail objednvky pokud je sbalen (ale NEAUTOMATICKY scrollovat)\n      if (sectionStates.detaily) {\n        setSectionStates(prev => ({ ...prev, detaily: false }));\n      }\n\n      // KRITICK: Vyistit saving stav pi chyb validace\n      setIsSaving(false);\n      return;\n    }\n\n    try {\n      setIsSavingDraft(true);\n\n      //  HELPER: Jednotn funkce pro generovn datetime v MySQL formtu\n      // Vrac: \"YYYY-MM-DD HH:MM:SS\" (LOKLN as, ne UTC!)\n      const getMySQLDateTime = () => {\n        const now = new Date();\n        const year = now.getFullYear();\n        const month = String(now.getMonth() + 1).padStart(2, '0');\n        const day = String(now.getDate()).padStart(2, '0');\n        const hours = String(now.getHours()).padStart(2, '0');\n        const minutes = String(now.getMinutes()).padStart(2, '0');\n        const seconds = String(now.getSeconds()).padStart(2, '0');\n        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n      };\n\n      //  HELPER: Pouze datum bez asu (LOKLN as, ne UTC!)\n      // Vrac: \"YYYY-MM-DD\"\n      const getMySQLDate = () => {\n        const now = new Date();\n        const year = now.getFullYear();\n        const month = String(now.getMonth() + 1).padStart(2, '0');\n        const day = String(now.getDate()).padStart(2, '0');\n        return `${year}-${month}-${day}`;\n      };\n\n      // KRITICK: Urit role uivatele na zatku - pouv se na vce mstech\n      const isSuperAdmin = userDetail?.roles?.some(role => role.kod_role === 'SUPERADMIN');\n      const isAdmin = userDetail?.roles?.some(role => role.kod_role === 'ADMINISTRATOR');\n      const shouldStayOnForm = isSuperAdmin || isAdmin; // SUPERADMIN/ADMIN zstvaj na formuli\n\n      //  FZE 7: Automaticky nastavit potvrdil_vecnou_spravnost_id a dt_potvrzeni_vecne_spravnosti pi prvnm potvrzen\n      // MUS BT PED sestavenm orderData!\n      let updatedFormData = { ...formData };\n\n      //  DEBUG: Kontrola podmnek pro nastaven ID\n      addDebugLog('info', 'VECNA-SPRAVNOST', 'check-conditions', `Kontrola: checkbox=${formData.potvrzeni_vecne_spravnosti}, existing_id=${formData.potvrdil_vecnou_spravnost_id}, user_id=${user_id}`);\n\n      if ((formData.potvrzeni_vecne_spravnosti === 1 || formData.potvrzeni_vecne_spravnosti === true) &&\n          !formData.potvrdil_vecnou_spravnost_id &&\n          user_id) {\n        const timestamp = getMySQLDateTime(); //  JEDNOTN FORMT\n        updatedFormData.potvrdil_vecnou_spravnost_id = user_id;\n        updatedFormData.dt_potvrzeni_vecne_spravnosti = timestamp;\n        addDebugLog('info', 'VECNA-SPRAVNOST', 'auto-set-id', ` Automaticky nastaveno ped uloenm: user_id=${user_id}, timestamp=${timestamp}`);\n      } else {\n        addDebugLog('warning', 'VECNA-SPRAVNOST', 'auto-set-skip', ` Peskoeno nastaven ID - podmnka nesplnna`);\n      }\n\n      // Pipravm jen vyplnn pole pro API\n      const orderData = {};\n\n      //  KRITICK: ID pihlenho uivatele (VDY povinn)\n      if (user_id) {\n        // Pevst na slo, pokud je to string\n        const uzivatelIdNumber = typeof user_id === 'string' ? parseInt(user_id, 10) : user_id;\n        orderData.uzivatel_id = uzivatelIdNumber;\n        addDebugLog('info', 'SAVE', 'uzivatel-id', `Nastaveno uzivatel_id: ${uzivatelIdNumber} (pvodn typ: ${typeof user_id})`);\n      } else {\n        addDebugLog('error', 'SAVE', 'uzivatel-id-missing', 'user_id chyb v AuthContext');\n      }\n\n      // Zkladn povinn pole\n      if (formData.predmet) orderData.predmet = formData.predmet;\n      if (formData.garant_uzivatel_id) orderData.garant_uzivatel_id = formData.garant_uzivatel_id;\n      if (formData.prikazce_id) orderData.prikazce_id = formData.prikazce_id;\n\n      //  BUGFIX: Objednatel ID - poslat VDY (INSERT i UPDATE)\n      // Pi INSERT: nastavit na user_id (kdo objednvku vytvoil)\n      // Pi UPDATE: zachovat pvodn hodnotu z formData\n      if (!isOrderSavedToDB && user_id) {\n        // INSERT - nov objednvka, objednatel = aktuln uivatel\n        const objednatelIdNumber = typeof user_id === 'string' ? parseInt(user_id, 10) : user_id;\n        orderData.objednatel_id = objednatelIdNumber;\n        addDebugLog('info', 'SAVE', 'objednatel-id', `Nastaveno objednatel_id: ${objednatelIdNumber} (nov objednvka)`);\n      } else if (isOrderSavedToDB && formData.objednatel_id) {\n        // UPDATE - existujc objednvka, zachovat pvodnho objednatele\n        const objednatelIdNumber = typeof formData.objednatel_id === 'string' ? parseInt(formData.objednatel_id, 10) : formData.objednatel_id;\n        orderData.objednatel_id = objednatelIdNumber;\n        addDebugLog('info', 'SAVE', 'objednatel-id-preserved', `Zachovn objednatel_id: ${objednatelIdNumber} (UPDATE objednvky)`);\n      }\n\n      //  STEDISKA: Normalizovat do array string pro backend\n      if (formData.strediska_kod && formData.strediska_kod.length > 0) {\n        orderData.strediska_kod = normalizeStrediskaForBackend(formData.strediska_kod);\n        addDebugLog('info', 'SAVE', 'strediska-normalized', `Stediska: ${JSON.stringify(formData.strediska_kod)} -> ${JSON.stringify(orderData.strediska_kod)}`);\n      }\n\n      if (formData.max_cena_s_dph) orderData.max_cena_s_dph = formData.max_cena_s_dph;\n      \n      // Mimodn udlost (boolean) - OPRAVA: explicitn pevod na boolean\n      orderData.mimoradna_udalost = Boolean(formData.mimoradna_udalost);\n      addDebugLog('info', 'SAVE', 'mimoradna-udalost', `Mimodn udlost: ${formData.mimoradna_udalost} -> ${orderData.mimoradna_udalost}`);\n\n      //  FINANCOVN: Normalizovat do objektu pro backend (VECHNA POLE jdou do financovani objektu!)\n      //  KRITICK OPRAVA: I kdy je pole disabled, MUSME poslat hodnotu!\n      // Disabled pole se neposlaj v HTML form submit, ale zde mme pstup k formData\n      if (formData.zpusob_financovani) {\n        orderData.financovani = normalizeFinancovaniForBackend(formData, financovaniOptions);\n        addDebugLog('info', 'SAVE', 'financovani-normalized', `Financovn: ${JSON.stringify(orderData.financovani)}`);\n      } else {\n        //  OCHRANA: Pokud nen financovn vyplnno, poli null\n        orderData.financovani = null;\n        addDebugLog('warning', 'SAVE', 'financovani-empty', 'Financovn nen vyplnno - poslm null');\n      }\n\n      // Druh objednvky - transformovat na objekt s kod_stavu a nazev_stavu\n      // Pole je vyplovno a ve FZI 3, proto ve fzi 1-2 me bt NULL\n      if (formData.druh_objednavky_kod) {\n        const druhObj = druhyObjednavkyOptions.find(opt =>\n          (opt.kod_stavu && opt.kod_stavu === formData.druh_objednavky_kod) ||\n          (opt.kod && opt.kod === formData.druh_objednavky_kod) ||\n          (opt.value && opt.value === formData.druh_objednavky_kod)\n        );\n\n        const druhObjednavkyObj = {\n          kod_stavu: druhObj?.kod_stavu || druhObj?.kod || druhObj?.value || formData.druh_objednavky_kod,\n          nazev_stavu: druhObj?.nazev_stavu || druhObj?.nazev || druhObj?.label || formData.druh_objednavky_kod\n        };\n\n        orderData.druh_objednavky_kod = JSON.stringify(druhObjednavkyObj);\n        addDebugLog('info', 'SAVE', 'druh-transform', `Transformace druhu objednvky: ${formData.druh_objednavky_kod} -> ${orderData.druh_objednavky_kod}`);\n      } else {\n        // Pokud nen vyplnno (fze 1-2), poslat null (po ALTER TABLE na DB)\n        orderData.druh_objednavky_kod = null;\n        addDebugLog('info', 'SAVE', 'druh-empty', 'Druh objednvky nen vyplnn (fze 1-2) - poslm NULL');\n      }\n\n      // Poloky objednvky - ukldaj se pi UPDATE (existujc objednvka) nebo od FZE 3+\n      // Poslaj se pmo jako pole do root objektu, ne jako JSON string\n      const isUpdateOperation = isOrderSavedToDB && formData.id;\n\n      //  OPRAVA: Pokud existuj poloky, VDY je poslat pi UPDATE (i ve fzi 2)\n      if (isUpdateOperation) {\n        // UPDATE - poslat poloky pokud existuj (i ve fzi 2)\n        if (formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n          orderData.polozky = formData.polozky_objednavky.map(polozka => ({\n            popis: polozka.popis || '',\n            //  FIX: Odstranit mezery a formtovn ped parseFloat (parseFloat(\"67 000\") vrac 67, ne 67000!)\n            cena_bez_dph: parseFloat((polozka.cena_bez_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0,\n            sazba_dph: parseInt(polozka.sazba_dph) || 21,\n            cena_s_dph: parseFloat((polozka.cena_s_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0,\n            //  Voliteln lokalizace (sek, budova, mstnost, poznmka)\n            usek_kod: polozka.usek_kod || null,\n            budova_kod: polozka.budova_kod || null,\n            mistnost_kod: polozka.mistnost_kod || null,\n            poznamka: polozka.poznamka || null,\n            //  LP kd na rovni poloky\n            lp_id: polozka.lp_id ? parseInt(polozka.lp_id) : null\n          }));\n\n          addDebugLog('info', 'SAVE', 'polozky-transform', `Transformace poloek objednvky (UPDATE fze ${currentPhase}): ${formData.polozky_objednavky.length} poloek -> pmo do root jako 'polozky' pole`);\n        } else {\n          // Przdn pole - poslat przdn pole, aby backend vymazal existujc poloky\n          orderData.polozky = [];\n          addDebugLog('warning', 'SAVE', 'polozky-empty', `Poloky jsou przdn (UPDATE fze ${currentPhase}) - poslm przdn pole`);\n        }\n      } else if (currentPhase >= 3 && formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n        // INSERT ve fzi 3+ - poslat poloky\n        orderData.polozky = formData.polozky_objednavky.map(polozka => ({\n          popis: polozka.popis || '',\n          cena_bez_dph: parseFloat((polozka.cena_bez_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0,\n          sazba_dph: parseInt(polozka.sazba_dph) || 21,\n          cena_s_dph: parseFloat((polozka.cena_s_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0,\n          usek_kod: polozka.usek_kod || null,\n          budova_kod: polozka.budova_kod || null,\n          mistnost_kod: polozka.mistnost_kod || null,\n          poznamka: polozka.poznamka || null,\n          lp_id: polozka.lp_id ? parseInt(polozka.lp_id) : null\n        }));\n        addDebugLog('info', 'SAVE', 'polozky-transform-insert', `Transformace poloek objednvky (INSERT fze ${currentPhase}): ${formData.polozky_objednavky.length} poloek`);\n      } else {\n        addDebugLog('info', 'SAVE', 'polozky-skip', `Poloky se neposlaj - INSERT v FZI ${currentPhase}`);\n      }\n\n      // Poznmka objednvky - soust hlavn datov vty\n      if (formData.poznamka_objednavky) {\n        orderData.poznamka = formData.poznamka_objednavky;\n        addDebugLog('info', 'SAVE', 'poznamka-add', `Pidna poznmka objednvky: ${formData.poznamka_objednavky.length} znak`);\n      }\n\n      // Vcn sprvnost - FZE 7 (ukldat VDY, i przdn hodnoty - EXPLICITN)\n      //  KRITICK OPRAVA: Textov pole pouvat z formData (obsahuj aktuln vyplnn hodnoty)\n      // Checkbox a metadata pouvat z updatedFormData (obsahuje nov nastaven ID a timestamp)\n      orderData.vecna_spravnost_umisteni_majetku = formData.vecna_spravnost_umisteni_majetku || '';\n      orderData.vecna_spravnost_poznamka = formData.vecna_spravnost_poznamka || '';\n      //  FIX: Konvertovat przdn string na 0, aby MySQL nepijal nevalidn hodnotu\n      const vecnaSpravnostValue = updatedFormData.potvrzeni_vecne_spravnosti;\n      orderData.potvrzeni_vecne_spravnosti = (vecnaSpravnostValue === 1 || vecnaSpravnostValue === true) ? 1 : 0;\n\n      //  DEBUG: Vcn sprvnost - automatick ID a timestamp (poslat VDY, i null)\n      orderData.potvrdil_vecnou_spravnost_id = updatedFormData.potvrdil_vecnou_spravnost_id || null;\n      orderData.dt_potvrzeni_vecne_spravnosti = updatedFormData.dt_potvrzeni_vecne_spravnosti || null;\n\n      //  DEBUG: Vpis vcn sprvnosti ped odeslnm\n      addDebugLog('info', 'VECNA-SPRAVNOST', 'save-data', `Ukldm vcnou sprvnost: checkbox=${orderData.potvrzeni_vecne_spravnosti}, umisteni=\"${orderData.vecna_spravnost_umisteni_majetku}\", poznamka=\"${orderData.vecna_spravnost_poznamka}\", user_id=${orderData.potvrdil_vecnou_spravnost_id}, dt=${orderData.dt_potvrzeni_vecne_spravnosti}`);\n\n      // Dodac a zrun podmnky\n      if (formData.dt_predpokladany_termin_dodani) orderData.dt_predpokladany_termin_dodani = formData.dt_predpokladany_termin_dodani;\n      if (formData.misto_dodani) orderData.misto_dodani = formData.misto_dodani;\n      if (formData.zaruka) orderData.zaruka = formData.zaruka;\n\n      // Informace o dodavateli\n      if (formData.dodavatel_id) orderData.dodavatel_id = formData.dodavatel_id;\n      if (formData.dodavatel_nazev) orderData.dodavatel_nazev = formData.dodavatel_nazev;\n      if (formData.dodavatel_adresa) orderData.dodavatel_adresa = formData.dodavatel_adresa;\n      if (formData.dodavatel_ico) orderData.dodavatel_ico = formData.dodavatel_ico;\n      if (formData.dodavatel_dic) orderData.dodavatel_dic = formData.dodavatel_dic;\n      if (formData.dodavatel_zastoupeny) orderData.dodavatel_zastoupeny = formData.dodavatel_zastoupeny;\n\n      // Kontaktn osoba dodavatele\n      if (formData.dodavatel_kontakt_jmeno) orderData.dodavatel_kontakt_jmeno = formData.dodavatel_kontakt_jmeno;\n      if (formData.dodavatel_kontakt_email) orderData.dodavatel_kontakt_email = formData.dodavatel_kontakt_email;\n      if (formData.dodavatel_kontakt_telefon) orderData.dodavatel_kontakt_telefon = formData.dodavatel_kontakt_telefon;\n\n      // Kontaktn daje objednatele\n      if (formData.objednatel_jmeno) orderData.objednatel_jmeno = formData.objednatel_jmeno;\n      if (formData.objednatel_email) orderData.objednatel_email = formData.objednatel_email;\n      if (formData.objednatel_telefon) orderData.objednatel_telefon = formData.objednatel_telefon;\n\n      // Popis a poznmky\n      if (formData.popis_pozadavku) orderData.popis_pozadavku = formData.popis_pozadavku;\n      if (formData.poznamky) orderData.poznamky = formData.poznamky;\n\n      // Plohy (pokud existuj)\n      if (formData.prilohy && formData.prilohy.length > 0) {\n        orderData.prilohy = formData.prilohy;\n      }\n\n      //  Schvlen objednvky - SPRVN LOGIKA podle DB struktury\n      // stav_schvaleni NEEXISTUJE v DB! Msto toho pouvme:\n      // 1. schvalovatel_id - ID uivatele, kter schvlil\n      // 2. dt_schvaleni - datum schvlen\n      // 3. stav_workflow_kod - pidme \"SCHVALENA\" do array\n\n      if (formData.dt_schvaleni) orderData.dt_schvaleni = formData.dt_schvaleni;\n\n      // Koment ke schvlen\n      //  Pi schvlen (stav_schvaleni === 'schvaleno') poslat przdn string nebo null\n      // Pro zamtnut a ek_se poslat hodnotu (povinn pole)\n      if (formData.stav_schvaleni === 'schvaleno') {\n        // Pi schvlen VDY poslat przdn string (vymazat koment)\n        orderData.schvaleni_komentar = '';\n      } else if (formData.schvaleni_komentar) {\n        // Pro ostatn stavy poslat hodnotu (pokud existuje)\n        orderData.schvaleni_komentar = formData.schvaleni_komentar;\n      }\n\n      // stav_workflow_kod - SESTAVUJ SPRVNOU POSLOUPNOST PODLE WORKFLOW KONCEPTU\n      // Nati existujc stavy z DB\n      let existingStates = parseWorkflowStates(formData.stav_workflow_kod);\n\n      //  OPRAVA WORKFLOW: ZACHOVAT PEDCHOZ STAVY A PIDVAT NOV (ne pepisovat)\n      // Workflow poad: KE_SCHVALENI  SCHVALENA  ROZPRACOVANA  ODESLANA  POTVRZENA  UVEREJNENA  FAKTURACE  DOKONCENA\n      let workflowStates = [...existingStates]; // Zachovat existujc stavy z DB\n\n      //  KRITICK: Kontrolovat formData.id NEBO formData.id pro rozhodnut INSERT vs UPDATE\n      const hasOrderId = formData.id || formData.id;\n\n      // 1. Prvn uloen do DB (INSERT)\n      if (!hasOrderId) {\n        workflowStates = []; // U novch zat ist\n\n        //  SPRVN LOGIKA: Rozhodnout podle radio buttonu v UI\n        // formData.stav_schvaleni je POUZE UI helper (neukld se do DB!)\n        const approvalChoice = formData.stav_schvaleni; // 'schvaleno', 'neschvaleno', 'ceka_se', nebo ''\n\n        if (approvalChoice === 'schvaleno') {\n          // Okamit schvlen - peskoit ODESLANA_KE_SCHVALENI\n          workflowStates = ['SCHVALENA'];\n          addDebugLog('info', 'SAVE', 'workflow-new', 'INSERT: Okamit schvlen - SCHVALENA');\n        } else {\n          // Normln postup - odesln ke schvlen\n          workflowStates = ['ODESLANA_KE_SCHVALENI'];\n          addDebugLog('info', 'SAVE', 'workflow-new', 'INSERT: Odesln ke schvlen - ODESLANA_KE_SCHVALENI');\n        }\n      } else {\n        //  UPDATE: Oetit star stav NOVA (deprecated) - nahradit za ODESLANA_KE_SCHVALENI\n        if (workflowStates.includes('NOVA') || workflowStates.length === 0 || (workflowStates.length === 1 && workflowStates[0] === 'NOVA')) {\n          workflowStates = workflowStates.filter(s => s !== 'NOVA');\n          if (!workflowStates.includes('ODESLANA_KE_SCHVALENI')) {\n            workflowStates.push('ODESLANA_KE_SCHVALENI');\n            addDebugLog('info', 'SAVE', 'workflow-migration', 'UPDATE: Migrovn star stav NOVA  ODESLANA_KE_SCHVALENI');\n          }\n        }\n      }\n\n      // 2. Schvlen/zamtnut - pepsat JEN vzjemn se vyluujc stavy\n      //  POUV formData.stav_schvaleni POUZE PRO UI LOGIKU (neposl se do DB!)\n      const approvalChoice = formData.stav_schvaleni; // UI helper\n\n      if (approvalChoice === 'schvaleno') {\n        // Odstranit POUZE vyluujc se schvalovac stavy (CEKA_SE, ZAMITNUTA)\n        workflowStates = workflowStates.filter(s => !['ODESLANA_KE_SCHVALENI', 'CEKA_SE', 'ZAMITNUTA'].includes(s));\n        if (!workflowStates.includes('SCHVALENA')) {\n          workflowStates.push('SCHVALENA');\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav SCHVALENA');\n        }\n      } else if (approvalChoice === 'neschvaleno') {\n        // Odstranit POUZE vyluujc se schvalovac stavy (SCHVALENA, CEKA_SE)\n        // POZOR: Pi zamtnut NEODSTRAOVAT dal stavy workflow!\n        workflowStates = workflowStates.filter(s => !['ODESLANA_KE_SCHVALENI', 'CEKA_SE', 'SCHVALENA'].includes(s));\n        if (!workflowStates.includes('ZAMITNUTA')) {\n          workflowStates.push('ZAMITNUTA');\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav ZAMITNUTA');\n        }\n      } else if (approvalChoice === 'ceka_se') {\n        // Odstranit POUZE vyluujc se schvalovac stavy (SCHVALENA, ZAMITNUTA)\n        workflowStates = workflowStates.filter(s => !['ODESLANA_KE_SCHVALENI', 'ZAMITNUTA', 'SCHVALENA'].includes(s));\n        if (!workflowStates.includes('CEKA_SE')) {\n          workflowStates.push('CEKA_SE');\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav CEKA_SE');\n        }\n      }\n\n      // 3. ROZPRACOVANA - FZE 3 rozpracovan (vyluuje se s ODESLANA a ZRUSENA)\n      // Pokud jsme ve FZI 3 (mme SCHVALENA) a NEN zakrtnut checkbox \"Odeslno\" ani \"Stornovno\"\n      //  pidej ROZPRACOVANA (uivatel pracuje na objednvce, ale jet ji neodeslal)\n      //  OPRAVA: NEPIDVAT ROZPRACOVANA pi prvnm schvlen (pouze kdy u byla SCHVALENA pedtm)\n      const wasAlreadyApproved = existingStates?.includes('SCHVALENA') || false;\n      const isJustNowApproved = approvalChoice === 'schvaleno' && !wasAlreadyApproved;\n\n      if (workflowStates.includes('SCHVALENA') &&\n          !formData.stav_odeslano &&\n          !formData.stav_stornovano &&\n          !workflowStates.includes('ROZPRACOVANA') &&\n          !isJustNowApproved) {  //  NOV PODMNKA: nepidvat pi prvnm schvlen\n        // Pidat ROZPRACOVANA (indiktor e se na objednvce pracuje)\n        workflowStates.push('ROZPRACOVANA');\n        addDebugLog('info', 'SAVE', 'workflow-update', ' Pidn stav ROZPRACOVANA - objednvka ve FZI 3, jet neodeslan');\n      }\n\n      // 4. ODESLANA - po odesln dodavateli (nahrazuje ROZPRACOVANA)\n      //  KRITICK: Workflow MUS bt IST [\"SCHVALENA\", \"ODESLANA\"], vymazat vy fze\n      if (formData.stav_odeslano && !formData.stav_stornovano) {\n        // Nastavit ist workflow FZE 4\n        workflowStates = ['SCHVALENA', 'ODESLANA'];\n        addDebugLog('info', 'SAVE', 'workflow-clean', ' Workflow nastaven na istou FZI 4: [\"SCHVALENA\", \"ODESLANA\"]');\n      } else if (!formData.stav_odeslano && workflowStates.includes('ODESLANA')) {\n        // Pokud ODESLANA existuje ale checkbox nen zakrtnut  vrtit na SCHVALENA\n        workflowStates = ['SCHVALENA'];\n        addDebugLog('info', 'SAVE', 'workflow-clean', ' Workflow vrcen na FZI 3: [\"SCHVALENA\"]');\n      }\n\n      // 5. ZRUSENA - pi stornovn\n      if (formData.stav_stornovano) {\n        if (!workflowStates.includes('ZRUSENA')) {\n          workflowStates.push('ZRUSENA');\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav ZRUSENA');\n        }\n        // Pi stornovn odstranit nkter stavy\n        workflowStates = workflowStates.filter(s => !['ROZPRACOVANA', 'ODESLANA', 'POTVRZENA'].includes(s));\n      } else {\n        // Odstranit ZRUSENA pokud nen stornovno\n        workflowStates = workflowStates.filter(s => s !== 'ZRUSENA');\n      }\n\n      // 6. POTVRZENA - potvrzen od dodavatele\n      const isDodavatelPotvrzeno = formData.dodavatel_zpusob_potvrzeni?.potvrzeni === 'ANO' ||\n                                  formData.stav_u_dodavatele === 'potvrzeno';\n      if (isDodavatelPotvrzeno && !formData.stav_stornovano) {\n        if (!workflowStates.includes('POTVRZENA')) {\n          workflowStates.push('POTVRZENA');\n          addDebugLog('info', 'SAVE', 'workflow-update', ' Pidn stav POTVRZENA - dodavatel potvrdil ANO');\n        }\n      } else if (!isDodavatelPotvrzeno) {\n        //  Dodavatel potvrdil NE  vrtit na istou FZI 4 (vymazat vechny vy fze)\n        workflowStates = workflowStates.filter(s =>\n          !['POTVRZENA', 'UVEREJNIT', 'NEUVEREJNIT', 'UVEREJNENA', 'FAKTURACE', 'VECNA_SPRAVNOST', 'ZKONTROLOVANA', 'DOKONCENA'].includes(s)\n        );\n        addDebugLog('info', 'SAVE', 'workflow-clean', ' Dodavatel potvrdil NE - workflow vrcen na FZI 4, vymazny vy fze');\n      }\n\n      // 7. UVEREJNENA - pi rozhodnut o zveejnn v registru smluv\n      // FZE 4: Uivatel s oprvnnm rozhodne ANO/NE pomoc checkboxu \"M bt zveejnna\"\n      //   - Pokud ma_byt_zverejnena = true  UVEREJNIT  FZE 5 (vyplnn datum + IDDT)\n      //   - Pokud ma_byt_zverejnena = false  NEUVEREJNIT  pesko FZI 5  rovnou FZE 6 (Fakturace)\n\n      // UVEREJNOVN - rozhodnut o zveejnn\n      // Logika:\n      // - Pokud dodavatel potvrdil (POTVRZENA) a ma_byt_zverejnena === true  pidat stav 'UVEREJNIT' (posun na fzi 5)\n      // - Pokud dodavatel potvrdil a ma_byt_zverejnena === false  pidat stav 'NEUVEREJNIT' (peskoit na fzi 6 - Fakturace)\n      // - Pokud ma_byt_zverejnena nen definovno, povaovat za false (defaultn chovn)\n      if (workflowStates.includes('POTVRZENA') && !formData.stav_stornovano) {\n        const maBytZverejnena = formData.ma_byt_zverejnena === true || formData.ma_byt_zverejnena === 1;\n\n        if (maBytZverejnena) {\n          // Chceme zveejnit  pidat UVEREJNIT\n          if (!workflowStates.includes('UVEREJNIT')) {\n            // Odstranme ppadn NEUVEREJNIT/UVEREJNENA pro konzistenci\n            workflowStates = workflowStates.filter(s => s !== 'NEUVEREJNIT' && s !== 'UVEREJNENA');\n            workflowStates.push('UVEREJNIT');\n            addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav UVEREJNIT (ma_byt_zverejnena = true)');\n          }\n\n          //  NOV: Pokud je UVEREJNIT a zrove jsou vyplnn datum + IDDT  posun na UVEREJNENA\n          if (workflowStates.includes('UVEREJNIT') && formData.dt_zverejneni && formData.registr_iddt) {\n            // Odstranit UVEREJNIT (u je dokoneno)\n            workflowStates = workflowStates.filter(s => s !== 'UVEREJNIT');\n            // Pidat UVEREJNENA  posun do FZE 6\n            if (!workflowStates.includes('UVEREJNENA')) {\n              workflowStates.push('UVEREJNENA');\n              addDebugLog('info', 'SAVE', 'workflow-update', 'Vyplnn registr smluv (datum + IDDT)  odstrann UVEREJNIT  pidn UVEREJNENA  FZE 6');\n            }\n          }\n        } else {\n          // Nem bt zveejnno (false, 0, undefined, null)  pidat NEUVEREJNIT + FAKTURACE\n          workflowStates = workflowStates.filter(s => s !== 'UVEREJNIT' && s !== 'UVEREJNENA');\n          if (!workflowStates.includes('NEUVEREJNIT')) {\n            workflowStates.push('NEUVEREJNIT');\n            addDebugLog('info', 'SAVE', 'workflow-update', `Pidn stav NEUVEREJNIT (ma_byt_zverejnena = ${formData.ma_byt_zverejnena})`);\n          }\n          //  AUTOMATICKY pidat FAKTURACE (ale ne VECNA_SPRAVNOST - ta se pid a po pidn faktury)\n          if (!workflowStates.includes('FAKTURACE')) {\n            workflowStates.push('FAKTURACE');\n            addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav FAKTURACE (automaticky po NEUVEREJNIT)  ek na pidn faktury');\n          }\n        }\n      }\n\n      // Pokud POTVRZENA zmiz nebo je stornovno, odstranit jakkoliv zveejovac stavy\n      if (!workflowStates.includes('POTVRZENA') || formData.stav_stornovano) {\n        workflowStates = workflowStates.filter(s => !['UVEREJNIT', 'NEUVEREJNIT', 'UVEREJNENA'].includes(s));\n        addDebugLog('info', 'SAVE', 'workflow-update', 'Odebrny zveejovac stavy (nen POTVRZENA nebo je stornovno)');\n      }\n\n      // Urit reim platby (POKLADNA vs FAKTURA) - pouito pro workflow vtven\n      const isPlatbaPokladnaObj = formData.financovani?.platba === 'pokladna';\n      const isPlatbaPokladnaDodavatel = formData.dodavatel_zpusob_potvrzeni?.platba === 'pokladna';\n      const isPokladna = isPlatbaPokladnaObj || isPlatbaPokladnaDodavatel;\n\n      //  POKLADNA: Po ODESLANA automaticky pidat VECNA_SPRAVNOST (pesko POTVRZEN, REGISTR, FAKTURACI)\n      // Pro POKLADNA skeme pmo z FZE 3 (ODESLANA) do FZE 7 (VECNA_SPRAVNOST)\n      if (isPokladna &&\n          (workflowStates.includes('ODESLANA') ||\n           workflowStates.includes('POTVRZENA') ||\n           workflowStates.includes('UVEREJNENA') ||\n           workflowStates.includes('NEUVEREJNIT')) &&\n          !formData.stav_stornovano) {\n        if (!workflowStates.includes('VECNA_SPRAVNOST')) {\n          workflowStates.push('VECNA_SPRAVNOST');\n          addDebugLog('info', 'SAVE', 'workflow-update', ' Reim POKLADNA  pidn stav VECNA_SPRAVNOST (peskoeny fze 4-6)  FZE 7/8');\n        }\n      }\n\n      // 8. FAKTURACE - pi pidn faktury (pouze kdy NEN pokladna)\n      //  Pokud m objednvka faktury  pidat FAKTURACE (pokud jet nen) + VECNA_SPRAVNOST\n      if (!isPokladna && formData.faktury && formData.faktury.length > 0 && !formData.stav_stornovano) {\n        // Ujisti se e m FAKTURACE\n        if (!workflowStates.includes('FAKTURACE')) {\n          workflowStates.push('FAKTURACE');\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav FAKTURACE (m faktury)  FZE 6/8');\n        }\n\n        //  Automaticky pidat VECNA_SPRAVNOST (vcn kontrola) po FAKTURACI - A KDY JSOU FAKTURY\n        if (workflowStates.includes('FAKTURACE') && !workflowStates.includes('VECNA_SPRAVNOST')) {\n          workflowStates.push('VECNA_SPRAVNOST');\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav VECNA_SPRAVNOST (m faktury)  FZE 7/8');\n        }\n      }\n\n      // 8.5. ZKONTROLOVANA - POUZE pokud VECHNY faktury maj potvrzenou per-invoice vcnou sprvnost\n      //  NOV LOGIKA: Kontrola per-invoice checkbox pro KADOU fakturu\n      const allFakturyVecneSpravny = (formData.faktury || []).length > 0 && \n        (formData.faktury || []).every(f => f.vecna_spravnost_potvrzeno === 1 || f.vecna_spravnost_potvrzeno === true);\n      \n      if (allFakturyVecneSpravny && !formData.stav_stornovano) {\n        if (!workflowStates.includes('ZKONTROLOVANA')) {\n          workflowStates.push('ZKONTROLOVANA');\n          addDebugLog('info', 'SAVE', 'workflow-update', ` VECHNY faktury (${formData.faktury.length}x) maj potvrzenou vcnou sprvnost  pidn stav ZKONTROLOVANA  FZE 8/8`);\n        }\n      } else {\n        //  Odebrat ZKONTROLOVANA pokud NEN potvrzena vcn sprvnost VECH faktur\n        // Automaticky se vrt na VECNA_SPRAVNOST  FZE 7/8\n        const hadZkontrolovana = workflowStates.includes('ZKONTROLOVANA');\n        workflowStates = workflowStates.filter(s => s !== 'ZKONTROLOVANA');\n        if (hadZkontrolovana) {\n          const nepotvrzeneFaktury = (formData.faktury || []).filter(f => !(f.vecna_spravnost_potvrzeno === 1 || f.vecna_spravnost_potvrzeno === true)).length;\n          addDebugLog('info', 'SAVE', 'workflow-update', ` NEJSOU potvrzeny vechny faktury (${nepotvrzeneFaktury}x chyb)  odebrn stav ZKONTROLOVANA  nvrat na FZI 7/8`);\n        }\n      }\n\n      // 9. DOKONCENA - pi potvrzen finlnho dokonen checkboxem\n      //  BEZ kontroly na faktury - objednvka me bt dokonen i bez faktur\n      //  Kontrola: ob checkboxy potvrzeny\n      const jeDokonceniPotvrzeno = formData.potvrzeni_dokonceni_objednavky === 1 || formData.potvrzeni_dokonceni_objednavky === true;\n      //  OPRAVA: Kontrolovat AKTULN stav workflowStates (po pidn ZKONTROLOVANA ve)\n      const jeVecnaSprvnostPotvrzena = workflowStates.includes('ZKONTROLOVANA');\n\n      if (jeDokonceniPotvrzeno && jeVecnaSprvnostPotvrzena && !formData.stav_stornovano) {\n        if (!workflowStates.includes('DOKONCENA')) {\n          workflowStates.push('DOKONCENA');\n          addDebugLog('info', 'SAVE', 'workflow-update', 'Pidn stav DOKONCENA - objednvka finln dokonena');\n        }\n\n        //  Automaticky nastavit dokoncil_id a dt_dokonceni pi prvnm potvrzen\n        if (!formData.dokoncil_id) {\n          orderData.dokoncil_id = user_id;\n          orderData.dt_dokonceni = getMySQLDateTime(); //  JEDNOTN FORMT\n          addDebugLog('info', 'SAVE', 'dokonceni', `Nastaveno dokonen objednvky uivatelem ${user_id}`);\n        }\n      } else {\n        // Odstranit DOKONCENA pokud checkbox nen zakrtnut\n        workflowStates = workflowStates.filter(s => s !== 'DOKONCENA');\n      }\n\n      // FINLN KONTROLA A PRAVY\n      // Odstra duplicity (zachovej poad)\n      workflowStates = [...new Set(workflowStates)];\n\n      //  KRITICK OPRAVA: Odstranit STAR/NEPLATN workflow stavy\n      // Odstranit K_DOKONCENI - ji se nepouv, nahrazeno ZKONTROLOVANA + DOKONCENA\n      workflowStates = workflowStates.filter(s => s !== 'K_DOKONCENI');\n\n      // BEZPENOSTN KONTROLA: nikdy przdn pole\n      if (workflowStates.length === 0) {\n        workflowStates = ['NOVA'];\n        addDebugLog('warning', 'SAVE', 'workflow-fallback', 'Przdn workflow - fallback na [NOVA]');\n      }\n\n      // Seadit stavy podle logickho poad (zachovat vznam workflow)\n      const workflowOrder = [\n        'NOVA', 'ODESLANA_KE_SCHVALENI', 'CEKA_SE', 'ZAMITNUTA', 'SCHVALENA',\n        'ROZPRACOVANA', 'ODESLANA', 'ZRUSENA', 'POTVRZENA', 'UVEREJNIT', 'NEUVEREJNIT', 'UVEREJNENA', 'FAKTURACE', 'VECNA_SPRAVNOST', 'ZKONTROLOVANA', 'DOKONCENA'\n      ];\n\n      workflowStates.sort((a, b) => {\n        const indexA = workflowOrder.indexOf(a);\n        const indexB = workflowOrder.indexOf(b);\n        return (indexA === -1 ? 999 : indexA) - (indexB === -1 ? 999 : indexB);\n      });\n\n      orderData.stav_workflow_kod = JSON.stringify(workflowStates);\n\n      //  KRITICK: Nastavit stav_objednavky podle poslednho workflow kdu\n      //  POUV SELNK Z DB msto hardcoded WORKFLOW_STATES\n      if (workflowStates.length > 0) {\n        const lastWorkflowCode = workflowStates[workflowStates.length - 1];\n\n        //  SPRVN: Najdi stav v selnku z DB\n        const stavZCiselniku = stavyWorkflowMap[lastWorkflowCode];\n\n        if (stavZCiselniku) {\n          //  Pouij hodnotu z DB selnku\n          orderData.stav_objednavky = stavZCiselniku.nazev;\n          addDebugLog('info', 'SAVE', 'stav-objednavky', ` Nastaveno stav_objednavky: \"${orderData.stav_objednavky}\" (z DB selnku pro workflow: ${lastWorkflowCode})`);\n        } else {\n          //  FALLBACK: Pokud selnk nen naten nebo chyb kd, pouij hardcoded\n          const workflowState = WORKFLOW_STATES[lastWorkflowCode];\n          orderData.stav_objednavky = workflowState ? workflowState.name : lastWorkflowCode;\n          addDebugLog('warning', 'SAVE', 'stav-objednavky-fallback', ` selnk neobsahuje \"${lastWorkflowCode}\" - pouit fallback: \"${orderData.stav_objednavky}\"`);\n        }\n      } else {\n        orderData.stav_objednavky = 'Nov';\n        addDebugLog('warning', 'SAVE', 'stav-objednavky-fallback', 'Przdn workflow stavy - stav_objednavky: \"Nov\"');\n      }\n\n      //  VDY pedat workflow tracking pol (pokud existuj v formData) - KROM odesilatel_id\n      // odesilatel_id se nastavuje POUZE pi zakrtnut checkboxu \"Odeslano\" (viz ne)\n      // Ostatn pole se zachovaj pi kadm UPDATE\n\n      //  BREAKING CHANGE: potvrdil_id  dodavatel_potvrdil_id\n      if (formData.dodavatel_potvrdil_id !== undefined) orderData.dodavatel_potvrdil_id = formData.dodavatel_potvrdil_id;\n\n      //  NOV WORKFLOW POLE (26.10.2025):\n      // Registr smluv -  VDY nastavit zverejnil_id pi uloen pokud existuje dt_zverejneni a registr_iddt\n      if (formData.dt_zverejneni && formData.registr_iddt) {\n        // Pokud jet nen zverejnil_id, nastav aktulnho uivatele\n        if (!formData.zverejnil_id) {\n          orderData.zverejnil_id = user_id;\n          addDebugLog('info', 'SAVE', 'registr-tracking', `Automaticky nastaven zverejnil_id: ${user_id}`);\n        } else {\n          // Zachovat existujc hodnotu\n          orderData.zverejnil_id = formData.zverejnil_id;\n        }\n      } else if (formData.zverejnil_id !== undefined) {\n        // Zachovat hodnotu pokud nen podmnka splnna\n        orderData.zverejnil_id = formData.zverejnil_id;\n      }\n\n      if (formData.dt_zverejneni_potvrzeni) orderData.dt_zverejneni_potvrzeni = formData.dt_zverejneni_potvrzeni;\n\n      // Vcn sprvnost - FZE 7 (vdy ukldat, i null hodnoty)\n      orderData.potvrdil_vecnou_spravnost_id = formData.potvrdil_vecnou_spravnost_id !== undefined ? formData.potvrdil_vecnou_spravnost_id : null;\n      orderData.dt_potvrzeni_vecne_spravnosti = formData.dt_potvrzeni_vecne_spravnosti || null;\n\n      // Fakturace -  VDY aktualizovat pi uloen ve fzi fakturace (posledn uivatel)\n      if (formData.faktury && formData.faktury.length > 0 && workflowStates.includes('FAKTURACE')) {\n        // Aktualizovat fakturant_id a dt_faktura_pridana pi kadm uloen ve fzi fakturace\n        orderData.fakturant_id = user_id;\n        orderData.dt_faktura_pridana = getMySQLDateTime(); //  JEDNOTN FORMT\n        addDebugLog('info', 'SAVE', 'fakturace-tracking', `Aktualizovn fakturant_id: ${user_id}, dt_faktura_pridana: ${orderData.dt_faktura_pridana}`);\n      } else {\n        // Zachovat existujc hodnoty pokud nejsme ve fzi fakturace\n        if (formData.fakturant_id !== undefined) orderData.fakturant_id = formData.fakturant_id;\n        if (formData.dt_faktura_pridana) orderData.dt_faktura_pridana = formData.dt_faktura_pridana;\n      }\n\n      // Dokonen - FZE 8 (vdy ukldat, i null hodnoty)\n      orderData.dokoncil_id = formData.dokoncil_id !== undefined ? formData.dokoncil_id : null;\n      orderData.dt_dokonceni = formData.dt_dokonceni || null;\n      orderData.dokonceni_poznamka = formData.dokonceni_poznamka !== undefined ? formData.dokonceni_poznamka : '';\n      //  FIX: Konvertovat przdn string na 0, aby MySQL nepijal nevalidn hodnotu\n      const dokonceniValue = formData.potvrzeni_dokonceni_objednavky;\n      orderData.potvrzeni_dokonceni_objednavky = (dokonceniValue === 1 || dokonceniValue === true) ? 1 : 0;\n\n      addDebugLog('info', 'SAVE', 'tracking-fields', `Workflow tracking pole: dodavatel_potvrdil=${orderData.dodavatel_potvrdil_id}, zverejnil=${orderData.zverejnil_id}, vecna_spravnost=${orderData.potvrdil_vecnou_spravnost_id}, fakturant=${orderData.fakturant_id}, dokoncil=${orderData.dokoncil_id}`);\n\n      // Storno metadata - pouze pokud je stornovno (dt_odeslani se e ve)\n      if (formData.stav_stornovano) {\n        if (formData.storno_uzivatel_id) orderData.storno_uzivatel_id = formData.storno_uzivatel_id;\n        if (formData.storno_provedl) orderData.storno_provedl = formData.storno_provedl;\n        // odeslani_storno_duvod se e v sekci dt_odeslani ve\n        // datum_storna se mapuje na dt_odeslani ve\n      }\n\n      // dt_odeslani se pouv jak pro odesln, tak pro storno\n      //  DLEIT: Workflow data mnit POUZE pokud je sekce ODEMEN!\n      if (formData.stav_odeslano || formData.stav_stornovano) {\n        // Kontrola: je sekce FZE 3 odemen?\n        const isPhase3Unlocked = !shouldLockPhase3Sections;\n\n        if (isPhase3Unlocked) {\n          // Sekce je ODEMEN - meme mnit workflow data\n          //  odesilatel_id nastavit POUZE pokud jet neexistuje (pi prvnm odesln/stornu)\n          if (!formData.odesilatel_id && user_id) {\n            orderData.odesilatel_id = user_id;\n            addDebugLog('info', 'SAVE', 'odesilatel-tracking-new', `Uloen NOV odesilatel_id: ${user_id} (prvn odesln/storno)`);\n          } else if (formData.odesilatel_id) {\n            // odesilatel_id ji existuje - ZACHOVAT pvodn hodnotu\n            orderData.odesilatel_id = formData.odesilatel_id;\n            addDebugLog('info', 'SAVE', 'odesilatel-tracking-preserve', `ZACHOVN pvodn odesilatel_id: ${formData.odesilatel_id}`);\n          }\n\n          // Pro ODESLN: nastavit datum odesln a smazat dvod storna\n          if (formData.stav_odeslano && !formData.stav_stornovano) {\n            //  Datum odesln nastavit POUZE pokud jet neexistuje (pi prvnm odesln)\n            if (!formData.dt_odeslani) {\n              const datumOdeslani = formData.datum_odeslani || getMySQLDate(); //  JEDNOTN FORMT\n              orderData.dt_odeslani = datumOdeslani;\n              addDebugLog('info', 'SAVE', 'odeslani-datum-new', `Nastaveno NOV dt_odeslani: ${datumOdeslani}`);\n            } else {\n              // Datum ji existuje - ZACHOVAT pvodn hodnotu\n              orderData.dt_odeslani = formData.dt_odeslani;\n              addDebugLog('info', 'SAVE', 'odeslani-datum-preserve', `ZACHOVNO pvodn dt_odeslani: ${formData.dt_odeslani}`);\n            }\n            orderData.odeslani_storno_duvod = ''; // Vymazat dvod storna pi odesln\n          }\n          // Pro STORNO: nastavit datum storna a zachovat dvod storna\n          else if (formData.stav_stornovano) {\n            //  Datum storna nastavit POUZE pokud jet neexistuje (pi prvnm stornovn)\n            if (!formData.dt_odeslani) {\n              const datumStorna = formData.datum_storna || getMySQLDate(); //  JEDNOTN FORMT\n              orderData.dt_odeslani = datumStorna;\n              addDebugLog('info', 'SAVE', 'storno-datum-new', `Nastaveno NOV dt_odeslani pro STORNO: ${datumStorna}`);\n            } else {\n              // Datum ji existuje - ZACHOVAT pvodn hodnotu\n              orderData.dt_odeslani = formData.dt_odeslani;\n              addDebugLog('info', 'SAVE', 'storno-datum-preserve', `ZACHOVNO pvodn dt_odeslani pro STORNO: ${formData.dt_odeslani}`);\n            }\n            if (formData.odeslani_storno_duvod) orderData.odeslani_storno_duvod = formData.odeslani_storno_duvod;\n\n            addDebugLog('info', 'SAVE', 'storno-datum', `Uloeno STORNO s dvodem: ${formData.odeslani_storno_duvod}`);\n          }\n        } else {\n          // Sekce je ZAMEN - ZACHOVAT vechny existujc workflow hodnoty beze zmny!\n          if (formData.odesilatel_id) orderData.odesilatel_id = formData.odesilatel_id;\n          if (formData.dt_odeslani) orderData.dt_odeslani = formData.dt_odeslani;\n          if (formData.odeslani_storno_duvod) orderData.odeslani_storno_duvod = formData.odeslani_storno_duvod;\n          addDebugLog('info', 'SAVE', 'odeslani-locked', `FZE 3 ZAMEN - workflow data zachovna beze zmny`);\n        }\n      } else {\n        //  Pokud NEN zakrtnut ANI \"Odeslano\" ANI \"Stornovno\"  vymazat odesilatel_id\n        // (objednvka se vrac do stavu \"neodeslna\")\n        orderData.odesilatel_id = null;\n        addDebugLog('info', 'SAVE', 'odesilatel-reset', `Vymazn odesilatel_id - objednvka nen odeslna ani stornovna`);\n      }\n\n      //  OPRAVA: dodavatel_zpusob_potvrzeni ukldat pokud je workflow >= POTVRZENA\n      // Pokud je sekce ODEMEN (editovateln)  ukldat NOV hodnoty z formule\n      // Pokud je sekce ZAMEN  zachovat hodnotu z DB\n      const hasPotvrzena = existingStates.includes('POTVRZENA') || workflowStates.includes('POTVRZENA');\n      \n      if (hasPotvrzena) {\n        // FZE 4+ - ukldat podle toho jestli je sekce odemen\n        const isSectionUnlocked = !shouldLockPhase4to6Sections;\n        \n        if (isSectionUnlocked) {\n          //  SEKCE ODEMEN  ukldat NOV hodnoty z formule\n          const potvrzeniData = formData.dodavatel_zpusob_potvrzeni || {};\n          const potvrzeni = potvrzeniData.potvrzeni || 'NE';\n          \n          const dataToSave = {\n            potvrzeni: potvrzeni,\n            zpusoby: Array.isArray(potvrzeniData.zpusoby) ? potvrzeniData.zpusoby : [],\n            platba: potvrzeniData.platba || ''\n          };\n          \n          orderData.dodavatel_zpusob_potvrzeni = JSON.stringify(dataToSave);\n          \n          addDebugLog('info', 'SAVE', 'dodavatel-potvrzeni-unlocked', `Sekce odemen - Uloeno: ${orderData.dodavatel_zpusob_potvrzeni}`);\n        } else {\n          //  SEKCE ZAMEN  ZACHOVAT hodnotu z DB (nebo z formData pokud original chyb)\n          if (formData.dodavatel_zpusob_potvrzeni_original) {\n            orderData.dodavatel_zpusob_potvrzeni = formData.dodavatel_zpusob_potvrzeni_original;\n          } else if (formData.dodavatel_zpusob_potvrzeni) {\n            // Fallback: pokud original chyb, pouij aktuln hodnotu\n            orderData.dodavatel_zpusob_potvrzeni = JSON.stringify(formData.dodavatel_zpusob_potvrzeni);\n          }\n          addDebugLog('info', 'SAVE', 'dodavatel-potvrzeni-locked', `Sekce zamen - Hodnota zachovna`);\n        }\n      } else {\n        // FZE 3 nebo ni - NEPOSLAT pole\n        addDebugLog('info', 'SAVE', 'dodavatel-potvrzeni-skip', `FZE 3- - Peskoeno`);\n      }\n\n      // Akceptace a zveejnn\n      //  OPRAVA: Konvertovat datetime hodnoty do MySQL formtu (odstranit timezone a ms)\n      if (formData.dt_akceptace) {\n        // Pokud obsahuje 'T' (ISO format), extrahovat jen datum nebo datum+as bez timezone\n        const akceptaceValue = String(formData.dt_akceptace);\n        if (akceptaceValue.includes('T')) {\n          // ISO format: 2025-12-05T16:57:42.491Z -> 2025-12-05 nebo 2025-12-05 16:57:42\n          orderData.dt_akceptace = akceptaceValue.split('.')[0].replace('T', ' ').replace('Z', '');\n        } else {\n          orderData.dt_akceptace = akceptaceValue;\n        }\n      }\n      if (formData.dt_zverejneni) {\n        const zverejneniValue = String(formData.dt_zverejneni);\n        if (zverejneniValue.includes('T')) {\n          orderData.dt_zverejneni = zverejneniValue.split('.')[0].replace('T', ' ').replace('Z', '');\n        } else {\n          orderData.dt_zverejneni = zverejneniValue;\n        }\n      }\n      if (formData.registr_iddt) orderData.registr_iddt = formData.registr_iddt;\n\n      //  SMAZNO: dt_splatnosti pat k FAKTUE, ne k objednvce!\n      // Pole dt_splatnosti neexistuje v tabulce objednavky25, zpsobovalo SQL error\n\n      //  KRITICK: dt_objednavky = aktuln datum a as VDY pi kadm uloen (CREATE i UPDATE)\n      // Toto pole slou jako timestamp posledn zmny objednvky\n      //  OPRAVA: Pout LOKLN as, ne UTC!\n      const currentDateTime = getMySQLDateTime(); //  LOKLN AS\n      orderData.dt_objednavky = currentDateTime;\n      \n      if (!isOrderSavedToDB) {\n        addDebugLog('info', 'SAVE', 'datum-vytvoreni', `Nov objednvka - dt_objednavky: ${currentDateTime}`);\n      } else {\n        addDebugLog('info', 'SAVE', 'datum-zmeny', `UPDATE objednvky - dt_objednavky aktualizovno na: ${currentDateTime}`);\n      }\n\n      // schvalovatel_id - pro NOVA neposlat vbec, jinak mus bt platn slo\n      if (!workflowStates.includes('NOVA')) {\n        // Pouze pokud NEN stav NOVA a mme platn ID\n        if (formData.schvalovatel_id && formData.schvalovatel_id > 0) {\n          orderData.schvalovatel_id = formData.schvalovatel_id;\n        }\n        //  Pokud nen NOVA ale schvalovatel_id chyb, nechme pole przdn\n        // Backend si porad s tm, e pole nen v requestu (partial update)\n      }\n      //  Pro stav NOVA: NEPOSLAT schvalovatel_id vbec (ani null, ani '')\n\n      //  FAKTURY - poslat do payload pro uloen s objednvkou (Backend si porad s uloenm)\n      // Faktury jsou v samostatn tabulce, ale BE potebuje data pro update/create pes sv faktury API\n      if (formData.faktury && formData.faktury.length > 0) {\n        orderData.faktury = formData.faktury.map((faktura, index) => {\n          let strediskaArray = [];\n          if (faktura.fa_strediska_kod && Array.isArray(faktura.fa_strediska_kod) && faktura.fa_strediska_kod.length > 0) {\n            // Extrahuj jen kdy (kod_stavu) z objekt\n            strediskaArray = faktura.fa_strediska_kod.map(item => {\n              if (typeof item === 'object' && item.kod_stavu) {\n                return item.kod_stavu; // Objekt  extrahuj kod_stavu\n              }\n              return item; // U je string  pouij pmo\n            });\n\n            //  DEBUG: Transformace stedisek\n          }\n\n          //  KRITICK: Pokud m faktura reln ID (ne temp-), musme ho poslat pro UPDATE!\n          const hasRealId = faktura.id && !String(faktura.id).startsWith('temp-');\n          const fakturaId = hasRealId ? Number(faktura.id) : null;\n\n          const fakturaData = {\n            id: fakturaId,                                                    //  POSLAT ID - pokud je NULL, BE vytvo novou, jinak UPDATE\n            fa_castka: String(parseFloat(faktura.fa_castka) || 0),           //  V2 API: VDY STRING pro pesnost!\n            fa_cislo_vema: faktura.fa_cislo_vema || '',                       // POVINN - slo faktury (me bt '')\n            fa_dorucena: 1,                                                   // POVINN - 0 nebo 1 (boolean)\n            fa_datum_vystaveni: faktura.fa_datum_vystaveni || new Date().toISOString().split('T')[0], // DLEIT - datum vystaven\n            fa_datum_splatnosti: faktura.fa_splatnost || faktura.fa_datum_splatnosti || '', //  FE -> DB: fa_splatnost -> fa_datum_splatnosti (obousmrn mapping)\n            fa_datum_doruceni: (typeof faktura.fa_datum_doruceni === 'string' && faktura.fa_datum_doruceni.match(/^\\d{4}-\\d{2}-\\d{2}$/))\n              ? faktura.fa_datum_doruceni\n              : new Date().toISOString().split('T')[0], //  OPRAVA: Pout jen pokud je validn datum\n            fa_strediska_kod: strediskaArray,                                 //  POLE KD: [\"KLADNO\",\"BENESOV\",\"BEROUN\"]\n            fa_poznamka: faktura.fa_poznamka || '',                           // VOLITELN - poznmka\n            //  NOV: Per-invoice vcn sprvnost (FZE 7/8) - 1:1 DB mapping\n            vecna_spravnost_umisteni_majetku: faktura.vecna_spravnost_umisteni_majetku || '',\n            vecna_spravnost_poznamka: faktura.vecna_spravnost_poznamka || '',\n            vecna_spravnost_potvrzeno: (faktura.vecna_spravnost_potvrzeno === 1 || faktura.vecna_spravnost_potvrzeno === true) ? 1 : 0,\n            potvrdil_vecnou_spravnost_id: faktura.potvrdil_vecnou_spravnost_id || null,\n            dt_potvrzeni_vecne_spravnosti: faktura.dt_potvrzeni_vecne_spravnosti || null,\n            rozsirujici_data: faktura._isPokladna\n              ? {\n                  //  POKLADN DOKLAD - JEN nov data (BEZ spreadu!)\n                  typ_platby: 'pokladna',\n                  pokladni_doklad: {\n                    datum_vytvoreni: faktura.dt_vytvoreni || new Date().toISOString(),\n                    poznamka: faktura.fa_poznamka || '',\n                    prilohy_count: faktura.attachments?.length || 0,\n                    vytvoril_uzivatel_id: faktura.vytvoril_uzivatel_id,\n                    vytvoril_jmeno: faktura.vytvoril_jmeno\n                  }\n                }\n              : faktura._fromISDOC && faktura._isdoc_polozky\n                ? {\n                    // ISDOC FAKTURA - JEN nov data (BEZ spreadu!)\n                    typ_platby: 'faktura',\n                    isdoc: {\n                      cislo_faktury: faktura.fa_cislo_vema,\n                      datum_vystaveni: faktura.fa_datum_vystaveni,\n                      datum_splatnosti: faktura.fa_datum_splatnosti,\n                      castka_s_dph: faktura.fa_castka,\n                      castka_bez_dph: faktura.fa_castka_bez_dph,\n                      dph_celkem: faktura.fa_dph,\n                      polozky: faktura._isdoc_polozky,\n                      dodavatel: faktura._isdoc_dodavatel\n                    }\n                  }\n                : {\n                    // STANDARDN FAKTURA - minimln data\n                    typ_platby: 'faktura'\n                  }\n          };\n          \n\n          \n          return fakturaData;\n        });\n        addDebugLog('info', 'SAVE', 'faktury-transform', `Pidno ${formData.faktury.length} faktur do payload`);\n        addDebugLog('info', 'SAVE', 'faktury-detail', `Detaily faktur: ${JSON.stringify(formData.faktury, null, 2)}`);\n      } else {\n        orderData.faktury = []; // Przdn pole = dn faktury\n        addDebugLog('info', 'SAVE', 'faktury-empty', 'dn faktury k uloen');\n      }\n      //  POZNMKA: Backend si porad s uloenm faktur pes sv faktury API\n      //              Frontend jen pedv data, BE e persist do faktury25 tabulky\n      \n      let result;\n      let orderId;              // Deklarace na rovni celho bloku\n      let orderNumber;          // Deklarace na rovni celho bloku\n      let updatedFormDataImmediate;  // Deklarace na rovni celho bloku\n\n      //  hasOrderId je ji deklarovn ve (ped workflow logikou na dku ~6567)\n      // POUIJ ho pro rozhodnut INSERT vs UPDATE\n\n      if (!hasOrderId) {\n        //  V2 API: Prvn uloen - vytvoen nov objednvky\n        addDebugLog('info', 'SAVE-V2', 'create-start', 'Volm createOrderV2()');\n\n        //  FZE 1: Omezit pole na pouze zkladn daje (BEZ faktur!)\n        if (currentPhase === 1) {\n          const phase1Fields = [\n            'uzivatel_id', 'objednatel_id', 'predmet', 'garant_uzivatel_id',\n            'prikazce_id', 'strediska_kod', 'max_cena_s_dph', 'financovani',\n            'druh_objednavky_kod', 'stav_workflow_kod', 'stav_objednavky', 'dt_objednavky',\n            'mimoradna_udalost'  //  EMERGENCY FLAG\n          ];\n\n          Object.keys(orderData).forEach(key => {\n            if (!phase1Fields.includes(key)) {\n              delete orderData[key];\n            }\n          });\n        }\n\n        //  prepareDataForAPI() se vol automaticky uvnit createOrderV2() - NEMNIT ZNOVU!\n        // const preparedData = prepareDataForAPI(orderData);   DUPLICITN - ji se dl v createOrderV2()\n\n        result = await createOrderV2(orderData, token, username);\n\n        addDebugLog('info', 'SAVE-V2', 'create-success', `Order created: ID ${result.id}`);\n\n        //  ODSTRANNO: CREATE by neml vytvet lock, take nen poteba unlock\n        // Draft/localStorage operace nemaj dlat LOCK/UNLOCK\n\n        updatedFormDataImmediate = result;\n        orderId = result.id;\n\n        orderNumber = result.ev_cislo || result.cislo_objednavky || formData.ev_cislo;\n\n        if (!orderNumber) {\n          addDebugLog('error', 'SAVE-V2', 'missing-ev-cislo', 'Backend nevrtil eviden slo objednvky');\n        }\n\n        // V2 API: faktury jsou pmo v result, ne v result.data\n        const fakturyFromBE = result.faktury || [];\n\n        //  DEKLARACE FAKTUR S PLOHAMI - MIMO IF BLOK (aby byla dostupn i pozdji)\n        let fakturyWithAttachments = [];\n\n        if (fakturyFromBE && Array.isArray(fakturyFromBE) && fakturyFromBE.length > 0) {\n          //  ZACHOVAT plohy z formData pokud existuj (ped uloenm)\n          const originalFaktury = formData.faktury || [];\n\n          //  Nast plohy pro kadou fakturu z DB\n          fakturyWithAttachments = await Promise.all(\n            fakturyFromBE.map(async (fakturaFromDB) => {\n              let attachments = [];\n\n              // 1. NEJDV zkusit najt plohy v pvodnch datech (ped uloenm)\n              const originalFaktura = originalFaktury.find(f =>\n                String(f.id) === String(fakturaFromDB.id) ||\n                f.fa_cislo_vema === fakturaFromDB.fa_cislo_vema\n              );\n\n              if (originalFaktura && originalFaktura.attachments && originalFaktura.attachments.length > 0) {\n                // Pout plohy z pvodnho formData\n                attachments = originalFaktura.attachments;\n              } else if (fakturaFromDB.id && !String(fakturaFromDB.id).startsWith('temp-')) {\n                // 2. Pokud nejsou v pvodnch datech, nast z DB\n                try {\n                  const attachResponse = await listInvoiceAttachments(\n                    fakturaFromDB.id,  // invoiceId\n                    username,          // username\n                    token,             // token\n                    parsedInsertData.id  // orderId\n                  );\n                  attachments = attachResponse.data?.attachments || attachResponse.data || [];\n                } catch (err) {\n                }\n              }\n\n              // Parsovat ISDOC data z rozsirujici_data pokud existuj\n              const isdocData = fakturaFromDB.rozsirujici_data?.isdoc;\n\n              //  PARSOVN STEDISEK z DB JSON stringu na pole objekt\n              let parsedStrediska = [];\n              try {\n                if (Array.isArray(fakturaFromDB.fa_strediska_kod)) {\n                  parsedStrediska = fakturaFromDB.fa_strediska_kod;\n                } else if (typeof fakturaFromDB.fa_strediska_kod === 'string') {\n                  parsedStrediska = JSON.parse(fakturaFromDB.fa_strediska_kod || '[]');\n                }\n\n                //  Zachovat cel objekty {kod_stavu, nazev_stavu}, ne jen kdy + validace\n                parsedStrediska = parsedStrediska.map(item => {\n                  if (typeof item === 'object' && item.kod_stavu) {\n                    // Zkontroluj zda existuje v aktivnch\n                    const exists = strediskaOptions.find(opt =>\n                      opt.kod_stavu === item.kod_stavu || opt.kod === item.kod_stavu || opt.value === item.kod_stavu\n                    );\n                    if (exists) {\n                      return item;\n                    }\n                    // Neaktivn stedisko  nahradit za 100 Sprva Kladno\n                    const fallback = strediskaOptions.find(opt =>\n                      opt.kod_stavu === \"100\" || opt.kod === \"100\" || opt.value === \"100\"\n                    );\n                    return fallback ? {\n                      kod_stavu: fallback.kod_stavu || fallback.kod || fallback.value,\n                      nazev_stavu: fallback.nazev_stavu || fallback.nazev || fallback.label\n                    } : { kod_stavu: \"100\", nazev_stavu: \"100 Sprva Kladno\" };\n                  }\n                  // String  zkontroluj zda existuje\n                  const stredisko = strediskaOptions.find(opt =>\n                    opt.kod_stavu === item || opt.kod === item || opt.value === item\n                  );\n                  if (stredisko) {\n                    return {\n                      kod_stavu: stredisko.kod_stavu || stredisko.kod || stredisko.value,\n                      nazev_stavu: stredisko.nazev_stavu || stredisko.nazev || stredisko.label\n                    };\n                  }\n                  // Neaktivn stedisko  nahradit za 100 Sprva Kladno\n                  const fallback = strediskaOptions.find(opt =>\n                    opt.kod_stavu === \"100\" || opt.kod === \"100\" || opt.value === \"100\"\n                  );\n                  return fallback ? {\n                    kod_stavu: fallback.kod_stavu || fallback.kod || fallback.value,\n                    nazev_stavu: fallback.nazev_stavu || fallback.nazev || fallback.label\n                  } : { kod_stavu: \"100\", nazev_stavu: \"100 Sprva Kladno\" };\n                });\n\n                //  DEBUG: Co jsme naparsovali?\n              } catch (e) {\n                parsedStrediska = [];\n              }\n\n              return {\n                ...fakturaFromDB,\n                // Mapovn DB -> FE (stejn jako pi natn)\n                fa_dorucena: fakturaFromDB.fa_datum_doruceni ? 1 : 0,\n                fa_splatnost: fakturaFromDB.fa_splatnost || (fakturaFromDB.fa_datum_splatnosti ? fakturaFromDB.fa_datum_splatnosti.split(' ')[0] : ''), //  OPRAVENO: Fallback na fa_datum_splatnosti\n                fa_strediska_kod: parsedStrediska, //  OPRAVENO: Pouij parsovan objekty\n                //  KRITICK: Pidat naten plohy\n                attachments: attachments,\n                // Zachovat originln DB pole pro API odesln\n                fa_datum_doruceni: fakturaFromDB.fa_datum_doruceni,\n                fa_datum_splatnosti: fakturaFromDB.fa_datum_splatnosti,\n                fa_datum_vystaveni: fakturaFromDB.fa_datum_vystaveni,\n                // Obnovit ISDOC metadata z rozsirujici_data\n                ...(isdocData ? {\n                  _isdoc_polozky: isdocData.polozky,\n                  _isdoc_dodavatel: isdocData.dodavatel,\n                  _fromISDOC: true\n                } : {})\n              };\n            })\n          );\n\n          // Aktualizuj faktury ve formData s natenmi plohami\n          setFormData(prev => ({\n            ...prev,\n            faktury: fakturyWithAttachments\n          }));\n\n          addDebugLog('success', 'SAVE', 'faktury-updated', `Faktury aktualizovny s relnmi ID z DB (${fakturyFromBE.length}) vetn ploh`);\n        }\n\n        //  Odeslat notifikace pi vytvoen nov objednvky\n        try {\n          // V2 API: stav_workflow_kod je pmo v result (me bt undefined nebo JSON string)\n          let workflowKod = result?.stav_workflow_kod || orderData.stav_workflow_kod;\n\n          // Pokud je stav_workflow_kod JSON string, parsuj ho\n          if (typeof workflowKod === 'string' && workflowKod.startsWith('[')) {\n            try {\n              workflowKod = JSON.parse(workflowKod);\n            } catch (e) {\n            }\n          }\n\n          //  STANDARDN NOTIFIKACE (zvoneek) - VDY zavolat!\n          await sendOrderNotifications(orderId, orderNumber, workflowKod, null, formData);\n\n          //  DUAL-TEMPLATE EMAIL: Nov objednvka m automaticky ODESLANA_KE_SCHVALENI (NAVC k zvoneku)\n          if (hasWorkflowState(workflowKod, 'ODESLANA_KE_SCHVALENI')) {\n            try {\n              // Pevst kdy stedisek na nzvy (strediskaOptions m strukturu {value, label})\n              const strediskaNazvy = (formData.strediska_kod || []).map(kod => {\n                const stredisko = strediskaOptions.find(opt => opt.value === kod);\n                return stredisko ? stredisko.label : kod;\n              });\n              \n              //  NOV SYSTM: Org-hierarchy-aware notifications\n              await triggerNotification(\n                'order_status_ke_schvaleni',\n                orderId,\n                user_id || formData.objednatel_id,\n                {\n                  order_number: orderNumber,\n                  order_subject: formData.predmet || '',\n                  commander_id: formData.prikazce_id,\n                  garant_id: formData.garant_uzivatel_id,\n                  creator_id: formData.objednatel_id,\n                  supplier_name: formData.dodavatel_nazev || 'Neuvedeno',\n                  financovani_json: JSON.stringify(orderData.financovani || {}),\n                  strediska_names: strediskaNazvy,\n                  max_price_with_dph: formData.max_cena_s_dph || 0,\n                  is_urgent: formData.mimoradna_udalost || false\n                }\n              );\n              addDebugLog('success', 'NOTIFICATION', 'trigger-sent-new', `Org-hierarchy notifikace triggernuta pro novou objednvku ${orderNumber}`);\n            } catch (triggerError) {\n              addDebugLog('warning', 'NOTIFICATION', 'trigger-error-new', `Chyba pi trigger notifikaci: ${triggerError.message}`);\n            }\n          }\n        } catch (notifError) {\n          // Nezastavuj workflow kvli chyb notifikace\n          addDebugLog('warning', 'SAVE', 'notification-error', `Chyba pi odesln notifikace: ${notifError.message}`);\n        }\n\n        // Toast notifikace se zobraz a pozdji (dek ~5150-5160) - jednotn pro INSERT i UPDATE\n\n        // SUPERADMIN a ADMINISTRATOR zstvaj na formuli (DN pesmrovn)\n        // Vichni ostatn uivatel vid progress a pak pesmrovn\n        // POUIJ promnn deklarovan na zatku funkce (dek ~4817)\n        const shouldShowProgress = !shouldStayOnForm; // Bn uivatel vid progress\n\n        //  WORKFLOW REFACTORING: Backend vrac kompletn zznam, pouij ho pmo\n        updatedFormDataImmediate = result;\n        orderId = result.id;\n        //  KRITICK: Backend by ml vracet ev_cislo, ale pokud nevrt, pouijeme cislo_objednavky\n        // Frontend NIKDY nevyml ev_cislo - bere POUZE z backendu!\n        orderNumber = result.ev_cislo || result.cislo_objednavky;\n\n        //  V2 API: Backend vrac data PMO v result, ne v result.data!\n        //  POUT CENTRLN TRANSFORMACI: Backend  Frontend\n        const transformedResult = transformBackendDataToFrontend(result);\n\n        //  VALIDACE STEDISEK: Fallback pro neaktivn stediska\n        if (transformedResult.strediska_kod && Array.isArray(transformedResult.strediska_kod)) {\n          transformedResult.strediska_kod = validateAndFixStrediska(\n            transformedResult.strediska_kod,\n            strediskaOptions\n          );\n        }\n\n        const parsedInsertData = {\n          ...transformedResult,\n          id: orderId,\n          //  Pout orderNumber (ev_cislo NEBO cislo_objednavky jako fallback)\n          ev_cislo: orderNumber\n        };\n\n        addDebugLog('success', 'INSERT', 'data-transformed', `Data transformovna: strediska=${parsedInsertData.strediska_kod?.join(', ') || 'none'}, financovani=${parsedInsertData.zpusob_financovani || 'none'}`);\n\n        //  KRITICK: Aktualizovat formData s PARSOVANMI daty z DB PRO VECHNY\n        // Tm zabrnme ztrt dat po uloen + sprvn parsujeme stediska\n        //  BUGFIX: Zachovat faktury s natenmi plohami (fakturyWithAttachments z dku 8030-8107)\n        setFormData(prev => ({\n          ...prev,\n          ...parsedInsertData,  //  Pouij parsedInsertData msto result.data (obsahuje parsovan stediska)\n          //  POUT FAKTURY S NATENMI PLOHAMI (pokud byly nateny)\n          faktury: fakturyWithAttachments && fakturyWithAttachments.length > 0 ? fakturyWithAttachments : (parsedInsertData.faktury || prev.faktury)\n        }));\n\n        addDebugLog('success', 'INSERT', 'formdata-updated', `FormData aktualizovn: id=${orderId}, strediska=${parsedInsertData.strediska_kod?.join(', ') || 'none'}, faktury s plohami: ${fakturyWithAttachments?.length || 0}`);\n        \n        //  NAST LP OPTIONS z enriched response (z financovani.lp_nazvy)\n        if (result.financovani?.lp_nazvy && Array.isArray(result.financovani.lp_nazvy)) {\n          const lpOptions = result.financovani.lp_nazvy\n            .map(lp => ({\n              id: lp.id,\n              kod: lp.cislo_lp || lp.kod || `LP${lp.id}`,\n              nazev: lp.nazev || 'Bez nzvu',\n              kategorie: lp.kategorie,\n              limit: lp.limit || lp.celkovy_limit,\n              cerpano: lp.cerpano || lp.skutecne_cerpano,\n              zbyva: lp.zbyva || lp.zbyva_skutecne,\n              rok: lp.rok,\n              label: `${lp.cislo_lp || lp.kod || `LP${lp.id}`} - ${lp.nazev || 'Bez nzvu'}`\n            }))\n            .sort((a, b) => a.nazev.localeCompare(b.nazev, 'cs'));\n          \n          setLpOptionsForItems(lpOptions);\n          addDebugLog('success', 'INSERT', 'lp-options-loaded', `LP options nateny z financovani.lp_nazvy: ${lpOptions.length}`);\n        }\n\n        //  FORCE REFRESH workflowManager hned po setFormData\n        workflowForceRefresh();\n\n        //  Reset vech unlock states - sekce se maj zamknout podle nov fze\n        workflowManager.resetAllUnlocks();\n\n        // NOTE: formData.id removed - formData.id is single source of truth (orderId is in formData)\n\n        if (shouldShowProgress) {\n          // Bn uivatel - spust progress a pesmrovn\n          //  CENTRALIZOVAN MAZN pes DraftManager\n          setDisableAutosave(true);\n          disableAutosaveRef.current = true; //  OKAMIT zakzat autosave (REF)\n          setIsEditMode(false);\n          setIsConceptSaved(false);\n\n          //  Pouij DraftManager pro mazn VECH kl (ASYNCHRONN pro verifikaci)\n          if (user_id) {\n            draftManager.setCurrentUser(user_id);\n            const deleted = await draftManager.deleteAllDraftKeys();\n\n            if (deleted) {\n              addDebugLog('success', 'INSERT', 'draftmanager-delete', `Vechny kle smazny pes DraftManager`);\n            } else {\n            }\n          }\n\n          //  KRITICK: Invaliduj cache PED navigac (aby seznam ml erstv data)\n          try {\n            ordersCacheService.invalidate(user_id);\n            addDebugLog('success', 'INSERT', 'cache-invalidation', 'Cache invalidovna ped navigac');\n          } catch (e) {\n            addDebugLog('error', 'INSERT', 'cache-invalidation-error', `Chyba pi invalidaci cache: ${e.message}`);\n          }\n\n          await startSaveProgressAndRedirect(orderNumber, orderId);\n\n        } else {\n          // SUPERADMIN/ADMIN - zstv na formuli v edit reimu\n          //  Povolit autosave zpt (zstvaj editovat)\n          setDisableAutosave(false);\n          disableAutosaveRef.current = false;\n          draftManager.setAutosaveEnabled(true, 'SUPERADMIN/ADMIN stays on form after INSERT');\n\n          //  ADMIN: Uloit aktualizovan data do draftu\n          try {\n            draftManager.setCurrentUser(user_id);\n            await draftManager.saveDraft(updatedFormDataImmediate, {\n              step: getCurrentPhase(),\n              attachments: attachments,\n              metadata: {\n                version: '1.4',\n                isConceptSaved: true,\n                isOrderSavedToDB: true,\n                savedOrderId: orderId,\n                isChanged: false,\n                dictionaries: {\n                  approvers: approvers || [],\n                  users: allUsers || [],\n                  strediska: strediskaOptions || [],\n                  financovani: financovaniOptions || [],\n                  druhyObjednavky: druhyObjednavkyOptions || [],\n                  lpKody: lpKodyOptions || []\n                }\n              }\n            });\n            addDebugLog('success', 'INSERT', 'admin-draft-saved', 'Draft uloen pro ADMIN po INSERT');\n          } catch (error) {\n            addDebugLog('error', 'INSERT', 'admin-draft-error', `Chyba pi ukldn draftu pro ADMIN: ${error.message}`);\n          }\n\n          // NEPROVDME unlock ani mazn konceptu - objednvka zstv oteven pro dal editaci\n          addDebugLog('info', 'SAVE', 'stay-on-form', `SUPERADMIN/ADMIN zstv na formuli - koncept NEN smazn, formul v edit reimu`);\n\n          //  TOAST NOTIFIKACE pro SUPERADMIN/ADMIN - zobrazit spch\n          if (showToast) {\n            const isNewOrder = !isOrderSavedToDB; // Byla to nov objednvka nebo update?\n            const message = isNewOrder\n              ? ' Objednavka uspesne vytvorena\\n ' + orderNumber + '\\n Databaze aktualizovana'\n              : ' Objednavka uspesne aktualizovana\\n ' + orderNumber + '\\n Zmeny ulozeny';\n            showToast(message, 'success');\n          }\n\n          //  ADMIN: Zustat na stejne pozici - NEAUTOMATICKY scrollovat\n          // Uzivatel ma moznost pokracovat tam, kde skoncil\n          addDebugLog('info', 'INSERT', 'stay-in-place', 'Zustan na stejne pozici po ulozeni');\n        }\n\n        // RESET isChanged - data jsou synchronizovna s DB\n        setIsChanged(false);\n\n        //  Pepoet erpn smlouvy (pokud je smlouva vybran a objednvka ve fzi 7-8)\n        if (formData.cislo_smlouvy && currentPhase >= 7) {\n          try {\n            await prepocetCerpaniSmluv({\n              token,\n              username,\n              cislo_smlouvy: formData.cislo_smlouvy\n            });\n            addDebugLog('success', 'SMLOUVA', 'prepocet-ok', `Pepoet erpn smlouvy ${formData.cislo_smlouvy} spn`);\n          } catch (error) {\n            addDebugLog('warning', 'SMLOUVA', 'prepocet-error', `Chyba pi pepotu smlouvy: ${error.message}`);\n            // Neperuovat proces ukldn, jen logovat\n          }\n        }\n\n        //  DB RESPONSE LOGGING (INSERT)\n        //  V2 API: result je pmo data objednvky, NE result.data!\n        addDebugLog('info', 'DB-RESPONSE', 'INSERT-complete', {\n          orderId: orderId,\n          orderNumber: orderNumber,\n          workflow: result.stav_workflow_kod,\n          fieldsCount: Object.keys(result).length,\n          polozky: result.polozky?.length || 0,\n          faktury: result.faktury?.length || 0\n        });\n\n        // Odvodit checkboxy z workflow stavu (pro zamykn sekc)\n        //  V2 API: result je pmo data objednvky, NE result.data!\n        const newWorkflowFromDB = result.stav_workflow_kod;\n        const isOdeslana = hasWorkflowState(newWorkflowFromDB, 'ODESLANA');\n        const isZrusena = hasWorkflowState(newWorkflowFromDB, 'ZRUSENA');\n\n        //  WORKFLOW REFACTORING: Po spnm uloen do DB aktualizovat draft s erstvmi daty\n        // Backend vrac kompletn zznam, take draft bude synchronizovan s DB\n        //  KRITICK: Mergovat pvodn formData (s polokami!) + parsovan DB data\n        try {\n          draftManager.setCurrentUser(user_id);\n\n          //  FIX: Mergovat updatedFormDataImmediate (obsahuje poloky + financovn) + parsedInsertData (DB data)\n          //  BUGFIX: Zachovat objednatel_id z pvodnho formData pro jistotu\n          const mergedDraftData = {\n            ...updatedFormDataImmediate, // Pvodn data s polokami\n            ...parsedInsertData,         // Pepsat DB daty (ID, workflow, atd.) + PARSOVAN FINANCOVN!\n            // Zachovat poloky a faktury z pvodnho formData\n            polozky_objednavky: updatedFormDataImmediate.polozky_objednavky || [],\n            faktury: updatedFormDataImmediate.faktury || [],\n            //  ZACHOVAT objednatel_id + osobn daje objednatele (fallback na pvodn data)\n            objednatel_id: parsedInsertData.objednatel_id || updatedFormDataImmediate.objednatel_id,\n            jmeno: parsedInsertData.jmeno || updatedFormDataImmediate.jmeno,\n            email: parsedInsertData.email || updatedFormDataImmediate.email,\n            telefon: parsedInsertData.telefon || updatedFormDataImmediate.telefon\n            //  FINANCOVN je u v parsedInsertData - nepepisovat!\n          };\n\n          await draftManager.saveDraft(mergedDraftData, {\n            step: getCurrentPhase(),\n            attachments: attachments,\n            metadata: {\n              version: '1.4',\n              isConceptSaved: true,\n              isOrderSavedToDB: true,\n              savedOrderId: orderId,\n              isChanged: false, //  FALSE = dn neuloen zmny (ve je v DB)\n              dictionaries: {\n                approvers: approvers || [],\n                users: allUsers || [],\n                strediska: strediskaOptions || [],\n                financovani: financovaniOptions || [],\n                druhyObjednavky: druhyObjednavkyOptions || [],\n                lpKody: lpKodyOptions || []\n              }\n            }\n          });\n          addDebugLog('success', 'INSERT', 'draft-updated', `Draft aktualizovn s PARSOVANMI DB daty (workflow: ${newWorkflowFromDB}, strediska: ${parsedInsertData.strediska_kod.join(', ')}, poloky: ${mergedDraftData.polozky_objednavky?.length || 0}, financovn: ${mergedDraftData.zpusob_financovani || 'none'})`);\n\n          //  AKTUALIZOVAT SNAPSHOT po spnm uloen\n          originalFormDataRef.current = JSON.parse(JSON.stringify(mergedDraftData));\n\n          //  BROADCAST: Aktualizovat MenuBar s novm stavem\n          broadcastOrderState({\n            isEditMode: true,\n            orderId: orderId,\n            orderNumber: orderNumber\n          });\n          addDebugLog('success', 'INSERT', 'broadcast', `Broadcast stavu odesln (isEditMode: true, orderId: ${orderId})`);\n        } catch (error) {\n          addDebugLog('error', 'INSERT', 'draft-update-error', `Chyba pi aktualizaci draftu: ${error.message}`);\n        }\n\n        //  WORKFLOW REFACTORING: FormData ji byl aktualizovn ve (dek ~7079) s parsovanmi stediskami\n        // ODSTRANNO duplicitn setFormData(parsedInsertData) - zpsobovalo pepsn dat\n\n        // Fze se odvod automaticky z DB stavu - BE vrac aktuln stav\n        //  V2 API: result je pmo data objednvky, NE result.data!\n        const newWorkflowKod = result.stav_workflow_kod;\n        addDebugLog('success', 'SAVE', 'order-status', `Objednvka oznaena jako uloen. ID: ${orderId}, EV: ${orderNumber}, DB stav: ${newWorkflowKod}`);\n\n        // FZE se automaticky pepot z aktualizovanho formData.stav_workflow_kod\n        addDebugLog('success', 'SAVE', 'workflow-state', `DB stav: ${newWorkflowKod} - fze se pepot automaticky`);\n\n        // Po spnm INSERT - reset stav a refresh autosave\n        // Reset odemknut pouze pokud je objednvka skuten schvlen\n        if (hasWorkflowState(newWorkflowKod, 'SCHVALENA')) {\n          setIsPhase1Unlocked(false); // Reset odemknut pouze pro schvlenou objednvku\n          addDebugLog('info', 'SAVE', 'lock-sections', 'FZE 1 sekce zameny - objednvka je schvlen');\n        } else {\n          addDebugLog('info', 'SAVE', 'keep-unlocked-phase1', `FZE 1 sekce zstvaj odemen - stav: ${newWorkflowKod}`);\n        }\n\n        // Pro FZE 2: Zamknout pokud DB obsahuje ODESLANA/ZRUSENA\n        const hasOdeslanaInNewState = hasWorkflowState(newWorkflowKod, 'ODESLANA');\n        const hasZrusenaInNewState = hasWorkflowState(newWorkflowKod, 'ZRUSENA');\n\n        // Zamykn e useEffect podle formData.stav_workflow_kod\n\n        // ZAMKNOUT FZE 2 - pokud je objednvka odeslan/zruen\n        // KONTROLA POUZE podle DB workflow stavu - NE podle UI checkboxu stav_stornovano!\n        addDebugLog('success', 'SAVE', 'no-ui-refresh', `Bez UI refresh - pmo zamykn. Nov stav: ${newWorkflowKod}`);\n          const shouldLockPhase2Now = (\n            hasWorkflowState(newWorkflowKod, 'ODESLANA') ||\n            hasWorkflowState(newWorkflowKod, 'ZRUSENA')\n          );\n\n        if (shouldLockPhase2Now) {\n          //  Zkontrolovat pes DraftManager, jestli nen Phase 2 run odemeno\n          let isManuallyUnlocked = false;\n          try {\n            const uiState = draftManager.getUIState();\n            if (uiState) {\n              const currentOrderId = formData.id;\n              // Kontrolovat pouze pokud existuje ID objednvky\n              if (currentOrderId && uiState.phase2OrderId === currentOrderId && uiState.phase2Unlocked === true) {\n                isManuallyUnlocked = true;\n              }\n            }\n          } catch (e) {\n            addDebugLog('warning', 'SAVE', 'unlock-check-error', `Chyba pi kontrole Phase 2 unlock stavu: ${e.message}`);\n          }\n\n          if (isManuallyUnlocked) {\n            addDebugLog('info', 'SAVE', 'phase2-keep-unlocked', `FZE 2 zstv ODEMENA - byla run odemena`);\n          } else {\n            setIsPhase3SectionsUnlocked(false);\n          }\n        }        setHasTriedToSubmit(false); // Reset validace po spnm uloen\n\n        // Aktualizovan data pro localStorage (vetn novho workflow stavu)\n        const updatedFormDataForSave = {\n          ...formData,\n          id: orderId,\n          ev_cislo: orderNumber,\n          stav_workflow_kod: newWorkflowKod,\n          ...(result?.dt_schvaleni && { dt_schvaleni: result.dt_schvaleni })\n        };\n\n        // Debug: Zkontroluj, zda m workflow stav SCHVALENA (INSERT)\n        const hasSchvalenaInsert = hasWorkflowState(newWorkflowKod, 'SCHVALENA');\n        addDebugLog('info', 'INSERT', 'phase-check', `M SCHVALENA: ${hasSchvalenaInsert}, nov fze by mla bt: ${hasSchvalenaInsert ? '2' : '1'}`);\n\n        // KRITICK: Aktualizovat formData pro refresh UI (stejn jako u UPDATE) - s force refresh\n        //  ZACHOVAT parsedInsertData.strediska_kod - nepepisovat!\n        setFormData(prev => {\n          //  Pevst workflow kd na textov popis\n          const stavObjednavky = (() => {\n            try {\n              const stavyArray = Array.isArray(newWorkflowKod)\n                ? newWorkflowKod\n                : JSON.parse(newWorkflowKod || '[\"NOVA\"]');\n              const poslednStav = stavyArray[stavyArray.length - 1];\n              const stavInfo = WORKFLOW_STATES[poslednStav];\n              return stavInfo?.name || poslednStav || 'Nov';\n            } catch (e) {\n              return 'Nov';\n            }\n          })();\n\n          const newData = {\n            ...prev,\n            id: orderId,\n            ev_cislo: orderNumber,\n            stav_workflow_kod: newWorkflowKod,\n            stav_objednavky: stavObjednavky,\n            ...(result?.dt_schvaleni && { dt_schvaleni: result.dt_schvaleni }),\n            strediska_kod: parsedInsertData.strediska_kod\n          };\n\n          return newData;\n        });\n\n        // U nen poteba explicitn DB reload - BE vrac spolehliv stav v response\n\n        //  REMOVED: Toast zprva \"Objednvka byla spn vytvoena\" - notifikace u informuj uivatele\n\n        // POZNMKA: Autosave byl pesunut do DraftManager.syncWithDatabase()\n        // Nen poteba volat saveDraftWithData - zpsobovalo duplicitn zpis a race conditions\n        addDebugLog('info', 'AUTOSAVE', 'skip-duplicate-insert', `Autosave peskoen - ji proveden pes DraftManager.syncWithDatabase()`);\n\n        // === SUPERADMIN/ADMIN zachovn draftu ===\n        // Pro SUPERADMIN a ADMIN NEMAZAT draft - zstvaj na formuli v edit reimu\n        // POUIJ ji deklarovan promnn z nadazenho scope (dek ~5203-5205)\n\n        if (!shouldStayOnForm && user_id) {\n          // Bn uivatel - smazat draft (bude pesmrovn)\n          draftManager.setCurrentUser(user_id);\n          await draftManager.deleteDraft();\n          addDebugLog('info', 'DRAFT', 'delete-after-create', 'Draft smazn po spnm CREATE pes DraftManager (bn uivatel)');\n        } else if (shouldStayOnForm) {\n          addDebugLog('info', 'DRAFT', 'keep-after-create', 'Draft ZACHOVN po CREATE - SUPERADMIN/ADMIN zstv na formuli');\n        }\n\n      } else {\n        // Aktualizace existujc objednvky - pouvme partial-update\n        const oldWorkflowKod = formData.stav_workflow_kod;\n\n        addDebugLog('info', 'SAVE-V2', 'update-start', `Volam updateOrderV2(${formData.id})`);\n\n        //  prepareDataForAPI() se vol automaticky uvnit updateOrderV2() - NEMNIT ZNOVU!\n        // const preparedData = prepareDataForAPI(orderData);   DUPLICITN - ji se dl v updateOrderV2()\n\n\n        //  DEBUG: STEDISKA VE FAKTURCH PED ODESLNM (UPDATE)\n        if (orderData.faktury && orderData.faktury.length > 0) {\n        }\n\n        result = await updateOrderV2(formData.id, orderData, token, username);\n\n        addDebugLog('info', 'SAVE-V2', 'update-success', `Order ${formData.id} updated`);\n\n        // DB RESPONSE LOGGING (UPDATE)\n        //  V2 API: Backend vrac cislo_objednavky (ne ev_cislo)\n        addDebugLog('info', 'DB-RESPONSE', 'UPDATE-complete', {\n          orderId: result.id,\n          orderNumber: result.cislo_objednavky || result.ev_cislo,\n          workflow: result.stav_workflow_kod,\n          fieldsCount: Object.keys(result).length,\n          polozky: result.polozky?.length || 0,\n          faktury: result.faktury?.length || 0\n        });\n\n        //  DEBUG: Zkontroluj co backend vrac v dodavatel_zpusob_potvrzeni\n\n        // Odeslat notifikace pi zmn workflow stavu\n        try {\n          const orderNumber = formData.ev_cislo || formData.cislo_objednavky || formData.id;\n          \n          //  STANDARDN NOTIFIKACE (zvoneek) - VDY zavolat!\n          await sendOrderNotifications(formData.id, orderNumber, result.stav_workflow_kod, oldWorkflowKod, formData);\n          \n          //  DUAL-TEMPLATE EMAIL: Pi prvnm odesln ke schvlen (NAVC k zvoneku)\n          const hasKeSchvaleni = hasWorkflowState(result.stav_workflow_kod, 'ODESLANA_KE_SCHVALENI');\n          const hadKeSchvaleni = oldWorkflowKod ? hasWorkflowState(oldWorkflowKod, 'ODESLANA_KE_SCHVALENI') : false;\n          \n          if (hasKeSchvaleni && !hadKeSchvaleni) {\n            //  NOV SYSTM: Org-hierarchy-aware notifications\n            try {\n              // Pevst kdy stedisek na nzvy (strediskaOptions m strukturu {value, label})\n              const strediskaNazvy = (formData.strediska_kod || []).map(kod => {\n                const stredisko = strediskaOptions.find(opt => opt.value === kod);\n                return stredisko ? stredisko.label : kod;\n              });\n              \n              await triggerNotification(\n                'order_status_ke_schvaleni',\n                formData.id,\n                user_id || formData.objednatel_id,\n                {\n                  order_number: orderNumber,\n                  order_subject: formData.predmet || '',\n                  commander_id: formData.prikazce_id,\n                  garant_id: formData.garant_uzivatel_id,\n                  creator_id: formData.objednatel_id,\n                  supplier_name: formData.dodavatel_nazev || 'Neuvedeno',\n                  financovani_json: JSON.stringify(orderData.financovani || {}),\n                  strediska_names: strediskaNazvy,\n                  max_price_with_dph: formData.max_cena_s_dph || 0,\n                  is_urgent: formData.mimoradna_udalost || false\n                }\n              );\n              addDebugLog('success', 'NOTIFICATION', 'trigger-sent', `Org-hierarchy notifikace triggernuta pro objednvku ${orderNumber}`);\n            } catch (triggerError) {\n              addDebugLog('warning', 'NOTIFICATION', 'trigger-error', `Chyba pi trigger notifikaci: ${triggerError.message}`);\n            }\n          }\n        } catch (notifError) {\n        }\n\n        //  WORKFLOW REFACTORING: Backend vrac kompletn zznam, pouij ho pmo\n        const updatedFormDataImmediate = result;\n        const updatedWorkflowKod = result.stav_workflow_kod;\n\n        // Odvodit checkboxy z workflow stavu (pro zamykn sekc)\n        const isOdeslana = hasWorkflowState(updatedWorkflowKod, 'ODESLANA');\n        const isZrusena = hasWorkflowState(updatedWorkflowKod, 'ZRUSENA');\n\n        //  V2 API: Backend vrac data PMO v result, ne v result.data!\n        //  POUT CENTRLN TRANSFORMACI: Backend  Frontend\n        const transformedResult = transformBackendDataToFrontend(result);\n\n        //  VALIDACE STEDISEK: Fallback pro neaktivn stediska\n        if (transformedResult.strediska_kod && Array.isArray(transformedResult.strediska_kod)) {\n          transformedResult.strediska_kod = validateAndFixStrediska(\n            transformedResult.strediska_kod,\n            strediskaOptions\n          );\n        }\n\n        // Nyn pracuj s transformovanmi daty (u obsahuje normalized stediska + financovn)\n        const parsedUpdateData = {\n          ...transformedResult  //  U obsahuje: strediska_kod (array), zpusob_financovani (string), polozky_objednavky (array), atd.\n        };\n\n        addDebugLog('success', 'UPDATE', 'data-transformed', `Data transformovna: strediska=${parsedUpdateData.strediska_kod?.join(', ') || 'none'}, financovani=${parsedUpdateData.zpusob_financovani || 'none'}`);\n\n\n        //  Pevst workflow kd na textov popis\n        const stavObjednavky = (() => {\n          try {\n            const stavyArray = Array.isArray(updatedWorkflowKod)\n              ? updatedWorkflowKod\n              : JSON.parse(updatedWorkflowKod || '[\"NOVA\"]');\n            const poslednStav = stavyArray[stavyArray.length - 1];\n            const stavInfo = WORKFLOW_STATES[poslednStav];\n            return stavInfo?.name || poslednStav || 'Nov';\n          } catch (e) {\n            return 'Nov';\n          }\n        })();\n\n        // Pidat stav_objednavky do parsedUpdateData\n        parsedUpdateData.stav_objednavky = stavObjednavky;\n\n        //  KRITICK: Normalizovat dodavatel_zpusob_potvrzeni do jednotnho FE formtu\n        // Podporovan BE formty:\n        // 1. NOV: { potvrzeni: 'ANO', zpusoby: ['email'], platba: 'faktura' }\n        // 2. STAR: { potvrzeno: true, zpusob: ['email'], platba: 'faktura' }\n        // FE oekv: { potvrzeni: 'ANO', zpusoby: ['email'], platba: 'faktura' }\n\n        if (parsedUpdateData.dodavatel_zpusob_potvrzeni && typeof parsedUpdateData.dodavatel_zpusob_potvrzeni === 'object') {\n          const beData = parsedUpdateData.dodavatel_zpusob_potvrzeni;\n\n          //  ULOIT originln hodnotu z DB (pro ppad zamen sekce)\n          parsedUpdateData.dodavatel_zpusob_potvrzeni_original = JSON.stringify(beData);\n\n          //  Pokud u m sprvnou FE strukturu (potvrzeni + zpusoby), jen normalizuj hodnoty\n          if (beData.potvrzeni !== undefined) {\n            parsedUpdateData.dodavatel_zpusob_potvrzeni = {\n              potvrzeni: beData.potvrzeni || 'NE',\n              zpusoby: Array.isArray(beData.zpusoby) ? beData.zpusoby : [],\n              platba: beData.platba || ''\n            };\n            addDebugLog('info', 'UPDATE', 'normalize-potvrzeni-ok',\n              `Normalizovn dodavatel_zpusob_potvrzeni (u sprvn formt): ${JSON.stringify(parsedUpdateData.dodavatel_zpusob_potvrzeni)}`);\n          }\n          //  Transformuj star BE formt (potvrzeno)\n          else if (beData.potvrzeno !== undefined) {\n            parsedUpdateData.dodavatel_zpusob_potvrzeni = {\n              potvrzeni: beData.potvrzeno ? 'ANO' : 'NE',\n              zpusoby: beData.zpusob || beData.zpusob_potvrzeni || [],\n              platba: beData.platba || beData.zpusob_platby || ''\n            };\n            addDebugLog('info', 'UPDATE', 'transform-potvrzeni-old',\n              `Transformovn dodavatel_zpusob_potvrzeni (star BE formt): ${JSON.stringify(parsedUpdateData.dodavatel_zpusob_potvrzeni)}`);\n          }\n          //  Fallback - star formt BEZ potvrzeno (odvo z dt_akceptace)\n          else if (beData.zpusob !== undefined || beData.zpusoby !== undefined) {\n            const maAkceptaci = !!(parsedUpdateData.dt_akceptace && parsedUpdateData.dodavatel_potvrdil_id);\n            parsedUpdateData.dodavatel_zpusob_potvrzeni = {\n              potvrzeni: maAkceptaci ? 'ANO' : 'NE',\n              zpusoby: beData.zpusoby || beData.zpusob || beData.zpusob_potvrzeni || [],\n              platba: beData.platba || beData.zpusob_platby || ''\n            };\n            addDebugLog('info', 'UPDATE', 'transform-potvrzeni-fallback',\n              `Transformovn dodavatel_zpusob_potvrzeni (fallback z dt_akceptace): ${JSON.stringify(parsedUpdateData.dodavatel_zpusob_potvrzeni)}`);\n          }\n        }\n\n        //  NAST PLOHY PRO FAKTURY (PED setFormData)\n        const fakturyWithAttachments = parsedUpdateData.faktury ? await Promise.all(\n          parsedUpdateData.faktury.map(async (fakturaFromDB) => {\n            // Parsovat ISDOC data z rozsirujici_data pokud existuj\n            const isdocData = fakturaFromDB.rozsirujici_data?.isdoc;\n\n            //  PARSOVN STEDISEK z DB JSON stringu na pole STRING (NE objekt!)\n            let parsedStrediska = [];\n            try {\n              if (Array.isArray(fakturaFromDB.fa_strediska_kod)) {\n                parsedStrediska = fakturaFromDB.fa_strediska_kod;\n              } else if (typeof fakturaFromDB.fa_strediska_kod === 'string') {\n                parsedStrediska = JSON.parse(fakturaFromDB.fa_strediska_kod || '[]');\n              }\n\n              //  VYISTIT - zajistit e jsou JEN STRINGY (extrahovat z objekt pokud jsou tam)\n              parsedStrediska = parsedStrediska.map(item => {\n                if (typeof item === 'string') {\n                  return item; // U je string - OK\n                }\n                // Extrahuj z objektu\n                return item.kod_stavu || item.value || item.id || item;\n              });\n\n              //  DEBUG: Co jsme naparsovali?\n            } catch (e) {\n              parsedStrediska = [];\n            }\n\n            //  NAST PLOHY FAKTURY Z DB\n            let attachments = [];\n            if (fakturaFromDB.id && !String(fakturaFromDB.id).startsWith('temp-')) {\n              try {\n                const attachResponse = await listInvoiceAttachments(\n                  fakturaFromDB.id,\n                  username,\n                  token,\n                  formData.id  // orderId\n                );\n                attachments = attachResponse.data?.attachments || attachResponse.data || [];\n                console.log(` [OrderForm25] Nateny plohy faktury ID=${fakturaFromDB.id}:`, attachments);\n              } catch (err) {\n                console.error(` [OrderForm25] Chyba pi natn ploh faktury ID=${fakturaFromDB.id}:`, err);\n              }\n            }\n\n            return {\n              ...fakturaFromDB,\n              // Mapovn DB -> FE (stejn jako pi INSERT)\n              fa_dorucena: fakturaFromDB.fa_datum_doruceni ? 1 : 0,\n              fa_splatnost: fakturaFromDB.fa_splatnost || (fakturaFromDB.fa_datum_splatnosti ? fakturaFromDB.fa_datum_splatnosti.split(' ')[0] : ''),\n              fa_strediska_kod: parsedStrediska,\n              //  KRITICK: Pidat naten plohy\n              attachments: attachments,\n              // Zachovat originln DB pole pro API odesln\n              fa_datum_doruceni: fakturaFromDB.fa_datum_doruceni,\n              fa_datum_splatnosti: fakturaFromDB.fa_datum_splatnosti,\n              fa_datum_vystaveni: fakturaFromDB.fa_datum_vystaveni,\n              // Obnovit ISDOC metadata z rozsirujici_data\n              ...(isdocData ? {\n                _isdoc_polozky: isdocData.polozky,\n                _isdoc_dodavatel: isdocData.dodavatel,\n                _fromISDOC: true\n              } : {})\n            };\n          })\n        ) : [];\n\n        //  KRITICK: Aktualizovat formData s daty z DB (jedin voln s mergem)\n        // OPRAVENO: Odstranno duplicitn setFormData(parsedUpdateData) kter pepisovalo cel state\n        //  BUGFIX: Zachovat objednatel_id z pvodnho formData, protoe backend ho pi UPDATE NEVRAC\n        setFormData(prev => ({\n          ...prev,\n          ...parsedUpdateData,  // Pouij parsedUpdateData msto updatedFormDataImmediate (obsahuje parsovan stediska + stav_objednavky)\n          //  EXPLICITN nastavit workflow kd z BE odpovdi\n          stav_workflow_kod: updatedWorkflowKod,\n          //  ZACHOVAT objednatel_id + osobn daje objednatele z pvodnho formData\n          objednatel_id: prev.objednatel_id || parsedUpdateData.objednatel_id,\n          jmeno: prev.jmeno || parsedUpdateData.jmeno,\n          email: prev.email || parsedUpdateData.email,\n          telefon: prev.telefon || parsedUpdateData.telefon,\n          //  POUT FAKTURY S NATENMI PLOHAMI\n          faktury: fakturyWithAttachments.length > 0 ? fakturyWithAttachments : prev.faktury\n        }));\n\n        addDebugLog('success', 'UPDATE', 'formdata-updated', `FormData aktualizovn: workflow=${updatedWorkflowKod}, strediska=${parsedUpdateData.strediska_kod.join(', ')}`);\n        \n        //  OPRAVA: RELOAD objednvky po UPDATE pro zskn enriched dat (vetn financovani.lp_nazvy)\n        // Backend UPDATE nevrac enriched financovn  musme zavolat GET s enriched=true\n        try {\n          const freshOrderData = await getOrderV2(formData.id, token, username, true); // enriched=true\n          \n          if (freshOrderData?.financovani?.lp_nazvy && Array.isArray(freshOrderData.financovani.lp_nazvy)) {\n            const lpOptions = freshOrderData.financovani.lp_nazvy\n              .map(lp => ({\n                id: lp.id,\n                kod: lp.cislo_lp || lp.kod || `LP${lp.id}`,\n                nazev: lp.nazev || 'Bez nzvu',\n                kategorie: lp.kategorie,\n                limit: lp.limit || lp.celkovy_limit,\n                cerpano: lp.cerpano || lp.skutecne_cerpano,\n                zbyva: lp.zbyva || lp.zbyva_skutecne,\n                rok: lp.rok,\n                label: `${lp.cislo_lp || lp.kod || `LP${lp.id}`} - ${lp.nazev || 'Bez nzvu'}`\n              }))\n              .sort((a, b) => a.nazev.localeCompare(b.nazev, 'cs'));\n            \n            setLpOptionsForItems(lpOptions);\n            addDebugLog('success', 'UPDATE', 'lp-options-reloaded', `LP options nateny z GET po UPDATE: ${lpOptions.length}`);\n          } else {\n            addDebugLog('warning', 'UPDATE', 'lp-options-missing', 'Enriched data neobsahuj financovani.lp_nazvy');\n          }\n        } catch (reloadError) {\n          addDebugLog('error', 'UPDATE', 'lp-options-reload-failed', `Chyba pi reload LP options: ${reloadError.message}`);\n        }\n\n        //  Pepoet erpn smlouvy (pokud je smlouva vybran a objednvka ve fzi 7-8)\n        if (formData.cislo_smlouvy && currentPhase >= 7) {\n          try {\n            await prepocetCerpaniSmluv({\n              token,\n              username,\n              cislo_smlouvy: formData.cislo_smlouvy\n            });\n            addDebugLog('success', 'SMLOUVA', 'prepocet-ok', `Pepoet erpn smlouvy ${formData.cislo_smlouvy} spn`);\n          } catch (error) {\n            addDebugLog('warning', 'SMLOUVA', 'prepocet-error', `Chyba pi pepotu smlouvy: ${error.message}`);\n            // Neperuovat proces ukldn, jen logovat\n          }\n        }\n\n        //  KRITICK: Nastavit flag, e workflow state byl aktualizovn\n        window.__workflowStateUpdated = true;\n\n        //  FORCE REFRESH workflowManager hned po setFormData\n        workflowForceRefresh();\n\n        //  Reset unlock states - sekce se maj zamknout podle nov fze\n        workflowManager.resetAllUnlocks();\n\n        //  PEPOTN FZE: Explicitn vpoet fze po UPDATE s NOVMI daty z DB\n        // Toto zajist sprvn zobrazen nap. 10/10 msto 9/10 po potvrzen vcn sprvnosti\n        const calculatePhaseFromWorkflow = (workflowKod, hasId, orderData = {}) => {\n          if (!hasId) return 1;\n          if (hasWorkflowState(workflowKod, 'DOKONCENA')) return 10;\n          // ZKONTROLOVANA - fze 10 (ped dokonenm)\n          if (hasWorkflowState(workflowKod, 'ZKONTROLOVANA')) return 10;\n          // VECNA_SPRAVNOST - fze 9 (vcn sprvnost)\n          if (hasWorkflowState(workflowKod, 'VECNA_SPRAVNOST')) return 9;\n          if (hasWorkflowState(workflowKod, 'FAKTURACE')) return 8;\n\n          //  FZE 7: UVEREJNENA - po vyplnn registru smluv\n          if (hasWorkflowState(workflowKod, 'UVEREJNENA')) return 7;\n\n          //  FZE 8: NEUVEREJNIT - rozhodnuto e nebude zveejnna  FZE 8 (Fakturace)\n          if (hasWorkflowState(workflowKod, 'NEUVEREJNIT')) return 8;\n\n          //  FZE 6: UVEREJNIT - rozhodnuto e m bt zveejnna  FZE 6 (vypluj registr)\n          if (hasWorkflowState(workflowKod, 'UVEREJNIT')) return 6;\n\n          if (hasWorkflowState(workflowKod, 'POTVRZENA')) return 5;\n          if (hasWorkflowState(workflowKod, 'ODESLANA')) return 4;\n          if (hasWorkflowState(workflowKod, 'SCHVALENA') || hasWorkflowState(workflowKod, 'ROZPRACOVANA')) return 3;\n          if (hasWorkflowState(workflowKod, 'ODESLANA_KE_SCHVALENI') || hasWorkflowState(workflowKod, 'CEKA_SE')) return 2;\n          return 1;\n        };\n\n        const newPhase = calculatePhaseFromWorkflow(updatedWorkflowKod, parsedUpdateData.id || formData.id, parsedUpdateData);\n        addDebugLog('info', 'UPDATE', 'phase-refreshed', ` Fze EXPLICITN pepotna: ${newPhase}/10, workflow: ${updatedWorkflowKod}`);\n\n\n        //  WORKFLOW REFACTORING: Po spnm UPDATE aktualizovat draft s erstvmi daty z DB\n        // Backend vrac kompletn zznam, take draft bude synchronizovan s DB\n        //  KRITICK: Mergovat pvodn formData (s polokami!) + parsovan DB data\n        try {\n          draftManager.setCurrentUser(user_id);\n\n          //  FIX: Mergovat updatedFormDataImmediate (obsahuje poloky + financovn) + parsedUpdateData (DB data)\n          //  BUGFIX: Zachovat objednatel_id z pvodnho formData, protoe backend ho pi UPDATE NEVRAC\n          //  KRITICK OPRAVA: Zachovat financovn z PVODNHO formData (ped UPDATE), ne z odpovdi BE\n          const mergedDraftData = {\n            ...updatedFormDataImmediate, // Pvodn data s polokami\n            ...parsedUpdateData,         // Pepsat DB daty (workflow, atd.) + PARSOVAN FINANCOVN!\n            // Zachovat poloky a faktury z pvodnho formData\n            polozky_objednavky: updatedFormDataImmediate.polozky_objednavky || [],\n            faktury: fakturyWithAttachments.length > 0 ? fakturyWithAttachments : updatedFormDataImmediate.faktury || [], //  PLOHY!\n            //  ZACHOVAT objednatel_id + osobn daje objednatele z pvodnho formData\n            objednatel_id: updatedFormDataImmediate.objednatel_id || parsedUpdateData.objednatel_id,\n            jmeno: updatedFormDataImmediate.jmeno || parsedUpdateData.jmeno,\n            email: updatedFormDataImmediate.email || parsedUpdateData.email,\n            telefon: updatedFormDataImmediate.telefon || parsedUpdateData.telefon,\n            //  KRITICK: EXPLICITN zachovat dynamick pole financovn Z PVODNHO formData\n            // Backend pi UPDATE nemus vracet vechna pole financovn  pouij PVODN hodnoty z formData\n            zpusob_financovani: parsedUpdateData.zpusob_financovani || formData.zpusob_financovani || updatedFormDataImmediate.zpusob_financovani,\n            lp_kod: parsedUpdateData.lp_kod || formData.lp_kod || updatedFormDataImmediate.lp_kod,\n            cislo_smlouvy: parsedUpdateData.cislo_smlouvy || formData.cislo_smlouvy || updatedFormDataImmediate.cislo_smlouvy,\n            smlouva_poznamka: parsedUpdateData.smlouva_poznamka || formData.smlouva_poznamka || updatedFormDataImmediate.smlouva_poznamka,\n            individualni_schvaleni: parsedUpdateData.individualni_schvaleni || formData.individualni_schvaleni || updatedFormDataImmediate.individualni_schvaleni,\n            individualni_poznamka: parsedUpdateData.individualni_poznamka || formData.individualni_poznamka || updatedFormDataImmediate.individualni_poznamka,\n            pojistna_udalost_cislo: parsedUpdateData.pojistna_udalost_cislo || formData.pojistna_udalost_cislo || updatedFormDataImmediate.pojistna_udalost_cislo,\n            pojistna_udalost_poznamka: parsedUpdateData.pojistna_udalost_poznamka || formData.pojistna_udalost_poznamka || updatedFormDataImmediate.pojistna_udalost_poznamka\n          };\n\n          await draftManager.saveDraft(mergedDraftData, {\n            step: getCurrentPhase(),\n            attachments: attachments,\n            metadata: {\n              version: '1.4',\n              isConceptSaved: true,\n              isOrderSavedToDB: true,\n              savedOrderId: formData.id,\n              isChanged: false, //  FALSE = dn neuloen zmny (ve je v DB)\n              dictionaries: {\n                approvers: approvers || [],\n                users: allUsers || [],\n                strediska: strediskaOptions || [],\n                financovani: financovaniOptions || [],\n                druhyObjednavky: druhyObjednavkyOptions || [],\n                lpKody: lpKodyOptions || []\n              }\n            }\n          });\n          addDebugLog('success', 'UPDATE', 'draft-updated', `Draft aktualizovn s PARSOVANMI DB daty (workflow: ${updatedWorkflowKod}, strediska: ${parsedUpdateData.strediska_kod.join(', ')}, poloky: ${mergedDraftData.polozky_objednavky?.length || 0}, financovn: ${mergedDraftData.zpusob_financovani || 'none'})`);\n\n          //  AKTUALIZOVAT SNAPSHOT po spnm uloen\n          originalFormDataRef.current = JSON.parse(JSON.stringify(mergedDraftData));\n\n          //  BROADCAST: Aktualizovat MenuBar (zstv v edit reimu)\n          broadcastOrderState({\n            isEditMode: true,\n            orderId: formData.id,\n            orderNumber: formData.ev_cislo || formData.cislo_objednavky\n          });\n          addDebugLog('success', 'UPDATE', 'broadcast', `Broadcast stavu odesln (isEditMode: true, orderId: ${formData.id})`);\n        } catch (error) {\n          addDebugLog('error', 'UPDATE', 'draft-update-error', `Chyba pi aktualizaci draftu: ${error.message}`);\n        }\n\n        addDebugLog('success', 'UPDATE', 'workflow-update', `Workflow stav aktualizovn: ${updatedWorkflowKod}`);\n\n        // FZE se automaticky pepot z aktualizovanho formData.stav_workflow_kod\n        addDebugLog('success', 'UPDATE', 'workflow-state', `DB stav: ${updatedWorkflowKod} - fze se pepot automaticky`);\n\n        //  REMOVED: Toast zprva \"Objednvka byla spn aktualizovna\" - notifikace u informuj uivatele\n\n        // Debug: Zkontroluj, zda m workflow stav SCHVALENA\n        const hasSchvalena = hasWorkflowState(updatedWorkflowKod, 'SCHVALENA');\n        addDebugLog('info', 'UPDATE', 'phase-check', `M SCHVALENA: ${hasSchvalena}, nov fze by mla bt: ${hasSchvalena ? '2' : '1'}`);\n\n        // Po spnm UPDATE - reset stav a refresh autosave\n        // Reset odemknut pouze pokud je objednvka skuten schvlen\n        if (hasWorkflowState(updatedWorkflowKod, 'SCHVALENA')) {\n          setIsPhase1Unlocked(false); // Reset odemknut pouze pro schvlenou objednvku\n          addDebugLog('info', 'UPDATE', 'lock-sections', 'FZE 1 sekce zameny - objednvka je schvlen');\n        } else {\n          addDebugLog('info', 'UPDATE', 'keep-unlocked-phase1', `FZE 1 sekce zstvaj odemen - stav: ${updatedWorkflowKod}`);\n        }\n\n        // Pro FZE 2: Zamknout pokud DB obsahuje ODESLANA/ZRUSENA\n        const hasOdeslanaInUpdatedState = hasWorkflowState(updatedWorkflowKod, 'ODESLANA');\n        const hasZrusenaInUpdatedState = hasWorkflowState(updatedWorkflowKod, 'ZRUSENA');\n\n        // Zamykn e useEffect podle formData.stav_workflow_kod\n\n        // ZAMKNOUT FZE 2 - pokud je objednvka odeslan/zruen\n        // KONTROLA POUZE podle DB workflow stavu - NE podle UI checkboxu stav_stornovano!\n        addDebugLog('success', 'UPDATE', 'direct-lock-check', `Pm zamykn FZE 2. Nov stav: ${updatedWorkflowKod}`);\n        const shouldLockPhase2Now = (\n          hasWorkflowState(updatedWorkflowKod, 'ODESLANA') ||\n          hasWorkflowState(updatedWorkflowKod, 'ZRUSENA')\n        );\n\n        if (shouldLockPhase2Now) {\n          //  Zkontrolovat pes DraftManager, jestli nen Phase 2 run odemeno\n          let isManuallyUnlocked = false;\n          try {\n            const uiState = draftManager.getUIState();\n            if (uiState) {\n              const currentOrderId = formData.id;\n              // Kontrolovat pouze pokud existuje ID objednvky\n              if (currentOrderId && uiState.phase2OrderId === currentOrderId && uiState.phase2Unlocked === true) {\n                isManuallyUnlocked = true;\n              }\n            }\n          } catch (e) {\n            addDebugLog('warning', 'UPDATE', 'unlock-check-error', `Chyba pi kontrole Phase 2 unlock stavu: ${e.message}`);\n          }\n\n          if (isManuallyUnlocked) {\n            addDebugLog('info', 'UPDATE', 'phase2-keep-unlocked', `FZE 2 zstv ODEMENA - byla run odemena`);\n          } else {\n            setIsPhase3SectionsUnlocked(false);\n          }\n        }\n        setHasTriedToSubmit(false); // Reset validace po spnm uloen\n\n        // KRITICK: Synchronizace u probhla pes DraftManager.syncWithDatabase()\n        // saveDraftWithData() u nen poteba - data jsou u uloena\n\n        // Pouij explicitn data msto aktulnho stavu formData\n        // KRITICK: orderId potebujeme pro dal operace (me bt pouit i ne)\n        //  V2 API: result je pmo data objednvky, NE result.data!\n        const updateOrderId = result.id || formData.id || formData.id;\n\n        // POZNMKA: Autosave byl pesunut do DraftManager.syncWithDatabase()\n        // Nen poteba volat saveDraftWithData - zpsobovalo duplicitn zpis\n        addDebugLog('info', 'AUTOSAVE', 'skip-duplicate', `Autosave peskoen - ji proveden pes DraftManager.syncWithDatabase()`);\n\n        // === SUPERADMIN/ADMIN zachovn draftu i po UPDATE ===\n        // POUIJ ji deklarovan promnn z nadazenho scope (dek ~5203-5205)\n\n        // RESET isChanged - data jsou synchronizovna s DB\n        setIsChanged(false);\n\n        // KRITICK: Pro bn uivatele spustit progress a pesmrovn (stejn jako u INSERT)\n        const shouldShowProgress = !shouldStayOnForm; // Bn uivatel vid progress\n        const orderNumber = formData.ev_cislo || formData.cislo_objednavky || formData.id;\n\n        if (shouldShowProgress) {\n          //  SYNCHRONN MAZN VECH KL - NESM SE DOSTAT DO RACE CONDITION S NAVIGATE()\n          setDisableAutosave(true);\n          disableAutosaveRef.current = true; //  OKAMIT zakzat autosave (REF)\n          setIsEditMode(false);\n          // NOTE: formData.id removed\n          setIsConceptSaved(false);\n\n          //  Pouij DraftManager pro CENTRALIZOVAN mazn VECH kl (ASYNCHRONN pro verifikaci)\n          if (user_id) {\n            draftManager.setCurrentUser(user_id);\n            const deleted = await draftManager.deleteAllDraftKeys();\n\n            if (deleted) {\n              addDebugLog('success', 'UPDATE', 'draftmanager-delete', `Vechny kle smazny pes DraftManager`);\n            } else {\n            }\n          }\n\n          //  KRITICK: Invaliduj cache PED navigac (aby seznam ml erstv data)\n          try {\n            ordersCacheService.invalidate(user_id);\n            addDebugLog('success', 'UPDATE', 'cache-invalidation', 'Cache invalidovna ped navigac');\n          } catch (e) {\n            addDebugLog('error', 'UPDATE', 'cache-invalidation-error', `Chyba pi invalidaci cache: ${e.message}`);\n          }\n\n          await startSaveProgressAndRedirect(orderNumber, updateOrderId);\n        } else {\n          // SUPERADMIN/ADMIN - zstv na formuli v edit reimu\n          //  Povolit autosave zpt (zstvaj editovat)\n          setDisableAutosave(false);\n          disableAutosaveRef.current = false;\n          draftManager.setAutosaveEnabled(true, 'SUPERADMIN/ADMIN stays on form after UPDATE');\n          addDebugLog('info', 'UPDATE', 'stay-on-form', `SUPERADMIN/ADMIN zstv na formuli - koncept NEN smazn`);\n\n          //  TOAST NOTIFIKACE pro SUPERADMIN/ADMIN pi UPDATE\n          showToast && showToast(' Objednvka spn aktualizovna\\n ' + orderNumber + '\\n Zmny uloeny', 'success');\n\n          //  ADMIN: Zstat na stejn pozici - NEAUTOMATICKY scrollovat\n          // Uivatel m monost pokraovat tam, kde skonil\n          addDebugLog('info', 'UPDATE', 'stay-in-place', 'Zsta na stejn pozici po uloen');\n        }\n      }\n\n    } catch (error) {\n      const endpoint = (!isOrderSavedToDB || !formData.id) ? 'order-v2/create' : 'order-v2/update';\n      addDebugLog('error', 'API', endpoint, error.message);\n\n      // Zpracovat HTTP 423 error (zameno jinm uivatelem)\n      if (error.lock_info) {\n        const lockInfo = error.lock_info;\n        \n        //  FIX: Kontrolovat POUZE locked === true (= zameno JINM uivatelem)\n        // locked === false znamen \"mu editovat\" (voln NEBO moje zamen)\n        if (lockInfo.locked === true) {\n          //  Zameno JINM uivatelem - zobrazit chybu o zamen\n          const userName = lockInfo.locked_by_user_fullname || `uivatel #${lockInfo.locked_by_user_id}`;\n          const lockAge = lockInfo.lock_age_minutes\n            ? ` (zameno ped ${lockInfo.lock_age_minutes} minutami)`\n            : '';\n\n          showToast && showToast(\n            `Nelze uloit zmny. Objednvka je zamena uivatelem ${userName}${lockAge}`,\n            { type: 'error' }\n          );\n          \n          addDebugLog('error', 'LOCK', 'order-locked-by-other', `Objednvka zamena uivatelem ${userName}`);\n        } else {\n          //  locked === false  MOJE objednvka nebo voln, zobrazit obecnou chybu\n          const errorMsg = translateErrorMessageShort(error.message);\n          showToast && showToast(`Nepodailo se uloit objednvku: ${errorMsg}`, { type: 'error' });\n          \n          addDebugLog('info', 'LOCK', 'order-owned-by-me', `Lock info ptomen, ale locked=false (moje objednvka)`);\n        }\n      } else {\n        const errorMsg = translateErrorMessageShort(error.message);\n        showToast && showToast(`Nepodailo se uloit objednvku: ${errorMsg}`, { type: 'error' });\n      }\n\n      //  Povolit autosave zpt pi chyb (uivatel me pokraovat v editaci)\n      setDisableAutosave(false);\n      disableAutosaveRef.current = false;\n      draftManager.setAutosaveEnabled(true, 'Error during save - re-enable autosave');\n\n      setIsSaving(false); // Vyistit saving stav pi chyb\n    } finally {\n      // Trigger user activity update after successful save\n      triggerActivity();\n\n      setIsSavingDraft(false);\n\n      //  KRITICK: Pokat na aktualizaci workflow state ped odemenm UI\n      if (window.__workflowStateUpdated) {\n        addDebugLog('info', 'SAVE', 'waiting-for-workflow', `ekm na propagaci workflow state do React...`);\n\n        // Pokat na render cycle pomoc setTimeout\n        setTimeout(() => {\n          addDebugLog('info', 'SAVE', 'workflow-propagated', `Workflow state propagovn, resetuji isSaving`);\n          window.__workflowStateUpdated = false;\n          setIsSaving(false);\n          addDebugLog('info', 'SAVE', 'finally-cleanup', `isSaving resetovno po workflow update`);\n        }, 200); // Zvil jsem na 200ms pro jistotu\n      } else {\n        addDebugLog('info', 'SAVE', 'no-workflow-update', 'Workflow nebyl aktualizovn, resetuji isSaving hned');\n        setTimeout(() => {\n          setIsSaving(false);\n          addDebugLog('info', 'SAVE', 'finally-cleanup', `isSaving resetovno bez workflow update`);\n        }, 100);\n      }\n\n      //  CACHE: Invaliduj cache po spnm uloen\n      try {\n        addDebugLog('info', 'SAVE', 'cache-invalidation', 'Invaliduji orders cache...');\n        ordersCacheService.invalidate(user_id);\n      } catch (e) {\n      }\n\n      //  Spus background refresh objednvek + notifikac\n      try {\n        addDebugLog('info', 'SAVE', 'background-refresh', 'Spoutm postOrderAction background task...');\n        backgroundTaskService.runTaskNow('postOrderAction');\n      } catch (e) {\n      }\n\n      //  Broadcast zmnu stavu do menu baru po spnm uloen\n      try {\n        //  KRITICK ZMNA: Po spnm uloen NEPROVDT dn draft operace\n        // Draft byl ji smazn v if(shouldShowProgress) bloku ve\n        // Broadcast by mohl zpsobit znovu-vytvoen draftu\n        // Zjisti fzi a slo objednvky pro orderSaved broadcast\n        const orderNumber = formData.ev_cislo || formData.cislo_objednavky || '';\n        const orderId = formData.id || formData.id;\n\n        //  VYPNUTO: Zpsobovalo blikn MenuBaru mezi stavy\n        /*\n        // Pokud byla objednvka uloena do DB, oznmit to ostatnm zlokm\n        if (orderId && orderNumber) {\n          broadcastOrderSaved(orderId, orderNumber);\n        }\n\n        // KRITICK: Urit znovu role uivatele pro broadcast (mus bt i ve finally bloku)\n        const isSuperAdmin = userDetail?.roles?.some(role => role.kod_role === 'SUPERADMIN');\n        const isAdmin = userDetail?.roles?.some(role => role.kod_role === 'ADMINISTRATOR');\n        const shouldStayOnForm = isSuperAdmin || isAdmin;\n\n        // KRITICK: Urit isEditMode podle toho, zda m objednvka ID v DB\n        // ALE: Pro bn uivatele (kte budou pesmrovni) VDY poslat false\n        // Pro SUPERADMIN/ADMIN (kte zstvaj) poslat true pokud m orderId\n        const isEdit = shouldStayOnForm ? !!orderId : false;\n\n        //  KRITICK: Po spnm uloen VDY poslat hasDraft: false\n        // Draft byl ji smazn v deleteAllDraftKeys() ve\n        window.dispatchEvent(new CustomEvent('orderDraftChange', {\n          detail: {\n            hasDraft: false,  //  VDY FALSE po spnm uloen!\n            isEditMode: isEdit,\n            orderId: orderId || formData.id,\n            orderNumber: orderNumber,\n            isLoading: false\n          }\n        }));\n        addDebugLog('success', 'SAVE', 'broadcast', `Broadcast orderDraftChange odesln (hasDraft: false, isEditMode: ${isEdit}, shouldStayOnForm: ${shouldStayOnForm})`);\n        */\n      } catch (e) {\n        // Ignorovat chybu broadcastu\n      }\n    }\n  };\n\n  //  HELPER: Sjednocen funkce pro ukldn draftu s konzistentnm API\n  const saveDraftUnified = async (formDataToSave, options = {}) => {\n    const {\n      isAutoSave = false,\n      explicitSavedOrderId,\n      attachmentsToSave = attachments,\n      isAfterDbSave = false\n    } = options;\n\n    if (!user_id) {\n      if (!isAutoSave) {\n        showToast && showToast('Nelze uloit koncept - nejste pihlen', { type: 'error' });\n      }\n      return false;\n    }\n\n    //  KRITICK: Kontrola zda je autosave povolen\n    if (isAutoSave && !draftManager.isAutosaveEnabled()) {\n      return false;\n    }\n\n    //  EEN PROBLMU #3: NEukldat draft pokud ev_cislo je \"Natm...\"\n    if (formDataToSave.ev_cislo === 'Natm...') {\n      return false;\n    }\n\n    try {\n      if (isAutoSave) {\n        setIsAutoSaving(true);\n      } else {\n        setIsSavingDraft(true);\n      }\n\n      // Nastavit current user\n      draftManager.setCurrentUser(user_id);\n\n      // Zkontroluj existujc draft pro firstSaveDate\n      const existingDraft = await draftManager.hasDraft();\n      let firstSaveDate = null;\n      \n      //  KRITICK: Detekce prvn autosave (NOVA  KONCEPT)\n      const isFirstAutosave = !existingDraft && isAutoSave;\n\n      if (isFirstAutosave) {\n        firstSaveDate = new Date().toISOString();\n        \n        //  BROADCAST: Pechod NOVA  KONCEPT pi prvn zmn!\n        broadcastOrderState({\n          isEditMode: false,\n          isNewOrder: false, // U nen nov, m koncept\n          orderId: null,\n          orderNumber: '',\n          hasDraft: true, //  KLOV: Koncept existuje!\n          currentPhase: currentPhase,\n          mainWorkflowState: mainWorkflowState\n        });\n      } else if (existingDraft) {\n        try {\n          const existing = await draftManager.loadDraft();\n          firstSaveDate = existing?.firstAutoSaveDate || new Date().toISOString();\n        } catch {\n          firstSaveDate = new Date().toISOString();\n        }\n      }\n\n      // Piprav formData kopii - ukld se CEL formData vetn individualni_schvaleni a pojistna_udalost_cislo\n      const draftFormData = { ...formDataToSave };\n\n      if (typeof draftFormData.financovani === 'object' && draftFormData.financovani !== null) {\n        addDebugLog('warning', 'DRAFT', 'deprecated-financovani-block', ' DEPRECATED blok se spustil - ml by bt mrtv kd!');\n        const financovaniObj = {\n          typ_financovani: formDataToSave.typ_financovani || '',\n          uhrada_faktury: formDataToSave.uhrada_faktury || '',\n          doplnujici_data: {}\n        };\n\n        if (formDataToSave.kod_strediska_financovani) financovaniObj.doplnujici_data.kod_strediska_financovani = formDataToSave.kod_strediska_financovani;\n        if (formDataToSave.organizacni_jednotka) financovaniObj.doplnujici_data.organizacni_jednotka = formDataToSave.organizacni_jednotka;\n        if (formDataToSave.ios) financovaniObj.doplnujici_data.ios = formDataToSave.ios;\n        if (formDataToSave.zakazka) financovaniObj.doplnujici_data.zakazka = formDataToSave.zakazka;\n\n        if (formDataToSave.typ_financovani === 'pojistne_udalosti') {\n          if (formDataToSave.pojistna_udalost_cislo) financovaniObj.doplnujici_data.pojistna_udalost_cislo = formDataToSave.pojistna_udalost_cislo;\n          if (formDataToSave.pojistna_udalost_poznamka) financovaniObj.doplnujici_data.pojistna_udalost_poznamka = formDataToSave.pojistna_udalost_poznamka;\n        }\n\n        draftFormData.financovani = JSON.stringify(financovaniObj);\n      }\n\n      // Serializuj attachments (odstra File objekty)\n      const serializableAttachments = attachmentsToSave.map(att => {\n        if (att.file) {\n          const { file, ...rest } = att;\n          return { ...rest, _hadFile: true };\n        }\n        return att;\n      });\n\n      // Urit formData.id\n      //  FIX: Pokud formData.id je null, ale formData.id existuje, pouij formData.id\n      // (objednvka je v DB, ale formData.id state nebyl nastaven pi naten draftu)\n      const effectiveSavedOrderId = explicitSavedOrderId !== undefined\n        ? explicitSavedOrderId\n        : (formData.id || (formDataToSave.id ? formDataToSave.id : null));\n\n      // NOTE: setSavedOrderId removed - formData.id is single source of truth\n\n      //  DEBUG: formData.id tracking\n\n      // Zkontrolovat fze 7/8 data\n      const hasPhase7Or8Data = Boolean(\n        draftFormData.vecna_spravnost_umisteni_majetku ||\n        draftFormData.vecna_spravnost_poznamka ||\n        draftFormData.dokonceni_poznamka\n      );\n\n      //  SPRVN API: saveDraft(formData, options)\n      await draftManager.saveDraft(draftFormData, {\n        orderId: effectiveSavedOrderId,\n        attachments: serializableAttachments,\n        metadata: {\n          firstAutoSaveDate: firstSaveDate,\n          version: '1.4',\n          isConceptSaved: true,\n          isOrderSavedToDB,\n          savedOrderId: effectiveSavedOrderId,\n          isChanged: isAfterDbSave ? hasPhase7Or8Data : true,\n          dictionaries: {\n            approvers: approvers || [],\n            users: allUsers || [],\n            strediska: strediskaOptions || [],\n            financovani: financovaniOptions || [],\n            druhyObjednavky: druhyObjednavkyOptions || [],\n            lpKody: lpKodyOptions || []\n          }\n        }\n      });\n\n      setLastAutoSave(new Date().toISOString());\n      setIsConceptSaved(true);\n\n      setTimeout(() => {\n        setIsAutoSaving(false);\n        setDataSource(null);\n      }, isAutoSave ? 300 : 0);\n\n      if (!isAutoSave) {\n        showToast && showToast(` Koncept spn uloen\\n Mstn loit\\n ${formData.cislo_objednavky || 'Nov objednvka'}`, 'success');\n      }\n\n      return true;\n    } catch (error) {\n      if (!isAutoSave) {\n        showToast && showToast('Nepodailo se uloit koncept', { type: 'error' });\n      }\n      setIsAutoSaving(false);\n      setIsSavingDraft(false);\n      return false;\n    }\n  };\n\n  // Pomocn funkce pro uloen draftu s explicitnmi daty\n  const saveDraftWithData = async (explicitFormData, isAutoSave = false, explicitSavedOrderId = undefined) => {\n    return saveDraftUnified(explicitFormData, {\n      isAutoSave,\n      explicitSavedOrderId\n    });\n  };\n\n  const saveDraft = async (isAutoSave = false, isAfterDbSave = false, customFormData = null) => {\n    //  KRITICK KONTROLA: Pokud se formul zavr, ZABLOKOVAT save\n    if (isClosingRef.current) {\n      return { success: false, reason: 'form_closing' };\n    }\n    \n    //  Pout custom data nebo aktuln formData ze state\n    const dataToSave = customFormData || formData;\n\n    return saveDraftUnified(dataToSave, {\n      isAutoSave,\n      isAfterDbSave\n    });\n  };\n\n  //  Nastavit callback pro useAutosave hook\n  useEffect(() => {\n    autosaveCallbackRef.current = saveDraft;\n  }, [saveDraft]);\n\n  // Funkce pro revalidaci objednvky s DB (ov aktuln stav v databzi)\n  /**\n   *  Helper funkce pro extrakci enriched user data z BE\n   * Backend vrac _enriched objekt s detaily uivatel\n   * Formt: _enriched.objednatel, _enriched.garant, _enriched.prikazce atd.\n   */\n  const extractEnrichedUserData = (enrichedField) => {\n    if (!enrichedField) return null;\n\n    const titul_pred_str = enrichedField.titul_pred ? enrichedField.titul_pred + ' ' : '';\n    const jmeno_str = enrichedField.jmeno || '';\n    const prijmeni_str = enrichedField.prijmeni || '';\n    const titul_za_str = enrichedField.titul_za ? ', ' + enrichedField.titul_za : '';\n    const displayName = `${titul_pred_str}${jmeno_str} ${prijmeni_str}${titul_za_str}`.replace(/\\s+/g, ' ').trim();\n\n    return {\n      displayName: displayName || enrichedField.username || '',\n      email: enrichedField.email || '',\n      telefon: enrichedField.telefon || ''\n    };\n  };\n\n  const revalidateOrderWithDB = async (orderId) => {\n    if (!orderId || !token || !username) {\n      addDebugLog('warning', 'REVALIDATE', 'skip', 'Chyb orderId, token nebo username - peskakuji revalidaci');\n      return null;\n    }\n\n    try {\n      addDebugLog('info', 'REVALIDATE', 'start', `Revaliduji objednvku ID ${orderId} s databz... (token: ${token?.substring(0, 10)}..., username: ${username})`);\n\n\n      //  V2 API: Nati objednvku s enriched daty\n      const dbOrder = await getOrderV2(orderId, token, username, true);\n\n      addDebugLog('info', 'REVALIDATE', 'api-response', `API odpov pro ID ${orderId}: ${JSON.stringify(dbOrder, null, 2)}`);\n\n      if (!dbOrder) {\n        addDebugLog('error', 'REVALIDATE', 'null-response', `API vrtilo null pro objednvku ID ${orderId}`);\n        return null;\n      }\n\n      // V2 API vrac pmo data objednvky (ne objekt s .data polem)\n      const orderData = dbOrder;\n\n      //  DEBUG: Zobrazit vechna enriched data z backendu\n      if (orderData._enriched) {\n        addDebugLog('info', 'REVALIDATE', 'enriched-keys', `Enriched kle: ${Object.keys(orderData._enriched).join(', ')}`);\n      }\n\n      //  KRITICK: Doplnit daje objednatele z _enriched NEBO selnku uivatel\n      if (orderData.objednatel_id) {\n        // 1. Priorita: Pouij enriched data z backendu (pokud existuj)\n        if (orderData._enriched?.objednatel) {\n          const enriched = extractEnrichedUserData(orderData._enriched.objednatel);\n          if (enriched) {\n            orderData.jmeno = enriched.displayName;\n            orderData.email = enriched.email;\n            orderData.telefon = enriched.telefon;\n            addDebugLog('success', 'REVALIDATE', 'objednatel-enriched-be', `Pouity enriched data z BE: ${enriched.displayName}`);\n          }\n        }\n        // 2. Fallback: Dohledat v selnku uivatel (pokud enriched data chyb)\n        else if (allUsers && allUsers.length > 0) {\n          const objednatel = allUsers.find(u =>\n            (u.id && u.id === orderData.objednatel_id) ||\n            (u.user_id && u.user_id === orderData.objednatel_id)\n          );\n\n          if (objednatel) {\n            const titul_pred_str = objednatel.titul_pred ? objednatel.titul_pred + ' ' : '';\n            const jmeno_str = objednatel.jmeno || '';\n            const prijmeni_str = objednatel.prijmeni || '';\n            const titul_za_str = objednatel.titul_za ? ', ' + objednatel.titul_za : '';\n            const displayName = `${titul_pred_str}${jmeno_str} ${prijmeni_str}${titul_za_str}`.replace(/\\s+/g, ' ').trim();\n\n            orderData.jmeno = displayName || objednatel.username || '';\n            orderData.email = objednatel.email || '';\n            orderData.telefon = objednatel.telefon || '';\n\n            addDebugLog('success', 'REVALIDATE', 'objednatel-enriched-fe', `Doplnny daje z FE selnku: ${displayName}`);\n          } else {\n            addDebugLog('warning', 'REVALIDATE', 'objednatel-not-found', `Objednatel ID ${orderData.objednatel_id} nenalezen`);\n          }\n        }\n      }\n\n      addDebugLog('success', 'REVALIDATE', 'loaded', `Natena objednvka z DB: ID=${orderData.id}, stav_workflow_kod=\"${orderData.stav_workflow_kod}\", ev_cislo=\"${orderData.cislo_objednavky || orderData.ev_cislo}\"`);\n\n      return orderData;\n    } catch (error) {\n      addDebugLog('error', 'REVALIDATE', 'failed', `Chyba pi revalidaci: ${error.message}`);\n      return null;\n    }\n  };\n  const deleteDraft = async () => {\n    if (!user_id) return;\n\n    try {\n      //  CENTRALIZOVAN MAZN pes DraftManager (ASYNCHRONN pro verifikaci)\n      draftManager.setCurrentUser(user_id);\n      const deleted = await draftManager.deleteAllDraftKeys();\n\n      if (!deleted) {\n      }\n\n      //  RESET STATES po smazn draftu\n      setIsEditMode(false);\n      setIsConceptSaved(false);\n      // NOTE: formData.id removed\n\n      //  Sma draft pes DraftManager (centralizovan)\n      try {\n        draftManager.setCurrentUser(user_id);\n        await draftManager.deleteDraft();\n      } catch (e) {\n      }\n    } catch (error) {\n    }\n  };\n\n  // Vyistit pouze Phase 2 unlock stav (pi nvratu do pedchoz fze)\n  const clearPhase2UnlockState = () => {\n    if (!user_id) return;\n\n    try {\n      //  Pout DraftManager pro vyitn\n      draftManager.saveUIState({ phase2Unlocked: false });\n      setIsPhase3SectionsUnlocked(false);\n    } catch (error) {\n    }\n  };\n\n  // Resetovn formule do vchozho stavu\n  const resetForm = () => {\n    // Reset formData do zkladnho stavu a nastaven pihlenho uivatele jako objednatele\n    setFormData({\n      uzivatel_id: user_id || '',\n      objednatel_id: user_id || '', // Nastav pihlenho uivatele jako objednatele\n      jmeno: userDetail?.jmeno || '', // Nati jmno z userDetail\n      email: userDetail?.email || '', // Nati email z userDetail\n      telefon: userDetail?.telefon || '', // Nati telefon z userDetail\n      predmet: '',\n      popis_pozadavku: '',\n      garant_uzivatel_id: '',\n      prikazce_id: '',\n      strediska_kod: [],\n      max_cena_s_dph: '',\n      mimoradna_udalost: false, // Mimodn udlost (vchoz false)\n      // Objednatel daje - napl z userDetail\n      objednatel_jmeno: userDetail ? getUserNameById(user_id) : '',\n      objednatel_email: userDetail?.email || '',\n      objednatel_telefon: userDetail?.telefon || '',\n      poznamky: '',\n      prilohy: [],\n      ev_cislo: 'Natm...',\n      // Reset pol pro schvlen\n      stav_schvaleni: '',\n      schvalovatel_id: '',\n      dt_schvaleni: '',\n      schvaleni_komentar: '',\n      stav_workflow_kod: '[\"ODESLANA_KE_SCHVALENI\"]', //  Nov objednvka zan rovnou stavem ODESLANA_KE_SCHVALENI\n      //  KRITICK OPRAVA: Nastavit datumov daje pro novou objednvku\n      temp_datum_objednavky: new Date().toISOString().split('T')[0], // Doasn datum objednvky\n      datum_vytvoreni: '', // Datum vytvoen se nastav a pi prvnm uloen do DB\n      datum_splatnosti: '' // Datum splatnosti zatm przdn\n    });\n\n    // Reset stav uloen objednvky\n    setIsConceptSaved(false);\n    // NOTE: isOrderSavedToDB se odvod automaticky z formData.id\n    // NOTE: formData.id removed\n\n    // Reset validanch chyb a touched fields\n    setValidationErrors({});\n    setTouchedSelectFields(new Set());\n\n    // Reset auto-save asovho raztka\n    setLastAutoSave(null);\n\n    // Reset editanho reimu\n    setIsEditMode(false);\n\n    // Reset flag\n    setIsDraftLoaded(false);\n    \n    //  KRITICK: Reset ref pro natn ev. sla - umonit znovu nast pi nov objednvce\n    hasLoadedNextNumberRef.current = false;\n\n    //  Povolit autosave pi resetu formule (nov objednvka)\n    setDisableAutosave(false);\n    disableAutosaveRef.current = false;\n    draftManager.setAutosaveEnabled(true, 'Form reset - new order');\n\n    //  Vyistit uloen stavy UI pes DraftManager\n    if (user_id) {\n      try {\n        draftManager.saveUIState({\n          sectionState: {},\n          scrollPosition: 0\n        });\n        //  KRITICK: Smazat draft z localStorage, aby se pi naten nenaetl star\n        draftManager.deleteDraft();\n      } catch (error) {\n      }\n    }\n\n    addDebugLog('info', 'FORM', 'reset', 'Formul resetovn do vchozho stavu a draft smazn');\n  };\n\n  const hasDraft = () => {\n    if (!user_id) return false;\n    draftManager.setCurrentUser(user_id);\n    return draftManager.hasDraft();\n  };\n\n  // Hlavn inicializan funkce s progress barem\n  const initializeForm = async () => {\n\n    if (!token || !username) {\n      setIsFormInitializing(false);\n      setIsLoadingCiselniky(false); //  NOV: selnky nejsou naten (chyba)\n      setInitializationError('Nejste pihlen');\n      return;\n    }\n\n    try {\n      setIsFormInitializing(true);\n      setIsLoadingCiselniky(true); //  NOV: Zanme natat selnky\n      setInitializationError(null);\n\n      // Start progress bar\n      if (startGlobalProgress) startGlobalProgress();\n      if (setGlobalProgress) setGlobalProgress(10);\n\n      //  REMOVED: FormDataManager.registerStateCallbacks\n      // selnky se nyn nataj pes useFormController  useDictionaries\n      // State settery u neexistuj - data jsou v dictionariesReducer\n\n      if (setGlobalProgress) setGlobalProgress(30);\n\n      //  INICIALIZACE PES MANAGER - NEJDV nati slovnky\n      const cache = await formDataManager.initialize({\n        token,\n        username,\n        formDataId: formData.id\n      });\n\n      if (setGlobalProgress) setGlobalProgress(60);\n\n      if (setGlobalProgress) setGlobalProgress(90);\n\n      // Kontrola, jestli jsou data naten\n      const hasData = (\n        cache.users.length > 0 ||\n        cache.approvers.length > 0 ||\n        cache.strediska.length > 0 ||\n        cache.lpKody.length > 0\n      );\n\n      if (!hasData) {\n        const errorMsg = 'Nepodailo se nast dn data z API';\n        setInitializationError(errorMsg);\n        setIsLoadingCiselniky(false); //  NOV: selnky se nepodailo nast\n\n        if (showToast) showToast(errorMsg, { type: 'error' });\n        if (failGlobalProgress) failGlobalProgress();\n      } else {\n        //  REMOVED: setAreDictionariesReady - u se nepouv\n        // Flag areDictionariesReady je nyn alias na dictionaries.isReady\n        setIsLoadingCiselniky(false); //  NOV: selnky jsou naten!\n        setIsInitialized(true);\n\n        //  RESOLVE PROMISE se dl v useEffect, kter ek na skutenou zmnu options\n        // NE tady - tady se jen nastav flag\n\n        if (doneGlobalProgress) doneGlobalProgress();\n\n        //  ZRUENO: Obnoven pozice scrollu (na dost uivatele)\n        // if (hasDraft() && user_id) {\n        //   draftManager.setCurrentUser(user_id);\n        //   loadScrollPosition();\n        // }\n      }\n\n    } catch (error) {\n      const errorMsg = 'Nepodailo se inicializovat formul';\n      setInitializationError(errorMsg);\n      setIsLoadingCiselniky(false); //  NOV: Chyba pi natn selnk\n\n      if (showToast) showToast(errorMsg, { type: 'error' });\n      if (failGlobalProgress) failGlobalProgress();\n    }\n  };\n\n  //  KRITICK OPRAVA: Spustit initializeForm() JEN PI MOUNT (useEffect s przdnmi dependencies)\n  // POUZE pokud nebylo zamen u zpracovno pi natn z DB\n  useEffect(() => {\n    if (formData.id && user_id && formData.stav_workflow_kod && !isPhase3SectionsLockProcessedFromDB) {\n\n      try {\n        //  Nast stav pes DraftManager\n        const uiState = draftManager.getUIState();\n        if (uiState && uiState.phase2Unlocked) {\n          // Ovit, e se jedn o stejnou objednvku (podle ID)\n          if (uiState.phase2OrderId === formData.id && uiState.phase2Unlocked === true) {\n\n            // Kontrola oprvnn a aktulnho workflow stavu\n            const isOrderSent = hasWorkflowState(formData.stav_workflow_kod, 'ODESLANA');\n            const isOrderCancelled = hasWorkflowState(formData.stav_workflow_kod, 'ZRUSENA');\n            // KONTROLA POUZE podle DB workflow stavu - NE podle UI checkboxu!\n            const isOrderInPhase3OrHigher = isOrderSent || isOrderCancelled;\n\n            // FINLN TVRD KONTROLA: I kdy uiState k unlock, ZKONTROLUJ workflow stav!\n            const currentWorkflowState = formData.stav_workflow_kod || 'NOVA';\n            const hasOdeslano = hasWorkflowState(currentWorkflowState, 'ODESLANA');\n            const hasZruseno = hasWorkflowState(currentWorkflowState, 'ZRUSENA');\n\n            // Smazat unlock stav a zamknout POUZE pokud je stav v DB ODESLANA nebo ZRUSENA\n            if (hasOdeslano || hasZruseno) {\n              draftManager.saveUIState({ phase2Unlocked: false }); // Sma neplatn stav\n              setIsPhase3SectionsUnlocked(false);\n            } else {\n              setIsPhase3SectionsUnlocked(true);\n            }\n          }\n        }\n      } catch (e) {\n        // Chyba pi natn stavu\n      }\n    }\n  }, [formData.id, user_id, formData.stav_workflow_kod, isPhase3SectionsLockProcessedFromDB]);\n\n  // DODATEN OCHRANA: Sledovn setTimeout re-render a blokace dal localStorage kontroly\n  const [preventLocalStorageCheck, setPreventLocalStorageCheck] = useState(false);\n\n  useEffect(() => {\n    if (isPhase3SectionsLockProcessedFromDB && !preventLocalStorageCheck) {\n      setPreventLocalStorageCheck(true);\n      addDebugLog('info', 'PHASE2-UNLOCK', 'prevention-set', `Nastavena prevence localStorage kontroly - zamen zpracovno z DB`);\n    }\n  }, [isPhase3SectionsLockProcessedFromDB, preventLocalStorageCheck]);\n\n  // Sledovn zmn workflow stavu pro vynucen zamen Phase 2\n  useEffect(() => {\n    if (formData.id && formData.stav_workflow_kod && user_id) {\n      const isOrderSent = hasWorkflowState(formData.stav_workflow_kod, 'ODESLANA');\n      const isOrderCancelled = hasWorkflowState(formData.stav_workflow_kod, 'ZRUSENA');\n      // KONTROLA POUZE podle DB workflow stavu - NE podle UI checkboxu!\n      const isOrderInPhase3OrHigher = isOrderSent || isOrderCancelled;\n\n      // VDY ZAMKNOUT pokud je objednvka ve fzi 3+ (ODESLANA/ZRUENA) a nen run odemena\n      if (isOrderInPhase3OrHigher && isPhase3SectionsUnlocked) {\n        //  Zkontrolovat jestli nen run odemeno pes DraftManager\n        let isManuallyUnlocked = false;\n        try {\n          const uiState = draftManager.getUIState();\n          if (uiState) {\n            // Kontrolovat pouze pokud existuje ID objednvky\n            if (formData.id && uiState.phase2OrderId === formData.id && uiState.phase2Unlocked === true) {\n              isManuallyUnlocked = true;\n            }\n          }\n        } catch (e) {\n          // Chyba pi kontrole stavu\n        }\n\n        if (!isManuallyUnlocked) {\n          setIsPhase3SectionsUnlocked(false);\n\n          //  Vyistit stav pes DraftManager pokud nen run odemeno\n          try {\n            draftManager.saveUIState({ phase2Unlocked: false });\n          } catch (e) {\n            // Chyba pi mazn stavu\n          }\n        }\n      }\n    }\n  }, [formData.stav_workflow_kod, formData.id, user_id, isPhase3SectionsUnlocked]);\n\n  // Reset stavu pi pechodu na novou objednvku (po zruen editace)\n  useEffect(() => {\n    if (isNewOrder && userDetail && user_id) {\n\n      // Reset stavu natn draftu\n      setIsDraftLoaded(false);\n      setDataSource(null);\n      setIsPhase3SectionsLockProcessedFromDB(false); // Reset flag pro novou objednvku\n\n      // Vypl daje aktuln pihlenho uivatele\n      const jmeno = `${userDetail.titul_pred ? userDetail.titul_pred + ' ' : ''}${userDetail.jmeno || ''} ${userDetail.prijmeni || ''}${userDetail.titul_za ? ', ' + userDetail.titul_za : ''}`.replace(/\\s+/g, ' ').trim();\n\n      setFormData(prev => ({\n        ...prev,\n        uzivatel_id: user_id,\n        objednatel_id: user_id,\n        jmeno: jmeno,\n        email: userDetail.email || '',\n        telefon: userDetail.telefon || '',\n        // Vymazn dat z pedchoz editace\n        id: null,\n        ev_cislo: '',\n        cislo_objednavky: null,\n        predmet: '',\n        popis_pozadavku: '',\n        max_cena_s_dph: '',\n        polozky_objednavky: [{ id: Date.now(), popis: '', cena_bez_dph: '', sazba_dph: '21', cena_s_dph: '' }]\n      }));\n\n      // Reset validanho stavu\n      setHasTriedToSubmit(false);\n      setValidationErrors({});\n      setTouchedSelectFields(new Set());\n\n      // Success log odstrann\n    }\n  }, [isNewOrder, userDetail, user_id]);\n\n  // Naten stavu sekc pi mount komponentu\n  useEffect(() => {\n    if (user_id) {\n      const savedSectionStates = loadSectionStates();\n      if (savedSectionStates) {\n        setSectionStates(prev => ({\n          ...prev,\n          ...savedSectionStates\n        }));\n        addDebugLog('success', 'UI', 'section-states', `Naten uloen stav sekc: ${JSON.stringify(savedSectionStates)}`);\n      }\n    }\n  }, [user_id]);\n\n  // Debug logger DOASN VYPNUT - zpsobuje nekonenou smyku\n  // useEffect(() => {\n  //   setDebugLogger(addDebugLog);\n  // }, []);\n\n  //  JEDNODUCH LOGIKA: VDY pi mount spus INIT\n  useEffect(() => {\n    // // console.log(' MOUNT OrderForm25 - spoutm INIT');\n\n    if (token && username) {\n      // Inicializace zen useFormController\n    }\n\n    return () => {\n      // // console.log(' UNMOUNT OrderForm25 - istm state');\n      setIsInitialized(false);\n      //  REMOVED: setAreDictionariesReady - u se nepouv (alias na dictionaries.isReady)\n    };\n  }, []);\n\n  //  NAVIGATION FIX: Reset initialization state when editOrderId changes\n  // This ensures form re-initializes when navigating between different orders\n  useEffect(() => {\n    // Reset flags to allow re-initialization\n    setIsInitialized(false);\n    setIsDraftLoaded(false);\n    setIsFormInitializing(true);\n\n    // Reset hasLoadedNextNumberRef to allow loading new order number\n    if (hasLoadedNextNumberRef.current) {\n      hasLoadedNextNumberRef.current = false;\n    }\n\n    //  KRITICK: Vymazat formData pi zmn order ID\n    // Zabrnme zobrazen dat ze STAR objednvky bhem natn NOV\n    if (editOrderId) {\n      // Zachovat pouze zkladn strukturu formData, vymazat vechny hodnoty\n      setFormData({\n        objednatel_id: user_id || '',\n        uzivatel_id: user_id || '',\n        garant_uzivatel_id: user_id || '',\n        jmeno: '',\n        email: '',\n        telefon: '',\n        ev_cislo: 'Natm...',\n        druh_objednavky_kod: '',\n        strediska_kod: [],\n        zpusob_financovani: '',\n        poznamka: '',\n        mimoradna_udalost: false, // Mimodn udlost\n        polozky_objednavky: [{\n          nazev: '',\n          specifikace: '',\n          mnozstvi: 1,\n          merna_jednotka: '',\n          jednotkova_cena: '',\n          celkova_cena: 0\n        }],\n        dodavatel: {},\n        faktury: [],\n        stav_workflow_kod: ['NOVA'],\n        stav_schvaleni: 'ek na schvlen'\n      });\n    }\n  }, [editOrderId, user_id]);\n\n  //  REMOVED: Deprecated useEffect pro natn objednvky (177 dk)\n  // Archivovno v: _DEPRECATED/OrderForm25-deprecated-useEffects.js\n  // Nahrazeno: useFormController.initializeForm()\n\n  //  UKONEN SPLASH SCREEN - a kdy jsou data skuten VYKRESLEN (selnky + objednvka natena)\n  useEffect(() => {\n    // Pro novou objednvku: ekej jen na selnky + draft loaded\n    if (!editOrderId) {\n      if (areDictionariesReady && isInitialized && isDraftLoaded) {\n        setIsFormInitializing(false);\n      }\n      return;\n    }\n\n    // Pro editaci: ekaj na selnky + draft loaded\n    if (areDictionariesReady && isInitialized && isDraftLoaded) {\n      setIsFormInitializing(false);\n    }\n  }, [editOrderId, areDictionariesReady, isInitialized, isDraftLoaded]);\n\n  //  REF: Sleduje zda u bylo ev_cislo nateno (JEDNOU a dost!)\n  const hasLoadedNextNumberRef = useRef(false);\n\n  //  REF: Pm reference na ScrollableContent element pro scroll pozici\n  const scrollableContentRef = useRef(null);\n\n  //  REF: Pm reference na FixedHeader pro dynamick men vky\n  const fixedHeaderRef = useRef(null);\n\n  //  Sdlet ref pes window pro pstup z onDataLoaded\n  //  KRITICK: Pi mount zkontrolovat, jestli mme draft - pokud ne, resetovat ref\n  useEffect(() => {\n    window.__orderForm_hasLoadedNextNumberRef = hasLoadedNextNumberRef;\n    \n    //  FIX: Pokud NEN draft, resetovat ref (ppad hard reload po \"Nov objednvka\")\n    if (user_id) {\n      draftManager.setCurrentUser(user_id);\n      draftManager.hasDraft().then(hasDraft => {\n        if (!hasDraft && !editOrderId) {\n          // Nen draft ANI editace  reset ref, aby se naetlo ev. slo\n          hasLoadedNextNumberRef.current = false;\n        }\n      });\n    }\n  }, [user_id, editOrderId]);\n\n  //  Dynamick men vky FixedHeader a nastaven CSS variable\n  // Vka headeru + konstantn gap 20px = padding-top pro ScrollableInner\n  useLayoutEffect(() => {\n    const GAP = 20; // Konstantn mezera mezi headerem a obsahem\n\n    const updateHeaderHeight = () => {\n      if (fixedHeaderRef.current) {\n        const height = fixedHeaderRef.current.offsetHeight;\n        // Nastavit CSS custom property: vka headeru + konstantn gap\n        document.documentElement.style.setProperty('--fixed-header-height', `${height + GAP}px`);\n      }\n    };\n\n    // Aktualizovat OKAMIT pi mount\n    updateHeaderHeight();\n    \n    // Opakovat nkolikrt po mount pro jistotu (dynamick obsah se me renderovat postupn)\n    const timeouts = [\n      setTimeout(updateHeaderHeight, 50),\n      setTimeout(updateHeaderHeight, 100),\n      setTimeout(updateHeaderHeight, 200),\n      setTimeout(updateHeaderHeight, 500)\n    ];\n\n    window.addEventListener('resize', updateHeaderHeight);\n\n    // Aktualizovat tak pi zmnch obsahu headeru (ResizeObserver)\n    const observer = new ResizeObserver(() => {\n      updateHeaderHeight();\n    });\n\n    if (fixedHeaderRef.current) {\n      observer.observe(fixedHeaderRef.current);\n    }\n\n    return () => {\n      timeouts.forEach(t => clearTimeout(t));\n      window.removeEventListener('resize', updateHeaderHeight);\n      observer.disconnect();\n    };\n  }, []);\n  \n  //  Pepotat vku headeru pi zmn stavu objednvky nebo workflow\n  useEffect(() => {\n    if (fixedHeaderRef.current) {\n      const height = fixedHeaderRef.current.offsetHeight;\n      document.documentElement.style.setProperty('--fixed-header-height', `${height + 20}px`);\n    }\n  }, [isOrderCompleted, shouldLockAllSections, formData.stav_workflow_kod, formData.ev_cislo, formData.dokoncil_id]);\n\n  // Naten evidennho sla - POUZE pro nov objednvky, POUZE JEDNOU!\n  useEffect(() => {\n    //  KRITICK: Nast slo JEN JEDNOU!\n\n    // 0 U bylo nateno  SKIP\n    if (hasLoadedNextNumberRef.current) {\n      return;\n    }\n\n    // 1 Pokud m ID  uloeno v DB  SKIP\n    if (formData.id) {\n      return;\n    }\n\n    // 2 Pokud je v EDIT mode  SKIP\n    if (isEditMode) {\n      return;\n    }\n\n    // 3 Pokud u m ev_cislo (ne \"Natm...\")  SKIP\n    if (formData.ev_cislo && formData.ev_cislo !== 'Natm...') {\n      hasLoadedNextNumberRef.current = true; // Oznait e u mme slo\n      return;\n    }\n\n    //  Vygeneruj slo JEN KDY:\n    // - Nen ID, nen edit mode, nen ev_cislo, mme API pstup\n    if (token && username) {\n      loadNextOrderNumber().then(success => {\n        if (success) {\n          hasLoadedNextNumberRef.current = true; // Oznait e u bylo nateno\n        }\n      });\n    }\n  }, [formData.id, isEditMode, token, username]); //  REMOVED: formData.ev_cislo z dependencies!\n\n  //  Funkce pro naten detail LP (zbvajc stka)\n  const loadLPDetail = useCallback(async (lp_id_or_kod) => {\n    if (!lp_id_or_kod || !token || !username) return;\n\n    // Najt LP option pro zskn cislo_lp\n    const lpOption = lpKodyOptions.find(opt => opt.id === lp_id_or_kod || opt.kod === lp_id_or_kod);\n    if (!lpOption) {\n      return;\n    }\n\n    // Backend oekv cislo_lp (textov kd typu \"LPIA1\")\n    const cislo_lp = lpOption.cislo_lp || lpOption.label || lpOption.kod;\n    if (!cislo_lp) {\n      return;\n    }\n\n    setLoadingLpDetails(prev => {\n      // Pokud u mme detaily nebo se prv nataj, nemusme natat znovu\n      if (prev[lp_id_or_kod]) return prev;\n      return { ...prev, [lp_id_or_kod]: true };\n    });\n\n    try {\n      const detail = await fetchLPDetail({ token, username, cislo_lp });\n      if (detail) {\n        setLpDetails(prev => ({ ...prev, [lp_id_or_kod]: detail }));\n      }\n    } catch (error) {\n      // Netobrazovat toast pokud je to jen 404 - LP nemus existovat\n      if (!error.message.includes('404') && !error.message.includes('400')) {\n        showToast(`Nepodailo se nast detail LP: ${error.message}`, 'error');\n      }\n    } finally {\n      setLoadingLpDetails(prev => ({ ...prev, [lp_id_or_kod]: false }));\n    }\n  }, [token, username, showToast, lpKodyOptions]);\n\n  //  Funkce pro naten seznamu smluv (pro autocomplete)\n  const loadSmlouvyList = useCallback(async () => {\n    if (!token || !username) return;\n    if (loadingSmlouvyList) return; // Zabrnit duplicitnmu natn\n\n    setLoadingSmlouvyList(true);\n\n    try {\n      const response = await getSmlouvyList({\n        token,\n        username,\n        show_inactive: false,\n        limit: 500 // Nast max 500 aktivnch smluv\n      });\n\n      if (response?.data && Array.isArray(response.data)) {\n        setSmlouvyList(response.data);\n      } else {\n        setSmlouvyList([]);\n      }\n    } catch (error) {\n      // Nebudeme zobrazovat toast - me to bt jen chybjc oprvnn\n      setSmlouvyList([]);\n    } finally {\n      setLoadingSmlouvyList(false);\n    }\n  }, [token, username, loadingSmlouvyList]);\n\n  //  Funkce pro naten detailu smlouvy (zbvajc stka)\n  const loadSmlouvaDetail = useCallback(async (cislo_smlouvy) => {\n    if (!cislo_smlouvy || !token || !username) {\n      setSmlouvaDetail(null);\n      return;\n    }\n\n    setLoadingSmlouvaDetail(true);\n\n    try {\n      // Najt smlouvu podle sla v natenm seznamu\n      const smlouva = smlouvyList.find(s => \n        s.cislo_smlouvy === cislo_smlouvy || \n        s.evidencni_cislo === cislo_smlouvy\n      );\n\n      if (smlouva) {\n        // Pout data pmo ze seznamu - u obsahuj vechny potebn informace\n        setSmlouvaDetail(smlouva);\n      } else {\n        // Smlouva nebyla nalezena v seznamu - umonit uivateli zadat vlastn slo\n        setSmlouvaDetail({ notFound: true });\n      }\n    } catch (error) {\n      setSmlouvaDetail({ notFound: true });\n    } finally {\n      setLoadingSmlouvaDetail(false);\n    }\n  }, [token, username, smlouvyList, formData.cislo_smlouvy]);\n\n  //  DEBUG: Monitor formData checkboxy changes\n  // DEBUG: Sledovn zmn checkbox pro zamykn sekc\n  useEffect(() => {\n    // Removed verbose logging - checkbox states tracked internally\n  }, [formData.potvrzeni_vecne_spravnosti, formData.potvrzeni_dokonceni_objednavky, formData.id]);\n\n  //  ODSTRANNO: Reload uivatel - FormDataManager to dl automaticky pi inicializaci\n  // useEffect(() => {\n  //   if (token && username && !isFormInitializing) {\n  //     loadAllUsers();\n  //   }\n  // Automatick naplnn daj objednatele pi prvn interakci s formulem\n  useEffect(() => {\n    // Kontrola: M uivatel daje, jsou daje objednatele przdn, nen editan reim, nen ji naten draft\n    const shouldFillOrdererData = userDetail &&\n                                  user_id &&\n                                  !isEditMode &&\n                                  !isDraftLoaded &&\n                                  !formData.objednatel_id &&\n                                  !formData.jmeno &&\n                                  !formData.email;\n\n    // Kontrola: M formul njak obsah (uivatel zaal vyplovat)?\n    const hasUserInput = (formData.predmet && String(formData.predmet).trim()) ||\n                        formData.garant_uzivatel_id ||\n                        formData.prikazce_id ||\n                        (formData.strediska_kod && Array.isArray(formData.strediska_kod) && formData.strediska_kod.length > 0) ||\n                        (formData.max_cena_s_dph && parseFloat(formData.max_cena_s_dph) > 0) ||\n                        (formData.popis_pozadavku && String(formData.popis_pozadavku).trim());\n\n    if (shouldFillOrdererData && hasUserInput) {\n\n      const jmeno = `${userDetail.titul_pred ? userDetail.titul_pred + ' ' : ''}${userDetail.jmeno || ''} ${userDetail.prijmeni || ''}${userDetail.titul_za ? ', ' + userDetail.titul_za : ''}`.replace(/\\s+/g, ' ').trim();\n\n      setFormData(prev => ({\n        ...prev,\n        objednatel_id: user_id,\n        jmeno: jmeno || 'Neuvedeno',\n        email: userDetail.email || '',\n        telefon: userDetail.telefon || ''\n      }));\n    }\n  }, [userDetail, user_id, isEditMode, isDraftLoaded, formData.objednatel_id, formData.jmeno, formData.email,\n      formData.predmet, formData.garant_uzivatel_id, formData.prikazce_id, formData.strediska_kod,\n      formData.max_cena_s_dph, formData.popis_pozadavku]);\n\n  //  Automatick detekce: M bt zveejnna (cena > 50 000 K bez DPH)\n  useEffect(() => {\n    // Pouze pokud mme poloky objednvky\n    if (!formData.polozky_objednavky || formData.polozky_objednavky.length === 0) {\n      return;\n    }\n\n    // Vypotat celkovou cenu BEZ DPH ze vech poloek\n    const celkovaCenaBezDPH = formData.polozky_objednavky.reduce((sum, polozka) => {\n      //  FIX: Odstranit formtovn ped parseFloat\n      const cena = parseFloat((polozka.cena_bez_dph || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\n      const mnozstvi = parseFloat(polozka.mnozstvi || 0);\n      return sum + (cena * mnozstvi);\n    }, 0);\n\n    // Pokud je cena > 50 000 K bez DPH a checkbox nen jet zakrtnut\n    if (celkovaCenaBezDPH > 50000 && !formData.ma_byt_zverejnena) {\n      setFormData(prev => ({\n        ...prev,\n        ma_byt_zverejnena: true\n      }));\n    }\n  }, [formData.polozky_objednavky, formData.ma_byt_zverejnena]);\n\n  // Fix: Zajitn sprvnho zobrazen LP kd po naten options\n  // Kdy se natou lpKodyOptions a formData.lp_kod u obsahuje ID,\n  // komponenta se mus pekreslit, aby zobrazila nzvy msto ID\n  useEffect(() => {\n    // Kontrola: Mme naten LP kdy options a formData obsahuje lp_kod pole?\n    if (lpKodyOptions.length > 0 &&\n        Array.isArray(formData.lp_kod) &&\n        formData.lp_kod.length > 0) {\n\n      // Zkontroluj, jestli vechna ID v lp_kod existuj v lpKodyOptions\n      const allFound = formData.lp_kod.every(id =>\n        lpKodyOptions.some(opt => (opt.id || opt.kod) === id)\n      );\n\n      if (allFound) {\n        // Vechny LP kdy jsou v options - nen poteba nic dlat\n        // Ale meme vynutit re-render nastavenm dummy state\n        // (toto pome kdy se options naetly a po formData)\n        // Nen poteba - React automaticky pekresl kdy se zmn lpKodyOptions\n      } else {\n        // Nkter ID nejsou v options - mon se jet nenaetly\n        // Pokme na dal render cyklus\n      }\n    }\n  }, [lpKodyOptions, formData.lp_kod]);\n\n  //  Automatick natn detail LP pi vbru\n  useEffect(() => {\n    if (!Array.isArray(formData.lp_kod) || formData.lp_kod.length === 0) {\n      return; // dn LP vybrny\n    }\n\n    // Nast detaily pro kad vybran LP (pokud jet nejsou naten)\n    formData.lp_kod.forEach(lp_id => {\n      if (!lpDetails[lp_id] && !loadingLpDetails[lp_id]) {\n        loadLPDetail(lp_id);\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [formData.lp_kod]);\n\n  //  Naten seznamu smluv pi mount (pro autocomplete)\n  useEffect(() => {\n    if (token && username && smlouvyList.length === 0 && !loadingSmlouvyList) {\n      loadSmlouvyList();\n    }\n  }, [token, username, smlouvyList.length, loadingSmlouvyList, loadSmlouvyList]);\n\n  //  Automatick generovn individualni_schvaleni z ev_cislo (O-  I-)\n  useEffect(() => {\n    // Pouze pro Individuln schvlen\n    const selectedSource = financovaniOptions.find(opt => opt.kod === formData.zpusob_financovani);\n    const nazev = selectedSource?.nazev || '';\n    const isIndividualni = nazev.includes('Individuln') && !nazev.includes('Pojistn');\n    \n    if (!isIndividualni) {\n      return; // Nejedn se o Individuln schvlen\n    }\n\n    // Zskat ev_cislo - me bt string nebo object\n    let evCislo = '';\n    if (typeof formData.ev_cislo === 'string') {\n      evCislo = formData.ev_cislo;\n    } else if (typeof formData.ev_cislo === 'object' && formData.ev_cislo) {\n      evCislo = formData.ev_cislo.order_number_string || \n                formData.ev_cislo.next_order_string || \n                formData.ev_cislo.next_number || '';\n    }\n\n    if (!evCislo || !evCislo.startsWith('O-')) {\n      return; // Nemme validn ev_cislo zanajc O-\n    }\n\n    // Nahradit O- za I-\n    const iCislo = evCislo.replace(/^O-/, 'I-');\n    \n    // Aktualizovat pouze pokud se li\n    if (formData.individualni_schvaleni !== iCislo) {\n      setFormData(prev => ({\n        ...prev,\n        individualni_schvaleni: iCislo\n      }));\n    }\n  }, [formData.ev_cislo, formData.zpusob_financovani, financovaniOptions, formData.individualni_schvaleni]);\n\n  //  Automatick vymazn LP kd pi zmn pkazce\n  useEffect(() => {\n    // Pouze pokud jsou vybran njak LP kdy\n    if (!formData.lp_kod || !Array.isArray(formData.lp_kod) || formData.lp_kod.length === 0) {\n      return;\n    }\n\n    // Zkontrolovat, zda vybran LP kdy odpovdaj novmu filtru\n    const selectedLpIds = formData.lp_kod;\n    const validLpIds = filteredLpKodyOptions.map(lp => lp.id || lp.kod);\n\n    // Pokud njak vybran LP ji nen ve filtru, vymazat vechny LP kdy\n    const hasInvalidLp = selectedLpIds.some(lpId => !validLpIds.includes(lpId));\n\n    if (hasInvalidLp) {\n      setFormData(prev => ({\n        ...prev,\n        lp_kod: []\n      }));\n\n      showToast('LP kdy byly vymazny - pkazce m jin sek', 'info');\n    }\n  }, [formData.prikazce_id, filteredLpKodyOptions]); // Spust se pi zmn pkazce nebo filtrovanch LP\n\n  //  Automatick naten detailu smlouvy pi zmn sla smlouvy\n  useEffect(() => {\n    if (formData.cislo_smlouvy && formData.cislo_smlouvy.trim()) {\n      loadSmlouvaDetail(formData.cislo_smlouvy.trim());\n    } else {\n      setSmlouvaDetail(null);\n    }\n  }, [formData.cislo_smlouvy, loadSmlouvaDetail]);\n\n  //  AUTOFILL DODAVATELE po schvlen ADMINem\n  // Kdy se objev stav SCHVALENA + financovn SMLOUVA + dodavatel przdn, spustit autofill\n  useEffect(() => {\n    const shouldAutoFill = async () => {\n      // Kontrola podmnek\n      const hasSchvalena = hasWorkflowState(formData.stav_workflow_kod, 'SCHVALENA');\n      const isSmlouva = formData.zpusob_financovani?.toUpperCase() === 'SMLOUVA';\n      const hasCisloSmlouvy = !!formData.cislo_smlouvy?.trim();\n      const nemaDodavatele = !formData.dodavatel_nazev?.trim() && !formData.dodavatel_ico?.trim();\n      \n      if (hasSchvalena && isSmlouva && hasCisloSmlouvy && nemaDodavatele && smlouvaDetail && !smlouvaDetail.notFound) {\n        try {\n          const supplierData = await autoFillSupplierFromContract(formData, currentPhase);\n          \n          if (supplierData) {\n            setFormData(prev => ({\n              ...prev,\n              ...supplierData\n            }));\n            setSupplierAutoFillSource(supplierData.source);\n            setIsChanged(true);\n          }\n        } catch (error) {\n        }\n      }\n    };\n    \n    shouldAutoFill();\n  }, [formData.stav_workflow_kod, formData.zpusob_financovani, formData.cislo_smlouvy, formData.dodavatel_nazev, formData.dodavatel_ico, smlouvaDetail, autoFillSupplierFromContract, currentPhase, hasWorkflowState]);\n\n  // Auto-save konceptu pi zmnch formData (s debounce 2000ms)\n  useEffect(() => {\n    // Neukldej przdn formul - spust se pokud je vyplnn pedmt NEBO garant NEBO jakkoli relevantn pole\n    const hasRelevantData = (\n      formData.predmet ||\n      formData.garant_uzivatel_id ||\n      formData.popis_pozadavku ||\n      formData.max_cena_s_dph ||\n      formData.poznamky ||\n      formData.dodavatel_nazev ||\n      (formData.strediska_kod && formData.strediska_kod.length > 0) ||\n      (formData.polozky_objednavky && formData.polozky_objednavky.some(p => p.popis))\n    );\n\n    //  Kontrola zda je strnka viditeln (uivatel je aktivn na tto zloce)\n    const isPageVisible = !document.hidden;\n\n    //  ZABLOKUJ autosave pokud:\n    // - probh ukldn do DB\n    // - je viditeln progress bar\n    // - byl spn uloen do DB (disableAutosave flag/ref)\n    // - DraftManager m autosave zakzn (centrln kontrola)\n    // - Strnka nen viditeln (uivatel je na jin zloce/aplikaci)\n    // - KRITICK: Draft jet nebyl naten pi mount (prevence pepsn existujcho draftu)\n    if (!user_id || !hasRelevantData || isSaving || showSaveProgress || disableAutosave || disableAutosaveRef.current || !draftManager.isAutosaveEnabled() || !isPageVisible || !isDraftLoaded) {\n      return; // Tich return - dn debug log pi bnm psan\n    }\n\n    // DEBOUNCED autosave - ulo se a 3000ms po posledn zmn\n    // (nastaveno na 3s + autosave pi oputn pole)\n    // Timer se ru a nastavuje nov pi kad zmn formData\n    const debounceTimer = setTimeout(() => {\n      saveDraft(true); // auto-save = true\n    }, 3000);\n\n    // Cleanup - vyisti timer pi dal zmn nebo unmount\n    return () => clearTimeout(debounceTimer);\n  }, [formData, user_id, isSaving, showSaveProgress, disableAutosave, isDraftLoaded]);\n\n  //  Page Visibility listener - pozastav autosave kdy uivatel pepne zloku\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      if (document.hidden) {\n      } else {\n        // NEDLME okamit autosave - nech ho spust hlavn useEffect s debouncem\n      }\n    };\n\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    return () => document.removeEventListener('visibilitychange', handleVisibilityChange);\n  }, [formData, user_id]);\n  // Ochrana ped oputnm strnky s neuloenmi plohami\n  useEffect(() => {\n    const handleBeforeUnload = (e) => {\n      //  Ulo scroll pozici ped oputnm strnky (pomoc ref)\n      try {\n        const scrollContainer = scrollableContentRef.current;\n        const scrollPosition = scrollContainer ? scrollContainer.scrollTop : (window.pageYOffset || document.documentElement.scrollTop);\n        draftManager.saveMetadata({ scrollPosition });\n      } catch (error) {\n      }\n\n      //  ULOEN NEULOENCH PLOH DO LOCALSTORAGE\n      const unsavedAttachments = attachments.filter(att =>\n        !att.serverId && // Nem server ID = nen nahrno na server\n        att.status !== 'uploaded' && // Nen oznaeno jako nahran\n        !att.fromServer && // Nen ze serveru\n        att.file // M skuten soubor\n      );\n\n      const unclassifiedAttachments = attachments.filter(att =>\n        (!att.klasifikace || att.klasifikace.trim() === '') && // Nen klasifikovno\n        !att.fromServer // Nen ze serveru\n      );\n\n      // Uloit neuloen plohy do LocalStorage (bez file objekt kvli velikosti)\n      if (unsavedAttachments.length > 0 || unclassifiedAttachments.length > 0) {\n        try {\n          const attachmentsToSave = [...unsavedAttachments, ...unclassifiedAttachments].map(att => ({\n            id: att.id,\n            name: att.name,\n            size: att.size,\n            type: att.type,\n            klasifikace: att.klasifikace || '',\n            uploadDate: att.uploadDate,\n            lastModified: att.lastModified || Date.now(),\n            // File object nelze uloit do LS - mus se znovu vybrat\n            needsReselection: true\n          }));\n\n          const storageKey = `unsaved_attachments_${formData.id || 'draft'}`;\n          localStorage.setItem(storageKey, JSON.stringify(attachmentsToSave));\n          \n          addDebugLog('info', 'ATTACHMENTS', 'save-to-ls', \n            `Uloeno ${attachmentsToSave.length} neuloench ploh do LocalStorage`);\n        } catch (error) {\n          addDebugLog('error', 'ATTACHMENTS', 'save-to-ls-error', error.message);\n        }\n\n        // Msto browser alertu - bez preventDefault, jen notifikace\n        addDebugLog('warning', 'ATTACHMENTS', 'unsaved-on-exit', \n          `Opoutte strnku s ${unsavedAttachments.length} neuloenmi a ${unclassifiedAttachments.length} neklasifikovanmi plohami`);\n      }\n    };\n\n    const handlePopState = () => {\n      //  ULOIT NEULOEN PLOHY pi navigaci\n      const unsavedAttachments = attachments.filter(att =>\n        !att.serverId && att.status !== 'uploaded' && !att.fromServer && att.file\n      );\n      const unclassifiedAttachments = attachments.filter(att =>\n        (!att.klasifikace || att.klasifikace.trim() === '') && !att.fromServer\n      );\n\n      if (unsavedAttachments.length > 0 || unclassifiedAttachments.length > 0) {\n        // Jen uloit do LS, neblokovat navigaci\n        try {\n          const attachmentsToSave = [...unsavedAttachments, ...unclassifiedAttachments].map(att => ({\n            id: att.id,\n            name: att.name,\n            size: att.size,\n            type: att.type,\n            klasifikace: att.klasifikace || '',\n            uploadDate: att.uploadDate,\n            lastModified: att.lastModified || Date.now(),\n            needsReselection: true\n          }));\n\n          const storageKey = `unsaved_attachments_${formData.id || 'draft'}`;\n          localStorage.setItem(storageKey, JSON.stringify(attachmentsToSave));\n          \n          addDebugLog('info', 'ATTACHMENTS', 'save-on-navigation', \n            `Uloeno ${attachmentsToSave.length} neuloench ploh pi navigaci`);\n        } catch (error) {\n          addDebugLog('error', 'ATTACHMENTS', 'save-on-navigation-error', error.message);\n        }\n      }\n    };\n\n    // Pidej event listenery\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    window.addEventListener('popstate', handlePopState);\n\n    // Cleanup\n    return () => {\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n      window.removeEventListener('popstate', handlePopState);\n    };\n  }, [attachments, formData, user_id, isOrderSavedToDB, formData.id]); // Aktuln data pro emergency save\n\n  // Funkce pro vyitn validan chyby pi ztrt fokusu\n  const handleFieldBlur = useCallback((fieldName, value) => {\n    // Validace probh POUZE pi Save\n    //     return rest;\n    //   });\n    // }\n\n    //  AUTO-SAVE pi oputn pole (onBlur) - NOV CENTRALIZOVAN SYSTM\n    // Pouit triggerAutosave s debounce 3 sekundy\n    const canAutosave = !disableAutosaveRef.current && draftManager.isAutosaveEnabled() && !isSaving && !showSaveProgress && isDraftLoaded;\n\n    if (canAutosave) {\n      triggerAutosave(false); // false = s debouncem 3s\n    } else {\n    }\n  }, [validationErrors, isSaving, showSaveProgress, isDraftLoaded, triggerAutosave]);\n\n  // UseEffect pro inicializaci ablon\n  useEffect(() => {\n    // Nast ablony z localStorage pi mount\n    try {\n      const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n      const stored = localStorage.getItem(key);\n      if (stored) {\n        const templates = JSON.parse(stored);\n        if (Array.isArray(templates)) {\n          setSavedTemplates(templates);\n        }\n      }\n    } catch (error) {\n    }\n\n    // Automaticky nast ablony z DB pi mount (po F5 refresh)\n    if (token && username && user_id) {\n\n      fetchAndMergeTemplates();\n    }\n  }, [user_id, token, username]);\n\n  const toggleSection = (sectionKey) => {\n    setSectionStates(prev => {\n      const newStates = {\n        ...prev,\n        [sectionKey]: !prev[sectionKey]\n      };\n      // Uloit stav sekc\n      saveSectionStates(newStates);\n\n      // AUTOMATICK NATEN PLOH pi rozbalen sekce ploh\n      if (sectionKey === 'prilohy' && prev[sectionKey] && !newStates[sectionKey]) {\n        // Sekce byla sbalen (true) a te se rozbaluje (false)\n\n        // Podmnka pro automatick naten pi rozbalen\n        // POUZE od FZE 3+ (SCHVALENA) - FZE 1 a 2 plohy nee\n        if (formData.id && token && username && !isNewOrder && currentPhase >= 3) {\n          setTimeout(() => {\n            loadAttachmentsSmartly();\n          }, 100); // Krtk zpodn pro sprvn vykreslen UI\n        }\n      }\n\n      return newStates;\n    });\n  };\n\n  // Funkce pro formtovn mny\n  const formatCurrency = (value) => {\n    if (!value) return '';\n\n    // Pevst na slo\n    const numValue = parseFloat(value);\n    if (isNaN(numValue)) return '';\n\n    // Formtovn s mezerami jako oddlovae tisc\n    const formatted = numValue.toLocaleString('cs-CZ', {\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 2,\n    }).replace(/\\s/g, ' '); // Zajistit sprvn mezery\n\n    return formatted + ' K';\n  };\n\n  // Parser pro pevod z formtovan mny zpt na slo\n  const parseCurrency = (formattedValue) => {\n    if (!formattedValue) return '';\n\n    // Odstranit \"K\" a vechny mezery\n    let cleanValue = formattedValue\n      .replace(/\\s/g, '') // Odstranit vechny mezery\n      .replace(/K/g, ''); // Odstranit \"K\"\n\n    // Pokud obsahuje rku jako desetinn oddlova (esk formtovn)\n    if (cleanValue.includes(',')) {\n      cleanValue = cleanValue.replace(',', '.');\n    }\n\n    const numValue = parseFloat(cleanValue);\n    return isNaN(numValue) ? '' : numValue.toString();\n  };\n\n  // Speciln handler pro mnov inputy s debouncing pro zachovn pozice kurzoru\n  const handleCurrencyChange = (field, formattedValue) => {\n    // Pevst formtovanou hodnotu zpt na slo\n    const numericValue = parseCurrency(formattedValue);\n\n    // Uloit selnou hodnotu do formData\n    // POZOR: Toto zpsobuje re-render a resetuje pozici kurzoru!\n    setFormData(prev => ({\n      ...prev,\n      [field]: numericValue\n    }));\n\n    // Nastavit flag, e dolo ke zmn\n    setIsChanged(true);\n  };\n\n  // Detekce duplicitnch nzv soubor - MUS BT PED handleFileUpload\n  const checkDuplicateFileName = (newFileName) => {\n    const existingFiles = attachments.filter(file =>\n      file.name.toLowerCase() === newFileName.toLowerCase()\n    );\n    return existingFiles.length > 0 ? existingFiles[0] : null;\n  };\n\n  // Funkce pro prci s plohami - Orders25 API\n  const handleFileUpload = (files) => {\n    //  CENTRLN ZAMYKN: Blokovat upload pokud je objednvka dokonena/zamtnuta/zruena\n    if (isWorkflowCompleted && !canUnlockAnything) {\n      showToast && showToast('Nelze nahrt plohy - objednvka je dokonena/zamtnuta/zruena', { type: 'warning' });\n      return;\n    }\n\n    if (!files || files.length === 0) {\n      return;\n    }\n\n    //  Kontrola celkov velikosti ploh ped upload\n    const existingAttachmentsSize = attachments\n      .filter(f => getFilePrefix(f) === 'obj-' && (f.status === 'uploaded' || f.status === 'uploading'))\n      .reduce((sum, f) => sum + (f.size || 0), 0);\n    \n    const newFilesSize = Array.from(files).reduce((sum, file) => sum + file.size, 0);\n    const totalSize = existingAttachmentsSize + newFilesSize;\n    const maxTotalSize = 100 * 1024 * 1024; // 100MB limit pro celou objednvku\n    \n    if (totalSize > maxTotalSize) {\n      const existingSizeMB = (existingAttachmentsSize / 1024 / 1024).toFixed(2);\n      const newSizeMB = (newFilesSize / 1024 / 1024).toFixed(2);\n      const totalSizeMB = (totalSize / 1024 / 1024).toFixed(2);\n      \n      showToast && showToast(\n        ` Pekroen limit celkov velikosti ploh!\\n\\n` +\n        ` Souasn velikost: ${existingSizeMB} MB\\n` +\n        ` Nov soubory: ${newSizeMB} MB\\n` +\n        ` Celkem by bylo: ${totalSizeMB} MB\\n` +\n        ` Maximum povoleno: 100 MB\\n\\n` +\n        ` Tip: Smate nkter existujc plohy nebo nahrajte men soubory`, \n        { type: 'error', timeout: 10000 }\n      );\n      return;\n    }\n\n    setUploadingFiles(true);\n\n    // Pidme soubory do loklnho stavu pro klasifikaci\n    const newFiles = Array.from(files).map((file, index) => {\n      // Validace typu souboru\n      if (!isAllowedFileType(file.name)) {\n        const fileExtension = file.name.split('.').pop()?.toLowerCase() || 'bez ppony';\n        \n        showToast && showToast(\n          ` Nepodporovan typ souboru \"${file.name}\"\\n\\n` +\n          ` Detekovan ppona: .${fileExtension}\\n` +\n          ` Podporovan typy:\\n` +\n          `   Dokumenty: PDF, DOC, DOCX, ODT, RTF, TXT\\n` +\n          `   Tabulky: XLS, XLSX, ODS, CSV\\n` +\n          `   Prezentace: PPT, PPTX, ODP\\n` +\n          `   Obrzky: JPG, PNG, GIF, BMP, WEBP, SVG\\n` +\n          `   Archivy: ZIP, RAR, 7Z\\n` +\n          `   Emaily: EML, MSG\\n\\n` +\n          ` Tip: Pevete soubor do podporovanho formtu`, \n          { type: 'error', timeout: 10000 }\n        );\n        return null;\n      }\n\n      // Validace velikosti souboru\n      const fileSizeMB = (file.size / 1024 / 1024).toFixed(2);\n      const maxSizeMB = 20;\n      \n      if (!isAllowedFileSize(file.size, maxSizeMB)) {\n        showToast && showToast(\n          ` Soubor \"${file.name}\" je pli velk\\n\\n` +\n          ` Velikost souboru: ${fileSizeMB} MB\\n` +\n          ` Maximln povolen velikost: ${maxSizeMB} MB\\n\\n` +\n          ` Tip: Zkomprimujte soubor nebo nahrajte men verzi`, \n          { type: 'error', timeout: 8000 }\n        );\n        return null;\n      }\n\n      // Kontrola duplicitnho nzvu\n      const duplicate = checkDuplicateFileName(file.name);\n      if (duplicate) {\n      }\n\n      // Pouij Orders25 metadata genertor\n      const metadata = createAttachmentMetadata(file);\n\n      return {\n        id: metadata.id,\n        guid: metadata.guid,\n        name: file.name,\n        originalName: metadata.originalName,\n        generatedName: metadata.generatedName,\n        systemovy_nazev: metadata.systemovy_nazev,\n        size: file.size,\n        type: file.type,\n        klasifikace: '', // Bude se vybrat uivatelem - po vbru se nahraje na server\n        uploadDate: metadata.uploaded_at || new Date().toISOString(),\n        status: 'pending_classification', // ek na klasifikaci\n        file: file, // Pro budouc upload po klasifikaci\n        uploadError: null,\n        serverId: null,\n        serverGuid: null,\n        isDuplicate: !!duplicate, // Flag pro duplicitn soubor\n        duplicateOf: duplicate?.id || null // ID pvodnho souboru\n      };\n    }).filter(Boolean); // Odfiltruj nevalidn soubory\n\n    // Aktualizuj oba state - formData i attachments\n    setFormData(prev => ({\n      ...prev,\n      prilohy_dokumenty: [...(prev.prilohy_dokumenty || []), ...newFiles]\n    }));\n\n    setAttachments(prev => [...prev, ...newFiles]);\n\n    setUploadingFiles(false);\n\n    // TOAST ODSTRANN - zobraz se a pi skutenm nahrn na server po klasifikaci\n    // const duplicateCount = newFiles.filter(f => f.isDuplicate).length;\n    // if (duplicateCount > 0) {\n    //   showToast(`Pidno ${newFiles.length} soubor ke klasifikaci\\n ${duplicateCount} soubor() m stejn nzev jako existujc ploha - po nastaven klasifikace bude nahrazen!`, 'warning');\n    // } else {\n    //   showToast(`Pidno ${newFiles.length} soubor ke klasifikaci`, 'success');\n    // }\n  };\n\n  //  Funkce pro nahrn dodatench doklad (automatick klasifikace jako \"JINE\")\n  const handleDodatecneDokladyUpload = async (files) => {\n    if (!files || files.length === 0) {\n      return;\n    }\n\n    setUploadingFiles(true);\n\n    // Pidme soubory s automatickou klasifikac \"JINE\"\n    const newFiles = Array.from(files).map((file, index) => {\n      // Validace typu souboru\n      if (!isAllowedFileType(file.name)) {\n        const fileExtension = file.name.split('.').pop()?.toLowerCase() || 'bez ppony';\n        \n        showToast && showToast(\n          ` Nepodporovan typ souboru \"${file.name}\"\\n\\n` +\n          ` Detekovan ppona: .${fileExtension}\\n` +\n          ` Podporovan typy:\\n` +\n          `   Dokumenty: PDF, DOC, DOCX, ODT, RTF, TXT\\n` +\n          `   Tabulky: XLS, XLSX, ODS, CSV\\n` +\n          `   Prezentace: PPT, PPTX, ODP\\n` +\n          `   Obrzky: JPG, PNG, GIF, BMP, WEBP, SVG\\n` +\n          `   Archivy: ZIP, RAR, 7Z\\n` +\n          `   Emaily: EML, MSG\\n\\n` +\n          ` Tip: Pevete soubor do podporovanho formtu`, \n          { type: 'error', timeout: 10000 }\n        );\n        return null;\n      }\n\n      if (!isAllowedFileSize(file.size, 20)) {\n        showToast(`Soubor ${file.name}: Pli velk (max 20MB)`, { type: 'error' });\n        return null;\n      }\n\n      // Kontrola duplicitnho nzvu\n      const duplicate = checkDuplicateFileName(file.name);\n\n      // Pouij Orders25 metadata genertor\n      const metadata = createAttachmentMetadata(file);\n\n      const newFile = {\n        id: metadata.id,\n        guid: metadata.guid,\n        name: file.name,\n        originalName: metadata.originalName,\n        generatedName: metadata.generatedName,\n        systemovy_nazev: metadata.systemovy_nazev,\n        size: file.size,\n        type: file.type,\n        klasifikace: 'JINE', //  Automatick klasifikace jako \"JINE\"\n        file_prefix: 'dd-', //  Prefix pro dodaten dokumenty\n        uploadDate: metadata.uploaded_at || new Date().toISOString(),\n        status: 'pending_upload', //  Ready k uploadu (m ji klasifikaci)\n        file: file,\n        uploadError: null,\n        serverId: null,\n        serverGuid: null,\n        isDuplicate: !!duplicate,\n        duplicateOf: duplicate?.id || null\n      };\n\n      return newFile;\n    }).filter(Boolean);\n\n    if (newFiles.length === 0) {\n      setUploadingFiles(false);\n      return;\n    }\n\n    // Aktualizuj oba state\n    setFormData(prev => ({\n      ...prev,\n      prilohy_dokumenty: [...(prev.prilohy_dokumenty || []), ...newFiles]\n    }));\n\n    setAttachments(prev => [...prev, ...newFiles]);\n\n    //  Automaticky nahraj vechny soubory na server s prefixem \"dd-\"\n    for (const file of newFiles) {\n      await uploadFileToServer25(file.id, 'JINE', 'dd-');\n    }\n\n    setUploadingFiles(false);\n  };\n\n  //  Pomocn funkce pro Dropzone dodatench doklad\n  const handleDodatecneDokladyDrop = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragOver(false);\n\n    // Zkus zskat soubory z items (modern zpsob)\n    let files = null;\n\n    if (e.dataTransfer.items && e.dataTransfer.items.length > 0) {\n      files = Array.from(e.dataTransfer.items)\n        .filter(item => item.kind === 'file')\n        .map(item => item.getAsFile())\n        .filter(Boolean);\n    } else if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {\n      files = e.dataTransfer.files;\n    }\n\n    if (files && files.length > 0) {\n      handleDodatecneDokladyUpload(files);\n    }\n  };\n\n  const handleDodatecneDokladySelect = (e) => {\n    const files = e.target.files;\n\n    if (files && files.length > 0) {\n      handleDodatecneDokladyUpload(files);\n    }\n    e.target.value = '';\n  };\n\n  const handleFileDrop = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragOver(false);\n\n    const files = e.dataTransfer.files;\n\n    if (files && files.length > 0) {\n      handleFileUpload(files);\n    }\n  };\n\n  const handleFileSelect = (e) => {\n    const files = e.target.files;\n    if (files.length > 0) {\n      handleFileUpload(files);\n    }\n    // Reset input pro optovn nahrn stejnho souboru\n    e.target.value = '';\n  };\n\n  const updateFileKlasifikace = async (fileId, klasifikace) => {\n    const file = attachments.find(f => f.id === fileId);\n    if (!file) {\n      return;\n    }\n\n    // Aktualizuj oba state - formData i attachments\n    setFormData(prev => ({\n      ...prev,\n      prilohy_dokumenty: (prev.prilohy_dokumenty || []).map(file =>\n        file.id === fileId ? { ...file, klasifikace } : file\n      )\n    }));\n\n    setAttachments(prev => prev.map(file =>\n      file.id === fileId ? { ...file, klasifikace } : file\n    ));\n\n    //  AUTOSAVE po zmn klasifikace (select) - okamit\n    if (!disableAutosaveRef.current && draftManager.isAutosaveEnabled() && !isSaving && !showSaveProgress && isDraftLoaded) {\n      triggerAutosave(true); // immediate\n    }\n\n    // ROZHODOVN: Lokln soubor vs. ji nahran na serveru\n    if (file.serverId && file.status === 'uploaded') {\n      //  SOUBOR JE JI NA SERVERU - Aktualizuj klasifikaci v DB\n\n      if (!klasifikace || klasifikace.trim() === '') {\n        showToast(' Nelze uloit przdnou klasifikaci pro nahran soubory', 'warning');\n        return;\n      }\n\n      try {\n        const result = await updateAttachmentV2(\n          formData.id,           // orderId\n          file.serverId,         // attachmentId\n          { type: klasifikace }, // updates\n          token,                 // token\n          username               // username\n        );\n\n        if (result.status === 'ok' || result.status === 'success') { //  OPRAVENO: backend me vracet 'success'\n\n          //  Aktualizuj lokln stav s daty z backendu\n          if (result.data) {\n            const updatedData = {\n              typ_prilohy: result.data.type || klasifikace,\n              dt_aktualizace: result.data.updated_at,\n              klasifikace: result.data.type || klasifikace\n            };\n\n            setFormData(prev => ({\n              ...prev,\n              prilohy_dokumenty: (prev.prilohy_dokumenty || []).map(f =>\n                f.id === fileId ? { ...f, ...updatedData } : f\n              )\n            }));\n\n            setAttachments(prev => prev.map(f =>\n              f.id === fileId ? { ...f, ...updatedData } : f\n            ));\n          }\n\n          // Zkontroluj existence souboru po aktualizaci (pomoc sync kontroly)\n          await checkAttachmentsSynchronization25(true); // silentMode = true\n\n          showToast(' Klasifikace aktualizovna\\n ' + file.name + '\\n ' + klasifikace, 'success');\n          // Success log odstrann\n\n          addDebugLog('success', 'ATTACHMENTS', 'update-classification-db',\n            `Klasifikace zmnna v DB: ${file.name}  ${klasifikace}`\n          );\n        }\n      } catch (error) {\n\n        const errorMsg = translateErrorMessageShort(error.message);\n\n        showToast(` Chyba pi aktualizaci klasifikace: ${errorMsg}`, 'error');\n\n        addDebugLog('error', 'ATTACHMENTS', 'update-classification-db-failed',\n          `Chyba aktualizace klasifikace v DB: ${errorMsg}`\n        );\n\n        // Vra zpt pvodn klasifikaci pi chyb\n        setFormData(prev => ({\n          ...prev,\n          prilohy_dokumenty: (prev.prilohy_dokumenty || []).map(f =>\n            f.id === fileId ? { ...f, klasifikace: file.klasifikace } : f\n          )\n        }));\n\n        setAttachments(prev => prev.map(f =>\n          f.id === fileId ? { ...f, klasifikace: file.klasifikace } : f\n        ));\n      }\n    } else {\n      //  LOKLN SOUBOR - Standardn chovn pro nahrn na server\n\n      // Pokud je klasifikace nastavena a objednvka je uloen, nahraj soubor na server\n      if (klasifikace && klasifikace.trim() !== '') {\n        if (!formData.id) {\n          // Objednvka nen uloen - zobraz varovn\n          addDebugLog('warning', 'ATTACHMENTS', 'upload-blocked', \n            `Nelze nahrt ${file.name} - objednvka nen uloen`);\n          \n          showToast && showToast(\n            ` Nelze nahrt plohu\\n\\n` +\n            ` Soubor: ${file.name}\\n` +\n            ` Klasifikace nastavena: ${klasifikace}\\n\\n` +\n            ` Nejprve ulo objednvku, pak se plohy automaticky nahraj`, \n            { type: 'warning', timeout: 6000 }\n          );\n          return;\n        }\n        \n        if (!token || !username) {\n          addDebugLog('error', 'ATTACHMENTS', 'upload-blocked', \n            `Nelze nahrt ${file.name} - chyb token nebo username`);\n          showToast && showToast(' Chyba autentizace - nelze nahrt plohu', { type: 'error' });\n          return;\n        }\n        \n        //  Ve OK - zahaj upload\n        const filePrefix = file.file_prefix || 'obj-';\n        await uploadFileToServer25(fileId, klasifikace, filePrefix);\n      }\n    }\n  };\n\n  // Upload souboru na server Orders25 po klasifikaci\n  const uploadFileToServer25 = async (fileId, klasifikace, filePrefix = 'obj-') => {\n    const file = formData.prilohy_dokumenty?.find(f => f.id === fileId);\n    \n    if (!file) {\n      addDebugLog('error', 'ATTACHMENTS', 'upload-no-file', \n        `Soubor s ID ${fileId} nebyl nalezen v prilohy_dokumenty`);\n      return;\n    }\n    \n    if (!file.file) {\n      addDebugLog('error', 'ATTACHMENTS', 'upload-no-file-object', \n        `Soubor ${file.name} nem File objekt - mon ji byl nahrn nebo ztracen`);\n      showToast && showToast(\n        ` Nelze nahrt \"${file.name}\"\\n\\n` +\n        `Soubor nem piazen File objekt.\\n` +\n        `Zkuste soubor znovu vybrat.`, \n        { type: 'warning', timeout: 5000 }\n      );\n      return;\n    }\n    \n    if (file.status === 'uploaded') {\n      addDebugLog('info', 'ATTACHMENTS', 'already-uploaded', \n        `Soubor ${file.name} je ji nahrn na serveru`);\n      return;\n    }\n\n    try {\n      // Ozna jako nahrvajc se v obou state\n      setFormData(prev => ({\n        ...prev,\n        prilohy_dokumenty: prev.prilohy_dokumenty.map(f =>\n          f.id === fileId\n            ? { ...f, status: 'uploading', uploadError: null, file_prefix: filePrefix }\n            : f\n        )\n      }));\n\n      setAttachments(prev => prev.map(f =>\n        f.id === fileId\n          ? { ...f, status: 'uploading', uploadError: null, file_prefix: filePrefix }\n          : f\n      ));\n\n      addDebugLog('info', 'ATTACHMENTS', 'upload-start',\n        `Nahrvm soubor ${file.name} s klasifikac ${klasifikace} a prefixem ${filePrefix} na server V2 API...`);\n\n      // KONTROLA: pokud nen formData.id, zastav upload a zobraz chybu\n      if (!formData.id) {\n        showToast(' Nelze nahrt plohu - objednvka nem ID! Nejprve ulo objednvku.', 'error');\n        throw new Error('Missing formData.id - order must be saved first');\n      }\n\n      const result = await uploadOrderAttachment(\n        formData.id,      // orderId\n        file.file,         // file\n        username,          // username\n        token,             // token\n        klasifikace,       // typ_prilohy\n        filePrefix         // file_prefix\n      );\n\n      addDebugLog('success', 'ATTACHMENTS', 'upload-success',\n        `Soubor ${file.name} nahrn spn`, result);\n\n      // V2 API vrac: result.data.attachment_id nebo result.data.id\n      const attachmentId = result.data?.attachment_id || result.data?.id;\n\n      // Aktualizuj stav s vsledky ze serveru v obou state\n      setFormData(prev => ({\n        ...prev,\n        prilohy_dokumenty: prev.prilohy_dokumenty.map(f =>\n          f.id === fileId\n            ? {\n                ...f,\n                status: 'uploaded',\n                serverId: attachmentId,\n                serverGuid: result.data?.guid || file.systemovy_nazev,\n                uploadError: null,\n                file: null, // Uvolnit pam - soubor je u na serveru\n                nahrano_uzivatel_id: result.data?.uploaded_by_user_id,\n                nahrano_uzivatel: result.data?.nahrano_uzivatel\n              }\n            : f\n        )\n      }));\n\n      setAttachments(prev => prev.map(f =>\n        f.id === fileId\n          ? {\n              ...f,\n              status: 'uploaded',\n              serverId: attachmentId,\n              serverGuid: result.data?.guid || file.systemovy_nazev,\n              uploadError: null,\n              file: null, // Uvolnit pam - soubor je u na serveru\n              nahrano_uzivatel_id: result.data?.uploaded_by_user_id,\n              nahrano_uzivatel: result.data?.nahrano_uzivatel\n            }\n          : f\n      ));\n\n      // Toast pi spnm nahrn na server\n      const successMessage = (\n        <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n          <div style={{ \n            fontSize: '15px', \n            fontWeight: '600', \n            marginBottom: '8px', \n            color: '#1a1a1a',\n            display: 'flex',\n            alignItems: 'center',\n            gap: '8px'\n          }}>\n            <CheckCircle2 size={20} color=\"#10b981\" style={{ flexShrink: 0 }} />\n            <span>Ploha spn nahrna</span>\n          </div>\n          <div style={{ \n            padding: '8px',\n            backgroundColor: '#f0fdf4',\n            borderRadius: '4px',\n            fontSize: '13px',\n            color: '#166534'\n          }}>\n            {file.name}\n          </div>\n        </div>\n      );\n      showToast && showToast(successMessage, { type: 'success' });\n\n      //  VYITN LOCALSTORAGE po spnm uploadu\n      try {\n        const storageKey = `unsaved_attachments_${formData.id || 'draft'}`;\n        const savedAttachmentsStr = localStorage.getItem(storageKey);\n        \n        if (savedAttachmentsStr) {\n          const savedAttachments = JSON.parse(savedAttachmentsStr);\n          // Odstranit nahran soubor ze seznamu\n          const filteredAttachments = savedAttachments.filter(att => att.id !== fileId);\n          \n          if (filteredAttachments.length === 0) {\n            // Vechny plohy nahrny - smazat cel LocalStorage kl\n            localStorage.removeItem(storageKey);\n            addDebugLog('info', 'ATTACHMENTS', 'ls-cleared', 'LocalStorage vyitn - vechny plohy nahrny');\n          } else {\n            // Aktualizovat seznam bez nahran plohy\n            localStorage.setItem(storageKey, JSON.stringify(filteredAttachments));\n            addDebugLog('info', 'ATTACHMENTS', 'ls-updated', `LocalStorage aktualizovn - zbv ${filteredAttachments.length} ploh`);\n          }\n        }\n      } catch (error) {\n        addDebugLog('error', 'ATTACHMENTS', 'ls-clear-error', error.message);\n      }\n\n    } catch (error) {\n      addDebugLog('error', 'ATTACHMENTS', 'upload-error',\n        `Chyba pi uploadu ${file.name}: ${error.message}`);\n\n      // Ozna chybu v loklnm stavu v obou state\n      setFormData(prev => ({\n        ...prev,\n        prilohy_dokumenty: prev.prilohy_dokumenty.map(f =>\n          f.id === fileId\n            ? {\n                ...f,\n                status: 'error',\n                uploadError: error.message\n              }\n            : f\n        )\n      }));\n\n      setAttachments(prev => prev.map(f =>\n        f.id === fileId\n          ? {\n              ...f,\n              status: 'error',\n              uploadError: error.message\n            }\n          : f\n      ));\n\n      // Toast s chybou pi uploadu\n      const errorMsg = error.response?.data?.message || error.message || 'Neznm chyba';\n      showToast(` Chyba pi nahrvn plohy \"${file.name}\": ${errorMsg}`, 'error');\n    }\n  };\n\n  // Kontrola synchronizace ploh s DB a diskem\n  const checkAttachmentsSynchronization25 = async (silentMode = false) => {\n    if (!formData.id) {\n      showToast('Nen ID objednvky pro kontrolu synchronizace', 'warning');\n      return;\n    }\n\n    try {\n      setIsCheckingSyncAttachments(true);\n\n      // 1. NATI PLOHY VEDEN V DB\n\n      const serverResult = await listOrderAttachments(\n        formData.id,      // orderId\n        username,          // username\n        token              // token\n      );\n\n      // V2 API vrac: result.data.attachments nebo result.data (array)\n      const dbAttachments = serverResult?.data?.attachments || serverResult?.data || [];\n\n      // 2. OV EXISTENCI SOUBOR NA VZDLENM SERVERU\n\n      let verifyResult = null;\n      if (dbAttachments.length > 0) {\n        try {\n          verifyResult = await verifyOrderAttachments(\n            formData.id,  // orderId\n            username,      // username\n            token          // token\n          );\n\n        } catch (verifyError) {\n        }\n      }\n\n      // 3. ZKONTROLUJ LOKLN KONCEPT PROTI DB\n\n      const issues = {\n        hasIssues: false,\n        // Kategorie problm\n        conceptUnclassified: [],     // Lokln plohy bez klasifikace (po F5)\n        conceptOrphaned: [],         // Lokln plohy kter nejsou v DB\n        dbMissingFiles: [],          // DB zznamy bez soubor na disku\n        dbOrphaned: [],              // DB zznamy kter nejsou v konceptu\n        uploadErrors: [],            // Plohy s chybami nahrvn\n        inconsistentState: []        // Nekonzistentn stavy\n      };\n\n      // ANALZA LOKLNHO KONCEPTU\n      attachments.forEach((localAtt, index) => {\n        try {\n          // A) Neklasifikovan lokln plohy (dleit po F5)\n          if (!localAtt.klasifikace || localAtt.klasifikace === '') {\n            issues.conceptUnclassified.push(localAtt);\n            issues.hasIssues = true;\n          }\n\n          // B) Chyby nahrvn\n          if (localAtt.status === 'error') {\n            issues.uploadErrors.push(localAtt);\n            issues.hasIssues = true;\n          }\n\n          // C) Lokln plohy kter nejsou v DB (osiel)\n          if (localAtt.serverId) {\n            const serverIdStr = String(localAtt.serverId); // Zajistit string pro .replace()\n            const foundInDB = dbAttachments.find(dbAtt =>\n              dbAtt.id.toString() === serverIdStr ||\n              dbAtt.id.toString() === serverIdStr.replace('server_', '')\n            );\n            if (!foundInDB) {\n              issues.conceptOrphaned.push(localAtt);\n              issues.hasIssues = true;\n            }\n          } else if (localAtt.status !== 'uploaded' && localAtt.status !== 'uploading') {\n            // Lokln soubor kter nebyl jet nahrn\n            issues.conceptOrphaned.push(localAtt);\n            issues.hasIssues = true;\n          }\n        } catch (attachmentError) {\n          // Pokrauj s dalmi plohami\n        }\n      });\n\n      // ANALZA DB ZZNAM\n      dbAttachments.forEach((dbAtt, index) => {\n        try {\n          // D) DB zznamy kter nejsou v konceptu (mon ztracen po F5)\n          const foundInConcept = attachments.find(localAtt => {\n            if (!localAtt.serverId) {\n              // Pokud lokln ploha nem serverId, pokus o shodu podle nzvu souboru\n              return localAtt.name === dbAtt.originalni_nazev_souboru && localAtt.status === 'uploaded';\n            }\n\n            const serverIdStr = String(localAtt.serverId); // Zajistit string pro .replace()\n            const dbIdStr = dbAtt.id.toString();\n            return (\n              serverIdStr === dbIdStr ||\n              serverIdStr === `server_${dbIdStr}` ||\n              serverIdStr.replace('server_', '') === dbIdStr ||\n              (localAtt.name === dbAtt.originalni_nazev_souboru && localAtt.status === 'uploaded')\n            );\n          });\n          if (!foundInConcept) {\n            issues.dbOrphaned.push(dbAtt);\n            issues.hasIssues = true;\n          }\n        } catch (dbAttError) {\n          // Pokrauj s dalmi zznamy\n        }\n      });\n\n      // E) SOUBORY CHYBJC NA DISKU nebo POKOZEN (z verify API)\n      // V2 API vrac: verifyResult.data.attachments s detaily o kadm souboru\n      const verifiedAttachments = verifyResult?.data?.attachments || [];\n      if (verifiedAttachments.length > 0) {\n        verifiedAttachments.forEach(att => {\n          // file_exists: false = soubor chyb na disku\n          if (att.file_exists === false) {\n            issues.dbMissingFiles.push({\n              name: att.original_name || 'neznm',\n              serverId: att.attachment_id || att.id,\n              path: att.system_path || att.guid,\n              systemName: att.guid,\n              status: att.status\n            });\n            issues.hasIssues = true;\n          }\n          // size_match: false = velikost nesouhlas (pokozen soubor)\n          else if (att.size_match === false) {\n            issues.inconsistentState.push({\n              name: att.original_name || 'neznm',\n              serverId: att.attachment_id || att.id,\n              issue: `SIZE MISMATCH: DB=${att.db_size}B, Disk=${att.actual_size}B`,\n              status: att.status\n            });\n            issues.hasIssues = true;\n          }\n        });\n      }\n\n      // ZOBRAZ VSLEDKY (pouze od FZE 3+ a pouze warningy/errory)\n      if (!issues.hasIssues) {\n        //  ODSTRANNO: Zbyten success toast \" Synchronizace OK\"\n        // Uivatel nepotebuje vdt e ve je OK - to je default stav\n      } else {\n        //  Zobrazit problmy POUZE od FZE 3+ (kdy se plohy e)\n        if (currentPhase >= 3 && !silentMode) {\n          let reportText = ' SYNC KONTROLA - Nalezen problmy:\\n';\n\n          if (issues.conceptUnclassified.length > 0) {\n            reportText += `\\n KONCEPT - NEKLASIFIKOVAN (${issues.conceptUnclassified.length}):\\n`;\n            issues.conceptUnclassified.forEach(att => {\n              reportText += `   ${att.name} - potebuje klasifikaci\\n`;\n            });\n          }\n\n        if (issues.conceptOrphaned.length > 0) {\n          reportText += `\\n KONCEPT - NENAHRAN/OSIEL (${issues.conceptOrphaned.length}):\\n`;\n          issues.conceptOrphaned.forEach(att => {\n            reportText += `   ${att.name} - ${att.serverId ? 'osiel' : 'nenahrna'}\\n`;\n          });\n        }\n\n        if (issues.dbOrphaned.length > 0) {\n          reportText += `\\n DB - CHYB V KONCEPTU (${issues.dbOrphaned.length}):\\n`;\n          issues.dbOrphaned.forEach(att => {\n            reportText += `   ${att.originalni_nazev_souboru} (ID: ${att.id}) - mon ztraceno po F5\\n`;\n          });\n        }\n\n        if (issues.dbMissingFiles.length > 0) {\n          reportText += `\\n SERVER - CHYB SOUBORY (${issues.dbMissingFiles.length}):\\n`;\n          issues.dbMissingFiles.forEach(att => {\n            reportText += `   ${att.name} (${att.path || att.systemName})\\n`;\n          });\n        }\n\n        if (issues.inconsistentState.length > 0) {\n          reportText += `\\n POKOZEN SOUBORY (${issues.inconsistentState.length}):\\n`;\n          issues.inconsistentState.forEach(att => {\n            reportText += `   ${att.name} - ${att.issue}\\n`;\n          });\n        }\n\n        if (issues.uploadErrors.length > 0) {\n          reportText += `\\n CHYBY NAHRVN (${issues.uploadErrors.length}):\\n`;\n          issues.uploadErrors.forEach(att => {\n            reportText += `   ${att.name}\\n`;\n          });\n        }\n\n        showToast(reportText, 'error');\n\n        // NABDKA AUTOMATICKCH OPRAV (pouze v interaktivnm mdu)\n        if (issues.dbOrphaned.length > 0) {\n          showToast && showToast(\n            `Nalezeno ${issues.dbOrphaned.length} plohy v databzi, kter chyb v konceptu (mon ztracen po obnoven strnky F5).\\n\\n` +\n            `Chcete je automaticky obnovit do konceptu?`, {\n            type: 'info',\n            timeout: 0,\n            action: {\n              confirmText: 'ANO, OBNOVIT',\n              cancelText: 'Ne',\n              onConfirm: async () => {\n                await restoreAttachmentsFromDB(issues.dbOrphaned);\n              }\n            }\n          });\n        }\n        } // Konec: currentPhase >= 3 && !silentMode\n      }\n\n      return issues;\n\n    } catch (error) {\n\n      showToast(\n        `Chyba kontroly synchronizace ploh:\\n${error.message}\\n\\n` +\n        `Zkuste:\\n` +\n        ` Obnovit strnku (F5)\\n` +\n        ` Zkontrolovat pipojen k serveru\\n` +\n        ` Zkontrolovat konzoli prohlee (F12)`,\n        'error'\n      );\n    } finally {\n      setIsCheckingSyncAttachments(false);\n    }\n  };\n\n  // Automatick obnoven ploh z DB do konceptu (po F5)\n  const restoreAttachmentsFromDB = async (dbAttachments) => {\n    try {\n      // Pokud nejsou pedan data, nati z API\n      if (!dbAttachments || !Array.isArray(dbAttachments)) {\n        if (!formData.id) {\n          showToast('Nen ID objednvky pro naten ploh z DB', 'warning');\n          return;\n        }\n\n        try {\n          const result = await listOrderAttachments(\n            formData.id,  // orderId\n            username,      // username\n            token          // token\n          );\n\n          const rawAttachments = result?.data?.attachments || result?.data || [];\n\n          if (!Array.isArray(rawAttachments)) {\n            showToast('Chyba API: neplatn struktura odpovdi pro plohy', 'error');\n            return;\n          }\n\n          dbAttachments = rawAttachments;\n        } catch (error) {\n          showToast('Chyba pi natn ploh z databze', 'error');\n          return;\n        }\n      }\n\n      const restoredAttachments = dbAttachments.map(attachment => ({\n        ...mapApiAttachmentToLocal(attachment),\n        isRestored: true // Flag pro rozpoznn obnovench\n      }));\n\n      // Pidej obnoven plohy k existujcm (bez duplicit)\n      setAttachments(prev => {\n        const existingIds = new Set(prev.map(att => att.serverId || att.id));\n        const newAttachments = restoredAttachments.filter(att =>\n          !existingIds.has(att.serverId) && !existingIds.has(att.id)\n        );\n\n        // Success log odstrann\n        return [...prev, ...newAttachments];\n      });\n\n      showToast(\n        ` Obnoveno ${restoredAttachments.length} ploh z databze do konceptu`,\n        'success'\n      );\n\n    } catch (error) {\n      showToast(`Chyba obnovovn: ${error.message}`, 'error');\n    }\n  };\n\n  // Smart naten: slou DB plohy + lokln neuloen z konceptu\n  // POZOR: Nat se pouze pokud je sekce ploh viditeln\n  // POZOR: Nat se POUZE od FZE 3+ (SCHVALENA) - FZE 1 a 2 plohy nee\n  const loadAttachmentsSmartly = async () => {\n    if (!formData.id || !token || !username) {\n      return;\n    }\n\n    if (sectionStates.prilohy) {\n      return;\n    }\n\n    //  Nast plohy z DB hned, jak m objednvka ID\n    try {\n\n      // 1. Zachovej lokln neuloen plohy z konceptu\n      const localUnsavedAttachments = attachments.filter(att =>\n        !att.serverId &&\n        att.status !== 'uploaded' &&\n        !att.fromServer\n      );\n\n      // 2. Nati plohy z DB\n      const rawAttachments = await fetchAttachmentsFromAPI();\n      const dbAttachments = rawAttachments.map(mapApiAttachmentToLocal);\n\n      // 3. Slouit: DB plohy + lokln neuloen\n      const mergedAttachments = [\n        ...dbAttachments,\n        ...localUnsavedAttachments\n      ];\n\n      // 4. Nastavit slouen plohy\n      setAttachments(mergedAttachments);\n\n      // 5. Automatick sync kontrola po naten\n      if (mergedAttachments.length > 0) {\n\n        setTimeout(() => {\n          checkAttachmentsSynchronization25(true); // Tich md pro auto-kontrolu\n        }, 1000); // Krtk zpodn aby se UI stihlo aktualizovat\n      }\n\n    } catch (error) {\n      showToast(`Chyba smart load: ${error.message}`, 'error');\n    }\n  };\n\n  // Naten existujcch ploh ze serveru (nahrazuje cel koncept)\n  // POZOR: Nat se pouze pokud je sekce ploh viditeln\n  // POZOR: Nat se POUZE od FZE 3+ (SCHVALENA) - FZE 1 a 2 plohy nee\n  const loadAttachmentsFromServer25 = async () => {\n    if (!formData.id || !token || !username) {\n      return;\n    }\n\n    if (sectionStates.prilohy) {\n      return;\n    }\n\n    //  FZE 1 a 2: Plohy se nee - zbyten zatovn\n    if (currentPhase < 3) {\n      return;\n    }\n\n    try {\n      addDebugLog('info', 'ATTACHMENTS', 'load-start',\n        `Natm plohy pro objednvku ${formData.id} ze serveru V2 API...`);\n\n      const result = await listOrderAttachments(\n        formData.id,  // orderId\n        username,      // username\n        token          // token\n      );\n\n      // V2 API vrac: result.data.attachments nebo result.data (array)\n      const rawAttachments = result?.data?.attachments || result?.data || [];\n\n      if (!Array.isArray(rawAttachments)) {\n        showToast('Chyba API: neplatn struktura odpovdi pro plohy', 'error');\n        return;\n      }\n\n      const serverAttachments = rawAttachments.map(mapApiAttachmentToLocal);\n      \n      addDebugLog('success', 'ATTACHMENTS', 'load-success',\n        `Nateno ${serverAttachments.length} ploh ze serveru`);\n\n      // Nahra lokln plohy tmi ze serveru\n      setAttachments(serverAttachments);\n\n      // Success log odstrann\n      // showToast(` Nateno ${serverAttachments.length} ploh z databze`, 'success'); // ODSTRANNO - info je vidt v bloku ploh\n\n    } catch (error) {\n\n      addDebugLog('error', 'ATTACHMENTS', 'load-error',\n        `Chyba pi natn ploh: ${error.message}`);\n\n      // Toast s chybou\n      showToast(`Chyba natn ploh z DB: ${error.message}`, 'error');\n    }\n  };\n\n  // Staen plohy ze serveru\n  const downloadAttachmentFromServer25 = async (attachment) => {\n    if (!attachment.serverId || !token || !username) {\n      showToast('Nelze sthnout plohu - chyb server ID', 'error');\n      return;\n    }\n\n    // Pro archivovan/importovan plohy - sthnout pmo ze star URL\n    if (attachment.typ_prilohy === 'IMPORT' && attachment.originalni_nazev_souboru) {\n      const oldAttachmentsUrl = process.env.REACT_APP_OLD_ATTACHMENTS_URL || 'https://erdms.zachranka.cz/prilohy/';\n      const oldUrl = `${oldAttachmentsUrl}${attachment.originalni_nazev_souboru}`;\n\n      addDebugLog('info', 'ATTACHMENTS', 'download-import',\n        `Stahovn importovan plohy ${attachment.name} ze starho systmu: ${oldUrl}`);\n\n      // Sthnout pmo bez dialogu\n      const link = document.createElement('a');\n      link.href = oldUrl;\n      link.download = attachment.originalni_nazev_souboru;\n      link.style.display = 'none';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n\n      showToast(` Ploha \"${attachment.originalni_nazev_souboru}\" se stahuje ze starho systmu`, 'info');\n      return;\n    }\n\n    try {\n      addDebugLog('info', 'ATTACHMENTS', 'download-start',\n        `Stahovn plohy ${attachment.name} ze serveru...`);\n\n      const blob = await downloadOrderAttachment(\n        formData.id,           // orderId\n        attachment.serverId,    // attachmentId\n        username,               // username\n        token                   // token\n      );\n\n      // Pmo sthnout soubor bez dialog\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = attachment.name || 'priloha';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n\n      addDebugLog('success', 'ATTACHMENTS', 'download-success',\n        `Ploha ${attachment.name} staena spn`);\n\n      // Toast s detaily downloadu - ODSTRANNO (download je okamit a viditeln)\n      // const downloadInfo = `BE Response: ServerID=${attachment.serverId}, GUID=${attachment.serverGuid || 'N/A'}, Size=${blob.size}B`;\n      // showToast(` Download OK: ${attachment.name}\\n${downloadInfo}`, 'success');\n\n    } catch (error) {\n      // Error u byl zpracovn v API vrstv, sta zobrazit error.message\n      const errorMessage = error.message || 'Nepodailo se sthnout plohu';\n      \n      //  Detekce missing file - zobrazit jako warning (validan toast) msto error\n      const isMissingFile = errorMessage.includes('Soubor nebyl nalezen na serveru') || \n                           errorMessage.includes('chyb fyzick soubor');\n      \n      showToast(errorMessage, { type: isMissingFile ? 'warning' : 'error' });\n      \n      addDebugLog(isMissingFile ? 'warning' : 'error', 'ATTACHMENTS', 'download-error',\n        `Chyba pi stahovn ${attachment.name}: ${errorMessage}`);\n    }\n  };\n\n  // Smazn plohy ze serveru a loklnho stavu\n  const deleteAttachmentFromServer25 = async (fileId) => {\n    const attachment = attachments.find(f => f.id === fileId);\n    if (!attachment) {\n      return;\n    }\n\n    // Ulo attachment k potvrzen smazn\n    setAttachmentToDelete({ fileId, attachment, isFromServer: true });\n    setShowDeleteAttachmentDialog(true);\n  };\n\n  const performDeleteAttachmentFromServer = async (fileId, attachment, attachmentName) => {\n    if (attachment.serverId && token && username) {\n      try {\n        addDebugLog('info', 'ATTACHMENTS', 'delete-start',\n          `Mazn plohy ${attachment.name} ze serveru...`);\n\n        const deleteResult = await deleteOrderAttachment(\n          formData.id,           // orderId\n          attachment.serverId,    // attachmentId\n          username,               // username\n          token                   // token\n        );\n\n        addDebugLog('success', 'ATTACHMENTS', 'delete-success',\n          `Ploha ${attachment.name} smazna ze serveru`);\n\n        // Toast pi spnm smazn\n        showToast(` Ploha \"${attachment.name}\" byla spn smazna`, 'success');\n\n      } catch (error) {\n\n        addDebugLog('error', 'ATTACHMENTS', 'delete-error',\n          `Chyba pi mazn ${attachment.name}: ${error.message}`);\n\n        // Toast pi chyb smazn\n        const errorMsg = error.response?.data?.message || error.message || 'Neznm chyba';\n        showToast(` Chyba pi mazn plohy \"${attachment.name}\": ${errorMsg}`, 'error');\n        return; // Nepokrauj v mazn z loklnho stavu\n      }\n    }\n\n    // Sma z loklnho stavu BEZ confirm dialogu (u byl potvrzen ve)\n    removeFileDirectly(fileId);\n  };\n\n  // Smazn plohy z loklnho stavu BEZ confirm dialogu (pro voln z jinch funkc)\n  const removeFileDirectly = (fileId) => {\n    // Aktualizuj oba state - formData i attachments\n    setFormData(prev => ({\n      ...prev,\n      prilohy_dokumenty: (prev.prilohy_dokumenty || []).filter(file => file.id !== fileId)\n    }));\n\n    setAttachments(prev => prev.filter(file => file.id !== fileId));\n  };\n\n  // Smazn plohy s confirm dialogem (pro lokln nepipojen soubory)\n  const removeFile = (fileId) => {\n    const file = attachments.find(f => f.id === fileId);\n    if (!file) return;\n\n    // Ulo attachment k potvrzen smazn\n    setAttachmentToDelete({ fileId, attachment: file, isFromServer: false });\n    setShowDeleteAttachmentDialog(true);\n  };\n\n  // Potvrzen smazn plohy z ConfirmDialogu\n  const handleConfirmDeleteAttachment = async () => {\n    if (!attachmentToDelete) return;\n\n    const { fileId, attachment, isFromServer } = attachmentToDelete;\n\n    if (isFromServer) {\n      // Smazn ze serveru\n      await performDeleteAttachmentFromServer(fileId, attachment, attachment.name || 'soubor');\n    } else {\n      // Smazn loklnho souboru\n      removeFileDirectly(fileId);\n      showToast('Soubor byl odstrann', 'info');\n    }\n\n    // Zavi dialog a reset state\n    setShowDeleteAttachmentDialog(false);\n    setAttachmentToDelete(null);\n  };\n\n  // Zruen smazn plohy\n  const handleCancelDeleteAttachment = () => {\n    setShowDeleteAttachmentDialog(false);\n    setAttachmentToDelete(null);\n  };\n\n  const removeAllFiles = () => {\n    if (attachments.length === 0) {\n      showToast('dn plohy k odstrann', 'info');\n      return;\n    }\n\n    // Otevi confirm dialog\n    setShowDeleteAllAttachmentsDialog(true);\n  };\n\n  // Handler pro potvrzen smazn vech ploh\n  const handleConfirmDeleteAllAttachments = () => {\n    // Aktualizuj oba state - formData i attachments\n    setFormData(prev => ({\n      ...prev,\n      prilohy_dokumenty: []\n    }));\n\n    setAttachments([]);\n\n    showToast(`Vechny plohy (${attachments.length} soubor) byly odstranny`, 'warning');\n    \n    // Zavi dialog\n    setShowDeleteAllAttachmentsDialog(false);\n  };\n\n  // Handler pro zruen smazn vech ploh\n  const handleCancelDeleteAllAttachments = () => {\n    setShowDeleteAllAttachmentsDialog(false);\n  };\n\n  // Centrln funkce pro naten ploh z API\n  // POZOR: Nat se pouze pokud je sekce ploh viditeln\n  const fetchAttachmentsFromAPI = async () => {\n    if (!formData.id || !token || !username) {\n      throw new Error('Chyb potebn daje pro naten ploh');\n    }\n\n    if (sectionStates.prilohy) {\n      throw new Error('Sekce ploh je sbalen - natn peskoeno');\n    }\n\n    const result = await listOrderAttachments(\n      formData.id,  // orderId\n      username,      // username\n      token          // token\n    );\n\n    // V2 API vrac: result.data.attachments nebo result.data (array)\n    const rawAttachments = result?.data?.attachments || result?.data || [];\n\n    if (!Array.isArray(rawAttachments)) {\n      throw new Error('API nevrtilo pole ploh');\n    }\n\n    return rawAttachments;\n  };\n\n  // Centrln mapovn plohy z API response na lokln objekt - 1:1 mapovn bez transformac\n  const mapApiAttachmentToLocal = (attachment) => {\n    // V2 API pouv: original_name, file_size, upload_date, uploaded_by_user_id, type, system_path\n\n    //  EXTRAKCE file_prefix ze system_path (backend pole)\n    const systemPath = attachment.system_path || attachment.systemovy_nazev || attachment.final_filename || '';\n    const fileName = systemPath.split('/').pop() || systemPath; // Vezmi nzev souboru (posledn st cesty)\n\n    let filePrefix = 'obj-'; // Default\n    if (fileName.startsWith('dd-')) {\n      filePrefix = 'dd-';\n    } else if (fileName.startsWith('obj-')) {\n      filePrefix = 'obj-';\n    }\n\n    const mapped = {\n      // Pm mapovn z DB/API struktury\n      id: `server_${attachment.id}`,\n      serverId: attachment.id,\n      objednavka_id: attachment.order_id || attachment.objednavka_id,\n      guid: attachment.guid,\n      typ_prilohy: attachment.type || attachment.typ_prilohy,\n      originalni_nazev_souboru: attachment.original_name || attachment.originalni_nazev_souboru,\n      systemovy_nazev: attachment.system_path, //  Backend vrac system_path\n      systemova_cesta: attachment.system_path, //  Backend vrac system_path\n      velikost: attachment.file_size || attachment.velikost || attachment.velikost_souboru_b,\n      dt_vytvoreni: attachment.upload_date || attachment.created_at || attachment.dt_vytvoreni,\n      dt_aktualizace: attachment.updated_at || attachment.dt_aktualizace,\n      nahrano_uzivatel_id: attachment.uploaded_by_user_id || attachment.nahrano_uzivatel_id,\n      nahrano_uzivatel: attachment.nahrano_uzivatel,\n      file_exists: attachment.file_exists,\n      file_prefix: filePrefix, //  Extrahovno ze system_path\n\n      // Kompatibilita s frontendem (aliasy)\n      name: attachment.original_name || attachment.originalni_nazev_souboru,\n      size: attachment.file_size || attachment.velikost || attachment.velikost_souboru_b,\n      type: 'application/octet-stream',\n      lastModified: new Date(attachment.upload_date || attachment.created_at || attachment.dt_vytvoreni || Date.now()).getTime(),\n      klasifikace: attachment.type || attachment.typ_prilohy,\n      cesta_k_souboru: attachment.system_path, //  Backend vrac system_path\n\n      // Status a metadata\n      status: 'uploaded',\n      uploadDate: attachment.upload_date || attachment.created_at || attachment.dt_vytvoreni || attachment.dt_aktualizace || null,\n      serverGuid: attachment.guid,\n      fromServer: true\n    };\n\n    return mapped;\n  };\n\n  // Pomocn funkce pro detekci file_prefix ze systemov cesty nebo file_prefix\n  const getFilePrefix = (file) => {\n    // Pokud u m file_prefix, pouij ho\n    if (file.file_prefix) {\n      return file.file_prefix;\n    }\n\n    // Extrahuj nzev souboru ze systemov cesty\n    const systemPath = file.systemova_cesta || file.systemovy_nazev || file.cesta_k_souboru || '';\n    const fileName = systemPath.split('/').pop() || systemPath;\n\n    // Kontrola prefixu nzvu souboru\n    if (fileName.startsWith('dd-')) {\n      return 'dd-';\n    }\n    if (fileName.startsWith('obj-')) {\n      return 'obj-';\n    }\n\n    return 'obj-'; // Default\n  };\n\n  // Pomocn funkce pro UI styling ploh\n  const getFileBorderColor = (file) => {\n    if (file.status === 'error') return '#fca5a5';\n    if (!file.klasifikace) return '#fca5a5';\n    if (file.isDuplicate) return '#f59e0b'; // Oranov pro duplicity\n    if (file.status === 'uploading') return '#f59e0b';\n    if (file.status === 'uploaded') return '#10b981';\n    return '#e5e7eb';\n  };\n\n  const getFileBackgroundColor = (file) => {\n    if (file.status === 'error') return '#fef2f2';\n    if (!file.klasifikace) return '#fef2f2';\n    if (file.isDuplicate) return '#fffbeb'; // Svtle oranov pro duplicity\n    if (file.status === 'uploading') return '#fffbeb';\n    if (file.status === 'uploaded') return '#f0fdf4';\n    return 'white';\n  };\n\n  const getFileIconColor = (file) => {\n    if (file.status === 'error') return '#dc2626';\n    if (file.status === 'uploading') return '#f59e0b';\n    if (file.status === 'uploaded') return '#10b981';\n    return '#6b7280';\n  };\n\n  const getFileStatusIndicator = (file) => {\n    switch (file.status) {\n      case 'pending_classification':\n        return (\n          <span style={{\n            color: '#dc2626',\n            fontSize: '0.75rem',\n            marginLeft: '0.5rem',\n            fontWeight: '600'\n          }}>\n             ek na klasifikaci\n          </span>\n        );\n      case 'uploading':\n        return (\n          <span style={{\n            color: '#f59e0b',\n            fontSize: '0.75rem',\n            marginLeft: '0.5rem',\n            fontWeight: '600'\n          }}>\n             Nahrv se...\n          </span>\n        );\n      case 'uploaded':\n        return (\n          <span style={{\n            color: '#10b981',\n            fontSize: '0.75rem',\n            marginLeft: '0.5rem',\n            fontWeight: '600'\n          }}>\n             Nahrno na server\n          </span>\n        );\n      case 'error':\n        return (\n          <span style={{\n            color: '#dc2626',\n            fontSize: '0.75rem',\n            marginLeft: '0.5rem',\n            fontWeight: '600'\n          }}>\n             Chyba uploadu\n          </span>\n        );\n      default:\n        return null;\n    }\n  };\n\n  // Funkce pro prci s polokami objednvky\n  const addPolozka = () => {\n    setFormData(prev => ({\n      ...prev,\n      polozky_objednavky: [\n        ...(prev.polozky_objednavky || []),\n        {\n          id: Date.now(),\n          popis: '',\n          cena_bez_dph: '',\n          sazba_dph: '21',\n          cena_s_dph: '',\n          //  Voliteln lokalizace - inicializace przdnch hodnot\n          usek_kod: '',\n          budova_kod: '',\n          mistnost_kod: '',\n          poznamka: '',\n          //  LP kd na rovni poloky\n          lp_id: null\n        }\n      ]\n    }));\n\n    // Auto-save po pidn poloky\n    setTimeout(() => saveDraft(true), 100);\n  };\n\n  const removePolozka = (id) => {\n    const currentPolozky = formData.polozky_objednavky || [];\n    if (currentPolozky.length <= 1) return; // Minimln jedna poloka\n\n    setFormData(prev => ({\n      ...prev,\n      polozky_objednavky: (prev.polozky_objednavky || []).filter(p => p.id !== id)\n    }));\n\n    // Auto-save po odebrn poloky\n    setTimeout(() => saveDraft(true), 100);\n  };\n\n  const updatePolozka = (id, field, value) => {\n    setFormData(prev => ({\n      ...prev,\n      polozky_objednavky: (prev.polozky_objednavky || []).map(polozka => {\n        if (polozka.id === id) {\n          const updatedPolozka = { ...polozka, [field]: value };\n\n          // Pokud se mn cena bez DPH nebo DPH sazba, pepotej cenu s DPH\n          if (field === 'cena_bez_dph' || field === 'sazba_dph') {\n            const cenaBezDph = parseFloat((updatedPolozka.cena_bez_dph || '0').replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\n            const dphSazba = parseFloat(updatedPolozka.sazba_dph) || 0;\n            const cenaSdph = cenaBezDph * (1 + dphSazba / 100);\n            // Pro faktury/etnictv pesn 2 desetinn msta\n            updatedPolozka.cena_s_dph = cenaSdph.toFixed(2);\n          }\n\n          // Pokud se mn cena s DPH, pepotej cenu bez DPH\n          if (field === 'cena_s_dph') {\n            const cenaSdph = parseFloat((updatedPolozka.cena_s_dph || '0').replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\n            const dphSazba = parseFloat(updatedPolozka.sazba_dph) || 0;\n            const cenaBezDph = cenaSdph / (1 + dphSazba / 100);\n            // Pro faktury/etnictv pesn 2 desetinn msta\n            updatedPolozka.cena_bez_dph = cenaBezDph.toFixed(2);\n          }\n\n          return updatedPolozka;\n        }\n        return polozka;\n      })\n    }));\n\n    //  NOV AUTOSAVE pro poloky objednvky\n    // Pro select DPH - okamit, pro text/ceny - pi blur (e se ve FormatNumberInput)\n    if (field === 'sazba_dph') {\n      // Select DPH - okamit uloen\n      if (!disableAutosaveRef.current && draftManager.isAutosaveEnabled() && !isSaving && !showSaveProgress && isDraftLoaded) {\n        triggerAutosave(true); // immediate\n      }\n    }\n    // Pro popis a ceny se autosave spust pi onBlur z input pole\n  };\n\n  // Pokroil funkce pro dodavatele\n  const handleSupplierLocalSearch = async () => {\n    // Pre-fill search with current supplier name or ICO if available\n    const currentName = formData.dodavatel_nazev || '';\n    const currentIco = formData.dodavatel_ico || '';\n    const searchTerm = currentName || currentIco;\n\n    setSupplierSearchTerm(searchTerm);\n    setSupplierSearchResults([]);\n    setShowSupplierSearchDialog(true);\n\n    // Load all available contacts and apply initial filter if we have search term\n    await loadAllSupplierContacts(searchTerm);\n  };\n\n  //  Kontrola zda jsou vyplnn vechny povinn daje dodavatele pro pidn do adrese\n  const checkSupplierRequiredFields = () => {\n    return !!(\n      formData.dodavatel_nazev?.trim() &&\n      formData.dodavatel_adresa?.trim() &&\n      formData.dodavatel_ico?.trim() &&\n      /^\\d{8}$/.test(formData.dodavatel_ico?.trim()) // IO mus mt 8 slic\n    );\n  };\n\n  //  Handler pro kliknut na ikonu \"Pidat do adrese\"\n  const handleAddSupplierToDirectory = async () => {\n    // DEBUG: Add to directory button click - logging removed\n    // DEBUG: ADD TO DIRECTORY logging removed for performance\n    /*// console.log(' [ADD TO DIRECTORY] formData dodavatele:', {\n      nazev: formData.dodavatel_nazev,\n      adresa: formData.dodavatel_adresa,\n      ico: formData.dodavatel_ico,\n      dic: formData.dodavatel_dic,\n      zastoupeny: formData.dodavatel_zastoupeny,\n      kontakt_jmeno: formData.dodavatel_kontakt_jmeno,\n      kontakt_email: formData.dodavatel_kontakt_email,\n      kontakt_telefon: formData.dodavatel_kontakt_telefon\n    });*/\n\n    if (!checkSupplierRequiredFields()) {\n      showToast?.('Vyplte vechny povinn daje dodavatele (nzev, adresa, IO)', 'warning');\n      return;\n    }\n\n    // Detekce existence dodavatele v DB\n    try {\n      setExistingSupplierCheck({ loading: true });\n\n      // Kontrola podle IO\n      const ico = formData.dodavatel_ico.trim();\n      const result = await fetchSupplierContacts({\n        token,\n        username,\n        user_id,\n        usek_zkr: userDetail?.usek_zkr,\n        ico: ico, // Filtruj podle IO\n        load_all: hasPermission && hasPermission('CONTACT_MANAGE')\n      });\n\n      // Prva pro vbr Global scope\n      const canManageGlobal = hasPermission && hasPermission('CONTACT_MANAGE');\n\n      //  DEBUG: Co backend vrtil\n\n      // Filtruj vsledky podle IO (stejn IO me bt vckrt s rznm scope)\n      const filteredResults = Array.isArray(result)\n        ? result.filter(supplier => supplier.ico?.trim() === ico)\n        : [];\n\n\n      if (filteredResults.length > 0) {\n\n        // Pro kad IO me existovat max 3 zznamy (Personal, sek, Global)\n        // PRAVIDLA DETEKCE:\n        // 1. usek_zkr vyplnn  SEK (priorita! ignoruje user_id)\n        // 2. user_id > 0 && usek_zkr przdn  PERSONAL\n        // 3. user_id = 0 && usek_zkr przdn  GLOBAL\n\n        // 1. SEK: M vyplnn usek_zkr (NEJVY PRIORITA)\n        const existsInUsek = filteredResults.find(s => {\n          const hasUsek = s.usek_zkr && s.usek_zkr.trim() !== '' && s.usek_zkr !== '[]' && s.usek_zkr !== 'null';\n\n          if (hasUsek) {\n            try {\n              const supplierUseky = JSON.parse(s.usek_zkr);\n              const myUsekRaw = userDetail?.usek_zkr;\n\n              // Mj sek me bt string nebo array\n              const myUseky = Array.isArray(myUsekRaw) ? myUsekRaw : [myUsekRaw];\n\n\n              // Zkontroluj jestli NJAK z mch sek je v secch dodavatele\n              const hasCommonUsek = Array.isArray(supplierUseky) &&\n                                   myUseky.some(myUsek => myUsek && supplierUseky.includes(myUsek));\n\n              return hasCommonUsek;\n            } catch (e) {\n              return false;\n            }\n          }\n          return false;\n        });\n\n        // 2. PERSONAL: user_id > 0 && usek_zkr przdn\n        const existsInPersonal = filteredResults.find(s => {\n          const hasUsek = s.usek_zkr && s.usek_zkr.trim() !== '' && s.usek_zkr !== '[]' && s.usek_zkr !== 'null';\n          const isPersonal = (s.user_id && s.user_id !== 0 && s.user_id !== '0') && !hasUsek;\n          return isPersonal;\n        });\n\n        // 3. GLOBAL: user_id = 0 && usek_zkr przdn\n        const existsInGlobal = filteredResults.find(s => {\n          const hasUsek = s.usek_zkr && s.usek_zkr.trim() !== '' && s.usek_zkr !== '[]' && s.usek_zkr !== 'null';\n          const isGlobal = (s.user_id === 0 || s.user_id === '0') && !hasUsek;\n          return isGlobal;\n        });\n\n\n        // Pedme info o tom, ve kterch scope dodavatel existuje\n        setExistingSupplierCheck({\n          exists: true,\n          existsInPersonal: existsInPersonal || null,\n          existsInUsek: existsInUsek || null,\n          existsInGlobal: existsInGlobal || null,\n          // Pro zptnou kompatibilitu - preferuj Personal > sek > Global\n          supplier: existsInPersonal || existsInUsek || existsInGlobal\n        });\n      } else {\n        // Dodavatel neexistuje\n        setExistingSupplierCheck({\n          exists: false,\n          existsInPersonal: null,\n          existsInUsek: null,\n          existsInGlobal: null,\n          supplier: null\n        });\n      }\n\n      // Otevt dialog\n      setShowSupplierAddDialog(true);\n    } catch (error) {\n      showToast?.('Chyba pi kontrole dodavatele v databzi', 'error');\n      setExistingSupplierCheck(null);\n    }\n  };\n\n  //  Handler pro uloen dodavatele do adrese\n  const handleSaveSupplierToDirectory = async (supplierData, scope, useky = null) => {\n    // DEBUG: SAVE TO DIRECTORY logging removed for performance\n    /*// console.log(' [SAVE TO DIRECTORY] Zatek ukldn');\n    // console.log(' [SAVE TO DIRECTORY] Pchoz supplierData:', supplierData);\n    // console.log(' [SAVE TO DIRECTORY] Scope:', scope, 'seky:', useky);*/\n\n    try {\n      // Uren user_id a usek_zkr podle scope\n      let userId;\n      let usekZkr;\n\n      if (scope === 'personal') {\n        userId = user_id; // ID pihlenho uivatele\n        usekZkr = '';  //  Przdn string (NIKDY null!) - Personal scope\n      } else if (scope === 'usek') {\n        userId = 0; // 0 = nen osobn\n        usekZkr = useky || []; // Array zkratek sek\n      } else { // global\n        userId = 0;\n        usekZkr = '';  //  Przdn string (NIKDY null!) - Global scope\n      }\n\n      //  FIX: SupplierAddDialog pouv UNPREFIXED nzvy (nazev, ico, adresa)\n      // OrderForm25 mu ale pedv PREFIXED data (dodavatel_nazev, dodavatel_ico, ...)\n      // SupplierAddDialog je intern mapuje na unprefixed  supplierData obsahuje u .nazev, .ico atd.\n      const dataToSave = {\n        nazev: supplierData.nazev || supplierData.dodavatel_nazev || '',\n        adresa: supplierData.adresa || supplierData.dodavatel_adresa || '',\n        ico: supplierData.ico || supplierData.dodavatel_ico || '',\n        dic: supplierData.dic || supplierData.dodavatel_dic || '',\n        zastoupeny: supplierData.zastoupeny || supplierData.dodavatel_zastoupeny || '',\n        kontakt_jmeno: supplierData.kontakt_jmeno || supplierData.dodavatel_kontakt_jmeno || '',\n        kontakt_email: supplierData.kontakt_email || supplierData.dodavatel_kontakt_email || '',\n        kontakt_telefon: supplierData.kontakt_telefon || supplierData.dodavatel_kontakt_telefon || '',\n        user_id: userId,\n        usek_zkr: usekZkr // Backend oekv array nebo null (NE JSON string!)\n      };\n\n      // console.log(' [SAVE TO DIRECTORY] Data pipraven k odesln:', dataToSave);\n\n      let result;\n\n      if (existingSupplierCheck?.exists && scope === existingSupplierCheck.scope) {\n        // Aktualizace existujcho dodavatele ve stejnm scope\n        // console.log(' [SAVE TO DIRECTORY] Aktualizace existujcho dodavatele');\n        /*console.log(' [SAVE TO DIRECTORY] Parametry pro updateSupplierByIco:', {\n          ico: dataToSave.ico,\n          nazev: dataToSave.nazev,\n          adresa: dataToSave.adresa,\n          userId,\n          usekZkr\n        });*/\n\n        result = await updateSupplierByIco({\n          token,\n          username,\n          user_id: userId,\n          usek_zkr: usekZkr,\n          ico: dataToSave.ico,\n          nazev: dataToSave.nazev,\n          adresa: dataToSave.adresa,\n          dic: dataToSave.dic,\n          zastoupeny: dataToSave.zastoupeny,\n          kontakt_jmeno: dataToSave.kontakt_jmeno,\n          kontakt_email: dataToSave.kontakt_email,\n          kontakt_telefon: dataToSave.kontakt_telefon\n        });\n\n        // console.log(' [SAVE TO DIRECTORY] Update spn, odpov:', result);\n        showToast?.('Dodavatel byl spn aktualizovn v adresi', 'success');\n      } else {\n        // Vytvoen novho dodavatele (nebo pidn do jinho scope)\n        // console.log(' [SAVE TO DIRECTORY] Vytven novho dodavatele');\n        /*console.log(' [SAVE TO DIRECTORY] Parametry pro createSupplier:', {\n          userId,  //  Sprvn userId podle scope\n          usekZkr,  //  Sprvn usekZkr podle scope\n          ...dataToSave\n        });*/\n\n        //  FIX: createSupplier oekv FLAT parametry, ne data objekt!\n        //  FIX 2: Pout SPRVN userId a usekZkr podle vybranho scope!\n        //   - Personal: userId = user_id, usekZkr = null\n        //   - sek: userId = 0, usekZkr = [array sek]\n        //   - Global: userId = 0, usekZkr = null\n        result = await createSupplier({\n          token,\n          username,\n          user_id: userId,  //  Z promnn userId (ne user_id!)\n          usek_zkr: usekZkr,  //  Z promnn usekZkr (ne userDetail.usek_zkr!)\n          // Rozbalit dataToSave FLAT do parametr\n          nazev: dataToSave.nazev,\n          adresa: dataToSave.adresa,\n          ico: dataToSave.ico,\n          dic: dataToSave.dic,\n          zastoupeny: dataToSave.zastoupeny,\n          kontakt_jmeno: dataToSave.kontakt_jmeno,\n          kontakt_email: dataToSave.kontakt_email,\n          kontakt_telefon: dataToSave.kontakt_telefon\n        });\n\n        // console.log(' [SAVE TO DIRECTORY] Create spn, odpov:', result);\n        showToast?.('Dodavatel byl spn pidn do adrese', 'success');\n      }\n\n      // Vyistit cache natench kontakt (aby se znovu naetly s novm zznamem)\n      setAllSupplierContacts([]);\n\n      // Zavt dialog\n      // console.log(' [SAVE TO DIRECTORY] Zavrn dialogu');\n      setShowSupplierAddDialog(false);\n      setExistingSupplierCheck(null);\n    } catch (error) {\n      throw new Error(error.message || 'Chyba pi ukldn dodavatele do databze');\n    }\n  };\n\n  const loadAllSupplierContacts = async (initialSearchTerm = '') => {\n    // Pokud u jsou kontakty naten, nedlme nic - jen aplikujeme filtr\n    if (allSupplierContacts.length > 0) {\n      if (initialSearchTerm && initialSearchTerm.length >= 2) {\n        performSupplierSearch(initialSearchTerm);\n      } else {\n        setSupplierSearchResults(allSupplierContacts);\n      }\n      return;\n    }\n\n    setSupplierSearchLoading(true);\n\n    try {\n      const result = await fetchSupplierContacts({\n        token: token,\n        username: username,\n        user_id: user_id,\n        usek_zkr: userDetail?.usek_zkr || undefined,\n        load_all: hasPermission && hasPermission('CONTACT_MANAGE') // Load all contacts for CONTACT_MANAGE users\n      });\n\n      if (Array.isArray(result)) {\n        setAllSupplierContacts(result); // Ulome si vechny kontakty\n\n        // Aplikovat filtr pokud mme vyhledvac termn, jinak zobrazit vechny\n        if (initialSearchTerm && initialSearchTerm.length >= 2) {\n          // Normalizovat vyhledvac termn\n          const searchNormalized = normalizeText(initialSearchTerm);\n\n          // Filtruji pmo nov naten data\n          const filtered = result.filter(supplier => {\n            const name = normalizeText(supplier.nazev || supplier.name || '');\n            const ico = (supplier.ico || '').toLowerCase(); // IO nen teba normalizovat\n            const email = (supplier.kontakt_email || supplier.email || '').toLowerCase();\n            const contact = normalizeText(supplier.kontakt_jmeno || '');\n\n            return name.includes(searchNormalized) ||\n                   ico.includes(initialSearchTerm.toLowerCase()) || // Pro IO pout pvodn termn\n                   email.includes(initialSearchTerm.toLowerCase()) || // Pro email pout pvodn termn\n                   contact.includes(searchNormalized);\n          });\n          setSupplierSearchResults(filtered);\n        } else {\n          setSupplierSearchResults(result); // Zobrazme vechny kontakty\n        }\n      } else {\n        setAllSupplierContacts([]);\n        setSupplierSearchResults([]);\n      }\n\n    } catch (error) {\n      showToast && showToast('Chyba pi natn kontakt: ' + error.message, { type: 'error' });\n      setAllSupplierContacts([]);\n      setSupplierSearchResults([]);\n    } finally {\n      setSupplierSearchLoading(false);\n    }\n  };\n\n  const performSupplierSearch = (searchTerm) => {\n    if (!searchTerm || searchTerm.length < 2) {\n      // Zobrazit vechny kontakty pokud je search przdn\n      setSupplierSearchResults(allSupplierContacts);\n      return;\n    }\n\n    // Normalizovat vyhledvac termn\n    const searchNormalized = normalizeText(searchTerm);\n\n    // Lokln filtrovn natench kontakt - bez API voln!\n    const filtered = allSupplierContacts.filter(supplier => {\n      const name = normalizeText(supplier.nazev || supplier.name || '');\n      const ico = (supplier.ico || '').toLowerCase(); // IO nen teba normalizovat\n      const email = (supplier.kontakt_email || supplier.email || '').toLowerCase();\n      const contact = normalizeText(supplier.kontakt_jmeno || '');\n\n      return name.includes(searchNormalized) ||\n             ico.includes(searchTerm.toLowerCase()) || // Pro IO pout pvodn termn\n             email.includes(searchTerm.toLowerCase()) || // Pro email pout pvodn termn\n             contact.includes(searchNormalized);\n    });\n\n    setSupplierSearchResults(filtered);\n  };\n\n  const handleSupplierSearchChange = (e) => {\n    const value = e.target.value;\n    setSupplierSearchTerm(value);\n\n    // Okamit lokln filtrovn - dn debounce ani API voln!\n    performSupplierSearch(value);\n  };\n\n  const handleSupplierSearchSelect = (supplier) => {\n    // Fill form with selected supplier data using correct field names\n    setFormData(prev => ({\n      ...prev,\n      dodavatel_nazev: supplier.nazev || supplier.name || '',\n      dodavatel_adresa: supplier.adresa || supplier.address || '',\n      dodavatel_ico: supplier.ico || '',\n      dodavatel_dic: supplier.dic || '',\n      dodavatel_zastoupeny: supplier.zastoupeny || supplier.represented || '',\n      dodavatel_kontakt_jmeno: supplier.kontakt_jmeno || (supplier.contactPerson && supplier.contactPerson.name) || '',\n      dodavatel_kontakt_email: supplier.kontakt_email || (supplier.contactPerson && supplier.contactPerson.email) || supplier.email || '',\n      dodavatel_kontakt_telefon: supplier.kontakt_telefon || (supplier.contactPerson && supplier.contactPerson.phone) || supplier.telefon || ''\n    }));\n\n    setShowSupplierSearchDialog(false);\n    setSupplierSearchTerm('');\n    setSupplierSearchResults([]);\n    showToast && showToast('Dodavatel byl vybrn', { type: 'success' });\n  };\n\n  const handleSupplierSearchClose = () => {\n    setShowSupplierSearchDialog(false);\n    setSupplierSearchTerm('');\n    setSupplierSearchResults([]);\n  };\n\n  const handleSupplierAresSearch = () => {\n    // Pre-fill search with current supplier name or IO if available\n    const currentName = formData.dodavatel_nazev || '';\n    const currentICO = formData.dodavatel_ico || '';\n    const searchTerm = currentName || currentICO;\n\n    setAresSearch(searchTerm);\n    setAresPopupOpen(true);\n    if (searchTerm && searchTerm.length >= 2) {\n      fetchAresData(searchTerm);\n    }\n  };\n\n  const fetchAresData = async (searchTerm = '') => {\n    const trimmedSearchTerm = searchTerm?.trim();\n    if (!trimmedSearchTerm || trimmedSearchTerm.length < 3) {\n      setAresResults([]);\n      return;\n    }\n\n    try {\n      setLoadingAres(true);\n\n      // Check if search term is numeric (IO) or text (nzev)\n      const isICO = /^\\d+$/.test(trimmedSearchTerm);\n\n      let url, requestData;\n\n      if (isICO) {\n        // Search by IO - direct endpoint\n        url = `https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/${trimmedSearchTerm}`;\n        const response = await fetch(url, {\n          method: 'GET',\n          headers: { 'Accept': 'application/json' }\n        });\n\n        if (response.ok) {\n          const data = await response.json();\n          const result = {\n            ico: data.ico,\n            dic: data.dic || '',\n            nazev: data.obchodniJmeno || '',\n            adresa: data.sidlo?.textovaAdresa || '',\n            sidlo: data.sidlo?.textovaAdresa || ''\n          };\n          setAresResults([result]);\n        } else {\n          setAresResults([]);\n          if (trimmedSearchTerm.length >= 8) {\n            showToast && showToast('Dodavatel nebyl v ARES nalezen', { type: 'warning' });\n          }\n        }\n      } else {\n        // Search by nzev - search endpoint\n        url = 'https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/vyhledat';\n\n        // Zkusme vyhledat jak s pvodnm textem, tak s normalizovanm\n        const searchVariants = [\n          trimmedSearchTerm, // Pvodn text\n          normalizeText(trimmedSearchTerm) // Normalizovan text (bez diakritiky)\n        ].filter((term, index, arr) => arr.indexOf(term) === index); // Odstran duplikty\n\n        let allResults = [];\n\n        // Vyhledme pro kadou variantu\n        for (const searchVariant of searchVariants) {\n          if (!searchVariant) continue;\n\n          requestData = {\n            obchodniJmeno: searchVariant,\n            pocet: 25\n          };\n\n          const response = await fetch(url, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(requestData)\n          });\n\n          if (response.ok) {\n            const data = await response.json();\n            const results = (data.ekonomickeSubjekty || []).map(item => ({\n              ico: item.ico,\n              dic: item.dic || '',\n              nazev: item.obchodniJmeno || '',\n              adresa: item.sidlo?.textovaAdresa || '',\n              sidlo: item.sidlo?.textovaAdresa || ''\n            }));\n            allResults.push(...results);\n          }\n        }\n\n        // Odstranit duplikty podle IO\n        const uniqueResults = allResults.filter((item, index, arr) =>\n          arr.findIndex(other => other.ico === item.ico) === index\n        );\n\n        // Seadit podle relevance - nejdve ty kter obsahuj pvodn vyhledvac termn\n        const normalizedSearchTerm = normalizeText(trimmedSearchTerm);\n        uniqueResults.sort((a, b) => {\n          const aNameNorm = normalizeText(a.nazev);\n          const bNameNorm = normalizeText(b.nazev);\n\n          const aContainsOriginal = aNameNorm.includes(normalizedSearchTerm);\n          const bContainsOriginal = bNameNorm.includes(normalizedSearchTerm);\n\n          if (aContainsOriginal && !bContainsOriginal) return -1;\n          if (!aContainsOriginal && bContainsOriginal) return 1;\n          return 0;\n        });\n\n        setAresResults(uniqueResults);\n\n        //  Detekce scope pro kad vsledek\n        if (uniqueResults.length > 0) {\n          const scopeInfoMap = {};\n\n          // Pro kad vsledek zkontroluj zda existuje v DB\n          for (const aresItem of uniqueResults) {\n            if (!aresItem.ico) continue;\n\n            try {\n              const dbResults = await fetchSupplierContacts({\n                token,\n                username,\n                user_id,\n                usek_zkr: userDetail?.usek_zkr,\n                ico: aresItem.ico,\n                load_all: hasPermission && hasPermission('CONTACT_MANAGE')\n              });\n\n              const filteredResults = Array.isArray(dbResults)\n                ? dbResults.filter(s => s.ico?.trim() === aresItem.ico.trim())\n                : [];\n\n              if (filteredResults.length > 0) {\n                // Normalizace userDetail.usek_zkr na pole\n                const myUseky = Array.isArray(userDetail?.usek_zkr)\n                  ? userDetail.usek_zkr\n                  : [userDetail?.usek_zkr];\n\n                // 1. SEK: M vyplnn usek_zkr\n                const existsInUsek = filteredResults.find(s => {\n                  const hasUsek = s.usek_zkr && s.usek_zkr.trim() !== '' && s.usek_zkr !== '[]' && s.usek_zkr !== 'null';\n                  if (hasUsek) {\n                    try {\n                      const supplierUseky = JSON.parse(s.usek_zkr);\n                      const hasCommonUsek = myUseky.some(myUsek => myUsek && supplierUseky.includes(myUsek));\n                      return hasCommonUsek;\n                    } catch (e) {\n                      return false;\n                    }\n                  }\n                  return false;\n                });\n\n                // 2. PERSONAL: user_id > 0 && user_id === currentUserId && usek_zkr przdn\n                const existsInPersonal = filteredResults.find(s => {\n                  const hasUsek = s.usek_zkr && s.usek_zkr.trim() !== '' && s.usek_zkr !== '[]' && s.usek_zkr !== 'null';\n                  return s.user_id > 0 && s.user_id === user_id && !hasUsek;\n                });\n\n                // 3. GLOBAL: user_id = 0 && usek_zkr przdn\n                const existsInGlobal = filteredResults.find(s => {\n                  const hasUsek = s.usek_zkr && s.usek_zkr.trim() !== '' && s.usek_zkr !== '[]' && s.usek_zkr !== 'null';\n                  return s.user_id === 0 && !hasUsek;\n                });\n\n                scopeInfoMap[aresItem.ico] = {\n                  existsInPersonal: !!existsInPersonal,\n                  existsInUsek: !!existsInUsek,\n                  existsInGlobal: !!existsInGlobal\n                };\n              } else {\n                scopeInfoMap[aresItem.ico] = {\n                  existsInPersonal: false,\n                  existsInUsek: false,\n                  existsInGlobal: false\n                };\n              }\n            } catch (error) {\n              scopeInfoMap[aresItem.ico] = {\n                existsInPersonal: false,\n                existsInUsek: false,\n                existsInGlobal: false\n              };\n            }\n          }\n\n          setAresScopeInfo(scopeInfoMap);\n        }\n\n        if (uniqueResults.length === 0) {\n          // dn vsledky nenalezeny ani s normalizac\n        }\n      }\n\n    } catch (error) {\n      setAresResults([]);\n      setAresScopeInfo({});\n      showToast && showToast('Chyba pi pipojen k ARES', { type: 'error' });\n    } finally {\n      setLoadingAres(false);\n    }\n  };\n\n  //  Handler pro pepnut vbru seku v ARES dialogu (stejn jako v SupplierAddDialog)\n  const handleAresUsekToggle = (usekZkr) => {\n    setAresSelectedUseky(prev => {\n      if (prev.includes(usekZkr)) {\n        return prev.filter(zkr => zkr !== usekZkr);\n      } else {\n        return [...prev, usekZkr];\n      }\n    });\n  };\n\n  const handleAresSearchChange = (e) => {\n    const value = e.target.value;\n    setAresSearch(value);\n\n    // Debounce search\n    if (value.length >= 2) {\n      clearTimeout(window.aresSearchTimeout);\n      window.aresSearchTimeout = setTimeout(() => {\n        fetchAresData(value);\n      }, 500);\n    } else {\n      setAresResults([]);\n    }\n  };\n\n  const handleAresSelect = (aresItem) => {\n    setFormData(prev => ({\n      ...prev,\n      dodavatel_nazev: aresItem.nazev || '',\n      dodavatel_adresa: aresItem.adresa || aresItem.sidlo || '',\n      dodavatel_ico: aresItem.ico || '',\n      dodavatel_dic: aresItem.dic || ''\n    }));\n\n    setAresPopupOpen(false);\n    setAresSearch('');\n    setAresResults([]);\n    showToast && showToast('Dodavatel naten z ARES', { type: 'success' });\n  };\n\n  // Funkce pro ukldn ARES zznamu do lokln databze\n  const handleSaveToLocal = async (aresItem, saveLocation) => {\n    if (!token || !username || !user_id) {\n      showToast && showToast('Chyb pihlaovac daje', { type: 'error' });\n      return;\n    }\n\n    setSavingToLocal(aresItem.ico);\n\n    try {\n      // Debug informace\n      addDebugLog('info', 'ARES-SAVE', 'permissions-check', `Uivatel: ${username}, USER_MANAGE: ${canManageUsers}, sek: ${userDetail?.usek_zkr}, Ukldm do: ${JSON.stringify(saveLocation)}`);\n\n      //  Urit user_id a usek_zkr podle vybranho umstn\n      let targetUserId = 0; // 0 = globln nebo sekov\n      let targetUsekZkr = '';\n\n      if (saveLocation === 'personal') {\n        targetUserId = user_id; // Osobn kontakt - jen pro vlastnka\n        targetUsekZkr = '';\n        addDebugLog('info', 'ARES-SAVE', 'target-personal', `Cl: Osobn kontakt pro user_id=${targetUserId}`);\n      } else if (saveLocation?.scope === 'usek' || saveLocation === 'department') {\n        //  SEKOV KONTAKT - pout vybran seky\n        targetUserId = 0;\n        const selectedUseky = saveLocation?.useky || [userDetail?.usek_zkr || ''];\n        targetUsekZkr = JSON.stringify(selectedUseky);\n        addDebugLog('info', 'ARES-SAVE', 'target-usek', `Cl: Kontakty seku pro seky=${selectedUseky.join(', ')}, usek_zkr=${targetUsekZkr}`);\n      } else if (saveLocation === 'global') {\n        targetUserId = 0; // Globln kontakt - vid vichni\n        targetUsekZkr = '';\n        addDebugLog('info', 'ARES-SAVE', 'target-global', `Cl: Globln kontakt (user_id=0, usek_zkr='')`);\n      }\n\n      // Nejdve zkusit aktualizovat existujc zznam\n      try {\n        await updateSupplierByIco({\n          token,\n          username,\n          ico: aresItem.ico,\n          nazev: aresItem.nazev,\n          adresa: aresItem.adresa || aresItem.sidlo || '',\n          dic: aresItem.dic || '',\n          zastoupeny: '',\n          kontakt_jmeno: '',\n          kontakt_email: '',\n          kontakt_telefon: '',\n          user_id: targetUserId,\n          usek_zkr: targetUsekZkr\n        });\n\n        showToast && showToast('Dodavatel byl aktualizovn v lokln databzi', { type: 'success' });\n\n      } catch (updateError) {\n        // Pokud aktualizace sele (zznam neexistuje), vytvo nov\n        await createSupplier({\n          token,\n          username,\n          nazev: aresItem.nazev,\n          adresa: aresItem.adresa || aresItem.sidlo || '',\n          ico: aresItem.ico,\n          dic: aresItem.dic || '',\n          zastoupeny: '',\n          kontakt_jmeno: '',\n          kontakt_email: '',\n          kontakt_telefon: '',\n          user_id: targetUserId,\n          usek_zkr: targetUsekZkr\n        });\n\n        showToast && showToast('Dodavatel byl pidn do lokln databze', { type: 'success' });\n      }\n\n      // Refresh loklnch kontakt po spnm uloen\n      setAllSupplierContacts([]); // Vyma cache aby se pi ptm oteven naetly nov data\n\n    } catch (error) {\n      showToast && showToast(`Chyba pi ukldn: ${error.message}`, { type: 'error' });\n    } finally {\n      setSavingToLocal(null);\n    }\n  };\n\n  const handleSelectAndSave = async (aresItem) => {\n    // Nejdve vypl formul\n    handleAresSelect(aresItem);\n\n    // Pak ulo do lokln DB s vchozm umstnm\n    const defaultLocation = 'personal'; // Vchoz je osobn kontakt\n    await handleSaveToLocal(aresItem, defaultLocation);\n  };\n\n  // Automatick vyhledvn IO pi zmn focus\n  const handleIcoBlur = (ico) => {\n    const trimmedIco = ico?.trim();\n\n    // Auto-save pi blur\n    handleFieldBlur('dodavatel_ico', trimmedIco);\n\n    if (trimmedIco && trimmedIco.length >= 8 && /^\\d+$/.test(trimmedIco)) {\n      checkSupplierByIco(trimmedIco);\n    }\n  };\n\n  // Kontrola dodavatele podle IO (nejdve lokln DB, pak ARES)\n  const checkSupplierByIco = async (ico) => {\n    const trimmedIco = ico?.trim();\n    if (!trimmedIco || trimmedIco.length < 8) return;\n\n    setIsIcoOperation(true);\n    setIcoCheckStatus('checking');\n    setIcoCheckData(null);\n    setShowIcoCheck(true);\n\n    try {\n      // Nejdve zkusme lokln databzi\n      const localResult = await searchSupplierByIco({\n        token: token,\n        username: username,\n        ico: trimmedIco\n      });\n\n      if (localResult?.data && Array.isArray(localResult.data) && localResult.data.length > 0) {\n        // Nalezeno v lokln databzi\n        const supplier = localResult.data[0];\n        setIcoCheckStatus('found-local');\n        setIcoCheckData({\n          ...supplier,\n          source: 'local'\n        });\n      } else {\n        // Nen v lokln DB, zkusme ARES\n        const aresUrl = `https://ares.gov.cz/ekonomicke-subjekty-v-be/rest/ekonomicke-subjekty/${trimmedIco}`;\n        const aresResponse = await fetch(aresUrl, {\n          method: 'GET',\n          headers: { 'Accept': 'application/json' }\n        });\n\n        if (aresResponse.ok) {\n          const aresData = await aresResponse.json();\n          setIcoCheckStatus('found-ares');\n          setIcoCheckData({\n            ico: aresData.ico,\n            dic: aresData.dic || '',\n            nazev: aresData.obchodniJmeno || '',\n            adresa: aresData.sidlo?.textovaAdresa || '',\n            source: 'ares'\n          });\n        } else {\n          setIcoCheckStatus('not-found');\n          setIcoCheckData(null);\n        }\n      }\n    } catch (error) {\n      setIcoCheckStatus('not-found');\n      setIcoCheckData(null);\n    } finally {\n      setIsIcoOperation(false);\n    }\n  };\n\n  // Akce pro IO dialog - pidn do osobnch kontakt\n  const handleIcoUpdate = async () => {\n    if (!icoCheckData) return;\n\n    if (icoCheckData.source === 'ares') {\n      // Z ARES - pidme do osobnch kontakt pod user_id\n      try {\n        const result = await createSupplier({\n          token: token,\n          username: username,\n          nazev: icoCheckData.nazev,\n          ico: icoCheckData.ico,\n          dic: icoCheckData.dic || '',\n          adresa: icoCheckData.adresa || '',\n          zastoupeny: '',\n          kontakt_jmeno: '',\n          kontakt_email: '',\n          kontakt_telefon: '',\n          user_id: user_id,\n          usek_zkr: '' // Osobn kontakt = bez seku\n        });\n\n        if (result?.ok || result?.status === 'ok') {\n          showToast && showToast('Dodavatel byl pidn do vaich osobnch kontakt', { type: 'success' });\n        } else {\n          throw new Error(result?.message || 'Neznm chyba');\n        }\n      } catch (error) {\n        showToast && showToast(`Chyba pi pidvn do kontakt: ${error.message}`, { type: 'error' });\n        return; // Nepokraujeme s vyplnnm\n      }\n    }\n\n    // Vyplnme formul\n    handleIcoFillForm();\n  };\n\n  const handleIcoFillForm = () => {\n    if (!icoCheckData) return;\n\n    setFormData(prev => ({\n      ...prev,\n      dodavatel_nazev: icoCheckData.nazev || icoCheckData.name || '',\n      dodavatel_adresa: icoCheckData.adresa || icoCheckData.address || '',\n      dodavatel_ico: icoCheckData.ico || '',\n      dodavatel_dic: icoCheckData.dic || '',\n      dodavatel_zastoupeny: icoCheckData.zastoupeny || '',\n      dodavatel_kontakt_jmeno: icoCheckData.kontakt_jmeno || '',\n      dodavatel_kontakt_email: icoCheckData.kontakt_email || '',\n      dodavatel_kontakt_telefon: icoCheckData.kontakt_telefon || ''\n    }));\n\n    setShowIcoCheck(false);\n    setIcoCheckStatus(null);\n    setIcoCheckData(null);\n    // showToast && showToast('daje dodavatele byly vyplnny', { type: 'success' }); // Odstranno - nen teba\n  };\n\n  const handleIcoCancel = () => {\n    setShowIcoCheck(false);\n    setIcoCheckStatus(null);\n    setIcoCheckData(null);\n  };\n\n  // ====================== ABLONY - POMOCN FUNKCE ======================\n\n  // Kontrola zda ablona odpovd vyhledvacmu dotazu\n  const matchesTemplateQuery = (entry, query) => {\n    if (!query || !query.trim()) return true;\n    const normalizedQuery = normalizeText(query);\n    const entryName = normalizeText(entry.name || entry.dbName || '');\n    const entryPredmet = normalizeText(entry.data?.poApproval?.predmet || '');\n    const entryFirstItem = normalizeText(entry.data?.polozky?.[0]?.popis || '');\n    return entryName.includes(normalizedQuery) || entryPredmet.includes(normalizedQuery) || entryFirstItem.includes(normalizedQuery);\n  };\n\n  // Kompaktn nhled poloek ablony (pevzato z OrderFormComponent)\n  const compactTemplatePreview = (data) => {\n    try {\n      const preview = {};\n      if (data?.poApproval?.predmet) preview.predmet = data.poApproval.predmet;\n      if (data?.poApproval?.max_cena_s_dph) preview.maxCena = data.poApproval.max_cena_s_dph;\n      if (data?.orderDetails?.dodavatel_nazev) preview.dodavatel = data.orderDetails.dodavatel_nazev;\n      if (Array.isArray(data?.polozky) && data.polozky.length) {\n        preview.polozky = data.polozky.length;\n        if (data.polozky[0]?.popis) preview.prvniPolozka = data.polozky[0].popis;\n      }\n      return preview;\n    } catch { return {}; }\n  };\n\n  // Pokroil preview funkce pro detailn nhled ablony\n  const createDetailedTemplatePreview = (template, data) => {\n    try {\n      const preview = {\n        templateInfo: {\n          name: template.name || 'Bez nzvu',\n          type: template.type || 'mixed',\n          created: template.ts ? formatDateOnly(new Date(template.ts)) : 'Neznmo',\n          isGlobal: template.user_id === 0\n        },\n        poApproval: null,\n        orderDetails: null,\n        items: []\n      };\n\n      // PO Approval sekce\n      if (data?.poApproval) {\n        const po = data.poApproval;\n        preview.poApproval = {\n          predmet: po.predmet || '',\n          maxCena: po.max_cena_s_dph || '',\n          popisPozadavku: po.popis_pozadavku || '',\n          strediska: Array.isArray(po.strediska_kod) ? po.strediska_kod : [],\n          objednatel: po.objednatel_id || '',\n          garant: po.garant_uzivatel_id || '',\n          prikazce: po.prikazce_id || ''\n        };\n      }\n\n      // Order Details sekce\n      if (data?.orderDetails) {\n        const od = data.orderDetails;\n        preview.orderDetails = {\n          dodavatelNazev: od.dodavatel_nazev || '',\n          dodavatelAdresa: od.dodavatel_adresa || '',\n          dodavatelIco: od.dodavatel_ico || '',\n          dodavatelDic: od.dodavatel_dic || '',\n          zpusobFinancovani: od.zpusob_financovani || '',\n          lpKod: od.lp_kod || '',\n          druhObjednavky: od.druh_objednavky_kod || '',\n          poznamka: od.poznamka || '',\n          datumDodani: od.datum_dodani || '',\n          fakturovatNa: od.fakturovat_na || '',\n          dodaciAdresa: od.dodaci_adresa || ''\n        };\n      }\n\n      // Poloky\n      if (Array.isArray(data?.polozky)) {\n        preview.items = data.polozky.map((item, index) => ({\n          index: index + 1,\n          popis: item.popis || '',\n          pocet: item.pocet || 1,\n          jednotka: item.jednotka || '',\n          cenaJednotka: item.cena_jednotka || 0,\n          cenaTotal: (item.pocet || 1) * (item.cena_jednotka || 0)\n        }));\n      }\n\n      return preview;\n    } catch (error) {\n      return null;\n    }\n  };\n\n  // Funkce pro oteven preview modalu\n  const showTemplatePreview = (template, data) => {\n    const previewData = createDetailedTemplatePreview(template, data);\n    if (previewData) {\n      setPreviewModalData({ template, data, preview: previewData });\n    }\n  };\n\n  // Extrakce poloek ze ablony pro nhled\n  const extractTemplateItems = (entry) => {\n    try {\n      const data = entry?.data;\n      if (Array.isArray(data?.polozky)) return data.polozky;\n      return [];\n    } catch { return []; }\n  };\n\n  // Logovn akc se ablonami\n  const logTemplateAction = (action, details) => {\n    try {\n      const logEntry = {\n        ts: Date.now(),\n        action,\n        details: details || {},\n        user: username || 'unknown'\n      };\n      setTemplateActionsLog(prev => [logEntry, ...prev.slice(0, 49)]);\n    } catch {}\n  };\n\n  const handleInputChange = useCallback((field, value) => {\n    //  DEBUG: Loguj zmny critickch pol\n    if (field === 'druh_objednavky_kod') {\n      // DEBUG: Order type change - logging removed\n    }\n\n    //  Prvn zmna v nov objednvce?\n    const isFirstChangeInNewOrder = !isChanged && !isOrderSavedToDB;\n\n    // NASTAVIT isChanged = true pi kad zmn\n    setIsChanged(true);\n\n    //  AUTOMATICK AUTOSAVE - aktivovat isDraftLoaded pi prvn zmn\n    if (!isDraftLoaded) {\n      setIsDraftLoaded(true);\n    }\n\n    //  OKAMIT AUTOSAVE pi prvn zmn v nov objednvce\n    if (isFirstChangeInNewOrder) {\n      // Okamit uloit koncept bez debounce\n      triggerAutosave(true); // force immediate save\n    } else {\n      //  SPUSTIT AUTOSAVE s debounce (3 sekundy po posledn zmn)\n      triggerAutosave();\n    }\n\n    // Validace pro povinn pole v relnm ase\n    const criticalFields = [\n      'garant_uzivatel_id',\n      'prikazce_id',\n      'strediska_kod',\n      'predmet',\n      'max_cena_s_dph',\n      'lp_kod',  //  LP kdy jsou tak povinn v nkterch fzch\n      'zpusob_financovani',  //  Zpsob financovn je povinn\n      'druh_objednavky_kod'  //  Druh objednvky je povinn\n    ];\n    if (criticalFields.includes(field)) {\n      // Pro stediska a LP kdy kontroluj dlku pole\n      const valueToValidate = (field === 'strediska_kod' || field === 'lp_kod') ? value : value;\n      validateField(field, valueToValidate);\n    }\n\n    setFormData(prev => {\n      let processedValue = value;\n\n      // Stediska se ukldaj jako pole kd ve frontend, transformace a pi ukldn do DB\n\n      const newData = {\n        ...prev,\n        [field]: processedValue\n      };\n\n      //  Pi zmn zpsobu financovn VYISTIT vechny dynamick hodnoty z pedchozho typu\n      //  KRITICK: Mus se vyistit VE, aby se do DB i LS uloila jen data pro nov typ\n      if (field === 'zpusob_financovani') {\n        // Vyistit VECHNY dynamick fieldy z vech typ financovn\n        newData.lp_kod = [];\n        newData.cislo_smlouvy = '';\n        newData.smlouva_poznamka = '';\n        newData.individualni_schvaleni = '';\n        newData.individualni_poznamka = '';\n        newData.pojistna_udalost_cislo = '';\n        newData.pojistna_udalost_poznamka = '';\n        // Pokladna nem dn extra fieldy\n      }\n\n      // Financovn se ukld jako kd ve frontend, transformace a pi ukldn do DB\n\n      // Funkce pro pevod na MySQL datetime formt\n      const toMySQLDateTime = () => {\n        const now = new Date();\n        const year = now.getFullYear();\n        const month = String(now.getMonth() + 1).padStart(2, '0');\n        const day = String(now.getDate()).padStart(2, '0');\n        const hours = String(now.getHours()).padStart(2, '0');\n        const minutes = String(now.getMinutes()).padStart(2, '0');\n        const seconds = String(now.getSeconds()).padStart(2, '0');\n        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n      };\n\n      // Funkce pro aktuln datum ve formtu YYYY-MM-DD\n      const getCurrentDate = () => {\n        const now = new Date();\n        const year = now.getFullYear();\n        const month = String(now.getMonth() + 1).padStart(2, '0');\n        const day = String(now.getDate()).padStart(2, '0');\n        return `${year}-${month}-${day}`;\n      };\n\n      // Pokud se mn stav schvlen, nastav pslun daje\n      //  DLEIT: stav_workflow_kod se NIKDY NEMN zde - jen pi ukldn do DB!\n      if (field === 'stav_schvaleni') {\n\n        if (value === 'schvaleno' && user_id) {\n          //  DLEIT: schvalovatel_id a dt_schvaleni nastavit POUZE pokud jet neexistuj\n          if (!prev.schvalovatel_id) {\n            newData.schvalovatel_id = user_id;\n            newData.dt_schvaleni = toMySQLDateTime();\n          } else {\n            // U existuje - ZACHOVAT pvodn hodnoty\n            newData.schvalovatel_id = prev.schvalovatel_id;\n            newData.dt_schvaleni = prev.dt_schvaleni;\n          }\n          //  Pi schvlen VYMAZAT koment (schvlen nepotebuje zdvodnn)\n          newData.schvaleni_komentar = '';\n          // stav_workflow_kod se zmn a pi uloen v backendu\n        }\n        else if (value === 'neschvaleno') {\n          //  DLEIT: schvalovatel_id a dt_schvaleni nastavit POUZE pokud jet neexistuj\n          if (!prev.schvalovatel_id) {\n            newData.schvalovatel_id = user_id;\n            newData.dt_schvaleni = toMySQLDateTime();\n          } else {\n            // U existuje - ZACHOVAT pvodn hodnoty\n            newData.schvalovatel_id = prev.schvalovatel_id;\n            newData.dt_schvaleni = prev.dt_schvaleni;\n          }\n          // Koment ZSTV (dvod zamtnut je povinn)\n          // stav_workflow_kod se zmn a pi uloen v backendu\n        }\n        else if (value === 'ceka_se') {\n          //  DLEIT: schvalovatel_id a dt_schvaleni nastavit POUZE pokud jet neexistuj\n          if (!prev.schvalovatel_id) {\n            newData.schvalovatel_id = user_id;\n            newData.dt_schvaleni = toMySQLDateTime();\n          } else {\n            // U existuje - ZACHOVAT pvodn hodnoty\n            newData.schvalovatel_id = prev.schvalovatel_id;\n            newData.dt_schvaleni = prev.dt_schvaleni;\n          }\n          // Koment ZSTV (dvod vrcen je povinn)\n          // stav_workflow_kod se zmn a pi uloen v backendu\n        }\n        else if (value === '') {\n          // Reset pi zruen vbru - dn radio nen zakrtnut\n          newData.schvalovatel_id = '';\n          newData.dt_schvaleni = '';\n          //  NESMME mnit stav_workflow_kod! Ten se mn jen v DB pi uloen!\n          // Viditelnost bloku schvlen zvis POUZE na stavu z DB, ne na checkboxu!\n        }\n      }\n\n      // Pokud se mn stav odesln, automaticky nastav datum\n      if (field === 'stav_odeslano') {\n        if (value === true && !prev.datum_odeslani) {\n          // Pi zakrtnut \"Odeslno\" automaticky vypl aktuln datum, pokud nen vyplnno\n          newData.datum_odeslani = getCurrentDate();\n\n          //  WORKFLOW se NEMN pi zakrtnut checkboxu!\n          // Zmn se a pi ULOEN formule (handleSave)\n          addDebugLog('info', 'WORKFLOW', 'odeslano-checked', `Checkbox Odeslno zakrtnut - workflow se zmn a pi uloen`);\n\n        } else if (value === false) {\n          // Pi zruen zakrtnut vyma datum odesln\n          newData.datum_odeslani = '';\n\n          //  WORKFLOW se NEMN pi zruen zakrtnut!\n          // Zmn se a pi ULOEN formule (handleSave)\n          addDebugLog('info', 'WORKFLOW', 'odeslano-unchecked', `Checkbox Odeslno odkrtnut - workflow se zmn a pi uloen`);\n\n          // KRITICK KONTROLA: NIKDY nevolat clearPhase2UnlockState pokud je objednvka ODESLAN/ZRUEN\n          const currentWorkflowState = prev.stav_workflow_kod || 'NOVA';\n          const hasOdeslano = hasWorkflowState(currentWorkflowState, 'ODESLANA');\n          const hasZruseno = hasWorkflowState(currentWorkflowState, 'ZRUSENA');\n\n          // Pokud je objednvka ODESLAN/ZRUEN - NIKDY NEISTIT zamen\n          if (hasOdeslano || hasZruseno || prev.stav_stornovano) {\n            addDebugLog('warning', 'PHASE2-UNLOCK', 'clear-blocked-final', `BLOKACE clearPhase2UnlockState - objednvka je ODESLAN/ZRUEN (workflow=${currentWorkflowState})`);\n          } else {\n            // Pouze pro objednvky kter NEJSOU odeslan/zruen\n            addDebugLog('info', 'PHASE2-UNLOCK', 'clear-allowed', `itn Phase 2 unlock povoleno - objednvka nen v zamenm stavu`);\n            clearPhase2UnlockState();\n          }\n        }\n      }\n\n      // Pokud se mn stav stornovn, automaticky nastav datum\n      if (field === 'stav_stornovano') {\n        if (value === true && !prev.datum_storna) {\n          // Pi zakrtnut \"Stornovno\" automaticky vypl aktuln datum, pokud nen vyplnno\n          newData.datum_storna = getCurrentDate();\n\n          // Pidat ID pihlenho uivatele do storno dat (pro DB)\n          if (user_id && !prev.storno_uzivatel_id) {\n            newData.storno_uzivatel_id = user_id;\n          }\n\n          // Pidat jmno pihlenho uivatele do storno dat (pro zobrazen)\n          if (userDetail && !prev.storno_provedl) {\n            const jmeno = `${userDetail.titul_pred ? userDetail.titul_pred + ' ' : ''}${userDetail.jmeno || ''} ${userDetail.prijmeni || ''}${userDetail.titul_za ? ', ' + userDetail.titul_za : ''}`.replace(/\\s+/g, ' ').trim();\n            newData.storno_provedl = jmeno;\n          }\n        } else if (value === false) {\n          // Pi zruen zakrtnut vyma datum storna a souvisejc data\n          newData.datum_storna = '';\n          newData.storno_uzivatel_id = '';\n          newData.storno_provedl = '';\n          newData.odeslani_storno_duvod = '';\n\n          // KRITICK KONTROLA: NIKDY nevolat clearPhase2UnlockState pokud je objednvka ODESLAN/ZRUEN\n          const currentWorkflowState = prev.stav_workflow_kod || 'NOVA';\n          const hasOdeslano = hasWorkflowState(currentWorkflowState, 'ODESLANA');\n          const hasZruseno = hasWorkflowState(currentWorkflowState, 'ZRUSENA');\n\n          // Pokud je objednvka ODESLAN/ZRUEN - NIKDY NEISTIT zamen\n          if (hasOdeslano || hasZruseno) {\n            addDebugLog('warning', 'PHASE2-UNLOCK', 'clear-blocked-storno-final', `BLOKACE clearPhase2UnlockState pi storno zmn - objednvka je ODESLAN/ZRUEN (workflow=${currentWorkflowState})`);\n          } else {\n            // Pouze pro objednvky kter NEJSOU odeslan/zruen\n            addDebugLog('info', 'PHASE2-UNLOCK', 'clear-allowed-storno', `itn Phase 2 unlock po storno zmn povoleno - objednvka nen v zamenm stavu`);\n            clearPhase2UnlockState();\n          }\n        }\n      }\n\n      //  FZE 7: Checkbox vcn sprvnosti\n      // DLEIT: Nastavit ID a timestamp IHNED po zakrtnut, aby byly dostupn pro autosave!\n      if (field === 'potvrzeni_vecne_spravnosti') {\n        if (value === 1 || value === true) {\n          // Pi zakrtnut checkboxu VDY nastav potvrzujcho uivatele a as\n          if (user_id && !prev.potvrdil_vecnou_spravnost_id) {\n            //  OPRAVA: Pout lokln as msto UTC (.toISOString())\n            const now = new Date();\n            const year = now.getFullYear();\n            const month = String(now.getMonth() + 1).padStart(2, '0');\n            const day = String(now.getDate()).padStart(2, '0');\n            const hours = String(now.getHours()).padStart(2, '0');\n            const minutes = String(now.getMinutes()).padStart(2, '0');\n            const seconds = String(now.getSeconds()).padStart(2, '0');\n            const localTimestamp = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n            \n            // Nastavit ID a timestamp pouze pi prvnm zakrtnut (pokud jet nejsou)\n            newData.potvrdil_vecnou_spravnost_id = user_id;\n            newData.dt_potvrzeni_vecne_spravnosti = localTimestamp;\n            addDebugLog('info', 'VECNA-SPRAVNOST', 'checkbox-set', `Automaticky nastaveno: potvrdil_vecnou_spravnost_id=${user_id}, dt=${newData.dt_potvrzeni_vecne_spravnosti}, checkbox_value=${value}`);\n          } else if (!user_id) {\n            addDebugLog('error', 'VECNA-SPRAVNOST', 'no-user-id', 'user_id nen definovno - nemu nastavit potvrdil_vecnou_spravnost_id');\n          } else {\n            addDebugLog('info', 'VECNA-SPRAVNOST', 'checkbox-already-set', `ID u je nastaveno: ${prev.potvrdil_vecnou_spravnost_id}`);\n          }\n        } else if (value === 0 || value === false) {\n          // Pi odkrtnut checkboxu NEMAZAT ID a as - nech zstanou pro historii\n          addDebugLog('info', 'VECNA-SPRAVNOST', 'checkbox-unset', 'Checkbox odkrtnut - ID a datum zstvaj zachovny');\n        }\n      }\n\n      //  FZE 8: Pokud se mn checkbox dokonen objednvky, automaticky nastav ID a timestamp\n      if (field === 'potvrzeni_dokonceni_objednavky') {\n        if (value === 1 || value === true) {\n          //  OPRAVA: Pout lokln as msto UTC (.toISOString())\n          if (user_id) {\n            const now = new Date();\n            const year = now.getFullYear();\n            const month = String(now.getMonth() + 1).padStart(2, '0');\n            const day = String(now.getDate()).padStart(2, '0');\n            const hours = String(now.getHours()).padStart(2, '0');\n            const minutes = String(now.getMinutes()).padStart(2, '0');\n            const seconds = String(now.getSeconds()).padStart(2, '0');\n            const localTimestamp = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n            \n            newData.dokoncil_id = user_id;\n            newData.dt_dokonceni = localTimestamp;\n          } else {\n            addDebugLog('error', 'DOKONCENI', 'no-user-id', 'user_id nen definovno');\n          }\n        } else if (value === 0 || value === false) {\n          // Pi odkrtnut checkboxu vyma ID a as\n          newData.dokoncil_id = null;\n          newData.dt_dokonceni = null;\n        }\n      }\n\n      return newData;\n    });\n\n    //  NOV AUTOSAVE SYSTM:\n    // Pro SELECT/CHECKBOX pole - spus autosave OKAMIT (s debouncem proti opakovanmu voln)\n    // Pro textov pole - autosave se spust pi onBlur v handleFieldBlur\n    // POZNMKA: potvrzeni_vecne_spravnosti a textov pole vcn sprvnosti se NEUKLDAJ automaticky\n    // - uivatel mus kliknout na Save button, aby se uloily sprvn vetn vech dat\n    // POZNMKA 2: potvrzeni_dokonceni_objednavky a dokonceni_poznamka se TAK NEUKLDAJ automaticky\n    // - stejn logika jako Fze 7 - uloen a pi Save button\n    const selectFields = [\n      'garant_uzivatel_id',\n      'prikazce_id',\n      'strediska_kod',\n      'zpusob_financovani',\n      'lp_kod',\n      'druh_objednavky_kod',\n      'stav_schvaleni',\n      'stav_odeslano',\n      'stav_stornovano',\n      // 'potvrzeni_vecne_spravnosti',         //  FZE 7: VYPNUTO - uloen a pi Save button\n      // 'potvrzeni_dokonceni_objednavky'      //  FZE 8: VYPNUTO - uloen a pi Save button (stejn jako Fze 7)\n    ];\n\n    if (selectFields.includes(field)) {\n      // SELECT/CHECKBOX - autosave okamit (s min. intervalem 1s)\n      if (!disableAutosaveRef.current && draftManager.isAutosaveEnabled() && !isSaving && !showSaveProgress && isDraftLoaded) {\n        triggerAutosave(true); // true = immediate (s min intervalem)\n      }\n    }\n    // Pro textov pole se autosave spust v handleFieldBlur (s debouncem 3s)\n  }, [validationErrors, formData, user_id, disableAutosaveRef, draftManager, isSaving, showSaveProgress, isDraftLoaded, triggerAutosave, setIsDraftLoaded]);\n\n  // Speciln handler pro radio buttony - umouje zruit vbr opakovanm kliknutm\n  const handleRadioClick = useCallback((value) => {\n    if (formData.stav_schvaleni === value) {\n      // Opakovan kliknut na stejn radio - zru vbr\n      handleInputChange('stav_schvaleni', '');\n      // Vynuluj i koment pi zruen vbru\n      handleInputChange('schvaleni_komentar', '');\n      // Vynuluj i schvalovatele pi zruen\n      handleInputChange('schvalovatel_id', '');\n    } else {\n      // Normln vbr\n      handleInputChange('stav_schvaleni', value);\n\n      //  AUTOMATICKY nastavit schvalovatele na aktuln pihlenho uivatele\n      // kdy vybere \"Schvleno\", \"Neschvleno\" nebo \"ek se\"\n      if (user_id && (value === 'schvaleno' || value === 'neschvaleno' || value === 'ceka_se')) {\n        handleInputChange('schvalovatel_id', user_id);\n      }\n    }\n\n    //  Radio button - autosave okamit\n    if (!disableAutosaveRef.current && draftManager.isAutosaveEnabled() && !isSaving && !showSaveProgress && isDraftLoaded) {\n      triggerAutosave(true); // true = immediate\n    }\n  }, [formData.stav_schvaleni, user_id, disableAutosaveRef, draftManager, isSaving, showSaveProgress, isDraftLoaded]);\n\n  // Handler pro uloen aktulnho formule jako ablonu\n  const handleSaveAsTemplate = useCallback(() => {\n    setShowTemplateSaveModal(true);\n    setSaveMode('new');\n    setSelectedTargetTemplate(null);\n    setTemplateName('');\n    setTemplateType('po');\n  }, []);\n\n  // Handler pro toggle sbalen/rozbalen sekc\n  const handleToggleSections = useCallback(() => {\n    if (areSectionsCollapsed) {\n      //  EXPAND ALL - Rozbalit vechny sekce\n      setSectionStates(prev => {\n        const newStates = { ...prev };\n        Object.keys(newStates).forEach(key => {\n          newStates[key] = false; // false = expanded\n        });\n        return newStates;\n      });\n      setAreSectionsCollapsed(false);\n    } else {\n      //  COLLAPSE ALL - Sbalit POUZE zamen sekce\n      setSectionStates(prev => {\n        const newStates = { ...prev };\n\n        //  NOV: Pout allSectionStates pmo - obsahuje u unlock states z workflowManager\n        const lockedSections = [];\n        Object.keys(newStates).forEach(sectionKey => {\n          //  VJIMKA: Sekci \"registr_smluv\" NIKDY nesbalovat automaticky\n          // Dvod: I kdy je zamen (read-only), mus zstat viditeln pro bnho uivatele,\n          // aby mohl vidt a ppadn potvrdit checkbox \"M bt zveejnna v registru\"\n          if (sectionKey === 'registr_smluv') {\n            return; // Pesko tuto sekci - zstane v aktulnm stavu\n          }\n\n          //  Pout allSectionStates - workflowManager u zahrnuje unlock states\n          const sectionState = allSectionStates[sectionKey];\n          const isLocked = sectionState && !sectionState.enabled;\n\n          if (isLocked) {\n            newStates[sectionKey] = true; // true = collapsed (sbalit zamen)\n            lockedSections.push(sectionKey);\n          }\n        });\n\n        //  [SECTION LOCK] Logovn zamench sekc\n        if (lockedSections.length > 0) {\n        }\n\n        return newStates;\n      });\n      setAreSectionsCollapsed(true);\n    }\n  }, [\n    areSectionsCollapsed,\n    allSectionStates, //  NOV: jedin zvislost - obsahuje vechny section states vetn unlock\n    workflowManager\n  ]);\n\n  //  SCROLL K SEKCI - umouje scrollovn i k zamenm sekcm pro ten dat\n  const scrollToSection = useCallback((sectionKey, behavior = 'smooth') => {\n    //  Scrollovn funguje i pro zamen sekce - uivatel me st ji vyplnn data\n\n    // Najdi element sekce pomoc data-section atributu\n    const scrollContainer = scrollableContentRef.current;\n    if (!scrollContainer) {\n      return false;\n    }\n\n    const sectionElement = scrollContainer.querySelector(`[data-section=\"${sectionKey}\"]`);\n    if (!sectionElement) {\n      return false;\n    }\n\n    //  SPRVN EEN: Scroll na lut roh + vka titulku\n    try {\n      // CLOVKA: Zobrazit lut roh sekce + titulek nad nm\n      // Struktura sekce:\n      // - FormSection (obsahuje data-section atribut) <- sectionElement\n      //   - SectionHeader (lut pozad s titulkem) <- tohle chceme vidt cel\n      //   - SectionBody (obsah)\n      //\n      // scrollIntoView() na FormSection by zobrazil jen zatek FormSection\n      // Potebujeme scrollovat o vku SectionHeader v\n\n      // Najdi SectionHeader uvnit sekce\n      const sectionHeader = sectionElement.querySelector('[class*=\"SectionHeader\"]') ||\n                           sectionElement.querySelector('div:first-child');\n\n      const targetElement = sectionHeader || sectionElement;\n\n      // Vypotej pozici elementu relativn k scroll containeru\n      const elementTop = targetElement.offsetTop;\n\n      //  Dynamick offset: peti CSS variable --fixed-header-height (vka headeru + 20px gap)\n      const fixedHeaderHeight = parseInt(\n        getComputedStyle(document.documentElement).getPropertyValue('--fixed-header-height') || '200'\n      );\n\n      // Odeti dynamickou vku headeru pro sprvn zobrazen pod FixedHeader\n      const targetScrollTop = elementTop - fixedHeaderHeight;\n\n      // Smooth scroll\n      if (behavior === 'smooth') {\n        scrollContainer.scrollTo({\n          top: targetScrollTop,\n          behavior: 'smooth'\n        });\n      } else {\n        scrollContainer.scrollTop = targetScrollTop;\n      }\n\n      return true;\n    } catch (error) {\n      return false;\n    }\n  }, [\n    allSectionStates, //  NOV: jedin zvislost - obsahuje vechny section states vetn unlock\n    canEditApprovedSections,\n    workflowManager,\n    showToast\n  ]);\n\n  //  Handler pro kliknut na sekci v FloatingNavigator\n  const handleNavigatorSectionClick = useCallback((sectionId) => {\n    //  VCN SPRVNOST: Scrolluj na FAKTURACE (vcn sprvnost je per-invoice v rmci faktur)\n    const targetSection = sectionId === 'vecna_spravnost' ? 'fakturace' : sectionId;\n    scrollToSection(targetSection, 'smooth');\n  }, [scrollToSection]);\n\n  //  Handler pro drop soubor z FloatingNavigator\n  const handleNavigatorFilesDrop = useCallback((files) => {\n    if (files && files.length > 0) {\n      handleFileUpload(files);\n      showToast && showToast(` Nahrvm ${files.length} soubor()...`, { type: 'info' });\n    }\n  }, [handleFileUpload, showToast]);\n\n  const handleReloadFromDB = useCallback(async () => {\n    if (!formData.id) {\n      showToast && showToast('Nelze nast stav z databze - objednvka nen uloena', { type: 'error' });\n      return;\n    }\n\n    if (!userDetail?.id) {\n      showToast && showToast('Nelze nast stav z databze - nen pihlen uivatel', { type: 'error' });\n      return;\n    }\n\n    try {\n      addDebugLog('info', 'STATUS-RELOAD', 'start', `Natm aktuln stav objednvky ID: ${formData.id}, uivatel: ${userDetail.id}`);\n\n      //  V2 API: GET order by ID (enriched=false pro rychlej reload)\n      const orderData = await getOrderV2(parseInt(formData.id), token, username, false);\n\n      if (!orderData || !orderData.id) {\n        throw new Error('Nepodailo se nast stav objednvky z databze');\n      }\n\n      addDebugLog('success', 'STATUS-RELOAD', 'loaded', `Naten aktuln stav: stav_objednavky=\"${orderData.stav_objednavky}\", stav_workflow_kod=\"${orderData.stav_workflow_kod}\"`);\n\n      // Aktualizuj POUZE workflow stavy v formData\n      setFormData(prev => ({\n        ...prev,\n        stav_workflow_kod: orderData.stav_workflow_kod,\n        stav_objednavky: orderData.stav_objednavky\n      }));\n\n      // Uloit aktualizovan stav do konceptu\n      const updatedFormData = {\n        ...formData,\n        stav_workflow_kod: orderData.stav_workflow_kod,\n        stav_objednavky: orderData.stav_objednavky\n      };\n\n      saveDraft(updatedFormData, {\n        isOrderSavedToDB: true,\n        savedOrderId: formData.id,\n        isChanged: isChanged\n      });\n\n      // Toast odstrann - zbyten um, stav se aktualizuje automaticky\n\n      addDebugLog('success', 'STATUS-RELOAD', 'complete', 'Stav aktualizovn a uloen do konceptu');\n\n    } catch (error) {\n      addDebugLog('error', 'STATUS-RELOAD', 'failed', error.message);\n      showToast && showToast(`Chyba pi natn stavu z databze: ${error.message}`, { type: 'error' });\n    }\n  }, [formData, userDetail, token, username, showToast, isChanged]);\n\n  //  Helper pro kontrolu, zda je mon generovat DOCX\n  const canGenerateDocx = useCallback(() => {\n    // Kontrola: objednvka mus bt uloena v DB\n    if (!formData.id) {\n      return false;\n    }\n\n    // Kontrola: minimln fze 3 (schvlen + rozpracovan nebo vy)\n    if (currentPhase < 3) {\n      return false;\n    }\n\n    // Kontrola: stav workflow mus bt alespo \"ROZPRACOVANA\" nebo vy\n    // Pouij workflowManager.hasWorkflowState() pro sprvnou kontrolu\n    const hasRozpracovana = hasWorkflowState(formData.stav_workflow_kod, 'ROZPRACOVANA');\n    const hasOdeslana = hasWorkflowState(formData.stav_workflow_kod, 'ODESLANA');\n    const hasPotvrzena = hasWorkflowState(formData.stav_workflow_kod, 'POTVRZENA');\n    const hasSchvalena = hasWorkflowState(formData.stav_workflow_kod, 'SCHVALENA');\n\n    // Mus mt SCHVALENA A (ROZPRACOVANA nebo vy stav)\n    if (!hasSchvalena) {\n      return false;\n    }\n\n    if (!hasRozpracovana && !hasOdeslana && !hasPotvrzena) {\n      return false;\n    }\n\n    return true;\n  }, [formData.id, formData.stav_workflow_kod, currentPhase, hasWorkflowState, mainWorkflowState]);\n\n  //  Handler pro generovn DOCX dokumentu\n  const handleGenerateDocx = useCallback(() => {\n    if (!canGenerateDocx()) {\n      // Zobraz specifickou chybu podle toho, co chyb\n      if (!formData.id) {\n        showToast && showToast('DOCX lze generovat pouze u uloench objednvek', { type: 'warning' });\n      } else if (currentPhase < 3) {\n        showToast && showToast('DOCX lze generovat a od fze \"Odesln objednvky\"', { type: 'warning' });\n      } else {\n        showToast && showToast('DOCX lze generovat a kdy je objednvka v procesu zpracovn', { type: 'warning' });\n      }\n      return;\n    }\n\n    try {\n      addDebugLog('info', 'DOCX-GENERATOR', 'open-dialog', `Otevrm DOCX genertor pro objednvku ID: ${formData.id}`);\n\n      // Vytvo order objekt kompatibiln s DocxGeneratorModal\n      const orderForDocx = {\n        objednavka_id: formData.id,\n        cislo_objednavky: formData.cislo_objednavky,\n        nazev_objednavky: formData.nazev_objednavky || formData.nazev,\n        ...formData\n      };\n\n      setDocxModalOrder(orderForDocx);\n      setDocxModalOpen(true);\n\n    } catch (error) {\n      addDebugLog('error', 'DOCX-GENERATOR', 'error', error.message);\n      showToast && showToast(`Chyba pi otevrn DOCX genertoru: ${error.message}`, { type: 'error' });\n    }\n  }, [formData, currentPhase, showToast]);\n\n  const handleDocxModalClose = useCallback(() => {\n    setDocxModalOpen(false);\n    setDocxModalOrder(null);\n  }, []);\n\n  const handleCancelOrder = useCallback(async () => {\n    //  Pokud je objednvka v KONENM STAVU (DOKONENA/ZAMTNUTA/STORNOVNA), zavi rovnou bez dotazu\n    // (u je uloen v DB, nen co ztratit)\n    if (isWorkflowCompleted) {\n      try {\n        //  KRITICK: OKAMIT ZABLOKOVAT VECHNY SAVE OPERACE \n        \n        // 0. GLOBLN FLAG - zablokuje saveDraft na rovni funkce (prvn linie obrany)\n        isClosingRef.current = true;\n        \n        // 1. Zablokovat autosave v DraftManager\n        draftManager.setAutosaveEnabled(false, 'Closing completed/rejected/cancelled order');\n        \n        // 2. Zablokovat autosave pes ref (okamit kontrola)\n        disableAutosaveRef.current = true;\n        \n        // 3. Zablokovat autosave pes state (pro useEffect)\n        setDisableAutosave(true);\n        \n        // 4. Zruit useAutosave hook timer\n        if (cancelAutosave) {\n          cancelAutosave();\n        }\n        \n        // 5. Zruit vechny setTimeout pro autosave\n        if (autoSaveTimerRef.current) {\n          clearTimeout(autoSaveTimerRef.current);\n          autoSaveTimerRef.current = null;\n        }\n\n        // Vyistit draft data\n        if (user_id) {\n          draftManager.setCurrentUser(user_id);\n          await draftManager.deleteAllDraftKeys();\n          \n          //  EXPLICITN vymazat metadata (isEditMode) - dleit pro MenuBar\n          try {\n            localStorage.removeItem(`order_form_isEditMode_${user_id}`);\n            localStorage.removeItem(`openOrderInConcept-${user_id}`);\n            localStorage.removeItem(`order_form_savedOrderId_${user_id}`);\n            localStorage.removeItem(`savedOrderId-${user_id}`);\n          } catch (e) {\n            // ignoruj chybu\n          }\n        }\n        \n        // NOTE: formData.id and sourceOrderIdForUnlock removed - using formData.id\n\n        // Odemkni objednvku (pokud je editace) - pouij editOrderId nebo formData.id\n        //  FIX: editOrderId je stabilnj ne formData.id (me bt undefined po smazn draftu)\n        const unlockOrderId = editOrderId || formData.id;\n        \n        if (unlockOrderId && token && username) {\n          try {\n            await unlockOrderV2({ token, username, orderId: unlockOrderId });\n            //  KRITICK: Zabrnit duplicitnmu unlock z useEffect cleanup (ji neexistuje)\n          } catch (error) {\n            console.warn(' UNLOCK OrderForm25: FAILED - obj #' + unlockOrderId, error.message);\n            // Ignoruj chybu odemykn\n          }\n        }\n\n        // Reset MenuBaru\n        try {\n          //  KRITICK: Nastavit isEditMode state na false PED broadcastem\n          setIsEditMode(false);\n          \n          broadcastDraftDeleted(user_id);\n          broadcastOrderState({\n            isEditMode: false,\n            isNewOrder: false,\n            orderId: null,\n            orderNumber: ''\n          });\n          \n          //  KRITICK: Pokat 50ms, aby se broadcast stihl propagovat\n          await new Promise(resolve => setTimeout(resolve, 50));\n        } catch (e) {\n          // Ignoruj chybu broadcastu\n        }\n\n        // Pesmruj na seznam s force reload z DB\n        navigate('/orders25-list', { state: { forceReload: true } });\n      } catch (error) {\n        showToast && showToast(`Chyba pi zavrn: ${error.message}`, { type: 'error' });\n      }\n      return;\n    }\n\n    // Zkontroluj neuloen a neklasifikovan plohy\n    const unsavedAttachments = attachments.filter(att =>\n      !att.serverId && att.status !== 'uploaded' && !att.fromServer && att.file\n    );\n    const unclassifiedAttachments = attachments.filter(att =>\n      !att.klasifikace || att.klasifikace.trim() === ''\n    );\n\n    let warningMessage = 'Koncept bude zruen a neuloen zmny nebudou uloeny.';\n\n    if (unsavedAttachments.length > 0 || unclassifiedAttachments.length > 0) {\n      warningMessage += `\\n\\n Informace o plohch:\\n ${unsavedAttachments.length} neuloench ploh\\n ${unclassifiedAttachments.length} neklasifikovanch ploh`;\n    }\n\n    // Zobraz confirm modal msto toast\n    setCancelWarningMessage(warningMessage);\n    setShowCancelConfirmModal(true);\n  }, [attachments, isWorkflowCompleted, user_id, formData.id, token, username, showToast, navigate]);\n\n  const handleCancelConfirm = useCallback(async () => {\n    //  ZJEDNODUEN ZAVEN pes DraftManager\n    addDebugLog('info', 'CANCEL', 'draftmanager-close', 'Zavrm formul pes DraftManager');\n\n    try {\n      //  KRITICK: OKAMIT ZABLOKOVAT VECHNY SAVE OPERACE \n      \n      // 0. GLOBLN FLAG - zablokuje saveDraft na rovni funkce (prvn linie obrany)\n      isClosingRef.current = true;\n      \n      // 1. Zablokovat autosave v DraftManager\n      draftManager.setAutosaveEnabled(false, 'Form closing - prevent save during cleanup');\n      \n      // 2. Zablokovat autosave pes ref (okamit kontrola)\n      disableAutosaveRef.current = true;\n      \n      // 3. Zablokovat autosave pes state (pro useEffect)\n      setDisableAutosave(true);\n      \n      // 4. Zruit useAutosave hook timer\n      if (cancelAutosave) {\n        cancelAutosave();\n      }\n      \n      // 5. Zruit vechny setTimeout pro autosave\n      if (autoSaveTimerRef.current) {\n        clearTimeout(autoSaveTimerRef.current);\n        autoSaveTimerRef.current = null;\n      }\n\n      //  OKAMIT resetovat vechny saving stavy\n      setIsSaving(false);\n      setShowSaveProgress(false);\n      setSaveProgressText('');\n      setSaveProgress(0);\n      setIsConceptSaved(false);\n\n      //  Zruit aktivn progress (pokud b)\n      if (window._activeProgressControl) {\n        window._activeProgressControl.cancel();\n        window._activeProgressControl = null;\n      }\n\n      // NOTE: unlockOrderIdRef removed\n      // NOTE: formData.id and sourceOrderIdForUnlock removed - using formData.id\n\n      //  1. Vyistit VECHNY draft data pes DraftManager (centralizovan)\n      if (user_id) {\n        draftManager.setCurrentUser(user_id);\n        const deleted = await draftManager.deleteAllDraftKeys();\n\n        if (deleted) {\n          addDebugLog('success', 'CANCEL', 'draftmanager-cleanup', 'Vechny draft kle smazny pes DraftManager');\n        } else {\n        }\n\n        //  VERIFIKACE: Zkontroluj e draft opravdu neexistuje\n        const stillHasDraft = await draftManager.hasDraft();\n        if (stillHasDraft) {\n          // Zkus znovu smazat\n          await draftManager.deleteAllDraftKeys();\n        } else {\n        }\n        \n        //  EXPLICITN vymazat metadata (isEditMode) - dleit pro MenuBar\n        try {\n          localStorage.removeItem(`order_form_isEditMode_${user_id}`);\n          localStorage.removeItem(`openOrderInConcept-${user_id}`);\n          localStorage.removeItem(`order_form_savedOrderId_${user_id}`);\n          localStorage.removeItem(`savedOrderId-${user_id}`);\n        } catch (e) {\n          // ignoruj chybu\n        }\n      }\n\n      // 2. Odemkni objednvku (pokud je editace) - graceful handling\n      //  FIX: Pout editOrderId msto formData.id (po smazn draftu me bt formData przdn)\n      const unlockOrderId = editOrderId || formData.id;\n      \n      if (unlockOrderId && token && username) {\n        try {\n          console.log(' UNLOCK OrderForm25: Odemykm obj #' + unlockOrderId + ' (zaven formule)');\n          await unlockOrderV2({ token, username, orderId: unlockOrderId });\n          console.log(' UNLOCK OrderForm25: OK - obj #' + unlockOrderId);\n          addDebugLog('success', 'CANCEL', 'unlock', `Objednvka ${unlockOrderId} byla odemknuta`);\n        } catch (error) {\n          console.warn(' UNLOCK OrderForm25: FAILED - obj #' + unlockOrderId, error.message);\n          addDebugLog('warning', 'CANCEL', 'unlock-error', `Chyba pi odemykn: ${error.message} - ignorovno`);\n          // Ignoruj chybu - formul se zave i kdy odemykn sele\n        }\n      }\n\n      // 3. Reset MenuBaru\n      try {\n        //  KRITICK: Nastavit isEditMode state na false PED broadcastem\n        setIsEditMode(false);\n        \n        broadcastDraftDeleted(user_id);\n\n        // Pokej krtce, aby se broadcast stihl zpracovat\n        await new Promise(resolve => setTimeout(resolve, 50));\n\n        broadcastOrderState({\n          isEditMode: false,\n          isNewOrder: false,\n          orderId: null,\n          orderNumber: ''\n        });\n\n        addDebugLog('success', 'CANCEL', 'broadcast', 'Broadcast stavu odesln (formul zaven)');\n      } catch (e) {\n        addDebugLog('warning', 'CANCEL', 'broadcast-error', `Chyba pi broadcastu: ${e.message}`);\n      }\n\n      // 4. Zavi modal\n      setShowCancelConfirmModal(false);\n      setCancelWarningMessage('');\n\n      addDebugLog('info', 'CANCEL', 'redirect', 'Pesmrovvm na seznam objednvek');\n\n      // 5. Pesmruj s dostatenm zpodnm, aby se stihly dokonit vechny async operace\n      setTimeout(() => {\n        navigate('/orders25-list', { state: { forceReload: true } });\n      }, 200);\n\n    } catch (error) {\n      addDebugLog('error', 'CANCEL', 'error', `Chyba pi zavrn: ${error.message}`);\n      showToast && showToast(`Chyba pi zavrn: ${error.message}`, { type: 'error' });\n\n      // I pi chyb resetuj stavy a pesmruj\n      setIsSaving(false);\n      setShowSaveProgress(false);\n      setShowCancelConfirmModal(false);\n      setCancelWarningMessage('');\n\n      // Pesmruj i pes chybu (lep ne zstat na formuli)\n      setTimeout(() => {\n        navigate('/orders25-list', { state: { forceReload: true } });\n      }, 100);\n    }\n  }, [user_id, draftManager, formData.id, token, username, showToast, navigate]);\n\n  const handleCancelCancel = useCallback(() => {\n    setShowCancelConfirmModal(false);\n    setCancelWarningMessage('');\n  }, []);\n\n  // Funkce pro odemykn FZE 1 sekc - IST FUNKCE BEZ TOAST\n  //  Handler pro odemen FZE 1 - nyn pouv workflowManager.unlockPhase2()\n  //  SJEDNOCENO s handleResetToPhase3Sections (unlock z PO sekce)\n  const handleResetToPhase1 = async () => {\n    //  Pouij centralizovanou logiku z WorkflowManager\n    const { updatedFormData, unlockState, newPhase } = workflowManager.unlockPhase2();\n\n    // Aktualizuj formData state okamit\n    setFormData(updatedFormData);\n\n    //  WorkflowManager se automaticky pepot dky zmn formData.stav_workflow_kod\n\n    // Okamit uloen do localStorage pes triggerAutosave\n    setTimeout(() => {\n      triggerAutosave(true);\n      addDebugLog('success', 'UNLOCK', unlockState, `FZE ${newPhase} odemena, workflow: ${updatedFormData.stav_workflow_kod}`);\n    }, 100);\n  };\n\n  const [pendingUnlock, setPendingUnlock] = useState(false);\n\n  // useEffect pro automatick uloen po odemen FZE 2\n  useEffect(() => {\n    //  GUARD: Nespoutt pokud u probh jin ukldn (nap. z saveOrderToAPI)\n    if (pendingUnlock && isPhase3SectionsUnlocked && !isSaving) {\n      const doSave = async () => {\n        try {\n          //  TICH ULOEN - bez progress baru a pesmrovn\n          setIsSaving(true);\n\n          // Piprav data pro UPDATE (stejn logika jako saveOrderToAPI)\n          const orderData = {};\n          if (formData.predmet) orderData.predmet = formData.predmet;\n          if (formData.garant_uzivatel_id) orderData.garant_uzivatel_id = formData.garant_uzivatel_id;\n\n          // Workflow stav (bez ODESLANA/ZRUSENA)\n          const existingStates = parseWorkflowStates(formData.stav_workflow_kod);\n          const cleanStates = existingStates.filter(s => s !== 'ODESLANA' && s !== 'ZRUSENA');\n          orderData.stav_workflow_kod = JSON.stringify(cleanStates);\n\n          // Storno checkboxy - false\n          orderData.stav_odeslano = false;\n          orderData.stav_stornovano = false;\n\n          // Zavolej API pmo (bez progress baru) - V2 API\n          //  prepareDataForAPI() se vol automaticky uvnit updateOrderV2() - NEMNIT ZNOVU!\n          // const preparedData = prepareDataForAPI(orderData);   DUPLICITN - ji se dl v updateOrderV2()\n          await updateOrderV2(formData.id, orderData, token, username);\n\n        } catch (error) {\n          showToast && showToast(`Chyba pi ukldn: ${error.message}`, { type: 'error' });\n        } finally {\n          setPendingUnlock(false);\n          setIsSaving(false);\n        }\n      };\n      doSave();\n    }\n  }, [pendingUnlock, isPhase3SectionsUnlocked, isSaving]); // Pidna zvislost isSaving\n\n  //  Univerzln helper pro reset vych fz pi odemen ni sekce\n  const resetHigherPhaseCheckboxes = (sectionName) => {\n    addDebugLog('info', 'UNLOCK', sectionName, 'Odemen ni sekce  automaticky rum checkboxy vych fz');\n\n    // Zruit checkbox Vcn sprvnosti\n    handleInputChange('potvrzeni_vecne_spravnosti', 0);\n\n    // Zruit checkbox Dokonen objednvky\n    handleInputChange('potvrzeni_dokonceni_objednavky', 0);\n\n    // Force re-render pro aktualizaci viditelnosti sekc\n    workflowForceRefresh();\n\n    //  OKAMIT ULOEN: Trigger autosave pro aktualizaci stavu\n    setTimeout(() => triggerAutosave(true), 100);\n  };\n\n  //  Funkce pro odemykn FZE 2 sekc - DELEGOVNO na WorkflowManager\n  const handleResetToPhase3Sections = async () => {\n    //  PMO ODEMKNI - confirm dialog je vnj (showUnlockPhase2Confirm)\n    //  DELEGACE NA WORKFLOWMANAGER\n    const { updatedFormData, unlockState, newPhase } = workflowManager.unlockPhase2();\n\n    // Aktualizuj formData state okamit\n    setFormData(updatedFormData);\n\n    //  FZE 2 se odemyk zmnou workflow na ODESLANA_KE_SCHVALENI\n\n    //  WorkflowManager se automaticky pepot dky zmn formData.stav_workflow_kod\n\n    // Okamit uloen do localStorage pes triggerAutosave\n    setTimeout(() => {\n      triggerAutosave(true);\n      addDebugLog('success', 'UNLOCK', unlockState, `FZE ${newPhase} odemena, workflow: ${updatedFormData.stav_workflow_kod}`);\n    }, 100);\n  };\n\n  //  Handler pro odemknut FZE 3 (Dodavatel a Stav odesln) - DELEGOVNO na WorkflowManager\n  //  POZNMKA: Financovn je soust FZE 1-2, ne FZE 3!\n  const handleResetToPhase3Workflow = async () => {\n    //  DELEGACE NA WORKFLOWMANAGER\n    const { updatedFormData, unlockState, newPhase } = workflowManager.unlockPhase3();\n\n    //  KRITICK: Nastav unlock state pro FZI 3 PED zmnou formData!\n    setIsPhase3SectionsUnlocked(true);\n\n    // Aktualizuj formData state s malm zpodnm pro zajitn sprvnho poad\n    setTimeout(() => {\n      setFormData(updatedFormData);\n\n      // Reset vych checkbox\n      resetHigherPhaseCheckboxes('phase3');\n\n      // Okamit uloen do DB pes triggerAutosave\n      setTimeout(() => {\n        triggerAutosave(true);\n        addDebugLog('success', 'UNLOCK', unlockState, `FZE ${newPhase} odemena, workflow: ${updatedFormData.stav_workflow_kod}`);\n      }, 100);\n    }, 10);\n  };\n\n  //  Handler pro odemknut FZE 4 (Potvrzen dodavatele) - DELEGOVNO na WorkflowManager\n  const handleResetToPhase4Confirmation = async () => {\n    // Kontrola jestli je uivatel SUPER/ADMIN nebo m prva\n    if (!canUnlockAnything && currentPhase > 4) {\n      showToast && showToast('Bn uivatel me odemknout pouze posledn fzi!', { type: 'error' });\n      return;\n    }\n\n    //  Zobraz ConfirmDialog msto Toast\n    setConfirmDialog({\n      isOpen: true,\n      title: \"Odemknout sekci Potvrzen dodavatele\",\n      message: \" Odemen sekce umon editaci, ale objednvka je ji POTVRZENA!\\n\\nOpravdu chcete pokraovat?\",\n      onConfirm: async () => {\n        //  DELEGACE NA WORKFLOWMANAGER\n        const { updatedFormData, unlockState, newPhase } = workflowManager.unlockPhase4();\n\n        //  KRITICK: Nastav unlock state pro potvrzen PED zmnou formData!\n        workflowManager.unlockSection('potvrzeni');\n        workflowManager.unlockSection('registr');\n\n        // Aktualizuj formData state s malm zpodnm pro zajitn sprvnho poad\n        setTimeout(() => {\n          setFormData(updatedFormData);\n\n          //  Reset vych checkbox\n          resetHigherPhaseCheckboxes('phase4');\n\n          // Okamit uloen do localStorage pes triggerAutosave\n          setTimeout(() => {\n            triggerAutosave(true);\n            addDebugLog('success', 'UNLOCK', unlockState, `FZE ${newPhase} odemena, workflow: ${updatedFormData.stav_workflow_kod}`);\n          }, 100);\n        }, 10);\n\n        // Zavi ConfirmDialog\n        setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null });\n      }\n    });\n  };\n\n  // Funkce pro validaci jednoho pole\n  const validateField = (fieldName, value) => {\n    // Pouij aktuln formData s novou hodnotou pro validaci\n    const tempFormData = { ...formData, [fieldName]: value };\n    // KRITICK: Validovat podle aktuln VIDITELN fze i pro jednotliv pole\n    const validationWorkflowCode = currentPhase === 1 ? 'NOVA' : mainWorkflowState;\n    const allErrors = validateWorkflowData(tempFormData, validationWorkflowCode);\n\n    // Aktualizuj pouze chybu pro toto pole\n    setValidationErrors(prev => {\n      const newErrors = { ...prev };\n      if (allErrors[fieldName]) {\n        newErrors[fieldName] = allErrors[fieldName];\n      } else {\n        delete newErrors[fieldName];\n      }\n      return newErrors;\n    });\n  };\n\n  // Funkce pro validace formule s novm workflow systmem\n  // VALIDACE SE SPOUT JEN PI POKUSU O ULOEN DO DATABZE\n  const validateFormForSave = () => {\n    //  SPECILN PRAVIDLA: Archivovan objednvky - BEZ VALIDACE\n    // Umonit partial update bez kontroly povinnch pol\n    if (isArchivedOrder) {\n      setValidationErrors({});\n      return true; //  Vdy platn\n    }\n\n    //  OPRAVA: Nastavit hasTriedToSubmit synchronn pomoc flushSync\n    // aby se erven ormovn zobrazilo IHNED pi prvnm pokusu\n    flushSync(() => {\n      setHasTriedToSubmit(true);\n    });\n\n    let errors = {};\n\n    // SPECILN LOGIKA: Pi stornovn validovat pouze storno pole\n    if (formData.stav_stornovano) {\n      // Pro stornovan objednvky validovat pouze dvod stornovn\n      if (!formData.odeslani_storno_duvod?.trim()) {\n        errors.odeslani_storno_duvod = 'Dvod stornovn je povinn';\n      }\n    } else {\n      // Normln validace pro nestornovan objednvky\n      // KRITICK: Validovat podle aktuln VIDITELN fze, ne podle stav_workflow_kod!\n      // Pokud jsme v FZI 1, validovat jen FZI 1, i kdy je zakrtnuto \"schvleno\"\n      const validationWorkflowCode = currentPhase === 1 ? 'NOVA' : mainWorkflowState;\n\n      //  Piprav informaci o viditelnosti a zamen sekc\n      const sectionStates = {\n        phase1: { visible: currentPhase >= 1, locked: shouldLockPhase1Sections },\n        phase2: { visible: currentPhase >= 2, locked: shouldLockPhase2Sections },\n        financovani: { visible: financovaniState.visible, locked: !financovaniState.enabled }, // Samostatn sekce pro financovn\n        phase3: { visible: currentPhase >= 3, locked: shouldLockPhase3Sections },\n        phase4to6: { visible: currentPhase >= 4, locked: shouldLockPhase4to6Sections },\n        registr_smluv_vyplneni: { visible: registrVyplneniState.visible, locked: isRegistrVyplneniLocked } // FZE 5: Zveejnn\n      };\n\n      //  FIX: Merge errors msto pepsn - jinak ztratme FZE 5 validaci!\n      const workflowErrors = validateWorkflowData(formData, validationWorkflowCode, sectionStates);\n      errors = { ...errors, ...workflowErrors };\n\n      //  VALIDACE DYNAMICKCH POL PODLE ZDROJE FINANCOVN\n      //  Kontrola povinnch dynamickch pol od FZE 1+ (pokud je financovn vyplnno)\n      //  Validovat POUZE pokud je sekce financovn viditeln A odemen\n      const shouldValidateFinancovani = sectionStates.financovani.visible && !sectionStates.financovani.locked;\n      if (currentPhase >= 1 && formData.zpusob_financovani && shouldValidateFinancovani) {\n        const selectedFinancovani = financovaniOptions.find(opt =>\n          opt.kod === formData.zpusob_financovani ||\n          opt.kod_stavu === formData.zpusob_financovani ||\n          opt.value === formData.zpusob_financovani\n        );\n\n        if (selectedFinancovani) {\n          const nazev = selectedFinancovani.nazev_stavu || selectedFinancovani.nazev || '';\n\n          // Limitovan pslib - LP kd je POVINN\n          if (nazev.includes('Limitovan') || nazev.includes('pslib')) {\n            if (!formData.lp_kod ||\n                (Array.isArray(formData.lp_kod) && formData.lp_kod.length === 0)) {\n              errors.lp_kod = \"LP kd je povinn pi financovn z Limitovanho pslibu\";\n            }\n            \n            //  VALIDACE LP U POLOEK: Pokud je financovn LP, vechny poloky MUS mt vyplnn LP\n            //  VALIDOVAT POUZE VE FZI 3+ (poloky jsou dostupn a od fze 3)\n            if (currentPhase >= 3 && formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n              formData.polozky_objednavky.forEach((polozka, index) => {\n                if (!polozka.polozka_lp_id && !polozka.lp_id) {\n                  errors[`polozka_${index}_lp`] = `Poloka ${index + 1}: LP je povinn pi financovn z Limitovanho pslibu`;\n                }\n              });\n            }\n          }\n\n          // Smlouva - slo smlouvy je POVINN a mus existovat v seznamu aktivnch smluv\n          if (nazev.includes('Smlouva')) {\n            if (!formData.cislo_smlouvy?.trim()) {\n              errors.cislo_smlouvy = 'slo smlouvy je povinn pi financovn ze Smlouvy';\n            } else {\n              //  PSN VALIDACE: Ovit, e slo smlouvy existuje v seznamu aktivnch smluv\n              const existujeSmlouva = smlouvyList.some(s => \n                (s.aktivni !== 0 && s.aktivni !== false) &&\n                (s.cislo_smlouvy === formData.cislo_smlouvy || s.evidencni_cislo === formData.cislo_smlouvy)\n              );\n              \n              if (!existujeSmlouva) {\n                errors.cislo_smlouvy = 'Zadan slo smlouvy neexistuje v seznamu aktivnch smluv. Vyberte prosm platnou smlouvu.';\n              }\n            }\n          }\n\n          // Individuln schvlen - Identifiktor je POVINN\n          if (nazev.includes('Individuln')) {\n            const individualniValue = typeof formData.individualni_schvaleni === 'string'\n              ? formData.individualni_schvaleni\n              : '';\n            if (!individualniValue.trim()) {\n              errors.individualni_schvaleni = 'Zadejte identifiktor - referenn slo nebo oznaen schvlen je povinn';\n            }\n          }\n\n          // Pojistn udlost - slo udlosti je POVINN\n          if (nazev.includes('Pojistn')) {\n            if (!formData.pojistna_udalost_cislo?.trim()) {\n              errors.pojistna_udalost_cislo = 'Zadejte slo pojistn udlosti - referenn slo kodn udlosti je povinn';\n            }\n          }\n        }\n      }\n\n      // SPECILN VALIDACE PRO FZI 4: Potvrzen dodavatele\n      //  VALIDOVAT POUZE VE FZI 4 (ODESLANA) - ve FZI 3 jet nemus bt vyplnno\n      if (currentPhase === 4 && formData.dodavatel_zpusob_potvrzeni?.potvrzeni === \"ANO\") {\n        // Zpsob potvrzen je povinn (alespo jeden zpsob mus bt v poli zpusoby)\n        const zpusobyPotvrzeni = formData.dodavatel_zpusob_potvrzeni;\n        const maZpusob = zpusobyPotvrzeni?.zpusoby && zpusobyPotvrzeni.zpusoby.length > 0;\n\n        if (!maZpusob) {\n          errors.dodavatel_zpusob_potvrzeni = 'Vyberte zpsob potvrzen (e-mail, telefon nebo psemn) - pi odpovdi \"ANO\" je povinn alespo jeden';\n        }\n\n        //  Zpsob platby - kontrola, e je nastavena hodnota (vdy \"faktura\")\n        // POZNMKA: Platba je v kdu pevn nastavena na \"faktura\" (readonly checkbox)\n        if (!zpusobyPotvrzeni?.platba || zpusobyPotvrzeni.platba.trim() === '') {\n          errors.zpusob_platby = 'Vyberte zpsob platby (faktura/pokladna) - pole je povinn pi potvrzen dodavatele';\n        }\n\n        //  Datum akceptace je VDY povinn (nezvisle na zpsobu potvrzen)\n        if (!formData.dt_akceptace?.trim()) {\n          errors.dt_akceptace = 'Zadejte datum akceptace - kdy dodavatel potvrdil objednvku';\n        }\n      }\n\n      // POZNMKA: IO, Nzev, Adresa dodavatele pat do bloku \"Dodavatel\" ve FZI 3\n      // Validuj se pes validateWorkflowData(), ne zde!\n\n      //  VALIDACE ZVEEJNN: Pesunuto do workflowUtils.js (validateWorkflowData)\n      // Validace dt_zverejneni a registr_iddt se provd automaticky pes workflow manager\n      // kdy je zakrtnuto ma_byt_zverejnena a sekce registr_smluv_vyplneni je viditeln a odemen\n\n      //  VALIDACE SEK, BUDOVA, MSTNOST U POLOEK: Pouze u majetkovch objednvek\n      //  VALIDOVAT POUZE VE FZI 3+ (lokalizan pole jsou dostupn a od fze 3)\n      const isMaterialOrderValue = isMaterialOrder;\n      \n      if (currentPhase >= 3 && isMaterialOrderValue && formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n        formData.polozky_objednavky.forEach((polozka, index) => {\n          if (!polozka.usek_kod || !polozka.usek_kod.trim()) {\n            errors[`polozka_${index}_usek_kod`] = `Poloka ${index + 1}: Vyberte sek - uren lokace je povinn u majetkovch poloek`;\n          }\n          if (!polozka.budova_kod || !polozka.budova_kod.trim()) {\n            errors[`polozka_${index}_budova_kod`] = `Poloka ${index + 1}: Vyberte budovu - uren lokace je povinn u majetkovch poloek`;\n          }\n          if (!polozka.mistnost_kod || !polozka.mistnost_kod.trim()) {\n            errors[`polozka_${index}_mistnost_kod`] = `Poloka ${index + 1}: Vyberte mstnost - uren lokace je povinn u majetkovch poloek`;\n          }\n        });\n      }\n\n      // VALIDACE FAKTUR - kontrola povinnch pol\n      //  POUZE validovat faktury ve FZI 6+ (kdy je sekce Fakturace viditeln)\n      //  NEvalidovat faktury kdy je vybran POKLADNA (faktury se v tom ppad nezobrazuj)\n      const isPlatbaPokladnaObj = formData.financovani?.platba === 'pokladna';\n      const isPlatbaPokladnaDodavatel = formData.dodavatel_zpusob_potvrzeni?.platba === 'pokladna';\n      const isPokladna = isPlatbaPokladnaObj || isPlatbaPokladnaDodavatel;\n\n      if (currentPhase >= 6 && !isPokladna && formData.faktury && formData.faktury.length > 0) {\n        formData.faktury.forEach((faktura, index) => {\n          const fakturaPrefix = `faktura_${index + 1}`;\n\n          // Variabiln symbol je povinn\n          if (!faktura.fa_cislo_vema || (typeof faktura.fa_cislo_vema === 'string' && faktura.fa_cislo_vema.trim() === '')) {\n            errors[`${fakturaPrefix}_cislo`] = `Faktura ${index + 1}: Zadejte variabiln symbol faktury`;\n          }\n\n          // stka je povinn a mus bt vt ne 0\n          if (!faktura.fa_castka || parseFloat(faktura.fa_castka) <= 0) {\n            errors[`${fakturaPrefix}_castka`] = `Faktura ${index + 1}: Zadejte stku faktury (mus bt vt ne 0 K)`;\n          }\n\n          // Datum doruen je povinn - kontroluj fa_datum_doruceni (ne fa_dorucena, to je boolean)\n          if (!faktura.fa_datum_doruceni || (typeof faktura.fa_datum_doruceni === 'string' && faktura.fa_datum_doruceni.trim() === '')) {\n            errors[`${fakturaPrefix}_dorucena`] = `Faktura ${index + 1}: Zadejte datum, kdy byla faktura doruena`;\n          }\n\n          // Datum splatnosti je povinn\n          if (!faktura.fa_splatnost || (typeof faktura.fa_splatnost === 'string' && faktura.fa_splatnost.trim() === '')) {\n            errors[`${fakturaPrefix}_splatnost`] = `Faktura ${index + 1}: Zadejte datum splatnosti faktury`;\n          }\n\n          //  Stediska faktury jsou VOLITELN a NEvaliduj se proti strediskaOptions\n          // Dvod: Stediska z faktury mohou bt jin ne stediska v naem systmu\n          // (mohou pijt od dodavatele s vlastnm slovnm)\n          // POZNMKA: Validace byla odstranna - stediska jsou ist informativn pole\n        });\n      }\n\n      //  FZE 7+: VALIDACE VCN SPRVNOSTI (per-invoice)\n      if (currentPhase >= 7 && !isPokladna && formData.faktury && formData.faktury.length > 0) {\n        const maxCena = parseFloat(formData.max_cena_s_dph) || 0;\n        \n        formData.faktury.forEach((faktura, index) => {\n          // Potvrzen vcn sprvnosti je POVINN ve FZI 7+\n          if (faktura.vecna_spravnost_potvrzeno !== 1 && faktura.vecna_spravnost_potvrzeno !== true) {\n            errors[`faktura_${index + 1}_vecna_spravnost`] = `Faktura ${index + 1}: Zakrtnte polko \"Potvrzuji vcnou sprvnost\" po kontrole faktury`;\n          }\n          \n          // Poznmka je POVINN pokud faktura pekrauje MAX cenu objednvky\n          const fakturaCastka = parseFloat(faktura.fa_castka) || 0;\n          if (fakturaCastka > maxCena && (!faktura.vecna_spravnost_poznamka || faktura.vecna_spravnost_poznamka.trim() === '')) {\n            errors[`faktura_${index + 1}_poznamka_vs`] = `Faktura ${index + 1}: Vysvtlete v poznmce, pro faktura pekrauje max. cenu objednvky (${maxCena.toFixed(2)} K)`;\n          }\n        });\n      }\n    }\n\n    const hasErrors = Object.keys(errors).length > 0;\n    \n    //  KRITICK: Pout flushSync k okamitmu nastaven validationErrors\n    // PED otevenm panel - jinak se panely otevou ale chyby jet nebudou v DOM\n    flushSync(() => {\n      setValidationErrors(errors);\n    });\n\n    //  AUTOMATICK OTEVEN LOKALIZANCH PANEL u poloek s chybami\n    // Pokud jsou chyby v lokanch polch (SEK, BUDOVA, MSTNOST), musme otevt panel,\n    // jinak se erven rmeky nezobraz (protoe pole jsou podmnn renderovna)\n    const locationErrorKeys = Object.keys(errors).filter(k => \n      k.includes('_usek_kod') || k.includes('_budova_kod') || k.includes('_mistnost_kod')\n    );\n    \n    if (locationErrorKeys.length > 0) {\n      // Najdi indexy poloek s chybami\n      const polozkyIndexesWithErrors = new Set();\n      locationErrorKeys.forEach(key => {\n        const match = key.match(/polozka_(\\d+)_/);\n        if (match) {\n          polozkyIndexesWithErrors.add(parseInt(match[1]));\n        }\n      });\n      \n      // Otevi panely pro tyto poloky - TAK pomoc flushSync\n      const newLokalizacePanelStates = { ...lokalizacePanelStates };\n      formData.polozky_objednavky?.forEach((polozka, index) => {\n        if (polozkyIndexesWithErrors.has(index)) {\n          newLokalizacePanelStates[polozka.id] = true;\n        }\n      });\n      \n      flushSync(() => {\n        setLokalizacePanelStates(newLokalizacePanelStates);\n      });\n    }\n\n    // Zobrazit toast s konkrtnmi chybami a scrollovat na prvn chybu\n    if (hasErrors) {\n      const errorCount = Object.keys(errors).length;\n      \n      if (formData.stav_stornovano) {\n        // Speciln zprva pro stornovn\n        showToast && showToast(`Nelze stornovat - zkontrolujte vyznaen pole`, { type: 'error' });\n      } else {\n        // Strukturovan chybov zprva\n        const structuredMessage = formatValidationErrors(errors);\n        \n        showToast && showToast(structuredMessage, { \n          type: 'error', \n          timeout: 10000\n        });\n      }\n\n      // Scroll na prvn chybov element s mrnm zpodnm\n      setTimeout(() => {\n        scrollToFirstError(errors);\n      }, 100);\n    }\n\n    return !hasErrors;\n  };\n\n  // Lehk validace pro zobrazen ervench pol (bez toast zprv)\n  const validateFormSilently = () => {\n    let errors = {};\n\n    // SPECILN LOGIKA: Pi stornovn validovat pouze storno pole\n    if (formData.stav_stornovano) {\n      if (!formData.odeslani_storno_duvod?.trim()) {\n        errors.odeslani_storno_duvod = 'Dvod stornovn je povinn';\n      }\n    } else {\n      //  Validace podle workflow - validuj ve VECH fzch\n      const validationWorkflowCode = currentPhase === 1 ? 'NOVA' : mainWorkflowState;\n\n      //  Piprav informaci o viditelnosti a zamen sekc\n      const sectionStates = {\n        phase1: { visible: currentPhase >= 1, locked: shouldLockPhase1Sections },\n        phase2: { visible: currentPhase >= 2, locked: shouldLockPhase2Sections },\n        financovani: { visible: financovaniState.visible, locked: !financovaniState.enabled }, // Samostatn sekce pro financovn\n        phase3: { visible: currentPhase >= 3, locked: shouldLockPhase3Sections },\n        phase4to6: { visible: currentPhase >= 4, locked: shouldLockPhase4to6Sections }\n      };\n\n      //  FIX: Merge errors msto pepsn - jinak ztratme FZE 5 validaci!\n      const workflowErrors = validateWorkflowData(formData, validationWorkflowCode, sectionStates);\n      errors = { ...errors, ...workflowErrors };\n\n      //  VALIDACE DYNAMICKCH POL PODLE ZDROJE FINANCOVN (tich validace)\n      //  Financovn je soust FZE 1-2 (validuje se hned od zatku!)\n      //  Validovat POUZE pokud je sekce financovn viditeln A odemen\n      const shouldValidateFinancovani = financovaniState.visible && financovaniState.enabled;\n      if (currentPhase >= 1 && formData.zpusob_financovani && shouldValidateFinancovani) {\n        const selectedFinancovani = financovaniOptions.find(opt =>\n          opt.kod === formData.zpusob_financovani ||\n          opt.kod_stavu === formData.zpusob_financovani ||\n          opt.value === formData.zpusob_financovani\n        );\n\n        if (selectedFinancovani) {\n          const nazev = selectedFinancovani.nazev_stavu || selectedFinancovani.nazev || '';\n\n          // Limitovan pslib - LP kd je POVINN\n          if (nazev.includes('Limitovan') || nazev.includes('pslib')) {\n            if (!formData.lp_kod ||\n                (Array.isArray(formData.lp_kod) && formData.lp_kod.length === 0)) {\n              errors.lp_kod = 'LP kd je povinn';\n            }\n            \n            //  VALIDACE LP U POLOEK: Pokud je financovn LP, vechny poloky MUS mt vyplnn LP\n            //  VALIDOVAT POUZE VE FZI 3+ (poloky jsou dostupn a od fze 3)\n            if (currentPhase >= 3 && formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n              formData.polozky_objednavky.forEach((polozka, index) => {\n                if (!polozka.polozka_lp_id && !polozka.lp_id) {\n                  errors[`polozka_${index}_lp`] = `Poloka ${index + 1}: LP je povinn`;\n                }\n              });\n            }\n          }\n\n          // Smlouva - slo smlouvy je POVINN a mus existovat v seznamu aktivnch smluv\n          if (nazev.includes('Smlouva')) {\n            if (!formData.cislo_smlouvy?.trim()) {\n              errors.cislo_smlouvy = 'slo smlouvy je povinn';\n            } else {\n              //  PSN VALIDACE: Ovit, e slo smlouvy existuje v seznamu aktivnch smluv\n              const existujeSmlouva = smlouvyList.some(s => \n                (s.aktivni !== 0 && s.aktivni !== false) &&\n                (s.cislo_smlouvy === formData.cislo_smlouvy || s.evidencni_cislo === formData.cislo_smlouvy)\n              );\n              \n              if (!existujeSmlouva) {\n                errors.cislo_smlouvy = 'Zadan slo smlouvy nen platn';\n              }\n            }\n          }\n\n          // Individuln schvlen - Identifiktor je POVINN\n          if (nazev.includes('Individuln')) {\n            if (!formData.individualni_schvaleni?.trim()) {\n              errors.individualni_schvaleni = 'Identifiktor je povinn';\n            }\n          }\n\n          // Pojistn udlost - slo udlosti je POVINN\n          if (nazev.includes('Pojistn')) {\n            if (!formData.pojistna_udalost_cislo?.trim()) {\n              errors.pojistna_udalost_cislo = 'slo pojistn udlosti je povinn';\n            }\n          }\n        }\n      }\n\n      //  VALIDACE SEK, BUDOVA, MSTNOST U POLOEK: Pouze u majetkovch objednvek\n      //  VALIDOVAT POUZE VE FZI 3+ (lokalizan pole jsou dostupn a od fze 3)\n      const isMaterialOrderValue = isMaterialOrder;\n      \n      if (currentPhase >= 3 && isMaterialOrderValue && formData.polozky_objednavky && formData.polozky_objednavky.length > 0) {\n        formData.polozky_objednavky.forEach((polozka, index) => {\n          if (!polozka.usek_kod || !polozka.usek_kod.trim()) {\n            errors[`polozka_${index}_usek_kod`] = `Poloka ${index + 1}: sek je povinn u majetkovch objednvek`;\n          }\n          if (!polozka.budova_kod || !polozka.budova_kod.trim()) {\n            errors[`polozka_${index}_budova_kod`] = `Poloka ${index + 1}: Budova je povinn u majetkovch objednvek`;\n          }\n          if (!polozka.mistnost_kod || !polozka.mistnost_kod.trim()) {\n            errors[`polozka_${index}_mistnost_kod`] = `Poloka ${index + 1}: Mstnost je povinn u majetkovch objednvek`;\n          }\n        });\n      }\n\n      // SPECILN VALIDACE PRO FZI 4: Potvrzen dodavatele\n      //  VALIDOVAT POUZE VE FZI 4 (ODESLANA) - ve FZI 3 jet nemus bt vyplnno\n      if (currentPhase === 4 && formData.dodavatel_zpusob_potvrzeni?.potvrzeni === \"ANO\") {\n        const zpusobyPotvrzeni = formData.dodavatel_zpusob_potvrzeni;\n        const maZpusob = zpusobyPotvrzeni?.zpusoby && zpusobyPotvrzeni.zpusoby.length > 0;\n\n        if (!maZpusob) {\n          errors.dodavatel_zpusob_potvrzeni = 'Pi potvrzen \"ANO\" mus bt vybrn alespo jeden zpsob potvrzen';\n        }\n\n        //  Zpsob platby - kontrola, e je nastavena hodnota (vdy \"faktura\")\n        // POZNMKA: Platba je v kdu pevn nastavena na \"faktura\" (readonly checkbox)\n        if (!zpusobyPotvrzeni?.platba || zpusobyPotvrzeni.platba.trim() === '') {\n          errors.zpusob_platby = 'Pi potvrzen dodavatele \"ANO\" je zpsob platby povinn';\n        }\n\n        //  Datum akceptace je VDY povinn (nezvisle na zpsobu potvrzen)\n        if (!formData.dt_akceptace?.trim()) {\n          errors.dt_akceptace = 'Pi potvrzen dodavatele \"ANO\" je datum akceptace povinn';\n        }\n      }\n\n      //  TICH VALIDACE REGISTRU SMLUV - pouze pro zobrazen ervench pol\n      //  POUZE validovat ve FZI 5 (Vyplnn registru smluv) - pokud m bt zveejnna\n      //  VALIDOVAT POUZE pokud m uivatel prvo ORDER_PUBLISH_REGISTRY (sekce mus bt viditeln)\n      if ((formData.ma_byt_zverejnena === true || formData.ma_byt_zverejnena === 1) && \n          currentPhase === 5 && \n          sectionStates.phase4to6?.visible && \n          !sectionStates.phase4to6?.locked) {\n        if (!formData.dt_zverejneni?.trim()) {\n          errors.dt_zverejneni = 'Datum zveejnn je povinn';\n        }\n        if (!formData.registr_iddt?.trim()) {\n          errors.registr_iddt = 'Identifiktor IDDT je povinn';\n        }\n      }\n\n      //  TICH VALIDACE FAKTUR - pouze pro zobrazen ervench pol\n      //  POUZE validovat faktury ve FZI 6+ (kdy je sekce Fakturace viditeln)\n      if (currentPhase >= 6 && formData.faktury && formData.faktury.length > 0) {\n        formData.faktury.forEach((faktura, index) => {\n          const fakturaPrefix = `faktura_${index + 1}`;\n\n          if (!faktura.fa_cislo_vema || (typeof faktura.fa_cislo_vema === 'string' && faktura.fa_cislo_vema.trim() === '')) {\n            errors[`${fakturaPrefix}_cislo`] = `Variabiln symbol je povinn`;\n          }\n\n          if (!faktura.fa_castka || parseFloat(faktura.fa_castka) <= 0) {\n            errors[`${fakturaPrefix}_castka`] = `stka je povinn`;\n          }\n\n          // Datum doruen - kontroluj fa_datum_doruceni (ne fa_dorucena, to je boolean)\n          if (!faktura.fa_datum_doruceni || (typeof faktura.fa_datum_doruceni === 'string' && faktura.fa_datum_doruceni.trim() === '')) {\n            errors[`${fakturaPrefix}_dorucena`] = `Datum doruen je povinn`;\n          }\n\n          if (!faktura.fa_splatnost || (typeof faktura.fa_splatnost === 'string' && faktura.fa_splatnost.trim() === '')) {\n            errors[`${fakturaPrefix}_splatnost`] = `Datum splatnosti je povinn`;\n          }\n        });\n      }\n    }\n\n    setValidationErrors(errors);\n    return Object.keys(errors).length === 0;\n  };\n\n  //  ZAKOMENTOVNO: Tento useEffect zpsobuje PEPSN validanch chyb!\n  // Problm: Po validateFormForSave() (kter vytvo vechny chyby vetn lokac),\n  // se tento useEffect spust a zavol validateFormSilently(), kter PEPE chyby\n  //  EEN: Live validace nen poteba - validujeme pouze pi kliknut na \"Uloit\"\n  /*\n  useEffect(() => {\n    // Spustit validaci pouze pokud u uivatel zkusil uloit\n    if (hasTriedToSubmit) {\n      validateFormSilently();\n    }\n    //  FIX: hasTriedToSubmit NEN v dependencies!\n    // Dvod: Nechceme spustit validaci pi zmn hasTriedToSubmit z falsetrue\n    // To by zpsobilo race condition s validateFormForSave()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    formData.dodavatel_zpusob_potvrzeni,\n    formData.dt_akceptace,\n    formData.dodavatel_ico,\n    formData.dodavatel_nazev,\n    formData.dodavatel_adresa,\n    formData.zpusob_financovani,\n    formData.lp_kod,\n    formData.cislo_smlouvy,\n    formData.individualni_schvaleni,\n    formData.pojistna_udalost_cislo,\n    formData.ma_byt_zverejnena,\n    formData.dt_zverejneni,\n    formData.registr_iddt\n  ]);\n  */\n\n  // Kontrola, zda je formul validn pro zkladn poadavky (pro sekci schvlen)\n  const isFormBasicallyValid = () => {\n    const errors = validateWorkflowData(formData, 'NOVA');\n    return Object.keys(errors).length === 0;\n  };\n\n  // Funkce pro kontrolu zkladnch pol (bez stavu schvlen)\n  // Ignoruje pole \"schvaleni_komentar\" - to se validuje a pi uloen\n  const areBasicFieldsValid = () => {\n    const errors = validateWorkflowData(formData, 'NOVA');\n    // Vyfiltrovat chybu schvaleni_komentar\n    const { schvaleni_komentar, ...otherErrors } = errors;\n    return Object.keys(otherErrors).length === 0;\n  };\n\n  // Funkce pro scroll na prvn chybov element\n  const scrollToFirstError = (errors) => {\n    if (!errors || Object.keys(errors).length === 0) return;\n\n    // Definice poad pol podle vizulnho poad ve formuli\n    const fieldOrder = [\n      'jmeno',\n      'email',\n      'garant_uzivatel_id',\n      'predmet',\n      'prikazce_id',\n      'max_cena_s_dph',\n      'strediska_kod',\n      'schvaleni_komentar',\n      'dodavatel_nazev',\n      'dodavatel_adresa',\n      'dodavatel_ico',\n      'druh_objednavky_kod',\n      'polozky_objednavky',\n      'zpusob_financovani',\n      'lp_kod',\n      'datum_odeslani',\n      'dodavatel_zpusob_potvrzeni',\n      'zpusob_platby',\n      'dt_akceptace',\n      'dt_zverejneni',        //  FZE 5: Datum zveejnn VZ\n      'registr_iddt'          //  FZE 5: Identifiktor IDDT\n    ];\n\n    // Najdi prvn chybov pole podle poad\n    for (const field of fieldOrder) {\n      if (errors[field]) {\n        // Mapovn field names na selektory\n        let element = null;\n        let parentSection = null;\n\n        switch (field) {\n          case 'jmeno':\n            element = document.querySelector('input[name=\"jmeno\"]');\n            break;\n          case 'email':\n            element = document.querySelector('input[type=\"email\"][name=\"email\"]');\n            break;\n          case 'garant_uzivatel_id':\n            element = document.querySelector('[data-field=\"garant\"]');\n            break;\n          case 'predmet':\n            element = document.querySelector('input[name=\"predmet\"]');\n            break;\n          case 'prikazce_id':\n            element = document.querySelector('[data-field=\"prikazce\"]');\n            break;\n          case 'max_cena_s_dph':\n            element = document.querySelector('input[name=\"max_cena_s_dph\"]');\n            break;\n          case 'strediska_kod':\n            element = document.querySelector('[data-field=\"strediska\"]');\n            break;\n          case 'schvaleni_komentar':\n            element = document.querySelector('textarea[name=\"schvaleni_komentar\"]');\n            break;\n          case 'dodavatel_nazev':\n            element = document.querySelector('input[name=\"dodavatel_nazev\"]');\n            break;\n          case 'dodavatel_adresa':\n            element = document.querySelector('input[name=\"dodavatel_adresa\"]');\n            break;\n          case 'dodavatel_ico':\n            element = document.querySelector('input[name=\"dodavatel_ico\"]');\n            break;\n          case 'druh_objednavky_kod':\n            element = document.querySelector('[data-field=\"druh_objednavky_kod\"]');\n            break;\n          case 'polozky_objednavky':\n            // Najdi prvn nevalidn poloku\n            const polozkyKeys = Object.keys(errors).filter(k => k.startsWith('polozka_'));\n            if (polozkyKeys.length > 0) {\n              const firstPolozkaError = polozkyKeys[0];\n              const index = parseInt(firstPolozkaError.split('_')[1]);\n              element = document.querySelector(`[data-polozka-index=\"${index}\"]`);\n              if (!element) {\n                // Fallback - najdi sekci s polokami\n                element = document.querySelector('[data-section=\"detaily\"]');\n              }\n            }\n            break;\n          case 'zpusob_financovani':\n            element = document.querySelector('[data-field=\"zpusob_financovani\"]');\n            break;\n          case 'lp_kod':\n            element = document.querySelector('[data-field=\"lp_kod\"]');\n            break;\n          case 'datum_odeslani':\n            element = document.querySelector('input[name=\"datum_odeslani\"]');\n            break;\n          case 'dodavatel_zpusob_potvrzeni':\n            element = document.querySelector('[name=\"dodavatel_zpusob_potvrzeni\"]');\n            break;\n          case 'zpusob_platby':\n            element = document.querySelector('[name=\"zpusob_platby\"]');\n            break;\n          case 'dt_akceptace':\n            element = document.querySelector('input[name=\"dt_akceptace\"]');\n            break;\n          case 'dt_zverejneni':\n            // DatePicker nem input s name, ale m fieldName prop - najdi button\n            element = document.querySelector('[data-field=\"dt_zverejneni\"]') ||\n                      document.querySelector('button[data-datepicker=\"dt_zverejneni\"]');\n            break;\n          case 'registr_iddt':\n            element = document.querySelector('input[name=\"registr_iddt\"]');\n            break;\n          default:\n            // Fallback - hledej podle nzvu pole\n            element = document.querySelector(`[name=\"${field}\"], [data-field=\"${field}\"]`);\n        }\n\n        if (element) {\n          // Najdi parent sekci a rozbal ji, pokud je sbalen\n          parentSection = element.closest('[data-section]');\n          if (parentSection) {\n            const sectionName = parentSection.getAttribute('data-section');\n            if (sectionName && sectionStates[sectionName]) {\n              // Sekce je sbalen, rozbal ji\n              setSectionStates(prev => ({ ...prev, [sectionName]: false }));\n\n              // Pokej na rozbalen a pak scrolluj\n              setTimeout(() => {\n                element.scrollIntoView({\n                  behavior: 'smooth',\n                  block: 'center',\n                  inline: 'nearest'\n                });\n\n                // Pokus o focus s mrnm zpodnm\n                setTimeout(() => {\n                  try {\n                    // Pro custom select komponenty, najdi input uvnit\n                    const inputInside = element.querySelector('input');\n                    if (inputInside) {\n                      inputInside.focus();\n                    } else {\n                      element.focus();\n                    }\n                  } catch (e) {\n                    // Focus me selhat u nkterch komponent\n                  }\n                }, 300);\n              }, 300);\n              break;\n            }\n          }\n\n          // Sekce je ji rozbalen, scrolluj ihned\n          element.scrollIntoView({\n            behavior: 'smooth',\n            block: 'center',\n            inline: 'nearest'\n          });\n\n          // Pokus o focus s mrnm zpodnm\n          setTimeout(() => {\n            try {\n              // Pro custom select komponenty, najdi input uvnit\n              const inputInside = element.querySelector('input');\n              if (inputInside) {\n                inputInside.focus();\n              } else {\n                element.focus();\n              }\n            } catch (e) {\n              // Focus me selhat u nkterch komponent\n            }\n          }, 300);\n          break;\n        }\n      }\n    }\n  };\n\n  const handleSaveOrder = async () => {\n    // Vymazat debug konzoli ped uloenm\n    clearDebugLogs();\n    addDebugLog('info', 'SAVE', 'order-save-start', 'Zanm ukldn objednvky...');\n\n    // Zavolej nai API funkci\n    await saveOrderToAPI();\n  };\n\n  // ====================== ABLONY - POKROIL FUNKCE ======================\n\n  // Koprovn peddefinovan ablony do uivatelskch ablon\n  const copyPredefinedToUser = async (predefinedEntry) => {\n    if (!token || !user_id || !predefinedEntry) {\n      return;\n    }\n\n    try {\n      const templateData = predefinedEntry.data || {};\n      const templateName = predefinedEntry.name || predefinedEntry.dbName || 'Kopie ablony';\n      const copyName = `${templateName} (kopie)`;\n\n      // Pprava dat pro API\n      const polozky_po = (templateData.poApproval) ? JSON.stringify(templateData.poApproval) : '';\n      const polozky_detail = (templateData.orderDetails) ? JSON.stringify(templateData.orderDetails) : '';\n\n      // Uren typu ablony\n      const typ = predefinedEntry.type?.toString().toUpperCase() || 'OBEJD';\n\n      const resp = await createTemplate({\n        username: user?.username || username,\n        token,\n        user_id: user_id || 0,\n        nazev_sablony: copyName,\n        polozky_po,\n        polozky_detail,\n        typ,\n        kategorie: 'OBJEDNAVKA25'\n      });\n\n      if (resp && (resp.success || resp.status === 'ok')) {\n        const created = resp.data || resp || {};\n        const entry = {\n          name: copyName,\n          data: templateData,\n          ts: Date.now(),\n          type: typ === 'PO' ? 'po' : (typ === 'DETAIL' ? 'details' : 'mixed'),\n          id: created.id || created.insertId,\n          user_id: user_id,\n          __fromServer: true\n        };\n\n        // Pidat do uivatelskch ablon\n        setSavedTemplates(prev => {\n          const existing = Array.isArray(prev) ? prev : [];\n          const filtered = existing.filter(e => (e.name || '').trim().toLowerCase() !== copyName.trim().toLowerCase());\n          const updatedTemplates = [entry, ...filtered].slice(0, 200);\n\n          // Uloit do localStorage\n          try {\n            const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n            localStorage.setItem(key, JSON.stringify(updatedTemplates));\n          } catch (error) {\n          }\n\n          return updatedTemplates;\n        });\n\n        logTemplateAction('copy', { originalName: templateName, copyName, type: typ.toLowerCase(), mode: 'server' });\n\n        if (showToast) {\n          showToast(`ablona \"${templateName}\" byla zkoprovna jako \"${copyName}\"`, { type: 'success' });\n        }\n\n        return entry;\n      }\n    } catch (err) {\n      if (showToast) {\n        showToast(`Chyba pi koprovn ablony: ${err?.message || 'Neznm chyba'}`, { type: 'error' });\n      }\n    }\n  };\n\n  // Koprovn uivatelsk ablony do globlnch ablon (jen pro TEMPLATE_MANAGE)\n  const copyUserTemplateToGlobal = async (userEntry) => {\n    if (!userEntry || !token || !user_id) {\n      return;\n    }\n\n    try {\n      const templateName = userEntry.name || userEntry.dbName || 'Kopie uivatelsk ablony';\n      const globalName = `${templateName} (GLO)`;\n\n      // Urit typ ablony\n      const data = userEntry.data || {};\n      const hasPo = data.poApproval && Object.keys(data.poApproval).length > 0;\n      const hasDet = data.orderDetails && Object.keys(data.orderDetails).length > 0;\n      let typ = 'PO';\n      if (hasPo && hasDet) typ = 'PO+detail';\n      else if (hasDet) typ = 'detail';\n\n      const result = await createTemplate({\n        username: user?.username || username,\n        token,\n        user_id: 0, // Globln ablona (user_id = 0)\n        nazev_sablony: globalName,\n        polozky_po: hasPo ? JSON.stringify(data.poApproval) : '',\n        polozky_detail: hasDet ? JSON.stringify(data.orderDetails) : '',\n        typ: typ.toLowerCase(),\n        kategorie: 'OBJEDNAVKA25'\n      });\n\n      if (result?.status === 'ok') {\n\n        // Refresh ablon pro aktualizaci\n        await fetchAndMergeTemplates();\n\n        logTemplateAction('copyToGlobal', { originalName: templateName, globalName, type: typ.toLowerCase(), mode: 'global' });\n\n        if (showToast) {\n          showToast(`ablona \"${templateName}\" byla zkoprovna do globlnch jako \"${globalName}\"`, { type: 'success' });\n        }\n      } else {\n        const errorMsg = result?.message || result?.data?.message || 'Nepodailo se zkoprovat ablonu do globlnch';\n        throw new Error(errorMsg);\n      }\n    } catch (err) {\n      if (showToast) {\n        showToast(`Chyba pi koprovn do globlnch ablon: ${err?.message || 'Neznm chyba'}`, { type: 'error' });\n      }\n    }\n  };\n\n  // Potvrzen mazn ablony\n  const confirmDeleteSavedTemplate = () => {\n    if (!templatePendingDelete) return;\n\n    try {\n      const target = templatePendingDelete;\n\n      // Pokud je ablona na serveru, sma ji tam\n      if (target && (target.__fromServer || target.id) && token && username) {\n        (async () => {\n          try {\n            const payloadUserId = (target && (target.user_id !== undefined && target.user_id !== null)) ? target.user_id : (user_id || 0);\n\n            // Pokud mazn globln ablony (user_id === 0), zkontroluj prva\n            if (Number(payloadUserId) === 0 && (!hasPermission || !hasPermission('TEMPLATE_MANAGE'))) {\n              if (showToast) {\n                showToast('Nemte oprvnn smazat peddefinovanou ablonu.', { type: 'error' });\n              }\n              return;\n            }\n\n            const resp = await deleteTemplate({\n              username: user?.username || username,\n              token,\n              user_id: payloadUserId || 0,\n              id: target.id\n            });\n\n            const serverStatus = resp && resp.data && (resp.data.status || resp.data.result || (resp.data.ok ? 'ok' : null));\n            const serverData = resp && resp.data && (resp.data.data || resp.data);\n            const isDeleted = serverStatus && String(serverStatus).toLowerCase() === 'ok' && serverData && (serverData.deleted === true || serverData.deleted === 'true');\n\n            if (isDeleted || resp?.success || resp?.status === 'ok') {\n              // Odstranit ze serverTemplates pokud je tam\n              setServerTemplates(prev => Array.isArray(prev) ? prev.filter(p => String(p.id) !== String(target.id)) : prev);\n\n              // Odstranit z uivatelskch ablon\n              setSavedTemplates(prev => {\n                const updatedTemplates = prev.filter(e => !(e.id && target.id && String(e.id) === String(target.id)));\n                // Uloit do localStorage\n                try {\n                  const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n                  localStorage.setItem(key, JSON.stringify(updatedTemplates));\n                } catch (error) {\n                }\n                return updatedTemplates;\n              });\n\n              logTemplateAction('delete', { name: target?.name, id: target?.id, mode: 'server' });\n\n              if (showToast) {\n                showToast('ablona byla smazna.', { type: 'success' });\n              }\n            } else {\n              throw new Error('Smazn na serveru se nezdailo');\n            }\n          } catch (err) {\n\n            // Fallback na lokln mazn\n            setSavedTemplates(prev => {\n              const updatedTemplates = prev.filter(e => !(e.ts === target.ts && e.name === target.name));\n              // Uloit do localStorage\n              try {\n                const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n                localStorage.setItem(key, JSON.stringify(updatedTemplates));\n              } catch (error) {\n              }\n              return updatedTemplates;\n            });\n\n            if (showToast) {\n              showToast(`Smazn ablony selhalo: ${err?.message || 'Chyba serveru'}`, { type: 'error' });\n            }\n          }\n        })();\n      } else {\n        // Pouze lokln ablona\n        setSavedTemplates(prev => {\n          const updatedTemplates = prev.filter(e => !(e.ts === templatePendingDelete.ts && e.name === templatePendingDelete.name));\n          // Uloit do localStorage\n          try {\n            const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n            localStorage.setItem(key, JSON.stringify(updatedTemplates));\n          } catch (error) {\n          }\n          return updatedTemplates;\n        });\n\n        logTemplateAction('delete', { name: templatePendingDelete?.name, ts: templatePendingDelete?.ts, mode: 'local' });\n      }\n    } finally {\n      setShowDeleteTemplateConfirm(false);\n      setTemplatePendingDelete(null);\n    }\n  };\n\n  // Zruen mazn ablony\n  const cancelDeleteSavedTemplate = () => {\n    setShowDeleteTemplateConfirm(false);\n    setTemplatePendingDelete(null);\n  };\n\n  // Zatek editace nzvu ablony\n  const startEditingTemplateName = (template) => {\n    setEditingTemplateId(template.id || template.ts);\n    setEditingTemplateName(template.name || '');\n  };\n\n  // Zruen editace nzvu ablony\n  const cancelEditingTemplateName = () => {\n    setEditingTemplateId(null);\n    setEditingTemplateName('');\n  };\n\n  // Uloen novho nzvu ablony\n  const saveTemplateName = async (template) => {\n    if (!editingTemplateName.trim()) {\n      if (showToast) {\n        showToast('Nzev ablony neme bt przdn', { type: 'error' });\n      }\n      return;\n    }\n\n    try {\n      const newName = editingTemplateName.trim();\n\n      if (template.__fromServer && template.id) {\n        // Serverov ablona - aktualizace na serveru\n\n        const result = await updateTemplate({\n          username: user?.username || username,\n          token,\n          user_id: template.user_id || 0, // Zachovej pvodn user_id ablony\n          id: template.id,\n          nazev_sablony: newName,\n          kategorie: \"OBJEDNAVKA25\"\n        });\n\n        if (result?.status === 'ok' && result?.data?.updated) {\n\n          // Refresh ablon pro aktualizaci\n          await fetchAndMergeTemplates();\n\n          logTemplateAction('rename', { oldName: template.name, newName, id: template.id, mode: 'server' });\n\n          if (showToast) {\n            showToast(`ablona pejmenovna na \"${newName}\"`, { type: 'success' });\n          }\n        } else {\n          const errorMsg = result?.message || result?.data?.message || 'Nepodailo se pejmenovat ablonu na serveru';\n          throw new Error(errorMsg);\n        }\n      } else {\n        // Lokln ablona - aktualizace v localStorage\n        setSavedTemplates(prev => {\n          const updated = prev.map(t => {\n            if ((t.id && template.id && String(t.id) === String(template.id)) ||\n                (t.ts === template.ts && t.name === template.name)) {\n              return { ...t, name: newName };\n            }\n            return t;\n          });\n\n          // Uloit do localStorage\n          try {\n            const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n            localStorage.setItem(key, JSON.stringify(updated));\n          } catch (error) {\n          }\n\n          return updated;\n        });\n\n        logTemplateAction('rename', { oldName: template.name, newName, mode: 'local' });\n\n        if (showToast) {\n          showToast(`ablona pejmenovna na \"${newName}\"`, { type: 'success' });\n        }\n      }\n\n      // Reset editace\n      setEditingTemplateId(null);\n      setEditingTemplateName('');\n\n    } catch (err) {\n      if (showToast) {\n        showToast(`Chyba pi pejmenovn ablony: ${err?.message || 'Neznm chyba'}`, { type: 'error' });\n      }\n    }\n  };\n\n  // ====================== ABLONY - HLAVN FUNKCE ======================\n\n  // Natn ablon ze serveru\n  const fetchAndMergeTemplates = async () => {\n    if (!token || !user_id) return;\n\n    setTemplatesLoading(true);\n    try {\n\n      // Zkusme nejprve OBJEDNAVKA25, pokud nebudou vsledky, zkusme OBJEDNAVKA\n      let response = await fetchTemplatesListWithMeta({\n        username: user?.username || username,\n        token,\n        user_id: user_id || 0,\n        kategorie: 'OBJEDNAVKA25', // DLEIT: Pro nov objednvky pouvme kategorii OBJEDNAVKA25\n        debug: true // Pidme debug parameter jako v pvodn implementaci\n      });\n\n      // Pro OrderForm25 pouvme vhradn OBJEDNAVKA25 kategorie - bez fallbacku na OBJEDNAVKA\n\n      // Zpracovn odpovdi podle pvodn logiky z OrderFormComponent\n      let templates = [];\n      if (Array.isArray(response?.items)) {\n        templates = response.items;\n      } else if (Array.isArray(response?.data)) {\n        templates = response.data;\n      } else if (response?.success && Array.isArray(response?.data)) {\n        templates = response.data;\n      }\n\n      if (templates.length > 0) {\n        // Rozdlen ablon na serverov a uivatelsk\n        const serverTpls = templates.filter(t => t.user_id === 0 || String(t.user_id) === '0');\n        const userTpls = templates.filter(t => t.user_id !== 0 && String(t.user_id) !== '0');\n\n        // Zpracovn serverovch ablon s nzvy podle pvodn logiky\n        const processedServerTemplates = serverTpls.map(t => {\n          const name = t.nazev_sablony || t.nazev || t.name || `sablona-${t.id}`;\n          const ts = t.dt_aktualizace || t.dt_vytvoreni || Date.now();\n          const data = parseTemplateData(t);\n\n          // Uren typu ablony podle pvodn logiky\n          const rawTyp = (t.typ || t.type || '');\n          const rawTypStr = (typeof rawTyp === 'string' ? rawTyp : String(rawTyp || '')).trim().toLowerCase();\n          let serverType = null;\n          if (rawTypStr) {\n            if (rawTypStr === 'po' || rawTypStr === 'p_o' || rawTypStr === 'p.o' || rawTypStr === 'p') serverType = 'PO';\n            else if (rawTypStr === 'detail' || rawTypStr === 'det' || rawTypStr === 'details') serverType = 'DETAIL';\n            else if (rawTypStr === 'obejd' || rawTypStr === 'po+detail' || rawTypStr === 'po_detail' || rawTypStr === 'both') serverType = 'OBEJD';\n            else {\n              // Heuristika: obsahuje klov slova\n              if (rawTypStr.includes('po') && rawTypStr.includes('detail')) serverType = 'OBEJD';\n              else if (rawTypStr.includes('po')) serverType = 'PO';\n              else if (rawTypStr.includes('det')) serverType = 'DETAIL';\n            }\n          }\n\n          // Pokud typ nen uren ze serveru, odvo z dat\n          const type = serverType || ((data.poApproval && data.orderDetails) ? 'OBEJD' : (data.poApproval ? 'PO' : (data.orderDetails ? 'DETAIL' : 'PO')));\n\n          return {\n            ...t,\n            name,\n            dbName: t.nazev_sablony || null,\n            ts: (new Date(ts)).getTime ? (new Date(ts)).getTime() : Date.now(),\n            type,\n            __fromServer: true,\n            data\n          };\n        });\n\n        setServerTemplates(processedServerTemplates);\n\n        // Zpracovn uivatelskch ablon s nzvy\n        const processedUserTemplates = userTpls.map(t => {\n          const name = t.nazev_sablony || t.nazev || t.name || `sablona-${t.id}`;\n          const ts = t.dt_aktualizace || t.dt_vytvoreni || Date.now();\n          const data = parseTemplateData(t);\n\n          // Uren typu ablony podle pvodn logiky\n          const rawTyp = (t.typ || t.type || '');\n          const rawTypStr = (typeof rawTyp === 'string' ? rawTyp : String(rawTyp || '')).trim().toLowerCase();\n          let serverType = null;\n          if (rawTypStr) {\n            if (rawTypStr === 'po' || rawTypStr === 'p_o' || rawTypStr === 'p.o' || rawTypStr === 'p') serverType = 'PO';\n            else if (rawTypStr === 'detail' || rawTypStr === 'det' || rawTypStr === 'details') serverType = 'DETAIL';\n            else if (rawTypStr === 'obejd' || rawTypStr === 'po+detail' || rawTypStr === 'po_detail' || rawTypStr === 'both') serverType = 'OBEJD';\n            else {\n              // Heuristika: obsahuje klov slova\n              if (rawTypStr.includes('po') && rawTypStr.includes('detail')) serverType = 'OBEJD';\n              else if (rawTypStr.includes('po')) serverType = 'PO';\n              else if (rawTypStr.includes('det')) serverType = 'DETAIL';\n            }\n          }\n\n          // Pokud typ nen uren ze serveru, odvo z dat\n          const type = serverType || ((data.poApproval && data.orderDetails) ? 'OBEJD' : (data.poApproval ? 'PO' : (data.orderDetails ? 'DETAIL' : 'PO')));\n\n          return {\n            ...t,\n            name,\n            dbName: t.nazev_sablony || null,\n            ts: (new Date(ts)).getTime ? (new Date(ts)).getTime() : Date.now(),\n            type,\n            __fromServer: true,\n            data\n          };\n        });\n\n        setSavedTemplates(processedUserTemplates);\n\n        // Uloit uivatelsk ablony do localStorage pro cache\n        try {\n          const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n          localStorage.setItem(key, JSON.stringify(processedUserTemplates));\n\n        } catch (error) {\n        }\n\n        // Debug: ukzat zpracovan nzvy ablon - nyn skryto pro produkci\n\n        setTemplatesFetchStatus({\n          status: response?.status || 'success',\n          error: response?.error || null,\n          raw: response?.raw || null\n        });\n        logTemplateAction('fetch', { count: templates.length, serverCount: processedServerTemplates.length, userCount: processedUserTemplates.length });\n      } else {\n        setTemplatesFetchStatus({\n          status: response?.status || 'empty',\n          error: response?.error || 'dn ablony nenalezeny',\n          raw: response?.raw || null\n        });\n      }\n    } catch (error) {\n      setTemplatesFetchStatus({ status: 'error', error: error.message });\n    } finally {\n      setTemplatesLoading(false);\n    }\n  };\n\n  // Parsovn dat ablony z DB podle pvodn logiky z OrderFormComponent\n  const parseTemplateData = (template) => {\n    try {\n      // Helper funkce pro bezpen parsovn template pol (pevzato z OrderFormComponent)\n      const safeParseTemplateField = (val) => {\n        if (val === null || val === undefined) return null;\n        if (typeof val !== 'string') return val;\n        const raw = val.trim();\n        if (!raw) return null;\n\n        // Zkusme pm JSON parse\n        try { return JSON.parse(raw); } catch (e) {}\n\n        // Normalizace: odstrann novch dk, trim\n        let s = raw.replace(/\\r?\\n/g, ' ').trim();\n\n        // Quote unquoted object keys: {key: -> {\"key\": a tak po rkch\n        try {\n          s = s.replace(/([\\{,\\s])(\\w[\\w\\-]*)\\s*:/g, '$1\"$2\":');\n        } catch (e) {}\n\n        // Nahrazen single quotes za double quotes\n        s = s.replace(/'/g, '\"');\n\n        // Zkusme parsovat normalizovan string\n        try { return JSON.parse(s); } catch (e) {}\n\n        // Posledn monost: evaluace JS-like objektu pomoc Function\n        try {\n          // eslint-disable-next-line no-new-func\n          const fn = new Function('return (' + raw + ');');\n          return fn();\n        } catch (e) {\n          return null;\n        }\n      };\n\n      const rawPo = template.polozky_po ? safeParseTemplateField(template.polozky_po) : null;\n      const rawDetail = template.polozky_detail ? safeParseTemplateField(template.polozky_detail) : null;\n\n      // Helper: expand flat/dotted keys do nested object struktury\n      const expandFlatKeys = (obj) => {\n        if (!obj || typeof obj !== 'object' || Array.isArray(obj)) return obj;\n        const out = {};\n        Object.keys(obj).forEach(k => {\n          const val = obj[k];\n          if (k.includes('.')) {\n            const parts = k.split('.');\n            let cur = out;\n            parts.forEach((p, idx) => {\n              if (idx === parts.length - 1) {\n                cur[p] = val;\n              } else {\n                if (!cur[p] || typeof cur[p] !== 'object') cur[p] = {};\n                cur = cur[p];\n              }\n            });\n          } else {\n            // Merge objects if needed\n            if (typeof val === 'object' && val !== null && !Array.isArray(val) && typeof out[k] === 'object') {\n              out[k] = { ...out[k], ...val };\n            } else {\n              out[k] = val;\n            }\n          }\n        });\n        return out;\n      };\n\n      const parsedPo = rawPo ? expandFlatKeys(rawPo) : null;\n      const parsedDetail = rawDetail ? expandFlatKeys(rawDetail) : null;\n\n      const data = {};\n      if (parsedPo) data.poApproval = parsedPo;\n      if (parsedDetail) data.orderDetails = parsedDetail;\n\n      return data;\n    } catch (error) {\n      return {};\n    }\n  };\n\n  // Natn PO ze ablony\n  const fillPoApprovalSaved = (entry) => {\n    if (currentPhase >= 2) return; // Nelze mnit PO po schvlen\n\n    const data = entry?.data;\n    if (data?.poApproval) {\n      const prev = { ...formData };\n      const next = {\n        ...prev,\n        ...data.poApproval,\n        // Zachovat ID a evidenn slo\n        id: prev.id,\n        ev_cislo: prev.ev_cislo\n      };\n\n      setFormData(next);\n      logTemplateAction('apply-po', {\n        name: entry.name,\n        source: 'saved',\n        ts: entry.ts,\n        preview: compactTemplatePreview(data)\n      });\n\n      //  KRITICK: Po naten ablony POVOLIT autosave a okamit uloit draft\n      draftManager.setAutosaveEnabled(true); //  Povolit autosave\n\n      //  SYNCHRONN voln saveDraft s pedanmi daty (bez setTimeout)\n      saveDraft(true, false, next).catch(e => {\n      });\n    }\n  };\n\n  // Helper: Mapovn pol na sekce (FZE 2)\n  const getFieldsForSections = () => ({\n    financovani: [\n      'zpusob_financovani', 'financovani', 'lp_kod', 'cislo_smlouvy', 'smlouva_poznamka',\n      'individualni_schvaleni', 'individualni_poznamka', 'pojistna_udalost_cislo', 'pojistna_udalost_poznamka'\n    ],\n    dodavatel: [\n      'dodavatel_id', 'dodavatel_nazev', 'dodavatel_adresa', 'dodavatel_ico',\n      'dodavatel_dic', 'dodavatel_zastoupeny'\n    ],\n    kontakt: [\n      'dodavatel_kontakt_jmeno', 'dodavatel_kontakt_email', 'dodavatel_kontakt_telefon'\n    ],\n    detaily: [\n      'druh_objednavky', 'druh_objednavky_kod', 'poznamka_objednavky'\n    ],\n    dodaci_podminky: [\n      'dt_predpokladany_termin_dodani', 'misto_dodani', 'zaruka'\n    ],\n    polozky: ['polozky_objednavky'] // Speciln pole - poloky objednvky\n  });\n\n  // Natn detail ze ablony - respektuje viditelnost sekc podle fze\n  const fillAllFieldsSaved = (entry) => {\n    if (currentPhase < 2) return; // Detaily lze plnit a po schvlen\n\n    const data = entry?.data;\n    if (!data?.orderDetails) {\n      return;\n    }\n\n    // Zjistit, kter sekce jsou viditeln v aktuln fzi\n    const visibility = getSectionVisibility(mainWorkflowState, currentPhase, isArchived);\n    const fieldMap = getFieldsForSections();\n\n    const prev = { ...formData };\n    const next = { ...prev };\n\n    // Naplnit pouze pole z viditelnch sekc\n    Object.entries(fieldMap).forEach(([sectionKey, fields]) => {\n      // Zkontrolovat, zda je sekce viditeln (krom poloek, kter maj speciln kontrolu)\n      const isSectionVisible = sectionKey === 'polozky' ? visibility.detaily : visibility[sectionKey];\n\n      if (isSectionVisible) {\n        fields.forEach(field => {\n          if (data.orderDetails[field] !== undefined) {\n            next[field] = data.orderDetails[field];\n          }\n        });\n      }\n    });\n\n    // Pidn poloek pokud jsou v ablon a sekce detaily je viditeln\n    if (visibility.detaily && Array.isArray(data.polozky) && data.polozky.length > 0) {\n      next.polozky_objednavky = data.polozky;\n    }\n\n    // Zachovat PO data a ID (vdy)\n    next.predmet = prev.predmet;\n    next.prikazce_id = prev.prikazce_id;\n    next.max_cena_s_dph = prev.max_cena_s_dph;\n    next.strediska_kod = prev.strediska_kod;\n    next.garant_uzivatel_id = prev.garant_uzivatel_id;\n    next.id = prev.id;\n    next.ev_cislo = prev.ev_cislo;\n\n    //  Zachovat financovn (soust PO sekce ve FZI 1)\n    next.zpusob_financovani = prev.zpusob_financovani;\n    next.lp_kod = prev.lp_kod;\n    next.cislo_smlouvy = prev.cislo_smlouvy;\n    next.smlouva_poznamka = prev.smlouva_poznamka;\n    next.individualni_schvaleni = prev.individualni_schvaleni;\n    next.individualni_poznamka = prev.individualni_poznamka;\n    next.pojistna_udalost_cislo = prev.pojistna_udalost_cislo;\n    next.pojistna_udalost_poznamka = prev.pojistna_udalost_poznamka;\n\n    setFormData(next);\n    logTemplateAction('apply-details', {\n      name: entry.name,\n      source: 'saved',\n      ts: entry.ts,\n      preview: compactTemplatePreview(data),\n      appliedSections: Object.keys(fieldMap).filter(k => k === 'polozky' ? visibility.detaily : visibility[k])\n    });\n\n    //  KRITICK: Po naten ablony POVOLIT autosave a okamit uloit draft\n    draftManager.setAutosaveEnabled(true); //  Povolit autosave\n\n    //  SYNCHRONN voln saveDraft s pedanmi daty (bez setTimeout)\n    saveDraft(true, false, next).catch(e => {\n    });\n\n  };\n\n  // Uloen ablony\n  const saveTemplateToStorage = async (name, data, type) => {\n    if (!token || !user_id) {\n      return;\n    }\n\n    try {\n      // Pprava dat pro API\n      const polozky_po = (type === 'po' || type === 'mixed') && data.poApproval\n        ? JSON.stringify(data.poApproval)\n        : '';\n      const polozky_detail = (type === 'details' || type === 'mixed') && data.orderDetails\n        ? JSON.stringify(data.orderDetails)\n        : '';\n\n      const typ = type === 'po' ? 'PO' : type === 'details' ? 'DETAIL' : 'OBEJD';\n\n      const response = await createTemplate({\n        username: user?.username || username,\n        token,\n        user_id: user_id || 0,\n        nazev_sablony: name,\n        polozky_po,\n        polozky_detail,\n        typ,\n        kategorie: 'OBJEDNAVKA25' // DLEIT: Pro nov objednvky\n      });\n\n      if (response?.success || response?.status === 'ok') {\n        // Aktualizace loklnho stavu\n        const newTemplate = {\n          name,\n          data,\n          ts: Date.now(),\n          type,\n          id: response.insertId || response.id || response.data?.id,\n          user_id,\n          __fromServer: true\n        };\n\n        setSavedTemplates(prev => {\n          const updatedTemplates = [newTemplate, ...prev];\n          // Uloit do localStorage\n          try {\n            const key = user_id ? `order_templates_${user_id}` : 'order_templates';\n            localStorage.setItem(key, JSON.stringify(updatedTemplates));\n          } catch (error) {\n          }\n          return updatedTemplates;\n        });\n\n        logTemplateAction('save', { name, type, mode: 'server' });\n\n        if (showToast) {\n          showToast(`ablona \"${name}\" byla uloena`, { type: 'success' });\n        }\n      } else {\n        const errorMsg = response?.message || response?.data?.message || 'Chyba pi ukldn';\n        throw new Error(errorMsg);\n      }\n    } catch (error) {\n      if (showToast) {\n        showToast(`Chyba pi ukldn ablony: ${error.message}`, { type: 'error' });\n      }\n    }\n  };\n\n  // Funkce pro ovldn vlastnch select\n  const toggleSelect = (selectName) => {\n    setSelectStates(prev => {\n      // Zavi vechny selecty\n      const newState = {\n        garant: false,\n        prikazce: false,\n        strediska: false,\n        financovani: false,\n      };\n      // Otevi pouze vybran select (pokud byl zaven)\n      newState[selectName] = !prev[selectName];\n      return newState;\n    });\n  };\n\n  const closeAllSelects = () => {\n    setSelectStates({\n      garant: false,\n      prikazce: false,\n      strediska: false,\n      financovani: false,\n      lp_kod: false,\n    });\n  };\n\n  // Funkce pro filtraci monost podle vyhledvn\n  const filterOptions = (options, searchTerm, searchField) => {\n    if (!searchTerm) return options;\n    return options.filter(option => {\n      const label = getOptionLabel(option, searchField);\n      return label.toLowerCase().includes(searchTerm.toLowerCase());\n    });\n  };\n\n  // Funkce pro zskn labelu monosti\n  const getOptionLabel = useCallback((option, field) => {\n    if (!option) return '';\n\n    switch (field) {\n      case 'garant':\n        return `${option.titul_pred ? option.titul_pred + ' ' : ''}${option.jmeno || ''} ${option.prijmeni || ''}${option.titul_za ? ', ' + option.titul_za : ''}`.replace(/\\s+/g, ' ').trim();\n      case 'prikazce':\n        // Pokud je option null, 0 nebo przdn ID, vra \"Neznm\"\n        if (!option || option === 0 || option.id === 0 || option.user_id === 0 || option.id === null || option.user_id === null) {\n          return 'Neznm';\n        }\n        const fullName = `${option.titul_pred ? option.titul_pred + ' ' : ''}${option.jmeno || ''} ${option.prijmeni || ''}${option.titul_za ? ', ' + option.titul_za : ''}`.replace(/\\s+/g, ' ').trim();\n        const usekSuffix = option.usek_zkr ? ` (${option.usek_zkr})` : '';\n        return (fullName || 'Neznm') + usekSuffix;\n      case 'strediska':\n      case 'strediska_kod':\n        // Pro hierarchick stediska pouij label (u obsahuje odsazen)\n        if (option.label) {\n          return option.label;\n        }\n        // Fallback pro pvodn formt\n        return option.name || option.nazev_stavu || option.toString();\n      case 'financovani':\n      case 'zpusob_financovani':\n        //  OPRAVA: Pouvat nazev_stavu stejn jako u stedisek\n        return option.nazev_stavu || option.nazev || option.label || (typeof option === 'string' ? option : 'Neznm');\n      case 'lp_kod':\n        //  OPRAVA: Pout cislo_lp a nazev_uctu msto kod a nazev\n        return option.cislo_lp\n          ? `${option.cislo_lp} - ${option.nazev_uctu || 'Bez nzvu'}`\n          : `${option.id || option} - ${option.nazev_uctu || option.nazev || option.label || 'Bez nzvu'}`;\n      case 'druh_objednavky_kod':\n        //  OPRAVA: Pouvat nazev_stavu stejn jako u stedisek + indiktor majetku\n        const druhLabel = option.nazev_stavu || option.nazev || option.label || (typeof option === 'string' ? option : 'Neznm');\n        const isMajetek = option.atribut_objektu === 1 || option.atribut_objektu === '1';\n        // Pidat (majetek) tag malm psmem jako st labelu\n        return isMajetek ? `${druhLabel}   (majetek)` : druhLabel;\n      // Pro Orders25List compatibility\n      case 'statusFilter':\n        return option.nazev_stavu || option.nazev || option.popis || option.kod_stavu || option.kod || String(option);\n      case 'selectedObjednatel':\n      case 'selectedGarant':\n        return option.displayName || `${option.jmeno || ''} ${option.prijmeni || ''}`.trim() || 'Bez jmna';\n      case 'selectedSchvalovatel':\n        // Pokud je option null, 0 nebo przdn ID, vra \"Neznm\"\n        if (!option || option === 0 || option.id === 0 || option.user_id === 0 || option.id === null || option.user_id === null) {\n          return 'Neznm';\n        }\n        return option.displayName || option.jmeno_prijmeni || `${option.jmeno || ''} ${option.prijmeni || ''}`.trim() || 'Neznm';\n      case 'pageSize':\n        return option.label || String(option.value || option);\n      default:\n        //  FALLBACK: Pokud field zan na \"polozka_\" a kon na \"_lp\", je to LP poloky\n        if (field && typeof field === 'string' && field.startsWith('polozka_') && field.endsWith('_lp')) {\n          // LP pro poloky - pouij label nebo vytvoit z kod a nazev\n          return option.label || (option.kod && option.nazev ? `${option.kod} - ${option.nazev}` : String(option));\n        }\n        // Obecn fallback - pokud m option.label, pouij ho\n        return option.label || (typeof option === 'string' ? option : String(option));\n    }\n  }, []); // dn dependencies - funkce je ist zvisl na vstupnch parametrech\n\n  // React komponenty pro vlastn selecty\n  // CustomSelect wrapper - pouv globln komponentu\n  const CustomSelectLocal = (props) => (\n    <CustomSelect\n      {...props}\n      selectStates={selectStates}\n      setSelectStates={setSelectStates}\n      searchStates={searchStates}\n      setSearchStates={setSearchStates}\n      touchedSelectFields={touchedSelectFields}\n      setTouchedSelectFields={setTouchedSelectFields}\n      hasTriedToSubmit={hasTriedToSubmit}\n      toggleSelect={toggleSelect}\n      filterOptions={filterOptions}\n      getOptionLabel={getOptionLabel}\n    />\n  );\n\n  // Multi-select komponenta pro stediska\n  const MultiSelect = ({\n    values = [],\n    onChange,\n    options = [],\n    placeholder,\n    disabled = false,\n    hasError = false,\n    icon = null\n  }) => {\n    // Zajistit, e values je vdy pole\n    const safeValues = Array.isArray(values) ? values : [];\n    const isOpen = selectStates.strediska;\n    const searchTerm = searchStates.strediska;\n    const dropdownRef = useRef(null);\n    const buttonRef = useRef(null);\n    const searchInputRef = useRef(null);\n\n    const filteredOptions = filterOptions(options, searchTerm, 'strediska');\n\n    // Pozicovn pro fixed dropdown s optimalizovanm scroll handlerem\n    useEffect(() => {\n      if (isOpen && buttonRef.current && dropdownRef.current) {\n        const updatePosition = () => {\n          if (!buttonRef.current || !dropdownRef.current) return;\n          const buttonRect = buttonRef.current.getBoundingClientRect();\n          const dropdown = dropdownRef.current;\n\n          const dropdownMaxHeight = 300;\n          const footerHeight = 54; // Vka fixn patiky\n          const buffer = 20; // Extra buffer pro bezpenost\n          const spaceBelow = window.innerHeight - buttonRect.bottom - footerHeight - buffer;\n          const spaceAbove = buttonRect.top - buffer;\n          // Otevi nahoru pokud: nen dost msta dole NEBO je nahoe vrazn vce msta\n          const shouldOpenUpward = spaceBelow < 200 || (spaceBelow < dropdownMaxHeight && spaceAbove > spaceBelow + 50);\n\n          dropdown.style.left = buttonRect.left + 'px';\n          dropdown.style.width = buttonRect.width + 'px';\n          dropdown.style.maxHeight = dropdownMaxHeight + 'px';\n\n          if (shouldOpenUpward) {\n            // Otevt nahoru\n            dropdown.style.bottom = (window.innerHeight - buttonRect.top + 2) + 'px';\n            dropdown.style.top = 'auto';\n          } else {\n            // Otevt dol (standardn chovn)\n            dropdown.style.top = (buttonRect.bottom + 2) + 'px';\n            dropdown.style.bottom = 'auto';\n          }\n        };\n\n        updatePosition();\n\n        const handleScroll = (event) => {\n          // OPRAVA: Neaktualizovat pozici pi scrollu uvnit dropdown menu\n          if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\n            // Pro scroll cel strnky - okamit aktualizace bez throttling\n            updatePosition();\n          }\n        };\n\n        // Pouvat passive listener pro lep performance\n        window.addEventListener('scroll', handleScroll, { passive: true, capture: true });\n        window.addEventListener('resize', updatePosition, { passive: true });\n\n        return () => {\n          window.removeEventListener('scroll', handleScroll, { capture: true });\n          window.removeEventListener('resize', updatePosition);\n        };\n      }\n    }, [isOpen]);\n\n    // Auto-focus search inputu pi oteven (pouze prvn oteven)\n    useEffect(() => {\n      if (isOpen && searchInputRef.current) {\n        // Mal zpodn pro zajitn, e dropdown je u vyrendrovan\n        // Ale pouze pokud nen ji focused jin element v dropdown\n        setTimeout(() => {\n          if (searchInputRef.current && !document.activeElement?.closest('[data-custom-select]')) {\n            searchInputRef.current.focus();\n          }\n        }, 100);\n      }\n    }, [isOpen]);\n\n    const displayValue = safeValues.length > 0\n      ? safeValues.map(val => {\n          const option = options.find(opt => opt.value === val || opt === val);\n          return option ? getOptionLabel(option, 'strediska') : val;\n        }).join(', ')\n      : placeholder;\n\n    const handleToggleOption = (option) => {\n      const optionValue = option.value || option;\n      const newValues = safeValues.includes(optionValue)\n        ? safeValues.filter(v => v !== optionValue)\n        : [...safeValues, optionValue];\n\n      // Zachovat scroll pozici ped zmnou\n      const scrollPosition = dropdownRef.current?.scrollTop || 0;\n\n      onChange({ target: { value: newValues } });\n\n      // OPRAVA: Obnovit scroll pozici a focus bez skoku na zatek\n      requestAnimationFrame(() => {\n        if (dropdownRef.current) {\n          dropdownRef.current.scrollTop = scrollPosition;\n        }\n        if (searchInputRef.current) {\n          // Deaktivovat automatick focus, kter zpsobuje problmy\n          // searchInputRef.current.focus();\n        }\n      });\n    };\n\n    return (\n      <MultiSelectWrapper data-custom-select isOpen={isOpen}>\n        <MultiSelectButton\n          ref={buttonRef}\n          onClick={() => !disabled && toggleSelect('strediska')}\n          disabled={disabled}\n          hasError={hasError}\n          placeholder={safeValues.length === 0 ? \"true\" : \"false\"}\n          value={safeValues.length > 0 ? 'selected' : ''}\n          isOpen={isOpen}\n          data-field=\"strediska\"\n          tabIndex={disabled ? -1 : 0}\n          onKeyDown={(e) => {\n            if (!disabled && e.key === 'Enter') {\n              toggleSelect('strediska');\n            }\n          }}\n          hasIcon={!!icon}\n        >\n          {icon && <span style={{\n            position: 'absolute',\n            left: '12px',\n            color: '#9ca3af',\n            width: '16px',\n            height: '16px',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center'\n          }}>\n            {React.cloneElement(icon, { size: 16 })}\n          </span>}\n          <SelectedValue isEmpty={safeValues.length === 0} title={displayValue}>{displayValue}</SelectedValue>\n        </MultiSelectButton>\n\n        {isOpen && !disabled && (\n          <CustomSelectDropdown ref={dropdownRef}>\n            <SearchBox>\n              <SearchIcon>\n                <Search size={16} />\n              </SearchIcon>\n              <SearchInput\n                ref={searchInputRef}\n                type=\"text\"\n                placeholder=\"Vyhledat stedisko...\"\n                value={searchTerm}\n                onChange={(e) => setSearchStates(prev => ({\n                  ...prev,\n                  strediska: e.target.value\n                }))}\n                onKeyDown={(e) => {\n                  if (e.key === 'ArrowDown') {\n                    // ipka dol - pejdi na prvn option\n                    e.preventDefault();\n                    if (filteredOptions.length > 0) {\n                      const firstOption = dropdownRef.current?.querySelector('[role=\"option\"]');\n                      if (firstOption) {\n                        firstOption.focus();\n                      }\n                    }\n                  } else if (e.key === 'ArrowUp') {\n                    // ipka nahoru - pejdi na posledn option\n                    e.preventDefault();\n                    if (filteredOptions.length > 0) {\n                      const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]') || []);\n                      const lastOption = options[options.length - 1];\n                      if (lastOption) {\n                        lastOption.focus();\n                      }\n                    }\n                  } else if (e.key === 'Tab') {\n                    // Pokud je dropdown oteven, pejdi na prvn option msto zaven\n                    if (filteredOptions.length > 0) {\n                      e.preventDefault();\n                      const firstOption = dropdownRef.current?.querySelector('[class*=\"SelectOption\"]');\n                      if (firstOption) {\n                        firstOption.focus();\n                      }\n                    } else {\n                      // Pokud nejsou dn options, zavi dropdown a pokrauj na dal prvek\n                      toggleSelect('strediska');\n                    }\n                  } else if (e.key === 'Escape') {\n                    e.preventDefault();\n                    toggleSelect('strediska');\n                  } else if (e.key === 'Enter') {\n                    e.preventDefault();\n                    e.stopPropagation();\n                  }\n                }}\n              />\n            </SearchBox>\n\n            {filteredOptions.map((option, index) => {\n              const optionValue = option.value || option;\n              const isChecked = safeValues.includes(optionValue);\n\n              return (\n                <MultiSelectOption\n                  key={option.value || index}\n                  level={option.level || 0}\n                  tabIndex={0}\n                  role=\"option\"\n                  aria-selected={isChecked}\n                  onClick={(e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    handleToggleOption(option);\n                  }}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter' || e.key === ' ') {\n                      e.preventDefault();\n                      handleToggleOption(option);\n                    } else if (e.key === 'ArrowDown') {\n                      // ipka dol - pejdi na dal option\n                      e.preventDefault();\n                      const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]') || []);\n                      const currentIdx = options.indexOf(e.target);\n                      const nextIdx = currentIdx + 1;\n                      if (nextIdx < options.length) {\n                        options[nextIdx].focus();\n                      } else {\n                        // Cyklicky na zatek\n                        options[0]?.focus();\n                      }\n                    } else if (e.key === 'ArrowUp') {\n                      // ipka nahoru - pejdi na pedchoz option\n                      e.preventDefault();\n                      const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]') || []);\n                      const currentIdx = options.indexOf(e.target);\n                      const prevIdx = currentIdx - 1;\n                      if (prevIdx >= 0) {\n                        options[prevIdx].focus();\n                      } else {\n                        // Cyklicky zpt do search inputu\n                        if (searchInputRef.current) {\n                          searchInputRef.current.focus();\n                        } else {\n                          options[options.length - 1]?.focus();\n                        }\n                      }\n                    } else if (e.key === 'Escape') {\n                      e.preventDefault();\n                      toggleSelect('strediska');\n                    } else if (e.key === 'Tab') {\n                      // Tab navigace v rmci dropdownu\n                      const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]') || []);\n                      const currentIdx = options.indexOf(e.target);\n\n                      if (e.shiftKey) {\n                        // Shift+Tab - pokud jsme na prvn option, vra se na search input\n                        if (currentIdx === 0) {\n                          e.preventDefault();\n                          if (searchInputRef.current) {\n                            searchInputRef.current.focus();\n                          }\n                        }\n                      } else {\n                        // Tab - pokud jsme na posledn option, zavi dropdown\n                        if (currentIdx === options.length - 1) {\n                          e.preventDefault();\n                          toggleSelect('strediska');\n                        }\n                      }\n                    }\n                  }}\n                >\n                  <input\n                    type=\"checkbox\"\n                    checked={isChecked}\n                    readOnly\n                  />\n                  <span>\n                    {getOptionLabel(option, 'strediska')}\n                  </span>\n                </MultiSelectOption>\n              );\n            })}\n\n            {filteredOptions.length === 0 && (\n              <CustomSelectOption>dn vsledky</CustomSelectOption>\n            )}\n          </CustomSelectDropdown>\n        )}\n      </MultiSelectWrapper>\n    );\n  };\n\n  // Clicked outside handler\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      // Zavt vechny selecty pi kliknut mimo\n      if (!event.target.closest('[data-custom-select]')) {\n        closeAllSelects();\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, []);\n\n  // AUTOSAVE JE VYPNUT - ukldn pouze pi onBlur (handleFieldBlur)\n  // Pvodn useEffect s debouncem byl odstrann, aby se autosave nespoutl pi kad zmn\n  // Autosave se nyn spout POUZE pi ztrt fokusu input pole (viz handleFieldBlur)\n\n  //  TAB NAVIGATION HANDLER - inteligentn navigace pouze po viditelnch a ne-disabled prvcch\n  const handleFormKeyDown = useCallback((e) => {\n    if (e.key !== 'Tab') return;\n\n    // Najdi aktuln fokusnut prvek\n    const activeElement = document.activeElement;\n\n    // Pokud jsme v otevenm dropdownu, nech dropdown zvldat tab sm\n    const isInDropdown = activeElement?.closest('[class*=\"Dropdown\"]') ||\n                        activeElement?.closest('[class*=\"SelectDropdown\"]') ||\n                        activeElement?.closest('[class*=\"TemplateDropdown\"]');\n\n    if (isInDropdown) {\n      // Nechme dropdown zvldat tab navigaci\n      return;\n    }\n\n    // Zskej ScrollableContent kontejner - pouze prvky uvnit nj\n    const formContainer = document.querySelector('[class*=\"ScrollableContent\"]');\n    if (!formContainer) return;\n\n    // Kontrola zda je aktivn prvek uvnit formule\n    if (!formContainer.contains(activeElement)) {\n      // Pokud jsme mimo formul, nech prohle zvldat tab normln\n      return;\n    }\n\n    const focusableSelectors = [\n      'input:not([disabled]):not([tabindex=\"-1\"])',\n      'textarea:not([disabled]):not([tabindex=\"-1\"])',\n      'select:not([disabled]):not([tabindex=\"-1\"])',\n      'button:not([disabled]):not([tabindex=\"-1\"])',\n      '[tabindex]:not([tabindex=\"-1\"]):not([disabled])',\n      '[data-field]:not([disabled]):not([tabindex=\"-1\"])'\n    ].join(',');\n\n    const allElements = Array.from(formContainer.querySelectorAll(focusableSelectors));\n\n    // Filtruj pouze viditeln prvky (offsetParent !== null znamen e je prvek viditeln)\n    const visibleElements = allElements.filter(el => {\n      // Kontrola viditelnosti\n      if (!el.offsetParent && el.tagName !== 'INPUT' && el.tagName !== 'TEXTAREA') {\n        return false;\n      }\n\n      // Kontrola zda nen skryt pomoc display: none nebo visibility: hidden\n      const style = window.getComputedStyle(el);\n      if (style.display === 'none' || style.visibility === 'hidden') {\n        return false;\n      }\n\n      // Kontrola zda nen disabled (i kdy u mme v selektoru, dvojit kontrola)\n      if (el.disabled || el.getAttribute('aria-disabled') === 'true') {\n        return false;\n      }\n\n      return true;\n    });\n\n    if (visibleElements.length === 0) return;\n\n    // Najdi index aktulnho prvku\n    const currentIndex = visibleElements.indexOf(activeElement);\n\n    if (currentIndex === -1) {\n      // Pokud aktuln prvek nen v seznamu, fokusni prvn prvek\n      e.preventDefault();\n      visibleElements[0]?.focus();\n      return;\n    }\n\n    // Vypotej nov index podle smru (Tab vs Shift+Tab)\n    let newIndex;\n    if (e.shiftKey) {\n      // Shift+Tab - jdi zpt\n      newIndex = currentIndex - 1;\n      if (newIndex < 0) {\n        newIndex = visibleElements.length - 1; // Cyklicky na konec\n      }\n    } else {\n      // Tab - jdi vped\n      newIndex = currentIndex + 1;\n      if (newIndex >= visibleElements.length) {\n        newIndex = 0; // Cyklicky na zatek\n      }\n    }\n\n    // Fokusni nov prvek\n    e.preventDefault();\n    visibleElements[newIndex]?.focus();\n\n    // Pokud je to dropdown button, NEOTEVREJ ho automaticky - uivatel me pout Enter\n    // Toto zjednoduuje UX - tab jen naviguje, Enter otvr\n  }, []);\n\n  //  ZAKOMENTOVNO: Tento useEffect zpsobuje PEPSN validanch chyb!\n  // Problm: Po validateFormForSave() (kter vytvo vechny chyby vetn lokac),\n  // se tento useEffect spust (kvli zmn hasTriedToSubmit z falsetrue) a zavol\n  // validateWorkflowData(), kter NEVALIDUJE lokalizan pole (sek, budova, mstnost).\n  // Tm dojde k PEPSN validationErrors objektem BEZ lokalizanch chyb!\n  //  EEN: Live validace nen poteba - validujeme pouze pi kliknut na \"Uloit\"\n  //            ve funkci validateFormForSave(), kter validuje VE vetn lokac.\n  /*\n  useEffect(() => {\n    // KRITICK: Spus validaci pouze pokud uivatel u se pokusil odeslat formul!\n    if (currentPhase >= 2 && formData.id && hasTriedToSubmit) {\n      // Mal zpodn aby se stihly pepotat vechny derived values\n      const timeout = setTimeout(() => {\n        const validationWorkflowCode = mainWorkflowState;\n        const errors = validateWorkflowData(formData, validationWorkflowCode);\n        setValidationErrors(errors);\n      }, 100);\n\n      return () => clearTimeout(timeout);\n    }\n  }, [currentPhase, mainWorkflowState, formData.id, hasTriedToSubmit]);\n  */\n\n  //  NOV LOADING GATE: Souhrn vech natn pro RACE CONDITION FIX\n  // Tato promnn uruje, zda jsou vechna potebn data pipravena\n  const isFormLoading = React.useMemo(() => {\n    // 1. Pokud se nataj selnky, formul NEN pipraven\n    if (isLoadingCiselniky) {\n      return true;\n    }\n\n    // 2. Pokud se nataj data formule (editace NEBO nov objednvka s draftem), formul NEN pipraven\n    if (isLoadingFormData) {\n      return true;\n    }\n\n    // 3. Vechna data jsou pipravena!\n    return false;\n  }, [isLoadingCiselniky, isLoadingFormData]);\n\n  //  AUTH GATE: Pokud nen token/username, zobrazit loading a pokat\n  // MUS BT A PO VECH HOOKS (React Rules of Hooks)\n  if (!token || !username) {\n    return (\n      <LoadingOverlay $visible={true}>\n        <LoadingSpinner $visible={true} />\n        <LoadingMessage $visible={true}>Ovuji pihlen...</LoadingMessage>\n        <LoadingSubtext $visible={true}>ekm na autentizaci...</LoadingSubtext>\n      </LoadingOverlay>\n    );\n  }\n  //       <LoadingMessage $visible={true}>\n  //         {isLoadingCiselniky && !isLoadingFormData && 'Natm selnky...'}\n  //         {isLoadingCiselniky && isLoadingFormData && 'Natm selnky a data objednvky...'}\n  //         {!isLoadingCiselniky && isLoadingFormData && 'Natm data objednvky...'}\n  //       </LoadingMessage>\n  //       <LoadingSubtext $visible={true}>\n  //         {isLoadingCiselniky && 'Zpracovvm seznamy pro vbrov pole...'}\n  //         {!isLoadingCiselniky && isLoadingFormData && 'Zpracovvm data z databze...'}\n  //       </LoadingSubtext>\n  //     </LoadingOverlay>\n  //   );\n  // }\n\n  //  NOV LOADING GATE: Zobrazit splash screen dokud nen lifecycle.isReady\n  // d useFormController lifecycle phases: MOUNTING  LOADING_DICTIONARIES  READY\n\n  if (!lifecycle.isReady) {\n    return (\n      <LoadingOverlay $visible={true}>\n        <LoadingSpinner $visible={true} />\n        <LoadingMessage $visible={true}>\n          {lifecycle.phase === 'MOUNTING' && 'Inicializuji formul...'}\n          {lifecycle.phase === 'LOADING_DICTIONARIES' && 'Natm selnky...'}\n          {lifecycle.phase === 'READY_FOR_DATA' && 'Pipravuji data...'}\n          {lifecycle.phase === 'LOADING_DATA' && 'Natm data objednvky...'}\n          {lifecycle.phase === 'DATA_LOADED' && 'Dokonuji natn...'}\n          {lifecycle.phase === 'READY' && 'Pipravuji formul...'}\n          {!lifecycle.phase && 'Natm formul objednvky'}\n        </LoadingMessage>\n        <LoadingSubtext $visible={true}>\n          {!dictionaries.isReady && `Natm ${dictionaries.loadedCount || 0}/${dictionaries.totalToLoad || 8} selnk...`}\n          {dictionaries.isReady && lifecycle.isLoadingFormData && 'Natm data objednvky...'}\n          {dictionaries.isReady && !lifecycle.isLoadingFormData && !lifecycle.isReady && 'Zpracovvm data...'}\n        </LoadingSubtext>\n      </LoadingOverlay>\n    );\n  }\n  //       <LoadingMessage $visible={true}>Natm formul objednvky</LoadingMessage>\n  //       <LoadingSubtext $visible={true}>Zpracovvm data z databze...</LoadingSubtext>\n  //     </LoadingOverlay>\n  //   );\n  // }\n\n  // Error state pi inicializaci\n  if (initializationError && !token) {\n    return (\n      <Container isFullscreen={isFullscreen}>\n        <div style={{ padding: '2rem', textAlign: 'center' }}>\n          <ErrorMessage>\n            Chyba inicializace: {initializationError}\n          </ErrorMessage>\n        </div>\n      </Container>\n    );\n  }\n\n  // Obsah formule\n  const formContent = (\n    <Container isFullscreen={isFullscreen}>\n      {/*  Plovouc navigtor po sekcch formule */}\n      <FloatingNavigator\n        onSectionClick={handleNavigatorSectionClick}\n        onFilesDrop={handleNavigatorFilesDrop}\n        onToggleSections={handleToggleSections}\n        areSectionsCollapsed={areSectionsCollapsed}\n        currentPhase={getCurrentPhase()}\n        validationErrors={validationErrors}\n        formData={navigatorFormData}\n        isFullscreen={isFullscreen}\n        isSectionActive={isSectionActive}\n        allSectionStates={extendedSectionStates}\n        isWorkflowCompleted={isWorkflowCompleted}\n        canPublishRegistry={canPublishRegistry}\n        canUnlockAnything={canUnlockAnything}\n        onSaveAsTemplate={handleSaveAsTemplate}\n        onGenerateDocx={handleGenerateDocx}\n        onToggleFullscreen={() => setIsFullscreen(!isFullscreen)}\n        canGenerateDocx={canGenerateDocx() && !isOrderCompleted}\n        canSaveTemplate={!showSaveProgress && !isSaving && !!token && !!user_id && !isOrderCompleted}\n        serverTemplates={serverTemplates}\n        savedTemplates={savedTemplates}\n        templatesLoading={templatesLoading}\n        searchQuery={searchPredefs}\n        showSearch={showSearchPredefs}\n        token={token}\n        hasPermission={hasPermission}\n        onTemplateSearch={setSearchPredefs}\n        onToggleTemplateSearch={() => setShowSearchPredefs(s => !s)}\n        onRefreshTemplates={fetchAndMergeTemplates}\n        onFillPoApproval={fillPoApprovalSaved}\n        onFillDetails={fillAllFieldsSaved}\n        canFillTemplate={!isOrderCompleted}\n        onCopyTemplateToUser={copyPredefinedToUser}\n        onCopyTemplateToGlobal={copyUserTemplateToGlobal}\n        onShowTemplatePreview={showTemplatePreview}\n        onDeleteTemplate={(template) => { setTemplatePendingDelete(template); setShowDeleteTemplateConfirm(true); }}\n        onEditTemplateName={startEditingTemplateName}\n        editingTemplateId={editingTemplateId}\n        editingTemplateName={editingTemplateName}\n        matchesTemplateQuery={matchesTemplateQuery}\n        isArchived={isArchived}\n      />\n\n      {/*  Indiktor hlasovho nahrvn je v Layout.js - globln pro celou aplikaci */}\n\n      {/* Varovn pi sten chyb inicializace */}\n      {initializationError && (\n        <ErrorMessage style={{ margin: '1rem' }}>\n          sten chyba pi natn dat: {initializationError}\n        </ErrorMessage>\n      )}\n\n      <FormWrapper>\n        {/* Fixn hlavika */}\n        <FixedHeader ref={fixedHeaderRef}>\n          <FixedHeaderContent>\n            {/* Hlavika formule */}\n            <FormHeader>\n              <HeaderLeft>\n                <TitleWithButtons>\n                  <HeaderTitle\n                    title={isEditMode && formData.ev_cislo ? `Editace objednvky ev.. ${formData.ev_cislo}` : ''}\n                  >\n                    Objednvka\n                    {formData.id && (\n                      <span className=\"order-id-badge\"> #{formData.id}</span>\n                    )}\n                  </HeaderTitle>\n                  {/*  ablony pesunuty do FloatingNavigator toolbaru */}\n                </TitleWithButtons>\n\n                {/*  Souhrn cen vedle nadpisu */}\n                {maxPrice > 0 && (\n                  <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '8px',\n                    padding: '4px 10px',\n                    marginLeft: '0.5rem',\n                    background: isPriceExceeded\n                      ? 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)'\n                      : 'linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)',\n                    border: `2px solid ${isPriceExceeded ? '#fca5a5' : '#bbf7d0'}`,\n                    borderRadius: '6px',\n                    fontSize: '0.75rem',\n                    fontWeight: 600,\n                    color: isPriceExceeded ? '#991b1b' : '#166534',\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\n                    whiteSpace: 'nowrap'\n                  }}>\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '1px', alignItems: 'flex-start' }}>\n                      <div style={{ fontSize: '0.6rem', opacity: 0.8, fontWeight: 500 }}>MAX CENA</div>\n                      <div style={{ fontSize: '0.85rem', fontWeight: 700 }}>\n                        {maxPrice.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K\n                      </div>\n                    </div>\n                    <div style={{ fontSize: '14px', fontWeight: 'bold', opacity: 0.5 }}></div>\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '1px', alignItems: 'flex-end' }}>\n                      <div style={{ fontSize: '0.6rem', opacity: 0.8, fontWeight: 500 }}>SOUET POLOEK</div>\n                      <div style={{ fontSize: '0.85rem', fontWeight: 700 }}>\n                        {totalPrice.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </HeaderLeft>\n\n              {/* EV. SLO a slo objednvky - vpravo */}\n              <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'flex-end' }}>\n                  <div style={{ fontSize: '12px', color: '#666', marginBottom: '2px' }}>\n                    {isOrderSavedToDB ? 'EV. SLO' : 'PEDPOKLDAN EV. SLO'}\n                  </div>\n                  {/* Status informace - pod EV. SLO */}\n                  {(lastAutoSave || isAutoSaving || dataSource) && (\n                    <div style={{\n                      fontSize: '10px',\n                      color: '#666',\n                      padding: '2px 6px',\n                      borderRadius: '4px',\n                      textAlign: 'right',\n                      backgroundColor: isAutoSaving\n                        ? '#fef2f2'  //  erven pi ukldn\n                        : dataSource === 'database'\n                          ? '#eff6ff'  //  modr pro DB\n                          : dataSource === 'concept'\n                            ? '#fefbf2'  //  lut pro koncept\n                            : '#f0fdf4', //  zelen pro auto-save\n                      border: `1px solid ${\n                        isAutoSaving\n                          ? '#fca5a5'  // erven\n                          : dataSource === 'database'\n                            ? '#bfdbfe'  // modr\n                            : dataSource === 'concept'\n                              ? '#fed7aa'  // oranov\n                              : '#bbf7d0'  // zelen\n                      }`,\n                      transition: 'all 0.2s ease'\n                    }}>\n                      {isAutoSaving ? (\n                        <span style={{ color: '#dc2626' }}> Ukldn konceptu...</span>\n                      ) : dataSource === 'database' ? (\n                        <span style={{ color: '#2563eb' }}> Nateno z DB</span>\n                      ) : dataSource === 'concept' ? (\n                        <span style={{ color: '#d97706' }}> Formul naten z Konceptu</span>\n                      ) : lastAutoSave ? (\n                        <>\n                          <span style={{ color: '#16a34a' }}> {isOrderSavedToDB ? 'Uloeno' : 'Koncept'}</span> {new Date(lastAutoSave).toLocaleTimeString('cs-CZ', {\n                            hour: '2-digit',\n                            minute: '2-digit',\n                            second: '2-digit'\n                          })}\n                        </>\n                      ) : null}\n                    </div>\n                  )}\n                </div>\n                <EvidenceNumber>\n                  <EvidenceValue $isEmergency={formData.mimoradna_udalost || false}>\n                    {/* API next-number vrac next_order_string nebo order_number_string */}\n                    {/*  DLEIT: Toto slo je POUZE pro ZOBRAZEN! */}\n                    {/* Backend si pidl finln slo pi CREATE - my ho NIKDY neposlme */}\n                    {isLoadingEvCislo ? (\n                      <span style={{\n                        color: '#666',\n                        fontStyle: 'italic',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem'\n                      }}>\n                        <Spinner />\n                        Natm...\n                      </span>\n                    ) : !isValidEvCislo(formData.ev_cislo) ? (\n                      <span style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem',\n                        color: '#d97706'\n                      }}>\n                        <FontAwesomeIcon icon={faExclamationTriangle} style={{ color: '#f59e0b' }} />\n                        <span style={{ fontSize: '13px' }}>Natn selhalo</span>\n                        <RetryButton\n                          onClick={(e) => {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            loadNextOrderNumber();\n                          }}\n                          title=\"Zkusit nast ev. slo znovu\"\n                        >\n                           Zkusit znovu\n                        </RetryButton>\n                      </span>\n                    ) : typeof formData.ev_cislo === 'object' ? (\n                      formData.ev_cislo?.next_order_string ||\n                      formData.ev_cislo?.order_number_string ||\n                      formData.ev_cislo?.next_number ||\n                      'Natm...'\n                    ) : (\n                      formData.ev_cislo || 'Natm...'\n                    )}\n                  </EvidenceValue>\n                </EvidenceNumber>\n              </div>\n            </FormHeader>\n\n            {/*  ERPN LP - zobrazit v hlavice nad fz */}\n            {(() => {\n              // Zobrazit kdy mme LP financovn\n              const selectedSource = financovaniOptions.find(opt => opt.kod_stavu === formData.zpusob_financovani || opt.kod === formData.zpusob_financovani);\n              const nazev = selectedSource?.nazev_stavu || selectedSource?.nazev || '';\n              const hasLPFinancing = (nazev.includes('Limitovan') || nazev.includes('pslib')) && Array.isArray(formData.lp_kod) && formData.lp_kod.length > 0;\n              \n              if (!hasLPFinancing) return null;\n              \n              return (\n                <div style={{\n                  marginTop: '0.75rem',\n                  marginBottom: '3px',\n                  padding: '0.5rem 0.75rem',\n                  background: 'linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)',\n                  border: '1px solid #93c5fd',\n                  borderRadius: '6px',\n                  fontSize: '0.7rem',\n                  display: 'flex',\n                  flexWrap: 'wrap',\n                  gap: '0.5rem',\n                  alignItems: 'center'\n                }}>\n                  {formData.lp_kod.map(lp_id => {\n                    const detail = lpDetails[lp_id];\n                    if (!detail) return null;\n                    \n                    //  Vybrat sprvn typ erpn podle fze\n                    let zbyva, typCerpani, aktualneCerpani;\n                    \n                    if (currentPhase <= 2) {\n                      // Fze 1-2: Pomrn rozdlen MAX CENY mezi vybran LP\n                      const maxCena = parseFloat(formData.max_cena_s_dph) || 0;\n                      const pocetLP = formData.lp_kod.length;\n                      const pomernaCast = pocetLP > 0 ? maxCena / pocetLP : 0;\n                      \n                      const rezervace = parseFloat(detail.zbyva_rezervace || 0);\n                      zbyva = rezervace - pomernaCast;\n                      aktualneCerpani = pomernaCast;\n                      typCerpani = 'Rezervace';\n                    } else if (currentPhase >= 3 && currentPhase <= 6) {\n                      // Fze 3-6: Pedpokldan erpn (souet poloek)\n                      zbyva = parseFloat(detail.zbyva_predpoklad || 0);\n                      typCerpani = 'Pedpoklad';\n                    } else {\n                      // Fze 7-8: Skuten erpn (faktury)\n                      zbyva = parseFloat(detail.zbyva_skutecne || 0);\n                      typCerpani = 'Skuten';\n                    }\n                    \n                    const isNegative = zbyva < 0;\n                    const lpOption = lpKodyOptions.find(opt => (opt.id || opt.kod) === lp_id);\n                    const lpCislo = lpOption?.cislo_lp || lp_id;\n                    const lpNazev = lpOption?.nazev_uctu || lpOption?.nazev || '';\n                    \n                    // Zskat informaci o sprvci z detail (pokud je naten)\n                    const spravce = detail?.spravce;\n                    const spravceText = spravce ? `${spravce.jmeno || ''} ${spravce.prijmeni || ''}`.trim() : '';\n                    const tooltipText = [\n                      lpNazev ? `${lpCislo} - ${lpNazev}` : lpCislo,\n                      spravceText ? `PO: ${spravceText}` : ''\n                    ].filter(Boolean).join('\\n');\n                    \n                    return (\n                      <div key={lp_id} style={{\n                        padding: '0.3rem 0.6rem',\n                        background: isNegative ? '#fee2e2' : 'white',\n                        border: `1px solid ${isNegative ? '#fca5a5' : '#bfdbfe'}`,\n                        borderRadius: '4px',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.4rem',\n                        fontSize: '0.7rem'\n                      }}>\n                        <div \n                          style={{ fontWeight: 700, color: '#1e40af', fontSize: '0.7rem', cursor: 'help' }}\n                          title={tooltipText}\n                        >\n                          {lpCislo}\n                        </div>\n                        <div style={{ fontWeight: 700, color: isNegative ? '#dc2626' : '#059669', fontSize: '0.7rem' }}>\n                          {zbyva < 0 && ''}\n                          {Math.abs(zbyva).toLocaleString('cs-CZ', { minimumFractionDigits: 0, maximumFractionDigits: 0 })} K\n                        </div>\n                        {currentPhase <= 2 && aktualneCerpani > 0 && (\n                          <>\n                            <div style={{ fontSize: '0.65rem', opacity: 0.7, color: '#64748b' }}>\n                              {aktualneCerpani.toLocaleString('cs-CZ', { minimumFractionDigits: 0, maximumFractionDigits: 0 })} K\n                            </div>\n                            <div \n                              style={{ fontSize: '0.65rem', opacity: 0.7, color: '#64748b', cursor: 'help' }}\n                              title='Rezervace - MAX CENA rozdlen pomrn mezi vybran LP'\n                            >\n                              (R)\n                            </div>\n                          </>\n                        )}\n                        {currentPhase >= 3 && (\n                          <div \n                            style={{ fontSize: '0.65rem', opacity: 0.7, color: '#64748b', cursor: 'help' }}\n                            title={currentPhase >= 3 && currentPhase <= 6 ? 'Pedpokldan erpn podle piazench poloek' : 'Skuten erpn podle faktur'}\n                          >\n                            ({currentPhase >= 3 && currentPhase <= 6 ? 'P' : 'S'})\n                          </div>\n                        )}\n                      </div>\n                    );\n                  })}\n                </div>\n              );\n            })()}\n\n            {/* dek s fz a akcemi NEBO zelen info box pro dokonenou objednvku NEBO erven pro zamtnutou NEBO oranov pro stornovanou */}\n            {isWorkflowRejected ? (\n              //  erven info box pro zamtnutou objednvku\n              <div style={{\n                padding: '1rem 1.5rem',\n                marginTop: '1rem',\n                backgroundColor: '#fee2e2',\n                border: '2px solid #dc2626',\n                borderRadius: '8px',\n                display: 'flex',\n                alignItems: 'flex-start',\n                gap: '1rem',\n                fontWeight: '600',\n                color: '#991b1b'\n              }}>\n                <Lock size={20} style={{ marginTop: '0.25rem', flexShrink: 0 }} />\n                <div style={{ flex: 1 }}>\n                  <div style={{ marginBottom: '0.5rem', fontSize: '1.1rem' }}>\n                     Objednvka zamtnuta\n                  </div>\n                  {formData.schvaleni_komentar && (\n                    <div style={{ fontWeight: 'normal', fontSize: '0.875rem', marginBottom: '0.5rem' }}>\n                      <strong>Dvod zamtnut:</strong> {formData.schvaleni_komentar}\n                    </div>\n                  )}\n                  {formData.schvalovatel_id && (\n                    <div style={{ fontWeight: 'normal', fontSize: '0.875rem' }}>\n                      <strong>Zamtl:</strong> {getUserNameById(formData.schvalovatel_id)}\n                      {formData.dt_schvaleni && `  ${new Date(formData.dt_schvaleni).toLocaleDateString('cs-CZ')} ${new Date(formData.dt_schvaleni).toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' })}`}\n                    </div>\n                  )}\n                </div>\n                {/* Tlatka vpravo */}\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem', flexShrink: 0 }}>\n                  <ActionButton\n                    className=\"cancel-btn\"\n                    onClick={handleCancelOrder}\n                    title=\"Zavt formul a vrtit se na seznam objednvek\"\n                    style={{\n                      padding: '0.5rem 1rem',\n                      fontSize: '0.875rem',\n                      backgroundColor: '#dc2626',\n                      color: 'white',\n                      border: 'none',\n                      borderRadius: '6px',\n                      cursor: 'pointer',\n                      fontWeight: '600',\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '0.5rem',\n                      whiteSpace: 'nowrap',\n                      transition: 'background-color 0.2s'\n                    }}\n                    onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#b91c1c'}\n                    onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#dc2626'}\n                  >\n                    <FontAwesomeIcon icon={faTimes} />\n                    Zavt\n                  </ActionButton>\n                  {/*  Tlatko Odemknout pro admin/ORDER_MANAGE */}\n                  {canUnlockAnything && (\n                    <ActionButton\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        setShowUnlockPhase2Confirm(true);\n                      }}\n                      title=\"Odemknout zamtnutou objednvku (vrtit na FZI 2 - ODESLANA_KE_SCHVALENI)\"\n                      style={{\n                        padding: '0.5rem 1rem',\n                        fontSize: '0.875rem',\n                        backgroundColor: '#f59e0b',\n                        color: 'white',\n                        border: 'none',\n                        borderRadius: '6px',\n                        cursor: 'pointer',\n                        fontWeight: '600',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem',\n                        whiteSpace: 'nowrap',\n                        transition: 'background-color 0.2s'\n                      }}\n                      onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#d97706'}\n                      onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#f59e0b'}\n                    >\n                      <Unlock size={16} />\n                      Odemknout\n                    </ActionButton>\n                  )}\n                </div>\n              </div>\n            ) : isWorkflowCancelled ? (\n              //  Oranov info box pro stornovanou objednvku\n              <div style={{\n                padding: '1rem 1.5rem',\n                marginTop: '1rem',\n                backgroundColor: '#fff7ed',\n                border: '2px solid #f97316',\n                borderRadius: '8px',\n                display: 'flex',\n                alignItems: 'flex-start',\n                gap: '1rem',\n                fontWeight: '600',\n                color: '#9a3412'\n              }}>\n                <Lock size={20} style={{ marginTop: '0.25rem', flexShrink: 0 }} />\n                <div style={{ flex: 1 }}>\n                  <div style={{ marginBottom: '0.5rem', fontSize: '1.1rem' }}>\n                     Objednvka stornovna\n                  </div>\n                  {formData.odeslani_storno_duvod && (\n                    <div style={{ fontWeight: 'normal', fontSize: '0.875rem', marginBottom: '0.5rem' }}>\n                      <strong>Dvod stornovn:</strong> {formData.odeslani_storno_duvod}\n                    </div>\n                  )}\n                  {formData.odesilatel_id && (\n                    <div style={{ fontWeight: 'normal', fontSize: '0.875rem' }}>\n                      <strong>Stornoval:</strong> {getUserNameById(formData.odesilatel_id)}\n                      {formData.dt_odeslani && `  ${new Date(formData.dt_odeslani).toLocaleDateString('cs-CZ')} ${new Date(formData.dt_odeslani).toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' })}`}\n                    </div>\n                  )}\n                </div>\n                {/* Tlatka vpravo */}\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem', flexShrink: 0 }}>\n                  <ActionButton\n                    className=\"cancel-btn\"\n                    onClick={handleCancelOrder}\n                    title=\"Zavt formul a vrtit se na seznam objednvek\"\n                    style={{\n                      padding: '0.5rem 1rem',\n                      fontSize: '0.875rem',\n                      backgroundColor: '#f97316',\n                      color: 'white',\n                      border: 'none',\n                      borderRadius: '6px',\n                      cursor: 'pointer',\n                      fontWeight: '600',\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '0.5rem',\n                      whiteSpace: 'nowrap',\n                      transition: 'background-color 0.2s'\n                    }}\n                    onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#ea580c'}\n                    onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#f97316'}\n                  >\n                    <FontAwesomeIcon icon={faTimes} />\n                    Zavt\n                  </ActionButton>\n                  {canUnlockAnything && (\n                    <ActionButton\n                      className=\"unlock-btn\"\n                      onClick={() => setShowUnlockStornoConfirm(true)}\n                      title=\"Odemknout stornovanou objednvku\"\n                      style={{\n                        padding: '0.5rem 1rem',\n                        fontSize: '0.875rem',\n                        backgroundColor: '#f97316',\n                        color: 'white',\n                        border: 'none',\n                        borderRadius: '6px',\n                        cursor: 'pointer',\n                        fontWeight: '600',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem',\n                        whiteSpace: 'nowrap',\n                        transition: 'background-color 0.2s'\n                      }}\n                      onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#ea580c'}\n                      onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#f97316'}\n                    >\n                      <Unlock size={16} />\n                      Odemknout\n                    </ActionButton>\n                  )}\n                </div>\n              </div>\n            ) : isWorkflowCompleted ? (\n              //  Zelen info box pro dokonenou objednvku\n              <div style={{\n                padding: '1rem 1.5rem',\n                marginTop: '1rem',\n                backgroundColor: '#dcfce7',\n                border: '2px solid #16a34a',\n                borderRadius: '8px',\n                display: 'flex',\n                alignItems: 'flex-start',\n                gap: '1rem',\n                fontWeight: '600',\n                color: '#166534'\n              }}>\n                <Lock size={20} style={{ marginTop: '0.25rem', flexShrink: 0 }} />\n                <div style={{ flex: 1 }}>\n                  <div style={{ marginBottom: '0.5rem' }}>\n                     Objednvka byla spn dokonena. Vechny kroky byly splnny.\n                  </div>\n                  {formData.dokoncil_id && (\n                    <div style={{ fontWeight: 'normal', fontSize: '0.875rem' }}>\n                      <strong>Dokonil:</strong> {getUserNameById(formData.dokoncil_id)}\n                      {formData.dt_dokonceni && `  ${new Date(formData.dt_dokonceni).toLocaleDateString('cs-CZ')} ${new Date(formData.dt_dokonceni).toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' })}`}\n                    </div>\n                  )}\n                </div>\n\n                {/* Tlatka vpravo - POD sebou */}\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem', flexShrink: 0 }}>\n                  <ActionButton\n                    className=\"cancel-btn\"\n                    onClick={handleCancelOrder}\n                    title=\"Zavt formul a vrtit se na seznam objednvek\"\n                    style={{\n                      padding: '0.5rem 1rem',\n                      fontSize: '0.875rem',\n                      backgroundColor: '#16a34a',\n                      color: 'white',\n                      border: 'none',\n                      borderRadius: '6px',\n                      cursor: 'pointer',\n                      fontWeight: '600',\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '0.5rem',\n                      whiteSpace: 'nowrap',\n                      transition: 'background-color 0.2s'\n                    }}\n                    onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#15803d'}\n                    onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#16a34a'}\n                  >\n                    <FontAwesomeIcon icon={faTimes} />\n                    Zavt\n                  </ActionButton>\n\n                  {/*  Tlatko Odemknout pro admin/ORDER_MANAGE - POD tlatkem Zavt */}\n                  {canUnlockAnything && (\n                    <ActionButton\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        setShowUnlockDokonceniConfirm(true);\n                      }}\n                      title=\"Odemknout dokonenou objednvku (vrtit na FZI 8 - ZKONTROLOVANA)\"\n                      style={{\n                        padding: '0.5rem 1rem',\n                        fontSize: '0.875rem',\n                        backgroundColor: '#f59e0b',\n                        color: 'white',\n                        border: 'none',\n                        borderRadius: '6px',\n                        cursor: 'pointer',\n                        fontWeight: '600',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem',\n                        whiteSpace: 'nowrap',\n                        transition: 'background-color 0.2s'\n                      }}\n                      onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#d97706'}\n                      onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#f59e0b'}\n                    >\n                      <Unlock size={16} />\n                      Odemknout\n                    </ActionButton>\n                  )}\n                </div>\n              </div>\n            ) : (\n            //  Standardn dek s fz a akcemi\n            <PhaseRow>\n              <div style={{ display: 'flex', alignItems: 'center', gap: '2rem', flex: 1 }}>\n                <PhaseProgressContainer>\n                  <PhaseText>\n                    {(() => {\n                      // Pouv novou 8-fzovou logiku\n                      if (formData.stav_stornovano || hasWorkflowState(formData.stav_workflow_kod, 'ZRUSENA')) {\n                        return \"Stornovan objednvka\";\n                      }\n\n                      // Pouit currentPhase z getCurrentPhase()\n                      const phaseLabels = {\n                        1: isChanged ? \"Fze 1/8: Koncept\" : \"Fze 1/8: Nov objednvka\",\n                        2: \"Fze 2/8: Ke schvlen\",\n                        3: \"Fze 3/8: Schvlen objednvka\",\n                        4: \"Fze 4/8: Dodavatel + Registr\",\n                        5: \"Fze 5/8: Vyplnn registru\",\n                        6: \"Fze 6/8: Fakturace\",\n                        7: \"Fze 7/8: Vcn sprvnost\",\n                        8: \"Fze 8/8: Zkontrolovno\"\n                      };\n\n                      return phaseLabels[currentPhase] || (isChanged ? \"Fze 1/8: Koncept\" : \"Fze 1/8: Nov objednvka\");\n                    })()}\n                  </PhaseText>\n\n                  {/* Progresn barevn indiktor */}\n                  <PhaseProgressBar>\n                    {phaseProgressOverride.phases.map((phase, index) => (\n                      <PhaseSegment key={phase.id}>\n                        <PhaseSegmentFill\n                          className={phase.fillClass}\n                          style={{\n                            opacity: phase.isVisible ? 1 : 0.15,\n                            transform: phase.isVisible ? 'scaleX(1)' : 'scaleX(0.1)',\n                            transformOrigin: 'left'\n                          }}\n                        />\n                      </PhaseSegment>\n                    ))}\n                  </PhaseProgressBar>\n                </PhaseProgressContainer>\n\n                {/*  Zbvajc stka Smlouvy - zobrazit pouze pokud je vybrn zpsob \"Smlouva\" */}\n                {(() => {\n                  const selectedSource = financovaniOptions.find(opt => opt.kod === formData.zpusob_financovani);\n                  const nazev = selectedSource?.nazev || '';\n                  const isSmlouvaActive = nazev.includes('Smlouva');\n                  return isSmlouvaActive;\n                })() && formData.cislo_smlouvy && smlouvaDetail && !smlouvaDetail.notFound && !loadingSmlouvaDetail && (\n                  (() => {\n                    const celkovaCastka = parseFloat(\n                      smlouvaDetail.hodnota_s_dph || \n                      smlouvaDetail.celkova_castka || \n                      0\n                    );\n                    const cerpano = parseFloat(\n                      smlouvaDetail.cerpano_celkem ||\n                      smlouvaDetail.cerpano || \n                      0\n                    );\n                    \n                    //  Vpoet rezervovan stky podle fze objednvky\n                    let rezervovanaCastka = 0;\n                    \n                    // Pro EDITOVANOU objednvku (m ID) ve fzi 7-8:\n                    // Backend ji m tuto objednvku zapotanou v cerpano_celkem\n                    // Proto neodetme znovu, jinak bychom odeetli dvakrt!\n                    const jeUlozenaObjednavka = formData.id && formData.id > 0;\n                    const jeVeFazi78 = currentPhase >= 7; // VECNA_SPRAVNOST, DOKONCENA\n                    \n                    if (!jeUlozenaObjednavka || !jeVeFazi78) {\n                      // Pro NOVOU objednvku NEBO pro objednvku ped fz 7-8:\n                      // Odetme rezervovanou stku\n                      \n                      const isPhase12 = currentPhase <= 2; // NOVA, KE_SCHVALENI\n                      const isPhase36 = currentPhase >= 3 && currentPhase <= 6; // SCHVALENA a FAKTURACE\n                      \n                      if (isPhase12) {\n                        // Fze 1-2: Rezervovat max_cena_s_dph\n                        rezervovanaCastka = parseFloat(formData.max_cena_s_dph || 0);\n                      } else if (isPhase36) {\n                        // Fze 3-6: Rezervovat souet poloek objednvky\n                        if (formData.polozky_objednavky && Array.isArray(formData.polozky_objednavky) && formData.polozky_objednavky.length > 0) {\n                          rezervovanaCastka = formData.polozky_objednavky.reduce((sum, polozka) => {\n                            //  FIX: Odstranit formtovn ped parseFloat\n                            const cena = parseFloat((polozka.cena_s_dph || polozka.celkova_cena || '0').toString().replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\n                            const mnozstvi = parseFloat(polozka.mnozstvi || 1);\n                            return sum + (cena * mnozstvi);\n                          }, 0);\n                        }\n                        // Pokud nejsou poloky nebo je souet 0, pouij max_cena_s_dph\n                        if (rezervovanaCastka === 0) {\n                          rezervovanaCastka = parseFloat(formData.max_cena_s_dph || 0);\n                        }\n                      } else if (jeVeFazi78) {\n                        // Fze 7-8 pro NOVOU objednvku: Rezervovat skutenou stku z faktur\n                        if (formData.faktury && Array.isArray(formData.faktury)) {\n                          rezervovanaCastka = formData.faktury.reduce((sum, faktura) => {\n                            return sum + parseFloat(faktura.celkova_castka || faktura.castka || 0);\n                          }, 0);\n                        }\n                      }\n                    }\n                    \n                    // Zbvajc stka = celkov stka smlouvy - erpno - rezervovno (pokud nen zapotno)\n                    const zbyva = celkovaCastka - cerpano - rezervovanaCastka;\n                    const isNegative = zbyva < 0;\n                    \n                    return (\n                      <div style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '8px',\n                        padding: '4px 10px',\n                        background: isNegative\n                          ? 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)'\n                          : 'linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)',\n                        border: `2px solid ${isNegative ? '#fca5a5' : '#86efac'}`,\n                        borderRadius: '6px',\n                        fontSize: '0.75rem',\n                        fontWeight: 600,\n                        color: isNegative ? '#991b1b' : '#15803d',\n                        boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\n                        whiteSpace: 'nowrap'\n                      }}>\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1px', alignItems: 'flex-end' }}>\n                          <div style={{ fontSize: '0.6rem', opacity: 0.8, fontWeight: 500 }}>\n                            SMLOUVA {formData.cislo_smlouvy}\n                          </div>\n                          <div style={{ fontSize: '0.85rem', fontWeight: 700 }}>\n                            {Math.abs(zbyva).toLocaleString('cs-CZ', { minimumFractionDigits: 0, maximumFractionDigits: 0 })} K\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })()\n                )}\n              </div>\n              <PhaseDivider />\n\n              <FormActions>\n                <ActionButton\n                  className=\"save-btn\"\n                  onClick={handleSaveOrder}\n                  disabled={\n                    isSaving ||\n                    showSaveProgress ||\n                    !canSaveOrder ||\n                    (isWorkflowCompleted && !canUnlockAnything) ||\n                    isLoadingEvCislo ||  //  EEN #1: Blokovat bhem loading\n                    !isValidEvCislo(formData.ev_cislo)  //  EEN #3: Blokovat pokud nen platn\n                  }\n                  title={\n                    isLoadingEvCislo\n                      ? 'Nat se evidenn slo...'\n                      : !isValidEvCislo(formData.ev_cislo)\n                        ? 'Evidenn slo se nepodailo nast'\n                        : (isWorkflowCompleted && !canUnlockAnything)\n                          ? 'Objednvka je dokonena/zamtnuta/stornovna a uzamena'\n                          : !canSaveOrder\n                            ? 'Nemte oprvnn k ukldn objednvek'\n                            : 'Uloit objednvku'\n                  }\n                >\n                  <FontAwesomeIcon icon={faSave} />\n                  {isLoadingEvCislo ? 'Natm slo...' : isSaving ? 'Ukldm...' : 'ULOIT'}\n                </ActionButton>\n\n                <ActionButton\n                  className=\"cancel-btn\"\n                  onClick={handleCancelOrder}\n                  title=\"Zavt formul\"\n                  disabled={showSaveProgress || isSaving}\n                >\n                  <FontAwesomeIcon icon={faTimes} />\n                  ZAVT\n                </ActionButton>\n              </FormActions>\n            </PhaseRow>\n            )}\n\n            {/* Progress indiktor po uloen objednvky */}\n            {showSaveProgress && (\n              <div style={{\n                padding: '1rem',\n                backgroundColor: '#f0f9ff',\n                borderTop: '1px solid #0ea5e9',\n                borderBottom: '1px solid #0ea5e9',\n              }}>\n                <div style={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: '1rem',\n                  marginBottom: '0.75rem'\n                }}>\n                  <div style={{\n                    fontSize: '1.5rem'\n                  }}>\n                    \n                  </div>\n                  <div>\n                    <div style={{\n                      fontWeight: '600',\n                      color: '#0c4a6e',\n                      fontSize: '1rem',\n                      marginBottom: '0.25rem'\n                    }}>\n                      Objednvka byla spn uloena!\n                    </div>\n                    <div style={{\n                      color: '#075985',\n                      fontSize: '0.875rem'\n                    }}>\n                      {saveProgressText}\n                    </div>\n                  </div>\n                </div>\n\n                {/* Progress bar */}\n                <div style={{\n                  width: '100%',\n                  height: '8px',\n                  backgroundColor: '#e0f2fe',\n                  borderRadius: '4px',\n                  overflow: 'hidden'\n                }}>\n                  <div style={{\n                    width: `${saveProgress}%`,\n                    height: '100%',\n                    backgroundColor: '#0ea5e9',\n                    transition: 'width 2s linear',\n                    borderRadius: '4px'\n                  }} />\n                </div>\n\n                <div style={{\n                  marginTop: '0.5rem',\n                  fontSize: '0.75rem',\n                  color: '#0369a1',\n                  textAlign: 'center'\n                }}>\n                  Pesmrovvm na seznam objednvek...\n                </div>\n              </div>\n            )}\n          </FixedHeaderContent>\n        </FixedHeader>\n\n        {/* Scrollovateln obsah s tab navigac */}\n        <ScrollableContent ref={scrollableContentRef} onKeyDown={handleFormKeyDown}>\n          <ScrollableInner>\n\n          {/* Sekce: Informace o objednateli */}\n          <FormSection data-section=\"objednatel\">\n        <SectionHeader\n          sectionTheme={getSectionTheme('objednatel')}\n          isActive={isSectionActive('objednatel')}\n        >\n          <SectionTitle sectionTheme={getSectionTheme('objednatel')}>\n            <SectionIcon sectionTheme={getSectionTheme('objednatel')}>\n              <FontAwesomeIcon icon={faUser} />\n            </SectionIcon>\n            Informace o objednateli\n            {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n            {shouldLockPhase1Sections && !shouldLockAllSections && (\n              <LockWarning title=\"FZE 1 a FZE 2 sekce jsou zameny pokud je aktivn FZE 3. Odemen resetuje workflow na ODESLNA KE SCHVLEN a vymae data FZE 3+.\">\n                 Sekce zamena\n              </LockWarning>\n            )}\n          </SectionTitle>\n          <SectionControls>\n            {/*  Nezobrazovat tlatko odemknut kdy je globln lock (shouldLockAllSections) */}\n            {shouldLockPhase1Sections && !shouldLockAllSections && canEditApprovedSections && (\n              <UnlockButton\n                onClick={(e) => {\n                  e.stopPropagation();\n                  setShowUnlockPhase1Confirm(true);\n                }}\n                title=\"Odemknout FZI 2 (Info o objednateli) - resetuje workflow na ODESLNA KE SCHVLEN\"\n              >\n                <Unlock />\n              </UnlockButton>\n            )}\n            <CollapseIcon\n              collapsed={sectionStates.objednatel}\n              sectionTheme={getSectionTheme('objednatel')}\n              onClick={() => toggleSection('objednatel')}\n              style={{ cursor: 'pointer' }}\n            >\n              <FontAwesomeIcon icon={faChevronUp} />\n            </CollapseIcon>\n          </SectionControls>\n        </SectionHeader>\n        <SectionContent collapsed={sectionStates.objednatel}>\n          <FormRow>\n            <FormGroup>\n              <Label required>JMNO</Label>\n              <InputWithIcon hasIcon>\n                <User />\n                <Input\n                  type=\"text\"\n                  name=\"jmeno\"\n                  placeholder=\"Jmno objednatele\"\n                  value={formData.jmeno || ''}\n                  disabled\n                  title={isEditMode ? \"Nateno z DB podle objednatele objednvky\" : (formData.jmeno ? \"Nateno z profilu pihlenho uivatele\" : \"Vypln se automaticky pi prvn interakci\")}\n                  hasError={!!validationErrors.jmeno}\n                  hasIcon\n                />\n              </InputWithIcon>\n              {validationErrors.jmeno && (\n                <ErrorText>{validationErrors.jmeno}</ErrorText>\n              )}\n            </FormGroup>\n            <FormGroup>\n              <Label required>E-MAIL</Label>\n              <InputWithIcon hasIcon>\n                <Mail />\n                <Input\n                  type=\"email\"\n                  name=\"email\"\n                  value={formData.email || ''}\n                  disabled\n                  title={isEditMode ? \"Nateno z DB podle objednatele objednvky\" : (formData.email ? \"Nateno z profilu pihlenho uivatele\" : \"Vypln se automaticky pi prvn interakci\")}\n                  hasError={!!validationErrors.email}\n                  hasIcon\n                />\n              </InputWithIcon>\n              {validationErrors.email && (\n                <ErrorText>{validationErrors.email}</ErrorText>\n              )}\n            </FormGroup>\n            <FormGroup>\n              <Label>TELEFON</Label>\n              <InputWithIcon hasIcon>\n                <Phone />\n                <Input\n                  type=\"tel\"\n                  value={formData.telefon || ''}\n                  disabled\n                  placeholder={formData.telefon ? '' : (isEditMode ? \"Telefon nen v DB uveden\" : \"Vypln se automaticky pi prvn interakci\")}\n                  title={isEditMode ? \"Nateno z DB podle objednatele objednvky\" : (formData.telefon ? \"Nateno z profilu pihlenho uivatele\" : \"Vypln se automaticky pi prvn interakci\")}\n                  hasIcon\n                />\n              </InputWithIcon>\n            </FormGroup>\n          </FormRow>\n          <FormRow>\n            <FormGroup data-custom-select>\n              <LabelWithClear>\n                <LabelText required>GARANT</LabelText>\n                <ClearSelectButton\n                  type=\"button\"\n                  $visible={!!formData.garant_uzivatel_id}\n                  onClick={() => handleInputChange('garant_uzivatel_id', '')}\n                  title=\"Vymazat vbr\"\n                >\n                  <X size={12} />\n                </ClearSelectButton>\n              </LabelWithClear>\n              <StableCustomSelect\n                value={formData.garant_uzivatel_id || ''}\n                onChange={(selectedValue) => handleInputChange('garant_uzivatel_id', selectedValue)}\n                onBlur={(field, value) => handleFieldBlur('garant_uzivatel_id', value)}\n                options={garantOptions}\n                placeholder=\"Vyberte garanta\"\n                disabled={shouldLockPhase1Sections}\n                hasError={!!validationErrors.garant_uzivatel_id}\n                required={true}\n                field=\"garant\"\n                loading={false}\n                loadingText=\"\"\n                icon={<User />}\n                getOptionLabel={getOptionLabel}\n                getOptionValue={(option, field) => option.id || option.user_id || option}\n                hasTriedToSubmit={hasTriedToSubmit}\n              />\n              {(validationErrors.garant_uzivatel_id || (hasTriedToSubmit && !formData.garant_uzivatel_id)) && (\n                <ErrorText>\n                  {validationErrors.garant_uzivatel_id || 'Garant je povinn'}\n                </ErrorText>\n              )}\n            </FormGroup>\n          </FormRow>\n        </SectionContent>\n      </FormSection>\n\n      {/* Sekce: Schvlen nkupu PO */}\n      <FormSection data-section=\"schvaleni\">\n        <SectionHeader\n          sectionTheme={getSectionTheme('schvaleni')}\n          isActive={isSectionActive('schvaleni')}\n        >\n          <SectionTitle sectionTheme={getSectionTheme('schvaleni')}>\n            <SectionIcon sectionTheme={getSectionTheme('schvaleni')}>\n              <FontAwesomeIcon icon={faClipboardCheck} />\n            </SectionIcon>\n            Schvlen nkupu PO\n            {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n            {shouldLockPhase1Sections && !shouldLockAllSections && (\n              <LockWarning title=\"FZE 1 a FZE 2 sekce jsou zameny pokud je aktivn FZE 3. Odemen umon editaci FZE 1 a 2.\">\n                 Sekce zamena\n              </LockWarning>\n            )}\n          </SectionTitle>\n          <SectionControls>\n            {/*  Nezobrazovat tlatko odemknut kdy je globln lock (shouldLockAllSections) */}\n            {shouldLockPhase1Sections && !shouldLockAllSections && canEditApprovedSections && (\n              <UnlockButton\n                onClick={(e) => {\n                  e.stopPropagation();\n                  setShowUnlockPhase2Confirm(true);\n                }}\n                title=\"Odemknout FZI 2 (PO sekce) - resetuje workflow na ODESLNA KE SCHVLEN\"\n              >\n                <Unlock />\n              </UnlockButton>\n            )}\n            <CollapseIcon\n              collapsed={sectionStates.schvaleni}\n              sectionTheme={getSectionTheme('schvaleni')}\n              onClick={() => toggleSection('schvaleni')}\n              style={{ cursor: 'pointer' }}\n            >\n              <FontAwesomeIcon icon={faChevronUp} />\n            </CollapseIcon>\n          </SectionControls>\n        </SectionHeader>\n        <SectionContent collapsed={sectionStates.schvaleni}>\n          <FormRow>\n            <FormGroup style={{gridColumn: '1 / -1'}}>\n              <Label required>PEDMT</Label>\n              <InputWithIcon hasIcon>\n                <FileText />\n                <Input\n                  type=\"text\"\n                  name=\"predmet\"\n                  placeholder=\"Zadejte pedmt objednvky\"\n                  value={formData.predmet || ''}\n                  onChange={(e) => handleInputChange('predmet', e.target.value)}\n                  onBlur={() => handleFieldBlur('predmet', formData.predmet)}\n                  disabled={shouldLockPhase1Sections}\n                  hasError={!!validationErrors.predmet}\n                  hasIcon\n                />\n              </InputWithIcon>\n              {validationErrors.predmet && (\n                <ErrorText>{validationErrors.predmet}</ErrorText>\n              )}\n            </FormGroup>\n          </FormRow>\n          <FormRow>\n            <FormGroup data-custom-select>\n              <LabelWithClear>\n                <LabelText required>SCHVALOVATEL/PKAZCE</LabelText>\n                <ClearSelectButton\n                  type=\"button\"\n                  $visible={!!formData.prikazce_id}\n                  onClick={() => handleInputChange('prikazce_id', '')}\n                  title=\"Vymazat vbr\"\n                >\n                  <X size={12} />\n                </ClearSelectButton>\n              </LabelWithClear>\n              <StableCustomSelect\n                value={formData.prikazce_id || ''}\n                onChange={(selectedValue) => handleInputChange('prikazce_id', selectedValue)}\n                onBlur={(field, value) => handleFieldBlur('prikazce_id', value)}\n                options={approvers}\n                placeholder=\"Vyberte pkazce operace\"\n                disabled={shouldLockPhase1Sections}\n                hasError={!!validationErrors.prikazce_id}\n                required={true}\n                field=\"prikazce\"\n                loading={false}\n                loadingText=\"\"\n                icon={<Users />}\n                getOptionLabel={getOptionLabel}\n                getOptionValue={(option, field) => option.id || option.user_id || option}\n                hasTriedToSubmit={hasTriedToSubmit}\n              />\n              {(validationErrors.prikazce_id || (hasTriedToSubmit && !formData.prikazce_id)) && (\n                <ErrorText>\n                  {validationErrors.prikazce_id || 'Pkazce je povinn'}\n                </ErrorText>\n              )}\n            </FormGroup>\n            <FormGroup>\n              <Label required>MAXIMLN CENA S DPH</Label>\n              <CurrencyInput\n                fieldName=\"max_cena_s_dph\"\n                value={formData.max_cena_s_dph || ''}\n                onChange={handleCurrencyChange}\n                onBlur={handleFieldBlur}\n                disabled={shouldLockPhase1Sections}\n                hasError={!!validationErrors.max_cena_s_dph}\n                placeholder=\"380 000 K\"\n              />\n              {validationErrors.max_cena_s_dph && (\n                <ErrorText>{validationErrors.max_cena_s_dph}</ErrorText>\n              )}\n            </FormGroup>\n            <FormGroup>\n              <Label>MIMODN UDLOST</Label>\n              <EmergencyToggleWrapper disabled={shouldLockPhase1Sections} style={{ height: '50px' }}>\n                <EmergencyToggleSwitch \n                  checked={formData.mimoradna_udalost || false}\n                  disabled={shouldLockPhase1Sections}\n                  >\n                  <input\n                    type=\"checkbox\"\n                    checked={formData.mimoradna_udalost || false}\n                    onChange={(e) => handleInputChange('mimoradna_udalost', e.target.checked)}\n                    disabled={shouldLockPhase1Sections}\n                  />\n                  <span />\n                </EmergencyToggleSwitch>\n                <EmergencyToggleLabel checked={formData.mimoradna_udalost || false}>\n                  {formData.mimoradna_udalost ? 'Krize / Havrie' : 'Bn objednvka'}\n                </EmergencyToggleLabel>\n              </EmergencyToggleWrapper>\n            </FormGroup>\n          </FormRow>\n          <FormRow>\n            <FormGroup data-custom-select style={{gridColumn: '1 / -1'}}>\n              <LabelWithClear>\n                <LabelText required>STEDISKO</LabelText>\n                <ClearSelectButton\n                  type=\"button\"\n                  $visible={Array.isArray(formData.strediska_kod) && formData.strediska_kod.length > 0}\n                  onClick={() => handleInputChange('strediska_kod', [])}\n                  title=\"Vymazat vbr\"\n                >\n                  <X size={12} />\n                </ClearSelectButton>\n              </LabelWithClear>\n              <StableCustomSelect\n                value={formData.strediska_kod || []}\n                onChange={(selectedValues) => handleInputChange('strediska_kod', selectedValues)}\n                onBlur={(field, value) => handleFieldBlur('strediska_kod', value)}\n                options={strediskaOptions}\n                placeholder=\"Vyberte stediska pro objednvku\"\n                field=\"strediska\"\n                disabled={shouldLockPhase1Sections}\n                hasError={!!validationErrors.strediska_kod}\n                required={true}\n                multiple={true}\n                icon={<Building />}\n                getOptionLabel={getOptionLabel}\n                getOptionValue={(option, field) => option.value || option.id || option}\n                hasTriedToSubmit={hasTriedToSubmit}\n              />\n              {validationErrors.strediska_kod && (\n                <ErrorText style={{ marginTop: '0.5rem', display: 'block' }}>\n                  {validationErrors.strediska_kod}\n                </ErrorText>\n              )}\n            </FormGroup>\n          </FormRow>\n\n          {/*  Sekce: Financovn objednvky - PESUNUTO Z FZE 3 DO FZE 1/2 */}\n          <FormRow style={{ marginTop: '1.5rem' }}>\n            <FormGroup style={{gridColumn: '1 / -1'}}>\n              {/* ediv oddlovac linka NAD sekc financovn */}\n              <div style={{\n                borderTop: '1px solid #d1d5db',\n                marginBottom: '1.5rem'\n              }} />\n\n              <FormRow>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  <LabelWithClear>\n                    <LabelText required>ZPSOB FINANCOVN</LabelText>\n                    <ClearSelectButton\n                      type=\"button\"\n                      $visible={!!formData.zpusob_financovani}\n                      onClick={() => handleInputChange('zpusob_financovani', '')}\n                      title=\"Vymazat vbr\"\n                    >\n                      <X size={12} />\n                    </ClearSelectButton>\n                  </LabelWithClear>\n                  <StableCustomSelect\n                    value={formData.zpusob_financovani || ''}\n                    onChange={(selectedValue) => handleInputChange('zpusob_financovani', selectedValue)}\n                    onBlur={(field, value) => handleFieldBlur('zpusob_financovani', value)}\n                    options={financovaniOptions}\n                    placeholder=\"Vyberte zdroj financovn...\"\n                    field=\"zpusob_financovani\"\n                    loading={false}\n                    loadingText=\"\"\n                    icon={<Coins />}\n                    disabled={shouldLockFinancovaniSection}\n                    hasError={!!validationErrors.zpusob_financovani}\n                    required={true}\n                    getOptionLabel={getOptionLabel}\n                    getOptionValue={(option, field) => option.kod_stavu || option.kod || option.id || option}\n                  />\n                  {validationErrors.zpusob_financovani && (\n                    <ErrorText>{validationErrors.zpusob_financovani}</ErrorText>\n                  )}\n                </FormGroup>\n              </FormRow>\n\n              {/* LP KD - zobrazit pouze kdy je vybran Limitovan pslib */}\n              {(() => {\n                const selectedSource = financovaniOptions.find(opt => opt.kod_stavu === formData.zpusob_financovani || opt.kod === formData.zpusob_financovani);\n                const nazev = selectedSource?.nazev_stavu || selectedSource?.nazev || '';\n                return nazev.includes('Limitovan') || nazev.includes('pslib');\n              })() && (\n                <FormRow>\n                  <FormGroup style={{gridColumn: '1 / -1'}}>\n                    <LabelWithClear>\n                      <LabelText required>LP KD</LabelText>\n                      <ClearSelectButton\n                        type=\"button\"\n                        $visible={Array.isArray(formData.lp_kod) && formData.lp_kod.length > 0}\n                        onClick={() => handleInputChange('lp_kod', [])}\n                        title=\"Vymazat vbr\"\n                      >\n                        <X size={12} />\n                      </ClearSelectButton>\n                    </LabelWithClear>\n                    <StableCustomSelect\n                      value={formData.lp_kod || []}\n                      onChange={(selectedValues) => handleInputChange('lp_kod', selectedValues)}\n                      onBlur={(field, value) => handleFieldBlur('lp_kod', value)}\n                      options={filteredLpKodyOptions}\n                      placeholder={(() => {\n                        if (!formData.prikazce_id) return \"Nejprve vyberte pkazce\";\n                        if (filteredLpKodyOptions.length === 0) return \"dn dostupn LP kdy\";\n                        \n                        // Zobrazit prvnch 4-5 LP kd\n                        const maxShow = 5;\n                        const lpCodes = filteredLpKodyOptions\n                          .slice(0, maxShow)\n                          .map(lp => lp.cislo_lp || lp.kod)\n                          .join(', ');\n                        \n                        const hasMore = filteredLpKodyOptions.length > maxShow;\n                        return hasMore ? `nap. ${lpCodes}, ...` : `nap. ${lpCodes}`;\n                      })()}\n                      field=\"lp_kod\"\n                      loading={false}\n                      loadingText=\"\"\n                      icon={<Hash />}\n                      disabled={shouldLockFinancovaniSection || !formData.prikazce_id}\n                      hasError={!!validationErrors.lp_kod}\n                      required={true}\n                      multiple={true}\n                      getOptionLabel={getOptionLabel}\n                      // getOptionValue ODEBRN - pouij default (opt.id || opt.value || opt)\n                    />\n                    {validationErrors.lp_kod && (\n                      <ErrorText>{validationErrors.lp_kod}</ErrorText>\n                    )}\n                  </FormGroup>\n                </FormRow>\n              )}\n\n              {(() => {\n                const selectedSource = financovaniOptions.find(opt => opt.kod === formData.zpusob_financovani);\n                const nazev = selectedSource?.nazev || '';\n                return nazev.includes('Smlouva');\n              })() && (\n                <>\n                  <FormRow style={{gridTemplateColumns: '1fr 2fr'}}>\n                    <FormGroup>\n                      <Label required>SLO SMLOUVY</Label>\n                      <SmlouvaAutocompleteContainer>\n                        <InputWithIcon hasIcon style={\n                          formData.cislo_smlouvy && smlouvaDetail && !smlouvaDetail.notFound && \n                          (smlouvaDetail.stav === 'VYPRSELA' || smlouvaDetail.stav === 'UKONCENA')\n                            ? { border: '2px solid #f97316', borderRadius: '6px' }\n                            : {}\n                        }>\n                          <Search />\n                          <Input\n                            type=\"text\"\n                            name=\"cislo_smlouvy\"\n                            placeholder=\"Zante pst slo smlouvy...\"\n                            value={smlouvaSearchTerm}\n                            onChange={(e) => {\n                              const value = e.target.value;\n                              setSmlouvaSearchTerm(value);\n                              setShowSmlouvySuggestions(value.length > 0);\n                              setSelectedSmlouvaSuggestionIndex(-1);\n                              \n                              // Pokud uivatel mae text, vyistit i formData\n                              if (!value) {\n                                handleInputChange('cislo_smlouvy', '');\n                              }\n                            }}\n                            onKeyDown={(e) => {\n                              if (!showSmlouvySuggestions) return;\n                              \n                              const searchLower = normalizeText(smlouvaSearchTerm);\n                              const filtered = smlouvyList.filter(s => {\n                                if (s.aktivni == 0 || s.aktivni === false) return false;\n                                const cislo = normalizeText(s.cislo_smlouvy || s.evidencni_cislo || '');\n                                const nazev = normalizeText(s.nazev_smlouvy || s.predmet || '');\n                                const firma = normalizeText(s.nazev_firmy || '');\n                                const ico = normalizeText(s.ico || '');\n                                const usek = normalizeText(s.usek_zkr || '');\n                                return cislo.includes(searchLower) || \n                                       nazev.includes(searchLower) || \n                                       firma.includes(searchLower) || \n                                       ico.includes(searchLower) || \n                                       usek.includes(searchLower);\n                              }).slice(0, 10);\n                              \n                              if (e.key === 'ArrowDown') {\n                                e.preventDefault();\n                                setSelectedSmlouvaSuggestionIndex(prev => \n                                  prev < filtered.length - 1 ? prev + 1 : prev\n                                );\n                              } else if (e.key === 'ArrowUp') {\n                                e.preventDefault();\n                                setSelectedSmlouvaSuggestionIndex(prev => \n                                  prev > 0 ? prev - 1 : -1\n                                );\n                              } else if (e.key === 'Enter' && selectedSmlouvaSuggestionIndex >= 0) {\n                                e.preventDefault();\n                                const selected = filtered[selectedSmlouvaSuggestionIndex];\n                                if (selected) {\n                                  const cislo = selected.cislo_smlouvy || selected.evidencni_cislo;\n                                  handleInputChange('cislo_smlouvy', cislo);\n                                  setSmlouvaSearchTerm(cislo);\n                                  setShowSmlouvySuggestions(false);\n                                  setSelectedSmlouvaSuggestionIndex(-1);\n                                }\n                              } else if (e.key === 'Escape') {\n                                setShowSmlouvySuggestions(false);\n                                setSelectedSmlouvaSuggestionIndex(-1);\n                              }\n                            }}\n                            onFocus={() => {\n                              // Zobrazit suggestions pi focusu, pokud u m njak search term\n                              if (smlouvaSearchTerm && smlouvaSearchTerm.length > 0) {\n                                setShowSmlouvySuggestions(true);\n                              }\n                            }}\n                            onBlur={(e) => {\n                              // Delay hiding to allow click on suggestion\n                              setTimeout(() => {\n                                setShowSmlouvySuggestions(false);\n                                setSelectedSmlouvaSuggestionIndex(-1);\n                                \n                                //  VALIDACE: Pokud search term neodpovd dn aktivn smlouv, vyistit pole\n                                const searchValue = smlouvaSearchTerm.trim();\n                                if (searchValue) {\n                                  const existsInList = smlouvyList.some(s => \n                                    (s.aktivni !== 0 && s.aktivni !== false) &&\n                                    (s.cislo_smlouvy === searchValue || s.evidencni_cislo === searchValue)\n                                  );\n                                  \n                                  if (existsInList) {\n                                    // Je platn smlouva - zajistit, e je uloen do formData\n                                    if (formData.cislo_smlouvy !== searchValue) {\n                                      handleInputChange('cislo_smlouvy', searchValue);\n                                    }\n                                  } else {\n                                    // Nevybral dnou platnou smlouvu - vyistit\n                                    handleInputChange('cislo_smlouvy', '');\n                                    setSmlouvaSearchTerm('');\n                                    showToast('Vyberte prosm smlouvu ze seznamu', 'warning');\n                                  }\n                                }\n                              }, 200);\n                            }}\n                            disabled={shouldLockFinancovaniSection}\n                            hasError={!!validationErrors.cislo_smlouvy}\n                            hasIcon\n                          />\n                        </InputWithIcon>\n                        \n                        {/* Autocomplete dropdown */}\n                        {showSmlouvySuggestions && smlouvaSearchTerm && smlouvaSearchTerm.length > 0 && (\n                          <SmlouvaSuggestionsList>\n                            {(() => {\n                              const searchLower = normalizeText(smlouvaSearchTerm);\n                              //  FILTR: Vylouit neaktivn smlouvy (aktivni == 0)\n                              const filtered = smlouvyList.filter(s => {\n                                // Vylouit neaktivn (aktivni == 0)\n                                if (s.aktivni == 0 || s.aktivni === false) return false;\n                                \n                                const cislo = normalizeText(s.cislo_smlouvy || s.evidencni_cislo || '');\n                                const nazev = normalizeText(s.nazev_smlouvy || s.predmet || '');\n                                const firma = normalizeText(s.nazev_firmy || '');\n                                const ico = normalizeText(s.ico || '');\n                                const usek = normalizeText(s.usek_zkr || '');\n                                \n                                return cislo.includes(searchLower) || \n                                       nazev.includes(searchLower) || \n                                       firma.includes(searchLower) || \n                                       ico.includes(searchLower) || \n                                       usek.includes(searchLower);\n                              }).slice(0, 10);\n\n                              if (loadingSmlouvyList) {\n                                return (\n                                  <SmlouvaSuggestionEmpty>\n                                     Natm smlouvy...\n                                  </SmlouvaSuggestionEmpty>\n                                );\n                              }\n\n                              if (filtered.length === 0) {\n                                return (\n                                  <SmlouvaSuggestionEmpty>\n                                     dn smlouva nenalezena\n                                  </SmlouvaSuggestionEmpty>\n                                );\n                              }\n\n                              return filtered.map((smlouva, index) => {\n                                //  Kontrola vypren smlouvy\n                                const jeVyprsela = smlouva.stav === 'VYPRSELA' || smlouva.stav === 'UKONCENA';\n                                const isSelected = index === selectedSmlouvaSuggestionIndex;\n                                \n                                return (\n                                  <SmlouvaSuggestionItem\n                                    key={smlouva.id}\n                                    onMouseDown={(e) => {\n                                      // onMouseDown se spust PED onBlur inputu, take hodnota se nastav vas\n                                      e.preventDefault(); // Zabrn blur eventu\n                                      const cislo = smlouva.cislo_smlouvy || smlouva.evidencni_cislo;\n                                      handleInputChange('cislo_smlouvy', cislo);\n                                      setSmlouvaSearchTerm(cislo);\n                                      setShowSmlouvySuggestions(false);\n                                      setSelectedSmlouvaSuggestionIndex(-1);\n                                    }}\n                                    style={{\n                                      ...(jeVyprsela ? { borderLeft: '3px solid #f97316', opacity: 0.8 } : {}),\n                                      ...(isSelected ? { backgroundColor: '#eff6ff', borderLeft: '3px solid #3b82f6' } : {})\n                                    }}\n                                  >\n                                    <SmlouvaSuggestionTitle>\n                                      {smlouva.cislo_smlouvy || smlouva.evidencni_cislo}\n                                      {jeVyprsela && <span style={{ color: '#f97316', marginLeft: '8px', fontSize: '0.85em' }}> VYPRELA</span>}\n                                    </SmlouvaSuggestionTitle>\n                                    <SmlouvaSuggestionMeta>\n                                      {smlouva.nazev_smlouvy && <span>{smlouva.nazev_smlouvy}</span>}\n                                      {smlouva.celkova_castka && (\n                                        <span>\n                                          {new Intl.NumberFormat('cs-CZ', { \n                                            style: 'currency', \n                                            currency: 'CZK',\n                                            minimumFractionDigits: 0,\n                                            maximumFractionDigits: 0\n                                          }).format(smlouva.celkova_castka)}\n                                        </span>\n                                      )}\n                                    </SmlouvaSuggestionMeta>\n                                    {smlouva.nazev_firmy && (\n                                      <SmlouvaSuggestionMeta style={{ fontSize: '0.8em', color: '#6b7280', marginTop: '2px' }}>\n                                        <span> {smlouva.nazev_firmy}{smlouva.ico ? ` (${smlouva.ico})` : ''}{smlouva.usek_zkr ? ` | ${smlouva.usek_zkr}` : ''}</span>\n                                      </SmlouvaSuggestionMeta>\n                                    )}\n                                  </SmlouvaSuggestionItem>\n                                );\n                              });\n                            })()}\n                          </SmlouvaSuggestionsList>\n                        )}\n                      </SmlouvaAutocompleteContainer>\n                      \n                      {validationErrors.cislo_smlouvy && (\n                        <ErrorText>{validationErrors.cislo_smlouvy}</ErrorText>\n                      )}\n                    </FormGroup>\n                    <FormGroup>\n                      <Label>POZNMKA KE SMLOUV</Label>\n                      <InputWithIcon hasIcon>\n                        <FileText />\n                        <Input\n                          type=\"text\"\n                          name=\"smlouva_poznamka\"\n                          placeholder=\"Dodaten informace o smlouv\"\n                          value={formData.smlouva_poznamka || ''}\n                          onChange={(e) => handleInputChange('smlouva_poznamka', e.target.value)}\n                          onBlur={() => handleFieldBlur('smlouva_poznamka', formData.smlouva_poznamka)}\n                          disabled={shouldLockFinancovaniSection}\n                          hasError={!!validationErrors.smlouva_poznamka}\n                          hasIcon\n                        />\n                      </InputWithIcon>\n                      {validationErrors.smlouva_poznamka && (\n                        <ErrorText>{validationErrors.smlouva_poznamka}</ErrorText>\n                      )}\n                    </FormGroup>\n                  </FormRow>\n                  \n                  {/*  VAROVN PRO VYPRELOU SMLOUVU - pes celou ku */}\n                  {formData.cislo_smlouvy && smlouvaDetail && !smlouvaDetail.notFound && \n                    (smlouvaDetail.stav === 'VYPRSELA' || smlouvaDetail.stav === 'UKONCENA') && (\n                    <div style={{\n                      marginTop: '-8px',\n                      marginBottom: '16px',\n                      padding: '8px 12px',\n                      background: '#fff7ed',\n                      border: '2px solid #f97316',\n                      borderRadius: '6px',\n                      color: '#c2410c',\n                      fontSize: '0.9rem',\n                      fontWeight: 600,\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '8px'\n                    }}>\n                       Smlouva ji vyprela!!! \n                      {smlouvaDetail.platnost_do && (\n                        <span style={{ fontSize: '0.85rem', fontWeight: 500 }}>\n                          Platnost byla do {new Date(smlouvaDetail.platnost_do).toLocaleDateString('cs-CZ')}\n                        </span>\n                      )}\n                    </div>\n                  )}\n\n\n                </>\n              )}\n\n              {(() => {\n                const selectedSource = financovaniOptions.find(opt => opt.kod === formData.zpusob_financovani);\n                const nazev = selectedSource?.nazev || '';\n                return nazev.includes('Individuln') && !nazev.includes('Pojistn');\n              })() && (\n                <FormRow style={{gridTemplateColumns: '1fr 2fr'}}>\n                  <FormGroup>\n                    <Label required>IDENTIFIKTOR SCHVLEN</Label>\n                    <InputWithIcon hasIcon>\n                      <Hash />\n                      <Input\n                        type=\"text\"\n                        name=\"individualni_schvaleni\"\n                        placeholder=\"Automaticky generovno z ev. sla\"\n                        value={formData.individualni_schvaleni || ''}\n                        onChange={(e) => handleInputChange('individualni_schvaleni', e.target.value)}\n                        disabled={true}\n                        readOnly={true}\n                        hasError={!!validationErrors.individualni_schvaleni}\n                        hasIcon\n                        style={{ backgroundColor: '#f3f4f6', cursor: 'not-allowed' }}\n                      />\n                    </InputWithIcon>\n                    {validationErrors.individualni_schvaleni && (\n                      <ErrorText>{validationErrors.individualni_schvaleni}</ErrorText>\n                    )}\n                  </FormGroup>\n                  <FormGroup>\n                    <Label>POZNMKA</Label>\n                    <InputWithIcon hasIcon>\n                      <FileText />\n                      <Input\n                        type=\"text\"\n                        name=\"individualni_poznamka\"\n                        placeholder=\"Dvod nebo podmnky schvlen\"\n                        value={formData.individualni_poznamka || ''}\n                        onChange={(e) => handleInputChange('individualni_poznamka', e.target.value)}\n                        disabled={shouldLockFinancovaniSection}\n                        hasError={!!validationErrors.individualni_poznamka}\n                        hasIcon\n                      />\n                    </InputWithIcon>\n                    {validationErrors.individualni_poznamka && (\n                      <ErrorText>{validationErrors.individualni_poznamka}</ErrorText>\n                    )}\n                  </FormGroup>\n                </FormRow>\n              )}\n\n              {(() => {\n                const selectedSource = financovaniOptions.find(opt => opt.kod === formData.zpusob_financovani);\n                const nazev = selectedSource?.nazev || '';\n                return nazev.includes('Pojistn') && nazev.includes('udlost');\n              })() && (\n                <FormRow style={{gridTemplateColumns: '1fr 2fr'}}>\n                  <FormGroup>\n                    <Label required>SLO POJISTN UDLOSTI</Label>\n                    <InputWithIcon hasIcon>\n                      <Hash />\n                      <Input\n                        type=\"text\"\n                        name=\"pojistna_udalost_cislo\"\n                        placeholder=\"Evidenn slo kody/udlosti\"\n                        value={formData.pojistna_udalost_cislo || ''}\n                        onChange={(e) => handleInputChange('pojistna_udalost_cislo', e.target.value)}\n                        disabled={shouldLockFinancovaniSection}\n                        hasError={!!validationErrors.pojistna_udalost_cislo}\n                        hasIcon\n                      />\n                    </InputWithIcon>\n                    {validationErrors.pojistna_udalost_cislo && (\n                      <ErrorText>{validationErrors.pojistna_udalost_cislo}</ErrorText>\n                    )}\n                  </FormGroup>\n                  <FormGroup>\n                    <Label>POZNMKA K POJISTN UDLOSTI</Label>\n                    <InputWithIcon hasIcon>\n                      <FileText />\n                      <Input\n                        type=\"text\"\n                        name=\"pojistna_udalost_poznamka\"\n                        placeholder=\"Popis kody nebo okolnost udlosti\"\n                        value={formData.pojistna_udalost_poznamka || ''}\n                        onChange={(e) => handleInputChange('pojistna_udalost_poznamka', e.target.value)}\n                        disabled={shouldLockFinancovaniSection}\n                        hasError={!!validationErrors.pojistna_udalost_poznamka}\n                        hasIcon\n                      />\n                    </InputWithIcon>\n                    {validationErrors.pojistna_udalost_poznamka && (\n                      <ErrorText>{validationErrors.pojistna_udalost_poznamka}</ErrorText>\n                    )}\n                  </FormGroup>\n                </FormRow>\n              )}\n            </FormGroup>\n          </FormRow>\n\n          {/*  Sekce: Stav schvlen - v samostatnm bloku */}\n          <FormRow>\n            <FormGroup style={{gridColumn: '1 / -1'}}>\n              {/*  Sekce STAV SCHVLEN se zobraz kdy:\n                  1. Objednvka je uloena v DB (m ID)\n                  2. Workflow NEN ve stavu NOVA (tzn. m jin stav ne nov objednvka)\n                  3. Uivatel m oprvnn ke schvalovn (admin nebo ORDER_APPROVAL role)\n\n                  Zobrazuje se pro stavy: CEKA_SE, ZAMITNUTO, SCHVALENO, ODESLAN_KE_SCHVALENI a dal\n                  Skrv se pouze pro stav NOVA nebo pokud uivatel nem oprvnn */}\n              {!!formData.id &&\n               !hasWorkflowState(formData.stav_workflow_kod, 'NOVA') &&\n               (canApproveOrders || canManageOrders) && (\n                <>\n                  {/* ediv oddlovac linka NAD celou sekc schvlen */}\n                  <div style={{\n                    borderTop: '1px solid #d1d5db',\n                    marginBottom: '1.5rem',\n                    marginTop: '1rem'\n                  }} />\n\n                  <div style={{gridColumn: '1 / -1'}}>\n                    {/* Checkboxy - zobrazit JEN kdy je objednvka ULOENA v DB */}\n                    {!!formData.id && (\n                      <>\n                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>\n                          <Label style={{ fontSize: '1rem', fontWeight: '600', margin: 0 }}>\n                            STAV SCHVLEN OBJEDNVKY\n                          </Label>\n                          {isFormBasicallyValid() && formData.stav_schvaleni && (\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                              <span style={{ fontWeight: 'bold' , color: '#374151', fontSize: '0.875rem' }}>\n                                Schvaluje:\n                              </span>\n                              <span style={{\n                                fontWeight: '600',\n                                color: '#059669',\n                                backgroundColor: '#d1fae5',\n                                padding: '0.25rem 0.5rem',\n                                borderRadius: '4px',\n                                fontSize: '0.875rem'\n                              }}>\n                                {getUserNameById(user_id)}\n                              </span>\n                            </div>\n                          )}\n                        </div>\n\n                    {/* ek se */}\n                    <label style={{\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '1rem',\n                      padding: '1rem',\n                      border: '1px solid #e5e7eb',\n                      borderRadius: '8px',\n                      backgroundColor: formData.stav_schvaleni === 'ceka_se' ? '#fef3c7' : '#f9fafb',\n                      cursor: shouldLockSchvaleniCheckboxes ? 'not-allowed' : 'pointer',\n                      opacity: shouldLockSchvaleniCheckboxes ? 0.6 : 1,\n                      marginBottom: '1rem',\n                      fontSize: '1rem',\n                      fontWeight: '500',\n                      color: formData.stav_schvaleni === 'ceka_se' ? '#f59e0b' : '#374151',\n                      pointerEvents: shouldLockSchvaleniCheckboxes ? 'none' : 'auto'\n                    }}\n                    onClick={(e) => {\n                      e.preventDefault();\n                      handleRadioClick('ceka_se');\n                    }}\n                    >\n                      <input\n                        type=\"radio\"\n                        name=\"stav_schvaleni\"\n                        value=\"ceka_se\"\n                        checked={formData.stav_schvaleni === 'ceka_se'}\n                        onChange={() => {}}\n                        disabled={shouldLockSchvaleniCheckboxes}\n                        style={{\n                          width: '20px',\n                          height: '20px',\n                          accentColor: '#f59e0b',\n                          margin: 0,\n                          flexShrink: 0\n                        }}\n                      />\n                      <FontAwesomeIcon icon={faClock} size=\"lg\" />\n                      ek se\n                      {formData.stav_schvaleni === 'ceka_se' && (\n                        <span style={{\n                          marginLeft: '0.5rem',\n                          fontSize: '0.875rem',\n                          color: '#f59e0b',\n                          fontWeight: '600'\n                        }}>\n                          \n                        </span>\n                      )}\n                    </label>\n\n                    {/* Neschvleno */}\n                    <label style={{\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '1rem',\n                      padding: '1rem',\n                      border: '1px solid #e5e7eb',\n                      borderRadius: '8px',\n                      backgroundColor: formData.stav_schvaleni === 'neschvaleno' ? '#fef2f2' : '#f9fafb',\n                      cursor: shouldLockSchvaleniCheckboxes ? 'not-allowed' : 'pointer',\n                      opacity: shouldLockSchvaleniCheckboxes ? 0.6 : 1,\n                      marginBottom: '1rem',\n                      fontSize: '1rem',\n                      fontWeight: '500',\n                      color: formData.stav_schvaleni === 'neschvaleno' ? '#dc2626' : '#374151',\n                      pointerEvents: shouldLockSchvaleniCheckboxes ? 'none' : 'auto'\n                    }}\n                    onClick={(e) => {\n                      e.preventDefault();\n                      handleRadioClick('neschvaleno');\n                    }}\n                    >\n                      <input\n                        type=\"radio\"\n                        name=\"stav_schvaleni\"\n                        value=\"neschvaleno\"\n                        checked={formData.stav_schvaleni === 'neschvaleno'}\n                        onChange={() => {}}\n                        disabled={shouldLockSchvaleniCheckboxes}\n                        style={{\n                          width: '20px',\n                          height: '20px',\n                          accentColor: '#dc2626',\n                          margin: 0,\n                          flexShrink: 0\n                        }}\n                      />\n                      <FontAwesomeIcon icon={faTimes} size=\"lg\" />\n                      Neschvleno\n                      {formData.stav_schvaleni === 'neschvaleno' && (\n                        <span style={{\n                          marginLeft: '0.5rem',\n                          fontSize: '0.875rem',\n                          color: '#dc2626',\n                          fontWeight: '600'\n                        }}>\n                          \n                        </span>\n                      )}\n                    </label>\n\n                    {/* Schvleno */}\n                    <label style={{\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '1rem',\n                      padding: '1rem',\n                      border: '1px solid #e5e7eb',\n                      borderRadius: '8px',\n                      backgroundColor: formData.stav_schvaleni === 'schvaleno' ? '#f0fdf4' : '#f9fafb',\n                      cursor: shouldLockSchvaleniCheckboxes ? 'not-allowed' : 'pointer',\n                      opacity: shouldLockSchvaleniCheckboxes ? 0.6 : 1,\n                      fontSize: '1rem',\n                      fontWeight: '500',\n                      color: formData.stav_schvaleni === 'schvaleno' ? '#15803d' : '#374151',\n                      pointerEvents: shouldLockSchvaleniCheckboxes ? 'none' : 'auto'\n                    }}\n                    onClick={(e) => {\n                      e.preventDefault();\n                      handleRadioClick('schvaleno');\n                    }}\n                    >\n                      <input\n                        type=\"radio\"\n                        name=\"stav_schvaleni\"\n                        value=\"schvaleno\"\n                        checked={formData.stav_schvaleni === 'schvaleno'}\n                        onChange={() => {}}\n                        disabled={shouldLockSchvaleniCheckboxes}\n                        style={{\n                          width: '20px',\n                          height: '20px',\n                          accentColor: '#16a34a',\n                          margin: 0,\n                          flexShrink: 0\n                        }}\n                      />\n                      <FontAwesomeIcon icon={faCheck} size=\"lg\" />\n                      Schvleno\n                      {formData.stav_schvaleni === 'schvaleno' && (\n                        <span style={{\n                          marginLeft: '0.5rem',\n                          fontSize: '0.875rem',\n                          color: '#15803d',\n                          fontWeight: '600'\n                        }}>\n                          \n                        </span>\n                      )}\n                    </label>\n\n                    {/* Dvod na stejnm dku */}\n                    {(formData.stav_schvaleni === 'neschvaleno' || formData.stav_schvaleni === 'ceka_se') && (\n                      <div style={{ flex: '1', minWidth: '300px' }}>\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                          <label style={{\n                            fontWeight: '500',\n                            color: '#374151',\n                            fontSize: '0.875rem',\n                            whiteSpace: 'nowrap'\n                          }}>\n                            Dvod:\n                            <span style={{ color: '#dc2626', marginLeft: '2px' }}>*</span>\n                          </label>\n                          <InputWithIcon hasIcon style={{ flex: 1 }}>\n                            <FileText />\n                            <Input\n                              type=\"text\"\n                              value={formData.schvaleni_komentar || ''}\n                              onChange={(e) => handleInputChange('schvaleni_komentar', e.target.value)}\n                              onBlur={() => handleFieldBlur('schvaleni_komentar', formData.schvaleni_komentar)}\n                              placeholder={\n                                formData.stav_schvaleni === 'neschvaleno'\n                                  ? \"Uvete dvod neschvlen...\"\n                                  : \"Uvete dvod ekn na schvlen...\"\n                              }\n                              hasIcon\n                              hasError={!!validationErrors.schvaleni_komentar}\n                            />\n                          </InputWithIcon>\n                        </div>\n                        {validationErrors.schvaleni_komentar && (\n                          <ErrorText style={{ marginTop: '0.25rem' }}>{validationErrors.schvaleni_komentar}</ErrorText>\n                        )}\n                      </div>\n                    )}\n                      </>\n                    )}\n\n                  {/*  INFO BOX - Zobraz se POD checkboxy A PO ULOEN DO DATABZE */}\n                  {/* Zobraz se pouze kdy workflow stav obsahuje SCHVALENA (= uloeno v DB se schvlenm) */}\n                  {hasWorkflowState(formData.stav_workflow_kod, 'SCHVALENA') && formData.stav_schvaleni && !!formData.schvalovatel_id && formData.dt_schvaleni && (\n                    <div style={{\n                      marginTop: '1rem',\n                      padding: '1rem',\n                      backgroundColor: formData.stav_schvaleni === 'schvaleno' ? '#dcfce7' :\n                                      formData.stav_schvaleni === 'neschvaleno' ? '#fef2f2' : '#fef3c7',\n                      border: formData.stav_schvaleni === 'schvaleno' ? '1px solid #16a34a' :\n                              formData.stav_schvaleni === 'neschvaleno' ? '1px solid #f87171' : '1px solid #f59e0b',\n                      borderRadius: '8px',\n                      color: formData.stav_schvaleni === 'schvaleno' ? '#166534' :\n                             formData.stav_schvaleni === 'neschvaleno' ? '#991b1b' : '#92400e',\n                    }}>\n                      <div style={{\n                        fontSize: '1rem',\n                        fontWeight: '600',\n                        marginBottom: '0.75rem',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem'\n                      }}>\n                        <span style={{ fontSize: '1.25rem' }}>\n                          {formData.stav_schvaleni === 'schvaleno' ? '' :\n                           formData.stav_schvaleni === 'neschvaleno' ? '' : ''}\n                        </span>\n                        {formData.stav_schvaleni === 'schvaleno' ? 'Objednvka m stav: Schvlen objednvka' :\n                         formData.stav_schvaleni === 'neschvaleno' ? 'Objednvka m stav: Zamtnuta objednvka' :\n                         'Objednvka ek na doplnn podklad'}\n                      </div>\n                      <div style={{ fontSize: '0.875rem', lineHeight: '1.6' }}>\n                        <div style={{ marginBottom: '0.5rem' }}>\n                          <strong>Datum schvlen:</strong> {prettyDate(formData.dt_schvaleni)}  <strong>\n                            {formData.stav_schvaleni === 'schvaleno' ? 'Schvlil:' :\n                             formData.stav_schvaleni === 'neschvaleno' ? 'Zamtl:' : 'Vrtil:'}\n                          </strong> {getUserNameById(formData.schvalovatel_id)}\n                        </div>\n                        {/* Koment se NEZOBRAZUJE pro stav schvaleno (schvlen nepotebuje zdvodnn) */}\n                        {formData.schvaleni_komentar && formData.stav_schvaleni !== 'schvaleno' && (\n                          <div>\n                            <strong>\n                              {formData.stav_schvaleni === 'neschvaleno' ? 'Dvod zamtnut:' :\n                               formData.stav_schvaleni === 'ceka_se' ? 'Dvod vrcen:' : 'Koment:'}\n                            </strong> {formData.schvaleni_komentar}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )}\n                </div>\n                </>\n              )}\n\n              {/*  INFO BOX PRO UIVATELE BEZ PRV SCHVALOVN */}\n              {/* Zobraz se uivatelm bez prva ke schvalovn, pokud m objednvka stav schvlen */}\n              {!!formData.id &&\n               !hasWorkflowState(formData.stav_workflow_kod, 'NOVA') &&\n               !(canApproveOrders || canManageOrders) &&\n               formData.stav_schvaleni && !!formData.schvalovatel_id && formData.dt_schvaleni && (\n                <div style={{\n                  marginTop: '1rem',\n                  padding: '1rem',\n                  backgroundColor: formData.stav_schvaleni === 'schvaleno' ? '#dcfce7' :\n                                  formData.stav_schvaleni === 'neschvaleno' ? '#fef2f2' : '#fef3c7',\n                  border: formData.stav_schvaleni === 'schvaleno' ? '1px solid #16a34a' :\n                          formData.stav_schvaleni === 'neschvaleno' ? '1px solid #f87171' : '1px solid #f59e0b',\n                  borderRadius: '8px',\n                  color: formData.stav_schvaleni === 'schvaleno' ? '#166534' :\n                         formData.stav_schvaleni === 'neschvaleno' ? '#991b1b' : '#92400e',\n                }}>\n                  <div style={{\n                    fontSize: '1rem',\n                    fontWeight: '600',\n                    marginBottom: '0.75rem',\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '0.5rem'\n                  }}>\n                    <span style={{ fontSize: '1.25rem' }}>\n                      {formData.stav_schvaleni === 'schvaleno' ? '' :\n                       formData.stav_schvaleni === 'neschvaleno' ? '' : ''}\n                    </span>\n                    {formData.stav_schvaleni === 'schvaleno' ? 'Objednvka m stav: Schvlen objednvka' :\n                     formData.stav_schvaleni === 'neschvaleno' ? 'Objednvka m stav: Zamtnuta objednvka' :\n                     'Objednvka ek na doplnn podklad'}\n                  </div>\n                  <div style={{ fontSize: '0.875rem', lineHeight: '1.6' }}>\n                    <div style={{ marginBottom: '0.5rem' }}>\n                      <strong>Datum schvlen:</strong> {prettyDate(formData.dt_schvaleni)}  <strong>\n                        {formData.stav_schvaleni === 'schvaleno' ? 'Schvlil:' :\n                         formData.stav_schvaleni === 'neschvaleno' ? 'Zamtl:' : 'Vrtil:'}\n                      </strong> {getUserNameById(formData.schvalovatel_id)}\n                    </div>\n                    {/* Koment se NEZOBRAZUJE pro stav schvaleno (schvlen nepotebuje zdvodnn) */}\n                    {formData.schvaleni_komentar && formData.stav_schvaleni !== 'schvaleno' && (\n                      <div>\n                        <strong>\n                          {formData.stav_schvaleni === 'neschvaleno' ? 'Dvod zamtnut:' :\n                           formData.stav_schvaleni === 'ceka_se' ? 'Dvod vrcen:' : 'Koment:'}\n                        </strong> {formData.schvaleni_komentar}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n\n            </FormGroup>\n          </FormRow>\n        </SectionContent>\n      </FormSection>\n\n      {/* INFORMAN BLOK - KONEC FZE 1 */}\n      {(isArchived || currentPhase === 1) && !formData.stav_schvaleni && (\n        <div style={{\n          margin: '2rem 0',\n          padding: '1rem 1.25rem',\n          backgroundColor: '#f0f9ff',\n          border: '1px solid #0ea5e9',\n          borderRadius: '8px',\n          color: '#0c4a6e'\n        }}>\n          <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n             Objednvka zatm nebyla schvlena\n          </div>\n          <div style={{ fontSize: '0.875rem' }}>\n            Abyste mohli pokraovat ve vyplovn detail objednvky, pidvn ploh a zadvn informac o dodavateli, je nutn nejprve objednvku nechat schvlit.\n          </div>\n        </div>\n      )}\n\n      {/* ROZEN SEKCE - VIDITELN PODLE WORKFLOW STAVU */}\n      {sectionVisibility.financovani && (\n        <>\n          {/* Sekce: Informace o dodavateli */}\n          <FormSection data-section=\"dodavatel\">\n            {(() => {\n              // Helper: Check if Pokladna is selected\n              const selectedFinancovani = financovaniOptions.find(opt =>\n                opt.kod === formData.zpusob_financovani ||\n                opt.value === formData.zpusob_financovani\n              );\n              const nazev = selectedFinancovani?.nazev || '';\n              const isPokladna = nazev.toLowerCase().includes('pokladna');\n\n              return (\n                <>\n                  <SectionHeader\n                    sectionTheme={getSectionTheme('dodavatel')}\n                    isActive={isSectionActive('dodavatel')}\n                  >\n                    <SectionTitle sectionTheme={getSectionTheme('dodavatel')}>\n                      <SectionIcon sectionTheme={getSectionTheme('dodavatel')}>\n                        <Building />\n                      </SectionIcon>\n                      Dodavatel\n                      {isPokladna && (\n                        <LockWarning title=\"Sekce Dodavatel nen potebn pro objednvky financovan z pokladny\" style={{ marginLeft: '8px', color: '#ff9800' }}>\n                           Pokladna - dodavatel nen vyadovn\n                        </LockWarning>\n                      )}\n                    </SectionTitle>\n                    <SectionControls>\n                      {/*  Ikona \"Pidat do adrese\" - zobraz se pouze pokud m prvo CONTACT_MANAGE nebo CONTACT_EDIT */}\n                      {checkSupplierRequiredFields() &&\n                       !shouldLockPhase3Sections &&\n                       !isPokladna &&\n                       hasPermission &&\n                       (hasPermission('CONTACT_MANAGE') || hasPermission('CONTACT_EDIT')) && (\n                        <AddToDirectoryIcon\n                          isActive={true}\n                          onClick={handleAddSupplierToDirectory}\n                          title=\"Pidat dodavatele do adrese\"\n                          style={{\n                            position: 'relative',\n                            right: 'auto',\n                            top: 'auto',\n                            transform: 'none',\n                            marginRight: '8px'\n                          }}\n                        >\n                          <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                            <path d=\"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"/>\n                            <circle cx=\"8.5\" cy=\"7\" r=\"4\"/>\n                            <line x1=\"20\" y1=\"8\" x2=\"20\" y2=\"14\"/>\n                            <line x1=\"23\" y1=\"11\" x2=\"17\" y2=\"11\"/>\n                          </svg>\n                        </AddToDirectoryIcon>\n                      )}\n                      {isPokladna ? (\n                        <CollapseIcon\n                          collapsed={true}\n                          sectionTheme={getSectionTheme('dodavatel')}\n                          style={{ cursor: 'not-allowed', opacity: 0.5 }}\n                          title=\"Sekce je zablokovan pro platbu z pokladny\"\n                        >\n                          <FontAwesomeIcon icon={faTimes} />\n                        </CollapseIcon>\n                      ) : (\n                        <CollapseIcon\n                          collapsed={sectionStates.dodavatel}\n                          sectionTheme={getSectionTheme('dodavatel')}\n                          onClick={() => toggleSection('dodavatel')}\n                          style={{ cursor: 'pointer' }}\n                        >\n                          <FontAwesomeIcon icon={faChevronUp} />\n                        </CollapseIcon>\n                      )}\n                    </SectionControls>\n                  </SectionHeader>\n                </>\n              );\n            })()}\n            <SectionContent collapsed={sectionStates.dodavatel}>\n              <FormRow>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  <Label required>\n                    NZEV DODAVATELE\n                    {supplierAutoFillSource && (\n                      <span style={{fontWeight: 'normal', fontSize: '0.85em', color: '#666', marginLeft: '8px'}}>\n                        (vyplnno z {\n                          supplierAutoFillSource === 'local' ? 'loklnho adrese' :\n                          supplierAutoFillSource === 'ares' ? 'ARES' :\n                          supplierAutoFillSource === 'smlouva' ? 'smlouvy' :\n                          supplierAutoFillSource === 'smlouva-fallback' ? 'smlouvy' :\n                          'automatickho zdroje'\n                        })\n                      </span>\n                    )}\n                  </Label>\n                  <InputWithIcon hasIcon style={{position: 'relative'}}>\n                    <Building />\n                    <Input\n                      type=\"text\"\n                      name=\"dodavatel_nazev\"\n                      placeholder=\"Nzev spolenosti\"\n                      value={formData.dodavatel_nazev || ''}\n                      onChange={(e) => {\n                        handleInputChange('dodavatel_nazev', e.target.value);\n                        // Reset source pi manuln prav\n                        if (supplierAutoFillSource) {\n                          setSupplierAutoFillSource(null);\n                        }\n                      }}\n                      onBlur={() => handleFieldBlur('dodavatel_nazev', formData.dodavatel_nazev)}\n                      hasError={!!validationErrors.dodavatel_nazev}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                      style={{paddingRight: '80px'}}\n                    />\n                    {/* Ikony pro vbr dodavatele */}\n                    <div style={{\n                      position: 'absolute',\n                      right: '8px',\n                      top: '50%',\n                      transform: 'translateY(-50%)',\n                      display: 'flex',\n                      gap: '4px',\n                      zIndex: 10\n                    }}>\n                      <SupplierSearchIcon\n                        onClick={shouldLockPhase3Sections ? undefined : handleSupplierLocalSearch}\n                        title={shouldLockPhase3Sections ? \"Zameno - sekce FZE 3\" : \"Vyhledat v lokln databzi dodavatel\"}\n                        style={{ opacity: shouldLockPhase3Sections ? 0.5 : 1, cursor: shouldLockPhase3Sections ? 'not-allowed' : 'pointer' }}\n                      >\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                          <path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"/>\n                          <circle cx=\"9\" cy=\"7\" r=\"4\"/>\n                          <path d=\"M23 21v-2a4 4 0 0 0-3-3.87\"/>\n                          <path d=\"M16 3.13a4 4 0 0 1 0 7.75\"/>\n                        </svg>\n                      </SupplierSearchIcon>\n                      <AresSearchIcon\n                        onClick={shouldLockPhase3Sections ? undefined : handleSupplierAresSearch}\n                        title={shouldLockPhase3Sections ? \"Zameno - sekce FZE 3\" : \"Vyhledat v ARES registru\"}\n                        style={{ opacity: shouldLockPhase3Sections ? 0.5 : 1, cursor: shouldLockPhase3Sections ? 'not-allowed' : 'pointer' }}\n                      >\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                          <ellipse cx=\"12\" cy=\"5\" rx=\"9\" ry=\"3\"/>\n                          <path d=\"M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5\"/>\n                          <path d=\"M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3\"/>\n                        </svg>\n                      </AresSearchIcon>\n                    </div>\n                  </InputWithIcon>\n                  {validationErrors.dodavatel_nazev && (\n                    <ErrorText>{validationErrors.dodavatel_nazev}</ErrorText>\n                  )}\n                </FormGroup>\n              </FormRow>\n              <FormRow style={{gridTemplateColumns: '2fr 1fr 1fr'}}>\n                <FormGroup>\n                  <Label required>ADRESA</Label>\n                  <InputWithIcon hasIcon>\n                    <MapPin />\n                    <Input\n                      type=\"text\"\n                      name=\"dodavatel_adresa\"\n                      placeholder=\"Adresa sdla\"\n                      value={formData.dodavatel_adresa || ''}\n                      onChange={(e) => handleInputChange('dodavatel_adresa', e.target.value)}\n                      onBlur={() => handleFieldBlur('dodavatel_adresa', formData.dodavatel_adresa)}\n                      hasError={!!validationErrors.dodavatel_adresa}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                    />\n                  </InputWithIcon>\n                  {validationErrors.dodavatel_adresa && (\n                    <ErrorText>{validationErrors.dodavatel_adresa}</ErrorText>\n                  )}\n                </FormGroup>\n                <FormGroup>\n                  <Label required>IO</Label>\n                  <InputWithIcon hasIcon style={{position: 'relative'}}>\n                    <Hash />\n                    <Input\n                      type=\"text\"\n                      name=\"dodavatel_ico\"\n                      placeholder=\"12345678\"\n                      value={formData.dodavatel_ico || ''}\n                      onChange={(e) => handleInputChange('dodavatel_ico', e.target.value)}\n                      onBlur={(e) => handleIcoBlur(e.target.value)}\n                      hasError={!!validationErrors.dodavatel_ico}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                      style={{paddingRight: '36px'}}\n                    />\n                    {/* Ikona pro ARES vyhledvn */}\n                    <AresSearchIcon\n                      onClick={shouldLockPhase3Sections ? undefined : handleSupplierAresSearch}\n                      title={shouldLockPhase3Sections ? \"Zameno - sekce FZE 3\" : \"Vyhledat IO v ARES registru\"}\n                      style={{ opacity: shouldLockPhase3Sections ? 0.5 : 1, cursor: shouldLockPhase3Sections ? 'not-allowed' : 'pointer' }}\n                    >\n                      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                        <ellipse cx=\"12\" cy=\"5\" rx=\"9\" ry=\"3\"/>\n                        <path d=\"M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5\"/>\n                        <path d=\"M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3\"/>\n                      </svg>\n                    </AresSearchIcon>\n\n                    {/* IO Check Notification */}\n                    {showIcoCheck && (\n                      <IcoNotification data-status={icoCheckStatus}>\n                        {icoCheckStatus === 'checking' && (\n                          <>\n                            <IcoNotificationTitle status=\"checking\">Kontroluji IO...</IcoNotificationTitle>\n                            <IcoNotificationMessage status=\"checking\">\n                              Vyhledvm dodavatele podle IO v databzi a ARES.\n                            </IcoNotificationMessage>\n                          </>\n                        )}\n\n                        {(icoCheckStatus === 'found-local' || icoCheckStatus === 'found-ares') && icoCheckData && (\n                          <>\n                            <IcoNotificationTitle status=\"found\">\n                              {icoCheckStatus === 'found-local' ? 'Dodavatel v databzi!' : 'Dodavatel nalezen v ARES!'}\n                            </IcoNotificationTitle>\n                            <IcoNotificationMessage status=\"found\">\n                              <strong>{icoCheckData.nazev || icoCheckData.name || 'Nzev nen k dispozici'}</strong><br/>\n                              IO: {icoCheckData.ico}<br/>\n                              {icoCheckData.dic && (<>DI: {icoCheckData.dic}<br/></>)}\n                              {(icoCheckData.adresa || icoCheckData.address) && <>{icoCheckData.adresa || icoCheckData.address}<br/></>}\n                              {icoCheckData.zastoupeny && (<>Zastoupen: {icoCheckData.zastoupeny}<br/></>)}\n                              {icoCheckData.kontakt_jmeno && (\n                                <>Kontakt: {icoCheckData.kontakt_jmeno}\n                                {icoCheckData.kontakt_email && (<>, {icoCheckData.kontakt_email}</>)}\n                                {icoCheckData.kontakt_telefon && (<>, {icoCheckData.kontakt_telefon}</>)}\n                                <br/></>\n                              )}\n                              <div style={{fontSize: '11px', color: '#666', marginTop: '8px'}}>\n                                Zdroj: {icoCheckData.source === 'local' ? 'Lokln databze' : 'ARES registr'}\n                              </div>\n                            </IcoNotificationMessage>\n                            <IcoNotificationActions>\n                              <IcoActionButton className=\"fill-form\" onClick={handleIcoFillForm}>\n                                Vyplnit formul\n                              </IcoActionButton>\n                              {icoCheckStatus === 'found-ares' && (\n                                <IcoActionButton className=\"primary\" onClick={handleIcoUpdate}>\n                                  Pidat do osobnch kontakt\n                                </IcoActionButton>\n                              )}\n                              <IcoActionButton className=\"secondary\" onClick={handleIcoCancel}>\n                                Zruit\n                              </IcoActionButton>\n                            </IcoNotificationActions>\n                          </>\n                        )}\n\n                        {icoCheckStatus === 'not-found' && (\n                          <>\n                            <IcoNotificationTitle status=\"not-found\">Dodavatel nebyl nalezen</IcoNotificationTitle>\n                            <IcoNotificationMessage status=\"not-found\">\n                              Dodavatel s tmto IO nen v lokln databzi ani v ARES. Mete pokraovat s runm zadnm.\n                            </IcoNotificationMessage>\n                            <IcoNotificationActions>\n                              <IcoActionButton className=\"secondary\" onClick={handleIcoCancel}>\n                                Pokraovat run\n                              </IcoActionButton>\n                            </IcoNotificationActions>\n                          </>\n                        )}\n                      </IcoNotification>\n                    )}\n                  </InputWithIcon>\n                  {validationErrors.dodavatel_ico && (\n                    <ErrorText>{validationErrors.dodavatel_ico}</ErrorText>\n                  )}\n                </FormGroup>\n                <FormGroup>\n                  <Label>DI</Label>\n                  <InputWithIcon hasIcon>\n                    <Hash />\n                    <Input\n                      type=\"text\"\n                      name=\"dodavatel_dic\"\n                      placeholder=\"CZ12345678\"\n                      value={formData.dodavatel_dic || ''}\n                      onChange={(e) => handleInputChange('dodavatel_dic', e.target.value)}\n                      onBlur={() => handleFieldBlur('dodavatel_dic', formData.dodavatel_dic)}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                    />\n                  </InputWithIcon>\n                </FormGroup>\n              </FormRow>\n              <FormRow>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  <Label>ZASTOUPEN</Label>\n                  <InputWithIcon hasIcon>\n                    <User />\n                    <Input\n                      type=\"text\"\n                      name=\"dodavatel_zastoupeny\"\n                      placeholder=\"Zastoupen Jim Novkem\"\n                      value={formData.dodavatel_zastoupeny || ''}\n                      onChange={(e) => handleInputChange('dodavatel_zastoupeny', e.target.value)}\n                      onBlur={() => handleFieldBlur('dodavatel_zastoupeny', formData.dodavatel_zastoupeny)}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                    />\n                  </InputWithIcon>\n                </FormGroup>\n              </FormRow>\n\n              {/* Kontaktn osoba dodavatele */}\n              <FormRow>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  {/* Dlc ra */}\n                  <div style={{\n                    width: '100%',\n                    height: '1px',\n                    background: 'linear-gradient(to right, #e5e7eb, transparent)',\n                    margin: '1.5rem 0 1rem 0'\n                  }}></div>\n                  <Label style={{\n                    fontSize: '1rem',\n                    fontWeight: '600',\n                    color: '#374151',\n                    marginBottom: '1rem',\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '0.5rem',\n                    marginTop: '0.5rem'\n                  }}>\n                    <User size={18} />\n                    Kontaktn osoba dodavatele\n                  </Label>\n                </FormGroup>\n              </FormRow>\n              <FormRow>\n                <FormGroup>\n                  <Label>JMNO A PJMEN</Label>\n                  <InputWithIcon hasIcon>\n                    <User />\n                    <Input\n                      type=\"text\"\n                      name=\"dodavatel_kontakt_jmeno\"\n                      placeholder=\"Jan Novk\"\n                      value={formData.dodavatel_kontakt_jmeno || ''}\n                      onChange={(e) => handleInputChange('dodavatel_kontakt_jmeno', e.target.value)}\n                      onBlur={() => handleFieldBlur('dodavatel_kontakt_jmeno', formData.dodavatel_kontakt_jmeno)}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                    />\n                  </InputWithIcon>\n                </FormGroup>\n                <FormGroup>\n                  <Label>E-MAIL</Label>\n                  <InputWithIcon hasIcon>\n                    <Mail />\n                    <Input\n                      type=\"email\"\n                      name=\"dodavatel_kontakt_email\"\n                      placeholder=\"jan.novak@dodavatel.cz\"\n                      value={formData.dodavatel_kontakt_email || ''}\n                      onChange={(e) => handleInputChange('dodavatel_kontakt_email', e.target.value)}\n                      onBlur={() => handleFieldBlur('dodavatel_kontakt_email', formData.dodavatel_kontakt_email)}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                    />\n                  </InputWithIcon>\n                </FormGroup>\n                <FormGroup>\n                  <Label>TELEFON</Label>\n                  <InputWithIcon hasIcon>\n                    <Phone />\n                    <Input\n                      type=\"tel\"\n                      name=\"dodavatel_kontakt_telefon\"\n                      placeholder=\"+420 123 456 789\"\n                      value={formData.dodavatel_kontakt_telefon || ''}\n                      onChange={(e) => handleInputChange('dodavatel_kontakt_telefon', e.target.value)}\n                      onBlur={() => handleFieldBlur('dodavatel_kontakt_telefon', formData.dodavatel_kontakt_telefon)}\n                      hasIcon\n                      disabled={shouldLockPhase3Sections}\n                    />\n                  </InputWithIcon>\n                </FormGroup>\n              </FormRow>\n            </SectionContent>\n          </FormSection>\n\n          {/* Sekce: Detaily objednvky */}\n          {(isArchived || currentPhase >= 3) && (() => {\n            //  FAILSAFE: Pokud se sekce zobraz, ale nejsou dn poloky, vytvoit jednu\n            if (currentPhase >= 3 && (!formData.polozky_objednavky || formData.polozky_objednavky.length === 0)) {\n              // DEBUG: FAILSAFE item creation - logging removed\n              setTimeout(() => {\n                if (!formData.polozky_objednavky || formData.polozky_objednavky.length === 0) {\n                  setFormData(prev => ({\n                    ...prev,\n                    polozky_objednavky: [{\n                      id: `failsafe_item_${Date.now()}`,\n                      popis: '',\n                      mnozstvi: '1',\n                      jednotka: 'ks',\n                      cena_bez_dph: '',\n                      sazba_dph: '21',\n                      cena_s_dph: ''\n                    }]\n                  }));\n                }\n              }, 100);\n            }\n            return true;\n          })() && (\n          <FormSection data-section=\"detaily\">\n            <SectionHeader\n              sectionTheme={getSectionTheme('detaily')}\n              isActive={isSectionActive('detaily')}\n            >\n              <SectionTitle sectionTheme={getSectionTheme('detaily')}>\n                <SectionIcon sectionTheme={getSectionTheme('detaily')}>\n                  <Package />\n                </SectionIcon>\n                Detaily objednvky\n                {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n                {shouldLockPhase3Sections && !shouldLockAllSections && (\n                  <LockWarning title=\"FZE 3 sekce je zamena ve FZI 4+. Odemen umon editaci FZE 3.\">\n                     Sekce zamena\n                  </LockWarning>\n                )}\n              </SectionTitle>\n              <SectionControls>\n                {/* Celkov cena s DPH a porovnn s maximem */}\n                <div style={{\n                  fontSize: '0.875rem',\n                  fontWeight: '600',\n                  color: '#92400e',\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: '0.5rem'\n                }}>\n                  <span>Celkem s DPH: {totalPrice.toLocaleString('cs-CZ')} K</span>\n                  {maxPrice > 0 && (\n                    <span style={{\n                      color: totalPrice > maxPrice ? '#dc2626' : '#059669',\n                      fontSize: '0.75rem',\n                      padding: '2px 6px',\n                      borderRadius: '4px',\n                      backgroundColor: totalPrice > maxPrice ? '#fef2f2' : '#f0fdf4',\n                      border: `1px solid ${totalPrice > maxPrice ? '#fecaca' : '#bbf7d0'}`\n                    }}>\n                      {totalPrice > maxPrice\n                        ? `+${(totalPrice - maxPrice).toLocaleString('cs-CZ')} K nad limit`\n                        : `${(maxPrice - totalPrice).toLocaleString('cs-CZ')} K do limitu`\n                      }\n                    </span>\n                  )}\n                </div>\n                <CollapseIcon\n                  collapsed={sectionStates.detaily}\n                  sectionTheme={getSectionTheme('detaily')}\n                  onClick={() => toggleSection('detaily')}\n                  style={{ cursor: 'pointer' }}\n                >\n                  <FontAwesomeIcon icon={faChevronUp} />\n                </CollapseIcon>\n              </SectionControls>\n            </SectionHeader>\n            <SectionContent collapsed={sectionStates.detaily}>\n              <FormRow>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  <LabelWithClear>\n                    <LabelText required>DRUH OBJ.</LabelText>\n                    <ClearSelectButton\n                      type=\"button\"\n                      $visible={!!formData.druh_objednavky_kod}\n                      onClick={() => handleInputChange('druh_objednavky_kod', '')}\n                      title=\"Vymazat vbr\"\n                    >\n                      <X size={12} />\n                    </ClearSelectButton>\n                  </LabelWithClear>\n                  <StableCustomSelect\n                    value={formData.druh_objednavky_kod}\n                    onChange={(selectedValue) => handleInputChange('druh_objednavky_kod', selectedValue)}\n                    onBlur={(field, value) => handleFieldBlur('druh_objednavky_kod', value)}\n                    options={druhyObjednavkyOptions}\n                    placeholder=\"Vyberte druh objednvky...\"\n                    field=\"druh_objednavky_kod\"\n                    icon={<Package />}\n                    disabled={shouldLockPhase3Sections}\n                    hasError={!!validationErrors.druh_objednavky_kod}\n                    required={true}\n                    loading={false}\n                    getOptionLabel={getOptionLabel}\n                    getOptionValue={(option, field) => option.kod_stavu || option.value || option.kod || option.id || option}\n                  />\n                  {validationErrors.druh_objednavky_kod && (\n                    <ErrorText>{validationErrors.druh_objednavky_kod}</ErrorText>\n                  )}\n                </FormGroup>\n              </FormRow>\n\n              {/* Poloky objednvky */}\n              <div style={{marginTop: '1.5rem'}}>\n                <div style={{\n                  display: 'flex',\n                  justifyContent: 'space-between',\n                  alignItems: 'center',\n                  marginBottom: '1rem'\n                }}>\n                  <h4 style={{margin: 0, fontSize: '1rem', fontWeight: '600', color: '#374151'}}>\n                    Poloky objednvky <span style={{color: '#ef4444'}}>*</span>\n                  </h4>\n                </div>\n\n                {validationErrors.polozky_objednavky && (\n                  <ErrorText style={{marginBottom: '1rem'}}>{validationErrors.polozky_objednavky}</ErrorText>\n                )}\n\n                {(formData.polozky_objednavky || []).map((polozka, index) => (\n                  <div key={polozka.id} style={{\n                    border: '1px solid #e5e7eb',\n                    borderRadius: '8px',\n                    padding: '1rem',\n                    marginBottom: '1rem',\n                    background: '#fafafa'\n                  }}>\n                    <div style={{\n                      display: 'flex',\n                      justifyContent: 'space-between',\n                      alignItems: 'center',\n                      marginBottom: '1rem'\n                    }}>\n                      <div style={{display: 'flex', alignItems: 'center', gap: '1rem', flex: 1}}>\n                        <span style={{fontWeight: '600', color: '#374151', display: 'flex', alignItems: 'center', gap: '0.5rem'}}>\n                          <ShoppingCart size={18} style={{ color: '#10b981' }} />\n                          POLOKA {index + 1} {index === 0 && <span style={{color: '#ef4444'}}>*</span>}\n                        </span>\n                        \n                        {/*  LP Select - POUZE ve fzi 3+ s LP financovnm */}\n                        {currentPhase >= 3 && (() => {\n                          // Zkontrolovat LP financovn\n                          const selectedSource = financovaniOptions.find(opt => opt.kod_stavu === formData.zpusob_financovani || opt.kod === formData.zpusob_financovani);\n                          const nazev = selectedSource?.nazev_stavu || selectedSource?.nazev || '';\n                          const hasLPFinancing = (nazev.includes('Limitovan') || nazev.includes('pslib')) && Array.isArray(formData.lp_kod) && formData.lp_kod.length > 0;\n                          \n                          if (!hasLPFinancing) return null;\n                          \n                          return (\n                            <div style={{flex: 1, marginRight: '0.5rem', display: 'flex', flexDirection: 'column', gap: '0.25rem'}} data-custom-select>\n                              <StableCustomSelect\n                                value={polozka.lp_id || ''}\n                                onChange={(selectedValue) => updatePolozka(polozka.id, 'lp_id', selectedValue)}\n                                options={lpOptionsForItems}\n                                placeholder={\n                                  !formData.id \n                                    ? 'Ulote objednvku...' \n                                    : lpOptionsForItems.length === 0 \n                                      ? 'dn LP dostupn' \n                                      : '-- Vybrat LP --'\n                                }\n                                field={`polozka_${polozka.id}_lp`}\n                                disabled={shouldLockPhase3Sections || !formData.id}\n                                hasError={!!validationErrors[`polozka_${index}_lp`]}\n                                required={true}\n                                hasTriedToSubmit={hasTriedToSubmit}\n                                icon={<Hash />}\n                                getOptionLabel={getOptionLabel}\n                                getOptionValue={(option) => option.id}\n                              />\n                              {validationErrors[`polozka_${index}_lp`] && (\n                                <ErrorText style={{fontSize: '0.7rem', marginTop: '0.1rem'}}>\n                                  {validationErrors[`polozka_${index}_lp`]}\n                                </ErrorText>\n                              )}\n                            </div>\n                          );\n                        })()}\n                      </div>\n                      \n                      {/* Tlatko smazat poloku */}\n                      {(formData.polozky_objednavky || []).length > 1 && (\n                        <DeleteItemButton\n                          type=\"button\"\n                          onClick={shouldLockPhase3Sections ? undefined : () => removePolozka(polozka.id)}\n                          disabled={shouldLockPhase3Sections}\n                          title={shouldLockPhase3Sections ? \"Zameno - sekce FZE 3\" : \"Smazat poloku\"}\n                          style={{ opacity: shouldLockPhase3Sections ? 0.5 : 1, cursor: shouldLockPhase3Sections ? 'not-allowed' : 'pointer' }}\n                        >\n                          <Trash size={16} />\n                        </DeleteItemButton>\n                      )}\n                    </div>\n\n                    <FormRow style={{marginBottom: '1rem'}}>\n                      <FormGroup style={{gridColumn: '1 / -1'}}>\n                        <Label required>Nzev / popis</Label>\n                        <InputWithIcon hasIcon>\n                          <FileText />\n                          <Input\n                            type=\"text\"\n                            placeholder=\"Nzev / popis poloky\"\n                            value={polozka.popis}\n                            onChange={(e) => updatePolozka(polozka.id, 'popis', e.target.value)}\n                            onBlur={() => handleFieldBlur(`polozka_${index}_popis`, polozka.popis)}\n                            hasError={!!validationErrors[`polozka_${index}_popis`]}\n                            hasIcon={true}\n                            disabled={shouldLockPhase3Sections}\n                          />\n                        </InputWithIcon>\n                        {validationErrors[`polozka_${index}_popis`] && (\n                          <ErrorText>{validationErrors[`polozka_${index}_popis`]}</ErrorText>\n                        )}\n                      </FormGroup>\n                    </FormRow>\n\n                    <FormRow style={{gridTemplateColumns: '1fr auto 1fr', gap: '1rem', alignItems: 'end'}}>\n                      <FormGroup>\n                        <Label required>CENA BEZ DPH</Label>\n                        <CurrencyInput\n                          fieldName={`polozka_${index}_cena_bez_dph`}\n                          value={polozka.cena_bez_dph || ''}\n                          onChange={(field, value) => updatePolozka(polozka.id, 'cena_bez_dph', value)}\n                          onBlur={(field, value) => handleFieldBlur(`polozka_${index}_cena_bez_dph`, value)}\n                          disabled={shouldLockPhase3Sections}\n                          placeholder=\"0.00\"\n                          hasError={!!validationErrors[`polozka_${index}_cena_bez_dph`]}\n                        />\n                        {validationErrors[`polozka_${index}_cena_bez_dph`] && (\n                          <ErrorText>{validationErrors[`polozka_${index}_cena_bez_dph`]}</ErrorText>\n                        )}\n                      </FormGroup>\n\n                      <FormGroup>\n                        <Label>DPH</Label>\n                        <select\n                          value={polozka.sazba_dph}\n                          onChange={(e) => updatePolozka(polozka.id, 'sazba_dph', e.target.value)}\n                          onBlur={() => handleFieldBlur(`polozka_${index}_sazba_dph`, polozka.sazba_dph)}\n                          disabled={shouldLockPhase3Sections}\n                          style={{\n                            padding: '0.75rem',\n                            border: '1px solid #d1d5db',\n                            borderRadius: '8px',\n                            fontSize: '0.875rem',\n                            backgroundColor: 'white',\n                            width: '80px'\n                          }}\n                        >\n                          <option value=\"12\">12%</option>\n                          <option value=\"21\">21%</option>\n                        </select>\n                      </FormGroup>\n\n                      <FormGroup>\n                        <Label required>CENA S DPH</Label>\n                        <CurrencyInput\n                          fieldName={`polozka_${index}_cena_s_dph`}\n                          value={polozka.cena_s_dph || ''}\n                          onChange={(field, value) => updatePolozka(polozka.id, 'cena_s_dph', value)}\n                          onBlur={(field, value) => handleFieldBlur(`polozka_${index}_cena_s_dph`, value)}\n                          disabled={shouldLockPhase3Sections}\n                          placeholder=\"0.00\"\n                          hasError={!!validationErrors[`polozka_${index}_cena_s_dph`]}\n                        />\n                        {validationErrors[`polozka_${index}_cena_s_dph`] && (\n                          <ErrorText>{validationErrors[`polozka_${index}_cena_s_dph`]}</ErrorText>\n                        )}\n                      </FormGroup>\n                    </FormRow>\n\n                    {/*  Lokalizace poloky - rozkldac panel */}\n                    <div style={{ marginTop: '1rem' }}>\n                      {(() => {\n                        // Zkontrolovat, zda druh objednvky m atribut_objektu = 1 (majetek)\n                        const isMaterialOrderValue = isMaterialOrder;\n                        \n                        return (\n                          <button\n                            type=\"button\"\n                            onClick={() => {\n                              // Pro materilov objednvky nelze panel zavt\n                              if (!isMaterialOrderValue) {\n                                setLokalizacePanelStates(prev => ({\n                                  ...prev,\n                                  [polozka.id]: !prev[polozka.id]\n                                }));\n                              }\n                            }}\n                            disabled={shouldLockPhase3Sections || isMaterialOrderValue}\n                            style={{\n                              display: 'flex',\n                              alignItems: 'center',\n                              gap: '0.5rem',\n                              padding: '0.5rem 0',\n                              background: 'transparent',\n                              border: 'none',\n                              color: isMaterialOrderValue ? '#ef4444' : '#6b7280',\n                              fontSize: '0.875rem',\n                              fontWeight: isMaterialOrderValue ? '600' : '500',\n                              cursor: (shouldLockPhase3Sections || isMaterialOrderValue) ? 'not-allowed' : 'pointer',\n                              opacity: shouldLockPhase3Sections ? 0.5 : 1,\n                              transition: 'color 0.2s'\n                            }}\n                            onMouseOver={(e) => !shouldLockPhase3Sections && !isMaterialOrderValue && (e.currentTarget.style.color = '#374151')}\n                            onMouseOut={(e) => !shouldLockPhase3Sections && !isMaterialOrderValue && (e.currentTarget.style.color = '#6b7280')}\n                          >\n                            {!isMaterialOrderValue && (\n                              <svg\n                                width=\"14\"\n                                height=\"14\"\n                                viewBox=\"0 0 24 24\"\n                                fill=\"none\"\n                                stroke=\"currentColor\"\n                                strokeWidth=\"2\"\n                                style={{\n                                  transform: lokalizacePanelStates[polozka.id] ? 'rotate(180deg)' : 'rotate(0deg)',\n                                  transition: 'transform 0.2s'\n                                }}\n                              >\n                                <polyline points=\"6 9 12 15 18 9\"></polyline>\n                              </svg>\n                            )}\n                            Upesnn msta dodn {isMaterialOrderValue ? (<span style={{color: '#ef4444'}}>*</span>) : '(voliteln)'}\n                          </button>\n                        );\n                      })()}\n\n                      {lokalizacePanelStates[polozka.id] && (() => {\n                        // Zkontrolovat, zda druh objednvky m atribut_objektu = 1 (majetek)\n                        const isMaterialOrderValue = isMaterialOrder;\n                        \n                        return (\n                          <div style={{\n                            marginTop: '0.75rem',\n                            padding: '1rem',\n                            background: isMaterialOrderValue ? '#fef2f2' : '#f9fafb',\n                            borderRadius: '6px',\n                            border: isMaterialOrderValue ? '1px solid #fca5a5' : '1px dashed #d1d5db'\n                          }}>\n                            <FormRow style={{gridTemplateColumns: '1fr 1fr 1fr'}}>\n                              <FormGroup>\n                                <Label>SEK {isMaterialOrderValue && <span style={{color: '#ef4444'}}>*</span>}</Label>\n                                <InputWithIcon hasIcon>\n                                  <MapPin size={16} />\n                                  <Input\n                                    type=\"text\"\n                                    name={`polozka_${index}_usek_kod`}\n                                    placeholder=\"sek...\"\n                                    value={polozka.usek_kod || ''}\n                                    onChange={(e) => updatePolozka(polozka.id, 'usek_kod', e.target.value)}\n                                    onBlur={() => handleFieldBlur(`polozka_${index}_usek_kod`, polozka.usek_kod)}\n                                    disabled={shouldLockPhase3Sections}\n                                    hasError={!!validationErrors[`polozka_${index}_usek_kod`]}\n                                    style={{ paddingLeft: '2.5rem' }}\n                                  />\n                                </InputWithIcon>\n                                {validationErrors[`polozka_${index}_usek_kod`] && (\n                                  <ErrorText>{validationErrors[`polozka_${index}_usek_kod`]}</ErrorText>\n                                )}\n                              </FormGroup>\n\n                              <FormGroup>\n                                <Label>BUDOVA {isMaterialOrderValue && <span style={{color: '#ef4444'}}>*</span>}</Label>\n                                <InputWithIcon hasIcon>\n                                  <MapPin size={16} />\n                                  <Input\n                                    type=\"text\"\n                                    name={`polozka_${index}_budova_kod`}\n                                    placeholder=\"Budova...\"\n                                    value={polozka.budova_kod || ''}\n                                    onChange={(e) => updatePolozka(polozka.id, 'budova_kod', e.target.value)}\n                                    onBlur={() => handleFieldBlur(`polozka_${index}_budova_kod`, polozka.budova_kod)}\n                                    disabled={shouldLockPhase3Sections}\n                                    hasError={!!validationErrors[`polozka_${index}_budova_kod`]}\n                                    style={{ paddingLeft: '2.5rem' }}\n                                  />\n                                </InputWithIcon>\n                                {validationErrors[`polozka_${index}_budova_kod`] && (\n                                  <ErrorText>{validationErrors[`polozka_${index}_budova_kod`]}</ErrorText>\n                                )}\n                              </FormGroup>\n\n                              <FormGroup>\n                                <Label>MSTNOST {isMaterialOrderValue && <span style={{color: '#ef4444'}}>*</span>}</Label>\n                                <InputWithIcon hasIcon>\n                                  <MapPin size={16} />\n                                  <Input\n                                    type=\"text\"\n                                    name={`polozka_${index}_mistnost_kod`}\n                                    placeholder=\"Mstnost...\"\n                                    value={polozka.mistnost_kod || ''}\n                                    onChange={(e) => updatePolozka(polozka.id, 'mistnost_kod', e.target.value)}\n                                    onBlur={() => handleFieldBlur(`polozka_${index}_mistnost_kod`, polozka.mistnost_kod)}\n                                    disabled={shouldLockPhase3Sections}\n                                    hasError={!!validationErrors[`polozka_${index}_mistnost_kod`]}\n                                    style={{ paddingLeft: '2.5rem' }}\n                                  />\n                                </InputWithIcon>\n                                {validationErrors[`polozka_${index}_mistnost_kod`] && (\n                                  <ErrorText>{validationErrors[`polozka_${index}_mistnost_kod`]}</ErrorText>\n                                )}\n                              </FormGroup>\n                            </FormRow>\n\n                            <FormRow style={{gridTemplateColumns: '1fr'}}>\n                              <FormGroup>\n                                <Label>POZNMKA K MSTU</Label>\n                                <TextArea\n                                  name={`polozka_${index}_poznamka_lokalizace`}\n                                  placeholder=\"Doplujc informace k mstu dodn...\"\n                                  value={polozka.poznamka || ''}\n                                  onChange={(e) => updatePolozka(polozka.id, 'poznamka', e.target.value)}\n                                  onBlur={() => handleFieldBlur(`polozka_${index}_poznamka_lokalizace`, polozka.poznamka)}\n                                  disabled={shouldLockPhase3Sections}\n                                  rows={2}\n                                />\n                              </FormGroup>\n                            </FormRow>\n                          </div>\n                        );\n                      })()}\n                    </div>\n                  </div>\n                ))}\n                \n                {/* Tlatko pidat dal poloku - zobrazit pouze kdy NEN zameno */}\n                {!shouldLockPhase3Sections && (\n                  <button\n                    type=\"button\"\n                    onClick={addPolozka}\n                    style={{\n                      width: '100%',\n                      marginTop: '1rem',\n                      padding: '1rem',\n                      background: 'transparent',\n                      border: '2px dashed #10b981',\n                      borderRadius: '8px',\n                      color: '#10b981',\n                      fontSize: '0.875rem',\n                      fontWeight: '500',\n                      cursor: 'pointer',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      gap: '0.5rem',\n                      transition: 'all 0.2s ease'\n                    }}\n                    onMouseOver={(e) => {\n                      e.currentTarget.style.background = '#f0fdf4';\n                      e.currentTarget.style.borderColor = '#059669';\n                    }}\n                    onMouseOut={(e) => {\n                      e.currentTarget.style.background = 'transparent';\n                      e.currentTarget.style.borderColor = '#10b981';\n                    }}\n                  >\n                    <Plus size={16} />\n                    <span>Pidat dal poloku</span>\n                  </button>\n                )}\n              </div>\n\n              <FormRow style={{marginTop: '1.5rem'}}>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  <Label>POZNMKA:</Label>\n                  <TextArea\n                    name=\"poznamka_objednavky\"\n                    placeholder=\"Dodaten poznmky a poadavky...\"\n                    value={formData.poznamka_objednavky || ''}\n                    onChange={(e) => handleInputChange('poznamka_objednavky', e.target.value)}\n                    onBlur={(e) => handleFieldBlur('poznamka_objednavky', e.target.value)}\n                    disabled={shouldLockPhase3Sections}\n                    rows={3}\n                  />\n                </FormGroup>\n              </FormRow>\n            </SectionContent>\n          </FormSection>\n          )}\n\n          {/* Sekce: Dodac a zrun podmnky */}\n          <FormSection data-section=\"dodaci_podminky\">\n            <SectionHeader\n              sectionTheme={getSectionTheme('dodaci_podminky')}\n              isActive={isSectionActive('dodaci_podminky')}\n            >\n              <SectionTitle sectionTheme={getSectionTheme('dodaci_podminky')}>\n                <SectionIcon sectionTheme={getSectionTheme('dodaci_podminky')}>\n                  <Calendar />\n                </SectionIcon>\n                Dodac a zrun podmnky\n                {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n                {shouldLockPhase3Sections && !shouldLockAllSections && (\n                  <LockWarning title=\"FZE 3 sekce je zamena ve FZI 4+. Odemen umon editaci FZE 3.\">\n                     Sekce zamena\n                  </LockWarning>\n                )}\n              </SectionTitle>\n              <SectionControls>\n                <CollapseIcon\n                  collapsed={sectionStates.dodaci_podminky}\n                  sectionTheme={getSectionTheme('dodaci_podminky')}\n                  onClick={() => toggleSection('dodaci_podminky')}\n                  style={{ cursor: 'pointer' }}\n                >\n                  <FontAwesomeIcon icon={faChevronUp} />\n                </CollapseIcon>\n              </SectionControls>\n            </SectionHeader>\n            <SectionContent collapsed={sectionStates.dodaci_podminky}>\n              <FormRow style={{gridTemplateColumns: '2fr 3fr'}}>\n                <FormGroup>\n                  <Label>PEDPOKLDAN TERMN DODN</Label>\n                  <DatePicker\n                    fieldName=\"dt_predpokladany_termin_dodani\"\n                    value={formData.dt_predpokladany_termin_dodani}\n                    onChange={(value) => handleInputChange('dt_predpokladany_termin_dodani', value)}\n                    onBlur={(value) => handleFieldBlur('dt_predpokladany_termin_dodani', value)}\n                    disabled={shouldLockPhase3Sections}\n                    hasError={!!validationErrors.dt_predpokladany_termin_dodani}\n                    placeholder=\"Vyberte datum\"\n                  />\n                </FormGroup>\n                <FormGroup>\n                  <Label>MSTO DODN</Label>\n                  <InputWithIcon hasIcon>\n                    <MapPin />\n                    <Input\n                      type=\"text\"\n                      name=\"misto_dodani\"\n                      placeholder=\"Adresa msta dodn\"\n                      value={formData.misto_dodani || ''}\n                      onChange={(e) => handleInputChange('misto_dodani', e.target.value)}\n                      onBlur={(e) => handleFieldBlur('misto_dodani', e.target.value)}\n                      disabled={shouldLockPhase3Sections}\n                      hasIcon\n                    />\n                  </InputWithIcon>\n                </FormGroup>\n              </FormRow>\n              <FormRow>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  <Label>ZRUKA</Label>\n                  <InputWithIcon hasIcon>\n                    <FileText />\n                    <Input\n                      type=\"text\"\n                      name=\"zaruka\"\n                      placeholder=\"Zrun podmnky a lhty\"\n                      value={formData.zaruka || ''}\n                      onChange={(e) => handleInputChange('zaruka', e.target.value)}\n                      onBlur={(e) => handleFieldBlur('zaruka', e.target.value)}\n                      disabled={shouldLockPhase3Sections}\n                      hasIcon\n                    />\n                  </InputWithIcon>\n                </FormGroup>\n              </FormRow>\n            </SectionContent>\n          </FormSection>\n\n          {/*  SEKCE PLOHY ODEBRNA - bude pidna na konec formule jako vdy aktivn */}\n\n          {/* FZE 3: Sekce: Stav odesln objednvky */}\n          <FormSection data-section=\"stav_odeslani\">\n            <SectionHeader\n              sectionTheme={getSectionTheme('stav_odeslani')}\n              isActive={isSectionActive('stav_odeslani')}\n            >\n              <SectionTitle sectionTheme={getSectionTheme('stav_odeslani')}>\n                <SectionIcon sectionTheme={getSectionTheme('stav_odeslani')}>\n                  <Package />\n                </SectionIcon>\n                Stav odesln objednvky\n                {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n                {shouldLockPhase3Sections && !shouldLockAllSections && (\n                  <LockWarning title=\"FZE 3 sekce je zamena ve FZI 4+. Odemen umon editaci FZE 3.\">\n                     Sekce zamena\n                  </LockWarning>\n                )}\n              </SectionTitle>\n              <SectionControls>\n                {/*  Nezobrazovat tlatko odemknut kdy je globln lock (shouldLockAllSections) */}\n                {shouldLockPhase3Sections && !shouldLockAllSections && canEditPhase3 && (\n                  <UnlockButton\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      setShowUnlockPhase3Confirm(true);\n                    }}\n                    title=\"Odemknout FZE 3 sekce\"\n                  >\n                    <Unlock />\n                  </UnlockButton>\n                )}\n                <CollapseIcon\n                  collapsed={sectionStates.stav_odeslani}\n                  sectionTheme={getSectionTheme('stav_odeslani')}\n                  onClick={() => toggleSection('stav_odeslani')}\n                  style={{ cursor: 'pointer' }}\n                >\n                  <FontAwesomeIcon icon={faChevronUp} />\n                </CollapseIcon>\n              </SectionControls>\n            </SectionHeader>\n              <SectionContent collapsed={sectionStates.stav_odeslani}>\n              <FormRow>\n                <FormGroup style={{gridColumn: '1 / -1'}}>\n                  <Label style={{ marginBottom: '1rem', fontSize: '1rem', fontWeight: '600' }}>\n                    KONEN STAV OBJEDNVKY\n                  </Label>\n\n                  {/* Odeslno */}\n                  <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '1rem',\n                    padding: '1rem',\n                    border: '1px solid #e5e7eb',\n                    borderRadius: '8px',\n                    backgroundColor: formData.stav_odeslano ? '#f0fdf4' : '#f9fafb',\n                    marginBottom: '1rem',\n                    opacity: (shouldLockPhase3Sections || showSaveProgress || isSaving) ? 0.6 : 1\n                  }}>\n                    <label style={{\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '0.75rem',\n                      fontSize: '1rem',\n                      fontWeight: '500',\n                      cursor: (shouldLockPhase3Sections || showSaveProgress || isSaving) ? 'not-allowed' : 'pointer',\n                      color: formData.stav_odeslano ? '#15803d' : '#374151'\n                    }}>\n                      <input\n                        type=\"checkbox\"\n                        name=\"stav_odeslano\"\n                        checked={formData.stav_odeslano || false}\n                        disabled={shouldLockPhase3Sections || showSaveProgress || isSaving}\n                        onChange={(e) => {\n                          const isChecked = e.target.checked;\n\n                          // Pi zakrtnut \"Odeslno\" odkrtnout \"Stornovno\" a smazat storno data\n                          if (isChecked) {\n                            handleInputChange('stav_stornovano', false);\n                            handleInputChange('datum_storna', '');\n                            handleInputChange('odeslani_storno_duvod', ''); // Smazat dvod storna pi odesln\n                            handleInputChange('storno_uzivatel_id', '');\n                            handleInputChange('storno_provedl', '');\n                          }\n\n                          // Hlavn zmna stavu - handleInputChange u obsahuje logiku pro nastaven datumu\n                          handleInputChange('stav_odeslano', isChecked);\n                        }}\n                        style={{\n                          width: '20px',\n                          height: '20px',\n                          accentColor: '#16a34a'\n                        }}\n                      />\n                      <Package size={20} />\n                      Odeslno\n                      {formData.stav_odeslano && (\n                        <span style={{\n                          marginLeft: '0.5rem',\n                          fontSize: '0.875rem',\n                          color: '#15803d',\n                          fontWeight: '600'\n                        }}>\n                          \n                        </span>\n                      )}\n                    </label>\n\n                    {/* Datum odesln vedle checkboxu */}\n                    {(formData.stav_odeslano || formData.dt_odeslani) && (\n                      <div style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem',\n                        marginLeft: 'auto'\n                      }}>\n                        <Label style={{ margin: 0, fontSize: '0.875rem' }}>DATUM:</Label>\n                        <div style={{ width: '280px' }}>\n                          <DatePicker\n                            fieldName=\"datum_odeslani\"\n                            value={formData.datum_odeslani}\n                            onChange={(value) => handleInputChange('datum_odeslani', value)}\n                            onBlur={(value) => handleFieldBlur('datum_odeslani', value)}\n                            disabled={shouldLockPhase3Sections}\n                            hasError={!!validationErrors.datum_odeslani}\n                            placeholder=\"Datum\"\n                          />\n                        </div>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Stornovno */}\n                  <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '1rem',\n                    padding: '1rem',\n                    border: '1px solid #e5e7eb',\n                    borderRadius: '8px',\n                    backgroundColor: formData.stav_stornovano ? '#fef2f2' : '#f9fafb',\n                    opacity: (shouldLockPhase3Sections || showSaveProgress || isSaving) ? 0.6 : 1\n                  }}>\n                    <label style={{\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '0.75rem',\n                      fontSize: '1rem',\n                      fontWeight: '500',\n                      cursor: (shouldLockPhase3Sections || showSaveProgress || isSaving) ? 'not-allowed' : 'pointer',\n                      color: formData.stav_stornovano ? '#dc2626' : '#374151'\n                    }}>\n                      <input\n                        type=\"checkbox\"\n                        name=\"stav_stornovano\"\n                        checked={formData.stav_stornovano || false}\n                        disabled={shouldLockPhase3Sections || showSaveProgress || isSaving}\n                        onChange={(e) => {\n                          const isChecked = e.target.checked;\n\n                          // Pi zakrtnut \"Stornovno\" odkrtnout \"Odeslno\"\n                          if (isChecked) {\n                            handleInputChange('stav_odeslano', false);\n                            handleInputChange('datum_odeslani', '');\n                          }\n\n                          //  HLAVN ZMNA - handleInputChange automaticky nastav datum v logice\n                          handleInputChange('stav_stornovano', isChecked);\n                        }}\n                        style={{\n                          width: '20px',\n                          height: '20px',\n                          accentColor: '#dc2626'\n                        }}\n                      />\n                      <FontAwesomeIcon icon={faTimes} size=\"lg\" />\n                      Stornovno\n                      {formData.stav_stornovano && (\n                        <span style={{\n                          marginLeft: '0.5rem',\n                          fontSize: '0.875rem',\n                          color: '#dc2626',\n                          fontWeight: '600'\n                        }}>\n                          \n                        </span>\n                      )}\n                    </label>\n\n                    {/* Datum storna vedle checkboxu */}\n                    {(formData.stav_stornovano || formData.datum_storna) && (\n                      <div style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.5rem',\n                        marginLeft: 'auto'\n                      }}>\n                        <Label style={{ margin: 0, fontSize: '0.875rem' }}>DATUM:</Label>\n                        <div style={{ width: '280px' }}>\n                          <DatePicker\n                            fieldName=\"datum_storna\"\n                            value={formData.datum_storna}\n                            onChange={(value) => handleInputChange('datum_storna', value)}\n                            onBlur={(value) => handleFieldBlur('datum_storna', value)}\n                            disabled={shouldLockPhase3Sections}\n                            hasError={!!validationErrors.datum_storna}\n                            placeholder=\"Vyberte datum...\"\n                          />\n                        </div>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Dvod stornovn - zobraz se pouze kdy je stornovno zakrtnuto */}\n                  {formData.stav_stornovano && (\n                    <div style={{ marginTop: '1rem' }}>\n                      <Label style={{ marginBottom: '0.5rem' }}>\n                        DVOD STORNOVN\n                        <span style={{ color: '#dc2626', marginLeft: '0.25rem' }}>*</span>\n                      </Label>\n                      <TextArea\n                        name=\"odeslani_storno_duvod\"\n                        placeholder=\"Uvete dvod stornovn objednvky...\"\n                        value={formData.odeslani_storno_duvod || ''}\n                        onChange={(e) => handleInputChange('odeslani_storno_duvod', e.target.value)}\n                        onBlur={(e) => handleFieldBlur('odeslani_storno_duvod', e.target.value)}\n                        rows={3}\n                        style={{\n                          border: '1px solid #fca5a5',\n                          backgroundColor: '#fef2f2'\n                        }}\n                      />\n                      {validationErrors.odeslani_storno_duvod && (\n                        <ErrorText style={{ marginTop: '0.5rem' }}>{validationErrors.odeslani_storno_duvod}</ErrorText>\n                      )}\n                    </div>\n                  )}\n\n                  {validationErrors.datum_odeslani && (\n                    <ErrorText style={{ marginTop: '0.5rem' }}>{validationErrors.datum_odeslani}</ErrorText>\n                  )}\n                  {validationErrors.datum_storna && (\n                    <ErrorText style={{ marginTop: '0.5rem' }}>{validationErrors.datum_storna}</ErrorText>\n                  )}\n\n                  {/* Informace o stavu */}\n                  {formData.stav_odeslano ? (\n                    <div style={{\n                      marginTop: '1rem',\n                      padding: '0.75rem 1rem',\n                      backgroundColor: '#dcfce7',\n                      border: '1px solid #16a34a',\n                      borderRadius: '6px',\n                      color: '#166534',\n                      fontSize: '0.875rem'\n                    }}>\n                      <div style={{ fontWeight: '600' }}>\n                        {formData.dt_odeslani && formData.odesilatel_id && hasWorkflowState(formData.stav_workflow_kod, 'ODESLANA') ? (\n                          // Data existuj + stav ODESLANA = byla ji odeslna\n                          <>\n                             Objednvka byla odeslna\n                            <div style={{ marginTop: '0.25rem', fontSize: '0.875rem', fontWeight: 'normal' }}>\n                              <strong>Datum odesln:</strong> {(() => {\n                                // Formtovn jen data bez asu (dt_odeslani z DB me obsahovat datetime)\n                                const dateStr = formData.dt_odeslani.split(' ')[0]; // Odstranit as\n                                const [year, month, day] = dateStr.split('-');\n                                return `${day}. ${month}. ${year}`;\n                              })()}  <strong>Odeslal:</strong> {getUserNameById(formData.odesilatel_id)}\n                            </div>\n                          </>\n                        ) : formData.datum_odeslani ? (\n                          // M datum ale jet nebyla odeslna - bude odeslna\n                          ` Objednvka bude oznaena jako odeslan dne ${formatDateOnly(new Date(formData.datum_odeslani))}`\n                        ) : (\n                          // Nem datum - bude odeslna po uloen\n                          ` Objednvka bude oznaena jako odeslan po uloen`\n                        )}\n                      </div>\n                    </div>\n                  ) : formData.stav_stornovano ? (\n                    <div style={{\n                      marginTop: '1rem',\n                      padding: '0.75rem 1rem',\n                      backgroundColor: '#fef2f2',\n                      border: '1px solid #f87171',\n                      borderRadius: '6px',\n                      color: '#991b1b',\n                      fontSize: '0.875rem'\n                    }}>\n                      <div style={{ fontWeight: '600' }}>\n                        {formData.dt_odeslani && formData.odesilatel_id && hasWorkflowState(formData.stav_workflow_kod, 'STORNOVANA') ? (\n                          // Data existuj + stav STORNOVANA = byla ji stornovna\n                          <>\n                             Objednvka byla stornovna\n                            <div style={{ marginTop: '0.5rem', fontSize: '0.875rem', fontWeight: 'normal' }}>\n                              <strong>Datum stornovn:</strong> {formData.dt_odeslani}\n                              {'  '}\n                              <strong>Stornoval:</strong> {getUserNameById(formData.odesilatel_id)}\n                            </div>\n                            {formData.odeslani_storno_duvod && (\n                              <div style={{ marginTop: '0.5rem', fontSize: '0.875rem', fontWeight: 'normal' }}>\n                                <strong>Dvod stornovn:</strong> {formData.odeslani_storno_duvod}\n                              </div>\n                            )}\n                          </>\n                        ) : (\n                          // Byla stornovna po uloen\n                          <>\n                             Objednvka byla stornovna {formData.datum_storna ? `dne ${formatDateOnly(new Date(formData.datum_storna))}` : 'po uloen'}\n                            {formData.odeslani_storno_duvod && (\n                              <div style={{ marginTop: '0.5rem', fontSize: '0.875rem', fontWeight: 'normal' }}>\n                                <strong>Dvod stornovn:</strong> {formData.odeslani_storno_duvod}\n                              </div>\n                            )}\n                          </>\n                        )}\n                      </div>\n                    </div>\n                  ) : null}\n                </FormGroup>\n              </FormRow>\n            </SectionContent>\n          </FormSection>\n\n          {/* INFORMAN BLOK - KONEC FZE 2 */}\n          {(isArchived || currentPhase >= 2) && hasWorkflowState(formData.stav_workflow_kod, 'SCHVALENA') && !formData.stav_odeslano && !formData.stav_stornovano && (\n            <div style={{\n              margin: '2rem 0',\n              padding: '1rem 1.25rem',\n              backgroundColor: '#fef3c7',\n              border: '1px solid #f59e0b',\n              borderRadius: '8px',\n              color: '#92400e'\n            }}>\n              <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                 Objednvka zatm nebyla dokonena\n              </div>\n              <div style={{ fontSize: '0.875rem' }}>\n                Zakrtnte \"Odeslno\" kdy bude objednvka skuten odeslna dodavateli, nebo \"Stornovno\" pokud se objednvka nebude realizovat.\n              </div>\n            </div>\n          )}\n\n          {/* FZE 3: Dal sekce zobrazen ve FZI 3 (pouze pokud nen stornovno) */}\n          {(isArchived || currentPhase >= 3) && !formData.stav_stornovano && (\n            <>\n              {/* FZE 4+: Sekce potvrzen dodavatelem - zobraz se a po ODESLN dodavateli */}\n\n              {/* Sekce: Potvrzen objednvky dodavatelem */}\n              {/*  ZOBRAZIT vdy kdy workflow prolo pes ODESLANA nebo POTVRZENA - jako HISTORIE */}\n              {(() => {\n                const phaseCheck = currentPhase >= 4;\n                const workflowCheck = hasWorkflowState(formData.stav_workflow_kod, 'ODESLANA') ||\n                                       hasWorkflowState(formData.stav_workflow_kod, 'POTVRZENA');\n                const shouldShow = phaseCheck && workflowCheck;\n\n                return shouldShow;\n              })() && (\n              <FormSection data-section=\"potvrzeni_objednavky\">\n                <SectionHeader\n                  sectionTheme={getSectionTheme('potvrzeni_objednavky')}\n                  isActive={isSectionActive('potvrzeni_objednavky')}\n                >\n                  <SectionTitle sectionTheme={getSectionTheme('potvrzeni_objednavky')}>\n                    <SectionIcon sectionTheme={getSectionTheme('potvrzeni_objednavky')}>\n                      <FontAwesomeIcon icon={faCheckCircle} />\n                    </SectionIcon>\n                    Potvrzen objednvky dodavatelem\n                    {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n                    {isPotvrzeniLocked && !shouldLockAllSections && (\n                      <LockWarning title=\"Sekce z minul fze je uzamena (read-only historie). Odemknout me administrtor nebo uivatel s prvem ORDER_MANAGE.\">\n                         Sekce zamena\n                      </LockWarning>\n                    )}\n                  </SectionTitle>\n                  <SectionControls>\n                    {/*  Nezobrazovat tlatko odemknut kdy je globln lock (shouldLockAllSections) */}\n                    {isPotvrzeniLocked && !shouldLockAllSections && canUnlockAnything && (\n                      <UnlockButton\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setShowUnlockPotvrzeniConfirm(true);\n                        }}\n                        title=\"Odemknout sekci Potvrzen od dodavatele\"\n                      >\n                        <Unlock />\n                      </UnlockButton>\n                    )}\n\n                    <CollapseIcon\n                      collapsed={sectionStates.potvrzeni_objednavky}\n                      sectionTheme={getSectionTheme('potvrzeni_objednavky')}\n                      onClick={() => toggleSection('potvrzeni_objednavky')}\n                      style={{ cursor: 'pointer' }}\n                    >\n                      <FontAwesomeIcon icon={faChevronUp} />\n                    </CollapseIcon>\n                  </SectionControls>\n                </SectionHeader>\n                <SectionContent collapsed={sectionStates.potvrzeni_objednavky} data-section=\"potvrzeni_objednavky\">\n                  <FormRow>\n                    <FormGroup style={{gridColumn: '1 / -1'}}>\n                      {/* Potvrzen od dodavatele - ANO/NE */}\n                      <div style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '1rem',\n                        padding: '1rem',\n                        border: '1px solid #e5e7eb',\n                        borderRadius: '8px',\n                        backgroundColor: formData.dodavatel_zpusob_potvrzeni?.potvrzeni === 'ANO' ? '#f0fdf4' : '#f9fafb',\n                        marginBottom: '1rem'\n                      }}>\n                        <span style={{\n                          fontSize: '1rem',\n                          fontWeight: '500',\n                          color: '#374151'\n                        }}>\n                          Dodavatel objednvku potvrdil:\n                        </span>\n                        <div style={{ display: 'flex', gap: '1rem' }}>\n                          {['ANO', 'NE'].map(option => (\n                            <label key={option} style={{\n                              display: 'flex',\n                              alignItems: 'center',\n                              gap: '0.5rem',\n                              padding: '0.5rem 1rem',\n                              border: '1px solid #e5e7eb',\n                              borderRadius: '6px',\n                              cursor: shouldLockPhase4to6Sections ? 'not-allowed' : 'pointer',\n                              backgroundColor: formData.dodavatel_zpusob_potvrzeni?.potvrzeni === option ? '#f0f9ff' : '#fff',\n                              opacity: shouldLockPhase4to6Sections ? 0.6 : 1,\n                              fontWeight: '500'\n                            }}>\n                              <input\n                                type=\"radio\"\n                                name=\"potvrzeni_dodavatele\"\n                                value={option}\n                                checked={formData.dodavatel_zpusob_potvrzeni?.potvrzeni === option}\n                                disabled={shouldLockPhase4to6Sections}\n                                onChange={() => {}} // Przdn onChange\n                                onClick={(e) => {\n                                  const currentValue = formData.dodavatel_zpusob_potvrzeni?.potvrzeni;\n                                  let newValue;\n\n                                  // Pokud klikm na ji vybranou monost, odkrtni ji\n                                  if (currentValue === e.target.value) {\n                                    newValue = '';\n                                  } else {\n                                    newValue = e.target.value;\n                                  }\n\n                                  const newData = {\n                                    ...formData.dodavatel_zpusob_potvrzeni,\n                                    potvrzeni: newValue,\n                                    zpusoby: newValue === 'ANO' ? formData.dodavatel_zpusob_potvrzeni?.zpusoby || [] : [],\n                                    platba: newValue === 'ANO' ? 'faktura' : '' //  Vdy \"faktura\" kdy je ANO\n                                  };\n                                  handleInputChange('dodavatel_zpusob_potvrzeni', newData);\n\n                                  //  AUTOMATICKY nastavit dodavatel_potvrdil_id pi zmn potvrzen\n                                  if (newValue === 'ANO' && user_id) {\n                                    handleInputChange('dodavatel_potvrdil_id', user_id);\n                                    addDebugLog('info', 'AKCEPTACE', 'dodavatel-potvrdil', `Automaticky nastaven dodavatel_potvrdil_id: ${user_id}`);\n                                  } else if (newValue !== 'ANO') {\n                                    handleInputChange('dodavatel_potvrdil_id', null);\n                                    addDebugLog('info', 'AKCEPTACE', 'dodavatel-reset', `Vymazn dodavatel_potvrdil_id (potvrzen nen ANO)`);\n                                  }\n                                }}\n                                style={{ cursor: 'pointer' }}\n                              />\n                              {option}\n                            </label>\n                          ))}\n                        </div>\n                      </div>\n\n                      {/* Zpsob potvrzen - zobraz se pouze pokud je ANO */}\n                      {formData.dodavatel_zpusob_potvrzeni?.potvrzeni === 'ANO' && (\n                        <>\n                          <FormRow>\n                            {/* Lev sloupec: Zpsob potvrzen */}\n                            <FormGroup>\n                              <Label required>Zpsob potvrzen</Label>\n                              <div style={{\n                                display: 'flex',\n                                flexDirection: 'column',\n                                gap: '0.5rem',\n                                marginTop: '0.5rem'\n                              }}>\n                                {[\n                                  { value: 'email', label: 'E-mail' },\n                                  { value: 'telefon', label: 'Telefont' },\n                                  { value: 'podepsana_objednavka', label: 'Podepsan objednvka' },\n                                  { value: 'eshop', label: 'e-Shop' }\n                                ].map(option => {\n                                  const isChecked = Array.isArray(formData.dodavatel_zpusob_potvrzeni?.zpusoby)\n                                    ? formData.dodavatel_zpusob_potvrzeni.zpusoby.includes(option.value)\n                                    : false;\n\n                                  const isDisabled = formData.dodavatel_zpusob_potvrzeni?.potvrzeni !== 'ANO' ||\n                                    shouldLockPhase4to6Sections ||\n                                    showSaveProgress ||\n                                    isSaving;\n\n                                  const hasValidationError = !!validationErrors.dodavatel_zpusob_potvrzeni;\n\n                                  return (\n                                    <label key={option.value} style={{\n                                      display: 'flex',\n                                      alignItems: 'center',\n                                      gap: '0.5rem',\n                                      padding: '0.5rem 1rem',\n                                      border: hasValidationError ? '2px solid #dc2626' : '1px solid #e5e7eb',\n                                      borderRadius: '6px',\n                                      cursor: isDisabled ? 'not-allowed' : 'pointer',\n                                      backgroundColor: isChecked ? '#f0f9ff' : '#fff',\n                                      opacity: isDisabled ? 0.5 : 1\n                                    }}>\n                                      <input\n                                        type=\"checkbox\"\n                                        checked={isChecked}\n                                        disabled={isDisabled}\n                                        onChange={(e) => {\n                                          const currentZpusoby = Array.isArray(formData.dodavatel_zpusob_potvrzeni?.zpusoby)\n                                            ? formData.dodavatel_zpusob_potvrzeni.zpusoby\n                                            : [];\n\n                                          let newZpusoby;\n                                          if (e.target.checked) {\n                                            newZpusoby = [...currentZpusoby, option.value];\n                                          } else {\n                                            newZpusoby = currentZpusoby.filter(val => val !== option.value);\n                                          }\n\n                                          const newData = {\n                                            ...formData.dodavatel_zpusob_potvrzeni,\n                                            zpusoby: newZpusoby\n                                          };\n                                          \n                                          //  OPRAVA: Aktualizovat OBA fieldy NAJEDNOU pomoc setFormData\n                                          const now = new Date().toISOString();\n                                          setFormData(prev => ({\n                                            ...prev,\n                                            dodavatel_zpusob_potvrzeni: newData,\n                                            dt_akceptace: newZpusoby.length > 0 ? now : ''\n                                          }));\n                                          setIsChanged(true);\n                                        }}\n                                        style={{ cursor: 'pointer' }}\n                                      />\n                                      {option.label}\n                                    </label>\n                                  );\n                                })}\n                              </div>\n                              {validationErrors.dodavatel_zpusob_potvrzeni && (\n                                <div style={{\n                                  color: '#dc2626',\n                                  fontSize: '0.875rem',\n                                  marginTop: '0.5rem',\n                                  fontWeight: '500'\n                                }}>\n                                  {validationErrors.dodavatel_zpusob_potvrzeni}\n                                </div>\n                              )}\n                            </FormGroup>\n\n                            {/* Prav sloupec: Datum akceptace + Zpsob platby */}\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\n                              {/* Datum akceptace - zobraz se vdy kdy je ANO zakrtnuto */}\n                              {formData.dodavatel_zpusob_potvrzeni?.potvrzeni === 'ANO' && (\n                              <FormGroup>\n                                <Label required>Datum akceptace</Label>\n                                <DatePicker\n                                  fieldName=\"dt_akceptace\"\n                                  value={formData.dt_akceptace}\n                                  onChange={(value) => handleInputChange('dt_akceptace', value)}\n                                  onBlur={(value) => handleFieldBlur('dt_akceptace', value)}\n                                  disabled={\n                                    shouldLockPhase4to6Sections ||\n                                    showSaveProgress ||\n                                    isSaving\n                                  }\n                                  hasError={!!validationErrors.dt_akceptace}\n                                  placeholder=\"Vyberte datum...\"\n                                />\n                                {validationErrors.dt_akceptace && (\n                                  <div style={{\n                                    color: '#dc2626',\n                                    fontSize: '0.875rem',\n                                    marginTop: '0.5rem',\n                                    fontWeight: '500'\n                                  }}>\n                                    {validationErrors.dt_akceptace}\n                                  </div>\n                                )}\n                              </FormGroup>\n                              )}\n\n                              {/* Zpsob platby - pouze Faktura */}\n                              <FormGroup style={{ marginTop: 'calc(2.5rem + 2px)' }}>\n                                <Label required>Zpsob platby</Label>\n                                <div style={{\n                                  display: 'flex',\n                                  flexDirection: 'column',\n                                  gap: '0.5rem',\n                                  marginTop: '0.5rem'\n                                }}>\n                                  <label style={{\n                                    display: 'flex',\n                                    alignItems: 'center',\n                                    gap: '0.5rem',\n                                    padding: '0.5rem 1rem',\n                                    border: '1px solid #e5e7eb',\n                                    borderRadius: '6px',\n                                    cursor: 'default',\n                                    backgroundColor: '#f0f9ff',\n                                    marginTop: '2px'\n                                  }}>\n                                    <input\n                                      type=\"radio\"\n                                      name=\"platba_dodavatel\"\n                                      value=\"faktura\"\n                                      checked={true}\n                                      disabled={shouldLockPhase4to6Sections || showSaveProgress || isSaving}\n                                      readOnly\n                                      style={{ cursor: 'default' }}\n                                    />\n                                    Faktura\n                                  </label>\n                                </div>\n                                {validationErrors.zpusob_platby && (\n                                  <div style={{\n                                    color: '#dc2626',\n                                    fontSize: '0.875rem',\n                                    marginTop: '0.5rem',\n                                    fontWeight: '500'\n                                  }}>\n                                    {validationErrors.zpusob_platby}\n                                  </div>\n                                )}\n                              </FormGroup>\n                            </div>\n                          </FormRow>\n                        </>\n                      )}\n\n                      {/* Informan zprva o dalch sekcch - zobraz se po potvrzen dodavatelem, ale ne kdy je ji odeslno */}\n                      {formData.dodavatel_zpusob_potvrzeni?.potvrzeni === 'ANO' &&\n                       formData.dodavatel_zpusob_potvrzeni?.zpusoby?.length > 0 &&\n                       formData.dodavatel_zpusob_potvrzeni?.platba &&\n                       !formData.stav_odeslano &&\n                       currentPhase < 4 && (\n                        <div style={{\n                          backgroundColor: '#f0f9ff',\n                          border: '1px solid #bfdbfe',\n                          borderRadius: '8px',\n                          padding: '1rem',\n                          marginTop: '1rem',\n                          display: 'flex',\n                          flexDirection: 'column',\n                          gap: '0.5rem'\n                        }}>\n                          <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                            <FontAwesomeIcon\n                              icon={faInfoCircle}\n                              style={{ color: '#3b82f6', fontSize: '1rem' }}\n                            />\n                            <span style={{ fontSize: '0.875rem', color: '#1e40af' }}>\n                              Po vyplnn daj o dodavateli budou dostupn dal sekce.\n                            </span>\n                          </div>\n                          {formData.dt_akceptace && (\n                            <div style={{ fontSize: '0.875rem', color: '#1e40af', marginTop: '0.25rem' }}>\n                              <strong>Datum potvrzen:</strong> {formatDateOnly(formData.dt_akceptace)}\n                              {formData.dodavatel_potvrdil_id && (\n                                <div style={{ marginTop: '0.25rem' }}>\n                                  <strong>Potvrdil:</strong> {getUserNameById(formData.dodavatel_potvrdil_id)}\n                                </div>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                      )}\n                    </FormGroup>\n                  </FormRow>\n\n                  {/* Info blok - Dodavatel potvrdil objednvku */}\n                  {/*  ZOBRAZ SE JEN PO ULOEN DO DB (workflow POTVRZENA) */}\n                  {hasWorkflowState(formData.stav_workflow_kod, 'POTVRZENA') && formData.dodavatel_potvrdil_id && formData.dt_akceptace ? (\n                    <div style={{\n                      backgroundColor: '#dcfce7',\n                      border: '1px solid #16a34a',\n                      borderRadius: '6px',\n                      padding: '1rem',\n                      marginTop: '1rem',\n                      color: '#166534',\n                      fontSize: '0.875rem'\n                    }}>\n                      <div style={{ fontWeight: '600', marginBottom: '0.25rem' }}>\n                         Dodavatel potvrdil objednvku\n                      </div>\n                      <div>\n                        <strong>Datum potvrzen:</strong> {formatDateOnly(formData.dt_akceptace)}  <strong>Potvrdil:</strong> {getUserNameById(formData.dodavatel_potvrdil_id)}\n                      </div>\n                      {/* Zpsob potvrzen a platba - na jednom dku */}\n                      {(formData.dodavatel_zpusob_potvrzeni?.zpusoby?.length > 0 || formData.dodavatel_zpusob_potvrzeni?.platba) && (\n                        <div>\n                          {formData.dodavatel_zpusob_potvrzeni?.zpusoby?.length > 0 && (\n                            <>\n                              <strong>Zpsob potvrzen:</strong> {formData.dodavatel_zpusob_potvrzeni.zpusoby.map(zpusob => {\n                                const labels = {\n                                  'email': 'E-mail',\n                                  'telefon': 'Telefont',\n                                  'podepsana_objednavka': 'Podepsan objednvka',\n                                  'eshop': 'e-Shop'\n                                };\n                                return labels[zpusob] || zpusob;\n                              }).join(', ')}\n                            </>\n                          )}\n                          {formData.dodavatel_zpusob_potvrzeni?.zpusoby?.length > 0 && formData.dodavatel_zpusob_potvrzeni?.platba && '  '}\n                          {formData.dodavatel_zpusob_potvrzeni?.platba && (\n                            <>\n                              <strong>Platba:</strong> {formData.dodavatel_zpusob_potvrzeni.platba === 'faktura' ? 'Fakturou' :\n                                                          formData.dodavatel_zpusob_potvrzeni.platba === 'hotove' ? 'Hotov (pokladna)' :\n                                                          formData.dodavatel_zpusob_potvrzeni.platba}\n                            </>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  ) : (\n                    <div style={{\n                      backgroundColor: '#dbeafe',\n                      border: '2px solid #3b82f6',\n                      borderRadius: '8px',\n                      padding: '1rem',\n                      marginTop: '1rem',\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '0.5rem'\n                    }}>\n                      <FontAwesomeIcon\n                        icon={faInfoCircle}\n                        style={{ color: '#3b82f6', fontSize: '1.25rem' }}\n                      />\n                      <div style={{ flex: 1 }}>\n                        <div style={{ fontWeight: '600', color: '#1e40af', marginBottom: '0.25rem' }}>\n                           ek se na potvrzen dodavatelem\n                        </div>\n                        <div style={{ fontSize: '0.875rem', color: '#1e40af' }}>\n                          Po potvrzen objednvky dodavatelem se zde zobraz daje o potvrzen.\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                </SectionContent>\n              </FormSection>\n              )}\n\n              {/* Sekce: Uveejnn v registru smluv */}\n              {/*  FZE 4: Pouze checkbox \"M bt zveejnna\" */}\n              {registrState.visible && (\n              <FormSection data-section=\"registr_smluv\">\n                <SectionHeader\n                  sectionTheme={getSectionTheme('registr_smluv')}\n                  isActive={isSectionActive('registr_smluv')}\n                >\n                  <SectionTitle sectionTheme={getSectionTheme('registr_smluv')}>\n                    <SectionIcon sectionTheme={getSectionTheme('registr_smluv')}>\n                      <FontAwesomeIcon icon={faFileContract} />\n                    </SectionIcon>\n                    <span>Rozhodnut o zveejnn v registru smluv</span>\n\n                    {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n                    {isRegistrLocked && !shouldLockAllSections && (\n                      <LockWarning title={\n                        (formData.dt_zverejneni && formData.registr_iddt && formData.ma_byt_zverejnena)\n                          ? 'Registr je zveejnn a zamen. Odemknout me pouze uivatel s oprvnnm ORDER_PUBLISH_REGISTRY.'\n                          : ((formData.ma_byt_zverejnena === false && currentPhase >= 6)\n                            ? 'Registr nen k zveejnn a je zamen. Odemknout me pouze uivatel s oprvnnm ORDER_PUBLISH_REGISTRY.'\n                            : 'Registr je zamen. Odemknout me pouze uivatel s oprvnnm ORDER_PUBLISH_REGISTRY.'\n                          )\n                      }>\n                         Sekce zamena\n                      </LockWarning>\n                    )}\n                  </SectionTitle>\n\n                  <SectionControls>\n                    {/*  Nezobrazovat tlatko odemknut kdy je globln lock (shouldLockAllSections) */}\n                    {isRegistrLocked && !shouldLockAllSections && canPublishRegistry && (\n                      <UnlockButton\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setShowUnlockRegistrConfirm(true);\n                        }}\n                        title=\"Odemknout sekci Registr smluv\"\n                      >\n                        <Unlock />\n                      </UnlockButton>\n                    )}\n\n                    <CollapseIcon\n                      collapsed={sectionStates.registr_smluv}\n                      sectionTheme={getSectionTheme('registr_smluv')}\n                      onClick={() => toggleSection('registr_smluv')}\n                      style={{ cursor: 'pointer' }}\n                    >\n                      <FontAwesomeIcon icon={faChevronUp} />\n                    </CollapseIcon>\n                  </SectionControls>\n                </SectionHeader>\n                <SectionContent collapsed={sectionStates.registr_smluv}>\n                  {/* CHECKBOX \"M bt zveejnna\" - zobraz se vdy kdy je sekce viditeln */}\n                  <div style={{ marginBottom: '1.5rem' }}>\n                    <Label style={{ marginBottom: '0.5rem' }}>Zveejnn</Label>\n                    <label style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.75rem',\n                        padding: '0.625rem 1rem',\n                        backgroundColor: formData.ma_byt_zverejnena ? '#dcfce7' : '#fff',\n                        border: formData.ma_byt_zverejnena ? '2px solid #16a34a' : '2px solid #e5e7eb',\n                        borderRadius: '8px',\n                        cursor: (isRegistrLocked) ? 'not-allowed' : 'pointer',\n                        fontSize: '0.95rem',\n                        fontWeight: '500',\n                        color: formData.ma_byt_zverejnena ? '#166534' : '#374151',\n                        opacity: (isRegistrLocked) ? 0.6 : 1,\n                        minHeight: '44px',\n                        boxSizing: 'border-box'\n                      }}>\n                        <input\n                          type=\"checkbox\"\n                          checked={formData.ma_byt_zverejnena || false}\n                          onChange={(e) => {\n                            // Pokud je sekce zamena, nedlej nic\n                            if (isRegistrLocked) return;\n\n                            // Pokud odkrtv a cena >= 50K, zobrazit confirm dialog\n                            if (!e.target.checked && formData.ma_byt_zverejnena && celkovaCenaBezDPH >= 50000) {\n                              setShowCancelPublishConfirm(true);\n                            } else {\n                              // Bu zakrtv, nebo odkrtv pod 50K  prost zm\n                              handleInputChange('ma_byt_zverejnena', e.target.checked);\n                            }\n                          }}\n                          disabled={isRegistrLocked}\n                          style={{\n                            width: '18px',\n                            height: '18px',\n                            cursor: (isRegistrLocked) ? 'not-allowed' : 'pointer',\n                            flexShrink: 0\n                          }}\n                        />\n                        <span style={{ flex: 1 }}>\n                          {currentPhase >= 5\n                            ? 'Objednvka m bt zveejnna v registru smluv'\n                            : 'M bt zveejnna'}\n                        </span>\n                      </label>\n\n                      {/* Informan text o povinnosti zveejnn */}\n                      <div style={{\n                        marginTop: '0.75rem',\n                        padding: '0.75rem 1rem',\n                        backgroundColor: celkovaCenaBezDPH >= 50000 ? '#dbeafe' : '#f3f4f6',\n                        border: `1px solid ${celkovaCenaBezDPH >= 50000 ? '#3b82f6' : '#d1d5db'}`,\n                        borderRadius: '6px',\n                        fontSize: '0.875rem',\n                        color: celkovaCenaBezDPH >= 50000 ? '#1e40af' : '#6b7280'\n                      }}>\n                        <div style={{ display: 'flex', alignItems: 'flex-start', gap: '0.5rem' }}>\n                          <FontAwesomeIcon\n                            icon={faInfoCircle}\n                            style={{ fontSize: '1rem', marginTop: '0.125rem', flexShrink: 0 }}\n                          />\n                          <div>\n                            <div style={{ fontWeight: '600', marginBottom: '0.25rem' }}>\n                              {celkovaCenaBezDPH >= 50000 ? 'Povinn zveejnn' : 'Voliteln zveejnn'}\n                            </div>\n                            <div>\n                              {celkovaCenaBezDPH >= 50000 ? (\n                                <>\n                                  Celkov cena <strong>{celkovaCenaBezDPH.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K bez DPH</strong> je nad limitem 50 000 K.\n                                  Objednvka <strong>mus bt zveejnna</strong> v registru smluv podle zkona.\n                                </>\n                              ) : (\n                                <>\n                                  Celkov cena <strong>{celkovaCenaBezDPH.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K bez DPH</strong> je pod limitem 50 000 K.\n                                  Zveejnn v registru smluv je voliteln.\n                                </>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n\n                  {/* FZE 4: Instrukce a varovn */}\n                  {(isArchived || currentPhase === 4) && (\n                    <>\n                      {!formData.ma_byt_zverejnena && celkovaCenaBezDPH < 50000 && (\n                        <div style={{\n                          padding: '1rem',\n                          backgroundColor: '#fef3c7',\n                          border: '1px solid #f59e0b',\n                          borderRadius: '6px',\n                          fontSize: '0.875rem',\n                          color: '#92400e'\n                        }}>\n                           Po uloen s odkrtnutm checkboxem se pesko vyplovn registru smluv a pokrauje se pmo k fakturaci.\n                        </div>\n                      )}\n                    </>\n                  )}\n                </SectionContent>\n              </FormSection>\n              )}\n              {/* KONEC: Sekce Registr smluv (FZE 4 - checkbox) */}\n\n              {/*  INFORMAN BLOK: Pro uivatele BEZ prva ORDER_PUBLISH_REGISTRY - pouze kdy EK na vyplnn */}\n              {(() => {\n                const isRegistrFilled = formData.dt_zverejneni && formData.registr_iddt;\n                const showInfoBlock = registrVyplneniState.visible && !canPublishRegistry && !isRegistrFilled;\n                return showInfoBlock && (\n                  <div style={{\n                    margin: '2rem 0',\n                    padding: '1rem 1.25rem',\n                    backgroundColor: '#fef3c7',\n                    border: '1px solid #f59e0b',\n                    borderRadius: '8px',\n                    color: '#92400e'\n                  }}>\n                    <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                       Zveejnn v registru smluv\n                    </div>\n                    <div style={{ fontSize: '0.875rem' }}>\n                      Objednvka ek na zveejnn v registru smluv. Tuto akci me provst pouze uivatel s oprvnnm pro sprvu registru.\n                    </div>\n                  </div>\n                );\n              })()}\n\n              {/*  SEKCE: VYPLNN REGISTRU SMLUV - ZOBRAZ SE VE FZI 5 (UVEREJNIT) */}\n              {/*  FZE 5: Datum + IDDT + checkbox (VOLITELN - pouze kdy ANO ve FZI 4) */}\n              {/*  PRVA: \n                  - Uivatel S prvem ORDER_PUBLISH_REGISTRY vid sekci ve FZI 5 (mohou vyplnit registr)\n                  - Uivatel BEZ prva vid sekci kdy je ji vyplnn (dt_zverejneni + registr_iddt)\n              */}\n              {(() => {\n                const isRegistrFilled = formData.dt_zverejneni && formData.registr_iddt;\n                const shouldShowRegistrVyplneni = registrVyplneniState.visible && (\n                  canPublishRegistry || isRegistrFilled\n                );\n                return shouldShowRegistrVyplneni && (\n              <FormSection data-section=\"registr_smluv_vyplneni\">\n                <SectionHeader\n                  sectionTheme={getSectionTheme('registr_smluv_vyplneni')}\n                  isActive={isSectionActive('registr_smluv_vyplneni')}\n                >\n                  <SectionTitle sectionTheme={getSectionTheme('registr_smluv_vyplneni')}>\n                    <SectionIcon sectionTheme={getSectionTheme('registr_smluv_vyplneni')}>\n                      <FontAwesomeIcon icon={faFileContract} />\n                    </SectionIcon>\n                    <span>Potvrzen zveejnn objednvky v registru smluv</span>\n\n                    {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) */}\n                    {isRegistrVyplneniLocked && !shouldLockAllSections && (\n                      <LockWarning title=\"Registr je zamen. Odemknout me pouze uivatel s oprvnnm ORDER_PUBLISH_REGISTRY.\">\n                         Sekce zamena\n                      </LockWarning>\n                    )}\n                  </SectionTitle>\n\n                  <SectionControls>\n                    {/*  Nezobrazovat tlatko odemknut kdy je globln lock (shouldLockAllSections) */}\n                    {isRegistrVyplneniLocked && !shouldLockAllSections && canPublishRegistry && (\n                      <UnlockButton\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setShowUnlockRegistrConfirm(true);\n                        }}\n                        title=\"Odemknout sekci Registr smluv\"\n                      >\n                        <Unlock />\n                      </UnlockButton>\n                    )}\n\n                    <CollapseIcon\n                      collapsed={sectionStates.registr_smluv_vyplneni}\n                      sectionTheme={getSectionTheme('registr_smluv_vyplneni')}\n                      onClick={() => toggleSection('registr_smluv_vyplneni')}\n                      style={{ cursor: 'pointer' }}\n                    >\n                      <FontAwesomeIcon icon={faChevronUp} />\n                    </CollapseIcon>\n                  </SectionControls>\n                </SectionHeader>\n                <SectionContent collapsed={sectionStates.registr_smluv_vyplneni}>\n                  {/* Grid 3 sloupce: Checkbox | Datum | Identifiktor */}\n                  <div style={{\n                    display: 'grid',\n                    gridTemplateColumns: '300px 1fr 1fr',\n                    gap: '1.5rem',\n                    alignItems: 'start'\n                  }}>\n                    {/* 1. CHECKBOX - M bt zveejnna */}\n                    <div>\n                      <Label style={{ marginBottom: '0.5rem' }}>Zveejnn</Label>\n                      <label style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.75rem',\n                        padding: '0.625rem 1rem',\n                        backgroundColor: formData.ma_byt_zverejnena ? '#dcfce7' : '#fff',\n                        border: formData.ma_byt_zverejnena ? '2px solid #16a34a' : '2px solid #e5e7eb',\n                        borderRadius: '8px',\n                        cursor: isRegistrVyplneniLocked ? 'not-allowed' : 'pointer',\n                        fontSize: '0.95rem',\n                        fontWeight: '500',\n                        color: formData.ma_byt_zverejnena ? '#166534' : '#374151',\n                        opacity: isRegistrVyplneniLocked ? 0.6 : 1,\n                        minHeight: '44px',\n                        boxSizing: 'border-box'\n                      }}>\n                        <input\n                          type=\"checkbox\"\n                          checked={formData.ma_byt_zverejnena || false}\n                          onChange={(e) => {\n                            if (isRegistrVyplneniLocked) return;\n\n                            // Pokud odkrtv a cena >= 50K, zobrazit confirm dialog\n                            if (!e.target.checked && formData.ma_byt_zverejnena && celkovaCenaBezDPH >= 50000) {\n                              setShowCancelPublishConfirm(true);\n                            } else {\n                              handleInputChange('ma_byt_zverejnena', e.target.checked);\n                            }\n                          }}\n                          disabled={isRegistrVyplneniLocked}\n                          style={{\n                            width: '18px',\n                            height: '18px',\n                            cursor: isRegistrVyplneniLocked ? 'not-allowed' : 'pointer',\n                            flexShrink: 0\n                          }}\n                        />\n                        <span style={{ flex: 1, whiteSpace: 'nowrap' }}>M bt zveejnna</span>\n                      </label>\n                    </div>\n\n                    {/* 2. DATUM ZVEEJNN */}\n                    <div>\n                      <Label required={formData.ma_byt_zverejnena}>Datum zveejnn (VZ)</Label>\n                      <DatePicker\n                        fieldName=\"dt_zverejneni\"\n                        value={formData.dt_zverejneni}\n                        onChange={(value) => {\n                          handleInputChange('dt_zverejneni', value);\n                          if (value && !formData.zverejnil_id) {\n                            const user_id = localStorage.getItem('user_id');\n                            if (user_id) {\n                              handleInputChange('zverejnil_id', parseInt(user_id, 10));\n                            }\n                          }\n                        }}\n                        onBlur={(value) => handleFieldBlur('dt_zverejneni', value)}\n                        disabled={!formData.ma_byt_zverejnena || isRegistrVyplneniLocked}\n                        hasError={!!validationErrors.dt_zverejneni}\n                        placeholder=\"Vyberte datum...\"\n                      />\n                      {validationErrors.dt_zverejneni && (\n                        <ErrorText style={{ marginTop: '0.5rem' }}>{validationErrors.dt_zverejneni}</ErrorText>\n                      )}\n                    </div>\n\n                    {/* 3. IDENTIFIKTOR */}\n                    <div>\n                      <Label required={formData.ma_byt_zverejnena}>Identifiktor</Label>\n                      <InputWithIcon hasIcon>\n                        <FontAwesomeIcon icon={faHashtag} />\n                        <Input\n                          type=\"text\"\n                          name=\"registr_iddt\"\n                          value={formData.registr_iddt || ''}\n                          onChange={(e) => {\n                            handleInputChange('registr_iddt', e.target.value);\n                            if (e.target.value && !formData.zverejnil_id) {\n                              const user_id = localStorage.getItem('user_id');\n                              if (user_id) {\n                                handleInputChange('zverejnil_id', parseInt(user_id, 10));\n                              }\n                            }\n                          }}\n                          disabled={!formData.ma_byt_zverejnena || isRegistrVyplneniLocked}\n                          hasError={!!validationErrors.registr_iddt}\n                          hasIcon\n                          placeholder=\"Zadejte identifiktor...\"\n                        />\n                      </InputWithIcon>\n                      {validationErrors.registr_iddt && (\n                        <ErrorText style={{ marginTop: '0.5rem' }}>{validationErrors.registr_iddt}</ErrorText>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* LUT ALERT - kdy NEN zakrtnuto */}\n                  {!formData.ma_byt_zverejnena && (\n                    <div style={{\n                      padding: '0.875rem 1rem',\n                      backgroundColor: '#fef3c7',\n                      border: '1px solid #f59e0b',\n                      borderRadius: '6px',\n                      fontSize: '0.875rem',\n                      color: '#92400e',\n                      marginTop: '1rem',\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '0.5rem'\n                    }}>\n                      <FontAwesomeIcon icon={faInfoCircle} style={{ fontSize: '1rem' }} />\n                      <div>\n                        <strong>Objednvka nebude zveejnna v registru smluv.</strong>\n                      </div>\n                    </div>\n                  )}\n\n                  {/*  ZELEN BOX - Objednvka byla zveejnna (pouze kdy UVEREJNENA) */}\n                  {hasWorkflowState(formData.stav_workflow_kod, 'UVEREJNENA') && (\n                    <div style={{\n                      marginTop: '1.5rem',\n                      padding: '1rem',\n                      backgroundColor: '#dcfce7',\n                      border: '1px solid #16a34a',\n                      borderRadius: '6px',\n                      fontSize: '0.875rem',\n                      color: '#166534'\n                    }}>\n                      <div style={{ fontWeight: '600', marginBottom: '0.25rem' }}>\n                         Objednvka byla zveejnna v registru smluv\n                      </div>\n                      <div>\n                        <strong>Datum zveejnn:</strong> {formatDateOnly(formData.dt_zverejneni)}  <strong>Zveejnil:</strong> {getUserNameById(formData.zverejnil_id)}\n                        {formData.registr_iddt && (\n                          <>\n                            {'  '}\n                            <strong>ID registru:</strong> {formData.registr_iddt}\n                          </>\n                        )}\n                      </div>\n                    </div>\n                  )}\n                </SectionContent>\n              </FormSection>\n                );\n              })()}\n              {/* KONEC: Sekce Vyplnn registru smluv (FZE 5 - voliteln) */}\n\n              {/*  SEKCE: FAKTURACE / DOKLADY - ZOBRAZ SE VE FZI 6+ (FAKTURACE a ve) */}\n              {/* Podmnky zobrazen:\n                  1. currentPhase >= 6 (FZE 6 a ve - 6, 7, 8, 9)\n                  2.  Zobrazuje se i ve vych fzch, ale je zamen (lockLogic v workflowManager)\n                  3.  SKRT kdy platba = 'pokladna' (msto toho se zobraz Dodaten dokumenty)\n                  4.  Pokud platba = 'faktura'  \"Fakturace\" s plnm blokem faktur\n              */}\n              {(() => {\n                //  Urit typ platby: pokladna nebo faktura\n                // Kontroluje platbu z financovn objednvky A z potvrzen dodavatele\n                const isPlatbaPokladnaObj = formData.financovani?.platba === 'pokladna';\n                const isPlatbaPokladnaDodavatel = formData.dodavatel_zpusob_potvrzeni?.platba === 'pokladna';\n                const isPokladna = isPlatbaPokladnaObj || isPlatbaPokladnaDodavatel;\n\n                //  SKRT sekci Fakturace kdy je pokladna\n                //  PRVA: \n                // - Uivatel S prvem INVOICE_MANAGE vid sekci od FZE 6 (mohou pidvat faktury)\n                // - Uivatel BEZ prva vid sekci kdy:\n                //   a) jsou ve FZI 7+ (aktivn fze po fakturaci)\n                //   b) existuj faktury (sekce je ji vyplnn)\n                const hasFaktury = formData.faktury && formData.faktury.length > 0;\n                const shouldShow = !isPokladna && (\n                  canManageInvoices \n                    ? currentPhase >= 6  // S prvem: vid od FZE 6\n                    : (currentPhase >= 7 || hasFaktury)  // Bez prva: vid od FZE 7 nebo kdy jsou faktury\n                );\n\n                // Pokud nen uren typ platby, zobrazit jako fakturu (default)\n                const sectionTitle = 'Fakturace k objednvce';\n                const sectionDescription = `(poet: ${formData.faktury?.length || 0})`;\n\n                return shouldShow ? (\n                <FormSection data-section=\"fakturace\">\n                  <SectionHeader\n                    sectionTheme=\"section-invoice\"\n                    isActive={true}\n                    style={{\n                      background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n                      borderColor: '#2563eb'\n                    }}\n                  >\n                    <SectionTitle sectionTheme=\"section-invoice\" style={{ color: '#fff' }}>\n                      <SectionIcon sectionTheme=\"section-invoice\" style={{ color: '#fff' }}>\n                        <FontAwesomeIcon icon={faCreditCard} />\n                      </SectionIcon>\n                      {sectionTitle}\n                      <span style={{\n                        fontSize: '0.75rem',\n                        marginLeft: '0.5rem',\n                        fontWeight: '400',\n                        opacity: 0.9\n                      }}>\n                        {sectionDescription}\n                      </span>\n                      {/*  Nezobrazovat zmek kdy je globln lock (shouldLockAllSections) - odemknout lze pouze z hlaviky */}\n                      {isFakturaceLockedPhase7 && !shouldLockAllSections && (\n                        <LockWarning title=\"Sekce je zamena. Odemknout me administrtor nebo uivatel s prvem ORDER_MANAGE.\">\n                           Sekce zamena\n                        </LockWarning>\n                      )}\n                    </SectionTitle>\n\n                    <SectionControls>\n                      {/*  Nezobrazovat tlatko odemknut kdy je globln lock (shouldLockAllSections) */}\n                      {isFakturaceLockedPhase7 && !shouldLockAllSections && canManageInvoices && (\n                        <UnlockButton\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            setShowUnlockFakturaceConfirm(true);\n                          }}\n                          title=\"Odemknout sekci Fakturace\"\n                        >\n                          <Unlock />\n                        </UnlockButton>\n                      )}\n\n                      <CollapseIcon\n                        collapsed={sectionStates.fakturace}\n                        onClick={() => toggleSection('fakturace')}\n                        style={{ color: '#fff', cursor: 'pointer' }}\n                      >\n                        <FontAwesomeIcon icon={faChevronUp} />\n                      </CollapseIcon>\n                    </SectionControls>\n                  </SectionHeader>\n\n                  <SectionContent collapsed={sectionStates.fakturace}>\n                    <div>\n                      {/*  POKLADNA: Zobrazit jen dropzone pro plohy (paragony) */}\n                      {isPokladna ? (\n                        <div style={{ padding: '1.5rem' }}>\n                          {(() => {\n                            //  ZAJISTIT: Vdy alespo jedna \"faktura\" (pokladn doklad) ve fzi 7+\n                            if ((!formData.faktury || formData.faktury.length === 0) && !fakturyLoading) {\n                              const dnesniDatum = formatDateForPicker(new Date());\n                              const pokladniDoklad = {\n                                id: `temp-pokladna-${Date.now()}`,\n                                objednavka_id: formData.id,\n                                fa_datum_doruceni: dnesniDatum,\n                                fa_dorucena: 1,\n                                fa_castka: null, // Nepovinn pro pokladnu\n                                fa_cislo_vema: '', // Nepovinn pro pokladnu\n                                fa_strediska_kod: formData.strediska_kod || [],\n                                fa_splatnost: null, // Nepovinn pro pokladnu\n                                fa_poznamka: '',\n                                vytvoril_uzivatel_id: user_id,\n                                vytvoril_jmeno: getUserNameById(user_id),\n                                dt_vytvoreni: new Date().toISOString(),\n                                dt_aktualizace: null,\n                                aktivni: 1,\n                                _isNew: true,\n                               _isPokladna: true, //  Pznak pro pokladn doklad\n                                attachments: []\n                              };\n\n                              setTimeout(() => {\n                                updateFaktury([pokladniDoklad]);\n                              }, 0);\n                            }\n                            return null;\n                          })()}\n\n                          <div style={{\n                            background: '#f8fafc',\n                            border: '2px solid #e2e8f0',\n                            borderRadius: '8px',\n                            padding: '2rem'\n                          }}>\n                            <div style={{\n                              fontSize: '2.5rem',\n                              marginBottom: '1rem',\n                              textAlign: 'center',\n                              color: '#64748b'\n                            }}>\n                              \n                            </div>\n                            <div style={{\n                              fontSize: '1.125rem',\n                              fontWeight: '500',\n                              color: '#334155',\n                              marginBottom: '0.5rem',\n                              textAlign: 'center'\n                            }}>\n                              Plohy doklad z pokladny\n                            </div>\n                            <div style={{\n                              fontSize: '0.875rem',\n                              color: '#64748b',\n                              marginBottom: '1.5rem',\n                              textAlign: 'center'\n                            }}>\n                              Nahrajte paragony, pokladn doklady a dal dokumenty k platb\n                            </div>\n\n                            {/* DROPZONE PRO PLOHY POKLADNY - pouv stejnou logiku jako faktury */}\n                            {formData.faktury && formData.faktury.length > 0 && formData.faktury[0] && (\n                              <>\n                                <InvoiceAttachmentsCompact\n                                  key={`pokladna-attachments-${formData.faktury[0].id}-${formData.id}`}\n                                  fakturaId={formData.faktury[0].id}\n                                  objednavkaId={formData.id}\n                                  fakturaTypyPrilohOptions={fakturaTypyPrilohOptions}\n                                  readOnly={shouldLockFaktury}\n                                  onISDOCParsed={handleISDOCParsed}\n                                  formData={formData}\n                                  faktura={formData.faktury[0]}\n                                  validateInvoiceForAttachments={validateInvoiceForAttachments}\n                                  isPokladna={true}\n                                  allUsers={allUsers}\n                                  attachments={(() => {\n                                    const atts = formData.faktury[0].attachments || [];\n                                    console.log(` [OrderForm25] Pedvm plohy do InvoiceAttachmentsCompact (fakturaId=${formData.faktury[0].id}):`, atts);\n                                    return atts;\n                                  })()}\n                                  onAttachmentsChange={(newAttachments) => {\n                                    console.log(` [OrderForm25] onAttachmentsChange voln s:`, newAttachments);\n                                    handleInvoiceAttachmentsChange(formData.faktury[0].id, newAttachments);\n                                  }}\n                                  onAttachmentUploaded={(uploadedAttachment) => {\n                                    handleInvoiceAttachmentUploaded(formData.faktury[0].id, uploadedAttachment);\n                                  }}\n                                  onCreateInvoiceInDB={handleCreateInvoiceInDB}\n                                />\n\n                                {/* POLE POZNMKA */}\n                                <FormRow style={{ marginTop: '1.5rem' }}>\n                                  <FormGroup style={{ gridColumn: '1 / -1' }}>\n                                    <Label>\n                                      Poznmka k platb\n                                      <span style={{ fontSize: '0.75rem', color: '#64748b', fontWeight: 'normal', marginLeft: '0.5rem' }}>\n                                        (Voliteln)\n                                      </span>\n                                    </Label>\n                                    <TextArea\n                                      value={formData.faktury[0].fa_poznamka || ''}\n                                      onChange={(e) => {\n                                        const updatedFaktury = formData.faktury.map((f, idx) =>\n                                          idx === 0\n                                            ? { ...f, fa_poznamka: e.target.value }\n                                            : f\n                                        );\n                                        updateFaktury(updatedFaktury);\n                                      }}\n                                      disabled={shouldLockFaktury}\n                                      placeholder=\"Nap.: Platba za materil, paragony ze dne 1.11.2025, apod.\"\n                                      rows={3}\n                                    />\n                                  </FormGroup>\n                                </FormRow>\n                              </>\n                            )}\n\n                            {/* Info poznmka */}\n                            <div style={{\n                              marginTop: '1.5rem',\n                              padding: '1rem',\n                              background: '#fef3c7',\n                              border: '1px solid #fbbf24',\n                              borderRadius: '6px',\n                              fontSize: '0.875rem',\n                              color: '#92400e',\n                              textAlign: 'left'\n                            }}>\n                              <strong> Poznmka:</strong> Pi platb pokladnou nen nutn vyplovat sla faktur ani stky.\n                              Sta nahrt paragony nebo pokladn doklady jako plohy a ppadn doplnit poznmku.\n                            </div>\n                          </div>\n                        </div>\n                      ) : (\n                        /* FAKTURA: Pln blok s fakturami */\n                        <>\n                      {(() => {\n                        //  ZAJISTIT: Vdy alespo jedna faktura ve fzi 7+\n                        // Pokud pole je przdn, okamit ho napl\n                        if ((!formData.faktury || formData.faktury.length === 0) && !fakturyLoading) {\n                          const dnesniDatum = formatDateForPicker(new Date());\n                          const novaFaktura = {\n                            id: `temp-${Date.now()}`,\n                            objednavka_id: formData.id,\n                            fa_datum_doruceni: dnesniDatum,\n                            fa_dorucena: 1,\n                            fa_castka: '',\n                            fa_cislo_vema: '',\n                            fa_strediska_kod: formData.strediska_kod || [],\n                            fa_splatnost: '',\n                            fa_poznamka: '',\n                            vytvoril_uzivatel_id: user_id,\n                            vytvoril_jmeno: getUserNameById(user_id),\n                            dt_vytvoreni: new Date().toISOString(),\n                            dt_aktualizace: null,\n                            aktivni: 1,\n                            _isNew: true,\n                            attachments: [] // Przdn pole pro plohy\n                          };\n\n                          // Okamit aktualizuj stav\n                          setTimeout(() => {\n                            updateFaktury([novaFaktura]);\n                          }, 0);\n                        }\n                        return null;\n                      })()}\n\n                      {fakturyLoading ? (\n                        <div style={{ textAlign: 'center', padding: '2rem', color: '#64748b' }}>\n                          Natn faktur...\n                        </div>\n                      ) : (\n                        <div style={{ marginTop: '1.5rem' }}>\n                          {/*  FALLBACK: Pokud i pes ve uveden je pole przdn, zobraz placeholder */}\n                          {(!formData.faktury || formData.faktury.length === 0) ? (\n                            <div style={{\n                              border: '2px dashed #cbd5e1',\n                              borderRadius: '8px',\n                              padding: '2rem',\n                              textAlign: 'center',\n                              color: '#64748b',\n                              background: '#f8fafc'\n                            }}>\n                              <div style={{ fontSize: '1.25rem', marginBottom: '0.5rem' }}></div>\n                              <div style={{ fontWeight: '500', marginBottom: '0.5rem' }}>Natm prvn fakturu...</div>\n                              <div style={{ fontSize: '0.875rem' }}>Prosm chvli strpen</div>\n                            </div>\n                          ) : (\n                            formData.faktury.map((faktura, index) => {\n                            const isEditing = editingFaktura?.id === faktura.id;\n                            const currentData = isEditing ? fakturaFormData : faktura;\n                            const isVecnaPotvrzena = faktura.vecna_spravnost_potvrzeno === 1;\n\n                            return (\n                            <div key={faktura.id} style={{\n                              border: '2px solid #3b82f6',\n                              borderRadius: '12px',\n                              padding: '0',\n                              marginBottom: '1.5rem',\n                              background: isEditing ? '#f0f9ff' : (isVecnaPotvrzena ? '#f0fdf4' : '#ffffff'),\n                              boxShadow: '0 2px 8px rgba(0, 0, 0, 0.08)',\n                              overflow: 'visible'\n                            }}>\n                              {/* Zhlav faktury - vrazn */}\n                              <div style={{\n                                background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n                                color: 'white',\n                                padding: '1rem 1.25rem',\n                                fontWeight: '700',\n                                fontSize: '1.1rem',\n                                display: 'flex',\n                                alignItems: 'center',\n                                justifyContent: 'space-between',\n                                gap: '1rem',\n                                borderBottom: '3px solid #1e40af',\n                                letterSpacing: '0.5px',\n                                textTransform: 'uppercase'\n                              }}>\n                                <div style={{display: 'flex', alignItems: 'center', gap: '0.75rem'}}>\n                                  <FontAwesomeIcon icon={faCreditCard} style={{ fontSize: '1.2rem' }} />\n                                  Faktura #{index + 1}\n                                  {index === 0 && <span style={{color: '#fef3c7', fontSize: '1.3rem'}}>*</span>}\n                                  {faktura.fa_cislo_vema && (\n                                    <span style={{ \n                                      fontWeight: '600',\n                                      fontSize: '0.9rem',\n                                      background: 'rgba(255, 255, 255, 0.2)',\n                                      padding: '0.25rem 0.75rem',\n                                      borderRadius: '6px',\n                                      letterSpacing: 'normal',\n                                      textTransform: 'none'\n                                    }}>\n                                      {faktura.fa_cislo_vema}\n                                    </span>\n                                  )}\n\n                                  {/*  Info tooltip s detaily faktury */}\n                                  <FakturaInfoIconWrapper>\n                                    <FakturaInfoIcon className=\"help-icon\">\n                                      <Info />\n                                    </FakturaInfoIcon>\n                                    <FakturaTooltipBubble className=\"tooltip-bubble\">\n                                      {/* DODAVATEL z ISDOC */}\n                                      {faktura._isdoc_dodavatel && (\n                                        <>\n                                          <FakturaTooltipRow>\n                                            <FakturaTooltipLabel>Vystavil:</FakturaTooltipLabel>\n                                            <FakturaTooltipValue style={{ display: 'flex', alignItems: 'center', gap: '6px', fontWeight: '600' }}>\n                                              {faktura._isdoc_dodavatel.nazev || '---'}\n                                              {faktura._isdoc_dodavatel.nazev && (\n                                                <Copy\n                                                  size={14}\n                                                  style={{ cursor: 'pointer', color: '#6b7280' }}\n                                                  onClick={() => {\n                                                    navigator.clipboard.writeText(faktura._isdoc_dodavatel.nazev);\n                                                    showToast && showToast('Nzev zkoprovn', { type: 'success' });\n                                                  }}\n                                                  title=\"Zkoprovat nzev\"\n                                                />\n                                              )}\n                                            </FakturaTooltipValue>\n                                          </FakturaTooltipRow>\n                                          <FakturaTooltipRow>\n                                            <FakturaTooltipLabel>IO:</FakturaTooltipLabel>\n                                            <FakturaTooltipValue style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\n                                              {faktura._isdoc_dodavatel.ico || '---'}\n                                              {faktura._isdoc_dodavatel.ico && (\n                                                <Copy\n                                                  size={14}\n                                                  style={{ cursor: 'pointer', color: '#6b7280' }}\n                                                  onClick={() => {\n                                                    navigator.clipboard.writeText(faktura._isdoc_dodavatel.ico);\n                                                    showToast && showToast('IO zkoprovno', { type: 'success' });\n                                                  }}\n                                                  title=\"Zkoprovat IO\"\n                                                />\n                                              )}\n                                            </FakturaTooltipValue>\n                                          </FakturaTooltipRow>\n                                          <div style={{ borderTop: '1px solid #e5e7eb', margin: '8px 0' }}></div>\n                                        </>\n                                      )}\n\n                                      {/*  EMAIL SMROVN z ISDOC */}\n                                      {faktura._isdoc_email && (\n                                        <>\n                                          <FakturaTooltipRow>\n                                            <FakturaTooltipLabel>Smrovno na:</FakturaTooltipLabel>\n                                            <FakturaTooltipValue style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\n                                              {faktura._isdoc_email}\n                                              <Copy\n                                                size={14}\n                                                style={{ cursor: 'pointer', color: '#6b7280' }}\n                                                onClick={() => {\n                                                  navigator.clipboard.writeText(faktura._isdoc_email);\n                                                  showToast && showToast('Email zkoprovn', { type: 'success' });\n                                                }}\n                                                title=\"Zkoprovat email\"\n                                              />\n                                            </FakturaTooltipValue>\n                                          </FakturaTooltipRow>\n                                          <div style={{ borderTop: '1px solid #e5e7eb', margin: '8px 0' }}></div>\n                                        </>\n                                      )}\n\n                                      <FakturaTooltipRow>\n                                        <FakturaTooltipLabel>slo faktury:</FakturaTooltipLabel>\n                                        <FakturaTooltipValue>{faktura.fa_cislo_vema || '---'}</FakturaTooltipValue>\n                                      </FakturaTooltipRow>\n                                      <FakturaTooltipRow>\n                                        <FakturaTooltipLabel>stka:</FakturaTooltipLabel>\n                                        <FakturaTooltipValue>\n                                          {faktura.fa_castka ? `${parseFloat(faktura.fa_castka).toLocaleString('cs-CZ')} K` : '---'}\n                                        </FakturaTooltipValue>\n                                      </FakturaTooltipRow>\n                                      <FakturaTooltipRow>\n                                        <FakturaTooltipLabel>Datum vystaven:</FakturaTooltipLabel>\n                                        <FakturaTooltipValue>\n                                          {faktura.fa_datum_vystaveni ? formatDateOnly(faktura.fa_datum_vystaveni) : '---'}\n                                        </FakturaTooltipValue>\n                                      </FakturaTooltipRow>\n                                      <FakturaTooltipRow>\n                                        <FakturaTooltipLabel>Datum splatnosti:</FakturaTooltipLabel>\n                                        <FakturaTooltipValue>\n                                          {(faktura.fa_datum_splatnosti || faktura.fa_splatnost)\n                                            ? formatDateOnly(faktura.fa_datum_splatnosti || faktura.fa_splatnost)\n                                            : '---'}\n                                        </FakturaTooltipValue>\n                                      </FakturaTooltipRow>\n                                      <FakturaTooltipRow>\n                                        <FakturaTooltipLabel>Datum doruen:</FakturaTooltipLabel>\n                                        <FakturaTooltipValue>\n                                          {faktura.fa_datum_doruceni ? formatDateOnly(faktura.fa_datum_doruceni) : '---'}\n                                        </FakturaTooltipValue>\n                                      </FakturaTooltipRow>\n                                      <FakturaTooltipRow>\n                                        <FakturaTooltipLabel>Vcn sprvnost:</FakturaTooltipLabel>\n                                        <FakturaTooltipValue>\n                                          {faktura.vecna_spravnost_potvrzeno === 'ANO' && (\n                                            <span style={{ \n                                              display: 'inline-flex', \n                                              alignItems: 'center', \n                                              gap: '0.25rem',\n                                              background: '#d1fae5',\n                                              color: '#065f46',\n                                              padding: '2px 8px',\n                                              borderRadius: '4px',\n                                              fontSize: '0.75rem',\n                                              fontWeight: '600'\n                                            }}>\n                                              <FontAwesomeIcon icon={faCheckCircle} />\n                                              ANO\n                                            </span>\n                                          )}\n                                          {faktura.vecna_spravnost_potvrzeno === 'NE' && (\n                                            <span style={{ \n                                              display: 'inline-flex', \n                                              alignItems: 'center', \n                                              gap: '0.25rem',\n                                              background: '#fee2e2',\n                                              color: '#991b1b',\n                                              padding: '2px 8px',\n                                              borderRadius: '4px',\n                                              fontSize: '0.75rem',\n                                              fontWeight: '600'\n                                            }}>\n                                              <FontAwesomeIcon icon={faTimesCircle} />\n                                              NE\n                                            </span>\n                                          )}\n                                          {!faktura.vecna_spravnost_potvrzeno && (\n                                            <span style={{ color: '#9ca3af', fontSize: '0.875rem' }}>\n                                              Neoveno\n                                            </span>\n                                          )}\n                                        </FakturaTooltipValue>\n                                      </FakturaTooltipRow>\n                                      {faktura.vecna_spravnost_umisteni_majetku && (\n                                        <FakturaTooltipRow>\n                                          <FakturaTooltipLabel>Umstn majetku:</FakturaTooltipLabel>\n                                          <FakturaTooltipValue>\n                                            {faktura.vecna_spravnost_umisteni_majetku}\n                                          </FakturaTooltipValue>\n                                        </FakturaTooltipRow>\n                                      )}\n                                      {faktura.vecna_spravnost_poznamka && (\n                                        <FakturaTooltipRow>\n                                          <FakturaTooltipLabel>Poznmka VS:</FakturaTooltipLabel>\n                                          <FakturaTooltipValue>\n                                            {faktura.vecna_spravnost_poznamka}\n                                          </FakturaTooltipValue>\n                                        </FakturaTooltipRow>\n                                      )}\n                                      <FakturaTooltipRow>\n                                        <FakturaTooltipLabel>Stediska:</FakturaTooltipLabel>\n                                        <FakturaTooltipValue title={\n                                          (() => {\n                                            const strediska = faktura.fa_strediska_kod;\n                                            if (!strediska) return '---';\n                                            if (Array.isArray(strediska)) {\n                                              return strediska\n                                                .map(s => typeof s === 'object' ? (s.label || s.nazev || s.value || s.kod || s) : s)\n                                                .filter(Boolean)\n                                                .join(', ') || '---';\n                                            }\n                                            if (typeof strediska === 'string') {\n                                              return strediska || '---';\n                                            }\n                                            return '---';\n                                          })()\n                                        }>\n                                          {(() => {\n                                            const strediska = faktura.fa_strediska_kod;\n                                            if (!strediska) return '---';\n                                            if (Array.isArray(strediska)) {\n                                              return strediska\n                                                .map(s => typeof s === 'object' ? (s.label || s.nazev || s.value || s.kod || s) : s)\n                                                .filter(Boolean)\n                                                .join(', ') || '---';\n                                            }\n                                            if (typeof strediska === 'string') {\n                                              return strediska || '---';\n                                            }\n                                            return '---';\n                                          })()}\n                                        </FakturaTooltipValue>\n                                      </FakturaTooltipRow>\n                                    </FakturaTooltipBubble>\n                                  </FakturaInfoIconWrapper>\n                                </div>\n                                <div style={{display: 'flex', gap: '0.5rem'}}>\n                                  {/* Tlatko smazat fakturu */}\n                                  <button\n                                    type=\"button\"\n                                    disabled={shouldLockFaktury}\n                                    onClick={() => {\n                                      if (faktura._isNew) {\n                                        // Pokud je nov (neuloen), jen odebrat ze seznamu\n                                        const currentFaktury = Array.isArray(formData.faktury) ? formData.faktury : [];\n                                        updateFaktury(currentFaktury.filter(f => f.id !== faktura.id));\n                                        if (isEditing) {\n                                          setEditingFaktura(null);\n                                          const predpokladanaCastka = totalPrice.toString();\n                                          const dnesniDatum = formatDateForPicker(new Date());\n\n                                          setFakturaFormData({\n                                            fa_datum_doruceni: dnesniDatum,\n    fa_dorucena: 1, //  Boolean flag\n                                            fa_castka: predpokladanaCastka,\n                                            fa_cislo_vema: '',\n                                            fa_strediska_kod: formData.strediska_kod || [],\n                                            fa_poznamka: '',\n                                            fa_splatnost: ''\n                                          });\n                                        }\n                                      } else {\n                                        // Pokud je uloen, smazat pes API\n                                        handleDeleteFaktura(faktura.id);\n                                      }\n                                    }}\n                                    title=\"Smazat fakturu\"\n                                    style={{\n                                      background: shouldLockFaktury ? 'rgba(255,255,255,0.3)' : 'rgba(220, 38, 38, 0.9)',\n                                      color: 'white',\n                                      border: '1px solid rgba(255,255,255,0.5)',\n                                      borderRadius: '6px',\n                                      padding: '0.4rem',\n                                      cursor: shouldLockFaktury ? 'not-allowed' : 'pointer',\n                                      display: 'flex',\n                                      alignItems: 'center',\n                                      justifyContent: 'center',\n                                      width: '32px',\n                                      height: '32px',\n                                      opacity: shouldLockFaktury ? 0.6 : 1,\n                                      transition: 'all 0.2s ease'\n                                    }}\n                                  >\n                                    <Trash size={16} />\n                                  </button>\n                                </div>\n                              </div>\n\n                              {/* Content wrapper pro fakturu */}\n                              <div style={{ padding: '1.25rem' }}>\n\n                              {/* INLINE EDITOVATELN POLE - 3 sloupce: datum fixn, zbytek proporcionln */}\n                              <FormRow style={{gridTemplateColumns: '280px 1fr 1fr'}}>\n                                <FormGroup>\n                                  <Label required>Datum doruen</Label>\n                                  <DatePicker\n                                    fieldName={`fa_${index + 1}_datum_doruceni`}\n                                    value={faktura.fa_datum_doruceni ?? (faktura._isNew ? formatDateForPicker(new Date()) : '')}\n                                    hasError={!!validationErrors[`faktura_${index + 1}_datum_doruceni`]}\n                                    disabled={shouldLockFaktury}\n                                    onChange={(value) => {\n                                      const updatedFaktury = formData.faktury.map(f =>\n                                        f.id === faktura.id\n                                          ? { \n                                              ...f, \n                                              fa_datum_doruceni: value, \n                                              fa_dorucena: value ? 1 : 0,\n                                              _isNew: false //  Odstranit _isNew flag pi jakkoliv zmn\n                                            }\n                                          : f\n                                      );\n                                      updateFaktury(updatedFaktury);\n                                    }}\n                                    placeholder=\"Vyberte datum doruen\"\n                                  />\n                                </FormGroup>\n\n                                <FormGroup>\n                                  <Label required>Variabiln symbol</Label>\n                                  <InputWithIcon hasIcon>\n                                    <FontAwesomeIcon icon={faHashtag} />\n                                    <Input\n                                      type=\"text\"\n                                      value={faktura.fa_cislo_vema || ''}\n                                      hasError={!!validationErrors[`faktura_${index + 1}_cislo`]}\n                                      disabled={shouldLockFaktury}\n                                      onChange={(e) => {\n                                        const updatedFaktury = formData.faktury.map(f =>\n                                          f.id === faktura.id\n                                            ? { ...f, fa_cislo_vema: e.target.value, _isNew: false }\n                                            : f\n                                        );\n                                        updateFaktury(updatedFaktury);\n                                      }}\n                                      required\n                                      placeholder=\"12345678\"\n                                      hasIcon\n                                    />\n                                  </InputWithIcon>\n                                </FormGroup>\n\n                                <FormGroup>\n                                  <Label required>stka v. DPH</Label>\n                                  <CurrencyInput\n                                    fieldName=\"fa_castka\"\n                                    value={faktura.fa_castka ?? ''}\n                                    hasError={!!validationErrors[`faktura_${index + 1}_castka`]}\n                                    disabled={shouldLockFaktury}\n                                    onChange={(field, value) => {\n                                      const updatedFaktury = formData.faktury.map(f =>\n                                        f.id === faktura.id\n                                          ? { ...f, fa_castka: value, _isNew: false }\n                                          : f\n                                      );\n                                      updateFaktury(updatedFaktury);\n                                    }}\n                                    placeholder=\"25000.50\"\n                                  />\n                                </FormGroup>\n                              </FormRow>\n\n                              <FormRow style={{gridTemplateColumns: '280px 1fr'}}>\n                                <FormGroup>\n                                  <Label required>Datum splatnosti</Label>\n                                  <DatePicker\n                                    fieldName={`fa_${index + 1}_splatnost`}\n                                    value={(() => {\n                                      //  Po editaci (_isNew: false) ignoruj fa_datum_splatnosti fallback\n                                      if (faktura._isNew === false) {\n                                        return faktura.fa_splatnost ?? '';\n                                      }\n                                      // Nov faktura - zkus fa_splatnost, pak fa_datum_splatnosti (z DB), pak przdn\n                                      return faktura.fa_splatnost ?? (faktura.fa_datum_splatnosti ? faktura.fa_datum_splatnosti.split(' ')[0] : '');\n                                    })()}\n                                    hasError={!!validationErrors[`faktura_${index + 1}_splatnost`]}\n                                    disabled={shouldLockFaktury}\n                                    onChange={(value) => {\n                                      const updatedFaktury = formData.faktury.map(f =>\n                                        f.id === faktura.id\n                                          ? { ...f, fa_splatnost: value, _isNew: false }\n                                          : f\n                                      );\n                                      updateFaktury(updatedFaktury);\n                                    }}\n                                    placeholder=\"Vyberte datum splatnosti\"\n                                  />\n                                </FormGroup>\n\n                                <FormGroup data-custom-select style={{gridColumn: '2 / -1'}}>\n                                  <LabelWithClear>\n                                    <LabelText>Stediska</LabelText>\n                                    <ClearSelectButton\n                                      type=\"button\"\n                                      $visible={(() => {\n                                        const strediska = faktura.fa_strediska_kod || [];\n                                        return Array.isArray(strediska) && strediska.length > 0;\n                                      })()}\n                                      onClick={() => {\n                                        const updatedFaktury = formData.faktury.map(f =>\n                                          f.id === faktura.id ? { ...f, fa_strediska_kod: [], _isNew: false } : f\n                                        );\n                                        updateFaktury(updatedFaktury);\n                                      }}\n                                      title=\"Vymazat vbr\"\n                                    >\n                                      <X size={12} />\n                                    </ClearSelectButton>\n                                  </LabelWithClear>\n                                  <StableCustomSelect\n                                    value={(() => {\n                                      const rawValue = faktura.fa_strediska_kod || formData.strediska_kod || [];\n                                      if (typeof rawValue === 'string' && rawValue.trim()) {\n                                        return rawValue.split(',').map(s => s.trim()).filter(Boolean);\n                                      }\n                                      return Array.isArray(rawValue) ? rawValue : [];\n                                    })()}\n                                    disabled={shouldLockFaktury}\n                                    onChange={(selectedValues) => {\n                                      const strediskaKody = Array.isArray(selectedValues)\n                                        ? selectedValues.map(item => {\n                                            if (typeof item === 'string') return item;\n                                            return item.value || item.kod_stavu || item.id || item;\n                                          })\n                                        : [];\n\n                                      const updatedFaktury = formData.faktury.map(f =>\n                                        f.id === faktura.id\n                                          ? { ...f, fa_strediska_kod: strediskaKody, _isNew: false }\n                                          : f\n                                      );\n                                      updateFaktury(updatedFaktury);\n                                    }}\n                                    options={strediskaOptions}\n                                    placeholder=\"Vyberte stediska (auto-vyplnno z objednvky)\"\n                                    field=\"strediska\"\n                                    required={false}\n                                    multiple={true}\n                                    icon={<Building />}\n                                    getOptionLabel={getOptionLabel}\n                                    getOptionValue={(option, field) => option.value || option.id || option}\n                                  />\n                                </FormGroup>\n                              </FormRow>\n\n                              <FormRow>\n                                <FormGroup style={{gridColumn: '1 / -1'}}>\n                                  <Label>Poznmka</Label>\n                                  <TextArea\n                                    value={faktura.fa_poznamka || ''}\n                                    disabled={shouldLockFaktury}\n                                    onChange={(e) => {\n                                      const updatedFaktury = formData.faktury.map(f =>\n                                        f.id === faktura.id\n                                          ? { ...f, fa_poznamka: e.target.value, _isNew: false }\n                                          : f\n                                      );\n                                      updateFaktury(updatedFaktury);\n                                    }}\n                                    placeholder=\"Voliteln poznmka...\"\n                                    rows={2}\n                                  />\n                                </FormGroup>\n                              </FormRow>\n\n                              {/*  NOV: Per-invoice VCN SPRVNOST (FZE 7/8) */}\n                              {currentPhase >= 7 && (\n                                <div style={{\n                                  marginTop: '1.5rem',\n                                  padding: '1rem',\n                                  background: isVecnaPotvrzena \n                                    ? 'linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)' \n                                    : 'linear-gradient(135deg, #fefefe 0%, #f3f4f6 100%)',\n                                  border: isVecnaPotvrzena ? '2px solid #22c55e' : '2px solid #d1d5db',\n                                  borderRadius: '8px'\n                                }}>\n                                  <div style={{ \n                                    fontWeight: '700', \n                                    fontSize: '0.95rem', \n                                    color: '#166534', \n                                    marginBottom: '1rem',\n                                    display: 'flex',\n                                    alignItems: 'center',\n                                    gap: '0.5rem'\n                                  }}>\n                                    <FontAwesomeIcon icon={faCheckCircle} />\n                                    Vcn sprvnost faktury #{index + 1}\n                                  </div>\n\n                                  {/*  LP ERPN EDITOR - pro faktury s LP financovnm */}\n                                  {(() => {\n                                    // Skip pokud nen LP financovn\n                                    const financovani = formData.financovani;\n                                    if (!financovani) {\n                                      return null;\n                                    }\n                                    \n                                    try {\n                                      const fin = typeof financovani === 'string' \n                                        ? JSON.parse(financovani) \n                                        : financovani;\n                                      \n                                      // Zobrazit LP editor pouze pokud:\n                                      // 1. typ_financovani obsahuje \"LP\" NEBO\n                                      // 2. m vybran LP kdy v lp_kod\n                                      const isLPFinancing = (\n                                        (fin?.typ_financovani && fin.typ_financovani.includes('LP')) ||\n                                        (Array.isArray(formData.lp_kod) && formData.lp_kod.length > 0)\n                                      );\n                                      \n                                      if (!isLPFinancing) {\n                                        return null;\n                                      }\n                                      \n                                      // Nast LP erpn pro fakturu s relnm ID\n                                      const fakturaId = faktura.id;\n                                      const isRealInvoice = fakturaId && !String(fakturaId).startsWith('temp-');\n                                      \n                                      // Naten LP dat - lazy loading pi prvnm zobrazen\n                                      if (isRealInvoice && !fakturyLPCerpani[fakturaId]?.loaded) {\n                                        // Nast asynchronn - nebude blokovat render\n                                        Promise.resolve().then(() => {\n                                          loadFakturaLPCerpani(fakturaId);\n                                        });\n                                      }\n                                      \n                                      // Zskat LP data z state\n                                      const lpData = fakturyLPCerpani[fakturaId] || { lpCerpani: [], loaded: false };\n                                      \n                                      return (\n                                        <div style={{ \n                                          marginBottom: '1.5rem',\n                                          padding: '1rem',\n                                          background: '#fff8e1',\n                                          border: '2px solid #ffb300',\n                                          borderRadius: '8px'\n                                        }}>\n                                          <div style={{\n                                            fontWeight: '600',\n                                            color: '#e65100',\n                                            marginBottom: '1rem',\n                                            fontSize: '0.9rem'\n                                          }}>\n                                             Rozdlen faktury mezi LP kdy\n                                          </div>\n                                          <LPCerpaniEditor\n                                            faktura={faktura}\n                                            orderData={formData}\n                                            lpCerpani={lpData.lpCerpani}\n                                            availableLPCodes={lpKodyOptions || []}\n                                            onChange={(newLpCerpani) => {\n                                              // Aktualizovat lokln state\n                                              setFakturyLPCerpani(prev => ({\n                                                ...prev,\n                                                [fakturaId]: {\n                                                  lpCerpani: newLpCerpani,\n                                                  loaded: true\n                                                }\n                                              }));\n                                              \n                                              // Pokud m faktura reln ID, uloit na backend\n                                              if (isRealInvoice) {\n                                                saveFakturaLPCerpaniData(fakturaId, newLpCerpani)\n                                                  .catch(err => {\n                                                    console.error(' Chyba pi ukldn LP erpn:', err);\n                                                    showToast && showToast('Nepodailo se uloit LP erpn: ' + err.message, 'warning');\n                                                  });\n                                              }\n                                            }}\n                                            disabled={!!faktura.vecna_spravnost_potvrzeno}\n                                          />\n                                        </div>\n                                      );\n                                    } catch (e) {\n                                      console.error(' [LP Editor] Chyba pi zpracovn LP editoru:', e);\n                                      return (\n                                        <div style={{\n                                          padding: '1rem',\n                                          background: '#fee2e2',\n                                          border: '1px solid #f87171',\n                                          borderRadius: '6px',\n                                          color: '#dc2626',\n                                          marginBottom: '1rem'\n                                        }}>\n                                           Chyba pi natn LP editoru: {e.message}\n                                        </div>\n                                      );\n                                    }\n                                  })()}\n\n                                  {/* Porovnn MAX CENA vs FAKTURA */}\n                                  {(() => {\n                                    const maxCena = parseFloat(formData.max_cena_s_dph) || 0;\n                                    const fakturaCastka = parseFloat(faktura.fa_castka) || 0;\n                                    const rozdil = fakturaCastka - maxCena;\n                                    const prekroceno = rozdil > 0;\n\n                                    return (\n                                      <div style={{\n                                        background: prekroceno ? '#fef2f2' : '#f0fdf4',\n                                        border: `1px solid ${prekroceno ? '#ef4444' : '#22c55e'}`,\n                                        borderRadius: '6px',\n                                        padding: '0.75rem',\n                                        marginBottom: '1rem',\n                                        fontSize: '0.85rem'\n                                      }}>\n                                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem' }}>\n                                          <span style={{ color: '#6b7280' }}>Max. cena objednvky s DPH:</span>\n                                          <span style={{ fontWeight: '600', color: '#374151' }}>\n                                            {maxCena.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K\n                                          </span>\n                                        </div>\n                                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem' }}>\n                                          <span style={{ color: '#6b7280' }}>stka faktury s DPH:</span>\n                                          <span style={{ fontWeight: '600', color: '#374151' }}>\n                                            {fakturaCastka.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K\n                                          </span>\n                                        </div>\n                                        <div style={{ \n                                          display: 'flex', \n                                          justifyContent: 'space-between', \n                                          paddingTop: '0.5rem', \n                                          borderTop: '1px solid #e5e7eb',\n                                          fontWeight: '700'\n                                        }}>\n                                          <span style={{ color: prekroceno ? '#dc2626' : '#16a34a' }}>\n                                            {prekroceno ? ' Pekroen:' : ' Rozdl:'}\n                                          </span>\n                                          <span style={{ color: prekroceno ? '#dc2626' : '#16a34a' }}>\n                                            {prekroceno ? '+' : ''}{rozdil.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K\n                                          </span>\n                                        </div>\n                                      </div>\n                                    );\n                                  })()}\n\n                                  <FormRow>\n                                    <FormGroup style={{gridColumn: '1 / -1'}}>\n                                      <Label>Umstn majetku</Label>\n                                      <Input\n                                        value={faktura.vecna_spravnost_umisteni_majetku || ''}\n                                        disabled={shouldLockVecnaSpravnost}\n                                        onChange={(e) => {\n                                          const updatedFaktury = formData.faktury.map(f =>\n                                            f.id === faktura.id\n                                              ? { ...f, vecna_spravnost_umisteni_majetku: e.target.value, _isNew: false }\n                                              : f\n                                          );\n                                          updateFaktury(updatedFaktury);\n                                        }}\n                                        placeholder=\"Nap. Kladno, budova K2, mstnost 203\"\n                                      />\n                                    </FormGroup>\n\n                                    <FormGroup style={{gridColumn: '1 / -1'}}>\n                                      {(() => {\n                                        const maxCena = parseFloat(formData.max_cena_s_dph) || 0;\n                                        const fakturaCastka = parseFloat(faktura.fa_castka) || 0;\n                                        const prekroceno = fakturaCastka > maxCena;\n                                        return <Label required={prekroceno} style={prekroceno ? {color: '#dc2626', fontWeight: '700'} : {}}>Poznmka k vcn sprvnosti{prekroceno ? ' (POVINN - faktura pekrauje MAX cenu)' : ''}</Label>;\n                                      })()}\n                                      <TextArea\n                                        value={faktura.vecna_spravnost_poznamka || ''}\n                                        disabled={shouldLockVecnaSpravnost}\n                                        hasError={!!validationErrors[`faktura_${index + 1}_poznamka_vs`]}\n                                        onChange={(e) => {\n                                          const updatedFaktury = formData.faktury.map(f =>\n                                            f.id === faktura.id\n                                              ? { ...f, vecna_spravnost_poznamka: e.target.value, _isNew: false }\n                                              : f\n                                          );\n                                          updateFaktury(updatedFaktury);\n                                        }}\n                                        placeholder=\"Voliteln poznmka k vcn sprvnosti...\"\n                                        rows={2}\n                                      />\n                                      {validationErrors[`faktura_${index + 1}_poznamka_vs`] && (\n                                        <ErrorText>{validationErrors[`faktura_${index + 1}_poznamka_vs`]}</ErrorText>\n                                      )}\n                                    </FormGroup>\n                                  </FormRow>\n\n                                  {/* Checkbox potvrzen vcn sprvnosti */}\n                                  {(() => {\n                                    const hasError = !!validationErrors[`faktura_${index + 1}_vecna_spravnost`];\n                                    return (\n                                      <>\n                                        <div style={{\n                                          marginTop: '1rem',\n                                          padding: '0.75rem',\n                                          background: hasError ? '#fef2f2' : '#ffffff',\n                                          border: hasError ? '2px solid #ef4444' : '1px solid #d1d5db',\n                                          borderRadius: '6px'\n                                        }}>\n                                          <label style={{\n                                            display: 'flex',\n                                            alignItems: 'center',\n                                            gap: '0.75rem',\n                                            cursor: shouldLockVecnaSpravnost ? 'not-allowed' : 'pointer',\n                                            fontSize: '0.9rem',\n                                            fontWeight: shouldLockVecnaSpravnost ? '400' : '600',\n                                            color: hasError ? '#dc2626' : (shouldLockVecnaSpravnost ? '#9ca3af' : '#374151')\n                                          }}>\n                                            <input\n                                              type=\"checkbox\"\n                                              checked={faktura.vecna_spravnost_potvrzeno === 1}\n                                              disabled={shouldLockVecnaSpravnost}\n                                        onChange={(e) => {\n                                          const newValue = e.target.checked ? 1 : 0;\n\n                                          //  LP VALIDACE: Pokud se potvrzuje vcn sprvnost (newValue === 1)\n                                          if (newValue === 1) {\n                                            // Zkontrolovat LP financovn\n                                            const financovani = formData.financovani;\n                                            if (financovani) {\n                                              try {\n                                                const fin = typeof financovani === 'string' \n                                                  ? JSON.parse(financovani) \n                                                  : financovani;\n                                                \n                                                if (fin?.typ === 'LP') {\n                                                  // Pro LP financovn validovat erpn\n                                                  const fakturaId = faktura.id;\n                                                  const lpData = fakturyLPCerpani[fakturaId];\n                                                  const lpCerpani = lpData?.lpCerpani || [];\n                                                  \n                                                  console.log(' [LP Validace] Kontroluji LP erpn pro fakturu:', fakturaId);\n                                                  console.log(' [LP Validace] LP erpn:', lpCerpani);\n                                                  \n                                                  // Validace: MUS bt piazen minimln 1 LP kd\n                                                  if (!lpCerpani || lpCerpani.length === 0 || lpCerpani.every(lp => !lp.lp_cislo || lp.castka <= 0)) {\n                                                    showToast && showToast('Pro LP financovn je povinn rozdlit fakturu mezi LP kdy', 'error');\n                                                    return; // Nepovol zakrtnut\n                                                  }\n                                                  \n                                                  // Validace: Souet nesm pekroit fa_castka\n                                                  const totalLP = lpCerpani.reduce((sum, lp) => sum + (parseFloat(lp.castka) || 0), 0);\n                                                  const fakturaCastka = parseFloat(faktura.fa_castka) || 0;\n                                                  \n                                                  if (totalLP > fakturaCastka) {\n                                                    showToast && showToast(`Souet LP erpn (${totalLP.toLocaleString('cs-CZ')} K) pekrauje stku faktury (${fakturaCastka.toLocaleString('cs-CZ')} K)`, 'error');\n                                                    return; // Nepovol zakrtnut\n                                                  }\n                                                  \n                                                  console.log(' [LP Validace] LP erpn je platn');\n                                                }\n                                              } catch (e) {\n                                                console.error(' Chyba pi validaci LP erpn:', e);\n                                                showToast && showToast('Chyba pi validaci LP erpn', 'error');\n                                                return;\n                                              }\n                                            }\n                                          }\n\n                                          let updatedFields = { vecna_spravnost_potvrzeno: newValue, _isNew: false };\n                                          if (newValue === 1 && user_id && !faktura.potvrdil_vecnou_spravnost_id) {\n                                            const now = new Date();\n                                            const year = now.getFullYear();\n                                            const month = String(now.getMonth() + 1).padStart(2, '0');\n                                            const day = String(now.getDate()).padStart(2, '0');\n                                            const hours = String(now.getHours()).padStart(2, '0');\n                                            const minutes = String(now.getMinutes()).padStart(2, '0');\n                                            const seconds = String(now.getSeconds()).padStart(2, '0');\n                                            const localTimestamp = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n                                            \n                                            updatedFields.potvrdil_vecnou_spravnost_id = user_id;\n                                            updatedFields.dt_potvrzeni_vecne_spravnosti = localTimestamp;\n                                            addDebugLog('info', 'VECNA-FAKTURA', 'metadata-set', `Faktura #${faktura.id}: Nastaveno ID=${user_id}, dt=${localTimestamp}`);\n                                          }\n\n                                          const updatedFaktury = formData.faktury.map(f =>\n                                            f.id === faktura.id\n                                              ? { ...f, ...updatedFields }\n                                              : f\n                                          );\n                                          updateFaktury(updatedFaktury);\n                                        }}\n                                        style={{\n                                          width: '18px',\n                                          height: '18px',\n                                          cursor: shouldLockVecnaSpravnost ? 'not-allowed' : 'pointer',\n                                          accentColor: shouldLockVecnaSpravnost ? '#9ca3af' : '#16a34a'\n                                        }}\n                                      />\n                                      <span style={{ flex: 1 }}>\n                                        Potvrzuji vcnou sprvnost faktury #{index + 1}\n                                      </span>\n                                      {(faktura.vecna_spravnost_potvrzeno === 1) && (\n                                        <span style={{\n                                          fontSize: '0.75rem',\n                                          color: '#16a34a',\n                                          background: '#dcfce7',\n                                          padding: '0.25rem 0.5rem',\n                                          borderRadius: '4px',\n                                          fontWeight: '600'\n                                        }}>\n                                           ZKONTROLOVNO\n                                        </span>\n                                      )}\n                                    </label>\n                                    \n                                    {/* Info dek - kdo a kdy potvrdil (POUZE ve fzi ZKONTROLOVANA 8+) */}\n                                    {(() => {\n                                      const isChecked = (isEditing ? (currentData.vecna_spravnost_potvrzeno === 1) : (faktura.vecna_spravnost_potvrzeno === 1));\n                                      const hasRealId = faktura.id && !String(faktura.id).startsWith('temp-');\n                                      const hasTimestamp = faktura.dt_potvrzeni_vecne_spravnosti;\n                                      const isZkontrolovanaPhase = currentPhase >= 8; // Fze ZKONTROLOVANA a ve\n                                      \n                                      if (!isChecked || !hasRealId || !hasTimestamp || !isZkontrolovanaPhase) return null;\n                                      \n                                      // Urit jmno potvrzujcho\n                                      const userName = faktura.potvrdil_vecnou_spravnost_jmeno \n                                        ? `${faktura.potvrdil_vecnou_spravnost_jmeno} ${faktura.potvrdil_vecnou_spravnost_prijmeni || ''}`.trim()\n                                        : (faktura.potvrdil_vecnou_spravnost_id ? getUserNameById(faktura.potvrdil_vecnou_spravnost_id) : null);\n                                      \n                                      return (\n                                        <div style={{\n                                          marginTop: '0.5rem',\n                                          padding: '0.5rem 0.75rem',\n                                          background: '#f0fdf4',\n                                          border: '1px solid #86efac',\n                                          borderRadius: '4px',\n                                          fontSize: '0.8rem',\n                                          color: '#15803d'\n                                        }}>\n                                          <strong>Potvrdil:</strong> {userName || 'Systm'}\n                                          {' '}<strong></strong>{' '}\n                                          <strong>Datum:</strong> {prettyDate(faktura.dt_potvrzeni_vecne_spravnosti)}\n                                        </div>\n                                      );\n                                    })()}\n                                  </div>\n                                  {hasError && (\n                                    <ErrorText style={{ marginTop: '0.5rem' }}>\n                                      {validationErrors[`faktura_${index + 1}_vecna_spravnost`]}\n                                    </ErrorText>\n                                  )}\n                                </>\n                                    );\n                                  })()}\n                                </div>\n                              )}\n\n                              {/*  PLOHY FAKTURY - Kompaktn komponenta s API validac */}\n                              <InvoiceAttachmentsCompact\n                                key={`invoice-attachments-${index}-${formData.id}`}\n                                fakturaId={faktura.id}\n                                objednavkaId={formData.id}\n                                fakturaTypyPrilohOptions={fakturaTypyPrilohOptions}\n                                readOnly={shouldLockFaktury}\n                                onISDOCParsed={handleISDOCParsed}\n                                formData={formData}\n                                faktura={faktura}\n                                validateInvoiceForAttachments={validateInvoiceForAttachments}\n                                allUsers={allUsers}\n                                attachments={faktura.attachments || []}\n                                onAttachmentsChange={(newAttachments) => {\n                                  handleInvoiceAttachmentsChange(faktura.id, newAttachments);\n                                }}\n                                onAttachmentUploaded={(uploadedAttachment) => {\n                                  //  Po uploadu plohy\n                                  handleInvoiceAttachmentUploaded(faktura.id, uploadedAttachment);\n                                }}\n                                onCreateInvoiceInDB={handleCreateInvoiceInDB}\n                              />\n\n                              {/* Faktury se ukldaj automaticky s objednvkou - tlatko \"Uloit fakturu\" odstranno */}\n\n                              {/* Info footer */}\n                              {!faktura._isNew && (\n                                <div style={{\n                                  borderTop: '1px solid #e5e7eb',\n                                  paddingTop: '0.5rem',\n                                  marginTop: '0.75rem',\n                                  fontSize: '0.75rem',\n                                  color: '#9ca3af',\n                                  display: 'flex',\n                                  justifyContent: 'space-between'\n                                }}>\n                                  <div>\n                                    <strong>Vytvoil:</strong> {faktura.vytvoril_jmeno || getUserNameById(faktura.vytvoril_uzivatel_id)}\n                                  </div>\n                                  <div>\n                                    <strong>Vytvoeno:</strong> {prettyDate(faktura.dt_vytvoreni)}\n                                  </div>\n                                </div>\n                              )}\n\n                              </div>\n                              {/* Konec content wrapper */}\n\n                            </div>\n                          )}))}\n\n                          {/*  TLATKO PIDAT DAL FAKTURU - pod seznamem faktur */}\n                          {!shouldLockFaktury && (\n                            <button\n                              type=\"button\"\n                              onClick={() => {\n                                const dnesniDatum = formatDateForPicker(new Date());\n                                const newFaktura = {\n                                  id: `temp-${Date.now()}`,\n                                  objednavka_id: formData.id,\n                                  fa_datum_doruceni: dnesniDatum,\n                                  fa_dorucena: 1,\n                                  fa_castka: '',\n                                  fa_cislo_vema: '',\n                                  fa_strediska_kod: Array.isArray(formData.strediska_kod) ? formData.strediska_kod : [],\n                                  fa_poznamka: '',\n                                  fa_splatnost: '',\n                                  vytvoril_uzivatel_id: user_id,\n                                  vytvoril_jmeno: getUserNameById(user_id),\n                                  dt_vytvoreni: new Date().toISOString(),\n                                  dt_aktualizace: null,\n                                  aktivni: 1,\n                                  _isNew: true,\n                                  vecna_spravnost_umisteni_majetku: '',\n                                  vecna_spravnost_poznamka: '',\n                                  vecna_spravnost_potvrzeno: 0\n                                };\n                                const currentFaktury = Array.isArray(formData.faktury) ? formData.faktury : [];\n                                updateFaktury([...currentFaktury, newFaktura]);\n                                setEditingFaktura(newFaktura);\n                                setFakturaFormData({\n                                  fa_datum_doruceni: dnesniDatum,\n                                  fa_dorucena: 1,\n                                  fa_castka: '',\n                                  fa_cislo_vema: '',\n                                  fa_strediska_kod: formData.strediska_kod || [],\n                                  fa_poznamka: '',\n                                  fa_splatnost: '',\n                                  vecna_spravnost_umisteni_majetku: '',\n                                  vecna_spravnost_poznamka: '',\n                                  vecna_spravnost_potvrzeno: 0\n                                });\n                              }}\n                              style={{\n                                width: '100%',\n                                marginTop: '1rem',\n                                padding: '1rem',\n                                background: 'transparent',\n                                color: '#3b82f6',\n                                border: '2px dashed #3b82f6',\n                                borderRadius: '8px',\n                                fontSize: '0.9rem',\n                                fontWeight: '600',\n                                cursor: 'pointer',\n                                display: 'flex',\n                                alignItems: 'center',\n                                justifyContent: 'center',\n                                gap: '0.5rem',\n                                transition: 'all 0.2s ease'\n                              }}\n                              onMouseEnter={(e) => {\n                                e.currentTarget.style.background = 'rgba(59, 130, 246, 0.05)';\n                                e.currentTarget.style.borderColor = '#2563eb';\n                              }}\n                              onMouseLeave={(e) => {\n                                e.currentTarget.style.background = 'transparent';\n                                e.currentTarget.style.borderColor = '#3b82f6';\n                              }}\n                            >\n                              <Plus size={18} />\n                              Pidat dal fakturu\n                            </button>\n                          )}\n                        </div>\n                      )}\n\n                      {/* INFORMAN BOX - Fakturace zpracovna - ZOBRAZIT kdy je pidna faktura */}\n                      {formData.faktury && formData.faktury.length > 0 && formData.fakturant_id && formData.dt_faktura_pridana && (\n                        <div style={{\n                          marginTop: '1.5rem',\n                          padding: '1rem',\n                          backgroundColor: '#dcfce7',\n                          border: '1px solid #16a34a',\n                          borderRadius: '6px',\n                          color: '#166534',\n                          fontSize: '0.875rem'\n                        }}>\n                          <div style={{ fontWeight: '600', marginBottom: '0.25rem' }}>\n                             Fakturace byla zpracovna\n                          </div>\n                          <div>\n                            <strong>Datum zpracovn:</strong> {prettyDate(formData.dt_faktura_pridana)}  <strong>Zpracoval:</strong> {getUserNameById(formData.fakturant_id)}\n                          </div>\n                        </div>\n                      )}\n                      </>\n                      )}\n                    </div>\n                  </SectionContent>\n                </FormSection>\n              ) : null;\n              })()}\n\n              {/*  INFO BOX PRO UIVATELE BEZ PRV INVOICE_MANAGE - ek se na doplnn faktur */}\n              {(() => {\n                const isPokladna = (() => {\n                  const selectedFinancovani = financovaniOptions.find(opt =>\n                    opt.kod === formData.zpusob_financovani ||\n                    opt.value === formData.zpusob_financovani\n                  );\n                  const nazev = selectedFinancovani?.nazev || '';\n                  return nazev.toLowerCase().includes('pokladna');\n                })();\n                const hasFaktury = formData.faktury && formData.faktury.length > 0;\n                const showInfoBlock = !isPokladna && currentPhase === 6 && !canManageInvoices && !hasFaktury;\n                return showInfoBlock && (\n                  <div style={{\n                    margin: '2rem 0',\n                    padding: '1rem 1.25rem',\n                    backgroundColor: '#fef3c7',\n                    border: '1px solid #f59e0b',\n                    borderRadius: '8px',\n                    color: '#92400e'\n                  }}>\n                    <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                       ek se na doplnn fakturace\n                    </div>\n                    <div style={{ fontSize: '0.875rem' }}>\n                      Objednvka ek na pidn faktur ekonomickm oddlenm. Po doplnn faktur budete moci pokraovat k <strong>vcn kontrole</strong>. Tuto akci me provst pouze uivatel s oprvnnm pro sprvu faktur.\n                    </div>\n                  </div>\n                );\n              })()}\n\n              {/* INFORMAN BLOK - AKTIVN FAKTURACE: Info o dalm kroku */}\n              {(isArchived || currentPhase === 6) && formData.faktury && formData.faktury.length > 0 && (\n                <div style={{\n                  margin: '2rem 0',\n                  padding: '1rem 1.25rem',\n                  backgroundColor: '#fefce8',\n                  border: '1px solid #eab308',\n                  borderRadius: '8px',\n                  color: '#854d0e'\n                }}>\n                  <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                     Pidn faktur k objednvce\n                  </div>\n                  <div style={{ fontSize: '0.875rem' }}>\n                    {formData.fakturant_id && formData.dt_faktura_pridana && (\n                      <div style={{ marginBottom: '0.5rem' }}>\n                        <strong>Pidal fakturu:</strong> {getUserNameById(formData.fakturant_id)}\n                        {'  '}\n                        <strong>Datum:</strong> {prettyDate(formData.dt_faktura_pridana)}\n                      </div>\n                    )}\n                    V tto sekci pidejte faktury k objednvce. Po pidn a uloen mete pokraovat k <strong>vcn kontrole</strong>.\n                  </div>\n                </div>\n              )}\n\n              {/*  SEKCE: DOKONEN OBJEDNVKY - FZE 10 */}\n              {/* ZOBRAZIT pouze pokud: */}\n              {/* 1. Uivatel je ADMIN nebo m prvo ORDER_MANAGE NEBO objednvka je ji DOKONCENA */}\n              {/* 2. Workflow obsahuje ZKONTROLOVANA nebo DOKONCENA (vcn sprvnost potvrzena) */}\n              {(canUnlockAnything || hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA')) && \n               (hasWorkflowState(formData.stav_workflow_kod, 'ZKONTROLOVANA') || hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA')) &&\n               (() => {\n                //  Logika zamen sekce dokonen - STEJN JAKO U VCN SPRVNOSTI\n                // ZAMENO pouze pokud:\n                // 1. Workflow obsahuje DOKONCENA (ne jen ZKONTROLOVANA!)\n                // 2. Checkbox JE ZAKRTNUT (potvrzeni_dokonceni_objednavky = 1)\n                // 3. JE ULOENO v DB (m formData.id)\n                // DLEIT: dokoncil_id a dt_dokonceni se nastavuj HNED pi zakrtnut,\n                // take nememe podle nich zjistit, jestli je uloeno v DB!\n                const isDokonceniSaved = !!(\n                  formData.id &&\n                  formData.potvrzeni_dokonceni_objednavky === 1 &&\n                  hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA')\n                );\n                //  Pout dokonceniState z workflowManager (u zahrnuje unlock logic)\n                const isDokonceniLockedLocal = !dokonceniState.enabled;\n\n                // Kho me odemknout? Pouze admin + ORDER_MANAGE\n                const canUnlockDokonceni = canUnlockAnything; // Pouze admin/ORDER_MANAGE\n\n                return (\n                <FormSection data-section=\"dokonceni\">\n                  <SectionHeader\n                    sectionTheme=\"section-dokonceni\"\n                    isActive={true}\n                    style={{\n                      background: 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)',\n                      borderColor: '#16a34a'\n                    }}\n                  >\n                    <SectionTitle sectionTheme=\"section-dokonceni\" style={{ color: '#fff', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                      <SectionIcon sectionTheme=\"section-dokonceni\" style={{ color: '#fff' }}>\n                        <FontAwesomeIcon icon={faCheckCircle} />\n                      </SectionIcon>\n                      Dokonen objednvky\n                    </SectionTitle>\n                    <SectionControls style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>\n                      <CollapseIcon\n                        collapsed={sectionStates.dokonceni}\n                        onClick={() => toggleSection('dokonceni')}\n                        style={{ color: '#fff', cursor: 'pointer' }}\n                      >\n                        <FontAwesomeIcon icon={faChevronUp} />\n                      </CollapseIcon>\n                    </SectionControls>\n                  </SectionHeader>\n\n                  <SectionContent collapsed={sectionStates.dokonceni}>\n                    <div style={{ padding: '1rem 0' }}>\n                      {/* Informace o dokonen */}\n                      <div style={{\n                        background: '#f0fdf4',\n                        border: '1px solid #22c55e',\n                        borderRadius: '8px',\n                        padding: '1rem',\n                        marginBottom: '1.5rem'\n                      }}>\n                        <div style={{ fontWeight: '600', color: '#166534', marginBottom: '0.75rem' }}>\n                           Finln krok - Dokonen objednvky\n                        </div>\n                        <div style={{ fontSize: '0.875rem', color: '#166534', lineHeight: '1.6' }}>\n                          Objednvka prola vemi fzemi:\n                          <ul style={{ marginTop: '0.5rem', marginLeft: '1.5rem', listStyle: 'none', paddingLeft: 0 }}>\n                            <li style={{ display: 'flex', alignItems: 'center', marginBottom: '0.4rem' }}>\n                               Schvlen ({formData.dt_schvaleni ? prettyDate(formData.dt_schvaleni) : ''}  {formData.schvalovatel_id ? getUserNameById(formData.schvalovatel_id) : ''})\n                            </li>\n                            <li style={{ display: 'flex', alignItems: 'center', marginBottom: '0.4rem' }}>\n                               Odesln dodavateli ({formData.dt_odeslani ? prettyDate(formData.dt_odeslani) : ''}  {formData.odesilatel_id ? getUserNameById(formData.odesilatel_id) : ''})\n                            </li>\n                            <li style={{ display: 'flex', alignItems: 'center', marginBottom: '0.4rem' }}>\n                               Potvrzen od dodavatele ({formData.dt_akceptace ? formatDateOnly(formData.dt_akceptace) : ''}  {formData.dodavatel_potvrdil_id ? getUserNameById(formData.dodavatel_potvrdil_id) : ''})\n                            </li>\n                            <li style={{ display: 'flex', alignItems: 'center', marginBottom: '0.4rem' }}>\n                               Registr smluv {formData.dt_zverejneni && formData.dt_zverejneni !== '0000-00-00' ? \n                                `(${formatDateOnly(formData.dt_zverejneni)}  ${formData.zverejnil_id ? getUserNameById(formData.zverejnil_id) : ''})` : \n                                '(nepodlh zveejnn v registru)'}\n                            </li>\n                            <li style={{ display: 'flex', alignItems: 'center', marginBottom: '0.4rem' }}>\n                               Fakturace ({formData.dt_faktura_pridana ? prettyDate(formData.dt_faktura_pridana) : ''}  {formData.fakturant_id ? getUserNameById(formData.fakturant_id) : ''})\n                            </li>\n                            {/*  PER-INVOICE: Vcn sprvnost jednotlivch faktur */}\n                            {formData.faktury && formData.faktury.length > 0 && formData.faktury.map((faktura, index) => {\n                              const isPotvrzeno = faktura.vecna_spravnost_potvrzeno === 1;\n                              const userName = faktura.potvrdil_vecnou_spravnost_jmeno \n                                ? `${faktura.potvrdil_vecnou_spravnost_jmeno} ${faktura.potvrdil_vecnou_spravnost_prijmeni || ''}`.trim()\n                                : (faktura.potvrdil_vecnou_spravnost_id ? getUserNameById(faktura.potvrdil_vecnou_spravnost_id) : '');\n                              const datum = faktura.dt_potvrzeni_vecne_spravnosti ? prettyDate(faktura.dt_potvrzeni_vecne_spravnosti) : '';\n                              \n                              return (\n                                <li key={faktura.id || index} style={{ display: 'flex', alignItems: 'center', marginBottom: '0.4rem' }}>\n                                  {isPotvrzeno ? '' : ''} Vcn sprvnost faktury #{index + 1} {datum ? `(${datum}  ${userName})` : ''}\n                                </li>\n                              );\n                            })}\n                          </ul>\n                          <div style={{ marginTop: '0.75rem', fontWeight: '500' }}>\n                            Nyn potvrte finln dokonen objednvky.\n                          </div>\n                        </div>\n                      </div>\n\n                      {/*  KONTROLA PEKROEN CENY - zobrazit JEN pokud je fakturace vy ne MAX cena */}\n                      {(() => {\n                        const maxCena = parseFloat(formData.max_cena_s_dph) || 0;\n                        const fakturyCelkem = formData.faktury ? formData.faktury.reduce((sum, faktura) => {\n                          const amount = parseFloat(faktura.fa_castka) || 0;\n                          return sum + amount;\n                        }, 0) : 0;\n\n                        const rozdil = fakturyCelkem - maxCena;\n                        const prekroceno = rozdil > 0;\n\n                        // Zobrazit POUZE pokud je pekroena MAX cena\n                        if (!prekroceno || maxCena === 0 || fakturyCelkem === 0) return null;\n\n                        return (\n                          <div style={{\n                            background: 'linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%)',\n                            border: '2px solid #ef4444',\n                            borderRadius: '12px',\n                            padding: '1rem',\n                            marginBottom: '1.5rem',\n                            boxShadow: '0 4px 12px rgba(239, 68, 68, 0.15)',\n                            display: 'flex',\n                            alignItems: 'flex-start',\n                            gap: '0.75rem'\n                          }}>\n                            <div style={{ fontSize: '1.5rem', marginTop: '0.1rem' }}></div>\n                            <div style={{ flex: 1 }}>\n                              <div style={{ fontWeight: '700', fontSize: '1rem', color: '#b91c1c', marginBottom: '0.5rem' }}>\n                                POZOR: Fakturace pekroila MAX cenu s DPH objednvky schvlenou PO\n                              </div>\n                              <div style={{\n                                display: 'grid',\n                                gridTemplateColumns: 'auto auto',\n                                gap: '0.5rem 1rem',\n                                fontSize: '0.875rem',\n                                color: '#7f1d1d',\n                                marginBottom: '0.75rem'\n                              }}>\n                                <span style={{ fontWeight: '600' }}>MAX cena s DPH (schvlen):</span>\n                                <span style={{ fontFamily: 'monospace', fontWeight: '700', textAlign: 'right' }}>{maxCena.toLocaleString('cs-CZ')} K</span>\n                                \n                                <span style={{ fontWeight: '600' }}>Fakturovan stka s DPH celkem:</span>\n                                <span style={{ fontFamily: 'monospace', fontWeight: '700', textAlign: 'right' }}>{fakturyCelkem.toLocaleString('cs-CZ')} K</span>\n                                \n                                <span style={{ fontWeight: '600' }}>Pekroen o:</span>\n                                <span style={{ fontFamily: 'monospace', fontWeight: '700', color: '#dc2626', textAlign: 'right' }}>\n                                  +{rozdil.toLocaleString('cs-CZ')} K\n                                </span>\n                              </div>\n                              {formData.vecna_spravnost_poznamka && (\n                                <div style={{\n                                  borderTop: '1px solid #fca5a5',\n                                  paddingTop: '0.75rem',\n                                  fontSize: '0.875rem',\n                                  color: '#7f1d1d'\n                                }}>\n                                  <div style={{ lineHeight: '1.5' }}>\n                                    <span style={{ fontWeight: '600' }}>Vysvtlen:</span>\n                                    {' '}\n                                    <span style={{ fontStyle: 'italic' }}>\n                                      \"{formData.vecna_spravnost_poznamka}\"\n                                    </span>\n                                  </div>\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        );\n                      })()}\n\n                      {/* POZNMKA K DOKONEN */}\n                      <FormRow>\n                        <FormGroup style={{ gridColumn: '1 / -1' }}>\n                          <Label>POZNMKA K DOKONEN (nepovinn)</Label>\n                          <TextArea\n                            value={formData.dokonceni_poznamka || ''}\n                            onChange={(e) => handleInputChange('dokonceni_poznamka', e.target.value)}\n                            placeholder=\"Voliteln poznmka k dokonen objednvky...\"\n                            rows={3}\n                            disabled={isDokonceniLockedLocal}\n                            style={{\n                              background: isDokonceniLockedLocal ? '#f3f4f6' : undefined,\n                              cursor: isDokonceniLockedLocal ? 'not-allowed' : undefined,\n                              opacity: isDokonceniLockedLocal ? 0.6 : 1\n                            }}\n                          />\n                        </FormGroup>\n                      </FormRow>\n\n                      {/* ANO/NE CHECKBOX - FINLN POTVRZEN */}\n                      <FormRow style={{ marginTop: '1.5rem' }}>\n                        <FormGroup style={{ gridColumn: '1 / -1' }}>\n                          <div style={{\n                            background: isDokonceniLockedLocal ? '#dcfce7' : '#fef3c7',\n                            border: `2px solid ${isDokonceniLockedLocal ? '#16a34a' : '#eab308'}`,\n                            borderRadius: '8px',\n                            padding: '1.25rem',\n                            opacity: isDokonceniLockedLocal ? 0.7 : 1\n                          }}>\n                            <label style={{\n                              display: 'flex',\n                              alignItems: 'center',\n                              gap: '1rem',\n                              cursor: isDokonceniLockedLocal ? 'not-allowed' : 'pointer',\n                              fontSize: '1rem',\n                              fontWeight: '600',\n                              color: formData.dokoncil_id ? '#166534' : '#713f12',\n                              opacity: formData.dokoncil_id ? 0.7 : 1\n                            }}>\n                              <input\n                                type=\"checkbox\"\n                                checked={\n                                  formData.potvrzeni_dokonceni_objednavky === 1 ||\n                                  formData.potvrzeni_dokonceni_objednavky === true ||\n                                  hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA')\n                                }\n                                onChange={(e) => {\n                                  handleInputChange('potvrzeni_dokonceni_objednavky', e.target.checked ? 1 : 0);\n                                }}\n                                required\n                                disabled={hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA')}\n                                style={{\n                                  width: '24px',\n                                  height: '24px',\n                                  cursor: isDokonceniLockedLocal ? 'not-allowed' : 'pointer',\n                                  accentColor: '#16a34a'\n                                }}\n                              />\n                              <span>\n                                 Potvrzuji finln dokonen objednvky\n                                <span style={{ color: '#dc2626', marginLeft: '0.25rem' }}>*</span>\n                              </span>\n                            </label>\n                            <div style={{\n                              fontSize: '0.875rem',\n                              color: isDokonceniLockedLocal ? '#166534' : '#92400e',\n                              marginTop: '0.75rem',\n                              marginLeft: '2.5rem'\n                            }}>\n                              {isDokonceniLockedLocal ? (\n                                <div>\n                                  <div style={{\n                                    fontWeight: '600',\n                                    display: 'flex',\n                                    alignItems: 'center',\n                                    gap: '0.5rem',\n                                    marginBottom: '0.5rem'\n                                  }}>\n                                    <span style={{ fontSize: '1.1rem' }}></span>\n                                    <strong>Objednvka je dokonena a uzamena</strong>\n                                  </div>\n                                  <div style={{ fontSize: '0.8rem', color: '#166534', lineHeight: '1.5' }}>\n                                    Workflow je kompletn uzameno. Zmny me provdt pouze oprvnn uivatel.\n                                  </div>\n                                </div>\n                              ) : (\n                                'Zakrtnutm potvrdte dokonen objednvky. Cel workflow bude uzamen.'\n                              )}\n                            </div>\n                          </div>\n                        </FormGroup>\n                      </FormRow>\n                    </div>\n                  </SectionContent>\n                </FormSection>\n                );\n              })()}\n\n              {/*  INFO BOX PRO BN UIVATELE - ek se na vcnou kontrolu */}\n              {(() => {\n                // Zobrazit info box pro uivatele BEZ prv ke kontrole vcn sprvnosti\n                //  DISABLED: Info block o vcn sprvnosti - ji nen poteba\n                const showInfoBlock = false; // Pvodn: currentPhase === 7 && !canUnlockAnything && !formData.potvrdil_vecnou_spravnost_id && !vecnaSpravnostState.visible\n                return showInfoBlock && (\n                  <div style={{\n                    margin: '2rem 0',\n                    padding: '1rem 1.25rem',\n                    backgroundColor: '#fef3c7',\n                    border: '1px solid #f59e0b',\n                    borderRadius: '8px',\n                    color: '#92400e'\n                  }}>\n                    <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                       ek se na vcnou kontrolu\n                    </div>\n                    <div style={{ fontSize: '0.875rem' }}>\n                      Objednvka ek na proveden vcn kontroly oprvnnm uivatelem. Po kontrole a potvrzen vcn sprvnosti bude mon pokraovat k <strong>dokonen objednvky</strong>.\n                    </div>\n                  </div>\n                );\n              })()}\n\n              {/* INFORMAN BLOK - FZE 7: VCN SPRVNOST - zobraz se pouze kdy workflow obsahuje ZKONTROLOVANA a jet nen potvrzena */}\n              {hasWorkflowState(formData.stav_workflow_kod, 'ZKONTROLOVANA') && !formData.potvrdil_vecnou_spravnost_id && (\n                <div style={{\n                  margin: '2rem 0',\n                  padding: '1rem 1.25rem',\n                  backgroundColor: '#f0fdfa',\n                  border: '1px solid #14b8a6',\n                  borderRadius: '8px',\n                  color: '#0f766e'\n                }}>\n                  <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                     FZE 7/8: Vcn sprvnost - Zkontrolujte a potvrte sprvnost objednvky\n                  </div>\n                  <div style={{ fontSize: '0.875rem' }}>\n                    Zkontrolujte vcnou sprvnost objednvky vetn vech faktur a daj. Po kontrole potvrte vcnou sprvnost v pslun sekci ne.\n                    {formData.faktury && formData.faktury.length > 0 && (\n                      <div style={{ marginTop: '0.5rem' }}>\n                        <strong>Faktury ke kontrole:</strong> {formData.faktury.length}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {/* INFORMAN BLOK - FZE 8: EK NA DOKONEN - pro bn uivatele (bez ORDER_MANAGE) */}\n              {!canUnlockAnything && \n               (hasWorkflowState(formData.stav_workflow_kod, 'ZKONTROLOVANA') || hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA')) &&\n               formData.potvrdil_vecnou_spravnost_id && \n               !hasWorkflowState(formData.stav_workflow_kod, 'DOKONCENA') && (\n                <div style={{\n                  margin: '2rem 0',\n                  padding: '1.5rem',\n                  backgroundColor: '#eff6ff',\n                  border: '2px solid #3b82f6',\n                  borderRadius: '8px',\n                  textAlign: 'center'\n                }}>\n                  <div style={{ fontSize: '3rem', marginBottom: '1rem' }}></div>\n                  <div style={{ fontWeight: '700', color: '#1e40af', marginBottom: '0.75rem', fontSize: '1.1rem' }}>\n                    Objednvka ek na dokonen\n                  </div>\n                  <div style={{ fontSize: '0.875rem', color: '#1e40af', lineHeight: '1.6' }}>\n                    Objednvka prola vemi fzemi workflow a ek na finln potvrzen dokonen.\n                  </div>\n                  <div style={{ fontSize: '0.875rem', color: '#1e40af', marginTop: '0.75rem', fontStyle: 'italic' }}>\n                     Dokonen objednvky provede oprvnn uivatel.\n                  </div>\n                </div>\n              )}\n\n              {/* INFORMAN BLOK - FZE 4/8: ekn na potvrzen dodavatelem */}\n              {(isArchived || currentPhase >= 4) && !formData.stav_stornovano && formData.dodavatel_zpusob_potvrzeni?.potvrzeni !== 'ANO' && (\n                <div style={{\n                  margin: '2rem 0',\n                  padding: '1rem 1.25rem',\n                  backgroundColor: '#f0fdf4',\n                  border: '1px solid #10b981',\n                  borderRadius: '8px',\n                  color: '#065f46'\n                }}>\n                  <div style={{ fontWeight: '600', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                     ekn na potvrzen od dodavatele\n                  </div>\n                  <div style={{ fontSize: '0.875rem' }}>\n                    Objednvka byla odeslna dodavateli. Po obdren potvrzen od dodavatele zakrtnte \"Dodavatel objednvku potvrdil\" a vyplte zpsob potvrzen.\n                    {formData.datum_odeslani && (\n                      <div style={{ marginTop: '0.5rem' }}>\n                        <strong>Datum odesln:</strong> {(() => {\n                          // Formtovn jen data bez asu (datum_odeslani je z datepickeru)\n                          const dateStr = formData.datum_odeslani.split(' ')[0]; // Odstranit ppadn as\n                          const [year, month, day] = dateStr.split('-');\n                          return `${day}. ${month}. ${year}`;\n                        })()}\n                        {formData.odesilatel_id && (\n                          <>\n                            {'  '}\n                            <strong>Odeslal:</strong> {getUserNameById(formData.odesilatel_id)}\n                          </>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {/* SCHOVAN SEKCE - Prbh objednvky a Dodac informace natvrdo zakzan */}\n              {/*\n              <FormSection>\n                <SectionHeader\n                  sectionTheme={getSectionTheme('prubeh_objednavky')}\n                  isActive={isSectionActive('prubeh_objednavky')}\n                >\n                  <SectionTitle sectionTheme={getSectionTheme('prubeh_objednavky')}>\n                    <SectionIcon sectionTheme={getSectionTheme('prubeh_objednavky')}>\n                      <FontAwesomeIcon icon={faClipboardCheck} />\n                    </SectionIcon>\n                    Prbh objednvky\n                  </SectionTitle>\n                  <CollapseIcon\n                    collapsed={sectionStates.prubeh_objednavky}\n                    sectionTheme={getSectionTheme('prubeh_objednavky')}\n                    onClick={() => toggleSection('prubeh_objednavky')}\n                    style={{ cursor: 'pointer' }}\n                  >\n                    <FontAwesomeIcon icon={faChevronUp} />\n                  </CollapseIcon>\n                </SectionHeader>\n                <SectionContent collapsed={sectionStates.prubeh_objednavky}>\n                  <FormRow>\n                    <FormGroup>\n                      <Label>STAV U DODAVATELE</Label>\n                      <InputWithIcon hasIcon>\n                        <Package />\n                        <select\n                          name=\"stav_u_dodavatele\"\n                          value={formData.stav_u_dodavatele || ''}\n                          onChange={(e) => handleInputChange('stav_u_dodavatele', e.target.value)}\n                          style={{\n                            width: '100%',\n                            padding: '0.75rem 3rem 0.75rem 3rem',\n                            border: '1px solid #d1d5db',\n                            borderRadius: '8px',\n                            fontSize: '0.875rem',\n                            backgroundColor: 'white'\n                          }}\n                        >\n                          <option value=\"\">Vyberte stav...</option>\n                          <option value=\"potvrzeno\">Potvrzeno dodavatelem</option>\n                          <option value=\"ve_vyrobe\">Ve vrob/pprav</option>\n                          <option value=\"pripraveno\">Pipraveno k odesln</option>\n                          <option value=\"odeslano\">Odeslno dodavatelem</option>\n                          <option value=\"doruceno\">Dorueno</option>\n                          <option value=\"stornovno\">Stornovno</option>\n                        </select>\n                      </InputWithIcon>\n                    </FormGroup>\n                    <FormGroup>\n                      <Label>DATUM ZMNY STAVU</Label>\n                      <DatePicker\n                        fieldName=\"datum_zmeny_stavu\"\n                        value={formData.datum_zmeny_stavu || ''}\n                        onChange={(value) => handleInputChange('datum_zmeny_stavu', value)}\n                        onBlur={(value) => handleFieldBlur('datum_zmeny_stavu', value)}\n                        placeholder=\"Vyberte datum zmny stavu\"\n                      />\n                    </FormGroup>\n                  </FormRow>\n                  <FormRow>\n                    <FormGroup style={{gridColumn: '1 / -1'}}>\n                      <Label>POZNMKA KE STAVU</Label>\n                      <TextArea\n                        name=\"poznamka_stav\"\n                        placeholder=\"Dodaten informace o prbhu objednvky...\"\n                        value={formData.poznamka_stav || ''}\n                        onChange={(e) => handleInputChange('poznamka_stav', e.target.value)}\n                        onBlur={(e) => handleFieldBlur('poznamka_stav', e.target.value)}\n                        rows={3}\n                      />\n                    </FormGroup>\n                  </FormRow>\n                </SectionContent>\n              </FormSection>\n\n              <FormSection>\n                <SectionHeader\n                  sectionTheme={getSectionTheme('dodaci_informace')}\n                  isActive={isSectionActive('dodaci_informace')}\n                >\n                  <SectionTitle sectionTheme={getSectionTheme('dodaci_informace')}>\n                    <SectionIcon sectionTheme={getSectionTheme('dodaci_informace')}>\n                      <Package />\n                    </SectionIcon>\n                    Dodac informace\n                  </SectionTitle>\n                  <CollapseIcon\n                    collapsed={sectionStates.dodaci_informace}\n                    sectionTheme={getSectionTheme('dodaci_informace')}\n                    onClick={() => toggleSection('dodaci_informace')}\n                    style={{ cursor: 'pointer' }}\n                  >\n                    <FontAwesomeIcon icon={faChevronUp} />\n                  </CollapseIcon>\n                </SectionHeader>\n                <SectionContent collapsed={sectionStates.dodaci_informace}>\n                  <FormRow>\n                    <FormGroup>\n                      <Label>SLO ZSILKY</Label>\n                      <InputWithIcon hasIcon>\n                        <Hash />\n                        <Input\n                          type=\"text\"\n                          name=\"cislo_zasilky\"\n                          placeholder=\"Sledovac slo zsilky\"\n                          value={formData.cislo_zasilky || ''}\n                          onChange={(e) => handleInputChange('cislo_zasilky', e.target.value)}\n                          hasIcon\n                        />\n                      </InputWithIcon>\n                    </FormGroup>\n                    <FormGroup>\n                      <Label>PEPRAVCE</Label>\n                      <InputWithIcon hasIcon>\n                        <Package />\n                        <Input\n                          type=\"text\"\n                          name=\"prepravce\"\n                          placeholder=\"Nzev pepravn spolenosti\"\n                          value={formData.prepravce || ''}\n                          onChange={(e) => handleInputChange('prepravce', e.target.value)}\n                          hasIcon\n                        />\n                      </InputWithIcon>\n                    </FormGroup>\n                  </FormRow>\n                  <FormRow>\n                    <FormGroup>\n                      <Label>OEKVAN DORUEN</Label>\n                      <DatePicker\n                        fieldName=\"ocekavane_doruceni\"\n                        value={formData.ocekavane_doruceni || ''}\n                        onChange={(value) => handleInputChange('ocekavane_doruceni', value)}\n                        onBlur={(value) => handleFieldBlur('ocekavane_doruceni', value)}\n                        placeholder=\"Vyberte oekvan datum doruen\"\n                      />\n                    </FormGroup>\n                    <FormGroup>\n                      <Label>SKUTEN DORUEN</Label>\n                      <DatePicker\n                        fieldName=\"skutecne_doruceni\"\n                        value={formData.skutecne_doruceni || ''}\n                        onChange={(value) => handleInputChange('skutecne_doruceni', value)}\n                        onBlur={(value) => handleFieldBlur('skutecne_doruceni', value)}\n                        placeholder=\"Vyberte skuten datum doruen\"\n                      />\n                    </FormGroup>\n                  </FormRow>\n                </SectionContent>\n              </FormSection>\n              */}\n\n              {/* SEKCE FAKTURACE DOASN SKRYTA - BUDE PIDNA POZDJI */}\n              {/* Sekce: Fakturace - zobraz se a po potvrzen ANO od dodavatele */}\n              {false && formData.dodavatel_zpusob_potvrzeni?.potvrzeni === 'ANO' && (\n                <FormSection>\n                  <SectionHeader\n                    sectionTheme={getSectionTheme('fakturace')}\n                    isActive={isSectionActive('fakturace')}\n                  >\n                    <SectionTitle sectionTheme={getSectionTheme('fakturace')}>\n                      <SectionIcon sectionTheme={getSectionTheme('fakturace')}>\n                        <Calculator />\n                      </SectionIcon>\n                      Fakturace\n                    </SectionTitle>\n                    <CollapseIcon\n                      collapsed={sectionStates.fakturace}\n                      sectionTheme={getSectionTheme('fakturace')}\n                      onClick={() => toggleSection('fakturace')}\n                      style={{ cursor: 'pointer' }}\n                    >\n                      <FontAwesomeIcon icon={faChevronUp} />\n                    </CollapseIcon>\n                  </SectionHeader>\n                  <SectionContent collapsed={sectionStates.fakturace}>\n                    <FormRow>\n                      <FormGroup>\n                        <Label>SLO FAKTURY</Label>\n                        <InputWithIcon hasIcon>\n                          <Hash />\n                          <Input\n                            type=\"text\"\n                            name=\"cislo_faktury\"\n                            placeholder=\"slo pijat faktury\"\n                            value={formData.cislo_faktury || ''}\n                            onChange={(e) => handleInputChange('cislo_faktury', e.target.value)}\n                            hasIcon\n                          />\n                        </InputWithIcon>\n                      </FormGroup>\n                      <FormGroup>\n                        <Label>DATUM FAKTURY</Label>\n                        <DatePicker\n                          fieldName=\"datum_faktury\"\n                          value={formData.datum_faktury || ''}\n                          onChange={(value) => handleInputChange('datum_faktury', value)}\n                          onBlur={(value) => handleFieldBlur('datum_faktury', value)}\n                          placeholder=\"Vyberte datum faktury\"\n                        />\n                      </FormGroup>\n                    </FormRow>\n                  <FormRow>\n                    <FormGroup>\n                      <Label>STKA BEZ DPH</Label>\n                      <InputWithIcon hasIcon>\n                        <Calculator />\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          name=\"castka_bez_dph\"\n                          placeholder=\"0.00\"\n                          value={formData.castka_bez_dph || ''}\n                          onChange={(e) => handleInputChange('castka_bez_dph', e.target.value)}\n                          style={{textAlign: 'right'}}\n                          hasIcon\n                        />\n                      </InputWithIcon>\n                    </FormGroup>\n                    <FormGroup>\n                      <Label>STKA S DPH</Label>\n                      <InputWithIcon hasIcon>\n                        <Calculator />\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          name=\"castka_s_dph\"\n                          placeholder=\"0.00\"\n                          value={formData.castka_s_dph || ''}\n                          onChange={(e) => handleInputChange('castka_s_dph', e.target.value)}\n                          style={{textAlign: 'right'}}\n                          hasIcon\n                        />\n                      </InputWithIcon>\n                    </FormGroup>\n                  </FormRow>\n                  <FormRow>\n                    <FormGroup>\n                      <Label>DATUM SPLATNOSTI</Label>\n                      <DatePicker\n                        fieldName=\"datum_splatnosti\"\n                        value={formData.datum_splatnosti || ''}\n                        onChange={(value) => handleInputChange('datum_splatnosti', value)}\n                        onBlur={(value) => handleFieldBlur('datum_splatnosti', value)}\n                        placeholder=\"Vyberte datum splatnosti\"\n                      />\n                    </FormGroup>\n                    <FormGroup>\n                      <Label>DATUM ZAPLACEN</Label>\n                      <DatePicker\n                        fieldName=\"datum_zaplaceni\"\n                        value={formData.datum_zaplaceni || ''}\n                        onChange={(value) => handleInputChange('datum_zaplaceni', value)}\n                        onBlur={(value) => handleFieldBlur('datum_zaplaceni', value)}\n                        placeholder=\"Vyberte datum zaplacen\"\n                      />\n                    </FormGroup>\n                  </FormRow>\n                </SectionContent>\n                </FormSection>\n              )}\n            </>\n          )}\n        </>\n      )}\n\n          {/*  NOV POZICE: Sekce Plohy k objednvce - zobraz se JEN kdy m objednvka ID (po prvnm uloen) */}\n          {formData.id && (() => {\n            //  isPrilohyLocked je definovno globln na dku ~5203 jako: isWorkflowCompleted && !canUnlockAnything\n\n            return (\n            <FormSection data-section=\"prilohy\">\n              <SectionHeader\n                sectionTheme={getSectionTheme('prilohy')}\n                isActive={isSectionActive('prilohy')}\n              >\n                <SectionTitle sectionTheme={getSectionTheme('prilohy')}>\n                  <SectionIcon sectionTheme={getSectionTheme('prilohy')}>\n                    <FontAwesomeIcon icon={faClipboard} />\n                  </SectionIcon>\n                  Plohy k objednvce\n                  {/*  Badge kdy je objednvka dokonena/zamtnuta/zruena */}\n                  {isPrilohyLocked && (\n                    <LockWarning title=\"Sekce Plohy k objednvce je zamena - objednvka je dokonena/zamtnuta/zruena.\">\n                      \n                    </LockWarning>\n                  )}\n                </SectionTitle>\n                <CollapseIcon\n                  collapsed={sectionStates.prilohy}\n                  sectionTheme={getSectionTheme('prilohy')}\n                  onClick={() => toggleSection('prilohy')}\n                  style={{ cursor: 'pointer' }}\n                >\n                  <FontAwesomeIcon icon={faChevronUp} />\n                </CollapseIcon>\n              </SectionHeader>\n              <SectionContent collapsed={sectionStates.prilohy}>\n                <FormRow>\n                  <FormGroup style={{gridColumn: '1 / -1'}}>\n                    {/*  Informace o zamen */}\n                    {isPrilohyLocked && (\n                      <div style={{\n                        background: '#fef3c7',\n                        border: '2px solid #f59e0b',\n                        borderRadius: '8px',\n                        padding: '1rem',\n                        marginBottom: '1rem',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '0.75rem'\n                      }}>\n                        <span style={{ fontSize: '1.5rem' }}></span>\n                        <div>\n                          <div style={{ fontWeight: '600', color: '#92400e', marginBottom: '0.25rem' }}>\n                            Pidvn ploh je zameno\n                          </div>\n                          <div style={{ fontSize: '0.875rem', color: '#92400e' }}>\n                            Objednvka je dokonena - nelze pidvat ani upravovat plohy.\n                          </div>\n                        </div>\n                      </div>\n                    )}\n\n                    {/* Drag & Drop Oblast */}\n                    <div\n                      style={{\n                        border: `2px dashed ${isPrilohyLocked ? '#d1d5db' : (dragOver ? '#dc2626' : '#fca5a5')}`,\n                        borderRadius: '8px',\n                        padding: '2rem',\n                        textAlign: 'center',\n                        backgroundColor: isPrilohyLocked ? '#f3f4f6' : (dragOver ? 'rgba(254, 202, 202, 0.5)' : 'rgba(254, 226, 226, 0.3)'),\n                        marginBottom: '1rem',\n                        transition: 'all 0.2s ease',\n                        cursor: isPrilohyLocked ? 'not-allowed' : 'pointer',\n                        opacity: isPrilohyLocked ? 0.5 : 1,\n                        pointerEvents: isPrilohyLocked ? 'none' : 'auto'\n                      }}\n                      onDrop={(e) => {\n                        if (isPrilohyLocked) return;\n                        e.preventDefault();\n                        e.stopPropagation();\n                        setDragOver(false);\n                        handleFileDrop(e);\n                      }}\n                      onDragOver={(e) => {\n                        if (isPrilohyLocked) return;\n                        e.preventDefault();\n                        e.stopPropagation();\n                        setDragOver(true);\n                      }}\n                      onDragEnter={(e) => {\n                        if (isPrilohyLocked) return;\n                        e.preventDefault();\n                        e.stopPropagation();\n                        setDragOver(true);\n                      }}\n                      onDragLeave={(e) => {\n                        if (isPrilohyLocked) return;\n                        e.preventDefault();\n                        e.stopPropagation();\n                        // Zkontroluj, zda opravdu opoutme celou oblast\n                        if (!e.currentTarget.contains(e.relatedTarget)) {\n                          setDragOver(false);\n                        }\n                      }}\n                      onClick={() => !isPrilohyLocked && document.getElementById('fileInput').click()}\n                    >\n                      {uploadingFiles ? (\n                        <div style={{\n                          width: '32px',\n                          height: '32px',\n                          border: '3px solid #f3f4f6',\n                          borderTop: '3px solid #3b82f6',\n                          borderRadius: '50%',\n                          animation: 'spin 1s linear infinite',\n                          margin: '0 auto 1rem auto'\n                        }}></div>\n                      ) : (\n                        <div style={{\n                          fontSize: '3rem',\n                          marginBottom: '1rem',\n                          color: dragOver ? '#dc2626' : '#991b1b',\n                          transition: 'color 0.2s ease'\n                        }}>\n                          \n                        </div>\n                      )}\n                      <div style={{\n                        fontSize: '1rem',\n                        fontWeight: '500',\n                        marginBottom: '0.5rem',\n                        color: dragOver ? '#dc2626' : uploadingFiles ? '#f59e0b' : '#991b1b'\n                      }}>\n                        {uploadingFiles ? 'Nahrvm soubory...' : dragOver ? 'Pus soubory zde!' : 'Pethni nebo vyber soubory'}\n                      </div>\n                      <div style={{ fontSize: '0.875rem', color: '#6b7280', marginBottom: '1rem' }}>\n                        Kad ploha mus bt klasifikovna: Objednvka / Faktura / Koilka / Jin.<br/>\n                        <span style={{ fontSize: '0.8rem', color: '#f59e0b' }}>\n                           Max. velikost souboru: 20 MB | Max. celkov velikost: 100 MB<br/>\n                           Podporovan formty:<br/>\n                          &nbsp;&nbsp; Dokumenty: PDF, DOC, DOCX, ODT, RTF, TXT<br/>\n                          &nbsp;&nbsp; Tabulky: XLS, XLSX, ODS, CSV<br/>\n                          &nbsp;&nbsp; Prezentace: PPT, PPTX, ODP<br/>\n                          &nbsp;&nbsp; Obrzky: JPG, PNG, GIF, BMP, SVG<br/>\n                          &nbsp;&nbsp; Archivy: ZIP, RAR, 7Z<br/>\n                          &nbsp;&nbsp; Emaily: EML, MSG\n                        </span>\n                      </div>\n                      <button\n                        type=\"button\"\n                        disabled={isPrilohyLocked}\n                        style={{\n                          marginTop: '1rem',\n                          background: isPrilohyLocked ? '#9ca3af' : '#3b82f6',\n                          color: 'white',\n                          border: 'none',\n                          borderRadius: '6px',\n                          padding: '0.5rem 1rem',\n                          fontSize: '0.875rem',\n                          fontWeight: '500',\n                          cursor: isPrilohyLocked ? 'not-allowed' : 'pointer',\n                          opacity: isPrilohyLocked ? 0.6 : 1\n                        }}\n                        onClick={(e) => {\n                          if (isPrilohyLocked) return;\n                          e.stopPropagation();\n                          document.getElementById('fileInput').click();\n                        }}\n                      >\n                        Vybrat\n                      </button>\n                    </div>\n\n                    {/* Skryt file input */}\n                    <input\n                      id=\"fileInput\"\n                      type=\"file\"\n                      multiple\n                      accept=\".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif,.txt\"\n                      onChange={handleFileSelect}\n                      disabled={isPrilohyLocked}\n                      style={{ display: 'none' }}\n                    />\n\n                    {/* Seznam nahranch soubor - pouze obj- prefix */}\n                    {attachments && attachments.filter(a => getFilePrefix(a) === 'obj-').length > 0 && (\n                      <div style={{ marginTop: '1rem' }}>\n                        <div style={{\n                          display: 'flex',\n                          justifyContent: 'space-between',\n                          alignItems: 'center',\n                          marginBottom: '1rem'\n                        }}>\n                          <Label>\n                            Poet ploh: <strong>{attachments.filter(a => getFilePrefix(a) === 'obj-').length}</strong> |\n                            Nahrno: <span style={{color: '#16a34a'}}><strong>{attachments.filter(f => getFilePrefix(f) === 'obj-' && f.status === 'uploaded').length}</strong></span> |\n                            Velikost: <strong>{(() => {\n                              const totalSize = attachments\n                                .filter(f => getFilePrefix(f) === 'obj-' && f.status === 'uploaded')\n                                .reduce((sum, f) => sum + (f.size || 0), 0);\n                              return totalSize > 0 ? `${(totalSize / 1024 / 1024).toFixed(2)} MB` : '0 MB';\n                            })()}</strong>\n                          </Label>\n\n                          <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                            {/* Sync tlatko */}\n                            <button\n                              type=\"button\"\n                              onClick={() => checkAttachmentsSynchronization25(false)}\n                              disabled={isCheckingSyncAttachments}\n                              style={{\n                                background: '#10b981',\n                                color: 'white',\n                                border: 'none',\n                                borderRadius: '6px',\n                                padding: '0.375rem',\n                                fontSize: '0.875rem',\n                                cursor: isCheckingSyncAttachments ? 'not-allowed' : 'pointer',\n                                display: 'flex',\n                                alignItems: 'center',\n                                justifyContent: 'center',\n                                opacity: isCheckingSyncAttachments ? 0.6 : 1\n                              }}\n                              title=\"Kontrola synchronizace ploh s databz a diskem - zkontroluje, jestli jsou plohy v DB i fyzicky na disku\"\n                            >\n                              <FontAwesomeIcon icon={faSync} />\n                            </button>\n\n                            {/* Smart tlatko */}\n                            <button\n                              type=\"button\"\n                              onClick={loadAttachmentsSmartly}\n                              style={{\n                                background: '#3b82f6',\n                                color: 'white',\n                                border: 'none',\n                                borderRadius: '6px',\n                                padding: '0.375rem',\n                                fontSize: '0.875rem',\n                                cursor: 'pointer',\n                                display: 'flex',\n                                alignItems: 'center',\n                                justifyContent: 'center'\n                              }}\n                              title=\"Chytr naten ploh - slou DB plohy s loklnmi neuloenmi plohami, ideln pi obnoven formule\"\n                            >\n                              <FontAwesomeIcon icon={faBrain} />\n                            </button>\n\n                            {/* DB tlatko */}\n                            <button\n                              type=\"button\"\n                              onClick={() => restoreAttachmentsFromDB(false)}\n                              style={{\n                                background: '#7c3aed',\n                                color: 'white',\n                                border: 'none',\n                                borderRadius: '6px',\n                                padding: '0.375rem',\n                                fontSize: '0.875rem',\n                                cursor: 'pointer',\n                                display: 'flex',\n                                alignItems: 'center',\n                                justifyContent: 'center'\n                              }}\n                              title=\"Naten z databze - nate pouze plohy uloen v databzi, pepe lokln stav\"\n                            >\n                              <FontAwesomeIcon icon={faDatabase} />\n                            </button>\n\n                            {/* Vymazat vechny - SKRT kdy je zameno */}\n                            {!isPrilohyLocked && (\n                              <button\n                                type=\"button\"\n                                onClick={removeAllFiles}\n                                style={{\n                                  background: '#dc2626',\n                                  color: 'white',\n                                  border: 'none',\n                                  borderRadius: '6px',\n                                  padding: '0.25rem 0.75rem',\n                                  fontSize: '0.75rem',\n                                  cursor: 'pointer'\n                                }}\n                              >\n                                Vymazat vechny\n                              </button>\n                            )}\n                          </div>\n                        </div>\n                        {attachments.filter(a => getFilePrefix(a) === 'obj-').map((file, index) => (\n                          <div key={file.id} style={{\n                            display: 'flex',\n                            alignItems: 'center',\n                            gap: '0.75rem',\n                            padding: '0.75rem',\n                            border: `1px solid ${getFileBorderColor(file)}`,\n                            borderRadius: '6px',\n                            backgroundColor: getFileBackgroundColor(file),\n                            marginBottom: '0.5rem',\n                            opacity: file.status === 'uploading' ? 0.6 : 1\n                          }}>\n                            {/* Ikona PDF/souboru s indiktorem stavu - fit pro 2 dky */}\n                            <div style={{\n                              width: '32px',\n                              height: '44px',\n                              display: 'flex',\n                              alignItems: 'center',\n                              justifyContent: 'center',\n                              flexShrink: 0,\n                              position: 'relative'\n                            }}>\n                              <FontAwesomeIcon\n                                icon={file.file_exists === false ? faFileCircleXmark : faFileAlt}\n                                style={{\n                                  color: file.file_exists === false ? '#dc2626' : (file.status === 'uploaded' ? '#10b981' : '#dc2626'),\n                                  fontSize: '24px'\n                                }}\n                              />\n                              {file.status === 'uploading' && (\n                                <div style={{\n                                  position: 'absolute',\n                                  top: '-2px',\n                                  right: '-2px',\n                                  width: '12px',\n                                  height: '12px',\n                                  backgroundColor: '#f59e0b',\n                                  borderRadius: '50%',\n                                  animation: 'spin 1s linear infinite'\n                                }} />\n                              )}\n                              {file.status === 'uploaded' && (\n                                <div style={{\n                                  position: 'absolute',\n                                  top: '-2px',\n                                  right: '-2px',\n                                  width: '12px',\n                                  height: '12px',\n                                  backgroundColor: '#10b981',\n                                  borderRadius: '50%'\n                                }} />\n                              )}\n                            </div>\n\n                            {/* Informace o souboru */}\n                            <div style={{ flex: 1, minWidth: 0 }}>\n                              <div style={{\n                                fontWeight: '500',\n                                fontSize: '0.875rem',\n                                color: '#374151',\n                                marginBottom: '2px'\n                              }}>\n                                {/* Jeden dek - nzev, velikost, staen, ko */}\n                                <div style={{\n                                  display: 'flex',\n                                  alignItems: 'center',\n                                  gap: '0.5rem'\n                                }}>\n                                  {/* Nzev souboru s hvzdikou jako horn index */}\n                                  <span style={{\n                                    overflow: 'hidden',\n                                    textOverflow: 'ellipsis',\n                                    whiteSpace: 'nowrap',\n                                    flex: 1,\n                                    minWidth: 0,\n                                    position: 'relative'\n                                  }}>\n                                    {file.name}\n                                    {/* erven hvzdika jako horn index hned za nzvem */}\n                                    {!file.klasifikace && (\n                                      <span style={{\n                                        color: '#dc2626',\n                                        fontSize: '0.7rem',\n                                        fontWeight: 'bold',\n                                        position: 'absolute',\n                                        top: '-2px',\n                                        marginLeft: '2px'\n                                      }}>\n                                        *\n                                      </span>\n                                    )}\n                                  </span>\n\n                                  {/* Warning pro soubory, kter neexistuj na disku */}\n                                  {file.file_exists === false && (\n                                    <span style={{\n                                      color: '#dc2626',\n                                      fontSize: '0.7rem',\n                                      fontWeight: 'bold',\n                                      backgroundColor: '#fee2e2',\n                                      padding: '1px 4px',\n                                      borderRadius: '3px',\n                                      flexShrink: 0\n                                    }}>\n                                       SOUBOR NENALEZEN\n                                    </span>\n                                  )}\n\n                                  {/* Warning pro duplicity */}\n                                  {file.isDuplicate && (\n                                    <span style={{\n                                      color: '#f59e0b',\n                                      fontSize: '0.7rem',\n                                      fontWeight: 'bold',\n                                      backgroundColor: '#fef3c7',\n                                      padding: '1px 4px',\n                                      borderRadius: '3px',\n                                      flexShrink: 0\n                                    }}>\n                                      DUPLIKT\n                                    </span>\n                                  )}\n\n                                  {/* Velikost souboru - pouvej velikost z BE nebo size z loklnho */}\n                                  <span style={{\n                                    color: '#6b7280',\n                                    fontWeight: 'normal',\n                                    fontSize: '0.75rem',\n                                    flexShrink: 0\n                                  }}>\n                                    ({Math.round((file.velikost || file.size || 0) / 1024)} kB)\n                                  </span>\n\n                                  {/* Staen pro nahran soubory */}\n                                  {file.status === 'uploaded' && file.serverId && (\n                                    <button\n                                      type=\"button\"\n                                      onClick={() => downloadAttachmentFromServer25(file)}\n                                      style={{\n                                        background: 'none',\n                                        border: 'none',\n                                        color: '#2563eb',\n                                        cursor: 'pointer',\n                                        padding: '2px',\n                                        display: 'flex',\n                                        alignItems: 'center',\n                                        fontSize: '12px',\n                                        flexShrink: 0\n                                      }}\n                                      title=\"Sthnout soubor\"\n                                    >\n                                      <FileText size={14} />\n                                    </button>\n                                  )}\n\n                                  {/* Ko - SKRT kdy je zameno */}\n                                  {!isPrilohyLocked && (\n                                    <button\n                                      type=\"button\"\n                                      onClick={() => file.serverId ? deleteAttachmentFromServer25(file.id) : removeFile(file.id)}\n                                      disabled={file.status === 'uploading'}\n                                      style={{\n                                        background: 'none',\n                                        border: 'none',\n                                        color: file.status === 'uploading' ? '#9ca3af' : '#dc2626',\n                                        cursor: file.status === 'uploading' ? 'not-allowed' : 'pointer',\n                                        padding: '2px',\n                                        display: 'flex',\n                                        alignItems: 'center',\n                                        opacity: file.status === 'uploading' ? 0.6 : 1,\n                                        fontSize: '12px',\n                                        flexShrink: 0\n                                      }}\n                                      title={file.serverId ? \"Smazat ze serveru\" : \"Smazat soubor\"}\n                                    >\n                                      <FontAwesomeIcon icon={faTrash} />\n                                    </button>\n                                  )}\n                                </div>\n                              </div>\n                              <div style={{\n                                fontSize: '0.75rem',\n                                color: '#6b7280',\n                                display: 'flex',\n                                alignItems: 'center',\n                                gap: '0.5rem'\n                              }}>\n                                <span>\n                                  {file.uploadDate && !isNaN(new Date(file.uploadDate).getTime()) \n                                    ? `${formatDateOnly(new Date(file.uploadDate))} ${new Date(file.uploadDate).toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' })}`\n                                    : 'Datum neuvedeno'\n                                  }\n                                </span>\n                                <span></span>\n                                <span style={{\n                                  textTransform: 'uppercase',\n                                  backgroundColor: '#fef3c7',\n                                  color: '#92400e',\n                                  padding: '2px 6px',\n                                  borderRadius: '4px',\n                                  fontSize: '0.6875rem',\n                                  fontWeight: '500'\n                                }}>\n                                  {file.type.includes('pdf') ? 'PDF' : file.name.split('.').pop()}\n                                </span>\n                                <span></span>\n                                <span style={{\n                                  backgroundColor: '#e0e7ff',\n                                  color: '#3730a3',\n                                  padding: '2px 6px',\n                                  borderRadius: '4px',\n                                  fontSize: '0.6875rem',\n                                  fontWeight: '500'\n                                }}>\n                                  Nahrno: {file.nahrano_uzivatel?.prijmeni || userDetail?.prijmeni || 'Neznm'} {file.nahrano_uzivatel?.jmeno || userDetail?.jmeno || 'uivatel'}\n                                </span>\n                              </div>\n                            </div>\n\n                            {/* Dropdown pro klasifikaci */}\n                            <div style={{ minWidth: '180px', flexShrink: 0 }}>\n                              {(() => {\n                                // Debug log pro hodnotu selectu\n                                // Debug disabled for production\n                                return null;\n                              })()}\n                              <select\n                                value={file.klasifikace || ''}\n                                onChange={(e) => updateFileKlasifikace(file.id, e.target.value)}\n                                disabled={file.status === 'uploading' || file.typ_prilohy === 'IMPORT' || isPrilohyLocked}\n                                style={{\n                                  width: '100%',\n                                  padding: '0.5rem 0.75rem',\n                                  border: `1px solid ${!file.klasifikace ? '#fca5a5' : file.typ_prilohy === 'IMPORT' ? '#f59e0b' : '#d1d5db'}`,\n                                  borderRadius: '6px',\n                                  fontSize: '0.875rem',\n                                  backgroundColor: file.status === 'uploading' ? '#f3f4f6' : file.typ_prilohy === 'IMPORT' ? '#fef3c7' : isPrilohyLocked ? '#f3f4f6' : 'white',\n                                  color: file.klasifikace ? '#374151' : '#6b7280',\n                                  cursor: file.status === 'uploading' || file.typ_prilohy === 'IMPORT' || isPrilohyLocked ? 'not-allowed' : 'pointer',\n                                  opacity: file.status === 'uploading' || isPrilohyLocked ? 0.6 : 1,\n                                  fontWeight: file.typ_prilohy === 'IMPORT' ? '600' : 'normal'\n                                }}\n                                title={isPrilohyLocked ? 'Klasifikace je zamena - objednvka dokonena' : (file.typ_prilohy === 'IMPORT' ? 'Importovan ploha - nelze mnit typ' : '')}\n                              >\n                                <option value=\"\" style={{ color: '#6b7280' }}>Vyberte...</option>\n                                {prilohyTypyOptions.map(typ => (\n                                  <option key={typ.kod || typ.id} value={typ.kod || typ.id}>\n                                    {typ.nazev || typ.name}\n                                  </option>\n                                ))}\n                              </select>\n                            </div>\n\n                          </div>\n                        ))}\n                      </div>\n                    )}\n\n                    {/* Varovn zprva o okamitch zmnch v plohch */}\n                    <div style={{\n                      backgroundColor: '#fef3c7',\n                      border: '1px solid #f59e0b',\n                      borderRadius: '8px',\n                      padding: '1rem',\n                      marginTop: '1rem',\n                      display: 'flex',\n                      alignItems: 'flex-start',\n                      gap: '0.75rem'\n                    }}>\n                      <div style={{\n                        fontSize: '1.25rem',\n                        flexShrink: 0,\n                        lineHeight: 1\n                      }}>\n                        \n                      </div>\n                      <div style={{\n                        fontSize: '0.875rem',\n                        color: '#92400e',\n                        lineHeight: '1.5'\n                      }}>\n                        <strong>Dleit upozornn:</strong> Vechny zmny v plohch (nahrn, klasifikace, mazn)\n                        jsou provdny okamit a automaticky se ukldaj do databze.\n                        Tyto akce nelze vzt zpt pomoc tlatka \"Zruit\".\n                      </div>\n                    </div>\n                  </FormGroup>\n                </FormRow>\n              </SectionContent>\n            </FormSection>\n            );\n          })()}\n\n          </ScrollableInner>\n        </ScrollableContent>\n      </FormWrapper>\n\n      {/* Supplier Search Dialog */}\n      {showSupplierSearchDialog && ReactDOM.createPortal(\n        <SupplierPopupOverlay>\n          <SupplierPopupModal onClick={(e) => e.stopPropagation()}>\n            <SupplierPopupHeader>\n              <SupplierPopupTitle>\n                <Users size={24} />\n                Adres dodavatel\n              </SupplierPopupTitle>\n              <SupplierPopupCloseButton onClick={handleSupplierSearchClose}>\n                \n              </SupplierPopupCloseButton>\n            </SupplierPopupHeader>\n\n            <SupplierPopupContent>\n              {/* Search Input */}\n              <div style={{ marginBottom: '20px' }}>\n                <SupplierSearchInput\n                  type=\"text\"\n                  value={supplierSearchTerm}\n                  onChange={handleSupplierSearchChange}\n                  placeholder=\"Vyhledat podle nzvu nebo IO...\"\n                  autoFocus\n                />\n              </div>\n\n              {/* Search Results */}\n              <div style={{ minHeight: '200px' }}>\n                {supplierSearchLoading ? (\n                  <div style={{\n                    display: 'flex',\n                    flexDirection: 'column',\n                    alignItems: 'center',\n                    padding: '40px 20px',\n                    textAlign: 'center'\n                  }}>\n                    <div style={{\n                      width: '32px',\n                      height: '32px',\n                      border: '3px solid #f3f4f6',\n                      borderTop: '3px solid #3b82f6',\n                      borderRadius: '50%',\n                      animation: 'spin 1s linear infinite',\n                      marginBottom: '16px'\n                    }}></div>\n                    <p style={{ color: '#6b7280', margin: 0 }}>Vyhledvm dodavatele...</p>\n                  </div>\n                ) : supplierSearchResults.length > 0 ? (\n                  <SupplierList>\n                    {supplierSearchResults.map((supplier, index) => (\n                      <SupplierItem\n                        key={supplier.id || index}\n                        onClick={() => handleSupplierSearchSelect(supplier)}\n                      >\n                        <div style={{ fontWeight: '600', color: '#111827', marginBottom: '8px' }}>\n                          {supplier.nazev || supplier.name}\n                        </div>\n                        <div style={{ fontSize: '0.875rem', color: '#6b7280', marginBottom: '4px' }}>\n                          {supplier.adresa || supplier.address || supplier.sidlo}\n                        </div>\n                        <div style={{ fontSize: '0.875rem', color: '#6b7280', marginBottom: '4px' }}>\n                          {supplier.ico && `IO: ${supplier.ico}`} {supplier.dic && ` DI: ${supplier.dic}`}\n                        </div>\n                        {(supplier.kontakt_jmeno || supplier.kontakt_email) && (\n                          <div style={{ fontSize: '0.75rem', color: '#9ca3af' }}>\n                            Kontakt: {supplier.kontakt_jmeno} {supplier.kontakt_email && ` ${supplier.kontakt_email}`}\n                          </div>\n                        )}\n                      </SupplierItem>\n                    ))}\n                  </SupplierList>\n                ) : allSupplierContacts.length === 0 ? (\n                  <div style={{\n                    textAlign: 'center',\n                    padding: '40px 20px',\n                    color: '#6b7280'\n                  }}>\n                    <p>dn dodavatel nejsou k dispozici.</p>\n                  </div>\n                ) : supplierSearchTerm.length >= 2 ? (\n                  <div style={{\n                    textAlign: 'center',\n                    padding: '40px 20px',\n                    color: '#6b7280'\n                  }}>\n                    <p>dn dodavatel nevyhovuj vyhledvn \"{supplierSearchTerm}\".</p>\n                  </div>\n                ) : (\n                  <div style={{\n                    textAlign: 'center',\n                    padding: '40px 20px',\n                    color: '#6b7280'\n                  }}>\n                    <p>Zante pst pro filtrovn dodavatel...</p>\n                  </div>\n                )}\n              </div>\n            </SupplierPopupContent>\n          </SupplierPopupModal>\n        </SupplierPopupOverlay>,\n        document.body\n      )}\n\n      {/* ARES Search Popup */}\n      {aresPopupOpen && ReactDOM.createPortal(\n        <AresPopupOverlay>\n          <AresPopupModal onClick={(e) => e.stopPropagation()}>\n            <AresPopupHeader>\n              <AresPopupTitle>\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <ellipse cx=\"12\" cy=\"5\" rx=\"9\" ry=\"3\"/>\n                  <path d=\"M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5\"/>\n                  <path d=\"M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3\"/>\n                </svg>\n                ARES - Administrativn registr ekonomickch subjekt\n              </AresPopupTitle>\n              <AresPopupCloseButton\n                onClick={() => {\n                  setAresPopupOpen(false);\n                  setAresSearch('');\n                }}\n              >\n                <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/>\n                  <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\n                </svg>\n              </AresPopupCloseButton>\n            </AresPopupHeader>\n\n            <AresPopupContent>\n              <AresSearchInputField\n                type=\"text\"\n                placeholder=\"Vyhledat podle nzvu firmy nebo IO...\"\n                value={aresSearch}\n                onChange={handleAresSearchChange}\n                autoFocus\n              />\n\n              {/*  ROZSAH ULOEN - PRESNE STEJN jako SupplierAddDialog */}\n              <div style={{ marginBottom: '16px' }}>\n                <div style={{ fontSize: '14px', fontWeight: '600', color: '#262626', marginBottom: '8px', textTransform: 'uppercase', letterSpacing: '0.5px' }}>\n                  Rozsah uloen\n                </div>\n                <AresScopeSelector>\n                  {/* Osobn */}\n                  <AresScopeOption\n                    type=\"button\"\n                    selected={aresSelectedScope === 'personal'}\n                    onClick={() => setAresSelectedScope('personal')}\n                  >\n                    <FontAwesomeIcon icon={faUser} />\n                    <span>Osobn</span>\n                  </AresScopeOption>\n\n                  {/* sek */}\n                  <AresScopeOption\n                    type=\"button\"\n                    selected={aresSelectedScope === 'usek'}\n                    onClick={() => hasPermission && hasPermission('CONTACT_EDIT') && setAresSelectedScope('usek')}\n                    disabled={!hasPermission || !hasPermission('CONTACT_EDIT')}\n                    title={(!hasPermission || !hasPermission('CONTACT_EDIT')) ? \"Nemte oprvnn pro sekov kontakt\" : \"\"}\n                  >\n                    <FontAwesomeIcon icon={faBuilding} />\n                    <span>sek</span>\n                  </AresScopeOption>\n\n                  {/* Globln */}\n                  <AresScopeOption\n                    type=\"button\"\n                    selected={aresSelectedScope === 'global'}\n                    onClick={() => hasPermission && hasPermission('CONTACT_MANAGE') && setAresSelectedScope('global')}\n                    disabled={!hasPermission || !hasPermission('CONTACT_MANAGE')}\n                    title={(!hasPermission || !hasPermission('CONTACT_MANAGE')) ? \"Nemte oprvnn pro globln kontakt\" : \"\"}\n                  >\n                    <FontAwesomeIcon icon={faGlobe} />\n                    <span>Globln</span>\n                  </AresScopeOption>\n                </AresScopeSelector>\n              </div>\n\n              {/*  Vbr sek - zobraz se pouze pokud je vybran scope \"usek\" */}\n              {aresSelectedScope === 'usek' && (\n                <div style={{ marginBottom: '16px' }}>\n                  <div style={{ fontSize: '14px', fontWeight: '600', color: '#262626', marginBottom: '12px', textTransform: 'uppercase', letterSpacing: '0.5px' }}>\n                    {canManageUsers ? 'Vbr sek' : `V sek: ${userDetail?.usek_zkr || 'N/A'}`}\n                  </div>\n                  {usekyLoading ? (\n                    <div style={{ padding: '1rem', textAlign: 'center', color: '#6b7280' }}>\n                      Natm seky...\n                    </div>\n                  ) : availableUseky.length === 0 ? (\n                    <div style={{ padding: '1rem', background: '#fef2f2', border: '1px solid #fecaca', borderRadius: '8px', color: '#dc2626' }}>\n                       dn seky nebyly nateny\n                    </div>\n                  ) : (\n                    <AresUsekGrid>\n                      {(canManageUsers ? availableUseky :\n                        availableUseky.filter(usek => usek.usek_zkr === userDetail?.usek_zkr)\n                      ).map((usek, index) => (\n                        <AresUsekItem\n                          key={usek.usek_zkr || index}\n                          selected={aresSelectedUseky.includes(usek.usek_zkr)}\n                          onClick={() => handleAresUsekToggle(usek.usek_zkr)}\n                        >\n                          <input\n                            type=\"checkbox\"\n                            checked={aresSelectedUseky.includes(usek.usek_zkr)}\n                            onChange={() => handleAresUsekToggle(usek.usek_zkr)}\n                          />\n                          {usek.usek_zkr}\n                        </AresUsekItem>\n                      ))}\n                    </AresUsekGrid>\n                  )}\n                  {aresSelectedUseky.length === 0 && !usekyLoading && availableUseky.length > 0 && (\n                    <div style={{ marginTop: '8px', padding: '8px', background: '#e0f2fe', border: '1px solid #0ea5e9', borderRadius: '6px', fontSize: '12px', color: '#0c4a6e' }}>\n                       Pokud nevyberete dn sek, kontakt se ulo jako osobn\n                    </div>\n                  )}\n                </div>\n              )}\n\n              <AresList>\n                {loadingAres ? (\n                  <AresLoadingSpinner>\n                    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" style={{ animation: 'spin 1s linear infinite' }}>\n                      <path d=\"M21 12a9 9 0 11-6.219-8.56\"/>\n                    </svg>\n                    <span style={{ marginLeft: '12px' }}>Vyhledvm v ARES...</span>\n                  </AresLoadingSpinner>\n                ) : aresResults.length > 0 ? (\n                  aresResults.map((aresItem, index) => {\n                    const isCurrentlySaving = savingToLocal === aresItem.ico;\n\n                    return (\n                      <AresItem key={index}>\n                        <AresItemContent\n                          hasButtons={true}\n                          onClick={() => handleAresSelect(aresItem)}\n                        >\n                          <div style={{ fontWeight: '600', color: '#111827', marginBottom: '8px' }}>\n                            {aresItem.nazev}\n                          </div>\n                          <div style={{ fontSize: '0.875rem', color: '#6b7280', marginBottom: '4px' }}>\n                            {aresItem.sidlo || aresItem.adresa}\n                          </div>\n                          <div style={{ fontSize: '0.875rem', color: '#6b7280' }}>\n                            IO: {aresItem.ico} {aresItem.dic && ` DI: ${aresItem.dic}`}\n                          </div>\n\n                          {/*  Scope indiktory */}\n                          {aresScopeInfo[aresItem.ico] && (\n                            aresScopeInfo[aresItem.ico].existsInGlobal ||\n                            aresScopeInfo[aresItem.ico].existsInUsek ||\n                            aresScopeInfo[aresItem.ico].existsInPersonal\n                          ) && (\n                            <AresScopeBadges>\n                              {aresScopeInfo[aresItem.ico].existsInGlobal && (\n                                <AresScopeBadge scope=\"global\">\n                                  <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                                    <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\n                                  </svg>\n                                  Globln\n                                </AresScopeBadge>\n                              )}\n                              {aresScopeInfo[aresItem.ico].existsInUsek && (\n                                <AresScopeBadge scope=\"usek\">\n                                  <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                                    <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\n                                  </svg>\n                                  sek\n                                </AresScopeBadge>\n                              )}\n                              {aresScopeInfo[aresItem.ico].existsInPersonal && (\n                                <AresScopeBadge scope=\"personal\">\n                                  <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                                    <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\n                                  </svg>\n                                  Osobn\n                                </AresScopeBadge>\n                              )}\n                            </AresScopeBadges>\n                          )}\n                        </AresItemContent>\n\n                        <AresItemButtons>\n                          <AresActionButton\n                            className=\"primary\"\n                            onClick={() => handleAresSelect(aresItem)}\n                          >\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                              <path d=\"M9 11l3 3L22 4\"/>\n                              <path d=\"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11\"/>\n                            </svg>\n                            Pout\n                          </AresActionButton>\n\n                          <AresActionButton\n                            className=\"success\"\n                            onClick={() => {\n                              //  Pout vybran scope namiesto hardcoded 'personal'\n                              const saveLocation = aresSelectedScope === 'usek'\n                                ? { scope: 'usek', useky: aresSelectedUseky }\n                                : aresSelectedScope;\n                              handleSaveToLocal(aresItem, saveLocation);\n                              handleAresSelect(aresItem);\n                            }}\n                            disabled={isCurrentlySaving || (aresSelectedScope === 'usek' && aresSelectedUseky.length === 0)}\n                            title={(aresSelectedScope === 'usek' && aresSelectedUseky.length === 0) ? \"Vyberte alespo jeden sek\" : \"\"}\n                          >\n                            {isCurrentlySaving ? (\n                              <>\n                                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" style={{ animation: 'spin 1s linear infinite' }}>\n                                  <path d=\"M21 12a9 9 0 11-6.219-8.56\"/>\n                                </svg>\n                                Ukldm...\n                              </>\n                            ) : (\n                              <>\n                                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                                  <path d=\"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z\"/>\n                                  <polyline points=\"17,21 17,13 7,13 7,21\"/>\n                                  <polyline points=\"7,3 7,8 15,8\"/>\n                                </svg>\n                                Pout + Uloit\n                              </>\n                            )}\n                          </AresActionButton>\n                        </AresItemButtons>\n                      </AresItem>\n                    );\n                  })\n                ) : aresSearch.length >= 2 ? (\n                  <div style={{\n                    textAlign: 'center',\n                    padding: '40px 20px',\n                    color: '#6b7280'\n                  }}>\n                    <p>V ARES nebyli nalezeni dn dodavatel.</p>\n                  </div>\n                ) : (\n                  <div style={{\n                    textAlign: 'center',\n                    padding: '40px 20px',\n                    color: '#6b7280'\n                  }}>\n                    <p>Zadejte alespo 2 znaky pro vyhledvn v ARES.</p>\n                  </div>\n                )}\n              </AresList>\n            </AresPopupContent>\n          </AresPopupModal>\n        </AresPopupOverlay>,\n        document.body\n      )}\n\n      {/* Modal pro uloen ablony */}\n      {showTemplateSaveModal && ReactDOM.createPortal(\n        <TemplateModalOverlay>\n          <TemplateModal onClick={(e) => e.stopPropagation()}>\n            <TemplateModalCloseButton\n              type=\"button\"\n              onClick={() => {\n                setShowTemplateSaveModal(false);\n                setTemplateName('');\n                setTemplateType('po');\n                setSaveMode('new');\n                setSelectedTargetTemplate(null);\n              }}\n            >\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n                <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n              </svg>\n            </TemplateModalCloseButton>\n\n            <TemplateModalHeader>\n              <TemplateModalTitle>\n                Uloit ablonu\n              </TemplateModalTitle>\n            </TemplateModalHeader>\n\n            <TemplateModalBody>\n              {/* Reim */}\n              <TemplateFormGroup>\n                <TemplateLabel>REIM</TemplateLabel>\n                <div style={{ display: 'flex', gap: '8px' }}>\n                  {[\n                    { value: 'new', label: ' Nov', disabled: false },\n                    { value: 'update', label: ' Aktualizovat', disabled: [...savedTemplates, ...serverTemplates].length === 0 },\n                    { value: 'merge', label: ' Slouit', disabled: [...savedTemplates, ...serverTemplates].length === 0 }\n                  ].map(option => (\n                    <label key={option.value} style={{\n                      flex: 1,\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      gap: '4px',\n                      padding: '10px 16px',\n                      borderRadius: '6px',\n                      border: `2px solid ${saveMode === option.value ? '#10b981' : '#e5e7eb'}`,\n                      backgroundColor: saveMode === option.value ? '#d1fae5' : 'white',\n                      cursor: option.disabled ? 'not-allowed' : 'pointer',\n                      opacity: option.disabled ? 0.5 : 1,\n                      fontSize: '0.875rem',\n                      fontWeight: '600',\n                      transition: 'all 0.2s'\n                    }}>\n                      <input\n                        type=\"radio\"\n                        name=\"saveMode\"\n                        value={option.value}\n                        checked={saveMode === option.value}\n                        onChange={(e) => setSaveMode(e.target.value)}\n                        disabled={option.disabled}\n                        style={{ display: 'none' }}\n                      />\n                      {option.label}\n                    </label>\n                  ))}\n                </div>\n              </TemplateFormGroup>\n\n              {/* Vbr existujc ablony (pro update/merge) */}\n              {(saveMode === 'update' || saveMode === 'merge') && (\n                <TemplateFormGroup>\n                  <TemplateLabel>VYBERTE ABLONU</TemplateLabel>\n                  <StableCustomSelect\n                    field=\"templateSelect\"\n                    value={selectedTargetTemplate?.id || selectedTargetTemplate?.ts || ''}\n                    onChange={(selectedValue) => {\n                      //  OPRAVA: StableCustomSelect posl hodnotu pmo, ne event!\n                      const allTemplates = [...savedTemplates, ...serverTemplates];\n                      const selected = allTemplates.find(t => (t.id || t.ts).toString() === String(selectedValue));\n                      setSelectedTargetTemplate(selected);\n                      if (saveMode === 'update' && selected) {\n                        setTemplateName(selected.name || '');\n                      }\n                    }}\n                    options={[...savedTemplates, ...serverTemplates]}\n                    placeholder=\"Vyberte ablonu...\"\n                    getOptionLabel={(option) => {\n                      const source = option.__fromServer ? 'server' : 'lokln';\n                      return `${option.name} (${source})`;\n                    }}\n                    getOptionValue={(option) => option.id || option.ts}\n                  />\n                </TemplateFormGroup>\n              )}\n\n              {/* Nzev ablony (pro new/merge) */}\n              {(saveMode === 'new' || saveMode === 'merge') && (\n                <TemplateFormGroup>\n                  <TemplateLabel>NZEV</TemplateLabel>\n                  <TemplateInput\n                    type=\"text\"\n                    value={templateName}\n                    onChange={(e) => setTemplateName(e.target.value)}\n                    placeholder={saveMode === 'merge' ? 'Nzev slouen ablony' : 'Nzev ablony'}\n                    autoFocus={saveMode === 'new'}\n                  />\n                </TemplateFormGroup>\n              )}\n\n              {/* Typ ablony - omezen podle fze */}\n              <TemplateFormGroup>\n                <TemplateLabel>TYP</TemplateLabel>\n                <div style={{ display: 'flex', gap: '8px' }}>\n                  {[\n                    { value: 'po', label: 'PO', disabled: false },\n                    { value: 'details', label: 'Detaily', disabled: !isArchived && currentPhase < 2 },\n                    { value: 'mixed', label: 'Ve', disabled: !isArchived && currentPhase < 2 }\n                  ].map(option => (\n                    <label key={option.value} style={{\n                      flex: 1,\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      padding: '10px 16px',\n                      borderRadius: '6px',\n                      border: `2px solid ${templateType === option.value ? '#3b82f6' : '#e5e7eb'}`,\n                      backgroundColor: templateType === option.value ? '#dbeafe' : 'white',\n                      cursor: option.disabled ? 'not-allowed' : 'pointer',\n                      opacity: option.disabled ? 0.4 : 1,\n                      fontSize: '0.875rem',\n                      fontWeight: '600',\n                      transition: 'all 0.2s'\n                    }}>\n                      <input\n                        type=\"radio\"\n                        name=\"templateType\"\n                        value={option.value}\n                        checked={templateType === option.value}\n                        onChange={(e) => setTemplateType(e.target.value)}\n                        disabled={option.disabled}\n                        style={{ display: 'none' }}\n                      />\n                      {option.label}\n                    </label>\n                  ))}\n                </div>\n                {(!isArchived && currentPhase < 2) && (\n                  <div style={{\n                    marginTop: '8px',\n                    padding: '8px 12px',\n                    backgroundColor: '#fef3c7',\n                    border: '1px solid #fbbf24',\n                    borderRadius: '6px',\n                    fontSize: '0.75rem',\n                    color: '#92400e'\n                  }}>\n                     Ve FZI 1 lze ukldat pouze <strong>PO</strong> (Pedbn objednvka). Detaily budou dostupn po schvlen.\n                  </div>\n                )}\n              </TemplateFormGroup>\n            </TemplateModalBody>\n\n            <TemplateModalActions>\n              <TemplateActionButton\n                type=\"button\"\n                variant=\"cancel\"\n                onClick={() => {\n                  setShowTemplateSaveModal(false);\n                  setTemplateName('');\n                  setTemplateType('po');\n                }}\n              >\n                Zruit\n              </TemplateActionButton>\n              <TemplateActionButton\n                type=\"button\"\n                variant=\"primary\"\n                onClick={async () => {\n                  if (!templateName.trim()) return;\n\n                  // Sestaven dat ablony podle fze a viditelnosti sekc\n                  const templateData = {};\n                  const visibility = getSectionVisibility(mainWorkflowState, currentPhase, isArchived);\n                  const fieldMap = getFieldsForSections();\n\n                  // PO st (vdy dostupn)\n                  if (templateType === 'po' || templateType === 'mixed') {\n                    templateData.poApproval = {\n                      predmet: formData.predmet || '',\n                      prikazce_id: formData.prikazce_id || '',\n                      max_cena_s_dph: formData.max_cena_s_dph || '',\n                      strediska_kod: formData.strediska_kod || '',\n                      garant_uzivatel_id: formData.garant_uzivatel_id || '',\n                      //  Financovn - pesunuto z FZE 3 do FZE 1, lze ukldat do PO ablony\n                      zpusob_financovani: formData.zpusob_financovani || '',\n                      lp_kod: formData.lp_kod || [],\n                      cislo_smlouvy: formData.cislo_smlouvy || '',\n                      smlouva_poznamka: formData.smlouva_poznamka || '',\n                      individualni_schvaleni: formData.individualni_schvaleni || '',\n                      individualni_poznamka: formData.individualni_poznamka || '',\n                      pojistna_udalost_cislo: formData.pojistna_udalost_cislo || '',\n                      pojistna_udalost_poznamka: formData.pojistna_udalost_poznamka || ''\n                    };\n                  }\n\n                  // Detailn st (pouze od FZE 3++ a z viditelnch sekc)\n                  if (templateType === 'details' || templateType === 'mixed') {\n                    if (currentPhase < 2) {\n                      showToast?.('Nelze uloit Detaily ve FZI 1. Pouijte typ \"PO\".', 'warning');\n                      return;\n                    }\n\n                    templateData.orderDetails = {};\n\n                    // Naplnit pouze pole z viditelnch sekc\n                    Object.entries(fieldMap).forEach(([sectionKey, fields]) => {\n                      const isSectionVisible = sectionKey === 'polozky' ? visibility.detaily : visibility[sectionKey];\n\n                      if (isSectionVisible) {\n                        fields.forEach(field => {\n                          if (field !== 'polozky_objednavky' && formData[field] !== undefined) {\n                            templateData.orderDetails[field] = formData[field] || '';\n                          }\n                        });\n                      }\n                    });\n\n                    // Poloky objednvky (pokud je sekce detaily viditeln)\n                    if (visibility.detaily && Array.isArray(formData.polozky_objednavky) && formData.polozky_objednavky.length > 0) {\n                      templateData.polozky = formData.polozky_objednavky.map(item => ({\n                        popis: item.popis || '',\n                        cena_bez_dph: item.cena_bez_dph || '',\n                        sazba_dph: item.sazba_dph || 21,\n                        cena_s_dph: item.cena_s_dph || ''\n                      }));\n                    }\n                  }\n\n                  if (saveMode === 'new') {\n                    // Nov ablona\n                    await saveTemplateToStorage(templateName.trim(), templateData, templateType);\n                  } else if (saveMode === 'update') {\n                    // Aktualizace existujc ablony\n                    if (selectedTargetTemplate.__fromServer) {\n                      // Serverov ablona - aktualizace pes API\n                      try {\n                        const polozky_po = (templateType === 'po' || templateType === 'mixed') && templateData.poApproval\n                          ? JSON.stringify(templateData.poApproval)\n                          : '';\n                        const polozky_detail = (templateType === 'details' || templateType === 'mixed') && templateData.orderDetails\n                          ? JSON.stringify(templateData.orderDetails)\n                          : '';\n\n                        const result = await updateTemplate({\n                          username: user?.username || username,\n                          token,\n                          user_id: selectedTargetTemplate.user_id || 0,\n                          id: selectedTargetTemplate.id,\n                          nazev_sablony: selectedTargetTemplate.name,\n                          polozky_po,\n                          polozky_detail,\n                          typ: templateType,\n                          kategorie: \"OBJEDNAVKA25\"\n                        });\n\n                        if (result?.status === 'ok') {\n                          await fetchAndMergeTemplates();\n                          if (showToast) {\n                            showToast(`ablona \"${selectedTargetTemplate.name}\" byla aktualizovna`, { type: 'success' });\n                          }\n                        }\n                      } catch (error) {\n                        if (showToast) {\n                          showToast('Chyba pi aktualizaci ablony na serveru', { type: 'error' });\n                        }\n                      }\n                    } else {\n                      // Lokln ablona - aktualizace v localStorage\n                      setSavedTemplates(prev => prev.map(template =>\n                        template.ts === selectedTargetTemplate.ts\n                          ? { ...template, data: templateData, type: templateType }\n                          : template\n                      ));\n                      if (showToast) {\n                        showToast(`ablona \"${selectedTargetTemplate.name}\" byla aktualizovna`, { type: 'success' });\n                      }\n                    }\n                  } else if (saveMode === 'merge') {\n                    // Slouen s existujc ablonou\n                    const mergedData = { ...selectedTargetTemplate.data };\n                    if (templateData.poApproval) {\n                      mergedData.poApproval = { ...mergedData.poApproval, ...templateData.poApproval };\n                    }\n                    if (templateData.orderDetails) {\n                      mergedData.orderDetails = { ...mergedData.orderDetails, ...templateData.orderDetails };\n                      // Slouit poloky\n                      if (templateData.orderDetails.polozky?.length > 0) {\n                        mergedData.orderDetails.polozky = [\n                          ...(mergedData.orderDetails.polozky || []),\n                          ...templateData.orderDetails.polozky\n                        ];\n                      }\n                    }\n\n                    await saveTemplateToStorage(templateName.trim(), mergedData, 'mixed');\n                    if (showToast) {\n                      showToast(`ablona \"${templateName}\" byla vytvoena slouenm`, { type: 'success' });\n                    }\n                  }\n\n                  setShowTemplateSaveModal(false);\n                  setTemplateName('');\n                  setTemplateType('po');\n                  setSaveMode('new');\n                  setSelectedTargetTemplate(null);\n                }}\n                disabled={\n                  (saveMode === 'new' && !templateName.trim()) ||\n                  ((saveMode === 'update' || saveMode === 'merge') && !selectedTargetTemplate) ||\n                  (saveMode === 'merge' && !templateName.trim())\n                }\n              >\n                {saveMode === 'new' ? ' Uloit' :\n                 saveMode === 'update' ? ' Aktualizovat' :\n                 ' Slouit'}\n              </TemplateActionButton>\n            </TemplateModalActions>\n          </TemplateModal>\n        </TemplateModalOverlay>,\n        document.body\n      )}\n\n      {/* Modal pro potvrzen mazn ablony */}\n      {showDeleteTemplateConfirm && ReactDOM.createPortal(\n        <DeleteConfirmOverlay onClick={(e) => { if (e.target === e.currentTarget) cancelDeleteSavedTemplate(); }}>\n          <DeleteConfirmModal onClick={(e) => e.stopPropagation()}>\n            <DeleteConfirmTitle>\n              Potvrdit smazn ablony\n            </DeleteConfirmTitle>\n            <DeleteConfirmMessage>\n              Opravdu chcete smazat ablonu <strong>\"{templatePendingDelete?.name}\"</strong>?\n              <br /><br />\n              Tato akce je nevratn.\n            </DeleteConfirmMessage>\n            <DeleteConfirmActions>\n              <DeleteConfirmButton onClick={cancelDeleteSavedTemplate}>\n                Zruit\n              </DeleteConfirmButton>\n              <DeleteConfirmButton variant=\"danger\" onClick={confirmDeleteSavedTemplate}>\n                Smazat\n              </DeleteConfirmButton>\n            </DeleteConfirmActions>\n          </DeleteConfirmModal>\n        </DeleteConfirmOverlay>,\n        document.body\n      )}\n\n      {/* Template Preview Modal */}\n      {previewModalData && ReactDOM.createPortal(\n        <PreviewModal onClick={() => setPreviewModalData(null)}>\n          <PreviewContent onClick={e => e.stopPropagation()}>\n            <PreviewHeader>\n              <PreviewTitle>\n                <Eye size={20} />\n                Nhled ablony\n              </PreviewTitle>\n              <PreviewCloseButton onClick={() => setPreviewModalData(null)}>\n                <X size={18} />\n              </PreviewCloseButton>\n            </PreviewHeader>\n\n            {/* Template Info */}\n            <PreviewSection>\n              <PreviewSectionTitle>\n                <FileText size={16} />\n                Informace o ablon\n              </PreviewSectionTitle>\n              <PreviewField>\n                <PreviewFieldLabel>Nzev:</PreviewFieldLabel>\n                <PreviewFieldValue>{previewModalData.preview.templateInfo.name}</PreviewFieldValue>\n              </PreviewField>\n              <PreviewField>\n                <PreviewFieldLabel>Typ:</PreviewFieldLabel>\n                <PreviewFieldValue>\n                  <PreviewBadge type={previewModalData.preview.templateInfo.type}>\n                    {previewModalData.preview.templateInfo.type === 'po' ? 'Schvlen' :\n                     previewModalData.preview.templateInfo.type === 'details' ? 'Detaily' : 'Kombinovan'}\n                  </PreviewBadge>\n                </PreviewFieldValue>\n              </PreviewField>\n              <PreviewField>\n                <PreviewFieldLabel>Vytvoena:</PreviewFieldLabel>\n                <PreviewFieldValue>{previewModalData.preview.templateInfo.created}</PreviewFieldValue>\n              </PreviewField>\n              <PreviewField>\n                <PreviewFieldLabel>Dostupnost:</PreviewFieldLabel>\n                <PreviewFieldValue>\n                  {previewModalData.preview.templateInfo.isGlobal ? 'Globln kontakt' : 'Osobn kontakt'}\n                </PreviewFieldValue>\n              </PreviewField>\n            </PreviewSection>\n\n            {/* PO Approval Section */}\n            {previewModalData.preview.poApproval && (\n              <PreviewSection>\n                <PreviewSectionTitle>\n                  <CheckCircle size={16} />\n                  Schvlen nkupu\n                </PreviewSectionTitle>\n                {previewModalData.preview.poApproval.predmet && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Pedmt:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.poApproval.predmet}</PreviewFieldValue>\n                  </PreviewField>\n                )}\n                {previewModalData.preview.poApproval.maxCena && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Max. cena s DPH:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.poApproval.maxCena} K</PreviewFieldValue>\n                  </PreviewField>\n                )}\n                {previewModalData.preview.poApproval.popisPozadavku && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Popis poadavku:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.poApproval.popisPozadavku}</PreviewFieldValue>\n                  </PreviewField>\n                )}\n                {previewModalData.preview.poApproval.strediska.length > 0 && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Stediska:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.poApproval.strediska.length} vybrno</PreviewFieldValue>\n                  </PreviewField>\n                )}\n              </PreviewSection>\n            )}\n\n            {/* Order Details Section */}\n            {previewModalData.preview.orderDetails && (\n              <PreviewSection>\n                <PreviewSectionTitle>\n                  <Package size={16} />\n                  Detaily objednvky\n                </PreviewSectionTitle>\n                {previewModalData.preview.orderDetails.dodavatelNazev && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Dodavatel:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.orderDetails.dodavatelNazev}</PreviewFieldValue>\n                  </PreviewField>\n                )}\n                {previewModalData.preview.orderDetails.dodavatelIco && (\n                  <PreviewField>\n                    <PreviewFieldLabel>IO:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.orderDetails.dodavatelIco}</PreviewFieldValue>\n                  </PreviewField>\n                )}\n                {previewModalData.preview.orderDetails.zpusobFinancovani && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Financovn:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.orderDetails.zpusobFinancovani}</PreviewFieldValue>\n                  </PreviewField>\n                )}\n                {previewModalData.preview.orderDetails.datumDodani && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Datum dodn:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.orderDetails.datumDodani}</PreviewFieldValue>\n                  </PreviewField>\n                )}\n                {previewModalData.preview.orderDetails.poznamka && (\n                  <PreviewField>\n                    <PreviewFieldLabel>Poznmka:</PreviewFieldLabel>\n                    <PreviewFieldValue>{previewModalData.preview.orderDetails.poznamka}</PreviewFieldValue>\n                  </PreviewField>\n                )}\n              </PreviewSection>\n            )}\n\n            {/* Items Section */}\n            {previewModalData.preview.items.length > 0 && (\n              <PreviewSection>\n                <PreviewSectionTitle>\n                  <ShoppingCart size={16} />\n                  Poloky ({previewModalData.preview.items.length})\n                </PreviewSectionTitle>\n                <PreviewItemsList>\n                  {previewModalData.preview.items.slice(0, 5).map((item, index) => (\n                    <PreviewItem key={index}>\n                      <PreviewItemTitle>\n                        {item.index}. {item.popis || 'Bez popisu'}\n                      </PreviewItemTitle>\n                      <PreviewItemDetails>\n                        <span>{item.pocet} {item.cenaJednotka} K/{item.jednotka || 'ks'}</span>\n                        <strong>{item.cenaTotal.toLocaleString('cs-CZ')} K</strong>\n                      </PreviewItemDetails>\n                    </PreviewItem>\n                  ))}\n                  {previewModalData.preview.items.length > 5 && (\n                    <PreviewEmptyState>\n                      ... a dalch {previewModalData.preview.items.length - 5} poloek\n                    </PreviewEmptyState>\n                  )}\n                  {previewModalData.preview.items.length > 0 && (\n                    <PreviewField style={{ marginTop: '0.75rem', paddingTop: '0.75rem', borderTop: '2px solid #f3f4f6' }}>\n                      <PreviewFieldLabel>Celkov cena:</PreviewFieldLabel>\n                      <PreviewFieldValue style={{ fontWeight: 'bold', color: '#059669' }}>\n                        {previewModalData.preview.items.reduce((sum, item) => sum + item.cenaTotal, 0).toLocaleString('cs-CZ')} K\n                      </PreviewFieldValue>\n                    </PreviewField>\n                  )}\n                </PreviewItemsList>\n              </PreviewSection>\n            )}\n\n            {/* Empty State */}\n            {!previewModalData.preview.poApproval && !previewModalData.preview.orderDetails && previewModalData.preview.items.length === 0 && (\n              <PreviewEmptyState>\n                Tato ablona neobsahuje dn data\n              </PreviewEmptyState>\n            )}\n          </PreviewContent>\n        </PreviewModal>,\n        document.body\n      )}\n\n      {/* Cancel Confirm Modal - GRADIENT-MODERN ORANGE style */}\n      <ConfirmDialog\n        isOpen={showCancelConfirmModal}\n        onClose={handleCancelCancel}\n        onConfirm={handleCancelConfirm}\n        title=\"Zavt formul\"\n        icon={faExclamationTriangle}\n        variant=\"warning\"\n        confirmText=\"Ano, zavt\"\n        cancelText=\"Ne, zstat\"\n      >\n        {cancelWarningMessage || 'Koncept bude zruen a neuloen zmny nebudou uloeny.'}\n      </ConfirmDialog>\n\n    {/*  Confirm Dialog pro smazn plohy - GRADIENT-MODERN RED */}\n    <ConfirmDialog\n      isOpen={showDeleteAttachmentDialog}\n      onClose={handleCancelDeleteAttachment}\n      onConfirm={handleConfirmDeleteAttachment}\n      title=\"Smazat plohu\"\n      icon={faTrash}\n      variant=\"danger\"\n      confirmText=\"Ano, smazat\"\n      cancelText=\"Zruit\"\n    >\n      <p>Opravdu chcete smazat <strong>\"{attachmentToDelete?.attachment?.name || 'tento soubor'}\"</strong>?</p>\n      {attachmentToDelete?.isFromServer && (\n        <p style={{ \n          background: 'linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%)', \n          padding: '0.75rem', \n          borderRadius: '6px', \n          border: '1px solid rgba(239, 68, 68, 0.2)',\n          color: '#991b1b',\n          fontSize: '0.9rem',\n          margin: '0.75rem 0' \n        }}>\n          <strong> Pozor:</strong> Po smazn ji nebude mon soubor obnovit.\n        </p>\n      )}\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro smazn VECH ploh - GRADIENT-MODERN RED */}\n    <ConfirmDialog\n      isOpen={showDeleteAllAttachmentsDialog}\n      onClose={handleCancelDeleteAllAttachments}\n      onConfirm={handleConfirmDeleteAllAttachments}\n      title=\"Smazat vechny plohy\"\n      icon={faTrash}\n      variant=\"danger\"\n      confirmText=\"Ano, smazat ve\"\n      cancelText=\"Zruit\"\n    >\n      <p>Opravdu chcete smazat <strong>vechny plohy ({attachments.length} soubor)</strong>?</p>\n      <p style={{ \n        background: 'linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%)', \n        padding: '0.75rem', \n        borderRadius: '6px', \n        border: '1px solid rgba(239, 68, 68, 0.2)',\n        color: '#991b1b',\n        fontSize: '0.9rem',\n        margin: '0.75rem 0' \n      }}>\n        <strong> Pozor:</strong> Tato akce odstran vechny nahran soubory. Operaci nelze vrtit zpt.\n      </p>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro smazn faktury - GRADIENT-MODERN RED */}\n    <ConfirmDialog\n      isOpen={deleteFacturaDialog.isOpen}\n      onClose={() => setDeleteFacturaDialog({ isOpen: false, fakturaId: null, fakturaNazev: '', pocetPriloh: 0 })}\n      onConfirm={confirmDeleteFaktura}\n      title=\"Smazat fakturu\"\n      icon={faTrash}\n      variant=\"danger\"\n      confirmText=\"Smazat\"\n      cancelText=\"Zruit\"\n    >\n      <p>Opravdu chcete smazat fakturu <strong>\"{deleteFacturaDialog.fakturaNazev}\"</strong>?</p>\n      {deleteFacturaDialog.pocetPriloh > 0 && (\n        <p style={{ background: '#fee2e2', padding: '0.75rem', borderRadius: '6px', border: '1px solid #ef4444', margin: '0.75rem 0' }}>\n          <strong> POZOR:</strong> Faktura m <strong>{deleteFacturaDialog.pocetPriloh} plohu/ploh</strong>, kter budou tak smazny!\n        </p>\n      )}\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro odemen FZE 1 sekc - GRADIENT-MODERN RED */}\n    <ConfirmDialog\n      isOpen={showUnlockPhase1Confirm}\n      onClose={() => setShowUnlockPhase1Confirm(false)}\n      onConfirm={() => {\n        setShowUnlockPhase1Confirm(false);\n        handleResetToPhase1();\n      }}\n      title=\" Odemknout FZI 2 (Info o objednateli)\"\n      icon={faExclamationTriangle}\n      variant=\"danger\"\n      confirmText=\"ANO, ODEMKNOUT A SMAZAT\"\n      cancelText=\"Zruit\"\n    >\n      <p style={{ background: '#fee2e2', padding: '0.75rem', borderRadius: '6px', border: '1px solid #ef4444', margin: '0.75rem 0' }}>\n        <strong> VAROVN:</strong> Odemen FZE 2 vymae <strong>vechna data vych fz (FZE 3-10)</strong>!\n      </p>\n      <p>Workflow se resetuje na stav <strong>ODESLNA KE SCHVLEN</strong>.</p>\n      <p><strong>Opravdu chcete pokraovat?</strong></p>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro odemen zamtnut objednvky */}\n    <ConfirmDialog\n      isOpen={showUnlockPhase2Confirm}\n      onClose={() => setShowUnlockPhase2Confirm(false)}\n      onConfirm={() => {\n        setShowUnlockPhase2Confirm(false);\n        handleResetToPhase3Sections();\n      }}\n      title=\"Odemknout zamtnutou objednvku\"\n      icon={faExclamationTriangle}\n      variant=\"danger\"\n      confirmText=\"Ano, odemknout\"\n      cancelText=\"Zruit\"\n    >\n      <p>Opravdu chcete odemknout zamtnutou objednvku?</p>\n      <p style={{ marginTop: '0.5rem', color: '#dc2626' }}>\n        <strong> UPOZORNN:</strong> Objednvka bude odemena a zpstupnna pro dal prbh workflow.\n      </p>\n      <p style={{ marginTop: '0.5rem' }}>\n        Budete moci provst potebn pravy a objednvku znovu odeslat ke schvlen.\n      </p>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro odemen FZE 3 sekce */}\n    <ConfirmDialog\n      isOpen={showUnlockPhase3Confirm}\n      onClose={() => setShowUnlockPhase3Confirm(false)}\n      onConfirm={() => {\n        setShowUnlockPhase3Confirm(false);\n        handleResetToPhase3Workflow(); //  Reset workflow + vymazn dat + uloen do DB\n      }}\n      title=\" Odemknout FZE 3\"\n      icon={faExclamationTriangle}\n      variant=\"danger\"\n      confirmText=\"ANO, ODEMKNOUT A SMAZAT\"\n      cancelText=\"Zruit\"\n    >\n      <div style={{\n        display: 'flex',\n        gap: '12px',\n        padding: '12px',\n        backgroundColor: 'rgba(239, 68, 68, 0.1)',\n        border: '1px solid rgba(239, 68, 68, 0.3)',\n        borderRadius: '6px',\n        marginBottom: '1rem'\n      }}>\n        <FontAwesomeIcon icon={faExclamationTriangle} style={{ color: '#ef4444', fontSize: '20px', marginTop: '2px' }} />\n        <div>\n          <strong>Varovn:</strong> Odemen FZE 3 vymae vechna data vych fz (FZE 4-10)!\n        </div>\n      </div>\n      <p>\n        Workflow se resetuje na stav <strong>ODESLNA</strong>.\n      </p>\n      <p style={{ marginTop: '0.5rem' }}>\n        Opravdu chcete pokraovat?\n      </p>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro odemen sekce Registr smluv */}\n    <ConfirmDialog\n      isOpen={showUnlockRegistrConfirm}\n      onClose={() => setShowUnlockRegistrConfirm(false)}\n      onConfirm={() => {\n        setShowUnlockRegistrConfirm(false);\n        workflowManager.unlockSection('registr_vyplneni'); //  Odemknout sekci vyplnn registru (FZE 5)\n\n        //  Nastavit workflow na FZI 5 - UVEREJNIT\n        const currentStates = Array.isArray(formData.stav_workflow_kod)\n          ? formData.stav_workflow_kod\n          : (formData.stav_workflow_kod ? [formData.stav_workflow_kod] : []);\n\n        // Odebrat UVEREJNENA (pokud existuje) a pidat UVEREJNIT\n        const updatedStates = currentStates.filter(s => s !== 'UVEREJNENA');\n        if (!updatedStates.includes('UVEREJNIT')) {\n          updatedStates.push('UVEREJNIT');\n        }\n\n        // Ujistit se, e jsou tam zkladn stavy pro FZI 5\n        if (!updatedStates.includes('ODESLANA')) updatedStates.push('ODESLANA');\n        if (!updatedStates.includes('POTVRZENA')) updatedStates.push('POTVRZENA');\n\n        setFormData(prev => ({\n          ...prev,\n          stav_workflow_kod: updatedStates\n        }));\n\n        addDebugLog('info', 'UNLOCK', 'registr-vyplneni', 'Odemena sekce Registr smluv - nastaveno UVEREJNIT (FZE 5)');\n\n        // Okamit uloen\n        setTimeout(() => {\n          triggerAutosave(true);\n        }, 100);\n      }}\n      title=\"Odemknout sekci Registr smluv\"\n      icon={faExclamationTriangle}\n      variant=\"danger\"\n      confirmText=\"Odemknout\"\n      cancelText=\"Zruit\"\n    >\n      <p>\n        Opravdu chcete odemknout sekci <strong>Registr smluv</strong> pro editaci?\n      </p>\n      <p style={{ marginTop: '0.5rem' }}>\n        Workflow se nastav na FZI 5 se stavem <strong>UVEREJNIT</strong>.\n      </p>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro odemen sekce Potvrzen od dodavatele */}\n    <ConfirmDialog\n      isOpen={showUnlockPotvrzeniConfirm}\n      title=\"Odemknout sekci Potvrzen od dodavatele\"\n      confirmText=\"Ano, odemknout\"\n      cancelText=\"Zruit\"\n      variant=\"warning\"\n      icon={faExclamationTriangle}\n      onConfirm={() => {\n        setShowUnlockPotvrzeniConfirm(false);\n        workflowManager.unlockSection('potvrzeni');\n        workflowManager.unlockSection('registr'); //  Tak odemknout sekci Registr smluv\n\n        //  Vrtit workflow na ODESLANA (FZE 4)\n        const { updatedFormData } = workflowManager.unlockPhase4();\n        setFormData(updatedFormData);\n\n        resetHigherPhaseCheckboxes('potvrzeni'); // Reset vych checkbox\n\n        // Okamit uloen\n        setTimeout(() => {\n          triggerAutosave(true);\n        }, 100);\n      }}\n      onClose={() => setShowUnlockPotvrzeniConfirm(false)}\n    >\n      <p>Opravdu chcete odemknout sekci <strong>Potvrzen od dodavatele</strong> pro editaci?</p>\n      <p style={{ marginTop: '0.5rem' }}>\n        Zrove bude odemena i sekce <strong>Registr smluv</strong> a workflow se vrt na stav <strong>ODESLNA (FZE 4)</strong>.\n      </p>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro zruen zveejnn */}\n    <ConfirmDialog\n      isOpen={showCancelPublishConfirm}\n      title=\"Zruit zveejnn v registru smluv\"\n      confirmText=\"Ano, odkrtnout\"\n      cancelText=\"Ne, ponechat zakrtnut\"\n      variant=\"danger\"\n      icon={faExclamationTriangle}\n      onConfirm={() => {\n        setShowCancelPublishConfirm(false);\n        handleInputChange('ma_byt_zverejnena', false);\n        handleInputChange('dt_zverejneni', '');\n        handleInputChange('registr_iddt', '');\n        handleInputChange('zverejnil_id', null);\n        addDebugLog('info', 'REGISTR', 'zrusit-zverejneni', 'Zruena povinnost zveejnn');\n      }}\n      onClose={() => setShowCancelPublishConfirm(false)}\n    >\n      <div>\n        <p style={{ marginBottom: '1rem' }}>\n          Celkov cena objednvky je <strong>{celkovaCenaBezDPH.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K bez DPH</strong>, co je nad limitem 50 000 K.\n        </p>\n        <p style={{\n          fontSize: '0.95rem',\n          color: '#dc2626',\n          fontWeight: '600',\n          marginBottom: '0.75rem',\n          padding: '0.75rem',\n          backgroundColor: '#fee2e2',\n          borderRadius: '6px',\n          border: '1px solid #fca5a5'\n        }}>\n           Podle zkona mus bt objednvka zveejnna v registru smluv.\n        </p>\n        <p style={{\n          fontSize: '0.9rem',\n          color: '#6b7280',\n          marginBottom: '0.5rem'\n        }}>\n          Opravdu chcete odkrtnout checkbox? Tato akce vymae vyplnn daje:\n        </p>\n        <ul style={{\n          fontSize: '0.9rem',\n          color: '#374151',\n          paddingLeft: '1.5rem',\n          margin: 0\n        }}>\n          <li>Datum zveejnn</li>\n          <li>Identifiktor</li>\n          <li>Zveejnil (uivatel)</li>\n        </ul>\n      </div>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro odemen sekce Fakturace */}\n    <ConfirmDialog\n      isOpen={showUnlockFakturaceConfirm}\n      title=\"Odemknout sekci Fakturace\"\n      confirmText=\"Odemknout\"\n      variant=\"warning\"\n      onConfirm={() => {\n        setShowUnlockFakturaceConfirm(false);\n        workflowManager.unlockSection('fakturace');\n\n        //  Odebrat FAKTURACE + VE CO NSLEDUJE  nvrat na FZI 6\n        const currentStates = Array.isArray(formData.stav_workflow_kod)\n          ? formData.stav_workflow_kod\n          : (formData.stav_workflow_kod ? [formData.stav_workflow_kod] : []);\n\n        // Odebrat FAKTURACE a vechny vy stavy\n        const updatedStates = currentStates.filter(s =>\n          !['FAKTURACE', 'VECNA_SPRAVNOST', 'ZKONTROLOVANA', 'DOKONCENA'].includes(s)\n        );\n\n        setFormData(prev => ({\n          ...prev,\n          stav_workflow_kod: updatedStates\n        }));\n\n        addDebugLog('info', 'UNLOCK', 'fakturace', 'Odemena sekce Fakturace - odebrny stavy FAKTURACE, KONTROLA, ZKONTROLOVANA, DOKONCENA  FZE 6/8');\n\n        //  Reset vych checkbox\n        resetHigherPhaseCheckboxes('fakturace');\n\n        // Okamit uloen\n        setTimeout(() => {\n          triggerAutosave(true);\n        }, 100);\n      }}\n      onClose={() => setShowUnlockFakturaceConfirm(false)}\n    >\n      <p>Opravdu chcete odemknout sekci <strong>Fakturace</strong> pro editaci?</p>\n      <p style={{ marginTop: '0.5rem', color: '#dc2626' }}>\n        Budou odebrny stavy <strong>FAKTURACE, VECNA_SPRAVNOST, ZKONTROLOVANA, DOKONCENA</strong> a workflow se vrt na <strong>FZI 6/8</strong>.\n      </p>\n    </ConfirmDialog>\n\n    {/*  DISABLED: Confirm Dialog pro odemen sekce Vcn sprvnost - ji nen poteba */}\n\n    {/*  Confirm Dialog pro odemen Dokonen objednvky (pro ORDER_MANAGE) */}\n    <ConfirmDialog\n      isOpen={showUnlockDokonceniConfirm}\n      title=\"Odemknout dokonenou objednvku\"\n      confirmText=\"Ano, odemknout\"\n      cancelText=\"Zruit\"\n      variant=\"warning\"\n      icon={faExclamationTriangle}\n      onConfirm={() => {\n        setShowUnlockDokonceniConfirm(false);\n\n        addDebugLog('info', 'UNLOCK', 'dokonceni', ' Dokonen objednvka odemena');\n\n\n        //  Upravit workflow: odebrat DOKONCENA, zachovat ve ostatn\n        const currentWorkflow = formData.stav_workflow_kod || '';\n        let workflowArray;\n        \n        if (Array.isArray(currentWorkflow)) {\n          workflowArray = [...currentWorkflow];\n        } else {\n          workflowArray = String(currentWorkflow).split(',').map(s => s.trim()).filter(s => s);\n        }\n        \n        // Odebrat pouze DOKONCENA\n        workflowArray = workflowArray.filter(s => s !== 'DOKONCENA');\n        \n        // Zajistit ZKONTROLOVANA\n        if (!workflowArray.includes('ZKONTROLOVANA')) {\n          workflowArray.push('ZKONTROLOVANA');\n        }\n\n\n        //  Nastavit nov state\n        setFormData(prev => ({\n          ...prev,\n          potvrzeni_dokonceni_objednavky: 0,\n          vecna_spravnost_potvrzeno: 1,\n          stav_workflow_kod: workflowArray\n        }));\n\n        //  VEKER ODEMEN PES WORKFLOW MANAGER\n        workflowManager.unlockSection('dokonceni');\n        workflowForceRefresh(); // Force pepoet vech sekc a stav\n\n        addDebugLog('info', 'UNLOCK', 'completed', ` Objednvka odemena (workflow manager refresh)`);\n      }}\n      onClose={() => setShowUnlockDokonceniConfirm(false)}\n    >\n      <p>Opravdu chcete odemknout dokonenou objednvku?</p>\n      <p style={{ marginTop: '0.5rem', color: '#16a34a' }}>\n        <strong> UPOZORNN:</strong> Objednvka bude zpstupnna k pravm a opravm.\n      </p>\n    </ConfirmDialog>\n\n    {/*  Confirm Dialog pro odemknut stornovan objednvky */}\n    <ConfirmDialog\n      isOpen={showUnlockStornoConfirm}\n      title=\"Odemknout stornovanou objednvku\"\n      confirmText=\"Ano, odemknout\"\n      cancelText=\"Zruit\"\n      variant=\"danger\"\n      icon={faExclamationTriangle}\n      onConfirm={async () => {\n        setShowUnlockStornoConfirm(false);\n        \n        addDebugLog('info', 'UNLOCK', 'cancelled', ` Odemykm stornovanou objednvku ID: ${formData.id}`);\n        \n        // Odebrat ZRUSENA stav z workflow\n        const updatedWorkflow = (formData.stav_workflow_kod || '')\n          .split(',')\n          .filter(s => s.trim() !== 'ZRUSENA')\n          .join(',');\n        \n        // Vymazat storno data\n        const clearedData = {\n          ...formData,\n          stav_workflow_kod: updatedWorkflow,\n          storno_duvod: null,\n          storno_user_id: null,\n          dt_storno: null,\n          stav_stornovano: 0\n        };\n        \n        // Uloit do DB pes useWorkflowManager\n        await workflowManager.unlockSection('storno');\n        \n        // Force update form data\n        setFormData(clearedData);\n        workflowForceRefresh();\n        \n        addDebugLog('info', 'UNLOCK', 'cancelled', ` Stornovan objednvka odemena, workflow refresh dokonen`);\n      }}\n      onClose={() => setShowUnlockStornoConfirm(false)}\n    >\n      <p>Opravdu chcete odemknout stornovanou objednvku?</p>\n      <p style={{ marginTop: '0.5rem', color: '#16a34a' }}>\n        <strong> UPOZORNN:</strong> Objednvka bude odemena a zpstupnna pro dal prbh workflow.\n      </p>\n      <p style={{ marginTop: '0.5rem' }}>\n        Budete moci provst potebn pravy nebo opravy.\n      </p>\n    </ConfirmDialog>\n\n    {/*  Univerzln Confirm Dialog (pro Phase unlock handlery) */}\n    {confirmDialog.isOpen && (\n      <ConfirmDialog\n        isOpen={confirmDialog.isOpen}\n        title={confirmDialog.title}\n        message={confirmDialog.message}\n        confirmText=\"Ano, odemknout\"\n        cancelText=\"Zruit\"\n        variant=\"danger\"\n        icon={faExclamationTriangle}\n        onConfirm={() => {\n          if (confirmDialog.onConfirm) {\n            confirmDialog.onConfirm();\n          }\n          setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null });\n        }}\n        onClose={() => setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null })}\n      />\n    )}\n\n    {/*  Dialog pro pidn dodavatele do adrese */}\n    <SupplierAddDialog\n      isOpen={showSupplierAddDialog}\n      onClose={() => {\n        setShowSupplierAddDialog(false);\n        setExistingSupplierCheck(null);\n      }}\n      onSave={handleSaveSupplierToDirectory}\n      supplierData={{\n        dodavatel_nazev: formData.dodavatel_nazev,\n        dodavatel_adresa: formData.dodavatel_adresa,\n        dodavatel_ico: formData.dodavatel_ico,\n        dodavatel_dic: formData.dodavatel_dic,\n        dodavatel_zastoupeny: formData.dodavatel_zastoupeny,\n        dodavatel_kontakt_jmeno: formData.dodavatel_kontakt_jmeno,\n        dodavatel_kontakt_email: formData.dodavatel_kontakt_email,\n        dodavatel_kontakt_telefon: formData.dodavatel_kontakt_telefon\n      }}\n      existsInPersonal={existingSupplierCheck?.existsInPersonal || null}\n      existsInUsek={existingSupplierCheck?.existsInUsek || null}\n      existsInGlobal={existingSupplierCheck?.existsInGlobal || null}\n      userPermissions={{\n        canAddPersonal: hasPermission && (hasPermission('CONTACT_MANAGE') || hasPermission('CONTACT_EDIT')), // CONTACT_MANAGE nebo CONTACT_EDIT\n        canAddUsek: hasPermission && (hasPermission('CONTACT_MANAGE') || hasPermission('CONTACT_EDIT')), // CONTACT_MANAGE nebo CONTACT_EDIT pro sv seky\n        canAddGlobal: hasPermission && hasPermission('CONTACT_MANAGE') // Pouze CONTACT_MANAGE\n      }}\n    />\n\n    {/*  Modern Sponka helper - kontextov npovda pro formul objednvky */}\n    {hasPermission('HELPER_VIEW') && (\n      <ModernHelper\n        pageContext=\"orderDetail\"\n      />\n    )}\n\n    {/*  DOCX Generator Modal */}\n    {docxModalOpen && (\n      <DocxGeneratorModal\n        order={docxModalOrder}\n        isOpen={docxModalOpen}\n        onClose={handleDocxModalClose}\n      />\n    )}\n\n    {/*  Financial Control Confirmation Modal - Potvrzen dokonen objednvky */}\n    {showFinancialControlConfirmation && (\n      <FinancialControlConfirmationModal\n        order={formData}\n        onConfirm={handleConfirmCompletion}\n        onCancel={handleCancelCompletion}\n        generatedBy={{\n          fullName: userDetail ? `${userDetail.titul_pred || ''} ${userDetail.jmeno || ''} ${userDetail.prijmeni || ''} ${userDetail.titul_za || ''}`.trim() : username,\n          position: userDetail?.pozice_nazev || 'Uivatel'\n        }}\n        token={token}\n        username={username}\n      />\n    )}\n\n    {/*  Save Overlay - rozmae zbytek strnky pi ukldn (krom hlaviky s progress barem) */}\n    {(showSaveProgress || isSaving) && (\n      <SaveOverlay $visible={true} />\n    )}\n\n    </Container>\n  );\n\n  // Pokud je fullscreen, pout React Portal pro vykreslen mimo app strukturu\n  if (isFullscreen) {\n    return ReactDOM.createPortal(formContent, document.body);\n  }\n\n  // Normln render\n  return formContent;\n}\n\n// Obal OrderForm25 v React.memo() pro optimalizaci re-render\n// Zabrauje zbytenm re-renderm kdy se props nemn\nexport default React.memo(OrderForm25);\n\n// ========================================\n// NOV STABILN CUSTOM SELECT KOMPONENTY\n// ========================================\n\n// Nov styled komponenty pro stabiln custom select\nconst StableSelectWrapper = styled.div`\n  position: relative;\n  width: 100%;\n`;\n\nconst StableSelectButton = styled.button`\n  width: 100%;\n  min-height: 2.5rem;\n  padding: 0.75rem 3rem 0.75rem ${props => props.hasIcon ? '3rem' : '1rem'};\n  background: white;\n  border: 2px solid ${props => props.hasError ? '#dc2626' : props.isOpen ? '#3b82f6' : '#e5e7eb'};\n  border-radius: 8px;\n  font-size: 0.875rem;\n  text-align: left;\n  cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  font-family: inherit;\n  font-weight: ${props => props.disabled ? '400' : (props.hasValue ? '600' : '400')};\n  color: ${props => props.disabled ? '#9ca3af' : props.hasValue ? '#1f2937' : '#6b7280'};\n\n  &:hover:not(:disabled) {\n    border-color: ${props => props.hasError ? '#dc2626' : '#3b82f6'};\n  }\n\n  &:focus {\n    outline: none;\n    border-color: ${props => props.hasError ? '#dc2626' : '#3b82f6'};\n    box-shadow: 0 0 0 3px ${props => props.hasError ? 'rgba(220, 38, 38, 0.1)' : 'rgba(59, 130, 246, 0.1)'};\n  }\n\n  &:disabled {\n    background: #f9fafb;\n    cursor: not-allowed;\n  }\n\n  /* Chevron ikona */\n  &::after {\n    content: '';\n    position: absolute;\n    right: 12px;\n    top: 50%;\n    transform: translateY(-50%) rotate(${props => props.isOpen ? '180deg' : '0deg'});\n    width: 0;\n    height: 0;\n    border-left: 4px solid transparent;\n    border-right: 4px solid transparent;\n    border-top: 4px solid #6b7280;\n    transition: transform 0.2s ease;\n  }\n`;\n\nconst StableSelectDropdown = styled.div`\n  position: fixed;\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n  max-height: 300px;\n  overflow-y: auto;\n  z-index: 4000;\n  min-width: 200px;\n\n  /* Optimalizace pro plynul scrollovn */\n  scroll-behavior: smooth;\n  overscroll-behavior: contain;\n\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #f8f9fa;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #d1d5db;\n    border-radius: 4px;\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background: #9ca3af;\n  }\n`;\n\nconst StableSelectSearchBox = styled.div`\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  padding: 0.5rem;\n  border-bottom: 1px solid #f3f4f6;\n  background: #f8f9fa;\n`;\n\nconst StableSelectSearchInput = styled.input`\n  width: 100%;\n  padding: 0.5rem 0.75rem 0.5rem 2.5rem;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  font-size: 0.875rem;\n\n  &:focus {\n    outline: none;\n    border-color: #3b82f6;\n    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n  }\n`;\n\nconst StableSelectSearchIcon = styled.div`\n  position: absolute;\n  left: 1rem;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #9ca3af;\n  pointer-events: none;\n`;\n\nconst StableSelectOption = styled.div`\n  padding: ${props => props.level === 0 ? '0.75rem 1rem' : '0.5rem 1rem 0.5rem 2rem'};\n  cursor: ${props => props.isHeader ? 'default' : 'pointer'};\n  font-size: 0.875rem;\n  color: ${props => props.level === 0 ? '#111827' : '#4b5563'};\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  background: ${props =>\n    props.isHeader ? '#f9fafb' :\n    props.selected ? '#eff6ff' : 'white'\n  };\n  border-left: ${props => props.selected ? '3px solid #3b82f6' : '3px solid transparent'};\n  border-bottom: ${props => props.level === 0 ? '1px solid #e5e7eb' : 'none'};\n  font-weight: ${props => props.selected ? '600' : '400'} !important; /* Bold jen pro vybranou monost */\n  /* Focusable pro tab navigaci */\n  outline: none;\n\n  &:hover {\n    background: ${props =>\n      props.isHeader ? '#f3f4f6' :\n      props.selected ? '#dbeafe' : '#f8fafc'\n    };\n    font-weight: ${props => props.selected ? '600' : '400'} !important; /* Zstv stejn i pi hover */\n  }\n\n  &:focus {\n    background: #dbeafe;\n    box-shadow: inset 0 0 0 2px #3b82f6;\n  }\n\n  &:last-child {\n    border-bottom-left-radius: 8px;\n    border-bottom-right-radius: 8px;\n  }\n\n  input[type=\"checkbox\"] {\n    margin: 0;\n    cursor: pointer;\n  }\n\n  span {\n    padding-left: ${props => (props.level || 0) * 20}px;\n    font-weight: ${props => props.selected ? '600' : '400'} !important; /* Bold jen pro vybranou monost */\n  }\n`;\n\nconst StableSelectValue = styled.span`\n  flex: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n`;\n\n// Helper funkce pro normalizaci textu (odstrann diakritiky pro vyhledvn)\nconst normalizeSearchText = (text) => {\n  if (!text) return '';\n  return text\n    .toLowerCase()\n    .normalize('NFD')\n    .replace(/[\\u0300-\\u036f]/g, '');\n};\n\n// Nov stabiln CustomSelect s jednoduchm state managementem\nconst StableCustomSelect = React.memo(({\n  value,\n  onChange,\n  onBlur,\n  options = [],\n  placeholder = \"Vyberte...\",\n  disabled = false,\n  hasError = false,\n  required = false,\n  field,\n  loading = false,\n  loadingText = 'Natn...',\n  icon = null,\n  multiple = false,\n  isClearable = false,\n  getOptionLabel,\n  getOptionValue,\n  hasTriedToSubmit = false\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [internalScroll, setInternalScroll] = useState(0);\n\n  const wrapperRef = useRef(null);\n  const buttonRef = useRef(null);\n  const dropdownRef = useRef(null);\n  const searchInputRef = useRef(null);\n  const voiceInputFlagRef = useRef(false); // Flag pro hlasov vstup\n\n  // Zpracovn hodnot\n  const normalizedValue = multiple ? (Array.isArray(value) ? value : []) : value;\n\n  // Filtrovan monosti\n  const filteredOptions = useMemo(() => {\n    if (!searchTerm || loading) return options;\n\n    // Normalizace hledanho textu (bez diakritiky)\n    const normalizedSearch = normalizeSearchText(searchTerm);\n\n    return options.filter(option => {\n      let label;\n      if (getOptionLabel) {\n        label = getOptionLabel(option, field);\n      } else {\n        // Fallback pro rzn typy objekt\n        if (field === 'strediska' || field === 'strediska_kod') {\n          label = option.label || option.name || option.nazev_stavu || String(option);\n        } else if (field === 'lp_kod') {\n          label = option.cislo_lp ? `${option.cislo_lp} - ${option.nazev_uctu || ''}` : option.label || String(option);\n        } else {\n          label = option.label || option.nazev || option.name || String(option);\n        }\n      }\n\n      // Normalizace labelu (bez diakritiky) pro porovnn\n      const normalizedLabel = normalizeSearchText(label);\n      return normalizedLabel.includes(normalizedSearch);\n    });\n  }, [options, searchTerm, loading, getOptionLabel, field]);\n\n  // Display hodnota\n  const displayValue = useMemo(() => {\n    if (multiple) {\n      if (normalizedValue.length === 0) return placeholder;\n\n      const result = normalizedValue.map(val => {\n        const option = options.find(opt => {\n          const optVal = getOptionValue ? getOptionValue(opt, field) : (opt.id || opt.value || opt.kod_stavu || opt.kod || opt);\n          // OPRAVA: Porovnn i pro string vs number (nap. '26' vs 26)\n          return optVal == val;\n        });\n\n        if (option) {\n          // Pouij extern getOptionLabel funkci nebo fallback\n          if (getOptionLabel) {\n            return getOptionLabel(option, field);\n          }\n          // Fallback pro rzn typy objekt\n          if (field === 'strediska' || field === 'strediska_kod') {\n            return option.label || option.name || option.nazev_stavu || String(option);\n          }\n          if (field === 'lp_kod') {\n            // OPRAVA: Pouij label, kter u je sprvn naformtovan pi natn LP kd\n            return option.label || (option.cislo_lp ? `${option.cislo_lp} - ${option.nazev_uctu || ''}` : String(option));\n          }\n          return option.label || option.nazev || option.name || String(option);\n        }\n\n        return String(val);\n      }).join(', ');\n\n      return result;\n    } else {\n      if (!normalizedValue) return placeholder;\n      const option = options.find(opt => {\n        const optVal = getOptionValue ? getOptionValue(opt, field) : (opt.id || opt.value || opt.kod_stavu || opt.kod || opt);\n        // OPRAVA: Porovnn i pro string vs number (nap. '26' vs 26)\n        return optVal == normalizedValue; // Pouvme == msto === pro type coercion\n      });\n      if (option) {\n        if (getOptionLabel) {\n          return getOptionLabel(option, field);\n        }\n        return option.label || option.nazev || option.name || String(option);\n      }\n      // Pokud nen nalezen option a jde o prikazce nebo schvalovatel s hodnotou 0 nebo null, zobraz \"Neznm\"\n      if ((field === 'prikazce' || field === 'schvalovatel') && (normalizedValue === 0 || normalizedValue === null || normalizedValue === '0')) {\n        return 'Neznm';\n      }\n      return String(normalizedValue);\n    }\n  }, [normalizedValue, options, placeholder, multiple, getOptionLabel, getOptionValue, field]);\n\n  // Zaven pi kliknut mimo\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {\n        setIsOpen(false);\n        setSearchTerm('');\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n      return () => document.removeEventListener('mousedown', handleClickOutside);\n    }\n  }, [isOpen]);\n\n  // Auto-focus search pi oteven\n  useEffect(() => {\n    if (isOpen && searchInputRef.current && filteredOptions.length > 0) {\n      setTimeout(() => searchInputRef.current?.focus(), 100);\n    }\n  }, [isOpen, filteredOptions.length]);\n\n  // Detekce hlasovho vstupu (nastaveno v useGlobalVoiceRecognition.js)\n  useEffect(() => {\n    if (!wrapperRef.current) return;\n\n    const checkVoiceInputAttribute = () => {\n      const hasVoiceInput = wrapperRef.current?.hasAttribute('data-voice-input');\n      if (hasVoiceInput && !voiceInputFlagRef.current) {\n        voiceInputFlagRef.current = true;\n        // NEODSTRAUJ atribut hned - nech ho tam pro ppad dalch kontrol\n      }\n    };\n\n    // Kontroluj okamit\n    checkVoiceInputAttribute();\n\n    // A tak pi zmn searchTerm (voice input mn hodnotu)\n    if (searchTerm) {\n      checkVoiceInputAttribute();\n    }\n  }, [searchTerm, field]);\n\n  // Automatick vbr pi 1 vsledku po filtrovn (pouze pro hlasov ovldn)\n  useEffect(() => {\n    if (isOpen && searchTerm && filteredOptions.length === 1 && !multiple && voiceInputFlagRef.current) {\n      // Pokud je jen 1 vsledek po filtrovn A je to hlasov vstup  automaticky vyber po krtkm delay\n      const timer = setTimeout(() => {\n        const option = filteredOptions[0];\n        const optionValue = getOptionValue ? getOptionValue(option, field) : (option.id || option.value || option);\n\n        // Zkontroluj, jestli u nen vybran\n        if (normalizedValue !== optionValue) {\n          onChange(optionValue);\n          if (onBlur) onBlur(field, optionValue);\n          setIsOpen(false);\n          setSearchTerm('');\n          voiceInputFlagRef.current = false; // Reset flag\n          // Odstra atribut po auto-vbru\n          if (wrapperRef.current) {\n            wrapperRef.current.removeAttribute('data-voice-input');\n          }\n        }\n      }, 500); // 500ms delay pro jistotu, e uivatel u nepe\n\n      return () => clearTimeout(timer);\n    }\n  }, [isOpen, searchTerm, filteredOptions, multiple, getOptionValue, field, normalizedValue, onChange, onBlur]);\n\n  // Pozicovn dropdown\n  useEffect(() => {\n    if (isOpen && buttonRef.current && dropdownRef.current) {\n      const updatePosition = () => {\n        if (!buttonRef.current || !dropdownRef.current) return;\n        const buttonRect = buttonRef.current.getBoundingClientRect();\n        const dropdown = dropdownRef.current;\n\n        const dropdownMaxHeight = 300;\n        const footerHeight = 54; // Vka fixn patiky\n        const buffer = 20; // Extra buffer pro bezpenost\n        const spaceBelow = window.innerHeight - buttonRect.bottom - footerHeight - buffer;\n        const spaceAbove = buttonRect.top - buffer;\n        // Otevi nahoru pokud: nen dost msta dole NEBO je nahoe vrazn vce msta\n        const shouldOpenUpward = spaceBelow < 200 || (spaceBelow < dropdownMaxHeight && spaceAbove > spaceBelow + 50);\n\n        dropdown.style.left = buttonRect.left + 'px';\n        dropdown.style.width = buttonRect.width + 'px';\n        dropdown.style.maxHeight = dropdownMaxHeight + 'px';\n\n        if (shouldOpenUpward) {\n          // Otevt nahoru\n          dropdown.style.bottom = (window.innerHeight - buttonRect.top + 2) + 'px';\n          dropdown.style.top = 'auto';\n        } else {\n          // Otevt dol (standardn chovn)\n          dropdown.style.top = (buttonRect.bottom + 2) + 'px';\n          dropdown.style.bottom = 'auto';\n        }\n      };\n\n      updatePosition();\n\n      const handleScroll = (event) => {\n        // Neaktualizovat pi scrollu uvnit dropdown\n        if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\n          updatePosition();\n        }\n      };\n\n      // Pouvat capture: true pro zachycen vech scroll event\n      window.addEventListener('scroll', handleScroll, { passive: true, capture: true });\n      window.addEventListener('resize', updatePosition, { passive: true });\n\n      return () => {\n        window.removeEventListener('scroll', handleScroll, { capture: true });\n        window.removeEventListener('resize', updatePosition);\n      };\n    }\n  }, [isOpen]);\n\n  // Zachovn scroll pozice\n  useEffect(() => {\n    if (dropdownRef.current && internalScroll > 0) {\n      dropdownRef.current.scrollTop = internalScroll;\n    }\n  }, [filteredOptions, internalScroll]);\n\n  const handleToggle = () => {\n    if (disabled) return;\n\n    const newState = !isOpen;\n    setIsOpen(newState);\n\n    if (isOpen) {\n      setSearchTerm('');\n    }\n  };\n\n  const handleOptionClick = (option) => {\n    // Zachovat scroll pozici\n    if (dropdownRef.current) {\n      setInternalScroll(dropdownRef.current.scrollTop);\n    }\n\n    const optionValue = getOptionValue ? getOptionValue(option, field) : (option.id || option.value || option);\n\n    if (multiple) {\n      const currentValues = Array.isArray(normalizedValue) ? normalizedValue : [];\n      const newValues = currentValues.includes(optionValue)\n        ? currentValues.filter(v => v !== optionValue)\n        : [...currentValues, optionValue];\n\n      // Pro multiselect poli pole pmo\n      onChange(newValues);\n      if (onBlur) onBlur(field, newValues);\n    } else {\n      // Pro single select poli hodnotu pmo\n      onChange(optionValue);\n      if (onBlur) onBlur(field, optionValue);\n      setIsOpen(false);\n      setSearchTerm('');\n      // Reset voice input flag pi runm vbru\n      voiceInputFlagRef.current = false;\n      if (wrapperRef.current) {\n        wrapperRef.current.removeAttribute('data-voice-input');\n      }\n    }\n  };\n\n  const isSelected = (option) => {\n    const optionValue = getOptionValue ? getOptionValue(option, field) : (option.id || option.value || option);\n    return multiple\n      ? normalizedValue.includes(optionValue)\n      : normalizedValue === optionValue;\n  };\n\n  // Automatick detekce chyby pro povinn pole (stejn jako v CustomSelect.js)\n  const hasValue = multiple\n    ? (Array.isArray(normalizedValue) && normalizedValue.length > 0)\n    : !!normalizedValue;\n  const shouldShowError = hasError || (required && !hasValue && !loading && !disabled && hasTriedToSubmit);\n\n  return (\n    <StableSelectWrapper ref={wrapperRef} data-stable-select data-field={field}>\n      <StableSelectButton\n        ref={buttonRef}\n        type=\"button\"\n        onClick={handleToggle}\n        disabled={disabled}\n        hasError={shouldShowError}\n        isOpen={isOpen}\n        hasValue={hasValue}\n        hasIcon={!!icon}\n        data-field={field}\n      >\n        {icon && (\n          <span style={{\n            position: 'absolute',\n            left: '12px',\n            color: '#9ca3af',\n            width: '16px',\n            height: '16px',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center'\n          }}>\n            {React.cloneElement(icon, { size: 16 })}\n          </span>\n        )}\n        <StableSelectValue title={displayValue}>\n          {(() => {\n            //  Check if selected option is majetek for druh_objednavky_kod\n            if (field === 'druh_objednavky_kod' && normalizedValue) {\n              const selectedOption = options.find(opt => {\n                const optVal = getOptionValue ? getOptionValue(opt, field) : (opt.id || opt.value || opt.kod_stavu || opt.kod || opt);\n                return optVal == normalizedValue;\n              });\n              if (selectedOption && (selectedOption.atribut_objektu === 1 || selectedOption.atribut_objektu === '1')) {\n                const cleanLabel = displayValue.replace('   (majetek)', '');\n                return (\n                  <>\n                    <span>{cleanLabel}</span>\n                    <span style={{\n                      marginLeft: '8px',\n                      fontSize: '0.75rem',\n                      color: '#dc2626',\n                      fontWeight: '500',\n                      padding: '2px 6px',\n                      backgroundColor: '#fee2e2',\n                      borderRadius: '4px',\n                      border: '1px solid #fca5a5'\n                    }}>\n                      (majetek)\n                    </span>\n                  </>\n                );\n              }\n            }\n            return displayValue;\n          })()}\n        </StableSelectValue>\n        {isClearable && !disabled && hasValue && (\n          <span\n            role=\"button\"\n            tabIndex={0}\n            onClick={(e) => {\n              e.stopPropagation();\n              const clearedValue = multiple ? [] : '';\n              onChange(clearedValue);\n            }}\n            onKeyDown={(e) => {\n              if (e.key === 'Enter' || e.key === ' ') {\n                e.preventDefault();\n                e.stopPropagation();\n                const clearedValue = multiple ? [] : '';\n                onChange(clearedValue);\n              }\n            }}\n            title=\"Smazat hodnotu\"\n            style={{\n              position: 'absolute',\n              right: '32px',\n              top: '50%',\n              transform: 'translateY(-50%)',\n              background: 'none',\n              border: 'none',\n              padding: '4px',\n              cursor: 'pointer',\n              color: '#6b7280',\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              width: '20px',\n              height: '20px',\n              borderRadius: '4px',\n              transition: 'all 0.2s ease',\n              zIndex: 2\n            }}\n            onMouseEnter={(e) => {\n              e.currentTarget.style.background = '#f3f4f6';\n              e.currentTarget.style.color = '#374151';\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.background = 'none';\n              e.currentTarget.style.color = '#6b7280';\n            }}\n          >\n            <X size={14} />\n          </span>\n        )}\n      </StableSelectButton>\n\n      {isOpen && !disabled && (\n        <StableSelectDropdown ref={dropdownRef}>\n          <StableSelectSearchBox>\n            <StableSelectSearchIcon>\n              <Search size={16} />\n            </StableSelectSearchIcon>\n            <StableSelectSearchInput\n              ref={searchInputRef}\n              type=\"text\"\n              placeholder=\"Vyhledat...\"\n              value={searchTerm}\n              onChange={(e) => {\n                // Pi runm psan resetuj voice flag\n                if (e.nativeEvent.inputType && e.nativeEvent.inputType.startsWith('insert')) {\n                  voiceInputFlagRef.current = false;\n                }\n                setSearchTerm(e.target.value);\n              }}\n              onClick={(e) => e.stopPropagation()}\n              onKeyDown={(e) => {\n                if (e.key === 'ArrowDown') {\n                  // ipka dol - pejdi na prvn option\n                  e.preventDefault();\n                  if (filteredOptions.length > 0) {\n                    const firstOption = dropdownRef.current?.querySelector('[role=\"option\"]:not([tabindex=\"-1\"])');\n                    if (firstOption) {\n                      firstOption.focus();\n                    }\n                  }\n                } else if (e.key === 'ArrowUp') {\n                  // ipka nahoru - pejdi na posledn option\n                  e.preventDefault();\n                  if (filteredOptions.length > 0) {\n                    const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]:not([tabindex=\"-1\"])') || []);\n                    const lastOption = options[options.length - 1];\n                    if (lastOption) {\n                      lastOption.focus();\n                    }\n                  }\n                } else if (e.key === 'Tab') {\n                  // Pokud je dropdown oteven, pejdi na prvn option msto zaven\n                  if (filteredOptions.length > 0) {\n                    e.preventDefault();\n                    const firstOption = dropdownRef.current?.querySelector('[role=\"option\"], [class*=\"SelectOption\"]');\n                    if (firstOption) {\n                      firstOption.focus();\n                    }\n                  } else {\n                    // Pokud nejsou dn options, zavi dropdown a pokrauj na dal prvek\n                    setIsOpen(false);\n                  }\n                } else if (e.key === 'Escape') {\n                  e.preventDefault();\n                  setIsOpen(false);\n                  // Vra focus na select button\n                  if (buttonRef.current) {\n                    buttonRef.current.focus();\n                  }\n                } else if (e.key === 'Enter') {\n                  e.preventDefault();\n                  e.stopPropagation();\n                }\n              }}\n            />\n          </StableSelectSearchBox>\n\n          {loading ? (\n            <StableSelectOption>{loadingText}</StableSelectOption>\n          ) : filteredOptions.length > 0 ? (\n            filteredOptions.map((option, index) => {\n              const optionValue = getOptionValue ? getOptionValue(option, field) : (option.id || option.value || option);\n              let optionLabel;\n\n              if (getOptionLabel) {\n                optionLabel = getOptionLabel(option, field);\n              } else {\n                // Fallback pro rzn typy objekt\n                if (field === 'strediska' || field === 'strediska_kod') {\n                  optionLabel = option.label || option.name || option.nazev_stavu || String(option);\n                } else if (field === 'lp_kod') {\n                  optionLabel = option.cislo_lp ? `${option.cislo_lp} - ${option.nazev_uctu || ''}` : option.label || String(option);\n                } else {\n                  optionLabel = option.label || option.nazev || option.name || String(option);\n                }\n              }\n\n              const selected = isSelected(option);\n              const level = option.level || 0;\n              const isHeader = option.isHeader || (level === 0 && !option.value && !option.id);\n              \n              //  Check if this is druh_objednavky with majetek flag\n              const isMajetekOption = field === 'druh_objednavky_kod' && (option.atribut_objektu === 1 || option.atribut_objektu === '1');\n\n              return (\n                <StableSelectOption\n                  key={optionValue || index}\n                  selected={selected}\n                  level={level}\n                  isHeader={isHeader}\n                  tabIndex={isHeader ? -1 : 0}\n                  role=\"option\"\n                  aria-selected={selected}\n                  onClick={(e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    // Neumoni kliknout na header\n                    if (!isHeader) {\n                      handleOptionClick(option);\n                    }\n                  }}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter' || e.key === ' ') {\n                      e.preventDefault();\n                      if (!isHeader) {\n                        handleOptionClick(option);\n                      }\n                    } else if (e.key === 'ArrowDown') {\n                      // ipka dol - pejdi na dal option\n                      e.preventDefault();\n                      const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]:not([tabindex=\"-1\"])') || []);\n                      const currentIdx = options.indexOf(e.target);\n                      const nextIdx = currentIdx + 1;\n                      if (nextIdx < options.length) {\n                        options[nextIdx].focus();\n                      } else {\n                        // Cyklicky na zatek\n                        options[0]?.focus();\n                      }\n                    } else if (e.key === 'ArrowUp') {\n                      // ipka nahoru - pejdi na pedchoz option\n                      e.preventDefault();\n                      const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]:not([tabindex=\"-1\"])') || []);\n                      const currentIdx = options.indexOf(e.target);\n                      const prevIdx = currentIdx - 1;\n                      if (prevIdx >= 0) {\n                        options[prevIdx].focus();\n                      } else {\n                        // Cyklicky na konec nebo zpt do search inputu\n                        if (searchInputRef.current) {\n                          searchInputRef.current.focus();\n                        } else {\n                          options[options.length - 1]?.focus();\n                        }\n                      }\n                    } else if (e.key === 'Escape') {\n                      e.preventDefault();\n                      setIsOpen(false);\n                      if (buttonRef.current) {\n                        buttonRef.current.focus();\n                      }\n                    } else if (e.key === 'Tab') {\n                      // Nech prohle zvldat tab - pejde na dal option nebo zave dropdown\n                      const options = Array.from(dropdownRef.current?.querySelectorAll('[role=\"option\"]:not([tabindex=\"-1\"])') || []);\n                      const currentIdx = options.indexOf(e.target);\n\n                      if (e.shiftKey) {\n                        // Shift+Tab - pokud jsme na prvn option, vra se na search input\n                        if (currentIdx === 0) {\n                          e.preventDefault();\n                          if (searchInputRef.current) {\n                            searchInputRef.current.focus();\n                          }\n                        }\n                      } else {\n                        // Tab - pokud jsme na posledn option, zavi dropdown a pokrauj dl\n                        if (currentIdx === options.length - 1) {\n                          e.preventDefault();\n                          setIsOpen(false);\n                          // Nech hlavn tab handler najt dal prvek ve formuli\n                        }\n                      }\n                    }\n                  }}\n                >\n                  {multiple && !isHeader && (\n                    <input\n                      type=\"checkbox\"\n                      checked={selected}\n                      readOnly\n                      onChange={() => {}} // Przdn handler aby nedval warning\n                    />\n                  )}\n                  {isMajetekOption ? (\n                    <>\n                      <span>{optionLabel.replace('   (majetek)', '')}</span>\n                      <span style={{\n                        marginLeft: '8px',\n                        fontSize: '0.75rem',\n                        color: '#dc2626',\n                        fontWeight: '500',\n                        padding: '2px 6px',\n                        backgroundColor: '#fee2e2',\n                        borderRadius: '4px',\n                        border: '1px solid #fca5a5'\n                      }}>\n                        (majetek)\n                      </span>\n                    </>\n                  ) : (\n                    <span>{optionLabel}</span>\n                  )}\n                </StableSelectOption>\n              );\n            })\n          ) : (\n            <StableSelectOption>dn vsledky</StableSelectOption>\n          )}\n        </StableSelectDropdown>\n      )}\n    </StableSelectWrapper>\n  );\n}, (prevProps, nextProps) => {\n  // Custom comparison funkce pro React.memo\n  // Vrac true pokud jsou props STEJN (skip re-render)\n  // Vrac false pokud jsou props RZN (provede re-render)\n\n  // Porovnej primitivn hodnoty\n  if (prevProps.value !== nextProps.value) return false;\n  if (prevProps.placeholder !== nextProps.placeholder) return false;\n  if (prevProps.disabled !== nextProps.disabled) return false;\n  if (prevProps.hasError !== nextProps.hasError) return false;\n  if (prevProps.required !== nextProps.required) return false;\n  if (prevProps.field !== nextProps.field) return false;\n  if (prevProps.loading !== nextProps.loading) return false;\n  if (prevProps.loadingText !== nextProps.loadingText) return false;\n  if (prevProps.multiple !== nextProps.multiple) return false;\n  if (prevProps.hasTriedToSubmit !== nextProps.hasTriedToSubmit) return false;\n\n  // Porovnej arrays (options) - kontrola dlky a referenc\n  if (prevProps.options.length !== nextProps.options.length) return false;\n  // Pro performance nekontrolujeme deep equality jednotlivch items\n  // sta porovnat reference pole (kter se mn pi naten dat)\n  if (prevProps.options !== nextProps.options) return false;\n\n  // Icon me bt React element, take pouijeme reference check\n  if (prevProps.icon !== nextProps.icon) return false;\n\n  // onChange, onBlur, getOptionLabel, getOptionValue jsou funkce\n  // Pokud jsou zmemoizovan pes useCallback, reference zstane stejn\n  // Zde je nememe deep compare, tak pouijeme reference check\n  if (prevProps.onChange !== nextProps.onChange) return false;\n  if (prevProps.onBlur !== nextProps.onBlur) return false;\n  if (prevProps.getOptionLabel !== nextProps.getOptionLabel) return false;\n  if (prevProps.getOptionValue !== nextProps.getOptionValue) return false;\n\n  // Vechny props jsou stejn - skip re-render\n  return true;\n});\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0',\n      key: '1nclc0',\n    },\n  ],\n  ['circle', { cx: '12', cy: '12', r: '3', key: '1v7zrd' }],\n];\n\n/**\n * @component @name Eye\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMi4wNjIgMTIuMzQ4YTEgMSAwIDAgMSAwLS42OTYgMTAuNzUgMTAuNzUgMCAwIDEgMTkuODc2IDAgMSAxIDAgMCAxIDAgLjY5NiAxMC43NSAxMC43NSAwIDAgMS0xOS44NzYgMCIgLz4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIzIiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/eye\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Eye = createLucideIcon('eye', __iconNode);\n\nexport default Eye;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'm22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7', key: '132q7q' }],\n  ['rect', { x: '2', y: '4', width: '20', height: '16', rx: '2', key: 'izxlao' }],\n];\n\n/**\n * @component @name Mail\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMjIgNy04Ljk5MSA1LjcyN2EyIDIgMCAwIDEtMi4wMDkgMEwyIDciIC8+CiAgPHJlY3QgeD0iMiIgeT0iNCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjE2IiByeD0iMiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/mail\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Mail = createLucideIcon('mail', __iconNode);\n\nexport default Mail;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8', key: 'v9h5vc' }],\n  ['path', { d: 'M21 3v5h-5', key: '1q7to0' }],\n  ['path', { d: 'M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16', key: '3uifl3' }],\n  ['path', { d: 'M8 16H3v5', key: '1cv678' }],\n];\n\n/**\n * @component @name RefreshCw\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMyAxMmE5IDkgMCAwIDEgOS05IDkuNzUgOS43NSAwIDAgMSA2Ljc0IDIuNzRMMjEgOCIgLz4KICA8cGF0aCBkPSJNMjEgM3Y1aC01IiAvPgogIDxwYXRoIGQ9Ik0yMSAxMmE5IDkgMCAwIDEtOSA5IDkuNzUgOS43NSAwIDAgMS02Ljc0LTIuNzRMMyAxNiIgLz4KICA8cGF0aCBkPSJNOCAxNkgzdjUiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/refresh-cw\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst RefreshCw = createLucideIcon('refresh-cw', __iconNode);\n\nexport default RefreshCw;\n","/**\n * Pekld anglick error messages do etiny\n * @param {string} errorMessage - Pvodn error message\n * @returns {string} - Peloen error message\n */\nexport function translateErrorMessage(errorMessage) {\n  if (!errorMessage || typeof errorMessage !== 'string') {\n    return errorMessage || 'Neznm chyba';\n  }\n\n  // Pekldme timeout chyby\n  if (errorMessage.includes('timeout') && errorMessage.includes('exceeded')) {\n    const match = errorMessage.match(/timeout of (\\d+)ms exceeded/);\n    if (match) {\n      const timeoutMs = match[1];\n      const timeoutSec = Math.round(timeoutMs / 1000);\n      return `Pekroen asov limit ${timeoutSec}s - server neodpovdl vas`;\n    } else {\n      return 'Pekroen asov limit - server neodpovdl vas';\n    }\n  }\n\n  // Pekldme dal bn axios/network chyby\n  if (errorMessage.includes('Network Error')) {\n    return 'Chyba st - zkontrolujte internetov pipojen';\n  }\n\n  if (errorMessage.includes('Request failed with status code 500')) {\n    return 'Chyba serveru (kd 500) - zkuste to znovu pozdji';\n  }\n\n  if (errorMessage.includes('Request failed with status code 404')) {\n    return 'Poadovan zdroj nebyl nalezen (kd 404)';\n  }\n\n  if (errorMessage.includes('Request failed with status code 403')) {\n    return 'Nemte oprvnn k tto operaci (kd 403)';\n  }\n\n  if (errorMessage.includes('Request failed with status code 401')) {\n    return 'Neautorizovan pstup - zkuste se znovu pihlsit (kd 401)';\n  }\n\n  if (errorMessage.includes('ECONNREFUSED') || errorMessage.includes('connection refused')) {\n    return 'Nelze se pipojit k serveru - server je pravdpodobn nedostupn';\n  }\n\n  if (errorMessage.includes('ENOTFOUND') || errorMessage.includes('getaddrinfo ENOTFOUND')) {\n    return 'Server nenalezen - zkontrolujte adresu serveru';\n  }\n\n  // Pokud nen rozpoznan chyba, vra pvodn message\n  return errorMessage;\n}\n\n/**\n * Zkrcen verze pro timeout chyby bez dodatenho textu\n * @param {string} errorMessage - Pvodn error message\n * @returns {string} - Peloen error message (krat verze)\n */\nexport function translateErrorMessageShort(errorMessage) {\n  if (!errorMessage || typeof errorMessage !== 'string') {\n    return errorMessage || 'Neznm chyba';\n  }\n\n  // Pekldme timeout chyby\n  if (errorMessage.includes('timeout') && errorMessage.includes('exceeded')) {\n    const match = errorMessage.match(/timeout of (\\d+)ms exceeded/);\n    if (match) {\n      const timeoutMs = match[1];\n      const timeoutSec = Math.round(timeoutMs / 1000);\n      return `Pekroen asov limit ${timeoutSec}s`;\n    } else {\n      return 'Pekroen asov limit';\n    }\n  }\n\n  // Pro ostatn chyby pouij plnou funkci\n  return translateErrorMessage(errorMessage);\n}","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['rect', { width: '18', height: '11', x: '3', y: '11', rx: '2', ry: '2', key: '1w4ew1' }],\n  ['path', { d: 'M7 11V7a5 5 0 0 1 10 0v4', key: 'fwvmzm' }],\n];\n\n/**\n * @component @name Lock\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cmVjdCB3aWR0aD0iMTgiIGhlaWdodD0iMTEiIHg9IjMiIHk9IjExIiByeD0iMiIgcnk9IjIiIC8+CiAgPHBhdGggZD0iTTcgMTFWN2E1IDUgMCAwIDEgMTAgMHY0IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/lock\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Lock = createLucideIcon('lock', __iconNode);\n\nexport default Lock;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M5 12h14', key: '1ays0h' }],\n  ['path', { d: 'M12 5v14', key: 's699le' }],\n];\n\n/**\n * @component @name Plus\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNNSAxMmgxNCIgLz4KICA8cGF0aCBkPSJNMTIgNXYxNCIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/plus\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Plus = createLucideIcon('plus', __iconNode);\n\nexport default Plus;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['rect', { width: '16', height: '20', x: '4', y: '2', rx: '2', key: '1nb95v' }],\n  ['line', { x1: '8', x2: '16', y1: '6', y2: '6', key: 'x4nwl0' }],\n  ['line', { x1: '16', x2: '16', y1: '14', y2: '18', key: 'wjye3r' }],\n  ['path', { d: 'M16 10h.01', key: '1m94wz' }],\n  ['path', { d: 'M12 10h.01', key: '1nrarc' }],\n  ['path', { d: 'M8 10h.01', key: '19clt8' }],\n  ['path', { d: 'M12 14h.01', key: '1etili' }],\n  ['path', { d: 'M8 14h.01', key: '6423bh' }],\n  ['path', { d: 'M12 18h.01', key: 'mhygvu' }],\n  ['path', { d: 'M8 18h.01', key: 'lrp35t' }],\n];\n\n/**\n * @component @name Calculator\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cmVjdCB3aWR0aD0iMTYiIGhlaWdodD0iMjAiIHg9IjQiIHk9IjIiIHJ4PSIyIiAvPgogIDxsaW5lIHgxPSI4IiB4Mj0iMTYiIHkxPSI2IiB5Mj0iNiIgLz4KICA8bGluZSB4MT0iMTYiIHgyPSIxNiIgeTE9IjE0IiB5Mj0iMTgiIC8+CiAgPHBhdGggZD0iTTE2IDEwaC4wMSIgLz4KICA8cGF0aCBkPSJNMTIgMTBoLjAxIiAvPgogIDxwYXRoIGQ9Ik04IDEwaC4wMSIgLz4KICA8cGF0aCBkPSJNMTIgMTRoLjAxIiAvPgogIDxwYXRoIGQ9Ik04IDE0aC4wMSIgLz4KICA8cGF0aCBkPSJNMTIgMThoLjAxIiAvPgogIDxwYXRoIGQ9Ik04IDE4aC4wMSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/calculator\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Calculator = createLucideIcon('calculator', __iconNode);\n\nexport default Calculator;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384',\n      key: '9njp5v',\n    },\n  ],\n];\n\n/**\n * @component @name Phone\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTMuODMyIDE2LjU2OGExIDEgMCAwIDAgMS4yMTMtLjMwM2wuMzU1LS40NjVBMiAyIDAgMCAxIDE3IDE1aDNhMiAyIDAgMCAxIDIgMnYzYTIgMiAwIDAgMS0yIDJBMTggMTggMCAwIDEgMiA0YTIgMiAwIDAgMSAyLTJoM2EyIDIgMCAwIDEgMiAydjNhMiAyIDAgMCAxLS44IDEuNmwtLjQ2OC4zNTFhMSAxIDAgMCAwLS4yOTIgMS4yMzMgMTQgMTQgMCAwIDAgNi4zOTIgNi4zODQiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/phone\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Phone = createLucideIcon('phone', __iconNode);\n\nexport default Phone;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'm6 9 6 6 6-6', key: 'qrunsl' }]];\n\n/**\n * @component @name ChevronDown\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtNiA5IDYgNiA2LTYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/chevron-down\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ChevronDown = createLucideIcon('chevron-down', __iconNode);\n\nexport default ChevronDown;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '8', cy: '8', r: '6', key: '3yglwk' }],\n  ['path', { d: 'M18.09 10.37A6 6 0 1 1 10.34 18', key: 't5s6rm' }],\n  ['path', { d: 'M7 6h1v4', key: '1obek4' }],\n  ['path', { d: 'm16.71 13.88.7.71-2.82 2.82', key: '1rbuyh' }],\n];\n\n/**\n * @component @name Coins\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSI4IiBjeT0iOCIgcj0iNiIgLz4KICA8cGF0aCBkPSJNMTguMDkgMTAuMzdBNiA2IDAgMSAxIDEwLjM0IDE4IiAvPgogIDxwYXRoIGQ9Ik03IDZoMXY0IiAvPgogIDxwYXRoIGQ9Im0xNi43MSAxMy44OC43LjcxLTIuODIgMi44MiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/coins\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Coins = createLucideIcon('coins', __iconNode);\n\nexport default Coins;\n"],"names":["Users","createLucideIcon","d","key","cx","cy","r","User","MapPin","LockOpen","width","height","x","y","rx","ry","ShoppingCart","Copy","DialogOverlay","styled","div","_templateObject","_taggedTemplateLiteral","DialogContainer","_templateObject2","DialogHeader","_templateObject3","DialogTitle","h2","_templateObject4","CloseButton","button","_templateObject5","DialogContent","_templateObject6","InfoBox","_templateObject7","props","type","InfoText","_templateObject8","FormSection","_templateObject9","SectionTitle","h3","_templateObject0","FormRow","_templateObject1","columns","FormGroup","_templateObject10","Label","label","_templateObject11","required","InputWithIcon","_templateObject12","Input","input","_templateObject13","hasIcon","hasError","disabled","ScopeSelector","_templateObject14","optionsCount","ScopeOption","_templateObject15","selected","ExistingIndicator","_templateObject16","scope","UsekGrid","_templateObject17","UsekItem","_templateObject18","UsekCode","_templateObject19","span","_templateObject20","ErrorText","_templateObject21","_templateObject22","DialogFooter","_templateObject23","Button","_templateObject24","variant","_ref","isOpen","onClose","onSave","supplierData","existsInPersonal","existsInUsek","existsInGlobal","userPermissions","canAddPersonal","canAddUsek","canAddGlobal","token","username","userDetail","useContext","AuthContext","editedData","setEditedData","useState","selectedScope","setSelectedScope","selectedUseky","setSelectedUseky","availableUseky","setAvailableUseky","usekyLoading","setUsekyLoading","isSaving","setIsSaving","errors","setErrors","useEffect","nazev","dodavatel_nazev","adresa","dodavatel_adresa","ico","dodavatel_ico","dic","dodavatel_dic","zastoupeny","dodavatel_zastoupeny","kontakt_jmeno","dodavatel_kontakt_jmeno","kontakt_email","dodavatel_kontakt_email","kontakt_telefon","dodavatel_kontakt_telefon","async","result","fetchUskyList","error","loadUseky","usek_zkr","usekArray","JSON","parse","Array","isArray","e","handleInputChange","field","value","prev","_objectSpread","newErrors","handleUsekToggle","usekZkr","includes","filter","zkr","actionType","isUpdatingExisting","_jsx","children","_jsxs","onClick","stopPropagation","FontAwesomeIcon","icon","faBuilding","faTimes","faCheckCircle","title","faUser","faGlobe","style","padding","textAlign","color","length","background","border","borderRadius","usek","map","myUseky","checked","onChange","marginTop","fontSize","Building","target","placeholder","Hash","maxLength","Mail","Phone","general","display","validateData","_editedData$nazev","_editedData$ico","trim","test","Object","keys","finalScope","finalUseky","message","faCheck","getButtonText","Menu","Maximize2","Minimize2","ChevronLeft","FileDown","Minus","ChevronRight","Upload","DropdownContainer","$left","$right","SectionHeader","HeaderTitle","HeaderActions","IconButton","$color","SearchBox","SearchIcon","SearchInput","SearchClearButton","TemplateList","TemplateItem","$type","TemplateInfo","TemplateName","TemplateBadge","TemplateActions","ActionButton","LoadButton","EmptyMessage","$muted","$italic","Divider","hr","show","serverTemplates","savedTemplates","templatesLoading","searchQuery","showSearch","currentPhase","isArchived","hasPermission","onSearch","onToggleSearch","onRefresh","onFillPo","onFillDetails","canFillTemplate","onCopyToUser","onCopyToGlobal","onShowPreview","onDelete","onEditName","editingTemplateId","editingTemplateName","matchesQuery","searchInputRef","useRef","dropdownRef","position","setPosition","left","right","current","rect","getBoundingClientRect","viewportWidth","window","innerWidth","setTimeout","_searchInputRef$curre","focus","safeServerTemplates","safeSavedTemplates","filteredServerTemplates","entry","user_id","String","filteredSavedTemplates","ref","faDatabase","RefreshCw","size","Search","X","idx","_t$poApproval","t","data","typ","toString","toUpperCase","allowedPo","allowedDet","displayName","name","dbName","poApproval","predmet","concat","id","badge","viewBox","fill","stroke","strokeWidth","Plus","Eye","Trash","gap","ts","_entry$data","_entry$data2","hasPo","hasDet","orderDetails","NavigatorContainer","$position","$isMinimized","$isCompact","$isFullscreen","$isDragging","NavigatorHeader","MinimizedText","NavigatorTitle","HeaderControls","ToolbarSection","ToolbarButtons","ToolbarButton","$withPlus","MinimizedExpandButton","NavigatorContent","SectionItem","$isDisabled","$bgColor","$borderColor","$isActive","SectionItemContent","SectionIcon","SectionInfo","$textColor","SectionName","ValidationBadge","$hasErrors","$hasMissingFields","AttachmentBadge","DropzoneContainer","$isDragOver","DropzoneIcon","DropzoneText","FORM_SECTIONS","bgColor","borderColor","phase","faClipboardCheck","iconType","Package","Calendar","FileTextIcon","faFileContract","Calculator","CheckCircle2","onSectionClick","onFilesDrop","onToggleSections","areSectionsCollapsed","validationErrors","formData","isFullscreen","isSectionActive","allSectionStates","isWorkflowCompleted","canPublishRegistry","canUnlockAnything","onTemplateClick","onSaveAsTemplate","onGenerateDocx","onToggleFullscreen","canGenerateDocx","canSaveTemplate","showTemplateDropdown","onTemplateSearch","onToggleTemplateSearch","onRefreshTemplates","onFillPoApproval","onCopyTemplateToUser","onCopyTemplateToGlobal","onShowTemplatePreview","onDeleteTemplate","onEditTemplateName","matchesTemplateQuery","isMinimized","setIsMinimized","isCompact","setIsCompact","isDragging","setIsDragging","isDragOver","setIsDragOver","dragOffset","setDragOffset","isTemplateDropdownOpen","setIsTemplateDropdownOpen","containerRef","fileInputRef","contentRef","savePosition","useCallback","newPosition","localStorage","setItem","stringify","constrainToViewport","pos","_containerRef$current","navigatorWidth","navigatorHeight","offsetHeight","maxX","Math","max","maxY","innerHeight","min","saved","getItem","savedPos","constrainedPos","console","warn","savedScroll","scrollPos","parseInt","scrollTop","handleWindowResize","prevPosition","handleResize","clearTimeout","timeoutId","addEventListener","removeEventListener","saveMinimizedState","minimized","saveCompactState","compact","scrollTimeoutRef","saveScrollPosition","handleMouseDown","clientX","clientY","top","handleMouseMove","newX","newY","constrainedPosition","handleMouseUp","document","toggleMinimized","newMinimized","prevPos","toggleCompact","newCompact","handleDragEnter","preventDefault","handleDragLeave","currentTarget","contains","relatedTarget","handleDragOver","handleDrop","files","from","dataTransfer","handleDropzoneClick","_fileInputRef$current","click","handleFileSelect","handleToggleTemplateDropdown","handleClickOutside","event","dropdown","closest","toolbarButton","handleSectionClick","section","getSectionValidationInfo","_section$required","errorCount","category","startsWith","categorizeErrorKey","missingCount","faktury","forEach","faktura","potvrzeni_vecne_spravnosti","maxCena","parseFloat","max_cena_s_dph","fa_castka","vecna_spravnost_poznamka","fieldName","totalRequired","isSectionVisibleAndEnabled","sectionId","sectionState","visible","enabled","renderSectionIcon","IconComponent","navigatorContent","onMouseDown","_Fragment","faBookmark","ChevronDown","faCompress","faExpand","TemplateDropdown","onScroll","isDisabled","isActive","validationInfo","hasErrors","hasMissingFields","showBadge","prilohy","isDropzoneDisabled","onDragEnter","onDragLeave","onDragOver","onDrop","multiple","margin","fontWeight","lineHeight","marginBottom","faClipboard","attachmentsCount","hasAttachmentErrors","showAttachmentsBadge","badgeText","ReactDOM","body","normalizeStrediskaFromBackend","every","item","kod","Boolean","parsed","kod_stavu","some","normalizeStrediskaForBackend","codes","normalizeFinancovaniFromBackend","financing","zpusob_financovani","zdroj","lp_kody","lp_kod","cislo_smlouvy","smlouva_poznamka","individualni_schvaleni","individualni_poznamka","pojistna_udalost_cislo","pojistna_udalost_poznamka","doplnujici_data","normalizeFinancovaniForBackend","financovaniOptions","arguments","undefined","selectedOption","find","opt","nazev_stavu","constructor","this","isInitialized","isInitializing","initPromise","cache","users","approvers","strediska","financovani","druhyObjednavky","lpKody","metadata","lastInitTime","initDuration","stateCallbacks","registerStateCallbacks","callbacks","setAllUsers","setApprovers","setStrediskaOptions","setFinancovaniOptions","setDruhyObjednavkyOptions","setLpKodyOptions","setLoadingUsers","setLoadingApprovers","setLoadingStrediska","setLoadingFinancovani","setLoadingDruhyObjednavky","setLoadingLpKody","initialize","formDataId","_updateReactState","startTime","Date","now","_performInitialization","duration","push","timestamp","_ref2","isLoadingFromDB","usersResult","approversResult","strediskaResult","financovaniResult","druhyObjednavkyResult","lpKodyResult","Promise","allSettled","_loadUsers","_loadApprovers","_loadStrediska","_loadFinancovani","_loadDruhyObjednavky","_loadLpKody","results","_handleResult","entries","_ref3","_","success","_ref4","_this$stateCallbacks$","_this$stateCallbacks","call","fetchAllUsers","user","aktivni","_this$stateCallbacks$2","_this$stateCallbacks2","_this$stateCallbacks$3","_this$stateCallbacks3","active","fetchApprovers","a","approver","titul_pred_str","titul_pred","jmeno_str","jmeno","prijmeni_str","prijmeni","titul_za_str","titul_za","replace","_this$stateCallbacks$4","_this$stateCallbacks4","_this$stateCallbacks$5","_this$stateCallbacks5","getStrediska25","_this$stateCallbacks$6","_this$stateCallbacks6","_this$stateCallbacks$7","_this$stateCallbacks7","getFinancovaniZdroj25","_this$stateCallbacks$8","_this$stateCallbacks8","_this$stateCallbacks$9","_this$stateCallbacks9","response","getDruhyObjednavky25","druhy","_this$stateCallbacks$0","_this$stateCallbacks0","_this$stateCallbacks$1","_this$stateCallbacks1","fetchLimitovanePrisliby","_this$stateCallbacks$10","_this$stateCallbacks10","status","_this$stateCallbacks$11","_this$stateCallbacks11","_this$stateCallbacks$12","_this$stateCallbacks12","_this$stateCallbacks$13","_this$stateCallbacks13","_this$stateCallbacks$14","_this$stateCallbacks14","_this$stateCallbacks$15","_this$stateCallbacks15","_this$stateCallbacks$16","_this$stateCallbacks16","_hasDataChanged","newData","prevKey","prevData","loadOrder","_ref5","orderId","archivovano","order","getOrderV2","Error","assign","strediska_kod","reset","getState","useAutosave","saveFunction","options","delay","dependencies","timeoutRef","isScheduledRef","lastSaveTimeRef","cancelAutosave","triggerAutosave","immediate","timeSinceLastSave","currentTime","isScheduled","api25invoices","axios","create","baseURL","process","headers","normalizeApi25InvoicesError","err","_err$response","_err$response$data","_err$response2","_err$response2$data","_err$response3","_err$response3$data","_err$response4","createInvoiceV2","_ref10","order_id","smlouva_id","fa_cislo_vema","fa_typ","fa_datum_vystaveni","fa_datum_splatnosti","fa_datum_doruceni","fa_dorucena","fa_strediska_kod","fa_poznamka","rozsirujici_data","vecna_spravnost_umisteni_majetku","fa_predana_zam_id","fa_datum_predani_zam","fa_datum_vraceni_zam","payload","Number","endpoint","objednavka_id","post","timeout","deleteInvoiceV2","invoiceId","hardDelete","hard_delete","delete","errorMsg","interceptors","use","_error$config","_error$config$url","_error$config2","_error$config2$url","_error$response","_error$response2","_error$response3","config","url","reject","CustomEvent","detail","dispatchEvent","responseText","WORKFLOW_STATES","NOVA","code","description","ODESLANA_KE_SCHVALENI","SCHVALENA","ZAMITNUTA","CEKA_POTVRZENI","POTVRZENA","DOKONCENA","ZRUSENA","ROZPRACOVANA","getWorkflowPhase","stateCode","state","FIELD_LABELS","values","garant_uzivatel_id","prikazce_id","email","dodavatel_kontakt","druh_objednavky_kod","polozky_objednavky","datum_odeslani","schvaleni_komentar","odeslani_storno_duvod","dodavatel_zpusob_potvrzeni","zpusob_platby","dt_akceptace","dt_zverejneni","registr_iddt","ma_byt_zverejnena","validateWorkflowData","_formData$schvaleni_k","_formData$schvaleni_k2","workflowCode","sectionStates","requiredFields","baseFields","getRequiredFields","FIELD_TO_PHASE","isPokladnaFinancing","zpusob","toLowerCase","_formData$datum_odesl","_formData$odeslani_st","_formData$datum_faktu","_formData$cislo_faktu","_formData$predmet","_formData$jmeno","_formData$email","_formData$dodavatel_n","_formData$dodavatel_a","_formData$dodavatel_i","_formData$druh_objedn","_formData$dodavatel_k","_formData$druh_objedn2","_formData$cislo_smlou","_formData$individualn","_formData$pojistna_ud","shouldValidateField","fieldPhase","locked","hasItemError","polozka","index","_polozka$popis","popis","cena_bez_dph","cena_s_dph","stav_schvaleni","stav_odeslani","stav_stornovano","registrSection","registr_smluv_vyplneni","stav_fakturace","datum_fakturace","cislo_faktury","fakturovana_cena_bez_dph","fakturovana_cena_s_dph","getSectionVisibility","orderPhase","objednatel","schvaleni","dodavatel","kontakt","detaily","dodaci_podminky","visibleSections","baseSections","getVisibleSections","baseVisibility","extendedVisibility","__orderFormCurrentInstanceId","__orderFormInitInProgress","useFormController","userId","editOrderId","archivovanoParam","onDataLoaded","onError","onReady","lifecycle","useFormLifecycle","dispatch","useReducer","lifecycleReducer","initialLifecycleState","startDictionariesLoad","LIFECYCLE_ACTIONS","START_DICTIONARIES_LOAD","dictionariesLoaded","DICTIONARIES_LOADED","startDataLoad","START_DATA_LOAD","dataLoaded","DATA_LOADED","setReady","READY","setError","ERROR","RESET","isLoadingDictionaries","isLoadingFormData","isReady","phaseHistory","isInPhase","canLoadData","LIFECYCLE_PHASES","READY_FOR_DATA","dictionaries","useDictionaries","orderDataLoader","loading","setLoading","loadingRef","extractEnrichedUserData","enrichedUser","telefon","transformOrderData","dbOrder","_dbOrder$financovani","_dbOrder$financovani2","_dbOrder$financovani3","_dbOrder$financovani4","objednatelData","objednatel_id","_dbOrder$_enriched","_dictionaries$data","_enriched","enriched","allUsers","u","strediskaKod","_dbOrder$_enriched2","s","zpusobFinancovani","financovaniVnorena","lp_nazev","paragraf","investice","druhObjednavky","stavObjednavky","stavyArray","stav_workflow_kod","poslednSta","stavInfo","transformedData","ev_cislo","cislo_objednavky","stav_objednavky","mimoradna_udalost","stav_odeslano","maOdeslanu","maDatum","dt_odeslani","maOdesilatele","odesilatel_id","dt_odeslano","split","datum_storna","datum_vytvoreni","dt_vytvoreni","datum_splatnosti","dt_splatnost","temp_datum_objednavky","datum_objednavky","dt_objednavky","dodavatel_potvrdil_id","zverejnil_id","dt_zverejneni_potvrzeni","potvrdil_vecnou_spravnost_id","dt_potvrzeni_vecne_spravnosti","rawValue","fakturant_id","dt_faktura_pridana","dokoncil_id","dt_dokonceni","dokonceni_poznamka","potvrzeni_dokonceni_objednavky","polozky","fa_splatnost","attachments","maAkceptaci","potvrzeni","zpusoby","platba","beData","potvrzeno","zpusob_potvrzeni","trimmed","currentStates","toISOString","schvalovatel_id","loadOrderForEdit","fakturyWithAttachments","all","_attachResponse$data","attachResponse","listInvoiceAttachments","f","loadOrderForCopy","nextNumberResponse","getNextOrderNumberV2","newEvCislo","order_number_string","next_order_string","next_number","dt_schvaleni","datum_posledni_zmeny","vytvoril_uzivatel_id","uzivatel_id","prilohy_dokumenty","sourceOrderId","useOrderDataLoader","ui","useUIState","uiReducer","initialUIState","openModal","modalKey","UI_ACTIONS","OPEN_MODAL","closeModal","CLOSE_MODAL","closeAllModals","CLOSE_ALL_MODALS","toggleDropdown","dropdownKey","TOGGLE_DROPDOWN","closeAllDropdowns","CLOSE_ALL_DROPDOWNS","collapseSection","sectionKey","COLLAPSE_SECTION","expandSection","EXPAND_SECTION","toggleSection","TOGGLE_SECTION","collapseAllSections","COLLAPSE_ALL_SECTIONS","expandAllSections","EXPAND_ALL_SECTIONS","lockSection","LOCK_SECTION","unlockSection","UNLOCK_SECTION","setSelectState","SET_SELECT_STATE","setSearchState","SET_SEARCH_STATE","toggleFullscreen","TOGGLE_FULLSCREEN","setFullscreen","SET_FULLSCREEN","toggleDebug","TOGGLE_DEBUG","pinDebug","PIN_DEBUG","setSaveProgress","text","SET_SAVE_PROGRESS","showSaveProgress","SHOW_SAVE_PROGRESS","hideSaveProgress","HIDE_SAVE_PROGRESS","setIcoCheckStatus","SET_ICO_CHECK_STATUS","setIcoCheckData","SET_ICO_CHECK_DATA","setDragOver","SET_DRAG_OVER","modals","dropdowns","sections","selectStates","searchStates","fullscreen","debug","saveProgress","icoCheckStatus","icoCheckData","dragOver","instanceIdRef","random","substr","initLockRef","cleanupRef","hasInitializedRef","isMountedRef","strictModeUnmountRef","lifecycleRef","dictionariesRef","orderDataLoaderRef","onDataLoadedRef","onErrorRef","onReadyRef","instanceId","wasInitializing","timeSinceMount","init","reason","currentLifecycle","currentDictionaries","currentOrderDataLoader","currentOnDataLoaded","currentOnReady","loadAll","loadedData","currentOnError","loadedCount","totalToLoad","_loggedWarnings","Set","parseWorkflowStates","_unused","hasWorkflowState","states","msg","meta","has","add","_err","warnOnce","typeofState","parsedStates","SECTION_DEFINITIONS","visibilityLogic","context","lockLogic","_context$unlockStates","_context$unlockStates2","unlockStates","phase1","phase2","_context$unlockStates3","_context$unlockStates4","_context$unlockStates5","phase3_sections","_context$unlockStates6","_context$unlockStates7","_context$unlockStates8","_context$unlockStates9","potvrzeni_objednavky","isPokladna","_context$unlockStates0","registr_smluv","_context$formData$dod","_context$unlockStates1","registr","hasUverejnit","hasUverejnena","_context$unlockStates10","registr_vyplneni","prubeh_objednavky","dodaci_informace","fakturace","_context$unlockStates11","vecna_spravnost","_context$unlockStates12","dokonceni","_context$unlockStates13","calculateSectionState","evalContext","calculateCurrentPhase","phase3","canEditApprovedSections","isWorkflowLocked","shouldLockPhase1Sections","shouldLockPhase2Sections","shouldLockPhase3Sections","isRegistrLocked","isFakturaceDisplayLocked","isVecnaSpravnostLocked","isDokonceniLocked","PHASE_DEFINITIONS","class","workflowStates","useWorkflowManager","_formData$financovani2","_formData$dodavatel_z2","workflowRefreshKey","setWorkflowRefreshKey","useMemo","_formData$financovani","_formData$dodavatel_z","isPlatbaPokladnaObj","isPlatbaPokladnaDodavatel","unlockedSections","setUnlockedSections","isSectionUnlocked","resetAllUnlocks","forceRefresh","phaseTheme","getPhaseTheme","phaseProgress","isStorno","phases","phaseNum","fillClass","isVisible","isCurrent","getCurrentPhaseCallback","getPhaseProgressCallback","getPhaseThemeCallback","parseWorkflowStatesCallback","hasWorkflowStateCallback","workflowCodeOrState","maybeState","mainWorkflowState","stateHierarchy","hierarchyState","lastState","getSectionState","additionalContext","getSectionLockState","calculateSectionLockState","getAllSectionLockStates","lockStates","isWorkflowRejected","isWorkflowCancelled","isFormLocked","getAllSectionStates","contextWithLock","unlockPhase2","newWorkflowCode","updatedFormData","datum","poznamka","stav_u_dodavatele","datum_zmeny_stavu","poznamka_stav","cislo_zasilky","prepravce","ocekavane_doruceni","skutecne_doruceni","datum_faktury","castka_bez_dph","castka_s_dph","datum_platby","unlockState","newPhase","preparePhase2Unlock","unlockPhase3","preparePhase3Unlock","unlockPhase4","preparePhase4Unlock","getCurrentPhase","getPhaseProgress","sectionDefinitions","phaseDefinitions","ModalOverlay","ModalContainer","ModalHeader","ModalTitle","ModalContent","PDFPreview","LoadingContainer","ModalFooter","ButtonGroup","ButtonCancel","ButtonConfirm","onConfirm","onCancel","generatedBy","pdfUrl","setPdfUrl","isLoading","setIsLoading","organizace","setOrganizace","strediskaMap","setStrediskaMap","orgData","getOrganizaceDetail","orgError","strediskaData","reduce","acc","kod_strediska","nazev_strediska","strediskaError","enrichedFaktury","enrichedFaktura","userData","getUserDetail","potvrdil_vecnou_spravnost","userError","orderForPDF","blob","pdf","FinancialControlPDF","toBlob","URL","createObjectURL","resolve","alert","generatePreview","log","revokeObjectURL","handleCancel","handleEsc","createPortal","faSpinner","spin","className","src","faTimesCircle","dateStr","orderNumber","filename","pdfFile","File","formatDateForPicker","date","isNaN","getTime","year","getFullYear","month","getMonth","padStart","day","getDate","normalizeText","normalize","getCurrentDateFormatted","Container","FormWrapper","debugPinned","FixedHeader","theme","colors","gray100","FixedHeaderContent","ScrollableContent","ScrollableInner","FormHeader","HeaderLeft","TitleWithButtons","isOverBudget","h1","PhaseRow","PhaseProgressContainer","PhaseText","isOver","PhaseProgressBar","PhaseSegment","PhaseSegmentFill","_templateObject25","PhaseDivider","_templateObject26","FormActions","_templateObject27","_templateObject28","keyframes","_templateObject29","Spinner","_templateObject30","RetryButton","_templateObject31","EvidenceNumber","_templateObject32","EvidenceValue","_templateObject33","_templateObject34","$isEmergency","_templateObject35","_templateObject36","sectionTheme","bg","hover","getBaseColors","opacity","_templateObject37","_templateObject38","CollapseIcon","_templateObject39","collapsed","SectionControls","_templateObject40","LockWarning","_templateObject41","SectionContent","_templateObject42","EmergencyToggleWrapper","_templateObject43","EmergencyToggleSwitch","_templateObject44","EmergencyToggleLabel","_templateObject45","_templateObject46","_templateObject47","_templateObject48","_templateObject49","LabelWithClear","_templateObject50","LabelText","_templateObject51","ClearSelectButton","_templateObject52","$visible","_templateObject53","_templateObject54","TextArea","textarea","_templateObject55","SmlouvaAutocompleteContainer","_templateObject56","$loading","$notFound","$isNegative","_templateObject57","_templateObject58","_templateObject59","_templateObject60","_templateObject61","_templateObject62","SmlouvaSuggestionsList","_templateObject63","SmlouvaSuggestionItem","_templateObject64","SmlouvaSuggestionTitle","_templateObject65","SmlouvaSuggestionMeta","_templateObject66","SmlouvaSuggestionEmpty","_templateObject67","select","_templateObject68","_templateObject69","_templateObject70","_templateObject71","isEmpty","_templateObject72","_templateObject73","_templateObject74","_templateObject75","_templateObject76","TemplateModalOverlay","_templateObject77","_templateObject78","_templateObject79","_templateObject80","_templateObject81","DeleteConfirmOverlay","_templateObject82","DeleteConfirmModal","_templateObject83","DeleteConfirmTitle","_templateObject84","DeleteConfirmMessage","_templateObject85","DeleteConfirmActions","_templateObject86","DeleteConfirmButton","_templateObject87","TemplateModal","_templateObject88","TemplateModalHeader","_templateObject89","TemplateModalTitle","_templateObject90","TemplateModalCloseButton","_templateObject91","TemplateModalBody","_templateObject92","TemplateFormGroup","_templateObject93","TemplateLabel","_templateObject94","TemplateInput","_templateObject95","TemplateModalActions","_templateObject96","_templateObject97","_templateObject98","_templateObject99","_templateObject100","_templateObject101","TemplateActionButton","_templateObject102","UnlockButton","_templateObject103","level","_templateObject104","_templateObject105","_templateObject106","_templateObject107","LoadingOverlay","_templateObject108","LoadingSpinner","_templateObject109","LoadingMessage","_templateObject110","LoadingSubtext","_templateObject111","SaveOverlay","_templateObject112","ErrorMessage","_templateObject113","$blurred","_templateObject114","_templateObject115","_templateObject116","SupplierSearchIcon","_templateObject117","AresSearchIcon","_templateObject118","AddToDirectoryIcon","_templateObject119","DeleteItemButton","_templateObject120","SupplierPopupOverlay","_templateObject121","SupplierPopupModal","_templateObject122","SupplierPopupHeader","_templateObject123","SupplierPopupTitle","_templateObject124","SupplierPopupCloseButton","_templateObject125","SupplierSearchInput","_templateObject126","SupplierPopupContent","_templateObject127","SupplierList","_templateObject128","SupplierItem","_templateObject129","AresPopupOverlay","_templateObject130","AresPopupModal","_templateObject131","AresPopupHeader","_templateObject132","AresPopupTitle","_templateObject133","AresPopupCloseButton","_templateObject134","AresPopupContent","_templateObject135","AresSearchInputField","_templateObject136","AresList","_templateObject137","AresItem","_templateObject138","AresItemContent","_templateObject139","hasButtons","AresScopeBadges","_templateObject140","AresScopeBadge","_templateObject141","AresItemButtons","_templateObject142","AresActionButton","_templateObject143","AresLoadingSpinner","_templateObject144","_templateObject145","AresScopeSelector","_templateObject146","AresScopeOption","_templateObject147","AresUsekGrid","_templateObject148","AresUsekItem","_templateObject149","IcoNotification","_templateObject150","IcoNotificationTitle","h4","_templateObject151","IcoNotificationMessage","_templateObject152","IcoNotificationActions","_templateObject153","IcoActionButton","_templateObject154","PreviewModal","_templateObject155","PreviewContent","_templateObject156","PreviewHeader","_templateObject157","PreviewTitle","_templateObject158","PreviewCloseButton","_templateObject159","PreviewSection","_templateObject160","PreviewSectionTitle","_templateObject161","PreviewField","_templateObject162","PreviewFieldLabel","_templateObject163","PreviewFieldValue","_templateObject164","PreviewItemsList","_templateObject165","PreviewItem","_templateObject166","PreviewItemTitle","_templateObject167","PreviewItemDetails","_templateObject168","PreviewBadge","_templateObject169","PreviewEmptyState","_templateObject170","CurrencyInputWrapper","_templateObject171","CurrencySymbol","_templateObject172","CurrencyInput","onBlur","inputRef","localValue","setLocalValue","isFocused","setIsFocused","formatCurrency","val","num","toFixed","formattedValue","newValue","cleanValue","numValue","finalValue","onFocus","handleFocus","handleBlurLocal","formatted","paddingRight","DatePicker","setIsOpen","currentMonth","setCurrentMonth","openUpwards","setOpenUpwards","wrapperRef","calendarRef","selectedDate","checkPosition","buttonRect","spaceBelow","bottom","spaceAbove","scrollContainer","querySelector","handleDateSelect","formattedDate","formatInputDate","today","calendarDays","getCalendarDays","firstDay","lastDay","days","i","getDay","isOtherMonth","remainingDays","displayText","toLocaleDateString","formatDisplayDate","DatePickerWrapper","DateInputButton","hasValue","DateClearButton","handleClear","DateTodayButton","handleToday","DateCalendarPopup","CalendarHeader","CalendarNav","prevMonth","CalendarTitle","nextMonth","CalendarGrid","CalendarDay","isToday","toDateString","isSelected","CalendarDate","CalendarFooter","CalendarButton","_templateObject173","_templateObject174","_templateObject175","_templateObject176","_templateObject177","_templateObject178","_templateObject179","_templateObject180","_templateObject181","_templateObject182","_templateObject183","_templateObject184","_templateObject185","FakturaInfoIconWrapper","_templateObject186","FakturaInfoIcon","_templateObject187","FakturaTooltipBubble","_templateObject188","FakturaTooltipRow","_templateObject189","FakturaTooltipLabel","_templateObject190","FakturaTooltipValue","_templateObject191","validateAndFixStrediska","strediskaCodes","strediskaOptions","transformBackendDataToFrontend","backendData","transformed","sazba_dph","poznamkaText","maxIterations","poznamka_objednavky","OrderForm25","_dictionaries$data2","_dictionaries$data3","_dictionaries$data4","_dictionaries$data5","_dictionaries$data6","_dictionaries$data7","_dictionaries$data8","_dictionaries$data9","_dictionaries$data0","_formData$polozky_obj","_formData$polozky_obj2","_userDetail$roles","_userDetail$roles2","_formData$polozky_obj4","_formData$faktury4","_formData$ev_cislo","_formData$ev_cislo2","_formData$ev_cislo3","_formData$dodavatel_z8","_formData$dodavatel_z11","_formData$dodavatel_z15","_formData$dodavatel_z16","_formData$dodavatel_z17","_formData$dodavatel_z18","_formData$dodavatel_z19","_formData$dodavatel_z20","_formData$dodavatel_z21","_formData$dodavatel_z22","_formData$dodavatel_z23","_formData$dodavatel_z24","_formData$dodavatel_z25","_formData$dodavatel_z26","_formData$dodavatel_z27","_formData$dodavatel_z28","_formData$dodavatel_z30","_attachmentToDelete$a","navigate","useNavigate","showToast","ToastContext","triggerActivity","useActivity","progress","start","startGlobalProgress","setProgress","setGlobalProgress","done","doneGlobalProgress","fail","failGlobalProgress","resetGlobalProgress","ProgressContext","onDataLoadedCalledRef","location","useLocation","urlParams","URLSearchParams","search","editOrderIdFromUrl","get","draftManager","getMetadata","editOrderIdFromLS","menuBarState","setCurrentUser","hasDraft","draftData","loadDraft","savedOrderId","saveMetadata","isEditMode","isNewOrder","__orderFormState","checkInitialState","setSectionStates","storno_detail","setSelectStates","garant","prikazce","setSearchStates","touchedSelectFields","setTouchedSelectFields","isLoadingEvCislo","setIsLoadingEvCislo","setIsFullscreen","lpDetailsState","setLpDetailsState","details","smlouvyState","setSmlouvyState","list","loadingList","loadingDetail","searchTerm","showSuggestions","selectedSuggestionIndex","handleEscKey","setAttachments","attachmentUI","setAttachmentUI","uploading","checkingSync","showDeleteDialog","deleteTarget","showDeleteAllDialog","supplierSearch","setSupplierSearch","showDialog","allContacts","aresState","setAresState","popupOpen","savingToLocal","scopeInfo","usekyState","setUsekyState","available","icoCheckState","setIcoCheckState","isOperation","saveProgressState","setSaveProgressState","isPhase3SectionsLocked","setIsPhase3SectionsLocked","isPhase3SectionsUnlocked","setIsPhase3SectionsUnlocked","isPhase3SectionsLockProcessedFromDB","setIsPhase3SectionsLockProcessedFromDB","showFinancialControlConfirmation","setShowFinancialControlConfirmation","financialControlConfirmed","setFinancialControlConfirmed","pendingSaveData","setPendingSaveData","setAreSectionsCollapsed","supplierDialog","setSupplierDialog","showAddDialog","existingCheck","autoFillSource","docxModal","setDocxModal","open","orderData","loadingState","setLoadingState","ciselniky","initializing","initialized","setIsEditMode","usekyData","scrollTimeout","handleScroll","scrollableContentRef","userNamesCache","setUserNamesCache","_setFormData","popis_pozadavku","dodavatel_id","druh_objednavky","dt_predpokladany_termin_dodani","misto_dodani","zaruka","storno_uzivatel_id","storno_provedl","storno_poznamky","datum_zaplaceni","faktury_objednavky","setFormData","_stack$split$","stack","__activeOrderFormId","__activeOrderFormEvCislo","restoreUnsavedAttachments","storageKey","savedAttachmentsStr","savedAttachments","addDebugLog","action","confirmText","cancelText","restoredAttachments","att","file","uploadError","removeItem","originalFormDataRef","original","fieldsToCompare","originalPolozky","currentPolozky","origItem","currItem","mnozstvi","cena_jednotkova","workflowManager","currentPhaseTheme","workflowForceRefresh","isArchivedOrder","phaseProgressOverride","isChanged","setIsChanged","isDraftLoaded","setIsDraftLoaded","broadcastMenuBarState","_state$isEditMode","_state$isNewOrder","_state$orderId","_state$orderNumber","_state$currentPhase","_state$mainWorkflowSt","_state$hasDraft","fullState","broadcastMenuBarStateRef","broadcastOrderState","overrides","hasRealId","saveState","setSaveState","saving","savingDraft","disableAutosave","lastAutoSave","autoSaving","dataSource","disableAutosaveRef","autoSaveTimerRef","isClosingRef","autosaveCallbackRef","performSaveDraft","isAutoSave","showCancelConfirmModal","setShowCancelConfirmModal","cancelWarningMessage","setCancelWarningMessage","templateState","setTemplateState","server","fetchStatus","showSaveModal","saveChecked","saveMode","selectedTarget","selectedTargetTs","showDeleteConfirm","pendingDelete","unlockDialogs","setUnlockDialogs","cancelPublish","storno","fakturyState","setFakturyState","showAddForm","editing","fakturyLPCerpani","setFakturyLPCerpani","deleteFacturaDialog","setDeleteFacturaDialog","fakturaId","fakturaNazev","pocetPriloh","confirmDialog","setConfirmDialog","templateUI","setTemplateUI","actionsLog","hoveredPreviewKey","previewModalData","editingId","editingName","showSearchPredefs","searchPredefs","setValidationErrors","hasTriedToSubmit","setHasTriedToSubmit","lokalizacePanelStates","setLokalizacePanelStates","lpState","setLpState","showSupplierSearchDialog","setShowSupplierSearchDialog","supplierSearchTerm","setSupplierSearchTerm","supplierSearchResults","setSupplierSearchResults","supplierSearchLoading","setSupplierSearchLoading","allSupplierContacts","setAllSupplierContacts","aresPopupOpen","setAresPopupOpen","aresSearch","setAresSearch","aresResults","setAresResults","loadingAres","setLoadingAres","setSavingToLocal","aresScopeInfo","setAresScopeInfo","aresSelectedScope","setAresSelectedScope","aresSelectedUseky","showIcoCheck","setShowIcoCheck","setIsIcoOperation","setShowSaveProgress","saveProgressText","setSaveProgressText","uploadingFiles","setUploadingFiles","isCheckingSyncAttachments","setIsCheckingSyncAttachments","showDeleteAttachmentDialog","setShowDeleteAttachmentDialog","attachmentToDelete","setAttachmentToDelete","showDeleteAllAttachmentsDialog","setShowDeleteAllAttachmentsDialog","showSupplierAddDialog","setShowSupplierAddDialog","existingSupplierCheck","setExistingSupplierCheck","supplierAutoFillSource","setSupplierAutoFillSource","docxModalOpen","setDocxModalOpen","docxModalOrder","setDocxModalOrder","isLoadingCiselniky","setIsFormInitializing","setIsInitialized","initializationError","setIsSavingDraft","setDisableAutosave","setLastAutoSave","isAutoSaving","setIsAutoSaving","setDataSource","lpDetails","loadingLpDetails","setLoadingLpDetails","smlouvyList","setSmlouvyList","loadingSmlouvyList","setLoadingSmlouvyList","smlouvaDetail","setSmlouvaDetail","loadingSmlouvaDetail","setLoadingSmlouvaDetail","smlouvaSearchTerm","setSmlouvaSearchTerm","showSmlouvySuggestions","setShowSmlouvySuggestions","selectedSmlouvaSuggestionIndex","setSelectedSmlouvaSuggestionIndex","setSavedTemplates","setServerTemplates","setTemplatesFetchStatus","setTemplatesLoading","showTemplateSaveModal","setShowTemplateSaveModal","templateName","setTemplateName","templateType","setTemplateType","setSaveMode","selectedTargetTemplate","setSelectedTargetTemplate","showDeleteTemplateConfirm","setShowDeleteTemplateConfirm","templatePendingDelete","setTemplatePendingDelete","showUnlockPhase1Confirm","setShowUnlockPhase1Confirm","showUnlockPhase2Confirm","setShowUnlockPhase2Confirm","showUnlockPhase3Confirm","setShowUnlockPhase3Confirm","showUnlockRegistrConfirm","setShowUnlockRegistrConfirm","showUnlockPotvrzeniConfirm","setShowUnlockPotvrzeniConfirm","showCancelPublishConfirm","setShowCancelPublishConfirm","showUnlockFakturaceConfirm","setShowUnlockFakturaceConfirm","showUnlockDokonceniConfirm","setShowUnlockDokonceniConfirm","showUnlockStornoConfirm","setShowUnlockStornoConfirm","fakturyLoading","editingFaktura","setEditingFaktura","fakturaFormData","setFakturaFormData","setPreviewModalData","setEditingTemplateId","setEditingTemplateName","lpOptionsForItems","setLpOptionsForItems","stavy","lp","stav","fetchLPDetail","cislo_lp","limit","celkovy_limit","cerpano","skutecne_cerpano","zbyva","zbyva_skutecne","loadLPStavy","autoFillSupplierFromContract","_orderData$zpusob_fin","_orderData$dodavatel_","_orderData$dodavatel_2","_orderData$cislo_smlo","_smlouva$ico","hasSchvalena","isSmlouvaFinancing","cisloSmlouvy","currentSmlouvyList","getSmlouvyList","show_inactive","loadError","smlouva","evidencni_cislo","icoZeSmlouvy","nazev_firmy","source","localResult","searchSupplierByIco","supplier","address","represented","localError","aresUrl","aresResponse","fetch","method","ok","_aresData$sidlo","aresData","json","obchodniJmeno","sidlo","textovaAdresa","aresError","handleDataLoaded","currentEditId","finalData","hasDbData","_draftData$formData","draftOrderId","currentOrderId","orderNumberData","nextNumber","__orderForm_hasLoadedNextNumberRef","loadSettingsFromLocalStorage","require","userSettings","vychozi_garant_id","defaultGarantId","vychozi_prikazce_id","defaultPrikazceId","wasAutoFilled","supplierFromContract","_loadedData$financova","lp_nazvy","lpOptions","kategorie","rok","sort","b","localeCompare","lpMappingData","lpKodyOptions","validLpOptions","lpKod","lpValue","originalValue","lpOption","lpDetail","nazev_uctu","saveDraft","draftError","setAutosaveEnabled","formatToastMessage","styles","AlertCircle","warning","AlertTriangle","info","InfoIcon","alignItems","fontFamily","flexShrink","flex","handleError","handleReady","formController","approversBase","druhyObjednavkyOptions","druhyObjednavkyRawData","prilohyTypyOptions","typyFakturOptions","stavyWorkflowMap","isMaterialOrder","React","druhObj","atribut_objektu","formatValidationErrors","categories","ostatni","cleanMessage","cat","backgroundColor","errIdx","marginLeft","marginRight","areDictionariesReady","combined","uniqueMap","Map","set","garantOptions","setGarantOptions","deaktivovan","fakturaTypyPrilohOptions","newPanelStates","isMaterialOrderValue","hasLocationData","usek_kod","budova_kod","mistnost_kod","p","budova","mistnost","isConceptSaved","setIsConceptSaved","isPhase1Unlocked","setIsPhase1Unlocked","_draftData$formData2","syncCheck","checkDBSync","getOrderTimestampV2","needsSync","dbData","mergedData","syncWithDatabase","cleanedDraftData","_cleanedDraftData$dod","_cleanedDraftData$dod2","loadDraftData","isOrderSavedToDB","sectionVisibility","getSectionTheme","sectionName","canEditPhase2","phase2SectionsForAuthorizedUsers","canApproveOrders","canManageOrders","canManageUsers","canEditPhase3","canManageInvoices","canSaveOrder","isSuperAdmin","roles","role","kod_role","isAdmin","hasOrderManagePermission","filteredLpKodyOptions","_prikazceWithRoles$ro","selectedPrikazce","prikazceWithRoles","setHours","platneOd","platne_od","platneDo","platne_do","prikazceUsekId","usek_id","lpUsekId","isPrilohyLocked","navigatorFormData","getAttachmentsInfo","count","file_exists","klasifikace","extendedSectionStates","hasFaktury","isRegistrFilled","isFieldDisabled","registrState","registrVyplneniState","isRegistrVyplneniLocked","potvrzeniState","isPotvrzeniLocked","shouldLockSchvaleniCheckboxes","financovaniState","shouldLockFinancovaniSection","shouldLockPhase4to6Sections","fakturaceState","isFakturaceLockedPhase7","shouldLockFaktury","dokonceniState","isOrderCompleted","shouldLockAllSections","isZkontrolovana","shouldLockVecnaSpravnost","userRoleRef","_userDetail$roles3","_userDetail$roles4","openConceptNumber","hasCreatedInitialItem","lastPhaseRef","_formData$polozky_obj3","polozkyLength","jednotka","dodavatelPotvrzeni","celkovaCenaBezDPH","sum","defaultValue","updateFaktury","newFaktury","selectedFinancovani","preventDefaults","eventName","totalPrice","total","maxPrice","_formData$max_cena_s_","isPriceExceeded","loadAttachmentsSmartly","getUserNameById","getUserDetailApi2","then","fullName","catch","isValidEvCislo","activeUsers","garantInAllUsers","inactiveGarantDetail","normalizedGarant","login","loadGarantOptions","dnesniDatum","novaFaktura","vytvoril_jmeno","dt_aktualizace","_isNew","loadFakturaLPCerpani","_fakturyLPCerpani$fak","loaded","getFakturaLPCerpani","lpCerpani","lp_cerpani","saveFakturaLPCerpaniData","lpCerpaniData","saveFakturaLPCerpani","handleISDOCParsed","isdocData","realFakturaId","currentFaktury","_updateExisting","updatedFaktury","fa_datum_zdanitelneho_plneni","fa_castka_bez_dph","fa_dph","_isdoc_parsed","_isdoc_polozky","_isdoc_dodavatel","_isdoc_email","_fromISDOC","_isdocRefresh","newFaktura","vecna_spravnost_potvrzeno","validateInvoiceForAttachments","_file$name","_file$name2","missingFields","endsWith","isValid","valid","isISDOC","join","handleInvoiceAttachmentsChange","newAttachments","faktura_id","hasPokladniDoklad","typ_prilohy","_isPokladna","handleCreateInvoiceInDB","_formData$faktury2","_response$data3","tempFakturaId","strediskaKody","invoicePayload","invoice_id","group","groupEnd","handleInvoiceAttachmentUploaded","uploadedAttachment","firstFaktura","loadNextOrderNumber","startSaveProgressAndRedirect","skipUnlock","unlockOrderId","unlockOrderV2","progressControl","startProgress","onProgress","percent","onComplete","saveUIState","highlightOrderId","_activeProgressControl","sendOrderNotifications","newWorkflowState","oldWorkflowState","notificationType","hasKeSchvaleni","hadKeSchvaleni","hadSchvalena","hasZamitnuta","hadZamitnuta","hasCekaSe","hadCekaSe","hasOdeslana","hadOdeslana","hasPotvrzena","hadPotvrzena","hadUverejnena","hasNeuverejnena","hadNeuverejnena","hasFakturace","hadFakturace","hasVecnaSpravnost","hadVecnaSpravnost","hasZkontrolovana","hadZkontrolovana","hasDokoncena","hadDokoncena","hasZrusena","hadZrusena","saveOrderToAPI","skipFinancialControlModal","jeCheckboxZaskrtnut","jeUzDokoncena","__workflowStateUpdated","faze_objednavky","schvalil_uzivatel_id","poznamka_schvaleni","poznamka_vecna_spravnost","lp_id","currentDateTime","getMySQLDateTime","hours","getHours","minutes","getMinutes","seconds","getSeconds","updateOrderV2","freshOrderData","updatedData","validateFormForSave","nadlimit","toLocaleString","_userDetail$roles5","_userDetail$roles6","_formData$dodavatel_z3","_formData$financovani3","_formData$dodavatel_z4","getMySQLDate","shouldStayOnForm","uzivatelIdNumber","objednatelIdNumber","druhObjednavkyObj","vecnaSpravnostValue","objednatel_jmeno","objednatel_email","objednatel_telefon","poznamky","existingStates","hasOrderId","approvalChoice","wasAlreadyApproved","isJustNowApproved","isDodavatelPotvrzeno","nepotvrzeneFaktury","jeDokonceniPotvrzeno","jeVecnaSprvnostPotvrzena","workflowOrder","indexA","indexOf","indexB","lastWorkflowCode","stavZCiselniku","workflowState","dokonceniValue","datumOdeslani","datumStorna","potvrzeniData","dataToSave","dodavatel_zpusob_potvrzeni_original","akceptaceValue","zverejneniValue","updatedFormDataImmediate","_faktura$attachments","strediskaArray","match","typ_platby","pokladni_doklad","prilohy_count","isdoc","datum_vystaveni","dph_celkem","_result$polozky2","_result$faktury2","_parsedUpdateData$str","oldWorkflowKod","workflow","fieldsCount","strediskaNazvy","stredisko","triggerNotification","order_number","order_subject","commander_id","garant_id","creator_id","supplier_name","financovani_json","strediska_names","max_price_with_dph","is_urgent","triggerError","notifError","updatedWorkflowKod","transformedResult","parsedUpdateData","poslednStav","_fakturaFromDB$rozsir2","fakturaFromDB","parsedStrediska","_attachResponse$data2","_freshOrderData$finan","reloadError","prepocetCerpaniSmluv","workflowKod","hasId","calculatePhaseFromWorkflow","_mergedDraftData$polo2","mergedDraftData","step","version","isManuallyUnlocked","uiState","getUIState","phase2OrderId","phase2Unlocked","updateOrderId","shouldShowProgress","deleteAllDraftKeys","ordersCacheService","invalidate","_parsedInsertData$str","_parsedInsertData$str2","_fakturyWithAttachmen","_result$financovani","_result$polozky","_result$faktury","_result2","phase1Fields","createOrderV2","fakturyFromBE","originalFaktury","_fakturaFromDB$rozsir","originalFaktura","parsedInsertData","fallback","_result","newWorkflowFromDB","_mergedDraftData$polo","newWorkflowKod","hasSchvalenaInsert","_result3","deleteDraft","lock_info","lockInfo","userName","locked_by_user_fullname","locked_by_user_id","lockAge","lock_age_minutes","translateErrorMessageShort","backgroundTaskService","runTaskNow","saveDraftUnified","formDataToSave","explicitSavedOrderId","attachmentsToSave","isAfterDbSave","isAutosaveEnabled","existingDraft","firstSaveDate","existing","firstAutoSaveDate","_unused2","draftFormData","financovaniObj","typ_financovani","uhrada_faktury","kod_strediska_financovani","organizacni_jednotka","ios","zakazka","serializableAttachments","rest","_objectWithoutProperties","_excluded","_hadFile","effectiveSavedOrderId","hasPhase7Or8Data","customFormData","clearPhase2UnlockState","currentWorkflowState","hasOdeslano","hasZruseno","preventLocalStorageCheck","setPreventLocalStorageCheck","isOrderSent","isOrderCancelled","savedSectionStates","loadSectionStates","hasLoadedNextNumberRef","specifikace","merna_jednotka","jednotkova_cena","celkova_cena","fixedHeaderRef","useLayoutEffect","updateHeaderHeight","documentElement","setProperty","timeouts","observer","ResizeObserver","observe","disconnect","loadLPDetail","lp_id_or_kod","loadSmlouvyList","loadSmlouvaDetail","notFound","shouldFillOrdererData","hasUserInput","selectedSource","evCislo","iCislo","selectedLpIds","validLpIds","lpId","_formData$zpusob_fina","isSmlouva","hasCisloSmlouvy","nemaDodavatele","shouldAutoFill","hasRelevantData","isPageVisible","hidden","debounceTimer","handleVisibilityChange","handleBeforeUnload","scrollPosition","pageYOffset","unsavedAttachments","serverId","fromServer","unclassifiedAttachments","uploadDate","lastModified","needsReselection","handlePopState","handleFieldBlur","stored","templates","fetchAndMergeTemplates","newStates","saveSectionStates","checkDuplicateFileName","newFileName","existingFiles","handleFileUpload","existingAttachmentsSize","getFilePrefix","newFilesSize","totalSize","existingSizeMB","newSizeMB","totalSizeMB","newFiles","isAllowedFileType","_file$name$split$pop","fileExtension","pop","fileSizeMB","isAllowedFileSize","duplicate","createAttachmentMetadata","guid","originalName","generatedName","systemovy_nazev","uploaded_at","serverGuid","isDuplicate","duplicateOf","uploadFileToServer25","fileId","_formData$prilohy_dok","filePrefix","_result$data","_result$data2","file_prefix","uploadOrderAttachment","attachmentId","attachment_id","_result$data3","_result$data4","_result$data5","nahrano_uzivatel_id","uploaded_by_user_id","nahrano_uzivatel","_result$data6","_result$data7","_result$data8","successMessage","filteredAttachments","_error$response2$data","checkAttachmentsSynchronization25","silentMode","_serverResult$data","_verifyResult","_verifyResult$data","serverResult","listOrderAttachments","dbAttachments","verifyResult","verifyOrderAttachments","verifyError","issues","hasIssues","conceptUnclassified","conceptOrphaned","dbMissingFiles","dbOrphaned","uploadErrors","inconsistentState","localAtt","serverIdStr","dbAtt","attachmentError","originalni_nazev_souboru","dbIdStr","dbAttError","verifiedAttachments","original_name","path","system_path","systemName","size_match","issue","db_size","actual_size","reportText","restoreAttachmentsFromDB","_result$data9","rawAttachments","attachment","mapApiAttachmentToLocal","isRestored","existingIds","localUnsavedAttachments","fetchAttachmentsFromAPI","mergedAttachments","removeFileDirectly","removeAllFiles","_result$data1","systemPath","final_filename","fileName","systemova_cesta","velikost","file_size","velikost_souboru_b","upload_date","created_at","updated_at","cesta_k_souboru","getFileBorderColor","getFileBackgroundColor","updatePolozka","updatedPolozka","cenaSdph","cenaBezDph","checkSupplierRequiredFields","_formData$dodavatel_n2","_formData$dodavatel_i2","_formData$dodavatel_i3","handleAddSupplierToDirectory","fetchSupplierContacts","load_all","filteredResults","_supplier$ico","supplierUseky","myUsekRaw","myUsek","hasUsek","exists","loadAllSupplierContacts","initialSearchTerm","performSupplierSearch","searchNormalized","filtered","contact","handleSupplierAresSearch","currentName","currentICO","fetchAresData","trimmedSearchTerm","requestData","_data$sidlo","_data$sidlo2","searchVariants","term","arr","allResults","searchVariant","pocet","ekonomickeSubjekty","_item$sidlo","_item$sidlo2","uniqueResults","findIndex","other","normalizedSearchTerm","aNameNorm","bNameNorm","aContainsOriginal","bContainsOriginal","scopeInfoMap","aresItem","dbResults","_s$ico","handleAresUsekToggle","handleAresSelect","handleSaveToLocal","saveLocation","targetUserId","targetUsekZkr","useky","updateSupplierByIco","updateError","createSupplier","checkSupplierByIco","trimmedIco","_aresData$sidlo2","handleIcoFillForm","handleIcoCancel","compactTemplatePreview","_data$poApproval","_data$poApproval2","_data$orderDetails","preview","_data$polozky$","prvniPolozka","_unused3","logTemplateAction","logEntry","slice","_unused5","isFirstChangeInNewOrder","validateField","processedValue","toMySQLDateTime","getCurrentDate","localTimestamp","handleRadioClick","handleSaveAsTemplate","handleToggleSections","lockedSections","scrollToSection","behavior","sectionElement","sectionHeader","elementTop","offsetTop","targetScrollTop","getComputedStyle","getPropertyValue","scrollTo","handleNavigatorSectionClick","handleNavigatorFilesDrop","hasRozpracovana","handleGenerateDocx","orderForDocx","nazev_objednavky","handleDocxModalClose","handleCancelOrder","broadcastDraftDeleted","forceReload","warningMessage","handleCancelConfirm","cancel","handleCancelCancel","pendingUnlock","setPendingUnlock","cleanStates","doSave","resetHigherPhaseCheckboxes","tempFormData","allErrors","flushSync","_formData$dodavatel_z5","_formData$financovani4","_formData$dodavatel_z6","validationWorkflowCode","phase4to6","workflowErrors","shouldValidateFinancovani","_formData$cislo_smlou2","polozka_lp_id","_formData$dt_akceptac","zpusobyPotvrzeni","fakturaPrefix","locationErrorKeys","k","_formData$polozky_obj5","polozkyIndexesWithErrors","newLokalizacePanelStates","structuredMessage","scrollToFirstError","fieldOrder","element","parentSection","polozkyKeys","firstPolozkaError","getAttribute","scrollIntoView","block","inline","inputInside","cancelDeleteSavedTemplate","fetchTemplatesListWithMeta","items","serverTpls","userTpls","processedServerTemplates","nazev_sablony","parseTemplateData","rawTyp","rawTypStr","serverType","__fromServer","processedUserTemplates","raw","serverCount","userCount","template","safeParseTemplateField","Function","fn","rawPo","polozky_po","rawDetail","polozky_detail","expandFlatKeys","obj","out","parts","cur","parsedPo","parsedDetail","saveTemplateToStorage","createTemplate","_response$data5","_response$data4","newTemplate","insertId","updatedTemplates","mode","getOptionLabel","option","druhLabel","jmeno_prijmeni","handleFormKeyDown","_visibleElements$newI","activeElement","formContainer","focusableSelectors","visibleElements","querySelectorAll","el","offsetParent","tagName","visibility","currentIndex","_visibleElements$","newIndex","shiftKey","formContent","FloatingNavigator","setShowSearchPredefs","next","fieldMap","_ref6","fields","appliedSections","predefinedEntry","_predefinedEntry$type","templateData","copyName","resp","created","userEntry","globalName","_result$data10","showTemplatePreview","previewData","createDetailedTemplatePreview","templateInfo","formatDateOnly","isGlobal","po","popisPozadavku","od","dodavatelNazev","dodavatelAdresa","dodavatelIco","dodavatelDic","datumDodani","datum_dodani","fakturovatNa","fakturovat_na","dodaciAdresa","dodaci_adresa","cenaJednotka","cena_jednotka","cenaTotal","query","_entry$data$poApprova","_entry$data2$polozky","_entry$data2$polozky$","normalizedQuery","entryName","entryPredmet","entryFirstItem","boxShadow","whiteSpace","flexDirection","minimumFractionDigits","maximumFractionDigits","transition","toLocaleTimeString","hour","minute","second","fontStyle","faExclamationTriangle","flexWrap","typCerpani","aktualneCerpani","pocetLP","pomernaCast","zbyva_rezervace","zbyva_predpoklad","isNegative","lpCislo","lpNazev","spravce","spravceText","tooltipText","cursor","abs","Lock","onMouseEnter","onMouseLeave","Unlock","transform","transformOrigin","celkovaCastka","hodnota_s_dph","celkova_castka","cerpano_celkem","rezervovanaCastka","jeUlozenaObjednavka","jeVeFazi78","isPhase36","castka","faSave","borderTop","borderBottom","overflow","onKeyDown","faChevronUp","StableCustomSelect","selectedValue","loadingText","getOptionValue","gridColumn","FileText","handleCurrencyChange","numericValue","parseCurrency","selectedValues","Coins","lpCodes","gridTemplateColumns","searchLower","cislo","nazev_smlouvy","firma","searchValue","jeVyprsela","borderLeft","Intl","NumberFormat","currency","format","platnost_do","readOnly","justifyContent","isFormBasicallyValid","pointerEvents","accentColor","faClock","minWidth","prettyDate","x1","y1","x2","y2","zIndex","currentIco","handleIcoBlur","removePolozka","onMouseOver","onMouseOut","points","paddingLeft","rows","addPolozka","isChecked","phaseCheck","workflowCheck","_formData$dodavatel_z9","_formData$dodavatel_z0","_formData$dodavatel_z1","_formData$dodavatel_z10","_formData$dodavatel_z12","_formData$dodavatel_z13","hasValidationError","_formData$dodavatel_z14","currentZpusoby","newZpusoby","faInfoCircle","minHeight","boxSizing","faHashtag","_formData$financovani5","_formData$dodavatel_z29","_formData$faktury5","shouldShow","sectionDescription","faCreditCard","pokladniDoklad","InvoiceAttachmentsCompact","objednavkaId","onISDOCParsed","atts","onAttachmentsChange","onAttachmentUploaded","onCreateInvoiceInDB","_faktura$fa_datum_dor","_faktura$fa_castka","isEditing","currentData","isVecnaPotvrzena","letterSpacing","textTransform","Info","navigator","clipboard","writeText","predpokladanaCastka","_formData$faktury","prilohyCount","_response$data","handleDeleteFaktura","_faktura$fa_splatnost2","_faktura$fa_splatnost","_fakturyLPCerpani$fak2","fin","isRealInvoice","lpData","LPCerpaniEditor","availableLPCodes","newLpCerpani","fakturaCastka","rozdil","prekroceno","paddingTop","lp_cislo","totalLP","updatedFields","hasTimestamp","potvrdil_vecnou_spravnost_jmeno","potvrdil_vecnou_spravnost_prijmeni","isDokonceniLockedLocal","listStyle","isPotvrzeno","fakturyCelkem","handleFileDrop","getElementById","animation","accept","faSync","faBrain","_file$nahrano_uzivate","_file$nahrano_uzivate2","faFileCircleXmark","faFileAlt","textOverflow","round","oldUrl","link","createElement","href","download","appendChild","removeChild","downloadOrderAttachment","errorMessage","isMissingFile","downloadAttachmentFromServer25","isFromServer","deleteAttachmentFromServer25","removeFile","faTrash","updateAttachmentV2","updateFileKlasifikace","handleSupplierSearchClose","autoFocus","contactPerson","phone","handleSupplierSearchSelect","aresSearchTimeout","isCurrentlySaving","_ref8","updateTemplate","_templateData$orderDe","confirmDeleteSavedTemplate","payloadUserId","deleteTemplate","serverStatus","serverData","deleted","CheckCircle","ConfirmDialog","handleCancelDeleteAttachment","deleteOrderAttachment","_error$response3$data","performDeleteAttachmentFromServer","handleCancelDeleteAllAttachments","handleConfirmDeleteAllAttachments","_response$data2","priloha","deleteInvoiceAttachment","handleResetToPhase1","handleResetToPhase3Sections","handleResetToPhase3Workflow","updatedStates","currentWorkflow","workflowArray","updatedWorkflow","clearedData","storno_duvod","storno_user_id","dt_storno","SupplierAddDialog","ModernHelper","pageContext","DocxGeneratorModal","FinancialControlConfirmationModal","handleCancelCompletion","pozice_nazev","StableSelectWrapper","_templateObject192","StableSelectButton","_templateObject193","StableSelectDropdown","_templateObject194","StableSelectSearchBox","_templateObject195","StableSelectSearchInput","_templateObject196","StableSelectSearchIcon","_templateObject197","StableSelectOption","_templateObject198","isHeader","StableSelectValue","_templateObject199","normalizeSearchText","_ref9","isClearable","setSearchTerm","internalScroll","setInternalScroll","buttonRef","voiceInputFlagRef","normalizedValue","filteredOptions","normalizedSearch","displayValue","checkVoiceInputAttribute","_wrapperRef$current","hasAttribute","timer","optionValue","removeAttribute","updatePosition","shouldOpenUpward","maxHeight","dropdownMaxHeight","passive","capture","handleOptionClick","currentValues","newValues","v","shouldShowError","handleToggle","cleanLabel","tabIndex","nativeEvent","inputType","_dropdownRef$current8","firstOption","_dropdownRef$current9","lastOption","_dropdownRef$current0","optionLabel","isMajetekOption","_dropdownRef$current1","nextIdx","_options$2","_dropdownRef$current10","prevIdx","_options2","_dropdownRef$current11","currentIdx","prevProps","nextProps","translateErrorMessage","timeoutMs","timeoutSec"],"sourceRoot":""}