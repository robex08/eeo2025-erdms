"use strict";(self.webpackChunkr_app_zzs_eeo=self.webpackChunkr_app_zzs_eeo||[]).push([[3637],{33637:(e,t,a)=>{a.d(t,{Bp:()=>w,CR:()=>l,IA:()=>k,MU:()=>d,Tz:()=>m,Zz:()=>p,createDownloadLink25:()=>y,hP:()=>c,iH:()=>v,isPreviewableInBrowser:()=>_,je:()=>i,nG:()=>h,openInBrowser25:()=>b,ro:()=>u});var o=a(89379);const s=a(56263).A.create({baseURL:"https://erdms.zachranka.cz/api.eeo/",headers:{"Content-Type":"application/json"}});const n=(e,t,a,o)=>{};function r(e){var t,a,o,s,n,r,u;return null!==(t=e.response)&&void 0!==t&&null!==(a=t.data)&&void 0!==a&&a.message?e.response.data.message:null!==(o=e.response)&&void 0!==o&&null!==(s=o.data)&&void 0!==s&&s.error?e.response.data.error:null!==(n=e.response)&&void 0!==n&&null!==(r=n.data)&&void 0!==r&&r.err?e.response.data.err:null!==(u=e.response)&&void 0!==u&&u.data&&"string"===typeof e.response.data?e.response.data:e.message?e.message:"Neo\u010dek\xe1van\xe1 chyba p\u0159i komunikaci se serverem"}async function u(e){let{token:t,username:a,orderId:o}=e;if(!t||!a||!o)throw new Error("Chyb\xed p\u0159\xedstupov\xfd token, u\u017eivatelsk\xe9 jm\xe9no nebo ID objedn\xe1vky.");const r={token:t,username:a,id:o};n("request","orders25/lock",r);try{const e=await s.post("orders25/lock",r);if(n("response","orders25/lock",r,e.data),e.data&&"ok"===e.data.status){const t=e.data.lock_info,a=(null===t||void 0===t?void 0:t.locked_by_user_fullname)||"V\xe1mi";return{success:!0,message:e.data.message||"Objedn\xe1vka byla zamknuta",lock_info:e.data.lock_info,locked_by_name:a}}if(e.data&&e.data.err){const t=e.data.lock_info,a=new Error(e.data.err);throw a.lock_info=t,a}var u;throw new Error((null===(u=e.data)||void 0===u?void 0:u.message)||"Nepoda\u0159ilo se zamknout objedn\xe1vku")}catch(v){var d,l,i,c;if(v.lock_info)throw v;if(401===(null===(d=v.response)||void 0===d?void 0:d.status)||403===(null===(l=v.response)||void 0===l?void 0:l.status))throw new Error("Nem\xe1te opr\xe1vn\u011bn\xed k zamknut\xed objedn\xe1vky");if(null!==(i=v.response)&&void 0!==i&&null!==(c=i.data)&&void 0!==c&&c.lock_info){const e=v.response.data.lock_info,t=new Error(v.response.data.err||"Objedn\xe1vka je zam\u010den\xe1 jin\xfdm u\u017eivatelem");throw t.lock_info=e,t}throw new Error("Chyba p\u0159i zamyk\xe1n\xed objedn\xe1vky: ".concat(v.message))}}async function d(e){let{token:t,username:a,orderId:o,force:r=!1}=e;if(!t||!a||!o)throw new Error("Chyb\xed p\u0159\xedstupov\xfd token, u\u017eivatelsk\xe9 jm\xe9no nebo ID objedn\xe1vky.");const u={token:t,username:a,id:o};r&&(u.force=!0),n("request","orders25/unlock",u);try{const e=await s.post("orders25/unlock",u);if(n("response","orders25/unlock",u,e.data),e.data&&"ok"===e.data.status)return{success:!0,message:e.data.message||"Objedn\xe1vka byla odemknuta",unlock_type:e.data.unlock_type||"normal"};var d;throw new Error((null===(d=e.data)||void 0===d?void 0:d.message)||"Nepoda\u0159ilo se odemknout objedn\xe1vku")}catch(c){var l,i;if(401===(null===(l=c.response)||void 0===l?void 0:l.status)||403===(null===(i=c.response)||void 0===i?void 0:i.status))throw new Error("Nem\xe1te opr\xe1vn\u011bn\xed k odemknut\xed objedn\xe1vky");throw new Error("Chyba p\u0159i odemyk\xe1n\xed objedn\xe1vky: ".concat(c.message))}}s.interceptors.response.use(e=>e,e=>{var t,a,o;if((401===(null===(t=e.response)||void 0===t?void 0:t.status)||403===(null===(a=e.response)||void 0===a?void 0:a.status))&&"undefined"!==typeof window){const e=new CustomEvent("authError",{detail:{message:"Va\u0161e p\u0159ihl\xe1\u0161en\xed vypr\u0161elo. P\u0159ihlaste se pros\xedm znovu."}});window.dispatchEvent(e)}const s=(null===(o=e.response)||void 0===o?void 0:o.data)||"";if("string"===typeof s&&s.includes("<!doctype")&&"undefined"!==typeof window){const e=new CustomEvent("authError",{detail:{message:"Va\u0161e p\u0159ihl\xe1\u0161en\xed vypr\u0161elo. Obnovte str\xe1nku a p\u0159ihlaste se znovu."}});window.dispatchEvent(e)}return Promise.reject(e)});const l=async e=>{let{token:t,username:a,aktivni:u=1}=e;try{var d;const e={token:t,username:a,typ_objektu:"STREDISKA",aktivni:u};n("request","states25/by-object-type",(0,o.A)((0,o.A)({},e),{},{token:t?"".concat(t.substring(0,10),"..."):"null"}));const r=await s.post("states25/by-object-type",e);n("success","states25/by-object-type",null,{status:r.status,statusText:r.statusText,data:r.data,headers:r.headers});const l=(null===(d=r.data)||void 0===d?void 0:d.data)||[];n("info","states25/by-object-type",null,{rawDataSample:l.slice(0,3),totalCount:l.length,fields:l[0]?Object.keys(l[0]):[]});const i=new Map;l.forEach(e=>{i.set(e.kod_stavu,e)});const c=l.filter(e=>!e.nadrazeny_kod_stavu||""===e.nadrazeny_kod_stavu.trim()||null===e.nadrazeny_kod_stavu||void 0===e.nadrazeny_kod_stavu),v=l.filter(e=>e.nadrazeny_kod_stavu&&""!==e.nadrazeny_kod_stavu.trim()&&null!==e.nadrazeny_kod_stavu&&void 0!==e.nadrazeny_kod_stavu);n("info","states25/by-object-type",null,{rootCount:c.length,childCount:v.length,rootSample:c.slice(0,2),childSample:v.slice(0,2)});const p=[];c.sort((e,t)=>(e.nazev_stavu||"").localeCompare(t.nazev_stavu||"","cs")),c.forEach(e=>{p.push({value:e.kod_stavu,label:e.nazev_stavu,level:0,isParent:!0,raw:e});const t=v.filter(t=>t.nadrazeny_kod_stavu===e.kod_stavu);t.sort((e,t)=>(e.nazev_stavu||"").localeCompare(t.nazev_stavu||"","cs")),t.forEach(t=>{p.push({value:t.kod_stavu,label:"".concat(t.nazev_stavu),level:1,isParent:!1,parentCode:e.kod_stavu,raw:t})})});const k=new Set;p.forEach(e=>{1===e.level&&k.add(e.raw.kod_stavu)});const _=v.filter(e=>!k.has(e.kod_stavu));return _.length>0&&(n("warning","states25/by-object-type",null,{orphanChildren:_.map(e=>({kod:e.kod_stavu,nazev:e.nazev_stavu,nadrazeny:e.nadrazeny_kod_stavu}))}),_.forEach(e=>{p.push({value:e.kod_stavu,label:"\u26a0\ufe0f ".concat(e.nazev_stavu," (nad\u0159azen\xfd: ").concat(e.nadrazeny_kod_stavu,")"),level:1,isParent:!1,isOrphan:!0,raw:e})})),n("info","states25/by-object-type","Fin\xe1ln\xed hierarchie",{totalItems:p.length}),p}catch(b){var l,i,c,v,p,k,_;const e=r(b);throw n("error","states25/by-object-type",null,{error:e.message,status:(null===(l=b.response)||void 0===l?void 0:l.status)||"NETWORK_ERROR",statusText:(null===(i=b.response)||void 0===i?void 0:i.statusText)||"Connection failed",response_data:(null===(c=b.response)||void 0===c?void 0:c.data)||null,request_url:(null===(v=b.config)||void 0===v?void 0:v.url)||"Unknown URL",request_method:(null===(p=b.config)||void 0===p||null===(k=p.method)||void 0===k?void 0:k.toUpperCase())||"POST",request_headers:(null===(_=b.config)||void 0===_?void 0:_.headers)||{},original_error:b.message}),e}},i=async e=>{let{token:t,username:a,aktivni:r=1}=e;try{var u;const e={token:t,username:a,typ_objektu:"DRUH_OBJEDNAVKY",aktivni:r};n("request","states25/by-object-type",(0,o.A)((0,o.A)({},e),{},{token:t?"".concat(t.substring(0,10),"..."):"null"}));const d=await s.post("states25/by-object-type",e);n("success","states25/by-object-type",null,{status:d.status,statusText:d.statusText,data:d.data,headers:d.headers});const l=((null===(u=d.data)||void 0===u?void 0:u.data)||[]).map(e=>({id:e.kod_stavu,kod:e.kod_stavu,kod_stavu:e.kod_stavu,nazev:e.nazev_stavu,nazev_stavu:e.nazev_stavu,value:e.kod_stavu,label:e.nazev_stavu,atribut_objektu:e.atribut_objektu}));return n("info","states25/by-object-type",null,{processedCount:l.length,sample:l.slice(0,3)}),l}catch(c){var d,l,i;throw n("error","states25/by-object-type",null,{message:c.message,status:null===(d=c.response)||void 0===d?void 0:d.status,statusText:null===(l=c.response)||void 0===l?void 0:l.statusText,data:null===(i=c.response)||void 0===i?void 0:i.data}),c}},c=async e=>{let{token:t,username:a,aktivni:u=1}=e;try{var d;const e={token:t,username:a,typ_objektu:"FINANCOVANI_ZDROJ",aktivni:u};n("request","states25/by-object-type",(0,o.A)((0,o.A)({},e),{},{token:t?"".concat(t.substring(0,10),"..."):"null"}));const r=await s.post("states25/by-object-type",e);n("success","states25/by-object-type",null,{status:r.status,statusText:r.statusText,data:r.data,headers:r.headers});const l=(null===(d=r.data)||void 0===d?void 0:d.data)||[];n("info","states25/by-object-type",null,{rawDataSample:l.slice(0,3),totalCount:l.length,fields:l[0]?Object.keys(l[0]):[]});const i=l.filter(e=>e.kod_stavu&&e.nazev_stavu).sort((e,t)=>(e.nazev_stavu||"").localeCompare(t.nazev_stavu||"","cs")).map(e=>({id:e.kod_stavu,kod:e.kod_stavu,kod_stavu:e.kod_stavu,nazev:e.nazev_stavu,nazev_stavu:e.nazev_stavu,label:e.nazev_stavu,raw:e}));return n("info","states25/by-object-type",null,{transformedCount:i.length,transformedSample:i.slice(0,3)}),i}catch(b){var l,i,c,v,p,k,_;const e=r(b);throw n("error","states25/by-object-type",null,{error:e.message,status:(null===(l=b.response)||void 0===l?void 0:l.status)||"NETWORK_ERROR",statusText:(null===(i=b.response)||void 0===i?void 0:i.statusText)||"Connection failed",response_data:(null===(c=b.response)||void 0===c?void 0:c.data)||null,request_url:(null===(v=b.config)||void 0===v?void 0:v.url)||"Unknown URL",request_method:(null===(p=b.config)||void 0===p||null===(k=p.method)||void 0===k?void 0:k.toUpperCase())||"POST",request_headers:(null===(_=b.config)||void 0===_?void 0:_.headers)||{},original_error:b.message}),e}};const v=async e=>{let{token:t,username:a,aktivni:r=1}=e;try{var u;const e={token:t,username:a,typ_objektu:"PRILOHA_TYP",aktivni:r};n("request","states25/by-object-type",(0,o.A)((0,o.A)({},e),{},{token:t?"".concat(t.substring(0,10),"..."):"null"}));const d=await s.post("states25/by-object-type",e),l=((null===(u=d.data)||void 0===u?void 0:u.data)||[]).filter(e=>e.kod_stavu&&e.nazev_stavu).sort((e,t)=>(e.nazev_stavu||"").localeCompare(t.nazev_stavu||"","cs")).map(e=>({value:e.kod_stavu,label:e.nazev_stavu,kod:e.kod_stavu,nazev:e.nazev_stavu}));return n("success","states25/by-object-type PRILOHA_TYP",null,{loaded_count:l.length,sample:l.slice(0,3)}),l}catch(d){throw n("error","states25/by-object-type PRILOHA_TYP",null,d.message),new Error("Chyba p\u0159i na\u010d\xedt\xe1n\xed typ\u016f p\u0159\xedloh: ".concat(d.message))}},p=async e=>{let{token:t,username:a,aktivni:r=1}=e;try{var u;const e={token:t,username:a,typ_objektu:"FAKTURA_TYP",aktivni:r};n("request","states25/by-object-type",(0,o.A)((0,o.A)({},e),{},{token:t?"".concat(t.substring(0,10),"..."):"null"}));const d=await s.post("states25/by-object-type",e),l=((null===(u=d.data)||void 0===u?void 0:u.data)||[]).filter(e=>e.kod_stavu&&e.nazev_stavu).sort((e,t)=>(e.nazev_stavu||"").localeCompare(t.nazev_stavu||"","cs")).map(e=>({value:e.kod_stavu,label:e.nazev_stavu,kod:e.kod_stavu,nazev:e.nazev_stavu}));return n("success","states25/by-object-type FAKTURA_TYP",null,{loaded_count:l.length,sample:l.slice(0,3)}),l}catch(d){throw n("error","states25/by-object-type FAKTURA_TYP",null,d.message),new Error("Chyba p\u0159i na\u010d\xedt\xe1n\xed typ\u016f faktur: ".concat(d.message))}},k=async e=>{let{token:t,username:a}=e;try{var r;const e={token:t,username:a,typ_objektu:"OBJEDNAVKA"};n("request","states25/by-object-type",(0,o.A)((0,o.A)({},e),{},{token:t?"".concat(t.substring(0,10),"..."):"null"}));const u=(null===(r=(await s.post("states25/by-object-type",e)).data)||void 0===r?void 0:r.data)||[],d={};return u.filter(e=>e.kod_stavu&&e.nazev_stavu).forEach(e=>{d[e.kod_stavu]={kod:e.kod_stavu,nazev:e.nazev_stavu,popis:e.popis_stavu||"",raw:e}}),n("success","states25/by-object-type OBJEDNAVKA",null,{loaded_count:Object.keys(d).length,sample:Object.keys(d).slice(0,3)}),d}catch(u){throw n("error","states25/by-object-type OBJEDNAVKA",null,u.message),new Error("Chyba p\u0159i na\u010d\xedt\xe1n\xed workflow stav\u016f: ".concat(u.message))}};function _(e){if(!e)return!1;const t=e.toLowerCase().split(".").pop();return["pdf","jpg","jpeg","png","gif","bmp","webp","svg","txt","xml","json"].includes(t)}function b(e,t){try{const a=window.URL.createObjectURL(e),o=t.toLowerCase().split(".").pop();if(["pdf","jpg","jpeg","png","gif","bmp","webp","svg"].includes(o)){const e=window.open(a,"_blank");return e?(e.document.title=t,e.addEventListener("load",()=>{setTimeout(()=>{window.URL.revokeObjectURL(a)},1e3)}),!0):(window.URL.revokeObjectURL(a),!1)}{const e=document.createElement("a");return e.href=a,e.download=t||"soubor",e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),setTimeout(()=>{window.URL.revokeObjectURL(a)},100),!0}}catch(a){return console.error("Chyba p\u0159i otev\xedr\xe1n\xed/stahov\xe1n\xed souboru:",a),!1}}function y(e,t){try{const a=window.URL.createObjectURL(e),o=document.createElement("a");o.href=a,o.download=t||"priloha",document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(a)}catch(a){throw new Error("Nepoda\u0159ilo se vytvo\u0159it odkaz pro sta\u017een\xed souboru")}}async function m(e){let{token:t,username:a,userId:r,oldOrderIds:u,tabulkaObj:d="DEMO_objednavky_2025",tabulkaOpriloh:l="DEMO_pripojene_odokumenty",database:i=null}=e;if(!u||!Array.isArray(u)||0===u.length)throw new Error("Parametr oldOrderIds mus\xed b\xfdt nepr\xe1zdn\xe9 pole \u010d\xedsel");if(!t||!a)throw new Error("Token a username jsou povinn\xe9 parametry");if(!r)throw new Error("Chyb\xed ID u\u017eivatele (userId parameter)");const c={token:t,username:a,old_order_ids:u,uzivatel_id:parseInt(r,10),tabulka_obj:d,tabulka_opriloh:l};i&&(c.database=i),n("request","orders25/import-oldies",(0,o.A)((0,o.A)({},c),{},{token:"***"}));try{const e=await s.post("orders25/import-oldies",c,{timeout:3e5});if(n("success","orders25/import-oldies",c,e.data),!e.data||"object"!==typeof e.data)throw new Error("Backend vr\xe1til neplatnou odpov\u011b\u010f (nen\xed JSON objekt)");return e.data}catch(p){var v;throw n("error","orders25/import-oldies",c,(null===(v=p.response)||void 0===v?void 0:v.data)||p.message),p}}async function h(e){try{n("request","orders25/count-by-user",e);const t=await s.post("orders25/count-by-user",{token:e.token,username:e.username,user_id:e.user_id});if(n("success","orders25/count-by-user",e,t.data),!t.data||"object"!==typeof t.data)throw new Error("Backend vr\xe1til neplatnou odpov\u011b\u010f");if(t.data.err)throw new Error(t.data.err);if("ok"!==t.data.status)throw new Error("Backend vr\xe1til chybu: "+(t.data.message||"Nezn\xe1m\xe1 chyba"));return t.data}catch(r){var t,a,o;throw console.error("\u274c Count by user failed:",{message:r.message,response:null===(t=r.response)||void 0===t?void 0:t.data,status:null===(a=r.response)||void 0===a?void 0:a.status,user_id:e.user_id}),n("error","orders25/count-by-user",e,(null===(o=r.response)||void 0===o?void 0:o.data)||r.message),r}}async function w(e){let{token:t,username:a,userId:o,oldOrderIds:n,tabulkaObj:r="DEMO_objednavky_2025",tabulkaOpriloh:u="DEMO_pripojene_odokumenty",database:d=null,onProgress:l=null,onComplete:i=null,onError:c=null}=e;if(!n||!Array.isArray(n)||0===n.length)throw new Error("Parametr oldOrderIds mus\xed b\xfdt nepr\xe1zdn\xe9 pole \u010d\xedsel");if(!t||!a)throw new Error("Token a username jsou povinn\xe9 parametry");if(!o)throw new Error("Chyb\xed ID u\u017eivatele (userId parameter)");const v={token:t,username:a,old_order_ids:n,uzivatel_id:parseInt(o,10),tabulka_obj:r,tabulka_opriloh:u,streaming:!0};return d&&(v.database=d),new Promise((e,t)=>{let a=s.defaults.baseURL;if(!a){const e=new Error("\u274c CHYBA: API baseURL nen\xed definov\xe1na! Zkontrolujte REACT_APP_API2_BASE_URL v .env souboru");return c&&c(e),void t(e)}a=a.replace(/\/$/,"");const o="".concat(a,"/orders25/import-oldies");fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream"},body:JSON.stringify(v)}).then(t=>{if(!t.ok){const e="HTTP ".concat(t.status,": ").concat(t.statusText);if(404===t.status)throw new Error("\u274c API endpoint nenalezen (404)\n\nURL: ".concat(t.url,"\n\nBackend pravd\u011bpodobn\u011b:\n\u2022 Neb\u011b\u017e\xed\n\u2022 Nem\xe1 implementovan\xfd SSE endpoint /orders25/import-oldies\n\u2022 Pou\u017e\xedv\xe1 jinou URL strukturu"));throw new Error(e)}const a=t.body.getReader(),o=new TextDecoder;let s="";const n=[];let r=null;const u=t=>{let{done:d,value:v}=t;if(d)return void e(r?{results:n,imported_count:r.imported_count,updated_count:r.updated_count,failed_count:r.failed_count,total_count:r.total_count}:{results:n,imported_count:n.filter(e=>"INSERT"===e.operation).length,updated_count:n.filter(e=>"UPDATE"===e.operation).length,failed_count:n.filter(e=>"ERROR"===e.status).length,total_count:n.length});s+=o.decode(v,{stream:!0});const p=s.split("\n\n");return s=p.pop()||"",p.forEach(e=>{if(e.trim()&&e.startsWith("data: "))try{const t=e.substring(6),a=JSON.parse(t);switch(a.type){case"start":break;case"progress":a.last_result&&n.push(a.last_result),l&&l({current:a.current,total:a.total,percentage:a.percentage,imported:a.imported,updated:a.updated,failed:a.failed,last_result:a.last_result,timestamp:a.timestamp});break;case"complete":r=a,i&&i({imported_count:a.imported_count,updated_count:a.updated_count,failed_count:a.failed_count,total_count:a.total_count,timestamp:a.timestamp})}}catch(t){c&&c(new Error("Failed to parse SSE event: ".concat(t.message)))}}),a.read().then(u)};return a.read().then(u)}).catch(e=>{c&&c(e),t(e)})})}}}]);
//# sourceMappingURL=3637.b66df0c1.chunk.js.map