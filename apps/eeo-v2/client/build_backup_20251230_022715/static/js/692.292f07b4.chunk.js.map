{"version":3,"file":"static/js/692.292f07b4.chunk.js","mappings":"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","sources":["utils/isdocParser.js","utils/invoiceOCR.js","components/invoices/InvoiceAttachmentUploadButton.js","components/invoices/ISDOCDetectionBadge.js","components/invoices/InvoiceAttachmentItem.js","components/invoices/ISDOCParsingDialog.js","components/invoices/InvoiceAttachmentsSection.js","components/invoices/InvoiceAttachmentsCompact.js","components/invoices/LPCerpaniEditor.js"],"sourcesContent":["/**\n *  ISDOC Parser Utility\n *\n * Parsuje ISDOC XML soubory a extrahuje data pro faktury\n * Inspirovno: plugins/ISDOC/isdoc-to-pdf.js\n */\n\n/**\n * Parsuje ISDOC XML soubor a vrac strukturovan data\n * @param {File} file - ISDOC soubor\n * @returns {Promise<Object>} - Naparsovan data faktury\n */\nexport async function parseISDOCFile(file) {\n  try {\n    const text = await file.text();\n    const parser = new DOMParser();\n    const xmlDoc = parser.parseFromString(text, 'text/xml');\n\n    // Zkontroluj parsing errors\n    const parserError = xmlDoc.querySelector('parsererror');\n    if (parserError) {\n      throw new Error('Chyba pi parsovn ISDOC XML: ' + parserError.textContent);\n    }\n\n    // Extrahuj invoice root element\n    const invoice = xmlDoc.querySelector('Invoice') || xmlDoc.documentElement;\n\n    // === ZKLADN DAJE FAKTURY ===\n    const invoiceId = getTextContent(invoice, 'ID');\n    const issueDate = getTextContent(invoice, 'IssueDate');\n    const taxPointDate = getTextContent(invoice, 'TaxPointDate');\n\n    //  Datum splatnosti - vce variant selektor pro rzn ISDOC verze\n    const dueDate = getTextContent(invoice, [\n      'PaymentMeans Payment Details PaymentDueDate',\n      'PaymentMeans Payment Details DueDate',\n      'PaymentMeans Payment PaymentDueDate',\n      'PaymentMeans PaymentDueDate',\n      'DueDate',\n      'PaymentDueDate'\n    ].join(', '));\n\n    const note = getTextContent(invoice, 'Note');\n\n    // === DODAVATEL (AccountingSupplierParty) ===\n    const supplier = invoice.querySelector('AccountingSupplierParty Party');\n    const supplierName = getTextContent(supplier, 'PartyName Name');\n    const supplierICO = getTextContent(supplier, 'PartyIdentification RegisterIdentificationID, PartyIdentification ID');\n    const supplierDIC = getTextContent(supplier, 'PartyTaxScheme CompanyID, TaxRegistration');\n    const supplierAddress = supplier ? extractAddress(supplier.querySelector('PostalAddress')) : null;\n\n    // === ODBRATEL (AccountingCustomerParty) ===\n    const customer = invoice.querySelector('AccountingCustomerParty Party');\n    const customerName = getTextContent(customer, 'PartyName Name');\n    const customerICO = getTextContent(customer, 'PartyIdentification RegisterIdentificationID, PartyIdentification ID');\n    const customerDIC = getTextContent(customer, 'PartyTaxScheme CompanyID');\n    const customerAddress = customer ? extractAddress(customer.querySelector('PostalAddress')) : null;\n\n    //  === KONTAKTN DAJE (Email pro smrovn) ===\n    const electronicMail = getTextContent(customer, 'Contact ElectronicMail') ||\n                           getTextContent(invoice, 'AccountingCustomerParty Party Contact ElectronicMail') ||\n                           getTextContent(invoice, 'Contact ElectronicMail');\n\n    // === POLOKY FAKTURY (InvoiceLines) ===\n    const items = [];\n    const invoiceLines = invoice.querySelectorAll('InvoiceLine');\n\n    invoiceLines.forEach((line) => {\n      //  Extrahuj popis poloky (NIKDY NE SellersItemIdentification/ID!)\n      const itemElement = line.querySelector('Item');\n      let popis = '';\n      if (itemElement) {\n        // Preferuj Description, pak Name - ale NIKDY ne SellersItemIdentification\n        const descElement = itemElement.querySelector(':scope > Description');\n        const nameElement = itemElement.querySelector(':scope > Name');\n        popis = (descElement?.textContent || nameElement?.textContent || '').trim();\n      }\n\n      const item = {\n        id: getTextContent(line, 'ID'),\n        popis: popis,\n        mnozstvi: parseFloat(getTextContent(line, 'InvoicedQuantity')) || 1,\n        jednotka: getTextContent(line, 'InvoicedQuantity').match(/unitCode=\"([^\"]+)\"/)?.[1] || 'ks',\n        cena_za_jednotku: parseFloat(getTextContent(line, 'Item ClassifiedTaxCategory UnitPricePrimaryAmount, UnitPrice')) || 0,\n        cena_celkem_bez_dph: parseFloat(getTextContent(line, 'LineExtensionAmount')) || 0,\n        sazba_dph: parseFloat(getTextContent(line, 'Item ClassifiedTaxCategory Percent')) || 21,\n        cena_celkem_s_dph: 0 // Vypoteme pozdji\n      };\n\n      // Vypoti cenu s DPH\n      item.cena_celkem_s_dph = item.cena_celkem_bez_dph * (1 + item.sazba_dph / 100);\n\n      items.push(item);\n    });\n\n    // === CELKOV STKY (TaxTotal, LegalMonetaryTotal) ===\n    const taxTotal = parseFloat(getTextContent(invoice, 'TaxTotal TaxAmount')) || 0;\n    const taxExclusiveAmount = parseFloat(getTextContent(invoice, 'LegalMonetaryTotal TaxExclusiveAmount')) || 0;\n    const taxInclusiveAmount = parseFloat(getTextContent(invoice, 'LegalMonetaryTotal TaxInclusiveAmount')) || 0;\n    const payableAmount = parseFloat(getTextContent(invoice, 'LegalMonetaryTotal PayableAmount')) || taxInclusiveAmount;\n\n    //  === SLEVY (AllowanceCharge, AllowanceTotalAmount) ===\n    const allowanceTotalAmount = parseFloat(getTextContent(invoice, 'LegalMonetaryTotal AllowanceTotalAmount')) || 0;\n    const chargeTotalAmount = parseFloat(getTextContent(invoice, 'LegalMonetaryTotal ChargeTotalAmount')) || 0;\n\n    // Extrahuj jednotliv slevy/pplatky\n    const allowanceCharges = [];\n    const allowanceChargeElements = invoice.querySelectorAll('AllowanceCharge');\n    allowanceChargeElements.forEach((ac) => {\n      const chargeIndicator = getTextContent(ac, 'ChargeIndicator') === 'true';\n      const amount = parseFloat(getTextContent(ac, 'Amount')) || 0;\n      const reason = getTextContent(ac, 'AllowanceChargeReason');\n\n      if (amount > 0) {\n        allowanceCharges.push({\n          typ: chargeIndicator ? 'PRIPLATEK' : 'SLEVA',\n          castka: amount,\n          duvod: reason\n        });\n      }\n    });\n\n    //  Vypoti skutenou slevu (rozdl mezi soutem poloek a finln stkou)\n    const itemsTotalWithVat = items.reduce((sum, item) => sum + item.cena_celkem_s_dph, 0);\n    const calculatedDiscount = itemsTotalWithVat - payableAmount;\n    const actualDiscount = calculatedDiscount > 0 ? calculatedDiscount : allowanceTotalAmount;\n\n    //  Vypoti procento slevy\n    const discountPercent = itemsTotalWithVat > 0 ? (actualDiscount / itemsTotalWithVat) * 100 : 0;\n\n    // === BANKOVN DAJE (PaymentMeans) ===\n    const paymentMeans = invoice.querySelector('PaymentMeans');\n    const bankAccount = getTextContent(paymentMeans, 'PayeeFinancialAccount ID, PayeeFinancialAccount AccountNumber');\n    const bankCode = getTextContent(paymentMeans, 'PayeeFinancialAccount FinancialInstitutionBranch ID, PayeeFinancialAccount BankCode');\n    const iban = getTextContent(paymentMeans, 'PayeeFinancialAccount IBAN');\n    const swift = getTextContent(paymentMeans, 'PayeeFinancialAccount FinancialInstitutionBranch FinancialInstitution ID, PayeeFinancialAccount SWIFT');\n\n    //  Variabiln symbol - vce variant selektor pro rzn ISDOC verze\n    const variableSymbol = getTextContent(paymentMeans, [\n      'Payment Details VariableSymbol',\n      'Payment VariableSymbol',\n      'Details VariableSymbol',\n      'VariableSymbol'\n    ].join(', '));\n\n    const constantSymbol = getTextContent(paymentMeans, [\n      'Payment Details ConstantSymbol',\n      'Payment ConstantSymbol',\n      'Details ConstantSymbol',\n      'ConstantSymbol'\n    ].join(', '));\n\n    const specificSymbol = getTextContent(paymentMeans, [\n      'Payment Details SpecificSymbol',\n      'Payment SpecificSymbol',\n      'Details SpecificSymbol',\n      'SpecificSymbol'\n    ].join(', '));\n\n    // === VRCEN STRUKTUROVANCH DAT ===\n    return {\n      // Zkladn daje\n      cislo_faktury: invoiceId,\n      datum_vystaveni: issueDate,\n      datum_zdanitelneho_plneni: taxPointDate || issueDate,\n      datum_splatnosti: dueDate,\n      poznamka: note,\n\n      // Dodavatel\n      dodavatel: {\n        nazev: supplierName,\n        ico: supplierICO,\n        dic: supplierDIC,\n        adresa: supplierAddress\n      },\n\n      // Odbratel (pro kontrolu)\n      odberatel: {\n        nazev: customerName,\n        ico: customerICO,\n        dic: customerDIC,\n        adresa: customerAddress,\n        email: electronicMail //  Email pro smrovn\n      },\n\n      // Poloky\n      polozky: items,\n      pocet_polozek: items.length,\n\n      // stky\n      castka_bez_dph: taxExclusiveAmount,\n      dph_celkem: taxTotal,\n      castka_s_dph: payableAmount,\n\n      //  Slevy a pplatky\n      sleva_celkem: actualDiscount,\n      sleva_procenta: discountPercent,\n      sleva_deklarovana: allowanceTotalAmount,\n      priplatek_celkem: chargeTotalAmount,\n      slevy_a_priplatky: allowanceCharges,\n      ma_slevu: actualDiscount > 0 || allowanceTotalAmount > 0,\n      soucet_polozek_s_dph: itemsTotalWithVat,\n\n      // Platebn daje\n      platba: {\n        bankovni_ucet: bankAccount,\n        kod_banky: bankCode,\n        iban: iban,\n        swift: swift,\n        variabilni_symbol: variableSymbol,\n        konstantni_symbol: constantSymbol,\n        specificky_symbol: specificSymbol\n      },\n\n      // Meta\n      _parsed: true,\n      _parsedAt: new Date().toISOString(),\n      _fileName: file.name\n    };\n\n  } catch (error) {\n    throw new Error(`Nepodailo se naparsovat ISDOC soubor: ${error.message}`);\n  }\n}\n\n/**\n * Pomocn funkce pro zskn textovho obsahu elementu\n * Podporuje CSS selektory s fallback\n */\nfunction getTextContent(parent, selector) {\n  if (!parent) return '';\n\n  const selectors = selector.split(',').map(s => s.trim());\n\n  for (const sel of selectors) {\n    const element = parent.querySelector(sel);\n    if (element && element.textContent.trim()) {\n      return element.textContent.trim();\n    }\n  }\n\n  return '';\n}\n\n/**\n * Extrahuje adresu z PostalAddress elementu\n */\nfunction extractAddress(postalAddress) {\n  if (!postalAddress) return null;\n\n  const street = getTextContent(postalAddress, 'StreetName');\n  const buildingNumber = getTextContent(postalAddress, 'BuildingNumber');\n  const city = getTextContent(postalAddress, 'CityName');\n  const zip = getTextContent(postalAddress, 'PostalZone');\n  const country = getTextContent(postalAddress, 'Country IdentificationCode, Country Name');\n\n  const parts = [\n    street && buildingNumber ? `${street} ${buildingNumber}` : (street || buildingNumber),\n    zip && city ? `${zip} ${city}` : (zip || city),\n    country\n  ].filter(Boolean);\n\n  return parts.join(', ') || null;\n}\n\n/**\n * Formtuje ISDOC poloky do tabulkov podoby pro poznmku\n * @param {Array} polozky - Pole poloek z ISDOC\n * @returns {string} - Textov tabulka\n */\nfunction formatPolozkyToTable(polozky) {\n  if (!polozky || polozky.length === 0) return '';\n\n  const lines = [\n    '=== FAKTUROVAN POLOKY ===',\n    ''\n  ];\n\n  polozky.forEach((item, index) => {\n    lines.push(`${index + 1}. ${item.popis || 'Poloka'}`);\n    lines.push(`   Mnostv: ${item.mnozstvi} ${item.jednotka}`);\n    lines.push(`   Cena/jedn.: ${item.cena_za_jednotku.toLocaleString('cs-CZ', { minimumFractionDigits: 2 })} K`);\n    lines.push(`   Celkem bez DPH: ${item.cena_celkem_bez_dph.toLocaleString('cs-CZ', { minimumFractionDigits: 2 })} K`);\n    lines.push(`   DPH ${item.sazba_dph}%: ${((item.cena_celkem_s_dph - item.cena_celkem_bez_dph)).toLocaleString('cs-CZ', { minimumFractionDigits: 2 })} K`);\n    lines.push(`   Celkem s DPH: ${item.cena_celkem_s_dph.toLocaleString('cs-CZ', { minimumFractionDigits: 2 })} K`);\n    lines.push('');\n  });\n\n  return lines.join('\\n');\n}\n\n/**\n * Mapuje ISDOC data na strukturu faktury v naem systmu\n * @param {Object} isdocData - Data z parseISDOCFile\n * @param {Object} formData - Aktuln formData z OrderForm25\n * @returns {Object} - Namapovan data pro fakturu\n */\nexport function mapISDOCToFaktura(isdocData, formData = {}, useVariableSymbol = true) {\n  const dnesniDatum = new Date().toISOString().split('T')[0]; // YYYY-MM-DD\n\n  //  Sestavit poznmku POUZE s polokami (ZRUIT pvodn poznmku z ISDOC)\n  const polozkyText = formatPolozkyToTable(isdocData.polozky);\n\n  //  NOV LOGIKA: Vbr mezi slem faktury nebo variabilnm symbolem\n  const cisloFaVpd = useVariableSymbol\n    ? (isdocData.platba?.variabilni_symbol || isdocData.cislo_faktury || '')\n    : (isdocData.cislo_faktury || '');\n\n  return {\n    // slo faktury - podle volby uivatele (slo FA nebo variabiln symbol)\n    fa_cislo_vema: cisloFaVpd,\n\n    // Data\n    fa_datum_vystaveni: isdocData.datum_vystaveni || '',\n    fa_datum_zdanitelneho_plneni: isdocData.datum_zdanitelneho_plneni || isdocData.datum_vystaveni || '',\n    fa_datum_splatnosti: isdocData.datum_splatnosti || '',\n    fa_datum_doruceni: dnesniDatum, //  DLEIT: Aktuln datum doruen\n\n    // stky\n    fa_castka: isdocData.castka_s_dph || 0,\n    fa_castka_bez_dph: isdocData.castka_bez_dph || 0,\n    fa_dph: isdocData.dph_celkem || 0,\n\n    // Poznmka - JEN poloky, BEZ pvodn poznmky z ISDOC\n    fa_poznamka: polozkyText,\n\n    // Stediska - zkoprujeme z objednvky\n    fa_strediska_kod: formData.strediska_kod || [],\n\n    //  ISDOC raw JSON pro uloen do DB\n    isdoc_data_json: JSON.stringify(isdocData),\n\n    // Platebn daje (pro tooltip/info)\n    _isdoc_platba: isdocData.platba,\n\n    // Poloky (pro tooltip/info)\n    _isdoc_polozky: isdocData.polozky,\n    _isdoc_pocet_polozek: isdocData.pocet_polozek,\n\n    // Dodavatel (pro kontrolu)\n    _isdoc_dodavatel: isdocData.dodavatel,\n\n    //  Email smrovn (pro info bublinu)\n    _isdoc_email: isdocData.odberatel?.email,\n\n    //  Pvodn hodnoty pro info\n    _isdoc_cislo_faktury: isdocData.cislo_faktury,\n    _isdoc_variabilni_symbol: isdocData.platba?.variabilni_symbol,\n\n    // Meta\n    _isdoc_parsed: true,\n    _isdoc_parsed_at: isdocData._parsedAt,\n    _isdoc_file_name: isdocData._fileName\n  };\n}\n\n/**\n * Zjist, zda je soubor ISDOC\n * @param {File} file - Soubor k oven\n * @returns {boolean}\n */\nexport function isISDOCFile(file) {\n  if (!file) return false;\n  const extension = file.name.split('.').pop().toLowerCase();\n  return extension === 'isdoc';\n}\n\n/**\n * Vytvo souhrn ISDOC dat pro zobrazen v dialogu\n * @param {Object} isdocData - Data z parseISDOCFile\n * @returns {Object} - Souhrn pro UI\n */\nexport function createISDOCSummary(isdocData) {\n  return {\n    cislo_faktury: isdocData.cislo_faktury || '---',\n    variabilni_symbol: isdocData.platba?.variabilni_symbol || '---',\n    datum_vystaveni: isdocData.datum_vystaveni || '---',\n    dodavatel: isdocData.dodavatel?.nazev || '---',\n    castka_s_dph: isdocData.castka_s_dph\n      ? `${parseFloat(isdocData.castka_s_dph).toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K`\n      : '---',\n    pocet_polozek: isdocData.pocet_polozek || 0,\n    celkova_castka_polozek: isdocData.polozky?.reduce((sum, p) => sum + (p.cena_celkem_s_dph || 0), 0) || 0,\n    polozky: isdocData.polozky || [], //  Pidat poloky pro zobrazen\n    //  Slevy\n    ma_slevu: isdocData.ma_slevu || false,\n    sleva_celkem: isdocData.sleva_celkem || 0,\n    sleva_procenta: isdocData.sleva_procenta || 0,\n    slevy_a_priplatky: isdocData.slevy_a_priplatky || []\n  };\n}\n","import { createWorker } from 'tesseract.js';\n\n/**\n * Pevede PDF na canvas obrzek pomoc PDF.js\n */\nasync function pdfToCanvas(arrayBuffer) {\n  // Dynamicky importujeme pdfjs-dist\n  const pdfjsLib = await import('pdfjs-dist/webpack');\n  \n  console.log(` Loading PDF from ArrayBuffer (${arrayBuffer.byteLength} bytes)...`);\n  \n  // Nateme PDF z ArrayBuffer\n  const loadingTask = pdfjsLib.getDocument({ \n    data: arrayBuffer,\n    verbosity: 0 // Snme rove logovn\n  });\n  \n  const pdf = await loadingTask.promise;\n  console.log(` PDF loaded: ${pdf.numPages} pages`);\n  \n  // Zskme prvn stranu\n  const page = await pdf.getPage(1);\n  console.log(` Page 1 loaded`);\n  \n  // Nastavme viewport (scale 2 pro lep kvalitu OCR)\n  const viewport = page.getViewport({ scale: 2.0 });\n  console.log(` Viewport: ${viewport.width}x${viewport.height}px`);\n  \n  // Vytvome canvas\n  const canvas = document.createElement('canvas');\n  const context = canvas.getContext('2d');\n  canvas.width = viewport.width;\n  canvas.height = viewport.height;\n  \n  // Renderujeme strnku na canvas\n  const renderTask = page.render({\n    canvasContext: context,\n    viewport: viewport\n  });\n  \n  await renderTask.promise;\n  console.log(` PDF rendered to canvas`);\n  \n  return canvas;\n}\n\n/**\n * Extrahuje text z PDF pomoc OCR\n * @param {ArrayBuffer} arrayBuffer - PDF data jako ArrayBuffer\n * @param {Function} onProgress - Callback pro progress (0-100)\n * @returns {Promise<string>} - Extrahovan text\n */\nexport async function extractTextFromPDF(arrayBuffer, onProgress = () => {}, retryCount = 0) {\n  const MAX_RETRIES = 2;\n  const TIMEOUT_MS = 90000; // 90 sekund timeout (del kvli konverzi)\n  \n  try {\n    // Validace vstupu\n    if (!arrayBuffer || !(arrayBuffer instanceof ArrayBuffer)) {\n      throw new Error('Neplatn ArrayBuffer');\n    }\n\n    console.log(` Starting OCR extraction (${arrayBuffer.byteLength} bytes, attempt ${retryCount + 1}/${MAX_RETRIES + 1})`);\n    onProgress(0, 'Natm PDF...');\n    \n    // Validace velikosti\n    if (arrayBuffer.byteLength === 0) {\n      throw new Error('PDF soubor je przdn');\n    }\n    \n    if (arrayBuffer.byteLength < 100) {\n      throw new Error('PDF soubor je pli mal (mon nen kompletn)');\n    }\n    \n    onProgress(10, 'Pevdm PDF na obrzek...');\n    \n    // Pevedeme PDF na canvas (prvn strana)\n    let canvas;\n    try {\n      canvas = await Promise.race([\n        pdfToCanvas(arrayBuffer),\n        new Promise((_, reject) => \n          setTimeout(() => reject(new Error('Timeout pi konverzi PDF (30s)')), 30000)\n        )\n      ]);\n      console.log(` PDF converted to canvas: ${canvas.width}x${canvas.height}px`);\n    } catch (conversionError) {\n      console.error(' PDF conversion error:', conversionError);\n      \n      // Retry logic\n      if (retryCount < MAX_RETRIES) {\n        console.log(` Retrying PDF conversion (attempt ${retryCount + 2}/${MAX_RETRIES + 1})...`);\n        onProgress(5, `Opakuji pokus ${retryCount + 2}/${MAX_RETRIES + 1}...`);\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        return extractTextFromPDF(arrayBuffer, onProgress, retryCount + 1);\n      }\n      \n      throw new Error(`Nepodailo se pevst PDF na obrzek: ${conversionError.message}`);\n    }\n    \n    onProgress(30, 'Pipravuji optimalizovan OCR engine...');\n    \n    //  SINGLE OPTIMALIZOVAN PRCHOD s nejlepm nastavenm\n    let worker;\n    try {\n      worker = await Promise.race([\n        createWorker('ces', 1, {\n          logger: m => {\n            if (m.status === 'recognizing text') {\n              const progress = 30 + (m.progress * 60);\n              onProgress(progress, `Rozpoznvm text: ${Math.round(m.progress * 100)}%`);\n            }\n          }\n        }),\n        new Promise((_, reject) => \n          setTimeout(() => reject(new Error('Timeout pi inicializaci OCR (30s)')), 30000)\n        )\n      ]);\n      \n      //  OPTIMLN NASTAVEN pro faktury\n      await worker.setParameters({\n        tessedit_pageseg_mode: '3', // PSM 3 = Automatic page segmentation (nejspolehlivj)\n        preserve_interword_spaces: '1', // Zachovat mezery mezi slovy\n        tessedit_char_whitelist: '0123456789.,/:- ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz', // Povolen znaky\n      });\n      \n      console.log(` Canvas size: ${canvas.width}x${canvas.height}px (scale: 2.0x)`);\n      \n    } catch (workerError) {\n      console.error(' Worker creation error:', workerError);\n      \n      if (retryCount < MAX_RETRIES) {\n        console.log(` Retrying OCR init (attempt ${retryCount + 2}/${MAX_RETRIES + 1})...`);\n        onProgress(5, `Opakuji pokus ${retryCount + 2}/${MAX_RETRIES + 1}...`);\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        return extractTextFromPDF(arrayBuffer, onProgress, retryCount + 1);\n      }\n      \n      throw new Error('Nepodailo se spustit OCR engine. Zkuste obnovit strnku.');\n    }\n    \n    let text = '';\n    try {\n      onProgress(90, 'Dokonuji rozpoznvn...');\n      \n      // Rozpoznme text z canvas\n      const result = await Promise.race([\n        worker.recognize(canvas),\n        new Promise((_, reject) => \n          setTimeout(() => reject(new Error(`Timeout pi OCR (${TIMEOUT_MS/1000}s)`)), TIMEOUT_MS)\n        )\n      ]);\n      \n      text = result?.data?.text || '';\n      const confidence = result?.data?.confidence || 0;\n      \n      console.log(` OCR completed: ${text.length} characters, confidence: ${confidence.toFixed(1)}%`);\n      \n      if (!text || text.trim().length === 0) {\n        throw new Error('PDF neobsahuje rozpoznateln text. Dokument me bt przdn nebo ve patn kvalit.');\n      }\n    } catch (recognizeError) {\n      console.error(' Recognition error:', recognizeError);\n      \n      if (retryCount < MAX_RETRIES && !recognizeError.message.includes('Timeout')) {\n        console.log(` Retrying recognition (attempt ${retryCount + 2}/${MAX_RETRIES + 1})...`);\n        await worker.terminate();\n        return extractTextFromPDF(arrayBuffer, onProgress, retryCount + 1);\n      }\n      \n      throw new Error('OCR selhalo: ' + (recognizeError.message || 'Neznm chyba'));\n    } finally {\n      try {\n        await worker.terminate();\n      } catch (e) {\n        console.warn(' Worker termination error:', e);\n      }\n    }\n    \n    onProgress(100, 'Hotovo!');\n    \n    return text;\n  } catch (error) {\n    console.error(' OCR extraction error:', error, error.stack);\n    throw error;\n  }\n}\n\n/**\n * Vyt daje o faktue z textu\n * @param {string} text - Text z OCR\n * @returns {Object} - Vyten daje\n */\nexport function extractInvoiceData(text) {\n  const result = {\n    datumVystaveni: null,\n    datumSplatnosti: null,\n    variabilniSymbol: null,\n    castka: null,\n    isFaktura: false,\n    warning: null\n  };\n\n  // Normalizujeme text - odstrann diakritiky pro robustnj hledn\n  const normalizedText = text.toLowerCase();\n  \n  // Rozdlme na dky pro lep analzu\n  const lines = text.split('\\n').map(line => line.trim()).filter(line => line.length > 0);\n\n  // ========== DETEKCE TYPU DOKUMENTU ==========\n  // Kontrola, zda dokument obsahuje slovo \"FAKTURA\"\n  const fakturaKeywords = ['faktura', 'invoice', 'daov doklad', 'tax invoice'];\n  const isFaktura = fakturaKeywords.some(keyword => normalizedText.includes(keyword));\n  \n  result.isFaktura = isFaktura;\n  \n  if (!isFaktura) {\n    // Detekce jinch typ dokument\n    if (normalizedText.includes('objednvka') || normalizedText.includes('order')) {\n      result.warning = 'Dokument se zd bt objednvkou, ne fakturou. OCR extrakce nemus bt relevantn.';\n    } else if (normalizedText.includes('dodac list') || normalizedText.includes('delivery note')) {\n      result.warning = 'Dokument se zd bt dodacm listem, ne fakturou. OCR extrakce nemus bt relevantn.';\n    } else if (normalizedText.includes('nabdka') || normalizedText.includes('quotation')) {\n      result.warning = 'Dokument se zd bt cenovou nabdkou, ne fakturou. OCR extrakce nemus bt relevantn.';\n    } else {\n      result.warning = 'Dokument neobsahuje slovo \"FAKTURA\". Me se jednat o jin typ dokumentu (objednvku, dodac list, nabdku).';\n    }\n  }\n  \n  // ========== Hledn Variabilnho symbolu ==========\n  // Mon varianty: \"Variabiln symbol\", \"slo faktury\", \"Faktura slo\", \"VS\", \"Faktura .\"\n  const vsPatterns = [\n    /(?:variabiln[i]\\s*symbol|var\\.?\\s*symbol|vs)[:\\s]*(\\d{4,})/i,\n    /(?:slo\\s*faktury|faktura\\s*slo|faktura\\s*\\.?)[:\\s]*(\\d{4,})/i,\n    /\\b(\\d{8,})\\b/  // Fallback: 8+ slic\n  ];\n  \n  for (const pattern of vsPatterns) {\n    const match = text.match(pattern);\n    if (match && match[1]) {\n      result.variabilniSymbol = match[1].trim();\n      break;\n    }\n  }\n\n  // ========== ROBUSTN HLEDN DATUM S MULTI-LINE KONTEXTEM ==========\n  // Najdeme vechny datumy v textu a analyzujeme jejich kontext (i pes dky)\n  const allDateMatches = [];\n  \n  // Vce variant datumovch formt (pro patn OCR)\n  const dateRegex = /(\\d{1,2}[\\s./-]*\\d{1,2}[\\s./-]*\\d{4})/g;\n  let match;\n  \n  while ((match = dateRegex.exec(text)) !== null) {\n    const dateStr = match[1];\n    const startPos = match.index;\n    const endPos = startPos + dateStr.length;\n    \n    // Zskme irok kontext (100 znak ped, 50 po) pro multi-line analzu\n    const contextBefore = text.substring(Math.max(0, startPos - 100), startPos);\n    const contextAfter = text.substring(endPos, Math.min(text.length, endPos + 50));\n    const fullContext = contextBefore + ' ' + contextAfter;\n    \n    // Normalizace kontextu - odstrann nadbytench mezer/newlines\n    const normalizedContext = fullContext.toLowerCase()\n      .replace(/\\s+/g, ' ')  // Vce mezer  jedna mezera\n      .replace(/[^\\w\\s:.-]/g, ''); // Odstranit speciln znaky krom : . -\n    \n    // Parsovn data (s toleranc k mezerm)\n    const cleanDateStr = dateStr.replace(/\\s+/g, '');\n    const parsed = parseCzechDate(cleanDateStr);\n    \n    if (parsed) {\n      allDateMatches.push({\n        date: cleanDateStr,\n        originalDate: dateStr,\n        parsed,\n        contextBefore: contextBefore.toLowerCase(),\n        contextAfter: contextAfter.toLowerCase(),\n        fullContext: normalizedContext,\n        position: startPos\n      });\n    }\n  }\n  \n  console.log(` Found ${allDateMatches.length} dates in document:`);\n  allDateMatches.forEach((d, i) => {\n    console.log(`  ${i + 1}. ${d.date} (${d.parsed}) - context: ...${d.contextBefore.slice(-30)}[DATE]${d.contextAfter.slice(0, 30)}...`);\n  });\n  \n  // ========== ROBUSTN Hledn Datumu vystaven ==========\n  // Vce variant klovch slov (vetn OCR chyb: i, e, r, atd.)\n  const issueDateKeywords = [\n    // Pesn varianty - VYSOK SKRE\n    { word: 'datum vystaveni', score: 20, aliases: ['datumvystaveni', 'dat vystaveni', 'dat.vystaveni'] },\n    { word: 'datum vystaven', score: 20, aliases: ['datumvystaven'] },\n    { word: 'vystaveni dokladu', score: 18, aliases: ['vystavndokladu', 'vystaveni dokl'] },\n    { word: 'datum dokladu', score: 16, aliases: ['datdokladu', 'dat.dokladu'] },\n    { word: 'vystaveno', score: 14, aliases: ['vystavno'] },\n    { word: 'date of issue', score: 15, aliases: [] },\n    { word: 'datum vytvoreni', score: 12, aliases: ['datumvytvoreni'] },\n    { word: 'datum vytvoen', score: 12, aliases: ['datumvytvoen'] },\n    { word: 'issued', score: 10, aliases: [] },\n    // OCR typo varianty\n    { word: 'daturn vystaveni', score: 18, aliases: [] }, // OCR: mrn\n    { word: 'oatum vystaveni', score: 18, aliases: [] }, // OCR: do\n    { word: 'vystavem', score: 12, aliases: [] }, // OCR: nom\n  ];\n  \n  let bestIssueDate = null;\n  let bestIssueScore = 0;\n  let bestIssueDebug = '';\n  \n  for (const dateMatch of allDateMatches) {\n    let score = 0;\n    let foundKeywords = [];\n    \n    // Skre podle klovch slov v kontextu\n    for (const keywordObj of issueDateKeywords) {\n      const mainWord = keywordObj.word;\n      const wordScore = keywordObj.score;\n      const aliases = keywordObj.aliases || [];\n      \n      // Kontrola hlavnho slova\n      if (dateMatch.fullContext.includes(mainWord)) {\n        score += wordScore;\n        foundKeywords.push(mainWord);\n        \n        // Extra body pokud je tsn ped datem (30 znak)\n        const closeContext = dateMatch.contextBefore.slice(-30);\n        if (closeContext.includes(mainWord)) {\n          score += Math.floor(wordScore * 0.5); // +50% bonusu\n        }\n      }\n      \n      // Kontrola alias\n      for (const alias of aliases) {\n        if (dateMatch.fullContext.includes(alias)) {\n          score += Math.floor(wordScore * 0.8); // 80% skre pro alias\n          foundKeywords.push(`${alias}(alias)`);\n        }\n      }\n    }\n    \n    // SILN penalizace pro slova typick pro splatnost\n    const antiKeywords = ['splatnost', 'splatnosti', 'splatno', 'splatne', 'due date', 'payment due', \n                          'zaplatit', 'uhradit', 'uhrazen', 'zaplaceno'];\n    for (const antiWord of antiKeywords) {\n      if (dateMatch.fullContext.includes(antiWord)) {\n        score -= 30; // Zveno z 25\n        foundKeywords.push(`-${antiWord}(penalty)`);\n      }\n    }\n    \n    // SILN penalizace pro \"zdanitelnho plnn\" (asto tam je jin datum)\n    if (dateMatch.fullContext.includes('zdanitelneho') || dateMatch.fullContext.includes('zdanitelnho') ||\n        dateMatch.fullContext.includes('zdanitelne') || dateMatch.fullContext.includes('plneni')) {\n      score -= 20; // Zveno z 15\n      foundKeywords.push('-zdanitelneho/plneni(penalty)');\n    }\n    \n    // SILN penalizace pro \"dne\" bez dalho kontextu (slab indiktor)\n    const hasWeakDne = dateMatch.contextBefore.includes(' dne ') || dateMatch.contextBefore.includes(' dne:');\n    const hasStrongKeyword = foundKeywords.some(kw => \n      kw.includes('datum') || kw.includes('vystaveni') || kw.includes('dokladu')\n    );\n    if (hasWeakDne && !hasStrongKeyword) {\n      score -= 10;\n      foundKeywords.push('-weak_dne(penalty)');\n    }\n    \n    if (foundKeywords.length > 0) {\n      console.log(`   Date ${dateMatch.date}: Keywords: ${foundKeywords.join(', ')}  score: ${score}`);\n    }\n    \n    if (score > bestIssueScore) {\n      bestIssueScore = score;\n      bestIssueDate = dateMatch.parsed;\n      bestIssueDebug = `${dateMatch.date} [${foundKeywords.join(', ')}]`;\n    }\n  }\n  \n  result.datumVystaveni = bestIssueDate;\n  console.log(` Best datum vystaven: ${bestIssueDate} (score: ${bestIssueScore}) - ${bestIssueDebug}`);\n  \n  // ========== ROBUSTN Hledn Datumu splatnosti ==========\n  // Vce variant klovch slov (vetn OCR chyb)\n  const dueDateKeywords = [\n    // Pesn varianty - VYSOK SKRE\n    { word: 'datum splatnosti', score: 20, aliases: ['datumsplatnosti', 'dat splatnosti', 'dat.splatnosti'] },\n    { word: 'termin splatnosti', score: 18, aliases: ['terminsplatnosti'] },\n    { word: 'splatnost:', score: 16, aliases: ['splatnost :'] }, // S dvojtekou = silnj\n    { word: 'splatnost', score: 14, aliases: [] }, // Bez dvojteky = slab\n    { word: 'due date', score: 17, aliases: ['duedate'] },\n    { word: 'payment due', score: 17, aliases: ['paymentdue'] },\n    { word: 'splatne', score: 13, aliases: ['splatn'] },\n    { word: 'splatno', score: 13, aliases: [] },\n    { word: 'splatna dne', score: 15, aliases: ['splatnadne'] },\n    { word: 'zaplatit do', score: 12, aliases: ['zaplatitdo'] },\n    { word: 'uhradit do', score: 12, aliases: ['uhraditdo'] },\n    // OCR typo varianty\n    { word: 'oatum splatnosti', score: 18, aliases: [] }, // OCR: do\n    { word: 'splamost', score: 13, aliases: [] }, // OCR: tnm\n  ];\n  \n  let bestDueDate = null;\n  let bestDueScore = 0;\n  let bestDueDebug = '';\n  \n  for (const dateMatch of allDateMatches) {\n    let score = 0;\n    let foundKeywords = [];\n    \n    // Skre podle klovch slov v kontextu\n    for (const keywordObj of dueDateKeywords) {\n      const mainWord = keywordObj.word;\n      const wordScore = keywordObj.score;\n      const aliases = keywordObj.aliases || [];\n      \n      // Kontrola hlavnho slova\n      if (dateMatch.fullContext.includes(mainWord)) {\n        score += wordScore;\n        foundKeywords.push(mainWord);\n        \n        // Extra body pokud je tsn ped datem (30 znak)\n        const closeContext = dateMatch.contextBefore.slice(-30);\n        if (closeContext.includes(mainWord)) {\n          score += Math.floor(wordScore * 0.5); // +50% bonusu\n        }\n      }\n      \n      // Kontrola alias\n      for (const alias of aliases) {\n        if (dateMatch.fullContext.includes(alias)) {\n          score += Math.floor(wordScore * 0.8); // 80% skre pro alias\n          foundKeywords.push(`${alias}(alias)`);\n        }\n      }\n    }\n    \n    // SILN penalizace pro slova typick pro vystaven\n    const antiKeywords = ['vystaveni', 'vystaven', 'vystaveno', 'datum dokladu', 'issued', \n                          'date of issue', 'vytvoreni', 'vytvoen', 'datum vytvoreni'];\n    for (const antiWord of antiKeywords) {\n      if (dateMatch.fullContext.includes(antiWord)) {\n        score -= 30; // Zveno z 25\n        foundKeywords.push(`-${antiWord}(penalty)`);\n      }\n    }\n    \n    // SILN penalizace pro \"zdanitelnho plnn\" (nen to splatnost)\n    if (dateMatch.fullContext.includes('zdanitelneho') || dateMatch.fullContext.includes('zdanitelnho') ||\n        dateMatch.fullContext.includes('zdanitelne') || dateMatch.fullContext.includes('plneni')) {\n      score -= 20; // Zveno z 15\n      foundKeywords.push('-zdanitelneho/plneni(penalty)');\n    }\n    \n    // SILN bonus pokud je datum POZDJI ne datum vystaven (logick kontrola)\n    if (result.datumVystaveni && dateMatch.parsed > result.datumVystaveni) {\n      score += 10; // Zveno z 5\n      foundKeywords.push('+later_than_issue(+10)');\n    } else if (result.datumVystaveni && dateMatch.parsed === result.datumVystaveni) {\n      // Penalizace pokud je STEJN jako datum vystaven (nesmysl)\n      score -= 15;\n      foundKeywords.push('-same_as_issue(penalty)');\n    }\n    \n    if (foundKeywords.length > 0) {\n      console.log(`   Date ${dateMatch.date}: Keywords: ${foundKeywords.join(', ')}  score: ${score}`);\n    }\n    \n    if (score > bestDueScore) {\n      bestDueScore = score;\n      bestDueDate = dateMatch.parsed;\n      bestDueDebug = `${dateMatch.date} [${foundKeywords.join(', ')}]`;\n    }\n  }\n  \n  result.datumSplatnosti = bestDueDate;\n  console.log(` Best datum splatnosti: ${bestDueDate} (score: ${bestDueScore}) - ${bestDueDebug}`);\n\n  // ========== Hledn stky v. DPH ==========\n  // Hledme stku s oznaenm rznch variant\n  const amountPatterns = [\n    // Primrn varianty - nejpesnj\n    /(?:celkem|vetn\\s*dph|s\\s*dph|k\\s*hrad|k\\s*zaplacen)[:\\s]*(\\d+(?:[,\\s]\\d{3})*[,.]?\\d{0,2})\\s*(?:k|czk)?/i,\n    /(?:cena\\s*celkem|celkov\\s*cena|total\\s*price)[:\\s]*(\\d+(?:[,\\s]\\d{3})*[,.]?\\d{0,2})\\s*(?:k|czk)?/i,\n    // Sekundrn varianty\n    /(?:stka|cena|amount|price)[:\\s]*(\\d+(?:[,\\s]\\d{3})*[,.]?\\d{0,2})\\s*(?:k|czk)?/i,\n    // Celkem na konci dku\n    /(\\d+(?:[,\\s]\\d{3})*[,.]?\\d{2})\\s*(?:k|czk)?\\s*celkem/i,\n    // S mezerou mezi sly (formt tisce)\n    /(?:celkem|cena)[:\\s]*(\\d{1,3}(?:\\s\\d{3})*[,.]?\\d{0,2})\\s*(?:k|czk)?/i\n  ];\n  \n  for (const pattern of amountPatterns) {\n    const match = text.match(pattern);\n    if (match && match[1]) {\n      result.castka = parseAmount(match[1]);\n      break;\n    }\n  }\n\n  // Pokud jsme nenali stku s klovmi slovy, zkusme nejvt stku v dokumentu\n  if (!result.castka) {\n    const allAmounts = text.match(/(\\d+(?:[,\\s]\\d{3})*[,.]?\\d{2})\\s*(?:k|czk)/gi);\n    if (allAmounts && allAmounts.length > 0) {\n      const amounts = allAmounts.map(a => parseAmount(a));\n      result.castka = Math.max(...amounts);\n    }\n  }\n\n  return result;\n}\n\n/**\n * Parsuje esk datum do ISO formtu\n */\nfunction parseCzechDate(dateStr) {\n  // Formty: DD.MM.YYYY, DD/MM/YYYY, DD-MM-YYYY\n  const parts = dateStr.split(/[./-]/);\n  if (parts.length === 3) {\n    const day = parts[0].padStart(2, '0');\n    const month = parts[1].padStart(2, '0');\n    const year = parts[2];\n    return `${year}-${month}-${day}`;\n  }\n  return null;\n}\n\n/**\n * Parsuje stku (odstran mezery, sprvn zpracuje rky a teky)\n */\nfunction parseAmount(amountStr) {\n  if (!amountStr) return null;\n  \n  // Odstrann neselnch znak krom rky a teky\n  let cleaned = amountStr.replace(/[^\\d,.]/g, '');\n  \n  // Odstrann mezer pouvanch jako oddlovae tisc\n  cleaned = cleaned.replace(/\\s/g, '');\n  \n  //  INTELIGENTN detekce formtu:\n  // Formt: 18 400,40 nebo 18.400,40  rka = des. teka\n  // Formt: 18,400.40  teka = des. teka (EN formt)\n  \n  const commaCount = (cleaned.match(/,/g) || []).length;\n  const dotCount = (cleaned.match(/\\./g) || []).length;\n  \n  let normalized = cleaned;\n  \n  if (commaCount === 1 && dotCount === 0) {\n    // Formt: 18400,40  rka je desetinn teka (CZ)\n    normalized = cleaned.replace(',', '.');\n  } else if (commaCount === 0 && dotCount === 1) {\n    // Formt: 18400.40  teka je desetinn teka (OK)\n    normalized = cleaned;\n  } else if (commaCount > 0 && dotCount > 0) {\n    // Smen formt - zjistit, co je oddlova tisc\n    const lastCommaPos = cleaned.lastIndexOf(',');\n    const lastDotPos = cleaned.lastIndexOf('.');\n    \n    if (lastCommaPos > lastDotPos) {\n      // Posledn je rka  rka = des. teka, teky = tisce\n      // Nap: 18.400,40\n      normalized = cleaned.replace(/\\./g, '').replace(',', '.');\n    } else {\n      // Posledn je teka  teka = des. teka, rky = tisce\n      // Nap: 18,400.40\n      normalized = cleaned.replace(/,/g, '');\n    }\n  } else if (commaCount > 1) {\n    // Vce rek  vechny jsou oddlovae tisc\n    // Nap: 1,000,000  odstranme\n    normalized = cleaned.replace(/,/g, '');\n  } else if (dotCount > 1) {\n    // Vce teek  vechny jsou oddlovae tisc\n    // Nap: 1.000.000  odstranme\n    normalized = cleaned.replace(/\\./g, '');\n  }\n  \n  const result = parseFloat(normalized);\n  console.log(` parseAmount: \"${amountStr}\"  \"${cleaned}\"  \"${normalized}\"  ${result}`);\n  \n  return isNaN(result) ? null : result;\n}\n","import React, { useRef, useState } from 'react';\nimport styled from '@emotion/styled';\nimport { Upload, File, AlertCircle, CheckCircle } from 'lucide-react';\nimport {\n  isAllowedInvoiceFileType,\n  isAllowedInvoiceFileSize,\n  isISDOCFile,\n  formatFileSize\n} from '../../services/api25invoices';\n\n/**\n * InvoiceAttachmentUploadButton Component\n *\n * Upload button s podporou drag & drop pro plohy faktur\n * Validuje typ a velikost souboru ped uploadem\n * Zobraz progress bhem nahrvn\n */\n\nconst UploadContainer = styled.div`\n  position: relative;\n  width: 100%;\n`;\n\nconst UploadArea = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 24px;\n  border: 2px dashed ${props => {\n    if (props.error) return '#fca5a5';\n    if (props.isDragging) return '#3b82f6';\n    return '#cbd5e1';\n  }};\n  border-radius: 8px;\n  background: ${props => {\n    if (props.error) return '#fef2f2';\n    if (props.isDragging) return '#eff6ff';\n    return '#f8fafc';\n  }};\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &:hover {\n    border-color: ${props => props.error ? '#f87171' : '#3b82f6'};\n    background: ${props => props.error ? '#fee2e2' : '#eff6ff'};\n  }\n\n  ${props => props.uploading && `\n    opacity: 0.7;\n    pointer-events: none;\n  `}\n`;\n\nconst UploadIcon = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  background: ${props => {\n    if (props.error) return '#fee2e2';\n    if (props.isDragging) return '#dbeafe';\n    return '#e0e7ff';\n  }};\n  color: ${props => {\n    if (props.error) return '#dc2626';\n    if (props.isDragging) return '#3b82f6';\n    return '#4f46e5';\n  }};\n\n  svg {\n    width: 24px;\n    height: 24px;\n  }\n`;\n\nconst UploadText = styled.div`\n  text-align: center;\n`;\n\nconst MainText = styled.div`\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: ${props => props.error ? '#dc2626' : '#1f2937'};\n  margin-bottom: 4px;\n`;\n\nconst SubText = styled.div`\n  font-size: 0.75rem;\n  color: #6b7280;\n`;\n\nconst HiddenInput = styled.input`\n  display: none;\n`;\n\nconst ProgressBar = styled.div`\n  width: 100%;\n  height: 4px;\n  background: #e5e7eb;\n  border-radius: 2px;\n  overflow: hidden;\n  margin-top: 12px;\n`;\n\nconst ProgressFill = styled.div`\n  height: 100%;\n  background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);\n  border-radius: 2px;\n  transition: width 0.3s ease;\n  width: ${props => props.progress}%;\n`;\n\nconst Message = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  margin-top: 12px;\n  background: ${props => props.type === 'error' ? '#fef2f2' : '#f0fdf4'};\n  border: 1px solid ${props => props.type === 'error' ? '#fecaca' : '#bbf7d0'};\n  color: ${props => props.type === 'error' ? '#dc2626' : '#16a34a'};\n\n  svg {\n    width: 18px;\n    height: 18px;\n    flex-shrink: 0;\n  }\n`;\n\nconst InvoiceAttachmentUploadButton = ({\n  onUpload,\n  disabled = false,\n  maxFileSize = 10 * 1024 * 1024, // 10 MB\n  acceptedTypes = ['pdf', 'isdoc', 'jpg', 'jpeg', 'png', 'xml']\n}) => {\n  const fileInputRef = useRef(null);\n  const [isDragging, setIsDragging] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [error, setError] = useState(null);\n  const [success, setSuccess] = useState(null);\n\n  // Validace souboru\n  const validateFile = (file) => {\n    // Reset messages\n    setError(null);\n    setSuccess(null);\n\n    // Validace typu\n    if (!isAllowedInvoiceFileType(file.name)) {\n      const allowed = acceptedTypes.join(', ').toUpperCase();\n      throw new Error(`Nepodporovan formt souboru. Povolen: ${allowed}`);\n    }\n\n    // Validace velikosti\n    if (!isAllowedInvoiceFileSize(file.size)) {\n      const maxSizeFormatted = formatFileSize(maxFileSize);\n      throw new Error(`Soubor je pli velk (max ${maxSizeFormatted})`);\n    }\n\n    return true;\n  };\n\n  // Zpracovn uploadu\n  const handleFileUpload = async (file) => {\n    try {\n      validateFile(file);\n\n      setUploading(true);\n      setProgress(0);\n      setError(null);\n      setSuccess(null);\n\n      // Detekce ISDOC\n      const isISDOC = isISDOCFile(file.name);\n\n      // Simulace progressu (reln progress by byl z axios onUploadProgress)\n      const progressInterval = setInterval(() => {\n        setProgress(prev => {\n          if (prev >= 90) {\n            clearInterval(progressInterval);\n            return 90;\n          }\n          return prev + 10;\n        });\n      }, 100);\n\n      // Voln parent callback\n      if (onUpload) {\n        await onUpload(file, isISDOC);\n      }\n\n      clearInterval(progressInterval);\n      setProgress(100);\n\n      // Success message\n      const fileName = file.name;\n      const successMsg = isISDOC\n        ? `ISDOC soubor \"${fileName}\" byl spn nahrn`\n        : `Soubor \"${fileName}\" byl spn nahrn`;\n\n      setSuccess(successMsg);\n\n      // Auto-hide success message\n      setTimeout(() => {\n        setSuccess(null);\n        setProgress(0);\n        setUploading(false);\n      }, 3000);\n\n    } catch (err) {\n      setError(err.message || 'Chyba pi nahrvn souboru');\n      setUploading(false);\n      setProgress(0);\n    }\n  };\n\n  // Click handler\n  const handleClick = () => {\n    if (disabled || uploading) return;\n    fileInputRef.current?.click();\n  };\n\n  // File input change\n  const handleFileChange = (e) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      handleFileUpload(file);\n    }\n    // Reset input\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  // Drag handlers\n  const handleDragEnter = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!disabled && !uploading) {\n      setIsDragging(true);\n    }\n  };\n\n  const handleDragLeave = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(false);\n  };\n\n  const handleDragOver = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleDrop = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(false);\n\n    if (disabled || uploading) return;\n\n    const file = e.dataTransfer.files?.[0];\n    if (file) {\n      handleFileUpload(file);\n    }\n  };\n\n  return (\n    <UploadContainer>\n      <UploadArea\n        onClick={handleClick}\n        onDragEnter={handleDragEnter}\n        onDragLeave={handleDragLeave}\n        onDragOver={handleDragOver}\n        onDrop={handleDrop}\n        isDragging={isDragging}\n        uploading={uploading}\n        error={!!error}\n      >\n        <UploadIcon isDragging={isDragging} error={!!error}>\n          {error ? <AlertCircle /> : <Upload />}\n        </UploadIcon>\n\n        <UploadText>\n          <MainText error={!!error}>\n            {error ? 'Chyba pi nahrvn' :\n             isDragging ? 'Puste soubor zde' :\n             uploading ? 'Nahrvm...' :\n             'Kliknte nebo pethnte soubor'}\n          </MainText>\n\n          {!error && (\n            <SubText>\n              {uploading\n                ? `Nahrvn ${progress}%...`\n                : `Podporovan formty: ${acceptedTypes.join(', ').toUpperCase()} (max ${formatFileSize(maxFileSize)})`\n              }\n            </SubText>\n          )}\n        </UploadText>\n\n        {uploading && (\n          <ProgressBar>\n            <ProgressFill progress={progress} />\n          </ProgressBar>\n        )}\n      </UploadArea>\n\n      <HiddenInput\n        ref={fileInputRef}\n        type=\"file\"\n        accept={acceptedTypes.map(ext => `.${ext}`).join(',')}\n        onChange={handleFileChange}\n        disabled={disabled || uploading}\n      />\n\n      {error && (\n        <Message type=\"error\">\n          <AlertCircle />\n          {error}\n        </Message>\n      )}\n\n      {success && (\n        <Message type=\"success\">\n          <CheckCircle />\n          {success}\n        </Message>\n      )}\n    </UploadContainer>\n  );\n};\n\nexport default InvoiceAttachmentUploadButton;\n","import React from 'react';\nimport styled from '@emotion/styled';\nimport { FileCheck } from 'lucide-react';\n\n/**\n * ISDOCDetectionBadge Component\n *\n * Zobraz badge s informac o detekci ISDOC formtu\n * Pouv se u plohy faktury pro rychlou vizuln indikaci\n */\n\nconst Badge = styled.div`\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 4px 10px;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  background: ${props => props.detected ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : '#e5e7eb'};\n  color: ${props => props.detected ? '#ffffff' : '#6b7280'};\n  border: 1px solid ${props => props.detected ? '#059669' : '#d1d5db'};\n  transition: all 0.2s ease;\n  cursor: ${props => props.onClick ? 'pointer' : 'default'};\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n\n  &:hover {\n    ${props => props.onClick && `\n      transform: translateY(-1px);\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    `}\n  }\n`;\n\nconst TooltipWrapper = styled.div`\n  position: relative;\n  display: inline-block;\n`;\n\nconst Tooltip = styled.div`\n  position: absolute;\n  bottom: calc(100% + 8px);\n  left: 50%;\n  transform: translateX(-50%);\n  background: #1f2937;\n  color: #ffffff;\n  padding: 8px 12px;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  white-space: nowrap;\n  z-index: 1000;\n  opacity: ${props => props.show ? 1 : 0};\n  visibility: ${props => props.show ? 'visible' : 'hidden'};\n  transition: opacity 0.2s ease, visibility 0.2s ease;\n  pointer-events: none;\n\n  &::after {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    border: 6px solid transparent;\n    border-top-color: #1f2937;\n  }\n`;\n\nconst ISDOCDetectionBadge = ({\n  detected = false,\n  parsed = false,\n  onClick,\n  showTooltip = true\n}) => {\n  const [tooltipVisible, setTooltipVisible] = React.useState(false);\n\n  const getTooltipText = () => {\n    if (detected && parsed) {\n      return 'ISDOC formt - data extrahovna';\n    }\n    if (detected && !parsed) {\n      return 'ISDOC formt - detekovn (neparsovn)';\n    }\n    return 'Standardn ploha';\n  };\n\n  const getBadgeText = () => {\n    if (detected && parsed) {\n      return 'ISDOC ';\n    }\n    if (detected && !parsed) {\n      return 'ISDOC';\n    }\n    return 'PDF/IMG';\n  };\n\n  const badge = (\n    <Badge\n      detected={detected}\n      onClick={onClick}\n      onMouseEnter={() => showTooltip && setTooltipVisible(true)}\n      onMouseLeave={() => setTooltipVisible(false)}\n    >\n      {detected && <FileCheck />}\n      {getBadgeText()}\n    </Badge>\n  );\n\n  if (!showTooltip) {\n    return badge;\n  }\n\n  return (\n    <TooltipWrapper>\n      {badge}\n      <Tooltip show={tooltipVisible}>\n        {getTooltipText()}\n      </Tooltip>\n    </TooltipWrapper>\n  );\n};\n\nexport default ISDOCDetectionBadge;\n","import React, { useState } from 'react';\nimport styled from '@emotion/styled';\nimport { FileText, Download, Trash2, AlertCircle } from 'lucide-react';\nimport ISDOCDetectionBadge from './ISDOCDetectionBadge';\nimport { formatFileSize } from '../../services/api25invoices';\nimport { prettyDate } from '../../utils/format';\n\n/**\n * InvoiceAttachmentItem Component\n *\n * Jednotliv poloka v seznamu ploh faktury\n * Zobraz nzev, velikost, datum, ISDOC badge a akce (download, delete)\n */\n\nconst ItemContainer = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  background: ${props => props.deleting ? '#fef2f2' : '#ffffff'};\n  border: 1px solid ${props => props.deleting ? '#fecaca' : '#e5e7eb'};\n  border-radius: 8px;\n  transition: all 0.2s ease;\n  gap: 12px;\n\n  &:hover {\n    ${props => !props.deleting && `\n      border-color: #cbd5e1;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n    `}\n  }\n\n  ${props => props.deleting && `\n    opacity: 0.6;\n    pointer-events: none;\n  `}\n`;\n\nconst LeftSection = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  flex: 1;\n  min-width: 0;\n`;\n\nconst FileIcon = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  border-radius: 8px;\n  color: #ffffff;\n  flex-shrink: 0;\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n`;\n\nconst FileInfo = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  min-width: 0;\n  flex: 1;\n`;\n\nconst FileName = styled.div`\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #1f2937;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n`;\n\nconst FileMeta = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 0.75rem;\n  color: #6b7280;\n  flex-wrap: wrap;\n`;\n\nconst MetaItem = styled.span`\n  display: flex;\n  align-items: center;\n  gap: 4px;\n\n  &::before {\n    content: '';\n    margin-right: 4px;\n\n    &:first-of-type {\n      display: none;\n    }\n  }\n\n  &:first-of-type::before {\n    display: none;\n  }\n`;\n\nconst RightSection = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  flex-shrink: 0;\n`;\n\nconst ActionButton = styled.button`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 36px;\n  height: 36px;\n  border: none;\n  border-radius: 6px;\n  background: ${props => props.variant === 'danger' ? '#fef2f2' : '#f3f4f6'};\n  color: ${props => props.variant === 'danger' ? '#dc2626' : '#6b7280'};\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n\n  &:hover {\n    background: ${props => props.variant === 'danger' ? '#fee2e2' : '#e5e7eb'};\n    transform: translateY(-1px);\n  }\n\n  &:active {\n    transform: translateY(0);\n  }\n\n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    transform: none;\n  }\n`;\n\nconst ErrorMessage = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 12px;\n  background: #fef2f2;\n  border: 1px solid #fecaca;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  color: #dc2626;\n  margin-top: 8px;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    flex-shrink: 0;\n  }\n`;\n\nconst InvoiceAttachmentItem = ({\n  attachment,\n  onDownload,\n  onDelete,\n  readOnly = false,\n  showUploader = true\n}) => {\n  const [downloading, setDownloading] = useState(false);\n  const [deleting, setDeleting] = useState(false);\n  const [error, setError] = useState(null);\n\n  // Zpracovn downloadu\n  const handleDownload = async () => {\n    if (downloading || !onDownload) return;\n\n    setDownloading(true);\n    setError(null);\n\n    try {\n      await onDownload(attachment);\n    } catch (err) {\n      setError(err.message || 'Chyba pi stahovn souboru');\n    } finally {\n      setDownloading(false);\n    }\n  };\n\n  // Zpracovn smazn\n  const handleDelete = async () => {\n    if (!onDelete) return;\n\n    // Support both API v2 (original_name) and old API (originalni_nazev_souboru)\n    const fileName = attachment.original_name || attachment.originalni_nazev_souboru || 'tento soubor';\n    const confirmMessage = `Opravdu chcete smazat plohu \"${fileName}\"?`;\n    if (!window.confirm(confirmMessage)) return;\n\n    setDeleting(true);\n    setError(null);\n\n    try {\n      await onDelete(attachment);\n    } catch (err) {\n      setError(err.message || 'Chyba pi mazn souboru');\n      setDeleting(false);\n    }\n  };\n\n  // Zskn nzvu souboru - support both API v2 and old API\n  const fileName = attachment.original_name || attachment.originalni_nazev_souboru || 'Neznm soubor';\n\n  // Formtovn velikosti - support both API v2 (file_size) and old API (velikost_souboru_b)\n  const fileSize = formatFileSize(attachment.file_size || attachment.velikost_souboru_b || 0);\n\n  // Datum vytvoen\n  const uploadDate = attachment.dt_vytvoreni\n    ? prettyDate(attachment.dt_vytvoreni)\n    : null;\n\n  // Uivatel kter nahrl\n  const uploader = attachment.nahrano_uzivatel\n    ? `${attachment.nahrano_uzivatel.prijmeni || ''} ${attachment.nahrano_uzivatel.jmeno || ''}`.trim()\n    : null;\n\n  return (\n    <>\n      <ItemContainer deleting={deleting}>\n        <LeftSection>\n          <FileIcon>\n            <FileText />\n          </FileIcon>\n\n          <FileInfo>\n            <FileName title={fileName}>\n              {fileName}\n            </FileName>\n\n            <FileMeta>\n              <MetaItem>{fileSize}</MetaItem>\n\n              {uploadDate && (\n                <MetaItem>{uploadDate}</MetaItem>\n              )}\n\n              {showUploader && uploader && (\n                <MetaItem>{uploader}</MetaItem>\n              )}\n            </FileMeta>\n          </FileInfo>\n        </LeftSection>\n\n        <RightSection>\n          <ISDOCDetectionBadge\n            detected={attachment.je_isdoc === 1 || attachment.je_isdoc === true}\n            parsed={attachment.isdoc_parsed === 1 || attachment.isdoc_parsed === true}\n          />\n\n          <ActionButton\n            onClick={handleDownload}\n            disabled={downloading}\n            title=\"Sthnout soubor\"\n          >\n            <Download />\n          </ActionButton>\n\n          {!readOnly && (\n            <ActionButton\n              variant=\"danger\"\n              onClick={handleDelete}\n              disabled={deleting}\n              title=\"Smazat soubor\"\n            >\n              <Trash2 />\n            </ActionButton>\n          )}\n        </RightSection>\n      </ItemContainer>\n\n      {error && (\n        <ErrorMessage>\n          <AlertCircle />\n          {error}\n        </ErrorMessage>\n      )}\n    </>\n  );\n};\n\nexport default InvoiceAttachmentItem;\n","import React from 'react';\nimport styled from '@emotion/styled';\nimport { FileText, Info, AlertCircle, CheckCircle, Building, Calendar, Banknote, Package, X } from 'lucide-react';\n\n/**\n * Formtuje datum do CZ formtu DD.MM.YYYY\n */\nconst formatDateCZ = (dateString) => {\n  if (!dateString) return '---';\n\n  try {\n    const date = new Date(dateString);\n    if (isNaN(date)) return dateString; // Fallback na pvodn string\n\n    const day = String(date.getDate()).padStart(2, '0');\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const year = date.getFullYear();\n\n    return `${day}.${month}.${year}`;\n  } catch (e) {\n    return dateString;\n  }\n};\n\nconst Overlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n  animation: fadeIn 0.2s ease;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n`;\n\nconst Modal = styled.div`\n  background: #ffffff;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  max-width: 1100px;\n  width: 95%;\n  max-height: 85vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp 0.3s ease;\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n`;\n\nconst Header = styled.div`\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  color: #ffffff;\n  padding: 24px;\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  position: relative;\n`;\n\nconst CloseButton = styled.button`\n  position: absolute;\n  top: 16px;\n  right: 16px;\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  border-radius: 6px;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: background 0.2s;\n  color: #ffffff;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n`;\n\nconst HeaderIcon = styled.div`\n  width: 48px;\n  height: 48px;\n  border-radius: 10px;\n  background: rgba(255, 255, 255, 0.2);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  svg {\n    width: 28px;\n    height: 28px;\n  }\n`;\n\nconst HeaderTitle = styled.div`\n  flex: 1;\n`;\n\nconst HeaderTitleText = styled.h2`\n  margin: 0;\n  font-size: 1.375rem;\n  font-weight: 700;\n`;\n\nconst HeaderSubtitle = styled.p`\n  margin: 4px 0 0 0;\n  font-size: 0.875rem;\n  opacity: 0.95;\n`;\n\nconst Content = styled.div`\n  padding: 24px;\n  overflow-y: auto;\n  flex: 1;\n`;\n\nconst InfoBox = styled.div`\n  background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);\n  border: 1px solid #93c5fd;\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 24px;\n  display: flex;\n  gap: 12px;\n\n  svg {\n    width: 20px;\n    height: 20px;\n    color: #2563eb;\n    flex-shrink: 0;\n    margin-top: 2px;\n  }\n`;\n\nconst InfoText = styled.p`\n  margin: 0;\n  font-size: 0.875rem;\n  color: #1e40af;\n  line-height: 1.5;\n`;\n\nconst Section = styled.div`\n  margin-bottom: 24px;\n`;\n\nconst SectionTitle = styled.h3`\n  font-size: 0.9375rem;\n  font-weight: 600;\n  color: #374151;\n  margin: 0 0 12px 0;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  svg {\n    width: 18px;\n    height: 18px;\n    color: #6b7280;\n  }\n`;\n\nconst TwoColumnLayout = styled.div`\n  display: grid;\n  grid-template-columns: 400px 1fr;\n  gap: 20px;\n  margin-bottom: 16px;\n\n  @media (max-width: 900px) {\n    grid-template-columns: 1fr;\n  }\n`;\n\nconst LeftColumn = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n`;\n\nconst RightColumn = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n`;\n\nconst TopRowGrid = styled.div`\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 12px;\n`;\n\nconst DataItem = styled.div`\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 12px;\n`;\n\nconst DataLabel = styled.div`\n  font-size: 0.75rem;\n  color: #6b7280;\n  font-weight: 500;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n  margin-bottom: 6px;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    flex-shrink: 0;\n    opacity: 0.7;\n  }\n`;\n\nconst DataValue = styled.div`\n  font-size: 0.9375rem;\n  color: #111827;\n  font-weight: 600;\n\n  &.highlight {\n    color: #10b981;\n    font-size: 1.125rem;\n  }\n`;\n\nconst FullWidthItem = styled(DataItem)`\n  grid-column: 1 / -1;\n`;\n\nconst Footer = styled.div`\n  background: #f9fafb;\n  border-top: 1px solid #e5e7eb;\n  padding: 16px 24px;\n  display: flex;\n  gap: 12px;\n  justify-content: flex-end;\n`;\n\nconst Button = styled.button`\n  padding: 10px 20px;\n  border-radius: 6px;\n  font-size: 0.9375rem;\n  font-weight: 600;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  &.primary {\n    background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n    color: #ffffff;\n\n    &:hover {\n      background: linear-gradient(135deg, #059669 0%, #047857 100%);\n      transform: translateY(-1px);\n      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);\n    }\n  }\n\n  &.secondary {\n    background: #ffffff;\n    color: #374151;\n    border: 1px solid #d1d5db;\n\n    &:hover {\n      background: #f9fafb;\n      border-color: #9ca3af;\n    }\n  }\n\n  &:active {\n    transform: translateY(0);\n  }\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n`;\n\nconst WarningBox = styled.div`\n  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n  border: 1px solid #fbbf24;\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 24px;\n  display: flex;\n  gap: 12px;\n\n  svg {\n    width: 20px;\n    height: 20px;\n    color: #f59e0b;\n    flex-shrink: 0;\n    margin-top: 2px;\n  }\n`;\n\nconst WarningText = styled.p`\n  margin: 0;\n  font-size: 0.875rem;\n  color: #92400e;\n  line-height: 1.5;\n`;\n\nconst CheckboxContainer = styled.div`\n  background: #e0f2fe;\n  border: 1px solid #0ea5e9;\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 16px;\n  display: flex;\n  align-items: flex-start;\n  gap: 12px;\n`;\n\nconst CheckboxLabel = styled.label`\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  cursor: pointer;\n  font-size: 0.9375rem;\n  color: #0c4a6e;\n  font-weight: 500;\n  user-select: none;\n  flex: 1;\n\n  input[type=\"checkbox\"] {\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n    accent-color: #0ea5e9;\n  }\n\n  &:hover {\n    color: #075985;\n  }\n`;\n\nconst CheckboxHint = styled.div`\n  font-size: 0.8125rem;\n  color: #0c4a6e;\n  margin-top: 8px;\n  margin-left: 30px;\n  line-height: 1.4;\n  font-style: italic;\n  font-weight: 500;\n`;\n\nconst ItemsSection = styled.div`\n  display: flex;\n  flex-direction: column;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 12px;\n`;\n\nconst ItemsSectionTitle = styled.h3`\n  font-size: 0.8125rem;\n  font-weight: 600;\n  color: #374151;\n  margin: 0 0 8px 0;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    color: #10b981;\n  }\n`;\n\nconst ItemsList = styled.div`\n  max-height: 300px;\n  overflow-y: auto;\n  margin-top: 8px;\n\n  &::-webkit-scrollbar {\n    width: 6px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: #e5e7eb;\n    border-radius: 3px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #10b981;\n    border-radius: 3px;\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background: #059669;\n  }\n`;\n\nconst ItemRow = styled.div`\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 10px;\n  margin-bottom: 6px;\n\n  &:last-child {\n    margin-bottom: 0;\n  }\n\n  &:hover {\n    border-color: #10b981;\n    box-shadow: 0 1px 3px rgba(16, 185, 129, 0.15);\n    transform: translateX(2px);\n    transition: all 0.2s ease;\n  }\n`;\n\nconst ItemHeader = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 8px;\n`;\n\nconst ItemName = styled.div`\n  font-size: 0.9375rem;\n  font-weight: 600;\n  color: #111827;\n  flex: 1;\n`;\n\nconst ItemPrice = styled.div`\n  font-size: 0.9375rem;\n  font-weight: 700;\n  color: #10b981;\n  white-space: nowrap;\n  margin-left: 16px;\n`;\n\nconst ItemDetails = styled.div`\n  display: flex;\n  gap: 16px;\n  flex-wrap: wrap;\n  font-size: 0.8125rem;\n  color: #6b7280;\n`;\n\nconst ItemDetail = styled.span`\n  display: flex;\n  align-items: center;\n  gap: 4px;\n\n  strong {\n    color: #374151;\n  }\n`;\n\n/**\n * ISDOCParsingDialog Component\n *\n * Dialog pro potvrzen extrakce dat z ISDOC souboru\n * Zobrazuje nhled dat a pt se uivatele, zda chce data vyplnit\n */\nconst ISDOCParsingDialog = ({\n  isdocSummary,\n  isdocData,\n  onConfirm,\n  onCancel,\n  onUploadWithoutParsing\n}) => {\n  //  State pro checkbox - vchoz hodnota TRUE (variabiln symbol)\n  const [useVariableSymbol, setUseVariableSymbol] = React.useState(true);\n\n  //  Zskat poloky z isdocData nebo isdocSummary\n  const polozky = isdocData?.polozky || isdocSummary?.polozky || [];\n\n  return (\n    <Overlay onClick={(e) => e.stopPropagation()}>\n      <Modal onClick={(e) => e.stopPropagation()}>\n        <Header>\n          <HeaderIcon>\n            <FileText />\n          </HeaderIcon>\n          <HeaderTitle>\n            <HeaderTitleText>Detekovn ISDOC formt!</HeaderTitleText>\n            <HeaderSubtitle>Elektronick faktura byla spn natena</HeaderSubtitle>\n          </HeaderTitle>\n          <CloseButton onClick={onCancel} aria-label=\"Zavt\">\n            <X />\n          </CloseButton>\n        </Header>\n\n        <Content>\n          <InfoBox>\n            <Info />\n            <InfoText>\n              ISDOC je standardn formt pro elektronickou vmnu faktur.\n              Systm me automaticky vyplnit daje faktury z tohoto souboru.\n            </InfoText>\n          </InfoBox>\n\n          {/*  DVOUSLOUPCOV LAYOUT: LEV (pod sebou) + PRAV (dodavatel + poloky) */}\n          <TwoColumnLayout>\n            {/* LEV STRANA - 22 GRID (50/50) */}\n            <LeftColumn>\n              <TopRowGrid>\n                <DataItem>\n                  <DataLabel>\n                    <Calendar />\n                    Datum vystaven\n                  </DataLabel>\n                  <DataValue>{formatDateCZ(isdocSummary.datum_vystaveni)}</DataValue>\n                </DataItem>\n\n                <DataItem>\n                  <DataLabel>\n                    <Banknote />\n                    Celkov stka\n                  </DataLabel>\n                  <DataValue className=\"highlight\">\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px', flexWrap: 'wrap' }}>\n                      <span>{isdocSummary.castka_s_dph}</span>\n                      {isdocSummary.ma_slevu && isdocSummary.sleva_celkem > 0 && (\n                        <span style={{\n                          fontSize: '0.75rem',\n                          color: '#059669',\n                          fontWeight: 500,\n                          display: 'inline-flex',\n                          alignItems: 'center',\n                          gap: '4px'\n                        }}>\n                           Sleva: -{isdocSummary.sleva_celkem.toLocaleString('cs-CZ', {\n                            minimumFractionDigits: 2\n                          })} K\n                          {isdocSummary.sleva_procenta > 0 && (\n                            <span style={{\n                              fontSize: '0.7rem',\n                              opacity: 0.8\n                            }}>\n                              ({isdocSummary.sleva_procenta.toFixed(1)}%)\n                            </span>\n                          )}\n                        </span>\n                      )}\n                    </div>\n                  </DataValue>\n                </DataItem>\n              </TopRowGrid>\n\n              <TopRowGrid>\n                <DataItem>\n                  <DataLabel>\n                    <FileText />\n                    slo faktury\n                  </DataLabel>\n                  <DataValue>{isdocSummary.cislo_faktury}</DataValue>\n                </DataItem>\n\n                <DataItem>\n                  <DataLabel>\n                    <FileText />\n                    Variabiln symbol\n                  </DataLabel>\n                  <DataValue>{isdocSummary.variabilni_symbol}</DataValue>\n                </DataItem>\n              </TopRowGrid>\n            </LeftColumn>\n\n            {/* PRAV STRANA - Dodavatel + Poet na jednom dku, pak poloky */}\n            <RightColumn>\n              {/* Prvn dek: Dodavatel + Poet poloek */}\n              <TopRowGrid>\n                <DataItem>\n                  <DataLabel>\n                    <Building />\n                    Dodavatel\n                  </DataLabel>\n                  <DataValue>{isdocSummary.dodavatel}</DataValue>\n                </DataItem>\n\n                <DataItem>\n                  <DataLabel>\n                    <Package />\n                    Poet poloek\n                  </DataLabel>\n                  <DataValue>{isdocSummary.pocet_polozek}</DataValue>\n                </DataItem>\n              </TopRowGrid>\n\n              {/* Poloky - pes celou ku */}\n              {polozky && polozky.length > 0 && (\n                <ItemsSection>\n                  <ItemsSectionTitle>\n                    <Package />\n                    Poloky faktury\n                  </ItemsSectionTitle>\n                  <ItemsList>\n                    {polozky.map((polozka, index) => (\n                      <ItemRow key={index}>\n                        <ItemHeader>\n                          <ItemName>\n                            {index + 1}. {polozka.popis || 'Poloka bez popisu'}\n                          </ItemName>\n                          <ItemPrice>\n                            {polozka.cena_celkem_s_dph?.toLocaleString('cs-CZ', {\n                              minimumFractionDigits: 2,\n                              maximumFractionDigits: 2\n                            })} K\n                          </ItemPrice>\n                        </ItemHeader>\n                        <ItemDetails>\n                          <ItemDetail>\n                            <strong>Mnostv:</strong> {polozka.mnozstvi} {polozka.jednotka}\n                          </ItemDetail>\n                          <ItemDetail>\n                            <strong>Cena/jedn.:</strong> {polozka.cena_za_jednotku?.toLocaleString('cs-CZ', {\n                              minimumFractionDigits: 2\n                            })} K\n                          </ItemDetail>\n                          <ItemDetail>\n                            <strong>Bez DPH:</strong> {polozka.cena_celkem_bez_dph?.toLocaleString('cs-CZ', {\n                              minimumFractionDigits: 2\n                            })} K\n                          </ItemDetail>\n                          <ItemDetail>\n                            <strong>DPH:</strong> {polozka.sazba_dph}%\n                          </ItemDetail>\n                        </ItemDetails>\n                      </ItemRow>\n                    ))}\n                  </ItemsList>\n                </ItemsSection>\n              )}\n            </RightColumn>\n          </TwoColumnLayout>\n\n          {/*  CHECKBOX PRO VBR MEZI SLEM FAKTURY A VARIABILNM SYMBOLEM */}\n          <CheckboxContainer>\n            <div style={{ flex: 1 }}>\n              <CheckboxLabel>\n                <input\n                  type=\"checkbox\"\n                  checked={useVariableSymbol}\n                  onChange={(e) => setUseVariableSymbol(e.target.checked)}\n                />\n                <span>\n                  Do pole <strong>slo FA/VPD</strong> pout <strong>variabiln symbol</strong> msto sla faktury\n                </span>\n              </CheckboxLabel>\n              <CheckboxHint>\n                {useVariableSymbol\n                  ? ` Bude pouit variabiln symbol: ${isdocSummary.variabilni_symbol}`\n                  : ` Bude pouito slo faktury: ${isdocSummary.cislo_faktury}`\n                }\n              </CheckboxHint>\n            </div>\n          </CheckboxContainer>\n\n          <WarningBox>\n            <AlertCircle />\n            <WarningText>\n              <strong>Datum doruen</strong> bude automaticky nastaven na dnen datum.\n              Po vyplnn daj zkontrolujte vechna pole ped uloenm!\n            </WarningText>\n          </WarningBox>\n        </Content>\n\n        <Footer>\n          <Button className=\"secondary\" onClick={onUploadWithoutParsing}>\n            Nahrt bez extrakce\n          </Button>\n          <Button className=\"secondary\" onClick={onCancel}>\n            Zruit\n          </Button>\n          <Button className=\"primary\" onClick={() => onConfirm(useVariableSymbol)}>\n            <CheckCircle />\n            Vyplnit daje faktury\n          </Button>\n        </Footer>\n      </Modal>\n    </Overlay>\n  );\n};\n\nexport default ISDOCParsingDialog;\n","import React, { useState, useEffect, useContext } from 'react';\nimport ReactDOM from 'react-dom';\nimport styled from '@emotion/styled';\nimport { Paperclip, ChevronDown, ChevronUp, AlertCircle, Loader } from 'lucide-react';\nimport InvoiceAttachmentUploadButton from './InvoiceAttachmentUploadButton';\nimport InvoiceAttachmentItem from './InvoiceAttachmentItem';\nimport ISDOCParsingDialog from './ISDOCParsingDialog';\nimport {\n  uploadInvoiceAttachment25,\n  listInvoiceAttachments25,\n  downloadInvoiceAttachment25,\n  deleteInvoiceAttachment25\n} from '../../services/api25invoices';\nimport { AuthContext } from '../../context/AuthContext';\nimport { ToastContext } from '../../context/ToastContext';\nimport { parseISDOCFile, isISDOCFile, createISDOCSummary } from '../../utils/isdocParser';\n\n/**\n * InvoiceAttachmentsSection Component\n *\n * Hlavn komponenta pro sprvu ploh faktury\n * Zahrnuje: seznam ploh, upload, download, delete\n * Automaticky nate plohy pi mount nebo zmn faktura_id\n */\n\nconst Section = styled.div`\n  margin-top: 16px;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  background: #ffffff;\n  overflow: hidden;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n  border-bottom: 1px solid #e5e7eb;\n  cursor: pointer;\n  user-select: none;\n  transition: background 0.2s ease;\n\n  &:hover {\n    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);\n  }\n`;\n\nconst HeaderLeft = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 10px;\n`;\n\nconst HeaderIcon = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  color: #ffffff;\n\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n`;\n\nconst HeaderTitle = styled.div`\n  font-size: 0.9375rem;\n  font-weight: 600;\n  color: #1f2937;\n`;\n\nconst Badge = styled.span`\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 20px;\n  height: 20px;\n  padding: 0 6px;\n  border-radius: 10px;\n  background: #3b82f6;\n  color: #ffffff;\n  font-size: 0.75rem;\n  font-weight: 600;\n  margin-left: 8px;\n`;\n\nconst ToggleIcon = styled.div`\n  display: flex;\n  align-items: center;\n  color: #6b7280;\n  transition: transform 0.2s ease;\n\n  svg {\n    width: 20px;\n    height: 20px;\n  }\n`;\n\nconst Content = styled.div`\n  padding: 16px;\n  display: ${props => props.collapsed ? 'none' : 'block'};\n`;\n\nconst UploadSection = styled.div`\n  margin-bottom: ${props => props.hasAttachments ? '20px' : '0'};\n`;\n\nconst AttachmentsList = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n`;\n\nconst EmptyState = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 32px 16px;\n  text-align: center;\n  color: #6b7280;\n  gap: 8px;\n\n  svg {\n    width: 48px;\n    height: 48px;\n    opacity: 0.3;\n  }\n`;\n\nconst EmptyText = styled.div`\n  font-size: 0.875rem;\n  font-weight: 500;\n`;\n\nconst LoadingState = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 32px 16px;\n  gap: 12px;\n  color: #6b7280;\n  font-size: 0.875rem;\n\n  svg {\n    width: 20px;\n    height: 20px;\n    animation: spin 1s linear infinite;\n  }\n\n  @keyframes spin {\n    from { transform: rotate(0deg); }\n    to { transform: rotate(360deg); }\n  }\n`;\n\nconst ErrorState = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  background: #fef2f2;\n  border: 1px solid #fecaca;\n  border-radius: 6px;\n  color: #dc2626;\n  font-size: 0.875rem;\n\n  svg {\n    width: 18px;\n    height: 18px;\n    flex-shrink: 0;\n  }\n`;\n\nconst InvoiceAttachmentsSection = ({\n  fakturaId,\n  objednavkaId,\n  readOnly = false,\n  onAttachmentsChange,\n  defaultCollapsed = false,\n  onISDOCParsed //  Callback pro vyplnn faktury z ISDOC\n}) => {\n  const { username, token } = useContext(AuthContext);\n  const { addToast } = useContext(ToastContext);\n\n  const [collapsed, setCollapsed] = useState(defaultCollapsed);\n  const [loading, setLoading] = useState(false);\n  const [attachments, setAttachments] = useState([]);\n  const [error, setError] = useState(null);\n\n  //  ISDOC parsing state\n  const [showISDOCDialog, setShowISDOCDialog] = useState(false);\n  const [pendingISDOCFile, setPendingISDOCFile] = useState(null);\n  const [isdocSummary, setIsdocSummary] = useState(null);\n\n  // Naten ploh pi mount nebo zmn faktura_id\n  useEffect(() => {\n    if (fakturaId) {\n      loadAttachments();\n    } else {\n      setAttachments([]);\n    }\n  }, [fakturaId]);\n\n  // Naten ploh z API\n  const loadAttachments = async () => {\n    if (!fakturaId) return;\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      const response = await listInvoiceAttachments25({\n        token: token,\n        username: username,\n        faktura_id: fakturaId,\n        objednavka_id: objednavkaId //  PIDNO pro nov Order V2 API\n      });\n\n      //  V2 API response structure: response.data.attachments\n      const attachmentsList = response?.data?.attachments || response.prilohy || [];\n\n      //  DEBUG: Kompletn vpis vech ploh\n\n      //  Kontrola existence fyzickch soubor\n      const processedAttachments = attachmentsList.map(att => {\n        const fileExists = att.file_exists !== false; // Backend by ml vrtit file_exists: false pokud soubor chyb\n        const hasError = att.error || att.file_error;\n\n        if (!fileExists || hasError) {\n          console.warn(' Ploha faktury m problm:', {\n            id: att.id,\n            name: att.original_name || att.originalni_nazev_souboru,\n            file_exists: fileExists,\n            error: hasError,\n            path: att.systemova_cesta\n          });\n        }\n\n        return {\n          ...att,\n          file_exists: fileExists,\n          error: hasError || (!fileExists ? 'Fyzick soubor chyb na disku' : null)\n        };\n      });\n\n      setAttachments(processedAttachments);\n\n      // Callback pro parent\n      if (onAttachmentsChange) {\n        onAttachmentsChange(processedAttachments);\n      }\n\n    } catch (err) {\n      setError(err.message || 'Chyba pi natn ploh');\n      addToast?.('error', 'Chyba pi natn ploh faktury');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Upload handler\n  const handleUpload = async (file, isISDOC) => {\n    if (!fakturaId || !objednavkaId) {\n      throw new Error('Chyb ID faktury nebo objednvky');\n    }\n\n    try {\n      //  Pokud je ISDOC, nabdnout parsing\n      if (isISDOC && onISDOCParsed) {\n        // Naparsovat ISDOC\n        try {\n          const isdocData = await parseISDOCFile(file);\n          const summary = createISDOCSummary(isdocData);\n\n          // Uloit pro pozdj pouit\n          setPendingISDOCFile({ file, isdocData });\n          setIsdocSummary(summary);\n          setShowISDOCDialog(true);\n\n          // Nechat uivatele rozhodnout v dialogu\n          return;\n\n        } catch (parseError) {\n          addToast?.('warning', 'Nepodailo se naparsovat ISDOC soubor. Nahrno jako bn ploha.');\n          // Pokraovat jako bn upload\n        }\n      }\n\n      // Bn upload (nebo ISDOC bez parsingu)\n      await performUpload(file, isISDOC);\n\n    } catch (err) {\n      addToast?.('error', err.message || 'Chyba pi nahrvn plohy');\n      throw err;\n    }\n  };\n\n  // Provede skuten upload na server\n  const performUpload = async (file, isISDOC) => {\n    // Uren typu plohy\n    const typ_prilohy = isISDOC ? 'ISDOC' : 'FAKTURA';\n\n    const response = await uploadInvoiceAttachment25({\n      token: token,\n      username: username,\n      faktura_id: fakturaId,\n      objednavka_id: objednavkaId,\n      typ_prilohy: typ_prilohy,\n      file: file\n    });\n\n\n    addToast?.('success', isISDOC\n      ? 'ISDOC soubor byl spn nahrn'\n      : 'Ploha byla spn nahrna'\n    );\n\n    // Reload attachments\n    await loadAttachments();\n  };\n\n  //  Potvrzen ISDOC parsingu - vyplnit fakturu\n  const handleISDOCConfirm = async () => {\n    if (!pendingISDOCFile) return;\n\n    try {\n      const { file, isdocData } = pendingISDOCFile;\n\n      // 1. Zavolat callback pro vyplnn faktury\n      if (onISDOCParsed) {\n        onISDOCParsed(isdocData);\n      }\n\n      // 2. Nahrt ISDOC soubor jako plohu\n      await performUpload(file, true);\n\n      // 3. Zavt dialog\n      setShowISDOCDialog(false);\n      setPendingISDOCFile(null);\n      setIsdocSummary(null);\n\n      addToast?.('success', 'ISDOC faktura byla spn natena a daje vyplnny');\n\n    } catch (err) {\n      addToast?.('error', err.message || 'Chyba pi zpracovn ISDOC');\n    }\n  };\n\n  //  Nahrt ISDOC bez parsingu\n  const handleISDOCUploadWithoutParsing = async () => {\n    if (!pendingISDOCFile) return;\n\n    try {\n      const { file } = pendingISDOCFile;\n\n      // Nahrt jako bnou plohu\n      await performUpload(file, true);\n\n      // Zavt dialog\n      setShowISDOCDialog(false);\n      setPendingISDOCFile(null);\n      setIsdocSummary(null);\n\n    } catch (err) {\n      addToast?.('error', err.message || 'Chyba pi nahrvn ISDOC');\n    }\n  };\n\n  //  Zruen ISDOC dialogu\n  const handleISDOCCancel = () => {\n    setShowISDOCDialog(false);\n    setPendingISDOCFile(null);\n    setIsdocSummary(null);\n  };\n\n  // Download handler\n  const handleDownload = async (attachment) => {\n    try {\n      const blob = await downloadInvoiceAttachment25({\n        token: token,\n        username: username,\n        faktura_id: fakturaId, //  Order V2 API\n        priloha_id: attachment.id,\n        objednavka_id: objednavkaId //  Order V2 API - required\n      });\n\n      // Nzev souboru - support both API v2 and old API\n      const filename = attachment.original_name || attachment.originalni_nazev_souboru || 'priloha.pdf';\n\n      // Importovat utility funkce\n      const { isPreviewableInBrowser, openInBrowser25 } = await import('../../services/api25orders');\n\n      // Zkontrolovat, zda lze soubor zobrazit v prohlei\n      if (isPreviewableInBrowser(filename)) {\n        const opened = openInBrowser25(blob, filename);\n        \n        if (opened) {\n          // Nabdnout monost staen\n          const shouldDownload = window.confirm(\n            `Ploha \"${filename}\" byla otevena v novm okn.\\n\\nChcete ji tak sthnout?`\n          );\n          \n          if (shouldDownload) {\n            // Create download link\n            const url = window.URL.createObjectURL(blob);\n            const link = document.createElement('a');\n            link.href = url;\n            link.download = filename;\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n            window.URL.revokeObjectURL(url);\n            \n            addToast?.('success', 'Soubor byl staen');\n          }\n          return;\n        }\n      }\n\n      // Pokud nelze zobrazit v prohlei, pmo sthnout\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n\n      addToast?.('success', 'Soubor byl staen');\n\n    } catch (err) {\n      addToast?.('error', err.message || 'Chyba pi stahovn plohy');\n      throw err;\n    }\n  };\n\n  // Delete handler\n  const handleDelete = async (attachment) => {\n    try {\n      //  HARD DELETE - fyzick smazn souboru z disku i DB\n      const response = await deleteInvoiceAttachment25({\n        token: token,\n        username: username,\n        faktura_id: fakturaId, //  Order V2 API\n        priloha_id: attachment.id,\n        objednavka_id: objednavkaId, //  Order V2 API - required\n        hard_delete: 1 //  HARD DELETE - smae soubor z disku\n      });\n\n\n      //  Kontrola response ped reloadem\n      if (response && (response.status === 'ok' || response.status === 'success')) {\n        // Log informac o smazn\n        if (response.data) {\n          const { file_existed, file_deleted_from_disk, db_record_deleted } = response.data;\n\n          //  Zobrazit detailn toast notifikaci podle BE response\n          if (db_record_deleted) {\n            if (file_existed && file_deleted_from_disk) {\n              //  Scn 1: Ve OK\n              addToast?.('success', ' Ploha spn smazna (DB + soubor)');\n            } else if (!file_existed) {\n              //  Scn 2: Soubor u neexistoval\n              addToast?.('warning', ' DB zznam smazn, ale soubor ji na disku neexistoval');\n            } else if (file_existed && !file_deleted_from_disk) {\n              //  Scn 3: Chyba oprvnn\n              addToast?.('warning', ' DB zznam smazn, ale soubor se nepodailo smazat z disku');\n            } else {\n              addToast?.('success', 'Ploha smazna z databze');\n            }\n          } else {\n            addToast?.('error', ' Nepodailo se smazat DB zznam');\n          }\n\n          // Zobrazit warning pokud je v response\n          if (response.warning) {\n          }\n        } else {\n          addToast?.('success', 'Ploha byla smazna');\n        }\n\n        // Reload attachments\n        await loadAttachments();\n      } else {\n        throw new Error(response?.message || 'Neoekvan odpov serveru');\n      }\n\n    } catch (err) {\n      addToast?.('error', ` Chyba pi mazn: ${err.message}`);\n      throw err;\n    }\n  };\n\n  const hasAttachments = attachments.length > 0;\n\n  return (\n    <>\n      <Section>\n        <Header onClick={() => setCollapsed(!collapsed)}>\n          <HeaderLeft>\n            <HeaderIcon>\n              <Paperclip />\n            </HeaderIcon>\n            <HeaderTitle>\n              Plohy faktury\n              {hasAttachments && <Badge>{attachments.length}</Badge>}\n            </HeaderTitle>\n          </HeaderLeft>\n\n          <ToggleIcon>\n            {collapsed ? <ChevronDown /> : <ChevronUp />}\n          </ToggleIcon>\n        </Header>\n\n        <Content collapsed={collapsed}>\n          {/* Upload sekce - VDY dostupn pokud nen readOnly */}\n          {!readOnly && (\n            <UploadSection hasAttachments={hasAttachments}>\n              <InvoiceAttachmentUploadButton\n                onUpload={handleUpload}\n                disabled={loading}\n              />\n            </UploadSection>\n          )}\n\n          {/* Error state */}\n          {error && (\n            <ErrorState>\n              <AlertCircle />\n              {error}\n            </ErrorState>\n          )}\n\n          {/* Loading state */}\n          {loading && (\n            <LoadingState>\n              <Loader />\n              Natm plohy...\n            </LoadingState>\n          )}\n\n          {/* Attachments list */}\n          {!loading && hasAttachments && (\n            <AttachmentsList>\n              {attachments.map((attachment) => (\n                <InvoiceAttachmentItem\n                  key={attachment.id}\n                  attachment={attachment}\n                  onDownload={handleDownload}\n                  onDelete={handleDelete}\n                  readOnly={readOnly}\n                />\n              ))}\n            </AttachmentsList>\n          )}\n\n          {/* Empty state */}\n          {!loading && !error && !hasAttachments && (\n            <EmptyState>\n              <Paperclip />\n              <EmptyText>\n                {readOnly\n                  ? 'Zatm nebyly nahrny dn plohy'\n                  : 'Nahrajte plohy k tto faktue'\n                }\n              </EmptyText>\n            </EmptyState>\n          )}\n        </Content>\n      </Section>\n\n      {/*  ISDOC Parsing Dialog */}\n      {showISDOCDialog && isdocSummary && ReactDOM.createPortal(\n        <ISDOCParsingDialog\n          isdocSummary={isdocSummary}\n          onConfirm={handleISDOCConfirm}\n          onCancel={handleISDOCCancel}\n          onUploadWithoutParsing={handleISDOCUploadWithoutParsing}\n        />,\n        document.body\n      )}\n    </>\n  );\n};\n\nexport default InvoiceAttachmentsSection;\n","import React, { useState, useEffect, useContext, useCallback, useMemo } from 'react';\nimport ReactDOM from 'react-dom';\nimport styled from '@emotion/styled';\nimport { Paperclip, Upload, Download, Trash2, AlertCircle, Loader, FileText, FileX, X, Info, AlertTriangle, CheckCircle2, ExternalLink, Sparkles } from 'lucide-react';\nimport {\n  uploadInvoiceAttachment25,\n  listInvoiceAttachments25,\n  downloadInvoiceAttachment25,\n  deleteInvoiceAttachment25,\n  updateInvoiceAttachment25,\n  verifyInvoiceAttachments25,\n  createInvoiceWithAttachment25,\n  isAllowedInvoiceFileType,\n  isAllowedInvoiceFileSize,\n  isISDOCFile,\n  formatFileSize\n} from '../../services/api25invoices';\nimport { AuthContext } from '../../context/AuthContext';\nimport { ToastContext } from '../../context/ToastContext';\nimport { prettyDate } from '../../utils/format';\nimport ISDOCParsingDialog from './ISDOCParsingDialog';\nimport { parseISDOCFile, createISDOCSummary, mapISDOCToFaktura } from '../../utils/isdocParser';\nimport ConfirmDialog from '../ConfirmDialog'; //  Vlastn confirm dialog\nimport { extractTextFromPDF, extractInvoiceData } from '../../utils/invoiceOCR'; //  OCR\n\n/**\n * InvoiceAttachmentsCompact Component\n *\n * PESN PODLE VZORU OBJEDNVKY PLOH:\n * - attachments[] array (lokln + server)\n * - status: 'pending_classification' | 'uploaded'\n * - Klasifikace ped uploadem pomoc <select>\n */\n\nconst Wrapper = styled.div`\n  margin-top: 16px;\n  padding-top: 16px;\n  border-top: 1px solid #e5e7eb;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 12px;\n`;\n\nconst Title = styled.div`\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #374151;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  svg {\n    width: 16px;\n    height: 16px;\n    color: #3b82f6;\n  }\n`;\n\nconst Badge = styled.span`\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 18px;\n  height: 18px;\n  padding: 0 6px;\n  border-radius: 9px;\n  background: #3b82f6;\n  color: #ffffff;\n  font-size: 0.6875rem;\n  font-weight: 600;\n  margin-left: 6px;\n`;\n\nconst DropZone = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 16px;\n  margin-bottom: 12px;\n  border: 2px dashed ${props => props.isDragging ? '#3b82f6' : '#d1d5db'};\n  border-radius: 8px;\n  background: ${props => props.isDragging ? '#eff6ff' : '#ffffff'};\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &:hover {\n    border-color: #3b82f6;\n    background: #f0f9ff;\n  }\n\n  ${props => props.disabled && `\n    opacity: 0.5;\n    cursor: not-allowed;\n    &:hover {\n      border-color: #d1d5db;\n      background: #ffffff;\n    }\n  `}\n`;\n\nconst DropZoneIcon = styled.div`\n  font-size: 1.5rem;\n  color: ${props => props.isDragging ? '#3b82f6' : '#9ca3af'};\n`;\n\nconst DropZoneText = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n`;\n\nconst DropZoneTitle = styled.div`\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: #374151;\n`;\n\nconst DropZoneSubtitle = styled.div`\n  font-size: 0.75rem;\n  color: #9ca3af;\n`;\n\nconst HiddenInput = styled.input`\n  display: none;\n`;\n\nconst AttachmentsList = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n`;\n\nconst AttachmentItem = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 10px 12px;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  gap: 12px;\n  transition: all 0.2s ease;\n\n  &:hover {\n    border-color: #cbd5e1;\n    background: #f3f4f6;\n  }\n`;\n\nconst AttachmentLeft = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  flex: 1;\n  min-width: 0;\n`;\n\nconst AttachmentIcon = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  border-radius: 6px;\n  color: #ffffff;\n  flex-shrink: 0;\n\n  svg {\n    width: 16px;\n    height: 16px;\n  }\n`;\n\nconst AttachmentInfo = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n  min-width: 0;\n  flex: 1;\n`;\n\nconst AttachmentName = styled.div`\n  font-size: 0.8125rem;\n  font-weight: 500;\n  color: #1f2937;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n`;\n\nconst AttachmentMeta = styled.div`\n  font-size: 0.6875rem;\n  color: #6b7280;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n`;\n\nconst ISDOCBadge = styled.span`\n  display: inline-flex;\n  align-items: center;\n  padding: 2px 6px;\n  border-radius: 4px;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  color: #ffffff;\n  font-size: 0.625rem;\n  font-weight: 600;\n`;\n\nconst AttachmentActions = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  flex-shrink: 0;\n`;\n\nconst ActionButton = styled.button`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 28px;\n  height: 28px;\n  border: none;\n  border-radius: 4px;\n  background: ${props => props.variant === 'danger' ? '#fef2f2' : '#ffffff'};\n  color: ${props => props.variant === 'danger' ? '#dc2626' : '#6b7280'};\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  svg {\n    width: 14px;\n    height: 14px;\n  }\n\n  &:hover {\n    background: ${props => props.variant === 'danger' ? '#fee2e2' : '#f3f4f6'};\n    transform: translateY(-1px);\n  }\n\n  &:active {\n    transform: translateY(0);\n  }\n\n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    transform: none;\n  }\n`;\n\nconst EmptyState = styled.div`\n  padding: 16px;\n  text-align: center;\n  color: #9ca3af;\n  font-size: 0.8125rem;\n  background: #f9fafb;\n  border: 1px dashed #d1d5db;\n  border-radius: 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  \n  svg {\n    width: 16px;\n    height: 16px;\n  }\n`;\n\n// File Viewer Modal Styles (pevzato ze Spisovky)\nconst FileModal = styled.div`\n  position: fixed;\n  left: ${props => props.x}px;\n  top: ${props => props.y}px;\n  width: ${props => props.w}px;\n  height: ${props => props.h}px;\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(0, 0, 0, 0.1);\n  z-index: 999998;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n`;\n\nconst FileModalContent = styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n`;\n\nconst FileModalHeader = styled.div`\n  padding: 12px 16px;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  color: white;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n`;\n\nconst FileModalTitle = styled.div`\n  font-size: 1rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n`;\n\nconst FileCloseButton = styled.button`\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  color: white;\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n`;\n\nconst FileObject = styled.object`\n  flex: 1;\n  border: none;\n  width: 100%;\n  height: 100%;\n`;\n\nconst PdfFallback = styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 1rem;\n  padding: 2rem;\n  background: #f8fafc;\n  color: #334155;\n`;\n\nconst DownloadButton = styled.a`\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  background: #10b981;\n  color: white;\n  border-radius: 8px;\n  text-decoration: none;\n  font-weight: 600;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n\n  &:hover {\n    background: #059669;\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px rgba(16, 185, 129, 0.3);\n  }\n`;\n\n\nconst LoadingState = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 16px;\n  gap: 8px;\n  color: #6b7280;\n  font-size: 0.8125rem;\n\n  svg {\n    width: 16px;\n    height: 16px;\n    animation: spin 1s linear infinite;\n  }\n\n  @keyframes spin {\n    from { transform: rotate(0deg); }\n    to { transform: rotate(360deg); }\n  }\n`;\n\nconst ErrorMessage = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 10px;\n  background: #fef2f2;\n  border: 1px solid #fecaca;\n  border-radius: 6px;\n  color: #dc2626;\n  font-size: 0.75rem;\n  margin-top: 8px;\n\n  svg {\n    width: 14px;\n    height: 14px;\n    flex-shrink: 0;\n  }\n`;\n\nconst InfoText = styled.div`\n  font-size: 0.75rem;\n  color: #6b7280;\n  padding: 12px;\n  background: #f9fafb;\n  border-radius: 6px;\n  border: 1px solid #e5e7eb;\n`;\n\nconst InvoiceAttachmentsCompact = ({\n  fakturaId,\n  objednavkaId,\n  fakturaTypyPrilohOptions = [], // FAKTURA_TYP z OrderForm25\n  readOnly = false,\n  onISDOCParsed, //  Callback pro vyplnn faktury z ISDOC\n  formData, //  Pro mapovn stedisek z objednvky\n  faktura, //  Objekt faktury pro validaci povinnch poloek\n  validateInvoiceForAttachments, //  Validan funkce pro fakturu\n  isPokladna = false, //  Je to pokladn doklad? (bez validace povinnch poloek)\n  onAttachmentUploaded, //  Callback po spnm uploadu jakkoliv plohy (vetn ISDOC)\n  onAttachmentRemoved, //  Callback pi smazn plohy (pro cleanup Spisovka metadata)\n  attachments: externalAttachments = [], //  Attachments z formData.faktury[].attachments (controlled)\n  onAttachmentsChange, //  Callback pro aktualizaci attachments (controlled component pattern)\n  onCreateInvoiceInDB, //  Callback pro vytvoen faktury v DB (temp  real ID)\n  onOCRDataExtracted, //  Callback pro pedn OCR vytench dat\n  allUsers = [] //  Seznam vech uivatel pro zobrazen jmna nahrvajcho uivatele\n}) => {\n  const { username, token } = useContext(AuthContext);\n  const { showToast } = useContext(ToastContext); //  OPRAVENO: showToast msto addToast\n\n  const [loading, setLoading] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [error, setError] = useState(null);\n  const [dragging, setDragging] = useState(false);\n  const fileInputRef = React.useRef(null);\n\n  //  ISDOC parsing state\n  const [showISDOCDialog, setShowISDOCDialog] = useState(false);\n  const [pendingISDOCFile, setPendingISDOCFile] = useState(null);\n  const [isdocSummary, setIsdocSummary] = useState(null);\n\n  //  File Viewer state (jako ve Spisovce)\n  const [fileViewer, setFileViewer] = useState({ visible: false, url: '', filename: '', type: '' });\n  const [fileViewerPosition, setFileViewerPosition] = useState(() => {\n    const screenWidth = window.innerWidth;\n    const screenHeight = window.innerHeight;\n    // ka: 50% obrazovky, max 900px, min 400px\n    const width = Math.max(400, Math.min(Math.floor(screenWidth * 0.5), 900));\n    // Vka: 85% obrazovky\n    const height = Math.floor(screenHeight * 0.85);\n    // X pozice: zarovnat vpravo s 20px marginem\n    const x = Math.max(20, screenWidth - width - 20);\n    // Y pozice: vycentrovat vertikln\n    const y = Math.max(20, Math.floor((screenHeight - height) / 2));\n    return { x, y, w: width, h: height };\n  });\n  const [isDraggingViewer, setIsDraggingViewer] = useState(false);\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 }); // Offset myi pi kliknut\n\n  //  Confirm dialog state\n  const [confirmDialog, setConfirmDialog] = useState({\n    isOpen: false,\n    title: '',\n    message: '',\n    onConfirm: null\n  });\n\n  //  FLAG: Sleduje, zda jsme u jednou naetli plohy ze serveru (prevence infinite loop)\n  const hasLoadedFromServerRef = React.useRef(false);\n\n  //  Pout external attachments jako zdroj pravdy (controlled component)\n  //  BEZPENOSTN KONTROLA: zajistit e attachments je vdy pole\n  //  OPRAVA: Mapovat file_size -> size pokud pijde z API\n  const attachments = useMemo(() => {\n    if (!Array.isArray(externalAttachments)) return [];\n    \n    const mapped = externalAttachments.map(att => {\n      // Pokud u m size, pouij ho\n      if (att.size !== undefined) return att;\n      \n      // Jinak mapuj z file_size nebo velikost_souboru_b\n      const mapped = {\n        ...att,\n        size: att.file_size || att.velikost_souboru_b || 0\n      };\n      \n      return mapped;\n    });\n    \n    return mapped;\n  }, [externalAttachments, fakturaId]);\n\n  //  Helper funkce pro aktualizaci attachments (vol onAttachmentsChange callback)\n  //  DLEIT: Mus sprvn fungovat s controlled component pattern\n  const updateAttachments = useCallback((updater) => {\n    if (!onAttachmentsChange) {\n      return;\n    }\n\n    //  Pokud je updater funkce, musme ji zavolat s aktulnmi attachments\n    //  Pokud je to hodnota, pedat ji pmo\n    if (typeof updater === 'function') {\n      // Zskat aktuln hodnotu z props (externalAttachments jsou controlled)\n      const currentAttachments = externalAttachments || [];\n      const newAttachments = updater(currentAttachments);\n      onAttachmentsChange(newAttachments); //  Pedat HODNOTU, ne funkci\n    } else {\n      onAttachmentsChange(updater); //  Pedat hodnotu pmo\n    }\n  }, [onAttachmentsChange, externalAttachments]);\n\n  //  Helper funkce pro zskn jmna uivatele podle ID\n  const getUserDisplayName = useCallback((userId) => {\n    if (!userId) return username || 'Neznm uivatel';\n    \n    // Najt uivatele v seznamu\n    const user = allUsers.find(u => u.id === userId || u.user_id === userId);\n    if (!user) return `Uivatel #${userId}`;\n    \n    // Sestavit cel jmno s tituly\n    const parts = [];\n    if (user.titul_pred) parts.push(user.titul_pred);\n    if (user.jmeno) parts.push(user.jmeno);\n    if (user.prijmeni) parts.push(user.prijmeni);\n    if (user.titul_za) parts.push(user.titul_za);\n    \n    return parts.length > 0 ? parts.join(' ') : (user.username || `Uivatel #${userId}`);\n  }, [allUsers, username]);\n\n  //  Drag handlers pro file viewer\n  const handleFileViewerDrag = useCallback((e) => {\n    if (!isDraggingViewer) return;\n    e.preventDefault();\n    \n    setFileViewerPosition(prev => {\n      // Pout uloen offset z mouseDown\n      const newX = e.clientX - dragOffset.x;\n      const newY = e.clientY - dragOffset.y;\n      \n      // Omezen aby okno nevyjelo mimo obrazovku\n      const screenWidth = window.innerWidth;\n      const screenHeight = window.innerHeight;\n      \n      const boundedX = Math.max(0, Math.min(newX, screenWidth - prev.w));\n      const boundedY = Math.max(0, Math.min(newY, screenHeight - prev.h));\n      \n      return {\n        ...prev,\n        x: boundedX,\n        y: boundedY\n      };\n    });\n  }, [isDraggingViewer, dragOffset]);\n\n  const handleFileViewerDragEnd = useCallback(() => {\n    setIsDraggingViewer(false);\n  }, []);\n\n  useEffect(() => {\n    if (isDraggingViewer) {\n      const handleMouseMove = (e) => handleFileViewerDrag(e);\n      const handleMouseUp = () => handleFileViewerDragEnd();\n      \n      document.addEventListener('mousemove', handleMouseMove);\n      document.addEventListener('mouseup', handleMouseUp);\n      \n      return () => {\n        document.removeEventListener('mousemove', handleMouseMove);\n        document.removeEventListener('mouseup', handleMouseUp);\n      };\n    }\n  }, [isDraggingViewer, handleFileViewerDrag, handleFileViewerDragEnd]);\n\n  // Naten ploh pi mount nebo zmn faktura_id\n  //  OPRAVA INFINITE LOOP: Pout ref flag pro kontrolu, zda jsme u naetli data\n  useEffect(() => {\n    //  Pokud se fakturaId zmn, resetovat flag\n    hasLoadedFromServerRef.current = false;\n  }, [fakturaId]);\n\n  useEffect(() => {\n    if (fakturaId && !String(fakturaId).startsWith('temp-')) {\n      //  Pokud u mme attachments z props A NEJSOU undefined, pout je\n      // (przdn pole [] je validn stav - znamen 0 ploh)\n      if (externalAttachments !== undefined && externalAttachments !== null) {\n        return; // Mme data z props (i kdy przdn)\n      }\n      \n      //  Pokud jsme u jednou naetli ze serveru, nepokraovat (prevence loop)\n      if (hasLoadedFromServerRef.current) {\n        return;\n      }\n      \n      // Przdn nebo undefined  nast ze serveru (pouze jednou!)\n      hasLoadedFromServerRef.current = true;\n      loadAttachmentsFromServer();\n    }\n  }, [fakturaId, externalAttachments]);\n\n  //  AUTO-UPLOAD pending ploh kdy se ID zmn z temp na reln\n  const prevFakturaIdRef = React.useRef(fakturaId);\n\n  useEffect(() => {\n    const uploadPendingAttachments = async () => {\n      // Kontrola: ID se zmnilo z temp na reln\n      const prevId = prevFakturaIdRef.current;\n      const currentId = fakturaId;\n\n      const wasTemp = String(prevId).startsWith('temp-');\n      const isRealNow = currentId && !String(currentId).startsWith('temp-');\n\n      if (!wasTemp || !isRealNow) {\n        // Nen to zmna z temp na reln - ukonit\n        prevFakturaIdRef.current = currentId;\n        return;\n      }\n      // Najdi vechny plohy se statusem 'pending_upload' nebo 'pending'\n      const pendingAttachments = attachments.filter(att => \n        (att.status === 'pending' || att.status === 'pending_upload') && att.file\n      );\n\n      if (pendingAttachments.length === 0) {\n        prevFakturaIdRef.current = currentId;\n        return;\n      }\n      // Nahrt kadou pending plohu\n      for (const attachment of pendingAttachments) {\n        try {\n\n          // Update status -> uploading\n          updateAttachments(prev => prev.map(a =>\n            a.id === attachment.id ? { ...a, status: 'uploading' } : a\n          ));\n\n          const response = await uploadInvoiceAttachment25({\n            token: token,\n            username: username,\n            faktura_id: currentId,\n            objednavka_id: objednavkaId,\n            typ_prilohy: attachment.klasifikace || 'FAKTURA',\n            file: attachment.file\n          });\n          \n          // Zskej ID plohy z rznch monch struktur\n          const attachmentId = response.priloha?.id || \n                              response.priloha_id || \n                              response.data?.priloha?.id || \n                              response.data?.id || \n                              response.id;\n          \n          // Update status -> uploaded\n          updateAttachments(prev => prev.map(a =>\n            a.id === attachment.id ? {\n              ...a,\n              status: 'uploaded',\n              serverId: attachmentId,\n              file: undefined // Odstra File object\n            } : a\n          ));\n\n          showToast&&showToast(` Ploha \"${attachment.name}\" byla spn nahrna`, { type: 'success' });\n\n        } catch (uploadError) {\n\n          // Update status -> error\n          updateAttachments(prev => prev.map(a =>\n            a.id === attachment.id ? { ...a, status: 'error', error: uploadError.message } : a\n          ));\n\n          showToast&&showToast(`Nepodailo se nahrt plohu \"${attachment.name}\"`, { type: 'error' });\n        }\n      }\n\n      // Zavolat callback pro autosave\n      if (onAttachmentUploaded) {\n        onAttachmentUploaded();\n      }\n\n      // Uloit aktuln ID pro pt porovnn\n      prevFakturaIdRef.current = currentId;\n    };\n\n    uploadPendingAttachments();\n  }, [fakturaId, attachments]); // Sleduj fakturaId i attachments\n\n  // Naten ploh ze serveru\n  const loadAttachmentsFromServer = async () => {\n    if (!fakturaId || String(fakturaId).startsWith('temp-')) return;\n    setLoading(true);\n    setError(null);\n\n    try {\n      const response = await listInvoiceAttachments25({\n        token: token,\n        username: username,\n        faktura_id: fakturaId,\n        objednavka_id: objednavkaId //  PIDNO pro nov Order V2 API\n      });\n\n      //  NOV V2 STRUKTURA: response.data.attachments (msto response.prilohy)\n      const attachmentsList = response.data?.attachments || response.prilohy || [];\n\n      //  DEBUG: Kompletn vpis vech ploh\n\n      const serverAttachments = attachmentsList.map(att => {\n        //  Kontrola existence fyzickho souboru\n        const fileExists = att.file_exists !== false; // Backend by ml vrtit file_exists: false pokud soubor chyb\n        const hasError = att.error || att.file_error;\n\n        //  Najt nzev typu plohy z selnku\n        const typPrilohy = fakturaTypyPrilohOptions.find(t => t.kod === (att.type || att.typ_prilohy));\n\n        return {\n          id: att.id,\n          serverId: att.id,\n          name: att.original_name || att.originalni_nazev_souboru,\n          size: att.file_size || att.velikost_souboru_b,\n          type: (att.original_name || att.originalni_nazev_souboru || '').endsWith('.pdf') ? 'application/pdf' : 'application/octet-stream',\n          klasifikace: att.type || att.typ_prilohy || 'FILE', //  Fallback na 'FILE' pokud chyb\n          faktura_typ_nazev: typPrilohy?.nazev || att.faktura_typ_nazev, //  Zskat nzev z selnku nebo pout z API\n          uploadDate: att.upload_date || att.dt_vytvoreni || new Date().toISOString(), //  Fallback na aktuln as\n          uploadedByUserId: att.uploaded_by_user_id || att.nahrano_uzivatel_id, //  ID uivatele, kter nahrl\n          status: fileExists ? 'uploaded' : 'error', //  Oznait pokozen plohy\n          je_isdoc: att.je_isdoc,\n          error: hasError || (!fileExists ? 'Fyzick soubor chyb na disku' : null) //  Chybov zprva\n        };\n      });\n      \n      //  OCHRANA: Nepepisovat attachments pokud jsou v procesu uploadu\n      const hasPendingUploads = attachments.some(a => \n        a.status === 'pending_upload' || a.status === 'uploading'\n      );\n      \n      if (hasPendingUploads && serverAttachments.length === 0) {\n        console.log(' Peskakuji przdnou odpov ze serveru - mme pending uploads');\n        return; // Nepepisovat lokln pending attachments\n      }\n      \n      //  OPRAVA INFINITE LOOP: Neaktualizovat attachments pokud se nezmnily\n      // (prevence zbytench re-render a loop)\n      const areAttachmentsEqual = (a, b) => {\n        if (a.length !== b.length) return false;\n        return a.every((att, i) => att.id === b[i]?.id && att.status === b[i]?.status);\n      };\n      \n      // Zatm neaktualizovat - pokat na verify\n      let finalAttachments = serverAttachments;\n\n      //  VERIFY - Zkontrolovat fyzickou existenci soubor na serveru\n      //  OPRAVA: Pout invoice_id msto faktura_id + objednavka_id\n      const numFakturaId = fakturaId ? Number(fakturaId) : null;\n      const isFakturaValid = numFakturaId && !isNaN(numFakturaId) && !String(fakturaId).startsWith('temp-');\n\n      if (isFakturaValid) {\n        try {\n          const verifyResult = await verifyInvoiceAttachments25({\n            token,\n            username,\n            invoice_id: numFakturaId,\n            objednavka_id: objednavkaId\n          });\n\n          if (verifyResult && verifyResult.attachments) {\n            //  OPRAVA: Aktualizovat serverAttachments (ne prev!), pak zavolat updateAttachments\n            finalAttachments = serverAttachments.map(att => {\n              const verifiedAtt = verifyResult.attachments.find(v => v.attachment_id === att.serverId);\n              if (verifiedAtt && !verifiedAtt.file_exists) {\n                return {\n                  ...att,\n                  status: 'error',\n                  error: `Fyzick soubor chyb na serveru (${verifiedAtt.status})`\n                };\n              }\n              return att;\n            });\n\n            // Zobrazit summary pokud jsou njak chybjc soubory\n            const summary = verifyResult.summary || {};\n            if (summary.missing_files > 0) {\n              showToast&&showToast(` ${summary.missing_files} ploha(y) faktury nemaj fyzick soubor na serveru`, { type: 'warning' });\n            }\n          }\n        } catch (verifyErr) {\n          console.error(' Chyba pi verify attachments:', verifyErr);\n          // Neblokovat natn kvli chyb verify\n        }\n      }\n\n      //  AKTUALIZOVAT POUZE POKUD SE ZMNILY (prevence loop)\n      if (!areAttachmentsEqual(finalAttachments, externalAttachments || [])) {\n        updateAttachments(finalAttachments);\n      }\n\n    } catch (err) {\n      console.error(' Chyba pi natn ploh faktury:', err);\n      setError(err.message || 'Chyba pi natn ploh');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Validace souboru\n  const validateFile = (file) => {\n    if (!isAllowedInvoiceFileType(file.name)) {\n      throw new Error('Nepodporovan formt souboru');\n    }\n\n    if (!isAllowedInvoiceFileSize(file.size)) {\n      throw new Error('Soubor je pli velk (max 10 MB)');\n    }\n  };\n\n  // Pidn soubor do attachments s pending_classification\n  const handleFileUpload = async (files) => {\n    const fileArray = Array.from(files);\n\n    // Najt ISDOC soubory a nabdnout parsing\n    const isdocFiles = fileArray.filter(f => isISDOCFile(f.name));\n    const nonIsdocFiles = fileArray.filter(f => !isISDOCFile(f.name));\n\n    //  NOV LOGIKA: Validace bnch soubor (ne-ISDOC) pi uploadu\n    // Pro kad ne-ISDOC soubor zkontroluj validaci faktury\n    if (nonIsdocFiles.length > 0 && !isPokladna) {\n      // Zkontroluj validaci (bez file parametru = kontrola zkladnch pol)\n      const validation = validateInvoiceForAttachments ? validateInvoiceForAttachments(faktura) : { isValid: true };\n      \n      if (!validation.isValid) {\n        //  ZAMTNOUT bn soubory - chyb povinn pole\n        //  Strukturovan chybov zprva (PESN jako OrderForm25)\n        const errorMessage = (\n          <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n            <div style={{ \n              fontSize: '15px', \n              fontWeight: '600', \n              marginBottom: '12px', \n              color: '#1a1a1a',\n              display: 'flex',\n              alignItems: 'center',\n              gap: '8px'\n            }}>\n              <AlertCircle size={20} color=\"#ff4d4f\" style={{ flexShrink: 0 }} />\n              <span>Pro uloen je nutn vyplnit nsledujc poloky:</span>\n            </div>\n            {Object.values(validation.categories).map((cat, idx) => \n              cat.errors.length > 0 && (\n                <div key={idx} style={{ \n                  marginBottom: '10px',\n                  padding: '10px',\n                  backgroundColor: '#fff1f0',\n                  borderRadius: '4px'\n                }}>\n                  <div style={{ \n                    fontWeight: '600', \n                    fontSize: '13px',\n                    color: '#d32f2f',\n                    marginBottom: '6px'\n                  }}>\n                    {cat.label}\n                  </div>\n                  {cat.errors.map((err, errIdx) => (\n                    <div key={errIdx} style={{ \n                      fontSize: '12px',\n                      color: '#666',\n                      marginLeft: '8px',\n                      marginTop: '4px',\n                      display: 'flex',\n                      alignItems: 'flex-start'\n                    }}>\n                      <span style={{ marginRight: '6px', color: '#ff4d4f', fontWeight: 'bold' }}></span>\n                      <span>{err}</span>\n                    </div>\n                  ))}\n                </div>\n              )\n            )}\n          </div>\n        );\n        \n        showToast && showToast(errorMessage, { type: 'error' });\n        return; // Ukonit upload\n      }\n    }\n\n    //  Pokud je prv 1 ISDOC soubor a mme callback, nabdnout parsing\n    if (isdocFiles.length === 1 && onISDOCParsed) {\n      const isdocFile = isdocFiles[0];\n\n      try {\n        // Validace souboru\n        validateFile(isdocFile);\n\n        // Naparsovat ISDOC\n        const isdocData = await parseISDOCFile(isdocFile);\n        const summary = createISDOCSummary(isdocData);\n\n        // Uloit pro pozdj pouit\n        setPendingISDOCFile({\n          file: isdocFile,\n          isdocData,\n          otherFiles: nonIsdocFiles // Ppadn dal soubory\n        });\n        setIsdocSummary(summary);\n        setShowISDOCDialog(true);\n\n        // Zpracovn probh v dialogu\n        return;\n\n      } catch (parseError) {\n        showToast&&showToast('Nepodailo se naparsovat ISDOC soubor. Nahrno jako bn ploha.', { type: 'error' });\n        // Pokraovat jako bn upload (spadne do kdu ne)\n      }\n    }\n\n    // Bn upload (vechny soubory nebo ISDOC po chyb parsingu)\n    const newFiles = fileArray.map((file, index) => {\n      try {\n        validateFile(file);\n\n        //  Automatick klasifikace podle typu souboru\n        const jeISDOC = isISDOCFile(file.name);\n        // ISDOC -> 'ISDOC', ostatn soubory (PDF, JPG, atd.) -> 'FAKTURA' (vchoz)\n        const autoKlasifikace = jeISDOC ? 'ISDOC' : 'FAKTURA';\n\n        return {\n          id: `pending-${Date.now()}-${index}`,\n          file: file,\n          name: file.name,\n          size: file.size,\n          type: file.type,\n          klasifikace: autoKlasifikace, //  Automatick klasifikace\n          uploadDate: new Date().toISOString(),\n          status: 'pending_upload', //  Ready k uploadu s auto-klasifikac\n          je_isdoc: jeISDOC ? 1 : 0,\n          //  SPISOVKA METADATA pro automatick tracking (pokud existuj)\n          ...(file.spisovka_dokument_id && { spisovka_dokument_id: file.spisovka_dokument_id }),\n          ...(file.spisovka_file_id && { spisovka_file_id: file.spisovka_file_id })\n        };\n      } catch (err) {\n        showToast&&showToast(`${file.name}: ${err.message}`, { type: 'error' });\n        return null;\n      }\n    }).filter(Boolean);\n\n    if (newFiles.length > 0) {\n      console.log(' PIDVM', newFiles.length, 'novch soubor do UI s optimistic update');\n      console.log(' Soubory:', newFiles.map(f => ({ name: f.name, klasifikace: f.klasifikace, status: f.status })));\n      \n      //  TRACKING: Pokud je ploha ze Spisovky, nastavit aktivn dokument do LS\n      const firstFile = newFiles[0];\n      if (firstFile?.spisovka_dokument_id) {\n        localStorage.setItem('spisovka_active_dokument', firstFile.spisovka_dokument_id);\n        console.log(' Aktivn Spisovka dokument uloen do LS:', firstFile.spisovka_dokument_id);\n      }\n      \n      //  NEJDV pidat soubory do UI\n      updateAttachments(prev => {\n        const updated = [...prev, ...newFiles];\n        console.log(' Celkov poet ploh po pidn:', updated.length);\n        return updated;\n      });\n\n      //  ODLOEN UPLOAD - ek na vykreslen React komponent\n      // requestAnimationFrame zajist, e upload se spust a PO vykreslen\n      requestAnimationFrame(() => {\n        // Jet jeden frame delay pro jistotu (jako u objednvek)\n        requestAnimationFrame(async () => {\n          // Sekvenn upload (jako u objednvek) - zabrauje race conditions\n          for (const file of newFiles) {\n            try {\n              await uploadFileToServer(file.id, file.klasifikace, file);\n            } catch (err) {\n              console.error(` Chyba pi uploadu souboru ${file.name}:`, err);\n              // Error handler je ji v uploadFileToServer - ozna soubor jako 'error'\n            }\n          }\n        });\n      });\n      \n      //  OKAMIT NVRAT - plohy jsou viditeln hned\n      // Upload probh na pozad s progress barem\n      //  DN REFRESH z DB - mohlo by to resetovat formul pi ukldn faktury\n    }\n  };\n\n  // Pomocn funkce pro UI styling ploh - STEJN JAKO U OBJEDNVEK\n  const getFileBorderColor = (file) => {\n    if (!file) return '#e5e7eb'; // Default pro undefined\n    if (file.status === 'error') return '#fca5a5';\n    if (!file.klasifikace) return '#fca5a5';\n    if (file.status === 'uploading') return '#f59e0b';\n    if (file.status === 'uploaded') return '#10b981';\n    if (file.status === 'pending_upload') return '#3b82f6'; // Modr pro ekajc\n    return '#e5e7eb';\n  };\n\n  const getFileBackgroundColor = (file) => {\n    if (!file) return 'white'; // Default pro undefined\n    if (file.status === 'error') return '#fef2f2';\n    if (!file.klasifikace) return '#fef2f2';\n    if (file.status === 'uploading') return '#fffbeb';\n    if (file.status === 'uploaded') return '#f0fdf4';\n    if (file.status === 'pending_upload') return '#eff6ff'; // Svtle modr pro ekajc\n    return 'white';\n  };\n\n  // Update klasifikace\n  const updateFileKlasifikace = async (fileId, klasifikace) => {\n    const file = attachments.find(f => f.id === fileId);\n    if (!file) return;\n\n    // Update lokln\n    updateAttachments(prev => prev.map(f =>\n      f.id === fileId ? { ...f, klasifikace } : f\n    ));\n\n    //  Pokud m klasifikaci a ek na upload -> automaticky upload\n    // (pending_classification i pending_upload)\n    if (klasifikace && klasifikace.trim() !== '' && (file.status === 'pending_classification' || file.status === 'pending_upload')) {\n      // Triggering auto-upload for pending file\n      // Upload s aktualizovanou klasifikac - PEDAT file objekt\n      await uploadFileToServer(fileId, klasifikace, file);\n    }\n    // Pokud je ji nahran na serveru -> update pes API\n    else if (klasifikace && klasifikace.trim() !== '' && file.status === 'uploaded' && file.serverId) {\n      try {\n        //  Pokud je klasifikace stejn jako pvodn, pesko update\n        if (file.klasifikace === klasifikace) {\n          // Klasifikace se nezmnila, skip update\n          return;\n        }\n\n        await updateInvoiceAttachment25({\n          token: token,\n          username: username,\n          faktura_id: fakturaId,\n          priloha_id: file.serverId,\n          objednavka_id: objednavkaId,\n          typ_prilohy: klasifikace,\n          type: klasifikace  //  Poli OBA parametry pro jistotu (type m pednost)\n        });\n\n        // Najdi nzev typu plohy pro zobrazen\n        const typPrilohy = fakturaTypyPrilohOptions.find(t => t.kod === klasifikace);\n\n        // Update lokln s nzvem\n        updateAttachments(prev => prev.map(f =>\n          f.id === fileId ? {\n            ...f,\n            klasifikace,\n            faktura_typ_nazev: typPrilohy?.nazev || klasifikace\n          } : f\n        ));\n\n        showToast&&showToast('Klasifikace byla aktualizovna', { type: 'success' });\n\n      } catch (err) {\n        showToast&&showToast(`Chyba pi aktualizaci: ${err.message}`, { type: 'error' });\n\n        // Vrtit zpt pvodn klasifikaci\n        updateAttachments(prev => prev.map(f =>\n          f.id === fileId ? { ...f, klasifikace: file.klasifikace } : f\n        ));\n      }\n    }\n  };\n\n  // Upload na server\n  const uploadFileToServer = async (fileId, klasifikaceOverride = null, fileObj = null) => {\n    //  DLEIT: Vdy pout fileObj (ji obsahuje vechna data vetn File objektu)\n    // attachments state me bt zastaral kvli async aktualizacm\n    const file = fileObj;\n    if (!file || !file.file) {\n      console.error(' uploadFileToServer: Chyb file nebo file.file', { fileId, fileObj });\n      return;\n    }\n\n    const klasifikace = klasifikaceOverride || file.klasifikace;\n\n    if (!klasifikace || klasifikace.trim() === '') {\n      showToast&&showToast('Vyberte typ plohy', { type: 'error' });\n      return;\n    }\n\n    //  Pokud m faktura temp-ID, NEJDV vytvoit fakturu v DB\n    const isTempFaktura = String(fakturaId).startsWith('temp-');\n    \n    // uploadFileToServer\n    \n    if (isTempFaktura) {\n      // Validace povinnch pol faktury ped vytvoenm v DB\n      if (!isPokladna) {\n        const validation = validateInvoiceForAttachments?.(faktura, file.file);\n        \n        // Validace faktury\n        \n        //  Pro ISDOC povolit upload i bez validnch pol\n        if (!validation?.isValid && !validation?.isISDOC) {\n          showToast&&showToast(\n            `Pro nahrn tto plohy vyplte nejprve: ${validation?.missingFields?.join(', ') || 'povinn pole'}`,\n            { type: 'error' }\n          );\n          return;\n        }\n        \n        // Info pro ISDOC s chybjcmi poli\n        if (validation?.isISDOC && validation?.missingFields?.length > 0) {\n          showToast&&showToast(\n            ' ISDOC soubor - data faktury budou extrahovna po nahrn',\n            { type: 'info' }\n          );\n        }\n      }\n\n      // Ozna jako \"uploading\" - vytvme fakturu v DB\n      updateAttachments(prev => prev.map(f =>\n        f.id === fileId ? {\n          ...f,\n          status: 'uploading',\n          klasifikace\n        } : f\n      ));\n\n      try {\n        //  CALLBACK: Vytvo fakturu v DB a zskej reln ID\n        if (!onCreateInvoiceInDB) {\n          throw new Error('Chyb callback pro vytvoen faktury v DB');\n        }\n\n        // Volm onCreateInvoiceInDB callback\n        //  ODSTRANNO: Toast \"Vytvm fakturu...\" - zpsoboval spam\n        \n        const realFakturaId = await onCreateInvoiceInDB(fakturaId);\n        \n        // Faktura vytvoena\n        \n        if (!realFakturaId || String(realFakturaId).startsWith('temp-')) {\n          throw new Error('Nepodailo se zskat reln ID faktury');\n        }\n\n        //  ODSTRANNO: Toast \"Faktura vytvoena...\" - uivatel vid jen finln spch\n\n        // Najdi nzev typu plohy pro zobrazen\n        const typPrilohy = fakturaTypyPrilohOptions.find(t => t.kod === klasifikace);\n\n        //  DEBUG: Payload ped uploadem plohy\n        const attachmentPayload = {\n          token: token,\n          username: username,\n          faktura_id: realFakturaId,\n          objednavka_id: objednavkaId,\n          typ_prilohy: klasifikace,\n          file: {\n            name: file.file.name,\n            size: file.file.size,\n            type: file.file.type\n          }\n        };\n        console.group(' DEBUG: Upload plohy faktury');\n        // REQUEST Payload\n\n        // Te nahrajeme plohu s relnm ID faktury\n        const response = await uploadInvoiceAttachment25({\n          token: token,\n          username: username,\n          faktura_id: realFakturaId, //  Reln ID\n          objednavka_id: objednavkaId,\n          typ_prilohy: klasifikace,\n          file: file.file\n        });\n\n        //  DEBUG: Response z backendu\n        // RESPONSE\n        console.groupEnd();\n\n        // Zskej ID plohy z rznch monch struktur\n        const attachmentId = response.priloha?.id || \n                            response.priloha_id || \n                            response.data?.priloha?.id || \n                            response.data?.id || \n                            response.id;\n\n        // Attachment ID (temp upload)\n\n        // Update s server ID\n        updateAttachments(prev => {\n          console.log(' UPDATE ATTACHMENTS (temp faktura) - PED:', prev.length, 'ploh');\n          const updated = prev.map(f =>\n            f.id === fileId ? {\n              ...f,\n              status: 'uploaded',\n              serverId: attachmentId,\n              klasifikace: klasifikace, //  Uloit klasifikaci pro pozdj porovnn\n              faktura_typ_nazev: typPrilohy?.nazev || klasifikace,\n              file: undefined, // Odstra File object\n              //  Zachovat Spisovka metadata (pokud existuj)\n              ...(f.spisovka_dokument_id && { spisovka_dokument_id: f.spisovka_dokument_id }),\n              ...(f.spisovka_file_id && { spisovka_file_id: f.spisovka_file_id })\n            } : f\n          );\n          console.log(' UPDATE ATTACHMENTS (temp faktura) - PO:', updated.length, 'ploh');\n          console.log(' Nalezena ploha s ID:', attachmentId, 'pro soubor:', file.file.name);\n          return updated;\n        });\n\n        //  Ploha spn nahrna - JEDIN toast pro temp fakturu\n        const successMessage = (\n          <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n            <div style={{ \n              fontSize: '15px', \n              fontWeight: '600', \n              marginBottom: '8px', \n              color: '#1a1a1a',\n              display: 'flex',\n              alignItems: 'center',\n              gap: '8px'\n            }}>\n              <CheckCircle2 size={20} color=\"#10b981\" style={{ flexShrink: 0 }} />\n              <span>Ploha spn nahrna</span>\n            </div>\n            <div style={{ \n              padding: '8px',\n              backgroundColor: '#f0fdf4',\n              borderRadius: '4px',\n              fontSize: '13px',\n              color: '#166534'\n            }}>\n              {file.file.name}\n            </div>\n          </div>\n        );\n        showToast&&showToast(successMessage, { type: 'success' });\n\n        //  NEREFRESHOVAT hned - zpsobuje to zmizen plohy z UI\n        // Msto toho spolhme na updateAttachments ve (dek 930)\n        // Refresh se provede automaticky pi ptm naten faktury\n\n        //  Zavolat callback pro autosave s uploadnutou plohou\n        if (onAttachmentUploaded) {\n          const uploadedAttachment = {\n            id: attachmentId,\n            faktura_id: realFakturaId,\n            typ_prilohy: klasifikace,\n            typ_prilohy_nazev: typPrilohy?.nazev || klasifikace,\n            nazev_souboru: file.file.name,\n            velikost: file.file.size,\n            status: 'uploaded',\n            datum_vytvoreni: new Date().toISOString()\n          };\n          onAttachmentUploaded(realFakturaId, uploadedAttachment);\n        }\n\n        return;\n\n      } catch (err) {\n        console.group(' CHYBA pi uploadu s temp ID');\n        console.error('Error object:', err);\n        console.error('Error message:', err.message);\n        console.error('Error stack:', err.stack);\n        if (err.response) {\n          console.error('Response data:', err.response.data);\n          console.error('Response status:', err.response.status);\n        }\n        console.groupEnd();\n        \n        // Status -> error\n        updateAttachments(prev => prev.map(f =>\n          f.id === fileId ? { \n            ...f, \n            status: 'error',\n            error: err.message || 'Chyba pi nahrvn'\n          } : f\n        ));\n\n        // Lep error zprva s nzvem souboru\n        const fileName = fileObj?.name || 'soubor';\n        let errorMsg = err.message || 'Nepodailo se nahrt plohu';\n        \n        // Zkontrolovat, jestli jde o nepodporovan typ souboru\n        if (errorMsg.includes('Nepodporovan typ souboru') || errorMsg.includes('Povolen typy')) {\n          showToast&&showToast(\n            ` Soubor \"${fileName}\" nelze nahrt\\n\\n${errorMsg}`,\n            { type: 'error' }\n          );\n        } else {\n          showToast&&showToast(\n            ` Chyba pi nahrvn \"${fileName}\": ${errorMsg}`,\n            { type: 'error' }\n          );\n        }\n        return;\n      }\n    }\n\n    // Status -> uploading s progress barem (simulace 0%)\n    updateAttachments(prev => prev.map(f =>\n      f.id === fileId ? { ...f, status: 'uploading', progress: 0 } : f\n    ));\n    \n    //  SIMULACE PROGRESS BARU (150ms intervaly pro plynulost)\n    const progressInterval = setInterval(() => {\n      updateAttachments(prev => prev.map(f => {\n        if (f.id === fileId && f.status === 'uploading') {\n          const currentProgress = f.progress || 0;\n          const newProgress = Math.min(currentProgress + Math.random() * 20, 95);\n          return { ...f, progress: newProgress };\n        }\n        return f;\n      }));\n    }, 150);\n    \n    try {\n      const response = await uploadInvoiceAttachment25({\n        token: token,\n        username: username,\n        faktura_id: fakturaId,\n        objednavka_id: objednavkaId,\n        typ_prilohy: klasifikace, // Pouij klasifikaci z parametru\n        file: file.file\n      });\n      \n      // Upload response\n      \n      // Najdi nzev typu plohy pro zobrazen\n      const typPrilohy = fakturaTypyPrilohOptions.find(t => t.kod === klasifikace);\n\n      // Zskej ID plohy z rznch monch struktur\n      const attachmentId = response.priloha?.id || \n                          response.priloha_id || \n                          response.data?.priloha?.id || \n                          response.data?.id || \n                          response.id;\n\n      // Attachment ID\n      \n      //  ZASTAVIT PROGRESS BAR\n      clearInterval(progressInterval);\n\n      // Update s server ID a 100% progress\n      updateAttachments(prev => {\n        console.log(' UPDATE ATTACHMENTS (reln faktura) - PED:', prev.length, 'ploh');\n        const updated = prev.map(f =>\n          f.id === fileId ? {\n            ...f,\n            status: 'uploaded',\n            progress: 100,\n            serverId: attachmentId,\n            klasifikace: klasifikace, //  Uloit klasifikaci\n            faktura_typ_nazev: typPrilohy?.nazev || klasifikace, // Nzev pro zobrazen\n            file: undefined // Odstra File object\n          } : f\n        );\n        console.log(' UPDATE ATTACHMENTS (reln faktura) - PO:', updated.length, 'ploh');\n        console.log(' Nalezena ploha s ID:', attachmentId, 'pro soubor:', file.file.name);\n        return updated;\n      });\n\n      //  JEDIN success toast pro existujc fakturu\n      const successMessage = (\n        <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n          <div style={{ \n            fontSize: '15px', \n            fontWeight: '600', \n            marginBottom: '8px', \n            color: '#1a1a1a',\n            display: 'flex',\n            alignItems: 'center',\n            gap: '8px'\n          }}>\n            <CheckCircle2 size={20} color=\"#10b981\" style={{ flexShrink: 0 }} />\n            <span>Ploha spn nahrna</span>\n          </div>\n          <div style={{ \n            padding: '8px',\n            backgroundColor: '#f0fdf4',\n            borderRadius: '4px',\n            fontSize: '13px',\n            color: '#166534'\n          }}>\n            {file.file.name}\n          </div>\n        </div>\n      );\n      showToast&&showToast(successMessage, { type: 'success' });\n\n      //  NEREFRESHOVAT hned - zpsobuje to zmizen plohy z UI\n      // Msto toho spolhme na updateAttachments ve\n      // Refresh se provede automaticky pi ptm naten faktury\n\n      //  Zavolat callback pro autosave s uploadnutou plohou\n      if (onAttachmentUploaded) {\n        const uploadedAttachment = {\n          id: attachmentId,\n          faktura_id: fakturaId,\n          typ_prilohy: klasifikace,\n          typ_prilohy_nazev: typPrilohy?.nazev || klasifikace,\n          nazev_souboru: file.file.name,\n          velikost: file.file.size,\n          status: 'uploaded',\n          datum_vytvoreni: new Date().toISOString()\n        };\n        onAttachmentUploaded(fakturaId, uploadedAttachment);\n      }\n\n    } catch (err) {\n      //  ZASTAVIT PROGRESS BAR\n      clearInterval(progressInterval);\n      \n      // Status -> error (pending znovu)\n      updateAttachments(prev => prev.map(f =>\n        f.id === fileId ? { ...f, status: 'pending_classification', progress: 0 } : f\n      ));\n\n      showToast&&showToast('Nepodailo se nahrt plohu', { type: 'error' });\n    }\n  };\n\n  // Odstrann souboru (lokln ped uploadem)\n  const removeFile = (fileId) => {\n    const file = attachments.find(f => f.id === fileId);\n    if (!file) return;\n\n    //  Zobrazit confirm dialog\n    setConfirmDialog({\n      isOpen: true,\n      title: 'Odstranit plohu',\n      message: `Opravdu chcete odstranit plohu \"${file.name}\"?`,\n      onConfirm: () => {\n        //  Odstranit z loklnho stavu\n        updateAttachments(prev => prev.filter(f => f.id !== fileId));\n        showToast&&showToast(' Ploha odstranna', { type: 'success' });\n        setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null });\n        \n        //  Notify parent o smazn (pro Spisovka tracking cleanup)\n        if (onAttachmentRemoved) {\n          onAttachmentRemoved(file);\n        }\n      }\n    });\n  };\n\n  // Smazn ze serveru\n  const deleteFromServer = async (fileId) => {\n    const file = attachments.find(f => f.id === fileId);\n    if (!file || !file.serverId) {\n      return;\n    }\n\n    //  Zobrazit confirm dialog\n    setConfirmDialog({\n      isOpen: true,\n      title: 'Smazat plohu',\n      message: `Opravdu chcete smazat plohu \"${file.name}\"?`,\n      onConfirm: async () => {\n\n        try {\n          //  HARD DELETE - fyzick smazn souboru z disku i DB\n          const response = await deleteInvoiceAttachment25({\n            token: token,\n            username: username,\n            faktura_id: fakturaId, //  Order V2 API\n            priloha_id: file.serverId,\n            objednavka_id: objednavkaId, //  Order V2 API - required\n            hard_delete: 1 //  HARD DELETE - smae soubor z disku\n          });\n\n          // DELETE Response\n\n          //  Kontrola response ped aktualizac UI\n          if (response && (response.status === 'ok' || response.status === 'success' || response.success === true)) {\n            // Log informac o smazn\n            if (response.data) {\n              //  Podle BE dokumentace: Pokud je status='ok', DB zznam JE smazn (vdy)\n              // Zobraz success, ale upozorni na warning pokud nco bylo patn se souborem\n              if (response.warning) {\n                //  Warning = DB smazno, ale problm se souborem na disku\n                showToast&&showToast(' Ploha smazna (s varovnm)', { type: 'warning' });\n                console.warn(' Warning:', response.warning);\n              } else {\n                //  Ve OK - DB i soubor smazny\n                showToast&&showToast(' Ploha byla spn smazna', { type: 'success' });\n              }\n            } else {\n              // Star struktura bez detail\n              showToast&&showToast(' Ploha byla spn smazna', { type: 'success' });\n            }\n\n            //  Zavt dialog\n            setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null });\n\n            //  Notify parent o smazn (pro Spisovka tracking cleanup)\n            if (onAttachmentRemoved) {\n              onAttachmentRemoved(file);\n            }\n\n            //  RELOAD ploh ze serveru (synchronizace)\n            await loadAttachmentsFromServer();\n\n            //  POZOR: onAttachmentUploaded se NEvol pi DELETE (nen to upload!)\n            // Pro autosave po smazn pouijte jin callback nebo hook\n          } else {\n            throw new Error(response?.message || 'Neoekvan odpov serveru');\n          }\n\n        } catch (err) {\n          console.error(' DELETE Error:', err);\n          console.error('Error message:', err.message);\n          console.error('Error response:', err.response?.data);\n          showToast&&showToast(`Nepodailo se smazat plohu: ${err.message}`, { type: 'error' });\n          setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null });\n        }\n      }\n    });\n  };\n\n  // Download / Preview v plovoucm okn\n  const handleDownload = async (fileId) => {\n    const file = attachments.find(f => f.id === fileId);\n    if (!file || !file.serverId) return;\n\n    try {\n      const blobData = await downloadInvoiceAttachment25({\n        token: token,\n        username: username,\n        faktura_id: fakturaId,\n        priloha_id: file.serverId,\n        objednavka_id: objednavkaId\n      });\n\n      const filename = file.name || 'priloha.pdf';\n      const ext = filename.toLowerCase().split('.').pop();\n\n      // Urit MIME type podle ppony\n      let mimeType = 'application/octet-stream';\n      if (ext === 'pdf') {\n        mimeType = 'application/pdf';\n      } else if (['jpg', 'jpeg'].includes(ext)) {\n        mimeType = 'image/jpeg';\n      } else if (ext === 'png') {\n        mimeType = 'image/png';\n      } else if (ext === 'gif') {\n        mimeType = 'image/gif';\n      } else if (ext === 'bmp') {\n        mimeType = 'image/bmp';\n      } else if (ext === 'webp') {\n        mimeType = 'image/webp';\n      } else if (ext === 'svg') {\n        mimeType = 'image/svg+xml';\n      }\n\n      // Vytvoit nov Blob se sprvnm MIME typem\n      const blob = new Blob([blobData], { type: mimeType });\n\n      // Pro PDF zobrazit v plovoucm okn\n      if (ext === 'pdf' || ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg'].includes(ext)) {\n        const url = window.URL.createObjectURL(blob);\n        setFileViewer({\n          visible: true,\n          url: url,\n          filename: filename,\n          type: ext === 'pdf' ? 'pdf' : 'image'\n        });\n        return;\n      }\n\n      // Pro ostatn soubory pmo sthnout\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n\n      showToast&&showToast('Soubor sten', { type: 'success' });\n\n    } catch (err) {\n      showToast&&showToast(`Chyba: ${err.message}`, { type: 'error' });\n    }\n  };\n\n  //  OCR EXTRAKCE Z PDF\n  const handleOCRExtraction = async (fileId) => {\n    const file = attachments.find(f => f.id === fileId);\n    if (!file) return;\n\n    // Kontrola, zda je soubor PDF\n    const isPDF = file.name?.toLowerCase().endsWith('.pdf') || file.type === 'application/pdf';\n    if (!isPDF) {\n      showToast&&showToast('OCR funguje pouze pro PDF soubory', { type: 'error' });\n      return;\n    }\n\n    // Zskme file object - bu z nahranho souboru nebo sthneme ze serveru\n    let fileBlob = file.file;\n    \n    if (!fileBlob && file.serverId) {\n      // Pokud je soubor ji nahrn na serveru, musme ho sthnout\n      try {\n        fileBlob = await downloadInvoiceAttachment25({\n          token: token,\n          username: username,\n          faktura_id: fakturaId,\n          priloha_id: file.serverId,\n          objednavka_id: objednavkaId\n        });\n      } catch (err) {\n        showToast&&showToast('Nepodailo se sthnout PDF pro OCR: ' + err.message, { type: 'error' });\n        return;\n      }\n    }\n\n    if (!fileBlob) {\n      showToast&&showToast('Soubor nen k dispozici pro OCR', { type: 'error' });\n      return;\n    }\n\n    // Vytvome File object, pokud mme jen Blob\n    const fileObject = fileBlob instanceof File \n      ? fileBlob \n      : new File([fileBlob], file.name, { type: 'application/pdf' });\n\n    // Zobrazme progress toast\n    let currentToastId = null;\n    \n    const updateProgress = (progress, message) => {\n      const progressContent = (\n        <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n          <div style={{ fontSize: '15px', fontWeight: '600', marginBottom: '8px', color: '#1a1a1a', display: 'flex', alignItems: 'center', gap: '8px' }}>\n            <Sparkles size={20} color=\"#8b5cf6\" style={{ flexShrink: 0 }} />\n            <span>OCR extrakce z PDF</span>\n          </div>\n          <div style={{ padding: '8px', backgroundColor: '#f5f3ff', borderRadius: '4px', fontSize: '13px', color: '#6d28d9' }}>\n            <div style={{ marginBottom: '4px' }}>{message}</div>\n            <div style={{ height: '4px', backgroundColor: '#e9d5ff', borderRadius: '2px', overflow: 'hidden' }}>\n              <div style={{ \n                height: '100%', \n                width: `${progress}%`, \n                backgroundColor: '#8b5cf6', \n                transition: 'width 0.3s ease' \n              }} />\n            </div>\n          </div>\n        </div>\n      );\n\n      if (currentToastId) {\n        // Update existing toast - musme najt a aktualizovat v ToastContext\n        // Pro jednoduchost vytvome nov toast\n        showToast&&showToast(progressContent, { type: 'info', duration: 999999 });\n      } else {\n        currentToastId = showToast&&showToast(progressContent, { type: 'info', duration: 999999 });\n      }\n    };\n\n    try {\n      // Spustme OCR extrakci\n      const extractedText = await extractTextFromPDF(fileObject, updateProgress);\n      \n      // Vytme data faktury z textu\n      const extractedData = extractInvoiceData(extractedText);\n      \n      console.log(' OCR Extracted Data:', extractedData);\n\n      // Zaveme progress toast\n      if (currentToastId) {\n        // ToastContext by ml mt metodu na zaven konkrtnho toastu\n        // Pro te jen nechme vymizet automaticky\n      }\n\n      // Zobrazit varovn, pokud dokument nen faktura\n      if (extractedData.warning) {\n        const warningContent = (\n          <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n            <div style={{ fontSize: '15px', fontWeight: '600', marginBottom: '8px', color: '#1a1a1a', display: 'flex', alignItems: 'center', gap: '8px' }}>\n              <AlertTriangle size={20} color=\"#f59e0b\" style={{ flexShrink: 0 }} />\n              <span>Varovn - Nen faktura</span>\n            </div>\n            <div style={{ padding: '8px', backgroundColor: '#fffbeb', borderRadius: '4px', fontSize: '13px', color: '#92400e' }}>\n              {extractedData.warning}\n            </div>\n          </div>\n        );\n        showToast&&showToast(warningContent, { type: 'warning', duration: 8000 });\n      }\n\n      // Zkontrolujeme, co se podailo vytit\n      const foundFields = [];\n      if (extractedData.variabilniSymbol) foundFields.push('Variabiln symbol');\n      if (extractedData.datumVystaveni) foundFields.push('Datum vystaven');\n      if (extractedData.datumSplatnosti) foundFields.push('Datum splatnosti');\n      if (extractedData.castka) foundFields.push('stka');\n\n      if (foundFields.length === 0) {\n        showToast&&showToast(' Nepodailo se vytit dn data z PDF', { type: 'error' });\n        return;\n      }\n\n      // Zobrazme nalezen daje\n      const successContent = (\n        <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n          <div style={{ fontSize: '15px', fontWeight: '600', marginBottom: '8px', color: '#1a1a1a', display: 'flex', alignItems: 'center', gap: '8px' }}>\n            <CheckCircle2 size={20} color=\"#10b981\" style={{ flexShrink: 0 }} />\n            <span>OCR extrakce spn</span>\n          </div>\n          <div style={{ padding: '8px', backgroundColor: '#f0fdf4', borderRadius: '4px', fontSize: '13px', color: '#166534' }}>\n            <div style={{ marginBottom: '4px', fontWeight: '500' }}>Nalezen daje:</div>\n            {extractedData.variabilniSymbol && (\n              <div> Variabiln symbol: {extractedData.variabilniSymbol}</div>\n            )}\n            {extractedData.datumVystaveni && (\n              <div> Datum vystaven: {extractedData.datumVystaveni}</div>\n            )}\n            {extractedData.datumSplatnosti && (\n              <div> Datum splatnosti: {extractedData.datumSplatnosti}</div>\n            )}\n            {extractedData.castka && (\n              <div> stka v. DPH: {extractedData.castka.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} K</div>\n            )}\n          </div>\n        </div>\n      );\n\n      showToast&&showToast(successContent, { type: 'success', duration: 10000 });\n\n      //  CALLBACK: Pedat vyten data zpt do formule\n      if (onOCRDataExtracted) {\n        onOCRDataExtracted(extractedData);\n      }\n\n    } catch (err) {\n      console.error(' OCR Error:', err);\n      \n      const errorContent = (\n        <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n          <div style={{ fontSize: '15px', fontWeight: '600', marginBottom: '8px', color: '#1a1a1a', display: 'flex', alignItems: 'center', gap: '8px' }}>\n            <AlertCircle size={20} color=\"#dc2626\" style={{ flexShrink: 0 }} />\n            <span>Chyba pi OCR extrakci</span>\n          </div>\n          <div style={{ padding: '8px', backgroundColor: '#fef2f2', borderRadius: '4px', fontSize: '13px', color: '#991b1b' }}>\n            {err.message}\n            <div style={{ marginTop: '8px', fontSize: '12px', color: '#6b7280' }}>\n               Mete vyplnit daje manuln z nhledu PDF\n            </div>\n          </div>\n        </div>\n      );\n      \n      showToast&&showToast(errorContent, { type: 'error', duration: 8000 });\n    }\n  };\n\n  //  Validace faktury pro pidn ploh - VYPOTAT PED HANDLERS\n  const invoiceValidation = useMemo(() => {\n    if (isPokladna) {\n      // Pokladn doklad nem povinn poloky\n      return { isValid: true, missingFields: [] };\n    }\n    if (!faktura) {\n      // Pokud nen faktura pedna, nelze validovat\n      return { isValid: false, missingFields: ['Faktura'] };\n    }\n    if (!validateInvoiceForAttachments) {\n      // Pokud nen validan funkce, pedpokldme e je validn (fallback)\n      return { isValid: true, missingFields: [] };\n    }\n    return validateInvoiceForAttachments(faktura);\n  }, [faktura, validateInvoiceForAttachments, isPokladna]);\n\n  //  NOV LOGIKA: Dropzona je VDY aktivn (validace probh pi uploadu)\n  // Disabled pouze kdy: uploading, loading nebo readOnly\n  const isDropzoneDisabled = uploading || loading || readOnly;\n\n  // Drag & Drop handlers\n  const handleDragOver = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!isDropzoneDisabled) {\n      setDragging(true);\n    }\n  };\n\n  const handleDragLeave = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.currentTarget === e.target || !e.currentTarget.contains(e.relatedTarget)) {\n      setDragging(false);\n    }\n  };\n\n  const handleDrop = async (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragging(false);\n\n    if (isDropzoneDisabled) return;\n\n    //  PRIORITA 1a: Kontrola drag & drop VECH ploh faktury ze spisovky\n    const spisovkaAttachmentsJson = e.dataTransfer.getData('text/spisovka-attachments');\n    \n    if (spisovkaAttachmentsJson) {\n      try {\n        const attachments = JSON.parse(spisovkaAttachmentsJson);\n        \n        if (!Array.isArray(attachments) || attachments.length === 0) {\n          showToast && showToast(' dn plohy k nahrn', { type: 'error' });\n          return;\n        }\n\n        //  VALIDACE PED STAENM (jen pro ne-ISDOC soubory)\n        const hasISDOC = attachments.some(a => isISDOCFile(a.filename));\n        \n        if (!hasISDOC && !isPokladna) {\n          const validation = validateInvoiceForAttachments ? validateInvoiceForAttachments(faktura) : { isValid: true };\n          \n          if (!validation.isValid) {\n            const errorMessage = (\n              <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n                <div style={{ \n                  fontSize: '15px', \n                  fontWeight: '600', \n                  marginBottom: '12px', \n                  color: '#1a1a1a',\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: '8px'\n                }}>\n                  <AlertCircle size={20} color=\"#ff4d4f\" style={{ flexShrink: 0 }} />\n                  <span>Pro uloen je nutn vyplnit nsledujc poloky:</span>\n                </div>\n                {Object.values(validation.categories).map((cat, idx) => \n                  cat.errors.length > 0 && (\n                    <div key={idx} style={{ \n                      marginBottom: '10px',\n                      padding: '10px',\n                      backgroundColor: '#fff1f0',\n                      borderRadius: '4px'\n                    }}>\n                      <div style={{ \n                        fontWeight: '600', \n                        fontSize: '13px',\n                        color: '#d32f2f',\n                        marginBottom: '6px'\n                      }}>\n                        {cat.label}\n                      </div>\n                      {cat.errors.map((err, errIdx) => (\n                        <div key={errIdx} style={{ \n                          fontSize: '12px',\n                          color: '#666',\n                          marginLeft: '8px',\n                          marginTop: '4px',\n                          display: 'flex',\n                          alignItems: 'flex-start'\n                        }}>\n                          <span style={{ marginRight: '6px', color: '#ff4d4f', fontWeight: 'bold' }}></span>\n                          <span>{err}</span>\n                        </div>\n                      ))}\n                    </div>\n                  )\n                )}\n              </div>\n            );\n            showToast && showToast(errorMessage, { type: 'error' });\n            return;\n          }\n        }\n\n        // Sthnout vechny soubory paraleln\n        const downloadPromises = attachments.map(async (attachment) => {\n          const proxyUrl = `${process.env.REACT_APP_API2_BASE_URL}spisovka.php/proxy-file?url=${encodeURIComponent(attachment.url)}`;\n          const response = await fetch(proxyUrl);\n          if (!response.ok) throw new Error(`Chyba pi stahovn ${attachment.filename}`);\n          \n          const originalFilename = response.headers.get('X-Original-Filename');\n          const finalFilename = originalFilename || attachment.filename;\n          \n          const blob = await response.blob();\n          return new File([blob], finalFilename, { type: attachment.mime_type || blob.type });\n        });\n\n        const files = await Promise.all(downloadPromises);\n        \n        // Zpracovat vechny soubory najednou\n        await handleFileUpload(files);\n        \n        // Zelen success toast po nahrn\n        const successMessage = (\n          <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n            <div style={{ \n              fontSize: '15px', \n              fontWeight: '600', \n              marginBottom: '8px', \n              color: '#1a1a1a',\n              display: 'flex',\n              alignItems: 'center',\n              gap: '8px'\n            }}>\n              <CheckCircle2 size={20} color=\"#10b981\" style={{ flexShrink: 0 }} />\n              <span>Plohy spn nahrny</span>\n            </div>\n            <div style={{ \n              padding: '8px',\n              backgroundColor: '#f0fdf4',\n              borderRadius: '4px',\n              fontSize: '13px',\n              color: '#166534'\n            }}>\n              Nahrno {files.length} {files.length === 1 ? 'ploha' : files.length < 5 ? 'plohy' : 'ploh'} ze spisovky\n            </div>\n          </div>\n        );\n        showToast && showToast(successMessage, { type: 'success' });\n      } catch (error) {\n        console.error(' Chyba pi stahovn ploh ze spisovky:', error);\n        \n        // Lep error zprva - extrahovat nzev souboru z chybov zprvy\n        let errorMsg = error.message;\n        if (errorMsg.includes('Chyba pi stahovn')) {\n          showToast && showToast(` ${errorMsg}`, { type: 'error' });\n        } else {\n          showToast && showToast(` Chyba pi zpracovn ploh: ${errorMsg}`, { type: 'error' });\n        }\n      }\n      return;\n    }\n\n    //  PRIORITA 1b: Kontrola drag & drop jedn plohy ze spisovky (CORS proxy)\n    const spisovkaFileUrl = e.dataTransfer.getData('text/spisovka-file-url');\n    const spisovkaFileName = e.dataTransfer.getData('text/spisovka-file-name');\n    const spisovkaFileMime = e.dataTransfer.getData('text/spisovka-file-mime');\n    const spisovkaFileId = e.dataTransfer.getData('text/spisovka-file-id'); //  ID plohy\n    const spisovkaDokumentId = e.dataTransfer.getData('text/spisovka-dokument-id'); //  ID dokumentu\n    \n    if (spisovkaFileUrl && spisovkaFileName) {\n      //  VALIDACE PED STAENM (pro bn soubory)\n      const isISDOC = isISDOCFile(spisovkaFileName);\n      \n      if (!isISDOC && !isPokladna) {\n        // Zkontroluj validaci faktury ped staenm\n        const validation = validateInvoiceForAttachments ? validateInvoiceForAttachments(faktura) : { isValid: true };\n        \n        if (!validation.isValid) {\n          //  ZAMTNOUT - chyb povinn pole\n          const errorMessage = (\n            <div style={{ fontFamily: 'system-ui, -apple-system, sans-serif', lineHeight: '1.5' }}>\n              <div style={{ \n                fontSize: '15px', \n                fontWeight: '600', \n                marginBottom: '12px', \n                color: '#1a1a1a',\n                display: 'flex',\n                alignItems: 'center',\n                gap: '8px'\n              }}>\n                <AlertCircle size={20} color=\"#ff4d4f\" style={{ flexShrink: 0 }} />\n                <span>Pro uloen je nutn vyplnit nsledujc poloky:</span>\n              </div>\n              {Object.values(validation.categories).map((cat, idx) => \n                cat.errors.length > 0 && (\n                  <div key={idx} style={{ \n                    marginBottom: '10px',\n                    padding: '10px',\n                    backgroundColor: '#fff1f0',\n                    borderRadius: '4px'\n                  }}>\n                    <div style={{ \n                      fontWeight: '600', \n                      fontSize: '13px',\n                      color: '#d32f2f',\n                      marginBottom: '6px'\n                    }}>\n                      {cat.label}\n                    </div>\n                    {cat.errors.map((err, errIdx) => (\n                      <div key={errIdx} style={{ \n                        fontSize: '12px',\n                        color: '#666',\n                        marginLeft: '8px',\n                        marginTop: '4px',\n                        display: 'flex',\n                        alignItems: 'flex-start'\n                      }}>\n                        <span style={{ marginRight: '6px', color: '#ff4d4f', fontWeight: 'bold' }}></span>\n                        <span>{err}</span>\n                      </div>\n                    ))}\n                  </div>\n                )\n              )}\n            </div>\n          );\n          showToast && showToast(errorMessage, { type: 'error' });\n          return; // Ukonit upload\n        }\n      }\n\n      // Staen souboru ze spisovky pes proxy a vytvoen File objektu\n      try {\n        // Pout proxy endpoint pro staen (een CORS)\n        const proxyUrl = `${process.env.REACT_APP_API2_BASE_URL}spisovka.php/proxy-file?url=${encodeURIComponent(spisovkaFileUrl)}`;\n        const response = await fetch(proxyUrl);\n        if (!response.ok) throw new Error('Chyba pi stahovn souboru');\n        \n        //  Zskat pvodn nzev souboru z HTTP hlaviky (pokud je k dispozici)\n        const originalFilename = response.headers.get('X-Original-Filename');\n        const finalFilename = originalFilename || spisovkaFileName;\n        \n        const blob = await response.blob();\n        const file = new File([blob], finalFilename, { type: spisovkaFileMime || blob.type });\n        \n        //  Pidat Spisovka metadata jako custom properties pro tracking\n        if (spisovkaFileId) {\n          file.spisovka_file_id = parseInt(spisovkaFileId);\n        }\n        if (spisovkaDokumentId) {\n          file.spisovka_dokument_id = parseInt(spisovkaDokumentId);\n        }\n        \n        // Zpracovat jako bn soubor\n        await handleFileUpload([file]);\n        \n        //  Toast se zobraz automaticky v handleFileUpload -> uploadAttachment\n      } catch (error) {\n        console.error(' Chyba pi stahovn souboru ze spisovky:', error);\n        showToast && showToast(' Chyba pi stahovn souboru ze spisovky', { type: 'error' });\n      }\n      return;\n    }\n    \n    // PRIORITA 2: Standardn drag & drop z filesystmu\n    const files = e.dataTransfer.files;\n    if (!files || files.length === 0) return;\n\n    await handleFileUpload(files);\n  };\n\n  // File input handler\n  const handleFileSelect = async (e) => {\n    const files = e.target.files;\n    if (!files || files.length === 0) return;\n\n    await handleFileUpload(files);\n\n    // Reset input\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  // Click handler\n  const handleDropZoneClick = () => {\n    if (!isDropzoneDisabled) {\n      fileInputRef.current?.click();\n    }\n  };\n\n  //  ISDOC Dialog Handlers - NOV ATOMICK WORKFLOW\n  const handleISDOCConfirm = async (useVariableSymbol = true) => {\n    if (!pendingISDOCFile) return;\n    try {\n      const { file, isdocData, otherFiles } = pendingISDOCFile;\n\n      // 1. Namapovat ISDOC data na fakturu\n      if (!formData) {\n        throw new Error('Chyb data formule objednvky');\n      }\n\n      //  Pedat useVariableSymbol do mapovn\n      const mappedData = mapISDOCToFaktura(isdocData, formData, useVariableSymbol);\n\n      //  KONTROLA: M u faktura reln ID?\n      const hasRealId = fakturaId && !String(fakturaId).startsWith('temp-');\n\n      let response;\n\n      if (hasRealId) {\n        //  FAKTURA U EXISTUJE  POUZE NAHRT PLOHU\n\n        const uploadResponse = await uploadInvoiceAttachment25({\n          token: token,\n          username: username,\n          faktura_id: fakturaId,\n          objednavka_id: objednavkaId,\n          typ_prilohy: 'FAKTURA',\n          file: file\n        });\n\n        response = {\n          faktura_id: fakturaId, // Pout existujc ID\n          priloha_id: uploadResponse.priloha_id,\n          priloha: uploadResponse.priloha\n        };\n      } else {\n        //  NOV FAKTURA  ATOMICKY VYTVOIT FAKTURU + PLOHU\n\n        response = await createInvoiceWithAttachment25({\n          token: token,\n          username: username,\n          objednavka_id: objednavkaId,\n          // Faktura metadata z ISDOC\n          fa_castka: mappedData.fa_castka,\n          fa_cislo_vema: mappedData.fa_cislo_vema,\n          fa_datum_vystaveni: mappedData.fa_datum_vystaveni,\n          fa_datum_splatnosti: mappedData.fa_datum_splatnosti,\n          fa_datum_doruceni: mappedData.fa_datum_doruceni,\n          fa_strediska_kod: mappedData.fa_strediska_kod,\n          fa_poznamka: mappedData.fa_poznamka,\n          fa_dorucena: 1,\n          // Ploha\n          file: file,\n          typ_prilohy: 'FAKTURA'\n        });\n\n      }\n\n      // 3. Aktualizovat UI s RELNMI ID z BE\n      if (onISDOCParsed) {\n        //  KRITICK: Pedat VDY mappedData, a u faktura byla nov nebo existujc\n        // Callback v OrderForm25 UPDATNE fakturu novmi daty z ISDOC\n        const dataToPass = {\n          ...mappedData,\n          id: response.faktura_id, //  RELN ID faktury z BE\n          _realId: response.faktura_id,\n          _updateExisting: hasRealId // Flag pro OrderForm25 - m se UPDATOVAT existujc faktura\n        };\n        onISDOCParsed(dataToPass, response.faktura_id);\n      }\n\n      // 4. Pidat plohu do loklnho stavu (u s relnm ID)\n      const typPrilohy = fakturaTypyPrilohOptions.find(t => t.kod === 'FAKTURA');\n\n      const serverAttachment = {\n        id: response.priloha_id, // RELN ID z BE\n        serverId: response.priloha_id,\n        faktura_id: response.faktura_id,\n        objednavka_id: objednavkaId,\n        name: file.name,\n        size: file.size,\n        type: file.type,\n        klasifikace: 'FAKTURA',\n        faktura_typ_nazev: typPrilohy?.nazev || 'FAKTURA',\n        uploadDate: response.priloha?.dt_vytvoreni || new Date().toISOString(),\n        status: 'uploaded',\n        je_isdoc: 1,\n        guid: response.priloha?.guid\n      };\n\n      updateAttachments(prev => [...prev, serverAttachment]);\n\n      // 5. Zpracovat ostatn soubory (pokud byly nahrny spolen)\n      if (otherFiles && otherFiles.length > 0) {\n        await handleFileUpload(otherFiles);\n      }\n\n      // 6. Zavt dialog\n      setShowISDOCDialog(false);\n      setPendingISDOCFile(null);\n      setIsdocSummary(null);\n\n      showToast&&showToast('Faktura vetn ISDOC plohy byla spn vytvoena', { type: 'success' });\n\n      //  Zavolat callback pro refresh\n      if (onAttachmentUploaded) {\n        onAttachmentUploaded();\n      }\n\n    } catch (err) {\n      showToast&&showToast(err.message || 'Chyba pi vytven faktury s plohou', { type: 'error' });\n    }\n  };\n\n  const handleISDOCUploadWithoutParsing = async () => {\n    if (!pendingISDOCFile) return;\n\n    try {\n      const { file, otherFiles } = pendingISDOCFile;\n\n      // Pidat ISDOC soubor bez parsingu - klasifikace ISDOC\n      const isdocAttachment = {\n        id: `pending-${Date.now()}`,\n        file: file,\n        name: file.name,\n        size: file.size,\n        type: file.type,\n        klasifikace: 'ISDOC', //  ISDOC typ pro ISDOC soubory\n        uploadDate: new Date().toISOString(),\n        status: 'pending_upload',\n        je_isdoc: 1\n      };\n\n      updateAttachments(prev => [...prev, isdocAttachment]);\n      await uploadFileToServer(isdocAttachment.id, 'ISDOC'); //  Upload s ISDOC typem\n\n      // Zpracovat ostatn soubory\n      if (otherFiles && otherFiles.length > 0) {\n        await handleFileUpload(otherFiles);\n      }\n\n      // Zavt dialog\n      setShowISDOCDialog(false);\n      setPendingISDOCFile(null);\n      setIsdocSummary(null);\n\n      showToast&&showToast('ISDOC soubor byl nahrn bez extrakce dat', { type: 'success' });\n\n    } catch (err) {\n      showToast&&showToast(err.message || 'Chyba pi nahrvn ISDOC', { type: 'error' });\n    }\n  };\n\n  const handleISDOCCancel = () => {\n    setShowISDOCDialog(false);\n    setPendingISDOCFile(null);\n    setIsdocSummary(null);\n    showToast&&showToast('Nahrn ISDOC zrueno', { type: 'info' });\n  };\n\n  return (\n    <>\n    <Wrapper>\n      <Header>\n        <Title>\n          <Paperclip />\n          Plohy faktury\n          {attachments.length > 0 && <Badge>{attachments.length}</Badge>}\n        </Title>\n      </Header>\n\n      {/* Hidden file input */}\n      <HiddenInput\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\".pdf,.isdoc,.jpg,.jpeg,.png,.xml\"\n        multiple\n        onChange={handleFileSelect}\n        disabled={isDropzoneDisabled}\n      />\n\n      {/*  Validan hlen - zobrazit kdy nejsou vyplnny povinn poloky */}\n      {!invoiceValidation.isValid && !readOnly && (\n        <div style={{\n          background: '#fef3c7',\n          border: '1px solid #f59e0b',\n          borderRadius: '6px',\n          padding: '1rem',\n          marginBottom: '1rem',\n          display: 'flex',\n          alignItems: 'flex-start',\n          gap: '0.75rem'\n        }}>\n          <Info size={20} style={{ color: '#f59e0b', flexShrink: 0, marginTop: '2px' }} />\n          <div style={{ flex: 1 }}>\n            <div style={{\n              fontWeight: '500',\n              color: '#92400e',\n              marginBottom: '0.25rem'\n            }}>\n              Vyplte povinn poloky faktury\n            </div>\n            <div style={{\n              fontSize: '0.875rem',\n              color: '#78350f'\n            }}>\n              Pro pidn ploh je nutn vyplnit: {invoiceValidation.missingFields?.join(', ') || 'povinn pole'}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Drag & Drop zna */}\n      {!readOnly && (\n        <DropZone\n          onClick={handleDropZoneClick}\n          onDragOver={handleDragOver}\n          onDragLeave={handleDragLeave}\n          onDrop={handleDrop}\n          isDragging={dragging}\n          disabled={isDropzoneDisabled}\n        >\n          <DropZoneIcon isDragging={dragging}>\n            {dragging ? '' : ''}\n          </DropZoneIcon>\n          <DropZoneText>\n            <DropZoneTitle>\n              {uploading\n                ? 'Nahrvm...'\n                : dragging\n                  ? 'Puste soubor'\n                  : 'Pethnte PDF, ISDOC, JPG, PNG, DOC, DOCX, XLS, XLSX nebo XML (max 10 MB)'}\n            </DropZoneTitle>\n            <DropZoneSubtitle>\n              Kliknutm otevete dialog  Po pidn vyberte typ plohy\n            </DropZoneSubtitle>\n          </DropZoneText>\n        </DropZone>\n      )}\n\n      {error && (\n        <ErrorMessage>\n          <AlertCircle />\n          {error}\n        </ErrorMessage>\n      )}\n\n      {loading && (\n        <LoadingState>\n          <Loader />\n          Natm plohy...\n        </LoadingState>\n      )}\n\n      {/* Empty state - kdy nejsou dn plohy */}\n      {!loading && attachments.length === 0 && (\n        <EmptyState>\n          <Paperclip />\n          dn plohy nejsou\n        </EmptyState>\n      )}\n\n      {/* Attachments list - PESN JAKO OBJEDNVKY */}\n      {!loading && attachments.length > 0 && (\n        <AttachmentsList>\n          {attachments.filter(file => file && file.id).map((file) => (\n            <div key={file.id} style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: '0.75rem',\n              padding: '0.75rem',\n              border: `1px solid ${getFileBorderColor(file)}`,\n              borderRadius: '6px',\n              backgroundColor: getFileBackgroundColor(file),\n              marginBottom: '0.5rem',\n              opacity: file.status === 'uploading' ? 0.6 : 1,\n              position: 'relative',\n              overflow: 'hidden'\n            }}>\n              {/* Ikona s indiktorem stavu - 32x44px aby se vely 2 dky textu */}\n              <div style={{\n                width: '32px',\n                height: '44px',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                flexShrink: 0,\n                position: 'relative'\n              }}>\n                {file.file_exists === false ? (\n                  <FileX\n                    size={24}\n                    style={{\n                      color: '#dc2626'\n                    }}\n                  />\n                ) : (\n                  <FileText\n                    size={24}\n                    style={{\n                      color: file.status === 'uploaded' ? '#10b981' : '#dc2626'\n                    }}\n                  />\n                )}\n                {file.status === 'uploaded' && (\n                  <div style={{\n                    position: 'absolute',\n                    top: '-2px',\n                    right: '-2px',\n                    width: '12px',\n                    height: '12px',\n                    backgroundColor: '#10b981',\n                    borderRadius: '50%'\n                  }} />\n                )}\n                {file.status === 'uploading' && (\n                  <div style={{\n                    position: 'absolute',\n                    top: '-2px',\n                    right: '-2px',\n                    width: '12px',\n                    height: '12px',\n                    backgroundColor: '#f59e0b',\n                    borderRadius: '50%',\n                    animation: 'spin 1s linear infinite'\n                  }} />\n                )}\n              </div>\n\n              {/*  PROGRESS BAR pro uploading status - mus bt ped obsahem */}\n              {file.status === 'uploading' && file.progress !== undefined && (\n                <div style={{\n                  position: 'absolute',\n                  bottom: 0,\n                  left: 0,\n                  right: 0,\n                  height: '4px',\n                  backgroundColor: '#fef3c7',\n                  borderRadius: '0 0 6px 6px',\n                  overflow: 'hidden',\n                  zIndex: 10\n                }}>\n                  <div style={{\n                    height: '100%',\n                    width: `${file.progress}%`,\n                    backgroundColor: 'linear-gradient(90deg, #f59e0b 0%, #fb923c 100%)',\n                    background: 'linear-gradient(90deg, #f59e0b 0%, #fb923c 100%)',\n                    transition: 'width 0.3s ease',\n                    boxShadow: '0 0 10px rgba(245, 158, 11, 0.6)'\n                  }} />\n                </div>\n              )}\n              \n              {/* Informace o souboru - 2 dky */}\n              <div style={{ flex: 1, minWidth: 0 }}>\n                {/* DEK 1: Nzev + velikost + akce (staen + ko) */}\n                <div style={{\n                  fontWeight: '500',\n                  fontSize: '0.875rem',\n                  color: '#374151',\n                  marginBottom: '2px'\n                }}>\n                  <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '0.5rem'\n                  }}>\n                    {/* Nzev souboru s hvzdikou */}\n                    <span style={{\n                      overflow: 'hidden',\n                      textOverflow: 'ellipsis',\n                      whiteSpace: 'nowrap',\n                      flex: 1,\n                      minWidth: 0,\n                      position: 'relative'\n                    }}>\n                      {file.name}\n                      {/* erven hvzdika jako horn index */}\n                      {!file.klasifikace && (\n                        <span style={{\n                          color: '#dc2626',\n                          fontSize: '0.7rem',\n                          fontWeight: 'bold',\n                          position: 'absolute',\n                          top: '-2px',\n                          marginLeft: '2px'\n                        }}>\n                          *\n                        </span>\n                      )}\n                    </span>\n\n                    {/* Warning pro soubory, kter neexistuj na disku */}\n                    {file.file_exists === false && (\n                      <span style={{\n                        color: '#dc2626',\n                        fontSize: '0.7rem',\n                        fontWeight: 'bold',\n                        backgroundColor: '#fee2e2',\n                        padding: '1px 4px',\n                        borderRadius: '3px',\n                        flexShrink: 0\n                      }}>\n                         SOUBOR NENALEZEN\n                      </span>\n                    )}\n\n                    {/* Velikost souboru */}\n                    <span style={{\n                      color: '#6b7280',\n                      fontWeight: 'normal',\n                      fontSize: '0.75rem',\n                      flexShrink: 0\n                    }}>\n                      ({Math.round((file.size || 0) / 1024)} kB)\n                    </span>\n\n                    {/* Nhled v novm okn */}\n                    {file.status === 'uploaded' && file.serverId && (\n                      <button\n                        type=\"button\"\n                        onClick={() => handleDownload(file.id)}\n                        style={{\n                          background: 'none',\n                          border: 'none',\n                          color: '#2563eb',\n                          cursor: 'pointer',\n                          padding: '2px',\n                          display: 'flex',\n                          alignItems: 'center',\n                          fontSize: '12px',\n                          flexShrink: 0\n                        }}\n                        title=\"Otevt v novm okn\"\n                      >\n                        <ExternalLink size={14} />\n                      </button>\n                    )}\n\n                    {/* Ko */}\n                    {!readOnly && (\n                      <button\n                        type=\"button\"\n                        onClick={() => file.serverId ? deleteFromServer(file.id) : removeFile(file.id)}\n                        disabled={file.status === 'uploading'}\n                        style={{\n                          background: 'none',\n                          border: 'none',\n                          color: file.status === 'uploading' ? '#9ca3af' : '#dc2626',\n                          cursor: file.status === 'uploading' ? 'not-allowed' : 'pointer',\n                          padding: '2px',\n                          display: 'flex',\n                          alignItems: 'center',\n                          opacity: file.status === 'uploading' ? 0.6 : 1,\n                          fontSize: '12px',\n                          flexShrink: 0\n                        }}\n                        title={file.serverId ? \"Smazat ze serveru\" : \"Smazat soubor\"}\n                      >\n                        <Trash2 size={14} />\n                      </button>\n                    )}\n                  </div>\n                </div>\n\n                {/* DEK 2: Datum + typ souboru + uivatel */}\n                <div style={{\n                  fontSize: '0.75rem',\n                  color: '#6b7280',\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: '0.5rem'\n                }}>\n                  <span>\n                    {file.uploadDate && !isNaN(new Date(file.uploadDate).getTime())\n                      ? `${new Date(file.uploadDate).toLocaleDateString('cs-CZ')} ${new Date(file.uploadDate).toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' })}`\n                      : ''\n                    }\n                  </span>\n                  <span></span>\n                  <span style={{\n                    textTransform: 'uppercase',\n                    backgroundColor: '#fef3c7',\n                    color: '#92400e',\n                    padding: '2px 6px',\n                    borderRadius: '4px',\n                    fontSize: '0.6875rem',\n                    fontWeight: '500'\n                  }}>\n                    {file.name ? (file.name.endsWith('.pdf') ? 'PDF' : file.name.split('.').pop().toUpperCase()) : 'FILE'}\n                  </span>\n                  <span></span>\n                  <span style={{\n                    backgroundColor: '#e0e7ff',\n                    color: '#3730a3',\n                    padding: '2px 6px',\n                    borderRadius: '4px',\n                    fontSize: '0.6875rem',\n                    fontWeight: '500'\n                  }}>\n                    Nahrno: {getUserDisplayName(file.uploadedByUserId)}\n                  </span>\n                  {file.faktura_typ_nazev && (\n                    <>\n                      <span></span>\n                      <span style={{\n                        backgroundColor: '#dbeafe',\n                        color: '#1e40af',\n                        padding: '2px 6px',\n                        borderRadius: '4px',\n                        fontSize: '0.6875rem',\n                        fontWeight: '500'\n                      }}>\n                        {file.faktura_typ_nazev}\n                      </span>\n                    </>\n                  )}\n                </div>\n              </div>\n\n              {/* Dropdown pro klasifikaci - PESN JAKO OBJEDNVKY */}\n              <div style={{ minWidth: '180px', flexShrink: 0 }}>\n                <select\n                  value={file.klasifikace || ''}\n                  onChange={(e) => updateFileKlasifikace(file.id, e.target.value)}\n                  disabled={file.status === 'uploading' || readOnly}\n                  style={{\n                    width: '100%',\n                    padding: '0.5rem 0.75rem',\n                    border: `1px solid ${!file.klasifikace ? '#fca5a5' : '#d1d5db'}`,\n                    borderRadius: '6px',\n                    fontSize: '0.875rem',\n                    backgroundColor: (file.status === 'uploading' || readOnly) ? '#f3f4f6' : 'white',\n                    color: file.klasifikace ? '#374151' : '#6b7280',\n                    cursor: (file.status === 'uploading' || readOnly) ? 'not-allowed' : 'pointer',\n                    opacity: (file.status === 'uploading' || readOnly) ? 0.6 : 1\n                  }}\n                >\n                  <option value=\"\" style={{ color: '#6b7280' }}>Vyberte...</option>\n                  {fakturaTypyPrilohOptions.map(typ => (\n                    <option key={typ.kod} value={typ.kod}>\n                      {typ.nazev}\n                    </option>\n                  ))}\n                </select>\n              </div>\n            </div>\n          ))}\n        </AttachmentsList>\n      )}\n    </Wrapper>\n\n    {/*  ISDOC Parsing Dialog */}\n    {showISDOCDialog && isdocSummary && ReactDOM.createPortal(\n      <ISDOCParsingDialog\n        isdocSummary={isdocSummary}\n        isdocData={pendingISDOCFile?.isdocData}\n        onConfirm={handleISDOCConfirm}\n        onCancel={handleISDOCCancel}\n        onUploadWithoutParsing={handleISDOCUploadWithoutParsing}\n      />,\n      document.body\n    )}\n\n    {/*  Confirm Dialog pro mazn ploh */}\n    <ConfirmDialog\n      isOpen={confirmDialog.isOpen}\n      title={confirmDialog.title}\n      confirmText=\"Smazat\"\n      variant=\"danger\"\n      onConfirm={confirmDialog.onConfirm}\n      onClose={() => setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null })}\n    >\n      {confirmDialog.message}\n    </ConfirmDialog>\n\n    {/*  File Viewer Modal (plovouc okno jako ve Spisovce) */}\n    {fileViewer.visible && ReactDOM.createPortal(\n      <FileModal \n        x={fileViewerPosition.x}\n        y={fileViewerPosition.y}\n        w={fileViewerPosition.w}\n        h={fileViewerPosition.h}\n      >\n        <FileModalContent>\n          <FileModalHeader\n            onMouseDown={(e) => {\n              // Uloit offset myi vi levmu hornmu rohu okna\n              const rect = e.currentTarget.parentElement.parentElement.getBoundingClientRect();\n              setDragOffset({\n                x: e.clientX - rect.left,\n                y: e.clientY - rect.top\n              });\n              setIsDraggingViewer(true);\n              e.preventDefault();\n              e.stopPropagation();\n            }}\n            style={{ cursor: isDraggingViewer ? 'grabbing' : 'grab' }}\n          >\n            <FileModalTitle>\n              <FileText size={20} />\n              {fileViewer.filename}\n            </FileModalTitle>\n            <FileCloseButton onClick={() => {\n              if (fileViewer.url) {\n                window.URL.revokeObjectURL(fileViewer.url);\n              }\n              setFileViewer({ visible: false, url: '', filename: '', type: '' });\n            }}>\n              <X size={18} />\n            </FileCloseButton>\n          </FileModalHeader>\n          <FileObject \n            data={fileViewer.url}\n            type={fileViewer.type === 'pdf' ? 'application/pdf' : undefined}\n            title={fileViewer.filename}\n          >\n            <PdfFallback>\n              <AlertCircle size={48} color=\"#64748b\" />\n              <div style={{ fontSize: '1.1rem', fontWeight: 600 }}>Soubor nelze zobrazit v prohlei</div>\n              <div style={{ fontSize: '0.9rem', color: '#64748b', textAlign: 'center', maxWidth: '400px' }}>\n                V prohle nepodporuje zobrazen tohoto typu soubor. Mete soubor sthnout a otevt extern.\n              </div>\n              <DownloadButton href={fileViewer.url} download={fileViewer.filename}>\n                <Download size={18} />\n                Sthnout soubor\n              </DownloadButton>\n            </PdfFallback>\n          </FileObject>\n        </FileModalContent>\n      </FileModal>,\n      document.body\n    )}\n    </>\n  );\n};\n\nexport default InvoiceAttachmentsCompact;\n","/**\n * LPCerpaniEditor.js - Komponenta pro rozdlen stky faktury mezi LP kdy\n * \n *  EL:\n * Umouje uivatelm pi kontrole vcn sprvnosti rozdlit stku faktury\n * mezi vce LP (Limitovan pslby) kd. Tm se sleduje skuten erpn\n * LP na rovni faktur, ne jen plnovan na rovni poloek.\n * \n *  PRAVIDLA:\n * - Souet stek MUS bt  fa_castka (nesm pekroit)\n * - Pokud je financovn typu LP, MUS bt min. 1 LP kd piazen\n * - Kad stka MUS bt > 0\n * - Auto-fill pro jeden LP kd (cel fa_castka)\n * \n *  DATA:\n * - Input: faktura (fa_castka), orderData (financovani)\n * - Output: lpCerpani array [{lp_cislo, lp_id, castka, poznamka}]\n * \n * Created: 2025-12-29\n */\n\nimport React, { useState, useEffect, useCallback, useMemo, useRef } from 'react';\nimport styled from '@emotion/styled';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faPlus,\n  faTimes,\n  faInfoCircle,\n  faExclamationTriangle,\n  faCheckCircle\n} from '@fortawesome/free-solid-svg-icons';\nimport { Trash, Hash } from 'lucide-react';\nimport { CustomSelect } from '../CustomSelect';\n\n// ============ STYLED COMPONENTS ============\n\nconst EditorWrapper = styled.div`\n  background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);\n  border: 1px solid ${props => props.hasError ? '#dc3545' : '#e9ecef'};\n  border-radius: 12px;\n  padding: 24px;\n  margin-bottom: 24px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n  transition: all 0.2s ease;\n  \n  &:hover {\n    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n  }\n`;\n\nconst EditorHeader = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 16px;\n  padding-bottom: 12px;\n  border-bottom: 2px solid #dee2e6;\n`;\n\nconst HeaderTitle = styled.h4`\n  margin: 0;\n  font-size: 16px;\n  font-weight: 600;\n  color: #333;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  svg {\n    color: #007bff;\n  }\n`;\n\nconst SummaryBox = styled.div`\n  display: flex;\n  gap: 24px;\n  font-size: 14px;\n`;\n\nconst SummaryItem = styled.div`\n  display: flex;\n  flex-direction: column;\n  \n  label {\n    font-size: 11px;\n    text-transform: uppercase;\n    color: #6c757d;\n    margin-bottom: 4px;\n  }\n  \n  span {\n    font-size: 16px;\n    font-weight: 600;\n    color: ${props => props.highlight ? '#007bff' : '#333'};\n  }\n`;\n\nconst LPRow = styled.div`\n  display: grid;\n  grid-template-columns: 1fr 220px 52px; /* Lep proporce pro vt elementy */\n  gap: 24px; /* Vt mezery */\n  margin-bottom: 24px;\n  align-items: end;\n  padding: 24px; /* Vt padding */\n  background: white;\n  border: 1px solid #e9ecef;\n  border-radius: 12px; /* Vt border-radius */\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); /* Jemnj shadow */\n  \n  @media (max-width: 1200px) {\n    grid-template-columns: 2fr 180px 52px;\n    gap: 16px;\n  }\n  \n  @media (max-width: 768px) {\n    grid-template-columns: 1fr;\n    gap: 16px;\n    align-items: stretch;\n    padding: 16px;\n  }\n`;\n\nconst FormGroup = styled.div`\n  display: flex;\n  flex-direction: column;\n  min-height: 80px; /* Vt vka pro lep proporce */\n  \n  label {\n    font-size: 14px; /* Vt font pro lep itelnost */\n    font-weight: 600;\n    color: #495057;\n    margin-bottom: 8px;\n    height: 22px;\n    line-height: 22px;\n    display: flex;\n    align-items: center;\n  }\n\n  /* Sjednocen vky vech input element */\n  [data-component=\"CustomSelect\"] {\n    height: 48px !important; /* Vt vka pro lep UX */\n    \n    & > div:first-of-type {\n      height: 48px !important;\n      display: flex;\n      align-items: center;\n      padding: 0 16px; /* Vt padding pro lep design */\n      font-size: 15px; /* Vt font v selectu */\n      font-weight: ${props => props.isFilled ? '600' : '400'}; /* Tun kdy je vyplnn */\n      \n      /* Ellipsis pro dlouh texty */\n      overflow: hidden;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n      max-width: 100%;\n    }\n    \n    /* Centrace placeholderu */\n    .select__placeholder {\n      line-height: 1;\n      font-size: 15px;\n      font-weight: 400; /* Placeholder vdy normln */\n      overflow: hidden;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n    }\n    \n    /* Styling pro dropdown options */\n    .select__option {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      max-width: 100%;\n      padding: 8px 12px;\n      \n      &:hover {\n        background: #f8f9fa;\n      }\n    }\n  }\n`;\n\nconst Select = styled.select`\n  padding: 8px 12px;\n  border: 1px solid #ced4da;\n  border-radius: 4px;\n  font-size: 14px;\n  background: white;\n  \n  &:focus {\n    outline: none;\n    border-color: #007bff;\n    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);\n  }\n  \n  &:disabled {\n    background: #e9ecef;\n    cursor: not-allowed;\n  }\n`;\n\nconst AmountInput = styled.input`\n  width: 100%;\n  height: 48px; /* Stejn vka jako CustomSelect */\n  padding: 12px 50px 12px 16px; /* Vt padding pro lep UX */\n  border: 1px solid ${props => props.hasError ? '#dc3545' : '#ced4da'};\n  border-radius: 6px;\n  font-size: 15px; /* Vt font pro lep itelnost */\n  font-weight: ${props => (props.value && props.value !== '0' && props.value !== '') ? '600' : '400'}; /* Tun kdy je vyplnn */\n  text-align: right;\n  font-family: inherit; /* Sjednocen font s celou strnkou */\n  box-sizing: border-box;\n  transition: border-color 0.15s ease;\n  \n  &:focus {\n    outline: none;\n    border-color: ${props => props.hasError ? '#dc3545' : '#007bff'};\n    box-shadow: 0 0 0 3px ${props => props.hasError ? 'rgba(220, 53, 69, 0.15)' : 'rgba(0, 123, 255, 0.15)'};\n  }\n  \n  &:disabled {\n    background: #f8f9fa;\n    cursor: not-allowed;\n    color: #6c757d;\n  }\n  \n  &::placeholder {\n    color: #adb5bd;\n    font-style: normal;\n  }\n`;\n\nconst AmountInputWrapper = styled.div`\n  position: relative;\n  flex: 1;\n  display: flex;\n  align-items: center;\n`;\n\nconst CurrencySymbol = styled.span`\n  position: absolute;\n  right: 16px; /* Vt offset kvli vtmu paddingu */\n  color: ${props => props.disabled ? '#9ca3af' : '#374151'};\n  font-weight: 600;\n  font-size: 15px; /* Vt font pro sladn s inputem */\n  font-family: inherit;\n  pointer-events: none;\n  user-select: none;\n`;\n\nconst ButtonGroup = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  align-items: center;\n  justify-content: flex-end;\n  min-height: 80px; /* Odpovd FormGroup min-height */\n  padding-bottom: 4px;\n`;\n\nconst IconButton = styled.button`\n  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);\n  color: white;\n  border: none;\n  border-radius: 8px;\n  padding: 0;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 48px; /* Stejn velikost jako vka input */\n  height: 48px;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 8px rgba(239, 68, 68, 0.25);\n\n  &:hover:not(:disabled) {\n    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.35);\n  }\n\n  &:active:not(:disabled) {\n    transform: translateY(0);\n    box-shadow: 0 2px 4px rgba(239, 68, 68, 0.25);\n  }\n\n  &:disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n    transform: none;\n    box-shadow: none;\n  }\n\n  svg {\n    color: white;\n    width: 18px; /* Vt ikona pro lep proporce */\n    height: 18px;\n  }\n`;\n\nconst AddButton = styled.button`\n  padding: 12px 20px; /* Vt padding */\n  border: 2px dashed #007bff;\n  border-radius: 8px; /* Vt border-radius */\n  background: white;\n  color: #007bff;\n  font-size: 15px; /* Vt font */\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n  margin-top: 12px;\n  width: 100%;\n  \n  &:hover:not(:disabled) {\n    background: #007bff;\n    color: white;\n    border-style: solid;\n  }\n  \n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    border-color: #ced4da;\n    color: #6c757d;\n  }\n`;\n\nconst ValidationMessage = styled.div`\n  margin-top: 12px;\n  padding: 12px 16px;\n  border-radius: 6px;\n  font-size: 14px;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  \n  background: ${props => {\n    if (props.type === 'error') return '#f8d7da';\n    if (props.type === 'warning') return '#fff3cd';\n    if (props.type === 'success') return '#d1e7dd';\n    return '#d1ecf1';\n  }};\n  \n  color: ${props => {\n    if (props.type === 'error') return '#842029';\n    if (props.type === 'warning') return '#664d03';\n    if (props.type === 'success') return '#0f5132';\n    return '#055160';\n  }};\n  \n  border: 1px solid ${props => {\n    if (props.type === 'error') return '#f5c2c7';\n    if (props.type === 'warning') return '#ffecb5';\n    if (props.type === 'success') return '#badbcc';\n    return '#b6effb';\n  }};\n  \n  svg {\n    flex-shrink: 0;\n  }\n`;\n\nconst AutoFillNote = styled.div`\n  background: #e7f3ff;\n  border-left: 4px solid #007bff;\n  padding: 12px 16px;\n  margin-bottom: 16px;\n  font-size: 13px;\n  color: #004085;\n  border-radius: 4px;\n`;\n\n// ============ HELPERS ============\n\nconst formatCurrency = (value) => {\n  if (!value && value !== 0) return '';\n  const num = parseFloat(value);\n  if (isNaN(num)) return '';\n  return num.toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ' ').replace('.', ',');\n};\n\nconst parseCurrency = (value) => {\n  if (!value) return 0;\n  const cleaned = value.toString().replace(/\\s/g, '').replace(',', '.');\n  const num = parseFloat(cleaned);\n  return isNaN(num) ? 0 : num;\n};\n\n// ============ MAIN COMPONENT ============\n\n// CurrencyAmountInput Sub-komponenta pro stku s K\nconst CurrencyAmountInput = React.memo(function CurrencyAmountInput({ value, onChange, hasError, disabled }) {\n  const [localValue, setLocalValue] = useState('');\n  const [isFocused, setIsFocused] = useState(false);\n  const inputRef = useRef(null);\n\n  // Formtovn mny\n  const formatCurrency = useCallback((val) => {\n    if (!val && val !== 0) return '';\n    const num = parseFloat(val.toString().replace(/[^0-9.-]/g, ''));\n    if (isNaN(num)) return '';\n    return num.toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ' ').replace('.', ',');\n  }, []);\n\n  // Potan hodnota msto useEffect\n  const displayValue = useMemo(() => {\n    if (isFocused) {\n      return localValue;\n    }\n    return formatCurrency(value || '');\n  }, [value, isFocused, localValue, formatCurrency]);\n\n  // Synchronizovat localValue s value pouze kdy nen focused\n  useEffect(() => {\n    if (!isFocused) {\n      setLocalValue(formatCurrency(value || ''));\n    }\n  }, [value, isFocused, formatCurrency]);\n\n  const handleChange = useCallback((e) => {\n    const newValue = e.target.value;\n    setLocalValue(newValue);\n\n    // Oistit hodnotu a vrtit jako string s tekou\n    const cleanValue = newValue.replace(/[^\\d,.-]/g, '').replace(',', '.');\n    const numValue = parseFloat(cleanValue);\n    const finalValue = isNaN(numValue) ? '' : numValue.toFixed(2);\n\n    onChange(finalValue);\n  }, [onChange]);\n\n  const handleFocus = useCallback(() => {\n    setIsFocused(true);\n  }, []);\n\n  const handleBlurLocal = useCallback(() => {\n    setIsFocused(false);\n\n    // Formtovat hodnotu pi ztrt fokusu\n    const formatted = formatCurrency(localValue);\n    setLocalValue(formatted);\n  }, [localValue, formatCurrency]);\n\n  return (\n    <AmountInputWrapper>\n      <AmountInput\n        ref={inputRef}\n        type=\"text\"\n        value={displayValue}\n        onChange={handleChange}\n        onFocus={handleFocus}\n        onBlur={handleBlurLocal}\n        disabled={disabled}\n        hasError={hasError}\n        placeholder=\"0,00\"\n      />\n      <CurrencySymbol disabled={disabled}>K</CurrencySymbol>\n    </AmountInputWrapper>\n  );\n});\n\nfunction LPCerpaniEditor({ \n  faktura, \n  orderData, \n  lpCerpani = [], \n  availableLPCodes = [], \n  onChange,\n  onValidationChange, \n  disabled = false\n}) {\n  \n  const [rows, setRows] = useState([]);\n  const [validationMessages, setValidationMessages] = useState([]);\n  \n  //  States pro CustomSelect\n  const [selectStates, setSelectStates] = useState({});\n  const [searchStates, setSearchStates] = useState({});\n  const [touchedSelectFields, setTouchedSelectFields] = useState({});\n  \n  //  Ref pro sledovn, zda u byl proveden auto-fill (aby se neopakoval)\n  const autoFilledRef = useRef(false);\n  const prevFakturaIdRef = useRef(null);\n  const prevLpCerpaniLengthRef = useRef(0);\n  \n  //  Stabiln ref pro onValidationChange callback (prevence infinite loop)\n  const onValidationChangeRef = useRef(onValidationChange);\n  useEffect(() => {\n    onValidationChangeRef.current = onValidationChange;\n  }, [onValidationChange]);\n\n  // Filtrovat LP kdy podle financovn objednvky\n  const filteredLPCodes = useMemo(() => {\n    if (!availableLPCodes || availableLPCodes.length === 0) {\n      return [];\n    }\n    \n    // Zkusit nkolik monch umstn LP kd v orderData\n    let lpKodyFromOrder = null;\n    \n    // Monost 1: orderData.lp_kod (array) - pvodn OrderForm25\n    if (orderData?.lp_kod && Array.isArray(orderData.lp_kod) && orderData.lp_kod.length > 0) {\n      lpKodyFromOrder = orderData.lp_kod;\n    }\n    // Monost 2: orderData.financovani.lp_kody (z parsed financovn)\n    else if (orderData?.financovani?.lp_kody && Array.isArray(orderData.financovani.lp_kody) && orderData.financovani.lp_kody.length > 0) {\n      lpKodyFromOrder = orderData.financovani.lp_kody;\n    }\n    \n    if (!lpKodyFromOrder || lpKodyFromOrder.length === 0) {\n      // Fallback: Pokud nejsou specifikovny LP kdy, zobraz vechny dostupn\n      return availableLPCodes;\n    }\n    \n    // Filtrovat availableLPCodes podle LP kd z objednvky\n    const filtered = availableLPCodes.filter(lpOption => {\n      return lpKodyFromOrder.some(kodValue => {\n        // kodValue me bt ID nebo kd (string)\n        return lpOption.id === kodValue || \n               lpOption.id === Number(kodValue) ||\n               lpOption.kod === kodValue ||\n               lpOption.cislo_lp === kodValue;\n      });\n    });\n    \n    return filtered.length > 0 ? filtered : availableLPCodes;\n  }, [orderData?.lp_kod, orderData?.financovani, availableLPCodes]);\n\n  // Transformovat options pro CustomSelect\n  const transformedOptions = useMemo(() => {\n    return filteredLPCodes.map(lp => ({\n      ...lp,\n      label: (() => {\n        const kod = lp.cislo_lp || lp.kod || lp.id;\n        const nazev = lp.nazev_uctu || lp.nazev || 'Bez nzvu';\n        \n        // Zkrcen dlouhch nzv pro lep responsivitu\n        const maxLength = 35;\n        const fullLabel = `${kod} - ${nazev}`;\n        \n        if (fullLabel.length > maxLength) {\n          return `${kod} - ${nazev.substring(0, maxLength - kod.length - 6)}...`;\n        }\n        \n        return fullLabel;\n      })()\n    }));\n  }, [filteredLPCodes]);\n\n  // Je LP financovn?\n  const isLPFinancing = filteredLPCodes.length > 0;\n  \n  // Reset auto-fill flag kdy se zmn faktura\n  useEffect(() => {\n    if (faktura?.id !== prevFakturaIdRef.current) {\n      autoFilledRef.current = false;\n      prevFakturaIdRef.current = faktura?.id;\n      prevLpCerpaniLengthRef.current = 0;\n    }\n  }, [faktura?.id]);\n\n  // Inicializace rows z lpCerpani prop - JEN pi zmn faktury\n  useEffect(() => {\n    // SPUSTIT JEN pi prvn inicializaci nebo zmn faktury\n    if (!autoFilledRef.current) {\n      const currentLength = lpCerpani?.length || 0;\n      \n      if (currentLength > 0) {\n        // Nast existujc data\n        setRows(lpCerpani.map((item, idx) => {\n          // Najt LP kd v dostupnch options pro sprvn namapovn\n          const matchedLP = availableLPCodes?.find(lp => \n            lp.id === item.lp_id || \n            lp.cislo_lp === item.lp_cislo || \n            lp.kod === item.lp_cislo\n          );\n          \n          return {\n            id: `row_${idx}_${Date.now()}`,\n            lp_cislo: item.lp_cislo || '',\n            lp_id: item.lp_id || (matchedLP ? matchedLP.id : null),\n            castka: item.castka || 0,\n            poznamka: item.poznamka || '',\n            lp_data: matchedLP || null\n          };\n        }));\n        autoFilledRef.current = true;\n      } else if (isLPFinancing && filteredLPCodes.length === 1 && faktura?.fa_castka) {\n        //  AUTO-FILL: Pouze pokud jet nebylo auto-filled\n        const autoRow = {\n          id: `row_auto_${Date.now()}`,\n          lp_cislo: filteredLPCodes[0].cislo_lp || filteredLPCodes[0].kod,\n          lp_id: filteredLPCodes[0].id,\n          castka: parseFloat(faktura.fa_castka),\n          poznamka: '',\n          lp_data: filteredLPCodes[0]\n        };\n        setRows([autoRow]);\n        autoFilledRef.current = true;\n      } else {\n        // Przdn lpCerpani a nen co auto-fillovat\n        setRows([]);\n      }\n    }\n  }, [faktura?.id, isLPFinancing, filteredLPCodes]);\n\n  // Souet piazench stek\n  const totalAssigned = useMemo(() => {\n    return rows.reduce((sum, row) => sum + (parseFloat(row.castka) || 0), 0);\n  }, [rows]);\n\n  // Validace\n  useEffect(() => {\n    const messages = [];\n    const faCastka = parseFloat(faktura?.fa_castka) || 0;\n\n    // 1. Povinnost pro LP financovn - mus mt alespo jeden VALIDN dek\n    const validRows = rows.filter(r => r.lp_id && r.lp_cislo && r.castka > 0);\n    if (isLPFinancing && validRows.length === 0) {\n      messages.push({\n        type: 'error',\n        text: ' Objednvka je financovna z LP. Muste piadit alespo jeden LP kd s stkou!',\n        code: 'MISSING_LP'\n      });\n    }\n\n    // 2. Kontrola nevyplnnch dk (m LP kd ale ne stku nebo naopak)\n    const incompleteRows = rows.filter(r => \n      (r.lp_id && (!r.castka || r.castka <= 0)) || \n      (!r.lp_id && r.castka > 0)\n    );\n    if (incompleteRows.length > 0) {\n      messages.push({\n        type: 'error',\n        text: ' Vechny dky mus mt vyplnn LP kd i stku',\n        code: 'INCOMPLETE_ROWS'\n      });\n    }\n\n    // 3. Kontrola pekroen\n    if (totalAssigned > faCastka) {\n      messages.push({\n        type: 'error',\n        text: ` Souet LP erpn (${formatCurrency(totalAssigned)} K) pekrauje stku faktury (${formatCurrency(faCastka)} K)`,\n        code: 'EXCEEDS_LIMIT'\n      });\n    }\n\n    // 4. Informace o neplnm piazen (ne error!)\n    if (totalAssigned > 0 && totalAssigned < faCastka) {\n      messages.push({\n        type: 'info',\n        text: ` Piadili jste ${formatCurrency(totalAssigned)} K z ${formatCurrency(faCastka)} K faktury. Rozdlen stky je na va odpovdnosti.`,\n        code: 'PARTIAL_ASSIGNMENT'\n      });\n    }\n\n    // 5. Potvrzen plnho piazen\n    if (totalAssigned === faCastka && rows.length > 0) {\n      messages.push({\n        type: 'success',\n        text: ` Cel stka faktury byla piazena na LP kdy.`,\n        code: 'COMPLETE'\n      });\n    }\n\n    setValidationMessages(messages);\n    \n    // Informovat parent o chybch pomoc stabilnho ref callbacku\n    if (onValidationChangeRef.current) {\n      const hasErrors = messages.some(m => m.type === 'error');\n      onValidationChangeRef.current(hasErrors);\n    }\n  }, [rows, totalAssigned, faktura, isLPFinancing]);\n\n  // Handler pro zmnu LP kdu\n  const handleLPChange = useCallback((rowId, selectedLpId) => {\n    setRows(prev => {\n      const updated = prev.map(row => {\n        if (row.id === rowId) {\n          // Najt LP kd podle ID\n          const lpOption = filteredLPCodes.find(lp => lp.id === selectedLpId);\n          \n          return {\n            ...row,\n            lp_cislo: lpOption ? lpOption.cislo_lp || lpOption.kod : '',\n            lp_id: selectedLpId || null,\n            lp_data: lpOption || null\n          };\n        }\n        return row;\n      });\n      \n      return updated;\n    });\n  }, [filteredLPCodes]);\n\n  // Handler pro zmnu stky\n  const handleCastkaChange = useCallback((rowId, value) => {\n    setRows(prev => {\n      const updated = prev.map(row => \n        row.id === rowId \n          ? { ...row, castka: parseCurrency(value) }\n          : row\n      );\n      \n      return updated;\n    });\n  }, []);\n\n  // Handler pro smazn dku\n  const handleRemoveRow = useCallback((rowId) => {\n    setRows(prev => {\n      const updated = prev.filter(row => row.id !== rowId);\n      \n      // Voln onChange okamit po aktualizaci\n      if (onChange) {\n        const validRows = updated.filter(r => r.lp_id && r.lp_cislo && r.castka > 0);\n        setTimeout(() => onChange(validRows), 0);\n      }\n      \n      return updated;\n    });\n  }, [onChange]);\n\n  // Handler pro pidn dku\n  const handleAddRow = useCallback(() => {\n    const newRow = {\n      id: `row_${Date.now()}`,\n      lp_cislo: '',\n      lp_id: null,\n      castka: 0,\n      poznamka: ''\n    };\n    setRows(prev => {\n      const updated = [...prev, newRow];\n      \n      // Voln onChange okamit po aktualizaci\n      if (onChange) {\n        const validRows = updated.filter(r => r.lp_id && r.lp_cislo && r.castka > 0);\n        setTimeout(() => onChange(validRows), 0);\n      }\n      \n      return updated;\n    });\n  }, [onChange]);\n  \n  // Handler pro uloen dat pi oputn pole\n  const handleSaveData = useCallback(() => {\n    if (onChange) {\n      const validRows = rows.filter(r => r.lp_id && r.lp_cislo && r.castka > 0);\n      onChange(validRows);\n    }\n  }, [onChange, rows]);\n\n  const toggleSelect = useCallback((fieldName) => {\n    setSelectStates(prev => ({\n      ...prev,\n      [fieldName]: !prev[fieldName]\n    }));\n  }, []);\n\n  const filterOptions = useCallback((options, searchTerm, field) => {\n    if (!searchTerm) return options;\n    \n    const searchLower = searchTerm.toLowerCase();\n    return options.filter(option => {\n      // Hledej v cislo_lp, kdu i nzvu\n      const kod = option.cislo_lp || option.kod || option.id || '';\n      const nazev = option.nazev_uctu || option.nazev || '';\n      \n      return kod.toLowerCase().includes(searchLower) || \n             nazev.toLowerCase().includes(searchLower);\n    });\n  }, []);\n\n  return (\n    <EditorWrapper>\n      <EditorHeader>\n        <HeaderTitle>\n          <FontAwesomeIcon icon={faInfoCircle} />\n          LP erpn na Faktue\n        </HeaderTitle>\n        <SummaryBox>\n          <SummaryItem>\n            <label>Faktura stka</label>\n            <span>{formatCurrency(faktura?.fa_castka || 0)} K</span>\n          </SummaryItem>\n          <SummaryItem highlight>\n            <label>Piazeno celkem</label>\n            <span>{formatCurrency(totalAssigned)} K</span>\n          </SummaryItem>\n          <SummaryItem>\n            <label>Zbv piadit</label>\n            <span>{formatCurrency((faktura?.fa_castka || 0) - totalAssigned)} K</span>\n          </SummaryItem>\n        </SummaryBox>\n      </EditorHeader>\n\n      {filteredLPCodes.length === 1 && rows.length > 0 && (\n        <AutoFillNote>\n           Objednvka pouv pouze jeden LP kd, stka byla automaticky pedvyplnna. Mete ji upravit podle poteby.\n        </AutoFillNote>\n      )}\n\n      {rows.map((row, index) => (\n        <LPRow key={row.id}>\n          <FormGroup>\n            <label>\n              LP kd&nbsp;<span style={{ color: '#dc2626' }}>*</span>\n            </label>\n            <CustomSelect\n              data-component=\"CustomSelect\"\n              value={row.lp_id || ''}\n              onChange={(e) => {\n                const selectedId = e?.target?.value || e;\n                handleLPChange(row.id, selectedId);\n              }}\n              onBlur={handleSaveData}\n              options={transformedOptions}\n              placeholder=\"-- Vyberte LP kd --\"\n              field={`lp_kod_${row.id}`}\n              icon={<Hash />}\n              disabled={disabled}\n              hasError={!row.lp_id}\n              required={true}\n              multiple={false}\n              selectStates={selectStates}\n              setSelectStates={setSelectStates}\n              searchStates={searchStates}\n              setSearchStates={setSearchStates}\n              touchedSelectFields={touchedSelectFields}\n              setTouchedSelectFields={setTouchedSelectFields}\n              hasTriedToSubmit={false}\n              toggleSelect={toggleSelect}\n              filterOptions={filterOptions}\n              getOptionLabel={(option) => option?.label || `${option?.cislo_lp || option?.kod || option?.id} - ${option?.nazev_uctu || option?.nazev || 'Bez nzvu'}`}\n            />\n          </FormGroup>\n\n          <FormGroup>\n            <label>stka (K)&nbsp;<span style={{color: '#dc2626'}}>*</span></label>\n            <CurrencyAmountInput\n              value={row.castka || ''}\n              onChange={(newValue) => handleCastkaChange(row.id, newValue)}\n              onBlur={handleSaveData}\n              hasError={!row.castka || row.castka <= 0}\n              disabled={disabled}\n              required\n            />\n          </FormGroup>\n\n          <ButtonGroup>\n            <IconButton\n              type=\"button\"\n              variant=\"danger\"\n              onClick={() => handleRemoveRow(row.id)}\n              disabled={disabled || rows.length === 1}\n              title=\"Odebrat dek\"\n            >\n              <Trash size={16} />\n            </IconButton>\n          </ButtonGroup>\n        </LPRow>\n      ))}\n\n      {filteredLPCodes.length > rows.length && (\n        <AddButton\n          type=\"button\"\n          onClick={handleAddRow}\n          disabled={disabled}\n        >\n          <FontAwesomeIcon icon={faPlus} /> Pidat dal LP kd\n        </AddButton>\n      )}\n\n      {validationMessages.map((msg, idx) => (\n        <ValidationMessage key={idx} type={msg.type}>\n          <FontAwesomeIcon \n            icon={\n              msg.type === 'error' ? faExclamationTriangle :\n              msg.type === 'success' ? faCheckCircle :\n              faInfoCircle\n            } \n          />\n          <span>{msg.text}</span>\n        </ValidationMessage>\n      ))}\n    </EditorWrapper>\n  );\n}\n\n// React.memo pro prevenci zbytench re-render\nexport default React.memo(LPCerpaniEditor);\n"],"names":["async","parseISDOCFile","file","text","xmlDoc","DOMParser","parseFromString","parserError","querySelector","Error","textContent","invoice","documentElement","invoiceId","getTextContent","issueDate","taxPointDate","dueDate","join","note","supplier","supplierName","supplierICO","supplierDIC","supplierAddress","extractAddress","customer","customerName","customerICO","customerDIC","customerAddress","electronicMail","items","querySelectorAll","forEach","line","_getTextContent$match","itemElement","popis","descElement","nameElement","trim","item","id","mnozstvi","parseFloat","jednotka","match","cena_za_jednotku","cena_celkem_bez_dph","sazba_dph","cena_celkem_s_dph","push","taxTotal","taxExclusiveAmount","taxInclusiveAmount","payableAmount","allowanceTotalAmount","chargeTotalAmount","allowanceCharges","ac","chargeIndicator","amount","reason","typ","castka","duvod","itemsTotalWithVat","reduce","sum","calculatedDiscount","actualDiscount","discountPercent","paymentMeans","bankAccount","bankCode","iban","swift","variableSymbol","constantSymbol","specificSymbol","cislo_faktury","datum_vystaveni","datum_zdanitelneho_plneni","datum_splatnosti","poznamka","dodavatel","nazev","ico","dic","adresa","odberatel","email","polozky","pocet_polozek","length","castka_bez_dph","dph_celkem","castka_s_dph","sleva_celkem","sleva_procenta","sleva_deklarovana","priplatek_celkem","slevy_a_priplatky","ma_slevu","soucet_polozek_s_dph","platba","bankovni_ucet","kod_banky","variabilni_symbol","konstantni_symbol","specificky_symbol","_parsed","_parsedAt","Date","toISOString","_fileName","name","error","concat","message","parent","selector","selectors","split","map","s","sel","element","postalAddress","street","buildingNumber","city","zip","country","filter","Boolean","mapISDOCToFaktura","isdocData","_isdocData$platba","_isdocData$odberatel","_isdocData$platba2","formData","arguments","undefined","useVariableSymbol","dnesniDatum","polozkyText","lines","index","toLocaleString","minimumFractionDigits","formatPolozkyToTable","fa_cislo_vema","fa_datum_vystaveni","fa_datum_zdanitelneho_plneni","fa_datum_splatnosti","fa_datum_doruceni","fa_castka","fa_castka_bez_dph","fa_dph","fa_poznamka","fa_strediska_kod","strediska_kod","isdoc_data_json","JSON","stringify","_isdoc_platba","_isdoc_polozky","_isdoc_pocet_polozek","_isdoc_dodavatel","_isdoc_email","_isdoc_cislo_faktury","_isdoc_variabilni_symbol","_isdoc_parsed","_isdoc_parsed_at","_isdoc_file_name","createISDOCSummary","_isdocData$platba3","_isdocData$dodavatel","_isdocData$polozky","maximumFractionDigits","celkova_castka_polozek","p","pdfToCanvas","arrayBuffer","pdfjsLib","console","log","byteLength","loadingTask","getDocument","data","verbosity","pdf","promise","numPages","page","getPage","viewport","getViewport","scale","width","height","canvas","document","createElement","context","getContext","renderTask","render","canvasContext","extractTextFromPDF","onProgress","retryCount","ArrayBuffer","MAX_RETRIES","worker","Promise","race","_","reject","setTimeout","conversionError","resolve","createWorker","logger","m","status","progress","Math","round","setParameters","tessedit_pageseg_mode","preserve_interword_spaces","tessedit_char_whitelist","workerError","_result$data","_result$data2","result","recognize","TIMEOUT_MS","confidence","toFixed","recognizeError","includes","terminate","e","warn","stack","extractInvoiceData","datumVystaveni","datumSplatnosti","variabilniSymbol","isFaktura","warning","normalizedText","toLowerCase","some","keyword","vsPatterns","pattern","allDateMatches","dateRegex","exec","dateStr","startPos","endPos","contextBefore","substring","max","contextAfter","min","normalizedContext","replace","cleanDateStr","parsed","parseCzechDate","date","originalDate","fullContext","position","d","i","slice","issueDateKeywords","word","score","aliases","bestIssueDate","bestIssueScore","bestIssueDebug","dateMatch","foundKeywords","keywordObj","mainWord","wordScore","floor","alias","antiKeywords","antiWord","hasWeakDne","hasStrongKeyword","kw","dueDateKeywords","bestDueDate","bestDueScore","bestDueDebug","amountPatterns","parseAmount","allAmounts","amounts","a","parts","day","padStart","month","year","amountStr","cleaned","commaCount","dotCount","normalized","lastIndexOf","isNaN","styled","div","_templateObject","_taggedTemplateLiteral","_templateObject2","props","isDragging","uploading","_templateObject3","_templateObject4","_templateObject5","_templateObject6","input","_templateObject7","_templateObject8","_templateObject9","_templateObject0","type","detected","onClick","show","deleting","span","button","variant","formatDateCZ","dateString","String","getDate","getMonth","getFullYear","Overlay","Modal","Header","CloseButton","HeaderIcon","HeaderTitle","HeaderTitleText","h2","HeaderSubtitle","Content","InfoBox","InfoText","_templateObject1","TwoColumnLayout","_templateObject10","h3","_templateObject11","_templateObject12","LeftColumn","_templateObject13","RightColumn","_templateObject14","TopRowGrid","_templateObject15","DataItem","_templateObject16","DataLabel","_templateObject17","DataValue","_templateObject18","Footer","_templateObject19","_templateObject20","Button","_templateObject21","WarningBox","_templateObject22","WarningText","_templateObject23","CheckboxContainer","_templateObject24","CheckboxLabel","label","_templateObject25","CheckboxHint","_templateObject26","ItemsSection","_templateObject27","ItemsSectionTitle","_templateObject28","ItemsList","_templateObject29","ItemRow","_templateObject30","ItemHeader","_templateObject31","ItemName","_templateObject32","ItemPrice","_templateObject33","ItemDetails","_templateObject34","ItemDetail","_templateObject35","_ref","isdocSummary","onConfirm","onCancel","onUploadWithoutParsing","setUseVariableSymbol","React","_jsx","stopPropagation","children","_jsxs","FileText","X","Info","Calendar","Banknote","className","style","display","alignItems","gap","flexWrap","fontSize","color","fontWeight","opacity","Building","Package","polozka","_polozka$cena_celkem_","_polozka$cena_za_jedn","_polozka$cena_celkem_2","flex","checked","onChange","target","AlertCircle","CheckCircle","collapsed","hasAttachments","Wrapper","Title","Badge","DropZone","disabled","DropZoneIcon","DropZoneText","DropZoneTitle","DropZoneSubtitle","HiddenInput","AttachmentsList","EmptyState","FileModal","x","y","w","h","FileModalContent","FileModalHeader","FileModalTitle","FileCloseButton","FileObject","object","PdfFallback","DownloadButton","LoadingState","ErrorMessage","_invoiceValidation$mi","fakturaId","objednavkaId","fakturaTypyPrilohOptions","readOnly","onISDOCParsed","faktura","validateInvoiceForAttachments","isPokladna","onAttachmentUploaded","onAttachmentRemoved","attachments","externalAttachments","onAttachmentsChange","onCreateInvoiceInDB","onOCRDataExtracted","allUsers","username","token","useContext","AuthContext","showToast","ToastContext","loading","setLoading","useState","setUploading","setError","dragging","setDragging","fileInputRef","showISDOCDialog","setShowISDOCDialog","pendingISDOCFile","setPendingISDOCFile","setIsdocSummary","fileViewer","setFileViewer","visible","url","filename","fileViewerPosition","setFileViewerPosition","screenWidth","window","innerWidth","screenHeight","innerHeight","isDraggingViewer","setIsDraggingViewer","dragOffset","setDragOffset","confirmDialog","setConfirmDialog","isOpen","title","hasLoadedFromServerRef","useMemo","Array","isArray","att","size","_objectSpread","file_size","velikost_souboru_b","updateAttachments","useCallback","updater","newAttachments","getUserDisplayName","userId","user","find","u","user_id","titul_pred","jmeno","prijmeni","titul_za","handleFileViewerDrag","preventDefault","prev","newX","clientX","newY","clientY","boundedX","boundedY","handleFileViewerDragEnd","useEffect","handleMouseMove","handleMouseUp","addEventListener","removeEventListener","current","startsWith","loadAttachmentsFromServer","prevFakturaIdRef","prevId","currentId","wasTemp","isRealNow","pendingAttachments","attachment","_response$priloha","_response$data","_response$data$priloh","_response$data2","response","uploadInvoiceAttachment25","faktura_id","objednavka_id","typ_prilohy","klasifikace","attachmentId","priloha","priloha_id","serverId","uploadError","uploadPendingAttachments","_response$data3","listInvoiceAttachments25","serverAttachments","prilohy","fileExists","file_exists","hasError","file_error","typPrilohy","t","kod","original_name","originalni_nazev_souboru","endsWith","faktura_typ_nazev","uploadDate","upload_date","dt_vytvoreni","uploadedByUserId","uploaded_by_user_id","nahrano_uzivatel_id","je_isdoc","areAttachmentsEqual","b","every","_b$i","_b$i2","finalAttachments","numFakturaId","Number","verifyResult","verifyInvoiceAttachments25","invoice_id","verifiedAtt","v","attachment_id","summary","missing_files","verifyErr","err","validateFile","isAllowedInvoiceFileType","isAllowedInvoiceFileSize","handleFileUpload","fileArray","from","files","isdocFiles","f","isISDOCFile","nonIsdocFiles","validation","isValid","errorMessage","fontFamily","lineHeight","marginBottom","flexShrink","Object","values","categories","cat","idx","errors","padding","backgroundColor","borderRadius","errIdx","marginLeft","marginTop","marginRight","isdocFile","otherFiles","parseError","newFiles","jeISDOC","autoKlasifikace","now","spisovka_dokument_id","spisovka_file_id","firstFile","localStorage","setItem","updated","requestAnimationFrame","uploadFileToServer","getFileBorderColor","getFileBackgroundColor","fileId","klasifikaceOverride","fileObj","_validation$missingFi2","_validation$missingFi","isISDOC","missingFields","_response$priloha2","_response$data4","_response$data4$prilo","_response$data5","realFakturaId","group","groupEnd","successMessage","CheckCircle2","uploadedAttachment","typ_prilohy_nazev","nazev_souboru","velikost","datum_vytvoreni","fileName","errorMsg","progressInterval","setInterval","currentProgress","newProgress","random","_response$priloha3","_response$data6","_response$data6$prilo","_response$data7","clearInterval","invoiceValidation","isDropzoneDisabled","_Fragment","Paperclip","ref","accept","multiple","value","background","border","handleDropZoneClick","_fileInputRef$current","click","onDragOver","onDragLeave","currentTarget","contains","relatedTarget","onDrop","spisovkaAttachmentsJson","dataTransfer","getData","parse","downloadPromises","proxyUrl","process","encodeURIComponent","fetch","ok","finalFilename","headers","get","blob","File","mime_type","all","spisovkaFileUrl","spisovkaFileName","spisovkaFileMime","spisovkaFileId","spisovkaDokumentId","parseInt","Loader","overflow","justifyContent","FileX","top","right","animation","bottom","left","zIndex","transition","boxShadow","minWidth","textOverflow","whiteSpace","blobData","downloadInvoiceAttachment25","ext","pop","mimeType","Blob","URL","createObjectURL","link","href","download","body","appendChild","removeChild","revokeObjectURL","handleDownload","cursor","ExternalLink","deleteInvoiceAttachment25","hard_delete","success","_err$response","deleteFromServer","removeFile","Trash2","getTime","toLocaleDateString","toLocaleTimeString","hour","minute","textTransform","toUpperCase","updateInvoiceAttachment25","updateFileKlasifikace","ReactDOM","ISDOCParsingDialog","_response$priloha4","_response$priloha5","mappedData","hasRealId","uploadResponse","createInvoiceWithAttachment25","fa_dorucena","dataToPass","_realId","_updateExisting","serverAttachment","guid","handleISDOCCancel","isdocAttachment","ConfirmDialog","confirmText","onClose","onMouseDown","rect","parentElement","getBoundingClientRect","textAlign","maxWidth","Download","EditorWrapper","EditorHeader","h4","SummaryBox","SummaryItem","highlight","LPRow","FormGroup","isFilled","AmountInput","select","AmountInputWrapper","CurrencySymbol","ButtonGroup","IconButton","AddButton","ValidationMessage","AutoFillNote","formatCurrency","num","parseCurrency","toString","CurrencyAmountInput","localValue","setLocalValue","isFocused","setIsFocused","inputRef","useRef","val","displayValue","handleChange","newValue","cleanValue","numValue","finalValue","handleFocus","handleBlurLocal","formatted","onFocus","onBlur","placeholder","LPCerpaniEditor","_ref2","orderData","lpCerpani","availableLPCodes","onValidationChange","rows","setRows","validationMessages","setValidationMessages","selectStates","setSelectStates","searchStates","setSearchStates","touchedSelectFields","setTouchedSelectFields","autoFilledRef","prevLpCerpaniLengthRef","onValidationChangeRef","filteredLPCodes","_orderData$financovan","lpKodyFromOrder","lp_kod","financovani","lp_kody","filtered","lpOption","kodValue","cislo_lp","transformedOptions","lp","nazev_uctu","fullLabel","isLPFinancing","matchedLP","lp_id","lp_cislo","lp_data","autoRow","totalAssigned","row","messages","faCastka","validRows","r","code","hasErrors","handleLPChange","rowId","selectedLpId","handleCastkaChange","handleRemoveRow","handleAddRow","newRow","handleSaveData","toggleSelect","fieldName","filterOptions","options","searchTerm","field","searchLower","option","FontAwesomeIcon","icon","faInfoCircle","CustomSelect","_e$target","selectedId","Hash","required","hasTriedToSubmit","getOptionLabel","Trash","faPlus","msg","faExclamationTriangle","faCheckCircle"],"sourceRoot":""}