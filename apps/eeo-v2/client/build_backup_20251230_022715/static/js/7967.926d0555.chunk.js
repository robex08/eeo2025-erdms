"use strict";(self.webpackChunkr_app_zzs_eeo=self.webpackChunkr_app_zzs_eeo||[]).push([[4795,7967,8319,9690],{27967:(e,a,n)=>{n.r(a),n.d(a,{default:()=>L});var o=n(89379),t=n(65043),i=n(27837),s=n(96427),c=n(83910),l=n(97929),r=n(70579);const d=function(e){var a;let{title:o,onMenuClick:s,notificationCount:d=0,showBackButton:u=!1,onBackClick:m,onActivityClick:v,activityCount:h=0}=e;const{isLoggedIn:p,token:b,user:j}=(0,t.useContext)(i.cy),[y,g]=(0,t.useState)(null),k="1.92",f=(null===(a=k.match(/(\d+\.\d+[a-z]?)/))||void 0===a?void 0:a[1])||k,_="undefined"!==typeof window&&window.location.pathname.startsWith("/dev/");return(0,t.useEffect)(()=>{if(!p||!b||null===j||void 0===j||!j.username)return void g(null);(async()=>{try{var e;const{getGlobalSettings:a}=await Promise.resolve().then(n.bind(n,58319)),{getUserDetailApi2:o}=await Promise.resolve().then(n.bind(n,75949)),t=await a(b,j.username),i=await o(j.username,b,j.id),s=(null===i||void 0===i||null===(e=i.roles)||void 0===e?void 0:e.some(e=>{var a;return null===(a=e.prava)||void 0===a?void 0:a.some(e=>"HIERARCHY_IMMUNE"===e.kod_prava)}))||!1;t.hierarchy_enabled&&t.hierarchy_profile_id?g({profileId:t.hierarchy_profile_id,enabled:!0,isImmune:s}):g({enabled:!1})}catch(a){console.error("\ud83d\udcf1 [MobileHeader] Chyba p\u0159i na\u010d\xedt\xe1n\xed hierarchie:",a),g(null)}})()},[p,b,null===j||void 0===j?void 0:j.username,null===j||void 0===j?void 0:j.id]),(0,r.jsx)("header",{className:"mobile-header",style:{background:_?"linear-gradient(135deg, #654321 0%, #8B4513 40%, #A0522D 70%, #8B0000 100%)":"linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%)"},children:(0,r.jsxs)("div",{className:"mobile-header-container",children:[u?(0,r.jsx)("button",{className:"mobile-back-btn",onClick:m,"aria-label":"Zp\u011bt",children:(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24",children:(0,r.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})})}):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"mobile-logo",children:(0,r.jsx)("img",{src:"/eeo-v2/logo-ZZS.png",alt:"ZZS Logo",className:"mobile-logo-img"})})}),(0,r.jsxs)("div",{className:"mobile-app-title",children:[(0,r.jsxs)("h1",{children:[o||"EEO",!o&&(0,r.jsxs)("sup",{style:{fontSize:"0.45em",marginLeft:"4px",fontWeight:"600",color:"#fbbf24",textShadow:"0 1px 2px rgba(0,0,0,0.3)"},children:[_&&(0,r.jsx)("span",{style:{color:"#ff6b6b",fontWeight:"700",backgroundColor:"rgba(220, 38, 38, 0.2)",padding:"1px 4px",borderRadius:"2px",marginRight:"4px",border:"1px solid rgba(220, 38, 38, 0.4)",textShadow:"0 1px 3px rgba(0,0,0,0.5)",fontSize:"0.95em"},children:"DEVELOP"}),f,(null===y||void 0===y?void 0:y.enabled)&&(null===y||void 0===y?void 0:y.profileId)&&(0,r.jsxs)("span",{style:{color:y.isImmune?"#9ca3af":"#10b981",fontWeight:"700",opacity:y.isImmune?.6:1},children:[".H",y.profileId]})]})]}),!o&&(0,r.jsx)("span",{className:"mobile-app-subtitle",children:"Elektronick\xe1 evidence objedn\xe1vek"})]}),(0,r.jsxs)("div",{className:"mobile-header-actions",children:[!u&&v&&(0,r.jsxs)("button",{className:"mobile-activity-btn",onClick:v,"aria-label":"Historie aktivit",children:[(0,r.jsx)(c.g,{icon:l.Yj9}),h>0&&(0,r.jsx)("span",{className:"mobile-activity-badge",children:h>9?"9+":h})]}),d>0&&(0,r.jsxs)("button",{className:"mobile-notification-btn","aria-label":"Notifikace",children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"})}),d>0&&(0,r.jsx)("span",{className:"mobile-notification-badge",children:d>99?"99+":d})]}),(0,r.jsxs)("button",{className:"mobile-menu-btn",onClick:s,"aria-label":"Menu",children:[(0,r.jsx)("span",{}),(0,r.jsx)("span",{}),(0,r.jsx)("span",{})]})]})]})})};const u=function(e){var a,n;let{isOpen:o,onClose:c,user:l,userDetail:d,authUser:u,onNavigate:m}=e;const{logout:v}=(0,t.useContext)(i.cy),{mode:h,preference:p,setThemePreference:b}=(0,s.A)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mobile-menu-overlay ".concat(o?"open":""),onClick:e=>{e.target===e.currentTarget&&c()}}),(0,r.jsxs)("div",{className:"mobile-menu ".concat(o?"open":""),children:[(0,r.jsxs)("div",{className:"mobile-menu-header",children:[(0,r.jsx)("button",{className:"mobile-menu-close",onClick:c,"aria-label":"Zav\u0159\xedt menu",children:(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})}),(0,r.jsx)("h3",{children:"Menu"})]}),(0,r.jsxs)("div",{className:"mobile-menu-content",children:[l&&(0,r.jsxs)("div",{className:"mobile-menu-user",children:[(0,r.jsx)("div",{className:"mobile-menu-user-avatar",children:null!==d&&void 0!==d&&d.jmeno?d.jmeno.charAt(0).toUpperCase():null!==u&&void 0!==u&&u.displayName?u.displayName.charAt(0).toUpperCase():"U"}),(0,r.jsxs)("div",{className:"mobile-menu-user-info",children:[(0,r.jsx)("div",{className:"mobile-menu-user-name",children:(()=>{if(!d)return(null===u||void 0===u?void 0:u.displayName)||(null===u||void 0===u?void 0:u.username)||"U\u017eivatel";const e=[];return d.titul_pred&&e.push(d.titul_pred),d.jmeno&&e.push(d.jmeno),d.prijmeni&&e.push(d.prijmeni),d.titul_za&&e.push(d.titul_za),e.length>0?e.join(" "):(null===u||void 0===u?void 0:u.displayName)||(null===u||void 0===u?void 0:u.username)||"U\u017eivatel"})()}),(0,r.jsxs)("div",{className:"mobile-menu-user-details",children:[(null===d||void 0===d?void 0:d.usek_nazev)&&(0,r.jsx)("span",{className:"user-detail-item",children:"object"===typeof d.usek_nazev?null===(a=d.usek_nazev)||void 0===a?void 0:a.nazev:d.usek_nazev}),(null===d||void 0===d?void 0:d.lokalita_nazev)&&(0,r.jsx)("span",{className:"user-detail-item",children:"object"===typeof d.lokalita_nazev?null===(n=d.lokalita_nazev)||void 0===n?void 0:n.nazev:d.lokalita_nazev})]}),(0,r.jsx)("div",{className:"mobile-menu-user-email",children:(null===d||void 0===d?void 0:d.email)||(null===u||void 0===u?void 0:u.mail)||(null===u||void 0===u?void 0:u.upn)||(null===u||void 0===u?void 0:u.username)||""})]})]}),(0,r.jsxs)("nav",{className:"mobile-menu-nav",children:[(0,r.jsxs)("button",{className:"mobile-menu-item",onClick:()=>{m("dashboard"),c()},children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),(0,r.jsx)("span",{children:"Dashboard"})]}),(0,r.jsxs)("button",{className:"mobile-menu-item",onClick:()=>{m("activity"),c()},children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"})}),(0,r.jsx)("span",{children:"Aktivita"})]})]}),(0,r.jsxs)("div",{className:"mobile-menu-section",children:[(0,r.jsx)("div",{className:"mobile-menu-section-title",children:"Re\u017eim zobrazen\xed"}),(0,r.jsxs)("div",{className:"mobile-menu-theme-options",children:[(0,r.jsxs)("button",{className:"mobile-menu-theme-btn ".concat("auto"===p?"active":""),onClick:()=>b("auto"),children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),(0,r.jsx)("span",{children:"Automaticky"}),"auto"===p&&(0,r.jsxs)("span",{className:"mobile-menu-theme-current",children:["(","dark"===h?"Tmav\xfd":"Sv\u011btl\xfd",")"]})]}),(0,r.jsxs)("button",{className:"mobile-menu-theme-btn ".concat("light"===p?"active":""),onClick:()=>b("light"),children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"})}),(0,r.jsx)("span",{children:"Sv\u011btl\xfd"})]}),(0,r.jsxs)("button",{className:"mobile-menu-theme-btn ".concat("dark"===p?"active":""),onClick:()=>b("dark"),children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M9 2c-1.05 0-2.05.16-3 .46 4.06 1.27 7 5.06 7 9.54 0 4.48-2.94 8.27-7 9.54.95.3 1.95.46 3 .46 5.52 0 10-4.48 10-10S14.52 2 9 2z"})}),(0,r.jsx)("span",{children:"Tmav\xfd"})]})]})]}),(0,r.jsx)("div",{className:"mobile-menu-footer",children:(0,r.jsxs)("button",{className:"mobile-menu-logout",onClick:async()=>{try{await v()}catch(e){console.error("Logout failed:",e)}},children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"})}),(0,r.jsx)("span",{children:"Odhl\xe1sit se"})]})})]})]})]})},m="eeo_activity_log",v={ORDER_APPROVED:"order_approved",ORDER_REJECTED:"order_rejected",ORDER_WAITING:"order_waiting",ORDER_CREATED:"order_created",ORDER_UPDATED:"order_updated",ORDER_DELETED:"order_deleted",INVOICE_APPROVED:"invoice_approved",INVOICE_REJECTED:"invoice_rejected",INVOICE_CREATED:"invoice_created",INVOICE_UPDATED:"invoice_updated",CASHBOOK_CREATED:"cashbook_created",CASHBOOK_UPDATED:"cashbook_updated",CASHBOOK_DELETED:"cashbook_deleted"},h={ORDER:"order",INVOICE:"invoice",CASHBOOK:"cashbook"},p=()=>{try{const e=localStorage.getItem(m);if(!e)return[];const a=JSON.parse(e),n=Date.now(),o=864e5,t=a.filter(e=>n-e.timestamp<o);return t.length!==a.length&&localStorage.setItem(m,JSON.stringify(t)),t.sort((e,a)=>a.timestamp-e.timestamp)}catch(e){return console.error("[ActivityLog] Chyba p\u0159i na\u010d\xedt\xe1n\xed aktivit:",e),[]}},b=e=>{let{entityType:a,entityId:n,activityType:o,title:t,amount:i=null,userName:s,description:c,metadata:l={}}=e;try{const e=p(),r={id:"".concat(a,"_").concat(n,"_").concat(Date.now()),timestamp:Date.now(),entityType:a,entityId:n,activityType:o,title:t,amount:i,userName:s,description:c,metadata:l};e.unshift(r);const d=e.slice(0,100);return localStorage.setItem(m,JSON.stringify(d)),console.log("[ActivityLog] Aktivita p\u0159id\xe1na:",r),r}catch(r){return console.error("[ActivityLog] Chyba p\u0159i p\u0159id\xe1v\xe1n\xed aktivity:",r),null}},j=()=>{try{return localStorage.removeItem(m),console.log("[ActivityLog] V\u0161echny aktivity vymaz\xe1ny"),!0}catch(e){return console.error("[ActivityLog] Chyba p\u0159i maz\xe1n\xed aktivit:",e),!1}},y=e=>e.includes("approved")?"activity-success":e.includes("rejected")?"activity-danger":e.includes("waiting")?"activity-warning":e.includes("created")||e.includes("updated")?"activity-info":e.includes("deleted")?"activity-danger":"activity-default",g=e=>{const a=Date.now()-e,n=Math.floor(a/6e4),o=Math.floor(a/36e5);return n<1?"pr\xe1v\u011b te\u010f":n<60?"p\u0159ed ".concat(n," min"):o<24?"p\u0159ed ".concat(o," h"):"p\u0159ed 1 dnem"};const k=function(e){let{isOpen:a,onClose:n}=e;const[o,i]=(0,t.useState)([]);(0,t.useEffect)(()=>{a&&s()},[a]);const s=()=>{const e=p();i(e)};return a?(0,r.jsx)("div",{className:"mobile-activity-overlay",onClick:n,children:(0,r.jsxs)("div",{className:"mobile-activity-panel",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"mobile-activity-header",children:[(0,r.jsxs)("h2",{children:["\ud83d\udccb Historie aktivit",(0,r.jsx)("span",{className:"mobile-activity-count",children:o.length})]}),(0,r.jsx)("button",{className:"mobile-activity-close",onClick:n,"aria-label":"Zav\u0159\xedt",children:(0,r.jsx)(c.g,{icon:l.GRI})})]}),(0,r.jsx)("div",{className:"mobile-activity-subtitle",children:"Posledn\xed aktivity za 24 hodin"}),(0,r.jsx)("div",{className:"mobile-activity-list",children:0===o.length?(0,r.jsxs)("div",{className:"mobile-activity-empty",children:[(0,r.jsx)(c.g,{icon:l.iW_,className:"empty-icon"}),(0,r.jsx)("p",{children:"Zat\xedm \u017e\xe1dn\xe9 aktivity"}),(0,r.jsx)("span",{className:"empty-hint",children:"Schv\xe1len\xed a dal\u0161\xed akce se zobraz\xed zde"})]}):o.map(e=>{var a,n,o,t;return(0,r.jsxs)("div",{className:"mobile-activity-card ".concat(y(e.activityType)),"data-entity-id":(null===(a=e.metadata)||void 0===a?void 0:a.orderId)||e.id,children:[(0,r.jsx)("div",{className:"activity-icon",children:(0,r.jsx)(c.g,{icon:(t=e.activityType,t.includes("approved")?l.SGM:t.includes("rejected")?l.s0Q:t.includes("waiting")?l.TuH:t.includes("created")?l.OQW:t.includes("updated")?l.MT7:t.includes("deleted")?l.yLS:l.iW_)})}),(0,r.jsxs)("div",{className:"activity-content",children:[(0,r.jsxs)("div",{className:"activity-meta",children:[(0,r.jsx)("span",{className:"activity-entity",children:(o=e.entityType,{[h.ORDER]:"Objedn\xe1vka",[h.INVOICE]:"Faktura",[h.CASHBOOK]:"Pokladna"}[o]||o)}),(0,r.jsx)("span",{className:"activity-time",children:g(e.timestamp)})]}),(0,r.jsxs)("div",{className:"activity-title",children:["Ev. \u010d\xedslo: ",(null===(n=e.metadata)||void 0===n?void 0:n.orderNumber)||e.entityId]}),e.title&&!e.title.startsWith("Objedn\xe1vka")&&(0,r.jsx)("div",{className:"activity-description",style:{fontWeight:600,color:"#212529",marginBottom:"0.25rem"},children:e.title}),(0,r.jsx)("div",{className:"activity-description",children:e.description}),e.amount&&(0,r.jsx)("div",{className:"activity-amount",children:new Intl.NumberFormat("cs-CZ",{style:"currency",currency:"CZK",minimumFractionDigits:0,maximumFractionDigits:0}).format(e.amount)})]})]},e.id)})}),o.length>0&&(0,r.jsx)("div",{className:"mobile-activity-footer",children:(0,r.jsxs)("button",{className:"mobile-activity-clear-btn",onClick:()=>{window.confirm("Opravdu smazat celou historii aktivit?")&&(j(),i([]))},children:[(0,r.jsx)(c.g,{icon:l.yLS}),"Vymazat historii"]})})]})}):null};const f=function(e){let{show:a,type:n="approved",message:o="\xdasp\u011b\u0161n\u011b provedeno",onComplete:i}=e;const[s,d]=(0,t.useState)("hidden");return(0,t.useEffect)(()=>{if(a){d("show");const e=setTimeout(()=>{d("flyaway")},1200),a=setTimeout(()=>{d("hidden"),i&&i()},2e3);return()=>{clearTimeout(e),clearTimeout(a)}}},[a,i]),"hidden"===s?null:(0,r.jsx)("div",{className:"mobile-success-animation ".concat(s," ").concat((()=>{switch(n){case"approved":default:return"success-animation-approved";case"rejected":return"success-animation-rejected";case"waiting":return"success-animation-waiting"}})()),children:(0,r.jsxs)("div",{className:"success-animation-content",children:[(0,r.jsx)("div",{className:"success-animation-icon",children:(0,r.jsx)(c.g,{icon:(()=>{switch(n){case"approved":default:return l.SGM;case"rejected":return l.s0Q;case"waiting":return l.TuH}})()})}),(0,r.jsx)("div",{className:"success-animation-message",children:o})]})})};const _=function(e){var a,n,o,i,s,d,u;let{order:m,onApprove:v,onReject:h,onWait:p,loading:b}=e;const[j,y]=(0,t.useState)(null),g=async(e,a)=>{y(e);try{await a(m)}finally{y(null)}},k=(e=>{if(null!=e.faktury_celkova_castka_s_dph&&""!==e.faktury_celkova_castka_s_dph){const a=parseFloat(e.faktury_celkova_castka_s_dph);if(!isNaN(a)&&a>0)return a}if(null!=e.polozky_celkova_cena_s_dph&&""!==e.polozky_celkova_cena_s_dph){const a=parseFloat(e.polozky_celkova_cena_s_dph);if(!isNaN(a)&&a>0)return a}if(e.polozky&&Array.isArray(e.polozky)&&e.polozky.length>0){const a=e.polozky.reduce((e,a)=>{const n=parseFloat(a.cena_s_dph||0);return e+(isNaN(n)?0:n)},0);if(a>0)return a}if(null!=e.max_cena_s_dph&&""!==e.max_cena_s_dph){const a=parseFloat(e.max_cena_s_dph);if(!isNaN(a))return a}return 0})(m);let f="Neuvedeno",_=null,N=null;if(m.financovani){if("object"===typeof m.financovani)N=m.financovani;else if("string"===typeof m.financovani)try{N=JSON.parse(m.financovani)}catch(z){f=m.financovani}if(N){const e=N.kod_stavu||N.typ||"",a={LP:"Limitovan\xfd p\u0159\xedslib",SMLOUVA:"Smlouva",INDIVIDUALNI_SCHVALENI:"Individu\xe1ln\xed schv\xe1len\xed",INDIVIDUALNI:"Individu\xe1ln\xed schv\xe1len\xed",POJISTNA_UDALOST:"Pojistn\xe1 ud\xe1lost",POJISTNE_UDALOSTI:"Pojistn\xe1 ud\xe1lost"};if(f=N.nazev_stavu||N.nazev||a[e]||e||"Neuvedeno","LP"===e)if(N.lp_nazvy&&Array.isArray(N.lp_nazvy)){_=N.lp_nazvy.map(e=>e.cislo_lp||e.id).filter(Boolean).join(", ")||"LP"}else N.lp_kody&&Array.isArray(N.lp_kody)&&(_=N.lp_kody.join(", "));else"SMLOUVA"===e&&N.cislo_smlouvy?_=N.cislo_smlouvy:"INDIVIDUALNI_SCHVALENI"!==e&&"INDIVIDUALNI"!==e||!N.individualni_schvaleni?"POJISTNA_UDALOST"!==e&&"POJISTNE_UDALOSTI"!==e||!N.pojistna_udalost_cislo||(_=N.pojistna_udalost_cislo):_=N.individualni_schvaleni}}else m.zpusob_financovani&&(f=m.zpusob_financovani);const x=m.predmet||"Bez n\xe1zvu",A=m.cislo_objednavky||m.ev_cislo||"#".concat(m.id),w=1===m.mimoradna_udalost||!0===m.mimoradna_udalost;let E="Nezn\xe1m\xfd";null!==(a=m.objednatel)&&void 0!==a&&a.cele_jmeno?E=m.objednatel.cele_jmeno:null!==(n=m._enriched)&&void 0!==n&&null!==(o=n.objednatel)&&void 0!==o&&o.cele_jmeno?E=m._enriched.objednatel.cele_jmeno:m.objednatel_cele_jmeno?E=m.objednatel_cele_jmeno:m.objednatel_jmeno?E=m.objednatel_jmeno:m.jmeno&&(E=m.jmeno);let C=null;return null!==(i=m.garant_uzivatel)&&void 0!==i&&i.cele_jmeno?C=m.garant_uzivatel.cele_jmeno:null!==(s=m._enriched)&&void 0!==s&&null!==(d=s.garant)&&void 0!==d&&d.cele_jmeno?C=m._enriched.garant.cele_jmeno:m.garant_cele_jmeno?C=m.garant_cele_jmeno:m.garant_jmeno&&(C=m.garant_jmeno),(0,r.jsxs)("div",{className:"mobile-approval-card ".concat(w?"urgent":""),children:[(0,r.jsxs)("div",{className:"mobile-approval-header",children:[(0,r.jsxs)("span",{className:"mobile-approval-number",children:[A,w&&(0,r.jsx)("span",{className:"mobile-approval-urgent-badge",children:" \u26a0\ufe0f"})]}),(0,r.jsx)("span",{className:"mobile-approval-objednatel",children:E})]}),(0,r.jsx)("div",{className:"mobile-approval-subject",children:x}),(0,r.jsxs)("div",{className:"mobile-approval-details",children:[(0,r.jsxs)("div",{className:"mobile-approval-detail-row",children:[C&&(0,r.jsxs)("div",{className:"mobile-approval-detail mobile-approval-detail-half",children:[(0,r.jsx)("span",{className:"mobile-approval-label",children:"Garant:"}),(0,r.jsx)("span",{className:"mobile-approval-value",children:C})]}),(0,r.jsxs)("div",{className:"mobile-approval-detail mobile-approval-detail-half",children:[(0,r.jsx)("span",{className:"mobile-approval-label",children:"Celkov\xe1 cena s DPH:"}),(0,r.jsx)("span",{className:"mobile-approval-value",children:(S=k,new Intl.NumberFormat("cs-CZ",{style:"currency",currency:"CZK",minimumFractionDigits:0,maximumFractionDigits:0}).format(S))})]})]}),(0,r.jsxs)("div",{className:"mobile-approval-detail",children:[(0,r.jsx)("span",{className:"mobile-approval-label",children:"Zdroj financov\xe1n\xed:"}),(0,r.jsx)("span",{className:"mobile-approval-value",children:_?"".concat(f," : ").concat(_):f})]}),(null===(u=m.financovani)||void 0===u?void 0:u.poznamka)&&(0,r.jsxs)("div",{className:"mobile-approval-detail",children:[(0,r.jsx)("span",{className:"mobile-approval-label",children:"Pozn\xe1mka:"}),(0,r.jsx)("span",{className:"mobile-approval-value",children:m.financovani.poznamka})]})]}),(0,r.jsxs)("div",{className:"mobile-approval-actions",children:[(0,r.jsxs)("button",{className:"mobile-approval-btn approve",onClick:()=>g("approve",v),disabled:b||null!==j,title:"Schv\xe1lit objedn\xe1vku",children:["approve"===j?(0,r.jsx)(c.g,{icon:l.z1G,spin:!0}):(0,r.jsx)(c.g,{icon:l.e68}),(0,r.jsx)("span",{children:"Schv\xe1lit"})]}),(0,r.jsxs)("button",{className:"mobile-approval-btn reject",onClick:()=>g("reject",h),disabled:b||null!==j,title:"Zam\xedtnout objedn\xe1vku",children:["reject"===j?(0,r.jsx)(c.g,{icon:l.z1G,spin:!0}):(0,r.jsx)(c.g,{icon:l.GRI}),(0,r.jsx)("span",{children:"Zam\xedtnout"})]}),(0,r.jsxs)("button",{className:"mobile-approval-btn wait",onClick:()=>g("wait",p),disabled:b||null!==j,title:"Ozna\u010dit jako \u010dek\xe1 se",children:["wait"===j?(0,r.jsx)(c.g,{icon:l.z1G,spin:!0}):(0,r.jsx)(c.g,{icon:l.a$}),(0,r.jsx)("span",{children:"\u010cek\xe1 se"})]})]})]});var S};const N=function(e){let{isOpen:a,onClose:n,onConfirm:o,title:i,message:s,confirmText:c="Potvrdit",cancelText:l="Zru\u0161it",requireReason:d=!1,reasonPlaceholder:u="Zadejte d\u016fvod...",variant:m="primary"}=e;const[v,h]=(0,t.useState)(""),[p,b]=(0,t.useState)("");(0,t.useEffect)(()=>{a&&(h(""),b(""))},[a]),(0,t.useEffect)(()=>(document.body.style.overflow=a?"hidden":"",()=>{document.body.style.overflow=""}),[a]);const j=()=>{n()};return a?(0,r.jsx)("div",{className:"mobile-confirm-overlay",onClick:j,children:(0,r.jsxs)("div",{className:"mobile-confirm-dialog ".concat(m),onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("div",{className:"mobile-confirm-header",children:(0,r.jsx)("h3",{children:i})}),(0,r.jsxs)("div",{className:"mobile-confirm-body",children:[s&&(0,r.jsx)("p",{className:"mobile-confirm-message",children:s}),d&&(0,r.jsxs)("div",{className:"mobile-confirm-reason",children:[(0,r.jsx)("textarea",{value:v,onChange:e=>{h(e.target.value),b("")},placeholder:u,rows:4,autoFocus:!0}),p&&(0,r.jsx)("div",{className:"mobile-confirm-error",children:p})]})]}),(0,r.jsxs)("div",{className:"mobile-confirm-actions",children:[(0,r.jsx)("button",{className:"mobile-confirm-btn cancel",onClick:j,children:l}),(0,r.jsx)("button",{className:"mobile-confirm-btn confirm ".concat(m),onClick:()=>{!d||v.trim()?(o(v.trim()),n()):b("D\u016fvod je povinn\xfd")},children:c})]})]})}):null};var x=n(49690),A=n(44649),w=n(30264),E=n(95680),C=n(34795),S=n(29742);const z={async getAllMobileData(e){let{token:a,username:n,year:o=(new Date).getFullYear(),userId:t=null,isAdmin:i=!1,showArchived:s=!1}=e;try{var c,l;const e=(new Date).getMonth()+1,r=await C.Ay.getHierarchyConfigCached(a,n),[d,u,m]=await Promise.allSettled([(0,A.cn)({rok:o},a,n,!1,!0),(0,w.uA)({token:a,username:n,year:o,page:1,per_page:1e3}),E.default.getCashboxListByPeriod(o,e,!0,!0)]);let v=null;"fulfilled"===d.status&&Array.isArray(d.value)?v=this.calculateOrdersStats(d.value,t,i,s):(console.error("[MobileData] \u274c Orders API FAILED! Reason:",d.reason),v={total:0,totalAmount:0,pending:{count:0,amount:0},approved:{count:0,amount:0},inProgress:{count:0,amount:0},completed:{count:0,amount:0},rejected:{count:0,amount:0},cancelled:{count:0,amount:0}});let h=null;"fulfilled"===u.status&&null!==(c=u.value)&&void 0!==c&&c.faktury?h=this.calculateInvoicesStats(u.value.faktury):(console.error("[MobileData] \u274c Invoices API FAILED! Reason:",u.reason),h={total:0,totalAmount:0,paid:{count:0,amount:0},unpaid:{count:0,amount:0},overdue:{count:0,amount:0},regular:{count:0,amount:0},advance:{count:0,amount:0},corrective:{count:0,amount:0},proforma:{count:0,amount:0},creditNote:{count:0,amount:0},withoutAssignment:{count:0,amount:0}});let p=null;return"fulfilled"===m.status&&"ok"===(null===(l=m.value)||void 0===l?void 0:l.status)?p=this.calculateCashbookStats(m.value.data):(console.error("[MobileData] \u274c Cashbook API FAILED! Reason:",m.reason),p={count:0,balance:0,pokladny:[]}),{success:!0,data:{orders:v,invoices:h,cashbook:p,notifications:{unread:0}},meta:{year:o,period:"Rok ".concat(o),dataSource:{orders:"fulfilled"===d.status?"API":"MOCK",invoices:"fulfilled"===u.status?"API":"MOCK",cashbook:"fulfilled"===m.status?"API":"MOCK"},hierarchy:{status:r.status,enabled:r.enabled,profileName:r.profileName,logic:r.logic,message:C.Ay.getHierarchyInfoMessage(r,C.fb.ORDERS)}}}}catch(r){return console.error("[MobileData] \u274c CRITICAL ERROR loading mobile data:",r),{success:!1,error:r.message,data:{orders:{total:0,totalAmount:0,pending:{count:0,amount:0},approved:{count:0,amount:0},inProgress:{count:0,amount:0},completed:{count:0,amount:0},rejected:{count:0,amount:0},cancelled:{count:0,amount:0}},invoices:{total:0,totalAmount:0,paid:{count:0,amount:0},unpaid:{count:0,amount:0},overdue:{count:0,amount:0},regular:{count:0,amount:0},advance:{count:0,amount:0},corrective:{count:0,amount:0},proforma:{count:0,amount:0},creditNote:{count:0,amount:0},withoutAssignment:{count:0,amount:0}},cashbook:{count:0,balance:0,pokladny:[]},notifications:{unread:0}},meta:{year:(new Date).getFullYear(),period:"ERROR",dataSource:{orders:"ERROR",invoices:"ERROR",cashbook:"ERROR"}}}}},calculateOrdersStats(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const t=(0,S.qF)(e,{showArchived:o,userId:a,isAdmin:n}),i=(0,S.sL)(t),s=e=>t.filter(a=>(0,S.we)(a)===e).reduce((e,a)=>e+(0,S.Kt)(a),0);return{total:i.total,totalAmount:i.totalAmount,pending:{count:i.byStatus.ODESLANA_KE_SCHVALENI||0,amount:s("ODESLANA_KE_SCHVALENI")},approved:{count:i.byStatus.SCHVALENA||0,amount:s("SCHVALENA")},maBytZverejnena:{count:i.byStatus.K_UVEREJNENI_DO_REGISTRU||0,amount:s("K_UVEREJNENI_DO_REGISTRU")},uverejnena:{count:i.byStatus.UVEREJNENA||0,amount:s("UVEREJNENA")},vecnaSpravnost:{count:i.byStatus.VECNA_SPRAVNOST||0,amount:s("VECNA_SPRAVNOST")},completed:{count:i.byStatus.DOKONCENA||0,amount:s("DOKONCENA")},rejected:{count:i.byStatus.ZAMITNUTA||0,amount:s("ZAMITNUTA")},cancelled:{count:i.byStatus.ZRUSENA||0,amount:s("ZRUSENA")}}},calculateInvoicesStats(e){const a=new Date;a.setHours(0,0,0,0);const n={total:e.length,totalAmount:0,paid:{count:0,amount:0},unpaid:{count:0,amount:0},overdue:{count:0,amount:0},regular:{count:0,amount:0},advance:{count:0,amount:0},corrective:{count:0,amount:0},proforma:{count:0,amount:0},creditNote:{count:0,amount:0},withoutAssignment:{count:0,amount:0}};return e.forEach(e=>{const o=parseFloat(e.fa_castka||0);n.totalAmount+=o;const t=(e=>{if(1===e.fa_zaplacena||!0===e.fa_zaplacena)return"paid";if(e.fa_datum_splatnosti){const n=new Date(e.fa_datum_splatnosti);if(n.setHours(0,0,0,0),n<a)return"overdue"}return"unpaid"})(e);"paid"===t?(n.paid.count++,n.paid.amount+=o):(n.unpaid.count++,n.unpaid.amount+=o,"overdue"===t&&(n.overdue.count++,n.overdue.amount+=o));const i=e.fa_typ;switch(i&&"string"===typeof i?i.toUpperCase():"BEZNA"){case"BEZNA":default:n.regular.count++,n.regular.amount+=o;break;case"ZALOHOVA":n.advance.count++,n.advance.amount+=o;break;case"OPRAVNA":n.corrective.count++,n.corrective.amount+=o;break;case"PROFORMA":n.proforma.count++,n.proforma.amount+=o;break;case"DOBROPIS":n.creditNote.count++,n.creditNote.amount+=o}e.objednavka_id||e.smlouva_id||(n.withoutAssignment.count++,n.withoutAssignment.amount+=o)}),n},calculateCashbookStats(e){const a=(null===e||void 0===e?void 0:e.pokladny)||[];if(0===a.length)return{count:0,balance:0,pokladny:[]};let n=0,o=0;const t=a.map(e=>{const a=parseInt(e.pocet_zaznamu||0,10),t=parseFloat(e.koncovy_stav||0),i=parseFloat(e.pocatecni_stav||0),s=parseFloat(e.celkove_prijmy||0),c=parseFloat(e.celkove_vydaje||0),l=parseInt(e.prijmy_pocet||0,10),r=parseInt(e.vydaje_pocet||0,10);n+=a,o+=t;const d=parseFloat(e.prevod_z_predchoziho||0);return{id:e.id,cislo_pokladny:e.cislo_pokladny,nazev:e.nazev,pocet_zaznamu:a,koncovy_stav:t,pocatecni_stav:i,prevod:d,aktivni:1===e.aktivni||"1"===e.aktivni,prijmy_castka:s,prijmy_pocet:l,vydaje_castka:c,vydaje_pocet:r}});return{count:n,balance:o,pokladny:t}}};var O=n(75949),I=n(33637),R=n(98951);function D(e){let{widget:a}=e;return(0,r.jsxs)("div",{className:"mobile-widget-card ".concat(a.color),children:[(0,r.jsxs)("div",{className:"mobile-widget-header",children:[null!==a.count&&void 0!==a.count&&(0,r.jsx)("div",{className:"mobile-widget-count",children:a.count}),(0,r.jsx)("div",{className:"mobile-widget-icon",children:(0,r.jsx)(c.g,{icon:a.icon})})]}),(0,r.jsxs)("div",{className:"mobile-widget-info",children:[(0,r.jsx)("div",{className:"mobile-widget-title",children:a.title}),null!==a.amount&&void 0!==a.amount&&(0,r.jsx)("div",{className:"mobile-widget-amount",children:(n=a.amount,new Intl.NumberFormat("cs-CZ",{style:"currency",currency:"CZK",minimumFractionDigits:0,maximumFractionDigits:0}).format(n))})]}),a.subtitle&&(0,r.jsx)("div",{className:"mobile-widget-subtitle",children:a.subtitle})]});var n}function T(e){let{cashbook:a,formatCurrency:n}=e;const o=a.cislo?"Pokladna ".concat(a.cislo):"Pokladna";return(0,r.jsxs)("div",{className:"mobile-cashbook-card",children:[a.nazev&&(0,r.jsxs)("div",{className:"mobile-cashbook-title",children:[o," - ",a.nazev]}),(0,r.jsxs)("div",{className:"mobile-cashbook-grid",children:[(0,r.jsxs)("div",{className:"mobile-cashbook-item",children:[(0,r.jsx)("div",{className:"mobile-cashbook-label",children:"P\u0159evod"}),(0,r.jsx)("div",{className:"mobile-cashbook-value",children:n(a.prevod)})]}),(0,r.jsxs)("div",{className:"mobile-cashbook-item highlight",children:[(0,r.jsx)("div",{className:"mobile-cashbook-label",children:"Z\u016fstatek"}),(0,r.jsx)("div",{className:"mobile-cashbook-value",children:n(a.zustatek)})]}),(0,r.jsxs)("div",{className:"mobile-cashbook-item",children:[(0,r.jsx)("div",{className:"mobile-cashbook-label",children:"P\u0159\xedjmy"}),(0,r.jsxs)("div",{className:"mobile-cashbook-count",children:[a.prijmy," ks"]}),(0,r.jsx)("div",{className:"mobile-cashbook-amount",children:n(a.prijmyCastka)})]}),(0,r.jsxs)("div",{className:"mobile-cashbook-item",children:[(0,r.jsx)("div",{className:"mobile-cashbook-label",children:"V\xfddaje"}),(0,r.jsxs)("div",{className:"mobile-cashbook-count",children:[a.vydaje," ks"]}),(0,r.jsx)("div",{className:"mobile-cashbook-amount",children:n(a.vydajeCastka)})]})]})]})}const L=function(){var e,a,n;const{user:m,userDetail:j,token:y,username:g}=(0,t.useContext)(i.cy),{mode:w}=(0,s.A)(),[E,C]=(0,t.useState)(!1),[S,L]=(0,t.useState)(!0),[V,M]=(0,t.useState)({orders:null,invoices:null,cashbook:null,notifications:null}),[H,P]=(0,t.useState)(!1),[Z,F]=(0,t.useState)((new Date).getFullYear()),[U,K]=(0,t.useState)([]),[B,J]=(0,t.useState)([]),[G,W]=(0,t.useState)(!1),[q,Y]=(0,t.useState)(!1),[Q,$]=(0,t.useState)("all"),[X,ee]=(0,t.useState)(""),[ae,ne]=(0,t.useState)(!1),[oe,te]=(0,t.useState)(!1),[ie,se]=(0,t.useState)(null),[ce,le]=(0,t.useState)({}),[re,de]=(0,t.useState)(!1),[ue,me]=(0,t.useState)(0),[ve,he]=(0,t.useState)({show:!1,type:"approved",message:""});(0,t.useEffect)(()=>{(async()=>{if(y&&g)if("function"===typeof I.IA)try{const e=await(0,I.IA)({token:y,username:g});le(e||{})}catch(e){console.error("[MobileDashboard] Chyba na\u010d\xedt\xe1n\xed \u010d\xedseln\xedku stav\u016f:",e)}else console.error("[MobileDashboard] getStavyWorkflow25 nen\xed dostupn\xe1 funkce!")})()},[y,g]);const pe=e=>{const a=ce[e];if(a)return a.nazev;return{SCHVALENA:"Schv\xe1len\xe1",ZAMITNUTA:"Zam\xedtnut\xe1",CEKA_SE:"\u010cek\xe1 se",ODESLANA_KE_SCHVALENI:"Ke schv\xe1len\xed",NOVA:"Nov\xe1"}[e]||e},be=()=>{const e=new Date,a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),t=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");return"".concat(a,"-").concat(n,"-").concat(o," ").concat(t,":").concat(i,":").concat(s)},je=m?(0,o.A)((0,o.A)({},m),{},{displayName:(null===j||void 0===j?void 0:j.jmeno_prijmeni_titul)||(null===j||void 0===j?void 0:j.jmeno_prijmeni)||m.username,mail:(null===j||void 0===j?void 0:j.email)||"",upn:m.username}):null,ye=(null===j||void 0===j||null===(e=j.roles)||void 0===e?void 0:e.some(e=>"SUPERADMIN"===e.kod_role||"ADMINISTRATOR"===e.kod_role))||!1,ge=ye||(null===j||void 0===j||null===(a=j.permissions)||void 0===a?void 0:a.some(e=>"ORDER_APPROVE"===e.kod_opravneni))||!1,ke=e=>{const a=document.querySelector('[data-section="'.concat(e,'"]'));if(a){const e=.5*parseFloat(getComputedStyle(document.documentElement).fontSize),n=a.offsetTop-108-e;window.scrollTo({top:n,behavior:"smooth"})}};(0,t.useEffect)(()=>{_e(),fe()},[Z]);const fe=()=>{const e=p();me(e.length)},_e=async()=>{try{L(!0),await xe()}catch(e){}finally{L(!1)}},Ne=async()=>{if(y&&g&&ge&&null!==j&&void 0!==j&&j.id)try{W(!0);const e=await(0,A.cn)({rok:Z},y,g,!1,!0);if(Array.isArray(e)){const a=e.filter(e=>{if(!e.id||e.id<=1)return!1;try{const a=Array.isArray(e.stav_workflow_kod)?e.stav_workflow_kod:JSON.parse(e.stav_workflow_kod||"[]");return Array.isArray(a)&&a.includes("ODESLANA_KE_SCHVALENI")}catch(a){return!1}}).filter(e=>e.prikazce_id===(null===j||void 0===j?void 0:j.id));J(a)}}catch(e){J([])}finally{W(!1)}},xe=async()=>{try{if(!y||!g)return void M({orders:null,invoices:null,cashbook:null,notifications:{unread:0}});const e=await z.getAllMobileData({token:y,username:g,year:Z,userId:ye?null:null===j||void 0===j?void 0:j.id,isAdmin:ye,showArchived:!1});e.success&&(M(e.data),ye&&await(async()=>{if(y&&g&&ye)try{const e=await(0,O.m1)({token:y,username:g});K(e||[])}catch(e){console.error("[MobileDashboard] Error loading active users:",e)}})(),ge&&await Ne())}catch(e){}},Ae=e=>new Intl.NumberFormat("cs-CZ",{style:"currency",currency:"CZK",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);if(S)return(0,r.jsx)(x.default,{message:H?"Obnovuji data...":"Na\u010d\xedt\xe1m dashboard..."});const we=(null===(n=V.notifications)||void 0===n?void 0:n.unread)||0,Ee=[];var Ce,Se,ze,Oe,Ie,Re,De,Te,Le,Ve,Me;V.orders&&(Ee.push({id:"orders-pending",title:"Ke schv\xe1len\xed",count:(null===(Ce=V.orders.pending)||void 0===Ce?void 0:Ce.count)||0,amount:(null===(Se=V.orders.pending)||void 0===Se?void 0:Se.amount)||0,icon:(0,R.cR)("ke_schvaleni"),color:"orange",category:"orders"}),(null===(ze=V.orders.approved)||void 0===ze?void 0:ze.count)>0&&Ee.push({id:"orders-approved",title:"Schv\xe1leno",count:V.orders.approved.count,amount:V.orders.approved.amount,icon:(0,R.cR)("schvalena"),color:"green",category:"orders"}),Ee.push({id:"orders-ma-byt-zverejnena",title:"M\xe1 b\xfdt zve\u0159ejn\u011bna",count:(null===(Oe=V.orders.maBytZverejnena)||void 0===Oe?void 0:Oe.count)||0,amount:(null===(Ie=V.orders.maBytZverejnena)||void 0===Ie?void 0:Ie.amount)||0,icon:(0,R.cR)("k_uverejneni_do_registru"),color:"teal",category:"orders"}),Ee.push({id:"orders-uverejnena",title:"Uve\u0159ejn\u011bn\xe1",count:(null===(Re=V.orders.uverejnena)||void 0===Re?void 0:Re.count)||0,amount:(null===(De=V.orders.uverejnena)||void 0===De?void 0:De.amount)||0,icon:(0,R.cR)("uverejnena"),color:"blue",category:"orders"}),(null===(Te=V.orders.vecnaSpravnost)||void 0===Te?void 0:Te.count)>0&&Ee.push({id:"orders-vecna-spravnost",title:"V\u011bcn\xe1 spr\xe1vnost",count:V.orders.vecnaSpravnost.count,amount:V.orders.vecnaSpravnost.amount,icon:(0,R.cR)("vecna_spravnost"),color:"purple",category:"orders"}),(null===(Le=V.orders.completed)||void 0===Le?void 0:Le.count)>0&&Ee.push({id:"orders-completed",title:"Dokon\u010deno",count:V.orders.completed.count,amount:V.orders.completed.amount,icon:(0,R.cR)("dokoncena"),color:"teal",category:"orders"}),(null===(Ve=V.orders.rejected)||void 0===Ve?void 0:Ve.count)>0&&Ee.push({id:"orders-rejected",title:"Zam\xedtnuto",count:V.orders.rejected.count,amount:V.orders.rejected.amount,icon:(0,R.cR)("zamitnuta"),color:"red",category:"orders"}),(null===(Me=V.orders.cancelled)||void 0===Me?void 0:Me.count)>0&&Ee.push({id:"orders-cancelled",title:"Zru\u0161eno",count:V.orders.cancelled.count,amount:V.orders.cancelled.amount,icon:(0,R.cR)("zrusena"),color:"gray",category:"orders"}));const He=[],Pe=[];var Ze,Fe,Ue,Ke,Be,Je,Ge,We,qe;V.invoices&&((null===(Ze=V.invoices.paid)||void 0===Ze?void 0:Ze.count)>0&&He.push({id:"invoices-paid",title:"Zaplaceno",count:V.invoices.paid.count,amount:V.invoices.paid.amount,icon:l.SGM,color:"green",category:"invoices-status"}),(null===(Fe=V.invoices.unpaid)||void 0===Fe?void 0:Fe.count)>0&&He.push({id:"invoices-unpaid",title:"Nezaplaceno",count:V.invoices.unpaid.count,amount:V.invoices.unpaid.amount,icon:l.TuH,color:"orange",category:"invoices-status"}),(null===(Ue=V.invoices.overdue)||void 0===Ue?void 0:Ue.count)>0&&He.push({id:"invoices-overdue",title:"Po splatnosti",count:V.invoices.overdue.count,amount:V.invoices.overdue.amount,icon:l.zpE,color:"red",category:"invoices-status"}),(null===(Ke=V.invoices.regular)||void 0===Ke?void 0:Ke.count)>0&&Pe.push({id:"invoices-regular",title:"B\u011b\u017en\xe1",count:V.invoices.regular.count,amount:V.invoices.regular.amount,icon:(0,R.cR)("schvalena"),color:"blue",category:"invoices"}),(null===(Be=V.invoices.advance)||void 0===Be?void 0:Be.count)>0&&Pe.push({id:"invoices-advance",title:"Z\xe1lohov\xe1",count:V.invoices.advance.count,amount:V.invoices.advance.amount,icon:(0,R.cR)("ke_schvaleni"),color:"purple",category:"invoices"}),(null===(Je=V.invoices.corrective)||void 0===Je?void 0:Je.count)>0&&Pe.push({id:"invoices-corrective",title:"Opravn\xe1",count:V.invoices.corrective.count,amount:V.invoices.corrective.amount,icon:(0,R.cR)("rozpracovana"),color:"teal",category:"invoices"}),(null===(Ge=V.invoices.proforma)||void 0===Ge?void 0:Ge.count)>0&&Pe.push({id:"invoices-proforma",title:"Proforma",count:V.invoices.proforma.count,amount:V.invoices.proforma.amount,icon:(0,R.cR)("potvrzena"),color:"blue",category:"invoices"}),(null===(We=V.invoices.creditNote)||void 0===We?void 0:We.count)>0&&Pe.push({id:"invoices-creditnote",title:"Dobropis",count:V.invoices.creditNote.count,amount:V.invoices.creditNote.amount,icon:(0,R.cR)("zrusena"),color:"gray",category:"invoices"}),(null===(qe=V.invoices.withoutAssignment)||void 0===qe?void 0:qe.count)>0&&Pe.push({id:"invoices-without-assignment",title:"Bez p\u0159i\u0159azen\xed",count:V.invoices.withoutAssignment.count,amount:V.invoices.withoutAssignment.amount,icon:l.s0Q,color:"gray",category:"invoices"}));const Ye=[];if(V.cashbook&&V.cashbook.pokladny&&V.cashbook.pokladny.length>0){V.cashbook.pokladny.forEach(e=>{e.aktivni&&Ye.push({id:e.id,cislo:e.cislo_pokladny,nazev:e.nazev||"",zaznamy:e.pocet_zaznamu||0,prevod:e.prevod||0,zustatek:e.koncovy_stav||0,prijmy:e.prijmy_pocet||0,prijmyCastka:e.prijmy_castka||0,vydaje:e.vydaje_pocet||0,vydajeCastka:e.vydaje_castka||0})})}return(0,r.jsxs)("div",{className:"mobile-dashboard",children:[(0,r.jsx)(d,{onMenuClick:()=>C(!0),notificationCount:we,onActivityClick:()=>de(!0),activityCount:ue}),q&&(0,r.jsxs)("div",{className:"mobile-subheader",children:[(0,r.jsxs)("button",{className:"mobile-subheader-back",onClick:()=>Y(!1),children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:(0,r.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})}),"Zp\u011bt"]}),(0,r.jsxs)("h2",{className:"mobile-subheader-title",children:["Ke schv\xe1len\xed (",(()=>{const e=B.length,a=B.filter(e=>!e.mimoradna_udalost).length,n=B.filter(e=>e.mimoradna_udalost).length;return"all"===Q?"".concat(e,"/").concat(a,"/").concat(n):"normal"===Q?a:n})(),")"]}),(0,r.jsxs)("div",{className:"mobile-subheader-filters",children:[(0,r.jsx)("button",{className:"mobile-filter-btn ".concat("all"===Q?"active":""),onClick:()=>$("all"),title:"V\u0161echny objedn\xe1vky",children:(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18",children:(0,r.jsx)("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"})})}),(0,r.jsx)("button",{className:"mobile-filter-btn ".concat("normal"===Q?"active":""),onClick:()=>$("normal"),title:"Norm\xe1ln\xed objedn\xe1vky",children:(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18",children:(0,r.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})})}),(0,r.jsx)("button",{className:"mobile-filter-btn ".concat("urgent"===Q?"active":""),onClick:()=>$("urgent"),title:"Mimo\u0159\xe1dn\xe9 objedn\xe1vky",children:(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18",children:(0,r.jsx)("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"})})})]})]}),(0,r.jsx)(u,{isOpen:E,onClose:()=>C(!1),user:je,userDetail:j,authUser:m,onNavigate:e=>{"dashboard"===e?(Y(!1),window.scrollTo({top:0,behavior:"smooth"}),xe(),fe()):"activity"===e&&de(!0)}}),q?(0,r.jsx)(r.Fragment,{children:G?(0,r.jsx)("div",{className:"mobile-dashboard-content",children:(0,r.jsxs)("div",{className:"mobile-refresh-indicator",children:[(0,r.jsx)("div",{className:"spinner-circle small"}),(0,r.jsx)("span",{children:"Na\u010d\xedt\xe1m objedn\xe1vky..."})]})}):B.length>0?(0,r.jsxs)("div",{className:"mobile-approval-list",children:[(0,r.jsx)("div",{className:"mobile-approval-search",children:(0,r.jsxs)("div",{className:"mobile-approval-search-wrapper",children:[(0,r.jsx)("input",{type:"text",placeholder:"Vyhledat objedn\xe1vku...",value:X,onChange:e=>ee(e.target.value)}),X&&(0,r.jsx)("button",{className:"mobile-approval-search-clear",onClick:()=>ee(""),title:"Vymazat vyhled\xe1v\xe1n\xed",children:(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:(0,r.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]})}),B.filter(e=>{if("urgent"===Q&&!e.mimoradna_udalost)return!1;if("normal"===Q&&e.mimoradna_udalost)return!1;if(X.trim()){var a,n;const o=X.toLowerCase(),t=(e.cislo_objednavky||e.ev_cislo||"").toLowerCase(),i=(e.predmet||"").toLowerCase(),s=((null===(a=e.objednatel)||void 0===a?void 0:a.cele_jmeno)||"").toLowerCase(),c=((null===(n=e.garant_uzivatel)||void 0===n?void 0:n.cele_jmeno)||"").toLowerCase();return t.includes(o)||i.includes(o)||s.includes(o)||c.includes(o)}return!0}).map(e=>(0,r.jsx)(_,{order:e,onApprove:async e=>{await(async e=>{if(y&&g&&e.id)try{const n=await(0,A.getOrderV2)(e.id,y,g,!0);if(!n)return void alert("Objedn\xe1vku se nepoda\u0159ilo na\u010d\xedst");let o=[];try{o=Array.isArray(n.stav_workflow_kod)?n.stav_workflow_kod:JSON.parse(n.stav_workflow_kod||"[]")}catch(a){o=[]}o=o.filter(e=>!["ODESLANA_KE_SCHVALENI","CEKA_SE","ZAMITNUTA"].includes(e)),o.includes("SCHVALENA")||o.push("SCHVALENA");const t={stav_workflow_kod:JSON.stringify(o),stav_objednavky:pe("SCHVALENA"),schvalovatel_id:(null===j||void 0===j?void 0:j.id)||null,dt_schvaleni:be(),schvaleni_komentar:""};await(0,A.qA)(e.id,t,y,g),b({entityType:h.ORDER,entityId:e.ev_cislo||e.cislo_objednavky||e.id,activityType:v.ORDER_APPROVED,title:e.nazev_obj||"Objedn\xe1vka ".concat(e.ev_cislo||e.cislo_objednavky||e.id),amount:e.castka_obj||null,userName:g,description:"\u2705 Objedn\xe1vka byla schv\xe1lena",metadata:{orderNumber:e.ev_cislo||e.cislo_objednavky,orderId:e.id}}),he({show:!0,type:"approved",message:"\u2705 Objedn\xe1vka schv\xe1lena!"}),Ne(),fe()}catch(n){alert("Chyba: ".concat(n.message||"Nepoda\u0159ilo se schv\xe1lit objedn\xe1vku"))}})(e),1===B.length&&Y(!1)},onReject:async e=>{await(e=>{se(e),ne(!0)})(e),1===B.length&&Y(!1)},onWait:async e=>{await(e=>{se(e),te(!0)})(e),1===B.length&&Y(!1)},loading:G},e.id))]}):(0,r.jsx)("div",{className:"mobile-dashboard-content",children:(0,r.jsx)("div",{className:"mobile-empty-state-inline",children:(0,r.jsx)("p",{children:"\u2705 \u017d\xe1dn\xe9 objedn\xe1vky ke schv\xe1len\xed"})})})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("nav",{className:"mobile-quick-nav",children:[ye&&U.length>0&&(0,r.jsx)("button",{className:"mobile-quick-nav-btn",onClick:()=>ke("users"),children:"UZI"}),(0,r.jsx)("button",{className:"mobile-quick-nav-btn",onClick:()=>ke("orders"),children:"OBJ"}),(0,r.jsx)("button",{className:"mobile-quick-nav-btn",onClick:()=>ke("invoices"),children:"FAK"}),(0,r.jsx)("button",{className:"mobile-quick-nav-btn",onClick:()=>ke("cashbook"),children:"POK"})]}),(0,r.jsxs)("main",{className:"mobile-dashboard-content",children:[H&&(0,r.jsxs)("div",{className:"mobile-refresh-indicator",children:[(0,r.jsx)("div",{className:"spinner-circle small"}),(0,r.jsx)("span",{children:"Obnovuji data..."})]}),ye&&U.length>0&&(0,r.jsxs)("section",{"data-section":"users",className:"mobile-widget-section",children:[(0,r.jsxs)("div",{className:"mobile-section-header",children:[(0,r.jsx)("h2",{children:"Aktivn\xed u\u017eivatel\xe9"}),(0,r.jsx)("div",{className:"mobile-section-summary",children:(0,r.jsxs)("span",{className:"mobile-summary-count",children:[U.length," online"]})})]}),(0,r.jsxs)("div",{className:"mobile-users-card",children:[(0,r.jsx)("div",{className:"mobile-users-list",children:U.slice(0,5).map((e,a)=>{const n=new Date,o=new Date(e.dt_posledni_aktivita),t=Math.floor((n-o)/1e3),i=Math.floor(t/60);let s="";if(t<60)s="".concat(t,"s");else if(i<60)s="".concat(i,"m");else{const e=Math.floor(i/60);s="".concat(e,"h")}const c=t<270?"#22c55e":t<300?"#f59e0b":"#ef4444",l=o.toLocaleString("cs-CZ",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),d=e.stats||{},u=[];if(d.objednavky>0&&u.push("OBJ: ".concat(d.objednavky)),d.faktury>0&&u.push("FA: ".concat(d.faktury)),null!==d.pokladna_zustatek){const e=new Intl.NumberFormat("cs-CZ",{style:"currency",currency:"CZK",minimumFractionDigits:0,maximumFractionDigits:0}).format(d.pokladna_zustatek);u.push("POKL: ".concat(e))}return(0,r.jsxs)("div",{className:"mobile-user-item",children:[(0,r.jsx)("div",{className:"mobile-user-status",style:{background:c}}),(0,r.jsxs)("div",{className:"mobile-user-info",children:[(0,r.jsxs)("div",{className:"mobile-user-row",children:[(0,r.jsx)("span",{className:"mobile-user-name",children:e.cele_jmeno||e.username}),(0,r.jsxs)("span",{className:"mobile-user-time",children:[l," (",s,")"]})]}),u.length>0&&(0,r.jsxs)("span",{className:"mobile-user-stats",children:["(",u.join(", "),")"]})]})]},a)})}),U.length>5&&(0,r.jsxs)("div",{className:"mobile-users-more",children:[(0,r.jsxs)("div",{className:"mobile-users-more-title",children:["+",U.length-5," dal\u0161\xedch aktivn\xedch"]}),(0,r.jsx)("div",{className:"mobile-users-more-list",children:U.slice(5).map((e,a)=>(0,r.jsx)("span",{className:"mobile-users-more-name",children:e.cele_jmeno||e.username},a))})]})]})]}),ge&&(G||B.length>0)&&(()=>{const e=B.filter(e=>!e.mimoradna_udalost).length,a=B.filter(e=>e.mimoradna_udalost).length,n=B.reduce((e,a)=>{const n=parseFloat(a.max_cena_s_dph||0);return e+(isNaN(n)?0:n)},0);return(0,r.jsxs)("section",{"data-section":"approvals",className:"mobile-widget-section",children:[(0,r.jsx)("div",{className:"mobile-section-header",children:(0,r.jsx)("h2",{children:"Objedn\xe1vky \u010dekaj\xed na m\xe9 schv\xe1len\xed"})}),(0,r.jsxs)("div",{className:"mobile-approval-widget",onClick:()=>!G&&B.length>0&&Y(!0),children:[(0,r.jsxs)("div",{className:"mobile-approval-widget-header",children:[(0,r.jsx)("div",{className:"mobile-approval-widget-count",children:G?"...":B.length}),(0,r.jsx)("div",{className:"mobile-approval-widget-breakdown",children:G?(0,r.jsx)("div",{className:"mobile-approval-loading",children:"Na\u010d\xedt\xe1m..."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mobile-approval-normal",children:[e," norm\xe1ln\xedch"]}),a>0&&(0,r.jsxs)("div",{className:"mobile-approval-urgent",children:[a," mimo\u0159\xe1dn\xfdch \u26a0\ufe0f"]})]})}),(0,r.jsx)("div",{className:"mobile-approval-widget-icon",children:(0,r.jsx)(c.g,{icon:(0,R.cR)("ke_schvaleni")})})]}),(0,r.jsxs)("div",{className:"mobile-approval-widget-info",children:[(0,r.jsxs)("div",{className:"mobile-approval-widget-title-row",children:[(0,r.jsx)("div",{className:"mobile-approval-widget-title",children:"Ke schv\xe1len\xed"}),(0,r.jsx)("div",{className:"mobile-approval-widget-action",children:"Klikn\u011bte pro schv\xe1len\xed"})]}),(0,r.jsxs)("div",{className:"mobile-approval-widget-title-row",children:[(0,r.jsx)("div",{className:"mobile-approval-widget-subtitle",children:"Max. celkem s DPH"}),(0,r.jsx)("div",{className:"mobile-approval-widget-price",children:Ae(n)})]})]})]})]})})(),Ee.length>0&&(0,r.jsxs)("section",{"data-section":"orders",className:"mobile-widget-section",children:[(0,r.jsxs)("div",{className:"mobile-section-header",children:[(0,r.jsx)("h2",{children:"Objedn\xe1vky"}),(0,r.jsx)("div",{className:"mobile-section-summary",children:V.orders.total>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"mobile-summary-count",children:[V.orders.total," ks"]}),V.orders.totalAmount>0&&(0,r.jsx)("span",{className:"mobile-summary-amount",children:Ae(V.orders.totalAmount)})]})})]}),(0,r.jsx)("div",{className:"mobile-widget-grid",children:Ee.map(e=>(0,r.jsx)(D,{widget:e},e.id))})]}),He.length>0&&(0,r.jsxs)("section",{"data-section":"invoices",className:"mobile-widget-section",children:[(0,r.jsxs)("div",{className:"mobile-section-header",children:[(0,r.jsx)("h2",{children:"Faktury - stavy"}),(0,r.jsx)("div",{className:"mobile-section-summary",children:V.invoices.total>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"mobile-summary-count",children:[V.invoices.total," ks"]}),V.invoices.totalAmount>0&&(0,r.jsx)("span",{className:"mobile-summary-amount",children:Ae(V.invoices.totalAmount)})]})})]}),(0,r.jsx)("div",{className:"mobile-widget-grid",children:He.map(e=>(0,r.jsx)(D,{widget:e},e.id))})]}),Pe.length>0&&(0,r.jsxs)("section",{className:"mobile-widget-section",children:[(0,r.jsx)("div",{className:"mobile-section-header",children:(0,r.jsx)("h2",{children:"Faktury - typy"})}),(0,r.jsx)("div",{className:"mobile-widget-grid",children:Pe.map(e=>(0,r.jsx)(D,{widget:e},e.id))})]}),Ye.length>0&&(0,r.jsxs)("section",{"data-section":"cashbook",className:"mobile-widget-section",children:[(0,r.jsxs)("div",{className:"mobile-section-header",children:[(0,r.jsx)("h2",{children:"Pokladna"}),(0,r.jsx)("div",{className:"mobile-section-summary",children:(0,r.jsx)("span",{className:"mobile-summary-count",children:"Aktu\xe1ln\xed m\u011bs\xedc"})})]}),Ye.map(e=>(0,r.jsx)(T,{cashbook:e,formatCurrency:Ae},e.id))]}),0===Ee.length&&0===He.length&&0===Pe.length&&0===Ye.length&&(0,r.jsxs)("div",{className:"mobile-empty-state",children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"})}),(0,r.jsx)("p",{children:"\u017d\xe1dn\xe1 data k zobrazen\xed"})]})]}),(0,r.jsx)("footer",{className:"mobile-footer",children:(0,r.jsxs)("button",{className:"mobile-footer-refresh-btn",onClick:async()=>{P(!0),await xe(),P(!1)},disabled:H,children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:H?"spinning":"",children:(0,r.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})}),(0,r.jsx)("span",{children:H?"Obnovuji...":"Obnovit data"})]})})]}),(0,r.jsx)(N,{isOpen:ae,onClose:()=>ne(!1),onConfirm:async e=>{if(y&&g&&null!==ie&&void 0!==ie&&ie.id)try{const n=await(0,A.getOrderV2)(ie.id,y,g,!0);if(!n)return alert("Objedn\xe1vku se nepoda\u0159ilo na\u010d\xedst"),void ne(!1);let o=[];try{o=Array.isArray(n.stav_workflow_kod)?n.stav_workflow_kod:JSON.parse(n.stav_workflow_kod||"[]")}catch(a){o=[]}o=o.filter(e=>!["ODESLANA_KE_SCHVALENI","CEKA_SE","SCHVALENA"].includes(e)),o.includes("ZAMITNUTA")||o.push("ZAMITNUTA");const t={stav_workflow_kod:JSON.stringify(o),stav_objednavky:pe("ZAMITNUTA"),schvalovatel_id:(null===j||void 0===j?void 0:j.id)||null,dt_schvaleni:be(),schvaleni_komentar:e};await(0,A.qA)(ie.id,t,y,g),b({entityType:h.ORDER,entityId:ie.ev_cislo||ie.cislo_objednavky||ie.id,activityType:v.ORDER_REJECTED,title:ie.nazev_obj||"Objedn\xe1vka ".concat(ie.ev_cislo||ie.cislo_objednavky||ie.id),amount:ie.castka_obj||null,userName:g,description:"\u274c Objedn\xe1vka byla zam\xedtnuta".concat(e?": ".concat(e):""),metadata:{orderNumber:ie.ev_cislo||ie.cislo_objednavky,orderId:ie.id}}),he({show:!0,type:"rejected",message:"\u274c Objedn\xe1vka zam\xedtnuta"}),ne(!1),se(null),Ne(),fe()}catch(n){alert("Chyba: ".concat(n.message||"Nepoda\u0159ilo se zam\xedtnout objedn\xe1vku")),ne(!1)}else ne(!1)},title:"Zam\xedtnout objedn\xe1vku",message:"Opravdu chcete zam\xedtnout objedn\xe1vku ".concat((null===ie||void 0===ie?void 0:ie.cislo_objednavky)||(null===ie||void 0===ie?void 0:ie.ev_cislo)||"","?"),confirmText:"Zam\xedtnout",cancelText:"Zru\u0161it",requireReason:!0,reasonPlaceholder:"Zadejte d\u016fvod zam\xedtnut\xed (povinn\xe9)...",variant:"danger"}),(0,r.jsx)(N,{isOpen:oe,onClose:()=>te(!1),onConfirm:async e=>{if(y&&g&&null!==ie&&void 0!==ie&&ie.id)try{const n=await(0,A.getOrderV2)(ie.id,y,g,!0);if(!n)return alert("Objedn\xe1vku se nepoda\u0159ilo na\u010d\xedst"),void te(!1);let o=[];try{o=Array.isArray(n.stav_workflow_kod)?n.stav_workflow_kod:JSON.parse(n.stav_workflow_kod||"[]")}catch(a){o=[]}o=o.filter(e=>!["ODESLANA_KE_SCHVALENI","SCHVALENA","ZAMITNUTA"].includes(e)),o.includes("CEKA_SE")||o.push("CEKA_SE");JSON.stringify(o),pe("CEKA_SE"),null===j||void 0===j||j.id,be();b({entityType:h.ORDER,entityId:ie.ev_cislo||ie.cislo_objednavky||ie.id,activityType:v.ORDER_WAITING,title:ie.nazev_obj||"Objedn\xe1vka ".concat(ie.ev_cislo||ie.cislo_objednavky||ie.id),amount:ie.castka_obj||null,userName:g,description:'\u23f3 Objedn\xe1vka ozna\u010dena jako "\u010cek\xe1 se"'.concat(e?": ".concat(e):""),metadata:{orderNumber:ie.ev_cislo||ie.cislo_objednavky,orderId:ie.id}}),he({show:!0,type:"waiting",message:"\u23f3 Objedn\xe1vka pozastavena"}),te(!1),se(null),Ne(),fe()}catch(n){alert("Chyba: ".concat(n.message||"Nepoda\u0159ilo se pozastavit objedn\xe1vku")),te(!1)}else te(!1)},title:"Pozastavit objedn\xe1vku",message:"Objedn\xe1vka ".concat((null===ie||void 0===ie?void 0:ie.cislo_objednavky)||(null===ie||void 0===ie?void 0:ie.ev_cislo)||"",' bude ozna\u010dena jako "\u010cek\xe1 se".'),confirmText:"Pozastavit",cancelText:"Zru\u0161it",requireReason:!0,reasonPlaceholder:"Zadejte d\u016fvod pozastaven\xed (povinn\xe9)...",variant:"warning"}),(0,r.jsx)(k,{isOpen:re,onClose:()=>{de(!1),fe()}}),(0,r.jsx)(f,{show:ve.show,type:ve.type,message:ve.message,onComplete:()=>he({show:!1,type:"approved",message:""})})]})}},29742:(e,a,n)=>{function o(e){if(e.isDraft||e.je_koncept)return"NOVA";let a;if(e.stav_objednavky)a=function(e){if(e&&"string"===typeof e){if(e.startsWith("Zam\xedtnut"))return"ZAMITNUTA";if(e.startsWith("Schv\xe1len"))return"SCHVALENA";if(e.startsWith("Dokon\u010den"))return"DOKONCENA";if(e.startsWith("Zru\u0161en"))return"ZRUSENA";if(e.startsWith("Archivov\xe1n"))return"ARCHIVOVANO"}return{"Ke schv\xe1len\xed":"KE_SCHVALENI","Nov\xe1":"NOVA","Rozpracovan\xe1":"ROZPRACOVANA","Odeslan\xe1 dodavateli":"ODESLANA","Potvrzen\xe1 dodavatelem":"POTVRZENA","M\xe1 b\xfdt zve\u0159ejn\u011bna":"K_UVEREJNENI_DO_REGISTRU","Uve\u0159ejn\u011bn\xe1":"UVEREJNENA","\u010cek\xe1 na potvrzen\xed":"CEKA_POTVRZENI","\u010cek\xe1 se":"CEKA_SE","V\u011bcn\xe1 spr\xe1vnost":"VECNA_SPRAVNOST","Smazan\xe1":"SMAZANA",Koncept:"NOVA"}[e]||e}(e.stav_objednavky);else if(e.stav_workflow_kod)try{const n=Array.isArray(e.stav_workflow_kod)?e.stav_workflow_kod:JSON.parse(e.stav_workflow_kod);a=Array.isArray(n)?n[n.length-1]:e.stav_workflow_kod}catch(n){a=e.stav_workflow_kod}else a="DRAFT";if(e.registr_smluv||e.stav_workflow_kod){const a=e.registr_smluv||{};if(a.dt_zverejneni&&a.registr_iddt)return"UVEREJNENA";let n=null;if(e.stav_workflow_kod)try{let a=[];if(Array.isArray(e.stav_workflow_kod)?a=e.stav_workflow_kod:"string"===typeof e.stav_workflow_kod&&(a=JSON.parse(e.stav_workflow_kod),Array.isArray(a)||(a=[])),a.length>0){const e=a[a.length-1];n="object"===typeof e?e.kod_stavu:e}}catch(o){}if(("UVEREJNIT"===n||"ANO"===a.zverejnit||!0===a.ma_byt_zverejnena||1===a.ma_byt_zverejnena||"1"===a.ma_byt_zverejnena)&&!a.registr_iddt)return"K_UVEREJNENI_DO_REGISTRU"}return a}function t(e){if(null!=e.faktury_celkova_castka_s_dph&&""!==e.faktury_celkova_castka_s_dph){const a=parseFloat(e.faktury_celkova_castka_s_dph);if(!isNaN(a)&&a>0)return a}if(null!=e.polozky_celkova_cena_s_dph&&""!==e.polozky_celkova_cena_s_dph){const a=parseFloat(e.polozky_celkova_cena_s_dph);if(!isNaN(a)&&a>0)return a}if(e.polozky&&Array.isArray(e.polozky)&&e.polozky.length>0){const a=e.polozky.reduce((e,a)=>{const n=parseFloat(a.cena_s_dph||0);return e+(isNaN(n)?0:n)},0);if(a>0)return a}if(null!=e.max_cena_s_dph&&""!==e.max_cena_s_dph){const a=parseFloat(e.max_cena_s_dph);if(!isNaN(a)&&a>0)return a}return 0}function i(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{showArchived:n=!1,userId:t=null,isAdmin:i=!1}=a;let s=e.filter(e=>!(!e.isDraft&&!e.je_koncept)||e.id&&e.id>1&&!e.isLocalConcept);return n||(s=s.filter(e=>{if(e.isDraft||e.je_koncept)return!0;return"ARCHIVOVANO"!==o(e)})),!i&&t&&(s=s.filter(e=>e.isDraft||e.je_koncept?e.objednatel_id===t||e.uzivatel_id===t:e.prikazce_id===t)),s}function s(e){const a=e.length,n=e.reduce((e,a)=>{const n=o(a);return e[n]=(e[n]||0)+1,e},{}),i=e.reduce((e,a)=>{const n=t(a);return e+(isNaN(n)?0:n)},0),s=e.reduce((e,a)=>{const n=o(a);if(["DOKONCENA","VYRIZENA","COMPLETED"].includes(n)){const n=t(a);return e+(isNaN(n)?0:n)}return e},0);return{total:a,byStatus:n,totalAmount:i,completedAmount:s,pendingAmount:i-s}}n.d(a,{Kt:()=>t,qF:()=>i,sL:()=>s,we:()=>o})},34795:(e,a,n)=>{n.d(a,{Ay:()=>r,fb:()=>t,getHierarchyConfig:()=>s});var o=n(58319);const t={ORDERS:"orders",INVOICES:"invoices",CASHBOOK:"cashbook"},i={DISABLED:"disabled",IMMUNE:"immune",ACTIVE:"active",NO_PROFILE:"no_profile",ERROR:"error"},s=async(e,a)=>{try{const s=await(0,o.getGlobalSettings)(e,a),l=Boolean(s.hierarchy_enabled),r=s.hierarchy_profile_id||null,d=s.hierarchy_logic||"OR";let u=null;if(r)try{const{getHierarchyProfiles:o}=await n.e(6102).then(n.bind(n,96102)),t=(await o(e,a)).find(e=>e.id===parseInt(r,10));u=t?t.name:null}catch(t){console.warn("\u26a0\ufe0f [HierarchyService] Nelze na\u010d\xedst n\xe1zev profilu:",t)}let m=i.DISABLED;return l&&(m=r?i.ACTIVE:i.NO_PROFILE),{status:m,enabled:l,profileId:r,profileName:u,logic:d,logicDescription:c(d),modules:{orders:l&&null!==r,invoices:!1,cashbook:!1}}}catch(t){return console.error("\u274c [HierarchyService] Chyba p\u0159i na\u010d\xedt\xe1n\xed nastaven\xed:",t),{status:i.ERROR,enabled:!1,profileId:null,profileName:null,logic:"OR",logicDescription:c("OR"),error:t.message,modules:{orders:!1,invoices:!1,cashbook:!1}}}},c=e=>"AND"===e?"Restriktivn\xed (A Z\xc1ROVE\u0147) - mus\xed spl\u0148ovat v\u0161echny \xfarovn\u011b sou\u010dasn\u011b":"Liber\xe1ln\xed (NEBO) - sta\u010d\xed splnit alespo\u0148 jednu \xfarove\u0148",l=(()=>{let e=null,a=0;return async function(n,o){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=Date.now();return!t&&e&&i-a<6e4||(e=await s(n,o),a=i),e}})(),r={HierarchyModules:t,HierarchyStatus:i,getHierarchyConfig:s,getHierarchyConfigCached:l,isHierarchyActiveForModule:async(e,a,n)=>{try{const o=await s(a,n);switch(e){case t.ORDERS:return o.modules.orders;case t.INVOICES:return o.modules.invoices;case t.CASHBOOK:return o.modules.cashbook;default:return console.warn("\u26a0\ufe0f [HierarchyService] Nezn\xe1m\xfd modul: ".concat(e)),!1}}catch(o){return console.error("\u274c [HierarchyService] Chyba p\u0159i kontrole modulu:",o),!1}},getLogicDescription:c,getHierarchyInfoMessage:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.ORDERS;if(!e)return null;switch(e.status){case i.DISABLED:return null;case i.NO_PROFILE:return"\u26a0\ufe0f Hierarchie je zapnut\xe1, ale nen\xed vybr\xe1n \u017e\xe1dn\xfd profil. Kontaktujte administr\xe1tora.";case i.IMMUNE:return"\ud83d\udee1\ufe0f M\xe1te neomezen\xfd p\u0159\xedstup k dat\u016fm (HIERARCHY_IMMUNE).";case i.ACTIVE:const n={[t.ORDERS]:"objedn\xe1vky",[t.INVOICES]:"faktury",[t.CASHBOOK]:"pokladnu"}[a]||"data";return"\ud83c\udfe2 Hierarchie aktivn\xed: Vid\xedte ".concat(n,' podle organiza\u010dn\xedho \u0159\xe1du "').concat(e.profileName,'" (').concat(e.logicDescription,").");case i.ERROR:return"\u274c Chyba p\u0159i na\u010d\xedt\xe1n\xed hierarchie. Kontaktujte administr\xe1tora.";default:return null}},getHierarchyBannerColor:e=>{if(!e)return"info";switch(e.status){case i.DISABLED:return"info";case i.NO_PROFILE:return"warning";case i.IMMUNE:return"success";case i.ACTIVE:return"info";case i.ERROR:return"error";default:return"info"}},clearHierarchyCache:()=>{}}},49690:(e,a,n)=>{n.r(a),n.d(a,{default:()=>R});var o,t,i,s,c,l,r,d,u,m,v,h,p,b=n(57528),j=(n(65043),n(83290)),y=n(45903),g=n(70579);const k=(0,j.i7)(o||(o=(0,b.A)(["\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n"]))),f=(0,j.i7)(t||(t=(0,b.A)(["\n  from { opacity: 0; }\n  to { opacity: 1; }\n"]))),_=(0,j.i7)(i||(i=(0,b.A)(["\n  from { opacity: 1; }\n  to { opacity: 0; }\n"]))),N=(0,j.i7)(s||(s=(0,b.A)(["\n  0%, 100% { opacity: 1; }\n  50% { opacity: 0.6; }\n"]))),x=y.A.div(c||(c=(0,b.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(135deg, #1f2a57 0%, #2c3e7a 100%);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n  animation: "," 0.2s ease-in;\n  \n  &.hidden {\n    animation: "," 0.3s ease-out forwards;\n  }\n"])),f,_),A=y.A.div(l||(l=(0,b.A)(["\n  margin-bottom: 2rem;\n  animation: "," 0.5s ease-in;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 1rem;\n"])),f),w=y.A.img(r||(r=(0,b.A)(["\n  width: 225px;\n  height: 225px;\n  object-fit: contain;\n  filter: drop-shadow(0 4px 20px rgba(0, 0, 0, 0.3));\n  animation: "," 0.6s ease-in;\n"])),f),E=y.A.div(d||(d=(0,b.A)(["\n  font-size: 2.5rem;\n  font-weight: 700;\n  color: #ffffff;\n  text-align: center;\n  letter-spacing: 3px;\n  text-shadow: 0 4px 20px rgba(37, 99, 235, 0.5);\n  background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n"]))),C=y.A.div(u||(u=(0,b.A)(["\n  font-size: 1rem;\n  color: rgba(255, 255, 255, 0.8);\n  text-align: center;\n  margin-top: 0.5rem;\n  letter-spacing: 1px;\n"]))),S=y.A.div(m||(m=(0,b.A)(["\n  margin: 2rem 0;\n"]))),z=y.A.div(v||(v=(0,b.A)(["\n  width: 50px;\n  height: 50px;\n  border: 4px solid rgba(255, 255, 255, 0.1);\n  border-top: 4px solid #ffffff;\n  border-radius: 50%;\n  animation: "," 1s linear infinite;\n"])),k),O=y.A.div(h||(h=(0,b.A)(["\n  color: rgba(255, 255, 255, 0.9);\n  font-size: 0.95rem;\n  margin-top: 1.5rem;\n  animation: "," 1.5s ease-in-out infinite;\n  letter-spacing: 0.5px;\n"])),N),I=y.A.div(p||(p=(0,b.A)(["\n  position: absolute;\n  bottom: 2rem;\n  color: rgba(255, 255, 255, 0.4);\n  font-size: 0.85rem;\n"]))),R=e=>{let{message:a="Spou\u0161t\u011bn\xed aplikace..."}=e;return(0,g.jsxs)(x,{children:[(0,g.jsxs)(A,{children:[(0,g.jsx)(w,{src:"".concat("/eeo-v2","/logo512.png"),alt:"ZZS Logo"}),(0,g.jsx)(E,{children:"ERDMS"}),(0,g.jsx)(C,{children:"Syst\xe9m spr\xe1vy a workflow objedn\xe1vek"})]}),(0,g.jsx)(S,{children:(0,g.jsx)(z,{})}),(0,g.jsx)(O,{children:a}),(0,g.jsxs)(I,{children:["verze ","1.92"]})]})}},58319:(e,a,n)=>{n.d(a,{checkMaintenanceMode:()=>c,getGlobalSettings:()=>t,l:()=>s,saveGlobalSettings:()=>i});const o="https://erdms.zachranka.cz/api.eeo/".replace(/\/$/,""),t=async(e,a)=>{try{const n=await fetch("".concat(o,"/global-settings"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,username:a,operation:"get"})});if(!n.ok)throw new Error("HTTP ".concat(n.status,": ").concat(n.statusText));const t=await n.json();return t.data||t}catch(n){throw console.error("Chyba p\u0159i na\u010d\xedt\xe1n\xed glob\xe1ln\xedho nastaven\xed:",n),n}},i=async(e,a,n)=>{try{const t={token:a,username:n,operation:"save",settings:e};console.group("\ud83d\udcbe SAVE GLOBAL SETTINGS"),console.log("Settings to save:",e),console.log("Full payload:",t),console.groupEnd();const i=await fetch("".concat(o,"/global-settings"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok)throw new Error("HTTP ".concat(i.status,": ").concat(i.statusText));return await i.json()}catch(t){throw console.error("Chyba p\u0159i ukl\xe1d\xe1n\xed glob\xe1ln\xedho nastaven\xed:",t),t}},s=async(e,a)=>{try{const n=await fetch("".concat(o,"/maintenance-message"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,username:a})});if(!n.ok)throw new Error("HTTP ".concat(n.status,": ").concat(n.statusText));return(await n.json()).message||"Syst\xe9m je moment\xe1ln\u011b v \xfadr\u017eb\u011b. Omlouv\xe1me se za komplikace."}catch(n){throw console.error("Chyba p\u0159i na\u010d\xedt\xe1n\xed \xfadr\u017ebov\xe9 zpr\xe1vy:",n),n}},c=async()=>{try{const e=await fetch("".concat(o,"/maintenance-status"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)return 404===e.status?console.warn("Maintenance check endpoint not found (404)"):console.warn("Maintenance check failed with status:",e.status),!1;const a=e.headers.get("content-type");if(!a||!a.includes("application/json"))return console.warn("Maintenance check: Response is not JSON, got:",a),!1;const n=await e.json();return!0===n.maintenance_mode||1===n.maintenance_mode}catch(e){return console.debug("Chyba p\u0159i kontrole maintenance mode:",e.message),!1}}},96427:(e,a,n)=>{n.d(a,{A:()=>t});var o=n(65043);const t=()=>{const[e,a]=(0,o.useState)(()=>{if("undefined"!==typeof window)try{const e=localStorage.getItem("app_theme_preference");if(e)return e}catch(e){}return"auto"}),[n,t]=(0,o.useState)("light");(0,o.useEffect)(()=>{const a=window.matchMedia("(prefers-color-scheme: dark)"),n=()=>{t("auto"===e?a.matches?"dark":"light":e)};return n(),a.addEventListener("change",n),()=>a.removeEventListener("change",n)},[e]),(0,o.useEffect)(()=>{document.documentElement.setAttribute("data-theme",n)},[n]),(0,o.useEffect)(()=>{try{localStorage.setItem("app_theme_preference",e)}catch(a){}},[e]);const i=(0,o.useCallback)(e=>{a(e)},[]),s=(0,o.useCallback)(()=>{t(e=>"light"===e?"dark":"light")},[]);return{mode:n,preference:e,setThemePreference:i,toggle:s}}},98951:(e,a,n)=>{n.d(a,{cR:()=>t,zJ:()=>i});var o=n(97929);const t=e=>{switch(null===e||void 0===e?void 0:e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")){case"nova":return o.ijD;case"ke_schvaleni":case"keSchvaleni":return o.TuH;case"schvalena":case"kontrola_potvrzena":case"vecnaSpravnost":case"vecna_spravnost":return o.SGM;case"zamitnuta":case"zrusena":return o.s0Q;case"rozpracovana":case"kontrola_ceka":case"cekaKontrola":return o.a$;case"odeslana":return o.raf;case"potvrzena":return o.V2x;case"uverejnena":case"registr_zverejnena":case"registrzverejnena":return o.IJd;case"dokoncena":return o.pvD;case"ceka_potvrzeni":case"cekaPotvrzeni":case"ceka_se":case"cekaSe":return o.G1Y;case"archivovano":case"archivovana":return o.Oh6;default:return o.iW_}},i=e=>{switch(null===e||void 0===e?void 0:e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")){case"nova":case"koncept":return"\ud83d\udcdd";case"ke_schvaleni":case"keschvaleni":return"\ud83d\udccb";case"schvalena":return"\ud83d\udc4d";case"zamitnuta":return"\u274c";case"rozpracovana":return"\ud83d\udd50";case"odeslana":return"\ud83d\udce4";case"potvrzena":return"\u2714\ufe0f";case"uverejnena":case"registr_zverejnena":case"registrzverejnena":return"\ud83d\udce2";case"dokoncena":return"\ud83c\udfaf";case"ceka_potvrzeni":case"cekapotvrzeni":case"ceka_se":case"cekase":return"\u23f8\ufe0f";case"zrusena":return"\ud83d\udeab";case"smazana":return"\ud83d\uddd1\ufe0f";case"archivovano":case"archivovana":return"\ud83d\udce6";case"ceka_kontrola":case"cekakontrola":return"\ud83d\udd0d";case"vecna_spravnost":case"vecnaspravnost":return"\u2705";default:return"\ud83d\udcca"}}}}]);
//# sourceMappingURL=7967.926d0555.chunk.js.map