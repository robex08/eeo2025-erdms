{"version":3,"file":"static/js/6872.b31b1b30.chunk.js","mappings":"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","sources":["components/FinancialControlModal.js"],"sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\nimport { createPortal } from 'react-dom';\nimport styled from '@emotion/styled';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTimes, faFileDownload, faPrint, faSpinner } from '@fortawesome/free-solid-svg-icons';\nimport { pdf } from '@react-pdf/renderer';\nimport FinancialControlPDF from './FinancialControlPDF';\nimport { AuthContext } from '../context/AuthContext';\nimport { getOrganizaceDetail } from '../services/apiv2Dictionaries';\nimport { getStrediska25 } from '../services/api25orders';\n\n// Styled components\nconst ModalOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.85);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n  padding: 0;\n`;\n\nconst ModalContainer = styled.div`\n  background: white;\n  border-radius: 0;\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n`;\n\nconst ModalHeader = styled.div`\n  padding: 20px 24px;\n  border-bottom: 2px solid #e5e7eb;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  background: linear-gradient(135deg, #059669 0%, #047857 100%);\n  color: white;\n  border-radius: 12px 12px 0 0;\n`;\n\nconst ModalTitle = styled.h2`\n  margin: 0;\n  font-size: 1.5rem;\n  font-weight: 700;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n`;\n\nconst ModalActions = styled.div`\n  display: flex;\n  gap: 12px;\n  align-items: center;\n`;\n\nconst ActionButton = styled.button`\n  padding: 10px 20px;\n  border: none;\n  border-radius: 8px;\n  font-size: 0.95rem;\n  font-weight: 600;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  transition: all 0.2s;\n  background: ${props => props.variant === 'primary' ? '#ffffff' : 'rgba(255, 255, 255, 0.2)'};\n  color: ${props => props.variant === 'primary' ? '#059669' : '#ffffff'};\n\n  &:hover {\n    background: ${props => props.variant === 'primary' ? '#f0fdf4' : 'rgba(255, 255, 255, 0.3)'};\n    transform: translateY(-2px);\n  }\n\n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    transform: none;\n  }\n`;\n\nconst CloseButton = styled.button`\n  background: rgba(255, 255, 255, 0.2);\n  border: none;\n  border-radius: 50%;\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s;\n  color: white;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.3);\n    transform: rotate(90deg);\n  }\n`;\n\nconst ModalBody = styled.div`\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  background: #f9fafb;\n`;\n\nconst IframeContainer = styled.div`\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  position: relative;\n`;\n\nconst PDFIframe = styled.iframe`\n  width: 100%;\n  height: 100%;\n  border: none;\n`;\n\nconst LoadingContainer = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  background: rgba(249, 250, 251, 0.95);\n  z-index: 10;\n`;\n\nconst LoadingText = styled.p`\n  margin-top: 16px;\n  font-size: 1.1rem;\n  color: #6b7280;\n  font-weight: 500;\n`;\n\nconst SpinnerIcon = styled(FontAwesomeIcon)`\n  font-size: 3rem;\n  color: #059669;\n  animation: spin 1s linear infinite;\n\n  @keyframes spin {\n    from {\n      transform: rotate(0deg);\n    }\n    to {\n      transform: rotate(360deg);\n    }\n  }\n`;\n\n/**\n * Modal pro n√°hled a generov√°n√≠ PDF finanƒçn√≠ kontroly\n * \n * @param {Object} order - Objedn√°vka s kompletn√≠mi daty\n * @param {Function} onClose - Callback pro zav≈ôen√≠ modalu\n * @param {Object} generatedBy - Informace o gener√°torovi {fullName, position}\n */\nconst FinancialControlModal = ({ order, onClose, generatedBy }) => {\n  const { token, username } = useContext(AuthContext);\n  const [pdfUrl, setPdfUrl] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [organizace, setOrganizace] = useState(null);\n  const [strediskaMap, setStrediskaMap] = useState({});\n\n  // Generov√°n√≠ PDF p≈ôi otev≈ôen√≠\n  useEffect(() => {\n    const generatePDF = async () => {\n      try {\n        setIsLoading(true);\n        \n        // üìã Naƒçten√≠ vizitky organizace (ID=1 - hlavn√≠ organizace)\n        let orgData = null;\n        try {\n          orgData = await getOrganizaceDetail({ token, username, id: 1 });\n          setOrganizace(orgData);\n        } catch (error) {\n          console.error('Nepoda≈ôilo se naƒç√≠st vizitku organizace:', error);\n        }\n\n        // üèõÔ∏è Naƒçten√≠ st≈ôedisek pro mapov√°n√≠ k√≥d ‚Üí n√°zev\n        let strediskaData = {};\n        try {\n          const strediskaList = await getStrediska25({ token, username, aktivni: null }); // null = v≈°echna st≈ôediska\n          \n          // Vytvo≈ô√≠me mapu: kod_stavu -> nazev_stavu\n          // API vrac√≠ hierarchickou strukturu s 'value' (=kod_stavu) a 'label' (=nazev_stavu)\n          strediskaData = strediskaList.reduce((acc, stredisko) => {\n            // Pou≈æij value a label z hierarchick√© struktury\n            if (stredisko.value) {\n              acc[stredisko.value] = stredisko.label || stredisko.value;\n            }\n            // Fallback: pokud existuje raw objekt, pou≈æij i ten\n            if (stredisko.raw?.kod_stavu) {\n              acc[stredisko.raw.kod_stavu] = stredisko.raw.nazev_stavu || stredisko.raw.kod_stavu;\n            }\n            return acc;\n          }, {});\n          setStrediskaMap(strediskaData);\n        } catch (error) {\n          console.error('Nepoda≈ôilo se naƒç√≠st st≈ôediska:', error);\n        }\n        \n        // Vytvo≈ôen√≠ PDF dokumentu\n        const blob = await pdf(\n          <FinancialControlPDF\n            order={order}\n            generatedBy={generatedBy}\n            organizace={orgData}\n            strediskaMap={strediskaData}\n          />\n        ).toBlob();\n\n        // Vytvo≈ôen√≠ URL pro iframe\n        const url = URL.createObjectURL(blob);\n        setPdfUrl(url);\n      } catch (error) {\n        console.error('Chyba p≈ôi generov√°n√≠ PDF n√°hledu:', error);\n        alert('Chyba p≈ôi generov√°n√≠ PDF n√°hledu');\n        onClose();\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    generatePDF();\n\n    // Cleanup - uvolnƒõn√≠ URL p≈ôi unmount\n    return () => {\n      if (pdfUrl) {\n        URL.revokeObjectURL(pdfUrl);\n      }\n    };\n  }, [order, generatedBy]);\n\n  // Sta≈æen√≠ PDF\n  const handleDownload = async () => {\n    try {\n      const blob = await pdf(\n        <FinancialControlPDF\n          order={order}\n          generatedBy={generatedBy}\n        />\n      ).toBlob();\n\n      const url = URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `financni-kontrola-${order?.cislo_objednavky || 'dokument'}.pdf`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n    } catch (error) {\n      console.error('Chyba p≈ôi stahov√°n√≠ PDF:', error);\n      alert('Chyba p≈ôi stahov√°n√≠ PDF');\n    }\n  };\n\n  // Tisk PDF\n  const handlePrint = () => {\n    if (pdfUrl) {\n      const iframe = document.getElementById('pdf-iframe');\n      if (iframe && iframe.contentWindow) {\n        iframe.contentWindow.print();\n      }\n    }\n  };\n\n  // Zav≈ôen√≠ na ESC\n  useEffect(() => {\n    const handleEsc = (e) => {\n      if (e.key === 'Escape') {\n        onClose();\n      }\n    };\n    window.addEventListener('keydown', handleEsc);\n    return () => window.removeEventListener('keydown', handleEsc);\n  }, [onClose]);\n\n  return createPortal(\n    <ModalOverlay onClick={onClose}>\n      <ModalContainer onClick={(e) => e.stopPropagation()}>\n        <ModalHeader>\n          <ModalTitle>\n            üìã Finanƒçn√≠ kontrola - {order?.cislo_objednavky || 'N√°hled'}\n          </ModalTitle>\n          \n          <ModalActions>\n            <ActionButton\n              variant=\"secondary\"\n              onClick={handleDownload}\n              disabled={isLoading}\n              title=\"St√°hnout PDF\"\n            >\n              <FontAwesomeIcon icon={faFileDownload} />\n              St√°hnout\n            </ActionButton>\n            \n            <ActionButton\n              variant=\"primary\"\n              onClick={handlePrint}\n              disabled={isLoading}\n              title=\"Vytisknout PDF\"\n            >\n              <FontAwesomeIcon icon={faPrint} />\n              Tisknout\n            </ActionButton>\n\n            <CloseButton onClick={onClose} title=\"Zav≈ô√≠t (ESC)\">\n              <FontAwesomeIcon icon={faTimes} />\n            </CloseButton>\n          </ModalActions>\n        </ModalHeader>\n\n        <ModalBody>\n          <IframeContainer>\n            {isLoading && (\n              <LoadingContainer>\n                <SpinnerIcon icon={faSpinner} />\n                <LoadingText>Generuji PDF n√°hled...</LoadingText>\n              </LoadingContainer>\n            )}\n            \n            {pdfUrl && (\n              <PDFIframe\n                id=\"pdf-iframe\"\n                src={pdfUrl}\n                title=\"PDF N√°hled - Finanƒçn√≠ kontrola\"\n              />\n            )}\n          </IframeContainer>\n        </ModalBody>\n      </ModalContainer>\n    </ModalOverlay>,\n    document.body\n  );\n};\n\nexport default FinancialControlModal;\n"],"names":["ModalOverlay","styled","div","_templateObject","_taggedTemplateLiteral","ModalContainer","_templateObject2","ModalHeader","_templateObject3","ModalTitle","h2","_templateObject4","ModalActions","_templateObject5","ActionButton","button","_templateObject6","props","variant","CloseButton","_templateObject7","ModalBody","_templateObject8","IframeContainer","_templateObject9","PDFIframe","iframe","_templateObject0","LoadingContainer","_templateObject1","LoadingText","p","_templateObject10","SpinnerIcon","FontAwesomeIcon","_templateObject11","_ref","order","onClose","generatedBy","token","username","useContext","AuthContext","pdfUrl","setPdfUrl","useState","isLoading","setIsLoading","organizace","setOrganizace","strediskaMap","setStrediskaMap","useEffect","async","orgData","getOrganizaceDetail","id","error","console","strediskaData","getStrediska25","aktivni","reduce","acc","stredisko","_stredisko$raw","value","label","raw","kod_stavu","nazev_stavu","blob","pdf","_jsx","FinancialControlPDF","toBlob","url","URL","createObjectURL","alert","generatePDF","revokeObjectURL","handleEsc","e","key","window","addEventListener","removeEventListener","createPortal","onClick","children","_jsxs","stopPropagation","cislo_objednavky","link","document","createElement","href","download","concat","body","appendChild","click","removeChild","disabled","title","icon","faFileDownload","handlePrint","getElementById","contentWindow","print","faPrint","faTimes","faSpinner","src"],"sourceRoot":""}