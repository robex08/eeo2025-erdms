"use strict";(self.webpackChunkr_app_zzs_eeo=self.webpackChunkr_app_zzs_eeo||[]).push([[6366],{56366:(n,e,o)=>{o.d(e,{DocxGeneratorModal:()=>fn});var t=o(57528),r=o(65043),a=o(97950),i=o(45903),l=o(83910),d=o(97929),s=o(27837),c=o(88720),p=o(36629),m=o(95162),u=o(26159),v=o.n(u);function h(n){if(!n)return n;if("string"===typeof n&&/^\d{2}\.\d{2}\.\d{4}$/.test(n))return n;try{let e;if("string"===typeof n)if(/^\d{4}-\d{2}-\d{2}/.test(n))e=new Date(n);else if(/^\d{1,2}\.\s*\d{1,2}\.\s*\d{4}/.test(n)){const o=n.split(".").map(n=>n.trim()),t=parseInt(o[0],10),r=parseInt(o[1],10)-1,a=parseInt(o[2],10);e=new Date(a,r,t)}else e=new Date(n);else{if(!(n instanceof Date))return n;e=n}if(isNaN(e.getTime()))return n;const o=String(e.getDate()).padStart(2,"0"),t=String(e.getMonth()+1).padStart(2,"0"),r=e.getFullYear();return"".concat(o,".").concat(t,".").concat(r)}catch(e){return n}}async function f(n){let{templateId:e,orderId:o,token:t,username:r,template:a,selectedUserId:i=null}=n;try{var l;let n=null;try{const o=await(0,p.U1)({token:t,username:r,id:e});if(!o||!o.data)throw new Error("\u0160ablona nenalezena nebo nem\xe1 data");n=o.data}catch(s){throw console.error("\u274c Chyba p\u0159i na\u010d\xedt\xe1n\xed detailu \u0161ablony:",s),new Error("Nepoda\u0159ilo se na\u010d\xedst \u0161ablonu ID ".concat(e,": ").concat(s.message))}const a=await(0,p.F_)({token:t,username:r,id:e,fileName:n.nazev||"template.docx"}),c=await v().loadAsync(a),u=await(null===(l=c.file("word/document.xml"))||void 0===l?void 0:l.async("text"));if(!u)throw new Error("Neplatn\xe1 DOCX \u0161ablona - chyb\xed document.xml");let f={};const b=n.docx_mapping||n.mapovani_json;if(!b)throw new Error("\u0160ablona nem\xe1 definovan\xe9 mapov\xe1n\xed pol\xed (mapovani_json). Nejd\u0159\xedve upravte \u0161ablonu a definujte mapov\xe1n\xed.");try{f="string"===typeof b?JSON.parse(b):b}catch(s){throw console.error("\u274c Chyba p\u0159i parsov\xe1n\xed mapovani_json:",s),new Error("Neplatn\xe9 JSON mapov\xe1n\xed v \u0161ablon\u011b: ".concat(s.message))}const x=await(0,m.h7)({token:t,username:r,objednavka_id:o});if(!x)throw new Error("Nepoda\u0159ilo se z\xedskat enriched data z backendu");if(i&&x.vypocitane){var d;const n=null===(d=x.dostupni_uzivatele_pro_podpis)||void 0===d?void 0:d.find(n=>parseInt(n.id)===parseInt(i));n&&(x.vypocitane.vybrany_uzivatel_cele_jmeno=n.cele_jmeno,x.vypocitane.vybrany_uzivatel_role=n.role,x.vypocitane.vybrany_uzivatel_lokalita=n.lokalita_nazev)}const j=function(n,e){const o={},t=[];return Object.entries(e).forEach(e=>{let[r,a]=e,i="";try{if("string"===typeof a&&a.includes(" + ")){const e=a.split(" + ").map(n=>n.trim());i=e.map(e=>h(g(n,e)||"")).filter(n=>n).join(" ")}else i=g(n,a),void 0===i||null===i?(t.push({docxField:r,dbPath:a}),i=""):i=h(i)}catch(s){i=""}o[r]=String(i||"")}),o}(x,f);let y=function(n,e){try{const o=new window.DOMParser,t=new window.XMLSerializer,r=o.parseFromString(n,"application/xml");let a=0,i=0;function l(n){if(!n||!n.childNodes)return;let o=[];for(let e=0;e<n.childNodes.length;e++){const t=n.childNodes[e];1===t.nodeType&&"r"===t.localName&&o.push(t)}let t=0;for(;t<o.length;){let l=-1,d=-1,s=null,c="";for(let n=t;n<o.length;n++){const e=o[n];for(let t=0;t<e.childNodes.length;t++){const r=e.childNodes[t];if(1===r.nodeType&&"fldChar"===r.localName){if("begin"===(r.getAttribute("w:fldCharType")||r.getAttribute("fldCharType"))){l=n;let e=!1;for(let r=n+1;r<o.length;r++){const n=o[r];for(let o=0;o<n.childNodes.length;o++){const t=n.childNodes[o];if(1===t.nodeType&&"instrText"===t.localName&&(c+=t.textContent),1===t.nodeType&&"fldChar"===t.localName){if("end"===(t.getAttribute("w:fldCharType")||t.getAttribute("fldCharType"))){d=r,e=!0;break}}}if(e)break}const t=/(DOCVARIABLE|MERGEFIELD)\s+([A-Z0-9_._ ]{1,})/i.exec(c.replace(/\s+/g," "));t&&(s=t[2].replace(/\s+/g,""));break}}}if(-1!==l)break}if(-1!==l&&-1!==d&&s){const c=e[s];if(!(s in e)){for(let e=d;e>=l;e--)n.removeChild(o[e]);o=Array.from(n.childNodes).filter(n=>1===n.nodeType&&"r"===n.localName),t=0,i++;continue}if(void 0!==c&&null!==c){const e=o[l];for(;e.firstChild;)e.removeChild(e.firstChild);const i=r.createElementNS(e.namespaceURI,"w:t");i.textContent=String(c),e.appendChild(i);for(let t=d;t>l;t--)n.removeChild(o[t]);o=Array.from(n.childNodes).filter(n=>1===n.nodeType&&"r"===n.localName),t=0,a++;continue}}t++}for(let e=0;e<n.childNodes.length;e++)l(n.childNodes[e])}return l(r.documentElement),t.serializeToString(r)}catch(s){console.error("\u274c Chyba p\u0159i DOM parsov\xe1n\xed XML:",s);let c=n;return Object.entries(e).forEach(n=>{let[e,o]=n;const t="{".concat(e,"}");c.includes(t)&&(c=c.replace(new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),String(o||"")))}),c}}(u,j);c.file("word/document.xml",y);return await c.generateAsync({type:"blob",mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"})}catch(s){throw console.error("\u274c Chyba p\u0159i generov\xe1n\xed DOCX:",s),s}}function g(n,e){if(n&&e)try{return e.replace(/\[(\d+)\]/g,".$1").split(".").filter(n=>""!==n).reduce((n,e)=>{if(void 0!==n&&null!==n){if(/^\d+$/.test(e)){const o=parseInt(e,10);return Array.isArray(n)&&void 0!==n[o]?n[o]:void 0}return n[e]}},n)}catch(o){return}}var b,x,j,y,_,k,w,z,N,A,C,D,E,O,I,S,T,X,P,V,$,G,R,L,U,F=o(70579);const M=i.A.div(b||(b=(0,t.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.4);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 9999;\n  animation: fadeIn 0.2s ease-out;\n\n  @keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n"]))),Y=i.A.div(x||(x=(0,t.A)(["\n  background: white;\n  border-radius: 12px;\n  padding: 0;\n  max-width: 1200px;\n  width: 95%;\n  max-height: 90vh;\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n  border: 1px solid #e5e7eb;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp 0.3s ease-out;\n\n  @keyframes slideUp {\n    from {\n      opacity: 0;\n      transform: translateY(20px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n"]))),W=i.A.div(j||(j=(0,t.A)(["\n  padding: 1.5rem;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n\n  h2 {\n    margin: 0;\n    color: white;\n    font-size: 1.25rem;\n    font-weight: 700;\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n\n    svg {\n      color: white;\n    }\n  }\n"]))),Z=i.A.button(y||(y=(0,t.A)(["\n  background: none;\n  border: none;\n  font-size: 1.5rem;\n  color: rgba(255, 255, 255, 0.9);\n  cursor: pointer;\n  padding: 0.5rem;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.2);\n    color: white;\n  }\n\n  &:active {\n    transform: scale(0.95);\n  }\n"]))),K=i.A.div(_||(_=(0,t.A)(["\n  padding: 1.5rem;\n  overflow-y: auto;\n  flex: 1;\n  display: flex;\n  gap: 1.5rem;\n\n  @media (max-width: 1200px) {\n    flex-direction: column;\n  }\n"]))),B=i.A.div(k||(k=(0,t.A)(["\n  flex: 0 0 400px;\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n\n  @media (max-width: 1200px) {\n    flex: 1;\n  }\n"]))),J=i.A.div(w||(w=(0,t.A)(["\n  flex: 1;\n  min-width: 0; /* Umo\u017en\xed spr\xe1vn\xe9 shrinkov\xe1n\xed */\n"]))),H=i.A.div(z||(z=(0,t.A)(["\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 0.75rem;\n\n  @media (max-width: 640px) {\n    grid-template-columns: 1fr;\n  }\n"]))),q=i.A.div(N||(N=(0,t.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n\n  &.full-width {\n    grid-column: 1 / -1;\n  }\n"]))),Q=i.A.div(A||(A=(0,t.A)(["\n  grid-column: 1 / -1;\n  border-top: 1px solid #cbd5e1;\n  margin: 0.5rem 0;\n"]))),nn=i.A.div(C||(C=(0,t.A)(["\n  background: linear-gradient(135deg, #dbeafe 0%, #f0f9ff 100%);\n  border: 2px solid #93c5fd;\n  border-radius: 12px;\n  padding: 1.25rem;\n  margin-bottom: 1.5rem;\n\n  h3 {\n    margin: 0 0 1rem 0;\n    color: #1e40af;\n    font-size: 1.05rem;\n    font-weight: 700;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n\n    svg {\n      color: #3b82f6;\n    }\n  }\n"]))),en=i.A.div(D||(D=(0,t.A)(["\n  background: linear-gradient(135deg, #fef3c7 0%, #fef9f5 100%);\n  border: 2px solid #fcd34d;\n  border-radius: 12px;\n  padding: 1.25rem;\n  margin-bottom: 1.5rem;\n\n  h3 {\n    margin: 0 0 1rem 0;\n    color: #92400e;\n    font-size: 1.05rem;\n    font-weight: 700;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n\n    svg {\n      color: #f59e0b;\n    }\n  }\n\n  p {\n    margin: 0 0 1rem 0;\n    color: #78350f;\n    font-size: 0.875rem;\n    line-height: 1.5;\n  }\n"]))),on=i.A.select(E||(E=(0,t.A)(["\n  width: 100%;\n  padding: 0.75rem;\n  border: 2px solid #e5e7eb;\n  border-radius: 8px;\n  font-size: 0.95rem;\n  font-weight: 500;\n  color: #1e293b;\n  background: white;\n  cursor: pointer;\n  transition: all 0.2s;\n\n  &:hover {\n    border-color: #10b981;\n  }\n\n  &:focus {\n    outline: none;\n    border-color: #10b981;\n    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);\n  }\n\n  &:disabled {\n    background: #f1f5f9;\n    cursor: not-allowed;\n    opacity: 0.6;\n  }\n\n  option {\n    padding: 0.5rem;\n  }\n\n  option:disabled {\n    color: #94a3b8;\n    font-style: italic;\n  }\n"]))),tn=i.A.span(O||(O=(0,t.A)(["\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: #64748b;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n"]))),rn=i.A.span(I||(I=(0,t.A)(["\n  font-size: 0.95rem;\n  color: #1e293b;\n  font-weight: 500;\n\n  &.highlighted {\n    color: #3b82f6;\n    font-weight: 700;\n    font-size: 1.05rem;\n  }\n\n  &.price {\n    color: #059669;\n    font-weight: 700;\n  }\n\n  &.missing {\n    color: #94a3b8;\n    font-style: italic;\n  }\n"]))),an=i.A.div(S||(S=(0,t.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n"]))),ln=i.A.div(T||(T=(0,t.A)(["\n  margin-bottom: 1rem;\n\n  h3 {\n    margin: 0 0 0.5rem 0;\n    color: #374151;\n    font-size: 1.05rem;\n    font-weight: 700;\n  }\n\n  p {\n    margin: 0;\n    color: #64748b;\n    font-size: 0.875rem;\n  }\n"]))),dn=i.A.div(X||(X=(0,t.A)(["\n  border: 2px solid ",";\n  border-radius: 10px;\n  padding: 1.25rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  background: ",";\n  position: relative;\n\n  &:hover {\n    border-color: ",";\n    background: ",";\n    transform: translateX(4px);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n  }\n\n  &:active {\n    transform: translateX(2px);\n  }\n\n  ","\n\n  h4 {\n    margin: 0 0 0.5rem 0;\n    color: #1e293b;\n    font-size: 1.05rem;\n    font-weight: 700;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding-right: ",";\n\n    svg {\n      color: ",";\n    }\n\n    .template-type {\n      font-size: 0.8rem;\n      font-weight: 400;\n      color: #94a3b8;\n      margin-left: 0.25rem;\n    }\n  }\n\n  p {\n    margin: 0.5rem 0;\n    color: #64748b;\n    font-size: 0.875rem;\n    line-height: 1.5;\n  }\n\n  .meta {\n    font-size: 0.75rem;\n    color: #94a3b8;\n    margin-top: 0.75rem;\n    padding-top: 0.75rem;\n    border-top: 1px solid #e5e7eb;\n    display: flex;\n    gap: 0.75rem;\n    flex-wrap: wrap;\n\n    span {\n      display: inline-flex;\n      align-items: center;\n      gap: 0.25rem;\n\n      &::before {\n        content: '\u2022';\n        color: #cbd5e1;\n      }\n\n      &:first-of-type::before {\n        content: '';\n      }\n    }\n  }\n"])),n=>n.$selected?"#3b82f6":"#e5e7eb",n=>n.$selected?"#eff6ff":"white",n=>n.$selected?"#2563eb":"#cbd5e1",n=>n.$selected?"#eff6ff":"#f8fafc",n=>n.$selected&&"\n    &::after {\n      content: '\u2713';\n      position: absolute;\n      top: 1rem;\n      right: 1rem;\n      width: 28px;\n      height: 28px;\n      background: #3b82f6;\n      color: white;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: 700;\n      font-size: 0.875rem;\n    }\n  ",n=>n.$selected?"2.5rem":"0",n=>n.$selected?"#3b82f6":"#64748b"),sn=i.A.div(P||(P=(0,t.A)(["\n  padding: 1.5rem;\n  border-top: 1px solid #e5e7eb;\n  display: flex;\n  gap: 1rem;\n  justify-content: flex-end;\n  background: #f8fafc;\n"]))),cn=i.A.button(V||(V=(0,t.A)(["\n  padding: 0.75rem 1.5rem;\n  border-radius: 8px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  border: 2px solid;\n\n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n\n  &:not(:disabled):active {\n    transform: translateY(1px);\n  }\n"]))),pn=(0,i.A)(cn)($||($=(0,t.A)(["\n  background: white;\n  border-color: #d1d5db;\n  color: #6b7280;\n\n  &:hover:not(:disabled) {\n    background: #f9fafb;\n    border-color: #9ca3af;\n    color: #374151;\n  }\n"]))),mn=(0,i.A)(cn)(G||(G=(0,t.A)(["\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  border-color: #10b981;\n  color: white;\n\n  &:hover:not(:disabled) {\n    background: linear-gradient(135deg, #059669 0%, #047857 100%);\n    border-color: #059669;\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);\n  }\n"]))),un=i.A.div(R||(R=(0,t.A)(["\n  text-align: center;\n  padding: 3rem 2rem;\n  color: #64748b;\n\n  .spinner {\n    margin-bottom: 1rem;\n    font-size: 2.5rem;\n    color: #3b82f6;\n    animation: spin 1s linear infinite;\n  }\n\n  p {\n    margin: 0;\n    font-size: 1rem;\n  }\n\n  @keyframes spin {\n    from { transform: rotate(0deg); }\n    to { transform: rotate(360deg); }\n  }\n"]))),vn=i.A.div(L||(L=(0,t.A)(["\n  text-align: center;\n  padding: 3rem 2rem;\n  color: #dc2626;\n\n  .icon {\n    margin-bottom: 1rem;\n    font-size: 2.5rem;\n  }\n\n  p {\n    margin: 0;\n    font-size: 1rem;\n    line-height: 1.6;\n  }\n"]))),hn=i.A.div(U||(U=(0,t.A)(["\n  text-align: center;\n  padding: 3rem 2rem;\n  color: #64748b;\n\n  .icon {\n    margin-bottom: 1rem;\n    font-size: 2.5rem;\n  }\n\n  p {\n    margin: 0;\n    font-size: 1rem;\n  }\n"]))),fn=n=>{var e;let{order:o,isOpen:t,onClose:i}=n;const{user:m,token:u}=(0,r.useContext)(s.cy),{showToast:v}=(0,r.useContext)(c.$o),[h,g]=(0,r.useState)([]),[b,x]=(0,r.useState)(null),[j,y]=(0,r.useState)(!1),[_,k]=(0,r.useState)(!1),[w,z]=(0,r.useState)(null),[N,A]=(0,r.useState)(-1),[C,D]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(!t||!o)return;(()=>{var n,e,t,r,a,i,l,d,s;const c=[];if(o.garant_uzivatel_id&&null!==(n=o.garant_uzivatel)&&void 0!==n&&n.cele_jmeno&&"Nezad\xe1no"!==o.garant_uzivatel.cele_jmeno&&"Nezadano"!==o.garant_uzivatel.cele_jmeno&&c.push({id:o.garant_uzivatel_id,name:o.garant_uzivatel.cele_jmeno,role:"Garant"}),o.prikazce_id&&null!==(e=o.prikazce_uzivatel)&&void 0!==e&&e.cele_jmeno&&"Nezad\xe1no"!==o.prikazce_uzivatel.cele_jmeno&&"Nezadano"!==o.prikazce_uzivatel.cele_jmeno&&c.push({id:o.prikazce_id,name:o.prikazce_uzivatel.cele_jmeno,role:"P\u0159\xedkazce"}),o.schvalovatel_id&&null!==(t=o.schvalovatel)&&void 0!==t&&t.cele_jmeno&&"Nezad\xe1no"!==o.schvalovatel.cele_jmeno&&"Nezadano"!==o.schvalovatel.cele_jmeno&&c.push({id:o.schvalovatel_id,name:o.schvalovatel.cele_jmeno,role:"Schvalovatel"}),o.uzivatel_id&&null!==(r=o.uzivatel)&&void 0!==r&&r.cele_jmeno&&"Nezad\xe1no"!==o.uzivatel.cele_jmeno&&"Nezadano"!==o.uzivatel.cele_jmeno&&c.push({id:o.uzivatel_id,name:o.uzivatel.cele_jmeno,role:"Objednatel"}),o.dodavatel_potvrdil_id&&null!==(a=o.dodavatel_potvrdil)&&void 0!==a&&a.cele_jmeno&&"Nezad\xe1no"!==o.dodavatel_potvrdil.cele_jmeno&&"Nezadano"!==o.dodavatel_potvrdil.cele_jmeno&&c.push({id:o.dodavatel_potvrdil_id,name:o.dodavatel_potvrdil.cele_jmeno,role:"Dodavatel potvrdil"}),o.odesilatel_id&&null!==(i=o.odesilatel)&&void 0!==i&&i.cele_jmeno&&"Nezad\xe1no"!==o.odesilatel.cele_jmeno&&"Nezadano"!==o.odesilatel.cele_jmeno&&c.push({id:o.odesilatel_id,name:o.odesilatel.cele_jmeno,role:"Odes\xedlatel"}),o.fakturant_id&&null!==(l=o.fakturant)&&void 0!==l&&l.cele_jmeno&&"Nezad\xe1no"!==o.fakturant.cele_jmeno&&"Nezadano"!==o.fakturant.cele_jmeno&&c.push({id:o.fakturant_id,name:o.fakturant.cele_jmeno,role:"Fakturant"}),o.potvrdil_vecnou_spravnost_id&&null!==(d=o.potvrdil_vecnou_spravnost)&&void 0!==d&&d.cele_jmeno&&"Nezad\xe1no"!==o.potvrdil_vecnou_spravnost.cele_jmeno&&"Nezadano"!==o.potvrdil_vecnou_spravnost.cele_jmeno&&c.push({id:o.potvrdil_vecnou_spravnost_id,name:o.potvrdil_vecnou_spravnost.cele_jmeno,role:"Potvrdil v\u011bcnou spr\xe1vnost"}),o.dokoncil_id&&null!==(s=o.dokoncil)&&void 0!==s&&s.cele_jmeno&&"Nezad\xe1no"!==o.dokoncil.cele_jmeno&&"Nezadano"!==o.dokoncil.cele_jmeno&&c.push({id:o.dokoncil_id,name:o.dokoncil.cele_jmeno,role:"Dokon\u010dil objedn\xe1vku"}),D(c),c.length>0){const n=c.findIndex(n=>"P\u0159\xedkazce"===n.role);A(-1!==n?n:0)}})(),(async()=>{try{y(!0),z(null);const n=await(0,p.Dv)({token:u,username:null===m||void 0===m?void 0:m.username,aktivni:1}),e=(null===n||void 0===n?void 0:n.data)||[];g(e),0===e.length?z("V datab\xe1zi nejsou k dispozici \u017e\xe1dn\xe9 aktivn\xed DOCX \u0161ablony"):1===e.length&&x(e[0])}catch(w){z("Nepoda\u0159ilo se na\u010d\xedst seznam DOCX \u0161ablon: ".concat(w.message)),null===v||void 0===v||v("Chyba p\u0159i na\u010d\xedt\xe1n\xed DOCX \u0161ablon: ".concat(w.message),{type:"error"})}finally{y(!1)}})()},[t,o,u,m,v]);return t?a.createPortal((0,F.jsx)(M,{onClick:i,children:(0,F.jsxs)(Y,{onClick:n=>n.stopPropagation(),children:[(0,F.jsxs)(W,{children:[(0,F.jsxs)("h2",{children:[(0,F.jsx)(l.g,{icon:d.W1P}),"Generovat DOCX dokument"]}),(0,F.jsx)(Z,{onClick:i,title:"Zav\u0159\xedt",children:(0,F.jsx)(l.g,{icon:d.GRI})})]}),(0,F.jsxs)(K,{children:[(0,F.jsxs)(B,{children:[o&&(0,F.jsxs)(nn,{children:[(0,F.jsxs)("h3",{children:[(0,F.jsx)(l.g,{icon:d.iW_}),"Informace o objedn\xe1vce"]}),(0,F.jsxs)(H,{children:[(0,F.jsxs)(q,{className:"full-width",children:[(0,F.jsx)(tn,{children:"\u010c\xcdSLO OBJEDN\xc1VKY"}),(0,F.jsx)(rn,{className:"highlighted",children:(null===o||void 0===o?void 0:o.cislo_objednavky)||(null===o||void 0===o?void 0:o.id)||"N/A"})]}),(0,F.jsxs)(q,{className:"full-width",children:[(0,F.jsx)(tn,{children:"P\u0158EDM\u011aT"}),(0,F.jsx)(rn,{children:(null===o||void 0===o?void 0:o.predmet)||(null===o||void 0===o?void 0:o.nazev)||(0,F.jsx)("span",{className:"missing",children:"Bez p\u0159edm\u011btu"})})]}),(0,F.jsx)(Q,{}),(0,F.jsxs)(q,{children:[(0,F.jsx)(tn,{children:"STAV"}),(0,F.jsx)(rn,{children:(null===o||void 0===o?void 0:o.stav_objednavky)||(0,F.jsx)("span",{className:"missing",children:"Nezn\xe1m\xfd"})})]}),(0,F.jsxs)(q,{children:[(0,F.jsx)(tn,{children:"CELKOV\xc1 CENA S DPH"}),(0,F.jsx)(rn,{className:"price",children:(E=(null===o||void 0===o?void 0:o.max_cena_s_dph)||(null===o||void 0===o?void 0:o.polozky_celkova_cena_s_dph),(E?new Intl.NumberFormat("cs-CZ",{style:"currency",currency:"CZK",minimumFractionDigits:2,maximumFractionDigits:2}).format(E):null)||(0,F.jsx)("span",{className:"missing",children:"Nezad\xe1no"}))})]}),(0,F.jsxs)(q,{children:[(0,F.jsx)(tn,{children:"DODAVATEL"}),(0,F.jsx)(rn,{children:(null===o||void 0===o?void 0:o.dodavatel_nazev)||(0,F.jsx)("span",{className:"missing",children:"Nezad\xe1no"})})]}),(0,F.jsxs)(q,{children:[(0,F.jsx)(tn,{children:"I\u010cO"}),(0,F.jsx)(rn,{children:(null===o||void 0===o?void 0:o.dodavatel_ico)||(0,F.jsx)("span",{className:"missing",children:"Nezad\xe1no"})})]}),(0,F.jsxs)(q,{children:[(0,F.jsx)(tn,{children:"GARANT"}),(0,F.jsx)(rn,{children:(null===o||void 0===o||null===(e=o.garant_uzivatel)||void 0===e?void 0:e.cele_jmeno)||(0,F.jsx)("span",{className:"missing",children:"Nezad\xe1no"})})]})]})]}),!j&&!w&&o&&(0,F.jsxs)(en,{children:[(0,F.jsxs)("h3",{children:[(0,F.jsx)(l.g,{icon:d.X46}),"Vyberte u\u017eivatele pro dokument"]}),(0,F.jsxs)("p",{children:["Vybran\xfd u\u017eivatel bude dosazen do vypo\u010d\xedtan\xfdch pol\xed dokumentu (cel\xe9 jm\xe9no v\u010detn\u011b titul\u016f).",C.length>0?" M\u016f\u017eete vybrat garanta, p\u0159ikazce, schvalovatele nebo jin\xe9ho u\u017eivatele z workflow.":' \u26a0\ufe0f V t\xe9to objedn\xe1vce nejsou definov\xe1ni \u017e\xe1dn\xed u\u017eivatel\xe9 (v\u0161ichni jsou "Nezad\xe1no").']}),C.length>0?(0,F.jsxs)(on,{value:N,onChange:n=>A(parseInt(n.target.value,10)),disabled:_,children:[(0,F.jsx)("option",{value:"-1",disabled:!0,children:"-- Vyberte u\u017eivatele --"}),C.map((n,e)=>(0,F.jsxs)("option",{value:e,children:[n.name," (",n.role,")"]},e))]}):(0,F.jsxs)("div",{style:{padding:"1rem",background:"#fee2e2",border:"2px solid #fca5a5",borderRadius:"8px",color:"#991b1b",fontWeight:500},children:["\u26a0\ufe0f Nelze generovat DOCX - v objedn\xe1vce nejsou definov\xe1ni \u017e\xe1dn\xed u\u017eivatel\xe9!",(0,F.jsx)("br",{}),(0,F.jsx)("small",{style:{fontSize:"0.875rem",marginTop:"0.5rem",display:"block"},children:"Pros\xedm dopl\u0148te garanta, p\u0159ikazce nebo jin\xe9ho u\u017eivatele v objedn\xe1vce."})]})]})]}),(0,F.jsxs)(J,{children:[j&&(0,F.jsxs)(un,{children:[(0,F.jsx)("div",{className:"spinner",children:(0,F.jsx)(l.g,{icon:d.z1G})}),(0,F.jsx)("p",{children:"Na\u010d\xedt\xe1m DOCX \u0161ablony..."})]}),w&&(0,F.jsxs)(vn,{children:[(0,F.jsx)("div",{className:"icon",children:(0,F.jsx)(l.g,{icon:d.zpE})}),(0,F.jsx)("p",{children:w})]}),!j&&!w&&0===h.length&&(0,F.jsxs)(hn,{children:[(0,F.jsx)("div",{className:"icon",children:(0,F.jsx)(l.g,{icon:d.W1P})}),(0,F.jsx)("p",{children:"Nejsou k dispozici \u017e\xe1dn\xe9 aktivn\xed DOCX \u0161ablony"})]}),!j&&!w&&h.length>0&&(0,F.jsxs)("div",{children:[(0,F.jsxs)(ln,{children:[(0,F.jsx)("h3",{children:"Vyberte DOCX \u0161ablonu"}),(0,F.jsxs)("p",{children:["K dispozici ",h.length," ",1===h.length?"\u0161ablona":h.length<5?"\u0161ablony":"\u0161ablon"]})]}),(0,F.jsx)(an,{children:h.map(n=>(0,F.jsxs)(dn,{$selected:(null===b||void 0===b?void 0:b.id)===n.id,onClick:()=>x(n),children:[(0,F.jsxs)("h4",{children:[(0,F.jsx)(l.g,{icon:d.W1P}),n.nazev||"\u0160ablona ".concat(n.id),n.typ_dokumentu&&(0,F.jsxs)("span",{className:"template-type",children:[" (",n.typ_dokumentu,")"]})]}),n.popis&&(0,F.jsx)("p",{children:n.popis})]},n.id))})]})]})]}),(0,F.jsxs)(sn,{children:[(0,F.jsxs)(pn,{onClick:i,children:[(0,F.jsx)(l.g,{icon:d.GRI}),"Zru\u0161it"]}),(0,F.jsx)(mn,{onClick:async()=>{if(!b||!o)return;if(-1===N||!C[N])return void(null===v||void 0===v||v("Pros\xedm vyberte u\u017eivatele, kter\xfd bude dosazen do dokumentu",{type:"warning"}));const n=C[N].id;try{k(!0);const e=o.id||o.objednavka_id||o.order_id;if(!e)throw new Error("Chyb\xed ID objedn\xe1vky");const t=await f({templateId:b.id,orderId:e,token:u,username:null===m||void 0===m?void 0:m.username,template:b,selectedUserId:n});!function(n,e){const o=window.URL.createObjectURL(n),t=document.createElement("a");t.href=o,t.download=e,document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(o),document.body.removeChild(t)}(t,"objednavka_".concat(o.cislo_objednavky||e,"_").concat(b.nazev,".docx")),null===v||void 0===v||v('\ud83d\udcc4 DOCX dokument "'.concat(b.nazev,'" byl \xfasp\u011b\u0161n\u011b vygenerov\xe1n a sta\u017een'),{type:"success"}),i()}catch(w){null===v||void 0===v||v("Chyba p\u0159i generov\xe1n\xed DOCX dokumentu: ".concat(w.message),{type:"error"})}finally{k(!1)}},disabled:!b||_||0===C.length,title:b?0===C.length?"V objedn\xe1vce nejsou definov\xe1ni \u017e\xe1dn\xed u\u017eivatel\xe9":_?"Generov\xe1n\xed prob\xedh\xe1...":"Generovat DOCX dokument":"Vyberte DOCX \u0161ablonu",children:_?(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(l.g,{icon:d.z1G,className:"fa-spin"}),"Generuji..."]}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(l.g,{icon:d.cbP}),"Generovat DOCX"]})})]})]})}),document.body):null;var E}},95162:(n,e,o)=>{o.d(e,{h7:()=>a});const t=o(56263).A.create({baseURL:"https://erdms.zachranka.cz/api.eeo/",headers:{"Content-Type":"application/json"}});function r(n){var e,o,t,r,a,i,l;return null!==(e=n.response)&&void 0!==e&&null!==(o=e.data)&&void 0!==o&&o.message?n.response.data.message:null!==(t=n.response)&&void 0!==t&&null!==(r=t.data)&&void 0!==r&&r.error?n.response.data.error:null!==(a=n.response)&&void 0!==a&&null!==(i=a.data)&&void 0!==i&&i.err?n.response.data.err:null!==(l=n.response)&&void 0!==l&&l.data?n.response.data:n.message?n.message:"Nezn\xe1m\xe1 chyba p\u0159i komunikaci se serverem"}async function a(n){let{token:e,username:o,objednavka_id:a}=n;if(!e||!o)throw new Error("Chyb\xed p\u0159\xedstupov\xfd token nebo u\u017eivatelsk\xe9 jm\xe9no. P\u0159ihlaste se pros\xedm znovu.");if(null===a||void 0===a)throw new Error("Chyb\xed ID objedn\xe1vky.");try{const n={token:e,username:o,objednavka_id:parseInt(a)},r=await t.post("sablona_docx/order-enriched-data",n,{timeout:1e4});if(200!==r.status)throw new Error("Neo\u010dek\xe1van\xfd k\xf3d odpov\u011bdi p\u0159i na\u010d\xedt\xe1n\xed enriched dat");const i=r.data;if(i.err)throw new Error(i.err);if("ok"===i.status&&i.data)return i.data;throw new Error("Neo\u010dek\xe1van\xe1 struktura odpov\u011bdi ze serveru")}catch(i){throw console.error("\u274c Chyba p\u0159i na\u010d\xedt\xe1n\xed DOCX enriched data:",i),new Error(r(i))}}t.interceptors.response.use(n=>n,n=>{var e,o,t;if((401===(null===(e=n.response)||void 0===e?void 0:e.status)||403===(null===(o=n.response)||void 0===o?void 0:o.status))&&"undefined"!==typeof window){const n=new CustomEvent("authError",{detail:{message:"Va\u0161e p\u0159ihl\xe1\u0161en\xed vypr\u0161elo. P\u0159ihlaste se pros\xedm znovu."}});window.dispatchEvent(n)}const r=(null===(t=n.response)||void 0===t?void 0:t.data)||"";if("string"===typeof r&&r.includes("<!doctype")&&"undefined"!==typeof window){const n=new CustomEvent("authError",{detail:{message:"Va\u0161e p\u0159ihl\xe1\u0161en\xed vypr\u0161elo. Obnovte str\xe1nku a p\u0159ihlaste se znovu."}});window.dispatchEvent(n)}return Promise.reject(n)})}}]);
//# sourceMappingURL=6366.971f6493.chunk.js.map